multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: sa_query.c 1389 2004-12-27 22:56:47Z roland $&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/dma-mapping.h&gt;
macro_line|#include &lt;linux/kref.h&gt;
macro_line|#include &lt;linux/idr.h&gt;
macro_line|#include &lt;ib_pack.h&gt;
macro_line|#include &lt;ib_sa.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Roland Dreier&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;InfiniBand subnet administration query support&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * These two structures must be packed because they have 64-bit fields&n; * that are only 32-bit aligned.  64-bit architectures will lay them&n; * out wrong otherwise.  (And unfortunately they are sent on the wire&n; * so we can&squot;t change the layout)&n; */
DECL|struct|ib_sa_hdr
r_struct
id|ib_sa_hdr
(brace
DECL|member|sm_key
id|u64
id|sm_key
suffix:semicolon
DECL|member|attr_offset
id|u16
id|attr_offset
suffix:semicolon
DECL|member|reserved
id|u16
id|reserved
suffix:semicolon
DECL|member|comp_mask
id|ib_sa_comp_mask
id|comp_mask
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|ib_sa_mad
r_struct
id|ib_sa_mad
(brace
DECL|member|mad_hdr
r_struct
id|ib_mad_hdr
id|mad_hdr
suffix:semicolon
DECL|member|rmpp_hdr
r_struct
id|ib_rmpp_hdr
id|rmpp_hdr
suffix:semicolon
DECL|member|sa_hdr
r_struct
id|ib_sa_hdr
id|sa_hdr
suffix:semicolon
DECL|member|data
id|u8
id|data
(braket
l_int|200
)braket
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|ib_sa_sm_ah
r_struct
id|ib_sa_sm_ah
(brace
DECL|member|ah
r_struct
id|ib_ah
op_star
id|ah
suffix:semicolon
DECL|member|ref
r_struct
id|kref
id|ref
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ib_sa_port
r_struct
id|ib_sa_port
(brace
DECL|member|agent
r_struct
id|ib_mad_agent
op_star
id|agent
suffix:semicolon
DECL|member|mr
r_struct
id|ib_mr
op_star
id|mr
suffix:semicolon
DECL|member|sm_ah
r_struct
id|ib_sa_sm_ah
op_star
id|sm_ah
suffix:semicolon
DECL|member|update_task
r_struct
id|work_struct
id|update_task
suffix:semicolon
DECL|member|ah_lock
id|spinlock_t
id|ah_lock
suffix:semicolon
DECL|member|port_num
id|u8
id|port_num
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ib_sa_device
r_struct
id|ib_sa_device
(brace
DECL|member|start_port
DECL|member|end_port
r_int
id|start_port
comma
id|end_port
suffix:semicolon
DECL|member|event_handler
r_struct
id|ib_event_handler
id|event_handler
suffix:semicolon
DECL|member|port
r_struct
id|ib_sa_port
id|port
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ib_sa_query
r_struct
id|ib_sa_query
(brace
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
r_struct
id|ib_sa_query
op_star
comma
r_int
comma
r_struct
id|ib_sa_mad
op_star
)paren
suffix:semicolon
DECL|member|release
r_void
(paren
op_star
id|release
)paren
(paren
r_struct
id|ib_sa_query
op_star
)paren
suffix:semicolon
DECL|member|port
r_struct
id|ib_sa_port
op_star
id|port
suffix:semicolon
DECL|member|mad
r_struct
id|ib_sa_mad
op_star
id|mad
suffix:semicolon
DECL|member|sm_ah
r_struct
id|ib_sa_sm_ah
op_star
id|sm_ah
suffix:semicolon
id|DECLARE_PCI_UNMAP_ADDR
c_func
(paren
id|mapping
)paren
r_int
id|id
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ib_sa_path_query
r_struct
id|ib_sa_path_query
(brace
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
comma
r_struct
id|ib_sa_path_rec
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|member|context
r_void
op_star
id|context
suffix:semicolon
DECL|member|sa_query
r_struct
id|ib_sa_query
id|sa_query
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ib_sa_mcmember_query
r_struct
id|ib_sa_mcmember_query
(brace
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
comma
r_struct
id|ib_sa_mcmember_rec
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|member|context
r_void
op_star
id|context
suffix:semicolon
DECL|member|sa_query
r_struct
id|ib_sa_query
id|sa_query
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|ib_sa_add_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
suffix:semicolon
r_static
r_void
id|ib_sa_remove_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
suffix:semicolon
DECL|variable|sa_client
r_static
r_struct
id|ib_client
id|sa_client
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sa&quot;
comma
dot
id|add
op_assign
id|ib_sa_add_one
comma
dot
id|remove
op_assign
id|ib_sa_remove_one
)brace
suffix:semicolon
DECL|variable|idr_lock
r_static
id|spinlock_t
id|idr_lock
suffix:semicolon
r_static
id|DEFINE_IDR
c_func
(paren
id|query_idr
)paren
suffix:semicolon
DECL|variable|tid_lock
r_static
id|spinlock_t
id|tid_lock
suffix:semicolon
DECL|variable|tid
r_static
id|u32
id|tid
suffix:semicolon
r_enum
(brace
DECL|enumerator|IB_SA_ATTR_CLASS_PORTINFO
id|IB_SA_ATTR_CLASS_PORTINFO
op_assign
l_int|0x01
comma
DECL|enumerator|IB_SA_ATTR_NOTICE
id|IB_SA_ATTR_NOTICE
op_assign
l_int|0x02
comma
DECL|enumerator|IB_SA_ATTR_INFORM_INFO
id|IB_SA_ATTR_INFORM_INFO
op_assign
l_int|0x03
comma
DECL|enumerator|IB_SA_ATTR_NODE_REC
id|IB_SA_ATTR_NODE_REC
op_assign
l_int|0x11
comma
DECL|enumerator|IB_SA_ATTR_PORT_INFO_REC
id|IB_SA_ATTR_PORT_INFO_REC
op_assign
l_int|0x12
comma
DECL|enumerator|IB_SA_ATTR_SL2VL_REC
id|IB_SA_ATTR_SL2VL_REC
op_assign
l_int|0x13
comma
DECL|enumerator|IB_SA_ATTR_SWITCH_REC
id|IB_SA_ATTR_SWITCH_REC
op_assign
l_int|0x14
comma
DECL|enumerator|IB_SA_ATTR_LINEAR_FDB_REC
id|IB_SA_ATTR_LINEAR_FDB_REC
op_assign
l_int|0x15
comma
DECL|enumerator|IB_SA_ATTR_RANDOM_FDB_REC
id|IB_SA_ATTR_RANDOM_FDB_REC
op_assign
l_int|0x16
comma
DECL|enumerator|IB_SA_ATTR_MCAST_FDB_REC
id|IB_SA_ATTR_MCAST_FDB_REC
op_assign
l_int|0x17
comma
DECL|enumerator|IB_SA_ATTR_SM_INFO_REC
id|IB_SA_ATTR_SM_INFO_REC
op_assign
l_int|0x18
comma
DECL|enumerator|IB_SA_ATTR_LINK_REC
id|IB_SA_ATTR_LINK_REC
op_assign
l_int|0x20
comma
DECL|enumerator|IB_SA_ATTR_GUID_INFO_REC
id|IB_SA_ATTR_GUID_INFO_REC
op_assign
l_int|0x30
comma
DECL|enumerator|IB_SA_ATTR_SERVICE_REC
id|IB_SA_ATTR_SERVICE_REC
op_assign
l_int|0x31
comma
DECL|enumerator|IB_SA_ATTR_PARTITION_REC
id|IB_SA_ATTR_PARTITION_REC
op_assign
l_int|0x33
comma
DECL|enumerator|IB_SA_ATTR_RANGE_REC
id|IB_SA_ATTR_RANGE_REC
op_assign
l_int|0x34
comma
DECL|enumerator|IB_SA_ATTR_PATH_REC
id|IB_SA_ATTR_PATH_REC
op_assign
l_int|0x35
comma
DECL|enumerator|IB_SA_ATTR_VL_ARB_REC
id|IB_SA_ATTR_VL_ARB_REC
op_assign
l_int|0x36
comma
DECL|enumerator|IB_SA_ATTR_MC_GROUP_REC
id|IB_SA_ATTR_MC_GROUP_REC
op_assign
l_int|0x37
comma
DECL|enumerator|IB_SA_ATTR_MC_MEMBER_REC
id|IB_SA_ATTR_MC_MEMBER_REC
op_assign
l_int|0x38
comma
DECL|enumerator|IB_SA_ATTR_TRACE_REC
id|IB_SA_ATTR_TRACE_REC
op_assign
l_int|0x39
comma
DECL|enumerator|IB_SA_ATTR_MULTI_PATH_REC
id|IB_SA_ATTR_MULTI_PATH_REC
op_assign
l_int|0x3a
comma
DECL|enumerator|IB_SA_ATTR_SERVICE_ASSOC_REC
id|IB_SA_ATTR_SERVICE_ASSOC_REC
op_assign
l_int|0x3b
)brace
suffix:semicolon
DECL|macro|PATH_REC_FIELD
mdefine_line|#define PATH_REC_FIELD(field) &bslash;&n;&t;.struct_offset_bytes = offsetof(struct ib_sa_path_rec, field),&t;&t;&bslash;&n;&t;.struct_size_bytes   = sizeof ((struct ib_sa_path_rec *) 0)-&gt;field,&t;&bslash;&n;&t;.field_name          = &quot;sa_path_rec:&quot; #field
DECL|variable|path_rec_table
r_static
r_const
r_struct
id|ib_field
id|path_rec_table
(braket
)braket
op_assign
(brace
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|0
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|32
)brace
comma
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|1
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|32
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|dgid
)paren
comma
dot
id|offset_words
op_assign
l_int|2
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|128
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|sgid
)paren
comma
dot
id|offset_words
op_assign
l_int|6
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|128
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|dlid
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|16
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|slid
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|16
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|raw_traffic
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|1
)brace
comma
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|1
comma
dot
id|size_bits
op_assign
l_int|3
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|flow_label
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|4
comma
dot
id|size_bits
op_assign
l_int|20
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|hop_limit
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|24
comma
dot
id|size_bits
op_assign
l_int|8
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|traffic_class
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|8
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|reversible
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|8
comma
dot
id|size_bits
op_assign
l_int|1
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|numb_path
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|9
comma
dot
id|size_bits
op_assign
l_int|7
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|pkey
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|16
)brace
comma
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|12
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|sl
)paren
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|12
comma
dot
id|size_bits
op_assign
l_int|4
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|mtu_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|mtu
)paren
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|18
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|rate_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|24
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|rate
)paren
comma
dot
id|offset_words
op_assign
l_int|13
comma
dot
id|offset_bits
op_assign
l_int|26
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|packet_life_time_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|14
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|packet_life_time
)paren
comma
dot
id|offset_words
op_assign
l_int|14
comma
dot
id|offset_bits
op_assign
l_int|2
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|PATH_REC_FIELD
c_func
(paren
id|preference
)paren
comma
dot
id|offset_words
op_assign
l_int|14
comma
dot
id|offset_bits
op_assign
l_int|8
comma
dot
id|size_bits
op_assign
l_int|8
)brace
comma
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|14
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|48
)brace
comma
)brace
suffix:semicolon
DECL|macro|MCMEMBER_REC_FIELD
mdefine_line|#define MCMEMBER_REC_FIELD(field) &bslash;&n;&t;.struct_offset_bytes = offsetof(struct ib_sa_mcmember_rec, field),&t;&bslash;&n;&t;.struct_size_bytes   = sizeof ((struct ib_sa_mcmember_rec *) 0)-&gt;field,&t;&bslash;&n;&t;.field_name          = &quot;sa_mcmember_rec:&quot; #field
DECL|variable|mcmember_rec_table
r_static
r_const
r_struct
id|ib_field
id|mcmember_rec_table
(braket
)braket
op_assign
(brace
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|mgid
)paren
comma
dot
id|offset_words
op_assign
l_int|0
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|128
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|port_gid
)paren
comma
dot
id|offset_words
op_assign
l_int|4
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|128
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|qkey
)paren
comma
dot
id|offset_words
op_assign
l_int|8
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|32
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|mlid
)paren
comma
dot
id|offset_words
op_assign
l_int|9
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|16
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|mtu_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|9
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|mtu
)paren
comma
dot
id|offset_words
op_assign
l_int|9
comma
dot
id|offset_bits
op_assign
l_int|18
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|traffic_class
)paren
comma
dot
id|offset_words
op_assign
l_int|9
comma
dot
id|offset_bits
op_assign
l_int|24
comma
dot
id|size_bits
op_assign
l_int|8
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|pkey
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|16
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|rate_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|16
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|rate
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|18
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|packet_life_time_selector
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|24
comma
dot
id|size_bits
op_assign
l_int|2
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|packet_life_time
)paren
comma
dot
id|offset_words
op_assign
l_int|10
comma
dot
id|offset_bits
op_assign
l_int|26
comma
dot
id|size_bits
op_assign
l_int|6
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|sl
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|4
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|flow_label
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|4
comma
dot
id|size_bits
op_assign
l_int|20
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|hop_limit
)paren
comma
dot
id|offset_words
op_assign
l_int|11
comma
dot
id|offset_bits
op_assign
l_int|24
comma
dot
id|size_bits
op_assign
l_int|8
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|scope
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|0
comma
dot
id|size_bits
op_assign
l_int|4
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|join_state
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|4
comma
dot
id|size_bits
op_assign
l_int|4
)brace
comma
(brace
id|MCMEMBER_REC_FIELD
c_func
(paren
id|proxy_join
)paren
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|8
comma
dot
id|size_bits
op_assign
l_int|1
)brace
comma
(brace
id|RESERVED
comma
dot
id|offset_words
op_assign
l_int|12
comma
dot
id|offset_bits
op_assign
l_int|9
comma
dot
id|size_bits
op_assign
l_int|23
)brace
comma
)brace
suffix:semicolon
DECL|function|free_sm_ah
r_static
r_void
id|free_sm_ah
c_func
(paren
r_struct
id|kref
op_star
id|kref
)paren
(brace
r_struct
id|ib_sa_sm_ah
op_star
id|sm_ah
op_assign
id|container_of
c_func
(paren
id|kref
comma
r_struct
id|ib_sa_sm_ah
comma
id|ref
)paren
suffix:semicolon
id|ib_destroy_ah
c_func
(paren
id|sm_ah-&gt;ah
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sm_ah
)paren
suffix:semicolon
)brace
DECL|function|update_sm_ah
r_static
r_void
id|update_sm_ah
c_func
(paren
r_void
op_star
id|port_ptr
)paren
(brace
r_struct
id|ib_sa_port
op_star
id|port
op_assign
id|port_ptr
suffix:semicolon
r_struct
id|ib_sa_sm_ah
op_star
id|new_ah
comma
op_star
id|old_ah
suffix:semicolon
r_struct
id|ib_port_attr
id|port_attr
suffix:semicolon
r_struct
id|ib_ah_attr
id|ah_attr
suffix:semicolon
r_if
c_cond
(paren
id|ib_query_port
c_func
(paren
id|port-&gt;agent-&gt;device
comma
id|port-&gt;port_num
comma
op_amp
id|port_attr
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t query port&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|new_ah
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|new_ah
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_ah
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t allocate new SM AH&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|kref_init
c_func
(paren
op_amp
id|new_ah-&gt;ref
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ah_attr
comma
l_int|0
comma
r_sizeof
id|ah_attr
)paren
suffix:semicolon
id|ah_attr.dlid
op_assign
id|port_attr.sm_lid
suffix:semicolon
id|ah_attr.sl
op_assign
id|port_attr.sm_sl
suffix:semicolon
id|ah_attr.port_num
op_assign
id|port-&gt;port_num
suffix:semicolon
id|new_ah-&gt;ah
op_assign
id|ib_create_ah
c_func
(paren
id|port-&gt;agent-&gt;qp-&gt;pd
comma
op_amp
id|ah_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|new_ah-&gt;ah
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t create new SM AH&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|new_ah
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|port-&gt;ah_lock
)paren
suffix:semicolon
id|old_ah
op_assign
id|port-&gt;sm_ah
suffix:semicolon
id|port-&gt;sm_ah
op_assign
id|new_ah
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|port-&gt;ah_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_ah
)paren
id|kref_put
c_func
(paren
op_amp
id|old_ah-&gt;ref
comma
id|free_sm_ah
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_event
r_static
r_void
id|ib_sa_event
c_func
(paren
r_struct
id|ib_event_handler
op_star
id|handler
comma
r_struct
id|ib_event
op_star
id|event
)paren
(brace
r_if
c_cond
(paren
id|event-&gt;event
op_eq
id|IB_EVENT_PORT_ERR
op_logical_or
id|event-&gt;event
op_eq
id|IB_EVENT_PORT_ACTIVE
op_logical_or
id|event-&gt;event
op_eq
id|IB_EVENT_LID_CHANGE
op_logical_or
id|event-&gt;event
op_eq
id|IB_EVENT_PKEY_CHANGE
op_logical_or
id|event-&gt;event
op_eq
id|IB_EVENT_SM_CHANGE
)paren
(brace
r_struct
id|ib_sa_device
op_star
id|sa_dev
op_assign
id|ib_get_client_data
c_func
(paren
id|event-&gt;device
comma
op_amp
id|sa_client
)paren
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|sa_dev-&gt;port
(braket
id|event-&gt;element.port_num
op_minus
id|sa_dev-&gt;start_port
)braket
dot
id|update_task
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * ib_sa_cancel_query - try to cancel an SA query&n; * @id:ID of query to cancel&n; * @query:query pointer to cancel&n; *&n; * Try to cancel an SA query.  If the id and query don&squot;t match up or&n; * the query has already completed, nothing is done.  Otherwise the&n; * query is canceled and will complete with a status of -EINTR.&n; */
DECL|function|ib_sa_cancel_query
r_void
id|ib_sa_cancel_query
c_func
(paren
r_int
id|id
comma
r_struct
id|ib_sa_query
op_star
id|query
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ib_mad_agent
op_star
id|agent
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idr_find
c_func
(paren
op_amp
id|query_idr
comma
id|id
)paren
op_ne
id|query
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|agent
op_assign
id|query-&gt;port-&gt;agent
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|ib_cancel_mad
c_func
(paren
id|agent
comma
id|id
)paren
suffix:semicolon
)brace
DECL|variable|ib_sa_cancel_query
id|EXPORT_SYMBOL
c_func
(paren
id|ib_sa_cancel_query
)paren
suffix:semicolon
DECL|function|init_mad
r_static
r_void
id|init_mad
c_func
(paren
r_struct
id|ib_sa_mad
op_star
id|mad
comma
r_struct
id|ib_mad_agent
op_star
id|agent
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|memset
c_func
(paren
id|mad
comma
l_int|0
comma
r_sizeof
op_star
id|mad
)paren
suffix:semicolon
id|mad-&gt;mad_hdr.base_version
op_assign
id|IB_MGMT_BASE_VERSION
suffix:semicolon
id|mad-&gt;mad_hdr.mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_ADM
suffix:semicolon
id|mad-&gt;mad_hdr.class_version
op_assign
id|IB_SA_CLASS_VERSION
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tid_lock
comma
id|flags
)paren
suffix:semicolon
id|mad-&gt;mad_hdr.tid
op_assign
id|cpu_to_be64
c_func
(paren
(paren
(paren
id|u64
)paren
id|agent-&gt;hi_tid
)paren
op_lshift
l_int|32
op_or
id|tid
op_increment
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tid_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|send_mad
r_static
r_int
id|send_mad
c_func
(paren
r_struct
id|ib_sa_query
op_star
id|query
comma
r_int
id|timeout_ms
)paren
(brace
r_struct
id|ib_sa_port
op_star
id|port
op_assign
id|query-&gt;port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_struct
id|ib_sge
id|gather_list
suffix:semicolon
r_struct
id|ib_send_wr
op_star
id|bad_wr
comma
id|wr
op_assign
(brace
dot
id|opcode
op_assign
id|IB_WR_SEND
comma
dot
id|sg_list
op_assign
op_amp
id|gather_list
comma
dot
id|num_sge
op_assign
l_int|1
comma
dot
id|send_flags
op_assign
id|IB_SEND_SIGNALED
comma
dot
id|wr
op_assign
(brace
dot
id|ud
op_assign
(brace
dot
id|mad_hdr
op_assign
op_amp
id|query-&gt;mad-&gt;mad_hdr
comma
dot
id|remote_qpn
op_assign
l_int|1
comma
dot
id|remote_qkey
op_assign
id|IB_QP1_QKEY
comma
dot
id|timeout_ms
op_assign
id|timeout_ms
)brace
)brace
)brace
suffix:semicolon
id|retry
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|idr_pre_get
c_func
(paren
op_amp
id|query_idr
comma
id|GFP_ATOMIC
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|idr_get_new
c_func
(paren
op_amp
id|query_idr
comma
id|query
comma
op_amp
id|query-&gt;id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|EAGAIN
)paren
r_goto
id|retry
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|wr.wr_id
op_assign
id|query-&gt;id
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|port-&gt;ah_lock
comma
id|flags
)paren
suffix:semicolon
id|kref_get
c_func
(paren
op_amp
id|port-&gt;sm_ah-&gt;ref
)paren
suffix:semicolon
id|query-&gt;sm_ah
op_assign
id|port-&gt;sm_ah
suffix:semicolon
id|wr.wr.ud.ah
op_assign
id|port-&gt;sm_ah-&gt;ah
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;ah_lock
comma
id|flags
)paren
suffix:semicolon
id|gather_list.addr
op_assign
id|dma_map_single
c_func
(paren
id|port-&gt;agent-&gt;device-&gt;dma_device
comma
id|query-&gt;mad
comma
r_sizeof
(paren
r_struct
id|ib_sa_mad
)paren
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|gather_list.length
op_assign
r_sizeof
(paren
r_struct
id|ib_sa_mad
)paren
suffix:semicolon
id|gather_list.lkey
op_assign
id|port-&gt;mr-&gt;lkey
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
id|query
comma
id|mapping
comma
id|gather_list.addr
)paren
suffix:semicolon
id|ret
op_assign
id|ib_post_send_mad
c_func
(paren
id|port-&gt;agent
comma
op_amp
id|wr
comma
op_amp
id|bad_wr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|dma_unmap_single
c_func
(paren
id|port-&gt;agent-&gt;device-&gt;dma_device
comma
id|pci_unmap_addr
c_func
(paren
id|query
comma
id|mapping
)paren
comma
r_sizeof
(paren
r_struct
id|ib_sa_mad
)paren
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|kref_put
c_func
(paren
op_amp
id|query-&gt;sm_ah-&gt;ref
comma
id|free_sm_ah
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|idr_remove
c_func
(paren
op_amp
id|query_idr
comma
id|query-&gt;id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ib_sa_path_rec_callback
r_static
r_void
id|ib_sa_path_rec_callback
c_func
(paren
r_struct
id|ib_sa_query
op_star
id|sa_query
comma
r_int
id|status
comma
r_struct
id|ib_sa_mad
op_star
id|mad
)paren
(brace
r_struct
id|ib_sa_path_query
op_star
id|query
op_assign
id|container_of
c_func
(paren
id|sa_query
comma
r_struct
id|ib_sa_path_query
comma
id|sa_query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mad
)paren
(brace
r_struct
id|ib_sa_path_rec
id|rec
suffix:semicolon
id|ib_unpack
c_func
(paren
id|path_rec_table
comma
id|ARRAY_SIZE
c_func
(paren
id|path_rec_table
)paren
comma
id|mad-&gt;data
comma
op_amp
id|rec
)paren
suffix:semicolon
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|status
comma
op_amp
id|rec
comma
id|query-&gt;context
)paren
suffix:semicolon
)brace
r_else
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|status
comma
l_int|NULL
comma
id|query-&gt;context
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_path_rec_release
r_static
r_void
id|ib_sa_path_rec_release
c_func
(paren
r_struct
id|ib_sa_query
op_star
id|sa_query
)paren
(brace
id|kfree
c_func
(paren
id|sa_query-&gt;mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|container_of
c_func
(paren
id|sa_query
comma
r_struct
id|ib_sa_path_query
comma
id|sa_query
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ib_sa_path_rec_get - Start a Path get query&n; * @device:device to send query on&n; * @port_num: port number to send query on&n; * @rec:Path Record to send in query&n; * @comp_mask:component mask to send in query&n; * @timeout_ms:time to wait for response&n; * @gfp_mask:GFP mask to use for internal allocations&n; * @callback:function called when query completes, times out or is&n; * canceled&n; * @context:opaque user context passed to callback&n; * @sa_query:query context, used to cancel query&n; *&n; * Send a Path Record Get query to the SA to look up a path.  The&n; * callback function will be called when the query completes (or&n; * fails); status is 0 for a successful response, -EINTR if the query&n; * is canceled, -ETIMEDOUT is the query timed out, or -EIO if an error&n; * occurred sending the query.  The resp parameter of the callback is&n; * only valid if status is 0.&n; *&n; * If the return value of ib_sa_path_rec_get() is negative, it is an&n; * error code.  Otherwise it is a query ID that can be used to cancel&n; * the query.&n; */
DECL|function|ib_sa_path_rec_get
r_int
id|ib_sa_path_rec_get
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
r_struct
id|ib_sa_path_rec
op_star
id|rec
comma
id|ib_sa_comp_mask
id|comp_mask
comma
r_int
id|timeout_ms
comma
r_int
id|gfp_mask
comma
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
id|status
comma
r_struct
id|ib_sa_path_rec
op_star
id|resp
comma
r_void
op_star
id|context
)paren
comma
r_void
op_star
id|context
comma
r_struct
id|ib_sa_query
op_star
op_star
id|sa_query
)paren
(brace
r_struct
id|ib_sa_path_query
op_star
id|query
suffix:semicolon
r_struct
id|ib_sa_device
op_star
id|sa_dev
op_assign
id|ib_get_client_data
c_func
(paren
id|device
comma
op_amp
id|sa_client
)paren
suffix:semicolon
r_struct
id|ib_sa_port
op_star
id|port
op_assign
op_amp
id|sa_dev-&gt;port
(braket
id|port_num
op_minus
id|sa_dev-&gt;start_port
)braket
suffix:semicolon
r_struct
id|ib_mad_agent
op_star
id|agent
op_assign
id|port-&gt;agent
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|query
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|query
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|query
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|query-&gt;sa_query.mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|query-&gt;sa_query.mad
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|query-&gt;sa_query.mad
)paren
(brace
id|kfree
c_func
(paren
id|query
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|query-&gt;callback
op_assign
id|callback
suffix:semicolon
id|query-&gt;context
op_assign
id|context
suffix:semicolon
id|init_mad
c_func
(paren
id|query-&gt;sa_query.mad
comma
id|agent
)paren
suffix:semicolon
id|query-&gt;sa_query.callback
op_assign
id|ib_sa_path_rec_callback
suffix:semicolon
id|query-&gt;sa_query.release
op_assign
id|ib_sa_path_rec_release
suffix:semicolon
id|query-&gt;sa_query.port
op_assign
id|port
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;mad_hdr.method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;mad_hdr.attr_id
op_assign
id|cpu_to_be16
c_func
(paren
id|IB_SA_ATTR_PATH_REC
)paren
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;sa_hdr.comp_mask
op_assign
id|comp_mask
suffix:semicolon
id|ib_pack
c_func
(paren
id|path_rec_table
comma
id|ARRAY_SIZE
c_func
(paren
id|path_rec_table
)paren
comma
id|rec
comma
id|query-&gt;sa_query.mad-&gt;data
)paren
suffix:semicolon
op_star
id|sa_query
op_assign
op_amp
id|query-&gt;sa_query
suffix:semicolon
id|ret
op_assign
id|send_mad
c_func
(paren
op_amp
id|query-&gt;sa_query
comma
id|timeout_ms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
op_star
id|sa_query
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|query-&gt;sa_query.mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|query
)paren
suffix:semicolon
)brace
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|query-&gt;sa_query.id
suffix:semicolon
)brace
DECL|variable|ib_sa_path_rec_get
id|EXPORT_SYMBOL
c_func
(paren
id|ib_sa_path_rec_get
)paren
suffix:semicolon
DECL|function|ib_sa_mcmember_rec_callback
r_static
r_void
id|ib_sa_mcmember_rec_callback
c_func
(paren
r_struct
id|ib_sa_query
op_star
id|sa_query
comma
r_int
id|status
comma
r_struct
id|ib_sa_mad
op_star
id|mad
)paren
(brace
r_struct
id|ib_sa_mcmember_query
op_star
id|query
op_assign
id|container_of
c_func
(paren
id|sa_query
comma
r_struct
id|ib_sa_mcmember_query
comma
id|sa_query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mad
)paren
(brace
r_struct
id|ib_sa_mcmember_rec
id|rec
suffix:semicolon
id|ib_unpack
c_func
(paren
id|mcmember_rec_table
comma
id|ARRAY_SIZE
c_func
(paren
id|mcmember_rec_table
)paren
comma
id|mad-&gt;data
comma
op_amp
id|rec
)paren
suffix:semicolon
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|status
comma
op_amp
id|rec
comma
id|query-&gt;context
)paren
suffix:semicolon
)brace
r_else
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|status
comma
l_int|NULL
comma
id|query-&gt;context
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_mcmember_rec_release
r_static
r_void
id|ib_sa_mcmember_rec_release
c_func
(paren
r_struct
id|ib_sa_query
op_star
id|sa_query
)paren
(brace
id|kfree
c_func
(paren
id|sa_query-&gt;mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|container_of
c_func
(paren
id|sa_query
comma
r_struct
id|ib_sa_mcmember_query
comma
id|sa_query
)paren
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_mcmember_rec_query
r_int
id|ib_sa_mcmember_rec_query
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
id|u8
id|method
comma
r_struct
id|ib_sa_mcmember_rec
op_star
id|rec
comma
id|ib_sa_comp_mask
id|comp_mask
comma
r_int
id|timeout_ms
comma
r_int
id|gfp_mask
comma
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
id|status
comma
r_struct
id|ib_sa_mcmember_rec
op_star
id|resp
comma
r_void
op_star
id|context
)paren
comma
r_void
op_star
id|context
comma
r_struct
id|ib_sa_query
op_star
op_star
id|sa_query
)paren
(brace
r_struct
id|ib_sa_mcmember_query
op_star
id|query
suffix:semicolon
r_struct
id|ib_sa_device
op_star
id|sa_dev
op_assign
id|ib_get_client_data
c_func
(paren
id|device
comma
op_amp
id|sa_client
)paren
suffix:semicolon
r_struct
id|ib_sa_port
op_star
id|port
op_assign
op_amp
id|sa_dev-&gt;port
(braket
id|port_num
op_minus
id|sa_dev-&gt;start_port
)braket
suffix:semicolon
r_struct
id|ib_mad_agent
op_star
id|agent
op_assign
id|port-&gt;agent
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|query
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|query
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|query
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|query-&gt;sa_query.mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|query-&gt;sa_query.mad
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|query-&gt;sa_query.mad
)paren
(brace
id|kfree
c_func
(paren
id|query
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|query-&gt;callback
op_assign
id|callback
suffix:semicolon
id|query-&gt;context
op_assign
id|context
suffix:semicolon
id|init_mad
c_func
(paren
id|query-&gt;sa_query.mad
comma
id|agent
)paren
suffix:semicolon
id|query-&gt;sa_query.callback
op_assign
id|ib_sa_mcmember_rec_callback
suffix:semicolon
id|query-&gt;sa_query.release
op_assign
id|ib_sa_mcmember_rec_release
suffix:semicolon
id|query-&gt;sa_query.port
op_assign
id|port
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;mad_hdr.method
op_assign
id|method
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;mad_hdr.attr_id
op_assign
id|cpu_to_be16
c_func
(paren
id|IB_SA_ATTR_MC_MEMBER_REC
)paren
suffix:semicolon
id|query-&gt;sa_query.mad-&gt;sa_hdr.comp_mask
op_assign
id|comp_mask
suffix:semicolon
id|ib_pack
c_func
(paren
id|mcmember_rec_table
comma
id|ARRAY_SIZE
c_func
(paren
id|mcmember_rec_table
)paren
comma
id|rec
comma
id|query-&gt;sa_query.mad-&gt;data
)paren
suffix:semicolon
op_star
id|sa_query
op_assign
op_amp
id|query-&gt;sa_query
suffix:semicolon
id|ret
op_assign
id|send_mad
c_func
(paren
op_amp
id|query-&gt;sa_query
comma
id|timeout_ms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
op_star
id|sa_query
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|query-&gt;sa_query.mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|query
)paren
suffix:semicolon
)brace
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|query-&gt;sa_query.id
suffix:semicolon
)brace
DECL|variable|ib_sa_mcmember_rec_query
id|EXPORT_SYMBOL
c_func
(paren
id|ib_sa_mcmember_rec_query
)paren
suffix:semicolon
DECL|function|send_handler
r_static
r_void
id|send_handler
c_func
(paren
r_struct
id|ib_mad_agent
op_star
id|agent
comma
r_struct
id|ib_mad_send_wc
op_star
id|mad_send_wc
)paren
(brace
r_struct
id|ib_sa_query
op_star
id|query
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|query
op_assign
id|idr_find
c_func
(paren
op_amp
id|query_idr
comma
id|mad_send_wc-&gt;wr_id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|query
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|mad_send_wc-&gt;status
)paren
(brace
r_case
id|IB_WC_SUCCESS
suffix:colon
multiline_comment|/* No callback -- already got recv */
r_break
suffix:semicolon
r_case
id|IB_WC_RESP_TIMEOUT_ERR
suffix:colon
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|query
comma
op_minus
id|ETIMEDOUT
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_WC_WR_FLUSH_ERR
suffix:colon
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|query
comma
op_minus
id|EINTR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|query
comma
op_minus
id|EIO
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma_unmap_single
c_func
(paren
id|agent-&gt;device-&gt;dma_device
comma
id|pci_unmap_addr
c_func
(paren
id|query
comma
id|mapping
)paren
comma
r_sizeof
(paren
r_struct
id|ib_sa_mad
)paren
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|kref_put
c_func
(paren
op_amp
id|query-&gt;sm_ah-&gt;ref
comma
id|free_sm_ah
)paren
suffix:semicolon
id|query
op_member_access_from_pointer
id|release
c_func
(paren
id|query
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|idr_remove
c_func
(paren
op_amp
id|query_idr
comma
id|mad_send_wc-&gt;wr_id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|recv_handler
r_static
r_void
id|recv_handler
c_func
(paren
r_struct
id|ib_mad_agent
op_star
id|mad_agent
comma
r_struct
id|ib_mad_recv_wc
op_star
id|mad_recv_wc
)paren
(brace
r_struct
id|ib_sa_query
op_star
id|query
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
id|query
op_assign
id|idr_find
c_func
(paren
op_amp
id|query_idr
comma
id|mad_recv_wc-&gt;wc-&gt;wr_id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|idr_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|query
)paren
(brace
r_if
c_cond
(paren
id|mad_recv_wc-&gt;wc-&gt;status
op_eq
id|IB_WC_SUCCESS
)paren
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|query
comma
id|mad_recv_wc-&gt;recv_buf.mad-&gt;mad_hdr.status
ques
c_cond
op_minus
id|EINVAL
suffix:colon
l_int|0
comma
(paren
r_struct
id|ib_sa_mad
op_star
)paren
id|mad_recv_wc-&gt;recv_buf.mad
)paren
suffix:semicolon
r_else
id|query
op_member_access_from_pointer
id|callback
c_func
(paren
id|query
comma
op_minus
id|EIO
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|ib_free_recv_mad
c_func
(paren
id|mad_recv_wc
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_add_one
r_static
r_void
id|ib_sa_add_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|ib_sa_device
op_star
id|sa_dev
suffix:semicolon
r_int
id|s
comma
id|e
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;node_type
op_eq
id|IB_NODE_SWITCH
)paren
id|s
op_assign
id|e
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|s
op_assign
l_int|1
suffix:semicolon
id|e
op_assign
id|device-&gt;phys_port_cnt
suffix:semicolon
)brace
id|sa_dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|sa_dev
op_plus
(paren
id|e
op_minus
id|s
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|ib_sa_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sa_dev
)paren
r_return
suffix:semicolon
id|sa_dev-&gt;start_port
op_assign
id|s
suffix:semicolon
id|sa_dev-&gt;end_port
op_assign
id|e
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|e
op_minus
id|s
suffix:semicolon
op_increment
id|i
)paren
(brace
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|mr
op_assign
l_int|NULL
suffix:semicolon
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|sm_ah
op_assign
l_int|NULL
suffix:semicolon
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|port_num
op_assign
id|i
op_plus
id|s
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|ah_lock
)paren
suffix:semicolon
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent
op_assign
id|ib_register_mad_agent
c_func
(paren
id|device
comma
id|i
op_plus
id|s
comma
id|IB_QPT_GSI
comma
l_int|NULL
comma
l_int|0
comma
id|send_handler
comma
id|recv_handler
comma
id|sa_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent
)paren
)paren
r_goto
id|err
suffix:semicolon
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|mr
op_assign
id|ib_get_dma_mr
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent-&gt;qp-&gt;pd
comma
id|IB_ACCESS_LOCAL_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|mr
)paren
)paren
(brace
id|ib_unregister_mad_agent
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|INIT_WORK
c_func
(paren
op_amp
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|update_task
comma
id|update_sm_ah
comma
op_amp
id|sa_dev-&gt;port
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ib_set_client_data
c_func
(paren
id|device
comma
op_amp
id|sa_client
comma
id|sa_dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We register our event handler after everything is set up,&n;&t; * and then update our cached info after the event handler is&n;&t; * registered to avoid any problems if a port changes state&n;&t; * during our initialization.&n;&t; */
id|INIT_IB_EVENT_HANDLER
c_func
(paren
op_amp
id|sa_dev-&gt;event_handler
comma
id|device
comma
id|ib_sa_event
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ib_register_event_handler
c_func
(paren
op_amp
id|sa_dev-&gt;event_handler
)paren
)paren
r_goto
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|e
op_minus
id|s
suffix:semicolon
op_increment
id|i
)paren
id|update_sm_ah
c_func
(paren
op_amp
id|sa_dev-&gt;port
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
id|err
suffix:colon
r_while
c_loop
(paren
op_decrement
id|i
op_ge
l_int|0
)paren
(brace
id|ib_dereg_mr
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|mr
)paren
suffix:semicolon
id|ib_unregister_mad_agent
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|sa_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ib_sa_remove_one
r_static
r_void
id|ib_sa_remove_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|ib_sa_device
op_star
id|sa_dev
op_assign
id|ib_get_client_data
c_func
(paren
id|device
comma
op_amp
id|sa_client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sa_dev
)paren
r_return
suffix:semicolon
id|ib_unregister_event_handler
c_func
(paren
op_amp
id|sa_dev-&gt;event_handler
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|sa_dev-&gt;end_port
op_minus
id|sa_dev-&gt;start_port
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ib_unregister_mad_agent
c_func
(paren
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|agent
)paren
suffix:semicolon
id|kref_put
c_func
(paren
op_amp
id|sa_dev-&gt;port
(braket
id|i
)braket
dot
id|sm_ah-&gt;ref
comma
id|free_sm_ah
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|sa_dev
)paren
suffix:semicolon
)brace
DECL|function|ib_sa_init
r_static
r_int
id|__init
id|ib_sa_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|idr_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tid_lock
)paren
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|tid
comma
r_sizeof
id|tid
)paren
suffix:semicolon
id|ret
op_assign
id|ib_register_client
c_func
(paren
op_amp
id|sa_client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Couldn&squot;t register ib_sa client&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ib_sa_cleanup
r_static
r_void
id|__exit
id|ib_sa_cleanup
c_func
(paren
r_void
)paren
(brace
id|ib_unregister_client
c_func
(paren
op_amp
id|sa_client
)paren
suffix:semicolon
)brace
DECL|variable|ib_sa_init
id|module_init
c_func
(paren
id|ib_sa_init
)paren
suffix:semicolon
DECL|variable|ib_sa_cleanup
id|module_exit
c_func
(paren
id|ib_sa_cleanup
)paren
suffix:semicolon
eof
