multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: sysfs.c 1349 2004-12-16 21:09:43Z roland $&n; */
macro_line|#include &quot;core_priv.h&quot;
macro_line|#include &lt;ib_mad.h&gt;
DECL|struct|ib_port
r_struct
id|ib_port
(brace
DECL|member|kobj
r_struct
id|kobject
id|kobj
suffix:semicolon
DECL|member|ibdev
r_struct
id|ib_device
op_star
id|ibdev
suffix:semicolon
DECL|member|gid_group
r_struct
id|attribute_group
id|gid_group
suffix:semicolon
DECL|member|gid_attr
r_struct
id|attribute
op_star
op_star
id|gid_attr
suffix:semicolon
DECL|member|pkey_group
r_struct
id|attribute_group
id|pkey_group
suffix:semicolon
DECL|member|pkey_attr
r_struct
id|attribute
op_star
op_star
id|pkey_attr
suffix:semicolon
DECL|member|port_num
id|u8
id|port_num
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|port_attribute
r_struct
id|port_attribute
(brace
DECL|member|attr
r_struct
id|attribute
id|attr
suffix:semicolon
DECL|member|show
id|ssize_t
(paren
op_star
id|show
)paren
(paren
r_struct
id|ib_port
op_star
comma
r_struct
id|port_attribute
op_star
comma
r_char
op_star
id|buf
)paren
suffix:semicolon
DECL|member|store
id|ssize_t
(paren
op_star
id|store
)paren
(paren
r_struct
id|ib_port
op_star
comma
r_struct
id|port_attribute
op_star
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|PORT_ATTR
mdefine_line|#define PORT_ATTR(_name, _mode, _show, _store) &bslash;&n;struct port_attribute port_attr_##_name = __ATTR(_name, _mode, _show, _store)
DECL|macro|PORT_ATTR_RO
mdefine_line|#define PORT_ATTR_RO(_name) &bslash;&n;struct port_attribute port_attr_##_name = __ATTR_RO(_name)
DECL|struct|port_table_attribute
r_struct
id|port_table_attribute
(brace
DECL|member|attr
r_struct
id|port_attribute
id|attr
suffix:semicolon
DECL|member|index
r_int
id|index
suffix:semicolon
)brace
suffix:semicolon
DECL|function|port_attr_show
r_static
id|ssize_t
id|port_attr_show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|port_attribute
op_star
id|port_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|port_attribute
comma
id|attr
)paren
suffix:semicolon
r_struct
id|ib_port
op_star
id|p
op_assign
id|container_of
c_func
(paren
id|kobj
comma
r_struct
id|ib_port
comma
id|kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port_attr-&gt;show
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|port_attr
op_member_access_from_pointer
id|show
c_func
(paren
id|p
comma
id|port_attr
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|variable|port_sysfs_ops
r_static
r_struct
id|sysfs_ops
id|port_sysfs_ops
op_assign
(brace
dot
id|show
op_assign
id|port_attr_show
)brace
suffix:semicolon
DECL|function|state_show
r_static
id|ssize_t
id|state_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_static
r_const
r_char
op_star
id|state_name
(braket
)braket
op_assign
(brace
(braket
id|IB_PORT_NOP
)braket
op_assign
l_string|&quot;NOP&quot;
comma
(braket
id|IB_PORT_DOWN
)braket
op_assign
l_string|&quot;DOWN&quot;
comma
(braket
id|IB_PORT_INIT
)braket
op_assign
l_string|&quot;INIT&quot;
comma
(braket
id|IB_PORT_ARMED
)braket
op_assign
l_string|&quot;ARMED&quot;
comma
(braket
id|IB_PORT_ACTIVE
)braket
op_assign
l_string|&quot;ACTIVE&quot;
comma
(braket
id|IB_PORT_ACTIVE_DEFER
)braket
op_assign
l_string|&quot;ACTIVE_DEFER&quot;
)brace
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: %s&bslash;n&quot;
comma
id|attr.state
comma
id|attr.state
op_ge
l_int|0
op_logical_and
id|attr.state
op_le
id|ARRAY_SIZE
c_func
(paren
id|state_name
)paren
ques
c_cond
id|state_name
(braket
id|attr.state
)braket
suffix:colon
l_string|&quot;UNKNOWN&quot;
)paren
suffix:semicolon
)brace
DECL|function|lid_show
r_static
id|ssize_t
id|lid_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|attr.lid
)paren
suffix:semicolon
)brace
DECL|function|lid_mask_count_show
r_static
id|ssize_t
id|lid_mask_count_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|attr.lmc
)paren
suffix:semicolon
)brace
DECL|function|sm_lid_show
r_static
id|ssize_t
id|sm_lid_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|attr.sm_lid
)paren
suffix:semicolon
)brace
DECL|function|sm_sl_show
r_static
id|ssize_t
id|sm_sl_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|attr.sm_sl
)paren
suffix:semicolon
)brace
DECL|function|cap_mask_show
r_static
id|ssize_t
id|cap_mask_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|attr.port_cap_flags
)paren
suffix:semicolon
)brace
DECL|function|rate_show
r_static
id|ssize_t
id|rate_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
r_char
op_star
id|speed
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_int
id|rate
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|attr.active_speed
)paren
(brace
r_case
l_int|2
suffix:colon
id|speed
op_assign
l_string|&quot; DDR&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|speed
op_assign
l_string|&quot; QDR&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rate
op_assign
l_int|25
op_star
id|ib_width_enum_to_int
c_func
(paren
id|attr.active_width
)paren
op_star
id|attr.active_speed
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d%s Gb/sec (%dX%s)&bslash;n&quot;
comma
id|rate
op_div
l_int|10
comma
id|rate
op_mod
l_int|10
ques
c_cond
l_string|&quot;.5&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|ib_width_enum_to_int
c_func
(paren
id|attr.active_width
)paren
comma
id|speed
)paren
suffix:semicolon
)brace
DECL|function|phys_state_show
r_static
id|ssize_t
id|phys_state_show
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|unused
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|attr.phys_state
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;1: Sleep&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;2: Polling&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;3: Disabled&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|4
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;4: PortConfigurationTraining&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|5
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;5: LinkUp&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|6
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;6: LinkErrorRecovery&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|7
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;7: Phy Test&bslash;n&quot;
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: &lt;unknown&gt;&bslash;n&quot;
comma
id|attr.phys_state
)paren
suffix:semicolon
)brace
)brace
r_static
id|PORT_ATTR_RO
c_func
(paren
id|state
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|lid
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|lid_mask_count
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|sm_lid
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|sm_sl
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|cap_mask
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|rate
)paren
suffix:semicolon
r_static
id|PORT_ATTR_RO
c_func
(paren
id|phys_state
)paren
suffix:semicolon
DECL|variable|port_default_attrs
r_static
r_struct
id|attribute
op_star
id|port_default_attrs
(braket
)braket
op_assign
(brace
op_amp
id|port_attr_state.attr
comma
op_amp
id|port_attr_lid.attr
comma
op_amp
id|port_attr_lid_mask_count.attr
comma
op_amp
id|port_attr_sm_lid.attr
comma
op_amp
id|port_attr_sm_sl.attr
comma
op_amp
id|port_attr_cap_mask.attr
comma
op_amp
id|port_attr_rate.attr
comma
op_amp
id|port_attr_phys_state.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|show_port_gid
r_static
id|ssize_t
id|show_port_gid
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|port_table_attribute
op_star
id|tab_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|port_table_attribute
comma
id|attr
)paren
suffix:semicolon
r_union
id|ib_gid
id|gid
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_gid
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
id|tab_attr-&gt;index
comma
op_amp
id|gid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%04x:%04x:%04x:%04x:%04x:%04x:%04x:%04x&bslash;n&quot;
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|0
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|1
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|2
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|3
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|4
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|5
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|6
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|gid.raw
)paren
(braket
l_int|7
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_port_pkey
r_static
id|ssize_t
id|show_port_pkey
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|port_table_attribute
op_star
id|tab_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|port_table_attribute
comma
id|attr
)paren
suffix:semicolon
id|u16
id|pkey
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_pkey
c_func
(paren
id|p-&gt;ibdev
comma
id|p-&gt;port_num
comma
id|tab_attr-&gt;index
comma
op_amp
id|pkey
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|pkey
)paren
suffix:semicolon
)brace
DECL|macro|PORT_PMA_ATTR
mdefine_line|#define PORT_PMA_ATTR(_name, _counter, _width, _offset)&t;&t;&t;&bslash;&n;struct port_table_attribute port_pma_attr_##_name = {&t;&t;&t;&bslash;&n;&t;.attr  = __ATTR(_name, S_IRUGO, show_pma_counter, NULL),&t;&bslash;&n;&t;.index = (_offset) | ((_width) &lt;&lt; 16) | ((_counter) &lt;&lt; 24)&t;&bslash;&n;}
DECL|function|show_pma_counter
r_static
id|ssize_t
id|show_pma_counter
c_func
(paren
r_struct
id|ib_port
op_star
id|p
comma
r_struct
id|port_attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|port_table_attribute
op_star
id|tab_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|port_table_attribute
comma
id|attr
)paren
suffix:semicolon
r_int
id|offset
op_assign
id|tab_attr-&gt;index
op_amp
l_int|0xffff
suffix:semicolon
r_int
id|width
op_assign
(paren
id|tab_attr-&gt;index
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_struct
id|ib_mad
op_star
id|in_mad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ib_mad
op_star
id|out_mad
op_assign
l_int|NULL
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;ibdev-&gt;process_mad
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;N/A (no PMA)&bslash;n&quot;
)paren
suffix:semicolon
id|in_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|out_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_mad
op_logical_or
op_logical_neg
id|out_mad
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;mad_hdr.base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mad_hdr.mgmt_class
op_assign
id|IB_MGMT_CLASS_PERF_MGMT
suffix:semicolon
id|in_mad-&gt;mad_hdr.class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mad_hdr.method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;mad_hdr.attr_id
op_assign
id|cpu_to_be16
c_func
(paren
l_int|0x12
)paren
suffix:semicolon
multiline_comment|/* PortCounters */
id|in_mad-&gt;data
(braket
l_int|41
)braket
op_assign
id|p-&gt;port_num
suffix:semicolon
multiline_comment|/* PortSelect field */
r_if
c_cond
(paren
(paren
id|p-&gt;ibdev
op_member_access_from_pointer
id|process_mad
c_func
(paren
id|p-&gt;ibdev
comma
id|IB_MAD_IGNORE_MKEY
comma
id|p-&gt;port_num
comma
l_int|0xffff
comma
id|in_mad
comma
id|out_mad
)paren
op_amp
(paren
id|IB_MAD_RESULT_SUCCESS
op_or
id|IB_MAD_RESULT_REPLY
)paren
)paren
op_ne
(paren
id|IB_MAD_RESULT_SUCCESS
op_or
id|IB_MAD_RESULT_REPLY
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|width
)paren
(brace
r_case
l_int|4
suffix:colon
id|ret
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
(paren
id|out_mad-&gt;data
(braket
l_int|40
op_plus
id|offset
op_div
l_int|8
)braket
op_rshift
(paren
id|offset
op_mod
l_int|4
)paren
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|ret
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|out_mad-&gt;data
(braket
l_int|40
op_plus
id|offset
op_div
l_int|8
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ret
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|40
op_plus
id|offset
op_div
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ret
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|be32_to_cpup
c_func
(paren
(paren
id|u32
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|40
op_plus
id|offset
op_div
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
id|out
suffix:colon
id|kfree
c_func
(paren
id|in_mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|out_mad
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|symbol_error
comma
l_int|0
comma
l_int|16
comma
l_int|32
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|link_error_recovery
comma
l_int|1
comma
l_int|8
comma
l_int|48
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|link_downed
comma
l_int|2
comma
l_int|8
comma
l_int|56
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_errors
comma
l_int|3
comma
l_int|16
comma
l_int|64
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_remote_physical_errors
comma
l_int|4
comma
l_int|16
comma
l_int|80
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_switch_relay_errors
comma
l_int|5
comma
l_int|16
comma
l_int|96
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_xmit_discards
comma
l_int|6
comma
l_int|16
comma
l_int|112
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_xmit_constraint_errors
comma
l_int|7
comma
l_int|8
comma
l_int|128
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_constraint_errors
comma
l_int|8
comma
l_int|8
comma
l_int|136
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|local_link_integrity_errors
comma
l_int|9
comma
l_int|4
comma
l_int|152
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|excessive_buffer_overrun_errors
comma
l_int|10
comma
l_int|4
comma
l_int|156
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|VL15_dropped
comma
l_int|11
comma
l_int|16
comma
l_int|176
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_xmit_data
comma
l_int|12
comma
l_int|32
comma
l_int|192
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_data
comma
l_int|13
comma
l_int|32
comma
l_int|224
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_xmit_packets
comma
l_int|14
comma
l_int|32
comma
l_int|256
)paren
suffix:semicolon
r_static
id|PORT_PMA_ATTR
c_func
(paren
id|port_rcv_packets
comma
l_int|15
comma
l_int|32
comma
l_int|288
)paren
suffix:semicolon
DECL|variable|pma_attrs
r_static
r_struct
id|attribute
op_star
id|pma_attrs
(braket
)braket
op_assign
(brace
op_amp
id|port_pma_attr_symbol_error.attr.attr
comma
op_amp
id|port_pma_attr_link_error_recovery.attr.attr
comma
op_amp
id|port_pma_attr_link_downed.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_errors.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_remote_physical_errors.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_switch_relay_errors.attr.attr
comma
op_amp
id|port_pma_attr_port_xmit_discards.attr.attr
comma
op_amp
id|port_pma_attr_port_xmit_constraint_errors.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_constraint_errors.attr.attr
comma
op_amp
id|port_pma_attr_local_link_integrity_errors.attr.attr
comma
op_amp
id|port_pma_attr_excessive_buffer_overrun_errors.attr.attr
comma
op_amp
id|port_pma_attr_VL15_dropped.attr.attr
comma
op_amp
id|port_pma_attr_port_xmit_data.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_data.attr.attr
comma
op_amp
id|port_pma_attr_port_xmit_packets.attr.attr
comma
op_amp
id|port_pma_attr_port_rcv_packets.attr.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|pma_group
r_static
r_struct
id|attribute_group
id|pma_group
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;counters&quot;
comma
dot
id|attrs
op_assign
id|pma_attrs
)brace
suffix:semicolon
DECL|function|ib_port_release
r_static
r_void
id|ib_port_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
r_struct
id|ib_port
op_star
id|p
op_assign
id|container_of
c_func
(paren
id|kobj
comma
r_struct
id|ib_port
comma
id|kobj
)paren
suffix:semicolon
r_struct
id|attribute
op_star
id|a
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|a
op_assign
id|p-&gt;gid_attr
(braket
id|i
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|kfree
c_func
(paren
id|a-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|a
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|a
op_assign
id|p-&gt;pkey_attr
(braket
id|i
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|kfree
c_func
(paren
id|a-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|a
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|p-&gt;gid_attr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
DECL|variable|port_type
r_static
r_struct
id|kobj_type
id|port_type
op_assign
(brace
dot
id|release
op_assign
id|ib_port_release
comma
dot
id|sysfs_ops
op_assign
op_amp
id|port_sysfs_ops
comma
dot
id|default_attrs
op_assign
id|port_default_attrs
)brace
suffix:semicolon
DECL|function|ib_device_release
r_static
r_void
id|ib_device_release
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
)paren
(brace
r_struct
id|ib_device
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|ib_device
comma
id|class_dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ib_device_hotplug
r_static
r_int
id|ib_device_hotplug
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
op_star
id|envp
comma
r_int
id|num_envp
comma
r_char
op_star
id|buf
comma
r_int
id|size
)paren
(brace
r_struct
id|ib_device
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|ib_device
comma
id|class_dev
)paren
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|add_hotplug_env_var
c_func
(paren
id|envp
comma
id|num_envp
comma
op_amp
id|i
comma
id|buf
comma
id|size
comma
op_amp
id|len
comma
l_string|&quot;NAME=%s&quot;
comma
id|dev-&gt;name
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * It might be nice to pass the node GUID to hotplug, but&n;&t; * right now the only way to get it is to query the device&n;&t; * provider, and this can crash during device removal because&n;&t; * we are will be running after driver removal has started.&n;&t; * We could add a node_guid field to struct ib_device, or we&n;&t; * could just let the hotplug script read the node GUID from&n;&t; * sysfs when devices are added.&n;&t; */
id|envp
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alloc_group
r_static
r_int
id|alloc_group
c_func
(paren
r_struct
id|attribute
op_star
op_star
op_star
id|attr
comma
id|ssize_t
(paren
op_star
id|show
)paren
(paren
r_struct
id|ib_port
op_star
comma
r_struct
id|port_attribute
op_star
comma
r_char
op_star
id|buf
)paren
comma
r_int
id|len
)paren
(brace
r_struct
id|port_table_attribute
op_star
op_star
op_star
id|tab_attr
op_assign
(paren
r_struct
id|port_table_attribute
op_star
op_star
op_star
)paren
id|attr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ret
suffix:semicolon
op_star
id|tab_attr
op_assign
id|kmalloc
c_func
(paren
(paren
l_int|1
op_plus
id|len
)paren
op_star
r_sizeof
op_star
id|tab_attr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|tab_attr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
op_star
id|tab_attr
comma
l_int|0
comma
(paren
l_int|1
op_plus
id|len
)paren
op_star
r_sizeof
op_star
id|tab_attr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
(brace
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
op_star
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.name
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.name
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snprintf
c_func
(paren
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.name
comma
l_int|8
comma
l_string|&quot;%d&quot;
comma
id|i
)paren
op_ge
l_int|8
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.mode
op_assign
id|S_IRUGO
suffix:semicolon
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.owner
op_assign
id|THIS_MODULE
suffix:semicolon
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.show
op_assign
id|show
suffix:semicolon
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|index
op_assign
id|i
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
)paren
id|kfree
c_func
(paren
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
op_member_access_from_pointer
id|attr.attr.name
)paren
suffix:semicolon
id|kfree
c_func
(paren
(paren
op_star
id|tab_attr
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
op_star
id|tab_attr
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|add_port
r_static
r_int
id|add_port
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_int
id|port_num
)paren
(brace
r_struct
id|ib_port
op_star
id|p
suffix:semicolon
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_port
c_func
(paren
id|device
comma
id|port_num
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|p
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
r_sizeof
op_star
id|p
)paren
suffix:semicolon
id|p-&gt;ibdev
op_assign
id|device
suffix:semicolon
id|p-&gt;port_num
op_assign
id|port_num
suffix:semicolon
id|p-&gt;kobj.ktype
op_assign
op_amp
id|port_type
suffix:semicolon
id|p-&gt;kobj.parent
op_assign
id|kobject_get
c_func
(paren
op_amp
id|device-&gt;ports_parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;kobj.parent
)paren
(brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|ret
op_assign
id|kobject_set_name
c_func
(paren
op_amp
id|p-&gt;kobj
comma
l_string|&quot;%d&quot;
comma
id|port_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
id|ret
op_assign
id|kobject_register
c_func
(paren
op_amp
id|p-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
id|ret
op_assign
id|sysfs_create_group
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|pma_group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
id|ret
op_assign
id|alloc_group
c_func
(paren
op_amp
id|p-&gt;gid_attr
comma
id|show_port_gid
comma
id|attr.gid_tbl_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_remove_pma
suffix:semicolon
id|p-&gt;gid_group.name
op_assign
l_string|&quot;gids&quot;
suffix:semicolon
id|p-&gt;gid_group.attrs
op_assign
id|p-&gt;gid_attr
suffix:semicolon
id|ret
op_assign
id|sysfs_create_group
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|p-&gt;gid_group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_free_gid
suffix:semicolon
id|ret
op_assign
id|alloc_group
c_func
(paren
op_amp
id|p-&gt;pkey_attr
comma
id|show_port_pkey
comma
id|attr.pkey_tbl_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_remove_gid
suffix:semicolon
id|p-&gt;pkey_group.name
op_assign
l_string|&quot;pkeys&quot;
suffix:semicolon
id|p-&gt;pkey_group.attrs
op_assign
id|p-&gt;pkey_attr
suffix:semicolon
id|ret
op_assign
id|sysfs_create_group
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|p-&gt;pkey_group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_free_pkey
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|p-&gt;kobj.entry
comma
op_amp
id|device-&gt;port_list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_free_pkey
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|attr.pkey_tbl_len
suffix:semicolon
op_increment
id|i
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;pkey_attr
(braket
id|i
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p-&gt;pkey_attr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|p-&gt;pkey_attr
)paren
suffix:semicolon
id|err_remove_gid
suffix:colon
id|sysfs_remove_group
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|p-&gt;gid_group
)paren
suffix:semicolon
id|err_free_gid
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|attr.gid_tbl_len
suffix:semicolon
op_increment
id|i
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;gid_attr
(braket
id|i
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p-&gt;gid_attr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|p-&gt;gid_attr
)paren
suffix:semicolon
id|err_remove_pma
suffix:colon
id|sysfs_remove_group
c_func
(paren
op_amp
id|p-&gt;kobj
comma
op_amp
id|pma_group
)paren
suffix:semicolon
id|err_put
suffix:colon
id|kobject_put
c_func
(paren
op_amp
id|device-&gt;ports_parent
)paren
suffix:semicolon
id|err
suffix:colon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|show_node_type
r_static
id|ssize_t
id|show_node_type
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_device
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|ib_device
comma
id|class_dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;node_type
)paren
(brace
r_case
id|IB_NODE_CA
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: CA&bslash;n&quot;
comma
id|dev-&gt;node_type
)paren
suffix:semicolon
r_case
id|IB_NODE_SWITCH
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: switch&bslash;n&quot;
comma
id|dev-&gt;node_type
)paren
suffix:semicolon
r_case
id|IB_NODE_ROUTER
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: router&bslash;n&quot;
comma
id|dev-&gt;node_type
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: &lt;unknown&gt;&bslash;n&quot;
comma
id|dev-&gt;node_type
)paren
suffix:semicolon
)brace
)brace
DECL|function|show_sys_image_guid
r_static
id|ssize_t
id|show_sys_image_guid
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_device
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|ib_device
comma
id|class_dev
)paren
suffix:semicolon
r_struct
id|ib_device_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_device
c_func
(paren
id|dev
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%04x:%04x:%04x:%04x&bslash;n&quot;
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.sys_image_guid
)paren
(braket
l_int|0
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.sys_image_guid
)paren
(braket
l_int|1
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.sys_image_guid
)paren
(braket
l_int|2
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.sys_image_guid
)paren
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_node_guid
r_static
id|ssize_t
id|show_node_guid
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ib_device
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|ib_device
comma
id|class_dev
)paren
suffix:semicolon
r_struct
id|ib_device_attr
id|attr
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_query_device
c_func
(paren
id|dev
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%04x:%04x:%04x:%04x&bslash;n&quot;
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.node_guid
)paren
(braket
l_int|0
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.node_guid
)paren
(braket
l_int|1
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.node_guid
)paren
(braket
l_int|2
)braket
)paren
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
op_amp
id|attr.node_guid
)paren
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|node_type
comma
id|S_IRUGO
comma
id|show_node_type
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|sys_image_guid
comma
id|S_IRUGO
comma
id|show_sys_image_guid
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|node_guid
comma
id|S_IRUGO
comma
id|show_node_guid
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|ib_class_attributes
r_static
r_struct
id|class_device_attribute
op_star
id|ib_class_attributes
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_node_type
comma
op_amp
id|class_device_attr_sys_image_guid
comma
op_amp
id|class_device_attr_node_guid
)brace
suffix:semicolon
DECL|variable|ib_class
r_static
r_struct
r_class
id|ib_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;infiniband&quot;
comma
dot
id|release
op_assign
id|ib_device_release
comma
dot
id|hotplug
op_assign
id|ib_device_hotplug
comma
)brace
suffix:semicolon
DECL|function|ib_device_register_sysfs
r_int
id|ib_device_register_sysfs
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|class_device
op_star
id|class_dev
op_assign
op_amp
id|device-&gt;class_dev
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|class_dev
op_member_access_from_pointer
r_class
op_assign
op_amp
id|ib_class
suffix:semicolon
id|class_dev-&gt;class_data
op_assign
id|device
suffix:semicolon
id|strlcpy
c_func
(paren
id|class_dev-&gt;class_id
comma
id|device-&gt;name
comma
id|BUS_ID_SIZE
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|device-&gt;port_list
)paren
suffix:semicolon
id|ret
op_assign
id|class_device_register
c_func
(paren
id|class_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|ib_class_attributes
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ret
op_assign
id|class_device_create_file
c_func
(paren
id|class_dev
comma
id|ib_class_attributes
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_unregister
suffix:semicolon
)brace
id|device-&gt;ports_parent.parent
op_assign
id|kobject_get
c_func
(paren
op_amp
id|class_dev-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device-&gt;ports_parent.parent
)paren
(brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|err_unregister
suffix:semicolon
)brace
id|ret
op_assign
id|kobject_set_name
c_func
(paren
op_amp
id|device-&gt;ports_parent
comma
l_string|&quot;ports&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
id|ret
op_assign
id|kobject_register
c_func
(paren
op_amp
id|device-&gt;ports_parent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;node_type
op_eq
id|IB_NODE_SWITCH
)paren
(brace
id|ret
op_assign
id|add_port
c_func
(paren
id|device
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|device-&gt;phys_port_cnt
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ret
op_assign
id|add_port
c_func
(paren
id|device
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_put
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|err_put
suffix:colon
(brace
r_struct
id|kobject
op_star
id|p
comma
op_star
id|t
suffix:semicolon
r_struct
id|ib_port
op_star
id|port
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|p
comma
id|t
comma
op_amp
id|device-&gt;port_list
comma
id|entry
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|p-&gt;entry
)paren
suffix:semicolon
id|port
op_assign
id|container_of
c_func
(paren
id|p
comma
r_struct
id|ib_port
comma
id|kobj
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|pma_group
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|port-&gt;pkey_group
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|port-&gt;gid_group
)paren
suffix:semicolon
id|kobject_unregister
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
id|kobject_put
c_func
(paren
op_amp
id|class_dev-&gt;kobj
)paren
suffix:semicolon
id|err_unregister
suffix:colon
id|class_device_unregister
c_func
(paren
id|class_dev
)paren
suffix:semicolon
id|err
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ib_device_unregister_sysfs
r_void
id|ib_device_unregister_sysfs
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|kobject
op_star
id|p
comma
op_star
id|t
suffix:semicolon
r_struct
id|ib_port
op_star
id|port
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|p
comma
id|t
comma
op_amp
id|device-&gt;port_list
comma
id|entry
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|p-&gt;entry
)paren
suffix:semicolon
id|port
op_assign
id|container_of
c_func
(paren
id|p
comma
r_struct
id|ib_port
comma
id|kobj
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|pma_group
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|port-&gt;pkey_group
)paren
suffix:semicolon
id|sysfs_remove_group
c_func
(paren
id|p
comma
op_amp
id|port-&gt;gid_group
)paren
suffix:semicolon
id|kobject_unregister
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|kobject_unregister
c_func
(paren
op_amp
id|device-&gt;ports_parent
)paren
suffix:semicolon
id|class_device_unregister
c_func
(paren
op_amp
id|device-&gt;class_dev
)paren
suffix:semicolon
)brace
DECL|function|ib_sysfs_setup
r_int
id|ib_sysfs_setup
c_func
(paren
r_void
)paren
(brace
r_return
id|class_register
c_func
(paren
op_amp
id|ib_class
)paren
suffix:semicolon
)brace
DECL|function|ib_sysfs_cleanup
r_void
id|ib_sysfs_cleanup
c_func
(paren
r_void
)paren
(brace
id|class_unregister
c_func
(paren
op_amp
id|ib_class
)paren
suffix:semicolon
)brace
eof
