multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: device.c 1349 2004-12-16 21:09:43Z roland $&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &quot;core_priv.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Roland Dreier&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;core kernel InfiniBand API&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
DECL|struct|ib_client_data
r_struct
id|ib_client_data
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|client
r_struct
id|ib_client
op_star
id|client
suffix:semicolon
DECL|member|data
r_void
op_star
id|data
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|device_list
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|client_list
)paren
suffix:semicolon
multiline_comment|/*&n; * device_sem protects access to both device_list and client_list.&n; * There&squot;s no real point to using multiple locks or something fancier&n; * like an rwsem: we always access both lists, and we&squot;re always&n; * modifying one list or the other list.  In any case this is not a&n; * hot path so there&squot;s no point in trying to optimize.&n; */
r_static
id|DECLARE_MUTEX
c_func
(paren
id|device_sem
)paren
suffix:semicolon
DECL|function|ib_device_check_mandatory
r_static
r_int
id|ib_device_check_mandatory
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
DECL|macro|IB_MANDATORY_FUNC
mdefine_line|#define IB_MANDATORY_FUNC(x) { offsetof(struct ib_device, x), #x }
r_static
r_const
r_struct
(brace
r_int
id|offset
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
)brace
id|mandatory_table
(braket
)braket
op_assign
(brace
id|IB_MANDATORY_FUNC
c_func
(paren
id|query_device
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|query_port
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|query_pkey
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|query_gid
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|alloc_pd
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|dealloc_pd
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|create_ah
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|destroy_ah
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|create_qp
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|modify_qp
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|destroy_qp
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|post_send
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|post_recv
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|create_cq
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|destroy_cq
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|poll_cq
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|req_notify_cq
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|get_dma_mr
)paren
comma
id|IB_MANDATORY_FUNC
c_func
(paren
id|dereg_mr
)paren
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
id|mandatory_table
op_div
r_sizeof
id|mandatory_table
(braket
l_int|0
)braket
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
(paren
r_void
op_star
op_star
)paren
(paren
(paren
r_void
op_star
)paren
id|device
op_plus
id|mandatory_table
(braket
id|i
)braket
dot
id|offset
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Device %s is missing mandatory function %s&bslash;n&quot;
comma
id|device-&gt;name
comma
id|mandatory_table
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__ib_device_get_by_name
r_static
r_struct
id|ib_device
op_star
id|__ib_device_get_by_name
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_struct
id|ib_device
op_star
id|device
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|device
comma
op_amp
id|device_list
comma
id|core_list
)paren
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|name
comma
id|device-&gt;name
comma
id|IB_DEVICE_NAME_MAX
)paren
)paren
r_return
id|device
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|alloc_name
r_static
r_int
id|alloc_name
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_int
op_star
id|inuse
suffix:semicolon
r_char
id|buf
(braket
id|IB_DEVICE_NAME_MAX
)braket
suffix:semicolon
r_struct
id|ib_device
op_star
id|device
suffix:semicolon
r_int
id|i
suffix:semicolon
id|inuse
op_assign
(paren
r_int
op_star
)paren
id|get_zeroed_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inuse
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|device
comma
op_amp
id|device_list
comma
id|core_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sscanf
c_func
(paren
id|device-&gt;name
comma
id|name
comma
op_amp
id|i
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|PAGE_SIZE
op_star
l_int|8
)paren
r_continue
suffix:semicolon
id|snprintf
c_func
(paren
id|buf
comma
r_sizeof
id|buf
comma
id|name
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|buf
comma
id|device-&gt;name
comma
id|IB_DEVICE_NAME_MAX
)paren
)paren
id|set_bit
c_func
(paren
id|i
comma
id|inuse
)paren
suffix:semicolon
)brace
id|i
op_assign
id|find_first_zero_bit
c_func
(paren
id|inuse
comma
id|PAGE_SIZE
op_star
l_int|8
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|inuse
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|buf
comma
r_sizeof
id|buf
comma
id|name
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__ib_device_get_by_name
c_func
(paren
id|buf
)paren
)paren
r_return
op_minus
id|ENFILE
suffix:semicolon
id|strlcpy
c_func
(paren
id|name
comma
id|buf
comma
id|IB_DEVICE_NAME_MAX
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ib_alloc_device - allocate an IB device struct&n; * @size:size of structure to allocate&n; *&n; * Low-level drivers should use ib_alloc_device() to allocate &amp;struct&n; * ib_device.  @size is the size of the structure to be allocated,&n; * including any private data used by the low-level driver.&n; * ib_dealloc_device() must be used to free structures allocated with&n; * ib_alloc_device().&n; */
DECL|function|ib_alloc_device
r_struct
id|ib_device
op_star
id|ib_alloc_device
c_func
(paren
r_int
id|size
)paren
(brace
r_void
op_star
id|dev
suffix:semicolon
id|BUG_ON
c_func
(paren
id|size
OL
r_sizeof
(paren
r_struct
id|ib_device
)paren
)paren
suffix:semicolon
id|dev
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
DECL|variable|ib_alloc_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_alloc_device
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_dealloc_device - free an IB device struct&n; * @device:structure to free&n; *&n; * Free a structure allocated with ib_alloc_device().&n; */
DECL|function|ib_dealloc_device
r_void
id|ib_dealloc_device
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_if
c_cond
(paren
id|device-&gt;reg_state
op_eq
id|IB_DEV_UNINITIALIZED
)paren
(brace
id|kfree
c_func
(paren
id|device
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|BUG_ON
c_func
(paren
id|device-&gt;reg_state
op_ne
id|IB_DEV_UNREGISTERED
)paren
suffix:semicolon
id|ib_device_unregister_sysfs
c_func
(paren
id|device
)paren
suffix:semicolon
)brace
DECL|variable|ib_dealloc_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_dealloc_device
)paren
suffix:semicolon
DECL|function|add_client_context
r_static
r_int
id|add_client_context
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_struct
id|ib_client
op_star
id|client
)paren
(brace
r_struct
id|ib_client_data
op_star
id|context
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|context
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|context
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|context
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t allocate client context for %s/%s&bslash;n&quot;
comma
id|device-&gt;name
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|context-&gt;client
op_assign
id|client
suffix:semicolon
id|context-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|context-&gt;list
comma
op_amp
id|device-&gt;client_data_list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * ib_register_device - Register an IB device with IB core&n; * @device:Device to register&n; *&n; * Low-level drivers use ib_register_device() to register their&n; * devices with the IB core.  All registered clients will receive a&n; * callback for each device that is added. @device must be allocated&n; * with ib_alloc_device().&n; */
DECL|function|ib_register_device
r_int
id|ib_register_device
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strchr
c_func
(paren
id|device-&gt;name
comma
l_char|&squot;%&squot;
)paren
)paren
(brace
id|ret
op_assign
id|alloc_name
c_func
(paren
id|device-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ib_device_check_mandatory
c_func
(paren
id|device
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|device-&gt;event_handler_list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|device-&gt;client_data_list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|device-&gt;event_handler_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|device-&gt;client_data_lock
)paren
suffix:semicolon
id|ret
op_assign
id|ib_device_register_sysfs
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t register device %s with driver model&bslash;n&quot;
comma
id|device-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|device-&gt;core_list
comma
op_amp
id|device_list
)paren
suffix:semicolon
id|device-&gt;reg_state
op_assign
id|IB_DEV_REGISTERED
suffix:semicolon
(brace
r_struct
id|ib_client
op_star
id|client
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|client
comma
op_amp
id|client_list
comma
id|list
)paren
r_if
c_cond
(paren
id|client-&gt;add
op_logical_and
op_logical_neg
id|add_client_context
c_func
(paren
id|device
comma
id|client
)paren
)paren
id|client
op_member_access_from_pointer
id|add
c_func
(paren
id|device
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|ib_register_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_register_device
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_unregister_device - Unregister an IB device&n; * @device:Device to unregister&n; *&n; * Unregister an IB device.  All clients will receive a remove callback.&n; */
DECL|function|ib_unregister_device
r_void
id|ib_unregister_device
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|ib_client
op_star
id|client
suffix:semicolon
r_struct
id|ib_client_data
op_star
id|context
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
id|list_for_each_entry_reverse
c_func
(paren
id|client
comma
op_amp
id|client_list
comma
id|list
)paren
r_if
c_cond
(paren
id|client-&gt;remove
)paren
id|client
op_member_access_from_pointer
id|remove
c_func
(paren
id|device
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|device-&gt;core_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|context
comma
id|tmp
comma
op_amp
id|device-&gt;client_data_list
comma
id|list
)paren
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|device-&gt;reg_state
op_assign
id|IB_DEV_UNREGISTERED
suffix:semicolon
)brace
DECL|variable|ib_unregister_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_unregister_device
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_register_client - Register an IB client&n; * @client:Client to register&n; *&n; * Upper level users of the IB drivers can use ib_register_client() to&n; * register callbacks for IB device addition and removal.  When an IB&n; * device is added, each registered client&squot;s add method will be called&n; * (in the order the clients were registered), and when a device is&n; * removed, each client&squot;s remove method will be called (in the reverse&n; * order that clients were registered).  In addition, when&n; * ib_register_client() is called, the client will receive an add&n; * callback for all devices already registered.&n; */
DECL|function|ib_register_client
r_int
id|ib_register_client
c_func
(paren
r_struct
id|ib_client
op_star
id|client
)paren
(brace
r_struct
id|ib_device
op_star
id|device
suffix:semicolon
id|down
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|client-&gt;list
comma
op_amp
id|client_list
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|device
comma
op_amp
id|device_list
comma
id|core_list
)paren
r_if
c_cond
(paren
id|client-&gt;add
op_logical_and
op_logical_neg
id|add_client_context
c_func
(paren
id|device
comma
id|client
)paren
)paren
id|client
op_member_access_from_pointer
id|add
c_func
(paren
id|device
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ib_register_client
id|EXPORT_SYMBOL
c_func
(paren
id|ib_register_client
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_unregister_client - Unregister an IB client&n; * @client:Client to unregister&n; *&n; * Upper level users use ib_unregister_client() to remove their client&n; * registration.  When ib_unregister_client() is called, the client&n; * will receive a remove callback for each IB device still registered.&n; */
DECL|function|ib_unregister_client
r_void
id|ib_unregister_client
c_func
(paren
r_struct
id|ib_client
op_star
id|client
)paren
(brace
r_struct
id|ib_client_data
op_star
id|context
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|ib_device
op_star
id|device
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|device
comma
op_amp
id|device_list
comma
id|core_list
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;remove
)paren
id|client
op_member_access_from_pointer
id|remove
c_func
(paren
id|device
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|context
comma
id|tmp
comma
op_amp
id|device-&gt;client_data_list
comma
id|list
)paren
r_if
c_cond
(paren
id|context-&gt;client
op_eq
id|client
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|context-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|client-&gt;list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|device_sem
)paren
suffix:semicolon
)brace
DECL|variable|ib_unregister_client
id|EXPORT_SYMBOL
c_func
(paren
id|ib_unregister_client
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_get_client_data - Get IB client context&n; * @device:Device to get context for&n; * @client:Client to get context for&n; *&n; * ib_get_client_data() returns client context set with&n; * ib_set_client_data().&n; */
DECL|function|ib_get_client_data
r_void
op_star
id|ib_get_client_data
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_struct
id|ib_client
op_star
id|client
)paren
(brace
r_struct
id|ib_client_data
op_star
id|context
suffix:semicolon
r_void
op_star
id|ret
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|context
comma
op_amp
id|device-&gt;client_data_list
comma
id|list
)paren
r_if
c_cond
(paren
id|context-&gt;client
op_eq
id|client
)paren
(brace
id|ret
op_assign
id|context-&gt;data
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|ib_get_client_data
id|EXPORT_SYMBOL
c_func
(paren
id|ib_get_client_data
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_set_client_data - Get IB client context&n; * @device:Device to set context for&n; * @client:Client to set context for&n; * @data:Context to set&n; *&n; * ib_set_client_data() sets client context that can be retrieved with&n; * ib_get_client_data().&n; */
DECL|function|ib_set_client_data
r_void
id|ib_set_client_data
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_struct
id|ib_client
op_star
id|client
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|ib_client_data
op_star
id|context
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|context
comma
op_amp
id|device-&gt;client_data_list
comma
id|list
)paren
r_if
c_cond
(paren
id|context-&gt;client
op_eq
id|client
)paren
(brace
id|context-&gt;data
op_assign
id|data
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;No client context found for %s/%s&bslash;n&quot;
comma
id|device-&gt;name
comma
id|client-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|device-&gt;client_data_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|ib_set_client_data
id|EXPORT_SYMBOL
c_func
(paren
id|ib_set_client_data
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_register_event_handler - Register an IB event handler&n; * @event_handler:Handler to register&n; *&n; * ib_register_event_handler() registers an event handler that will be&n; * called back when asynchronous IB events occur (as defined in&n; * chapter 11 of the InfiniBand Architecture Specification).  This&n; * callback may occur in interrupt context.&n; */
DECL|function|ib_register_event_handler
r_int
id|ib_register_event_handler
(paren
r_struct
id|ib_event_handler
op_star
id|event_handler
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|event_handler-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|event_handler-&gt;list
comma
op_amp
id|event_handler-&gt;device-&gt;event_handler_list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|event_handler-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ib_register_event_handler
id|EXPORT_SYMBOL
c_func
(paren
id|ib_register_event_handler
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_unregister_event_handler - Unregister an event handler&n; * @event_handler:Handler to unregister&n; *&n; * Unregister an event handler registered with&n; * ib_register_event_handler().&n; */
DECL|function|ib_unregister_event_handler
r_int
id|ib_unregister_event_handler
c_func
(paren
r_struct
id|ib_event_handler
op_star
id|event_handler
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|event_handler-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|event_handler-&gt;list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|event_handler-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ib_unregister_event_handler
id|EXPORT_SYMBOL
c_func
(paren
id|ib_unregister_event_handler
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_dispatch_event - Dispatch an asynchronous event&n; * @event:Event to dispatch&n; *&n; * Low-level drivers must call ib_dispatch_event() to dispatch the&n; * event to all registered event handlers when an asynchronous event&n; * occurs.&n; */
DECL|function|ib_dispatch_event
r_void
id|ib_dispatch_event
c_func
(paren
r_struct
id|ib_event
op_star
id|event
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ib_event_handler
op_star
id|handler
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|event-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|handler
comma
op_amp
id|event-&gt;device-&gt;event_handler_list
comma
id|list
)paren
id|handler
op_member_access_from_pointer
id|handler
c_func
(paren
id|handler
comma
id|event
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|event-&gt;device-&gt;event_handler_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|ib_dispatch_event
id|EXPORT_SYMBOL
c_func
(paren
id|ib_dispatch_event
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_query_device - Query IB device attributes&n; * @device:Device to query&n; * @device_attr:Device attributes&n; *&n; * ib_query_device() returns the attributes of a device through the&n; * @device_attr pointer.&n; */
DECL|function|ib_query_device
r_int
id|ib_query_device
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_struct
id|ib_device_attr
op_star
id|device_attr
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|query_device
c_func
(paren
id|device
comma
id|device_attr
)paren
suffix:semicolon
)brace
DECL|variable|ib_query_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_query_device
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_query_port - Query IB port attributes&n; * @device:Device to query&n; * @port_num:Port number to query&n; * @port_attr:Port attributes&n; *&n; * ib_query_port() returns the attributes of a port through the&n; * @port_attr pointer.&n; */
DECL|function|ib_query_port
r_int
id|ib_query_port
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
r_struct
id|ib_port_attr
op_star
id|port_attr
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|query_port
c_func
(paren
id|device
comma
id|port_num
comma
id|port_attr
)paren
suffix:semicolon
)brace
DECL|variable|ib_query_port
id|EXPORT_SYMBOL
c_func
(paren
id|ib_query_port
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_query_gid - Get GID table entry&n; * @device:Device to query&n; * @port_num:Port number to query&n; * @index:GID table index to query&n; * @gid:Returned GID&n; *&n; * ib_query_gid() fetches the specified GID table entry.&n; */
DECL|function|ib_query_gid
r_int
id|ib_query_gid
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
r_int
id|index
comma
r_union
id|ib_gid
op_star
id|gid
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|query_gid
c_func
(paren
id|device
comma
id|port_num
comma
id|index
comma
id|gid
)paren
suffix:semicolon
)brace
DECL|variable|ib_query_gid
id|EXPORT_SYMBOL
c_func
(paren
id|ib_query_gid
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_query_pkey - Get P_Key table entry&n; * @device:Device to query&n; * @port_num:Port number to query&n; * @index:P_Key table index to query&n; * @pkey:Returned P_Key&n; *&n; * ib_query_pkey() fetches the specified P_Key table entry.&n; */
DECL|function|ib_query_pkey
r_int
id|ib_query_pkey
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
id|u16
id|index
comma
id|u16
op_star
id|pkey
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|query_pkey
c_func
(paren
id|device
comma
id|port_num
comma
id|index
comma
id|pkey
)paren
suffix:semicolon
)brace
DECL|variable|ib_query_pkey
id|EXPORT_SYMBOL
c_func
(paren
id|ib_query_pkey
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_modify_device - Change IB device attributes&n; * @device:Device to modify&n; * @device_modify_mask:Mask of attributes to change&n; * @device_modify:New attribute values&n; *&n; * ib_modify_device() changes a device&squot;s attributes as specified by&n; * the @device_modify_mask and @device_modify structure.&n; */
DECL|function|ib_modify_device
r_int
id|ib_modify_device
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
r_int
id|device_modify_mask
comma
r_struct
id|ib_device_modify
op_star
id|device_modify
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|modify_device
c_func
(paren
id|device
comma
id|device_modify_mask
comma
id|device_modify
)paren
suffix:semicolon
)brace
DECL|variable|ib_modify_device
id|EXPORT_SYMBOL
c_func
(paren
id|ib_modify_device
)paren
suffix:semicolon
multiline_comment|/**&n; * ib_modify_port - Modifies the attributes for the specified port.&n; * @device: The device to modify.&n; * @port_num: The number of the port to modify.&n; * @port_modify_mask: Mask used to specify which attributes of the port&n; *   to change.&n; * @port_modify: New attribute values for the port.&n; *&n; * ib_modify_port() changes a port&squot;s attributes as specified by the&n; * @port_modify_mask and @port_modify structure.&n; */
DECL|function|ib_modify_port
r_int
id|ib_modify_port
c_func
(paren
r_struct
id|ib_device
op_star
id|device
comma
id|u8
id|port_num
comma
r_int
id|port_modify_mask
comma
r_struct
id|ib_port_modify
op_star
id|port_modify
)paren
(brace
r_return
id|device
op_member_access_from_pointer
id|modify_port
c_func
(paren
id|device
comma
id|port_num
comma
id|port_modify_mask
comma
id|port_modify
)paren
suffix:semicolon
)brace
DECL|variable|ib_modify_port
id|EXPORT_SYMBOL
c_func
(paren
id|ib_modify_port
)paren
suffix:semicolon
DECL|function|ib_core_init
r_static
r_int
id|__init
id|ib_core_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|ib_sysfs_setup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t create InfiniBand device class&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|ib_cache_setup
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t set up InfiniBand P_Key/GID cache&bslash;n&quot;
)paren
suffix:semicolon
id|ib_sysfs_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ib_core_cleanup
r_static
r_void
id|__exit
id|ib_core_cleanup
c_func
(paren
r_void
)paren
(brace
id|ib_cache_cleanup
c_func
(paren
)paren
suffix:semicolon
id|ib_sysfs_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|ib_core_init
id|module_init
c_func
(paren
id|ib_core_init
)paren
suffix:semicolon
DECL|variable|ib_core_cleanup
id|module_exit
c_func
(paren
id|ib_core_cleanup
)paren
suffix:semicolon
eof
