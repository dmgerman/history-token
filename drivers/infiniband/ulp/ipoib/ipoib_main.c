multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: ipoib_main.c 1377 2004-12-23 19:57:12Z roland $&n; */
macro_line|#include &quot;ipoib.h&quot;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;&t;/* For ARPHRD_xxx */
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/in.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Roland Dreier&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;IP-over-InfiniBand net driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG
DECL|variable|ipoib_debug_level
r_int
id|ipoib_debug_level
suffix:semicolon
id|module_param_named
c_func
(paren
id|debug_level
comma
id|ipoib_debug_level
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug_level
comma
l_string|&quot;Enable debug tracing if &gt; 0&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|ipv4_bcast_addr
r_static
r_const
id|u8
id|ipv4_bcast_addr
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x12
comma
l_int|0x40
comma
l_int|0x1b
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|ipoib_workqueue
r_struct
id|workqueue_struct
op_star
id|ipoib_workqueue
suffix:semicolon
r_static
r_void
id|ipoib_add_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
suffix:semicolon
r_static
r_void
id|ipoib_remove_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
suffix:semicolon
DECL|variable|ipoib_client
r_static
r_struct
id|ib_client
id|ipoib_client
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ipoib&quot;
comma
dot
id|add
op_assign
id|ipoib_add_one
comma
dot
id|remove
op_assign
id|ipoib_remove_one
)brace
suffix:semicolon
DECL|function|ipoib_open
r_int
id|ipoib_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;bringing up interface&bslash;n&quot;
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|IPOIB_FLAG_ADMIN_UP
comma
op_amp
id|priv-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_pkey_dev_delay_open
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_ib_dev_open
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_ib_dev_up
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_FLAG_SUBINTERFACE
comma
op_amp
id|priv-&gt;flags
)paren
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|cpriv
suffix:semicolon
multiline_comment|/* Bring up any child interfaces too */
id|down
c_func
(paren
op_amp
id|priv-&gt;vlan_mutex
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|cpriv
comma
op_amp
id|priv-&gt;child_intfs
comma
id|list
)paren
(brace
r_int
id|flags
suffix:semicolon
id|flags
op_assign
id|cpriv-&gt;dev-&gt;flags
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|IFF_UP
)paren
r_continue
suffix:semicolon
id|dev_change_flags
c_func
(paren
id|cpriv-&gt;dev
comma
id|flags
op_or
id|IFF_UP
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|priv-&gt;vlan_mutex
)paren
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_stop
r_static
r_int
id|ipoib_stop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;stopping interface&bslash;n&quot;
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|IPOIB_FLAG_ADMIN_UP
comma
op_amp
id|priv-&gt;flags
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_ib_dev_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_ib_dev_stop
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_FLAG_SUBINTERFACE
comma
op_amp
id|priv-&gt;flags
)paren
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|cpriv
suffix:semicolon
multiline_comment|/* Bring down any child interfaces too */
id|down
c_func
(paren
op_amp
id|priv-&gt;vlan_mutex
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|cpriv
comma
op_amp
id|priv-&gt;child_intfs
comma
id|list
)paren
(brace
r_int
id|flags
suffix:semicolon
id|flags
op_assign
id|cpriv-&gt;dev-&gt;flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|IFF_UP
)paren
)paren
r_continue
suffix:semicolon
id|dev_change_flags
c_func
(paren
id|cpriv-&gt;dev
comma
id|flags
op_amp
op_complement
id|IFF_UP
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|priv-&gt;vlan_mutex
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_change_mtu
r_static
r_int
id|ipoib_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OG
id|IPOIB_PACKET_SIZE
op_minus
id|IPOIB_ENCAP_LEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|priv-&gt;admin_mtu
op_assign
id|new_mtu
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|min
c_func
(paren
id|priv-&gt;mcast_mtu
comma
id|priv-&gt;admin_mtu
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__path_find
r_static
r_struct
id|ipoib_path
op_star
id|__path_find
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_union
id|ib_gid
op_star
id|gid
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|rb_node
op_star
id|n
op_assign
id|priv-&gt;path_tree.rb_node
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|path
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_while
c_loop
(paren
id|n
)paren
(brace
id|path
op_assign
id|rb_entry
c_func
(paren
id|n
comma
r_struct
id|ipoib_path
comma
id|rb_node
)paren
suffix:semicolon
id|ret
op_assign
id|memcmp
c_func
(paren
id|gid-&gt;raw
comma
id|path-&gt;pathrec.dgid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|n
op_assign
id|n-&gt;rb_left
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|n
op_assign
id|n-&gt;rb_right
suffix:semicolon
r_else
r_return
id|path
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|__path_add
r_static
r_int
id|__path_add
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_path
op_star
id|path
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|rb_node
op_star
op_star
id|n
op_assign
op_amp
id|priv-&gt;path_tree.rb_node
suffix:semicolon
r_struct
id|rb_node
op_star
id|pn
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|tpath
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
(brace
id|pn
op_assign
op_star
id|n
suffix:semicolon
id|tpath
op_assign
id|rb_entry
c_func
(paren
id|pn
comma
r_struct
id|ipoib_path
comma
id|rb_node
)paren
suffix:semicolon
id|ret
op_assign
id|memcmp
c_func
(paren
id|path-&gt;pathrec.dgid.raw
comma
id|tpath-&gt;pathrec.dgid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|n
op_assign
op_amp
id|pn-&gt;rb_left
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|n
op_assign
op_amp
id|pn-&gt;rb_right
suffix:semicolon
r_else
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
id|rb_link_node
c_func
(paren
op_amp
id|path-&gt;rb_node
comma
id|pn
comma
id|n
)paren
suffix:semicolon
id|rb_insert_color
c_func
(paren
op_amp
id|path-&gt;rb_node
comma
op_amp
id|priv-&gt;path_tree
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|path-&gt;list
comma
op_amp
id|priv-&gt;path_list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__path_free
r_static
r_void
id|__path_free
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_path
op_star
id|path
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_neigh
op_star
id|neigh
comma
op_star
id|tn
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|__skb_dequeue
c_func
(paren
op_amp
id|path-&gt;queue
)paren
)paren
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|neigh
comma
id|tn
comma
op_amp
id|path-&gt;neigh_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;ah
)paren
id|ipoib_put_ah
c_func
(paren
id|neigh-&gt;ah
)paren
suffix:semicolon
op_star
id|to_ipoib_neigh
c_func
(paren
id|neigh-&gt;neighbour
)paren
op_assign
l_int|NULL
suffix:semicolon
id|neigh-&gt;neighbour-&gt;ops-&gt;destructor
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|path-&gt;ah
)paren
id|ipoib_put_ah
c_func
(paren
id|path-&gt;ah
)paren
suffix:semicolon
id|rb_erase
c_func
(paren
op_amp
id|path-&gt;rb_node
comma
op_amp
id|priv-&gt;path_tree
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|path-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|path
)paren
suffix:semicolon
)brace
DECL|function|ipoib_flush_paths
r_void
id|ipoib_flush_paths
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|path
comma
op_star
id|tp
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|remove_list
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_splice
c_func
(paren
op_amp
id|priv-&gt;path_list
comma
op_amp
id|remove_list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;path_list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|path
comma
id|tp
comma
op_amp
id|remove_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|path-&gt;query
)paren
id|ib_sa_cancel_query
c_func
(paren
id|path-&gt;query_id
comma
id|path-&gt;query
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|path-&gt;done
)paren
suffix:semicolon
id|__path_free
c_func
(paren
id|dev
comma
id|path
)paren
suffix:semicolon
)brace
)brace
DECL|function|path_rec_completion
r_static
r_void
id|path_rec_completion
c_func
(paren
r_int
id|status
comma
r_struct
id|ib_sa_path_rec
op_star
id|pathrec
comma
r_void
op_star
id|path_ptr
)paren
(brace
r_struct
id|ipoib_path
op_star
id|path
op_assign
id|path_ptr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|path-&gt;dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_ah
op_star
id|ah
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ipoib_neigh
op_star
id|neigh
suffix:semicolon
r_struct
id|sk_buff_head
id|skqueue
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|pathrec
)paren
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;PathRec LID 0x%04x for GID &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|be16_to_cpu
c_func
(paren
id|pathrec-&gt;dlid
)paren
comma
id|IPOIB_GID_ARG
c_func
(paren
id|pathrec-&gt;dgid
)paren
)paren
suffix:semicolon
r_else
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;PathRec status %d for GID &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|status
comma
id|IPOIB_GID_ARG
c_func
(paren
id|path-&gt;pathrec.dgid
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|skqueue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_struct
id|ib_ah_attr
id|av
op_assign
(brace
dot
id|dlid
op_assign
id|be16_to_cpu
c_func
(paren
id|pathrec-&gt;dlid
)paren
comma
dot
id|sl
op_assign
id|pathrec-&gt;sl
comma
dot
id|port_num
op_assign
id|priv-&gt;port
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ib_sa_rate_enum_to_int
c_func
(paren
id|pathrec-&gt;rate
)paren
OG
l_int|0
)paren
id|av.static_rate
op_assign
(paren
l_int|2
op_star
id|priv-&gt;local_rate
op_minus
id|ib_sa_rate_enum_to_int
c_func
(paren
id|pathrec-&gt;rate
)paren
op_minus
l_int|1
)paren
op_div
(paren
id|priv-&gt;local_rate
ques
c_cond
id|priv-&gt;local_rate
suffix:colon
l_int|1
)paren
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;static_rate %d for local port %dX, path %dX&bslash;n&quot;
comma
id|av.static_rate
comma
id|priv-&gt;local_rate
comma
id|ib_sa_rate_enum_to_int
c_func
(paren
id|pathrec-&gt;rate
)paren
)paren
suffix:semicolon
id|ah
op_assign
id|ipoib_create_ah
c_func
(paren
id|dev
comma
id|priv-&gt;pd
comma
op_amp
id|av
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|path-&gt;ah
op_assign
id|ah
suffix:semicolon
r_if
c_cond
(paren
id|ah
)paren
(brace
id|path-&gt;pathrec
op_assign
op_star
id|pathrec
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;created address handle %p for LID 0x%04x, SL %d&bslash;n&quot;
comma
id|ah
comma
id|be16_to_cpu
c_func
(paren
id|pathrec-&gt;dlid
)paren
comma
id|pathrec-&gt;sl
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|__skb_dequeue
c_func
(paren
op_amp
id|path-&gt;queue
)paren
)paren
)paren
id|__skb_queue_tail
c_func
(paren
op_amp
id|skqueue
comma
id|skb
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|neigh
comma
op_amp
id|path-&gt;neigh_list
comma
id|list
)paren
(brace
id|kref_get
c_func
(paren
op_amp
id|path-&gt;ah-&gt;ref
)paren
suffix:semicolon
id|neigh-&gt;ah
op_assign
id|path-&gt;ah
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|__skb_dequeue
c_func
(paren
op_amp
id|neigh-&gt;queue
)paren
)paren
)paren
id|__skb_queue_tail
c_func
(paren
op_amp
id|skqueue
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_else
id|path-&gt;query
op_assign
l_int|NULL
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|path-&gt;done
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|__skb_dequeue
c_func
(paren
op_amp
id|skqueue
)paren
)paren
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
)paren
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;dev_queue_xmit failed &quot;
l_string|&quot;to requeue packet&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|path_rec_create
r_static
r_struct
id|ipoib_path
op_star
id|path_rec_create
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_union
id|ib_gid
op_star
id|gid
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|path
suffix:semicolon
id|path
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|path
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path
)paren
r_return
l_int|NULL
suffix:semicolon
id|path-&gt;dev
op_assign
id|dev
suffix:semicolon
id|path-&gt;pathrec.dlid
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|path-&gt;queue
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|path-&gt;neigh_list
)paren
suffix:semicolon
id|path-&gt;query
op_assign
l_int|NULL
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|path-&gt;done
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|path-&gt;pathrec.dgid.raw
comma
id|gid-&gt;raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
id|path-&gt;pathrec.sgid
op_assign
id|priv-&gt;local_gid
suffix:semicolon
id|path-&gt;pathrec.pkey
op_assign
id|cpu_to_be16
c_func
(paren
id|priv-&gt;pkey
)paren
suffix:semicolon
id|path-&gt;pathrec.numb_path
op_assign
l_int|1
suffix:semicolon
id|__path_add
c_func
(paren
id|dev
comma
id|path
)paren
suffix:semicolon
r_return
id|path
suffix:semicolon
)brace
DECL|function|path_rec_start
r_static
r_int
id|path_rec_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_path
op_star
id|path
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;Start path record lookup for &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|path-&gt;pathrec.dgid
)paren
)paren
suffix:semicolon
id|path-&gt;query_id
op_assign
id|ib_sa_path_rec_get
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
op_amp
id|path-&gt;pathrec
comma
id|IB_SA_PATH_REC_DGID
op_or
id|IB_SA_PATH_REC_SGID
op_or
id|IB_SA_PATH_REC_NUMB_PATH
op_or
id|IB_SA_PATH_REC_PKEY
comma
l_int|1000
comma
id|GFP_ATOMIC
comma
id|path_rec_completion
comma
id|path
comma
op_amp
id|path-&gt;query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path-&gt;query_id
OL
l_int|0
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_sa_path_rec_get failed&bslash;n&quot;
)paren
suffix:semicolon
id|path-&gt;query
op_assign
l_int|NULL
suffix:semicolon
r_return
id|path-&gt;query_id
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|neigh_add_path
r_static
r_void
id|neigh_add_path
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|path
suffix:semicolon
r_struct
id|ipoib_neigh
op_star
id|neigh
suffix:semicolon
id|neigh
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|neigh
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|neigh
)paren
(brace
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|neigh-&gt;queue
)paren
suffix:semicolon
id|neigh-&gt;neighbour
op_assign
id|skb-&gt;dst-&gt;neighbour
suffix:semicolon
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
op_assign
id|neigh
suffix:semicolon
multiline_comment|/*&n;&t; * We can only be called from ipoib_start_xmit, so we&squot;re&n;&t; * inside tx_lock -- no need to save/restore flags.&n;&t; */
id|spin_lock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|path
op_assign
id|__path_find
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path
)paren
(brace
id|path
op_assign
id|path_rec_create
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path
)paren
r_goto
id|err
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|neigh-&gt;list
comma
op_amp
id|path-&gt;neigh_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path-&gt;pathrec.dlid
)paren
(brace
id|kref_get
c_func
(paren
op_amp
id|path-&gt;ah-&gt;ref
)paren
suffix:semicolon
id|neigh-&gt;ah
op_assign
id|path-&gt;ah
suffix:semicolon
id|ipoib_send
c_func
(paren
id|dev
comma
id|skb
comma
id|path-&gt;ah
comma
id|be32_to_cpup
c_func
(paren
(paren
id|__be32
op_star
)paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|neigh-&gt;ah
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|neigh-&gt;queue
)paren
OL
id|IPOIB_MAX_PATH_REC_QUEUE
)paren
(brace
id|__skb_queue_tail
c_func
(paren
op_amp
id|neigh-&gt;queue
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|path-&gt;query
op_logical_and
id|path_rec_start
c_func
(paren
id|dev
comma
id|path
)paren
)paren
r_goto
id|err
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
id|err
suffix:colon
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
op_assign
l_int|NULL
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|neigh-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|neigh-&gt;neighbour-&gt;ops-&gt;destructor
op_assign
l_int|NULL
suffix:semicolon
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|path_lookup
r_static
r_void
id|path_lookup
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Look up path record for unicasts */
r_if
c_cond
(paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
(braket
l_int|4
)braket
op_ne
l_int|0xff
)paren
(brace
id|neigh_add_path
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Add in the P_Key for multicasts */
id|skb-&gt;dst-&gt;neighbour-&gt;ha
(braket
l_int|8
)braket
op_assign
(paren
id|priv-&gt;pkey
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|skb-&gt;dst-&gt;neighbour-&gt;ha
(braket
l_int|9
)braket
op_assign
id|priv-&gt;pkey
op_amp
l_int|0xff
suffix:semicolon
id|ipoib_mcast_send
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
op_plus
l_int|4
)paren
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|unicast_arp_send
r_static
r_void
id|unicast_arp_send
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_pseudoheader
op_star
id|phdr
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_path
op_star
id|path
suffix:semicolon
multiline_comment|/*&n;&t; * We can only be called from ipoib_start_xmit, so we&squot;re&n;&t; * inside tx_lock -- no need to save/restore flags.&n;&t; */
id|spin_lock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|path
op_assign
id|__path_find
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|phdr-&gt;hwaddr
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path
)paren
(brace
id|path
op_assign
id|path_rec_create
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|phdr-&gt;hwaddr
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path
)paren
(brace
multiline_comment|/* put pseudoheader back on for next time */
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
op_star
id|phdr
)paren
suffix:semicolon
id|__skb_queue_tail
c_func
(paren
op_amp
id|path-&gt;queue
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path_rec_start
c_func
(paren
id|dev
comma
id|path
)paren
)paren
id|__path_free
c_func
(paren
id|dev
comma
id|path
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|path-&gt;pathrec.dlid
)paren
(brace
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;Send unicast ARP to %04x&bslash;n&quot;
comma
id|be16_to_cpu
c_func
(paren
id|path-&gt;pathrec.dlid
)paren
)paren
suffix:semicolon
id|ipoib_send
c_func
(paren
id|dev
comma
id|skb
comma
id|path-&gt;ah
comma
id|be32_to_cpup
c_func
(paren
(paren
id|__be32
op_star
)paren
id|phdr-&gt;hwaddr
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|path-&gt;query
op_logical_or
op_logical_neg
id|path_rec_start
c_func
(paren
id|dev
comma
id|path
)paren
)paren
op_logical_and
id|skb_queue_len
c_func
(paren
op_amp
id|path-&gt;queue
)paren
OL
id|IPOIB_MAX_PATH_REC_QUEUE
)paren
(brace
multiline_comment|/* put pseudoheader back on for next time */
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
op_star
id|phdr
)paren
suffix:semicolon
id|__skb_queue_tail
c_func
(paren
op_amp
id|path-&gt;queue
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|ipoib_start_xmit
r_static
r_int
id|ipoib_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_neigh
op_star
id|neigh
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|spin_trylock
c_func
(paren
op_amp
id|priv-&gt;tx_lock
)paren
)paren
(brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|NETDEV_TX_LOCKED
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Check if our queue is stopped.  Since we have the LLTX bit&n;&t; * set, we can&squot;t rely on netif_stop_queue() preventing our&n;&t; * xmit function from being called with a full queue.&n;&t; */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|NETDEV_TX_BUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;dst
op_logical_and
id|skb-&gt;dst-&gt;neighbour
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
)paren
)paren
(brace
id|path_lookup
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|neigh
op_assign
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|neigh-&gt;ah
)paren
)paren
(brace
id|ipoib_send
c_func
(paren
id|dev
comma
id|skb
comma
id|neigh-&gt;ah
comma
id|be32_to_cpup
c_func
(paren
(paren
id|__be32
op_star
)paren
id|skb-&gt;dst-&gt;neighbour-&gt;ha
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|neigh-&gt;queue
)paren
OL
id|IPOIB_MAX_PATH_REC_QUEUE
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|__skb_queue_tail
c_func
(paren
op_amp
id|neigh-&gt;queue
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|ipoib_pseudoheader
op_star
id|phdr
op_assign
(paren
r_struct
id|ipoib_pseudoheader
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
op_star
id|phdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phdr-&gt;hwaddr
(braket
l_int|4
)braket
op_eq
l_int|0xff
)paren
(brace
multiline_comment|/* Add in the P_Key for multicast*/
id|phdr-&gt;hwaddr
(braket
l_int|8
)braket
op_assign
(paren
id|priv-&gt;pkey
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|phdr-&gt;hwaddr
(braket
l_int|9
)braket
op_assign
id|priv-&gt;pkey
op_amp
l_int|0xff
suffix:semicolon
id|ipoib_mcast_send
c_func
(paren
id|dev
comma
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|phdr-&gt;hwaddr
op_plus
l_int|4
)paren
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* unicast GID -- should be ARP reply */
r_if
c_cond
(paren
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
id|skb-&gt;data
)paren
op_ne
id|ETH_P_ARP
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;Unicast, no %s: type %04x, QPN %06x &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|skb-&gt;dst
ques
c_cond
l_string|&quot;neigh&quot;
suffix:colon
l_string|&quot;dst&quot;
comma
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
id|skb-&gt;data
)paren
comma
id|be32_to_cpup
c_func
(paren
(paren
id|u32
op_star
)paren
id|phdr-&gt;hwaddr
)paren
comma
id|IPOIB_GID_ARG
c_func
(paren
op_star
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|phdr-&gt;hwaddr
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
op_increment
id|priv-&gt;stats.tx_dropped
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|unicast_arp_send
c_func
(paren
id|skb
comma
id|dev
comma
id|phdr
)paren
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|NETDEV_TX_OK
suffix:semicolon
)brace
DECL|function|ipoib_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|ipoib_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
DECL|function|ipoib_timeout
r_static
r_void
id|ipoib_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;transmit timeout: latency %ld&bslash;n&quot;
comma
id|jiffies
op_minus
id|dev-&gt;trans_start
)paren
suffix:semicolon
multiline_comment|/* XXX reset QP, etc. */
)brace
DECL|function|ipoib_hard_header
r_static
r_int
id|ipoib_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_struct
id|ipoib_header
op_star
id|header
suffix:semicolon
id|header
op_assign
(paren
r_struct
id|ipoib_header
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
op_star
id|header
)paren
suffix:semicolon
id|header-&gt;proto
op_assign
id|htons
c_func
(paren
id|type
)paren
suffix:semicolon
id|header-&gt;reserved
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * If we don&squot;t have a neighbour structure, stuff the&n;&t; * destination address onto the front of the skb so we can&n;&t; * figure out where to send the packet later.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;dst
op_logical_or
op_logical_neg
id|skb-&gt;dst-&gt;neighbour
)paren
(brace
r_struct
id|ipoib_pseudoheader
op_star
id|phdr
op_assign
(paren
r_struct
id|ipoib_pseudoheader
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
op_star
id|phdr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|phdr-&gt;hwaddr
comma
id|daddr
comma
id|INFINIBAND_ALEN
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_set_mcast_list
r_static
r_void
id|ipoib_set_mcast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;restart_task
)paren
suffix:semicolon
)brace
DECL|function|ipoib_neigh_destructor
r_static
r_void
id|ipoib_neigh_destructor
c_func
(paren
r_struct
id|neighbour
op_star
id|n
)paren
(brace
r_struct
id|ipoib_neigh
op_star
id|neigh
op_assign
op_star
id|to_ipoib_neigh
c_func
(paren
id|n
)paren
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|n-&gt;dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ipoib_dbg
c_func
(paren
id|priv
comma
l_string|&quot;neigh_destructor for %06x &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|be32_to_cpup
c_func
(paren
(paren
id|__be32
op_star
)paren
id|n-&gt;ha
)paren
comma
id|IPOIB_GID_ARG
c_func
(paren
op_star
(paren
(paren
r_union
id|ib_gid
op_star
)paren
(paren
id|n-&gt;ha
op_plus
l_int|4
)paren
)paren
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;ah
)paren
id|ipoib_put_ah
c_func
(paren
id|neigh-&gt;ah
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|neigh-&gt;list
)paren
suffix:semicolon
op_star
id|to_ipoib_neigh
c_func
(paren
id|n
)paren
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|ipoib_neigh_setup
r_static
r_int
id|ipoib_neigh_setup
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
multiline_comment|/*&n;&t; * Is this kosher?  I can&squot;t find anybody in the kernel that&n;&t; * sets neigh-&gt;destructor, so we should be able to set it here&n;&t; * without trouble.&n;&t; */
id|neigh-&gt;ops-&gt;destructor
op_assign
id|ipoib_neigh_destructor
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_neigh_setup_dev
r_static
r_int
id|ipoib_neigh_setup_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neigh_parms
op_star
id|parms
)paren
(brace
id|parms-&gt;neigh_setup
op_assign
id|ipoib_neigh_setup
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_dev_init
r_int
id|ipoib_dev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ib_device
op_star
id|ca
comma
r_int
id|port
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Allocate RX/TX &quot;rings&quot; to hold queued skbs */
id|priv-&gt;rx_ring
op_assign
id|kmalloc
c_func
(paren
id|IPOIB_RX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ipoib_buf
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;rx_ring
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to allocate RX ring (%d entries)&bslash;n&quot;
comma
id|ca-&gt;name
comma
id|IPOIB_RX_RING_SIZE
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|priv-&gt;rx_ring
comma
l_int|0
comma
id|IPOIB_RX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ipoib_buf
)paren
)paren
suffix:semicolon
id|priv-&gt;tx_ring
op_assign
id|kmalloc
c_func
(paren
id|IPOIB_TX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ipoib_buf
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;tx_ring
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to allocate TX ring (%d entries)&bslash;n&quot;
comma
id|ca-&gt;name
comma
id|IPOIB_TX_RING_SIZE
)paren
suffix:semicolon
r_goto
id|out_rx_ring_cleanup
suffix:semicolon
)brace
id|memset
c_func
(paren
id|priv-&gt;tx_ring
comma
l_int|0
comma
id|IPOIB_TX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ipoib_buf
)paren
)paren
suffix:semicolon
multiline_comment|/* priv-&gt;tx_head &amp; tx_tail are already 0 */
r_if
c_cond
(paren
id|ipoib_ib_dev_init
c_func
(paren
id|dev
comma
id|ca
comma
id|port
)paren
)paren
r_goto
id|out_tx_ring_cleanup
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_tx_ring_cleanup
suffix:colon
id|kfree
c_func
(paren
id|priv-&gt;tx_ring
)paren
suffix:semicolon
id|out_rx_ring_cleanup
suffix:colon
id|kfree
c_func
(paren
id|priv-&gt;rx_ring
)paren
suffix:semicolon
id|out
suffix:colon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|ipoib_dev_cleanup
r_void
id|ipoib_dev_cleanup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
comma
op_star
id|cpriv
comma
op_star
id|tcpriv
suffix:semicolon
id|ipoib_delete_debug_file
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Delete any child interfaces first */
id|list_for_each_entry_safe
c_func
(paren
id|cpriv
comma
id|tcpriv
comma
op_amp
id|priv-&gt;child_intfs
comma
id|list
)paren
(brace
id|unregister_netdev
c_func
(paren
id|cpriv-&gt;dev
)paren
suffix:semicolon
id|ipoib_dev_cleanup
c_func
(paren
id|cpriv-&gt;dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|cpriv-&gt;dev
)paren
suffix:semicolon
)brace
id|ipoib_ib_dev_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;rx_ring
)paren
(brace
id|kfree
c_func
(paren
id|priv-&gt;rx_ring
)paren
suffix:semicolon
id|priv-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;tx_ring
)paren
(brace
id|kfree
c_func
(paren
id|priv-&gt;tx_ring
)paren
suffix:semicolon
id|priv-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|ipoib_setup
r_static
r_void
id|ipoib_setup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|ipoib_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|ipoib_stop
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|ipoib_change_mtu
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|ipoib_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|ipoib_get_stats
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|ipoib_timeout
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|ipoib_hard_header
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|ipoib_set_mcast_list
suffix:semicolon
id|dev-&gt;neigh_setup
op_assign
id|ipoib_neigh_setup_dev
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|HZ
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;header_cache_update
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_BROADCAST
op_or
id|IFF_MULTICAST
suffix:semicolon
multiline_comment|/*&n;&t; * We add in INFINIBAND_ALEN to allow for the destination&n;&t; * address &quot;pseudoheader&quot; for skbs without neighbour struct.&n;&t; */
id|dev-&gt;hard_header_len
op_assign
id|IPOIB_ENCAP_LEN
op_plus
id|INFINIBAND_ALEN
suffix:semicolon
id|dev-&gt;addr_len
op_assign
id|INFINIBAND_ALEN
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_INFINIBAND
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
id|IPOIB_TX_RING_SIZE
op_star
l_int|2
suffix:semicolon
id|dev-&gt;features
op_assign
id|NETIF_F_VLAN_CHALLENGED
op_or
id|NETIF_F_LLTX
suffix:semicolon
multiline_comment|/* MTU will be reset when mcast join happens */
id|dev-&gt;mtu
op_assign
id|IPOIB_PACKET_SIZE
op_minus
id|IPOIB_ENCAP_LEN
suffix:semicolon
id|priv-&gt;mcast_mtu
op_assign
id|priv-&gt;admin_mtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;broadcast
comma
id|ipv4_bcast_addr
comma
id|INFINIBAND_ALEN
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|priv-&gt;dev
op_assign
id|dev
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;tx_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|priv-&gt;mcast_mutex
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|priv-&gt;vlan_mutex
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;path_list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;child_intfs
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;dead_ahs
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;multicast_list
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;pkey_task
comma
id|ipoib_pkey_poll
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;mcast_task
comma
id|ipoib_mcast_join_task
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;flush_task
comma
id|ipoib_ib_dev_flush
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;restart_task
comma
id|ipoib_mcast_restart_task
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;ah_reap_task
comma
id|ipoib_reap_ah
comma
id|priv-&gt;dev
)paren
suffix:semicolon
)brace
DECL|function|ipoib_intf_alloc
r_struct
id|ipoib_dev_priv
op_star
id|ipoib_intf_alloc
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|alloc_netdev
c_func
(paren
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|ipoib_dev_priv
)paren
comma
id|name
comma
id|ipoib_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|show_pkey
r_static
id|ssize_t
id|show_pkey
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|net_device
comma
id|class_dev
)paren
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|priv-&gt;pkey
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|pkey
comma
id|S_IRUGO
comma
id|show_pkey
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|create_child
r_static
id|ssize_t
id|create_child
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|pkey
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%i&quot;
comma
op_amp
id|pkey
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pkey
template_param
l_int|0xffff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|ipoib_vlan_add
c_func
(paren
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|net_device
comma
id|class_dev
)paren
comma
id|pkey
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|create_child
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|create_child
)paren
suffix:semicolon
DECL|function|delete_child
r_static
id|ssize_t
id|delete_child
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|pkey
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%i&quot;
comma
op_amp
id|pkey
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pkey
template_param
l_int|0xffff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|ipoib_vlan_delete
c_func
(paren
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|net_device
comma
id|class_dev
)paren
comma
id|pkey
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|delete_child
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|delete_child
)paren
suffix:semicolon
DECL|function|ipoib_add_pkey_attr
r_int
id|ipoib_add_pkey_attr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|class_device_create_file
c_func
(paren
op_amp
id|dev-&gt;class_dev
comma
op_amp
id|class_device_attr_pkey
)paren
suffix:semicolon
)brace
DECL|function|ipoib_add_port
r_static
r_struct
id|net_device
op_star
id|ipoib_add_port
c_func
(paren
r_const
r_char
op_star
id|format
comma
r_struct
id|ib_device
op_star
id|hca
comma
id|u8
id|port
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
suffix:semicolon
r_int
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|priv
op_assign
id|ipoib_intf_alloc
c_func
(paren
id|format
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv
)paren
r_goto
id|alloc_mem_failed
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|priv-&gt;dev
comma
id|hca-&gt;dma_device
)paren
suffix:semicolon
id|result
op_assign
id|ib_query_pkey
c_func
(paren
id|hca
comma
id|port
comma
l_int|0
comma
op_amp
id|priv-&gt;pkey
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ib_query_pkey port %d failed (ret = %d)&bslash;n&quot;
comma
id|hca-&gt;name
comma
id|port
comma
id|result
)paren
suffix:semicolon
r_goto
id|alloc_mem_failed
suffix:semicolon
)brace
id|priv-&gt;dev-&gt;broadcast
(braket
l_int|8
)braket
op_assign
id|priv-&gt;pkey
op_rshift
l_int|8
suffix:semicolon
id|priv-&gt;dev-&gt;broadcast
(braket
l_int|9
)braket
op_assign
id|priv-&gt;pkey
op_amp
l_int|0xff
suffix:semicolon
id|result
op_assign
id|ib_query_gid
c_func
(paren
id|hca
comma
id|port
comma
l_int|0
comma
op_amp
id|priv-&gt;local_gid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ib_query_gid port %d failed (ret = %d)&bslash;n&quot;
comma
id|hca-&gt;name
comma
id|port
comma
id|result
)paren
suffix:semicolon
r_goto
id|alloc_mem_failed
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|priv-&gt;dev-&gt;dev_addr
op_plus
l_int|4
comma
id|priv-&gt;local_gid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
id|result
op_assign
id|ipoib_dev_init
c_func
(paren
id|priv-&gt;dev
comma
id|hca
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to initialize port %d (ret = %d)&bslash;n&quot;
comma
id|hca-&gt;name
comma
id|port
comma
id|result
)paren
suffix:semicolon
r_goto
id|device_init_failed
suffix:semicolon
)brace
id|INIT_IB_EVENT_HANDLER
c_func
(paren
op_amp
id|priv-&gt;event_handler
comma
id|priv-&gt;ca
comma
id|ipoib_event
)paren
suffix:semicolon
id|result
op_assign
id|ib_register_event_handler
c_func
(paren
op_amp
id|priv-&gt;event_handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ib_register_event_handler failed for &quot;
l_string|&quot;port %d (ret = %d)&bslash;n&quot;
comma
id|hca-&gt;name
comma
id|port
comma
id|result
)paren
suffix:semicolon
r_goto
id|event_failed
suffix:semicolon
)brace
id|result
op_assign
id|register_netdev
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: couldn&squot;t register ipoib port %d; error %d&bslash;n&quot;
comma
id|hca-&gt;name
comma
id|port
comma
id|result
)paren
suffix:semicolon
r_goto
id|register_failed
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipoib_create_debug_file
c_func
(paren
id|priv-&gt;dev
)paren
)paren
r_goto
id|debug_failed
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_add_pkey_attr
c_func
(paren
id|priv-&gt;dev
)paren
)paren
r_goto
id|sysfs_failed
suffix:semicolon
r_if
c_cond
(paren
id|class_device_create_file
c_func
(paren
op_amp
id|priv-&gt;dev-&gt;class_dev
comma
op_amp
id|class_device_attr_create_child
)paren
)paren
r_goto
id|sysfs_failed
suffix:semicolon
r_if
c_cond
(paren
id|class_device_create_file
c_func
(paren
op_amp
id|priv-&gt;dev-&gt;class_dev
comma
op_amp
id|class_device_attr_delete_child
)paren
)paren
r_goto
id|sysfs_failed
suffix:semicolon
r_return
id|priv-&gt;dev
suffix:semicolon
id|sysfs_failed
suffix:colon
id|ipoib_delete_debug_file
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|debug_failed
suffix:colon
id|unregister_netdev
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|register_failed
suffix:colon
id|ib_unregister_event_handler
c_func
(paren
op_amp
id|priv-&gt;event_handler
)paren
suffix:semicolon
id|event_failed
suffix:colon
id|ipoib_dev_cleanup
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|device_init_failed
suffix:colon
id|free_netdev
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|alloc_mem_failed
suffix:colon
r_return
id|ERR_PTR
c_func
(paren
id|result
)paren
suffix:semicolon
)brace
DECL|function|ipoib_add_one
r_static
r_void
id|ipoib_add_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|list_head
op_star
id|dev_list
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
suffix:semicolon
r_int
id|s
comma
id|e
comma
id|p
suffix:semicolon
id|dev_list
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|dev_list
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_list
)paren
r_return
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
id|dev_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;node_type
op_eq
id|IB_NODE_SWITCH
)paren
(brace
id|s
op_assign
l_int|0
suffix:semicolon
id|e
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|s
op_assign
l_int|1
suffix:semicolon
id|e
op_assign
id|device-&gt;phys_port_cnt
suffix:semicolon
)brace
r_for
c_loop
(paren
id|p
op_assign
id|s
suffix:semicolon
id|p
op_le
id|e
suffix:semicolon
op_increment
id|p
)paren
(brace
id|dev
op_assign
id|ipoib_add_port
c_func
(paren
l_string|&quot;ib%d&quot;
comma
id|device
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|dev
)paren
)paren
(brace
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|priv-&gt;list
comma
id|dev_list
)paren
suffix:semicolon
)brace
)brace
id|ib_set_client_data
c_func
(paren
id|device
comma
op_amp
id|ipoib_client
comma
id|dev_list
)paren
suffix:semicolon
)brace
DECL|function|ipoib_remove_one
r_static
r_void
id|ipoib_remove_one
c_func
(paren
r_struct
id|ib_device
op_star
id|device
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|list_head
op_star
id|dev_list
suffix:semicolon
id|dev_list
op_assign
id|ib_get_client_data
c_func
(paren
id|device
comma
op_amp
id|ipoib_client
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|priv
comma
id|tmp
comma
id|dev_list
comma
id|list
)paren
(brace
id|ib_unregister_event_handler
c_func
(paren
op_amp
id|priv-&gt;event_handler
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|ipoib_dev_cleanup
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipoib_init_module
r_static
r_int
id|__init
id|ipoib_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|ipoib_register_debugfs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/*&n;&t; * We create our own workqueue mainly because we want to be&n;&t; * able to flush it when devices are being removed.  We can&squot;t&n;&t; * use schedule_work()/flush_scheduled_work() because both&n;&t; * unregister_netdev() and linkwatch_event take the rtnl lock,&n;&t; * so flush_scheduled_work() can deadlock during device&n;&t; * removal.&n;&t; */
id|ipoib_workqueue
op_assign
id|create_singlethread_workqueue
c_func
(paren
l_string|&quot;ipoib&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipoib_workqueue
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_fs
suffix:semicolon
)brace
id|ret
op_assign
id|ib_register_client
c_func
(paren
op_amp
id|ipoib_client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_wq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_fs
suffix:colon
id|ipoib_unregister_debugfs
c_func
(paren
)paren
suffix:semicolon
id|err_wq
suffix:colon
id|destroy_workqueue
c_func
(paren
id|ipoib_workqueue
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ipoib_cleanup_module
r_static
r_void
id|__exit
id|ipoib_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|ipoib_unregister_debugfs
c_func
(paren
)paren
suffix:semicolon
id|ib_unregister_client
c_func
(paren
op_amp
id|ipoib_client
)paren
suffix:semicolon
id|destroy_workqueue
c_func
(paren
id|ipoib_workqueue
)paren
suffix:semicolon
)brace
DECL|variable|ipoib_init_module
id|module_init
c_func
(paren
id|ipoib_init_module
)paren
suffix:semicolon
DECL|variable|ipoib_cleanup_module
id|module_exit
c_func
(paren
id|ipoib_cleanup_module
)paren
suffix:semicolon
eof
