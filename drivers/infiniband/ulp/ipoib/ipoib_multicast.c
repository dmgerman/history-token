multiline_comment|/*&n; * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: ipoib_multicast.c 1362 2004-12-18 15:56:29Z roland $&n; */
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/completion.h&gt;
macro_line|#include &quot;ipoib.h&quot;
macro_line|#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG
DECL|variable|mcast_debug_level
r_static
r_int
id|mcast_debug_level
suffix:semicolon
id|module_param
c_func
(paren
id|mcast_debug_level
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mcast_debug_level
comma
l_string|&quot;Enable multicast debug tracing if &gt; 0&quot;
)paren
suffix:semicolon
macro_line|#endif
r_static
id|DECLARE_MUTEX
c_func
(paren
id|mcast_mutex
)paren
suffix:semicolon
multiline_comment|/* Used for all multicast joins (broadcast, IPv4 mcast and IPv6 mcast) */
DECL|struct|ipoib_mcast
r_struct
id|ipoib_mcast
(brace
DECL|member|mcmember
r_struct
id|ib_sa_mcmember_rec
id|mcmember
suffix:semicolon
DECL|member|ah
r_struct
id|ipoib_ah
op_star
id|ah
suffix:semicolon
DECL|member|rb_node
r_struct
id|rb_node
id|rb_node
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|done
r_struct
id|completion
id|done
suffix:semicolon
DECL|member|query_id
r_int
id|query_id
suffix:semicolon
DECL|member|query
r_struct
id|ib_sa_query
op_star
id|query
suffix:semicolon
DECL|member|created
r_int
r_int
id|created
suffix:semicolon
DECL|member|backoff
r_int
r_int
id|backoff
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|member|logcount
r_int
r_char
id|logcount
suffix:semicolon
DECL|member|neigh_list
r_struct
id|list_head
id|neigh_list
suffix:semicolon
DECL|member|pkt_queue
r_struct
id|sk_buff_head
id|pkt_queue
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ipoib_mcast_iter
r_struct
id|ipoib_mcast_iter
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|mgid
r_union
id|ib_gid
id|mgid
suffix:semicolon
DECL|member|created
r_int
r_int
id|created
suffix:semicolon
DECL|member|queuelen
r_int
r_int
id|queuelen
suffix:semicolon
DECL|member|complete
r_int
r_int
id|complete
suffix:semicolon
DECL|member|send_only
r_int
r_int
id|send_only
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ipoib_mcast_free
r_static
r_void
id|ipoib_mcast_free
c_func
(paren
r_struct
id|ipoib_mcast
op_star
id|mcast
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|mcast-&gt;dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_neigh
op_star
id|neigh
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|netdev_priv
c_func
(paren
id|dev
)paren
comma
l_string|&quot;deleting multicast group &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|neigh
comma
id|tmp
comma
op_amp
id|mcast-&gt;neigh_list
comma
id|list
)paren
(brace
id|ipoib_put_ah
c_func
(paren
id|neigh-&gt;ah
)paren
suffix:semicolon
op_star
id|to_ipoib_neigh
c_func
(paren
id|neigh-&gt;neighbour
)paren
op_assign
l_int|NULL
suffix:semicolon
id|neigh-&gt;neighbour-&gt;ops-&gt;destructor
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mcast-&gt;ah
)paren
id|ipoib_put_ah
c_func
(paren
id|mcast-&gt;ah
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|mcast
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_alloc
r_static
r_struct
id|ipoib_mcast
op_star
id|ipoib_mcast_alloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|can_sleep
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|mcast
suffix:semicolon
id|mcast
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|mcast
)paren
comma
id|can_sleep
ques
c_cond
id|GFP_KERNEL
suffix:colon
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mcast
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|mcast
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|mcast
)paren
)paren
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
id|mcast-&gt;dev
op_assign
id|dev
suffix:semicolon
id|mcast-&gt;created
op_assign
id|jiffies
suffix:semicolon
id|mcast-&gt;backoff
op_assign
id|HZ
suffix:semicolon
id|mcast-&gt;logcount
op_assign
l_int|0
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mcast-&gt;list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mcast-&gt;neigh_list
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
suffix:semicolon
id|mcast-&gt;ah
op_assign
l_int|NULL
suffix:semicolon
id|mcast-&gt;query
op_assign
l_int|NULL
suffix:semicolon
r_return
id|mcast
suffix:semicolon
)brace
DECL|function|__ipoib_mcast_find
r_static
r_struct
id|ipoib_mcast
op_star
id|__ipoib_mcast_find
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_union
id|ib_gid
op_star
id|mgid
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|rb_node
op_star
id|n
op_assign
id|priv-&gt;multicast_tree.rb_node
suffix:semicolon
r_while
c_loop
(paren
id|n
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|mcast
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mcast
op_assign
id|rb_entry
c_func
(paren
id|n
comma
r_struct
id|ipoib_mcast
comma
id|rb_node
)paren
suffix:semicolon
id|ret
op_assign
id|memcmp
c_func
(paren
id|mgid-&gt;raw
comma
id|mcast-&gt;mcmember.mgid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|n
op_assign
id|n-&gt;rb_left
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|n
op_assign
id|n-&gt;rb_right
suffix:semicolon
r_else
r_return
id|mcast
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|__ipoib_mcast_add
r_static
r_int
id|__ipoib_mcast_add
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_mcast
op_star
id|mcast
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|rb_node
op_star
op_star
id|n
op_assign
op_amp
id|priv-&gt;multicast_tree.rb_node
comma
op_star
id|pn
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
op_star
id|n
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|tmcast
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|pn
op_assign
op_star
id|n
suffix:semicolon
id|tmcast
op_assign
id|rb_entry
c_func
(paren
id|pn
comma
r_struct
id|ipoib_mcast
comma
id|rb_node
)paren
suffix:semicolon
id|ret
op_assign
id|memcmp
c_func
(paren
id|mcast-&gt;mcmember.mgid.raw
comma
id|tmcast-&gt;mcmember.mgid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|n
op_assign
op_amp
id|pn-&gt;rb_left
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
id|n
op_assign
op_amp
id|pn-&gt;rb_right
suffix:semicolon
r_else
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
id|rb_link_node
c_func
(paren
op_amp
id|mcast-&gt;rb_node
comma
id|pn
comma
id|n
)paren
suffix:semicolon
id|rb_insert_color
c_func
(paren
op_amp
id|mcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_mcast_join_finish
r_static
r_int
id|ipoib_mcast_join_finish
c_func
(paren
r_struct
id|ipoib_mcast
op_star
id|mcast
comma
r_struct
id|ib_sa_mcmember_rec
op_star
id|mcmember
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|mcast-&gt;dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mcast-&gt;mcmember
op_assign
op_star
id|mcmember
suffix:semicolon
multiline_comment|/* Set the cached Q_Key before we attach if it&squot;s the broadcast group */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|mcast-&gt;mcmember.mgid.raw
comma
id|priv-&gt;dev-&gt;broadcast
op_plus
l_int|4
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
)paren
(brace
id|priv-&gt;qkey
op_assign
id|be32_to_cpu
c_func
(paren
id|priv-&gt;broadcast-&gt;mcmember.qkey
)paren
suffix:semicolon
id|priv-&gt;tx_wr.wr.ud.remote_qkey
op_assign
id|priv-&gt;qkey
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_ATTACHED
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;multicast group &quot;
id|IPOIB_GID_FMT
l_string|&quot; already attached&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ret
op_assign
id|ipoib_mcast_attach
c_func
(paren
id|dev
comma
id|be16_to_cpu
c_func
(paren
id|mcast-&gt;mcmember.mlid
)paren
comma
op_amp
id|mcast-&gt;mcmember.mgid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;couldn&squot;t attach QP to multicast group &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_ATTACHED
comma
op_amp
id|mcast-&gt;flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
(brace
r_struct
id|ib_ah_attr
id|av
op_assign
(brace
dot
id|dlid
op_assign
id|be16_to_cpu
c_func
(paren
id|mcast-&gt;mcmember.mlid
)paren
comma
dot
id|port_num
op_assign
id|priv-&gt;port
comma
dot
id|sl
op_assign
id|mcast-&gt;mcmember.sl
comma
dot
id|ah_flags
op_assign
id|IB_AH_GRH
comma
dot
id|grh
op_assign
(brace
dot
id|flow_label
op_assign
id|be32_to_cpu
c_func
(paren
id|mcast-&gt;mcmember.flow_label
)paren
comma
dot
id|hop_limit
op_assign
id|mcast-&gt;mcmember.hop_limit
comma
dot
id|sgid_index
op_assign
l_int|0
comma
dot
id|traffic_class
op_assign
id|mcast-&gt;mcmember.traffic_class
)brace
)brace
suffix:semicolon
id|av.grh.dgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
r_if
c_cond
(paren
id|ib_sa_rate_enum_to_int
c_func
(paren
id|mcast-&gt;mcmember.rate
)paren
OG
l_int|0
)paren
id|av.static_rate
op_assign
(paren
l_int|2
op_star
id|priv-&gt;local_rate
op_minus
id|ib_sa_rate_enum_to_int
c_func
(paren
id|mcast-&gt;mcmember.rate
)paren
op_minus
l_int|1
)paren
op_div
(paren
id|priv-&gt;local_rate
ques
c_cond
id|priv-&gt;local_rate
suffix:colon
l_int|1
)paren
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;static_rate %d for local port %dX, mcmember %dX&bslash;n&quot;
comma
id|av.static_rate
comma
id|priv-&gt;local_rate
comma
id|ib_sa_rate_enum_to_int
c_func
(paren
id|mcast-&gt;mcmember.rate
)paren
)paren
suffix:semicolon
id|mcast-&gt;ah
op_assign
id|ipoib_create_ah
c_func
(paren
id|dev
comma
id|priv-&gt;pd
comma
op_amp
id|av
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mcast-&gt;ah
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_address_create failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;MGID &quot;
id|IPOIB_GID_FMT
l_string|&quot; AV %p, LID 0x%04x, SL %d&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
comma
id|mcast-&gt;ah-&gt;ah
comma
id|be16_to_cpu
c_func
(paren
id|mcast-&gt;mcmember.mlid
)paren
comma
id|mcast-&gt;mcmember.sl
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* actually send any queued packets */
r_while
c_loop
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;dst
op_logical_or
op_logical_neg
id|skb-&gt;dst-&gt;neighbour
)paren
(brace
multiline_comment|/* put pseudoheader back on for next time */
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ipoib_pseudoheader
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
)paren
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;dev_queue_xmit failed to requeue packet&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|ipoib_mcast_sendonly_join_complete
id|ipoib_mcast_sendonly_join_complete
c_func
(paren
r_int
id|status
comma
r_struct
id|ib_sa_mcmember_rec
op_star
id|mcmember
comma
r_void
op_star
id|mcast_ptr
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|mcast
op_assign
id|mcast_ptr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|mcast-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|ipoib_mcast_join_finish
c_func
(paren
id|mcast
comma
id|mcmember
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|mcast-&gt;logcount
op_increment
OL
l_int|20
)paren
id|ipoib_dbg_mcast
c_func
(paren
id|netdev_priv
c_func
(paren
id|dev
)paren
comma
l_string|&quot;multicast join failed for &quot;
id|IPOIB_GID_FMT
l_string|&quot;, status %d&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Flush out any queued packets */
r_while
c_loop
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear the busy flag so we try again */
id|clear_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_BUSY
comma
op_amp
id|mcast-&gt;flags
)paren
suffix:semicolon
)brace
id|complete
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_sendonly_join
r_static
r_int
id|ipoib_mcast_sendonly_join
c_func
(paren
r_struct
id|ipoib_mcast
op_star
id|mcast
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|mcast-&gt;dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ib_sa_mcmember_rec
id|rec
op_assign
(brace
macro_line|#if 0&t;&t;&t;&t;/* Some SMs don&squot;t support send-only yet */
dot
id|join_state
op_assign
l_int|4
macro_line|#else
dot
id|join_state
op_assign
l_int|1
macro_line|#endif
)brace
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_FLAG_OPER_UP
comma
op_amp
id|priv-&gt;flags
)paren
)paren
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;device shutting down, no multicast joins&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_BUSY
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;multicast entry busy, skipping&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|rec.mgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
id|rec.port_gid
op_assign
id|priv-&gt;local_gid
suffix:semicolon
id|rec.pkey
op_assign
id|be16_to_cpu
c_func
(paren
id|priv-&gt;pkey
)paren
suffix:semicolon
id|ret
op_assign
id|ib_sa_mcmember_rec_set
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
op_amp
id|rec
comma
id|IB_SA_MCMEMBER_REC_MGID
op_or
id|IB_SA_MCMEMBER_REC_PORT_GID
op_or
id|IB_SA_MCMEMBER_REC_PKEY
op_or
id|IB_SA_MCMEMBER_REC_JOIN_STATE
comma
l_int|1000
comma
id|GFP_ATOMIC
comma
id|ipoib_mcast_sendonly_join_complete
comma
id|mcast
comma
op_amp
id|mcast-&gt;query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_sa_mcmember_rec_set failed (ret = %d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
r_else
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;no multicast record for &quot;
id|IPOIB_GID_FMT
l_string|&quot;, starting join&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|mcast-&gt;query_id
op_assign
id|ret
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ipoib_mcast_join_complete
r_static
r_void
id|ipoib_mcast_join_complete
c_func
(paren
r_int
id|status
comma
r_struct
id|ib_sa_mcmember_rec
op_star
id|mcmember
comma
r_void
op_star
id|mcast_ptr
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|mcast
op_assign
id|mcast_ptr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|mcast-&gt;dev
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;join completion for &quot;
id|IPOIB_GID_FMT
l_string|&quot; (status %d)&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
op_logical_and
op_logical_neg
id|ipoib_mcast_join_finish
c_func
(paren
id|mcast
comma
id|mcmember
)paren
)paren
(brace
id|mcast-&gt;backoff
op_assign
id|HZ
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
id|queue_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|EINTR
)paren
(brace
id|complete
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_logical_and
id|mcast-&gt;logcount
op_increment
OL
l_int|20
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ETIMEDOUT
op_logical_or
id|status
op_eq
op_minus
id|EINTR
)paren
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;multicast join failed for &quot;
id|IPOIB_GID_FMT
l_string|&quot;, status %d&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
comma
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;multicast join failed for &quot;
id|IPOIB_GID_FMT
l_string|&quot;, status %d&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
comma
id|status
)paren
suffix:semicolon
)brace
)brace
id|mcast-&gt;backoff
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|mcast-&gt;backoff
OG
id|IPOIB_MAX_BACKOFF_SECONDS
)paren
id|mcast-&gt;backoff
op_assign
id|IPOIB_MAX_BACKOFF_SECONDS
suffix:semicolon
id|mcast-&gt;query
op_assign
l_int|NULL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ETIMEDOUT
)paren
id|queue_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
)paren
suffix:semicolon
r_else
id|queue_delayed_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
comma
id|mcast-&gt;backoff
op_star
id|HZ
)paren
suffix:semicolon
)brace
r_else
id|complete
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ipoib_mcast_join
r_static
r_void
id|ipoib_mcast_join
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_mcast
op_star
id|mcast
comma
r_int
id|create
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ib_sa_mcmember_rec
id|rec
op_assign
(brace
dot
id|join_state
op_assign
l_int|1
)brace
suffix:semicolon
id|ib_sa_comp_mask
id|comp_mask
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;joining MGID &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|rec.mgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
id|rec.port_gid
op_assign
id|priv-&gt;local_gid
suffix:semicolon
id|rec.pkey
op_assign
id|be16_to_cpu
c_func
(paren
id|priv-&gt;pkey
)paren
suffix:semicolon
id|comp_mask
op_assign
id|IB_SA_MCMEMBER_REC_MGID
op_or
id|IB_SA_MCMEMBER_REC_PORT_GID
op_or
id|IB_SA_MCMEMBER_REC_PKEY
op_or
id|IB_SA_MCMEMBER_REC_JOIN_STATE
suffix:semicolon
r_if
c_cond
(paren
id|create
)paren
(brace
id|comp_mask
op_or_assign
id|IB_SA_MCMEMBER_REC_QKEY
op_or
id|IB_SA_MCMEMBER_REC_SL
op_or
id|IB_SA_MCMEMBER_REC_FLOW_LABEL
op_or
id|IB_SA_MCMEMBER_REC_TRAFFIC_CLASS
suffix:semicolon
id|rec.qkey
op_assign
id|priv-&gt;broadcast-&gt;mcmember.qkey
suffix:semicolon
id|rec.sl
op_assign
id|priv-&gt;broadcast-&gt;mcmember.sl
suffix:semicolon
id|rec.flow_label
op_assign
id|priv-&gt;broadcast-&gt;mcmember.flow_label
suffix:semicolon
id|rec.traffic_class
op_assign
id|priv-&gt;broadcast-&gt;mcmember.traffic_class
suffix:semicolon
)brace
id|ret
op_assign
id|ib_sa_mcmember_rec_set
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
op_amp
id|rec
comma
id|comp_mask
comma
id|mcast-&gt;backoff
op_star
l_int|1000
comma
id|GFP_ATOMIC
comma
id|ipoib_mcast_join_complete
comma
id|mcast
comma
op_amp
id|mcast-&gt;query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_sa_mcmember_rec_set failed, status %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
id|mcast-&gt;backoff
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|mcast-&gt;backoff
OG
id|IPOIB_MAX_BACKOFF_SECONDS
)paren
id|mcast-&gt;backoff
op_assign
id|IPOIB_MAX_BACKOFF_SECONDS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
id|queue_delayed_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
comma
id|mcast-&gt;backoff
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
)brace
r_else
id|mcast-&gt;query_id
op_assign
id|ret
suffix:semicolon
)brace
DECL|function|ipoib_mcast_join_task
r_void
id|ipoib_mcast_join_task
c_func
(paren
r_void
op_star
id|dev_ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_ptr
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ib_query_gid
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
l_int|0
comma
op_amp
id|priv-&gt;local_gid
)paren
)paren
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_gid_entry_get() failed&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|priv-&gt;dev-&gt;dev_addr
op_plus
l_int|4
comma
id|priv-&gt;local_gid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
(brace
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ib_query_port
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
op_amp
id|attr
)paren
)paren
(brace
id|priv-&gt;local_lid
op_assign
id|attr.lid
suffix:semicolon
id|priv-&gt;local_rate
op_assign
id|attr.active_speed
op_star
id|ib_width_enum_to_int
c_func
(paren
id|attr.active_width
)paren
suffix:semicolon
)brace
r_else
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_query_port failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;broadcast
)paren
(brace
id|priv-&gt;broadcast
op_assign
id|ipoib_mcast_alloc
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;broadcast
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;failed to allocate broadcast group&bslash;n&quot;
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
id|queue_delayed_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
comma
id|HZ
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|priv-&gt;broadcast-&gt;mcmember.mgid.raw
comma
id|priv-&gt;dev-&gt;broadcast
op_plus
l_int|4
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|__ipoib_mcast_add
c_func
(paren
id|dev
comma
id|priv-&gt;broadcast
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_ATTACHED
comma
op_amp
id|priv-&gt;broadcast-&gt;flags
)paren
)paren
(brace
id|ipoib_mcast_join
c_func
(paren
id|dev
comma
id|priv-&gt;broadcast
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|mcast
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|mcast
comma
op_amp
id|priv-&gt;multicast_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_BUSY
comma
op_amp
id|mcast-&gt;flags
)paren
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_ATTACHED
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
multiline_comment|/* Found the next unjoined group */
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_amp
id|mcast-&gt;list
op_eq
op_amp
id|priv-&gt;multicast_list
)paren
(brace
multiline_comment|/* All done */
r_break
suffix:semicolon
)brace
id|ipoib_mcast_join
c_func
(paren
id|dev
comma
id|mcast
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|priv-&gt;mcast_mtu
op_assign
id|ib_mtu_enum_to_int
c_func
(paren
id|priv-&gt;broadcast-&gt;mcmember.mtu
)paren
op_minus
id|IPOIB_ENCAP_LEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|min
c_func
(paren
id|priv-&gt;mcast_mtu
comma
id|priv-&gt;admin_mtu
)paren
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;successfully joined all multicast groups&bslash;n&quot;
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_start_thread
r_int
id|ipoib_mcast_start_thread
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;starting multicast thread&bslash;n&quot;
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
)paren
id|queue_work
c_func
(paren
id|ipoib_workqueue
comma
op_amp
id|priv-&gt;mcast_task
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_mcast_stop_thread
r_int
id|ipoib_mcast_stop_thread
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_mcast
op_star
id|mcast
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;stopping multicast thread&bslash;n&quot;
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|IPOIB_MCAST_RUN
comma
op_amp
id|priv-&gt;flags
)paren
suffix:semicolon
id|cancel_delayed_work
c_func
(paren
op_amp
id|priv-&gt;mcast_task
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mcast_mutex
)paren
suffix:semicolon
id|flush_workqueue
c_func
(paren
id|ipoib_workqueue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;broadcast
op_logical_and
id|priv-&gt;broadcast-&gt;query
)paren
(brace
id|ib_sa_cancel_query
c_func
(paren
id|priv-&gt;broadcast-&gt;query_id
comma
id|priv-&gt;broadcast-&gt;query
)paren
suffix:semicolon
id|priv-&gt;broadcast-&gt;query
op_assign
l_int|NULL
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;waiting for bcast&bslash;n&quot;
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|priv-&gt;broadcast-&gt;done
)paren
suffix:semicolon
)brace
id|list_for_each_entry
c_func
(paren
id|mcast
comma
op_amp
id|priv-&gt;multicast_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|mcast-&gt;query
)paren
(brace
id|ib_sa_cancel_query
c_func
(paren
id|mcast-&gt;query_id
comma
id|mcast-&gt;query
)paren
suffix:semicolon
id|mcast-&gt;query
op_assign
l_int|NULL
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;waiting for MGID &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|mcast-&gt;done
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_mcast_leave
r_static
r_int
id|ipoib_mcast_leave
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ipoib_mcast
op_star
id|mcast
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ib_sa_mcmember_rec
id|rec
op_assign
(brace
dot
id|join_state
op_assign
l_int|1
)brace
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_clear_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_ATTACHED
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;leaving MGID &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|rec.mgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
id|rec.port_gid
op_assign
id|priv-&gt;local_gid
suffix:semicolon
id|rec.pkey
op_assign
id|be16_to_cpu
c_func
(paren
id|priv-&gt;pkey
)paren
suffix:semicolon
multiline_comment|/* Remove ourselves from the multicast group */
id|ret
op_assign
id|ipoib_mcast_detach
c_func
(paren
id|dev
comma
id|be16_to_cpu
c_func
(paren
id|mcast-&gt;mcmember.mlid
)paren
comma
op_amp
id|mcast-&gt;mcmember.mgid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ipoib_mcast_detach failed (result = %d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Just make one shot at leaving and don&squot;t wait for a reply;&n;&t; * if we fail, too bad.&n;&t; */
id|ret
op_assign
id|ib_sa_mcmember_rec_delete
c_func
(paren
id|priv-&gt;ca
comma
id|priv-&gt;port
comma
op_amp
id|rec
comma
id|IB_SA_MCMEMBER_REC_MGID
op_or
id|IB_SA_MCMEMBER_REC_PORT_GID
op_or
id|IB_SA_MCMEMBER_REC_PKEY
op_or
id|IB_SA_MCMEMBER_REC_JOIN_STATE
comma
l_int|0
comma
id|GFP_ATOMIC
comma
l_int|NULL
comma
id|mcast
comma
op_amp
id|mcast-&gt;query
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;ib_sa_mcmember_rec_delete failed &quot;
l_string|&quot;for leave (result = %d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_mcast_send
r_void
id|ipoib_mcast_send
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_union
id|ib_gid
op_star
id|mgid
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipoib_mcast
op_star
id|mcast
suffix:semicolon
multiline_comment|/*&n;&t; * We can only be called from ipoib_start_xmit, so we&squot;re&n;&t; * inside tx_lock -- no need to save/restore flags.&n;&t; */
id|spin_lock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|mcast
op_assign
id|__ipoib_mcast_find
c_func
(paren
id|dev
comma
id|mgid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mcast
)paren
(brace
multiline_comment|/* Let&squot;s create a new send only group now */
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;setting up send only multicast group for &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
op_star
id|mgid
)paren
)paren
suffix:semicolon
id|mcast
op_assign
id|ipoib_mcast_alloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mcast
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;unable to allocate memory for &quot;
l_string|&quot;multicast structure&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
suffix:semicolon
id|mcast-&gt;mcmember.mgid
op_assign
op_star
id|mgid
suffix:semicolon
id|__ipoib_mcast_add
c_func
(paren
id|dev
comma
id|mcast
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|mcast-&gt;list
comma
op_amp
id|priv-&gt;multicast_list
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mcast-&gt;ah
)paren
(brace
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
OL
id|IPOIB_MAX_MCAST_QUEUE
)paren
id|skb_queue_tail
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mcast-&gt;query
)paren
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;no address vector, &quot;
l_string|&quot;but multicast join already started&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
id|ipoib_mcast_sendonly_join
c_func
(paren
id|mcast
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If lookup completes between here and out:, don&squot;t&n;&t;&t; * want to send packet twice.&n;&t;&t; */
id|mcast
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|mcast
op_logical_and
id|mcast-&gt;ah
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;dst
op_logical_and
id|skb-&gt;dst-&gt;neighbour
op_logical_and
op_logical_neg
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
)paren
(brace
r_struct
id|ipoib_neigh
op_star
id|neigh
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|neigh
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|kref_get
c_func
(paren
op_amp
id|mcast-&gt;ah-&gt;ref
)paren
suffix:semicolon
id|neigh-&gt;ah
op_assign
id|mcast-&gt;ah
suffix:semicolon
id|neigh-&gt;neighbour
op_assign
id|skb-&gt;dst-&gt;neighbour
suffix:semicolon
op_star
id|to_ipoib_neigh
c_func
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
op_assign
id|neigh
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|neigh-&gt;list
comma
op_amp
id|mcast-&gt;neigh_list
)paren
suffix:semicolon
)brace
)brace
id|ipoib_send
c_func
(paren
id|dev
comma
id|skb
comma
id|mcast-&gt;ah
comma
id|IB_MULTICAST_QPN
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_dev_flush
r_void
id|ipoib_mcast_dev_flush
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|remove_list
)paren
suffix:semicolon
r_struct
id|ipoib_mcast
op_star
id|mcast
comma
op_star
id|tmcast
comma
op_star
id|nmcast
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;flushing multicast list&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|mcast
comma
id|tmcast
comma
op_amp
id|priv-&gt;multicast_list
comma
id|list
)paren
(brace
id|nmcast
op_assign
id|ipoib_mcast_alloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nmcast
)paren
(brace
id|nmcast-&gt;flags
op_assign
id|mcast-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|IPOIB_MCAST_FLAG_SENDONLY
)paren
suffix:semicolon
id|nmcast-&gt;mcmember.mgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
multiline_comment|/* Add the new group in before the to-be-destroyed group */
id|list_add_tail
c_func
(paren
op_amp
id|nmcast-&gt;list
comma
op_amp
id|mcast-&gt;list
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|mcast-&gt;list
)paren
suffix:semicolon
id|rb_replace_node
c_func
(paren
op_amp
id|mcast-&gt;rb_node
comma
op_amp
id|nmcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|mcast-&gt;list
comma
op_amp
id|remove_list
)paren
suffix:semicolon
)brace
r_else
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;could not reallocate multicast group &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|priv-&gt;broadcast
)paren
(brace
id|nmcast
op_assign
id|ipoib_mcast_alloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nmcast
)paren
(brace
id|nmcast-&gt;mcmember.mgid
op_assign
id|priv-&gt;broadcast-&gt;mcmember.mgid
suffix:semicolon
id|rb_replace_node
c_func
(paren
op_amp
id|priv-&gt;broadcast-&gt;rb_node
comma
op_amp
id|nmcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|priv-&gt;broadcast-&gt;list
comma
op_amp
id|remove_list
)paren
suffix:semicolon
)brace
id|priv-&gt;broadcast
op_assign
id|nmcast
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|mcast
comma
id|tmcast
comma
op_amp
id|remove_list
comma
id|list
)paren
(brace
id|ipoib_mcast_leave
c_func
(paren
id|dev
comma
id|mcast
)paren
suffix:semicolon
id|ipoib_mcast_free
c_func
(paren
id|mcast
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipoib_mcast_dev_down
r_void
id|ipoib_mcast_dev_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Delete broadcast since it will be recreated */
r_if
c_cond
(paren
id|priv-&gt;broadcast
)paren
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;deleting broadcast group&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rb_erase
c_func
(paren
op_amp
id|priv-&gt;broadcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ipoib_mcast_leave
c_func
(paren
id|dev
comma
id|priv-&gt;broadcast
)paren
suffix:semicolon
id|ipoib_mcast_free
c_func
(paren
id|priv-&gt;broadcast
)paren
suffix:semicolon
id|priv-&gt;broadcast
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|ipoib_mcast_restart_task
r_void
id|ipoib_mcast_restart_task
c_func
(paren
r_void
op_star
id|dev_ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_ptr
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_struct
id|ipoib_mcast
op_star
id|mcast
comma
op_star
id|tmcast
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|remove_list
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;restarting multicast task&bslash;n&quot;
)paren
suffix:semicolon
id|ipoib_mcast_stop_thread
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Unfortunately, the networking core only gives us a list of all of&n;&t; * the multicast hardware addresses. We need to figure out which ones&n;&t; * are new and which ones have been removed&n;&t; */
multiline_comment|/* Clear out the found flag */
id|list_for_each_entry
c_func
(paren
id|mcast
comma
op_amp
id|priv-&gt;multicast_list
comma
id|list
)paren
id|clear_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_FOUND
comma
op_amp
id|mcast-&gt;flags
)paren
suffix:semicolon
multiline_comment|/* Mark all of the entries that are found or don&squot;t exist */
r_for
c_loop
(paren
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
suffix:semicolon
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_union
id|ib_gid
id|mgid
suffix:semicolon
id|memcpy
c_func
(paren
id|mgid.raw
comma
id|mclist-&gt;dmi_addr
op_plus
l_int|4
comma
r_sizeof
id|mgid
)paren
suffix:semicolon
multiline_comment|/* Add in the P_Key */
id|mgid.raw
(braket
l_int|4
)braket
op_assign
(paren
id|priv-&gt;pkey
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|mgid.raw
(braket
l_int|5
)braket
op_assign
id|priv-&gt;pkey
op_amp
l_int|0xff
suffix:semicolon
id|mcast
op_assign
id|__ipoib_mcast_find
c_func
(paren
id|dev
comma
op_amp
id|mgid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mcast
op_logical_or
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
r_struct
id|ipoib_mcast
op_star
id|nmcast
suffix:semicolon
multiline_comment|/* Not found or send-only group, let&squot;s add a new entry */
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;adding multicast entry for mgid &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mgid
)paren
)paren
suffix:semicolon
id|nmcast
op_assign
id|ipoib_mcast_alloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nmcast
)paren
(brace
id|ipoib_warn
c_func
(paren
id|priv
comma
l_string|&quot;unable to allocate memory for multicast structure&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_FOUND
comma
op_amp
id|nmcast-&gt;flags
)paren
suffix:semicolon
id|nmcast-&gt;mcmember.mgid
op_assign
id|mgid
suffix:semicolon
r_if
c_cond
(paren
id|mcast
)paren
(brace
multiline_comment|/* Destroy the send only entry */
id|list_del
c_func
(paren
op_amp
id|mcast-&gt;list
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|mcast-&gt;list
comma
op_amp
id|remove_list
)paren
suffix:semicolon
id|rb_replace_node
c_func
(paren
op_amp
id|mcast-&gt;rb_node
comma
op_amp
id|nmcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
)brace
r_else
id|__ipoib_mcast_add
c_func
(paren
id|dev
comma
id|nmcast
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|nmcast-&gt;list
comma
op_amp
id|priv-&gt;multicast_list
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcast
)paren
id|set_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_FOUND
comma
op_amp
id|mcast-&gt;flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove all of the entries don&squot;t exist anymore */
id|list_for_each_entry_safe
c_func
(paren
id|mcast
comma
id|tmcast
comma
op_amp
id|priv-&gt;multicast_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_FOUND
comma
op_amp
id|mcast-&gt;flags
)paren
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|IPOIB_MCAST_FLAG_SENDONLY
comma
op_amp
id|mcast-&gt;flags
)paren
)paren
(brace
id|ipoib_dbg_mcast
c_func
(paren
id|priv
comma
l_string|&quot;deleting multicast group &quot;
id|IPOIB_GID_FMT
l_string|&quot;&bslash;n&quot;
comma
id|IPOIB_GID_ARG
c_func
(paren
id|mcast-&gt;mcmember.mgid
)paren
)paren
suffix:semicolon
id|rb_erase
c_func
(paren
op_amp
id|mcast-&gt;rb_node
comma
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
multiline_comment|/* Move to the remove list */
id|list_del
c_func
(paren
op_amp
id|mcast-&gt;list
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|mcast-&gt;list
comma
op_amp
id|remove_list
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* We have to cancel outside of the spinlock */
id|list_for_each_entry_safe
c_func
(paren
id|mcast
comma
id|tmcast
comma
op_amp
id|remove_list
comma
id|list
)paren
(brace
id|ipoib_mcast_leave
c_func
(paren
id|mcast-&gt;dev
comma
id|mcast
)paren
suffix:semicolon
id|ipoib_mcast_free
c_func
(paren
id|mcast
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IPOIB_FLAG_ADMIN_UP
comma
op_amp
id|priv-&gt;flags
)paren
)paren
id|ipoib_mcast_start_thread
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_iter_init
r_struct
id|ipoib_mcast_iter
op_star
id|ipoib_mcast_iter_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_mcast_iter
op_star
id|iter
suffix:semicolon
id|iter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|iter
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iter
)paren
r_return
l_int|NULL
suffix:semicolon
id|iter-&gt;dev
op_assign
id|dev
suffix:semicolon
id|memset
c_func
(paren
id|iter-&gt;mgid.raw
comma
l_int|0
comma
r_sizeof
id|iter-&gt;mgid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_mcast_iter_next
c_func
(paren
id|iter
)paren
)paren
(brace
id|ipoib_mcast_iter_free
c_func
(paren
id|iter
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|iter
suffix:semicolon
)brace
DECL|function|ipoib_mcast_iter_free
r_void
id|ipoib_mcast_iter_free
c_func
(paren
r_struct
id|ipoib_mcast_iter
op_star
id|iter
)paren
(brace
id|kfree
c_func
(paren
id|iter
)paren
suffix:semicolon
)brace
DECL|function|ipoib_mcast_iter_next
r_int
id|ipoib_mcast_iter_next
c_func
(paren
r_struct
id|ipoib_mcast_iter
op_star
id|iter
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|iter-&gt;dev
)paren
suffix:semicolon
r_struct
id|rb_node
op_star
id|n
suffix:semicolon
r_struct
id|ipoib_mcast
op_star
id|mcast
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|n
op_assign
id|rb_first
c_func
(paren
op_amp
id|priv-&gt;multicast_tree
)paren
suffix:semicolon
r_while
c_loop
(paren
id|n
)paren
(brace
id|mcast
op_assign
id|rb_entry
c_func
(paren
id|n
comma
r_struct
id|ipoib_mcast
comma
id|rb_node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|iter-&gt;mgid.raw
comma
id|mcast-&gt;mcmember.mgid.raw
comma
r_sizeof
(paren
r_union
id|ib_gid
)paren
)paren
OL
l_int|0
)paren
(brace
id|iter-&gt;mgid
op_assign
id|mcast-&gt;mcmember.mgid
suffix:semicolon
id|iter-&gt;created
op_assign
id|mcast-&gt;created
suffix:semicolon
id|iter-&gt;queuelen
op_assign
id|skb_queue_len
c_func
(paren
op_amp
id|mcast-&gt;pkt_queue
)paren
suffix:semicolon
id|iter-&gt;complete
op_assign
op_logical_neg
op_logical_neg
id|mcast-&gt;ah
suffix:semicolon
id|iter-&gt;send_only
op_assign
op_logical_neg
op_logical_neg
(paren
id|mcast-&gt;flags
op_amp
(paren
l_int|1
op_lshift
id|IPOIB_MCAST_FLAG_SENDONLY
)paren
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|n
op_assign
id|rb_next
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ipoib_mcast_iter_read
r_void
id|ipoib_mcast_iter_read
c_func
(paren
r_struct
id|ipoib_mcast_iter
op_star
id|iter
comma
r_union
id|ib_gid
op_star
id|mgid
comma
r_int
r_int
op_star
id|created
comma
r_int
r_int
op_star
id|queuelen
comma
r_int
r_int
op_star
id|complete
comma
r_int
r_int
op_star
id|send_only
)paren
(brace
op_star
id|mgid
op_assign
id|iter-&gt;mgid
suffix:semicolon
op_star
id|created
op_assign
id|iter-&gt;created
suffix:semicolon
op_star
id|queuelen
op_assign
id|iter-&gt;queuelen
suffix:semicolon
op_star
id|complete
op_assign
id|iter-&gt;complete
suffix:semicolon
op_star
id|send_only
op_assign
id|iter-&gt;send_only
suffix:semicolon
)brace
eof
