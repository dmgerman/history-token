multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: ipoib_fs.c 1389 2004-12-27 22:56:47Z roland $&n; */
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &quot;ipoib.h&quot;
r_enum
(brace
DECL|enumerator|IPOIB_MAGIC
id|IPOIB_MAGIC
op_assign
l_int|0x49504942
multiline_comment|/* &quot;IPIB&quot; */
)brace
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|ipoib_fs_mutex
)paren
suffix:semicolon
DECL|variable|ipoib_root
r_static
r_struct
id|dentry
op_star
id|ipoib_root
suffix:semicolon
DECL|variable|ipoib_sb
r_static
r_struct
id|super_block
op_star
id|ipoib_sb
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|ipoib_device_list
)paren
suffix:semicolon
DECL|function|ipoib_mcg_seq_start
r_static
r_void
op_star
id|ipoib_mcg_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|file
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ipoib_mcast_iter
op_star
id|iter
suffix:semicolon
id|loff_t
id|n
op_assign
op_star
id|pos
suffix:semicolon
id|iter
op_assign
id|ipoib_mcast_iter_init
c_func
(paren
id|file
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iter
)paren
r_return
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|n
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|ipoib_mcast_iter_next
c_func
(paren
id|iter
)paren
)paren
(brace
id|ipoib_mcast_iter_free
c_func
(paren
id|iter
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|iter
suffix:semicolon
)brace
DECL|function|ipoib_mcg_seq_next
r_static
r_void
op_star
id|ipoib_mcg_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|file
comma
r_void
op_star
id|iter_ptr
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|ipoib_mcast_iter
op_star
id|iter
op_assign
id|iter_ptr
suffix:semicolon
(paren
op_star
id|pos
)paren
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ipoib_mcast_iter_next
c_func
(paren
id|iter
)paren
)paren
(brace
id|ipoib_mcast_iter_free
c_func
(paren
id|iter
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|iter
suffix:semicolon
)brace
DECL|function|ipoib_mcg_seq_stop
r_static
r_void
id|ipoib_mcg_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|file
comma
r_void
op_star
id|iter_ptr
)paren
(brace
multiline_comment|/* nothing for now */
)brace
DECL|function|ipoib_mcg_seq_show
r_static
r_int
id|ipoib_mcg_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|file
comma
r_void
op_star
id|iter_ptr
)paren
(brace
r_struct
id|ipoib_mcast_iter
op_star
id|iter
op_assign
id|iter_ptr
suffix:semicolon
r_char
id|gid_buf
(braket
r_sizeof
l_string|&quot;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&quot;
)braket
suffix:semicolon
r_union
id|ib_gid
id|mgid
suffix:semicolon
r_int
id|i
comma
id|n
suffix:semicolon
r_int
r_int
id|created
suffix:semicolon
r_int
r_int
id|queuelen
comma
id|complete
comma
id|send_only
suffix:semicolon
r_if
c_cond
(paren
id|iter
)paren
(brace
id|ipoib_mcast_iter_read
c_func
(paren
id|iter
comma
op_amp
id|mgid
comma
op_amp
id|created
comma
op_amp
id|queuelen
comma
op_amp
id|complete
comma
op_amp
id|send_only
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
id|mgid
op_div
l_int|2
suffix:semicolon
op_increment
id|i
)paren
(brace
id|n
op_add_assign
id|sprintf
c_func
(paren
id|gid_buf
op_plus
id|n
comma
l_string|&quot;%x&quot;
comma
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|mgid.raw
)paren
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
r_sizeof
id|mgid
op_div
l_int|2
op_minus
l_int|1
)paren
id|gid_buf
(braket
id|n
op_increment
)braket
op_assign
l_char|&squot;:&squot;
suffix:semicolon
)brace
)brace
id|seq_printf
c_func
(paren
id|file
comma
l_string|&quot;GID: %*s&quot;
comma
op_minus
(paren
l_int|1
op_plus
(paren
r_int
)paren
r_sizeof
id|gid_buf
)paren
comma
id|gid_buf
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|file
comma
l_string|&quot; created: %10ld queuelen: %4d complete: %d send_only: %d&bslash;n&quot;
comma
id|created
comma
id|queuelen
comma
id|complete
comma
id|send_only
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipoib_seq_ops
r_static
r_struct
id|seq_operations
id|ipoib_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|ipoib_mcg_seq_start
comma
dot
id|next
op_assign
id|ipoib_mcg_seq_next
comma
dot
id|stop
op_assign
id|ipoib_mcg_seq_stop
comma
dot
id|show
op_assign
id|ipoib_mcg_seq_show
comma
)brace
suffix:semicolon
DECL|function|ipoib_mcg_open
r_static
r_int
id|ipoib_mcg_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|ipoib_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipoib_fops
r_static
r_struct
id|file_operations
id|ipoib_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|ipoib_mcg_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release
)brace
suffix:semicolon
DECL|function|ipoib_get_inode
r_static
r_struct
id|inode
op_star
id|ipoib_get_inode
c_func
(paren
r_void
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|new_inode
c_func
(paren
id|ipoib_sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode
)paren
(brace
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
id|inode-&gt;i_uid
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_gid
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_blksize
op_assign
id|PAGE_CACHE_SIZE
suffix:semicolon
id|inode-&gt;i_blocks
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ipoib_fops
suffix:semicolon
)brace
r_return
id|inode
suffix:semicolon
)brace
DECL|function|__ipoib_create_debug_file
r_static
r_int
id|__ipoib_create_debug_file
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_char
id|name
(braket
id|IFNAMSIZ
op_plus
r_sizeof
l_string|&quot;_mcg&quot;
)braket
suffix:semicolon
id|snprintf
c_func
(paren
id|name
comma
r_sizeof
id|name
comma
l_string|&quot;%s_mcg&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dentry
op_assign
id|d_alloc_name
c_func
(paren
id|ipoib_root
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dentry
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|inode
op_assign
id|ipoib_get_inode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|inode-&gt;u.generic_ip
op_assign
id|dev
suffix:semicolon
id|priv-&gt;mcg_dentry
op_assign
id|dentry
suffix:semicolon
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipoib_create_debug_file
r_int
id|ipoib_create_debug_file
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|priv-&gt;fs_list
comma
op_amp
id|ipoib_device_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipoib_sb
)paren
(brace
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
r_return
id|__ipoib_create_debug_file
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ipoib_delete_debug_file
r_void
id|ipoib_delete_debug_file
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ipoib_dev_priv
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|priv-&gt;fs_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipoib_sb
)paren
(brace
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;mcg_dentry
)paren
(brace
id|d_drop
c_func
(paren
id|priv-&gt;mcg_dentry
)paren
suffix:semicolon
id|simple_unlink
c_func
(paren
id|ipoib_root-&gt;d_inode
comma
id|priv-&gt;mcg_dentry
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipoib_fill_super
r_static
r_int
id|ipoib_fill_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
r_static
r_struct
id|tree_descr
id|ipoib_files
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;&quot;
)brace
)brace
suffix:semicolon
r_struct
id|ipoib_dev_priv
op_star
id|priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|simple_fill_super
c_func
(paren
id|sb
comma
id|IPOIB_MAGIC
comma
id|ipoib_files
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ipoib_root
op_assign
id|sb-&gt;s_root
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
id|ipoib_sb
op_assign
id|sb
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|priv
comma
op_amp
id|ipoib_device_list
comma
id|fs_list
)paren
(brace
id|ret
op_assign
id|__ipoib_create_debug_file
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ipoib_get_sb
r_static
r_struct
id|super_block
op_star
id|ipoib_get_sb
c_func
(paren
r_struct
id|file_system_type
op_star
id|fs_type
comma
r_int
id|flags
comma
r_const
r_char
op_star
id|dev_name
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|get_sb_single
c_func
(paren
id|fs_type
comma
id|flags
comma
id|data
comma
id|ipoib_fill_super
)paren
suffix:semicolon
)brace
DECL|function|ipoib_kill_sb
r_static
r_void
id|ipoib_kill_sb
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|down
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
id|ipoib_sb
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ipoib_fs_mutex
)paren
suffix:semicolon
id|kill_litter_super
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
DECL|variable|ipoib_fs_type
r_static
r_struct
id|file_system_type
id|ipoib_fs_type
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;ipoib_debugfs&quot;
comma
dot
id|get_sb
op_assign
id|ipoib_get_sb
comma
dot
id|kill_sb
op_assign
id|ipoib_kill_sb
comma
)brace
suffix:semicolon
DECL|function|ipoib_register_debugfs
r_int
id|ipoib_register_debugfs
c_func
(paren
r_void
)paren
(brace
r_return
id|register_filesystem
c_func
(paren
op_amp
id|ipoib_fs_type
)paren
suffix:semicolon
)brace
DECL|function|ipoib_unregister_debugfs
r_void
id|ipoib_unregister_debugfs
c_func
(paren
r_void
)paren
(brace
id|unregister_filesystem
c_func
(paren
op_amp
id|ipoib_fs_type
)paren
suffix:semicolon
)brace
eof
