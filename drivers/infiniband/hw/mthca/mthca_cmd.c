multiline_comment|/*&n; * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: mthca_cmd.c 1349 2004-12-16 21:09:43Z roland $&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;mthca_dev.h&quot;
macro_line|#include &quot;mthca_config_reg.h&quot;
macro_line|#include &quot;mthca_cmd.h&quot;
macro_line|#include &quot;mthca_memfree.h&quot;
DECL|macro|CMD_POLL_TOKEN
mdefine_line|#define CMD_POLL_TOKEN 0xffff
r_enum
(brace
DECL|enumerator|HCR_IN_PARAM_OFFSET
id|HCR_IN_PARAM_OFFSET
op_assign
l_int|0x00
comma
DECL|enumerator|HCR_IN_MODIFIER_OFFSET
id|HCR_IN_MODIFIER_OFFSET
op_assign
l_int|0x08
comma
DECL|enumerator|HCR_OUT_PARAM_OFFSET
id|HCR_OUT_PARAM_OFFSET
op_assign
l_int|0x0c
comma
DECL|enumerator|HCR_TOKEN_OFFSET
id|HCR_TOKEN_OFFSET
op_assign
l_int|0x14
comma
DECL|enumerator|HCR_STATUS_OFFSET
id|HCR_STATUS_OFFSET
op_assign
l_int|0x18
comma
DECL|enumerator|HCR_OPMOD_SHIFT
id|HCR_OPMOD_SHIFT
op_assign
l_int|12
comma
DECL|enumerator|HCA_E_BIT
id|HCA_E_BIT
op_assign
l_int|22
comma
DECL|enumerator|HCR_GO_BIT
id|HCR_GO_BIT
op_assign
l_int|23
)brace
suffix:semicolon
r_enum
(brace
multiline_comment|/* initialization and general commands */
DECL|enumerator|CMD_SYS_EN
id|CMD_SYS_EN
op_assign
l_int|0x1
comma
DECL|enumerator|CMD_SYS_DIS
id|CMD_SYS_DIS
op_assign
l_int|0x2
comma
DECL|enumerator|CMD_MAP_FA
id|CMD_MAP_FA
op_assign
l_int|0xfff
comma
DECL|enumerator|CMD_UNMAP_FA
id|CMD_UNMAP_FA
op_assign
l_int|0xffe
comma
DECL|enumerator|CMD_RUN_FW
id|CMD_RUN_FW
op_assign
l_int|0xff6
comma
DECL|enumerator|CMD_MOD_STAT_CFG
id|CMD_MOD_STAT_CFG
op_assign
l_int|0x34
comma
DECL|enumerator|CMD_QUERY_DEV_LIM
id|CMD_QUERY_DEV_LIM
op_assign
l_int|0x3
comma
DECL|enumerator|CMD_QUERY_FW
id|CMD_QUERY_FW
op_assign
l_int|0x4
comma
DECL|enumerator|CMD_ENABLE_LAM
id|CMD_ENABLE_LAM
op_assign
l_int|0xff8
comma
DECL|enumerator|CMD_DISABLE_LAM
id|CMD_DISABLE_LAM
op_assign
l_int|0xff7
comma
DECL|enumerator|CMD_QUERY_DDR
id|CMD_QUERY_DDR
op_assign
l_int|0x5
comma
DECL|enumerator|CMD_QUERY_ADAPTER
id|CMD_QUERY_ADAPTER
op_assign
l_int|0x6
comma
DECL|enumerator|CMD_INIT_HCA
id|CMD_INIT_HCA
op_assign
l_int|0x7
comma
DECL|enumerator|CMD_CLOSE_HCA
id|CMD_CLOSE_HCA
op_assign
l_int|0x8
comma
DECL|enumerator|CMD_INIT_IB
id|CMD_INIT_IB
op_assign
l_int|0x9
comma
DECL|enumerator|CMD_CLOSE_IB
id|CMD_CLOSE_IB
op_assign
l_int|0xa
comma
DECL|enumerator|CMD_QUERY_HCA
id|CMD_QUERY_HCA
op_assign
l_int|0xb
comma
DECL|enumerator|CMD_SET_IB
id|CMD_SET_IB
op_assign
l_int|0xc
comma
DECL|enumerator|CMD_ACCESS_DDR
id|CMD_ACCESS_DDR
op_assign
l_int|0x2e
comma
DECL|enumerator|CMD_MAP_ICM
id|CMD_MAP_ICM
op_assign
l_int|0xffa
comma
DECL|enumerator|CMD_UNMAP_ICM
id|CMD_UNMAP_ICM
op_assign
l_int|0xff9
comma
DECL|enumerator|CMD_MAP_ICM_AUX
id|CMD_MAP_ICM_AUX
op_assign
l_int|0xffc
comma
DECL|enumerator|CMD_UNMAP_ICM_AUX
id|CMD_UNMAP_ICM_AUX
op_assign
l_int|0xffb
comma
DECL|enumerator|CMD_SET_ICM_SIZE
id|CMD_SET_ICM_SIZE
op_assign
l_int|0xffd
comma
multiline_comment|/* TPT commands */
DECL|enumerator|CMD_SW2HW_MPT
id|CMD_SW2HW_MPT
op_assign
l_int|0xd
comma
DECL|enumerator|CMD_QUERY_MPT
id|CMD_QUERY_MPT
op_assign
l_int|0xe
comma
DECL|enumerator|CMD_HW2SW_MPT
id|CMD_HW2SW_MPT
op_assign
l_int|0xf
comma
DECL|enumerator|CMD_READ_MTT
id|CMD_READ_MTT
op_assign
l_int|0x10
comma
DECL|enumerator|CMD_WRITE_MTT
id|CMD_WRITE_MTT
op_assign
l_int|0x11
comma
DECL|enumerator|CMD_SYNC_TPT
id|CMD_SYNC_TPT
op_assign
l_int|0x2f
comma
multiline_comment|/* EQ commands */
DECL|enumerator|CMD_MAP_EQ
id|CMD_MAP_EQ
op_assign
l_int|0x12
comma
DECL|enumerator|CMD_SW2HW_EQ
id|CMD_SW2HW_EQ
op_assign
l_int|0x13
comma
DECL|enumerator|CMD_HW2SW_EQ
id|CMD_HW2SW_EQ
op_assign
l_int|0x14
comma
DECL|enumerator|CMD_QUERY_EQ
id|CMD_QUERY_EQ
op_assign
l_int|0x15
comma
multiline_comment|/* CQ commands */
DECL|enumerator|CMD_SW2HW_CQ
id|CMD_SW2HW_CQ
op_assign
l_int|0x16
comma
DECL|enumerator|CMD_HW2SW_CQ
id|CMD_HW2SW_CQ
op_assign
l_int|0x17
comma
DECL|enumerator|CMD_QUERY_CQ
id|CMD_QUERY_CQ
op_assign
l_int|0x18
comma
DECL|enumerator|CMD_RESIZE_CQ
id|CMD_RESIZE_CQ
op_assign
l_int|0x2c
comma
multiline_comment|/* SRQ commands */
DECL|enumerator|CMD_SW2HW_SRQ
id|CMD_SW2HW_SRQ
op_assign
l_int|0x35
comma
DECL|enumerator|CMD_HW2SW_SRQ
id|CMD_HW2SW_SRQ
op_assign
l_int|0x36
comma
DECL|enumerator|CMD_QUERY_SRQ
id|CMD_QUERY_SRQ
op_assign
l_int|0x37
comma
multiline_comment|/* QP/EE commands */
DECL|enumerator|CMD_RST2INIT_QPEE
id|CMD_RST2INIT_QPEE
op_assign
l_int|0x19
comma
DECL|enumerator|CMD_INIT2RTR_QPEE
id|CMD_INIT2RTR_QPEE
op_assign
l_int|0x1a
comma
DECL|enumerator|CMD_RTR2RTS_QPEE
id|CMD_RTR2RTS_QPEE
op_assign
l_int|0x1b
comma
DECL|enumerator|CMD_RTS2RTS_QPEE
id|CMD_RTS2RTS_QPEE
op_assign
l_int|0x1c
comma
DECL|enumerator|CMD_SQERR2RTS_QPEE
id|CMD_SQERR2RTS_QPEE
op_assign
l_int|0x1d
comma
DECL|enumerator|CMD_2ERR_QPEE
id|CMD_2ERR_QPEE
op_assign
l_int|0x1e
comma
DECL|enumerator|CMD_RTS2SQD_QPEE
id|CMD_RTS2SQD_QPEE
op_assign
l_int|0x1f
comma
DECL|enumerator|CMD_SQD2SQD_QPEE
id|CMD_SQD2SQD_QPEE
op_assign
l_int|0x38
comma
DECL|enumerator|CMD_SQD2RTS_QPEE
id|CMD_SQD2RTS_QPEE
op_assign
l_int|0x20
comma
DECL|enumerator|CMD_ERR2RST_QPEE
id|CMD_ERR2RST_QPEE
op_assign
l_int|0x21
comma
DECL|enumerator|CMD_QUERY_QPEE
id|CMD_QUERY_QPEE
op_assign
l_int|0x22
comma
DECL|enumerator|CMD_INIT2INIT_QPEE
id|CMD_INIT2INIT_QPEE
op_assign
l_int|0x2d
comma
DECL|enumerator|CMD_SUSPEND_QPEE
id|CMD_SUSPEND_QPEE
op_assign
l_int|0x32
comma
DECL|enumerator|CMD_UNSUSPEND_QPEE
id|CMD_UNSUSPEND_QPEE
op_assign
l_int|0x33
comma
multiline_comment|/* special QPs and management commands */
DECL|enumerator|CMD_CONF_SPECIAL_QP
id|CMD_CONF_SPECIAL_QP
op_assign
l_int|0x23
comma
DECL|enumerator|CMD_MAD_IFC
id|CMD_MAD_IFC
op_assign
l_int|0x24
comma
multiline_comment|/* multicast commands */
DECL|enumerator|CMD_READ_MGM
id|CMD_READ_MGM
op_assign
l_int|0x25
comma
DECL|enumerator|CMD_WRITE_MGM
id|CMD_WRITE_MGM
op_assign
l_int|0x26
comma
DECL|enumerator|CMD_MGID_HASH
id|CMD_MGID_HASH
op_assign
l_int|0x27
comma
multiline_comment|/* miscellaneous commands */
DECL|enumerator|CMD_DIAG_RPRT
id|CMD_DIAG_RPRT
op_assign
l_int|0x30
comma
DECL|enumerator|CMD_NOP
id|CMD_NOP
op_assign
l_int|0x31
comma
multiline_comment|/* debug commands */
DECL|enumerator|CMD_QUERY_DEBUG_MSG
id|CMD_QUERY_DEBUG_MSG
op_assign
l_int|0x2a
comma
DECL|enumerator|CMD_SET_DEBUG_MSG
id|CMD_SET_DEBUG_MSG
op_assign
l_int|0x2b
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * According to Mellanox code, FW may be starved and never complete&n; * commands.  So we can&squot;t use strict timeouts described in PRM -- we&n; * just arbitrarily select 60 seconds for now.&n; */
macro_line|#if 0
multiline_comment|/*&n; * Round up and add 1 to make sure we get the full wait time (since we&n; * will be starting in the middle of a jiffy)&n; */
r_enum
(brace
id|CMD_TIME_CLASS_A
op_assign
(paren
id|HZ
op_plus
l_int|999
)paren
op_div
l_int|1000
op_plus
l_int|1
comma
id|CMD_TIME_CLASS_B
op_assign
(paren
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
op_plus
l_int|1
comma
id|CMD_TIME_CLASS_C
op_assign
(paren
id|HZ
op_plus
l_int|9
)paren
op_div
l_int|10
op_plus
l_int|1
)brace
suffix:semicolon
macro_line|#else
r_enum
(brace
DECL|enumerator|CMD_TIME_CLASS_A
id|CMD_TIME_CLASS_A
op_assign
l_int|60
op_star
id|HZ
comma
DECL|enumerator|CMD_TIME_CLASS_B
id|CMD_TIME_CLASS_B
op_assign
l_int|60
op_star
id|HZ
comma
DECL|enumerator|CMD_TIME_CLASS_C
id|CMD_TIME_CLASS_C
op_assign
l_int|60
op_star
id|HZ
)brace
suffix:semicolon
macro_line|#endif
r_enum
(brace
DECL|enumerator|GO_BIT_TIMEOUT
id|GO_BIT_TIMEOUT
op_assign
id|HZ
op_star
l_int|10
)brace
suffix:semicolon
DECL|struct|mthca_cmd_context
r_struct
id|mthca_cmd_context
(brace
DECL|member|done
r_struct
id|completion
id|done
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|result
r_int
id|result
suffix:semicolon
DECL|member|next
r_int
id|next
suffix:semicolon
DECL|member|out_param
id|u64
id|out_param
suffix:semicolon
DECL|member|token
id|u16
id|token
suffix:semicolon
DECL|member|status
id|u8
id|status
suffix:semicolon
)brace
suffix:semicolon
DECL|function|go_bit
r_static
r_inline
r_int
id|go_bit
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_return
id|readl
c_func
(paren
id|dev-&gt;hcr
op_plus
id|HCR_STATUS_OFFSET
)paren
op_amp
id|swab32
c_func
(paren
l_int|1
op_lshift
id|HCR_GO_BIT
)paren
suffix:semicolon
)brace
DECL|function|mthca_cmd_post
r_static
r_int
id|mthca_cmd_post
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u64
id|out_param
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
id|u16
id|token
comma
r_int
id|event
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;cmd.hcr_sem
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
r_if
c_cond
(paren
id|event
)paren
(brace
r_int
r_int
id|end
op_assign
id|jiffies
op_plus
id|GO_BIT_TIMEOUT
suffix:semicolon
r_while
c_loop
(paren
id|go_bit
c_func
(paren
id|dev
)paren
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|end
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|go_bit
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We use writel (instead of something like memcpy_toio)&n;&t; * because writes of less than 32 bits to the HCR don&squot;t work&n;&t; * (and some architectures such as ia64 implement memcpy_toio&n;&t; * in terms of writeb).&n;&t; */
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|in_param
op_rshift
l_int|32
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|0
op_star
l_int|4
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|in_param
op_amp
l_int|0xfffffffful
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|1
op_star
l_int|4
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|in_modifier
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|2
op_star
l_int|4
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|out_param
op_rshift
l_int|32
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|3
op_star
l_int|4
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|out_param
op_amp
l_int|0xfffffffful
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|4
op_star
l_int|4
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
id|token
op_lshift
l_int|16
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|5
op_star
l_int|4
)paren
suffix:semicolon
multiline_comment|/* __raw_writel may not order writes. */
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|cpu_to_be32
c_func
(paren
(paren
l_int|1
op_lshift
id|HCR_GO_BIT
)paren
op_or
(paren
id|event
ques
c_cond
(paren
l_int|1
op_lshift
id|HCA_E_BIT
)paren
suffix:colon
l_int|0
)paren
op_or
(paren
id|op_modifier
op_lshift
id|HCR_OPMOD_SHIFT
)paren
op_or
id|op
)paren
comma
id|dev-&gt;hcr
op_plus
l_int|6
op_star
l_int|4
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|dev-&gt;cmd.hcr_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_cmd_poll
r_static
r_int
id|mthca_cmd_poll
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u64
op_star
id|out_param
comma
r_int
id|out_is_imm
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
r_int
r_int
id|timeout
comma
id|u8
op_star
id|status
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;cmd.poll_sem
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
id|err
op_assign
id|mthca_cmd_post
c_func
(paren
id|dev
comma
id|in_param
comma
id|out_param
ques
c_cond
op_star
id|out_param
suffix:colon
l_int|0
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|CMD_POLL_TOKEN
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|end
op_assign
id|timeout
op_plus
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|go_bit
c_func
(paren
id|dev
)paren
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|end
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|go_bit
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|out_is_imm
)paren
(brace
id|memcpy_fromio
c_func
(paren
id|out_param
comma
id|dev-&gt;hcr
op_plus
id|HCR_OUT_PARAM_OFFSET
comma
r_sizeof
(paren
id|u64
)paren
)paren
suffix:semicolon
id|be64_to_cpus
c_func
(paren
id|out_param
)paren
suffix:semicolon
)brace
op_star
id|status
op_assign
id|be32_to_cpu
c_func
(paren
id|__raw_readl
c_func
(paren
id|dev-&gt;hcr
op_plus
id|HCR_STATUS_OFFSET
)paren
)paren
op_rshift
l_int|24
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|dev-&gt;cmd.poll_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_cmd_event
r_void
id|mthca_cmd_event
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u16
id|token
comma
id|u8
id|status
comma
id|u64
id|out_param
)paren
(brace
r_struct
id|mthca_cmd_context
op_star
id|context
op_assign
op_amp
id|dev-&gt;cmd.context
(braket
id|token
op_amp
id|dev-&gt;cmd.token_mask
)braket
suffix:semicolon
multiline_comment|/* previously timed out command completing at long last */
r_if
c_cond
(paren
id|token
op_ne
id|context-&gt;token
)paren
r_return
suffix:semicolon
id|context-&gt;result
op_assign
l_int|0
suffix:semicolon
id|context-&gt;status
op_assign
id|status
suffix:semicolon
id|context-&gt;out_param
op_assign
id|out_param
suffix:semicolon
id|context-&gt;token
op_add_assign
id|dev-&gt;cmd.token_mask
op_plus
l_int|1
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|context-&gt;done
)paren
suffix:semicolon
)brace
DECL|function|event_timeout
r_static
r_void
id|event_timeout
c_func
(paren
r_int
r_int
id|context_ptr
)paren
(brace
r_struct
id|mthca_cmd_context
op_star
id|context
op_assign
(paren
r_struct
id|mthca_cmd_context
op_star
)paren
id|context_ptr
suffix:semicolon
id|context-&gt;result
op_assign
op_minus
id|EBUSY
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|context-&gt;done
)paren
suffix:semicolon
)brace
DECL|function|mthca_cmd_wait
r_static
r_int
id|mthca_cmd_wait
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u64
op_star
id|out_param
comma
r_int
id|out_is_imm
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
r_int
r_int
id|timeout
comma
id|u8
op_star
id|status
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_struct
id|mthca_cmd_context
op_star
id|context
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dev-&gt;cmd.event_sem
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;cmd.context_lock
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|dev-&gt;cmd.free_head
OL
l_int|0
)paren
suffix:semicolon
id|context
op_assign
op_amp
id|dev-&gt;cmd.context
(braket
id|dev-&gt;cmd.free_head
)braket
suffix:semicolon
id|dev-&gt;cmd.free_head
op_assign
id|context-&gt;next
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;cmd.context_lock
)paren
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|context-&gt;done
)paren
suffix:semicolon
id|err
op_assign
id|mthca_cmd_post
c_func
(paren
id|dev
comma
id|in_param
comma
id|out_param
ques
c_cond
op_star
id|out_param
suffix:colon
l_int|0
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|context-&gt;token
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|context-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|timeout
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|context-&gt;timer
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|context-&gt;done
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|context-&gt;timer
)paren
suffix:semicolon
id|err
op_assign
id|context-&gt;result
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
op_star
id|status
op_assign
id|context-&gt;status
suffix:semicolon
r_if
c_cond
(paren
op_star
id|status
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Command %02x completed with status %02x&bslash;n&quot;
comma
id|op
comma
op_star
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out_is_imm
)paren
op_star
id|out_param
op_assign
id|context-&gt;out_param
suffix:semicolon
id|out
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;cmd.context_lock
)paren
suffix:semicolon
id|context-&gt;next
op_assign
id|dev-&gt;cmd.free_head
suffix:semicolon
id|dev-&gt;cmd.free_head
op_assign
id|context
op_minus
id|dev-&gt;cmd.context
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;cmd.context_lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;cmd.event_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Invoke a command with an output mailbox */
DECL|function|mthca_cmd_box
r_static
r_int
id|mthca_cmd_box
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u64
id|out_param
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
r_int
r_int
id|timeout
comma
id|u8
op_star
id|status
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;cmd.use_events
)paren
r_return
id|mthca_cmd_wait
c_func
(paren
id|dev
comma
id|in_param
comma
op_amp
id|out_param
comma
l_int|0
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|timeout
comma
id|status
)paren
suffix:semicolon
r_else
r_return
id|mthca_cmd_poll
c_func
(paren
id|dev
comma
id|in_param
comma
op_amp
id|out_param
comma
l_int|0
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|timeout
comma
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Invoke a command with no output parameter */
DECL|function|mthca_cmd
r_static
r_int
id|mthca_cmd
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
r_int
r_int
id|timeout
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd_box
c_func
(paren
id|dev
comma
id|in_param
comma
l_int|0
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|timeout
comma
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Invoke a command with an immediate output parameter (and copy the&n; * output into the caller&squot;s out_param pointer after the command&n; * executes).&n; */
DECL|function|mthca_cmd_imm
r_static
r_int
id|mthca_cmd_imm
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|in_param
comma
id|u64
op_star
id|out_param
comma
id|u32
id|in_modifier
comma
id|u8
id|op_modifier
comma
id|u16
id|op
comma
r_int
r_int
id|timeout
comma
id|u8
op_star
id|status
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;cmd.use_events
)paren
r_return
id|mthca_cmd_wait
c_func
(paren
id|dev
comma
id|in_param
comma
id|out_param
comma
l_int|1
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|timeout
comma
id|status
)paren
suffix:semicolon
r_else
r_return
id|mthca_cmd_poll
c_func
(paren
id|dev
comma
id|in_param
comma
id|out_param
comma
l_int|1
comma
id|in_modifier
comma
id|op_modifier
comma
id|op
comma
id|timeout
comma
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Switch to using events to issue FW commands (should be called after&n; * event queue to command events has been initialized).&n; */
DECL|function|mthca_cmd_use_events
r_int
id|mthca_cmd_use_events
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|dev-&gt;cmd.context
op_assign
id|kmalloc
c_func
(paren
id|dev-&gt;cmd.max_cmds
op_star
r_sizeof
(paren
r_struct
id|mthca_cmd_context
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;cmd.context
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;cmd.max_cmds
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dev-&gt;cmd.context
(braket
id|i
)braket
dot
id|token
op_assign
id|i
suffix:semicolon
id|dev-&gt;cmd.context
(braket
id|i
)braket
dot
id|next
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dev-&gt;cmd.context
(braket
id|i
)braket
dot
id|timer
)paren
suffix:semicolon
id|dev-&gt;cmd.context
(braket
id|i
)braket
dot
id|timer.data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|dev-&gt;cmd.context
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;cmd.context
(braket
id|i
)braket
dot
id|timer.function
op_assign
id|event_timeout
suffix:semicolon
)brace
id|dev-&gt;cmd.context
(braket
id|dev-&gt;cmd.max_cmds
op_minus
l_int|1
)braket
dot
id|next
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;cmd.free_head
op_assign
l_int|0
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|dev-&gt;cmd.event_sem
comma
id|dev-&gt;cmd.max_cmds
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dev-&gt;cmd.context_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev-&gt;cmd.token_mask
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;cmd.token_mask
OL
id|dev-&gt;cmd.max_cmds
suffix:semicolon
id|dev-&gt;cmd.token_mask
op_lshift_assign
l_int|1
)paren
suffix:semicolon
multiline_comment|/* nothing */
op_decrement
id|dev-&gt;cmd.token_mask
suffix:semicolon
id|dev-&gt;cmd.use_events
op_assign
l_int|1
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dev-&gt;cmd.poll_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Switch back to polling (used when shutting down the device)&n; */
DECL|function|mthca_cmd_use_polling
r_void
id|mthca_cmd_use_polling
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|dev-&gt;cmd.use_events
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;cmd.max_cmds
suffix:semicolon
op_increment
id|i
)paren
id|down
c_func
(paren
op_amp
id|dev-&gt;cmd.event_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;cmd.context
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;cmd.poll_sem
)paren
suffix:semicolon
)brace
DECL|function|mthca_SYS_EN
r_int
id|mthca_SYS_EN
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
id|u64
id|out
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|mthca_cmd_imm
c_func
(paren
id|dev
comma
l_int|0
comma
op_amp
id|out
comma
l_int|0
comma
l_int|0
comma
id|CMD_SYS_EN
comma
id|HZ
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|status
op_eq
id|MTHCA_CMD_STAT_DDR_MEM_ERR
)paren
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;SYS_EN DDR error: syn=%x, sock=%d, &quot;
l_string|&quot;sladdr=%d, SPD source=%s&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|out
op_rshift
l_int|6
)paren
op_amp
l_int|0xf
comma
(paren
r_int
)paren
(paren
id|out
op_rshift
l_int|4
)paren
op_amp
l_int|3
comma
(paren
r_int
)paren
(paren
id|out
op_rshift
l_int|1
)paren
op_amp
l_int|7
comma
(paren
r_int
)paren
id|out
op_amp
l_int|1
ques
c_cond
l_string|&quot;NVMEM&quot;
suffix:colon
l_string|&quot;DIMM&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|mthca_SYS_DIS
r_int
id|mthca_SYS_DIS
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|CMD_SYS_DIS
comma
id|HZ
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_map_cmd
r_static
r_int
id|mthca_map_cmd
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u16
id|op
comma
r_struct
id|mthca_icm
op_star
id|icm
comma
id|u64
id|virt
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|inbox
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_struct
id|mthca_icm_iter
id|iter
suffix:semicolon
r_int
id|lg
suffix:semicolon
r_int
id|nent
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|ts
op_assign
l_int|0
comma
id|tc
op_assign
l_int|0
suffix:semicolon
id|inbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|PAGE_SIZE
comma
op_amp
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|inbox
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mthca_icm_first
c_func
(paren
id|icm
comma
op_amp
id|iter
)paren
suffix:semicolon
op_logical_neg
id|mthca_icm_last
c_func
(paren
op_amp
id|iter
)paren
suffix:semicolon
id|mthca_icm_next
c_func
(paren
op_amp
id|iter
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * We have to pass pages that are aligned to their&n;&t;&t; * size, so find the least significant 1 in the&n;&t;&t; * address or size and use that as our log2 size.&n;&t;&t; */
id|lg
op_assign
id|ffs
c_func
(paren
id|mthca_icm_addr
c_func
(paren
op_amp
id|iter
)paren
op_or
id|mthca_icm_size
c_func
(paren
op_amp
id|iter
)paren
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|lg
OL
l_int|12
)paren
(brace
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;Got FW area not aligned to 4K (%llx/%lx).&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|mthca_icm_addr
c_func
(paren
op_amp
id|iter
)paren
comma
id|mthca_icm_size
c_func
(paren
op_amp
id|iter
)paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mthca_icm_size
c_func
(paren
op_amp
id|iter
)paren
op_div
(paren
l_int|1
op_lshift
id|lg
)paren
suffix:semicolon
op_increment
id|i
comma
op_increment
id|nent
)paren
(brace
r_if
c_cond
(paren
id|virt
op_ne
op_minus
l_int|1
)paren
(brace
op_star
(paren
(paren
id|__be64
op_star
)paren
(paren
id|inbox
op_plus
id|nent
op_star
l_int|4
)paren
)paren
op_assign
id|cpu_to_be64
c_func
(paren
id|virt
)paren
suffix:semicolon
id|virt
op_add_assign
l_int|1
op_lshift
id|lg
suffix:semicolon
)brace
op_star
(paren
(paren
id|__be64
op_star
)paren
(paren
id|inbox
op_plus
id|nent
op_star
l_int|4
op_plus
l_int|2
)paren
)paren
op_assign
id|cpu_to_be64
c_func
(paren
(paren
id|mthca_icm_addr
c_func
(paren
op_amp
id|iter
)paren
op_plus
(paren
id|i
op_lshift
id|lg
)paren
)paren
op_or
(paren
id|lg
op_minus
l_int|12
)paren
)paren
suffix:semicolon
id|ts
op_add_assign
l_int|1
op_lshift
(paren
id|lg
op_minus
l_int|10
)paren
suffix:semicolon
op_increment
id|tc
suffix:semicolon
r_if
c_cond
(paren
id|nent
op_eq
id|PAGE_SIZE
op_div
l_int|16
)paren
(brace
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|nent
comma
l_int|0
comma
id|op
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_or
op_star
id|status
)paren
r_goto
id|out
suffix:semicolon
id|nent
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|nent
)paren
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|nent
comma
l_int|0
comma
id|op
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|op
)paren
(brace
r_case
id|CMD_MAP_FA
suffix:colon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Mapped %d chunks/%d KB for FW.&bslash;n&quot;
comma
id|tc
comma
id|ts
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_MAP_ICM_AUX
suffix:colon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Mapped %d chunks/%d KB for ICM aux.&bslash;n&quot;
comma
id|tc
comma
id|ts
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_MAP_ICM
suffix:colon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Mapped %d chunks/%d KB at %llx for ICM.&bslash;n&quot;
comma
id|tc
comma
id|ts
comma
(paren
r_int
r_int
r_int
)paren
id|virt
op_minus
(paren
id|ts
op_lshift
l_int|10
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|PAGE_SIZE
comma
id|inbox
comma
id|indma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_MAP_FA
r_int
id|mthca_MAP_FA
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_icm
op_star
id|icm
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_map_cmd
c_func
(paren
id|dev
comma
id|CMD_MAP_FA
comma
id|icm
comma
op_minus
l_int|1
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_UNMAP_FA
r_int
id|mthca_UNMAP_FA
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|CMD_UNMAP_FA
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_RUN_FW
r_int
id|mthca_RUN_FW
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|CMD_RUN_FW
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_QUERY_FW
r_int
id|mthca_QUERY_FW
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|outbox
suffix:semicolon
id|dma_addr_t
id|outdma
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u8
id|lg
suffix:semicolon
DECL|macro|QUERY_FW_OUT_SIZE
mdefine_line|#define QUERY_FW_OUT_SIZE             0x100
DECL|macro|QUERY_FW_VER_OFFSET
mdefine_line|#define QUERY_FW_VER_OFFSET            0x00
DECL|macro|QUERY_FW_MAX_CMD_OFFSET
mdefine_line|#define QUERY_FW_MAX_CMD_OFFSET        0x0f
DECL|macro|QUERY_FW_ERR_START_OFFSET
mdefine_line|#define QUERY_FW_ERR_START_OFFSET      0x30
DECL|macro|QUERY_FW_ERR_SIZE_OFFSET
mdefine_line|#define QUERY_FW_ERR_SIZE_OFFSET       0x38
DECL|macro|QUERY_FW_START_OFFSET
mdefine_line|#define QUERY_FW_START_OFFSET          0x20
DECL|macro|QUERY_FW_END_OFFSET
mdefine_line|#define QUERY_FW_END_OFFSET            0x28
DECL|macro|QUERY_FW_SIZE_OFFSET
mdefine_line|#define QUERY_FW_SIZE_OFFSET           0x00
DECL|macro|QUERY_FW_CLR_INT_BASE_OFFSET
mdefine_line|#define QUERY_FW_CLR_INT_BASE_OFFSET   0x20
DECL|macro|QUERY_FW_EQ_ARM_BASE_OFFSET
mdefine_line|#define QUERY_FW_EQ_ARM_BASE_OFFSET    0x40
DECL|macro|QUERY_FW_EQ_SET_CI_BASE_OFFSET
mdefine_line|#define QUERY_FW_EQ_SET_CI_BASE_OFFSET 0x48
id|outbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_FW_OUT_SIZE
comma
op_amp
id|outdma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|outbox
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
l_int|0
comma
l_int|0
comma
id|CMD_QUERY_FW
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw_ver
comma
id|outbox
comma
id|QUERY_FW_VER_OFFSET
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * FW subminor version is at more signifant bits than minor&n;&t; * version, so swap here.&n;&t; */
id|dev-&gt;fw_ver
op_assign
(paren
id|dev-&gt;fw_ver
op_amp
l_int|0xffff00000000ull
)paren
op_or
(paren
(paren
id|dev-&gt;fw_ver
op_amp
l_int|0xffff0000ull
)paren
op_rshift
l_int|16
)paren
op_or
(paren
(paren
id|dev-&gt;fw_ver
op_amp
l_int|0x0000ffffull
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|lg
comma
id|outbox
comma
id|QUERY_FW_MAX_CMD_OFFSET
)paren
suffix:semicolon
id|dev-&gt;cmd.max_cmds
op_assign
l_int|1
op_lshift
id|lg
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;FW version %012llx, max commands %d&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw_ver
comma
id|dev-&gt;cmd.max_cmds
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.arbel.fw_pages
comma
id|outbox
comma
id|QUERY_FW_SIZE_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.arbel.clr_int_base
comma
id|outbox
comma
id|QUERY_FW_CLR_INT_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.arbel.eq_arm_base
comma
id|outbox
comma
id|QUERY_FW_EQ_ARM_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.arbel.eq_set_ci_base
comma
id|outbox
comma
id|QUERY_FW_EQ_SET_CI_BASE_OFFSET
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;FW size %d KB&bslash;n&quot;
comma
id|dev-&gt;fw.arbel.fw_pages
op_lshift
l_int|2
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Arbel page size is always 4 KB; round up number of&n;&t;&t; * system pages needed.&n;&t;&t; */
id|dev-&gt;fw.arbel.fw_pages
op_assign
(paren
id|dev-&gt;fw.arbel.fw_pages
op_plus
(paren
l_int|1
op_lshift
(paren
id|PAGE_SHIFT
op_minus
l_int|12
)paren
)paren
op_minus
l_int|1
)paren
op_rshift
(paren
id|PAGE_SHIFT
op_minus
l_int|12
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Clear int @ %llx, EQ arm @ %llx, EQ set CI @ %llx&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw.arbel.clr_int_base
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw.arbel.eq_arm_base
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw.arbel.eq_set_ci_base
)paren
suffix:semicolon
)brace
r_else
(brace
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.tavor.fw_start
comma
id|outbox
comma
id|QUERY_FW_START_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;fw.tavor.fw_end
comma
id|outbox
comma
id|QUERY_FW_END_OFFSET
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;FW size %d KB (start %llx, end %llx)&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
(paren
id|dev-&gt;fw.tavor.fw_end
op_minus
id|dev-&gt;fw.tavor.fw_start
)paren
op_rshift
l_int|10
)paren
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw.tavor.fw_start
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;fw.tavor.fw_end
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_FW_OUT_SIZE
comma
id|outbox
comma
id|outdma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_ENABLE_LAM
r_int
id|mthca_ENABLE_LAM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
id|u8
id|info
suffix:semicolon
id|u32
op_star
id|outbox
suffix:semicolon
id|dma_addr_t
id|outdma
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
DECL|macro|ENABLE_LAM_OUT_SIZE
mdefine_line|#define ENABLE_LAM_OUT_SIZE         0x100
DECL|macro|ENABLE_LAM_START_OFFSET
mdefine_line|#define ENABLE_LAM_START_OFFSET     0x00
DECL|macro|ENABLE_LAM_END_OFFSET
mdefine_line|#define ENABLE_LAM_END_OFFSET       0x08
DECL|macro|ENABLE_LAM_INFO_OFFSET
mdefine_line|#define ENABLE_LAM_INFO_OFFSET      0x13
DECL|macro|ENABLE_LAM_INFO_HIDDEN_FLAG
mdefine_line|#define ENABLE_LAM_INFO_HIDDEN_FLAG (1 &lt;&lt; 4)
DECL|macro|ENABLE_LAM_INFO_ECC_MASK
mdefine_line|#define ENABLE_LAM_INFO_ECC_MASK    0x3
id|outbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|ENABLE_LAM_OUT_SIZE
comma
op_amp
id|outdma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|outbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
l_int|0
comma
l_int|0
comma
id|CMD_ENABLE_LAM
comma
id|CMD_TIME_CLASS_C
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_star
id|status
op_eq
id|MTHCA_CMD_STAT_LAM_NOT_PRE
)paren
r_goto
id|out
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;ddr_start
comma
id|outbox
comma
id|ENABLE_LAM_START_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;ddr_end
comma
id|outbox
comma
id|ENABLE_LAM_END_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|info
comma
id|outbox
comma
id|ENABLE_LAM_INFO_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_logical_neg
(paren
id|info
op_amp
id|ENABLE_LAM_INFO_HIDDEN_FLAG
)paren
op_ne
op_logical_neg
op_logical_neg
(paren
id|dev-&gt;mthca_flags
op_amp
id|MTHCA_FLAG_DDR_HIDDEN
)paren
)paren
(brace
id|mthca_info
c_func
(paren
id|dev
comma
l_string|&quot;FW reports that HCA-attached memory &quot;
l_string|&quot;is %s hidden; does not match PCI config&bslash;n&quot;
comma
(paren
id|info
op_amp
id|ENABLE_LAM_INFO_HIDDEN_FLAG
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info
op_amp
id|ENABLE_LAM_INFO_HIDDEN_FLAG
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;HCA-attached memory is hidden.&bslash;n&quot;
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;HCA memory size %d KB (start %llx, end %llx)&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
(paren
id|dev-&gt;ddr_end
op_minus
id|dev-&gt;ddr_start
)paren
op_rshift
l_int|10
)paren
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;ddr_start
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;ddr_end
)paren
suffix:semicolon
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|ENABLE_LAM_OUT_SIZE
comma
id|outbox
comma
id|outdma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_DISABLE_LAM
r_int
id|mthca_DISABLE_LAM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|CMD_SYS_DIS
comma
id|CMD_TIME_CLASS_C
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_QUERY_DDR
r_int
id|mthca_QUERY_DDR
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
id|u8
id|info
suffix:semicolon
id|u32
op_star
id|outbox
suffix:semicolon
id|dma_addr_t
id|outdma
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
DECL|macro|QUERY_DDR_OUT_SIZE
mdefine_line|#define QUERY_DDR_OUT_SIZE         0x100
DECL|macro|QUERY_DDR_START_OFFSET
mdefine_line|#define QUERY_DDR_START_OFFSET     0x00
DECL|macro|QUERY_DDR_END_OFFSET
mdefine_line|#define QUERY_DDR_END_OFFSET       0x08
DECL|macro|QUERY_DDR_INFO_OFFSET
mdefine_line|#define QUERY_DDR_INFO_OFFSET      0x13
DECL|macro|QUERY_DDR_INFO_HIDDEN_FLAG
mdefine_line|#define QUERY_DDR_INFO_HIDDEN_FLAG (1 &lt;&lt; 4)
DECL|macro|QUERY_DDR_INFO_ECC_MASK
mdefine_line|#define QUERY_DDR_INFO_ECC_MASK    0x3
id|outbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_DDR_OUT_SIZE
comma
op_amp
id|outdma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|outbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
l_int|0
comma
l_int|0
comma
id|CMD_QUERY_DDR
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;ddr_start
comma
id|outbox
comma
id|QUERY_DDR_START_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev-&gt;ddr_end
comma
id|outbox
comma
id|QUERY_DDR_END_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|info
comma
id|outbox
comma
id|QUERY_DDR_INFO_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_logical_neg
(paren
id|info
op_amp
id|QUERY_DDR_INFO_HIDDEN_FLAG
)paren
op_ne
op_logical_neg
op_logical_neg
(paren
id|dev-&gt;mthca_flags
op_amp
id|MTHCA_FLAG_DDR_HIDDEN
)paren
)paren
(brace
id|mthca_info
c_func
(paren
id|dev
comma
l_string|&quot;FW reports that HCA-attached memory &quot;
l_string|&quot;is %s hidden; does not match PCI config&bslash;n&quot;
comma
(paren
id|info
op_amp
id|QUERY_DDR_INFO_HIDDEN_FLAG
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info
op_amp
id|QUERY_DDR_INFO_HIDDEN_FLAG
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;HCA-attached memory is hidden.&bslash;n&quot;
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;HCA memory size %d KB (start %llx, end %llx)&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
(paren
id|dev-&gt;ddr_end
op_minus
id|dev-&gt;ddr_start
)paren
op_rshift
l_int|10
)paren
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;ddr_start
comma
(paren
r_int
r_int
r_int
)paren
id|dev-&gt;ddr_end
)paren
suffix:semicolon
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_DDR_OUT_SIZE
comma
id|outbox
comma
id|outdma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_QUERY_DEV_LIM
r_int
id|mthca_QUERY_DEV_LIM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_dev_lim
op_star
id|dev_lim
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|outbox
suffix:semicolon
id|dma_addr_t
id|outdma
suffix:semicolon
id|u8
id|field
suffix:semicolon
id|u16
id|size
suffix:semicolon
r_int
id|err
suffix:semicolon
DECL|macro|QUERY_DEV_LIM_OUT_SIZE
mdefine_line|#define QUERY_DEV_LIM_OUT_SIZE             0x100
DECL|macro|QUERY_DEV_LIM_MAX_SRQ_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_SRQ_SZ_OFFSET     0x10
DECL|macro|QUERY_DEV_LIM_MAX_QP_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_QP_SZ_OFFSET      0x11
DECL|macro|QUERY_DEV_LIM_RSVD_QP_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_QP_OFFSET        0x12
DECL|macro|QUERY_DEV_LIM_MAX_QP_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_QP_OFFSET         0x13
DECL|macro|QUERY_DEV_LIM_RSVD_SRQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_SRQ_OFFSET       0x14
DECL|macro|QUERY_DEV_LIM_MAX_SRQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_SRQ_OFFSET        0x15
DECL|macro|QUERY_DEV_LIM_RSVD_EEC_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_EEC_OFFSET       0x16
DECL|macro|QUERY_DEV_LIM_MAX_EEC_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_EEC_OFFSET        0x17
DECL|macro|QUERY_DEV_LIM_MAX_CQ_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_CQ_SZ_OFFSET      0x19
DECL|macro|QUERY_DEV_LIM_RSVD_CQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_CQ_OFFSET        0x1a
DECL|macro|QUERY_DEV_LIM_MAX_CQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_CQ_OFFSET         0x1b
DECL|macro|QUERY_DEV_LIM_MAX_MPT_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_MPT_OFFSET        0x1d
DECL|macro|QUERY_DEV_LIM_RSVD_EQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_EQ_OFFSET        0x1e
DECL|macro|QUERY_DEV_LIM_MAX_EQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_EQ_OFFSET         0x1f
DECL|macro|QUERY_DEV_LIM_RSVD_MTT_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_MTT_OFFSET       0x20
DECL|macro|QUERY_DEV_LIM_MAX_MRW_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_MRW_SZ_OFFSET     0x21
DECL|macro|QUERY_DEV_LIM_RSVD_MRW_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_MRW_OFFSET       0x22
DECL|macro|QUERY_DEV_LIM_MAX_MTT_SEG_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_MTT_SEG_OFFSET    0x23
DECL|macro|QUERY_DEV_LIM_MAX_AV_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_AV_OFFSET         0x27
DECL|macro|QUERY_DEV_LIM_MAX_REQ_QP_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_REQ_QP_OFFSET     0x29
DECL|macro|QUERY_DEV_LIM_MAX_RES_QP_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_RES_QP_OFFSET     0x2b
DECL|macro|QUERY_DEV_LIM_MAX_RDMA_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_RDMA_OFFSET       0x2f
DECL|macro|QUERY_DEV_LIM_RSZ_SRQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSZ_SRQ_OFFSET        0x33
DECL|macro|QUERY_DEV_LIM_ACK_DELAY_OFFSET
mdefine_line|#define QUERY_DEV_LIM_ACK_DELAY_OFFSET      0x35
DECL|macro|QUERY_DEV_LIM_MTU_WIDTH_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MTU_WIDTH_OFFSET      0x36
DECL|macro|QUERY_DEV_LIM_VL_PORT_OFFSET
mdefine_line|#define QUERY_DEV_LIM_VL_PORT_OFFSET        0x37
DECL|macro|QUERY_DEV_LIM_MAX_GID_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_GID_OFFSET        0x3b
DECL|macro|QUERY_DEV_LIM_MAX_PKEY_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_PKEY_OFFSET       0x3f
DECL|macro|QUERY_DEV_LIM_FLAGS_OFFSET
mdefine_line|#define QUERY_DEV_LIM_FLAGS_OFFSET          0x44
DECL|macro|QUERY_DEV_LIM_RSVD_UAR_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_UAR_OFFSET       0x48
DECL|macro|QUERY_DEV_LIM_UAR_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_UAR_SZ_OFFSET         0x49
DECL|macro|QUERY_DEV_LIM_PAGE_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_PAGE_SZ_OFFSET        0x4b
DECL|macro|QUERY_DEV_LIM_MAX_SG_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_SG_OFFSET         0x51
DECL|macro|QUERY_DEV_LIM_MAX_DESC_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_DESC_SZ_OFFSET    0x52
DECL|macro|QUERY_DEV_LIM_MAX_SG_RQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_SG_RQ_OFFSET      0x55
DECL|macro|QUERY_DEV_LIM_MAX_DESC_SZ_RQ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_DESC_SZ_RQ_OFFSET 0x56
DECL|macro|QUERY_DEV_LIM_MAX_QP_MCG_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_QP_MCG_OFFSET     0x61
DECL|macro|QUERY_DEV_LIM_RSVD_MCG_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_MCG_OFFSET       0x62
DECL|macro|QUERY_DEV_LIM_MAX_MCG_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_MCG_OFFSET        0x63
DECL|macro|QUERY_DEV_LIM_RSVD_PD_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_PD_OFFSET        0x64
DECL|macro|QUERY_DEV_LIM_MAX_PD_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_PD_OFFSET         0x65
DECL|macro|QUERY_DEV_LIM_RSVD_RDD_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_RDD_OFFSET       0x66
DECL|macro|QUERY_DEV_LIM_MAX_RDD_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_RDD_OFFSET        0x67
DECL|macro|QUERY_DEV_LIM_EEC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_EEC_ENTRY_SZ_OFFSET   0x80
DECL|macro|QUERY_DEV_LIM_QPC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_QPC_ENTRY_SZ_OFFSET   0x82
DECL|macro|QUERY_DEV_LIM_EEEC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_EEEC_ENTRY_SZ_OFFSET  0x84
DECL|macro|QUERY_DEV_LIM_EQPC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_EQPC_ENTRY_SZ_OFFSET  0x86
DECL|macro|QUERY_DEV_LIM_EQC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_EQC_ENTRY_SZ_OFFSET   0x88
DECL|macro|QUERY_DEV_LIM_CQC_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_CQC_ENTRY_SZ_OFFSET   0x8a
DECL|macro|QUERY_DEV_LIM_SRQ_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_SRQ_ENTRY_SZ_OFFSET   0x8c
DECL|macro|QUERY_DEV_LIM_UAR_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_UAR_ENTRY_SZ_OFFSET   0x8e
DECL|macro|QUERY_DEV_LIM_MTT_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MTT_ENTRY_SZ_OFFSET   0x90
DECL|macro|QUERY_DEV_LIM_MPT_ENTRY_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MPT_ENTRY_SZ_OFFSET   0x92
DECL|macro|QUERY_DEV_LIM_PBL_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_PBL_SZ_OFFSET         0x96
DECL|macro|QUERY_DEV_LIM_BMME_FLAGS_OFFSET
mdefine_line|#define QUERY_DEV_LIM_BMME_FLAGS_OFFSET     0x97
DECL|macro|QUERY_DEV_LIM_RSVD_LKEY_OFFSET
mdefine_line|#define QUERY_DEV_LIM_RSVD_LKEY_OFFSET      0x98
DECL|macro|QUERY_DEV_LIM_LAMR_OFFSET
mdefine_line|#define QUERY_DEV_LIM_LAMR_OFFSET           0x9f
DECL|macro|QUERY_DEV_LIM_MAX_ICM_SZ_OFFSET
mdefine_line|#define QUERY_DEV_LIM_MAX_ICM_SZ_OFFSET     0xa0
id|outbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_DEV_LIM_OUT_SIZE
comma
op_amp
id|outdma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|outbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
l_int|0
comma
l_int|0
comma
id|CMD_QUERY_DEV_LIM
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_SRQ_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_srq_sz
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_QP_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_qp_sz
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_QP_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_qps
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_QP_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_qps
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_SRQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_srqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_rshift
l_int|4
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_SRQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_srqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_EEC_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_eecs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_EEC_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_eecs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_CQ_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_cq_sz
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_CQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_cqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_CQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_cqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_MPT_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_mpts
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_EQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_eqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_EQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_eqs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x7
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_MTT_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_mtts
op_assign
l_int|1
op_lshift
(paren
id|field
op_rshift
l_int|4
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_MRW_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_mrw_sz
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_MRW_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_mrws
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_MTT_SEG_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_mtt_seg
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_REQ_QP_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_requester_per_qp
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_RES_QP_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_responder_per_qp
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_RDMA_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_rdma_global
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_ACK_DELAY_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;local_ca_ack_delay
op_assign
id|field
op_amp
l_int|0x1f
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MTU_WIDTH_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_mtu
op_assign
id|field
op_rshift
l_int|4
suffix:semicolon
id|dev_lim-&gt;max_port_width
op_assign
id|field
op_amp
l_int|0xf
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_VL_PORT_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_vl
op_assign
id|field
op_rshift
l_int|4
suffix:semicolon
id|dev_lim-&gt;num_ports
op_assign
id|field
op_amp
l_int|0xf
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_GID_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_gids
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_PKEY_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_pkeys
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0xf
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev_lim-&gt;flags
comma
id|outbox
comma
id|QUERY_DEV_LIM_FLAGS_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_UAR_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_uars
op_assign
id|field
op_rshift
l_int|4
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_UAR_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;uar_size
op_assign
l_int|1
op_lshift
(paren
(paren
id|field
op_amp
l_int|0x3f
)paren
op_plus
l_int|20
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_PAGE_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;min_page_sz
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_SG_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_sg
op_assign
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_DESC_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_desc_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_QP_MCG_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_qp_per_mcg
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_MCG_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_mgms
op_assign
id|field
op_amp
l_int|0xf
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_MCG_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_mcgs
op_assign
l_int|1
op_lshift
id|field
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_PD_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_pds
op_assign
id|field
op_rshift
l_int|4
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_PD_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_pds
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_RDD_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;reserved_rdds
op_assign
id|field
op_rshift
l_int|4
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_RDD_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;max_rdds
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_EEC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;eec_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_QPC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;qpc_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_EEEC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;eeec_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_EQPC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;eqpc_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_EQC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;eqc_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_CQC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;cqc_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_SRQ_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;srq_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_UAR_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;uar_scratch_entry_sz
op_assign
id|size
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max QPs: %d, reserved QPs: %d, entry size: %d&bslash;n&quot;
comma
id|dev_lim-&gt;max_qps
comma
id|dev_lim-&gt;reserved_qps
comma
id|dev_lim-&gt;qpc_entry_sz
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max CQs: %d, reserved CQs: %d, entry size: %d&bslash;n&quot;
comma
id|dev_lim-&gt;max_cqs
comma
id|dev_lim-&gt;reserved_cqs
comma
id|dev_lim-&gt;cqc_entry_sz
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max EQs: %d, reserved EQs: %d, entry size: %d&bslash;n&quot;
comma
id|dev_lim-&gt;max_eqs
comma
id|dev_lim-&gt;reserved_eqs
comma
id|dev_lim-&gt;eqc_entry_sz
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;reserved MPTs: %d, reserved MTTs: %d&bslash;n&quot;
comma
id|dev_lim-&gt;reserved_mrws
comma
id|dev_lim-&gt;reserved_mtts
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max PDs: %d, reserved PDs: %d, reserved UARs: %d&bslash;n&quot;
comma
id|dev_lim-&gt;max_pds
comma
id|dev_lim-&gt;reserved_pds
comma
id|dev_lim-&gt;reserved_uars
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max QP/MCG: %d, reserved MGMs: %d&bslash;n&quot;
comma
id|dev_lim-&gt;max_pds
comma
id|dev_lim-&gt;reserved_mgms
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Flags: %08x&bslash;n&quot;
comma
id|dev_lim-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSZ_SRQ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;hca.arbel.resize_srq
op_assign
id|field
op_amp
l_int|1
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_MTT_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;mtt_seg_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|size
comma
id|outbox
comma
id|QUERY_DEV_LIM_MPT_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;mpt_entry_sz
op_assign
id|size
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_PBL_SZ_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;hca.arbel.max_pbl_sz
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev_lim-&gt;hca.arbel.bmme_flags
comma
id|outbox
comma
id|QUERY_DEV_LIM_BMME_FLAGS_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev_lim-&gt;hca.arbel.reserved_lkey
comma
id|outbox
comma
id|QUERY_DEV_LIM_RSVD_LKEY_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_LAMR_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;hca.arbel.lam_required
op_assign
id|field
op_amp
l_int|1
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|dev_lim-&gt;hca.arbel.max_icm_sz
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_ICM_SZ_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_lim-&gt;hca.arbel.bmme_flags
op_amp
l_int|1
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Base MM extensions: yes &quot;
l_string|&quot;(flags %d, max PBL %d, rsvd L_Key %08x)&bslash;n&quot;
comma
id|dev_lim-&gt;hca.arbel.bmme_flags
comma
id|dev_lim-&gt;hca.arbel.max_pbl_sz
comma
id|dev_lim-&gt;hca.arbel.reserved_lkey
)paren
suffix:semicolon
r_else
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Base MM extensions: no&bslash;n&quot;
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Max ICM size %lld MB&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|dev_lim-&gt;hca.arbel.max_icm_sz
op_rshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
id|MTHCA_GET
c_func
(paren
id|field
comma
id|outbox
comma
id|QUERY_DEV_LIM_MAX_AV_OFFSET
)paren
suffix:semicolon
id|dev_lim-&gt;hca.tavor.max_avs
op_assign
l_int|1
op_lshift
(paren
id|field
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|dev_lim-&gt;mtt_seg_sz
op_assign
id|MTHCA_MTT_SEG_SIZE
suffix:semicolon
id|dev_lim-&gt;mpt_entry_sz
op_assign
id|MTHCA_MPT_ENTRY_SIZE
suffix:semicolon
)brace
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_DEV_LIM_OUT_SIZE
comma
id|outbox
comma
id|outdma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_QUERY_ADAPTER
r_int
id|mthca_QUERY_ADAPTER
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_adapter
op_star
id|adapter
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|outbox
suffix:semicolon
id|dma_addr_t
id|outdma
suffix:semicolon
r_int
id|err
suffix:semicolon
DECL|macro|QUERY_ADAPTER_OUT_SIZE
mdefine_line|#define QUERY_ADAPTER_OUT_SIZE             0x100
DECL|macro|QUERY_ADAPTER_VENDOR_ID_OFFSET
mdefine_line|#define QUERY_ADAPTER_VENDOR_ID_OFFSET     0x00
DECL|macro|QUERY_ADAPTER_DEVICE_ID_OFFSET
mdefine_line|#define QUERY_ADAPTER_DEVICE_ID_OFFSET     0x04
DECL|macro|QUERY_ADAPTER_REVISION_ID_OFFSET
mdefine_line|#define QUERY_ADAPTER_REVISION_ID_OFFSET   0x08
DECL|macro|QUERY_ADAPTER_INTA_PIN_OFFSET
mdefine_line|#define QUERY_ADAPTER_INTA_PIN_OFFSET      0x10
id|outbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_ADAPTER_OUT_SIZE
comma
op_amp
id|outdma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|outbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
l_int|0
comma
l_int|0
comma
id|CMD_QUERY_ADAPTER
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|adapter-&gt;vendor_id
comma
id|outbox
comma
id|QUERY_ADAPTER_VENDOR_ID_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|adapter-&gt;device_id
comma
id|outbox
comma
id|QUERY_ADAPTER_DEVICE_ID_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|adapter-&gt;revision_id
comma
id|outbox
comma
id|QUERY_ADAPTER_REVISION_ID_OFFSET
)paren
suffix:semicolon
id|MTHCA_GET
c_func
(paren
id|adapter-&gt;inta_pin
comma
id|outbox
comma
id|QUERY_ADAPTER_INTA_PIN_OFFSET
)paren
suffix:semicolon
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|QUERY_DEV_LIM_OUT_SIZE
comma
id|outbox
comma
id|outdma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_INIT_HCA
r_int
id|mthca_INIT_HCA
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_init_hca_param
op_star
id|param
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|inbox
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
DECL|macro|INIT_HCA_IN_SIZE
mdefine_line|#define INIT_HCA_IN_SIZE             &t; 0x200
DECL|macro|INIT_HCA_FLAGS_OFFSET
mdefine_line|#define INIT_HCA_FLAGS_OFFSET        &t; 0x014
DECL|macro|INIT_HCA_QPC_OFFSET
mdefine_line|#define INIT_HCA_QPC_OFFSET          &t; 0x020
DECL|macro|INIT_HCA_QPC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_QPC_BASE_OFFSET    &t; (INIT_HCA_QPC_OFFSET + 0x10)
DECL|macro|INIT_HCA_LOG_QP_OFFSET
mdefine_line|#define  INIT_HCA_LOG_QP_OFFSET      &t; (INIT_HCA_QPC_OFFSET + 0x17)
DECL|macro|INIT_HCA_EEC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_EEC_BASE_OFFSET    &t; (INIT_HCA_QPC_OFFSET + 0x20)
DECL|macro|INIT_HCA_LOG_EEC_OFFSET
mdefine_line|#define  INIT_HCA_LOG_EEC_OFFSET     &t; (INIT_HCA_QPC_OFFSET + 0x27)
DECL|macro|INIT_HCA_SRQC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_SRQC_BASE_OFFSET   &t; (INIT_HCA_QPC_OFFSET + 0x28)
DECL|macro|INIT_HCA_LOG_SRQ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_SRQ_OFFSET     &t; (INIT_HCA_QPC_OFFSET + 0x2f)
DECL|macro|INIT_HCA_CQC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_CQC_BASE_OFFSET    &t; (INIT_HCA_QPC_OFFSET + 0x30)
DECL|macro|INIT_HCA_LOG_CQ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_CQ_OFFSET      &t; (INIT_HCA_QPC_OFFSET + 0x37)
DECL|macro|INIT_HCA_EQPC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_EQPC_BASE_OFFSET   &t; (INIT_HCA_QPC_OFFSET + 0x40)
DECL|macro|INIT_HCA_EEEC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_EEEC_BASE_OFFSET   &t; (INIT_HCA_QPC_OFFSET + 0x50)
DECL|macro|INIT_HCA_EQC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_EQC_BASE_OFFSET    &t; (INIT_HCA_QPC_OFFSET + 0x60)
DECL|macro|INIT_HCA_LOG_EQ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_EQ_OFFSET      &t; (INIT_HCA_QPC_OFFSET + 0x67)
DECL|macro|INIT_HCA_RDB_BASE_OFFSET
mdefine_line|#define  INIT_HCA_RDB_BASE_OFFSET    &t; (INIT_HCA_QPC_OFFSET + 0x70)
DECL|macro|INIT_HCA_UDAV_OFFSET
mdefine_line|#define INIT_HCA_UDAV_OFFSET         &t; 0x0b0
DECL|macro|INIT_HCA_UDAV_LKEY_OFFSET
mdefine_line|#define  INIT_HCA_UDAV_LKEY_OFFSET   &t; (INIT_HCA_UDAV_OFFSET + 0x0)
DECL|macro|INIT_HCA_UDAV_PD_OFFSET
mdefine_line|#define  INIT_HCA_UDAV_PD_OFFSET     &t; (INIT_HCA_UDAV_OFFSET + 0x4)
DECL|macro|INIT_HCA_MCAST_OFFSET
mdefine_line|#define INIT_HCA_MCAST_OFFSET        &t; 0x0c0
DECL|macro|INIT_HCA_MC_BASE_OFFSET
mdefine_line|#define  INIT_HCA_MC_BASE_OFFSET         (INIT_HCA_MCAST_OFFSET + 0x00)
DECL|macro|INIT_HCA_LOG_MC_ENTRY_SZ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_MC_ENTRY_SZ_OFFSET (INIT_HCA_MCAST_OFFSET + 0x12)
DECL|macro|INIT_HCA_MC_HASH_SZ_OFFSET
mdefine_line|#define  INIT_HCA_MC_HASH_SZ_OFFSET      (INIT_HCA_MCAST_OFFSET + 0x16)
DECL|macro|INIT_HCA_LOG_MC_TABLE_SZ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_MC_TABLE_SZ_OFFSET (INIT_HCA_MCAST_OFFSET + 0x1b)
DECL|macro|INIT_HCA_TPT_OFFSET
mdefine_line|#define INIT_HCA_TPT_OFFSET              0x0f0
DECL|macro|INIT_HCA_MPT_BASE_OFFSET
mdefine_line|#define  INIT_HCA_MPT_BASE_OFFSET        (INIT_HCA_TPT_OFFSET + 0x00)
DECL|macro|INIT_HCA_MTT_SEG_SZ_OFFSET
mdefine_line|#define  INIT_HCA_MTT_SEG_SZ_OFFSET      (INIT_HCA_TPT_OFFSET + 0x09)
DECL|macro|INIT_HCA_LOG_MPT_SZ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_MPT_SZ_OFFSET      (INIT_HCA_TPT_OFFSET + 0x0b)
DECL|macro|INIT_HCA_MTT_BASE_OFFSET
mdefine_line|#define  INIT_HCA_MTT_BASE_OFFSET        (INIT_HCA_TPT_OFFSET + 0x10)
DECL|macro|INIT_HCA_UAR_OFFSET
mdefine_line|#define INIT_HCA_UAR_OFFSET              0x120
DECL|macro|INIT_HCA_UAR_BASE_OFFSET
mdefine_line|#define  INIT_HCA_UAR_BASE_OFFSET        (INIT_HCA_UAR_OFFSET + 0x00)
DECL|macro|INIT_HCA_UARC_SZ_OFFSET
mdefine_line|#define  INIT_HCA_UARC_SZ_OFFSET         (INIT_HCA_UAR_OFFSET + 0x09)
DECL|macro|INIT_HCA_LOG_UAR_SZ_OFFSET
mdefine_line|#define  INIT_HCA_LOG_UAR_SZ_OFFSET      (INIT_HCA_UAR_OFFSET + 0x0a)
DECL|macro|INIT_HCA_UAR_PAGE_SZ_OFFSET
mdefine_line|#define  INIT_HCA_UAR_PAGE_SZ_OFFSET     (INIT_HCA_UAR_OFFSET + 0x0b)
DECL|macro|INIT_HCA_UAR_SCATCH_BASE_OFFSET
mdefine_line|#define  INIT_HCA_UAR_SCATCH_BASE_OFFSET (INIT_HCA_UAR_OFFSET + 0x10)
DECL|macro|INIT_HCA_UAR_CTX_BASE_OFFSET
mdefine_line|#define  INIT_HCA_UAR_CTX_BASE_OFFSET    (INIT_HCA_UAR_OFFSET + 0x18)
id|inbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|INIT_HCA_IN_SIZE
comma
op_amp
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|inbox
comma
l_int|0
comma
id|INIT_HCA_IN_SIZE
)paren
suffix:semicolon
macro_line|#if defined(__LITTLE_ENDIAN)
op_star
(paren
id|inbox
op_plus
id|INIT_HCA_FLAGS_OFFSET
op_div
l_int|4
)paren
op_and_assign
op_complement
id|cpu_to_be32
c_func
(paren
l_int|1
op_lshift
l_int|1
)paren
suffix:semicolon
macro_line|#elif defined(__BIG_ENDIAN)
op_star
(paren
id|inbox
op_plus
id|INIT_HCA_FLAGS_OFFSET
op_div
l_int|4
)paren
op_or_assign
id|cpu_to_be32
c_func
(paren
l_int|1
op_lshift
l_int|1
)paren
suffix:semicolon
macro_line|#else
macro_line|#error Host endianness not defined
macro_line|#endif
multiline_comment|/* Check port for UD address vector: */
op_star
(paren
id|inbox
op_plus
id|INIT_HCA_FLAGS_OFFSET
op_div
l_int|4
)paren
op_or_assign
id|cpu_to_be32
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* We leave wqe_quota, responder_exu, etc as 0 (default) */
multiline_comment|/* QPC/EEC/CQC/EQC/RDB attributes */
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;qpc_base
comma
id|INIT_HCA_QPC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_num_qps
comma
id|INIT_HCA_LOG_QP_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;eec_base
comma
id|INIT_HCA_EEC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_num_eecs
comma
id|INIT_HCA_LOG_EEC_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;srqc_base
comma
id|INIT_HCA_SRQC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_num_srqs
comma
id|INIT_HCA_LOG_SRQ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;cqc_base
comma
id|INIT_HCA_CQC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_num_cqs
comma
id|INIT_HCA_LOG_CQ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;eqpc_base
comma
id|INIT_HCA_EQPC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;eeec_base
comma
id|INIT_HCA_EEEC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;eqc_base
comma
id|INIT_HCA_EQC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_num_eqs
comma
id|INIT_HCA_LOG_EQ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;rdb_base
comma
id|INIT_HCA_RDB_BASE_OFFSET
)paren
suffix:semicolon
multiline_comment|/* UD AV attributes */
multiline_comment|/* multicast attributes */
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;mc_base
comma
id|INIT_HCA_MC_BASE_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_mc_entry_sz
comma
id|INIT_HCA_LOG_MC_ENTRY_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;mc_hash_sz
comma
id|INIT_HCA_MC_HASH_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_mc_table_sz
comma
id|INIT_HCA_LOG_MC_TABLE_SZ_OFFSET
)paren
suffix:semicolon
multiline_comment|/* TPT attributes */
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;mpt_base
comma
id|INIT_HCA_MPT_BASE_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_ne
id|ARBEL_NATIVE
)paren
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;mtt_seg_sz
comma
id|INIT_HCA_MTT_SEG_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_mpt_sz
comma
id|INIT_HCA_LOG_MPT_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;mtt_base
comma
id|INIT_HCA_MTT_BASE_OFFSET
)paren
suffix:semicolon
multiline_comment|/* UAR attributes */
(brace
id|u8
id|uar_page_sz
op_assign
id|PAGE_SHIFT
op_minus
l_int|12
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|uar_page_sz
comma
id|INIT_HCA_UAR_PAGE_SZ_OFFSET
)paren
suffix:semicolon
)brace
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;uar_scratch_base
comma
id|INIT_HCA_UAR_SCATCH_BASE_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_uarc_sz
comma
id|INIT_HCA_UARC_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;log_uar_sz
comma
id|INIT_HCA_LOG_UAR_SZ_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;uarc_base
comma
id|INIT_HCA_UAR_CTX_BASE_OFFSET
)paren
suffix:semicolon
)brace
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
l_int|0
comma
l_int|0
comma
id|CMD_INIT_HCA
comma
id|HZ
comma
id|status
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|INIT_HCA_IN_SIZE
comma
id|inbox
comma
id|indma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_INIT_IB
r_int
id|mthca_INIT_IB
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_init_ib_param
op_star
id|param
comma
r_int
id|port
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|inbox
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u32
id|flags
suffix:semicolon
DECL|macro|INIT_IB_IN_SIZE
mdefine_line|#define INIT_IB_IN_SIZE          56
DECL|macro|INIT_IB_FLAGS_OFFSET
mdefine_line|#define INIT_IB_FLAGS_OFFSET     0x00
DECL|macro|INIT_IB_FLAG_SIG
mdefine_line|#define INIT_IB_FLAG_SIG         (1 &lt;&lt; 18)
DECL|macro|INIT_IB_FLAG_NG
mdefine_line|#define INIT_IB_FLAG_NG          (1 &lt;&lt; 17)
DECL|macro|INIT_IB_FLAG_G0
mdefine_line|#define INIT_IB_FLAG_G0          (1 &lt;&lt; 16)
DECL|macro|INIT_IB_FLAG_1X
mdefine_line|#define INIT_IB_FLAG_1X          (1 &lt;&lt; 8)
DECL|macro|INIT_IB_FLAG_4X
mdefine_line|#define INIT_IB_FLAG_4X          (1 &lt;&lt; 9)
DECL|macro|INIT_IB_FLAG_12X
mdefine_line|#define INIT_IB_FLAG_12X         (1 &lt;&lt; 11)
DECL|macro|INIT_IB_VL_SHIFT
mdefine_line|#define INIT_IB_VL_SHIFT         4
DECL|macro|INIT_IB_MTU_SHIFT
mdefine_line|#define INIT_IB_MTU_SHIFT        12
DECL|macro|INIT_IB_MAX_GID_OFFSET
mdefine_line|#define INIT_IB_MAX_GID_OFFSET   0x06
DECL|macro|INIT_IB_MAX_PKEY_OFFSET
mdefine_line|#define INIT_IB_MAX_PKEY_OFFSET  0x0a
DECL|macro|INIT_IB_GUID0_OFFSET
mdefine_line|#define INIT_IB_GUID0_OFFSET     0x10
DECL|macro|INIT_IB_NODE_GUID_OFFSET
mdefine_line|#define INIT_IB_NODE_GUID_OFFSET 0x18
DECL|macro|INIT_IB_SI_GUID_OFFSET
mdefine_line|#define INIT_IB_SI_GUID_OFFSET   0x20
id|inbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|INIT_IB_IN_SIZE
comma
op_amp
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|inbox
comma
l_int|0
comma
id|INIT_IB_IN_SIZE
)paren
suffix:semicolon
id|flags
op_assign
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;enable_1x
ques
c_cond
id|INIT_IB_FLAG_1X
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;enable_4x
ques
c_cond
id|INIT_IB_FLAG_4X
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;set_guid0
ques
c_cond
id|INIT_IB_FLAG_G0
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;set_node_guid
ques
c_cond
id|INIT_IB_FLAG_NG
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;set_si_guid
ques
c_cond
id|INIT_IB_FLAG_SIG
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;vl_cap
op_lshift
id|INIT_IB_VL_SHIFT
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;mtu_cap
op_lshift
id|INIT_IB_MTU_SHIFT
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|flags
comma
id|INIT_IB_FLAGS_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;gid_cap
comma
id|INIT_IB_MAX_GID_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;pkey_cap
comma
id|INIT_IB_MAX_PKEY_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;guid0
comma
id|INIT_IB_GUID0_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;node_guid
comma
id|INIT_IB_NODE_GUID_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;si_guid
comma
id|INIT_IB_SI_GUID_OFFSET
)paren
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|port
comma
l_int|0
comma
id|CMD_INIT_IB
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|INIT_HCA_IN_SIZE
comma
id|inbox
comma
id|indma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_CLOSE_IB
r_int
id|mthca_CLOSE_IB
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|port
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|port
comma
l_int|0
comma
id|CMD_CLOSE_IB
comma
id|HZ
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_CLOSE_HCA
r_int
id|mthca_CLOSE_HCA
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|panic
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
id|panic
comma
id|CMD_CLOSE_HCA
comma
id|HZ
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_SET_IB
r_int
id|mthca_SET_IB
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_set_ib_param
op_star
id|param
comma
r_int
id|port
comma
id|u8
op_star
id|status
)paren
(brace
id|u32
op_star
id|inbox
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u32
id|flags
op_assign
l_int|0
suffix:semicolon
DECL|macro|SET_IB_IN_SIZE
mdefine_line|#define SET_IB_IN_SIZE         0x40
DECL|macro|SET_IB_FLAGS_OFFSET
mdefine_line|#define SET_IB_FLAGS_OFFSET    0x00
DECL|macro|SET_IB_FLAG_SIG
mdefine_line|#define SET_IB_FLAG_SIG        (1 &lt;&lt; 18)
DECL|macro|SET_IB_FLAG_RQK
mdefine_line|#define SET_IB_FLAG_RQK        (1 &lt;&lt;  0)
DECL|macro|SET_IB_CAP_MASK_OFFSET
mdefine_line|#define SET_IB_CAP_MASK_OFFSET 0x04
DECL|macro|SET_IB_SI_GUID_OFFSET
mdefine_line|#define SET_IB_SI_GUID_OFFSET  0x08
id|inbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|SET_IB_IN_SIZE
comma
op_amp
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|inbox
comma
l_int|0
comma
id|SET_IB_IN_SIZE
)paren
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;set_si_guid
ques
c_cond
id|SET_IB_FLAG_SIG
suffix:colon
l_int|0
suffix:semicolon
id|flags
op_or_assign
id|param-&gt;reset_qkey_viol
ques
c_cond
id|SET_IB_FLAG_RQK
suffix:colon
l_int|0
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|flags
comma
id|SET_IB_FLAGS_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;cap_mask
comma
id|SET_IB_CAP_MASK_OFFSET
)paren
suffix:semicolon
id|MTHCA_PUT
c_func
(paren
id|inbox
comma
id|param-&gt;si_guid
comma
id|SET_IB_SI_GUID_OFFSET
)paren
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|port
comma
l_int|0
comma
id|CMD_SET_IB
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|INIT_HCA_IN_SIZE
comma
id|inbox
comma
id|indma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_MAP_ICM
r_int
id|mthca_MAP_ICM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_icm
op_star
id|icm
comma
id|u64
id|virt
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_map_cmd
c_func
(paren
id|dev
comma
id|CMD_MAP_ICM
comma
id|icm
comma
id|virt
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_MAP_ICM_page
r_int
id|mthca_MAP_ICM_page
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|dma_addr
comma
id|u64
id|virt
comma
id|u8
op_star
id|status
)paren
(brace
id|u64
op_star
id|inbox
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|inbox
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
l_int|16
comma
op_amp
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|inbox
(braket
l_int|0
)braket
op_assign
id|cpu_to_be64
c_func
(paren
id|virt
)paren
suffix:semicolon
id|inbox
(braket
l_int|1
)braket
op_assign
id|cpu_to_be64
c_func
(paren
id|dma_addr
op_or
(paren
id|PAGE_SHIFT
op_minus
l_int|12
)paren
)paren
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
l_int|1
comma
l_int|0
comma
id|CMD_MAP_ICM
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
l_int|16
comma
id|inbox
comma
id|indma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Mapped page at %llx for ICM.&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|virt
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_UNMAP_ICM
r_int
id|mthca_UNMAP_ICM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|virt
comma
id|u32
id|page_count
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
id|virt
comma
id|page_count
comma
l_int|0
comma
id|CMD_UNMAP_ICM
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_MAP_ICM_AUX
r_int
id|mthca_MAP_ICM_AUX
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_icm
op_star
id|icm
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_map_cmd
c_func
(paren
id|dev
comma
id|CMD_MAP_ICM_AUX
comma
id|icm
comma
op_minus
l_int|1
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_UNMAP_ICM_AUX
r_int
id|mthca_UNMAP_ICM_AUX
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u8
op_star
id|status
)paren
(brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|CMD_UNMAP_ICM_AUX
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_SET_ICM_SIZE
r_int
id|mthca_SET_ICM_SIZE
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|icm_size
comma
id|u64
op_star
id|aux_pages
comma
id|u8
op_star
id|status
)paren
(brace
r_int
id|ret
op_assign
id|mthca_cmd_imm
c_func
(paren
id|dev
comma
id|icm_size
comma
id|aux_pages
comma
l_int|0
comma
l_int|0
comma
id|CMD_SET_ICM_SIZE
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_logical_or
id|status
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/*&n;&t; * Arbel page size is always 4 KB; round up number of system&n;&t; * pages needed.&n;&t; */
op_star
id|aux_pages
op_assign
(paren
op_star
id|aux_pages
op_plus
(paren
l_int|1
op_lshift
(paren
id|PAGE_SHIFT
op_minus
l_int|12
)paren
)paren
op_minus
l_int|1
)paren
op_rshift
(paren
id|PAGE_SHIFT
op_minus
l_int|12
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_SW2HW_MPT
r_int
id|mthca_SW2HW_MPT
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|mpt_entry
comma
r_int
id|mpt_index
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|mpt_entry
comma
id|MTHCA_MPT_ENTRY_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|mpt_index
comma
l_int|0
comma
id|CMD_SW2HW_MPT
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
id|MTHCA_MPT_ENTRY_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_HW2SW_MPT
r_int
id|mthca_HW2SW_MPT
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|mpt_entry
comma
r_int
id|mpt_index
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|outdma
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|mpt_entry
)paren
(brace
id|outdma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|mpt_entry
comma
id|MTHCA_MPT_ENTRY_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|outdma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
id|mpt_index
comma
op_logical_neg
id|mpt_entry
comma
id|CMD_HW2SW_MPT
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpt_entry
)paren
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|outdma
comma
id|MTHCA_MPT_ENTRY_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_WRITE_MTT
r_int
id|mthca_WRITE_MTT
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
op_star
id|mtt_entry
comma
r_int
id|num_mtt
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|mtt_entry
comma
(paren
id|num_mtt
op_plus
l_int|2
)paren
op_star
l_int|8
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|num_mtt
comma
l_int|0
comma
id|CMD_WRITE_MTT
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
(paren
id|num_mtt
op_plus
l_int|2
)paren
op_star
l_int|8
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_MAP_EQ
r_int
id|mthca_MAP_EQ
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u64
id|event_mask
comma
r_int
id|unmap
comma
r_int
id|eq_num
comma
id|u8
op_star
id|status
)paren
(brace
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;%s mask %016llx for eqn %d&bslash;n&quot;
comma
id|unmap
ques
c_cond
l_string|&quot;Clearing&quot;
suffix:colon
l_string|&quot;Setting&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|event_mask
comma
id|eq_num
)paren
suffix:semicolon
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
id|event_mask
comma
(paren
id|unmap
op_lshift
l_int|31
)paren
op_or
id|eq_num
comma
l_int|0
comma
id|CMD_MAP_EQ
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_SW2HW_EQ
r_int
id|mthca_SW2HW_EQ
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|eq_context
comma
r_int
id|eq_num
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|eq_context
comma
id|MTHCA_EQ_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|eq_num
comma
l_int|0
comma
id|CMD_SW2HW_EQ
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
id|MTHCA_EQ_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_HW2SW_EQ
r_int
id|mthca_HW2SW_EQ
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|eq_context
comma
r_int
id|eq_num
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|outdma
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|outdma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|eq_context
comma
id|MTHCA_EQ_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|outdma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
id|eq_num
comma
l_int|0
comma
id|CMD_HW2SW_EQ
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|outdma
comma
id|MTHCA_EQ_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_SW2HW_CQ
r_int
id|mthca_SW2HW_CQ
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|cq_context
comma
r_int
id|cq_num
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|cq_context
comma
id|MTHCA_CQ_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|cq_num
comma
l_int|0
comma
id|CMD_SW2HW_CQ
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
id|MTHCA_CQ_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_HW2SW_CQ
r_int
id|mthca_HW2SW_CQ
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|cq_context
comma
r_int
id|cq_num
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|outdma
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|outdma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|cq_context
comma
id|MTHCA_CQ_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|outdma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
id|cq_num
comma
l_int|0
comma
id|CMD_HW2SW_CQ
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|outdma
comma
id|MTHCA_CQ_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_MODIFY_QP
r_int
id|mthca_MODIFY_QP
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|trans
comma
id|u32
id|num
comma
r_int
id|is_ee
comma
r_void
op_star
id|qp_context
comma
id|u32
id|optmask
comma
id|u8
op_star
id|status
)paren
(brace
r_static
r_const
id|u16
id|op
(braket
)braket
op_assign
(brace
(braket
id|MTHCA_TRANS_RST2INIT
)braket
op_assign
id|CMD_RST2INIT_QPEE
comma
(braket
id|MTHCA_TRANS_INIT2INIT
)braket
op_assign
id|CMD_INIT2INIT_QPEE
comma
(braket
id|MTHCA_TRANS_INIT2RTR
)braket
op_assign
id|CMD_INIT2RTR_QPEE
comma
(braket
id|MTHCA_TRANS_RTR2RTS
)braket
op_assign
id|CMD_RTR2RTS_QPEE
comma
(braket
id|MTHCA_TRANS_RTS2RTS
)braket
op_assign
id|CMD_RTS2RTS_QPEE
comma
(braket
id|MTHCA_TRANS_SQERR2RTS
)braket
op_assign
id|CMD_SQERR2RTS_QPEE
comma
(braket
id|MTHCA_TRANS_ANY2ERR
)braket
op_assign
id|CMD_2ERR_QPEE
comma
(braket
id|MTHCA_TRANS_RTS2SQD
)braket
op_assign
id|CMD_RTS2SQD_QPEE
comma
(braket
id|MTHCA_TRANS_SQD2SQD
)braket
op_assign
id|CMD_SQD2SQD_QPEE
comma
(braket
id|MTHCA_TRANS_SQD2RTS
)braket
op_assign
id|CMD_SQD2RTS_QPEE
comma
(braket
id|MTHCA_TRANS_ANY2RST
)braket
op_assign
id|CMD_ERR2RST_QPEE
)brace
suffix:semicolon
id|u8
id|op_mod
op_assign
l_int|0
suffix:semicolon
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|trans
OL
l_int|0
op_logical_or
id|trans
op_ge
id|ARRAY_SIZE
c_func
(paren
id|op
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|trans
op_eq
id|MTHCA_TRANS_ANY2RST
)paren
(brace
id|indma
op_assign
l_int|0
suffix:semicolon
id|op_mod
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* don&squot;t write outbox, any-&gt;reset */
multiline_comment|/* For debugging */
id|qp_context
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
op_amp
id|indma
)paren
suffix:semicolon
id|op_mod
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* write outbox, any-&gt;reset */
)brace
r_else
(brace
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|qp_context
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Dumping QP context:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08x&bslash;n&quot;
comma
id|be32_to_cpup
c_func
(paren
id|qp_context
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x100
op_div
l_int|4
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;[%02x] &quot;
comma
id|i
op_star
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08x&quot;
comma
id|be32_to_cpu
c_func
(paren
(paren
(paren
id|u32
op_star
)paren
id|qp_context
)paren
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|trans
op_eq
id|MTHCA_TRANS_ANY2RST
)paren
(brace
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|indma
comma
(paren
op_logical_neg
op_logical_neg
id|is_ee
op_lshift
l_int|24
)paren
op_or
id|num
comma
id|op_mod
comma
id|op
(braket
id|trans
)braket
comma
id|CMD_TIME_CLASS_C
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Dumping QP context:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08x&bslash;n&quot;
comma
id|be32_to_cpup
c_func
(paren
id|qp_context
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x100
op_div
l_int|4
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;[%02x] &quot;
comma
id|i
op_star
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08x&quot;
comma
id|be32_to_cpu
c_func
(paren
(paren
(paren
id|u32
op_star
)paren
id|qp_context
)paren
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
(paren
op_logical_neg
op_logical_neg
id|is_ee
op_lshift
l_int|24
)paren
op_or
id|num
comma
id|op_mod
comma
id|op
(braket
id|trans
)braket
comma
id|CMD_TIME_CLASS_C
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trans
op_ne
id|MTHCA_TRANS_ANY2RST
)paren
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_else
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
id|qp_context
comma
id|indma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_QUERY_QP
r_int
id|mthca_QUERY_QP
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u32
id|num
comma
r_int
id|is_ee
comma
r_void
op_star
id|qp_context
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|outdma
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|outdma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|qp_context
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|outdma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
(paren
op_logical_neg
op_logical_neg
id|is_ee
op_lshift
l_int|24
)paren
op_or
id|num
comma
l_int|0
comma
id|CMD_QUERY_QPEE
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|outdma
comma
id|MTHCA_QP_CONTEXT_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_CONF_SPECIAL_QP
r_int
id|mthca_CONF_SPECIAL_QP
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|type
comma
id|u32
id|qpn
comma
id|u8
op_star
id|status
)paren
(brace
id|u8
id|op_mod
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IB_QPT_SMI
suffix:colon
id|op_mod
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_QPT_GSI
suffix:colon
id|op_mod
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_QPT_RAW_IPV6
suffix:colon
id|op_mod
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_QPT_RAW_ETY
suffix:colon
id|op_mod
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|mthca_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|qpn
comma
id|op_mod
comma
id|CMD_CONF_SPECIAL_QP
comma
id|CMD_TIME_CLASS_B
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_MAD_IFC
r_int
id|mthca_MAD_IFC
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|ignore_mkey
comma
r_int
id|port
comma
r_void
op_star
id|in_mad
comma
r_void
op_star
id|response_mad
comma
id|u8
op_star
id|status
)paren
(brace
r_void
op_star
id|box
suffix:semicolon
id|dma_addr_t
id|dma
suffix:semicolon
r_int
id|err
suffix:semicolon
DECL|macro|MAD_IFC_BOX_SIZE
mdefine_line|#define MAD_IFC_BOX_SIZE 512
id|box
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|MAD_IFC_BOX_SIZE
comma
op_amp
id|dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|box
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|box
comma
id|in_mad
comma
l_int|256
)paren
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
id|dma
comma
id|dma
op_plus
l_int|256
comma
id|port
comma
op_logical_neg
op_logical_neg
id|ignore_mkey
comma
id|CMD_MAD_IFC
comma
id|CMD_TIME_CLASS_C
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
op_logical_neg
op_star
id|status
)paren
id|memcpy
c_func
(paren
id|response_mad
comma
id|box
op_plus
l_int|256
comma
l_int|256
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|MAD_IFC_BOX_SIZE
comma
id|box
comma
id|dma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_READ_MGM
r_int
id|mthca_READ_MGM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|index
comma
r_void
op_star
id|mgm
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|outdma
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|outdma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|mgm
comma
id|MTHCA_MGM_ENTRY_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|outdma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_box
c_func
(paren
id|dev
comma
l_int|0
comma
id|outdma
comma
id|index
comma
l_int|0
comma
id|CMD_READ_MGM
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|outdma
comma
id|MTHCA_MGM_ENTRY_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_WRITE_MGM
r_int
id|mthca_WRITE_MGM
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|index
comma
r_void
op_star
id|mgm
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|mgm
comma
id|MTHCA_MGM_ENTRY_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd
c_func
(paren
id|dev
comma
id|indma
comma
id|index
comma
l_int|0
comma
id|CMD_WRITE_MGM
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
id|MTHCA_MGM_ENTRY_SIZE
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_MGID_HASH
r_int
id|mthca_MGID_HASH
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_void
op_star
id|gid
comma
id|u16
op_star
id|hash
comma
id|u8
op_star
id|status
)paren
(brace
id|dma_addr_t
id|indma
suffix:semicolon
id|u64
id|imm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|indma
op_assign
id|pci_map_single
c_func
(paren
id|dev-&gt;pdev
comma
id|gid
comma
l_int|16
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_mapping_error
c_func
(paren
id|indma
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_cmd_imm
c_func
(paren
id|dev
comma
id|indma
comma
op_amp
id|imm
comma
l_int|0
comma
l_int|0
comma
id|CMD_MGID_HASH
comma
id|CMD_TIME_CLASS_A
comma
id|status
)paren
suffix:semicolon
op_star
id|hash
op_assign
id|imm
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|dev-&gt;pdev
comma
id|indma
comma
l_int|16
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
eof
