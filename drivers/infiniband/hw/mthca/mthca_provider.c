multiline_comment|/*&n; * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: mthca_provider.c 1397 2004-12-28 05:09:00Z roland $&n; */
macro_line|#include &lt;ib_smi.h&gt;
macro_line|#include &quot;mthca_dev.h&quot;
macro_line|#include &quot;mthca_cmd.h&quot;
DECL|function|mthca_query_device
r_static
r_int
id|mthca_query_device
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
r_struct
id|ib_device_attr
op_star
id|props
)paren
(brace
r_struct
id|ib_smp
op_star
id|in_mad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ib_smp
op_star
id|out_mad
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|u8
id|status
suffix:semicolon
id|in_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|out_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|out_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_mad
op_logical_or
op_logical_neg
id|out_mad
)paren
r_goto
id|out
suffix:semicolon
id|props-&gt;fw_ver
op_assign
id|to_mdev
c_func
(paren
id|ibdev
)paren
op_member_access_from_pointer
id|fw_ver
suffix:semicolon
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_LID_ROUTED
suffix:semicolon
id|in_mad-&gt;class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;attr_id
op_assign
id|IB_SMP_ATTR_NODE_INFO
suffix:semicolon
id|err
op_assign
id|mthca_MAD_IFC
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|NULL
comma
l_int|NULL
comma
id|in_mad
comma
id|out_mad
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|props-&gt;vendor_id
op_assign
id|be32_to_cpup
c_func
(paren
(paren
id|u32
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|36
)paren
)paren
op_amp
l_int|0xffffff
suffix:semicolon
id|props-&gt;vendor_part_id
op_assign
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|30
)paren
)paren
suffix:semicolon
id|props-&gt;hw_ver
op_assign
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|32
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|props-&gt;sys_image_guid
comma
id|out_mad-&gt;data
op_plus
l_int|4
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|props-&gt;node_guid
comma
id|out_mad-&gt;data
op_plus
l_int|12
comma
l_int|8
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|in_mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|out_mad
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_query_port
r_static
r_int
id|mthca_query_port
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
id|u8
id|port
comma
r_struct
id|ib_port_attr
op_star
id|props
)paren
(brace
r_struct
id|ib_smp
op_star
id|in_mad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ib_smp
op_star
id|out_mad
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|u8
id|status
suffix:semicolon
id|in_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|out_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|out_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_mad
op_logical_or
op_logical_neg
id|out_mad
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_LID_ROUTED
suffix:semicolon
id|in_mad-&gt;class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;attr_id
op_assign
id|IB_SMP_ATTR_PORT_INFO
suffix:semicolon
id|in_mad-&gt;attr_mod
op_assign
id|cpu_to_be32
c_func
(paren
id|port
)paren
suffix:semicolon
id|err
op_assign
id|mthca_MAD_IFC
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
l_int|1
comma
l_int|1
comma
id|port
comma
l_int|NULL
comma
l_int|NULL
comma
id|in_mad
comma
id|out_mad
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|props-&gt;lid
op_assign
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|16
)paren
)paren
suffix:semicolon
id|props-&gt;lmc
op_assign
id|out_mad-&gt;data
(braket
l_int|34
)braket
op_amp
l_int|0x7
suffix:semicolon
id|props-&gt;sm_lid
op_assign
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|18
)paren
)paren
suffix:semicolon
id|props-&gt;sm_sl
op_assign
id|out_mad-&gt;data
(braket
l_int|36
)braket
op_amp
l_int|0xf
suffix:semicolon
id|props-&gt;state
op_assign
id|out_mad-&gt;data
(braket
l_int|32
)braket
op_amp
l_int|0xf
suffix:semicolon
id|props-&gt;phys_state
op_assign
id|out_mad-&gt;data
(braket
l_int|33
)braket
op_rshift
l_int|4
suffix:semicolon
id|props-&gt;port_cap_flags
op_assign
id|be32_to_cpup
c_func
(paren
(paren
id|u32
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|20
)paren
)paren
suffix:semicolon
id|props-&gt;gid_tbl_len
op_assign
id|to_mdev
c_func
(paren
id|ibdev
)paren
op_member_access_from_pointer
id|limits.gid_table_len
suffix:semicolon
id|props-&gt;pkey_tbl_len
op_assign
id|to_mdev
c_func
(paren
id|ibdev
)paren
op_member_access_from_pointer
id|limits.pkey_table_len
suffix:semicolon
id|props-&gt;qkey_viol_cntr
op_assign
id|be16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|out_mad-&gt;data
op_plus
l_int|48
)paren
)paren
suffix:semicolon
id|props-&gt;active_width
op_assign
id|out_mad-&gt;data
(braket
l_int|31
)braket
op_amp
l_int|0xf
suffix:semicolon
id|props-&gt;active_speed
op_assign
id|out_mad-&gt;data
(braket
l_int|35
)braket
op_rshift
l_int|4
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|in_mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|out_mad
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_modify_port
r_static
r_int
id|mthca_modify_port
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
id|u8
id|port
comma
r_int
id|port_modify_mask
comma
r_struct
id|ib_port_modify
op_star
id|props
)paren
(brace
r_struct
id|mthca_set_ib_param
id|set_ib
suffix:semicolon
r_struct
id|ib_port_attr
id|attr
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u8
id|status
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|to_mdev
c_func
(paren
id|ibdev
)paren
op_member_access_from_pointer
id|cap_mask_mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|err
op_assign
id|mthca_query_port
c_func
(paren
id|ibdev
comma
id|port
comma
op_amp
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|set_ib.set_si_guid
op_assign
l_int|0
suffix:semicolon
id|set_ib.reset_qkey_viol
op_assign
op_logical_neg
op_logical_neg
(paren
id|port_modify_mask
op_amp
id|IB_PORT_RESET_QKEY_CNTR
)paren
suffix:semicolon
id|set_ib.cap_mask
op_assign
(paren
id|attr.port_cap_flags
op_or
id|props-&gt;set_port_cap_mask
)paren
op_amp
op_complement
id|props-&gt;clr_port_cap_mask
suffix:semicolon
id|err
op_assign
id|mthca_SET_IB
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
op_amp
id|set_ib
comma
id|port
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|to_mdev
c_func
(paren
id|ibdev
)paren
op_member_access_from_pointer
id|cap_mask_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_query_pkey
r_static
r_int
id|mthca_query_pkey
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
id|u8
id|port
comma
id|u16
id|index
comma
id|u16
op_star
id|pkey
)paren
(brace
r_struct
id|ib_smp
op_star
id|in_mad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ib_smp
op_star
id|out_mad
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|u8
id|status
suffix:semicolon
id|in_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|out_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|out_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_mad
op_logical_or
op_logical_neg
id|out_mad
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_LID_ROUTED
suffix:semicolon
id|in_mad-&gt;class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;attr_id
op_assign
id|IB_SMP_ATTR_PKEY_TABLE
suffix:semicolon
id|in_mad-&gt;attr_mod
op_assign
id|cpu_to_be32
c_func
(paren
id|index
op_div
l_int|32
)paren
suffix:semicolon
id|err
op_assign
id|mthca_MAD_IFC
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
l_int|1
comma
l_int|1
comma
id|port
comma
l_int|NULL
comma
l_int|NULL
comma
id|in_mad
comma
id|out_mad
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
op_star
id|pkey
op_assign
id|be16_to_cpu
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|out_mad-&gt;data
)paren
(braket
id|index
op_mod
l_int|32
)braket
)paren
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|in_mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|out_mad
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_query_gid
r_static
r_int
id|mthca_query_gid
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
id|u8
id|port
comma
r_int
id|index
comma
r_union
id|ib_gid
op_star
id|gid
)paren
(brace
r_struct
id|ib_smp
op_star
id|in_mad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ib_smp
op_star
id|out_mad
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|u8
id|status
suffix:semicolon
id|in_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|in_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|out_mad
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|out_mad
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_mad
op_logical_or
op_logical_neg
id|out_mad
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_LID_ROUTED
suffix:semicolon
id|in_mad-&gt;class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;attr_id
op_assign
id|IB_SMP_ATTR_PORT_INFO
suffix:semicolon
id|in_mad-&gt;attr_mod
op_assign
id|cpu_to_be32
c_func
(paren
id|port
)paren
suffix:semicolon
id|err
op_assign
id|mthca_MAD_IFC
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
l_int|1
comma
l_int|1
comma
id|port
comma
l_int|NULL
comma
l_int|NULL
comma
id|in_mad
comma
id|out_mad
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|gid-&gt;raw
comma
id|out_mad-&gt;data
op_plus
l_int|8
comma
l_int|8
)paren
suffix:semicolon
id|memset
c_func
(paren
id|in_mad
comma
l_int|0
comma
r_sizeof
op_star
id|in_mad
)paren
suffix:semicolon
id|in_mad-&gt;base_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;mgmt_class
op_assign
id|IB_MGMT_CLASS_SUBN_LID_ROUTED
suffix:semicolon
id|in_mad-&gt;class_version
op_assign
l_int|1
suffix:semicolon
id|in_mad-&gt;method
op_assign
id|IB_MGMT_METHOD_GET
suffix:semicolon
id|in_mad-&gt;attr_id
op_assign
id|IB_SMP_ATTR_GUID_INFO
suffix:semicolon
id|in_mad-&gt;attr_mod
op_assign
id|cpu_to_be32
c_func
(paren
id|index
op_div
l_int|8
)paren
suffix:semicolon
id|err
op_assign
id|mthca_MAD_IFC
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
l_int|1
comma
l_int|1
comma
id|port
comma
l_int|NULL
comma
l_int|NULL
comma
id|in_mad
comma
id|out_mad
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|gid-&gt;raw
op_plus
l_int|8
comma
id|out_mad-&gt;data
op_plus
(paren
id|index
op_mod
l_int|8
)paren
op_star
l_int|16
comma
l_int|8
)paren
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|in_mad
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|out_mad
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_alloc_pd
r_static
r_struct
id|ib_pd
op_star
id|mthca_alloc_pd
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
)paren
(brace
r_struct
id|mthca_pd
op_star
id|pd
suffix:semicolon
r_int
id|err
suffix:semicolon
id|pd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|pd
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pd
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|err
op_assign
id|mthca_pd_alloc
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
id|pd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|pd
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
op_amp
id|pd-&gt;ibpd
suffix:semicolon
)brace
DECL|function|mthca_dealloc_pd
r_static
r_int
id|mthca_dealloc_pd
c_func
(paren
r_struct
id|ib_pd
op_star
id|pd
)paren
(brace
id|mthca_pd_free
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_ah_create
r_static
r_struct
id|ib_ah
op_star
id|mthca_ah_create
c_func
(paren
r_struct
id|ib_pd
op_star
id|pd
comma
r_struct
id|ib_ah_attr
op_star
id|ah_attr
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|mthca_ah
op_star
id|ah
suffix:semicolon
id|ah
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|ah
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ah
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|err
op_assign
id|mthca_create_ah
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
comma
id|ah_attr
comma
id|ah
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|ah
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
op_amp
id|ah-&gt;ibah
suffix:semicolon
)brace
DECL|function|mthca_ah_destroy
r_static
r_int
id|mthca_ah_destroy
c_func
(paren
r_struct
id|ib_ah
op_star
id|ah
)paren
(brace
id|mthca_destroy_ah
c_func
(paren
id|to_mdev
c_func
(paren
id|ah-&gt;device
)paren
comma
id|to_mah
c_func
(paren
id|ah
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ah
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_create_qp
r_static
r_struct
id|ib_qp
op_star
id|mthca_create_qp
c_func
(paren
r_struct
id|ib_pd
op_star
id|pd
comma
r_struct
id|ib_qp_init_attr
op_star
id|init_attr
)paren
(brace
r_struct
id|mthca_qp
op_star
id|qp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|init_attr-&gt;qp_type
)paren
(brace
r_case
id|IB_QPT_RC
suffix:colon
r_case
id|IB_QPT_UC
suffix:colon
r_case
id|IB_QPT_UD
suffix:colon
(brace
id|qp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|qp
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|qp-&gt;sq.max
op_assign
id|init_attr-&gt;cap.max_send_wr
suffix:semicolon
id|qp-&gt;rq.max
op_assign
id|init_attr-&gt;cap.max_recv_wr
suffix:semicolon
id|qp-&gt;sq.max_gs
op_assign
id|init_attr-&gt;cap.max_send_sge
suffix:semicolon
id|qp-&gt;rq.max_gs
op_assign
id|init_attr-&gt;cap.max_recv_sge
suffix:semicolon
id|err
op_assign
id|mthca_alloc_qp
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
comma
id|to_mcq
c_func
(paren
id|init_attr-&gt;send_cq
)paren
comma
id|to_mcq
c_func
(paren
id|init_attr-&gt;recv_cq
)paren
comma
id|init_attr-&gt;qp_type
comma
id|init_attr-&gt;sq_sig_type
comma
id|qp
)paren
suffix:semicolon
id|qp-&gt;ibqp.qp_num
op_assign
id|qp-&gt;qpn
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|IB_QPT_SMI
suffix:colon
r_case
id|IB_QPT_GSI
suffix:colon
(brace
id|qp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mthca_sqp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|qp-&gt;sq.max
op_assign
id|init_attr-&gt;cap.max_send_wr
suffix:semicolon
id|qp-&gt;rq.max
op_assign
id|init_attr-&gt;cap.max_recv_wr
suffix:semicolon
id|qp-&gt;sq.max_gs
op_assign
id|init_attr-&gt;cap.max_send_sge
suffix:semicolon
id|qp-&gt;rq.max_gs
op_assign
id|init_attr-&gt;cap.max_recv_sge
suffix:semicolon
id|qp-&gt;ibqp.qp_num
op_assign
id|init_attr-&gt;qp_type
op_eq
id|IB_QPT_SMI
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|err
op_assign
id|mthca_alloc_sqp
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
comma
id|to_mcq
c_func
(paren
id|init_attr-&gt;send_cq
)paren
comma
id|to_mcq
c_func
(paren
id|init_attr-&gt;recv_cq
)paren
comma
id|init_attr-&gt;sq_sig_type
comma
id|qp-&gt;ibqp.qp_num
comma
id|init_attr-&gt;port_num
comma
id|to_msqp
c_func
(paren
id|qp
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/* Don&squot;t support raw QPs */
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOSYS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|qp
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
id|init_attr-&gt;cap.max_inline_data
op_assign
l_int|0
suffix:semicolon
r_return
op_amp
id|qp-&gt;ibqp
suffix:semicolon
)brace
DECL|function|mthca_destroy_qp
r_static
r_int
id|mthca_destroy_qp
c_func
(paren
r_struct
id|ib_qp
op_star
id|qp
)paren
(brace
id|mthca_free_qp
c_func
(paren
id|to_mdev
c_func
(paren
id|qp-&gt;device
)paren
comma
id|to_mqp
c_func
(paren
id|qp
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|qp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_create_cq
r_static
r_struct
id|ib_cq
op_star
id|mthca_create_cq
c_func
(paren
r_struct
id|ib_device
op_star
id|ibdev
comma
r_int
id|entries
)paren
(brace
r_struct
id|mthca_cq
op_star
id|cq
suffix:semicolon
r_int
id|nent
suffix:semicolon
r_int
id|err
suffix:semicolon
id|cq
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|cq
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cq
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nent
op_assign
l_int|1
suffix:semicolon
id|nent
op_le
id|entries
suffix:semicolon
id|nent
op_lshift_assign
l_int|1
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|err
op_assign
id|mthca_init_cq
c_func
(paren
id|to_mdev
c_func
(paren
id|ibdev
)paren
comma
id|nent
comma
id|cq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|cq
)paren
suffix:semicolon
id|cq
op_assign
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
op_amp
id|cq-&gt;ibcq
suffix:semicolon
)brace
DECL|function|mthca_destroy_cq
r_static
r_int
id|mthca_destroy_cq
c_func
(paren
r_struct
id|ib_cq
op_star
id|cq
)paren
(brace
id|mthca_free_cq
c_func
(paren
id|to_mdev
c_func
(paren
id|cq-&gt;device
)paren
comma
id|to_mcq
c_func
(paren
id|cq
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|convert_access
r_static
r_inline
id|u32
id|convert_access
c_func
(paren
r_int
id|acc
)paren
(brace
r_return
(paren
id|acc
op_amp
id|IB_ACCESS_REMOTE_ATOMIC
ques
c_cond
id|MTHCA_MPT_FLAG_ATOMIC
suffix:colon
l_int|0
)paren
op_or
(paren
id|acc
op_amp
id|IB_ACCESS_REMOTE_WRITE
ques
c_cond
id|MTHCA_MPT_FLAG_REMOTE_WRITE
suffix:colon
l_int|0
)paren
op_or
(paren
id|acc
op_amp
id|IB_ACCESS_REMOTE_READ
ques
c_cond
id|MTHCA_MPT_FLAG_REMOTE_READ
suffix:colon
l_int|0
)paren
op_or
(paren
id|acc
op_amp
id|IB_ACCESS_LOCAL_WRITE
ques
c_cond
id|MTHCA_MPT_FLAG_LOCAL_WRITE
suffix:colon
l_int|0
)paren
op_or
id|MTHCA_MPT_FLAG_LOCAL_READ
suffix:semicolon
)brace
DECL|function|mthca_get_dma_mr
r_static
r_struct
id|ib_mr
op_star
id|mthca_get_dma_mr
c_func
(paren
r_struct
id|ib_pd
op_star
id|pd
comma
r_int
id|acc
)paren
(brace
r_struct
id|mthca_mr
op_star
id|mr
suffix:semicolon
r_int
id|err
suffix:semicolon
id|mr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|mr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mr
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|err
op_assign
id|mthca_mr_alloc_notrans
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
op_member_access_from_pointer
id|pd_num
comma
id|convert_access
c_func
(paren
id|acc
)paren
comma
id|mr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|mr
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
op_amp
id|mr-&gt;ibmr
suffix:semicolon
)brace
DECL|function|mthca_reg_phys_mr
r_static
r_struct
id|ib_mr
op_star
id|mthca_reg_phys_mr
c_func
(paren
r_struct
id|ib_pd
op_star
id|pd
comma
r_struct
id|ib_phys_buf
op_star
id|buffer_list
comma
r_int
id|num_phys_buf
comma
r_int
id|acc
comma
id|u64
op_star
id|iova_start
)paren
(brace
r_struct
id|mthca_mr
op_star
id|mr
suffix:semicolon
id|u64
op_star
id|page_list
suffix:semicolon
id|u64
id|total_size
suffix:semicolon
id|u64
id|mask
suffix:semicolon
r_int
id|shift
suffix:semicolon
r_int
id|npages
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
multiline_comment|/* First check that we have enough alignment */
r_if
c_cond
(paren
(paren
op_star
id|iova_start
op_amp
op_complement
id|PAGE_MASK
)paren
op_ne
(paren
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
op_amp
op_complement
id|PAGE_MASK
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_phys_buf
OG
l_int|1
op_logical_and
(paren
(paren
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
op_plus
id|buffer_list
(braket
l_int|0
)braket
dot
id|size
)paren
op_amp
op_complement
id|PAGE_MASK
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|mask
op_assign
l_int|0
suffix:semicolon
id|total_size
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_phys_buf
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|buffer_list
(braket
id|i
)braket
dot
id|addr
op_amp
op_complement
id|PAGE_MASK
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
l_int|0
op_logical_and
id|i
op_ne
id|num_phys_buf
op_minus
l_int|1
op_logical_and
(paren
id|buffer_list
(braket
id|i
)braket
dot
id|size
op_amp
op_complement
id|PAGE_MASK
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|total_size
op_add_assign
id|buffer_list
(braket
id|i
)braket
dot
id|size
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|mask
op_or_assign
id|buffer_list
(braket
id|i
)braket
dot
id|addr
suffix:semicolon
)brace
multiline_comment|/* Find largest page shift we can use to cover buffers */
r_for
c_loop
(paren
id|shift
op_assign
id|PAGE_SHIFT
suffix:semicolon
id|shift
OL
l_int|31
suffix:semicolon
op_increment
id|shift
)paren
r_if
c_cond
(paren
id|num_phys_buf
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1ULL
op_lshift
id|shift
)paren
op_amp
id|mask
)paren
r_break
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
l_int|1ULL
op_lshift
id|shift
op_ge
id|buffer_list
(braket
l_int|0
)braket
dot
id|size
op_plus
(paren
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
op_amp
(paren
(paren
l_int|1ULL
op_lshift
id|shift
)paren
op_minus
l_int|1
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
id|buffer_list
(braket
l_int|0
)braket
dot
id|size
op_add_assign
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
op_amp
(paren
(paren
l_int|1ULL
op_lshift
id|shift
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
op_and_assign
op_complement
l_int|0ull
op_lshift
id|shift
suffix:semicolon
id|mr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|mr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mr
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|npages
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_phys_buf
suffix:semicolon
op_increment
id|i
)paren
id|npages
op_add_assign
(paren
id|buffer_list
(braket
id|i
)braket
dot
id|size
op_plus
(paren
l_int|1ULL
op_lshift
id|shift
)paren
op_minus
l_int|1
)paren
op_rshift
id|shift
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|npages
)paren
r_return
op_amp
id|mr-&gt;ibmr
suffix:semicolon
id|page_list
op_assign
id|kmalloc
c_func
(paren
id|npages
op_star
r_sizeof
op_star
id|page_list
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page_list
)paren
(brace
id|kfree
c_func
(paren
id|mr
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
id|n
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_phys_buf
suffix:semicolon
op_increment
id|i
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|buffer_list
(braket
id|i
)braket
dot
id|size
op_plus
(paren
l_int|1ULL
op_lshift
id|shift
)paren
op_minus
l_int|1
)paren
op_rshift
id|shift
suffix:semicolon
op_increment
id|j
)paren
id|page_list
(braket
id|n
op_increment
)braket
op_assign
id|buffer_list
(braket
id|i
)braket
dot
id|addr
op_plus
(paren
(paren
id|u64
)paren
id|j
op_lshift
id|shift
)paren
suffix:semicolon
id|mthca_dbg
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
l_string|&quot;Registering memory at %llx (iova %llx) &quot;
l_string|&quot;in PD %x; shift %d, npages %d.&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|buffer_list
(braket
l_int|0
)braket
dot
id|addr
comma
(paren
r_int
r_int
r_int
)paren
op_star
id|iova_start
comma
id|to_mpd
c_func
(paren
id|pd
)paren
op_member_access_from_pointer
id|pd_num
comma
id|shift
comma
id|npages
)paren
suffix:semicolon
id|err
op_assign
id|mthca_mr_alloc_phys
c_func
(paren
id|to_mdev
c_func
(paren
id|pd-&gt;device
)paren
comma
id|to_mpd
c_func
(paren
id|pd
)paren
op_member_access_from_pointer
id|pd_num
comma
id|page_list
comma
id|shift
comma
id|npages
comma
op_star
id|iova_start
comma
id|total_size
comma
id|convert_access
c_func
(paren
id|acc
)paren
comma
id|mr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|mr
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|page_list
)paren
suffix:semicolon
r_return
op_amp
id|mr-&gt;ibmr
suffix:semicolon
)brace
DECL|function|mthca_dereg_mr
r_static
r_int
id|mthca_dereg_mr
c_func
(paren
r_struct
id|ib_mr
op_star
id|mr
)paren
(brace
id|mthca_free_mr
c_func
(paren
id|to_mdev
c_func
(paren
id|mr-&gt;device
)paren
comma
id|to_mmr
c_func
(paren
id|mr
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|show_rev
r_static
id|ssize_t
id|show_rev
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|mthca_dev
comma
id|ib_dev.class_dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%x&bslash;n&quot;
comma
id|dev-&gt;rev_id
)paren
suffix:semicolon
)brace
DECL|function|show_fw_ver
r_static
id|ssize_t
id|show_fw_ver
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|mthca_dev
comma
id|ib_dev.class_dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%x.%x.%x&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|dev-&gt;fw_ver
op_rshift
l_int|32
)paren
comma
(paren
r_int
)paren
(paren
id|dev-&gt;fw_ver
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
(paren
r_int
)paren
id|dev-&gt;fw_ver
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
DECL|function|show_hca
r_static
id|ssize_t
id|show_hca
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|container_of
c_func
(paren
id|cdev
comma
r_struct
id|mthca_dev
comma
id|ib_dev.class_dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;hca_type
)paren
(brace
r_case
id|TAVOR
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;MT23108&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|ARBEL_COMPAT
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;MT25208 (MT23108 compat mode)&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|ARBEL_NATIVE
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;MT25208&bslash;n&quot;
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|hw_rev
comma
id|S_IRUGO
comma
id|show_rev
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|fw_ver
comma
id|S_IRUGO
comma
id|show_fw_ver
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|hca_type
comma
id|S_IRUGO
comma
id|show_hca
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|mthca_class_attributes
r_static
r_struct
id|class_device_attribute
op_star
id|mthca_class_attributes
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_hw_rev
comma
op_amp
id|class_device_attr_fw_ver
comma
op_amp
id|class_device_attr_hca_type
)brace
suffix:semicolon
DECL|function|mthca_register_device
r_int
id|mthca_register_device
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|strlcpy
c_func
(paren
id|dev-&gt;ib_dev.name
comma
l_string|&quot;mthca%d&quot;
comma
id|IB_DEVICE_NAME_MAX
)paren
suffix:semicolon
id|dev-&gt;ib_dev.node_type
op_assign
id|IB_NODE_CA
suffix:semicolon
id|dev-&gt;ib_dev.phys_port_cnt
op_assign
id|dev-&gt;limits.num_ports
suffix:semicolon
id|dev-&gt;ib_dev.dma_device
op_assign
op_amp
id|dev-&gt;pdev-&gt;dev
suffix:semicolon
id|dev-&gt;ib_dev.class_dev.dev
op_assign
op_amp
id|dev-&gt;pdev-&gt;dev
suffix:semicolon
id|dev-&gt;ib_dev.query_device
op_assign
id|mthca_query_device
suffix:semicolon
id|dev-&gt;ib_dev.query_port
op_assign
id|mthca_query_port
suffix:semicolon
id|dev-&gt;ib_dev.modify_port
op_assign
id|mthca_modify_port
suffix:semicolon
id|dev-&gt;ib_dev.query_pkey
op_assign
id|mthca_query_pkey
suffix:semicolon
id|dev-&gt;ib_dev.query_gid
op_assign
id|mthca_query_gid
suffix:semicolon
id|dev-&gt;ib_dev.alloc_pd
op_assign
id|mthca_alloc_pd
suffix:semicolon
id|dev-&gt;ib_dev.dealloc_pd
op_assign
id|mthca_dealloc_pd
suffix:semicolon
id|dev-&gt;ib_dev.create_ah
op_assign
id|mthca_ah_create
suffix:semicolon
id|dev-&gt;ib_dev.destroy_ah
op_assign
id|mthca_ah_destroy
suffix:semicolon
id|dev-&gt;ib_dev.create_qp
op_assign
id|mthca_create_qp
suffix:semicolon
id|dev-&gt;ib_dev.modify_qp
op_assign
id|mthca_modify_qp
suffix:semicolon
id|dev-&gt;ib_dev.destroy_qp
op_assign
id|mthca_destroy_qp
suffix:semicolon
id|dev-&gt;ib_dev.post_send
op_assign
id|mthca_post_send
suffix:semicolon
id|dev-&gt;ib_dev.post_recv
op_assign
id|mthca_post_receive
suffix:semicolon
id|dev-&gt;ib_dev.create_cq
op_assign
id|mthca_create_cq
suffix:semicolon
id|dev-&gt;ib_dev.destroy_cq
op_assign
id|mthca_destroy_cq
suffix:semicolon
id|dev-&gt;ib_dev.poll_cq
op_assign
id|mthca_poll_cq
suffix:semicolon
id|dev-&gt;ib_dev.get_dma_mr
op_assign
id|mthca_get_dma_mr
suffix:semicolon
id|dev-&gt;ib_dev.reg_phys_mr
op_assign
id|mthca_reg_phys_mr
suffix:semicolon
id|dev-&gt;ib_dev.dereg_mr
op_assign
id|mthca_dereg_mr
suffix:semicolon
id|dev-&gt;ib_dev.attach_mcast
op_assign
id|mthca_multicast_attach
suffix:semicolon
id|dev-&gt;ib_dev.detach_mcast
op_assign
id|mthca_multicast_detach
suffix:semicolon
id|dev-&gt;ib_dev.process_mad
op_assign
id|mthca_process_mad
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
id|dev-&gt;ib_dev.req_notify_cq
op_assign
id|mthca_arbel_arm_cq
suffix:semicolon
r_else
id|dev-&gt;ib_dev.req_notify_cq
op_assign
id|mthca_tavor_arm_cq
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|dev-&gt;cap_mask_mutex
)paren
suffix:semicolon
id|ret
op_assign
id|ib_register_device
c_func
(paren
op_amp
id|dev-&gt;ib_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|mthca_class_attributes
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ret
op_assign
id|class_device_create_file
c_func
(paren
op_amp
id|dev-&gt;ib_dev.class_dev
comma
id|mthca_class_attributes
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|ib_unregister_device
c_func
(paren
op_amp
id|dev-&gt;ib_dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_unregister_device
r_void
id|mthca_unregister_device
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
id|ib_unregister_device
c_func
(paren
op_amp
id|dev-&gt;ib_dev
)paren
suffix:semicolon
)brace
eof
