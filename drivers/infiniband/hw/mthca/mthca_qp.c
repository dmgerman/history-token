multiline_comment|/*&n; * Copyright (c) 2004 Topspin Communications.  All rights reserved.&n; *&n; * This software is available to you under a choice of one of two&n; * licenses.  You may choose to be licensed under the terms of the GNU&n; * General Public License (GPL) Version 2, available from the file&n; * COPYING in the main directory of this source tree, or the&n; * OpenIB.org BSD license below:&n; *&n; *     Redistribution and use in source and binary forms, with or&n; *     without modification, are permitted provided that the following&n; *     conditions are met:&n; *&n; *      - Redistributions of source code must retain the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer.&n; *&n; *      - Redistributions in binary form must reproduce the above&n; *        copyright notice, this list of conditions and the following&n; *        disclaimer in the documentation and/or other materials&n; *        provided with the distribution.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,&n; * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF&n; * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND&n; * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS&n; * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN&n; * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN&n; * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&n; * SOFTWARE.&n; *&n; * $Id: mthca_qp.c 1355 2004-12-17 15:23:43Z roland $&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;ib_verbs.h&gt;
macro_line|#include &lt;ib_cache.h&gt;
macro_line|#include &lt;ib_pack.h&gt;
macro_line|#include &quot;mthca_dev.h&quot;
macro_line|#include &quot;mthca_cmd.h&quot;
macro_line|#include &quot;mthca_memfree.h&quot;
r_enum
(brace
DECL|enumerator|MTHCA_MAX_DIRECT_QP_SIZE
id|MTHCA_MAX_DIRECT_QP_SIZE
op_assign
l_int|4
op_star
id|PAGE_SIZE
comma
DECL|enumerator|MTHCA_ACK_REQ_FREQ
id|MTHCA_ACK_REQ_FREQ
op_assign
l_int|10
comma
DECL|enumerator|MTHCA_FLIGHT_LIMIT
id|MTHCA_FLIGHT_LIMIT
op_assign
l_int|9
comma
DECL|enumerator|MTHCA_UD_HEADER_SIZE
id|MTHCA_UD_HEADER_SIZE
op_assign
l_int|72
multiline_comment|/* largest UD header possible */
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_QP_STATE_RST
id|MTHCA_QP_STATE_RST
op_assign
l_int|0
comma
DECL|enumerator|MTHCA_QP_STATE_INIT
id|MTHCA_QP_STATE_INIT
op_assign
l_int|1
comma
DECL|enumerator|MTHCA_QP_STATE_RTR
id|MTHCA_QP_STATE_RTR
op_assign
l_int|2
comma
DECL|enumerator|MTHCA_QP_STATE_RTS
id|MTHCA_QP_STATE_RTS
op_assign
l_int|3
comma
DECL|enumerator|MTHCA_QP_STATE_SQE
id|MTHCA_QP_STATE_SQE
op_assign
l_int|4
comma
DECL|enumerator|MTHCA_QP_STATE_SQD
id|MTHCA_QP_STATE_SQD
op_assign
l_int|5
comma
DECL|enumerator|MTHCA_QP_STATE_ERR
id|MTHCA_QP_STATE_ERR
op_assign
l_int|6
comma
DECL|enumerator|MTHCA_QP_STATE_DRAINING
id|MTHCA_QP_STATE_DRAINING
op_assign
l_int|7
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_QP_ST_RC
id|MTHCA_QP_ST_RC
op_assign
l_int|0x0
comma
DECL|enumerator|MTHCA_QP_ST_UC
id|MTHCA_QP_ST_UC
op_assign
l_int|0x1
comma
DECL|enumerator|MTHCA_QP_ST_RD
id|MTHCA_QP_ST_RD
op_assign
l_int|0x2
comma
DECL|enumerator|MTHCA_QP_ST_UD
id|MTHCA_QP_ST_UD
op_assign
l_int|0x3
comma
DECL|enumerator|MTHCA_QP_ST_MLX
id|MTHCA_QP_ST_MLX
op_assign
l_int|0x7
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_QP_PM_MIGRATED
id|MTHCA_QP_PM_MIGRATED
op_assign
l_int|0x3
comma
DECL|enumerator|MTHCA_QP_PM_ARMED
id|MTHCA_QP_PM_ARMED
op_assign
l_int|0x0
comma
DECL|enumerator|MTHCA_QP_PM_REARM
id|MTHCA_QP_PM_REARM
op_assign
l_int|0x1
)brace
suffix:semicolon
r_enum
(brace
multiline_comment|/* qp_context flags */
DECL|enumerator|MTHCA_QP_BIT_DE
id|MTHCA_QP_BIT_DE
op_assign
l_int|1
op_lshift
l_int|8
comma
multiline_comment|/* params1 */
DECL|enumerator|MTHCA_QP_BIT_SRE
id|MTHCA_QP_BIT_SRE
op_assign
l_int|1
op_lshift
l_int|15
comma
DECL|enumerator|MTHCA_QP_BIT_SWE
id|MTHCA_QP_BIT_SWE
op_assign
l_int|1
op_lshift
l_int|14
comma
DECL|enumerator|MTHCA_QP_BIT_SAE
id|MTHCA_QP_BIT_SAE
op_assign
l_int|1
op_lshift
l_int|13
comma
DECL|enumerator|MTHCA_QP_BIT_SIC
id|MTHCA_QP_BIT_SIC
op_assign
l_int|1
op_lshift
l_int|4
comma
DECL|enumerator|MTHCA_QP_BIT_SSC
id|MTHCA_QP_BIT_SSC
op_assign
l_int|1
op_lshift
l_int|3
comma
multiline_comment|/* params2 */
DECL|enumerator|MTHCA_QP_BIT_RRE
id|MTHCA_QP_BIT_RRE
op_assign
l_int|1
op_lshift
l_int|15
comma
DECL|enumerator|MTHCA_QP_BIT_RWE
id|MTHCA_QP_BIT_RWE
op_assign
l_int|1
op_lshift
l_int|14
comma
DECL|enumerator|MTHCA_QP_BIT_RAE
id|MTHCA_QP_BIT_RAE
op_assign
l_int|1
op_lshift
l_int|13
comma
DECL|enumerator|MTHCA_QP_BIT_RIC
id|MTHCA_QP_BIT_RIC
op_assign
l_int|1
op_lshift
l_int|4
comma
DECL|enumerator|MTHCA_QP_BIT_RSC
id|MTHCA_QP_BIT_RSC
op_assign
l_int|1
op_lshift
l_int|3
)brace
suffix:semicolon
DECL|struct|mthca_qp_path
r_struct
id|mthca_qp_path
(brace
DECL|member|port_pkey
id|u32
id|port_pkey
suffix:semicolon
DECL|member|rnr_retry
id|u8
id|rnr_retry
suffix:semicolon
DECL|member|g_mylmc
id|u8
id|g_mylmc
suffix:semicolon
DECL|member|rlid
id|u16
id|rlid
suffix:semicolon
DECL|member|ackto
id|u8
id|ackto
suffix:semicolon
DECL|member|mgid_index
id|u8
id|mgid_index
suffix:semicolon
DECL|member|static_rate
id|u8
id|static_rate
suffix:semicolon
DECL|member|hop_limit
id|u8
id|hop_limit
suffix:semicolon
DECL|member|sl_tclass_flowlabel
id|u32
id|sl_tclass_flowlabel
suffix:semicolon
DECL|member|rgid
id|u8
id|rgid
(braket
l_int|16
)braket
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|mthca_qp_context
r_struct
id|mthca_qp_context
(brace
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|tavor_sched_queue
id|u32
id|tavor_sched_queue
suffix:semicolon
multiline_comment|/* Reserved on Arbel */
DECL|member|mtu_msgmax
id|u8
id|mtu_msgmax
suffix:semicolon
DECL|member|rq_size_stride
id|u8
id|rq_size_stride
suffix:semicolon
multiline_comment|/* Reserved on Tavor */
DECL|member|sq_size_stride
id|u8
id|sq_size_stride
suffix:semicolon
multiline_comment|/* Reserved on Tavor */
DECL|member|rlkey_arbel_sched_queue
id|u8
id|rlkey_arbel_sched_queue
suffix:semicolon
multiline_comment|/* Reserved on Tavor */
DECL|member|usr_page
id|u32
id|usr_page
suffix:semicolon
DECL|member|local_qpn
id|u32
id|local_qpn
suffix:semicolon
DECL|member|remote_qpn
id|u32
id|remote_qpn
suffix:semicolon
DECL|member|reserved1
id|u32
id|reserved1
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|pri_path
r_struct
id|mthca_qp_path
id|pri_path
suffix:semicolon
DECL|member|alt_path
r_struct
id|mthca_qp_path
id|alt_path
suffix:semicolon
DECL|member|rdd
id|u32
id|rdd
suffix:semicolon
DECL|member|pd
id|u32
id|pd
suffix:semicolon
DECL|member|wqe_base
id|u32
id|wqe_base
suffix:semicolon
DECL|member|wqe_lkey
id|u32
id|wqe_lkey
suffix:semicolon
DECL|member|params1
id|u32
id|params1
suffix:semicolon
DECL|member|reserved2
id|u32
id|reserved2
suffix:semicolon
DECL|member|next_send_psn
id|u32
id|next_send_psn
suffix:semicolon
DECL|member|cqn_snd
id|u32
id|cqn_snd
suffix:semicolon
DECL|member|snd_wqe_base_l
id|u32
id|snd_wqe_base_l
suffix:semicolon
multiline_comment|/* Next send WQE on Tavor */
DECL|member|snd_db_index
id|u32
id|snd_db_index
suffix:semicolon
multiline_comment|/* (debugging only entries) */
DECL|member|last_acked_psn
id|u32
id|last_acked_psn
suffix:semicolon
DECL|member|ssn
id|u32
id|ssn
suffix:semicolon
DECL|member|params2
id|u32
id|params2
suffix:semicolon
DECL|member|rnr_nextrecvpsn
id|u32
id|rnr_nextrecvpsn
suffix:semicolon
DECL|member|ra_buff_indx
id|u32
id|ra_buff_indx
suffix:semicolon
DECL|member|cqn_rcv
id|u32
id|cqn_rcv
suffix:semicolon
DECL|member|rcv_wqe_base_l
id|u32
id|rcv_wqe_base_l
suffix:semicolon
multiline_comment|/* Next recv WQE on Tavor */
DECL|member|rcv_db_index
id|u32
id|rcv_db_index
suffix:semicolon
multiline_comment|/* (debugging only entries) */
DECL|member|qkey
id|u32
id|qkey
suffix:semicolon
DECL|member|srqn
id|u32
id|srqn
suffix:semicolon
DECL|member|rmsn
id|u32
id|rmsn
suffix:semicolon
DECL|member|rq_wqe_counter
id|u16
id|rq_wqe_counter
suffix:semicolon
multiline_comment|/* reserved on Tavor */
DECL|member|sq_wqe_counter
id|u16
id|sq_wqe_counter
suffix:semicolon
multiline_comment|/* reserved on Tavor */
DECL|member|reserved3
id|u32
id|reserved3
(braket
l_int|18
)braket
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|mthca_qp_param
r_struct
id|mthca_qp_param
(brace
DECL|member|opt_param_mask
id|u32
id|opt_param_mask
suffix:semicolon
DECL|member|reserved1
id|u32
id|reserved1
suffix:semicolon
DECL|member|context
r_struct
id|mthca_qp_context
id|context
suffix:semicolon
DECL|member|reserved2
id|u32
id|reserved2
(braket
l_int|62
)braket
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_QP_OPTPAR_ALT_ADDR_PATH
id|MTHCA_QP_OPTPAR_ALT_ADDR_PATH
op_assign
l_int|1
op_lshift
l_int|0
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RRE
id|MTHCA_QP_OPTPAR_RRE
op_assign
l_int|1
op_lshift
l_int|1
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RAE
id|MTHCA_QP_OPTPAR_RAE
op_assign
l_int|1
op_lshift
l_int|2
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RWE
id|MTHCA_QP_OPTPAR_RWE
op_assign
l_int|1
op_lshift
l_int|3
comma
DECL|enumerator|MTHCA_QP_OPTPAR_PKEY_INDEX
id|MTHCA_QP_OPTPAR_PKEY_INDEX
op_assign
l_int|1
op_lshift
l_int|4
comma
DECL|enumerator|MTHCA_QP_OPTPAR_Q_KEY
id|MTHCA_QP_OPTPAR_Q_KEY
op_assign
l_int|1
op_lshift
l_int|5
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RNR_TIMEOUT
id|MTHCA_QP_OPTPAR_RNR_TIMEOUT
op_assign
l_int|1
op_lshift
l_int|6
comma
DECL|enumerator|MTHCA_QP_OPTPAR_PRIMARY_ADDR_PATH
id|MTHCA_QP_OPTPAR_PRIMARY_ADDR_PATH
op_assign
l_int|1
op_lshift
l_int|7
comma
DECL|enumerator|MTHCA_QP_OPTPAR_SRA_MAX
id|MTHCA_QP_OPTPAR_SRA_MAX
op_assign
l_int|1
op_lshift
l_int|8
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RRA_MAX
id|MTHCA_QP_OPTPAR_RRA_MAX
op_assign
l_int|1
op_lshift
l_int|9
comma
DECL|enumerator|MTHCA_QP_OPTPAR_PM_STATE
id|MTHCA_QP_OPTPAR_PM_STATE
op_assign
l_int|1
op_lshift
l_int|10
comma
DECL|enumerator|MTHCA_QP_OPTPAR_PORT_NUM
id|MTHCA_QP_OPTPAR_PORT_NUM
op_assign
l_int|1
op_lshift
l_int|11
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RETRY_COUNT
id|MTHCA_QP_OPTPAR_RETRY_COUNT
op_assign
l_int|1
op_lshift
l_int|12
comma
DECL|enumerator|MTHCA_QP_OPTPAR_ALT_RNR_RETRY
id|MTHCA_QP_OPTPAR_ALT_RNR_RETRY
op_assign
l_int|1
op_lshift
l_int|13
comma
DECL|enumerator|MTHCA_QP_OPTPAR_ACK_TIMEOUT
id|MTHCA_QP_OPTPAR_ACK_TIMEOUT
op_assign
l_int|1
op_lshift
l_int|14
comma
DECL|enumerator|MTHCA_QP_OPTPAR_RNR_RETRY
id|MTHCA_QP_OPTPAR_RNR_RETRY
op_assign
l_int|1
op_lshift
l_int|15
comma
DECL|enumerator|MTHCA_QP_OPTPAR_SCHED_QUEUE
id|MTHCA_QP_OPTPAR_SCHED_QUEUE
op_assign
l_int|1
op_lshift
l_int|16
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_OPCODE_NOP
id|MTHCA_OPCODE_NOP
op_assign
l_int|0x00
comma
DECL|enumerator|MTHCA_OPCODE_RDMA_WRITE
id|MTHCA_OPCODE_RDMA_WRITE
op_assign
l_int|0x08
comma
DECL|enumerator|MTHCA_OPCODE_RDMA_WRITE_IMM
id|MTHCA_OPCODE_RDMA_WRITE_IMM
op_assign
l_int|0x09
comma
DECL|enumerator|MTHCA_OPCODE_SEND
id|MTHCA_OPCODE_SEND
op_assign
l_int|0x0a
comma
DECL|enumerator|MTHCA_OPCODE_SEND_IMM
id|MTHCA_OPCODE_SEND_IMM
op_assign
l_int|0x0b
comma
DECL|enumerator|MTHCA_OPCODE_RDMA_READ
id|MTHCA_OPCODE_RDMA_READ
op_assign
l_int|0x10
comma
DECL|enumerator|MTHCA_OPCODE_ATOMIC_CS
id|MTHCA_OPCODE_ATOMIC_CS
op_assign
l_int|0x11
comma
DECL|enumerator|MTHCA_OPCODE_ATOMIC_FA
id|MTHCA_OPCODE_ATOMIC_FA
op_assign
l_int|0x12
comma
DECL|enumerator|MTHCA_OPCODE_BIND_MW
id|MTHCA_OPCODE_BIND_MW
op_assign
l_int|0x18
comma
DECL|enumerator|MTHCA_OPCODE_INVALID
id|MTHCA_OPCODE_INVALID
op_assign
l_int|0xff
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|MTHCA_NEXT_DBD
id|MTHCA_NEXT_DBD
op_assign
l_int|1
op_lshift
l_int|7
comma
DECL|enumerator|MTHCA_NEXT_FENCE
id|MTHCA_NEXT_FENCE
op_assign
l_int|1
op_lshift
l_int|6
comma
DECL|enumerator|MTHCA_NEXT_CQ_UPDATE
id|MTHCA_NEXT_CQ_UPDATE
op_assign
l_int|1
op_lshift
l_int|3
comma
DECL|enumerator|MTHCA_NEXT_EVENT_GEN
id|MTHCA_NEXT_EVENT_GEN
op_assign
l_int|1
op_lshift
l_int|2
comma
DECL|enumerator|MTHCA_NEXT_SOLICIT
id|MTHCA_NEXT_SOLICIT
op_assign
l_int|1
op_lshift
l_int|1
comma
DECL|enumerator|MTHCA_MLX_VL15
id|MTHCA_MLX_VL15
op_assign
l_int|1
op_lshift
l_int|17
comma
DECL|enumerator|MTHCA_MLX_SLR
id|MTHCA_MLX_SLR
op_assign
l_int|1
op_lshift
l_int|16
)brace
suffix:semicolon
DECL|struct|mthca_next_seg
r_struct
id|mthca_next_seg
(brace
DECL|member|nda_op
id|u32
id|nda_op
suffix:semicolon
multiline_comment|/* [31:6] next WQE [4:0] next opcode */
DECL|member|ee_nds
id|u32
id|ee_nds
suffix:semicolon
multiline_comment|/* [31:8] next EE  [7] DBD [6] F [5:0] next WQE size */
DECL|member|flags
id|u32
id|flags
suffix:semicolon
multiline_comment|/* [3] CQ [2] Event [1] Solicit */
DECL|member|imm
id|u32
id|imm
suffix:semicolon
multiline_comment|/* immediate data */
)brace
suffix:semicolon
DECL|struct|mthca_tavor_ud_seg
r_struct
id|mthca_tavor_ud_seg
(brace
DECL|member|reserved1
id|u32
id|reserved1
suffix:semicolon
DECL|member|lkey
id|u32
id|lkey
suffix:semicolon
DECL|member|av_addr
id|u64
id|av_addr
suffix:semicolon
DECL|member|reserved2
id|u32
id|reserved2
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|dqpn
id|u32
id|dqpn
suffix:semicolon
DECL|member|qkey
id|u32
id|qkey
suffix:semicolon
DECL|member|reserved3
id|u32
id|reserved3
(braket
l_int|2
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_arbel_ud_seg
r_struct
id|mthca_arbel_ud_seg
(brace
DECL|member|av
id|u32
id|av
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|dqpn
id|u32
id|dqpn
suffix:semicolon
DECL|member|qkey
id|u32
id|qkey
suffix:semicolon
DECL|member|reserved
id|u32
id|reserved
(braket
l_int|2
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_bind_seg
r_struct
id|mthca_bind_seg
(brace
DECL|member|flags
id|u32
id|flags
suffix:semicolon
multiline_comment|/* [31] Atomic [30] rem write [29] rem read */
DECL|member|reserved
id|u32
id|reserved
suffix:semicolon
DECL|member|new_rkey
id|u32
id|new_rkey
suffix:semicolon
DECL|member|lkey
id|u32
id|lkey
suffix:semicolon
DECL|member|addr
id|u64
id|addr
suffix:semicolon
DECL|member|length
id|u64
id|length
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_raddr_seg
r_struct
id|mthca_raddr_seg
(brace
DECL|member|raddr
id|u64
id|raddr
suffix:semicolon
DECL|member|rkey
id|u32
id|rkey
suffix:semicolon
DECL|member|reserved
id|u32
id|reserved
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_atomic_seg
r_struct
id|mthca_atomic_seg
(brace
DECL|member|swap_add
id|u64
id|swap_add
suffix:semicolon
DECL|member|compare
id|u64
id|compare
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_data_seg
r_struct
id|mthca_data_seg
(brace
DECL|member|byte_count
id|u32
id|byte_count
suffix:semicolon
DECL|member|lkey
id|u32
id|lkey
suffix:semicolon
DECL|member|addr
id|u64
id|addr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mthca_mlx_seg
r_struct
id|mthca_mlx_seg
(brace
DECL|member|nda_op
id|u32
id|nda_op
suffix:semicolon
DECL|member|nds
id|u32
id|nds
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
multiline_comment|/* [17] VL15 [16] SLR [14:12] static rate&n;&t;&t;&t;&t;   [11:8] SL [3] C [2] E */
DECL|member|rlid
id|u16
id|rlid
suffix:semicolon
DECL|member|vcrc
id|u16
id|vcrc
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mthca_opcode
r_static
r_const
id|u8
id|mthca_opcode
(braket
)braket
op_assign
(brace
(braket
id|IB_WR_SEND
)braket
op_assign
id|MTHCA_OPCODE_SEND
comma
(braket
id|IB_WR_SEND_WITH_IMM
)braket
op_assign
id|MTHCA_OPCODE_SEND_IMM
comma
(braket
id|IB_WR_RDMA_WRITE
)braket
op_assign
id|MTHCA_OPCODE_RDMA_WRITE
comma
(braket
id|IB_WR_RDMA_WRITE_WITH_IMM
)braket
op_assign
id|MTHCA_OPCODE_RDMA_WRITE_IMM
comma
(braket
id|IB_WR_RDMA_READ
)braket
op_assign
id|MTHCA_OPCODE_RDMA_READ
comma
(braket
id|IB_WR_ATOMIC_CMP_AND_SWP
)braket
op_assign
id|MTHCA_OPCODE_ATOMIC_CS
comma
(braket
id|IB_WR_ATOMIC_FETCH_AND_ADD
)braket
op_assign
id|MTHCA_OPCODE_ATOMIC_FA
comma
)brace
suffix:semicolon
DECL|function|is_sqp
r_static
r_int
id|is_sqp
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_return
id|qp-&gt;qpn
op_ge
id|dev-&gt;qp_table.sqp_start
op_logical_and
id|qp-&gt;qpn
op_le
id|dev-&gt;qp_table.sqp_start
op_plus
l_int|3
suffix:semicolon
)brace
DECL|function|is_qp0
r_static
r_int
id|is_qp0
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_return
id|qp-&gt;qpn
op_ge
id|dev-&gt;qp_table.sqp_start
op_logical_and
id|qp-&gt;qpn
op_le
id|dev-&gt;qp_table.sqp_start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|get_recv_wqe
r_static
r_void
op_star
id|get_recv_wqe
c_func
(paren
r_struct
id|mthca_qp
op_star
id|qp
comma
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
id|qp-&gt;is_direct
)paren
r_return
id|qp-&gt;queue.direct.buf
op_plus
(paren
id|n
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
suffix:semicolon
r_else
r_return
id|qp-&gt;queue.page_list
(braket
(paren
id|n
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
op_rshift
id|PAGE_SHIFT
)braket
dot
id|buf
op_plus
(paren
(paren
id|n
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|get_send_wqe
r_static
r_void
op_star
id|get_send_wqe
c_func
(paren
r_struct
id|mthca_qp
op_star
id|qp
comma
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
id|qp-&gt;is_direct
)paren
r_return
id|qp-&gt;queue.direct.buf
op_plus
id|qp-&gt;send_wqe_offset
op_plus
(paren
id|n
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
suffix:semicolon
r_else
r_return
id|qp-&gt;queue.page_list
(braket
(paren
id|qp-&gt;send_wqe_offset
op_plus
(paren
id|n
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
)paren
op_rshift
id|PAGE_SHIFT
)braket
dot
id|buf
op_plus
(paren
(paren
id|qp-&gt;send_wqe_offset
op_plus
(paren
id|n
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
)paren
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|mthca_qp_event
r_void
id|mthca_qp_event
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
id|u32
id|qpn
comma
r_enum
id|ib_event_type
id|event_type
)paren
(brace
r_struct
id|mthca_qp
op_star
id|qp
suffix:semicolon
r_struct
id|ib_event
id|event
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
id|qp
op_assign
id|mthca_array_get
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|qpn
op_amp
(paren
id|dev-&gt;limits.num_qps
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp
)paren
id|atomic_inc
c_func
(paren
op_amp
id|qp-&gt;refcount
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp
)paren
(brace
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;Async event for bogus QP %08x&bslash;n&quot;
comma
id|qpn
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|event.device
op_assign
op_amp
id|dev-&gt;ib_dev
suffix:semicolon
id|event.event
op_assign
id|event_type
suffix:semicolon
id|event.element.qp
op_assign
op_amp
id|qp-&gt;ibqp
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;ibqp.event_handler
)paren
id|qp-&gt;ibqp
dot
id|event_handler
c_func
(paren
op_amp
id|event
comma
id|qp-&gt;ibqp.qp_context
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|qp-&gt;refcount
)paren
)paren
id|wake_up
c_func
(paren
op_amp
id|qp-&gt;wait
)paren
suffix:semicolon
)brace
DECL|function|to_mthca_state
r_static
r_int
id|to_mthca_state
c_func
(paren
r_enum
id|ib_qp_state
id|ib_state
)paren
(brace
r_switch
c_cond
(paren
id|ib_state
)paren
(brace
r_case
id|IB_QPS_RESET
suffix:colon
r_return
id|MTHCA_QP_STATE_RST
suffix:semicolon
r_case
id|IB_QPS_INIT
suffix:colon
r_return
id|MTHCA_QP_STATE_INIT
suffix:semicolon
r_case
id|IB_QPS_RTR
suffix:colon
r_return
id|MTHCA_QP_STATE_RTR
suffix:semicolon
r_case
id|IB_QPS_RTS
suffix:colon
r_return
id|MTHCA_QP_STATE_RTS
suffix:semicolon
r_case
id|IB_QPS_SQD
suffix:colon
r_return
id|MTHCA_QP_STATE_SQD
suffix:semicolon
r_case
id|IB_QPS_SQE
suffix:colon
r_return
id|MTHCA_QP_STATE_SQE
suffix:semicolon
r_case
id|IB_QPS_ERR
suffix:colon
r_return
id|MTHCA_QP_STATE_ERR
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|enumerator|RC
DECL|enumerator|UC
DECL|enumerator|UD
DECL|enumerator|RD
DECL|enumerator|RDEE
DECL|enumerator|MLX
DECL|enumerator|NUM_TRANS
r_enum
(brace
id|RC
comma
id|UC
comma
id|UD
comma
id|RD
comma
id|RDEE
comma
id|MLX
comma
id|NUM_TRANS
)brace
suffix:semicolon
DECL|function|to_mthca_st
r_static
r_int
id|to_mthca_st
c_func
(paren
r_int
id|transport
)paren
(brace
r_switch
c_cond
(paren
id|transport
)paren
(brace
r_case
id|RC
suffix:colon
r_return
id|MTHCA_QP_ST_RC
suffix:semicolon
r_case
id|UC
suffix:colon
r_return
id|MTHCA_QP_ST_UC
suffix:semicolon
r_case
id|UD
suffix:colon
r_return
id|MTHCA_QP_ST_UD
suffix:semicolon
r_case
id|RD
suffix:colon
r_return
id|MTHCA_QP_ST_RD
suffix:semicolon
r_case
id|MLX
suffix:colon
r_return
id|MTHCA_QP_ST_MLX
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_const
r_struct
(brace
DECL|member|trans
r_int
id|trans
suffix:semicolon
DECL|member|req_param
id|u32
id|req_param
(braket
id|NUM_TRANS
)braket
suffix:semicolon
DECL|member|opt_param
id|u32
id|opt_param
(braket
id|NUM_TRANS
)braket
suffix:semicolon
DECL|variable|state_table
)brace
id|state_table
(braket
id|IB_QPS_ERR
op_plus
l_int|1
)braket
(braket
id|IB_QPS_ERR
op_plus
l_int|1
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_INIT
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_RST2INIT
comma
dot
id|req_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_PORT
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_PORT
op_or
id|IB_QP_ACCESS_FLAGS
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
)brace
comma
multiline_comment|/* bug-for-bug compatibility with VAPI: */
dot
id|opt_param
op_assign
(brace
(braket
id|MLX
)braket
op_assign
id|IB_QP_PORT
)brace
)brace
comma
)brace
comma
(braket
id|IB_QPS_INIT
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_INIT
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_INIT2INIT
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_PORT
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_PORT
op_or
id|IB_QP_ACCESS_FLAGS
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
comma
(braket
id|IB_QPS_RTR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_INIT2RTR
comma
dot
id|req_param
op_assign
(brace
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_AV
op_or
id|IB_QP_PATH_MTU
op_or
id|IB_QP_DEST_QPN
op_or
id|IB_QP_RQ_PSN
op_or
id|IB_QP_MAX_DEST_RD_ATOMIC
op_or
id|IB_QP_MIN_RNR_TIMER
)paren
comma
)brace
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_ALT_PATH
op_or
id|IB_QP_ACCESS_FLAGS
op_or
id|IB_QP_PKEY_INDEX
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
)brace
comma
(braket
id|IB_QPS_RTR
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_RTS
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_RTR2RTS
comma
dot
id|req_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
id|IB_QP_SQ_PSN
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_TIMEOUT
op_or
id|IB_QP_RETRY_CNT
op_or
id|IB_QP_RNR_RETRY
op_or
id|IB_QP_SQ_PSN
op_or
id|IB_QP_MAX_QP_RD_ATOMIC
)paren
comma
(braket
id|MLX
)braket
op_assign
id|IB_QP_SQ_PSN
comma
)brace
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_ALT_PATH
op_or
id|IB_QP_ACCESS_FLAGS
op_or
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_MIN_RNR_TIMER
op_or
id|IB_QP_PATH_MIG_STATE
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
)brace
comma
(braket
id|IB_QPS_RTS
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_RTS
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_RTS2RTS
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_ACCESS_FLAGS
op_or
id|IB_QP_ALT_PATH
op_or
id|IB_QP_PATH_MIG_STATE
op_or
id|IB_QP_MIN_RNR_TIMER
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
comma
(braket
id|IB_QPS_SQD
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_RTS2SQD
comma
)brace
comma
)brace
comma
(braket
id|IB_QPS_SQD
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_RTS
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_SQD2RTS
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_ALT_PATH
op_or
id|IB_QP_ACCESS_FLAGS
op_or
id|IB_QP_MIN_RNR_TIMER
op_or
id|IB_QP_PATH_MIG_STATE
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
comma
(braket
id|IB_QPS_SQD
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_SQD2SQD
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_AV
op_or
id|IB_QP_TIMEOUT
op_or
id|IB_QP_RETRY_CNT
op_or
id|IB_QP_RNR_RETRY
op_or
id|IB_QP_MAX_QP_RD_ATOMIC
op_or
id|IB_QP_MAX_DEST_RD_ATOMIC
op_or
id|IB_QP_CUR_STATE
op_or
id|IB_QP_ALT_PATH
op_or
id|IB_QP_ACCESS_FLAGS
op_or
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_MIN_RNR_TIMER
op_or
id|IB_QP_PATH_MIG_STATE
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_PKEY_INDEX
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
)brace
comma
(braket
id|IB_QPS_SQE
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
comma
(braket
id|IB_QPS_RTS
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_SQERR2RTS
comma
dot
id|opt_param
op_assign
(brace
(braket
id|UD
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
(braket
id|RC
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_MIN_RNR_TIMER
)paren
comma
(braket
id|MLX
)braket
op_assign
(paren
id|IB_QP_CUR_STATE
op_or
id|IB_QP_QKEY
)paren
comma
)brace
)brace
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
(braket
id|IB_QPS_RESET
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2RST
)brace
comma
(braket
id|IB_QPS_ERR
)braket
op_assign
(brace
dot
id|trans
op_assign
id|MTHCA_TRANS_ANY2ERR
)brace
)brace
)brace
suffix:semicolon
DECL|function|store_attrs
r_static
r_void
id|store_attrs
c_func
(paren
r_struct
id|mthca_sqp
op_star
id|sqp
comma
r_struct
id|ib_qp_attr
op_star
id|attr
comma
r_int
id|attr_mask
)paren
(brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_PKEY_INDEX
)paren
id|sqp-&gt;pkey_index
op_assign
id|attr-&gt;pkey_index
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_QKEY
)paren
id|sqp-&gt;qkey
op_assign
id|attr-&gt;qkey
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_SQ_PSN
)paren
id|sqp-&gt;send_psn
op_assign
id|attr-&gt;sq_psn
suffix:semicolon
)brace
DECL|function|init_port
r_static
r_void
id|init_port
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_int
id|port
)paren
(brace
r_int
id|err
suffix:semicolon
id|u8
id|status
suffix:semicolon
r_struct
id|mthca_init_ib_param
id|param
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|param
comma
l_int|0
comma
r_sizeof
id|param
)paren
suffix:semicolon
id|param.enable_1x
op_assign
l_int|1
suffix:semicolon
id|param.enable_4x
op_assign
l_int|1
suffix:semicolon
id|param.vl_cap
op_assign
id|dev-&gt;limits.vl_cap
suffix:semicolon
id|param.mtu_cap
op_assign
id|dev-&gt;limits.mtu_cap
suffix:semicolon
id|param.gid_cap
op_assign
id|dev-&gt;limits.gid_table_len
suffix:semicolon
id|param.pkey_cap
op_assign
id|dev-&gt;limits.pkey_table_len
suffix:semicolon
id|err
op_assign
id|mthca_INIT_IB
c_func
(paren
id|dev
comma
op_amp
id|param
comma
id|port
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;INIT_IB failed, return code %d.&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;INIT_IB returned status %02x.&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|mthca_modify_qp
r_int
id|mthca_modify_qp
c_func
(paren
r_struct
id|ib_qp
op_star
id|ibqp
comma
r_struct
id|ib_qp_attr
op_star
id|attr
comma
r_int
id|attr_mask
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|to_mdev
c_func
(paren
id|ibqp-&gt;device
)paren
suffix:semicolon
r_struct
id|mthca_qp
op_star
id|qp
op_assign
id|to_mqp
c_func
(paren
id|ibqp
)paren
suffix:semicolon
r_enum
id|ib_qp_state
id|cur_state
comma
id|new_state
suffix:semicolon
r_void
op_star
id|mailbox
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|mthca_qp_param
op_star
id|qp_param
suffix:semicolon
r_struct
id|mthca_qp_context
op_star
id|qp_context
suffix:semicolon
id|u32
id|req_param
comma
id|opt_param
suffix:semicolon
id|u8
id|status
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_CUR_STATE
)paren
(brace
r_if
c_cond
(paren
id|attr-&gt;cur_qp_state
op_ne
id|IB_QPS_RTR
op_logical_and
id|attr-&gt;cur_qp_state
op_ne
id|IB_QPS_RTS
op_logical_and
id|attr-&gt;cur_qp_state
op_ne
id|IB_QPS_SQD
op_logical_and
id|attr-&gt;cur_qp_state
op_ne
id|IB_QPS_SQE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
id|cur_state
op_assign
id|attr-&gt;cur_qp_state
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|qp-&gt;sq.lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|qp-&gt;rq.lock
)paren
suffix:semicolon
id|cur_state
op_assign
id|qp-&gt;state
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|qp-&gt;rq.lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|qp-&gt;sq.lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_STATE
)paren
(brace
r_if
c_cond
(paren
id|attr-&gt;qp_state
template_param
id|IB_QPS_ERR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|new_state
op_assign
id|attr-&gt;qp_state
suffix:semicolon
)brace
r_else
id|new_state
op_assign
id|cur_state
suffix:semicolon
r_if
c_cond
(paren
id|state_table
(braket
id|cur_state
)braket
(braket
id|new_state
)braket
dot
id|trans
op_eq
id|MTHCA_TRANS_INVALID
)paren
(brace
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Illegal QP transition &quot;
l_string|&quot;%d-&gt;%d&bslash;n&quot;
comma
id|cur_state
comma
id|new_state
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|req_param
op_assign
id|state_table
(braket
id|cur_state
)braket
(braket
id|new_state
)braket
dot
id|req_param
(braket
id|qp-&gt;transport
)braket
suffix:semicolon
id|opt_param
op_assign
id|state_table
(braket
id|cur_state
)braket
(braket
id|new_state
)braket
dot
id|opt_param
(braket
id|qp-&gt;transport
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req_param
op_amp
id|attr_mask
)paren
op_ne
id|req_param
)paren
(brace
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;QP transition &quot;
l_string|&quot;%d-&gt;%d missing req attr 0x%08x&bslash;n&quot;
comma
id|cur_state
comma
id|new_state
comma
id|req_param
op_amp
op_complement
id|attr_mask
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
op_complement
(paren
id|req_param
op_or
id|opt_param
op_or
id|IB_QP_STATE
)paren
)paren
(brace
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;QP transition (transport %d) &quot;
l_string|&quot;%d-&gt;%d has extra attr 0x%08x&bslash;n&quot;
comma
id|qp-&gt;transport
comma
id|cur_state
comma
id|new_state
comma
id|attr_mask
op_amp
op_complement
(paren
id|req_param
op_or
id|opt_param
op_or
id|IB_QP_STATE
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mailbox
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|qp_param
)paren
op_plus
id|MTHCA_CMD_MAILBOX_EXTRA
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mailbox
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|qp_param
op_assign
id|MAILBOX_ALIGN
c_func
(paren
id|mailbox
)paren
suffix:semicolon
id|qp_context
op_assign
op_amp
id|qp_param-&gt;context
suffix:semicolon
id|memset
c_func
(paren
id|qp_param
comma
l_int|0
comma
r_sizeof
op_star
id|qp_param
)paren
suffix:semicolon
id|qp_context-&gt;flags
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|to_mthca_state
c_func
(paren
id|new_state
)paren
op_lshift
l_int|28
)paren
op_or
(paren
id|to_mthca_st
c_func
(paren
id|qp-&gt;transport
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|qp_context-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_BIT_DE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|attr_mask
op_amp
id|IB_QP_PATH_MIG_STATE
)paren
)paren
id|qp_context-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_PM_MIGRATED
op_lshift
l_int|11
)paren
suffix:semicolon
r_else
(brace
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_PM_STATE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|attr-&gt;path_mig_state
)paren
(brace
r_case
id|IB_MIG_MIGRATED
suffix:colon
id|qp_context-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_PM_MIGRATED
op_lshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_MIG_REARM
suffix:colon
id|qp_context-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_PM_REARM
op_lshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_MIG_ARMED
suffix:colon
id|qp_context-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_PM_ARMED
op_lshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* leave tavor_sched_queue as 0 */
r_if
c_cond
(paren
id|qp-&gt;transport
op_eq
id|MLX
op_logical_or
id|qp-&gt;transport
op_eq
id|UD
)paren
id|qp_context-&gt;mtu_msgmax
op_assign
(paren
id|IB_MTU_2048
op_lshift
l_int|5
)paren
op_or
l_int|11
suffix:semicolon
r_else
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_PATH_MTU
)paren
id|qp_context-&gt;mtu_msgmax
op_assign
(paren
id|attr-&gt;path_mtu
op_lshift
l_int|5
)paren
op_or
l_int|31
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|qp_context-&gt;rq_size_stride
op_assign
(paren
(paren
id|ffs
c_func
(paren
id|qp-&gt;rq.max
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|3
)paren
op_or
(paren
id|qp-&gt;rq.wqe_shift
op_minus
l_int|4
)paren
suffix:semicolon
id|qp_context-&gt;sq_size_stride
op_assign
(paren
(paren
id|ffs
c_func
(paren
id|qp-&gt;sq.max
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|3
)paren
op_or
(paren
id|qp-&gt;sq.wqe_shift
op_minus
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/* leave arbel_sched_queue as 0 */
id|qp_context-&gt;usr_page
op_assign
id|cpu_to_be32
c_func
(paren
id|dev-&gt;driver_uar.index
)paren
suffix:semicolon
id|qp_context-&gt;local_qpn
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;qpn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_DEST_QPN
)paren
(brace
id|qp_context-&gt;remote_qpn
op_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;dest_qp_num
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qp-&gt;transport
op_eq
id|MLX
)paren
id|qp_context-&gt;pri_path.port_pkey
op_or_assign
id|cpu_to_be32
c_func
(paren
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|port
op_lshift
l_int|24
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_PORT
)paren
(brace
id|qp_context-&gt;pri_path.port_pkey
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;port_num
op_lshift
l_int|24
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_PORT_NUM
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_PKEY_INDEX
)paren
(brace
id|qp_context-&gt;pri_path.port_pkey
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;pkey_index
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_PKEY_INDEX
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_RNR_RETRY
)paren
(brace
id|qp_context-&gt;pri_path.rnr_retry
op_assign
id|attr-&gt;rnr_retry
op_lshift
l_int|5
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RNR_RETRY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_AV
)paren
(brace
id|qp_context-&gt;pri_path.g_mylmc
op_assign
id|attr-&gt;ah_attr.src_path_bits
op_amp
l_int|0x7f
suffix:semicolon
id|qp_context-&gt;pri_path.rlid
op_assign
id|cpu_to_be16
c_func
(paren
id|attr-&gt;ah_attr.dlid
)paren
suffix:semicolon
id|qp_context-&gt;pri_path.static_rate
op_assign
(paren
op_logical_neg
op_logical_neg
id|attr-&gt;ah_attr.static_rate
)paren
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|attr-&gt;ah_attr.ah_flags
op_amp
id|IB_AH_GRH
)paren
(brace
id|qp_context-&gt;pri_path.g_mylmc
op_or_assign
l_int|1
op_lshift
l_int|7
suffix:semicolon
id|qp_context-&gt;pri_path.mgid_index
op_assign
id|attr-&gt;ah_attr.grh.sgid_index
suffix:semicolon
id|qp_context-&gt;pri_path.hop_limit
op_assign
id|attr-&gt;ah_attr.grh.hop_limit
suffix:semicolon
id|qp_context-&gt;pri_path.sl_tclass_flowlabel
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|attr-&gt;ah_attr.sl
op_lshift
l_int|28
)paren
op_or
(paren
id|attr-&gt;ah_attr.grh.traffic_class
op_lshift
l_int|20
)paren
op_or
(paren
id|attr-&gt;ah_attr.grh.flow_label
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|qp_context-&gt;pri_path.rgid
comma
id|attr-&gt;ah_attr.grh.dgid.raw
comma
l_int|16
)paren
suffix:semicolon
)brace
r_else
(brace
id|qp_context-&gt;pri_path.sl_tclass_flowlabel
op_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;ah_attr.sl
op_lshift
l_int|28
)paren
suffix:semicolon
)brace
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_PRIMARY_ADDR_PATH
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_TIMEOUT
)paren
(brace
id|qp_context-&gt;pri_path.ackto
op_assign
id|attr-&gt;timeout
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_ACK_TIMEOUT
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX alt_path */
multiline_comment|/* leave rdd as 0 */
id|qp_context-&gt;pd
op_assign
id|cpu_to_be32
c_func
(paren
id|to_mpd
c_func
(paren
id|ibqp-&gt;pd
)paren
op_member_access_from_pointer
id|pd_num
)paren
suffix:semicolon
multiline_comment|/* leave wqe_base as 0 (we always create an MR based at 0 for WQs) */
id|qp_context-&gt;wqe_lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;mr.ibmr.lkey
)paren
suffix:semicolon
id|qp_context-&gt;params1
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|MTHCA_ACK_REQ_FREQ
op_lshift
l_int|28
)paren
op_or
(paren
id|MTHCA_FLIGHT_LIMIT
op_lshift
l_int|24
)paren
op_or
id|MTHCA_QP_BIT_SRE
op_or
id|MTHCA_QP_BIT_SWE
op_or
id|MTHCA_QP_BIT_SAE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;sq_policy
op_eq
id|IB_SIGNAL_ALL_WR
)paren
id|qp_context-&gt;params1
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_BIT_SSC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_RETRY_CNT
)paren
(brace
id|qp_context-&gt;params1
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;retry_cnt
op_lshift
l_int|16
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RETRY_COUNT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_MAX_DEST_RD_ATOMIC
)paren
(brace
id|qp_context-&gt;params1
op_or_assign
id|cpu_to_be32
c_func
(paren
id|min
c_func
(paren
id|attr-&gt;max_dest_rd_atomic
ques
c_cond
id|ffs
c_func
(paren
id|attr-&gt;max_dest_rd_atomic
)paren
op_minus
l_int|1
suffix:colon
l_int|0
comma
l_int|7
)paren
op_lshift
l_int|21
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_SRA_MAX
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_SQ_PSN
)paren
id|qp_context-&gt;next_send_psn
op_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;sq_psn
)paren
suffix:semicolon
id|qp_context-&gt;cqn_snd
op_assign
id|cpu_to_be32
c_func
(paren
id|to_mcq
c_func
(paren
id|ibqp-&gt;send_cq
)paren
op_member_access_from_pointer
id|cqn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|qp_context-&gt;snd_wqe_base_l
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;send_wqe_offset
)paren
suffix:semicolon
id|qp_context-&gt;snd_db_index
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;sq.db_index
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_ACCESS_FLAGS
)paren
(brace
multiline_comment|/*&n;&t;&t; * Only enable RDMA/atomics if we have responder&n;&t;&t; * resources set to a non-zero value.&n;&t;&t; */
r_if
c_cond
(paren
id|qp-&gt;resp_depth
)paren
(brace
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;qp_access_flags
op_amp
id|IB_ACCESS_REMOTE_WRITE
ques
c_cond
id|MTHCA_QP_BIT_RWE
suffix:colon
l_int|0
)paren
suffix:semicolon
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;qp_access_flags
op_amp
id|IB_ACCESS_REMOTE_READ
ques
c_cond
id|MTHCA_QP_BIT_RRE
suffix:colon
l_int|0
)paren
suffix:semicolon
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;qp_access_flags
op_amp
id|IB_ACCESS_REMOTE_ATOMIC
ques
c_cond
id|MTHCA_QP_BIT_RAE
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RWE
op_or
id|MTHCA_QP_OPTPAR_RRE
op_or
id|MTHCA_QP_OPTPAR_RAE
)paren
suffix:semicolon
id|qp-&gt;atomic_rd_en
op_assign
id|attr-&gt;qp_access_flags
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_MAX_QP_RD_ATOMIC
)paren
(brace
id|u8
id|rra_max
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;resp_depth
op_logical_and
op_logical_neg
id|attr-&gt;max_rd_atomic
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Lowering our responder resources to zero.&n;&t;&t;&t; * Turn off RDMA/atomics as responder.&n;&t;&t;&t; * (RWE/RRE/RAE in params2 already zero)&n;&t;&t;&t; */
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RWE
op_or
id|MTHCA_QP_OPTPAR_RRE
op_or
id|MTHCA_QP_OPTPAR_RAE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|qp-&gt;resp_depth
op_logical_and
id|attr-&gt;max_rd_atomic
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Increasing our responder resources from&n;&t;&t;&t; * zero.  Turn on RDMA/atomics as appropriate.&n;&t;&t;&t; */
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;atomic_rd_en
op_amp
id|IB_ACCESS_REMOTE_WRITE
ques
c_cond
id|MTHCA_QP_BIT_RWE
suffix:colon
l_int|0
)paren
suffix:semicolon
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;atomic_rd_en
op_amp
id|IB_ACCESS_REMOTE_READ
ques
c_cond
id|MTHCA_QP_BIT_RRE
suffix:colon
l_int|0
)paren
suffix:semicolon
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;atomic_rd_en
op_amp
id|IB_ACCESS_REMOTE_ATOMIC
ques
c_cond
id|MTHCA_QP_BIT_RAE
suffix:colon
l_int|0
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RWE
op_or
id|MTHCA_QP_OPTPAR_RRE
op_or
id|MTHCA_QP_OPTPAR_RAE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|rra_max
op_assign
l_int|0
suffix:semicolon
l_int|1
op_lshift
id|rra_max
OL
id|attr-&gt;max_rd_atomic
op_logical_and
id|rra_max
OL
id|dev-&gt;qp_table.rdb_shift
suffix:semicolon
op_increment
id|rra_max
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|rra_max
op_lshift
l_int|21
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RRA_MAX
)paren
suffix:semicolon
id|qp-&gt;resp_depth
op_assign
id|attr-&gt;max_rd_atomic
suffix:semicolon
)brace
id|qp_context-&gt;params2
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_BIT_RSC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_MIN_RNR_TIMER
)paren
(brace
id|qp_context-&gt;rnr_nextrecvpsn
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;min_rnr_timer
op_lshift
l_int|24
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_RNR_TIMEOUT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_RQ_PSN
)paren
id|qp_context-&gt;rnr_nextrecvpsn
op_or_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;rq_psn
)paren
suffix:semicolon
id|qp_context-&gt;ra_buff_indx
op_assign
id|cpu_to_be32
c_func
(paren
id|dev-&gt;qp_table.rdb_base
op_plus
(paren
(paren
id|qp-&gt;qpn
op_amp
(paren
id|dev-&gt;limits.num_qps
op_minus
l_int|1
)paren
)paren
op_star
id|MTHCA_RDB_ENTRY_SIZE
op_lshift
id|dev-&gt;qp_table.rdb_shift
)paren
)paren
suffix:semicolon
id|qp_context-&gt;cqn_rcv
op_assign
id|cpu_to_be32
c_func
(paren
id|to_mcq
c_func
(paren
id|ibqp-&gt;recv_cq
)paren
op_member_access_from_pointer
id|cqn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
id|qp_context-&gt;rcv_db_index
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;rq.db_index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr_mask
op_amp
id|IB_QP_QKEY
)paren
(brace
id|qp_context-&gt;qkey
op_assign
id|cpu_to_be32
c_func
(paren
id|attr-&gt;qkey
)paren
suffix:semicolon
id|qp_param-&gt;opt_param_mask
op_or_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_QP_OPTPAR_Q_KEY
)paren
suffix:semicolon
)brace
id|err
op_assign
id|mthca_MODIFY_QP
c_func
(paren
id|dev
comma
id|state_table
(braket
id|cur_state
)braket
(braket
id|new_state
)braket
dot
id|trans
comma
id|qp-&gt;qpn
comma
l_int|0
comma
id|qp_param
comma
l_int|0
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;modify QP %d returned status %02x.&bslash;n&quot;
comma
id|state_table
(braket
id|cur_state
)braket
(braket
id|new_state
)braket
dot
id|trans
comma
id|status
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|qp-&gt;state
op_assign
id|new_state
suffix:semicolon
id|kfree
c_func
(paren
id|mailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_sqp
c_func
(paren
id|dev
comma
id|qp
)paren
)paren
id|store_attrs
c_func
(paren
id|to_msqp
c_func
(paren
id|qp
)paren
comma
id|attr
comma
id|attr_mask
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we are moving QP0 to RTR, bring the IB link up; if we&n;&t; * are moving QP0 to RESET or ERROR, bring the link back down.&n;&t; */
r_if
c_cond
(paren
id|is_qp0
c_func
(paren
id|dev
comma
id|qp
)paren
)paren
(brace
r_if
c_cond
(paren
id|cur_state
op_ne
id|IB_QPS_RTR
op_logical_and
id|new_state
op_eq
id|IB_QPS_RTR
)paren
id|init_port
c_func
(paren
id|dev
comma
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur_state
op_ne
id|IB_QPS_RESET
op_logical_and
id|cur_state
op_ne
id|IB_QPS_ERR
op_logical_and
(paren
id|new_state
op_eq
id|IB_QPS_RESET
op_logical_or
id|new_state
op_eq
id|IB_QPS_ERR
)paren
)paren
id|mthca_CLOSE_IB
c_func
(paren
id|dev
comma
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|port
comma
op_amp
id|status
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate and register buffer for WQEs.  qp-&gt;rq.max, sq.max,&n; * rq.max_gs and sq.max_gs must all be assigned.&n; * mthca_alloc_wqe_buf will calculate rq.wqe_shift and&n; * sq.wqe_shift (as well as send_wqe_offset, is_direct, and&n; * queue)&n; */
DECL|function|mthca_alloc_wqe_buf
r_static
r_int
id|mthca_alloc_wqe_buf
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_pd
op_star
id|pd
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|npages
comma
id|shift
suffix:semicolon
id|dma_addr_t
id|t
suffix:semicolon
id|u64
op_star
id|dma_list
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
op_plus
id|qp-&gt;rq.max_gs
op_star
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|qp-&gt;rq.wqe_shift
op_assign
l_int|6
suffix:semicolon
l_int|1
op_lshift
id|qp-&gt;rq.wqe_shift
OL
id|size
suffix:semicolon
id|qp-&gt;rq.wqe_shift
op_increment
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|size
op_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
op_plus
id|qp-&gt;sq.max_gs
op_star
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|qp-&gt;transport
)paren
(brace
r_case
id|MLX
suffix:colon
id|size
op_add_assign
l_int|2
op_star
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|UD
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_arbel_ud_seg
)paren
suffix:semicolon
r_else
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_tavor_ud_seg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* bind seg is as big as atomic + raddr segs */
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_bind_seg
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|qp-&gt;sq.wqe_shift
op_assign
l_int|6
suffix:semicolon
l_int|1
op_lshift
id|qp-&gt;sq.wqe_shift
OL
id|size
suffix:semicolon
id|qp-&gt;sq.wqe_shift
op_increment
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|qp-&gt;send_wqe_offset
op_assign
id|ALIGN
c_func
(paren
id|qp-&gt;rq.max
op_lshift
id|qp-&gt;rq.wqe_shift
comma
l_int|1
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|qp-&gt;send_wqe_offset
op_plus
(paren
id|qp-&gt;sq.max
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
)paren
suffix:semicolon
id|qp-&gt;wrid
op_assign
id|kmalloc
c_func
(paren
(paren
id|qp-&gt;rq.max
op_plus
id|qp-&gt;sq.max
)paren
op_star
r_sizeof
(paren
id|u64
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp-&gt;wrid
)paren
r_goto
id|err_out
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|MTHCA_MAX_DIRECT_QP_SIZE
)paren
(brace
id|qp-&gt;is_direct
op_assign
l_int|1
suffix:semicolon
id|npages
op_assign
l_int|1
suffix:semicolon
id|shift
op_assign
id|get_order
c_func
(paren
id|size
)paren
op_plus
id|PAGE_SHIFT
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Creating direct QP of size %d (shift %d)&bslash;n&quot;
comma
id|size
comma
id|shift
)paren
suffix:semicolon
id|qp-&gt;queue.direct.buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|size
comma
op_amp
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp-&gt;queue.direct.buf
)paren
r_goto
id|err_out
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|qp-&gt;queue.direct
comma
id|mapping
comma
id|t
)paren
suffix:semicolon
id|memset
c_func
(paren
id|qp-&gt;queue.direct.buf
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_while
c_loop
(paren
id|t
op_amp
(paren
(paren
l_int|1
op_lshift
id|shift
)paren
op_minus
l_int|1
)paren
)paren
(brace
op_decrement
id|shift
suffix:semicolon
id|npages
op_mul_assign
l_int|2
suffix:semicolon
)brace
id|dma_list
op_assign
id|kmalloc
c_func
(paren
id|npages
op_star
r_sizeof
op_star
id|dma_list
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma_list
)paren
r_goto
id|err_out_free
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
op_increment
id|i
)paren
id|dma_list
(braket
id|i
)braket
op_assign
id|t
op_plus
id|i
op_star
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
)brace
r_else
(brace
id|qp-&gt;is_direct
op_assign
l_int|0
suffix:semicolon
id|npages
op_assign
id|size
op_div
id|PAGE_SIZE
suffix:semicolon
id|shift
op_assign
id|PAGE_SHIFT
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
id|mthca_dbg
c_func
(paren
id|dev
comma
l_string|&quot;Creating indirect QP with %d pages&bslash;n&quot;
comma
id|npages
)paren
suffix:semicolon
id|dma_list
op_assign
id|kmalloc
c_func
(paren
id|npages
op_star
r_sizeof
op_star
id|dma_list
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma_list
)paren
r_goto
id|err_out
suffix:semicolon
id|qp-&gt;queue.page_list
op_assign
id|kmalloc
c_func
(paren
id|npages
op_star
r_sizeof
op_star
id|qp-&gt;queue.page_list
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp-&gt;queue.page_list
)paren
r_goto
id|err_out
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
op_increment
id|i
)paren
(brace
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|PAGE_SIZE
comma
op_amp
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
)paren
r_goto
id|err_out_free
suffix:semicolon
id|memset
c_func
(paren
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|qp-&gt;queue.page_list
(braket
id|i
)braket
comma
id|mapping
comma
id|t
)paren
suffix:semicolon
id|dma_list
(braket
id|i
)braket
op_assign
id|t
suffix:semicolon
)brace
)brace
id|err
op_assign
id|mthca_mr_alloc_phys
c_func
(paren
id|dev
comma
id|pd-&gt;pd_num
comma
id|dma_list
comma
id|shift
comma
id|npages
comma
l_int|0
comma
id|size
comma
id|MTHCA_MPT_FLAG_LOCAL_READ
comma
op_amp
id|qp-&gt;mr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_free
suffix:semicolon
id|kfree
c_func
(paren
id|dma_list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free
suffix:colon
r_if
c_cond
(paren
id|qp-&gt;is_direct
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|size
comma
id|qp-&gt;queue.direct.buf
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|qp-&gt;queue.direct
comma
id|mapping
)paren
)paren
suffix:semicolon
)brace
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
)paren
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|PAGE_SIZE
comma
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|qp-&gt;queue.page_list
(braket
id|i
)braket
comma
id|mapping
)paren
)paren
suffix:semicolon
)brace
id|err_out
suffix:colon
id|kfree
c_func
(paren
id|qp-&gt;wrid
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dma_list
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_alloc_memfree
r_static
r_int
id|mthca_alloc_memfree
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|ret
op_assign
id|mthca_table_get
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.qp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|mthca_table_get
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.eqp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_qpc
suffix:semicolon
id|qp-&gt;rq.db_index
op_assign
id|mthca_alloc_db
c_func
(paren
id|dev
comma
id|MTHCA_DB_TYPE_RQ
comma
id|qp-&gt;qpn
comma
op_amp
id|qp-&gt;rq.db
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;rq.db_index
OL
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_eqpc
suffix:semicolon
)brace
id|qp-&gt;sq.db_index
op_assign
id|mthca_alloc_db
c_func
(paren
id|dev
comma
id|MTHCA_DB_TYPE_SQ
comma
id|qp-&gt;qpn
comma
op_amp
id|qp-&gt;sq.db
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;sq.db_index
OL
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_rq_db
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|err_rq_db
suffix:colon
id|mthca_free_db
c_func
(paren
id|dev
comma
id|MTHCA_DB_TYPE_RQ
comma
id|qp-&gt;rq.db_index
)paren
suffix:semicolon
id|err_eqpc
suffix:colon
id|mthca_table_put
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.eqp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
id|err_qpc
suffix:colon
id|mthca_table_put
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.qp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|mthca_free_memfree
r_static
r_void
id|mthca_free_memfree
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
id|mthca_free_db
c_func
(paren
id|dev
comma
id|MTHCA_DB_TYPE_SQ
comma
id|qp-&gt;sq.db_index
)paren
suffix:semicolon
id|mthca_free_db
c_func
(paren
id|dev
comma
id|MTHCA_DB_TYPE_RQ
comma
id|qp-&gt;rq.db_index
)paren
suffix:semicolon
id|mthca_table_put
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.eqp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
id|mthca_table_put
c_func
(paren
id|dev
comma
id|dev-&gt;qp_table.qp_table
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
)brace
)brace
DECL|function|mthca_wq_init
r_static
r_void
id|mthca_wq_init
c_func
(paren
r_struct
id|mthca_wq
op_star
id|wq
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|wq-&gt;lock
)paren
suffix:semicolon
id|wq-&gt;next_ind
op_assign
l_int|0
suffix:semicolon
id|wq-&gt;last_comp
op_assign
id|wq-&gt;max
op_minus
l_int|1
suffix:semicolon
id|wq-&gt;head
op_assign
l_int|0
suffix:semicolon
id|wq-&gt;tail
op_assign
l_int|0
suffix:semicolon
id|wq-&gt;last
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|mthca_alloc_qp_common
r_static
r_int
id|mthca_alloc_qp_common
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_pd
op_star
id|pd
comma
r_struct
id|mthca_cq
op_star
id|send_cq
comma
r_struct
id|mthca_cq
op_star
id|recv_cq
comma
r_enum
id|ib_sig_type
id|send_policy
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_struct
id|mthca_next_seg
op_star
id|wqe
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|qp-&gt;refcount
comma
l_int|1
)paren
suffix:semicolon
id|qp-&gt;state
op_assign
id|IB_QPS_RESET
suffix:semicolon
id|qp-&gt;atomic_rd_en
op_assign
l_int|0
suffix:semicolon
id|qp-&gt;resp_depth
op_assign
l_int|0
suffix:semicolon
id|qp-&gt;sq_policy
op_assign
id|send_policy
suffix:semicolon
id|mthca_wq_init
c_func
(paren
op_amp
id|qp-&gt;sq
)paren
suffix:semicolon
id|mthca_wq_init
c_func
(paren
op_amp
id|qp-&gt;rq
)paren
suffix:semicolon
id|ret
op_assign
id|mthca_alloc_memfree
c_func
(paren
id|dev
comma
id|qp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|mthca_alloc_wqe_buf
c_func
(paren
id|dev
comma
id|pd
comma
id|qp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|mthca_free_memfree
c_func
(paren
id|dev
comma
id|qp
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|qp-&gt;rq.max
suffix:semicolon
op_increment
id|i
)paren
(brace
id|wqe
op_assign
id|get_recv_wqe
c_func
(paren
id|qp
comma
id|i
)paren
suffix:semicolon
id|wqe-&gt;nda_op
op_assign
id|cpu_to_be32
c_func
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|qp-&gt;rq.max
op_minus
l_int|1
)paren
)paren
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
suffix:semicolon
id|wqe-&gt;ee_nds
op_assign
id|cpu_to_be32
c_func
(paren
l_int|1
op_lshift
(paren
id|qp-&gt;rq.wqe_shift
op_minus
l_int|4
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|qp-&gt;sq.max
suffix:semicolon
op_increment
id|i
)paren
(brace
id|wqe
op_assign
id|get_send_wqe
c_func
(paren
id|qp
comma
id|i
)paren
suffix:semicolon
id|wqe-&gt;nda_op
op_assign
id|cpu_to_be32
c_func
(paren
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|qp-&gt;sq.max
op_minus
l_int|1
)paren
)paren
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
op_plus
id|qp-&gt;send_wqe_offset
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_align_qp_size
r_static
r_void
id|mthca_align_qp_size
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_ne
id|ARBEL_NATIVE
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
l_int|1
op_lshift
id|i
OL
id|qp-&gt;rq.max
suffix:semicolon
op_increment
id|i
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|qp-&gt;rq.max
op_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
l_int|1
op_lshift
id|i
OL
id|qp-&gt;sq.max
suffix:semicolon
op_increment
id|i
)paren
suffix:semicolon
multiline_comment|/* nothing */
id|qp-&gt;sq.max
op_assign
l_int|1
op_lshift
id|i
suffix:semicolon
)brace
DECL|function|mthca_alloc_qp
r_int
id|mthca_alloc_qp
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_pd
op_star
id|pd
comma
r_struct
id|mthca_cq
op_star
id|send_cq
comma
r_struct
id|mthca_cq
op_star
id|recv_cq
comma
r_enum
id|ib_qp_type
id|type
comma
r_enum
id|ib_sig_type
id|send_policy
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
r_int
id|err
suffix:semicolon
id|mthca_align_qp_size
c_func
(paren
id|dev
comma
id|qp
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IB_QPT_RC
suffix:colon
id|qp-&gt;transport
op_assign
id|RC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_QPT_UC
suffix:colon
id|qp-&gt;transport
op_assign
id|UC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_QPT_UD
suffix:colon
id|qp-&gt;transport
op_assign
id|UD
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|qp-&gt;qpn
op_assign
id|mthca_alloc
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;qpn
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|mthca_alloc_qp_common
c_func
(paren
id|dev
comma
id|pd
comma
id|send_cq
comma
id|recv_cq
comma
id|send_policy
comma
id|qp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|mthca_free
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
id|mthca_array_set
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|qp-&gt;qpn
op_amp
(paren
id|dev-&gt;limits.num_qps
op_minus
l_int|1
)paren
comma
id|qp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_alloc_sqp
r_int
id|mthca_alloc_sqp
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_pd
op_star
id|pd
comma
r_struct
id|mthca_cq
op_star
id|send_cq
comma
r_struct
id|mthca_cq
op_star
id|recv_cq
comma
r_enum
id|ib_sig_type
id|send_policy
comma
r_int
id|qpn
comma
r_int
id|port
comma
r_struct
id|mthca_sqp
op_star
id|sqp
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u32
id|mqpn
op_assign
id|qpn
op_star
l_int|2
op_plus
id|dev-&gt;qp_table.sqp_start
op_plus
id|port
op_minus
l_int|1
suffix:semicolon
id|mthca_align_qp_size
c_func
(paren
id|dev
comma
op_amp
id|sqp-&gt;qp
)paren
suffix:semicolon
id|sqp-&gt;header_buf_size
op_assign
id|sqp-&gt;qp.sq.max
op_star
id|MTHCA_UD_HEADER_SIZE
suffix:semicolon
id|sqp-&gt;header_buf
op_assign
id|dma_alloc_coherent
c_func
(paren
op_amp
id|dev-&gt;pdev-&gt;dev
comma
id|sqp-&gt;header_buf_size
comma
op_amp
id|sqp-&gt;header_dma
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sqp-&gt;header_buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mthca_array_get
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|mqpn
)paren
)paren
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_else
id|mthca_array_set
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|mqpn
comma
id|sqp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out
suffix:semicolon
id|sqp-&gt;port
op_assign
id|port
suffix:semicolon
id|sqp-&gt;qp.qpn
op_assign
id|mqpn
suffix:semicolon
id|sqp-&gt;qp.transport
op_assign
id|MLX
suffix:semicolon
id|err
op_assign
id|mthca_alloc_qp_common
c_func
(paren
id|dev
comma
id|pd
comma
id|send_cq
comma
id|recv_cq
comma
id|send_policy
comma
op_amp
id|sqp-&gt;qp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_free
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|pd-&gt;sqp_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free
suffix:colon
multiline_comment|/*&n;&t; * Lock CQs here, so that CQ polling code can do QP lookup&n;&t; * without taking a lock.&n;&t; */
id|spin_lock_irq
c_func
(paren
op_amp
id|send_cq-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_cq
op_ne
id|recv_cq
)paren
id|spin_lock
c_func
(paren
op_amp
id|recv_cq-&gt;lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
id|mthca_array_clear
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|mqpn
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_cq
op_ne
id|recv_cq
)paren
id|spin_unlock
c_func
(paren
op_amp
id|recv_cq-&gt;lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|send_cq-&gt;lock
)paren
suffix:semicolon
id|err_out
suffix:colon
id|dma_free_coherent
c_func
(paren
op_amp
id|dev-&gt;pdev-&gt;dev
comma
id|sqp-&gt;header_buf_size
comma
id|sqp-&gt;header_buf
comma
id|sqp-&gt;header_dma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_free_qp
r_void
id|mthca_free_qp
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
)paren
(brace
id|u8
id|status
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|mthca_cq
op_star
id|send_cq
suffix:semicolon
r_struct
id|mthca_cq
op_star
id|recv_cq
suffix:semicolon
id|send_cq
op_assign
id|to_mcq
c_func
(paren
id|qp-&gt;ibqp.send_cq
)paren
suffix:semicolon
id|recv_cq
op_assign
id|to_mcq
c_func
(paren
id|qp-&gt;ibqp.recv_cq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Lock CQs here, so that CQ polling code can do QP lookup&n;&t; * without taking a lock.&n;&t; */
id|spin_lock_irq
c_func
(paren
op_amp
id|send_cq-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_cq
op_ne
id|recv_cq
)paren
id|spin_lock
c_func
(paren
op_amp
id|recv_cq-&gt;lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
id|mthca_array_clear
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|qp-&gt;qpn
op_amp
(paren
id|dev-&gt;limits.num_qps
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_cq
op_ne
id|recv_cq
)paren
id|spin_unlock
c_func
(paren
op_amp
id|recv_cq-&gt;lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|send_cq-&gt;lock
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|qp-&gt;refcount
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|qp-&gt;wait
comma
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|qp-&gt;refcount
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;state
op_ne
id|IB_QPS_RESET
)paren
id|mthca_MODIFY_QP
c_func
(paren
id|dev
comma
id|MTHCA_TRANS_ANY2RST
comma
id|qp-&gt;qpn
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|status
)paren
suffix:semicolon
id|mthca_cq_clean
c_func
(paren
id|dev
comma
id|to_mcq
c_func
(paren
id|qp-&gt;ibqp.send_cq
)paren
op_member_access_from_pointer
id|cqn
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;ibqp.send_cq
op_ne
id|qp-&gt;ibqp.recv_cq
)paren
id|mthca_cq_clean
c_func
(paren
id|dev
comma
id|to_mcq
c_func
(paren
id|qp-&gt;ibqp.recv_cq
)paren
op_member_access_from_pointer
id|cqn
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
id|mthca_free_mr
c_func
(paren
id|dev
comma
op_amp
id|qp-&gt;mr
)paren
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|qp-&gt;send_wqe_offset
op_plus
(paren
id|qp-&gt;sq.max
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qp-&gt;is_direct
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|size
comma
id|qp-&gt;queue.direct.buf
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|qp-&gt;queue.direct
comma
id|mapping
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
op_div
id|PAGE_SIZE
suffix:semicolon
op_increment
id|i
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev-&gt;pdev
comma
id|PAGE_SIZE
comma
id|qp-&gt;queue.page_list
(braket
id|i
)braket
dot
id|buf
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|qp-&gt;queue.page_list
(braket
id|i
)braket
comma
id|mapping
)paren
)paren
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|qp-&gt;wrid
)paren
suffix:semicolon
id|mthca_free_memfree
c_func
(paren
id|dev
comma
id|qp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_sqp
c_func
(paren
id|dev
comma
id|qp
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
(paren
id|to_mpd
c_func
(paren
id|qp-&gt;ibqp.pd
)paren
op_member_access_from_pointer
id|sqp_count
)paren
)paren
suffix:semicolon
id|dma_free_coherent
c_func
(paren
op_amp
id|dev-&gt;pdev-&gt;dev
comma
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|header_buf_size
comma
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|header_buf
comma
id|to_msqp
c_func
(paren
id|qp
)paren
op_member_access_from_pointer
id|header_dma
)paren
suffix:semicolon
)brace
r_else
id|mthca_free
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
comma
id|qp-&gt;qpn
)paren
suffix:semicolon
)brace
multiline_comment|/* Create UD header for an MLX send and build a data segment for it */
DECL|function|build_mlx_header
r_static
r_int
id|build_mlx_header
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_sqp
op_star
id|sqp
comma
r_int
id|ind
comma
r_struct
id|ib_send_wr
op_star
id|wr
comma
r_struct
id|mthca_mlx_seg
op_star
id|mlx
comma
r_struct
id|mthca_data_seg
op_star
id|data
)paren
(brace
r_int
id|header_size
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ib_ud_header_init
c_func
(paren
l_int|256
comma
multiline_comment|/* assume a MAD */
id|sqp-&gt;ud_header.grh_present
comma
op_amp
id|sqp-&gt;ud_header
)paren
suffix:semicolon
id|err
op_assign
id|mthca_read_ah
c_func
(paren
id|dev
comma
id|to_mah
c_func
(paren
id|wr-&gt;wr.ud.ah
)paren
comma
op_amp
id|sqp-&gt;ud_header
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|mlx-&gt;flags
op_and_assign
op_complement
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_SOLICIT
op_or
l_int|1
)paren
suffix:semicolon
id|mlx-&gt;flags
op_or_assign
id|cpu_to_be32
c_func
(paren
(paren
op_logical_neg
id|sqp-&gt;qp.ibqp.qp_num
ques
c_cond
id|MTHCA_MLX_VL15
suffix:colon
l_int|0
)paren
op_or
(paren
id|sqp-&gt;ud_header.lrh.destination_lid
op_eq
l_int|0xffff
ques
c_cond
id|MTHCA_MLX_SLR
suffix:colon
l_int|0
)paren
op_or
(paren
id|sqp-&gt;ud_header.lrh.service_level
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|mlx-&gt;rlid
op_assign
id|sqp-&gt;ud_header.lrh.destination_lid
suffix:semicolon
id|mlx-&gt;vcrc
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|wr-&gt;opcode
)paren
(brace
r_case
id|IB_WR_SEND
suffix:colon
id|sqp-&gt;ud_header.bth.opcode
op_assign
id|IB_OPCODE_UD_SEND_ONLY
suffix:semicolon
id|sqp-&gt;ud_header.immediate_present
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_WR_SEND_WITH_IMM
suffix:colon
id|sqp-&gt;ud_header.bth.opcode
op_assign
id|IB_OPCODE_UD_SEND_ONLY_WITH_IMMEDIATE
suffix:semicolon
id|sqp-&gt;ud_header.immediate_present
op_assign
l_int|1
suffix:semicolon
id|sqp-&gt;ud_header.immediate_data
op_assign
id|wr-&gt;imm_data
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sqp-&gt;ud_header.lrh.virtual_lane
op_assign
op_logical_neg
id|sqp-&gt;qp.ibqp.qp_num
ques
c_cond
l_int|15
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sqp-&gt;ud_header.lrh.destination_lid
op_eq
l_int|0xffff
)paren
id|sqp-&gt;ud_header.lrh.source_lid
op_assign
l_int|0xffff
suffix:semicolon
id|sqp-&gt;ud_header.bth.solicited_event
op_assign
op_logical_neg
op_logical_neg
(paren
id|wr-&gt;send_flags
op_amp
id|IB_SEND_SOLICITED
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sqp-&gt;qp.ibqp.qp_num
)paren
id|ib_get_cached_pkey
c_func
(paren
op_amp
id|dev-&gt;ib_dev
comma
id|sqp-&gt;port
comma
id|sqp-&gt;pkey_index
comma
op_amp
id|sqp-&gt;ud_header.bth.pkey
)paren
suffix:semicolon
r_else
id|ib_get_cached_pkey
c_func
(paren
op_amp
id|dev-&gt;ib_dev
comma
id|sqp-&gt;port
comma
id|wr-&gt;wr.ud.pkey_index
comma
op_amp
id|sqp-&gt;ud_header.bth.pkey
)paren
suffix:semicolon
id|cpu_to_be16s
c_func
(paren
op_amp
id|sqp-&gt;ud_header.bth.pkey
)paren
suffix:semicolon
id|sqp-&gt;ud_header.bth.destination_qpn
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qpn
)paren
suffix:semicolon
id|sqp-&gt;ud_header.bth.psn
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|sqp-&gt;send_psn
op_increment
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
l_int|24
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|sqp-&gt;ud_header.deth.qkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qkey
op_amp
l_int|0x80000000
ques
c_cond
id|sqp-&gt;qkey
suffix:colon
id|wr-&gt;wr.ud.remote_qkey
)paren
suffix:semicolon
id|sqp-&gt;ud_header.deth.source_qpn
op_assign
id|cpu_to_be32
c_func
(paren
id|sqp-&gt;qp.ibqp.qp_num
)paren
suffix:semicolon
id|header_size
op_assign
id|ib_ud_header_pack
c_func
(paren
op_amp
id|sqp-&gt;ud_header
comma
id|sqp-&gt;header_buf
op_plus
id|ind
op_star
id|MTHCA_UD_HEADER_SIZE
)paren
suffix:semicolon
id|data-&gt;byte_count
op_assign
id|cpu_to_be32
c_func
(paren
id|header_size
)paren
suffix:semicolon
id|data-&gt;lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|to_mpd
c_func
(paren
id|sqp-&gt;qp.ibqp.pd
)paren
op_member_access_from_pointer
id|ntmr.ibmr.lkey
)paren
suffix:semicolon
id|data-&gt;addr
op_assign
id|cpu_to_be64
c_func
(paren
id|sqp-&gt;header_dma
op_plus
id|ind
op_star
id|MTHCA_UD_HEADER_SIZE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_wq_overflow
r_static
r_inline
r_int
id|mthca_wq_overflow
c_func
(paren
r_struct
id|mthca_wq
op_star
id|wq
comma
r_int
id|nreq
comma
r_struct
id|ib_cq
op_star
id|ib_cq
)paren
(brace
r_int
id|cur
suffix:semicolon
r_struct
id|mthca_cq
op_star
id|cq
suffix:semicolon
id|cur
op_assign
id|wq-&gt;head
op_minus
id|wq-&gt;tail
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|cur
op_plus
id|nreq
OL
id|wq-&gt;max
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|cq
op_assign
id|to_mcq
c_func
(paren
id|ib_cq
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cq-&gt;lock
)paren
suffix:semicolon
id|cur
op_assign
id|wq-&gt;head
op_minus
id|wq-&gt;tail
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|cq-&gt;lock
)paren
suffix:semicolon
r_return
id|cur
op_plus
id|nreq
op_ge
id|wq-&gt;max
suffix:semicolon
)brace
DECL|function|mthca_tavor_post_send
r_int
id|mthca_tavor_post_send
c_func
(paren
r_struct
id|ib_qp
op_star
id|ibqp
comma
r_struct
id|ib_send_wr
op_star
id|wr
comma
r_struct
id|ib_send_wr
op_star
op_star
id|bad_wr
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|to_mdev
c_func
(paren
id|ibqp-&gt;device
)paren
suffix:semicolon
r_struct
id|mthca_qp
op_star
id|qp
op_assign
id|to_mqp
c_func
(paren
id|ibqp
)paren
suffix:semicolon
r_void
op_star
id|wqe
suffix:semicolon
r_void
op_star
id|prev_wqe
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|nreq
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|size0
op_assign
l_int|0
suffix:semicolon
id|u32
id|f0
op_assign
l_int|0
suffix:semicolon
r_int
id|ind
suffix:semicolon
id|u8
id|op0
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|qp-&gt;sq.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* XXX check that state is OK to post send */
id|ind
op_assign
id|qp-&gt;sq.next_ind
suffix:semicolon
r_for
c_loop
(paren
id|nreq
op_assign
l_int|0
suffix:semicolon
id|wr
suffix:semicolon
op_increment
id|nreq
comma
id|wr
op_assign
id|wr-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|mthca_wq_overflow
c_func
(paren
op_amp
id|qp-&gt;sq
comma
id|nreq
comma
id|qp-&gt;ibqp.send_cq
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;SQ %06x full (%u head, %u tail,&quot;
l_string|&quot; %d max, %d nreq)&bslash;n&quot;
comma
id|qp-&gt;qpn
comma
id|qp-&gt;sq.head
comma
id|qp-&gt;sq.tail
comma
id|qp-&gt;sq.max
comma
id|nreq
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_assign
id|get_send_wqe
c_func
(paren
id|qp
comma
id|ind
)paren
suffix:semicolon
id|prev_wqe
op_assign
id|qp-&gt;sq.last
suffix:semicolon
id|qp-&gt;sq.last
op_assign
id|wqe
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|nda_op
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|ee_nds
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
(paren
(paren
id|wr-&gt;send_flags
op_amp
id|IB_SEND_SIGNALED
)paren
ques
c_cond
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_CQ_UPDATE
)paren
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|wr-&gt;send_flags
op_amp
id|IB_SEND_SOLICITED
)paren
ques
c_cond
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_SOLICIT
)paren
suffix:colon
l_int|0
)paren
op_or
id|cpu_to_be32
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wr-&gt;opcode
op_eq
id|IB_WR_SEND_WITH_IMM
op_logical_or
id|wr-&gt;opcode
op_eq
id|IB_WR_RDMA_WRITE_WITH_IMM
)paren
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
id|wr-&gt;imm_data
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
op_div
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|qp-&gt;transport
)paren
(brace
r_case
id|RC
suffix:colon
r_switch
c_cond
(paren
id|wr-&gt;opcode
)paren
(brace
r_case
id|IB_WR_ATOMIC_CMP_AND_SWP
suffix:colon
r_case
id|IB_WR_ATOMIC_FETCH_AND_ADD
suffix:colon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|raddr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;wr.atomic.remote_addr
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|rkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.atomic.rkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|reserved
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_raddr_seg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wr-&gt;opcode
op_eq
id|IB_WR_ATOMIC_CMP_AND_SWP
)paren
(brace
(paren
(paren
r_struct
id|mthca_atomic_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|swap_add
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;wr.atomic.swap
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_atomic_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|compare
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;wr.atomic.compare_add
)paren
suffix:semicolon
)brace
r_else
(brace
(paren
(paren
r_struct
id|mthca_atomic_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|swap_add
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;wr.atomic.compare_add
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_atomic_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|compare
op_assign
l_int|0
suffix:semicolon
)brace
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_atomic_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_raddr_seg
)paren
op_div
l_int|16
op_plus
r_sizeof
(paren
r_struct
id|mthca_atomic_seg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IB_WR_RDMA_WRITE
suffix:colon
r_case
id|IB_WR_RDMA_WRITE_WITH_IMM
suffix:colon
r_case
id|IB_WR_RDMA_READ
suffix:colon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|raddr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;wr.rdma.remote_addr
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|rkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.rdma.rkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_raddr_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|reserved
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_raddr_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_raddr_seg
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* No extra segments required for sends */
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|UD
suffix:colon
(paren
(paren
r_struct
id|mthca_tavor_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|to_mah
c_func
(paren
id|wr-&gt;wr.ud.ah
)paren
op_member_access_from_pointer
id|key
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_tavor_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|av_addr
op_assign
id|cpu_to_be64
c_func
(paren
id|to_mah
c_func
(paren
id|wr-&gt;wr.ud.ah
)paren
op_member_access_from_pointer
id|avdma
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_tavor_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|dqpn
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qpn
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_tavor_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|qkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qkey
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_tavor_ud_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_tavor_ud_seg
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MLX
suffix:colon
id|err
op_assign
id|build_mlx_header
c_func
(paren
id|dev
comma
id|to_msqp
c_func
(paren
id|qp
)paren
comma
id|ind
comma
id|wr
comma
id|wqe
op_minus
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
comma
id|wqe
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wr-&gt;num_sge
OG
id|qp-&gt;sq.max_gs
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;too many gathers&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wr-&gt;num_sge
suffix:semicolon
op_increment
id|i
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|lkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|addr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
)brace
multiline_comment|/* Add one more inline data segment for ICRC */
r_if
c_cond
(paren
id|qp-&gt;transport
op_eq
id|MLX
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
(paren
l_int|1
op_lshift
l_int|31
)paren
op_or
l_int|4
)paren
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|wqe
)paren
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
)brace
id|qp-&gt;wrid
(braket
id|ind
op_plus
id|qp-&gt;rq.max
)braket
op_assign
id|wr-&gt;wr_id
suffix:semicolon
r_if
c_cond
(paren
id|wr-&gt;opcode
op_ge
id|ARRAY_SIZE
c_func
(paren
id|mthca_opcode
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;opcode invalid&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prev_wqe
)paren
(brace
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|nda_op
op_assign
id|cpu_to_be32
c_func
(paren
(paren
(paren
id|ind
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
op_plus
id|qp-&gt;send_wqe_offset
)paren
op_or
id|mthca_opcode
(braket
id|wr-&gt;opcode
)braket
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|ee_nds
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|size0
ques
c_cond
l_int|0
suffix:colon
id|MTHCA_NEXT_DBD
)paren
op_or
id|size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|size0
)paren
(brace
id|size0
op_assign
id|size
suffix:semicolon
id|op0
op_assign
id|mthca_opcode
(braket
id|wr-&gt;opcode
)braket
suffix:semicolon
)brace
op_increment
id|ind
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ind
op_ge
id|qp-&gt;sq.max
)paren
)paren
id|ind
op_sub_assign
id|qp-&gt;sq.max
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|nreq
)paren
)paren
(brace
id|u32
id|doorbell
(braket
l_int|2
)braket
suffix:semicolon
id|doorbell
(braket
l_int|0
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
(paren
id|qp-&gt;sq.next_ind
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
op_plus
id|qp-&gt;send_wqe_offset
)paren
op_or
id|f0
op_or
id|op0
)paren
suffix:semicolon
id|doorbell
(braket
l_int|1
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|qp-&gt;qpn
op_lshift
l_int|8
)paren
op_or
id|size0
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|mthca_write64
c_func
(paren
id|doorbell
comma
id|dev-&gt;kar
op_plus
id|MTHCA_SEND_DOORBELL
comma
id|MTHCA_GET_DOORBELL_LOCK
c_func
(paren
op_amp
id|dev-&gt;doorbell_lock
)paren
)paren
suffix:semicolon
)brace
id|qp-&gt;sq.next_ind
op_assign
id|ind
suffix:semicolon
id|qp-&gt;sq.head
op_add_assign
id|nreq
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|qp-&gt;sq.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_tavor_post_receive
r_int
id|mthca_tavor_post_receive
c_func
(paren
r_struct
id|ib_qp
op_star
id|ibqp
comma
r_struct
id|ib_recv_wr
op_star
id|wr
comma
r_struct
id|ib_recv_wr
op_star
op_star
id|bad_wr
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|to_mdev
c_func
(paren
id|ibqp-&gt;device
)paren
suffix:semicolon
r_struct
id|mthca_qp
op_star
id|qp
op_assign
id|to_mqp
c_func
(paren
id|ibqp
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|nreq
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|size0
op_assign
l_int|0
suffix:semicolon
r_int
id|ind
suffix:semicolon
r_void
op_star
id|wqe
suffix:semicolon
r_void
op_star
id|prev_wqe
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|qp-&gt;rq.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* XXX check that state is OK to post receive */
id|ind
op_assign
id|qp-&gt;rq.next_ind
suffix:semicolon
r_for
c_loop
(paren
id|nreq
op_assign
l_int|0
suffix:semicolon
id|wr
suffix:semicolon
op_increment
id|nreq
comma
id|wr
op_assign
id|wr-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|mthca_wq_overflow
c_func
(paren
op_amp
id|qp-&gt;rq
comma
id|nreq
comma
id|qp-&gt;ibqp.recv_cq
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;RQ %06x full (%u head, %u tail,&quot;
l_string|&quot; %d max, %d nreq)&bslash;n&quot;
comma
id|qp-&gt;qpn
comma
id|qp-&gt;rq.head
comma
id|qp-&gt;rq.tail
comma
id|qp-&gt;rq.max
comma
id|nreq
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_assign
id|get_recv_wqe
c_func
(paren
id|qp
comma
id|ind
)paren
suffix:semicolon
id|prev_wqe
op_assign
id|qp-&gt;rq.last
suffix:semicolon
id|qp-&gt;rq.last
op_assign
id|wqe
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|nda_op
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|ee_nds
op_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_DBD
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
op_div
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|wr-&gt;num_sge
OG
id|qp-&gt;rq.max_gs
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wr-&gt;num_sge
suffix:semicolon
op_increment
id|i
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|lkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|addr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
)brace
id|qp-&gt;wrid
(braket
id|ind
)braket
op_assign
id|wr-&gt;wr_id
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|prev_wqe
)paren
)paren
(brace
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|nda_op
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|ind
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|ee_nds
op_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_DBD
op_or
id|size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|size0
)paren
id|size0
op_assign
id|size
suffix:semicolon
op_increment
id|ind
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ind
op_ge
id|qp-&gt;rq.max
)paren
)paren
id|ind
op_sub_assign
id|qp-&gt;rq.max
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|nreq
)paren
)paren
(brace
id|u32
id|doorbell
(braket
l_int|2
)braket
suffix:semicolon
id|doorbell
(braket
l_int|0
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|qp-&gt;rq.next_ind
op_lshift
id|qp-&gt;rq.wqe_shift
)paren
op_or
id|size0
)paren
suffix:semicolon
id|doorbell
(braket
l_int|1
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|qp-&gt;qpn
op_lshift
l_int|8
)paren
op_or
id|nreq
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|mthca_write64
c_func
(paren
id|doorbell
comma
id|dev-&gt;kar
op_plus
id|MTHCA_RECEIVE_DOORBELL
comma
id|MTHCA_GET_DOORBELL_LOCK
c_func
(paren
op_amp
id|dev-&gt;doorbell_lock
)paren
)paren
suffix:semicolon
)brace
id|qp-&gt;rq.next_ind
op_assign
id|ind
suffix:semicolon
id|qp-&gt;rq.head
op_add_assign
id|nreq
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|qp-&gt;rq.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_arbel_post_send
r_int
id|mthca_arbel_post_send
c_func
(paren
r_struct
id|ib_qp
op_star
id|ibqp
comma
r_struct
id|ib_send_wr
op_star
id|wr
comma
r_struct
id|ib_send_wr
op_star
op_star
id|bad_wr
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|to_mdev
c_func
(paren
id|ibqp-&gt;device
)paren
suffix:semicolon
r_struct
id|mthca_qp
op_star
id|qp
op_assign
id|to_mqp
c_func
(paren
id|ibqp
)paren
suffix:semicolon
r_void
op_star
id|wqe
suffix:semicolon
r_void
op_star
id|prev_wqe
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|nreq
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|size0
op_assign
l_int|0
suffix:semicolon
id|u32
id|f0
op_assign
l_int|0
suffix:semicolon
r_int
id|ind
suffix:semicolon
id|u8
id|op0
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|qp-&gt;sq.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* XXX check that state is OK to post send */
id|ind
op_assign
id|qp-&gt;sq.head
op_amp
(paren
id|qp-&gt;sq.max
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nreq
op_assign
l_int|0
suffix:semicolon
id|wr
suffix:semicolon
op_increment
id|nreq
comma
id|wr
op_assign
id|wr-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|mthca_wq_overflow
c_func
(paren
op_amp
id|qp-&gt;sq
comma
id|nreq
comma
id|qp-&gt;ibqp.send_cq
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;SQ %06x full (%u head, %u tail,&quot;
l_string|&quot; %d max, %d nreq)&bslash;n&quot;
comma
id|qp-&gt;qpn
comma
id|qp-&gt;sq.head
comma
id|qp-&gt;sq.tail
comma
id|qp-&gt;sq.max
comma
id|nreq
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_assign
id|get_send_wqe
c_func
(paren
id|qp
comma
id|ind
)paren
suffix:semicolon
id|prev_wqe
op_assign
id|qp-&gt;sq.last
suffix:semicolon
id|qp-&gt;sq.last
op_assign
id|wqe
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
(paren
(paren
id|wr-&gt;send_flags
op_amp
id|IB_SEND_SIGNALED
)paren
ques
c_cond
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_CQ_UPDATE
)paren
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|wr-&gt;send_flags
op_amp
id|IB_SEND_SOLICITED
)paren
ques
c_cond
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_SOLICIT
)paren
suffix:colon
l_int|0
)paren
op_or
id|cpu_to_be32
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wr-&gt;opcode
op_eq
id|IB_WR_SEND_WITH_IMM
op_logical_or
id|wr-&gt;opcode
op_eq
id|IB_WR_RDMA_WRITE_WITH_IMM
)paren
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
id|wr-&gt;imm_data
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
op_div
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|qp-&gt;transport
)paren
(brace
r_case
id|UD
suffix:colon
id|memcpy
c_func
(paren
(paren
(paren
r_struct
id|mthca_arbel_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|av
comma
id|to_mah
c_func
(paren
id|wr-&gt;wr.ud.ah
)paren
op_member_access_from_pointer
id|av
comma
id|MTHCA_AV_SIZE
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_arbel_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|dqpn
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qpn
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_arbel_ud_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|qkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;wr.ud.remote_qkey
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_arbel_ud_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_arbel_ud_seg
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MLX
suffix:colon
id|err
op_assign
id|build_mlx_header
c_func
(paren
id|dev
comma
id|to_msqp
c_func
(paren
id|qp
)paren
comma
id|ind
comma
id|wr
comma
id|wqe
op_minus
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
comma
id|wqe
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wr-&gt;num_sge
OG
id|qp-&gt;sq.max_gs
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;too many gathers&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wr-&gt;num_sge
suffix:semicolon
op_increment
id|i
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|lkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|addr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
)brace
multiline_comment|/* Add one more inline data segment for ICRC */
r_if
c_cond
(paren
id|qp-&gt;transport
op_eq
id|MLX
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
(paren
l_int|1
op_lshift
l_int|31
)paren
op_or
l_int|4
)paren
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|wqe
)paren
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
op_div
l_int|16
suffix:semicolon
)brace
id|qp-&gt;wrid
(braket
id|ind
op_plus
id|qp-&gt;rq.max
)braket
op_assign
id|wr-&gt;wr_id
suffix:semicolon
r_if
c_cond
(paren
id|wr-&gt;opcode
op_ge
id|ARRAY_SIZE
c_func
(paren
id|mthca_opcode
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;opcode invalid&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|prev_wqe
)paren
)paren
(brace
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|nda_op
op_assign
id|cpu_to_be32
c_func
(paren
(paren
(paren
id|ind
op_lshift
id|qp-&gt;sq.wqe_shift
)paren
op_plus
id|qp-&gt;send_wqe_offset
)paren
op_or
id|mthca_opcode
(braket
id|wr-&gt;opcode
)braket
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|prev_wqe
)paren
op_member_access_from_pointer
id|ee_nds
op_assign
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_DBD
op_or
id|size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|size0
)paren
(brace
id|size0
op_assign
id|size
suffix:semicolon
id|op0
op_assign
id|mthca_opcode
(braket
id|wr-&gt;opcode
)braket
suffix:semicolon
)brace
op_increment
id|ind
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ind
op_ge
id|qp-&gt;sq.max
)paren
)paren
id|ind
op_sub_assign
id|qp-&gt;sq.max
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|nreq
)paren
)paren
(brace
id|u32
id|doorbell
(braket
l_int|2
)braket
suffix:semicolon
id|doorbell
(braket
l_int|0
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|nreq
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|qp-&gt;sq.head
op_amp
l_int|0xffff
)paren
op_lshift
l_int|8
)paren
op_or
id|f0
op_or
id|op0
)paren
suffix:semicolon
id|doorbell
(braket
l_int|1
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|qp-&gt;qpn
op_lshift
l_int|8
)paren
op_or
id|size0
)paren
suffix:semicolon
id|qp-&gt;sq.head
op_add_assign
id|nreq
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Make sure that descriptors are written before&n;&t;&t; * doorbell record.&n;&t;&t; */
id|wmb
c_func
(paren
)paren
suffix:semicolon
op_star
id|qp-&gt;sq.db
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;sq.head
op_amp
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Make sure doorbell record is written before we&n;&t;&t; * write MMIO send doorbell.&n;&t;&t; */
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|mthca_write64
c_func
(paren
id|doorbell
comma
id|dev-&gt;kar
op_plus
id|MTHCA_SEND_DOORBELL
comma
id|MTHCA_GET_DOORBELL_LOCK
c_func
(paren
op_amp
id|dev-&gt;doorbell_lock
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|qp-&gt;sq.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_arbel_post_receive
r_int
id|mthca_arbel_post_receive
c_func
(paren
r_struct
id|ib_qp
op_star
id|ibqp
comma
r_struct
id|ib_recv_wr
op_star
id|wr
comma
r_struct
id|ib_recv_wr
op_star
op_star
id|bad_wr
)paren
(brace
r_struct
id|mthca_dev
op_star
id|dev
op_assign
id|to_mdev
c_func
(paren
id|ibqp-&gt;device
)paren
suffix:semicolon
r_struct
id|mthca_qp
op_star
id|qp
op_assign
id|to_mqp
c_func
(paren
id|ibqp
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|nreq
suffix:semicolon
r_int
id|ind
suffix:semicolon
r_int
id|i
suffix:semicolon
r_void
op_star
id|wqe
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|qp-&gt;rq.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* XXX check that state is OK to post receive */
id|ind
op_assign
id|qp-&gt;rq.head
op_amp
(paren
id|qp-&gt;rq.max
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nreq
op_assign
l_int|0
suffix:semicolon
id|wr
suffix:semicolon
op_increment
id|nreq
comma
id|wr
op_assign
id|wr-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|mthca_wq_overflow
c_func
(paren
op_amp
id|qp-&gt;rq
comma
id|nreq
comma
id|qp-&gt;ibqp.recv_cq
)paren
)paren
(brace
id|mthca_err
c_func
(paren
id|dev
comma
l_string|&quot;RQ %06x full (%u head, %u tail,&quot;
l_string|&quot; %d max, %d nreq)&bslash;n&quot;
comma
id|qp-&gt;qpn
comma
id|qp-&gt;rq.head
comma
id|qp-&gt;rq.tail
comma
id|qp-&gt;rq.max
comma
id|nreq
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|wqe
op_assign
id|get_recv_wqe
c_func
(paren
id|qp
comma
id|ind
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_next_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|flags
op_assign
l_int|0
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_next_seg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|wr-&gt;num_sge
OG
id|qp-&gt;rq.max_gs
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
op_star
id|bad_wr
op_assign
id|wr
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wr-&gt;num_sge
suffix:semicolon
op_increment
id|i
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|length
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|lkey
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|addr
op_assign
id|cpu_to_be64
c_func
(paren
id|wr-&gt;sg_list
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
id|wqe
op_add_assign
r_sizeof
(paren
r_struct
id|mthca_data_seg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|qp-&gt;rq.max_gs
)paren
(brace
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|byte_count
op_assign
l_int|0
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|lkey
op_assign
id|cpu_to_be32
c_func
(paren
l_int|0x100
)paren
suffix:semicolon
(paren
(paren
r_struct
id|mthca_data_seg
op_star
)paren
id|wqe
)paren
op_member_access_from_pointer
id|addr
op_assign
l_int|0
suffix:semicolon
)brace
id|qp-&gt;wrid
(braket
id|ind
)braket
op_assign
id|wr-&gt;wr_id
suffix:semicolon
op_increment
id|ind
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ind
op_ge
id|qp-&gt;rq.max
)paren
)paren
id|ind
op_sub_assign
id|qp-&gt;rq.max
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|nreq
)paren
)paren
(brace
id|qp-&gt;rq.head
op_add_assign
id|nreq
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Make sure that descriptors are written before&n;&t;&t; * doorbell record.&n;&t;&t; */
id|wmb
c_func
(paren
)paren
suffix:semicolon
op_star
id|qp-&gt;rq.db
op_assign
id|cpu_to_be32
c_func
(paren
id|qp-&gt;rq.head
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|qp-&gt;rq.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_free_err_wqe
r_int
id|mthca_free_err_wqe
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
comma
r_struct
id|mthca_qp
op_star
id|qp
comma
r_int
id|is_send
comma
r_int
id|index
comma
r_int
op_star
id|dbd
comma
id|u32
op_star
id|new_wqe
)paren
(brace
r_struct
id|mthca_next_seg
op_star
id|next
suffix:semicolon
r_if
c_cond
(paren
id|is_send
)paren
id|next
op_assign
id|get_send_wqe
c_func
(paren
id|qp
comma
id|index
)paren
suffix:semicolon
r_else
id|next
op_assign
id|get_recv_wqe
c_func
(paren
id|qp
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hca_type
op_eq
id|ARBEL_NATIVE
)paren
op_star
id|dbd
op_assign
l_int|1
suffix:semicolon
r_else
op_star
id|dbd
op_assign
op_logical_neg
op_logical_neg
(paren
id|next-&gt;ee_nds
op_amp
id|cpu_to_be32
c_func
(paren
id|MTHCA_NEXT_DBD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next-&gt;ee_nds
op_amp
id|cpu_to_be32
c_func
(paren
l_int|0x3f
)paren
)paren
op_star
id|new_wqe
op_assign
(paren
id|next-&gt;nda_op
op_amp
id|cpu_to_be32
c_func
(paren
op_complement
l_int|0x3f
)paren
)paren
op_or
(paren
id|next-&gt;ee_nds
op_amp
id|cpu_to_be32
c_func
(paren
l_int|0x3f
)paren
)paren
suffix:semicolon
r_else
op_star
id|new_wqe
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mthca_init_qp_table
r_int
id|__devinit
id|mthca_init_qp_table
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|u8
id|status
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dev-&gt;qp_table.lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We reserve 2 extra QPs per port for the special QPs.  The&n;&t; * special QP for port 1 has to be even, so round up.&n;&t; */
id|dev-&gt;qp_table.sqp_start
op_assign
(paren
id|dev-&gt;limits.reserved_qps
op_plus
l_int|1
)paren
op_amp
op_complement
l_int|1UL
suffix:semicolon
id|err
op_assign
id|mthca_alloc_init
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
comma
id|dev-&gt;limits.num_qps
comma
(paren
l_int|1
op_lshift
l_int|24
)paren
op_minus
l_int|1
comma
id|dev-&gt;qp_table.sqp_start
op_plus
id|MTHCA_MAX_PORTS
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|mthca_array_init
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|dev-&gt;limits.num_qps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|mthca_alloc_cleanup
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
op_increment
id|i
)paren
(brace
id|err
op_assign
id|mthca_CONF_SPECIAL_QP
c_func
(paren
id|dev
comma
id|i
ques
c_cond
id|IB_QPT_GSI
suffix:colon
id|IB_QPT_SMI
comma
id|dev-&gt;qp_table.sqp_start
op_plus
id|i
op_star
l_int|2
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|mthca_warn
c_func
(paren
id|dev
comma
l_string|&quot;CONF_SPECIAL_QP returned &quot;
l_string|&quot;status %02x, aborting.&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
op_increment
id|i
)paren
id|mthca_CONF_SPECIAL_QP
c_func
(paren
id|dev
comma
id|i
comma
l_int|0
comma
op_amp
id|status
)paren
suffix:semicolon
id|mthca_array_cleanup
c_func
(paren
op_amp
id|dev-&gt;qp_table.qp
comma
id|dev-&gt;limits.num_qps
)paren
suffix:semicolon
id|mthca_alloc_cleanup
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|mthca_cleanup_qp_table
r_void
id|__devexit
id|mthca_cleanup_qp_table
c_func
(paren
r_struct
id|mthca_dev
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|status
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
op_increment
id|i
)paren
id|mthca_CONF_SPECIAL_QP
c_func
(paren
id|dev
comma
id|i
comma
l_int|0
comma
op_amp
id|status
)paren
suffix:semicolon
id|mthca_alloc_cleanup
c_func
(paren
op_amp
id|dev-&gt;qp_table.alloc
)paren
suffix:semicolon
)brace
eof
