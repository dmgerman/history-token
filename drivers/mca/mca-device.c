multiline_comment|/* -*- mode: c; c-basic-offset: 8 -*- */
multiline_comment|/*&n; * MCA device support functions&n; *&n; * These functions support the ongoing device access API.&n; *&n; * (C) 2002 James Bottomley &lt;James.Bottomley@HansenPartnership.com&gt;&n; *&n;**-----------------------------------------------------------------------------&n;**  &n;**  This program is free software; you can redistribute it and/or modify&n;**  it under the terms of the GNU General Public License as published by&n;**  the Free Software Foundation; either version 2 of the License, or&n;**  (at your option) any later version.&n;**&n;**  This program is distributed in the hope that it will be useful,&n;**  but WITHOUT ANY WARRANTY; without even the implied warranty of&n;**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;**  GNU General Public License for more details.&n;**&n;**  You should have received a copy of the GNU General Public License&n;**  along with this program; if not, write to the Free Software&n;**  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;**&n;**-----------------------------------------------------------------------------&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/mca.h&gt;
multiline_comment|/**&n; *&t;mca_device_read_stored_pos - read POS register from stored data&n; *&t;@mca_dev: device to read from&n; *&t;@reg:  register to read from&n; *&n; *&t;Fetch a POS value that was stored at boot time by the kernel&n; *&t;when it scanned the MCA space. The register value is returned.&n; *&t;Missing or invalid registers report 0.&n; */
DECL|function|mca_device_read_stored_pos
r_int
r_char
id|mca_device_read_stored_pos
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|reg
)paren
(brace
r_if
c_cond
(paren
id|reg
OL
l_int|0
op_logical_or
id|reg
op_ge
l_int|8
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|mca_dev-&gt;pos
(braket
id|reg
)braket
suffix:semicolon
)brace
DECL|variable|mca_device_read_stored_pos
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_read_stored_pos
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_read_pos - read POS register from card&n; *&t;@mca_dev: device to read from&n; *&t;@reg:  register to read from&n; *&n; *&t;Fetch a POS value directly from the hardware to obtain the&n; *&t;current value. This is much slower than&n; *&t;mca_device_read_stored_pos and may not be invoked from&n; *&t;interrupt context. It handles the deep magic required for&n; *&t;onboard devices transparently.&n; */
DECL|function|mca_device_read_pos
r_int
r_char
id|mca_device_read_pos
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|reg
)paren
(brace
r_struct
id|mca_bus
op_star
id|mca_bus
op_assign
id|to_mca_bus
c_func
(paren
id|mca_dev-&gt;dev.parent
)paren
suffix:semicolon
r_return
id|mca_bus-&gt;f
dot
id|mca_read_pos
c_func
(paren
id|mca_dev
comma
id|reg
)paren
suffix:semicolon
r_return
id|mca_dev-&gt;pos
(braket
id|reg
)braket
suffix:semicolon
)brace
DECL|variable|mca_device_read_pos
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_read_pos
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_write_pos - read POS register from card&n; *&t;@mca_dev: device to write pos register to&n; *&t;@reg:  register to write to&n; *&t;@byte: byte to write to the POS registers&n; *&n; *&t;Store a POS value directly to the hardware. You should not&n; *&t;normally need to use this function and should have a very good&n; *&t;knowledge of MCA bus before you do so. Doing this wrongly can&n; *&t;damage the hardware.&n; *&n; *&t;This function may not be used from interrupt context.&n; *&n; */
DECL|function|mca_device_write_pos
r_void
id|mca_device_write_pos
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|reg
comma
r_int
r_char
id|byte
)paren
(brace
r_struct
id|mca_bus
op_star
id|mca_bus
op_assign
id|to_mca_bus
c_func
(paren
id|mca_dev-&gt;dev.parent
)paren
suffix:semicolon
id|mca_bus-&gt;f
dot
id|mca_write_pos
c_func
(paren
id|mca_dev
comma
id|reg
comma
id|byte
)paren
suffix:semicolon
)brace
DECL|variable|mca_device_write_pos
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_write_pos
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_transform_irq - transform the ADF obtained IRQ&n; *&t;@mca_device: device whose irq needs transforming&n; *&t;@irq: input irq from ADF&n; *&n; *&t;MCA Adapter Definition Files (ADF) contain irq, ioport, memory&n; *&t;etc. definitions.  In systems with more than one bus, these need&n; *&t;to be transformed through bus mapping functions to get the real&n; *&t;system global quantities.&n; *&n; *&t;This function transforms the interrupt number and returns the&n; *&t;transformed system global interrupt&n; */
DECL|function|mca_device_transform_irq
r_int
id|mca_device_transform_irq
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|irq
)paren
(brace
r_struct
id|mca_bus
op_star
id|mca_bus
op_assign
id|to_mca_bus
c_func
(paren
id|mca_dev-&gt;dev.parent
)paren
suffix:semicolon
r_return
id|mca_bus-&gt;f
dot
id|mca_transform_irq
c_func
(paren
id|mca_dev
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|mca_device_transform_irq
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_transform_irq
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_transform_ioport - transform the ADF obtained I/O port&n; *&t;@mca_device: device whose port needs transforming&n; *&t;@ioport: input I/O port from ADF&n; *&n; *&t;MCA Adapter Definition Files (ADF) contain irq, ioport, memory&n; *&t;etc. definitions.  In systems with more than one bus, these need&n; *&t;to be transformed through bus mapping functions to get the real&n; *&t;system global quantities.&n; *&n; *&t;This function transforms the I/O port number and returns the&n; *&t;transformed system global port number.&n; *&n; *&t;This transformation can be assumed to be linear for port ranges.&n; */
DECL|function|mca_device_transform_ioport
r_int
id|mca_device_transform_ioport
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|port
)paren
(brace
r_struct
id|mca_bus
op_star
id|mca_bus
op_assign
id|to_mca_bus
c_func
(paren
id|mca_dev-&gt;dev.parent
)paren
suffix:semicolon
r_return
id|mca_bus-&gt;f
dot
id|mca_transform_ioport
c_func
(paren
id|mca_dev
comma
id|port
)paren
suffix:semicolon
)brace
DECL|variable|mca_device_transform_ioport
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_transform_ioport
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_transform_memory - transform the ADF obtained memory&n; *&t;@mca_device: device whose memory region needs transforming&n; *&t;@mem: memory region start from ADF&n; *&n; *&t;MCA Adapter Definition Files (ADF) contain irq, ioport, memory&n; *&t;etc. definitions.  In systems with more than one bus, these need&n; *&t;to be transformed through bus mapping functions to get the real&n; *&t;system global quantities.&n; *&n; *&t;This function transforms the memory region start and returns the&n; *&t;transformed system global memory region (physical).&n; *&n; *&t;This transformation can be assumed to be linear for region ranges.&n; */
DECL|function|mca_device_transform_memory
r_void
op_star
id|mca_device_transform_memory
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_void
op_star
id|mem
)paren
(brace
r_struct
id|mca_bus
op_star
id|mca_bus
op_assign
id|to_mca_bus
c_func
(paren
id|mca_dev-&gt;dev.parent
)paren
suffix:semicolon
r_return
id|mca_bus-&gt;f
dot
id|mca_transform_memory
c_func
(paren
id|mca_dev
comma
id|mem
)paren
suffix:semicolon
)brace
DECL|variable|mca_device_transform_memory
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_transform_memory
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_claimed - check if claimed by driver&n; *&t;@mca_dev:&t;device to check&n; *&n; *&t;Returns 1 if the slot has been claimed by a driver&n; */
DECL|function|mca_device_claimed
r_int
id|mca_device_claimed
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
)paren
(brace
r_return
id|mca_dev-&gt;driver_loaded
suffix:semicolon
)brace
DECL|variable|mca_device_claimed
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_claimed
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_set_claim - set the claim value of the driver&n; *&t;@mca_dev:&t;device to set value for&n; *&t;@val:&t;&t;claim value to set (1 claimed, 0 unclaimed)&n; */
DECL|function|mca_device_set_claim
r_void
id|mca_device_set_claim
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_int
id|val
)paren
(brace
id|mca_dev-&gt;driver_loaded
op_assign
id|val
suffix:semicolon
)brace
DECL|variable|mca_device_set_claim
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_set_claim
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_status - get the status of the device&n; *&t;@mca_device:&t;device to get&n; *&n; *&t;returns an enumeration of the device status:&n; *&n; *&t;MCA_ADAPTER_NORMAL&t;adapter is OK.&n; *&t;MCA_ADAPTER_NONE&t;no adapter at device (should never happen).&n; *&t;MCA_ADAPTER_DISABLED&t;adapter is disabled.&n; *&t;MCA_ADAPTER_ERROR&t;adapter cannot be initialised.&n; */
DECL|function|mca_device_status
r_enum
id|MCA_AdapterStatus
id|mca_device_status
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
)paren
(brace
r_return
id|mca_dev-&gt;status
suffix:semicolon
)brace
DECL|variable|mca_device_status
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_status
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;mca_device_set_name - set the name of the device&n; *&t;@mca_device:&t;device to set the name of&n; *&t;@name:&t;&t;name to set&n; */
DECL|function|mca_device_set_name
r_void
id|mca_device_set_name
c_func
(paren
r_struct
id|mca_device
op_star
id|mca_dev
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mca_dev
)paren
(brace
r_return
suffix:semicolon
)brace
id|strlcpy
c_func
(paren
id|mca_dev-&gt;name
comma
id|name
comma
r_sizeof
(paren
id|mca_dev-&gt;name
)paren
)paren
suffix:semicolon
)brace
DECL|variable|mca_device_set_name
id|EXPORT_SYMBOL
c_func
(paren
id|mca_device_set_name
)paren
suffix:semicolon
eof
