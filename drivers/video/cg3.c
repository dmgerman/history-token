multiline_comment|/* cg3.c: CGTHREE frame buffer driver&n; *&n; * Copyright (C) 2003 David S. Miller (davem@redhat.com)&n; * Copyright (C) 1996,1998 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1997 Eddie C. Dost (ecd@skynet.be)&n; *&n; * Driver layout based loosely on tgafb.c, see that file for credits.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &quot;sbuslib.h&quot;
multiline_comment|/*&n; * Local functions.&n; */
r_static
r_int
id|cg3_setcolreg
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg3_blank
c_func
(paren
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg3_mmap
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg3_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *  Frame buffer operations&n; */
DECL|variable|cg3_ops
r_static
r_struct
id|fb_ops
id|cg3_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_setcolreg
op_assign
id|cg3_setcolreg
comma
dot
id|fb_blank
op_assign
id|cg3_blank
comma
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_mmap
op_assign
id|cg3_mmap
comma
dot
id|fb_ioctl
op_assign
id|cg3_ioctl
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/* Control Register Constants */
DECL|macro|CG3_CR_ENABLE_INTS
mdefine_line|#define CG3_CR_ENABLE_INTS      0x80
DECL|macro|CG3_CR_ENABLE_VIDEO
mdefine_line|#define CG3_CR_ENABLE_VIDEO     0x40
DECL|macro|CG3_CR_ENABLE_TIMING
mdefine_line|#define CG3_CR_ENABLE_TIMING    0x20
DECL|macro|CG3_CR_ENABLE_CURCMP
mdefine_line|#define CG3_CR_ENABLE_CURCMP    0x10
DECL|macro|CG3_CR_XTAL_MASK
mdefine_line|#define CG3_CR_XTAL_MASK        0x0c
DECL|macro|CG3_CR_DIVISOR_MASK
mdefine_line|#define CG3_CR_DIVISOR_MASK     0x03
multiline_comment|/* Status Register Constants */
DECL|macro|CG3_SR_PENDING_INT
mdefine_line|#define CG3_SR_PENDING_INT      0x80
DECL|macro|CG3_SR_RES_MASK
mdefine_line|#define CG3_SR_RES_MASK         0x70
DECL|macro|CG3_SR_1152_900_76_A
mdefine_line|#define CG3_SR_1152_900_76_A    0x40
DECL|macro|CG3_SR_1152_900_76_B
mdefine_line|#define CG3_SR_1152_900_76_B    0x60
DECL|macro|CG3_SR_ID_MASK
mdefine_line|#define CG3_SR_ID_MASK          0x0f
DECL|macro|CG3_SR_ID_COLOR
mdefine_line|#define CG3_SR_ID_COLOR         0x01
DECL|macro|CG3_SR_ID_MONO
mdefine_line|#define CG3_SR_ID_MONO          0x02
DECL|macro|CG3_SR_ID_MONO_ECL
mdefine_line|#define CG3_SR_ID_MONO_ECL      0x03
DECL|enum|cg3_type
r_enum
id|cg3_type
(brace
DECL|enumerator|CG3_AT_66HZ
id|CG3_AT_66HZ
op_assign
l_int|0
comma
DECL|enumerator|CG3_AT_76HZ
id|CG3_AT_76HZ
comma
DECL|enumerator|CG3_RDI
id|CG3_RDI
)brace
suffix:semicolon
DECL|struct|bt_regs
r_struct
id|bt_regs
(brace
DECL|member|addr
r_volatile
id|u32
id|addr
suffix:semicolon
DECL|member|color_map
r_volatile
id|u32
id|color_map
suffix:semicolon
DECL|member|control
r_volatile
id|u32
id|control
suffix:semicolon
DECL|member|cursor
r_volatile
id|u32
id|cursor
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cg3_regs
r_struct
id|cg3_regs
(brace
DECL|member|cmap
r_struct
id|bt_regs
id|cmap
suffix:semicolon
DECL|member|control
r_volatile
id|u8
id|control
suffix:semicolon
DECL|member|status
r_volatile
id|u8
id|status
suffix:semicolon
DECL|member|cursor_start
r_volatile
id|u8
id|cursor_start
suffix:semicolon
DECL|member|cursor_end
r_volatile
id|u8
id|cursor_end
suffix:semicolon
DECL|member|h_blank_start
r_volatile
id|u8
id|h_blank_start
suffix:semicolon
DECL|member|h_blank_end
r_volatile
id|u8
id|h_blank_end
suffix:semicolon
DECL|member|h_sync_start
r_volatile
id|u8
id|h_sync_start
suffix:semicolon
DECL|member|h_sync_end
r_volatile
id|u8
id|h_sync_end
suffix:semicolon
DECL|member|comp_sync_end
r_volatile
id|u8
id|comp_sync_end
suffix:semicolon
DECL|member|v_blank_start_high
r_volatile
id|u8
id|v_blank_start_high
suffix:semicolon
DECL|member|v_blank_start_low
r_volatile
id|u8
id|v_blank_start_low
suffix:semicolon
DECL|member|v_blank_end
r_volatile
id|u8
id|v_blank_end
suffix:semicolon
DECL|member|v_sync_start
r_volatile
id|u8
id|v_sync_start
suffix:semicolon
DECL|member|v_sync_end
r_volatile
id|u8
id|v_sync_end
suffix:semicolon
DECL|member|xfer_holdoff_start
r_volatile
id|u8
id|xfer_holdoff_start
suffix:semicolon
DECL|member|xfer_holdoff_end
r_volatile
id|u8
id|xfer_holdoff_end
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Offset of interesting structures in the OBIO space */
DECL|macro|CG3_REGS_OFFSET
mdefine_line|#define CG3_REGS_OFFSET&t;     0x400000UL
DECL|macro|CG3_RAM_OFFSET
mdefine_line|#define CG3_RAM_OFFSET&t;     0x800000UL
DECL|struct|cg3_par
r_struct
id|cg3_par
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|regs
r_struct
id|cg3_regs
id|__iomem
op_star
id|regs
suffix:semicolon
DECL|member|sw_cmap
id|u32
id|sw_cmap
(braket
(paren
(paren
l_int|256
op_star
l_int|3
)paren
op_plus
l_int|3
)paren
op_div
l_int|4
)braket
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|CG3_FLAG_BLANKED
mdefine_line|#define CG3_FLAG_BLANKED&t;0x00000001
DECL|macro|CG3_FLAG_RDI
mdefine_line|#define CG3_FLAG_RDI&t;&t;0x00000002
DECL|member|physbase
r_int
r_int
id|physbase
suffix:semicolon
DECL|member|fbsize
r_int
r_int
id|fbsize
suffix:semicolon
DECL|member|sdev
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/**&n; *      cg3_setcolreg - Optional function. Sets a color register.&n; *      @regno: boolean, 0 copy local, 1 get_user() function&n; *      @red: frame buffer colormap structure&n; *      @green: The green value which can be up to 16 bits wide&n; *      @blue:  The blue value which can be up to 16 bits wide.&n; *      @transp: If supported the alpha value which can be up to 16 bits wide.&n; *      @info: frame buffer info structure&n; *&n; * The cg3 palette is loaded with 4 color values at each time&n; * so you end up with: (rgb)(r), (gb)(rg), (b)(rgb), and so on.&n; * We keep a sw copy of the hw cmap to assist us in this esoteric&n; * loading procedure.&n; */
DECL|function|cg3_setcolreg
r_static
r_int
id|cg3_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg3_par
op_star
id|par
op_assign
(paren
r_struct
id|cg3_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|bt_regs
id|__iomem
op_star
id|bt
op_assign
op_amp
id|par-&gt;regs-&gt;cmap
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
op_star
id|p32
suffix:semicolon
id|u8
op_star
id|p8
suffix:semicolon
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
l_int|256
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|p8
op_assign
(paren
id|u8
op_star
)paren
id|par-&gt;sw_cmap
op_plus
(paren
id|regno
op_star
l_int|3
)paren
suffix:semicolon
id|p8
(braket
l_int|0
)braket
op_assign
id|red
suffix:semicolon
id|p8
(braket
l_int|1
)braket
op_assign
id|green
suffix:semicolon
id|p8
(braket
l_int|2
)braket
op_assign
id|blue
suffix:semicolon
DECL|macro|D4M3
mdefine_line|#define D4M3(x) ((((x)&gt;&gt;2)&lt;&lt;1) + ((x)&gt;&gt;2))      /* (x/4)*3 */
DECL|macro|D4M4
mdefine_line|#define D4M4(x) ((x)&amp;~0x3)                      /* (x/4)*4 */
id|count
op_assign
l_int|3
suffix:semicolon
id|p32
op_assign
op_amp
id|par-&gt;sw_cmap
(braket
id|D4M3
c_func
(paren
id|regno
)paren
)braket
suffix:semicolon
id|sbus_writel
c_func
(paren
id|D4M4
c_func
(paren
id|regno
)paren
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|sbus_writel
c_func
(paren
op_star
id|p32
op_increment
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
DECL|macro|D4M3
macro_line|#undef D4M3
DECL|macro|D4M4
macro_line|#undef D4M4
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      cg3_blank - Optional function.  Blanks the display.&n; *      @blank_mode: the blank mode we want.&n; *      @info: frame buffer structure that represents a single frame buffer&n; */
r_static
r_int
DECL|function|cg3_blank
id|cg3_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg3_par
op_star
id|par
op_assign
(paren
r_struct
id|cg3_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg3_regs
id|__iomem
op_star
id|regs
op_assign
id|par-&gt;regs
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
id|FB_BLANK_UNBLANK
suffix:colon
multiline_comment|/* Unblanking */
id|val
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|val
op_or_assign
id|CG3_CR_ENABLE_VIDEO
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|val
comma
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|par-&gt;flags
op_and_assign
op_complement
id|CG3_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_NORMAL
suffix:colon
multiline_comment|/* Normal blanking */
r_case
id|FB_BLANK_VSYNC_SUSPEND
suffix:colon
multiline_comment|/* VESA blank (vsync off) */
r_case
id|FB_BLANK_HSYNC_SUSPEND
suffix:colon
multiline_comment|/* VESA blank (hsync off) */
r_case
id|FB_BLANK_POWERDOWN
suffix:colon
multiline_comment|/* Poweroff */
id|val
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|val
op_or_assign
id|CG3_CR_ENABLE_VIDEO
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|val
comma
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|par-&gt;flags
op_or_assign
id|CG3_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cg3_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|cg3_mmap_map
(braket
)braket
op_assign
(brace
(brace
dot
id|voff
op_assign
id|CG3_MMAP_OFFSET
comma
dot
id|poff
op_assign
id|CG3_RAM_OFFSET
comma
dot
id|size
op_assign
id|SBUS_MMAP_FBSIZE
c_func
(paren
l_int|1
)paren
)brace
comma
(brace
dot
id|size
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|cg3_mmap
r_static
r_int
id|cg3_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|cg3_par
op_star
id|par
op_assign
(paren
r_struct
id|cg3_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_mmap_helper
c_func
(paren
id|cg3_mmap_map
comma
id|par-&gt;physbase
comma
id|par-&gt;fbsize
comma
id|par-&gt;sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
id|vma
)paren
suffix:semicolon
)brace
DECL|function|cg3_ioctl
r_static
r_int
id|cg3_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg3_par
op_star
id|par
op_assign
(paren
r_struct
id|cg3_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_ioctl_helper
c_func
(paren
id|cmd
comma
id|arg
comma
id|info
comma
id|FBTYPE_SUN3COLOR
comma
l_int|8
comma
id|par-&gt;fbsize
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Initialisation&n; */
r_static
r_void
DECL|function|cg3_init_fix
id|cg3_init_fix
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|linebytes
)paren
(brace
r_struct
id|cg3_par
op_star
id|par
op_assign
(paren
r_struct
id|cg3_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|strlcpy
c_func
(paren
id|info-&gt;fix.id
comma
id|par-&gt;sdev-&gt;prom_name
comma
r_sizeof
(paren
id|info-&gt;fix.id
)paren
)paren
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|info-&gt;fix.line_length
op_assign
id|linebytes
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_SUN_CGTHREE
suffix:semicolon
)brace
DECL|function|cg3_rdi_maybe_fixup_var
r_static
r_void
id|cg3_rdi_maybe_fixup_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_char
id|buffer
(braket
l_int|40
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|ww
comma
id|hh
suffix:semicolon
op_star
id|buffer
op_assign
l_int|0
suffix:semicolon
id|prom_getstring
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;params&quot;
comma
id|buffer
comma
r_sizeof
(paren
id|buffer
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buffer
)paren
(brace
id|ww
op_assign
id|simple_strtoul
c_func
(paren
id|buffer
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ww
op_logical_and
op_star
id|p
op_eq
l_char|&squot;x&squot;
)paren
(brace
id|hh
op_assign
id|simple_strtoul
c_func
(paren
id|p
op_plus
l_int|1
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hh
op_logical_and
op_star
id|p
op_eq
l_char|&squot;-&squot;
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;xres
op_ne
id|ww
op_logical_or
id|var-&gt;yres
op_ne
id|hh
)paren
(brace
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|ww
suffix:semicolon
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
op_assign
id|hh
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|variable|__initdata
r_static
id|u8
id|cg3regvals_66hz
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* 1152 x 900, 66 Hz */
l_int|0x14
comma
l_int|0xbb
comma
l_int|0x15
comma
l_int|0x2b
comma
l_int|0x16
comma
l_int|0x04
comma
l_int|0x17
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0xae
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xa8
comma
l_int|0x1b
comma
l_int|0x24
comma
l_int|0x1c
comma
l_int|0x01
comma
l_int|0x1d
comma
l_int|0x05
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x20
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|cg3regvals_76hz
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* 1152 x 900, 76 Hz */
l_int|0x14
comma
l_int|0xb7
comma
l_int|0x15
comma
l_int|0x27
comma
l_int|0x16
comma
l_int|0x03
comma
l_int|0x17
comma
l_int|0x0f
comma
l_int|0x18
comma
l_int|0xae
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xae
comma
l_int|0x1b
comma
l_int|0x2a
comma
l_int|0x1c
comma
l_int|0x01
comma
l_int|0x1d
comma
l_int|0x09
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x24
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|cg3regvals_rdi
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* 640 x 480, cgRDI */
l_int|0x14
comma
l_int|0x70
comma
l_int|0x15
comma
l_int|0x20
comma
l_int|0x16
comma
l_int|0x08
comma
l_int|0x17
comma
l_int|0x10
comma
l_int|0x18
comma
l_int|0x06
comma
l_int|0x19
comma
l_int|0x02
comma
l_int|0x1a
comma
l_int|0x31
comma
l_int|0x1b
comma
l_int|0x51
comma
l_int|0x1c
comma
l_int|0x06
comma
l_int|0x1d
comma
l_int|0x0c
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x22
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
op_star
id|cg3_regvals
(braket
)braket
id|__initdata
op_assign
(brace
id|cg3regvals_66hz
comma
id|cg3regvals_76hz
comma
id|cg3regvals_rdi
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u_char
id|cg3_dacvals
(braket
)braket
id|__initdata
op_assign
(brace
l_int|4
comma
l_int|0xff
comma
l_int|5
comma
l_int|0x00
comma
l_int|6
comma
l_int|0x70
comma
l_int|7
comma
l_int|0x00
comma
l_int|0
)brace
suffix:semicolon
DECL|function|cg3_do_default_mode
r_static
r_void
id|cg3_do_default_mode
c_func
(paren
r_struct
id|cg3_par
op_star
id|par
)paren
(brace
r_enum
id|cg3_type
id|type
suffix:semicolon
id|u8
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;flags
op_amp
id|CG3_FLAG_RDI
)paren
id|type
op_assign
id|CG3_RDI
suffix:semicolon
r_else
(brace
id|u8
id|status
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|par-&gt;regs-&gt;status
)paren
comma
id|mon
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|CG3_SR_ID_MASK
)paren
op_eq
id|CG3_SR_ID_COLOR
)paren
(brace
id|mon
op_assign
id|status
op_amp
id|CG3_SR_RES_MASK
suffix:semicolon
r_if
c_cond
(paren
id|mon
op_eq
id|CG3_SR_1152_900_76_A
op_logical_or
id|mon
op_eq
id|CG3_SR_1152_900_76_B
)paren
id|type
op_assign
id|CG3_AT_76HZ
suffix:semicolon
r_else
id|type
op_assign
id|CG3_AT_66HZ
suffix:semicolon
)brace
r_else
(brace
id|prom_printf
c_func
(paren
l_string|&quot;cgthree: can&squot;t handle SR %02x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|p
op_assign
id|cg3_regvals
(braket
id|type
)braket
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
)paren
(brace
id|u8
id|__iomem
op_star
id|regp
op_assign
op_amp
(paren
(paren
id|u8
id|__iomem
op_star
)paren
id|par-&gt;regs
)paren
(braket
id|p
(braket
l_int|0
)braket
)braket
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|p
(braket
l_int|1
)braket
comma
id|regp
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|p
op_assign
id|cg3_dacvals
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
)paren
(brace
r_volatile
id|u8
id|__iomem
op_star
id|regp
suffix:semicolon
id|regp
op_assign
(paren
r_volatile
id|u8
id|__iomem
op_star
)paren
op_amp
id|par-&gt;regs-&gt;cmap.addr
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|p
(braket
l_int|0
)braket
comma
id|regp
)paren
suffix:semicolon
id|regp
op_assign
(paren
r_volatile
id|u8
id|__iomem
op_star
)paren
op_amp
id|par-&gt;regs-&gt;cmap.control
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|p
(braket
l_int|1
)braket
comma
id|regp
)paren
suffix:semicolon
)brace
)brace
DECL|struct|all_info
r_struct
id|all_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|par
r_struct
id|cg3_par
id|par
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|cg3_list
)paren
suffix:semicolon
DECL|function|cg3_init_one
r_static
r_void
id|cg3_init_one
c_func
(paren
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_struct
id|all_info
op_star
id|all
suffix:semicolon
r_int
id|linebytes
suffix:semicolon
id|all
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|all
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|all
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg3: Cannot allocate memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|all
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|all
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|all-&gt;list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|all-&gt;par.lock
)paren
suffix:semicolon
id|all-&gt;par.sdev
op_assign
id|sdev
suffix:semicolon
id|all-&gt;par.physbase
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|sbusfb_fill_var
c_func
(paren
op_amp
id|all-&gt;info.var
comma
id|sdev-&gt;prom_node
comma
l_int|8
)paren
suffix:semicolon
id|all-&gt;info.var.red.length
op_assign
l_int|8
suffix:semicolon
id|all-&gt;info.var.green.length
op_assign
l_int|8
suffix:semicolon
id|all-&gt;info.var.blue.length
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;cgRDI&quot;
)paren
)paren
id|all-&gt;par.flags
op_or_assign
id|CG3_FLAG_RDI
suffix:semicolon
r_if
c_cond
(paren
id|all-&gt;par.flags
op_amp
id|CG3_FLAG_RDI
)paren
id|cg3_rdi_maybe_fixup_var
c_func
(paren
op_amp
id|all-&gt;info.var
comma
id|sdev
)paren
suffix:semicolon
id|linebytes
op_assign
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;linebytes&quot;
comma
id|all-&gt;info.var.xres
)paren
suffix:semicolon
id|all-&gt;par.fbsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|linebytes
op_star
id|all-&gt;info.var.yres
)paren
suffix:semicolon
id|all-&gt;par.regs
op_assign
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG3_REGS_OFFSET
comma
r_sizeof
(paren
r_struct
id|cg3_regs
)paren
comma
l_string|&quot;cg3 regs&quot;
)paren
suffix:semicolon
id|all-&gt;info.flags
op_assign
id|FBINFO_DEFAULT
suffix:semicolon
id|all-&gt;info.fbops
op_assign
op_amp
id|cg3_ops
suffix:semicolon
macro_line|#ifdef CONFIG_SPARC32
id|all-&gt;info.screen_base
op_assign
(paren
r_char
id|__iomem
op_star
)paren
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;address&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|all-&gt;info.screen_base
)paren
id|all-&gt;info.screen_base
op_assign
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG3_RAM_OFFSET
comma
id|all-&gt;par.fbsize
comma
l_string|&quot;cg3 ram&quot;
)paren
suffix:semicolon
id|all-&gt;info.par
op_assign
op_amp
id|all-&gt;par
suffix:semicolon
id|cg3_blank
c_func
(paren
l_int|0
comma
op_amp
id|all-&gt;info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prom_getbool
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;width&quot;
)paren
)paren
id|cg3_do_default_mode
c_func
(paren
op_amp
id|all-&gt;par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_alloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
comma
l_int|256
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg3: Could not allocate color map.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fb_set_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
comma
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|cg3_init_fix
c_func
(paren
op_amp
id|all-&gt;info
comma
id|linebytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg3: Could not register framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|all-&gt;list
comma
op_amp
id|cg3_list
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;cg3: %s at %lx:%lx&bslash;n&quot;
comma
id|sdev-&gt;prom_name
comma
(paren
r_int
)paren
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
(paren
r_int
)paren
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
)paren
suffix:semicolon
)brace
DECL|function|cg3_init
r_int
id|__init
id|cg3_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;cg3fb&quot;
comma
l_int|NULL
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;cgthree&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;cgRDI&quot;
)paren
)paren
id|cg3_init_one
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cg3_exit
r_void
id|__exit
id|cg3_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|tmp
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|tmp
comma
op_amp
id|cg3_list
)paren
(brace
r_struct
id|all_info
op_star
id|all
op_assign
id|list_entry
c_func
(paren
id|pos
comma
id|typeof
c_func
(paren
op_star
id|all
)paren
comma
id|list
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|cg3_setup
id|cg3_setup
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
multiline_comment|/* No cmdline options yet... */
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cg3_init
id|module_init
c_func
(paren
id|cg3_init
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|variable|cg3_exit
id|module_exit
c_func
(paren
id|cg3_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for CGthree chipsets&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller &lt;davem@redhat.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
