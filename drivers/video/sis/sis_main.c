multiline_comment|/*&n; * SiS 300/630/730/540/315/550/650/740 frame buffer device&n; * for Linux kernels 2.4.x and 2.5.x&n; *&n; * Partly based on the VBE 2.0 compliant graphic boards framebuffer driver,&n; * which is (c) 1998 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n; *&n; * Authors:   &t;SiS (www.sis.com.tw)&n; *&t;&t;(Various others)&n; *&t;&t;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;:&n; *&t;&t;&t;- many fixes and enhancements for 630 &amp; 310/325 series,&n; *&t;&t;&t;- extended bridge handling, TV output for Chrontel&n; *                      - 650/LVDS support (for LCD panels up to 1400x1050)&n; *                      - 650/Chrontel 7019 support&n; *                      - 301B/301LV LCD and TV support&n; *&t;&t;&t;- memory queue handling enhancements,&n; *&t;&t;&t;- everything marked with &quot;TW&quot;&n; *&t;&t;&t;(see http://www.winischhofer.net/linuxsis630.shtml&n; *&t;&t;&t;for more information and updates)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sisfb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mtrr.h&gt; 
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &quot;osdef.h&quot;
macro_line|#include &quot;vgatypes.h&quot;
macro_line|#include &quot;sis_main.h&quot;
singleline_comment|//#ifdef LINUXBIOS
singleline_comment|//#include &quot;bios.h&quot;
singleline_comment|//#endif
multiline_comment|/* -------------------- Macro definitions ---------------------------- */
singleline_comment|// #define SISFBDEBUG
DECL|macro|SISFBDEBUG
macro_line|#undef SISFBDEBUG /* TW */
macro_line|#ifdef SISFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
DECL|macro|vgawb
mdefine_line|#define vgawb(reg,data) &bslash;&n;           (outb(data, ivideo.vga_base+reg))
DECL|macro|vgaww
mdefine_line|#define vgaww(reg,data) &bslash;&n;           (outw(data, ivideo.vga_base+reg))
DECL|macro|vgawl
mdefine_line|#define vgawl(reg,data) &bslash;&n;           (outl(data, ivideo.vga_base+reg))
DECL|macro|vgarb
mdefine_line|#define vgarb(reg)      &bslash;&n;           (inb(ivideo.vga_base+reg))
multiline_comment|/* --------------- Hardware Access Routines -------------------------- */
DECL|function|sisfb_set_reg1
r_void
id|sisfb_set_reg1
c_func
(paren
id|u16
id|port
comma
id|u16
id|index
comma
id|u16
id|data
)paren
(brace
id|outb
c_func
(paren
(paren
id|u8
)paren
(paren
id|index
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
id|outb
c_func
(paren
(paren
id|u8
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_set_reg3
r_void
id|sisfb_set_reg3
c_func
(paren
id|u16
id|port
comma
id|u16
id|data
)paren
(brace
id|outb
c_func
(paren
(paren
id|u8
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_set_reg4
r_void
id|sisfb_set_reg4
c_func
(paren
id|u16
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|outl
c_func
(paren
(paren
id|u32
)paren
(paren
id|data
op_amp
l_int|0xffffffff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg1
id|u8
id|sisfb_get_reg1
c_func
(paren
id|u16
id|port
comma
id|u16
id|index
)paren
(brace
id|u8
id|data
suffix:semicolon
id|outb
c_func
(paren
(paren
id|u8
)paren
(paren
id|index
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
id|port
op_add_assign
l_int|1
suffix:semicolon
id|data
op_assign
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg2
id|u8
id|sisfb_get_reg2
c_func
(paren
id|u16
id|port
)paren
(brace
id|u8
id|data
suffix:semicolon
id|data
op_assign
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg3
id|u32
id|sisfb_get_reg3
c_func
(paren
id|u16
id|port
)paren
(brace
id|u32
id|data
suffix:semicolon
id|data
op_assign
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
singleline_comment|// Eden Chen
singleline_comment|//void sisfb_clear_DAC(u16 port)
singleline_comment|//{
singleline_comment|//&t;int i,j;
singleline_comment|//
singleline_comment|//&t;vgawb(DAC_ADR, 0x00);
singleline_comment|//&t;for(i=0; i&lt;256; i++)
singleline_comment|//&t;&t;for(j=0; j&lt;3; j++)
singleline_comment|//&t;&t;&t;vgawb(DAC_DATA, 0);
singleline_comment|//}
singleline_comment|//void sisfb_clear_buffer(PHW_DEVICE_EXTENSION psishw_ext)
singleline_comment|//{
singleline_comment|//&t;memset((char *) ivideo.video_vbase, 0,
singleline_comment|//&t;&t;video_linelength * ivideo.video_height);
singleline_comment|//}
singleline_comment|// ~Eden Chen
multiline_comment|/* --------------- Interface to BIOS code ---------------------------- */
id|BOOLEAN
DECL|function|sisfb_query_VGA_config_space
id|sisfb_query_VGA_config_space
c_func
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Get VGA offset 0x%lx&bslash;n&quot;
comma
id|offset
)paren
suffix:semicolon
r_else
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Set offset 0x%lx to 0x%lx&bslash;n&quot;
comma
id|offset
comma
op_star
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|ivideo.chip_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d VGA device.&bslash;n&quot;
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_query_north_bridge_space
id|BOOLEAN
id|sisfb_query_north_bridge_space
c_func
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
id|u16
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_550
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_650
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_650
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d North Bridge device.&bslash;n&quot;
comma
id|nbridge_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* -------------------- Export functions ----------------------------- */
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,23)
DECL|function|sis_get_glyph
r_static
r_void
id|sis_get_glyph
c_func
(paren
id|SIS_GLYINFO
op_star
id|gly
)paren
macro_line|#else
r_static
r_void
id|sis_get_glyph
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
id|SIS_GLYINFO
op_star
id|gly
)paren
macro_line|#endif
(brace
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,23)
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|currcon
)braket
suffix:semicolon
macro_line|#else
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
suffix:semicolon
macro_line|#endif
id|u16
id|c
suffix:semicolon
id|u8
op_star
id|cdat
suffix:semicolon
r_int
id|widthb
suffix:semicolon
id|u8
op_star
id|gbuf
op_assign
id|gly-&gt;gmask
suffix:semicolon
r_int
id|size
suffix:semicolon
id|gly-&gt;fontheight
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|gly-&gt;fontwidth
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|widthb
op_assign
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|c
op_assign
id|gly-&gt;ch
op_amp
id|p-&gt;charmask
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|size
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|widthb
suffix:semicolon
id|memcpy
c_func
(paren
id|gbuf
comma
id|cdat
comma
id|size
)paren
suffix:semicolon
id|gly-&gt;ngmask
op_assign
id|size
suffix:semicolon
)brace
DECL|function|sis_dispinfo
r_void
id|sis_dispinfo
c_func
(paren
r_struct
id|ap_data
op_star
id|rec
)paren
(brace
id|rec-&gt;minfo.bpp
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|rec-&gt;minfo.xres
op_assign
id|ivideo.video_width
suffix:semicolon
id|rec-&gt;minfo.yres
op_assign
id|ivideo.video_height
suffix:semicolon
id|rec-&gt;minfo.v_xres
op_assign
id|ivideo.video_vwidth
suffix:semicolon
id|rec-&gt;minfo.v_yres
op_assign
id|ivideo.video_vheight
suffix:semicolon
id|rec-&gt;minfo.org_x
op_assign
id|ivideo.org_x
suffix:semicolon
id|rec-&gt;minfo.org_y
op_assign
id|ivideo.org_y
suffix:semicolon
id|rec-&gt;minfo.vrate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
id|rec-&gt;iobase
op_assign
id|ivideo.vga_base
op_minus
l_int|0x30
suffix:semicolon
id|rec-&gt;mem_size
op_assign
id|ivideo.video_size
suffix:semicolon
id|rec-&gt;disp_state
op_assign
id|ivideo.disp_state
suffix:semicolon
id|rec-&gt;version
op_assign
(paren
id|VER_MAJOR
op_lshift
l_int|24
)paren
op_or
(paren
id|VER_MINOR
op_lshift
l_int|16
)paren
op_or
id|VER_LEVEL
suffix:semicolon
id|rec-&gt;hasVB
op_assign
id|ivideo.hasVB
suffix:semicolon
id|rec-&gt;TV_type
op_assign
id|ivideo.TV_type
suffix:semicolon
id|rec-&gt;TV_plug
op_assign
id|ivideo.TV_plug
suffix:semicolon
id|rec-&gt;chip
op_assign
id|ivideo.chip
suffix:semicolon
)brace
multiline_comment|/* ------------------ Internal Routines ------------------------------ */
DECL|function|sisfb_search_mode
r_static
r_void
id|sisfb_search_mode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sisbios_mode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_mode_idx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid mode &squot;%s&squot;&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_validate_mode
r_static
r_void
id|sisfb_validate_mode
c_func
(paren
r_void
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
r_switch
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
)paren
(brace
r_case
id|LCD_1024x768
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x1024
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x960
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|960
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_2048x1536
suffix:colon
id|xres
op_assign
l_int|2048
suffix:semicolon
id|yres
op_assign
l_int|1536
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1920x1440
suffix:colon
id|xres
op_assign
l_int|1920
suffix:semicolon
id|yres
op_assign
l_int|1440
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1600x1200
suffix:colon
id|xres
op_assign
l_int|1600
suffix:semicolon
id|yres
op_assign
l_int|1200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_800x600
suffix:colon
id|xres
op_assign
l_int|800
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_640x480
suffix:colon
id|xres
op_assign
l_int|640
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_320x480
suffix:colon
multiline_comment|/* TW: FSTN */
id|xres
op_assign
l_int|320
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1024x600
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1152x864
suffix:colon
id|xres
op_assign
l_int|1152
suffix:semicolon
id|yres
op_assign
l_int|864
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1152x768
suffix:colon
id|xres
op_assign
l_int|1152
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x768
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1400x1050
suffix:colon
id|xres
op_assign
l_int|1400
suffix:semicolon
id|yres
op_assign
l_int|1050
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|xres
op_assign
l_int|0
suffix:semicolon
id|yres
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
id|xres
)paren
(brace
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
OG
id|yres
)paren
(brace
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
l_int|720
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
)paren
(brace
r_case
l_int|512
suffix:colon
r_case
l_int|640
suffix:colon
r_case
l_int|800
suffix:colon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_ne
l_int|480
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_ne
l_int|576
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* TW: LVDS/CHRONTEL does not support 720 */
r_if
c_cond
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
op_logical_or
id|ivideo.hasVB
op_eq
id|HASVB_CHRONTEL
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
l_int|32
)paren
(brace
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: LVDS/CHRONTEL only supports &lt; 800 (1024 on 650/Ch7019)*/
r_if
c_cond
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
op_logical_or
id|ivideo.hasVB
op_eq
id|HASVB_CHRONTEL
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|1920
)paren
(brace
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: TODO: Validate modes available on either 300 or 310/325 series only */
)brace
DECL|function|sisfb_search_crt2type
r_static
r_void
id|sisfb_search_crt2type
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_crt2type
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid CRT2 type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_search_queuemode
r_static
r_void
id|sisfb_search_queuemode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sis_queuemode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_queuemode
op_assign
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_queuemode
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid queuemode type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_search_refresh_rate
r_static
id|u8
id|sisfb_search_refresh_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|xres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|yres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_rate_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_le
id|xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_eq
id|xres
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|yres
op_eq
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_eq
id|rate
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
OG
id|rate
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_minus
id|rate
)paren
op_le
l_int|2
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d up to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_rate_idx
OG
l_int|0
)paren
(brace
r_return
id|sisfb_rate_idx
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unsupported rate %d for %dx%d&bslash;n&quot;
comma
id|rate
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sis_getcolreg
r_static
r_int
id|sis_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|vgawb
c_func
(paren
id|DAC_ADR
comma
id|regno
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC_DATA
comma
id|red
op_rshift
l_int|10
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC_DATA
comma
id|green
op_rshift
l_int|10
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC_DATA
comma
id|blue
op_rshift
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
id|vgawb
c_func
(paren
id|DAC2_ADR
comma
id|regno
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC2_DATA
comma
id|red
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC2_DATA
comma
id|green
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|DAC2_DATA
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|fbcon_cmap.cfb24
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_do_set_var
r_static
r_int
id|sisfb_do_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
r_int
r_int
id|vtotal
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* TW */
multiline_comment|/*&t;var-&gt;upper_margin + var-&gt;yres + var-&gt;lower_margin +&n;&t;&t;var-&gt;vsync_len;     */
r_float
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|old_mode
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
multiline_comment|/* TW */
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
multiline_comment|/* TW */
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
(paren
id|var-&gt;yres
op_div
l_int|2
)paren
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
multiline_comment|/* TW */
multiline_comment|/* var-&gt;yres &lt;&lt;= 1; */
multiline_comment|/* TW */
)brace
r_else
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Invalid &squot;var&squot; information&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|drate
op_assign
l_float|1E12
op_div
id|var-&gt;pixclock
suffix:semicolon
id|hrate
op_assign
id|drate
op_div
id|htotal
suffix:semicolon
id|ivideo.refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_div
id|vtotal
op_star
l_int|2
op_plus
l_float|0.5
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sisfb: Change mode to %dx%dx%d-%dHz&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|old_mode
op_assign
id|sisfb_mode_idx
suffix:semicolon
id|sisfb_mode_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_mode_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
id|sisfb_validate_mode
c_func
(paren
)paren
suffix:semicolon
r_else
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sisfb: Mode %dx%d-%d not supported&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|old_mode
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
)paren
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
op_logical_and
id|isactive
)paren
(brace
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sisfb: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Set new mode: %dx%dx%d-%d &bslash;n&quot;
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_disp
r_static
r_void
id|sisfb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_struct
id|display_switch
op_star
id|sw
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_else
id|display
op_assign
op_amp
id|disp
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|con
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,23)
id|display-&gt;screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
macro_line|#endif
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|0
suffix:semicolon
id|display-&gt;inverse
op_assign
id|sisfb_inverse
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb24
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|sisfb_sw
comma
id|sw
comma
r_sizeof
(paren
op_star
id|sw
)paren
)paren
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|sisfb_sw
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
)brace
DECL|function|sisfb_do_install_cmap
r_static
r_void
id|sisfb_do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
id|con
op_ne
id|info-&gt;currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|video_cmap_len
)paren
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|con
op_ne
id|currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|video_cmap_len
)paren
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* --------------- Chip-dependent Routines --------------------------- */
macro_line|#ifdef CONFIG_FB_SIS_300 /* for SiS 300/630/540/730 */
DECL|function|sisfb_get_dram_size_300
r_static
r_int
id|sisfb_get_dram_size_300
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
comma
id|reg
suffix:semicolon
id|u16
id|nbridge_id
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nbridge_id
op_eq
l_int|0
)paren
(brace
multiline_comment|/* 300 */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
op_amp
id|SIS_DRAM_SIZE_MASK
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 540, 630, 730 */
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|reg
op_assign
id|SIS_DATA_BUS_64
op_lshift
l_int|6
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_2MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_2MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_300
r_static
r_void
id|sisfb_detect_VB_connect_300
c_func
(paren
)paren
(brace
id|u8
id|sr16
comma
id|sr17
comma
id|cr32
comma
id|temp
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_17
)paren
suffix:semicolon
id|sr17
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR32
)paren
suffix:semicolon
id|cr32
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x0F
)paren
op_logical_and
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x01
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x0E
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: override detected CRT2 type */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x08
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x02
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x04
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x20
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x10
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_16
)paren
suffix:semicolon
id|sr16
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr16
op_amp
l_int|0x20
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: override detected CRT2 type */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* TW: Detect TV plug &amp; type anyway */
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
singleline_comment|// Eden Chen
singleline_comment|//temp = *((u8 *)(sishw_ext.VirtualRomBase+0x52));
singleline_comment|//if (temp&amp;0x40) {
singleline_comment|//&t;temp=*((u8 *)(sishw_ext.VirtualRomBase+0x53));
singleline_comment|//} else {
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_POWER_ON_TRAP
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
singleline_comment|//}
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_17
)paren
suffix:semicolon
id|sr17
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_forcecrt1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sr17
op_or_assign
l_int|0x80
suffix:semicolon
)brace
r_else
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
id|sr17
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|sr17
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type_300
r_static
r_void
id|sisfb_get_VB_type_300
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_has_VB_300
c_func
(paren
)paren
)paren
(brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR37
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS_EXTERNAL_CHIP_MASK
)paren
op_rshift
l_int|1
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_SIS301
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_TRUMPION
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_TRUMPION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|sisfb_has_VB_300
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_has_VB_300
r_static
r_int
id|sisfb_has_VB_300
c_func
(paren
r_void
)paren
(brace
singleline_comment|// Eden Chen
singleline_comment|//u8 sr38, sr39, vb_chipid;
id|u8
id|vb_chipid
suffix:semicolon
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_POWER_ON_TRAP);
singleline_comment|//sr38 = vgarb(SEQ_DATA);
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_POWER_ON_TRAP2);
singleline_comment|//sr39 = vgarb(SEQ_DATA);
id|vgawb
c_func
(paren
id|VB_PART4_ADR
comma
l_int|0x0
)paren
suffix:semicolon
id|vb_chipid
op_assign
id|vgarb
c_func
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_303
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
singleline_comment|//if (
singleline_comment|//&t;( (ivideo.chip == SIS_300) &amp;&amp; (sr38 &amp; 0x20) )
singleline_comment|//&t;||
singleline_comment|//&t;( (ivideo.chip == SIS_540) &amp;&amp; (sr38 &amp; 0x20) &amp;&amp; (!(sr39 &amp; 0x80)) )
singleline_comment|//&t;||
singleline_comment|//&t;( (ivideo.chip == SIS_630 ) &amp;&amp; (sr38 &amp; 0x20) &amp;&amp; (!(sr39 &amp; 0x80)) &amp;&amp; 
singleline_comment|//&t;&t;((ivideo.revision_id &amp; 0xf0) &lt; 0x30) &amp;&amp; (vb_chipid == 1) ) 
singleline_comment|//&t;||
singleline_comment|//&t;( (ivideo.chip == SIS_630 ) &amp;&amp; ((ivideo.revision_id &amp; 0xf0) &gt;= 0x30) &amp;&amp; 
singleline_comment|//&t;&t;(vb_chipid == 1) ) 
singleline_comment|//&t;||
singleline_comment|//&t;( (ivideo.chip == SIS_730) &amp;&amp; (vb_chipid == 1) ) /* 730 */
singleline_comment|//) {
singleline_comment|//&t;ivideo.hasVB = HASVB_301;
singleline_comment|//&t;return TRUE;
singleline_comment|//} else {
singleline_comment|//&t;ivideo.hasVB = HASVB_NONE;
singleline_comment|//&t;return FALSE;
singleline_comment|//}
singleline_comment|// ~Eden Chen
)brace
macro_line|#endif  /* CONFIG_FB_SIS_300 */
macro_line|#ifdef CONFIG_FB_SIS_315    /* for SiS 315/550/650/740 */
DECL|function|sisfb_get_dram_size_315
r_static
r_int
id|sisfb_get_dram_size_315
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
suffix:semicolon
id|u8
id|reg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
op_logical_or
id|ivideo.chip
op_eq
id|SIS_650
)paren
(brace
macro_line|#ifdef LINUXBIOS
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_550
)paren
op_logical_or
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_650
)paren
)paren
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: Initialize SR14 &quot;by hand&quot; */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
op_amp
l_int|0xC0
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
singleline_comment|//case BRI_DRAM_SIZE_2MB:
singleline_comment|//&t;reg |= (SIS315_DRAM_SIZE_2MB &lt;&lt; 4); break;
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case BRI_DRAM_SIZE_128MB:&n;&t;&t;&t;&t;&t;reg |= (SIS315_DRAM_SIZE_128MB &lt;&lt; 4); break; */
)brace
multiline_comment|/* TODO : set Dual channel and bus width bits here */
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|reg
op_amp
id|SIS550_DRAM_SIZE_MASK
)paren
(brace
r_case
id|SIS550_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_24MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_96MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x6000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_256MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x10000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* TW: Some 550 BIOSes don&squot;t seem to initialize SR14 correctly (if at all),&n;&t;&t;&t; *     do it the hard way ourselves in this case. Unfortunately, we don&squot;t&n;&t;&t;&t; *     support 24, 48, 96 and other &quot;odd&quot; amounts here.&n;&t;&t;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Warning: Could not determine memory size, &quot;
l_string|&quot;now reading from PCI config&bslash;n&quot;
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_550
)paren
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: Initialize SR14=IND_SIS_DRAM_SIZE */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
op_amp
l_int|0xC0
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case BRI_DRAM_SIZE_128MB:&n;&t;&t;&t;&t;&t;reg |= (SIS315_DRAM_SIZE_128MB &lt;&lt; 4); break; */
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unable to determine memory size, giving up.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Total confusion - No SiS PCI VGA device found?!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 315 */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS315_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
)paren
(brace
r_case
id|SIS315_DRAM_SIZE_2MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|reg
op_and_assign
id|SIS315_DUAL_CHANNEL_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS315_SINGLE_CHANNEL_2_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DUAL_CHANNEL_1_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_ASYM_DDR
suffix:colon
multiline_comment|/* TW: DDR asymentric */
id|ivideo.video_size
op_add_assign
(paren
id|ivideo.video_size
op_div
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_315
r_static
r_void
id|sisfb_detect_VB_connect_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|sr17
comma
id|cr32
comma
id|temp
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR32
)paren
suffix:semicolon
id|cr32
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: Override with option */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
multiline_comment|/* TW: PAL/NTSC changed for 315/650 */
r_if
c_cond
(paren
id|ivideo.chip
op_le
id|SIS_315PRO
)paren
(brace
macro_line|#if 0
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_POWER_ON_TRAP
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
macro_line|#endif
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x10
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
r_else
(brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x79
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_17
)paren
suffix:semicolon
id|sr17
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_forcecrt1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sr17
op_or_assign
l_int|0x80
suffix:semicolon
)brace
r_else
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
id|sr17
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|sr17
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type_315
r_static
r_void
id|sisfb_get_VB_type_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisfb_has_VB_315
c_func
(paren
)paren
)paren
(brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR37
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
multiline_comment|/* TW: CR37 changed on 310/325 series */
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS_EXTERNAL_CHIP_MASK
)paren
op_rshift
l_int|1
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_SIS301
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS310_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS310_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|sisfb_has_VB_315
r_static
r_int
id|sisfb_has_VB_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|vb_chipid
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART4_ADR
comma
l_int|0x00
)paren
suffix:semicolon
id|vb_chipid
op_assign
id|vgarb
c_func
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_303
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif   /* CONFIG_FB_SIS_315 */
multiline_comment|/* --------------------- Heap Routines ------------------------------- */
DECL|function|sisfb_heap_init
r_static
r_int
id|sisfb_heap_init
c_func
(paren
r_void
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|u8
id|temp
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_int
id|agp_enabled
op_assign
l_int|1
suffix:semicolon
id|u32
id|agp_size
suffix:semicolon
r_int
r_int
op_star
id|cmdq_baseport
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|read_port
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|write_port
op_assign
l_int|0
suffix:semicolon
id|SIS_CMDTYPE
id|cmd_type
suffix:semicolon
macro_line|#ifndef AGPOFF
id|agp_kern_info
op_star
id|agp_info
suffix:semicolon
id|agp_memory
op_star
id|agp
suffix:semicolon
id|u32
id|agp_phys
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/* TW: The heap start is either set manually using the &quot;mem&quot; parameter, or&n; *     defaults as follows:&n; *     -) If more than 16MB videoRAM available, let our heap start at 12MB.&n; *     -) If more than  8MB videoRAM available, let our heap start at  8MB.&n; *     -) If 4MB or less is available, let it start at 4MB.&n; *     This is for avoiding a clash with X driver which uses the beginning&n; *     of the videoRAM. To limit size of X framebuffer, use Option MaxXFBMem&n; *     in XF86Config-4.&n; *     The heap start can also be specified by parameter &quot;mem&quot; when starting the sisfb&n; *     driver. sisfb mem=1024 lets heap starts at 1MB, etc.&n; */
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0x800000
suffix:semicolon
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
l_int|0x400000
suffix:semicolon
)brace
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
)brace
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
(paren
id|ivideo.video_vbase
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Memory heap starting at %dK&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|ivideo.heapstart
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|sisfb_heap_end
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
id|ivideo.video_size
suffix:semicolon
id|sisfb_heap_size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* TW: Now initialize the 310 series&squot; command queue mode.&n;&t; * On 310, there are three queue modes available which&n;&t; *     are chosen by setting bits 7:5 in SR26:&n;&t; * 1. MMIO queue mode (bit 5, 0x20). The hardware will keep&n;&t; *    track of the queue, the FIFO, command parsing and so&n;&t; *    on. This is the one comparable to the 300 series.&n;&t; * 2. VRAM queue mode (bit 6, 0x40). In this case, one will&n;&t; *    have to do queue management himself. Register 0x85c4 will&n;&t; *    hold the location of the next free queue slot, 0x85c8&n;&t; *    is the &quot;queue read pointer&quot; whose way of working is&n;&t; *    unknown to me. Anyway, this mode would require a&n;&t; *    translation of the MMIO commands to some kind of&n;&t; *    accelerator assembly and writing these commands&n;&t; *    to the memory location pointed to by 0x85c4.&n;&t; *    We will not use this, as nobody knows how this&n;&t; *    &quot;assembly&quot; works, and as it would require a complete&n;&t; *    re-write of the accelerator code.&n;&t; * 3. AGP queue mode (bit 7, 0x80). Works as 2., but keeps the&n;&t; *    queue in AGP memory space.&n;&t; *&n;&t; * SR26 bit 4 is called &quot;Bypass H/W queue&quot;.&n;&t; * SR26 bit 1 is called &quot;Enable Command Queue Auto Correction&quot;&n;&t; * SR26 bit 0 resets the queue&n;&t; * Size of queue memory is encoded in bits 3:2 like this:&n;&t; *    00  (0x00)  512K&n;&t; *    01  (0x04)  1M&n;&t; *    10  (0x08)  2M&n;&t; *    11  (0x0C)  4M&n;&t; * The queue location is to be written to 0x85C0.&n;&t; *&n;         */
id|cmdq_baseport
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_PHYBASE
)paren
suffix:semicolon
id|write_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_WRITEPORT
)paren
suffix:semicolon
id|read_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_READPORT
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;AGP base: 0x%p, read: 0x%p, write: 0x%p&bslash;n&quot;
comma
id|cmdq_baseport
comma
id|read_port
comma
id|write_port
)paren
suffix:semicolon
id|agp_size
op_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
macro_line|#ifndef AGPOFF
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
(brace
id|agp_info
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|agp_info
comma
l_int|0x00
comma
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
id|agp_copy_info
c_func
(paren
id|agp_info
)paren
suffix:semicolon
id|agp_backend_acquire
c_func
(paren
)paren
suffix:semicolon
id|agp
op_assign
id|agp_allocate_memory
c_func
(paren
id|COMMAND_QUEUE_AREA_SIZE
op_div
id|PAGE_SIZE
comma
id|AGP_NORMAL_MEMORY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|agp
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Allocating AGP buffer failed.&bslash;n&quot;
)paren
suffix:semicolon
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|agp_bind_memory
c_func
(paren
id|agp
comma
id|agp-&gt;pg_start
)paren
op_ne
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP: Failed to bind memory&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: Free AGP memory here */
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|agp_enable
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* TW: Now select the queue mode */
r_if
c_cond
(paren
(paren
id|agp_enabled
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
)paren
(brace
id|cmd_type
op_assign
id|AGP_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using AGP queue mode&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&t;} else if (sisfb_heap_size &gt;= COMMAND_QUEUE_AREA_SIZE)  */
)brace
r_else
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|VM_CMD_QUEUE
)paren
(brace
id|cmd_type
op_assign
id|VM_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using VRAM queue mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using MMIO queue mode&bslash;n&quot;
)paren
suffix:semicolon
id|cmd_type
op_assign
id|MMIO_CMD
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|agp_size
)paren
(brace
r_case
l_int|0x80000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_512k
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_1M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x200000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_2M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x400000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_4M
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd_type
)paren
(brace
r_case
id|AGP_CMD_QUEUE
suffix:colon
macro_line|#ifndef AGPOFF
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP buffer base:0x%lx, offset:0x%x, size: %dK&bslash;n&quot;
comma
id|agp_info-&gt;aper_base
comma
id|agp-&gt;physical
comma
id|agp_size
op_div
l_int|1024
)paren
suffix:semicolon
id|agp_phys
op_assign
id|agp_info-&gt;aper_base
op_plus
id|agp-&gt;physical
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_AGP_IO_PAD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
l_int|0
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|SIS_AGP_2X
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_AGP_CMDQUEUE_ENABLE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|agp_phys
suffix:semicolon
id|sisfb_caps
op_or_assign
id|AGP_CMD_QUEUE_CAP
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|VM_CMD_QUEUE
suffix:colon
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_VRAM_CMDQUEUE_ENABLE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|VM_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: VM Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* MMIO */
multiline_comment|/* TW: This previously only wrote SIS_MMIO_CMD_ENABLE&n;&t;&t; * to IND_SIS_CMDQUEUE_SET. I doubt that this is&n;&t;&t; * enough. Reserve memory in any way.&n;&t;&t; */
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
multiline_comment|/* TW: Set Auto_Correction bit; this works in sisfb lite,&n;&t;&t; * so why not.&n;&t;&t; */
id|temp
op_or_assign
(paren
id|SIS_MMIO_CMD_ENABLE
op_or
id|SIS_CMD_AUTO_CORR
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: MMIO Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* sisvga_engine = 315 */
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
multiline_comment|/* TW: Now initialize TurboQueue. TB is always located at the very&n;&t;     * top of the video RAM. */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|TURBO_QUEUE_AREA_SIZE
)paren
(brace
r_int
r_int
id|tqueue_pos
suffix:semicolon
id|u8
id|tq_state
suffix:semicolon
id|tqueue_pos
op_assign
(paren
id|ivideo.video_size
op_minus
id|TURBO_QUEUE_AREA_SIZE
)paren
op_div
(paren
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_TURBOQUEUE_SET
)paren
suffix:semicolon
id|tq_state
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|tq_state
op_or_assign
l_int|0xf0
suffix:semicolon
id|tq_state
op_and_assign
l_int|0xfc
suffix:semicolon
id|tq_state
op_or_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|tq_state
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_TURBOQUEUE_ADR
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
id|sisfb_caps
op_or_assign
id|TURBO_QUEUE_CAP
suffix:semicolon
id|sisfb_heap_end
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: TurboQueue start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|TURBO_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* TW: Now reserve memory for the HWCursor. It is always located at the very&n;               top of the videoRAM, right below the TB memory area (if used). */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|sisfb_hwcursor_size
)paren
(brace
id|sisfb_heap_end
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_hwcursor_vbase
op_assign
id|sisfb_heap_end
suffix:semicolon
id|sisfb_caps
op_or_assign
id|HW_CURSOR_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Hardware Cursor start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|sisfb_hwcursor_size
op_div
l_int|1024
)paren
suffix:semicolon
)brace
id|sisfb_heap.poha_chain
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
l_int|NULL
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|poh-&gt;poh_next
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
op_plus
l_int|1
suffix:semicolon
id|poh-&gt;offset
op_assign
id|sisfb_heap_start
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Heap start:0x%p, end:0x%p, len=%dk&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_start
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_end
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: First Node offset:0x%x, size:%dk&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|poh-&gt;offset
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|sisfb_heap.oh_free.poh_next
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.poh_prev
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.size
op_assign
l_int|0
suffix:semicolon
id|sisfb_heap.max_freesize
op_assign
id|poh-&gt;size
suffix:semicolon
id|sisfb_heap.oh_used.poh_next
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.poh_prev
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.size
op_assign
id|SENTINEL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_poh_new_node
r_static
id|SIS_OH
op_star
id|sisfb_poh_new_node
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|cOhs
suffix:semicolon
id|SIS_OHALLOC
op_star
id|poha
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap.poh_freelist
op_eq
l_int|NULL
)paren
(brace
id|poha
op_assign
id|kmalloc
c_func
(paren
id|OH_ALLOC_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|poha
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|poha-&gt;poha_next
op_assign
id|sisfb_heap.poha_chain
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
id|poha
suffix:semicolon
id|cOhs
op_assign
(paren
id|OH_ALLOC_SIZE
op_minus
r_sizeof
(paren
id|SIS_OHALLOC
)paren
)paren
op_div
r_sizeof
(paren
id|SIS_OH
)paren
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cOhs
op_minus
l_int|1
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|poh-&gt;poh_next
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh-&gt;poh_next
suffix:semicolon
r_return
(paren
id|poh
)paren
suffix:semicolon
)brace
DECL|function|sisfb_poh_allocate
r_static
id|SIS_OH
op_star
id|sisfb_poh_allocate
c_func
(paren
r_int
r_int
id|size
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|pohRoot
suffix:semicolon
r_int
id|bAllocated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|sisfb_heap.max_freesize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|pohThis-&gt;size
)paren
(brace
id|bAllocated
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|bAllocated
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|pohThis-&gt;size
)paren
(brace
id|pohRoot
op_assign
id|pohThis
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|pohThis
)paren
suffix:semicolon
)brace
r_else
(brace
id|pohRoot
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pohRoot
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohRoot-&gt;offset
op_assign
id|pohThis-&gt;offset
suffix:semicolon
id|pohRoot-&gt;size
op_assign
id|size
suffix:semicolon
id|pohThis-&gt;offset
op_add_assign
id|size
suffix:semicolon
id|pohThis-&gt;size
op_sub_assign
id|size
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_sub_assign
id|size
suffix:semicolon
id|pohThis
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_insert_node
c_func
(paren
id|pohThis
comma
id|pohRoot
)paren
suffix:semicolon
r_return
(paren
id|pohRoot
)paren
suffix:semicolon
)brace
DECL|function|sisfb_delete_node
r_static
r_void
id|sisfb_delete_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|poh_prev
op_assign
id|poh-&gt;poh_prev
suffix:semicolon
id|poh_next
op_assign
id|poh-&gt;poh_next
suffix:semicolon
id|poh_prev-&gt;poh_next
op_assign
id|poh_next
suffix:semicolon
id|poh_next-&gt;poh_prev
op_assign
id|poh_prev
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|sisfb_insert_node
r_static
r_void
id|sisfb_insert_node
c_func
(paren
id|SIS_OH
op_star
id|pohList
comma
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|pohTemp
suffix:semicolon
id|pohTemp
op_assign
id|pohList-&gt;poh_next
suffix:semicolon
id|pohList-&gt;poh_next
op_assign
id|poh
suffix:semicolon
id|pohTemp-&gt;poh_prev
op_assign
id|poh
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
id|pohList
suffix:semicolon
id|poh-&gt;poh_next
op_assign
id|pohTemp
suffix:semicolon
)brace
DECL|function|sisfb_poh_free
r_static
id|SIS_OH
op_star
id|sisfb_poh_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|poh_freed
suffix:semicolon
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
r_int
r_int
id|ulUpper
suffix:semicolon
r_int
r_int
id|ulLower
suffix:semicolon
r_int
id|foundNode
op_assign
l_int|0
suffix:semicolon
id|poh_freed
op_assign
id|sisfb_heap.oh_used.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|poh_freed
op_ne
op_amp
id|sisfb_heap.oh_used
)paren
(brace
r_if
c_cond
(paren
id|poh_freed-&gt;offset
op_eq
id|base
)paren
(brace
id|foundNode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|poh_freed
op_assign
id|poh_freed-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|foundNode
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
id|sisfb_heap.max_freesize
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_prev
op_assign
id|poh_next
op_assign
l_int|NULL
suffix:semicolon
id|ulUpper
op_assign
id|poh_freed-&gt;offset
op_plus
id|poh_freed-&gt;size
suffix:semicolon
id|ulLower
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|pohThis-&gt;offset
op_eq
id|ulUpper
)paren
(brace
id|poh_next
op_assign
id|pohThis
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pohThis-&gt;offset
op_plus
id|pohThis-&gt;size
)paren
op_eq
id|ulLower
)paren
(brace
id|poh_prev
op_assign
id|pohThis
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
id|sisfb_delete_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh_prev
op_logical_and
id|poh_next
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
(paren
id|poh_freed-&gt;size
op_plus
id|poh_next-&gt;size
)paren
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_prev
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_next
)paren
(brace
id|poh_next-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_next-&gt;offset
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_next
)paren
suffix:semicolon
)brace
id|sisfb_insert_node
c_func
(paren
op_amp
id|sisfb_heap.oh_free
comma
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_freed
)paren
suffix:semicolon
)brace
DECL|function|sisfb_free_node
r_static
r_void
id|sisfb_free_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|sis_malloc
r_void
id|sis_malloc
c_func
(paren
r_struct
id|sis_memreq
op_star
id|req
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_allocate
c_func
(paren
id|req-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|req-&gt;offset
op_assign
l_int|0
suffix:semicolon
id|req-&gt;size
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation succeeded: 0x%p&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|poh-&gt;offset
op_plus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
)paren
)paren
suffix:semicolon
id|req-&gt;offset
op_assign
id|poh-&gt;offset
suffix:semicolon
id|req-&gt;size
op_assign
id|poh-&gt;size
suffix:semicolon
)brace
)brace
DECL|function|sis_free
r_void
id|sis_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_free
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: sisfb_poh_free() failed at base 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------ SetMode Routines ------------------------------- */
DECL|function|sisfb_pre_setmode
r_static
r_void
id|sisfb_pre_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|cr30
op_assign
l_int|0
comma
id|cr31
op_assign
l_int|0
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x31
)paren
suffix:semicolon
id|cr31
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_amp
op_complement
l_int|0x60
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_CRT2
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT2 type is VGA&bslash;n&quot;
)paren
suffix:semicolon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_CRT2
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_LCD
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT2 type is LCD&bslash;n&quot;
)paren
suffix:semicolon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_LCD
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT2 type is TV&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_HIVISION
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_HIVISION
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SVIDEO
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_COMPOSITE
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SCART
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SCART
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
multiline_comment|/* cr31 &amp;= ~0x04; */
multiline_comment|/* TW @@@ 5/5/02 */
multiline_comment|/* TW: No NotSimuMode by default  */
multiline_comment|/*karl*/
r_if
c_cond
(paren
id|sisfb_tvmode
op_eq
l_int|1
op_logical_or
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
id|cr31
op_or_assign
l_int|0x1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_tvmode
op_eq
l_int|2
op_logical_or
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
id|cr31
op_and_assign
op_complement
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* CRT2 disable */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT2 is disabled&bslash;n&quot;
)paren
suffix:semicolon
id|cr30
op_assign
l_int|0x00
suffix:semicolon
id|cr31
op_or_assign
(paren
id|SIS_DRIVER_MODE
op_or
id|SIS_VB_OUTPUT_DISABLE
)paren
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR30
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|cr30
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR31
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|cr31
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR33
)paren
suffix:semicolon
multiline_comment|/*&n;&t;if (ivideo.disp_state &amp; DISPTYPE_CRT2) {&n;&t;&t;sisfb_rate_idx &amp;= 0x0F;&n;&t;&t;sisfb_rate_idx |= (sisfb_rate_idx &lt;&lt; 4);&n;&t;&t;vgawb(CRTC_DATA, sisfb_rate_idx);&n;&t;} else {&n;&t;&t;vgawb(CRTC_DATA, sisfb_rate_idx &amp; 0x0F);&n;&t;}&n;*/
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|sisfb_rate_idx
op_amp
l_int|0x0F
)paren
suffix:semicolon
)brace
DECL|function|sisfb_post_setmode
r_static
r_void
id|sisfb_post_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
multiline_comment|/* TW: We can&squot;t switch off CRT1 on LVDS/Chrontel in 8bpp Modes */
r_if
c_cond
(paren
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS
)paren
op_logical_or
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: We can&squot;t switch off CRT1 on 630+301B in 8bpp Modes */
r_if
c_cond
(paren
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_301B
)paren
op_logical_and
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_LCD
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: We can&squot;t switch off CRT1 if bridge is in slave mode */
id|vgawb
c_func
(paren
id|VB_PART1_ADR
comma
l_int|0x00
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART1_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0x50
)paren
op_eq
l_int|0x10
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
id|reg
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|reg
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_RAMDAC_CONTROL
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
l_int|0x04
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_TV
)paren
op_logical_and
(paren
id|ivideo.hasVB
op_eq
id|HASVB_301
)paren
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART4_ADR
comma
l_int|0x01
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xB0
)paren
multiline_comment|/* 301B Revision ID */
(brace
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|320
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|filter
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// ~Eden Chen
singleline_comment|// Eden Chen
singleline_comment|//vgawb(VB_PART1_ADR,  0x24);
id|vgawb
c_func
(paren
id|VB_PART1_ADR
comma
id|sisfb_CRT2_write_enable
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
id|vgawb
c_func
(paren
id|VB_PART1_DATA
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x1F
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xDF
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x20
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xEB
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x04
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x25
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xEE
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x0C
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x22
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xEB
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x15
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x25
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xF6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x1F
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xDF
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x20
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xF1
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xF7
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x1F
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xF3
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x00
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x1D
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xFC
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0xFB
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x14
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
l_int|0x2A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
singleline_comment|// Eden 
r_if
c_cond
(paren
(paren
id|filter
op_ge
l_int|0
)paren
op_logical_and
(paren
id|filter
op_le
l_int|7
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;FilterTable[%d]-%d: %02x %02x %02x %02x&bslash;n&quot;
comma
id|filter_tb
comma
id|filter
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
singleline_comment|// ~Eden 
)brace
)brace
)brace
DECL|function|sisfb_crtc_to_var
r_static
r_void
id|sisfb_crtc_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u16
id|VRE
comma
id|VBE
comma
id|VRS
comma
id|VBS
comma
id|VDE
comma
id|VT
suffix:semicolon
id|u16
id|HRE
comma
id|HBE
comma
id|HRS
comma
id|HBS
comma
id|HDE
comma
id|HT
suffix:semicolon
id|u8
id|sr_data
comma
id|cr_data
comma
id|cr_data2
comma
id|cr_data3
comma
id|mr_data
suffix:semicolon
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|F
comma
id|temp
suffix:semicolon
r_float
id|hrate
comma
id|drate
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_COLOR_MODE
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr_data
op_amp
id|SIS_INTERLACED_MODE
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|sr_data
op_amp
l_int|0x1C
)paren
op_rshift
l_int|2
)paren
(brace
r_case
id|SIS_8BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_16BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_32BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|6
suffix:semicolon
id|video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0xA
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x6
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x7
)paren
suffix:semicolon
id|cr_data2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VT
op_assign
(paren
id|cr_data
op_amp
l_int|0xFF
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x01
)paren
op_lshift
l_int|10
)paren
suffix:semicolon
id|A
op_assign
id|VT
op_plus
l_int|2
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x12
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x40
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x02
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|E
op_assign
id|VDE
op_plus
l_int|1
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x10
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x04
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x08
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|F
op_assign
id|VRS
op_plus
l_int|1
op_minus
id|E
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x15
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x9
)paren
suffix:semicolon
id|cr_data3
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x08
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data3
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x16
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VBE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_assign
id|VBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|511
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|512
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x11
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VRE
op_assign
(paren
id|cr_data
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x20
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|VRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_minus
l_int|1
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|32
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
op_assign
id|E
suffix:semicolon
multiline_comment|/* TW: We have to report the physical dimension to the console! */
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|var-&gt;yres
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;yres_virtual
op_lshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* TW end */
id|var-&gt;upper_margin
op_assign
id|D
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|F
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|C
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0xb
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x0
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HT
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|A
op_assign
id|HT
op_plus
l_int|5
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x1
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x0C
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|E
op_assign
id|HDE
op_plus
l_int|1
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x4
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0xC0
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|F
op_assign
id|HRS
op_minus
id|E
op_minus
l_int|3
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x2
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0xc
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x3
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x5
)paren
suffix:semicolon
id|cr_data2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HBE
op_assign
(paren
id|cr_data
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|HRE
op_assign
(paren
id|cr_data2
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|temp
op_assign
id|HBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|256
)paren
suffix:semicolon
id|temp
op_assign
id|HRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_plus
l_int|3
)paren
op_amp
l_int|63
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|64
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|E
op_star
l_int|8
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|D
op_star
l_int|8
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|F
op_star
l_int|8
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|C
op_star
l_int|8
suffix:semicolon
id|var-&gt;activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|mr_data
op_assign
id|vgarb
c_func
(paren
l_int|0x1C
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x80
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x40
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
id|VT
op_add_assign
l_int|2
suffix:semicolon
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
id|HT
op_assign
(paren
id|HT
op_plus
l_int|5
)paren
op_star
l_int|8
suffix:semicolon
id|hrate
op_assign
(paren
r_float
)paren
id|ivideo.refresh_rate
op_star
(paren
r_float
)paren
id|VT
op_div
l_int|2
suffix:semicolon
id|drate
op_assign
id|hrate
op_star
id|HT
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_float|1E12
op_div
id|drate
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------ Public Routines -------------------------------- */
DECL|function|sisfb_get_fix
r_static
r_int
id|sisfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|fb_info.modename
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|ivideo.video_base
suffix:semicolon
multiline_comment|/*karl:10/01/2001*/
multiline_comment|/* TW */
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|fix-&gt;smem_len
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
id|fix-&gt;smem_len
op_assign
l_int|0x800000
suffix:semicolon
r_else
id|fix-&gt;smem_len
op_assign
l_int|0x400000
suffix:semicolon
)brace
r_else
id|fix-&gt;smem_len
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
id|fix-&gt;type
op_assign
id|video_type
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|video_linelength
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|ivideo.mmio_base
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|sisfb_mmio_size
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|0
)braket
op_assign
id|ivideo.video_size
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|1
)braket
op_assign
(paren
id|ivideo.video_size
op_rshift
l_int|16
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|2
)braket
op_assign
id|sisfb_caps
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_var
r_static
r_int
id|sisfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|default_var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
multiline_comment|/* JennyLee 2001126: for FSTN */
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|320
op_logical_and
id|var-&gt;yres
op_eq
l_int|480
)paren
id|var-&gt;yres
op_assign
l_int|240
suffix:semicolon
multiline_comment|/* ~JennyLee */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_var
r_static
r_int
id|sisfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
id|cols
comma
id|rows
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
id|sisfb_do_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|info-&gt;currcon
comma
id|info
)paren
)paren
(brace
macro_line|#else
r_if
c_cond
(paren
id|sisfb_do_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|currcon
comma
id|info
)paren
)paren
(brace
macro_line|#endif
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;changevar
)paren
(paren
op_star
id|info-&gt;changevar
)paren
(paren
id|con
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap
r_static
r_int
id|sisfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
macro_line|#else
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
macro_line|#endif
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|video_cmap_len
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_cmap
r_static
r_int
id|sisfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|video_cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|info
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
r_else
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_ioctl
r_static
r_int
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_malloc
c_func
(paren
(paren
r_struct
id|sis_memreq
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_free
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_GLYPH
suffix:colon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,23)
id|sis_get_glyph
c_func
(paren
(paren
id|SIS_GLYINFO
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#else
id|sis_get_glyph
c_func
(paren
id|info
comma
(paren
id|SIS_GLYINFO
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|FBIOGET_HWCINFO
suffix:colon
(brace
r_int
r_int
op_star
id|hwc_offset
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_caps
op_amp
id|HW_CURSOR_CAP
)paren
op_star
id|hwc_offset
op_assign
id|sisfb_hwcursor_vbase
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
r_else
op_star
id|hwc_offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOPUT_MODEINFO
suffix:colon
(brace
r_struct
id|mode_info
op_star
id|x
op_assign
(paren
r_struct
id|mode_info
op_star
)paren
id|arg
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|x-&gt;bpp
suffix:semicolon
id|ivideo.video_width
op_assign
id|x-&gt;xres
suffix:semicolon
id|ivideo.video_height
op_assign
id|x-&gt;yres
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|x-&gt;v_xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|x-&gt;v_yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|x-&gt;org_x
suffix:semicolon
id|ivideo.org_y
op_assign
id|x-&gt;org_y
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|x-&gt;vrate
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOGET_DISPINFO
suffix:colon
id|sis_dispinfo
c_func
(paren
(paren
r_struct
id|ap_data
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISFB_GET_INFO
suffix:colon
multiline_comment|/* TW: New for communication with X driver */
(brace
id|sisfb_info
op_star
id|x
op_assign
(paren
id|sisfb_info
op_star
)paren
id|arg
suffix:semicolon
id|x-&gt;sisfb_id
op_assign
id|SISFB_ID
suffix:semicolon
id|x-&gt;sisfb_version
op_assign
id|VER_MAJOR
suffix:semicolon
id|x-&gt;sisfb_revision
op_assign
id|VER_MINOR
suffix:semicolon
id|x-&gt;sisfb_patchlevel
op_assign
id|VER_LEVEL
suffix:semicolon
id|x-&gt;chip_id
op_assign
id|ivideo.chip_id
suffix:semicolon
id|x-&gt;memory
op_assign
id|ivideo.video_size
op_div
l_int|1024
suffix:semicolon
id|x-&gt;heapstart
op_assign
id|ivideo.heapstart
op_div
l_int|1024
suffix:semicolon
id|x-&gt;fbvidmode
op_assign
id|sisfb_mode_no
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
id|sisfb_get_var
c_func
(paren
op_amp
id|var
comma
id|info-&gt;currcon
comma
id|info
)paren
suffix:semicolon
macro_line|#else
id|sisfb_get_var
c_func
(paren
op_amp
id|var
comma
id|currcon
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|var.accel_flags
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
macro_line|#if defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
macro_line|#else&t;/* TW: 2.5 API */
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
macro_line|#endif
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|sisfb_get_fix
comma
id|fb_get_var
suffix:colon
id|sisfb_get_var
comma
id|fb_set_var
suffix:colon
id|sisfb_set_var
comma
id|fb_get_cmap
suffix:colon
id|sisfb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|sisfb_set_cmap
comma
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
id|fb_setcolreg
suffix:colon
id|sisfb_setcolreg
comma
id|fb_blank
suffix:colon
id|sisfb_blank
comma
macro_line|#endif
id|fb_ioctl
suffix:colon
id|sisfb_ioctl
comma
id|fb_mmap
suffix:colon
id|sisfb_mmap
comma
)brace
suffix:semicolon
multiline_comment|/* ------------ Interface to the low level console driver -------------*/
DECL|function|sisfb_update_var
r_static
r_int
id|sisfb_update_var
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_switch
r_static
r_int
id|sisfb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|cols
comma
id|rows
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap.len
)paren
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap.len
)paren
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|currcon
op_assign
id|con
suffix:semicolon
macro_line|#endif
id|sisfb_do_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|sisfb_update_var
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_void
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
l_int|0
)paren
id|reg
op_and_assign
l_int|0x7f
suffix:semicolon
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|sisfb_setup
r_int
id|sisfb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
id|fb_info.fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
id|fb_invert_cmaps
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|strcpy
c_func
(paren
id|fb_info.fontname
comma
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vrate:&quot;
comma
l_int|6
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;rate:&quot;
comma
l_int|5
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;crt1off&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;filter:&quot;
comma
l_int|7
)paren
)paren
(brace
id|filter
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt2type:&quot;
comma
l_int|14
)paren
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt1:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_forcecrt1
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|10
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvmode:&quot;
comma
l_int|7
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_string|&quot;pal&quot;
comma
l_int|3
)paren
)paren
id|sisfb_tvmode
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_string|&quot;ntsc&quot;
comma
l_int|4
)paren
)paren
id|sisfb_tvmode
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mem:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_mem
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;dstn:&quot;
comma
l_int|5
)paren
)paren
(brace
id|enable_dstn
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* TW: DSTN overrules forcecrt2type */
r_if
c_cond
(paren
id|enable_dstn
)paren
id|sisfb_crt2type
op_assign
id|DISPTYPE_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;queuemode:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_search_queuemode
c_func
(paren
id|this_opt
op_plus
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pdc:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_pdc
op_amp
op_complement
l_int|0x3c
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Illegal pdc parameter&bslash;n&quot;
)paren
suffix:semicolon
id|sisfb_pdc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid parameter %s&bslash;n&quot;
comma
id|this_opt
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_init
r_int
id|__init
id|sisfb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|board
op_star
id|b
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
singleline_comment|//unsigned long rom_vbase;
id|u32
id|reg32
suffix:semicolon
id|u16
id|reg16
suffix:semicolon
id|u8
id|reg
suffix:semicolon
r_int
id|temp1
comma
id|temp2
suffix:semicolon
id|outb
c_func
(paren
l_int|0x77
comma
l_int|0x80
)paren
suffix:semicolon
macro_line|#if 0 &t;
multiline_comment|/* for DOC VB */
id|sisfb_set_reg4
c_func
(paren
l_int|0xcf8
comma
l_int|0x800000e0
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xcfc
)paren
suffix:semicolon
id|reg32
op_assign
id|reg32
op_or
l_int|0x00001000
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xcfc
comma
id|reg32
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_off
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|enable_dstn
)paren
id|SetEnableDstn
c_func
(paren
)paren
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
r_for
c_loop
(paren
id|b
op_assign
id|sisdev_list
suffix:semicolon
id|b-&gt;vendor
suffix:semicolon
id|b
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|b-&gt;vendor
op_eq
id|pdev-&gt;vendor
)paren
op_logical_and
(paren
id|b-&gt;device
op_eq
id|pdev-&gt;device
)paren
)paren
(brace
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.modename
comma
id|b-&gt;name
)paren
suffix:semicolon
id|ivideo.chip_id
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|ivideo.revision_id
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|reg16
)paren
suffix:semicolon
id|sishw_ext.jChipRevision
op_assign
id|ivideo.revision_id
suffix:semicolon
id|sisvga_enabled
op_assign
id|reg16
op_amp
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pdev_valid
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|ivideo.chip_id
)paren
(brace
r_case
id|PCI_DEVICE_ID_SI_300
suffix:colon
id|ivideo.chip
op_assign
id|SIS_300
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_630_VGA
suffix:colon
(brace
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07301039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_730
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.modename
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
)brace
r_else
id|ivideo.chip
op_assign
id|SIS_630
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_540_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_540
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315H
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315H
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315PRO
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315PRO
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_550_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_550
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_650_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_650
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sishw_ext.jChipType
op_assign
id|ivideo.chip
suffix:semicolon
singleline_comment|// for Debug
r_if
c_cond
(paren
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315
)paren
)paren
id|sishw_ext.jChipType
op_assign
id|SIS_315H
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s is used as %s device(VGA Engine %d).&bslash;n&quot;
comma
id|fb_info.modename
comma
id|sisvga_enabled
ques
c_cond
l_string|&quot;primary&quot;
suffix:colon
l_string|&quot;secondary&quot;
comma
id|sisvga_engine
)paren
suffix:semicolon
id|ivideo.video_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|ivideo.mmio_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|sishw_ext.ulIOAddress
op_assign
(paren
r_int
r_int
)paren
id|ivideo.vga_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
op_plus
l_int|0x30
suffix:semicolon
id|sisfb_mmio_size
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
singleline_comment|// Eden Eden
singleline_comment|//#ifdef LINUXBIOS
singleline_comment|//&t;sishw_ext.VirtualRomBase = rom_vbase = (unsigned long) rom_data;
singleline_comment|//#else
singleline_comment|//&t;{
singleline_comment|//&t;unsigned long rom_base  = 0x000C0000;
singleline_comment|//
singleline_comment|//&t;request_region(rom_base, 32, &quot;sisfb&quot;);
singleline_comment|//&t;sishw_ext.VirtualRomBase = rom_vbase 
singleline_comment|//&t;&t;= (unsigned long) ioremap(rom_base, MAX_ROM_SCAN);
singleline_comment|//&t;}
singleline_comment|//#endif
singleline_comment|// ~Eden Chen
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
multiline_comment|/* TW: Debug kernel 2.5 problem */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x14
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sisfb: SR14 = 0x%02x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* /TW */
macro_line|#ifdef LINUXBIOS
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x28
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x29
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
l_int|0x61
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_1A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_SCRATCH_REG_1A_MASK
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
op_logical_or
id|ivideo.chip
op_eq
id|SIS_650
)paren
(brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x28
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
l_int|0x5A
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x29
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
l_int|0x64
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
l_int|0x00
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif /* LinuxBIOS */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_315H
suffix:colon
r_case
id|SIS_315
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
r_case
id|SIS_650
suffix:colon
singleline_comment|// Eden Chen
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_SCRATCH_REG_1A);
singleline_comment|//reg = vgarb(SEQ_DATA);
singleline_comment|//if (reg &amp; SIS_SCRATCH_REG_1A_MASK)
singleline_comment|//&t;sishw_ext.bIntegratedMMEnabled = TRUE;
singleline_comment|//else
singleline_comment|//&t;sishw_ext.bIntegratedMMEnabled = FALSE;
singleline_comment|//for Debug
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
singleline_comment|// ~Eden Chen
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_1A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|SIS_SCRATCH_REG_1A_MASK
)paren
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_else
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
id|sishw_ext.pDevice
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.pjVirtualRomBase
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.pjCustomizedROMImage
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
l_int|0
suffix:semicolon
id|sishw_ext.pQueryVGAConfigSpace
op_assign
op_amp
id|sisfb_query_VGA_config_space
suffix:semicolon
id|sishw_ext.pQueryNorthBridgeSpace
op_assign
op_amp
id|sisfb_query_north_bridge_space
suffix:semicolon
id|strcpy
c_func
(paren
id|sishw_ext.szVBIOSVer
comma
l_string|&quot;0.84&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: Mode numbers for 1280x960 are different for 300 and 310/325 series */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
)braket
dot
id|mode_no
op_assign
l_int|0x6e
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|1
)braket
dot
id|mode_no
op_assign
l_int|0x6f
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|2
)braket
dot
id|mode_no
op_assign
l_int|0x7b
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|3
)braket
dot
id|mode_no
op_assign
l_int|0x7b
suffix:semicolon
)brace
id|sishw_ext.pSR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|SR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pSR
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Allocating SRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pCR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|CR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pCR
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Allocating CRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x2000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|SiSInit
c_func
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x2000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|SiSInit
c_func
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x7
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x10
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_get_dram_size_300
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 315 Init */
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.VirtualVideoMemoryAddress 
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|SiSInit
c_func
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x13
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x14
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|SiSInit
c_func
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x13
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
l_int|0x14
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_get_dram_size_315
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PCI_ADDRESS_SET
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_PCI_ADDR_ENABLE
suffix:semicolon
multiline_comment|/* Enable PCI_LINEAR_ADDRESSING */
id|reg
op_or_assign
id|SIS_MEM_MAP_IO_ENABLE
suffix:semicolon
multiline_comment|/* Enable MMIO_ENABLE */
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_MODULE_ENABLE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_ENABLE_2D
suffix:semicolon
multiline_comment|/* Enable 2D accelerator engine */
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
id|sishw_ext.ulVideoMemorySize
op_assign
id|ivideo.video_size
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_pdc
)paren
(brace
id|sishw_ext.pdc
op_assign
id|sisfb_pdc
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.pdc
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
comma
l_string|&quot;sisfb FB&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Is there another framebuffer driver active?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
comma
l_string|&quot;sisfb MMIO&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ivideo.video_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|ivideo.mmio_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Framebuffer at 0x%lx, mapped to 0x%p, size %dk&bslash;n&quot;
comma
id|ivideo.video_base
comma
id|ivideo.video_vbase
comma
id|ivideo.video_size
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: MMIO at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo.mmio_base
comma
id|ivideo.mmio_vbase
comma
id|sisfb_mmio_size
op_div
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_get_VB_type_300
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
id|sisfb_detect_VB_connect_300
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|sisfb_get_VB_type_315
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
id|sisfb_detect_VB_connect_315
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_UNKNOWN
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.hasVB
)paren
(brace
r_case
id|HASVB_301
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART4_ADR
comma
l_int|0x01
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xD0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xB0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301B
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301B bridge detected (revision 0x%02x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301 bridge detected&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HASVB_302
suffix:colon
id|vgawb
c_func
(paren
id|VB_PART4_ADR
comma
l_int|0x01
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xD0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xB0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302B
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302B bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302 bridge detected&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HASVB_303
suffix:colon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_303
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS303 bridge detected (not supported)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_LVDS
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: LVDS transmitter detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_TRUMPION
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Trumpion Zurac LVDS scaler detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel TV encoder detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_LVDS_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x5
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: LVDS transmitter and Chrontel TV encoder detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: No or unknown bridge type detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* TW: Determine and detect attached TV&squot;s on Chrontel */
r_if
c_cond
(paren
id|sishw_ext.usExternalChip
op_eq
l_int|0x04
op_logical_or
id|sishw_ext.usExternalChip
op_eq
l_int|0x05
)paren
(brace
id|SiSRegInit
c_func
(paren
id|sishw_ext.ulIOAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
multiline_comment|/* TW: Chrontel 7005 */
macro_line|#ifdef CONFIG_FB_SIS_300
id|SiS_IF_DEF_CH70xx
op_assign
l_int|1
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
l_int|0x25
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_ge
l_int|50
)paren
op_logical_and
(paren
id|temp1
op_le
l_int|100
)paren
)paren
(brace
multiline_comment|/* TW: Read power status */
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x03
)paren
op_ne
l_int|0x03
)paren
(brace
multiline_comment|/* TW: Power all outputs */
id|SiS_SetCH70xxANDOR
c_func
(paren
l_int|0x030E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: Sense connected TV devices */
id|SiS_SetCH700x
c_func
(paren
l_int|0x0110
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
l_int|0x0010
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x08
)paren
)paren
(brace
multiline_comment|/* TW: So we can be sure that there IS a SVHS output */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SVHS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x32
)paren
suffix:semicolon
id|temp2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_or
l_int|0x02
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|temp2
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
multiline_comment|/* TW: So we can be sure that there IS a CVBS output */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to CVBS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x32
)paren
suffix:semicolon
id|temp2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_or
l_int|0x01
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|temp2
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0
)paren
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
multiline_comment|/* TW: Chrontel 7019 */
macro_line|#ifdef CONFIG_FB_SIS_315
id|SiS_IF_DEF_CH70xx
op_assign
l_int|2
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH701x
c_func
(paren
l_int|0x49
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
l_int|0x2049
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
l_int|0x20
)paren
suffix:semicolon
id|temp2
op_or_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_xor_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
l_int|0x20
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
(paren
id|temp1
op_lshift
l_int|8
)paren
op_or
l_int|0x49
)paren
suffix:semicolon
id|temp1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x02
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x10
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x04
)paren
(brace
id|temp1
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|temp1
op_assign
l_int|0x04
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|temp1
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to CVBS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x32
)paren
suffix:semicolon
id|temp2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_or
l_int|0x01
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|temp2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SVHS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
l_int|0x32
)paren
suffix:semicolon
id|temp2
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_or
l_int|0x02
suffix:semicolon
id|vgawb
c_func
(paren
id|CRTC_DATA
comma
id|temp2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
multiline_comment|/* TW: This should not happen */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SCART output!?&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
id|ivideo.disp_state
op_or_assign
id|DISPMODE_SINGLE
suffix:semicolon
r_else
id|ivideo.disp_state
op_or_assign
(paren
id|DISPMODE_MIRROR
op_or
id|DISPTYPE_CRT1
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo.disp_state
op_assign
id|DISPMODE_SINGLE
op_or
id|DISPTYPE_CRT1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_LCD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|enable_dstn
)paren
(brace
id|vgawb
c_func
(paren
id|CRTC_ADR
comma
id|IND_SIS_LCD_PANEL
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
c_func
(paren
id|CRTC_DATA
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis300paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis310paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* TW: FSTN/DSTN */
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_320x480
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_mode_idx
op_ge
l_int|0
)paren
id|sisfb_validate_mode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_LCDMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_TVMODE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.refresh_rate
op_ne
l_int|0
)paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_rate_idx
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Mode is %dx%dx%d (%dHz), linelength=%d&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|ivideo.refresh_rate
comma
id|video_linelength
)paren
suffix:semicolon
singleline_comment|// Eden Chen
singleline_comment|// Check interface correction  For Debug
id|DPRINTK
c_func
(paren
l_string|&quot;VM Adr=0x%p&bslash;n&quot;
comma
id|sishw_ext.pjVideoMemoryAddress
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VM Size=%ldK&bslash;n&quot;
comma
id|sishw_ext.ulVideoMemorySize
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;IO Adr=0x%lx&bslash;n&quot;
comma
id|sishw_ext.ulIOAddress
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Chip=%d&bslash;n&quot;
comma
id|sishw_ext.jChipType
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ChipRevision=%d&bslash;n&quot;
comma
id|sishw_ext.jChipRevision
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VBChip=%d&bslash;n&quot;
comma
id|sishw_ext.ujVBChipID
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ExtVB=%d&bslash;n&quot;
comma
id|sishw_ext.usExternalChip
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LCD=%ld&bslash;n&quot;
comma
id|sishw_ext.ulCRT2LCDType
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;bIntegratedMMEnabled=%d&bslash;n&quot;
comma
id|sishw_ext.bIntegratedMMEnabled
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sisfb: Setting mode[0x%x] failed, using default mode&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vgawb
c_func
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
c_func
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
id|sisfb_crtc_to_var
c_func
(paren
op_amp
id|default_var
)paren
suffix:semicolon
id|fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|fb_info.node
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|fb_info.node
op_assign
id|NODEV
suffix:semicolon
macro_line|#endif
id|fb_info.fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,23)
id|fb_info.screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|fb_info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
id|fb_info.disp
op_assign
op_amp
id|disp
suffix:semicolon
id|fb_info.switch_con
op_assign
op_amp
id|sisfb_switch
suffix:semicolon
id|fb_info.updatevar
op_assign
op_amp
id|sisfb_update_var
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,23)
id|fb_info.blank
op_assign
op_amp
id|sisfb_blank
suffix:semicolon
macro_line|#endif
id|fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|default_var
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: if mode = &quot;none&quot; */
r_if
c_cond
(paren
id|sisfb_heap_init
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sisfb: Failed to initialize offscreen memory heap&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|ivideo.mtrr
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* TW: for mode &quot;none&quot; */
multiline_comment|/*H.C.*/
id|ivideo.mtrr
op_assign
id|mtrr_add
c_func
(paren
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;if (ivideo.mtrr &gt;= 0) {&n;           &t;    printk(KERN_INFO &quot;Succeed to turn on Write-Combining on VideoMemory %08XH, Size: %08XH&bslash;n&quot;,&n;&t;&t;&t;&t;&t;ivideo.video_base, ivideo.video_size);&n;      &t;&t;} else&t;{&n;           &t;    printk(KERN_INFO &quot;Fail to turn on Write-Combining on Video Memory 0x%08X, Size: 0x%08X&bslash;n&quot;,&n;&t;&t;&t;&t;&t;ivideo.video_base, ivideo.video_size);&n;      &t;&t;}&n;&t;&t;*/
id|vc_resize_con
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|fb_info.node
)paren
comma
id|fb_info.modename
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Added SISFB_GET_INFO ioctl = %x&bslash;n&quot;
comma
id|SISFB_GET_INFO
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: if mode = &quot;none&quot; */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|rate
r_static
r_int
r_int
id|rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|crt1off
r_static
r_int
r_int
id|crt1off
op_assign
l_int|1
suffix:semicolon
DECL|variable|mem
r_static
r_int
r_int
id|mem
op_assign
l_int|0
suffix:semicolon
DECL|variable|dstn
r_static
r_int
r_int
id|dstn
op_assign
l_int|0
suffix:semicolon
DECL|variable|forcecrt2type
r_static
r_char
op_star
id|forcecrt2type
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|forcecrt1
r_static
r_int
id|forcecrt1
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|queuemode
r_static
r_char
op_star
id|queuemode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|pdc
r_static
r_int
id|pdc
op_assign
l_int|0
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 300/540/630/730/315/550/650/740 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* TW (Code is officially open says SiS) */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Various; SiS; Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;Selects the desired display mode in the format [X]x[Y]x[Depth], eg. 800x600x16 &quot;
l_string|&quot;(default: none; this leaves the console untouched and the driver will only do &quot;
l_string|&quot;the video memory management for eg. DRM/DRI)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|rate
comma
l_string|&quot;Selects the desired vertical refresh rate for CRT1 (external VGA) in Hz. &quot;
l_string|&quot;(default: 60)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|crt1off
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|crt1off
comma
l_string|&quot;If this option is set, the driver will switch off CRT1 (external VGA). &quot;
l_string|&quot;(Deprecated, please use forcecrt1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|filter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|filter
comma
l_string|&quot;Selects TV flicker filter type (only for SiS30x video bridges). &quot;
l_string|&quot;(Possible values 0-7, default: [no filter])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dstn
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* JennyLee 20011211 */
id|MODULE_PARM_DESC
c_func
(paren
id|dstn
comma
l_string|&quot;Selects DSTN/FSTN display mode for SiS550. This sets CRT2 type to LCD and &quot;
l_string|&quot;overrides forcecrt2type setting. (1=ON, 0=OFF) (default: 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|queuemode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|queuemode
comma
l_string|&quot;Selects the queue mode on 315/550/650/740. Possible choices are AGP, VRAM &quot;
l_string|&quot;or MMIO. AGP is only available if the kernel has AGP support. &quot;
l_string|&quot;The queue mode is important to programs using the 2D/3D accelerator of &quot;
l_string|&quot;the SiS chip. The modes require a totally different way of programming &quot;
l_string|&quot;the engines. On 300/540/630/730, this option is ignored. (default: MMIO)&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: &quot;Import&quot; the options from the X driver */
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mem
comma
l_string|&quot;Determines the beginning of the video memory heap in KB. This heap is used for &quot;
l_string|&quot;video RAM management for eg. DRM/DRI. The default depends on the amount of video &quot;
l_string|&quot;memory available. If 8MB of video RAM or less is available, &quot;
l_string|&quot;the heap starts at 4096KB, if between 8 and 16MB are available at 8192KB, otherwise at 12288MB.&quot;
l_string|&quot;The value is to be specified without &squot;KB&squot; and should match MaxXFBMem setting for &quot;
l_string|&quot;XFree 4.x (x&gt;=2). See http://www.winischhofer.net/linuxsis630.shtml for a closer description.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;If this option is omitted, the driver autodetects CRT2 output devices, such as LCD, &quot;
l_string|&quot;TV or secondary VGA (in this order; so if eg. an LCD is there, it will be used regardless &quot;
l_string|&quot;of a connected TV set). With this option, this autodetection can be overridden. &quot;
l_string|&quot;Possible parameters are LCD, TV, VGA or NONE. NONE disables CRT2 and makes it &quot;
l_string|&quot;possible to use higher resolutions on CRT1 than eg. your LCD panel supports. TV &quot;
l_string|&quot;selects TV output (only resolutions 640x480 and 800x600 are supported for TV!). &quot;
l_string|&quot;VGA refers to _secondary_ VGA which is unlikely to be available; the VGA plug found &quot;
l_string|&quot;on most machines is CRT1. (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt1
comma
l_string|&quot;Normally, the driver autodetects whether or not CRT1 (external VGA) is connected. &quot;
l_string|&quot;With this option, the detection can be overridden (1=CRT1 ON, 0=CRT1 off) &quot;
l_string|&quot;(default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pdc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pdc
comma
l_string|&quot;(300 series only) This is for manually selecting the LCD panel delay compensation. The &quot;
l_string|&quot;driver should detect this correctly in most cases; however, sometimes this is not possible. If &quot;
l_string|&quot;you see &squot;small waves&squot; on the LCD, try setting this to 4, 32 or 24. If the problem persists, &quot;
l_string|&quot;try other values between 4 and 60 in steps of 4. &quot;
l_string|&quot;(default: [autodetected])&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mode
)paren
id|sisfb_search_mode
c_func
(paren
id|mode
)paren
suffix:semicolon
r_else
multiline_comment|/* TW: set mode=none if no mode parameter is given */
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt2type
)paren
id|sisfb_search_crt2type
c_func
(paren
id|forcecrt2type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|crt1off
op_eq
l_int|0
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sisfb_forcecrt1
op_assign
id|forcecrt1
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|1
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|0
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
id|sisfb_mem
op_assign
id|mem
suffix:semicolon
id|enable_dstn
op_assign
id|dstn
suffix:semicolon
multiline_comment|/* JennyLee 20011211 */
multiline_comment|/* TW: DSTN overrules forcecrt2type */
r_if
c_cond
(paren
id|enable_dstn
)paren
id|sisfb_crt2type
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_if
c_cond
(paren
id|queuemode
)paren
id|sisfb_search_queuemode
c_func
(paren
id|queuemode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pdc
op_amp
op_complement
l_int|0x3c
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|pdc
op_amp
l_int|0x3c
suffix:semicolon
)brace
)brace
id|sisfb_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* TW: Release mem regions */
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
multiline_comment|/* TW: Release MTRR region */
r_if
c_cond
(paren
id|ivideo.mtrr
)paren
id|mtrr_del
c_func
(paren
id|ivideo.mtrr
comma
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
)paren
suffix:semicolon
multiline_comment|/* Unregister the framebuffer */
id|unregister_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Module unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|sis_malloc
id|EXPORT_SYMBOL
c_func
(paren
id|sis_malloc
)paren
suffix:semicolon
DECL|variable|sis_free
id|EXPORT_SYMBOL
c_func
(paren
id|sis_free
)paren
suffix:semicolon
DECL|variable|sis_dispinfo
id|EXPORT_SYMBOL
c_func
(paren
id|sis_dispinfo
)paren
suffix:semicolon
DECL|variable|ivideo
id|EXPORT_SYMBOL
c_func
(paren
id|ivideo
)paren
suffix:semicolon
eof
