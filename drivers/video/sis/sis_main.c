multiline_comment|/*&n; * SiS 300/630/730/540/315/550/650/651/M650/661FX/M661FX/740/741/M741/330/760&n; * frame buffer driver for Linux kernels 2.4.x and 2.5.x&n; *&n; * Copyright (C) 2001-2004 Thomas Winischhofer, Vienna, Austria.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the named License,&n; * or any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA&n; *&n; * Author:   &t;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&n; *&n; * Author of code base:&n; *&t;&t;SiS (www.sis.com.tw)&n; *&t; &t;Copyright (C) 1999 Silicon Integrated Systems, Inc.&n; *&n; * See http://www.winischhofer.net/ for more information and updates&n; *&n; * Originally based on the VBE 2.0 compliant graphic boards framebuffer driver,&n; * which is (c) 1998 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#endif
macro_line|#include &quot;osdef.h&quot;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#include &lt;video/sisfb.h&gt;
macro_line|#else
macro_line|#include &lt;linux/sisfb.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#endif
macro_line|#include &quot;vgatypes.h&quot;
macro_line|#include &quot;sis_main.h&quot;
macro_line|#include &quot;sis.h&quot;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)
macro_line|#error &quot;This version of sisfb requires at least 2.6.0&quot;
macro_line|#else
macro_line|#if 0
mdefine_line|#define NEWFBDEV&t;&t;/* Define this as soon as new fvdev code has been merged */
macro_line|#endif
macro_line|#endif
macro_line|#endif
multiline_comment|/* -------------------- Macro definitions ---------------------------- */
DECL|macro|SISFBDEBUG
macro_line|#undef SISFBDEBUG &t;/* TW: no debugging */
macro_line|#ifdef SISFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#ifdef SISFBACCEL
macro_line|#ifdef FBCON_HAS_CFB8
r_extern
r_struct
id|display_switch
id|fbcon_sis8
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_extern
r_struct
id|display_switch
id|fbcon_sis16
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_extern
r_struct
id|display_switch
id|fbcon_sis32
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#endif
multiline_comment|/* --------------- Hardware Access Routines -------------------------- */
DECL|function|sisfb_set_reg4
r_void
id|sisfb_set_reg4
c_func
(paren
id|u16
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|outl
c_func
(paren
(paren
id|u32
)paren
(paren
id|data
op_amp
l_int|0xffffffff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg3
id|u32
id|sisfb_get_reg3
c_func
(paren
id|u16
id|port
)paren
(brace
id|u32
id|data
suffix:semicolon
id|data
op_assign
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------ Interface for init &amp; mode switching code ------------- */
id|BOOLEAN
DECL|function|sisfb_query_VGA_config_space
id|sisfb_query_VGA_config_space
c_func
(paren
id|PSIS_HW_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Get VGA offset 0x%lx&bslash;n&quot;
comma
id|offset
)paren
suffix:semicolon
r_else
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Set offset 0x%lx to 0x%lx&bslash;n&quot;
comma
id|offset
comma
op_star
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,74)
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
macro_line|#else
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
)paren
(brace
macro_line|#endif
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|ivideo.chip_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d VGA device.&bslash;n&quot;
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_query_north_bridge_space
id|BOOLEAN
id|sisfb_query_north_bridge_space
c_func
(paren
id|PSIS_HW_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
id|u16
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|SIS_550
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_550
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_650
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_650
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_740
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_740
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_661
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_660
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_741
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_741
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_660
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_660
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_760
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_760
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,74)
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
macro_line|#else
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
)paren
(brace
macro_line|#endif
id|DPRINTK
c_func
(paren
l_string|&quot;Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d North Bridge device.&bslash;n&quot;
comma
id|nbridge_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* ------------------ Internal helper routines ----------------- */
DECL|function|sisfb_verify_rate
r_static
id|BOOLEAN
id|sisfb_verify_rate
c_func
(paren
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
r_int
id|mode_idx
comma
r_int
id|rate_idx
comma
r_int
id|rate
)paren
(brace
r_int
id|htotal
comma
id|vtotal
suffix:semicolon
r_int
r_int
id|dclock
comma
id|hsync
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|monitor-&gt;datavalid
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode_idx
OL
l_int|0
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rate
OL
(paren
id|monitor-&gt;vmin
op_minus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rate
OG
(paren
id|monitor-&gt;vmax
op_plus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_gettotalfrommode
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|mode_no
comma
op_amp
id|htotal
comma
op_amp
id|vtotal
comma
id|rate_idx
)paren
)paren
(brace
id|dclock
op_assign
(paren
id|htotal
op_star
id|vtotal
op_star
id|rate
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|dclock
OG
(paren
id|monitor-&gt;dclockmax
op_plus
l_int|1000
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|hsync
op_assign
id|dclock
op_div
id|htotal
suffix:semicolon
r_if
c_cond
(paren
id|hsync
OL
(paren
id|monitor-&gt;hmin
op_minus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hsync
OG
(paren
id|monitor-&gt;hmax
op_plus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
suffix:semicolon
DECL|function|sisfb_interpret_edid
r_static
id|BOOLEAN
id|sisfb_interpret_edid
c_func
(paren
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
id|u8
op_star
id|buffer
)paren
(brace
r_int
id|i
comma
id|j
comma
id|xres
comma
id|yres
comma
id|refresh
comma
id|index
suffix:semicolon
id|u32
id|emodes
suffix:semicolon
r_if
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
op_ne
l_int|0x00
op_logical_or
id|buffer
(braket
l_int|1
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|2
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|3
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|4
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|5
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|6
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|7
)braket
op_ne
l_int|0x00
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Bad EDID header&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0x12
)braket
op_ne
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: EDID version %d not supported&bslash;n&quot;
comma
id|buffer
(braket
l_int|0x12
)braket
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|monitor-&gt;feature
op_assign
id|buffer
(braket
l_int|0x18
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
(braket
l_int|0x14
)braket
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buffer
(braket
l_int|0x14
)braket
op_amp
l_int|0x08
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Monitor does not support separate syncs&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0x13
)braket
op_ge
l_int|0x01
)paren
(brace
multiline_comment|/* EDID V1 rev 1 and 2: Search for monitor descriptor&n;&t;    * to extract ranges&n;&t;    */
id|j
op_assign
l_int|0x36
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|buffer
(braket
id|j
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|1
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|2
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|3
)braket
op_eq
l_int|0xfd
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|4
)braket
op_eq
l_int|0x00
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|buffer
(braket
id|j
op_plus
l_int|7
)braket
suffix:semicolon
id|monitor-&gt;hmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|8
)braket
suffix:semicolon
id|monitor-&gt;vmin
op_assign
id|buffer
(braket
id|j
op_plus
l_int|5
)braket
suffix:semicolon
id|monitor-&gt;vmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|6
)braket
suffix:semicolon
id|monitor-&gt;dclockmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|9
)braket
op_star
l_int|10
op_star
l_int|1000
suffix:semicolon
id|monitor-&gt;datavalid
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|j
op_add_assign
l_int|18
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|monitor-&gt;datavalid
)paren
(brace
multiline_comment|/* Otherwise: Get a range from the list of supported&n;&t;    * Estabished Timings. This is not entirely accurate,&n;&t;    * because fixed frequency monitors are not supported&n;&t;    * that way.&n;&t;    */
id|monitor-&gt;hmin
op_assign
l_int|65535
suffix:semicolon
id|monitor-&gt;hmax
op_assign
l_int|0
suffix:semicolon
id|monitor-&gt;vmin
op_assign
l_int|65535
suffix:semicolon
id|monitor-&gt;vmax
op_assign
l_int|0
suffix:semicolon
id|monitor-&gt;dclockmax
op_assign
l_int|0
suffix:semicolon
id|emodes
op_assign
id|buffer
(braket
l_int|0x23
)braket
op_or
(paren
id|buffer
(braket
l_int|0x24
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|buffer
(braket
l_int|0x25
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|13
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|emodes
op_amp
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|mask
)paren
(brace
r_if
c_cond
(paren
id|monitor-&gt;hmin
OG
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;hmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmin
OG
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmin
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;dclockmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
)paren
(brace
id|monitor-&gt;dclockmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
suffix:semicolon
)brace
)brace
)brace
id|index
op_assign
l_int|0x26
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|xres
op_assign
(paren
id|buffer
(braket
id|index
)braket
op_plus
l_int|31
)paren
op_star
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|buffer
(braket
id|index
op_plus
l_int|1
)braket
op_amp
l_int|0xc0
)paren
(brace
r_case
l_int|0xc0
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|9
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x80
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|4
)paren
op_div
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x40
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|3
)paren
op_div
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|yres
op_assign
id|xres
suffix:semicolon
r_break
suffix:semicolon
)brace
id|refresh
op_assign
(paren
id|buffer
(braket
id|index
op_plus
l_int|1
)braket
op_amp
l_int|0x3f
)paren
op_plus
l_int|60
suffix:semicolon
r_if
c_cond
(paren
(paren
id|xres
op_ge
l_int|640
)paren
op_logical_and
(paren
id|yres
op_ge
l_int|480
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|xres
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|x
)paren
op_logical_and
(paren
id|yres
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|y
)paren
op_logical_and
(paren
id|refresh
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|v
)paren
)paren
(brace
r_if
c_cond
(paren
id|monitor-&gt;hmin
OG
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;hmax
OL
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmax
op_assign
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmin
OG
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmin
op_assign
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmax
OL
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmax
op_assign
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;dclockmax
OL
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|d
)paren
(brace
id|monitor-&gt;dclockmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
suffix:semicolon
)brace
)brace
)brace
)brace
id|index
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|monitor-&gt;hmin
op_le
id|monitor-&gt;hmax
)paren
op_logical_and
(paren
id|monitor-&gt;vmin
op_le
id|monitor-&gt;vmax
)paren
)paren
(brace
id|monitor-&gt;datavalid
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|monitor-&gt;datavalid
suffix:semicolon
)brace
DECL|function|sisfb_handle_ddc
r_static
r_void
id|sisfb_handle_ddc
c_func
(paren
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
r_int
id|crtno
)paren
(brace
id|USHORT
id|temp
comma
id|i
comma
id|realcrtno
op_assign
id|crtno
suffix:semicolon
id|u8
id|buffer
(braket
l_int|256
)braket
suffix:semicolon
id|monitor-&gt;datavalid
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|crtno
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|realcrtno
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|realcrtno
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sisfb_crt1off
)paren
op_logical_and
(paren
op_logical_neg
id|crtno
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|SiS_Pr
comma
id|ivideo.vbflags
comma
id|sisvga_engine
comma
id|realcrtno
comma
l_int|0
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|temp
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC probing failed&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC supported&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC level: %s%s%s%s&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
comma
(paren
id|temp
op_amp
l_int|0x1a
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;[none of the supported]&quot;
comma
(paren
id|temp
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot;2 &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|temp
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot;D&amp;P&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|temp
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot;FPDI-2&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x02
)paren
(brace
id|i
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Number of retrys */
r_do
(brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|SiS_Pr
comma
id|ivideo.vbflags
comma
id|sisvga_engine
comma
id|realcrtno
comma
l_int|1
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|temp
)paren
op_logical_and
id|i
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
(brace
r_if
c_cond
(paren
id|sisfb_interpret_edid
c_func
(paren
id|monitor
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Monitor range H %d-%dKHz, V %d-%dHz, Max. dotclock %dMHz&bslash;n&quot;
comma
id|monitor-&gt;hmin
comma
id|monitor-&gt;hmax
comma
id|monitor-&gt;vmin
comma
id|monitor-&gt;vmax
comma
id|monitor-&gt;dclockmax
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC EDID corrupt&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC reading failed&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: VESA D&amp;P and FPDI-2 not supported yet&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|sisfb_search_vesamode
r_static
r_void
id|sisfb_search_vesamode
c_func
(paren
r_int
r_int
id|vesamode
comma
id|BOOLEAN
id|quiet
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vesamode
op_eq
l_int|0
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode &squot;none&squot; not supported anymore. Using default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|vesamode
op_and_assign
l_int|0x1dff
suffix:semicolon
multiline_comment|/* Clean VESA mode number from other flags */
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
op_increment
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|vesa_mode_no_1
op_eq
id|vesamode
)paren
op_logical_or
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|vesa_mode_no_2
op_eq
id|vesamode
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x53
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x5b
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
id|sisfb_mode_idx
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|j
)paren
op_logical_and
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid VESA mode 0x%x&squot;&bslash;n&quot;
comma
id|vesamode
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_mode
r_static
r_void
id|sisfb_search_mode
c_func
(paren
r_char
op_star
id|name
comma
id|BOOLEAN
id|quiet
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|j
op_assign
l_int|0
comma
id|xres
op_assign
l_int|0
comma
id|yres
op_assign
l_int|0
comma
id|depth
op_assign
l_int|0
comma
id|rate
op_assign
l_int|0
suffix:semicolon
r_char
id|strbuf
(braket
l_int|16
)braket
comma
id|strbuf1
(braket
l_int|20
)braket
suffix:semicolon
r_char
op_star
id|nameptr
op_assign
id|name
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Internal error, using default mode.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sisbios_mode
(braket
id|MODE_INDEX_NONE
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|name
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode &squot;none&squot; not supported anymore. Using default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|name
)paren
op_le
l_int|19
)paren
(brace
id|strcpy
c_func
(paren
id|strbuf1
comma
id|name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|strbuf1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strbuf1
(braket
id|i
)braket
template_param
l_char|&squot;9&squot;
)paren
(brace
id|strbuf1
(braket
id|i
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
)brace
)brace
multiline_comment|/* This does some fuzzy mode naming detection */
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u %u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
comma
op_amp
id|depth
comma
op_amp
id|rate
)paren
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
(paren
id|rate
op_le
l_int|32
)paren
op_logical_or
(paren
id|depth
OG
l_int|32
)paren
)paren
(brace
id|j
op_assign
id|rate
suffix:semicolon
id|rate
op_assign
id|depth
suffix:semicolon
id|depth
op_assign
id|j
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux%u&quot;
comma
id|xres
comma
id|yres
comma
id|depth
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_parm_rate
op_assign
id|rate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
comma
op_amp
id|depth
)paren
op_eq
l_int|3
)paren
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux%u&quot;
comma
id|xres
comma
id|yres
comma
id|depth
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
)brace
r_else
(brace
id|xres
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
)paren
op_eq
l_int|2
)paren
op_logical_and
(paren
id|xres
op_ne
l_int|0
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux8&quot;
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
)brace
r_else
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|name
comma
l_int|NULL
comma
l_int|0
)paren
comma
id|quiet
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
id|i
op_assign
l_int|0
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|nameptr
comma
id|sisbios_mode
(braket
id|i
op_increment
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|nameptr
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x53
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
op_eq
l_int|0x5b
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
id|sisfb_mode_idx
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|j
)paren
op_logical_and
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid mode &squot;%s&squot;&bslash;n&quot;
comma
id|nameptr
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_validate_mode
r_static
r_int
id|sisfb_validate_mode
c_func
(paren
r_int
id|myindex
comma
r_int
r_int
id|vbflags
)paren
(brace
id|u16
id|xres
comma
id|yres
comma
id|myres
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS300
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS315
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
id|myres
op_assign
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
suffix:semicolon
r_switch
c_cond
(paren
id|vbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_LCD
suffix:colon
r_switch
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
)paren
(brace
r_case
id|LCD_640x480
suffix:colon
id|xres
op_assign
l_int|640
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_800x600
suffix:colon
id|xres
op_assign
l_int|800
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1024x600
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1024x768
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1152x768
suffix:colon
id|xres
op_assign
l_int|1152
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x960
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|960
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x768
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x1024
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1400x1050
suffix:colon
id|xres
op_assign
l_int|1400
suffix:semicolon
id|yres
op_assign
l_int|1050
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1600x1200
suffix:colon
id|xres
op_assign
l_int|1600
suffix:semicolon
id|yres
op_assign
l_int|1200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_320x480
suffix:colon
id|xres
op_assign
l_int|320
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* FSTN (old) */
r_case
id|LCD_640x480_2
suffix:colon
r_case
id|LCD_640x480_3
suffix:colon
id|xres
op_assign
l_int|640
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* FSTN (new) */
r_default
suffix:colon
id|xres
op_assign
l_int|0
suffix:semicolon
id|yres
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SiS_Pr.SiS_CustomT
op_eq
id|CUT_BARCO1366
)paren
(brace
id|xres
op_assign
l_int|1360
suffix:semicolon
id|yres
op_assign
l_int|1024
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SiS_Pr.SiS_CustomT
op_eq
id|CUT_PANEL848
)paren
(brace
id|xres
op_assign
l_int|848
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
OG
id|xres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|myres
OG
id|yres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_30xBDH
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
op_eq
l_int|320
)paren
(brace
r_if
c_cond
(paren
(paren
id|myres
op_eq
l_int|240
)paren
op_logical_or
(paren
id|myres
op_eq
l_int|480
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
op_eq
l_int|0x5b
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
op_eq
l_int|0x53
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|SiS_GetModeID_LCD
c_func
(paren
id|sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
comma
id|sisfb_fstn
comma
id|SiS_Pr.SiS_CustomT
comma
id|xres
comma
id|yres
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CRT2_TV
suffix:colon
r_if
c_cond
(paren
id|SiS_GetModeID_TV
c_func
(paren
id|sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CRT2_VGA
suffix:colon
r_if
c_cond
(paren
id|SiS_GetModeID_VGA2
c_func
(paren
id|sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|myindex
suffix:semicolon
)brace
DECL|function|sisfb_search_crt2type
r_static
r_void
id|sisfb_search_crt2type
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|sisfb_crt2type
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
id|sisfb_tvplug
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|tvplug_no
suffix:semicolon
id|sisfb_dstn
op_assign
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|flags
op_amp
id|FL_550_DSTN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|sisfb_fstn
op_assign
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|flags
op_amp
id|FL_550_FSTN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid CRT2 type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.chip
op_ne
id|SIS_550
)paren
(brace
id|sisfb_dstn
op_assign
id|sisfb_fstn
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_queuemode
r_static
r_void
id|sisfb_search_queuemode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sis_queuemode
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|sis_queuemode
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|sisfb_queuemode
op_assign
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_queuemode
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid queuemode type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_search_refresh_rate
r_static
id|u8
id|sisfb_search_refresh_rate
c_func
(paren
r_int
r_int
id|rate
comma
r_int
id|mode_idx
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|xres
op_assign
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|xres
suffix:semicolon
id|yres
op_assign
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_rate_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_le
id|xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_eq
id|xres
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|yres
op_eq
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_eq
id|rate
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
OG
id|rate
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_minus
id|rate
)paren
op_le
l_int|3
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d up to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_rate_idx
OG
l_int|0
)paren
(brace
r_return
id|sisfb_rate_idx
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unsupported rate %d for %dx%d&bslash;n&quot;
comma
id|rate
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_tvstd
r_static
r_void
id|sisfb_search_tvstd
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sis_tvtype
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|sis_tvtype
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_specialtiming
r_static
r_void
id|sisfb_search_specialtiming
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|BOOLEAN
id|found
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
l_string|&quot;none&quot;
comma
l_int|4
)paren
)paren
(brace
id|SiS_Pr.SiS_CustomT
op_assign
id|CUT_FORCENONE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Special timing disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
)paren
)paren
(brace
id|SiS_Pr.SiS_CustomT
op_assign
id|mycustomttable
(braket
id|i
)braket
dot
id|SpecialID
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Special timing for %s %s forced (&bslash;&quot;%s&bslash;&quot;)&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sisfb: Invalid SpecialTiming parameter, valid are:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;&bslash;t&bslash;&quot;none&bslash;&quot; (to disable special timings)&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;&bslash;t&bslash;&quot;%s&bslash;&quot; (for %s %s)&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|sisfb_bridgeisslave
r_static
id|BOOLEAN
id|sisfb_bridgeisslave
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|P1_00
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
id|P1_00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|P1_00
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
op_logical_or
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
id|P1_00
op_amp
l_int|0x50
)paren
op_eq
l_int|0x10
)paren
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
DECL|function|sisfballowretracecrt1
r_static
id|BOOLEAN
id|sisfballowretracecrt1
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|temp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp
op_amp
l_int|0x80
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0xc0
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfbcheckvretracecrt1
r_static
id|BOOLEAN
id|sisfbcheckvretracecrt1
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfballowretracecrt1
c_func
(paren
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|sisfbwaitretracecrt1
r_static
r_void
id|sisfbwaitretracecrt1
c_func
(paren
r_void
)paren
(brace
r_int
id|watchdog
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisfballowretracecrt1
c_func
(paren
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|watchdog
op_assign
l_int|65536
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
)paren
op_logical_and
op_decrement
id|watchdog
)paren
(brace
suffix:semicolon
)brace
id|watchdog
op_assign
l_int|65536
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
op_logical_and
op_decrement
id|watchdog
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|sisfbcheckvretracecrt2
r_static
id|BOOLEAN
id|sisfbcheckvretracecrt2
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|temp
comma
id|reg
suffix:semicolon
r_switch
c_cond
(paren
id|sisvga_engine
)paren
(brace
r_case
id|SIS_300_VGA
suffix:colon
id|reg
op_assign
l_int|0x25
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_315_VGA
suffix:colon
id|reg
op_assign
l_int|0x30
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
id|reg
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x02
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_else
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_CheckVBRetrace
r_static
id|BOOLEAN
id|sisfb_CheckVBRetrace
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_bridgeisslave
c_func
(paren
)paren
)paren
(brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|sisfbcheckvretracecrt2
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|sisfb_myblank
r_static
r_int
id|sisfb_myblank
c_func
(paren
r_int
id|blank
)paren
(brace
id|u8
id|sr01
comma
id|sr11
comma
id|sr1f
comma
id|cr63
op_assign
l_int|0
comma
id|p2_0
comma
id|p1_13
suffix:semicolon
id|BOOLEAN
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* on */
id|sr01
op_assign
l_int|0x00
suffix:semicolon
id|sr11
op_assign
l_int|0x00
suffix:semicolon
id|sr1f
op_assign
l_int|0x00
suffix:semicolon
id|cr63
op_assign
l_int|0x00
suffix:semicolon
id|p2_0
op_assign
l_int|0x20
suffix:semicolon
id|p1_13
op_assign
l_int|0x00
suffix:semicolon
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* blank */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x00
suffix:semicolon
id|sr1f
op_assign
l_int|0x00
suffix:semicolon
id|cr63
op_assign
l_int|0x00
suffix:semicolon
id|p2_0
op_assign
l_int|0x20
suffix:semicolon
id|p1_13
op_assign
l_int|0x00
suffix:semicolon
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* no vsync */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0x80
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0x40
suffix:semicolon
id|p1_13
op_assign
l_int|0x80
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* no hsync */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0x40
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0x80
suffix:semicolon
id|p1_13
op_assign
l_int|0x40
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* off */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0xc0
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0xc0
suffix:semicolon
id|p1_13
op_assign
l_int|0xc0
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_CRT1
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
op_complement
l_int|0x20
comma
id|sr01
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_thismonitor.datavalid
)paren
op_logical_or
(paren
(paren
id|sisfb_thismonitor.datavalid
)paren
op_logical_and
(paren
id|sisfb_thismonitor.feature
op_amp
l_int|0xe0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|SiS_Pr.SiS_MyCR63
comma
l_int|0xbf
comma
id|cr63
)paren
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
l_int|0x3f
comma
id|sr1f
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|CRT2_LCD
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_if
c_cond
(paren
id|backlight
)paren
(brace
id|SiS_SiS30xBLOn
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SiS30xBLOff
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
r_if
c_cond
(paren
id|backlight
)paren
(brace
id|SiS_Chrontel701xBLOn
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_Chrontel701xBLOff
c_func
(paren
op_amp
id|SiS_Pr
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_30xBDH
op_or
id|VB_LVDS
)paren
)paren
)paren
op_logical_or
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
)paren
op_eq
id|VB_LVDS
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
op_complement
l_int|0x0c
comma
id|sr11
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
id|VB_30xBDH
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
l_int|0x3f
comma
id|p1_13
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
id|VB_30xBDH
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1f
comma
id|p2_0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|CRT2_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1f
comma
id|p2_0
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------- FBDev related routines for all series ----------- */
DECL|function|sisfb_set_vparms
r_static
r_void
id|sisfb_set_vparms
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Unsupported depth %d&quot;
comma
id|ivideo.video_bpp
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|sisfb_do_set_var
r_static
r_int
id|sisfb_do_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
l_int|0
comma
id|vtotal
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|old_mode
suffix:semicolon
id|u32
id|pixclock
suffix:semicolon
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Invalid &squot;var&squot; information&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pixclock
op_logical_and
id|htotal
op_logical_and
id|vtotal
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|ivideo.refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Change mode to %dx%dx%d-%dHz&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
macro_line|#endif
id|old_mode
op_assign
id|sisfb_mode_idx
suffix:semicolon
id|sisfb_mode_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_mode_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|sisfb_mode_idx
comma
id|ivideo.currentvbflags
)paren
suffix:semicolon
)brace
r_else
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode %dx%dx%d not supported&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|old_mode
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
comma
id|sisfb_mode_idx
)paren
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
op_amp
id|sisfb_thismonitor
comma
id|sisfb_mode_idx
comma
id|sisfb_rate_idx
comma
id|ivideo.refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
op_logical_and
id|isactive
)paren
(brace
macro_line|#else
r_if
c_cond
(paren
id|isactive
)paren
(brace
macro_line|#endif
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_accel
)paren
(brace
id|ivideo.accel
op_assign
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
id|sisfb_set_vparms
c_func
(paren
)paren
suffix:semicolon
id|ivideo.current_width
op_assign
id|ivideo.video_width
suffix:semicolon
id|ivideo.current_height
op_assign
id|ivideo.video_height
suffix:semicolon
id|ivideo.current_bpp
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|ivideo.current_htotal
op_assign
id|htotal
suffix:semicolon
id|ivideo.current_vtotal
op_assign
id|vtotal
suffix:semicolon
id|ivideo.current_pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
id|ivideo.current_refresh_rate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|sisfb_lastrates
(braket
id|sisfb_mode_no
)braket
op_assign
id|ivideo.refresh_rate
suffix:semicolon
macro_line|#endif
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_pan_var
r_static
r_int
id|sisfb_pan_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
r_int
id|base
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
op_plus
id|var-&gt;xoffset
suffix:semicolon
multiline_comment|/* calculate base bpp dep. */
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
id|base
op_rshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_default
suffix:colon
id|base
op_rshift_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0D
comma
id|base
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0C
comma
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0D
comma
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x37
comma
l_int|0xFE
comma
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|sisfb_CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x06
comma
(paren
id|base
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x05
comma
(paren
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x04
comma
(paren
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
l_int|0x7F
comma
(paren
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_bpp_to_var
r_static
r_void
id|sisfb_bpp_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|6
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|sis_dispinfo
r_void
id|sis_dispinfo
c_func
(paren
r_struct
id|ap_data
op_star
id|rec
)paren
(brace
id|rec-&gt;minfo.bpp
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|rec-&gt;minfo.xres
op_assign
id|ivideo.video_width
suffix:semicolon
id|rec-&gt;minfo.yres
op_assign
id|ivideo.video_height
suffix:semicolon
id|rec-&gt;minfo.v_xres
op_assign
id|ivideo.video_vwidth
suffix:semicolon
id|rec-&gt;minfo.v_yres
op_assign
id|ivideo.video_vheight
suffix:semicolon
id|rec-&gt;minfo.org_x
op_assign
id|ivideo.org_x
suffix:semicolon
id|rec-&gt;minfo.org_y
op_assign
id|ivideo.org_y
suffix:semicolon
id|rec-&gt;minfo.vrate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
id|rec-&gt;iobase
op_assign
id|ivideo.vga_base
op_minus
l_int|0x30
suffix:semicolon
id|rec-&gt;mem_size
op_assign
id|ivideo.video_size
suffix:semicolon
id|rec-&gt;disp_state
op_assign
id|ivideo.disp_state
suffix:semicolon
id|rec-&gt;version
op_assign
(paren
id|VER_MAJOR
op_lshift
l_int|24
)paren
op_or
(paren
id|VER_MINOR
op_lshift
l_int|16
)paren
op_or
id|VER_LEVEL
suffix:semicolon
id|rec-&gt;hasVB
op_assign
id|ivideo.hasVB
suffix:semicolon
id|rec-&gt;TV_type
op_assign
id|ivideo.TV_type
suffix:semicolon
id|rec-&gt;TV_plug
op_assign
id|ivideo.TV_plug
suffix:semicolon
id|rec-&gt;chip
op_assign
id|ivideo.chip
suffix:semicolon
id|rec-&gt;vbflags
op_assign
id|ivideo.vbflags
suffix:semicolon
id|rec-&gt;currentvbflags
op_assign
id|ivideo.currentvbflags
suffix:semicolon
)brace
multiline_comment|/* ------------ FBDev related routines for 2.4 series ----------- */
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
DECL|function|sisfb_crtc_to_var
r_static
r_void
id|sisfb_crtc_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u16
id|VRE
comma
id|VBE
comma
id|VRS
comma
id|VBS
comma
id|VDE
comma
id|VT
suffix:semicolon
id|u16
id|HRE
comma
id|HBE
comma
id|HRS
comma
id|HBS
comma
id|HDE
comma
id|HT
suffix:semicolon
id|u8
id|sr_data
comma
id|cr_data
comma
id|cr_data2
comma
id|cr_data3
comma
id|mr_data
suffix:semicolon
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|F
comma
id|temp
suffix:semicolon
r_int
r_int
id|hrate
comma
id|drate
comma
id|maxyres
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_COLOR_MODE
comma
id|sr_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr_data
op_amp
id|SIS_INTERLACED_MODE
)paren
(brace
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
)brace
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|sr_data
op_amp
l_int|0x1C
)paren
op_rshift
l_int|2
)paren
(brace
r_case
id|SIS_8BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_16BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_32BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_bpp_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0A
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x06
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x07
comma
id|cr_data2
)paren
suffix:semicolon
id|VT
op_assign
(paren
id|cr_data
op_amp
l_int|0xFF
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x01
)paren
op_lshift
l_int|10
)paren
suffix:semicolon
id|A
op_assign
id|VT
op_plus
l_int|2
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x12
comma
id|cr_data
)paren
suffix:semicolon
id|VDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x40
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x02
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|E
op_assign
id|VDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x10
comma
id|cr_data
)paren
suffix:semicolon
id|VRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x04
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x08
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|F
op_assign
id|VRS
op_plus
l_int|1
op_minus
id|E
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x15
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x09
comma
id|cr_data3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr_data3
op_amp
l_int|0x80
)paren
(brace
id|var-&gt;vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
)brace
id|VBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x08
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data3
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x16
comma
id|cr_data
)paren
suffix:semicolon
id|VBE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_assign
id|VBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|511
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|512
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x11
comma
id|cr_data
)paren
suffix:semicolon
id|VRE
op_assign
(paren
id|cr_data
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x20
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|VRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_minus
l_int|1
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|32
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;yres
op_assign
id|E
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|D
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|F
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|C
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|var-&gt;yres
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;upper_margin
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;lower_margin
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;vsync_len
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;yres
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;upper_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;lower_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;vsync_len
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0b
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x00
comma
id|cr_data
)paren
suffix:semicolon
id|HT
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|A
op_assign
id|HT
op_plus
l_int|5
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x01
comma
id|cr_data
)paren
suffix:semicolon
id|HDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x0C
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|E
op_assign
id|HDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x04
comma
id|cr_data
)paren
suffix:semicolon
id|HRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0xC0
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|F
op_assign
id|HRS
op_minus
id|E
op_minus
l_int|3
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x02
comma
id|cr_data
)paren
suffix:semicolon
id|HBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0c
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x03
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x05
comma
id|cr_data2
)paren
suffix:semicolon
id|HBE
op_assign
(paren
id|cr_data
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|HRE
op_assign
(paren
id|cr_data2
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|temp
op_assign
id|HBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|256
)paren
suffix:semicolon
id|temp
op_assign
id|HRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_plus
l_int|3
)paren
op_amp
l_int|63
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|64
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|E
op_star
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_eq
l_int|320
)paren
op_logical_and
(paren
id|var-&gt;yres
op_eq
l_int|200
op_logical_or
id|var-&gt;yres
op_eq
l_int|240
)paren
)paren
(brace
multiline_comment|/* Terrible hack, but the correct CRTC data for&n;&t;  &t; * these modes only produces a black screen...&n;&t;  &t; */
id|var-&gt;left_margin
op_assign
(paren
l_int|400
op_minus
l_int|376
)paren
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
l_int|328
op_minus
l_int|320
)paren
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
l_int|376
op_minus
l_int|328
)paren
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;left_margin
op_assign
id|D
op_star
l_int|8
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|F
op_star
l_int|8
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|C
op_star
l_int|8
suffix:semicolon
)brace
id|var-&gt;activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|mr_data
op_assign
id|inSISREG
c_func
(paren
id|SISMISCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x80
)paren
(brace
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
)brace
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x40
)paren
(brace
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
)brace
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
id|VT
op_add_assign
l_int|2
suffix:semicolon
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
id|HT
op_assign
(paren
id|HT
op_plus
l_int|5
)paren
op_star
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|hrate
op_assign
id|ivideo.refresh_rate
op_star
id|VT
op_div
l_int|2
suffix:semicolon
id|drate
op_assign
(paren
id|hrate
op_star
id|HT
)paren
op_div
l_int|1000
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|drate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|maxyres
op_assign
id|ivideo.heapstart
op_div
(paren
id|var-&gt;xres
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxyres
OG
l_int|32767
)paren
(brace
id|maxyres
op_assign
l_int|32767
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_max
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OG
id|maxyres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
DECL|function|sis_getcolreg
r_static
r_int
id|sis_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo.video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo.video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|sis_fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|sis_fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_disp
r_static
r_void
id|sisfb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_struct
id|display_switch
op_star
id|sw
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
)brace
r_else
id|display
op_assign
op_amp
id|sis_disp
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|con
comma
l_int|0
)paren
suffix:semicolon
id|display-&gt;screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|sisfb_inverse
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis8
suffix:colon
op_amp
id|fbcon_cfb8
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis16
suffix:colon
op_amp
id|fbcon_cfb16
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
macro_line|#endif
id|display-&gt;dispsw_data
op_assign
id|sis_fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis32
suffix:colon
op_amp
id|fbcon_cfb32
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
macro_line|#endif
id|display-&gt;dispsw_data
op_assign
id|sis_fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|sisfb_sw
comma
id|sw
comma
r_sizeof
(paren
op_star
id|sw
)paren
)paren
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|sisfb_sw
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
multiline_comment|/* display-&gt;scrollmode = 0;  */
)brace
r_else
(brace
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
)brace
)brace
DECL|function|sisfb_do_install_cmap
r_static
r_void
id|sisfb_do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|ivideo.video_cmap_len
)paren
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_var
r_static
r_int
id|sisfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|default_var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
)brace
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|320
op_logical_and
id|var-&gt;yres
op_eq
l_int|480
)paren
id|var-&gt;yres
op_assign
l_int|240
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_var
r_static
r_int
id|sisfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
id|cols
comma
id|rows
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_do_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|currcon
comma
id|info
)paren
)paren
(brace
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
id|var
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;changevar
)paren
(brace
(paren
op_star
id|info-&gt;changevar
)paren
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Why was this called here? */
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap
r_static
r_int
id|sisfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|ivideo.video_cmap_len
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_cmap
r_static
r_int
id|sisfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|ivideo.video_cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_pan_display
r_static
r_int
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.xres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.yres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
comma
id|mmio_off
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
macro_line|#endif
multiline_comment|/* By Jake Page: Treat mmap request with offset beyond heapstart&n;&t; *               as request for mapping the mmio area &n;&t; */
id|mmio_off
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|mmio_off
)paren
(brace
id|off
op_sub_assign
id|mmio_off
suffix:semicolon
id|sisfb_get_var
c_func
(paren
op_amp
id|var
comma
id|currcon
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var.accel_flags
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
multiline_comment|/* by Jake Page; is that really needed? */
macro_line|#if defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
multiline_comment|/* RedHat requires vma as the first paramater to the following call */
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sis_get_glyph
r_static
r_void
id|sis_get_glyph
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
id|SIS_GLYINFO
op_star
id|gly
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|currcon
)braket
suffix:semicolon
id|u16
id|c
suffix:semicolon
id|u8
op_star
id|cdat
suffix:semicolon
r_int
id|widthb
suffix:semicolon
id|u8
op_star
id|gbuf
op_assign
id|gly-&gt;gmask
suffix:semicolon
r_int
id|size
suffix:semicolon
id|gly-&gt;fontheight
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|gly-&gt;fontwidth
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|widthb
op_assign
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|c
op_assign
id|gly-&gt;ch
op_amp
id|p-&gt;charmask
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|size
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|widthb
suffix:semicolon
id|memcpy
c_func
(paren
id|gbuf
comma
id|cdat
comma
id|size
)paren
suffix:semicolon
id|gly-&gt;ngmask
op_assign
id|size
suffix:semicolon
)brace
DECL|function|sisfb_update_var
r_static
r_int
id|sisfb_update_var
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
id|sisfb_pan_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
)brace
DECL|function|sisfb_switch
r_static
r_int
id|sisfb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|cols
comma
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap.len
)paren
(brace
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|currcon
op_assign
id|con
suffix:semicolon
id|sisfb_do_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
id|info
)paren
suffix:semicolon
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|sisfb_update_var
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_void
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|sisfb_myblank
c_func
(paren
id|blank
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ------------ FBDev related routines for 2.5 series ----------- */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|function|sisfb_open
r_static
r_int
id|sisfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_release
r_static
r_int
id|sisfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap_len
r_static
r_int
id|sisfb_get_cmap_len
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|rc
op_assign
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|rc
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_case
l_int|32
suffix:colon
id|rc
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|info-&gt;var
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_par
r_static
r_int
id|sisfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_do_set_var
c_func
(paren
op_amp
id|info-&gt;var
comma
l_int|1
comma
id|info
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|sisfb_get_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
id|info-&gt;currcon
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_check_var
r_static
r_int
id|sisfb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
l_int|0
comma
id|vtotal
op_assign
l_int|0
comma
id|myrateindex
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
comma
id|maxyres
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|refresh_rate
comma
id|search_idx
suffix:semicolon
id|BOOLEAN
id|recalc_clock
op_assign
id|FALSE
suffix:semicolon
id|u32
id|pixclock
suffix:semicolon
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|SISFAIL
c_func
(paren
l_string|&quot;sisfb: no valid timing data&quot;
)paren
suffix:semicolon
)brace
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|search_idx
comma
id|ivideo.currentvbflags
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found_mode
)paren
(brace
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
)paren
op_logical_and
(paren
id|var-&gt;yres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
op_eq
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|search_idx
comma
id|ivideo.currentvbflags
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Adapted from %dx%dx%d to %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|var-&gt;xres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Failed to find supported mode near %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|ivideo.vbflags
op_amp
id|VB_LVDS
)paren
op_logical_or
multiline_comment|/* Slave modes on LVDS and 301B-DH */
(paren
(paren
id|ivideo.vbflags
op_amp
id|VB_30xBDH
)paren
op_logical_and
(paren
id|ivideo.currentvbflags
op_amp
id|CRT2_LCD
)paren
)paren
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|8
)paren
)paren
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo.current_htotal
op_eq
id|htotal
)paren
op_logical_and
multiline_comment|/* x=x &amp; y=y &amp; c=c -&gt; assume depth change */
(paren
id|ivideo.current_vtotal
op_eq
id|vtotal
)paren
op_logical_and
(paren
id|ivideo.current_pixclock
op_eq
id|pixclock
)paren
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|ivideo.current_htotal
op_ne
id|htotal
)paren
op_logical_or
multiline_comment|/* x!=x | y!=y &amp; c=c -&gt; invalid pixclock */
(paren
id|ivideo.current_vtotal
op_ne
id|vtotal
)paren
)paren
op_logical_and
(paren
id|ivideo.current_pixclock
op_eq
id|var-&gt;pixclock
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_lastrates
(braket
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
)braket
)paren
(brace
id|refresh_rate
op_assign
id|sisfb_lastrates
(braket
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_parm_rate
op_ne
op_minus
l_int|1
)paren
(brace
id|refresh_rate
op_assign
id|sisfb_parm_rate
suffix:semicolon
)brace
r_else
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pixclock
)paren
op_logical_and
(paren
id|htotal
)paren
op_logical_and
(paren
id|vtotal
)paren
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.current_refresh_rate
)paren
(brace
id|refresh_rate
op_assign
id|ivideo.current_refresh_rate
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
id|myrateindex
op_assign
id|sisfb_search_refresh_rate
c_func
(paren
id|refresh_rate
comma
id|search_idx
)paren
suffix:semicolon
multiline_comment|/* Eventually recalculate timing and clock */
r_if
c_cond
(paren
id|recalc_clock
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|myrateindex
)paren
(brace
id|myrateindex
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|rate_idx
suffix:semicolon
)brace
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|sisfb_mode_rate_to_dclock
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
comma
id|myrateindex
)paren
)paren
suffix:semicolon
id|sisfb_mode_rate_to_ddata
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
comma
id|myrateindex
comma
op_amp
id|var-&gt;left_margin
comma
op_amp
id|var-&gt;right_margin
comma
op_amp
id|var-&gt;upper_margin
comma
op_amp
id|var-&gt;lower_margin
comma
op_amp
id|var-&gt;hsync_len
comma
op_amp
id|var-&gt;vsync_len
comma
op_amp
id|var-&gt;sync
comma
op_amp
id|var-&gt;vmode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;pixclock
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
op_amp
id|sisfb_thismonitor
comma
id|search_idx
comma
id|myrateindex
comma
id|refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Adapt RGB settings */
id|sisfb_bpp_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
multiline_comment|/* Sanity check for offsets */
r_if
c_cond
(paren
id|var-&gt;xoffset
OL
l_int|0
)paren
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
)paren
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Horiz-panning not supported */
r_if
c_cond
(paren
id|var-&gt;xres
op_ne
id|var-&gt;xres_virtual
)paren
(brace
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|maxyres
op_assign
id|ivideo.heapstart
op_div
(paren
id|var-&gt;xres
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxyres
OG
l_int|32767
)paren
(brace
id|maxyres
op_assign
l_int|32767
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_max
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OG
id|maxyres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres
op_ne
id|var-&gt;yres_virtual
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Truncate offsets to maximum if too high */
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
(brace
id|var-&gt;xoffset
op_assign
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
(brace
id|var-&gt;yoffset
op_assign
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set everything else to 0 */
id|var-&gt;red.msb_right
op_assign
id|var-&gt;green.msb_right
op_assign
id|var-&gt;blue.msb_right
op_assign
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_pan_display
r_static
r_int
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|info-&gt;var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|info-&gt;var.xres
OG
id|info-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|info-&gt;var.yres
OG
id|info-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
comma
id|mmio_off
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
macro_line|#endif
multiline_comment|/* By Jake Page: Treat mmap request with offset beyond heapstart&n;&t; *               as request for mapping the mmio area &n;&t; */
id|mmio_off
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|mmio_off
)paren
(brace
id|off
op_sub_assign
id|mmio_off
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.accel_flags
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
multiline_comment|/* by Jake Page; is that really needed? */
macro_line|#if defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_int
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
id|sisfb_myblank
c_func
(paren
id|blank
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ----------- FBDev related routines for all series ---------- */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|function|sisfb_ioctl
r_static
r_int
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
macro_line|#else
r_static
r_int
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
macro_line|#endif
(brace
r_struct
id|sis_memreq
id|sismemreq
suffix:semicolon
r_struct
id|ap_data
id|sisapdata
suffix:semicolon
r_int
r_int
id|sismembase
op_assign
l_int|0
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|SIS_GLYINFO
id|sisglyinfo
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|sismemreq
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|sismemreq
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sis_malloc
c_func
(paren
op_amp
id|sismemreq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sismemreq
comma
r_sizeof
(paren
id|sismemreq
)paren
)paren
)paren
(brace
id|sis_free
c_func
(paren
id|sismemreq.offset
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|sismembase
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sis_free
c_func
(paren
id|sismembase
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_case
id|FBIOGET_GLYPH
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|sisglyinfo
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|sisglyinfo
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sis_get_glyph
c_func
(paren
id|info
comma
op_amp
id|sisglyinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOPUT_MODEINFO
suffix:colon
(brace
r_struct
id|mode_info
id|x
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|x
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|x
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|ivideo.video_bpp
op_assign
id|x.bpp
suffix:semicolon
id|ivideo.video_width
op_assign
id|x.xres
suffix:semicolon
id|ivideo.video_height
op_assign
id|x.yres
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|x.v_xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|x.v_yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|x.org_x
suffix:semicolon
id|ivideo.org_y
op_assign
id|x.org_y
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|x.vrate
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_vwidth
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|sisfb_set_vparms
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
r_case
id|FBIOGET_HWCINFO
suffix:colon
(brace
r_int
r_int
id|myhwcoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_caps
op_amp
id|HW_CURSOR_CAP
)paren
(brace
id|myhwcoffset
op_assign
id|sisfb_hwcursor_vbase
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|myhwcoffset
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOGET_DISPINFO
suffix:colon
id|sis_dispinfo
c_func
(paren
op_amp
id|sisapdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sisapdata
comma
r_sizeof
(paren
id|sisapdata
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SISFB_GET_INFO
suffix:colon
multiline_comment|/* For communication with X driver */
(brace
id|sisfb_info
id|x
suffix:semicolon
id|x.sisfb_id
op_assign
id|SISFB_ID
suffix:semicolon
id|x.sisfb_version
op_assign
id|VER_MAJOR
suffix:semicolon
id|x.sisfb_revision
op_assign
id|VER_MINOR
suffix:semicolon
id|x.sisfb_patchlevel
op_assign
id|VER_LEVEL
suffix:semicolon
id|x.chip_id
op_assign
id|ivideo.chip_id
suffix:semicolon
id|x.memory
op_assign
id|ivideo.video_size
op_div
l_int|1024
suffix:semicolon
id|x.heapstart
op_assign
id|ivideo.heapstart
op_div
l_int|1024
suffix:semicolon
id|x.fbvidmode
op_assign
id|sisfb_mode_no
suffix:semicolon
id|x.sisfb_caps
op_assign
id|sisfb_caps
suffix:semicolon
id|x.sisfb_tqlen
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* yet fixed */
id|x.sisfb_pcibus
op_assign
id|ivideo.pcibus
suffix:semicolon
id|x.sisfb_pcislot
op_assign
id|ivideo.pcislot
suffix:semicolon
id|x.sisfb_pcifunc
op_assign
id|ivideo.pcifunc
suffix:semicolon
id|x.sisfb_lcdpdc
op_assign
id|sisfb_detectedpdc
suffix:semicolon
id|x.sisfb_lcda
op_assign
id|sisfb_detectedlcda
suffix:semicolon
id|x.sisfb_vbflags
op_assign
id|ivideo.vbflags
suffix:semicolon
id|x.sisfb_currentvbflags
op_assign
id|ivideo.currentvbflags
suffix:semicolon
id|x.sisfb_scalelcd
op_assign
id|SiS_Pr.UsePanelScaler
suffix:semicolon
id|x.sisfb_specialtiming
op_assign
id|SiS_Pr.SiS_CustomT
suffix:semicolon
id|x.sisfb_haveemi
op_assign
id|SiS_Pr.HaveEMI
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|x.sisfb_haveemilcd
op_assign
id|SiS_Pr.HaveEMILCD
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|x.sisfb_emi30
op_assign
id|SiS_Pr.EMI_30
suffix:semicolon
id|x.sisfb_emi31
op_assign
id|SiS_Pr.EMI_31
suffix:semicolon
id|x.sisfb_emi32
op_assign
id|SiS_Pr.EMI_32
suffix:semicolon
id|x.sisfb_emi33
op_assign
id|SiS_Pr.EMI_33
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|x
comma
r_sizeof
(paren
id|x
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|SISFB_GET_VBRSTATUS
suffix:colon
(brace
r_if
c_cond
(paren
id|sisfb_CheckVBRetrace
c_func
(paren
)paren
)paren
(brace
r_return
id|put_user
c_func
(paren
l_int|1UL
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
r_return
id|put_user
c_func
(paren
l_int|0UL
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SISFB_GET_AUTOMAXIMIZE
suffix:colon
(brace
r_if
c_cond
(paren
id|sisfb_max
)paren
(brace
r_return
id|put_user
c_func
(paren
l_int|1UL
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
r_return
id|put_user
c_func
(paren
l_int|0UL
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SISFB_SET_AUTOMAXIMIZE
suffix:colon
(brace
r_int
r_int
id|newmax
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|newmax
comma
(paren
r_int
r_int
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|newmax
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|newmax
)paren
(brace
id|sisfb_max
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|sisfb_max
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_fix
r_static
r_int
id|sisfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|sis_fb_info-&gt;modename
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|myid
)paren
suffix:semicolon
macro_line|#endif&t;
id|fix-&gt;smem_start
op_assign
id|ivideo.video_base
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|fix-&gt;smem_len
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
(brace
id|fix-&gt;smem_len
op_assign
l_int|0x800000
suffix:semicolon
)brace
r_else
id|fix-&gt;smem_len
op_assign
l_int|0x400000
suffix:semicolon
)brace
r_else
(brace
id|fix-&gt;smem_len
op_assign
id|ivideo.video_size
op_minus
l_int|0x100000
suffix:semicolon
)brace
)brace
r_else
id|fix-&gt;smem_len
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
(brace
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
)brace
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
)brace
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|ivideo.video_linelength
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|ivideo.mmio_base
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|sisfb_mmio_size
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo.chip
op_eq
id|SIS_330
)paren
op_logical_or
(paren
id|ivideo.chip
op_eq
id|SIS_760
)paren
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_XABRE
suffix:semicolon
)brace
r_else
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR_2
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|fix-&gt;reserved
(braket
l_int|0
)braket
op_assign
id|ivideo.video_size
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|1
)braket
op_assign
(paren
id|ivideo.video_size
op_rshift
l_int|16
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|2
)braket
op_assign
id|sisfb_caps
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------  fb_ops structures ----------------- */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_get_fix
op_assign
id|sisfb_get_fix
comma
dot
id|fb_get_var
op_assign
id|sisfb_get_var
comma
dot
id|fb_set_var
op_assign
id|sisfb_set_var
comma
dot
id|fb_get_cmap
op_assign
id|sisfb_get_cmap
comma
dot
id|fb_set_cmap
op_assign
id|sisfb_set_cmap
comma
dot
id|fb_pan_display
op_assign
id|sisfb_pan_display
comma
dot
id|fb_ioctl
op_assign
id|sisfb_ioctl
comma
dot
id|fb_mmap
op_assign
id|sisfb_mmap
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|sisfb_open
comma
dot
id|fb_release
op_assign
id|sisfb_release
comma
dot
id|fb_check_var
op_assign
id|sisfb_check_var
comma
dot
id|fb_set_par
op_assign
id|sisfb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|sisfb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|sisfb_pan_display
comma
dot
id|fb_blank
op_assign
id|sisfb_blank
comma
dot
id|fb_fillrect
op_assign
id|fbcon_sis_fillrect
comma
dot
id|fb_copyarea
op_assign
id|fbcon_sis_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
dot
id|fb_sync
op_assign
id|fbcon_sis_sync
comma
dot
id|fb_ioctl
op_assign
id|sisfb_ioctl
comma
dot
id|fb_mmap
op_assign
id|sisfb_mmap
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* ---------------- Chip generation dependent routines ---------------- */
macro_line|#ifdef CONFIG_FB_SIS_300 /* for SiS 300/630/540/730 */
DECL|function|sisfb_get_dram_size_300
r_static
r_int
id|sisfb_get_dram_size_300
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
comma
id|reg
suffix:semicolon
id|u16
id|nbridge_id
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nbridge_id
op_eq
l_int|0
)paren
(brace
multiline_comment|/* 300 */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|reg
op_amp
id|SIS_DRAM_SIZE_MASK
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 540, 630, 730 */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,74)
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
macro_line|#else
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
)paren
(brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|reg
op_assign
id|SIS_DATA_BUS_64
op_lshift
l_int|6
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_2MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_2MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif  /* CONFIG_FB_SIS_300 */
macro_line|#ifdef CONFIG_FB_SIS_315    /* for SiS 315/550/650/740/330/661/741/760 */
DECL|function|sisfb_get_dram_size_315
r_static
r_int
id|sisfb_get_dram_size_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
op_logical_or
id|ivideo.chip
op_eq
id|SIS_650
op_logical_or
id|ivideo.chip
op_eq
id|SIS_740
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x3f
suffix:semicolon
id|reg
op_increment
suffix:semicolon
id|reg
op_lshift_assign
l_int|2
suffix:semicolon
id|ivideo.video_size
op_assign
id|reg
op_lshift
l_int|20
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_661
op_logical_or
id|ivideo.chip
op_eq
id|SIS_741
op_logical_or
id|ivideo.chip
op_eq
id|SIS_660
op_logical_or
id|ivideo.chip
op_eq
id|SIS_760
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xf0
suffix:semicolon
id|reg
op_rshift_assign
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
l_int|1
op_lshift
id|reg
)paren
op_lshift
l_int|20
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 315, 330 */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
l_int|1
op_lshift
(paren
(paren
id|reg
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
)paren
op_lshift
l_int|20
suffix:semicolon
id|reg
op_and_assign
id|SIS315_DUAL_CHANNEL_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_330
)paren
(brace
r_if
c_cond
(paren
id|reg
)paren
(brace
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS315_SINGLE_CHANNEL_2_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DUAL_CHANNEL_1_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_ASYM_DDR
suffix:colon
multiline_comment|/* TW: DDR asymetric */
id|ivideo.video_size
op_add_assign
(paren
id|ivideo.video_size
op_div
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif   /* CONFIG_FB_SIS_315 */
multiline_comment|/* -------------- video bridge detection --------------- */
DECL|function|sisfb_detect_VB_connect
r_static
r_void
id|sisfb_detect_VB_connect
c_func
(paren
)paren
(brace
id|u8
id|sr16
comma
id|sr17
comma
id|cr32
comma
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_17
comma
id|sr17
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x0F
)paren
op_logical_and
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
)paren
(brace
multiline_comment|/* Old BIOSes store the detected CRT2 type in SR17&n;&t;&t; &t; * instead of CR32. However, since our detection&n;&t;&t;&t; * routines store their results to CR32, we now copy&n;&t;&t;&t; * the remaining bits (for LCD and VGA) to CR32 for&n;&t;&t;&t; * unified usage.&n;&t;&t;&t; * SR17[0] CRT1    [1] LCD     [2] TV    [3] VGA2&n;&t;&t;&t; *     [4] AVIDEO  [5] SVIDEO&n;&t;&t;&t; */
macro_line|#if 0
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x01
)paren
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
id|SIS_CRT1
)paren
suffix:semicolon
r_else
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
id|SIS_CRT1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x02
)paren
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
id|SIS_VB_LCD
)paren
suffix:semicolon
r_else
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
id|SIS_VB_LCD
)paren
suffix:semicolon
multiline_comment|/* no HiVision and no DVI connector here */
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0xc0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* PAL/NTSC is stored on SR16 on such machines */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
(paren
id|TV_PAL
op_or
id|TV_NTSC
)paren
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_16
comma
id|sr16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr16
op_amp
l_int|0x20
)paren
id|ivideo.vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
r_else
id|ivideo.vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
)brace
)brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR32
comma
id|cr32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
id|ivideo.vbflags
op_and_assign
op_complement
(paren
id|CRT2_TV
op_or
id|CRT2_LCD
op_or
id|CRT2_VGA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
id|ivideo.vbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.vbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.vbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
multiline_comment|/* TW: Detect/set TV plug &amp; type */
r_if
c_cond
(paren
id|sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|sisfb_tvplug
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.vbflags
op_or_assign
id|TV_SCART
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
(paren
id|TV_PAL
op_or
id|TV_NTSC
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_POWER_ON_TRAP
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
id|ivideo.vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
r_else
id|ivideo.vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo.chip
op_le
id|SIS_315PRO
)paren
op_logical_or
(paren
id|ivideo.chip
op_ge
id|SIS_330
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x38
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo.vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo.vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|sisfb_forcecrt1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type
r_static
r_void
id|sisfb_get_VB_type
c_func
(paren
r_void
)paren
(brace
id|u8
id|vb_chipid
suffix:semicolon
id|u8
id|reg
suffix:semicolon
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Detected&quot;
suffix:semicolon
r_char
id|bridgestr
(braket
)braket
op_assign
l_string|&quot;video bridge&quot;
suffix:semicolon
r_char
id|lvdsstr
(braket
)braket
op_assign
l_string|&quot;LVDS transmitter&quot;
suffix:semicolon
r_char
id|chrstr
(braket
)braket
op_assign
l_string|&quot;Chrontel TV encoder&quot;
suffix:semicolon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_UNKNOWN
suffix:semicolon
id|sishw_ext.Is301BDH
op_assign
id|FALSE
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
comma
id|vb_chipid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xb0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_301
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301 %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xc0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_301B
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301B
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x02
)paren
)paren
(brace
id|sishw_ext.Is301BDH
op_assign
id|TRUE
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|VB_30xBDH
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301B-DH %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301B %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xd0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_301C
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301C
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301C %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xe0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_301LV
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_le
l_int|0xe1
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x39
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
l_int|0xff
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_302LV
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo.vbflags
op_or_assign
id|VB_302ELV
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302ELV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302ELV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xd0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_302B
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302B
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x02
)paren
)paren
(brace
id|sishw_ext.Is301BDH
op_assign
id|TRUE
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|VB_30xBDH
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302B-DH %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302B %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xe0
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_301LV
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_le
l_int|0xe1
)paren
(brace
id|ivideo.vbflags
op_or_assign
id|VB_302LV
suffix:semicolon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
)paren
op_logical_and
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR37
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
id|SIS_EXTERNAL_CHIP_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|VB_LVDS
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x01
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s&bslash;n&quot;
comma
id|stdstr
comma
id|lvdsstr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_TRUMPION
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_TRUMPION
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x02
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Trumpion LCD scaler&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_CHRONTEL
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|VB_CHRONTEL
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x04
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s&bslash;n&quot;
comma
id|stdstr
comma
id|chrstr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
id|ivideo.vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x05
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s and %s&bslash;n&quot;
comma
id|stdstr
comma
id|lvdsstr
comma
id|chrstr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_661
)paren
(brace
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS310_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|VB_LVDS
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x01
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s&bslash;n&quot;
comma
id|stdstr
comma
id|lvdsstr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS310_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
id|ivideo.vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0x05
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s and %s&bslash;n&quot;
comma
id|stdstr
comma
id|lvdsstr
comma
id|chrstr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_SISBRIDGE
)paren
(brace
id|SiS_Sense30x
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|SiS_SenseCh
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------ Sensing routines ------------------ */
r_static
id|BOOLEAN
DECL|function|sisfb_test_DDC1
id|sisfb_test_DDC1
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|old
suffix:semicolon
r_int
id|count
op_assign
l_int|48
suffix:semicolon
id|old
op_assign
id|SiS_ReadDDC1Bit
c_func
(paren
op_amp
id|SiS_Pr
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|old
op_ne
id|SiS_ReadDDC1Bit
c_func
(paren
op_amp
id|SiS_Pr
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_return
(paren
id|count
op_eq
op_minus
l_int|1
)paren
ques
c_cond
id|FALSE
suffix:colon
id|TRUE
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_sense_crt1
id|sisfb_sense_crt1
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|SR1F
comma
id|CR63
op_assign
l_int|0
comma
id|CR17
suffix:semicolon
r_int
r_int
id|temp
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|i
suffix:semicolon
id|BOOLEAN
id|mustwait
op_assign
id|FALSE
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
id|SR1F
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
l_int|0x04
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
l_int|0x3F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SR1F
op_amp
l_int|0xc0
)paren
(brace
id|mustwait
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|SiS_Pr.SiS_MyCR63
comma
id|CR63
)paren
suffix:semicolon
id|CR63
op_and_assign
l_int|0x40
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
id|SiS_Pr.SiS_MyCR63
comma
l_int|0xBF
)paren
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|CR17
)paren
suffix:semicolon
id|CR17
op_and_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CR17
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x80
)paren
suffix:semicolon
id|mustwait
op_assign
id|TRUE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mustwait
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sisfbwaitretracecrt1
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|i
op_assign
l_int|3
suffix:semicolon
r_do
(brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|SiS_Pr
comma
id|ivideo.vbflags
comma
id|sisvga_engine
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
op_logical_and
id|i
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_test_DDC1
c_func
(paren
)paren
)paren
(brace
id|temp
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|temp
)paren
op_logical_and
(paren
id|temp
op_ne
l_int|0xffff
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|SiS_Pr.SiS_MyCR63
comma
l_int|0xBF
comma
id|CR63
)paren
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x7F
comma
id|CR17
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
id|SR1F
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine and detect attached devices on SiS30x */
r_static
r_int
DECL|function|SISDoSense
id|SISDoSense
c_func
(paren
r_int
id|tempbl
comma
r_int
id|tempbh
comma
r_int
id|tempcl
comma
r_int
id|tempch
)paren
(brace
r_int
id|temp
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x11
comma
id|tempbl
)paren
suffix:semicolon
id|temp
op_assign
id|tempbh
op_or
id|tempcl
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
l_int|0xe0
comma
id|temp
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x1000
)paren
suffix:semicolon
id|tempch
op_and_assign
l_int|0x7f
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x03
comma
id|temp
)paren
suffix:semicolon
id|temp
op_xor_assign
l_int|0x0e
suffix:semicolon
id|temp
op_and_assign
id|tempch
suffix:semicolon
r_return
(paren
id|temp
op_eq
id|tempch
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SiS_Sense30x
id|SiS_Sense30x
c_func
(paren
r_void
)paren
(brace
id|u8
id|backupP4_0d
comma
id|backupP2_00
suffix:semicolon
id|u8
id|svhs_bl
comma
id|svhs_bh
suffix:semicolon
id|u8
id|svhs_cl
comma
id|svhs_ch
suffix:semicolon
id|u8
id|cvbs_bl
comma
id|cvbs_bh
suffix:semicolon
id|u8
id|cvbs_cl
comma
id|cvbs_ch
suffix:semicolon
id|u8
id|vga2_bl
comma
id|vga2_bh
suffix:semicolon
id|u8
id|vga2_cl
comma
id|vga2_ch
suffix:semicolon
r_int
id|myflag
comma
id|result
comma
id|haveresult
comma
id|i
comma
id|j
suffix:semicolon
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Detected&quot;
suffix:semicolon
r_char
id|tvstr
(braket
)braket
op_assign
l_string|&quot;TV connected to&quot;
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302ELV
)paren
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
(paren
id|backupP4_0d
op_or
l_int|0x04
)paren
)paren
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|backupP2_00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
(paren
id|backupP2_00
op_or
l_int|0x1c
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
op_or
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x01
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x90
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x01
suffix:semicolon
id|svhs_bl
op_assign
l_int|0x6b
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x01
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0x74
suffix:semicolon
)brace
r_else
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0xd1
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x00
suffix:semicolon
id|svhs_bl
op_assign
l_int|0xb9
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x00
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0xb3
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myflag
op_amp
l_int|0x04
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0xfd
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x00
suffix:semicolon
id|svhs_bl
op_assign
l_int|0xdd
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x00
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0xee
suffix:semicolon
)brace
id|vga2_ch
op_assign
l_int|0x0e
suffix:semicolon
id|vga2_cl
op_assign
l_int|0x08
suffix:semicolon
id|svhs_ch
op_assign
l_int|0x04
suffix:semicolon
id|svhs_cl
op_assign
l_int|0x04
suffix:semicolon
id|cvbs_ch
op_assign
l_int|0x08
suffix:semicolon
id|cvbs_cl
op_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x00
suffix:semicolon
id|vga2_ch
op_assign
l_int|0x00
suffix:semicolon
id|vga2_cl
op_assign
l_int|0x00
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3b
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|myflag
op_amp
l_int|0x01
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x00
suffix:semicolon
id|vga2_ch
op_assign
l_int|0x00
suffix:semicolon
id|vga2_cl
op_assign
l_int|0x00
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_302B
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x01
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x90
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x01
suffix:semicolon
id|svhs_bl
op_assign
l_int|0x6b
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x01
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0x74
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302ELV
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x01
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x90
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x01
suffix:semicolon
id|svhs_bl
op_assign
l_int|0x6b
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x01
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0x10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x00
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x02
suffix:semicolon
id|svhs_bl
op_assign
l_int|0x00
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x01
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0x00
suffix:semicolon
)brace
r_else
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0xd1
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x00
suffix:semicolon
id|svhs_bl
op_assign
l_int|0xb9
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x00
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0xb3
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myflag
op_amp
l_int|0x04
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0xfd
suffix:semicolon
id|svhs_bh
op_assign
l_int|0x00
suffix:semicolon
id|svhs_bl
op_assign
l_int|0xdd
suffix:semicolon
id|cvbs_bh
op_assign
l_int|0x00
suffix:semicolon
id|cvbs_bl
op_assign
l_int|0xee
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
id|vga2_bh
op_assign
l_int|0x00
suffix:semicolon
id|vga2_bl
op_assign
l_int|0x00
suffix:semicolon
id|vga2_ch
op_assign
l_int|0x00
suffix:semicolon
id|vga2_cl
op_assign
l_int|0x00
suffix:semicolon
id|svhs_ch
op_assign
l_int|0x04
suffix:semicolon
id|svhs_cl
op_assign
l_int|0x08
suffix:semicolon
id|cvbs_ch
op_assign
l_int|0x08
suffix:semicolon
id|cvbs_cl
op_assign
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|vga2_ch
op_assign
l_int|0x0e
suffix:semicolon
id|vga2_cl
op_assign
l_int|0x08
suffix:semicolon
id|svhs_ch
op_assign
l_int|0x04
suffix:semicolon
id|svhs_cl
op_assign
l_int|0x04
suffix:semicolon
id|cvbs_ch
op_assign
l_int|0x08
suffix:semicolon
id|cvbs_cl
op_assign
l_int|0x04
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vga2_ch
op_logical_or
id|vga2_cl
op_logical_or
id|vga2_bh
op_logical_or
id|vga2_bl
)paren
(brace
id|haveresult
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|10
suffix:semicolon
id|j
op_increment
)paren
(brace
id|result
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SISDoSense
c_func
(paren
id|vga2_bl
comma
id|vga2_bh
comma
id|vga2_cl
comma
id|vga2_ch
)paren
)paren
(brace
id|result
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|result
op_ge
l_int|2
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s secondary VGA connection&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x10
)paren
suffix:semicolon
)brace
r_else
(brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x10
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302ELV
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
l_int|0x04
)paren
suffix:semicolon
)brace
id|haveresult
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|10
suffix:semicolon
id|j
op_increment
)paren
(brace
id|result
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SISDoSense
c_func
(paren
id|svhs_bl
comma
id|svhs_bh
comma
id|svhs_cl
comma
id|svhs_ch
)paren
)paren
(brace
id|result
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|result
op_ge
l_int|2
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s SVIDEO output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x05
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
(brace
id|haveresult
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|10
suffix:semicolon
id|j
op_increment
)paren
(brace
id|result
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SISDoSense
c_func
(paren
id|cvbs_bl
comma
id|cvbs_bh
comma
id|cvbs_cl
comma
id|cvbs_ch
)paren
)paren
(brace
id|result
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|result
op_ge
l_int|2
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s COMPOSITE output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x06
)paren
suffix:semicolon
)brace
r_else
(brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
)brace
id|SISDoSense
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|backupP2_00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine and detect attached TV&squot;s on Chrontel */
r_static
r_void
DECL|function|SiS_SenseCh
id|SiS_SenseCh
c_func
(paren
r_void
)paren
(brace
id|u8
id|temp1
comma
id|temp2
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_int
r_char
id|test
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Chrontel: Detected TV connected to&quot;
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
id|SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Chrontel 700x */
id|SiS_SetChrontelGPIO
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x9c
)paren
suffix:semicolon
multiline_comment|/* Set general purpose IO for Chrontel communication */
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|1000
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x25
)paren
suffix:semicolon
multiline_comment|/* See Chrontel TB31 for explanation */
id|temp2
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|temp2
op_amp
l_int|0x07
)paren
op_eq
l_int|0x01
)paren
op_logical_or
(paren
id|temp2
op_amp
l_int|0x04
)paren
)paren
(brace
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0b0e
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|300
)paren
suffix:semicolon
)brace
id|temp2
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x25
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_ne
id|temp1
)paren
(brace
id|temp1
op_assign
id|temp2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_ge
l_int|0x22
)paren
op_logical_and
(paren
id|temp1
op_le
l_int|0x50
)paren
)paren
(brace
multiline_comment|/* Read power status */
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x03
)paren
op_ne
l_int|0x03
)paren
(brace
multiline_comment|/* Power all outputs */
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0B0E
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|300
)paren
suffix:semicolon
)brace
multiline_comment|/* Sense connected TV devices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0110
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0010
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x08
)paren
)paren
(brace
id|test
(braket
id|i
)braket
op_assign
l_int|0x02
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|test
(braket
id|i
)braket
op_assign
l_int|0x01
suffix:semicolon
)brace
r_else
id|test
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test
(braket
l_int|0
)braket
op_eq
id|test
(braket
l_int|1
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test
(braket
l_int|0
)braket
op_eq
id|test
(braket
l_int|2
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test
(braket
l_int|1
)braket
op_eq
id|test
(braket
l_int|2
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: TV detection unreliable - test results varied&bslash;n&quot;
)paren
suffix:semicolon
id|temp1
op_assign
id|test
(braket
l_int|2
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0x02
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SVIDEO output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x05
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s CVBS output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x06
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0
)paren
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
multiline_comment|/* Set general purpose IO for Chrontel communication */
id|SiS_SetChrontelGPIO
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
id|SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Chrontel 7019 */
id|temp1
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x49
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x2049
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|temp2
op_or_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_xor_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp1
op_lshift
l_int|8
)paren
op_or
l_int|0x49
)paren
suffix:semicolon
id|temp1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x02
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x10
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x04
)paren
(brace
id|temp1
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|temp1
op_assign
l_int|0x04
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|temp1
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s CVBS output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x06
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SVIDEO output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo.vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x05
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SCART output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x04
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x03
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
multiline_comment|/* ------------------------ Heap routines -------------------------- */
DECL|function|sisfb_heap_init
r_static
r_int
id|sisfb_heap_init
c_func
(paren
r_void
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|u8
id|temp
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_int
id|agp_enabled
op_assign
l_int|1
suffix:semicolon
id|u32
id|agp_size
suffix:semicolon
r_int
r_int
op_star
id|cmdq_baseport
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|read_port
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|write_port
op_assign
l_int|0
suffix:semicolon
id|SIS_CMDTYPE
id|cmd_type
suffix:semicolon
macro_line|#ifndef AGPOFF
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_struct
id|agp_kern_info
op_star
id|agp_info
suffix:semicolon
r_struct
id|agp_memory
op_star
id|agp
suffix:semicolon
macro_line|#else
id|agp_kern_info
op_star
id|agp_info
suffix:semicolon
id|agp_memory
op_star
id|agp
suffix:semicolon
macro_line|#endif
id|u32
id|agp_phys
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/*     The heap start is either set manually using the &quot;mem&quot; parameter, or&n; *     defaults as follows:&n; *     -) If more than 16MB videoRAM available, let our heap start at 12MB.&n; *     -) If more than  8MB videoRAM available, let our heap start at  8MB.&n; *     -) If 4MB or less is available, let it start at 4MB.&n; *     This is for avoiding a clash with X driver which uses the beginning&n; *     of the videoRAM. To limit size of X framebuffer, use Option MaxXFBMem&n; *     in XF86Config-4.&n; *     The heap start can also be specified by parameter &quot;mem&quot; when starting the sisfb&n; *     driver. sisfb mem=1024 lets heap starts at 1MB, etc.&n; *&n; *     On the 315 and Xabre series, the default is a 1MB heap since DRI is not&n; *     supported there.&n; */
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0x800000
suffix:semicolon
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
l_int|0x400000
suffix:semicolon
)brace
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
id|ivideo.video_size
op_minus
l_int|0x100000
suffix:semicolon
)brace
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
)brace
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
(paren
id|ivideo.video_vbase
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Memory heap starting at %dK&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|ivideo.heapstart
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|sisfb_heap_end
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
id|ivideo.video_size
suffix:semicolon
id|sisfb_heap_size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* Now initialize the 315/330 series&squot; command queue mode.&n;&t; * On 315, there are three queue modes available which&n;&t; * are chosen by setting bits 7:5 in SR26:&n;&t; * 1. MMIO queue mode (bit 5, 0x20). The hardware will keep&n;&t; *    track of the queue, the FIFO, command parsing and so&n;&t; *    on. This is the one comparable to the 300 series.&n;&t; * 2. VRAM queue mode (bit 6, 0x40). In this case, one will&n;&t; *    have to do queue management himself. Register 0x85c4 will&n;&t; *    hold the location of the next free queue slot, 0x85c8&n;&t; *    is the &quot;queue read pointer&quot; whose way of working is&n;&t; *    unknown to me. Anyway, this mode would require a&n;&t; *    translation of the MMIO commands to some kind of&n;&t; *    accelerator assembly and writing these commands&n;&t; *    to the memory location pointed to by 0x85c4.&n;&t; *    We will not use this, as nobody knows how this&n;&t; *    &quot;assembly&quot; works, and as it would require a complete&n;&t; *    re-write of the accelerator code.&n;&t; * 3. AGP queue mode (bit 7, 0x80). Works as 2., but keeps the&n;&t; *    queue in AGP memory space.&n;&t; *&n;&t; * SR26 bit 4 is called &quot;Bypass H/W queue&quot;.&n;&t; * SR26 bit 1 is called &quot;Enable Command Queue Auto Correction&quot;&n;&t; * SR26 bit 0 resets the queue&n;&t; * Size of queue memory is encoded in bits 3:2 like this:&n;&t; *    00  (0x00)  512K&n;&t; *    01  (0x04)  1M&n;&t; *    10  (0x08)  2M&n;&t; *    11  (0x0C)  4M&n;&t; * The queue location is to be written to 0x85C0.&n;&t; *&n;         */
id|cmdq_baseport
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_PHYBASE
)paren
suffix:semicolon
id|write_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_WRITEPORT
)paren
suffix:semicolon
id|read_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_READPORT
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;AGP base: 0x%p, read: 0x%p, write: 0x%p&bslash;n&quot;
comma
id|cmdq_baseport
comma
id|read_port
comma
id|write_port
)paren
suffix:semicolon
id|agp_size
op_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
macro_line|#ifndef AGPOFF
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|agp_info
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|agp_info
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|agp_info
comma
l_int|0x00
comma
r_sizeof
(paren
op_star
id|agp_info
)paren
)paren
suffix:semicolon
macro_line|#else
id|agp_info
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|agp_info
comma
l_int|0x00
comma
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
macro_line|#endif
id|agp_copy_info
c_func
(paren
id|agp_info
)paren
suffix:semicolon
id|agp_backend_acquire
c_func
(paren
)paren
suffix:semicolon
id|agp
op_assign
id|agp_allocate_memory
c_func
(paren
id|COMMAND_QUEUE_AREA_SIZE
op_div
id|PAGE_SIZE
comma
id|AGP_NORMAL_MEMORY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|agp
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Allocating AGP buffer failed.&bslash;n&quot;
)paren
suffix:semicolon
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|agp_bind_memory
c_func
(paren
id|agp
comma
id|agp-&gt;pg_start
)paren
op_ne
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP: Failed to bind memory&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: Free AGP memory here */
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|agp_enable
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* Now select the queue mode */
r_if
c_cond
(paren
(paren
id|agp_enabled
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
)paren
(brace
id|cmd_type
op_assign
id|AGP_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using AGP queue mode&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&t;} else if (sisfb_heap_size &gt;= COMMAND_QUEUE_AREA_SIZE)  */
)brace
r_else
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|VM_CMD_QUEUE
)paren
(brace
id|cmd_type
op_assign
id|VM_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using VRAM queue mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using MMIO queue mode&bslash;n&quot;
)paren
suffix:semicolon
id|cmd_type
op_assign
id|MMIO_CMD
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|agp_size
)paren
(brace
r_case
l_int|0x80000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_512k
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_1M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x200000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_2M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x400000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_4M
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd_type
)paren
(brace
r_case
id|AGP_CMD_QUEUE
suffix:colon
macro_line|#ifndef AGPOFF
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP buffer base = 0x%lx, offset = 0x%x, size = %dK&bslash;n&quot;
comma
id|agp_info-&gt;aper_base
comma
id|agp-&gt;physical
comma
id|agp_size
op_div
l_int|1024
)paren
suffix:semicolon
id|agp_phys
op_assign
id|agp_info-&gt;aper_base
op_plus
id|agp-&gt;physical
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_AGP_IO_PAD
comma
l_int|0
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_AGP_IO_PAD
comma
id|SIS_AGP_2X
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_AGP_CMDQUEUE_ENABLE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|agp_phys
suffix:semicolon
id|sisfb_caps
op_or_assign
id|AGP_CMD_QUEUE_CAP
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|VM_CMD_QUEUE
suffix:colon
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_VRAM_CMDQUEUE_ENABLE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|VM_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: VM Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* MMIO */
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
multiline_comment|/* Set Auto_Correction bit */
id|temp
op_or_assign
(paren
id|SIS_MMIO_CMD_ENABLE
op_or
id|SIS_CMD_AUTO_CORR
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|MMIO_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: MMIO Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* sisvga_engine = 315 */
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
multiline_comment|/* Now initialize TurboQueue. TB is always located at the very&n;&t;     * top of the video RAM. */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|TURBO_QUEUE_AREA_SIZE
)paren
(brace
r_int
r_int
id|tqueue_pos
suffix:semicolon
id|u8
id|tq_state
suffix:semicolon
id|tqueue_pos
op_assign
(paren
id|ivideo.video_size
op_minus
id|TURBO_QUEUE_AREA_SIZE
)paren
op_div
(paren
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_amp
l_int|0xff
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|tq_state
op_or_assign
l_int|0xf0
suffix:semicolon
id|tq_state
op_and_assign
l_int|0xfc
suffix:semicolon
id|tq_state
op_or_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_ADR
comma
id|temp
)paren
suffix:semicolon
id|sisfb_caps
op_or_assign
id|TURBO_QUEUE_CAP
suffix:semicolon
id|sisfb_heap_end
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: TurboQueue start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|TURBO_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Now reserve memory for the HWCursor. It is always located at the very&n;        top of the videoRAM, right below the TB memory area (if used). */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|sisfb_hwcursor_size
)paren
(brace
id|sisfb_heap_end
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_hwcursor_vbase
op_assign
id|sisfb_heap_end
suffix:semicolon
id|sisfb_caps
op_or_assign
id|HW_CURSOR_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Hardware Cursor start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|sisfb_hwcursor_size
op_div
l_int|1024
)paren
suffix:semicolon
)brace
id|sisfb_heap.poha_chain
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
l_int|NULL
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
op_plus
l_int|1
suffix:semicolon
id|poh-&gt;offset
op_assign
id|sisfb_heap_start
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Heap start:0x%p, end:0x%p, len=%dk&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_start
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_end
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: First Node offset:0x%x, size:%dk&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|poh-&gt;offset
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|sisfb_heap.oh_free.poh_next
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.poh_prev
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.size
op_assign
l_int|0
suffix:semicolon
id|sisfb_heap.max_freesize
op_assign
id|poh-&gt;size
suffix:semicolon
id|sisfb_heap.oh_used.poh_next
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.poh_prev
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.size
op_assign
id|SENTINEL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_poh_new_node
r_static
id|SIS_OH
op_star
id|sisfb_poh_new_node
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|cOhs
suffix:semicolon
id|SIS_OHALLOC
op_star
id|poha
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap.poh_freelist
op_eq
l_int|NULL
)paren
(brace
id|poha
op_assign
id|kmalloc
c_func
(paren
id|OH_ALLOC_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|poha
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|poha-&gt;poha_next
op_assign
id|sisfb_heap.poha_chain
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
id|poha
suffix:semicolon
id|cOhs
op_assign
(paren
id|OH_ALLOC_SIZE
op_minus
r_sizeof
(paren
id|SIS_OHALLOC
)paren
)paren
op_div
r_sizeof
(paren
id|SIS_OH
)paren
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cOhs
op_minus
l_int|1
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|poh-&gt;poh_next
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh-&gt;poh_next
suffix:semicolon
r_return
(paren
id|poh
)paren
suffix:semicolon
)brace
DECL|function|sisfb_poh_allocate
r_static
id|SIS_OH
op_star
id|sisfb_poh_allocate
c_func
(paren
r_int
r_int
id|size
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|pohRoot
suffix:semicolon
r_int
id|bAllocated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|sisfb_heap.max_freesize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|pohThis-&gt;size
)paren
(brace
id|bAllocated
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|bAllocated
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|pohThis-&gt;size
)paren
(brace
id|pohRoot
op_assign
id|pohThis
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|pohThis
)paren
suffix:semicolon
)brace
r_else
(brace
id|pohRoot
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pohRoot
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohRoot-&gt;offset
op_assign
id|pohThis-&gt;offset
suffix:semicolon
id|pohRoot-&gt;size
op_assign
id|size
suffix:semicolon
id|pohThis-&gt;offset
op_add_assign
id|size
suffix:semicolon
id|pohThis-&gt;size
op_sub_assign
id|size
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_sub_assign
id|size
suffix:semicolon
id|pohThis
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_insert_node
c_func
(paren
id|pohThis
comma
id|pohRoot
)paren
suffix:semicolon
r_return
(paren
id|pohRoot
)paren
suffix:semicolon
)brace
DECL|function|sisfb_delete_node
r_static
r_void
id|sisfb_delete_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|poh_prev
op_assign
id|poh-&gt;poh_prev
suffix:semicolon
id|poh_next
op_assign
id|poh-&gt;poh_next
suffix:semicolon
id|poh_prev-&gt;poh_next
op_assign
id|poh_next
suffix:semicolon
id|poh_next-&gt;poh_prev
op_assign
id|poh_prev
suffix:semicolon
)brace
DECL|function|sisfb_insert_node
r_static
r_void
id|sisfb_insert_node
c_func
(paren
id|SIS_OH
op_star
id|pohList
comma
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|pohTemp
suffix:semicolon
id|pohTemp
op_assign
id|pohList-&gt;poh_next
suffix:semicolon
id|pohList-&gt;poh_next
op_assign
id|poh
suffix:semicolon
id|pohTemp-&gt;poh_prev
op_assign
id|poh
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
id|pohList
suffix:semicolon
id|poh-&gt;poh_next
op_assign
id|pohTemp
suffix:semicolon
)brace
DECL|function|sisfb_poh_free
r_static
id|SIS_OH
op_star
id|sisfb_poh_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|poh_freed
suffix:semicolon
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
r_int
r_int
id|ulUpper
suffix:semicolon
r_int
r_int
id|ulLower
suffix:semicolon
r_int
id|foundNode
op_assign
l_int|0
suffix:semicolon
id|poh_freed
op_assign
id|sisfb_heap.oh_used.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|poh_freed
op_ne
op_amp
id|sisfb_heap.oh_used
)paren
(brace
r_if
c_cond
(paren
id|poh_freed-&gt;offset
op_eq
id|base
)paren
(brace
id|foundNode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|poh_freed
op_assign
id|poh_freed-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|foundNode
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
id|sisfb_heap.max_freesize
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_prev
op_assign
id|poh_next
op_assign
l_int|NULL
suffix:semicolon
id|ulUpper
op_assign
id|poh_freed-&gt;offset
op_plus
id|poh_freed-&gt;size
suffix:semicolon
id|ulLower
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|pohThis-&gt;offset
op_eq
id|ulUpper
)paren
(brace
id|poh_next
op_assign
id|pohThis
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pohThis-&gt;offset
op_plus
id|pohThis-&gt;size
)paren
op_eq
id|ulLower
)paren
(brace
id|poh_prev
op_assign
id|pohThis
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
id|sisfb_delete_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh_prev
op_logical_and
id|poh_next
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
(paren
id|poh_freed-&gt;size
op_plus
id|poh_next-&gt;size
)paren
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_prev
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_next
)paren
(brace
id|poh_next-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_next-&gt;offset
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_next
)paren
suffix:semicolon
)brace
id|sisfb_insert_node
c_func
(paren
op_amp
id|sisfb_heap.oh_free
comma
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_freed
)paren
suffix:semicolon
)brace
DECL|function|sisfb_free_node
r_static
r_void
id|sisfb_free_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh
suffix:semicolon
)brace
DECL|function|sis_malloc
r_void
id|sis_malloc
c_func
(paren
r_struct
id|sis_memreq
op_star
id|req
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_allocate
c_func
(paren
id|req-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|req-&gt;offset
op_assign
l_int|0
suffix:semicolon
id|req-&gt;size
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation succeeded: 0x%p&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|poh-&gt;offset
op_plus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
)paren
)paren
suffix:semicolon
id|req-&gt;offset
op_assign
id|poh-&gt;offset
suffix:semicolon
id|req-&gt;size
op_assign
id|poh-&gt;size
suffix:semicolon
)brace
)brace
DECL|function|sis_free
r_void
id|sis_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_free
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: sisfb_poh_free() failed at base 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------- SetMode routines ------------------------- */
DECL|function|sisfb_pre_setmode
r_static
r_void
id|sisfb_pre_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|cr30
op_assign
l_int|0
comma
id|cr31
op_assign
l_int|0
comma
id|cr33
op_assign
l_int|0
comma
id|cr35
op_assign
l_int|0
suffix:semicolon
id|ivideo.currentvbflags
op_and_assign
(paren
id|VB_VIDEOBRIDGE
op_or
id|VB_DISPTYPE_DISP2
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x31
comma
id|cr31
)paren
suffix:semicolon
id|cr31
op_and_assign
op_complement
l_int|0x60
suffix:semicolon
id|cr31
op_or_assign
l_int|0x04
suffix:semicolon
id|cr33
op_assign
id|sisfb_rate_idx
op_amp
l_int|0x0F
suffix:semicolon
id|SiS_SetEnableDstn
c_func
(paren
op_amp
id|SiS_Pr
comma
id|FALSE
)paren
suffix:semicolon
id|SiS_SetEnableFstn
c_func
(paren
op_amp
id|SiS_Pr
comma
id|FALSE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_TV
suffix:colon
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SVIDEO
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_COMPOSITE
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_SCART
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SCART
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|TV_SCART
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
)brace
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo.vbflags
op_amp
id|TV_HIVISION
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_PAL
)paren
(brace
id|cr31
op_or_assign
l_int|0x01
suffix:semicolon
id|cr35
op_or_assign
l_int|0x01
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|TV_PAL
suffix:semicolon
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
)brace
r_else
(brace
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|cr35
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|CRT2_LCD
suffix:colon
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_LCD
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
id|SiS_SetEnableDstn
c_func
(paren
op_amp
id|SiS_Pr
comma
id|sisfb_dstn
)paren
suffix:semicolon
id|SiS_SetEnableFstn
c_func
(paren
op_amp
id|SiS_Pr
comma
id|sisfb_fstn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT2_VGA
suffix:colon
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_CRT2
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_nocrt2rate
)paren
(brace
id|cr33
op_or_assign
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|cr33
op_or_assign
(paren
(paren
id|sisfb_rate_idx
op_amp
l_int|0x0F
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* disable CRT2 */
id|cr30
op_assign
l_int|0x00
suffix:semicolon
id|cr31
op_or_assign
(paren
id|SIS_DRIVER_MODE
op_or
id|SIS_VB_OUTPUT_DISABLE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.chip
op_ge
id|SIS_661
)paren
(brace
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
multiline_comment|/* Leave overscan bit alone */
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x35
comma
op_complement
l_int|0x10
comma
id|cr35
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR30
comma
id|cr30
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR31
comma
id|cr31
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR33
comma
id|cr33
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* Clear LCDA and PAL-N/M bits */
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
op_complement
l_int|0x03
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_661
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
op_complement
l_int|0xc0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ivideo.accel
)paren
(brace
id|sisfb_syncaccel
c_func
(paren
)paren
suffix:semicolon
)brace
id|SiS_Pr.SiS_UseOEM
op_assign
id|sisfb_useoem
suffix:semicolon
)brace
DECL|function|sisfb_post_setmode
r_static
r_void
id|sisfb_post_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|BOOLEAN
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|u8
id|reg1
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
id|BOOLEAN
id|doit
op_assign
id|TRUE
suffix:semicolon
macro_line|#endif
multiline_comment|/* We can&squot;t switch off CRT1 if bridge is in slave mode */
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
(paren
id|sisfb_crt1off
)paren
op_logical_and
(paren
id|doit
)paren
)paren
(brace
id|crt1isoff
op_assign
id|TRUE
suffix:semicolon
id|reg
op_assign
l_int|0x00
suffix:semicolon
)brace
r_else
(brace
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
id|reg
op_assign
l_int|0x80
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x7f
comma
id|reg
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
(brace
id|crt1isoff
op_assign
id|TRUE
suffix:semicolon
id|reg
op_assign
l_int|0x40
suffix:semicolon
id|reg1
op_assign
l_int|0xc0
suffix:semicolon
)brace
r_else
(brace
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
id|reg
op_assign
l_int|0x00
suffix:semicolon
id|reg1
op_assign
l_int|0x00
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|SiS_Pr.SiS_MyCR63
comma
op_complement
l_int|0x40
comma
id|reg
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
op_complement
l_int|0xc0
comma
id|reg1
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|crt1isoff
)paren
(brace
id|ivideo.currentvbflags
op_and_assign
op_complement
id|VB_DISPTYPE_CRT1
suffix:semicolon
id|ivideo.currentvbflags
op_or_assign
id|VB_SINGLE_MODE
suffix:semicolon
id|ivideo.disp_state
op_or_assign
id|DISPMODE_SINGLE
suffix:semicolon
)brace
r_else
(brace
id|ivideo.currentvbflags
op_or_assign
id|VB_DISPTYPE_CRT1
suffix:semicolon
id|ivideo.disp_state
op_or_assign
id|DISPTYPE_CRT1
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_CRT2
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|VB_MIRROR_MODE
suffix:semicolon
id|ivideo.disp_state
op_or_assign
id|DISPMODE_MIRROR
suffix:semicolon
)brace
r_else
(brace
id|ivideo.currentvbflags
op_or_assign
id|VB_SINGLE_MODE
suffix:semicolon
id|ivideo.disp_state
op_or_assign
id|DISPMODE_SINGLE
suffix:semicolon
)brace
)brace
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_RAMDAC_CONTROL
comma
op_complement
l_int|0x04
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo.currentvbflags
op_amp
id|CRT2_TV
)paren
op_logical_and
(paren
id|ivideo.vbflags
op_amp
id|VB_301
)paren
)paren
(brace
multiline_comment|/* Set filter for SiS301 */
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|320
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|filter
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|sisfb_CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_NTSC
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3a
comma
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xdf
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x04
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEE
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x0C
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x22
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x15
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0xF6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_PAL
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3A
comma
l_int|0x1F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xDF
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xF7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1F
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1D
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xFC
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xFB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x14
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x2A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|filter
op_ge
l_int|0
)paren
op_logical_and
(paren
id|filter
op_le
l_int|7
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;FilterTable[%d]-%d: %02x %02x %02x %02x&bslash;n&quot;
comma
id|filter_tb
comma
id|filter
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifndef MODULE
DECL|function|sisfb_setup
r_int
id|sisfb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|sisfb_fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#endif
id|ivideo.refresh_rate
op_assign
l_int|0
suffix:semicolon
id|SiS_Pr.SiS_CustomT
op_assign
id|CUT_NONE
suffix:semicolon
id|SiS_Pr.UsePanelScaler
op_assign
op_minus
l_int|1
suffix:semicolon
id|SiS_Pr.LVDSHL
op_assign
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Options %s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vesa:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
comma
id|FALSE
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* fb_invert_cmaps(); */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|sisfb_fontname
comma
id|this_opt
op_plus
l_int|5
comma
r_sizeof
(paren
id|sisfb_fontname
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|sisfb_fontname
(braket
r_sizeof
(paren
id|sisfb_fontname
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vrate:&quot;
comma
l_int|6
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|sisfb_parm_rate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;rate:&quot;
comma
l_int|5
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|sisfb_parm_rate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;crt1off&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;filter:&quot;
comma
l_int|7
)paren
)paren
(brace
id|filter
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt2type:&quot;
comma
l_int|14
)paren
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt1:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_forcecrt1
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|10
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvmode:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvstandard:&quot;
comma
l_int|11
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mem:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_mem
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;queuemode:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_search_queuemode
c_func
(paren
id|this_opt
op_plus
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pdc:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noypan&quot;
comma
l_int|6
)paren
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomax&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_max
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;userom:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_userom
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;useoem:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_useoem
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nocrt2rate&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_nocrt2rate
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;scalelcd:&quot;
comma
l_int|9
)paren
)paren
(brace
r_int
r_int
id|temp
op_assign
l_int|2
suffix:semicolon
id|temp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|9
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|1
)paren
)paren
(brace
id|SiS_Pr.UsePanelScaler
op_assign
id|temp
op_xor
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;specialtiming:&quot;
comma
l_int|14
)paren
)paren
(brace
id|sisfb_search_specialtiming
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lvdshl:&quot;
comma
l_int|7
)paren
)paren
(brace
r_int
r_int
id|temp
op_assign
l_int|4
suffix:semicolon
id|temp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ge
l_int|0
)paren
op_logical_and
(paren
id|temp
op_le
l_int|3
)paren
)paren
(brace
id|SiS_Pr.LVDSHL
op_assign
id|temp
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|this_opt
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
id|this_opt
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
comma
id|TRUE
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid option %s&bslash;n&quot;
comma
id|this_opt
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: Acceleration only with MMIO mode */
r_if
c_cond
(paren
(paren
id|sisfb_queuemode
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_ne
id|MMIO_CMD
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sis_find_rom
r_static
r_char
op_star
id|sis_find_rom
c_func
(paren
r_void
)paren
(brace
macro_line|#if defined(__i386__)
id|u32
id|segstart
suffix:semicolon
r_int
r_char
op_star
id|rom_base
comma
op_star
id|rom
suffix:semicolon
r_int
id|romptr
suffix:semicolon
r_int
r_int
id|pciid
suffix:semicolon
r_for
c_loop
(paren
id|segstart
op_assign
l_int|0x000c0000
suffix:semicolon
id|segstart
OL
l_int|0x000f0000
suffix:semicolon
id|segstart
op_add_assign
l_int|0x00001000
)paren
(brace
id|rom_base
op_assign
(paren
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|segstart
comma
l_int|0x10000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rom_base
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
id|rom_base
op_ne
l_int|0x55
)paren
op_logical_or
(paren
op_star
(paren
id|rom_base
op_plus
l_int|1
)paren
op_ne
l_int|0xaa
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|romptr
op_assign
(paren
r_int
r_int
)paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x18
)paren
op_or
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x19
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|romptr
OG
(paren
l_int|0x10000
op_minus
l_int|8
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
op_plus
id|romptr
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|rom
op_ne
l_char|&squot;P&squot;
)paren
op_logical_or
(paren
op_star
(paren
id|rom
op_plus
l_int|1
)paren
op_ne
l_char|&squot;C&squot;
)paren
op_logical_or
(paren
op_star
(paren
id|rom
op_plus
l_int|2
)paren
op_ne
l_char|&squot;I&squot;
)paren
op_logical_or
(paren
op_star
(paren
id|rom
op_plus
l_int|3
)paren
op_ne
l_char|&squot;R&squot;
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pciid
op_assign
(paren
op_star
(paren
id|rom
op_plus
l_int|4
)paren
)paren
op_or
(paren
(paren
op_star
(paren
id|rom
op_plus
l_int|5
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_ne
l_int|0x1039
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pciid
op_assign
(paren
op_star
(paren
id|rom
op_plus
l_int|6
)paren
)paren
op_or
(paren
(paren
op_star
(paren
id|rom
op_plus
l_int|7
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_eq
id|ivideo.chip_id
)paren
(brace
r_return
id|rom_base
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sisfb_init
r_int
id|__init
id|sisfb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|board
op_star
id|b
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u32
id|reg32
suffix:semicolon
id|u16
id|reg16
suffix:semicolon
id|u8
id|reg
suffix:semicolon
macro_line|#if 0
multiline_comment|/* for DOC VB */
id|sisfb_set_reg4
c_func
(paren
l_int|0xcf8
comma
l_int|0x800000e0
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xcfc
)paren
suffix:semicolon
id|reg32
op_assign
id|reg32
op_or
l_int|0x00001000
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xcfc
comma
id|reg32
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_off
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|sisfb_registered
op_assign
l_int|0
suffix:semicolon
id|sisfb_thismonitor.datavalid
op_assign
id|FALSE
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sishw_ext
comma
l_int|0
comma
r_sizeof
(paren
id|sishw_ext
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|memset
c_func
(paren
op_amp
id|sisfb_lastrates
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|128
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|memset
c_func
(paren
op_amp
id|sis_disp
comma
l_int|0
comma
r_sizeof
(paren
id|sis_disp
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,74)
id|pci_for_each_dev
c_func
(paren
id|pdev
)paren
(brace
macro_line|#else
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
)paren
(brace
macro_line|#endif
r_for
c_loop
(paren
id|b
op_assign
id|sisdev_list
suffix:semicolon
id|b-&gt;vendor
suffix:semicolon
id|b
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|b-&gt;vendor
op_eq
id|pdev-&gt;vendor
)paren
op_logical_and
(paren
id|b-&gt;device
op_eq
id|pdev-&gt;device
)paren
)paren
(brace
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)) &amp;&amp; defined(NEWFBDEV)
id|sis_fb_info
op_assign
id|framebuffer_alloc
c_func
(paren
l_int|0
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
macro_line|#else
id|sis_fb_info
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sis_fb_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|sis_fb_info
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)) || (!(defined(NEWFBDEV)))
id|memset
c_func
(paren
id|sis_fb_info
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sis_fb_info
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
id|b-&gt;name
)paren
suffix:semicolon
macro_line|#else&t;&t;&t;&t;
id|strcpy
c_func
(paren
id|myid
comma
id|b-&gt;name
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
id|ivideo.chip_id
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|ivideo.revision_id
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|reg16
)paren
suffix:semicolon
id|sishw_ext.jChipRevision
op_assign
id|ivideo.revision_id
suffix:semicolon
id|sisvga_enabled
op_assign
id|reg16
op_amp
l_int|0x01
suffix:semicolon
id|ivideo.pcibus
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
id|ivideo.pcislot
op_assign
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo.pcifunc
op_assign
id|PCI_FUNC
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo.subsysvendor
op_assign
id|pdev-&gt;subsystem_vendor
suffix:semicolon
id|ivideo.subsysdevice
op_assign
id|pdev-&gt;subsystem_device
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pdev_valid
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip_id
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|PCI_DEVICE_ID_SI_300
suffix:colon
id|ivideo.chip
op_assign
id|SIS_300
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
multiline_comment|/* New X driver uses 2 buffers */
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_630_VGA
suffix:colon
(brace
id|ivideo.chip
op_assign
id|SIS_630
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07301039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_730
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_540_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_540
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|PCI_DEVICE_ID_SI_315H
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315H
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315PRO
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315PRO
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_550_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_550
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_650_VGA
suffix:colon
(brace
id|ivideo.chip
op_assign
id|SIS_650
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07401039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_740
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 740&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 740&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_330
suffix:colon
id|ivideo.chip
op_assign
id|SIS_330
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_660_VGA
suffix:colon
(brace
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07601039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_760
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 760&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 760&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x06601039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_660
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 660&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 660&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07411039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_741
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 741&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 741&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|ivideo.chip
op_assign
id|SIS_661
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
l_string|&quot;SIS 661&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 661&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
r_default
suffix:colon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.jChipType
op_assign
id|ivideo.chip
suffix:semicolon
multiline_comment|/* for Debug */
r_if
c_cond
(paren
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315
)paren
)paren
(brace
id|sishw_ext.jChipType
op_assign
id|SIS_315H
suffix:semicolon
)brace
id|ivideo.video_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|ivideo.mmio_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|sishw_ext.ulIOAddress
op_assign
id|SiS_Pr.RelIO
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
op_plus
l_int|0x30
suffix:semicolon
id|ivideo.vga_base
op_assign
(paren
r_int
r_int
)paren
id|sishw_ext.ulIOAddress
suffix:semicolon
id|sisfb_mmio_size
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|SiS_Pr.SiS_Backup70xx
op_assign
l_int|0xff
suffix:semicolon
id|SiS_Pr.SiS_CHOverScan
op_assign
op_minus
l_int|1
suffix:semicolon
id|SiS_Pr.SiS_ChSW
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.SiS_UseLCDA
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.HaveEMI
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.HaveEMILCD
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.OverruleEMI
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.SiS_SensibleSR11
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.SiS_MyCR63
op_assign
l_int|0x63
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_ge
id|SIS_661
)paren
(brace
id|SiS_Pr.SiS_SensibleSR11
op_assign
id|TRUE
suffix:semicolon
id|SiS_Pr.SiS_MyCR63
op_assign
l_int|0x53
suffix:semicolon
)brace
id|SiSRegInit
c_func
(paren
op_amp
id|SiS_Pr
comma
id|sishw_ext.ulIOAddress
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* TW: Find PCI systems for Chrontel/GPIO communication setup */
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_630
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_eq
id|ivideo.subsysvendor
op_logical_and
id|mychswtable
(braket
id|i
)braket
dot
id|subsysCard
op_eq
id|ivideo.subsysdevice
)paren
(brace
id|SiS_Pr.SiS_ChSW
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Identified [%s %s] requiring Chrontel/GPIO setup&bslash;n&quot;
comma
id|mychswtable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mychswtable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_ne
l_int|0
)paren
(brace
suffix:semicolon
)brace
)brace
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;&t;
macro_line|#ifdef MODULE
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0x80
)paren
op_logical_and
(paren
id|reg
op_ne
l_int|0xff
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Cannot initialize display mode, X server is active&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
macro_line|#endif&t;
macro_line|#endif
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_315H
suffix:colon
r_case
id|SIS_315
suffix:colon
r_case
id|SIS_330
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
r_case
id|SIS_650
suffix:colon
r_case
id|SIS_740
suffix:colon
r_case
id|SIS_661
suffix:colon
r_case
id|SIS_741
suffix:colon
r_case
id|SIS_660
suffix:colon
r_case
id|SIS_760
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_1A
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|SIS_SCRATCH_REG_1A_MASK
)paren
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_else
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_userom
)paren
(brace
id|sishw_ext.pjVirtualRomBase
op_assign
id|sis_find_rom
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pjVirtualRomBase
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM found and mapped to %p&bslash;n&quot;
comma
id|sishw_ext.pjVirtualRomBase
)paren
suffix:semicolon
id|sishw_ext.UseROM
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM not found&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sishw_ext.pjVirtualRomBase
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM usage disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sishw_ext.bSkipDramSizing
op_assign
l_int|0
suffix:semicolon
id|sishw_ext.pQueryVGAConfigSpace
op_assign
op_amp
id|sisfb_query_VGA_config_space
suffix:semicolon
id|sishw_ext.pQueryNorthBridgeSpace
op_assign
op_amp
id|sisfb_query_north_bridge_space
suffix:semicolon
multiline_comment|/* Find systems for special custom timing */
r_if
c_cond
(paren
id|SiS_Pr.SiS_CustomT
op_eq
id|CUT_NONE
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|j
suffix:semicolon
r_int
r_char
op_star
id|biosver
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|biosdate
op_assign
l_int|NULL
suffix:semicolon
id|BOOLEAN
id|footprint
suffix:semicolon
r_int
r_int
id|chksum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.UseROM
)paren
(brace
id|biosver
op_assign
id|sishw_ext.pjVirtualRomBase
op_plus
l_int|0x06
suffix:semicolon
id|biosdate
op_assign
id|sishw_ext.pjVirtualRomBase
op_plus
l_int|0x2c
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32768
suffix:semicolon
id|i
op_increment
)paren
(brace
id|chksum
op_add_assign
id|sishw_ext.pjVirtualRomBase
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_eq
id|ivideo.chip
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
)paren
)paren
op_logical_or
(paren
id|sishw_ext.UseROM
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
comma
id|biosver
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
)paren
)paren
)paren
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
)paren
)paren
op_logical_or
(paren
id|sishw_ext.UseROM
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
comma
id|biosdate
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
)paren
)paren
)paren
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|mycustomttable
(braket
id|i
)braket
dot
id|bioschksum
)paren
op_logical_or
(paren
id|sishw_ext.UseROM
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|bioschksum
op_eq
id|chksum
)paren
)paren
)paren
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|pcisubsysvendor
op_eq
id|ivideo.subsysvendor
)paren
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|pcisubsyscard
op_eq
id|ivideo.subsysdevice
)paren
)paren
(brace
id|footprint
op_assign
id|TRUE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|5
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintAddr
(braket
id|j
)braket
)paren
(brace
r_if
c_cond
(paren
id|sishw_ext.UseROM
)paren
(brace
r_if
c_cond
(paren
id|sishw_ext.pjVirtualRomBase
(braket
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintAddr
(braket
id|j
)braket
)braket
op_ne
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintData
(braket
id|j
)braket
)paren
(brace
id|footprint
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_else
id|footprint
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|footprint
)paren
(brace
id|SiS_Pr.SiS_CustomT
op_assign
id|mycustomttable
(braket
id|i
)braket
dot
id|SpecialID
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Identified [%s %s], special timing applies&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: [specialtiming parameter name: %s]&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
)paren
(brace
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* Mode numbers for 1280x768 are different for 300 and 315 series */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisbios_mode
(braket
id|MODEINDEX_1280x768
)braket
dot
id|mode_no
op_assign
l_int|0x55
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x768
op_plus
l_int|1
)braket
dot
id|mode_no
op_assign
l_int|0x5a
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x768
op_plus
l_int|2
)braket
dot
id|mode_no
op_assign
l_int|0x5b
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x768
op_plus
l_int|3
)braket
dot
id|mode_no
op_assign
l_int|0x5b
suffix:semicolon
)brace
macro_line|#endif
id|sishw_ext.pSR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|SR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pSR
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Allocating SRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pCR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|CR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pCR
op_eq
l_int|NULL
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Allocating CRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 300 Init */
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x4000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_get_dram_size_300
c_func
(paren
)paren
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 315 Init */
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_get_dram_size_315
c_func
(paren
)paren
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
multiline_comment|/* Enable PCI_LINEAR_ADDRESSING and MMIO_ENABLE  */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PCI_ADDRESS_SET
comma
(paren
id|SIS_PCI_ADDR_ENABLE
op_or
id|SIS_MEM_MAP_IO_ENABLE
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable 2D accelerator engine */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_MODULE_ENABLE
comma
id|SIS_ENABLE_2D
)paren
suffix:semicolon
)brace
id|sishw_ext.ulVideoMemorySize
op_assign
id|ivideo.video_size
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_pdc
op_and_assign
l_int|0x3c
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_pdc
)paren
(brace
id|SiS_Pr.PDC
op_assign
id|sisfb_pdc
suffix:semicolon
)brace
r_else
(brace
id|SiS_Pr.PDC
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
comma
l_string|&quot;sisfb FB&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Is there another framebuffer driver active?&bslash;n&quot;
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
comma
l_string|&quot;sisfb MMIO&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ivideo.video_vbase
op_assign
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ivideo.video_vbase
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to map frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ivideo.mmio_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ivideo.mmio_vbase
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to map MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo.video_vbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Framebuffer at 0x%lx, mapped to 0x%p, size %dk&bslash;n&quot;
comma
id|ivideo.video_base
comma
id|ivideo.video_vbase
comma
id|ivideo.video_size
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: MMIO at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo.mmio_base
comma
id|ivideo.mmio_vbase
comma
id|sisfb_mmio_size
op_div
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap_init
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sisfb: Failed to initialize offscreen memory heap&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|ivideo.mtrr
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
id|ivideo.vbflags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_UNKNOWN
suffix:semicolon
id|sishw_ext.Is301BDH
op_assign
id|FALSE
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0
suffix:semicolon
id|sisfb_sense_crt1
c_func
(paren
)paren
suffix:semicolon
id|sisfb_get_VB_type
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
id|sisfb_detect_VB_connect
c_func
(paren
)paren
suffix:semicolon
)brace
id|ivideo.currentvbflags
op_assign
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_crt2type
op_eq
id|CRT2_LCD
)paren
op_logical_and
(paren
id|ivideo.vbflags
op_amp
id|CRT2_LCD
)paren
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
id|CRT2_LCD
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|sisfb_crt2type
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Chrontel 700x TV detection often unreliable, therefore use a&n;&t;&t;       * different default order on such machines&n;&t;&t;       */
r_if
c_cond
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|ivideo.vbflags
op_amp
id|VB_CHRONTEL
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_TV
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_TV
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|ivideo.currentvbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_LCD_PANEL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis300paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis310paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
)brace
id|sisfb_detectedpdc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* Save the current PanelDelayCompensation if the LCD is currently used */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_30xBDH
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Currently on LCD? If yes, read current pdc */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
id|sisfb_detectedpdc
op_and_assign
l_int|0x3c
suffix:semicolon
r_if
c_cond
(paren
id|SiS_Pr.PDC
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Let option override detection */
id|SiS_Pr.PDC
op_assign
id|sisfb_detectedpdc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|SiS_Pr.PDC
)paren
op_logical_and
(paren
id|SiS_Pr.PDC
op_ne
id|sisfb_detectedpdc
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|SiS_Pr.PDC
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|sisfb_detectedlcda
op_assign
l_int|0xff
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* Save PDC */
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Currently on LCD? If yes, read current pdc */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x2D
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiS_Pr.PDC
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Let option override detection */
id|SiS_Pr.PDC
op_assign
id|sisfb_detectedpdc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|SiS_Pr.PDC
)paren
op_logical_and
(paren
id|SiS_Pr.PDC
op_ne
id|sisfb_detectedpdc
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|SiS_Pr.PDC
)paren
suffix:semicolon
)brace
multiline_comment|/* Save EMI */
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x30
comma
id|SiS_Pr.EMI_30
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x31
comma
id|SiS_Pr.EMI_31
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x32
comma
id|SiS_Pr.EMI_32
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x33
comma
id|SiS_Pr.EMI_33
)paren
suffix:semicolon
id|SiS_Pr.HaveEMI
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
id|SiS_Pr.HaveEMILCD
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Try to find about LCDA */
r_if
c_cond
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302B
op_or
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_le
l_int|0x13
)paren
op_logical_or
(paren
id|tmp
op_eq
l_int|0xff
)paren
)paren
(brace
multiline_comment|/* Currently on LCDA? (Some BIOSes leave CR38) */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0x03
)paren
op_eq
l_int|0x03
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Currently on LCDA? (Some newer BIOSes set D0 in CR35) */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x35
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x01
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Currently on LCD? If so, we can find out&n;&t;&t;&t;        * by peeking the mode register&n;&t;&t;&t;&t;*/
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x04
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|SiS_Pr.SiS_UseLCDA
)paren
(brace
id|sisfb_detectedlcda
op_assign
l_int|0x03
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Bridge uses LCDA for low resolution and text modes&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|sisfb_crt1off
)paren
(brace
id|sisfb_handle_ddc
c_func
(paren
op_amp
id|sisfb_thismonitor
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ivideo.vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
id|ivideo.vbflags
op_amp
(paren
id|CRT2_VGA
op_or
id|CRT2_LCD
)paren
)paren
)paren
(brace
id|sisfb_handle_ddc
c_func
(paren
op_amp
id|sisfb_thismonitor
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisfb_mode_idx
op_ge
l_int|0
)paren
id|sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|sisfb_mode_idx
comma
id|ivideo.currentvbflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_LCD
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_LCDMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT2_TV
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_TVMODE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.refresh_rate
op_ne
l_int|0
)paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
comma
id|sisfb_mode_idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_rate_idx
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
op_amp
id|sisfb_thismonitor
comma
id|sisfb_mode_idx
comma
id|sisfb_rate_idx
comma
id|ivideo.refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|sisfb_set_vparms
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
multiline_comment|/* ---------------- For 2.4: Now switch the mode ------------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_accel
)paren
(brace
id|ivideo.accel
op_assign
op_minus
l_int|1
suffix:semicolon
id|default_var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|sisfb_initaccel
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Maximize regardless of sisfb_max at startup */
id|default_var.yres_virtual
op_assign
l_int|32767
suffix:semicolon
id|sisfb_crtc_to_var
c_func
(paren
op_amp
id|default_var
)paren
suffix:semicolon
id|sis_fb_info-&gt;node
op_assign
op_minus
l_int|1
suffix:semicolon
id|sis_fb_info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sis_fb_info-&gt;blank
op_assign
op_amp
id|sisfb_blank
suffix:semicolon
id|sis_fb_info-&gt;fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|sis_fb_info-&gt;switch_con
op_assign
op_amp
id|sisfb_switch
suffix:semicolon
id|sis_fb_info-&gt;updatevar
op_assign
op_amp
id|sisfb_update_var
suffix:semicolon
id|sis_fb_info-&gt;changevar
op_assign
l_int|NULL
suffix:semicolon
id|sis_fb_info-&gt;disp
op_assign
op_amp
id|sis_disp
suffix:semicolon
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;fontname
comma
id|sisfb_fontname
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|default_var
comma
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#else&t;&t;/* --------- For 2.5: Setup a somewhat sane default var ------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Default mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|default_var.xres
op_assign
id|default_var.xres_virtual
op_assign
id|ivideo.video_width
suffix:semicolon
id|default_var.yres
op_assign
id|default_var.yres_virtual
op_assign
id|ivideo.video_height
suffix:semicolon
id|default_var.bits_per_pixel
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|sisfb_bpp_to_var
c_func
(paren
op_amp
id|default_var
)paren
suffix:semicolon
id|default_var.pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|sisfb_mode_rate_to_dclock
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
comma
id|sisfb_rate_idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_rate_to_ddata
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
comma
id|sisfb_rate_idx
comma
op_amp
id|default_var.left_margin
comma
op_amp
id|default_var.right_margin
comma
op_amp
id|default_var.upper_margin
comma
op_amp
id|default_var.lower_margin
comma
op_amp
id|default_var.hsync_len
comma
op_amp
id|default_var.vsync_len
comma
op_amp
id|default_var.sync
comma
op_amp
id|default_var.vmode
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|default_var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|default_var.pixclock
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_accel
)paren
(brace
id|ivideo.accel
op_assign
op_minus
l_int|1
suffix:semicolon
id|default_var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|sisfb_initaccel
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
multiline_comment|/* Maximize regardless of sisfb_max at startup */
id|default_var.yres_virtual
op_assign
id|ivideo.heapstart
op_div
(paren
id|default_var.xres
op_star
(paren
id|default_var.bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_var.yres_virtual
OG
l_int|32767
)paren
(brace
id|default_var.yres_virtual
op_assign
l_int|32767
suffix:semicolon
)brace
r_if
c_cond
(paren
id|default_var.yres_virtual
op_le
id|default_var.yres
)paren
(brace
id|default_var.yres_virtual
op_assign
id|default_var.yres
suffix:semicolon
)brace
)brace
id|sis_fb_info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sis_fb_info-&gt;var
op_assign
id|default_var
suffix:semicolon
id|sis_fb_info-&gt;fix
op_assign
id|sisfb_fix
suffix:semicolon
id|sis_fb_info-&gt;par
op_assign
op_amp
id|ivideo
suffix:semicolon
id|sis_fb_info-&gt;screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|sis_fb_info-&gt;fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
macro_line|#ifdef NEWFBDEV
id|sis_fb_info-&gt;class_dev.dev
op_assign
op_amp
id|pdev-&gt;dev
suffix:semicolon
macro_line|#endif
id|sisfb_get_fix
c_func
(paren
op_amp
id|sis_fb_info-&gt;fix
comma
op_minus
l_int|1
comma
id|sis_fb_info
)paren
suffix:semicolon
id|sis_fb_info-&gt;pseudo_palette
op_assign
id|pseudo_palette
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|sis_fb_info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Initial vbflags 0x%lx&bslash;n&quot;
comma
id|ivideo.vbflags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|ivideo.mtrr
op_assign
id|mtrr_add
c_func
(paren
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.mtrr
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Added MTRRs&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|vc_resize_con
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
id|sis_fb_info
)paren
OL
l_int|0
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Failed to register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_registered
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Installed SISFB_GET_INFO ioctl (%x)&bslash;n&quot;
comma
id|SISFB_GET_INFO
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Installed SISFB_GET_VBRSTATUS ioctl (%x)&bslash;n&quot;
comma
id|SISFB_GET_VBRSTATUS
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: 2D acceleration is %s, scrolling mode %s&bslash;n&quot;
comma
id|sisfb_accel
ques
c_cond
l_string|&quot;enabled&quot;
suffix:colon
l_string|&quot;disabled&quot;
comma
id|sisfb_ypan
ques
c_cond
(paren
id|sisfb_max
ques
c_cond
l_string|&quot;ypan (auto-max)&quot;
suffix:colon
l_string|&quot;ypan (no auto-max)&quot;
)paren
suffix:colon
l_string|&quot;redraw&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|sis_fb_info-&gt;node
)paren
comma
id|sis_fb_info-&gt;modename
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|sis_fb_info-&gt;node
comma
id|myid
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: (C) 2001-2004 Thomas Winischhofer.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* if mode = &quot;none&quot; */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|vesa
r_static
r_int
id|vesa
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|rate
r_static
r_int
r_int
id|rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|crt1off
r_static
r_int
r_int
id|crt1off
op_assign
l_int|1
suffix:semicolon
DECL|variable|mem
r_static
r_int
r_int
id|mem
op_assign
l_int|0
suffix:semicolon
DECL|variable|forcecrt2type
r_static
r_char
op_star
id|forcecrt2type
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|forcecrt1
r_static
r_int
id|forcecrt1
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|queuemode
r_static
r_char
op_star
id|queuemode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|pdc
r_static
r_int
id|pdc
op_assign
l_int|0
suffix:semicolon
DECL|variable|noaccel
r_static
r_int
id|noaccel
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|noypan
r_static
r_int
id|noypan
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|nomax
r_static
r_int
id|nomax
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|inverse
r_static
r_int
id|inverse
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|userom
r_static
r_int
id|userom
op_assign
l_int|1
suffix:semicolon
DECL|variable|useoem
r_static
r_int
id|useoem
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|tvstandard
r_static
r_char
op_star
id|tvstandard
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|nocrt2rate
r_static
r_int
id|nocrt2rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|scalelcd
r_static
r_int
id|scalelcd
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|specialtiming
r_static
r_char
op_star
id|specialtiming
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|lvdshl
r_static
r_int
id|lvdshl
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 300/540/630/730/315/550/650/651/661/740/741/330/760 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;; SiS; Various others&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired display mode in the format [X]x[Y]x[Depth], eg.&bslash;n&quot;
l_string|&quot;1024x768x16. Other formats supported include XxY-Depth and&bslash;n&quot;
l_string|&quot;XxY-Depth@Rate. If the parameter is only one (decimal or hexadecimal)&bslash;n&quot;
l_string|&quot;number, it will be interpreted as a VESA mode number. (default: none if&bslash;n&quot;
l_string|&quot;sisfb is a module; this leaves the console untouched and the driver will&bslash;n&quot;
l_string|&quot;only do the video memory management for eg. DRM/DRI; 800x600x8 if sisfb&bslash;n&quot;
l_string|&quot;is in the kernel)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)&t; 
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired default display mode in the format XxYxDepth,&bslash;n&quot;
l_string|&quot;eg. 1024x768x16. Other formats supported include XxY-Depth and&bslash;n&quot;
l_string|&quot;XxY-Depth@Rate. If the parameter is only one (decimal or hexadecimal)&bslash;n&quot;
l_string|&quot;number, it will be interpreted as a VESA mode number. (default: 800x600x8)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|vesa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired display mode by VESA defined mode number, eg. 0x117&bslash;n&quot;
l_string|&quot;(default: 0x0000 if sisfb is a module; this leaves the console untouched&bslash;n&quot;
l_string|&quot;and the driver will only do the video memory management for eg. DRM/DRI;&bslash;n&quot;
l_string|&quot;0x0103 if sisfb is in the kernel)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|vesa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired default display mode by VESA defined mode number, eg.&bslash;n&quot;
l_string|&quot;0x117 (default: 0x0103)&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM
c_func
(paren
id|rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|rate
comma
l_string|&quot;&bslash;nSelects the desired vertical refresh rate for CRT1 (external VGA) in Hz.&bslash;n&quot;
l_string|&quot;If the mode is specified in the format XxY-Depth@Rate, this parameter&bslash;n&quot;
l_string|&quot;will be ignored (default: 60)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|crt1off
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|crt1off
comma
l_string|&quot;(Deprecated, please use forcecrt1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|filter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|filter
comma
l_string|&quot;&bslash;nSelects TV flicker filter type (only for systems with a SiS301 video bridge).&bslash;n&quot;
l_string|&quot;(Possible values 0-7, default: [no filter])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|queuemode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|queuemode
comma
l_string|&quot;&bslash;nSelects the queue mode on 315/550/65x/74x/330/760. Possible choices are AGP, VRAM,&bslash;n&quot;
l_string|&quot;MMIO. AGP is only available if the kernel has AGP support. The queue mode is&bslash;n&quot;
l_string|&quot;important to programs using the 2D/3D accelerator of the SiS chip. The modes&bslash;n&quot;
l_string|&quot;require a totally different way of programming the engines. If any mode than&bslash;n&quot;
l_string|&quot;MMIO is selected, sisfb will disable its own 2D acceleration. On&bslash;n&quot;
l_string|&quot;300/540/630/730, this option is ignored. (default: MMIO)&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: &quot;Import&quot; the options from the X driver */
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mem
comma
l_string|&quot;&bslash;nDetermines the beginning of the video memory heap in KB. This heap is used&bslash;n&quot;
l_string|&quot;for video RAM management for eg. DRM/DRI. On 300 series, the default depends&bslash;n&quot;
l_string|&quot;on the amount of video RAM available. If 8MB of video RAM or less is available,&bslash;n&quot;
l_string|&quot;the heap starts at 4096KB, if between 8 and 16MB are available at 8192KB,&bslash;n&quot;
l_string|&quot;otherwise at 12288KB. On 315 and Xabre series, the heap is 1MB by default. The&bslash;n&quot;
l_string|&quot;value is to be specified without &squot;KB&squot; and should match the MaxXFBMem setting for&bslash;n&quot;
l_string|&quot;XFree 4.x (x&gt;=2).&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;&bslash;nIf this option is omitted, the driver autodetects CRT2 output devices, such as&bslash;n&quot;
l_string|&quot;LCD, TV or secondary VGA. With this option, this autodetection can be&bslash;n&quot;
l_string|&quot;overridden. Possible parameters are LCD, TV, VGA or NONE. NONE disables CRT2.&bslash;n&quot;
l_string|&quot;On systems with a 301(B/LV) bridge, parameters SVIDEO, COMPOSITE or SCART can be&bslash;n&quot;
l_string|&quot;used instead of TV to override the TV detection. (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt1
comma
l_string|&quot;&bslash;nNormally, the driver autodetects whether or not CRT1 (external VGA) is &bslash;n&quot;
l_string|&quot;connected. With this option, the detection can be overridden (1=CRT1 ON,&bslash;n&quot;
l_string|&quot; 0=CRT1 off) (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pdc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pdc
comma
l_string|&quot;&bslash;nThis is for manually selecting the LCD panel delay compensation. The driver&bslash;n&quot;
l_string|&quot;should detect this correctly in most cases; however, sometimes this is not&bslash;n&quot;
l_string|&quot;possible. If you see &squot;small waves&squot; on the LCD, try setting this to 4, 32 or 24&bslash;n&quot;
l_string|&quot;on a 300 series chipset; 3 or 51 on a 315 series chipset. If the problem persists,&bslash;n&quot;
l_string|&quot;try other values (on 300 series: between 4 and 60 in steps of 4; on 315 series:&bslash;n&quot;
l_string|&quot;and value from 0 to 255). (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noaccel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;&bslash;nIf set to anything other than 0, 2D acceleration will be disabled.&bslash;n&quot;
l_string|&quot;(default: 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noypan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noypan
comma
l_string|&quot;&bslash;nIf set to anything other than 0, y-panning will be disabled and scrolling&bslash;n&quot;
l_string|&quot;will be performed by redrawing the screen. (default: 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nomax
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomax
comma
l_string|&quot;&bslash;nIf y-panning is enabled, sisfb will by default use the entire available video&bslash;n&quot;
l_string|&quot;memory for the virtual screen in order to optimize scrolling performance. If this&bslash;n&quot;
l_string|&quot;is set to anything other than 0, sisfb will not do this and thereby enable the user&bslash;n&quot;
l_string|&quot;to positively specify a virtual Y size of the screen using fbset. (default: 0)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|MODULE_PARM
c_func
(paren
id|inverse
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|inverse
comma
l_string|&quot;&bslash;nSetting this to anything but 0 should invert the display colors, but this&bslash;n&quot;
l_string|&quot;does not seem to work. (default: 0)&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|MODULE_PARM
c_func
(paren
id|userom
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|userom
comma
l_string|&quot;&bslash;nSetting this to 0 keeps sisfb from using the video BIOS data which is needed&bslash;n&quot;
l_string|&quot;for some LCD and TV setup. (default: 1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|useoem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|useoem
comma
l_string|&quot;&bslash;nSetting this to 0 keeps sisfb from using its internel OEM data for some LCD&bslash;n&quot;
l_string|&quot;panels and TV connector types. (default: [auto])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tvstandard
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tvstandard
comma
l_string|&quot;&bslash;nThis allows overriding the BIOS default for the TV standard. Valid choices are&bslash;n&quot;
l_string|&quot;pal and ntsc. (default: [auto])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nocrt2rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nocrt2rate
comma
l_string|&quot;&bslash;nSetting this to 1 will force the driver to use the default refresh rate for&bslash;n&quot;
l_string|&quot;CRT2 if CRT2 type is VGA. (default: 0, use same rate as CRT1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|scalelcd
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|scalelcd
comma
l_string|&quot;&bslash;nSetting this to 1 will force the driver to scale the LCD image to the panel&squot;s&bslash;n&quot;
l_string|&quot;native resolution. Setting it to 0 will disable scaling; if the panel can scale&bslash;n&quot;
l_string|&quot;by itself, it will probably do this, otherwise you will see a black bar around&bslash;n&quot;
l_string|&quot;the screen image. Default: [autodetect if panel can scale]&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|specialtiming
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|lvdshl
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|SiS_Pr.UsePanelScaler
op_assign
op_minus
l_int|1
suffix:semicolon
id|SiS_Pr.SiS_CustomT
op_assign
id|CUT_NONE
suffix:semicolon
id|SiS_Pr.LVDSHL
op_assign
op_minus
l_int|1
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_parm_rate
op_assign
id|rate
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scalelcd
op_eq
l_int|0
)paren
op_logical_or
(paren
id|scalelcd
op_eq
l_int|1
)paren
)paren
(brace
id|SiS_Pr.UsePanelScaler
op_assign
id|scalelcd
op_xor
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|mode
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vesa
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|vesa
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
multiline_comment|/* For 2.4, set mode=none if no mode is given  */
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
multiline_comment|/* For 2.5, we don&squot;t need this &quot;mode=none&quot; stuff anymore */
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|forcecrt2type
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|forcecrt2type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tvstandard
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|tvstandard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|crt1off
op_eq
l_int|0
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sisfb_forcecrt1
op_assign
id|forcecrt1
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|0
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|1
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|0
)paren
(brace
id|sisfb_accel
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noypan
op_eq
l_int|1
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noypan
op_eq
l_int|0
)paren
(brace
id|sisfb_ypan
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nomax
op_eq
l_int|1
)paren
(brace
id|sisfb_max
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nomax
op_eq
l_int|0
)paren
(brace
id|sisfb_max
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
)brace
id|sisfb_fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|mem
)paren
(brace
id|sisfb_mem
op_assign
id|mem
suffix:semicolon
)brace
id|sisfb_userom
op_assign
id|userom
suffix:semicolon
id|sisfb_useoem
op_assign
id|useoem
suffix:semicolon
r_if
c_cond
(paren
id|queuemode
)paren
id|sisfb_search_queuemode
c_func
(paren
id|queuemode
)paren
suffix:semicolon
multiline_comment|/* If other queuemode than MMIO, disable 2D accel and ypan */
r_if
c_cond
(paren
(paren
id|sisfb_queuemode
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_ne
id|MMIO_CMD
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdc
)paren
(brace
id|sisfb_pdc
op_assign
id|pdc
op_amp
l_int|0x3c
suffix:semicolon
)brace
id|sisfb_nocrt2rate
op_assign
id|nocrt2rate
suffix:semicolon
r_if
c_cond
(paren
id|specialtiming
)paren
(brace
id|sisfb_search_specialtiming
c_func
(paren
id|specialtiming
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lvdshl
op_ge
l_int|0
)paren
op_logical_and
(paren
id|lvdshl
op_le
l_int|3
)paren
)paren
(brace
id|SiS_Pr.LVDSHL
op_assign
id|lvdshl
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Unmap */
id|iounmap
c_func
(paren
id|ivideo.video_vbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo.mmio_vbase
)paren
suffix:semicolon
multiline_comment|/* Release mem regions */
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
multiline_comment|/* Release MTRR region */
r_if
c_cond
(paren
id|ivideo.mtrr
)paren
(brace
id|mtrr_del
c_func
(paren
id|ivideo.mtrr
comma
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Unregister the framebuffer */
r_if
c_cond
(paren
id|sisfb_registered
)paren
(brace
id|unregister_framebuffer
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)) &amp;&amp; (defined(NEWFBDEV))
id|framebuffer_release
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#else
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|sishw_ext.pSR
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sishw_ext.pCR
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
)brace
multiline_comment|/* TODO: Restore the initial mode&n;&t; * This sounds easy but is as good as impossible&n;&t; * on many machines with SiS chip and video bridge&n;&t; * since text modes are always set up differently&n;&t; * from machine to machine. Depends on the type&n;&t; * of integration between chipset and bridge.&n;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Module unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|sis_malloc
id|EXPORT_SYMBOL
c_func
(paren
id|sis_malloc
)paren
suffix:semicolon
DECL|variable|sis_free
id|EXPORT_SYMBOL
c_func
(paren
id|sis_free
)paren
suffix:semicolon
DECL|variable|sis_dispinfo
id|EXPORT_SYMBOL
c_func
(paren
id|sis_dispinfo
)paren
suffix:semicolon
DECL|variable|ivideo
id|EXPORT_SYMBOL
c_func
(paren
id|ivideo
)paren
suffix:semicolon
eof
