multiline_comment|/*&n; * SiS 300/630/540/315H/315 frame buffer device For Kernal 2.4.x&n; *&n; * This driver is partly based on the VBE 2.0 compliant graphic &n; * boards framebuffer driver, which is &n; * &n; * (c) 1998 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n; *&n; */
singleline_comment|//#undef SISFBDEBUG
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sisfb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &quot;osdef.h&quot;
macro_line|#include &quot;vgatypes.h&quot;
macro_line|#include &quot;sis_main.h&quot;
multiline_comment|/* -------------------- Macro definitions ---------------------------- */
macro_line|#ifdef SISFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
DECL|macro|vgawb
mdefine_line|#define vgawb(reg,data) &bslash;&n;           (outb(data, ivideo.vga_base+reg))
DECL|macro|vgaww
mdefine_line|#define vgaww(reg,data) &bslash;&n;           (outw(data, ivideo.vga_base+reg))
DECL|macro|vgawl
mdefine_line|#define vgawl(reg,data) &bslash;&n;           (outl(data, ivideo.vga_base+reg))
DECL|macro|vgarb
mdefine_line|#define vgarb(reg)      &bslash;&n;           (inb(ivideo.vga_base+reg))
multiline_comment|/* --------------- Hardware Access Routines -------------------------- */
DECL|function|sisfb_set_reg1
r_void
id|sisfb_set_reg1
(paren
id|u16
id|port
comma
id|u16
id|index
comma
id|u16
id|data
)paren
(brace
id|outb
(paren
(paren
id|u8
)paren
(paren
id|index
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
id|outb
(paren
(paren
id|u8
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_set_reg3
r_void
id|sisfb_set_reg3
(paren
id|u16
id|port
comma
id|u16
id|data
)paren
(brace
id|outb
(paren
(paren
id|u8
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_set_reg4
r_void
id|sisfb_set_reg4
(paren
id|u16
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|outl
(paren
(paren
id|u32
)paren
(paren
id|data
op_amp
l_int|0xffffffff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg1
id|u8
id|sisfb_get_reg1
(paren
id|u16
id|port
comma
id|u16
id|index
)paren
(brace
id|u8
id|data
suffix:semicolon
id|outb
(paren
(paren
id|u8
)paren
(paren
id|index
op_amp
l_int|0xff
)paren
comma
id|port
)paren
suffix:semicolon
id|port
op_add_assign
l_int|1
suffix:semicolon
id|data
op_assign
id|inb
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg2
id|u8
id|sisfb_get_reg2
(paren
id|u16
id|port
)paren
(brace
id|u8
id|data
suffix:semicolon
id|data
op_assign
id|inb
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg3
id|u32
id|sisfb_get_reg3
(paren
id|u16
id|port
)paren
(brace
id|u32
id|data
suffix:semicolon
id|data
op_assign
id|inl
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------- Interface to BIOS code ---------------------------- */
DECL|function|sisfb_query_VGA_config_space
id|BOOLEAN
id|sisfb_query_VGA_config_space
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
id|DPRINTK
(paren
l_string|&quot;Get VGA offset 0x%lx&bslash;n&quot;
comma
id|offset
)paren
suffix:semicolon
r_else
id|DPRINTK
(paren
l_string|&quot;Set offset 0x%lx to 0x%lx&bslash;n&quot;
comma
id|offset
comma
op_star
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
id|pci_for_each_dev
(paren
id|pdev
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|ivideo.chip_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;Can&squot;t find SiS %d VGA device.&bslash;n&quot;
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_query_north_bridge_space
id|BOOLEAN
id|sisfb_query_north_bridge_space
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
id|u16
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_550
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pci_for_each_dev
(paren
id|pdev
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;Current: 0x%x, target: 0x%x&bslash;n&quot;
comma
id|pdev-&gt;device
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;Can&squot;t find SiS %d North Bridge device.&bslash;n&quot;
comma
id|nbridge_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* -------------------- Export functions ----------------------------- */
DECL|function|sis_get_glyph
r_static
r_void
id|sis_get_glyph
(paren
r_struct
id|fb_info
op_star
id|info
comma
id|SIS_GLYINFO
op_star
id|gly
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
suffix:semicolon
id|u16
id|c
suffix:semicolon
id|u8
op_star
id|cdat
suffix:semicolon
r_int
id|widthb
suffix:semicolon
id|u8
op_star
id|gbuf
op_assign
id|gly-&gt;gmask
suffix:semicolon
r_int
id|size
suffix:semicolon
id|gly-&gt;fontheight
op_assign
id|fontheight
(paren
id|p
)paren
suffix:semicolon
id|gly-&gt;fontwidth
op_assign
id|fontwidth
(paren
id|p
)paren
suffix:semicolon
id|widthb
op_assign
(paren
id|fontwidth
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|c
op_assign
id|gly-&gt;ch
op_amp
id|p-&gt;charmask
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
(paren
id|p
)paren
op_le
l_int|8
)paren
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|fontheight
(paren
id|p
)paren
suffix:semicolon
r_else
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|fontheight
(paren
id|p
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|size
op_assign
id|fontheight
(paren
id|p
)paren
op_star
id|widthb
suffix:semicolon
id|memcpy
(paren
id|gbuf
comma
id|cdat
comma
id|size
)paren
suffix:semicolon
id|gly-&gt;ngmask
op_assign
id|size
suffix:semicolon
)brace
DECL|function|sis_dispinfo
r_void
id|sis_dispinfo
(paren
r_struct
id|ap_data
op_star
id|rec
)paren
(brace
id|rec-&gt;minfo.bpp
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|rec-&gt;minfo.xres
op_assign
id|ivideo.video_width
suffix:semicolon
id|rec-&gt;minfo.yres
op_assign
id|ivideo.video_height
suffix:semicolon
id|rec-&gt;minfo.v_xres
op_assign
id|ivideo.video_vwidth
suffix:semicolon
id|rec-&gt;minfo.v_yres
op_assign
id|ivideo.video_vheight
suffix:semicolon
id|rec-&gt;minfo.org_x
op_assign
id|ivideo.org_x
suffix:semicolon
id|rec-&gt;minfo.org_y
op_assign
id|ivideo.org_y
suffix:semicolon
id|rec-&gt;minfo.vrate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
id|rec-&gt;iobase
op_assign
id|ivideo.vga_base
op_minus
l_int|0x30
suffix:semicolon
id|rec-&gt;mem_size
op_assign
id|ivideo.video_size
suffix:semicolon
id|rec-&gt;disp_state
op_assign
id|ivideo.disp_state
suffix:semicolon
id|rec-&gt;version
op_assign
(paren
id|VER_MAJOR
op_lshift
l_int|24
)paren
op_or
(paren
id|VER_MINOR
op_lshift
l_int|16
)paren
op_or
id|VER_LEVEL
suffix:semicolon
id|rec-&gt;hasVB
op_assign
id|ivideo.hasVB
suffix:semicolon
id|rec-&gt;TV_type
op_assign
id|ivideo.TV_type
suffix:semicolon
id|rec-&gt;TV_plug
op_assign
id|ivideo.TV_plug
suffix:semicolon
id|rec-&gt;chip
op_assign
id|ivideo.chip
suffix:semicolon
)brace
multiline_comment|/* ------------------ Internal Routines ------------------------------ */
DECL|function|sisfb_search_mode
r_static
r_void
id|sisfb_search_mode
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|name
comma
id|sisbios_mode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_mode_idx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
id|DPRINTK
(paren
l_string|&quot;Invalid user mode : %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_validate_mode
r_static
r_void
id|sisfb_validate_mode
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
)paren
(brace
r_case
id|LCD_1024x768
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|1024
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x1024
suffix:colon
r_case
id|LCD_1280x960
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|1280
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_2048x1536
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|2048
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1920x1440
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|1920
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1600x1200
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|1600
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_800x600
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|800
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_640x480
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
OG
l_int|640
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
l_int|720
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
)paren
(brace
r_case
l_int|800
suffix:colon
r_case
l_int|640
suffix:colon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_ne
l_int|480
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_ne
l_int|576
)paren
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/*karl */
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
l_int|32
)paren
id|sisfb_mode_idx
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_refresh_rate
r_static
id|u8
id|sisfb_search_refresh_rate
(paren
r_int
r_int
id|rate
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|xres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|yres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_rate_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_le
id|xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_eq
id|xres
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|yres
op_eq
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_eq
id|rate
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
OG
id|rate
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_minus
id|rate
)paren
op_le
l_int|2
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;Adjust rate from %d up to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Adjust rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_rate_idx
OG
l_int|0
)paren
(brace
r_return
id|sisfb_rate_idx
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
(paren
l_string|&quot;Unsupported rate %d for %dx%d mode&bslash;n&quot;
comma
id|rate
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sis_getcolreg
r_static
r_int
id|sis_getcolreg
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|vgawb
(paren
id|DAC_ADR
comma
id|regno
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC_DATA
comma
id|red
op_rshift
l_int|10
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC_DATA
comma
id|green
op_rshift
l_int|10
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC_DATA
comma
id|blue
op_rshift
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
id|vgawb
(paren
id|DAC2_ADR
comma
id|regno
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC2_DATA
comma
id|red
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC2_DATA
comma
id|green
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
(paren
id|DAC2_DATA
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|fbcon_cmap.cfb24
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_do_set_var
r_static
r_int
id|sisfb_do_set_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
r_int
r_int
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
r_float
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|old_mode
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
id|var-&gt;yres
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|htotal
op_logical_or
op_logical_neg
id|vtotal
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;Invalid &squot;var&squot; Information!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|drate
op_assign
l_float|1E12
op_div
id|var-&gt;pixclock
suffix:semicolon
id|hrate
op_assign
id|drate
op_div
id|htotal
suffix:semicolon
id|ivideo.refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_div
id|vtotal
op_star
l_int|2
op_plus
l_float|0.5
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;Chagne mode to %dx%dx%d-%dMHz&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|old_mode
op_assign
id|sisfb_mode_idx
suffix:semicolon
id|sisfb_mode_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_mode_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
id|sisfb_validate_mode
(paren
)paren
suffix:semicolon
r_else
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb does not support mode %dx%d-%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|old_mode
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_search_refresh_rate
(paren
id|ivideo.refresh_rate
)paren
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
op_logical_and
id|isactive
)paren
(brace
id|sisfb_pre_setmode
(paren
)paren
suffix:semicolon
singleline_comment|// Eden Chen
multiline_comment|/*&n;#ifdef CONFIG_FB_SIS_300&n;&t;&t;if (SiSSetMode(&amp;sishw_ext, sisfb_mode_no)) {&n;&t;&t;&t;DPRINTK(&quot;set mode[0x%x]: failed&bslash;n&quot;, sisfb_mode_no);&n;&t;&t;&t;return -1;&n;&t;&t;}&n;#endif&n;&n;#ifdef CONFIG_FB_SIS_315&n;&t;&t;if (SiSSetMode310(&amp;sishw_ext, sisfb_mode_no)) {&n;&t;&t;&t;DPRINTK(&quot;set mode[0x%x]: failed&bslash;n&quot;, sisfb_mode_no);&n;&t;&t;&t;return -1;&n;&t;&t;}&n;&n;#endif&n;*/
r_if
c_cond
(paren
id|SiSSetMode
(paren
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;set mode[0x%x]: failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
id|sisfb_post_setmode
(paren
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;Set New Mode : %dx%dx%d-%d &bslash;n&quot;
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_disp
r_static
r_void
id|sisfb_set_disp
(paren
r_int
id|con
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_struct
id|display_switch
op_star
id|sw
suffix:semicolon
id|u32
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_else
id|display
op_assign
op_amp
id|disp
suffix:semicolon
id|sisfb_get_fix
(paren
op_amp
id|fix
comma
id|con
comma
l_int|0
)paren
suffix:semicolon
id|display-&gt;screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|0
suffix:semicolon
id|display-&gt;inverse
op_assign
id|sisfb_inverse
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB24
r_case
l_int|24
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb24
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
(paren
op_amp
id|sisfb_sw
comma
id|sw
comma
r_sizeof
(paren
op_star
id|sw
)paren
)paren
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|sisfb_sw
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
)brace
DECL|function|sisfb_do_install_cmap
r_static
r_void
id|sisfb_do_install_cmap
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|info-&gt;currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
(paren
id|fb_default_cmap
(paren
id|video_cmap_len
)paren
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------- Chip-dependent Routines --------------------------- */
macro_line|#ifdef CONFIG_FB_SIS_300&t;/* for SiS 300/630/540/730 */
DECL|function|sisfb_get_dram_size_300
r_static
r_int
id|sisfb_get_dram_size_300
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
comma
id|reg
suffix:semicolon
id|u16
id|nbridge_id
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nbridge_id
op_eq
l_int|0
)paren
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|vgarb
(paren
id|SEQ_DATA
)paren
op_amp
id|SIS_DRAM_SIZE_MASK
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
id|pci_for_each_dev
(paren
id|pdev
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|nbridge_id
)paren
)paren
(brace
singleline_comment|//&amp;&amp; (pdev-&gt;device == PCI_DEVICE_ID_SI_630)) {
id|pci_read_config_byte
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|reg
op_assign
id|SIS_DATA_BUS_64
op_lshift
l_int|6
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_2MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_2MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_300
r_static
r_void
id|sisfb_detect_VB_connect_300
c_func
(paren
r_void
)paren
(brace
id|u8
id|sr16
comma
id|sr17
comma
id|cr32
comma
id|temp
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_17
)paren
suffix:semicolon
id|sr17
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR32
)paren
suffix:semicolon
id|cr32
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x0F
)paren
op_logical_and
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x01
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x0E
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x08
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x02
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x04
)paren
(brace
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x20
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x10
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_16
)paren
suffix:semicolon
id|sr16
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr16
op_amp
l_int|0x20
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
(brace
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
singleline_comment|// Eden Chen
singleline_comment|//temp = *((u8 *)(sishw_ext.VirtualRomBase+0x52));
singleline_comment|//if (temp&amp;0x40) {
singleline_comment|//      temp=*((u8 *)(sishw_ext.VirtualRomBase+0x53));
singleline_comment|//} else {
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_POWER_ON_TRAP
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
singleline_comment|//}
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type_300
r_static
r_void
id|sisfb_get_VB_type_300
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_has_VB_300
(paren
)paren
)paren
(brace
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR37
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS_EXTERNAL_CHIP_MASK
)paren
op_rshift
l_int|1
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_SIS301
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_TRUMPION
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_TRUMPION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|sisfb_has_VB_300
(paren
)paren
suffix:semicolon
)brace
singleline_comment|//sishw_ext.hasVB = ivideo.hasVB;
)brace
DECL|function|sisfb_has_VB_300
r_static
r_int
id|sisfb_has_VB_300
(paren
r_void
)paren
(brace
singleline_comment|// Eden Chen
singleline_comment|//u8 sr38, sr39, vb_chipid;
id|u8
id|vb_chipid
suffix:semicolon
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_POWER_ON_TRAP);
singleline_comment|//sr38 = vgarb(SEQ_DATA);
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_POWER_ON_TRAP2);
singleline_comment|//sr39 = vgarb(SEQ_DATA);
id|vgawb
(paren
id|VB_PART4_ADR
comma
l_int|0x0
)paren
suffix:semicolon
id|vb_chipid
op_assign
id|vgarb
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_303
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* CONFIG_FB_SIS_300 */
macro_line|#ifdef CONFIG_FB_SIS_315&t;/* for SiS 315H/315 */
DECL|function|sisfb_get_dram_size_315
r_static
r_int
id|sisfb_get_dram_size_315
(paren
r_void
)paren
(brace
macro_line|#ifdef LINUXBIOS
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
suffix:semicolon
macro_line|#endif
id|u8
id|reg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
)paren
(brace
macro_line|#ifdef LINUXBIOS
id|pci_for_each_dev
(paren
id|pdev
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SI
)paren
op_logical_and
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_550
)paren
)paren
(brace
id|pci_read_config_byte
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
op_amp
l_int|0xC0
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
singleline_comment|//case BRI_DRAM_SIZE_2MB:
singleline_comment|//      reg |= (SIS315_DRAM_SIZE_2MB &lt;&lt; 4); break;
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case BRI_DRAM_SIZE_128MB:&n;&t;&t;&t;&t;&t;   reg |= (SIS315_DRAM_SIZE_128MB &lt;&lt; 4); break; */
)brace
multiline_comment|/* TODO : set Dual channel and bus width bits here */
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|reg
op_amp
id|SIS550_DRAM_SIZE_MASK
)paren
(brace
r_case
id|SIS550_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_24MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_96MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x6000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_256MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x10000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_DRAM_SIZE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS315_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
)paren
(brace
r_case
id|SIS315_DRAM_SIZE_2MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|reg
op_and_assign
id|SIS315_DUAL_CHANNEL_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS315_SINGLE_CHANNEL_2_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DUAL_CHANNEL_1_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_315
r_static
r_void
id|sisfb_detect_VB_connect_315
(paren
r_void
)paren
(brace
id|u8
id|cr32
comma
id|temp
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR32
)paren
suffix:semicolon
id|cr32
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
(brace
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_POWER_ON_TRAP
)paren
suffix:semicolon
id|temp
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_VB_type_315
r_static
r_void
id|sisfb_get_VB_type_315
(paren
r_void
)paren
(brace
id|u8
id|vb_chipid
suffix:semicolon
id|vgawb
(paren
id|VB_PART4_ADR
comma
l_int|0x0
)paren
suffix:semicolon
id|vb_chipid
op_assign
id|vgarb
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_303
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
)brace
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.hasVB = ivideo.hasVB;
singleline_comment|// ~Eden Chen
)brace
macro_line|#endif&t;&t;&t;&t;/* CONFIG_FB_SIS_315 */
multiline_comment|/* --------------------- Heap Routines ------------------------------- */
DECL|function|sisfb_heap_init
r_static
r_int
id|sisfb_heap_init
(paren
r_void
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|u8
id|temp
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_int
id|agp_enabled
op_assign
l_int|1
suffix:semicolon
id|u32
id|agp_size
suffix:semicolon
r_int
r_int
op_star
id|cmdq_baseport
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|read_port
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|write_port
op_assign
l_int|0
suffix:semicolon
id|SIS_CMDTYPE
id|cmd_type
suffix:semicolon
macro_line|#ifndef AGPOFF
id|agp_kern_info
op_star
id|agp_info
suffix:semicolon
id|agp_memory
op_star
id|agp
suffix:semicolon
id|u32
id|agp_phys
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/*karl:10/01/2001 */
r_if
c_cond
(paren
op_logical_neg
id|sisfb_mem
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
l_int|0x800000
suffix:semicolon
r_else
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
l_int|0x400000
suffix:semicolon
)brace
r_else
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
(paren
id|ivideo.video_vbase
op_plus
id|sisfb_mem
op_star
l_int|0x100000
)paren
suffix:semicolon
id|sisfb_heap_end
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
id|ivideo.video_size
suffix:semicolon
id|sisfb_heap_size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|cmdq_baseport
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_PHYBASE
)paren
suffix:semicolon
id|write_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_WRITEPORT
)paren
suffix:semicolon
id|read_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_READPORT
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;AGP base: 0x%p, read: 0x%p, write: 0x%p&bslash;n&quot;
comma
id|cmdq_baseport
comma
id|read_port
comma
id|write_port
)paren
suffix:semicolon
id|agp_size
op_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
macro_line|#ifndef AGPOFF
id|agp_info
op_assign
id|vmalloc
(paren
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
id|memset
(paren
(paren
r_void
op_star
)paren
id|agp_info
comma
l_int|0x00
comma
r_sizeof
(paren
id|agp_kern_info
)paren
)paren
suffix:semicolon
id|agp_copy_info
(paren
id|agp_info
)paren
suffix:semicolon
id|agp_backend_acquire
(paren
)paren
suffix:semicolon
id|agp
op_assign
id|agp_allocate_memory
(paren
id|COMMAND_QUEUE_AREA_SIZE
op_div
id|PAGE_SIZE
comma
id|AGP_NORMAL_MEMORY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|agp
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;Allocate AGP buffer failed.&bslash;n&quot;
)paren
suffix:semicolon
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|agp_bind_memory
(paren
id|agp
comma
id|agp-&gt;pg_start
)paren
op_ne
l_int|0
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;AGP : can not bind memory&bslash;n&quot;
)paren
suffix:semicolon
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|agp_enable
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|agp_enabled
)paren
id|cmd_type
op_assign
id|AGP_CMD_QUEUE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|COMMAND_QUEUE_AREA_SIZE
)paren
id|cmd_type
op_assign
id|VM_CMD_QUEUE
suffix:semicolon
r_else
id|cmd_type
op_assign
id|MMIO_CMD
suffix:semicolon
r_switch
c_cond
(paren
id|agp_size
)paren
(brace
r_case
l_int|0x80000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_512k
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_1M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x200000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_2M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x400000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_4M
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd_type
)paren
(brace
r_case
id|AGP_CMD_QUEUE
suffix:colon
macro_line|#ifndef AGPOFF
id|DPRINTK
(paren
l_string|&quot;AGP buffer base:0x%lx, offset:0x%x, size is %dK&bslash;n&quot;
comma
id|agp_info-&gt;aper_base
comma
id|agp-&gt;physical
comma
id|agp_size
op_div
l_int|1024
)paren
suffix:semicolon
id|agp_phys
op_assign
id|agp_info-&gt;aper_base
op_plus
id|agp-&gt;physical
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_AGP_IO_PAD
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
l_int|0
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|SIS_AGP_2X
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_AGP_CMDQUEUE_ENABLE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|agp_phys
suffix:semicolon
id|sisfb_caps
op_or_assign
id|AGP_CMD_QUEUE_CAP
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|VM_CMD_QUEUE
suffix:colon
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_VRAM_CMDQUEUE_ENABLE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|VM_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;VM Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_CMDQUEUE_SET
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_MMIO_CMD_ENABLE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|TURBO_QUEUE_AREA_SIZE
)paren
(brace
r_int
r_int
id|tqueue_pos
suffix:semicolon
id|u8
id|tq_state
suffix:semicolon
id|tqueue_pos
op_assign
(paren
id|ivideo.video_size
op_minus
id|TURBO_QUEUE_AREA_SIZE
)paren
op_div
(paren
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_TURBOQUEUE_SET
)paren
suffix:semicolon
id|tq_state
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|tq_state
op_or_assign
l_int|0xf0
suffix:semicolon
id|tq_state
op_and_assign
l_int|0xfc
suffix:semicolon
id|tq_state
op_or_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|tq_state
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_TURBOQUEUE_ADR
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|temp
)paren
suffix:semicolon
id|sisfb_caps
op_or_assign
id|TURBO_QUEUE_CAP
suffix:semicolon
id|sisfb_heap_end
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;Turbo Queue: start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|TURBO_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|HW_CURSOR_AREA_SIZE
)paren
(brace
id|sisfb_heap_end
op_sub_assign
id|HW_CURSOR_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|HW_CURSOR_AREA_SIZE
suffix:semicolon
id|sisfb_hwcursor_vbase
op_assign
id|sisfb_heap_end
suffix:semicolon
id|sisfb_caps
op_or_assign
id|HW_CURSOR_CAP
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;Hardware Cursor: start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|HW_CURSOR_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
)brace
id|sisfb_heap.poha_chain
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
l_int|NULL
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_new_node
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|poh-&gt;poh_next
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
op_plus
l_int|1
suffix:semicolon
id|poh-&gt;offset
op_assign
id|sisfb_heap_start
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;sisfb:Heap start:0x%p, end:0x%p, len=%dk&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_start
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_end
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;sisfb:First Node offset:0x%x, size:%dk&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|poh-&gt;offset
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|sisfb_heap.oh_free.poh_next
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.poh_prev
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.size
op_assign
l_int|0
suffix:semicolon
id|sisfb_heap.max_freesize
op_assign
id|poh-&gt;size
suffix:semicolon
id|sisfb_heap.oh_used.poh_next
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.poh_prev
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.size
op_assign
id|SENTINEL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_poh_new_node
r_static
id|SIS_OH
op_star
id|sisfb_poh_new_node
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|cOhs
suffix:semicolon
id|SIS_OHALLOC
op_star
id|poha
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap.poh_freelist
op_eq
l_int|NULL
)paren
(brace
id|poha
op_assign
id|kmalloc
(paren
id|OH_ALLOC_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|poha-&gt;poha_next
op_assign
id|sisfb_heap.poha_chain
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
id|poha
suffix:semicolon
id|cOhs
op_assign
(paren
id|OH_ALLOC_SIZE
op_minus
r_sizeof
(paren
id|SIS_OHALLOC
)paren
)paren
op_div
r_sizeof
(paren
id|SIS_OH
)paren
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cOhs
op_minus
l_int|1
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|poh-&gt;poh_next
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh-&gt;poh_next
suffix:semicolon
r_return
(paren
id|poh
)paren
suffix:semicolon
)brace
DECL|function|sisfb_poh_allocate
r_static
id|SIS_OH
op_star
id|sisfb_poh_allocate
(paren
r_int
r_int
id|size
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|pohRoot
suffix:semicolon
r_int
id|bAllocated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|sisfb_heap.max_freesize
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|pohThis-&gt;size
)paren
(brace
id|bAllocated
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|bAllocated
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|pohThis-&gt;size
)paren
(brace
id|pohRoot
op_assign
id|pohThis
suffix:semicolon
id|sisfb_delete_node
(paren
id|pohThis
)paren
suffix:semicolon
)brace
r_else
(brace
id|pohRoot
op_assign
id|sisfb_poh_new_node
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pohRoot
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohRoot-&gt;offset
op_assign
id|pohThis-&gt;offset
suffix:semicolon
id|pohRoot-&gt;size
op_assign
id|size
suffix:semicolon
id|pohThis-&gt;offset
op_add_assign
id|size
suffix:semicolon
id|pohThis-&gt;size
op_sub_assign
id|size
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_sub_assign
id|size
suffix:semicolon
id|pohThis
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_insert_node
(paren
id|pohThis
comma
id|pohRoot
)paren
suffix:semicolon
r_return
(paren
id|pohRoot
)paren
suffix:semicolon
)brace
DECL|function|sisfb_delete_node
r_static
r_void
id|sisfb_delete_node
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|poh_prev
op_assign
id|poh-&gt;poh_prev
suffix:semicolon
id|poh_next
op_assign
id|poh-&gt;poh_next
suffix:semicolon
id|poh_prev-&gt;poh_next
op_assign
id|poh_next
suffix:semicolon
id|poh_next-&gt;poh_prev
op_assign
id|poh_prev
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|sisfb_insert_node
r_static
r_void
id|sisfb_insert_node
(paren
id|SIS_OH
op_star
id|pohList
comma
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|pohTemp
suffix:semicolon
id|pohTemp
op_assign
id|pohList-&gt;poh_next
suffix:semicolon
id|pohList-&gt;poh_next
op_assign
id|poh
suffix:semicolon
id|pohTemp-&gt;poh_prev
op_assign
id|poh
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
id|pohList
suffix:semicolon
id|poh-&gt;poh_next
op_assign
id|pohTemp
suffix:semicolon
)brace
DECL|function|sisfb_poh_free
r_static
id|SIS_OH
op_star
id|sisfb_poh_free
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|poh_freed
suffix:semicolon
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
r_int
r_int
id|ulUpper
suffix:semicolon
r_int
r_int
id|ulLower
suffix:semicolon
r_int
id|foundNode
op_assign
l_int|0
suffix:semicolon
id|poh_freed
op_assign
id|sisfb_heap.oh_used.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|poh_freed
op_ne
op_amp
id|sisfb_heap.oh_used
)paren
(brace
r_if
c_cond
(paren
id|poh_freed-&gt;offset
op_eq
id|base
)paren
(brace
id|foundNode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|poh_freed
op_assign
id|poh_freed-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|foundNode
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
id|sisfb_heap.max_freesize
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_prev
op_assign
id|poh_next
op_assign
l_int|NULL
suffix:semicolon
id|ulUpper
op_assign
id|poh_freed-&gt;offset
op_plus
id|poh_freed-&gt;size
suffix:semicolon
id|ulLower
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|pohThis-&gt;offset
op_eq
id|ulUpper
)paren
(brace
id|poh_next
op_assign
id|pohThis
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pohThis-&gt;offset
op_plus
id|pohThis-&gt;size
)paren
op_eq
id|ulLower
)paren
(brace
id|poh_prev
op_assign
id|pohThis
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
id|sisfb_delete_node
(paren
id|poh_freed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh_prev
op_logical_and
id|poh_next
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
(paren
id|poh_freed-&gt;size
op_plus
id|poh_next-&gt;size
)paren
suffix:semicolon
id|sisfb_delete_node
(paren
id|poh_next
)paren
suffix:semicolon
id|sisfb_free_node
(paren
id|poh_freed
)paren
suffix:semicolon
id|sisfb_free_node
(paren
id|poh_next
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_prev
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|sisfb_free_node
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_next
)paren
(brace
id|poh_next-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_next-&gt;offset
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|sisfb_free_node
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_next
)paren
suffix:semicolon
)brace
id|sisfb_insert_node
(paren
op_amp
id|sisfb_heap.oh_free
comma
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_freed
)paren
suffix:semicolon
)brace
DECL|function|sisfb_free_node
r_static
r_void
id|sisfb_free_node
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|sis_malloc
r_void
id|sis_malloc
(paren
r_struct
id|sis_memreq
op_star
id|req
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_allocate
(paren
id|req-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|req-&gt;offset
op_assign
l_int|0
suffix:semicolon
id|req-&gt;size
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;sisfb: VMEM Allocation Failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb: VMEM Allocation Successed : 0x%p&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|poh-&gt;offset
op_plus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
)paren
)paren
suffix:semicolon
id|req-&gt;offset
op_assign
id|poh-&gt;offset
suffix:semicolon
id|req-&gt;size
op_assign
id|poh-&gt;size
suffix:semicolon
)brace
)brace
DECL|function|sis_free
r_void
id|sis_free
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_free
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb: sisfb_poh_free() failed at base 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------ SetMode Routines ------------------------------- */
DECL|function|sisfb_pre_setmode
r_static
r_void
id|sisfb_pre_setmode
(paren
r_void
)paren
(brace
id|u8
id|cr30
op_assign
l_int|0
comma
id|cr31
op_assign
l_int|0
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x31
)paren
suffix:semicolon
id|cr31
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
op_amp
op_complement
l_int|0x60
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_CRT2
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_CRT2
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_LCD
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_LCD
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_HIVISION
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_HIVISION
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SVIDEO
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_COMPOSITE
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SCART
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SCART
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
multiline_comment|/*karl */
r_if
c_cond
(paren
id|sisfb_tvmode
op_eq
l_int|1
)paren
id|cr31
op_or_assign
l_int|0x1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_tvmode
op_eq
l_int|2
)paren
id|cr31
op_and_assign
op_complement
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cr30
op_assign
l_int|0x00
suffix:semicolon
id|cr31
op_or_assign
(paren
id|SIS_DRIVER_MODE
op_or
id|SIS_VB_OUTPUT_DISABLE
)paren
suffix:semicolon
)brace
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR30
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|cr30
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR31
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|cr31
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_SCRATCH_REG_CR33
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|sisfb_rate_idx
op_amp
l_int|0x0F
)paren
suffix:semicolon
)brace
DECL|function|sisfb_post_setmode
r_static
r_void
id|sisfb_post_setmode
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS
)paren
op_logical_or
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
)paren
)paren
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
id|reg
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|reg
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_RAMDAC_CONTROL
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
l_int|0x04
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_TV
)paren
op_logical_and
(paren
id|ivideo.hasVB
op_eq
id|HASVB_301
)paren
)paren
(brace
multiline_comment|/*karl */
id|vgawb
(paren
id|VB_PART4_ADR
comma
l_int|0x01
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_ne
l_int|0xB1
)paren
op_logical_and
(paren
id|reg
op_ne
l_int|0xB0
)paren
)paren
(brace
multiline_comment|/*301B Revision ID */
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|320
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|filter
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// ~Eden Chen
singleline_comment|// Eden Chen
singleline_comment|//vgawb(VB_PART1_ADR,  0x24);
id|vgawb
(paren
id|VB_PART1_ADR
comma
id|IND_SIS_CRT2_WRITE_ENABLE
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
id|vgawb
(paren
id|VB_PART1_DATA
comma
l_int|0x1
)paren
suffix:semicolon
singleline_comment|// Eden Chen for Debug
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x1F
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xDF
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x20
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xEB
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x04
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x25
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xEE
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x0C
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x22
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xEB
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x15
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x25
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xF6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x1F
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xDF
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x30
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART2_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x20
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xF1
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xF7
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x1F
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xF3
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x00
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x1D
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xFC
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0xFB
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x14
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
l_int|0x2A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
singleline_comment|// Eden 
r_if
c_cond
(paren
(paren
id|filter
op_ge
l_int|0
)paren
op_logical_and
(paren
id|filter
op_le
l_int|7
)paren
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;FilterTable[%d]-%d: %02x %02x %02x %02x&bslash;n&quot;
comma
id|filter_tb
comma
id|filter
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x35
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x36
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_ADR
comma
l_int|0x38
)paren
suffix:semicolon
id|vgawb
(paren
id|VB_PART2_DATA
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
singleline_comment|// ~Eden 
)brace
)brace
)brace
DECL|function|sisfb_crtc_to_var
r_static
r_void
id|sisfb_crtc_to_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u16
id|VRE
comma
id|VBE
comma
id|VRS
comma
id|VBS
comma
id|VDE
comma
id|VT
suffix:semicolon
id|u16
id|HRE
comma
id|HBE
comma
id|HRS
comma
id|HBS
comma
id|HDE
comma
id|HT
suffix:semicolon
id|u8
id|sr_data
comma
id|cr_data
comma
id|cr_data2
comma
id|cr_data3
comma
id|mr_data
suffix:semicolon
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|F
comma
id|temp
suffix:semicolon
r_float
id|hrate
comma
id|drate
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_COLOR_MODE
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr_data
op_amp
id|SIS_INTERLACED_MODE
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|sr_data
op_amp
l_int|0x1C
)paren
op_rshift
l_int|2
)paren
(brace
r_case
id|SIS_8BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_16BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_32BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|6
suffix:semicolon
id|video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0xA
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x6
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x7
)paren
suffix:semicolon
id|cr_data2
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VT
op_assign
(paren
id|cr_data
op_amp
l_int|0xFF
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x01
)paren
op_lshift
l_int|10
)paren
suffix:semicolon
id|A
op_assign
id|VT
op_plus
l_int|2
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x12
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x40
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x02
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|E
op_assign
id|VDE
op_plus
l_int|1
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x10
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x04
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x08
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|F
op_assign
id|VRS
op_plus
l_int|1
op_minus
id|E
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x15
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x9
)paren
suffix:semicolon
id|cr_data3
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x08
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data3
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x16
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VBE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_assign
id|VBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|511
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|512
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x11
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|VRE
op_assign
(paren
id|cr_data
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x20
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|VRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_minus
l_int|1
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|32
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
op_assign
id|E
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|D
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|F
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|C
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0xb
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x0
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HT
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|A
op_assign
id|HT
op_plus
l_int|5
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x1
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x0C
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|E
op_assign
id|HDE
op_plus
l_int|1
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x4
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0xC0
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|F
op_assign
id|HRS
op_minus
id|E
op_minus
l_int|3
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x2
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0xc
)paren
suffix:semicolon
id|sr_data
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x3
)paren
suffix:semicolon
id|cr_data
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x5
)paren
suffix:semicolon
id|cr_data2
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
id|HBE
op_assign
(paren
id|cr_data
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|HRE
op_assign
(paren
id|cr_data2
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|temp
op_assign
id|HBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|256
)paren
suffix:semicolon
id|temp
op_assign
id|HRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_plus
l_int|3
)paren
op_amp
l_int|63
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|64
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|E
op_star
l_int|8
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|D
op_star
l_int|8
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|F
op_star
l_int|8
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|C
op_star
l_int|8
suffix:semicolon
id|var-&gt;activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|mr_data
op_assign
id|vgarb
(paren
l_int|0x1C
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x80
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x40
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
id|VT
op_add_assign
l_int|2
suffix:semicolon
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
id|HT
op_assign
(paren
id|HT
op_plus
l_int|5
)paren
op_star
l_int|8
suffix:semicolon
id|hrate
op_assign
(paren
r_float
)paren
id|ivideo.refresh_rate
op_star
(paren
r_float
)paren
id|VT
op_div
l_int|2
suffix:semicolon
id|drate
op_assign
id|hrate
op_star
id|HT
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_float|1E12
op_div
id|drate
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------ Public Routines -------------------------------- */
DECL|function|sisfb_get_fix
r_static
r_int
id|sisfb_get_fix
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|memset
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
(paren
id|fix-&gt;id
comma
id|fb_info.modename
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|ivideo.video_base
suffix:semicolon
multiline_comment|/*karl:10/01/2001 */
r_if
c_cond
(paren
op_logical_neg
id|sisfb_mem
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
id|fix-&gt;smem_len
op_assign
l_int|0x800000
suffix:semicolon
r_else
id|fix-&gt;smem_len
op_assign
l_int|0x400000
suffix:semicolon
)brace
r_else
id|fix-&gt;smem_len
op_assign
id|sisfb_mem
op_star
l_int|0x100000
suffix:semicolon
id|fix-&gt;type
op_assign
id|video_type
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|video_linelength
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|ivideo.mmio_base
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|sisfb_mmio_size
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|0
)braket
op_assign
id|ivideo.video_size
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|1
)braket
op_assign
(paren
id|ivideo.video_size
op_rshift
l_int|16
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|2
)braket
op_assign
id|sisfb_caps
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_var
r_static
r_int
id|sisfb_get_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|memcpy
(paren
id|var
comma
op_amp
id|default_var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_var
r_static
r_int
id|sisfb_set_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
id|cols
comma
id|rows
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_do_set_var
(paren
id|var
comma
id|con
op_eq
id|info-&gt;currcon
comma
id|info
)paren
)paren
(brace
id|sisfb_crtc_to_var
(paren
id|var
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_crtc_to_var
(paren
id|var
)paren
suffix:semicolon
id|sisfb_set_disp
(paren
id|con
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;changevar
)paren
(paren
op_star
id|info-&gt;changevar
)paren
(paren
id|con
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|sisfb_do_install_cmap
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap
r_static
r_int
id|sisfb_get_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
r_return
id|fb_get_cmap
(paren
id|cmap
comma
id|kspc
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_copy_cmap
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
(paren
id|fb_default_cmap
(paren
id|video_cmap_len
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_cmap
r_static
r_int
id|sisfb_set_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|err
op_assign
id|fb_alloc_cmap
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|video_cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
r_return
id|fb_set_cmap
(paren
id|cmap
comma
id|kspc
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
(paren
id|cmap
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_ioctl
r_static
r_int
id|sisfb_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_malloc
(paren
(paren
r_struct
id|sis_memreq
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_free
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_GLYPH
suffix:colon
id|sis_get_glyph
(paren
id|info
comma
(paren
id|SIS_GLYINFO
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_HWCINFO
suffix:colon
(brace
r_int
r_int
op_star
id|hwc_offset
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_caps
op_amp
id|HW_CURSOR_CAP
)paren
op_star
id|hwc_offset
op_assign
id|sisfb_hwcursor_vbase
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
r_else
op_star
id|hwc_offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOPUT_MODEINFO
suffix:colon
(brace
r_struct
id|mode_info
op_star
id|x
op_assign
(paren
r_struct
id|mode_info
op_star
)paren
id|arg
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|x-&gt;bpp
suffix:semicolon
id|ivideo.video_width
op_assign
id|x-&gt;xres
suffix:semicolon
id|ivideo.video_height
op_assign
id|x-&gt;yres
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|x-&gt;v_xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|x-&gt;v_yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|x-&gt;org_x
suffix:semicolon
id|ivideo.org_y
op_assign
id|x-&gt;org_y
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|x-&gt;vrate
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOGET_DISPINFO
suffix:colon
id|sis_dispinfo
(paren
(paren
r_struct
id|ap_data
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
id|sisfb_get_var
(paren
op_amp
id|var
comma
id|info-&gt;currcon
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var.accel_flags
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
macro_line|#if defined(__i386__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|sisfb_get_fix
comma
id|fb_get_var
suffix:colon
id|sisfb_get_var
comma
id|fb_set_var
suffix:colon
id|sisfb_set_var
comma
id|fb_get_cmap
suffix:colon
id|sisfb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|sisfb_set_cmap
comma
id|fb_setcolreg
suffix:colon
id|sisfb_setcolreg
comma
id|fb_blank
suffix:colon
id|sisfb_blank
comma
id|fb_ioctl
suffix:colon
id|sisfb_ioctl
comma
id|fb_mmap
suffix:colon
id|sisfb_mmap
comma
)brace
suffix:semicolon
multiline_comment|/* ------------ Interface to the low level console driver -------------*/
DECL|function|sisfb_update_var
r_static
r_int
id|sisfb_update_var
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_switch
r_static
r_int
id|sisfb_switch
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|cols
comma
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap.len
)paren
id|fb_get_cmap
(paren
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
id|sisfb_do_set_var
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sisfb_set_disp
(paren
id|con
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
id|sisfb_do_install_cmap
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|sisfb_update_var
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_int
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
l_int|0
)paren
id|reg
op_and_assign
l_int|0x7f
suffix:semicolon
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x17
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
id|reg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_setup
r_int
id|sisfb_setup
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
id|fb_info.fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
id|fb_invert_cmaps
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|strcpy
(paren
id|fb_info.fontname
comma
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
(paren
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;vrate:&quot;
comma
l_int|6
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;crt1off&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;filter:&quot;
comma
l_int|7
)paren
)paren
(brace
id|filter
op_assign
(paren
r_int
)paren
id|simple_strtoul
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*karl */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;tvmode:&quot;
comma
l_int|7
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
op_plus
l_int|7
comma
l_string|&quot;pal&quot;
comma
l_int|3
)paren
)paren
id|sisfb_tvmode
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
op_plus
l_int|7
comma
l_string|&quot;ntsc&quot;
comma
l_int|4
)paren
)paren
id|sisfb_tvmode
op_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/*karl:10/01/2001 */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;mem:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_mem
op_assign
id|simple_strtoul
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|DPRINTK
(paren
l_string|&quot;invalid parameter %s&bslash;n&quot;
comma
id|this_opt
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_init
r_int
id|__init
id|sisfb_init
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|board
op_star
id|b
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
singleline_comment|//unsigned long rom_vbase;
id|u32
id|reg32
suffix:semicolon
id|u16
id|reg16
suffix:semicolon
id|u8
id|reg
suffix:semicolon
r_int
id|nRes
suffix:semicolon
id|outb
(paren
l_int|0x77
comma
l_int|0x80
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_off
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|pci_for_each_dev
(paren
id|pdev
)paren
(brace
r_for
c_loop
(paren
id|b
op_assign
id|sisdev_list
suffix:semicolon
id|b-&gt;vendor
suffix:semicolon
id|b
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|b-&gt;vendor
op_eq
id|pdev-&gt;vendor
)paren
op_logical_and
(paren
id|b-&gt;device
op_eq
id|pdev-&gt;device
)paren
)paren
(brace
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|strcpy
(paren
id|fb_info.modename
comma
id|b-&gt;name
)paren
suffix:semicolon
id|ivideo.chip_id
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pci_read_config_byte
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|ivideo.revision_id
)paren
suffix:semicolon
id|pci_read_config_word
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|reg16
)paren
suffix:semicolon
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.uRevisionID = ivideo.revision_id;
id|sishw_ext.jChipRevision
op_assign
id|ivideo.revision_id
suffix:semicolon
singleline_comment|// ~Eden Chen
id|sisvga_enabled
op_assign
id|reg16
op_amp
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pdev_valid
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|ivideo.chip_id
)paren
(brace
r_case
id|PCI_DEVICE_ID_SI_300
suffix:colon
id|ivideo.chip
op_assign
id|SIS_300
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_630_VGA
suffix:colon
(brace
id|sisfb_set_reg4
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07301039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_730
suffix:semicolon
id|strcpy
(paren
id|fb_info.modename
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
)brace
r_else
id|ivideo.chip
op_assign
id|SIS_630
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_540_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_540
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315H
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315H
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315PRO
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315PRO
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_550_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_550
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.jChipID = ivideo.chip;
id|sishw_ext.jChipType
op_assign
id|ivideo.chip
suffix:semicolon
singleline_comment|// for Debug
r_if
c_cond
(paren
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315
)paren
)paren
id|sishw_ext.jChipType
op_assign
id|SIS_315H
suffix:semicolon
singleline_comment|// ~Eden Chen
id|DPRINTK
(paren
l_string|&quot;%s is used as %s device(VGA Engine %d).&bslash;n&quot;
comma
id|fb_info.modename
comma
id|sisvga_enabled
ques
c_cond
l_string|&quot;primary&quot;
suffix:colon
l_string|&quot;secondary&quot;
comma
id|sisvga_engine
)paren
suffix:semicolon
id|ivideo.video_base
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|ivideo.mmio_base
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.IOAddress = (unsigned short) ivideo.vga_base 
singleline_comment|//      = pci_resource_start(pdev, 2) + 0x30;
id|sishw_ext.ulIOAddress
op_assign
(paren
r_int
r_int
)paren
id|ivideo.vga_base
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|2
)paren
op_plus
l_int|0x30
suffix:semicolon
singleline_comment|// ~Eden Chen
id|sisfb_mmio_size
op_assign
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
r_if
c_cond
(paren
id|pci_enable_device
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
macro_line|#ifdef LINUXBIOS
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x28
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
l_int|0x37
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x29
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
l_int|0x61
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_1A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_SCRATCH_REG_1A_MASK
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
)paren
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x28
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
l_int|0x5A
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x29
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
l_int|0x64
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_ADR
comma
l_int|0x3A
)paren
suffix:semicolon
id|vgawb
(paren
id|CRTC_DATA
comma
l_int|0x00
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_315H
suffix:colon
r_case
id|SIS_315
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
singleline_comment|// Eden Chen
singleline_comment|//vgawb(SEQ_ADR, IND_SIS_SCRATCH_REG_1A);
singleline_comment|//reg = vgarb(SEQ_DATA);
singleline_comment|//if (reg &amp; SIS_SCRATCH_REG_1A_MASK)
singleline_comment|//      sishw_ext.bIntegratedMMEnabled = TRUE;
singleline_comment|//else
singleline_comment|//      sishw_ext.bIntegratedMMEnabled = FALSE;
singleline_comment|//for Debug
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
singleline_comment|// ~Eden Chen
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_SCRATCH_REG_1A
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|SIS_SCRATCH_REG_1A_MASK
)paren
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_else
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
singleline_comment|// Eden Chen
id|sishw_ext.pDevice
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.pjVirtualRomBase
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.pjCustomizedROMImage
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
l_int|0
suffix:semicolon
id|sishw_ext.pQueryVGAConfigSpace
op_assign
op_amp
id|sisfb_query_VGA_config_space
suffix:semicolon
id|sishw_ext.pQueryNorthBridgeSpace
op_assign
op_amp
id|sisfb_query_north_bridge_space
suffix:semicolon
id|strcpy
(paren
id|sishw_ext.szVBIOSVer
comma
l_string|&quot;0.84&quot;
)paren
suffix:semicolon
id|sishw_ext.pSR
op_assign
id|vmalloc
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|SR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pSR
op_eq
l_int|NULL
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;Allocated SRReg space fail.&bslash;n&quot;
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pCR
op_assign
id|vmalloc
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|CR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pCR
op_eq
l_int|NULL
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;Allocated CRReg space fail.&bslash;n&quot;
)paren
suffix:semicolon
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
singleline_comment|// ~Eden Chen
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
singleline_comment|// Eden Chen
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
(paren
id|ivideo.video_base
comma
l_int|0x2000000
)paren
suffix:semicolon
singleline_comment|//SiSInit300(&amp;sishw_ext);
id|SiSInit
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
singleline_comment|// Eden Chen
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
(paren
id|ivideo.video_base
comma
l_int|0x2000000
)paren
suffix:semicolon
singleline_comment|//SiSInit300(&amp;sishw_ext);
id|SiSInit
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
)brace
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x7
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x10
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
macro_line|#endif
id|sisfb_get_dram_size_300
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 315 Init */
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.VirtualVideoMemoryAddress 
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
singleline_comment|//SiSInit310(&amp;sishw_ext);
id|SiSInit
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x13
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x14
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
singleline_comment|// Eden Chen
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
id|SiSInit
(paren
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x13
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
l_int|0x14
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
macro_line|#endif
id|sisfb_get_dram_size_315
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|//Eden Chen 
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PCI_ADDRESS_SET
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_PCI_ADDR_ENABLE
suffix:semicolon
id|reg
op_or_assign
id|SIS_MEM_MAP_IO_ENABLE
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_MODULE_ENABLE
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|SEQ_DATA
)paren
suffix:semicolon
id|reg
op_or_assign
id|SIS_ENABLE_2D
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|reg
)paren
suffix:semicolon
singleline_comment|//~Eden Chen
singleline_comment|// Eden Chen
id|sishw_ext.ulVideoMemorySize
op_assign
id|ivideo.video_size
suffix:semicolon
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
comma
l_string|&quot;sisfb FB&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;sisfb: cannot reserve frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
comma
l_string|&quot;sisfb MMIO&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;sisfb: cannot reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
singleline_comment|// Eden Chen
singleline_comment|//sishw_ext.VirtualVideoMemoryAddress = ivideo.video_vbase 
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ivideo.video_vbase
op_assign
id|ioremap
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
singleline_comment|// Eden Chen
id|ivideo.mmio_vbase
op_assign
id|ioremap
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;sisfb: framebuffer at 0x%lx, mapped to 0x%p, size %dk&bslash;n&quot;
comma
id|ivideo.video_base
comma
id|ivideo.video_vbase
comma
id|ivideo.video_size
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;sisfb: MMIO at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo.mmio_base
comma
id|ivideo.mmio_vbase
comma
id|sisfb_mmio_size
op_div
l_int|1024
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_get_VB_type_300
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
id|sisfb_detect_VB_connect_300
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|sisfb_get_VB_type_315
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
id|sisfb_detect_VB_connect_315
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
singleline_comment|// Eden Chen
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_UNKNOWN
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.hasVB
)paren
(brace
r_case
id|HASVB_301
suffix:colon
multiline_comment|/*karl */
id|vgawb
(paren
id|VB_PART4_ADR
comma
l_int|0x01
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|VB_PART4_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_ne
l_int|0xB1
)paren
op_logical_and
(paren
id|reg
op_ne
l_int|0xB0
)paren
)paren
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301
suffix:semicolon
r_else
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301B
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_302
suffix:colon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_303
suffix:colon
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_303
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_LVDS
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_TRUMPION
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_LVDS_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
singleline_comment|// ~Eden Chen
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
id|ivideo.disp_state
op_or_assign
id|DISPMODE_SINGLE
suffix:semicolon
r_else
id|ivideo.disp_state
op_or_assign
(paren
id|DISPMODE_MIRROR
op_or
id|DISPTYPE_CRT1
)paren
suffix:semicolon
)brace
r_else
id|ivideo.disp_state
op_assign
id|DISPMODE_SINGLE
op_or
id|DISPTYPE_CRT1
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_LCD
)paren
(brace
id|vgawb
(paren
id|CRTC_ADR
comma
id|IND_SIS_LCD_PANEL
)paren
suffix:semicolon
id|reg
op_assign
id|vgarb
(paren
id|CRTC_DATA
)paren
suffix:semicolon
singleline_comment|// Eden Chen
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS_LCD_PANEL_800X600
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_800x600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_LCD_PANEL_1024X768
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_1024x768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_LCD_PANEL_1280X1024
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_1280x1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_LCD_PANEL_640X480
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_640x480
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_LCD_PANEL_1280X960
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_1280x960
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_1024x768
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// ~Eden Chen
)brace
r_if
c_cond
(paren
id|sisfb_mode_idx
op_ge
l_int|0
)paren
id|sisfb_validate_mode
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_LCDMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_TVMODE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.refresh_rate
op_ne
l_int|0
)paren
id|sisfb_search_refresh_rate
(paren
id|ivideo.refresh_rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_rate_idx
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;sisfb: mode is %dx%dx%d, linelength=%d&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|video_linelength
)paren
suffix:semicolon
singleline_comment|// Eden Chen
singleline_comment|// Check interface correction  For Debug
id|DPRINTK
(paren
l_string|&quot;VM Adr=0x%p&bslash;n&quot;
comma
id|sishw_ext.pjVideoMemoryAddress
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;VM Size=%ldK&bslash;n&quot;
comma
id|sishw_ext.ulVideoMemorySize
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;IO Adr=0x%lx&bslash;n&quot;
comma
id|sishw_ext.ulIOAddress
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;Chip=%d&bslash;n&quot;
comma
id|sishw_ext.jChipType
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ChipRevision=%d&bslash;n&quot;
comma
id|sishw_ext.jChipRevision
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;VBChip=%d&bslash;n&quot;
comma
id|sishw_ext.ujVBChipID
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ExtVB=%d&bslash;n&quot;
comma
id|sishw_ext.usExternalChip
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;LCD=%ld&bslash;n&quot;
comma
id|sishw_ext.ulCRT2LCDType
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;bIntegratedMMEnabled=%d&bslash;n&quot;
comma
id|sishw_ext.bIntegratedMMEnabled
)paren
suffix:semicolon
singleline_comment|// ~Eden Chen
id|sisfb_pre_setmode
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
(paren
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;set mode[0x%x]: failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vgawb
(paren
id|SEQ_ADR
comma
id|IND_SIS_PASSWORD
)paren
suffix:semicolon
id|vgawb
(paren
id|SEQ_DATA
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
singleline_comment|// Eden Chen
id|sisfb_post_setmode
(paren
)paren
suffix:semicolon
id|sisfb_crtc_to_var
(paren
op_amp
id|default_var
)paren
suffix:semicolon
id|fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fb_info.node
op_assign
id|NODEV
suffix:semicolon
id|fb_info.fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|fb_info.disp
op_assign
op_amp
id|disp
suffix:semicolon
id|fb_info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|fb_info.switch_con
op_assign
op_amp
id|sisfb_switch
suffix:semicolon
id|fb_info.updatevar
op_assign
op_amp
id|sisfb_update_var
suffix:semicolon
id|fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sisfb_set_disp
(paren
op_minus
l_int|1
comma
op_amp
id|default_var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap_init
(paren
)paren
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;sisfb: Failed to enable offscreen heap&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*H.C. */
id|nRes
op_assign
id|mtrr_add
(paren
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
id|vc_resize_con
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
(paren
op_amp
id|fb_info
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|GET_FB_IDX
(paren
id|fb_info.node
)paren
comma
id|fb_info.modename
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|rate
r_static
r_int
r_int
id|rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|crt1
r_static
r_int
r_int
id|crt1
op_assign
l_int|1
suffix:semicolon
id|MODULE_PARM
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|crt1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|filter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mode
)paren
id|sisfb_search_mode
(paren
id|mode
)paren
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|crt1
op_eq
l_int|0
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sisfb_init
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
(paren
r_void
)paren
(brace
id|unregister_framebuffer
(paren
op_amp
id|fb_info
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|sis_malloc
id|EXPORT_SYMBOL
(paren
id|sis_malloc
)paren
suffix:semicolon
DECL|variable|sis_free
id|EXPORT_SYMBOL
(paren
id|sis_free
)paren
suffix:semicolon
DECL|variable|sis_dispinfo
id|EXPORT_SYMBOL
(paren
id|sis_dispinfo
)paren
suffix:semicolon
DECL|variable|ivideo
id|EXPORT_SYMBOL
(paren
id|ivideo
)paren
suffix:semicolon
eof
