multiline_comment|/*&n; * SiS 300/630/730/540/315/550/650/740 frame buffer device&n; * for Linux kernels 2.4.x and 2.5.x&n; *&n; * Partly based on the VBE 2.0 compliant graphic boards framebuffer driver,&n; * which is (c) 1998 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n; *&n; * Authors:   &t;SiS (www.sis.com.tw)&n; *&t;&t;(Various others)&n; *&t;&t;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;:&n; *&t;&t;&t;- SiS Xabre (330) support&n; *&t;&t;&t;- many fixes and enhancements for all chipset series,&n; *&t;&t;&t;- extended bridge handling, TV output for Chrontel 7005&n; *                      - 650/LVDS support (for LCD panels up to 1600x1200)&n; *                      - 650/740/Chrontel 7019 support&n; *                      - 30xB/30xLV LCD, TV and VGA2 support&n; *&t;&t;&t;- memory queue handling enhancements,&n; *                      - 2D acceleration and y-panning,&n; *                      - portation to 2.5 API&n; *&t;&t;&t;- etc.&n; *&t;&t;&t;(see http://www.winischhofer.net/&n; *&t;&t;&t;for more information and updates)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#endif
macro_line|#include &quot;osdef.h&quot;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#include &lt;video/sisfb.h&gt;
macro_line|#else
macro_line|#include &lt;linux/sisfb.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#endif
macro_line|#include &quot;vgatypes.h&quot;
macro_line|#include &quot;sis_main.h&quot;
macro_line|#include &quot;sis.h&quot;
macro_line|#if 0
macro_line|#ifdef LINUXBIOS
macro_line|#include &quot;bios.h&quot;
macro_line|#endif
macro_line|#endif
multiline_comment|/* -------------------- Macro definitions ---------------------------- */
DECL|macro|SISFBDEBUG
macro_line|#undef SISFBDEBUG &t;/* TW: no debugging */
macro_line|#ifdef SISFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#ifdef SISFBACCEL
macro_line|#ifdef FBCON_HAS_CFB8
r_extern
r_struct
id|display_switch
id|fbcon_sis8
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_extern
r_struct
id|display_switch
id|fbcon_sis16
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_extern
r_struct
id|display_switch
id|fbcon_sis32
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#endif
multiline_comment|/* --------------- Hardware Access Routines -------------------------- */
DECL|function|sisfb_set_reg4
r_void
id|sisfb_set_reg4
c_func
(paren
id|u16
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|outl
c_func
(paren
(paren
id|u32
)paren
(paren
id|data
op_amp
l_int|0xffffffff
)paren
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_reg3
id|u32
id|sisfb_get_reg3
c_func
(paren
id|u16
id|port
)paren
(brace
id|u32
id|data
suffix:semicolon
id|data
op_assign
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------ Interface for init &amp; mode switching code ------------- */
id|BOOLEAN
DECL|function|sisfb_query_VGA_config_space
id|sisfb_query_VGA_config_space
c_func
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Get VGA offset 0x%lx&bslash;n&quot;
comma
id|offset
)paren
suffix:semicolon
r_else
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Set offset 0x%lx to 0x%lx&bslash;n&quot;
comma
id|offset
comma
op_star
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|ivideo.chip_id
comma
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev
)paren
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d VGA device.&bslash;n&quot;
comma
id|ivideo.chip_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_query_north_bridge_space
id|BOOLEAN
id|sisfb_query_north_bridge_space
c_func
(paren
id|PSIS_HW_DEVICE_INFO
id|psishw_ext
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|set
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
r_char
id|init
op_assign
l_int|0
comma
id|valid_pdev
op_assign
l_int|0
suffix:semicolon
id|u16
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|init
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_550
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_650
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_650
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_740
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_740
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|nbridge_id
comma
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev
)paren
id|valid_pdev
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid_pdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Can&squot;t find SiS %d North Bridge device.&bslash;n&quot;
comma
id|nbridge_id
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_eq
l_int|0
)paren
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
op_star
)paren
id|value
)paren
suffix:semicolon
r_else
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|offset
comma
(paren
id|u32
)paren
(paren
op_star
id|value
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* ------------------ Internal helper routines ----------------- */
DECL|function|sisfb_search_mode
r_static
r_void
id|sisfb_search_mode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Internal error, using default mode.&bslash;n&quot;
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)&t;&t;
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sisbios_mode
(braket
id|MODE_INDEX_NONE
)braket
dot
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode &squot;none&squot; not supported anymore. Using default.&bslash;n&quot;
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif&t;&t;
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sisbios_mode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_mode_idx
op_assign
id|i
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|j
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid mode &squot;%s&squot;&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_vesamode
r_static
r_void
id|sisfb_search_vesamode
c_func
(paren
r_int
r_int
id|vesamode
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vesamode
op_eq
l_int|0
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode &squot;none&squot; not supported anymore. Using default.&bslash;n&quot;
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
macro_line|#endif&t;&t;
r_return
suffix:semicolon
)brace
id|vesamode
op_and_assign
l_int|0x1dff
suffix:semicolon
multiline_comment|/* Clean VESA mode number from other flags */
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|vesa_mode_no_1
op_eq
id|vesamode
)paren
op_logical_or
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|vesa_mode_no_2
op_eq
id|vesamode
)paren
)paren
(brace
id|sisfb_mode_idx
op_assign
id|i
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|j
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid VESA mode 0x%x&squot;&bslash;n&quot;
comma
id|vesamode
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_validate_mode
r_static
r_int
id|sisfb_validate_mode
c_func
(paren
r_int
id|myindex
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS300
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS315
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
r_switch
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
)paren
(brace
r_case
id|LCD_640x480
suffix:colon
id|xres
op_assign
l_int|640
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_800x600
suffix:colon
id|xres
op_assign
l_int|800
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1024x600
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1024x768
suffix:colon
id|xres
op_assign
l_int|1024
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1152x768
suffix:colon
id|xres
op_assign
l_int|1152
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x960
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|960
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x768
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|768
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1280x1024
suffix:colon
id|xres
op_assign
l_int|1280
suffix:semicolon
id|yres
op_assign
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1400x1050
suffix:colon
id|xres
op_assign
l_int|1400
suffix:semicolon
id|yres
op_assign
l_int|1050
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_1600x1200
suffix:colon
id|xres
op_assign
l_int|1600
suffix:semicolon
id|yres
op_assign
l_int|1200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_320x480
suffix:colon
multiline_comment|/* TW: FSTN */
id|xres
op_assign
l_int|320
suffix:semicolon
id|yres
op_assign
l_int|480
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|xres
op_assign
l_int|0
suffix:semicolon
id|yres
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
OG
id|xres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
OG
id|yres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sishw_ext.usExternalChip
op_eq
l_int|0x01
)paren
op_logical_or
multiline_comment|/* LVDS */
(paren
id|sishw_ext.usExternalChip
op_eq
l_int|0x05
)paren
op_logical_or
multiline_comment|/* LVDS+Chrontel */
(paren
id|sishw_ext.Is301BDH
)paren
)paren
(brace
multiline_comment|/* 301B-DH */
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
)paren
(brace
r_case
l_int|512
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|512
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
op_eq
id|LCD_1024x600
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|400
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|480
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|600
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|600
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|768
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_eq
l_int|600
)paren
op_logical_and
(paren
id|sishw_ext.ulCRT2LCDType
op_ne
id|LCD_1024x600
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1152
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
)paren
op_ne
l_int|768
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
op_ne
id|LCD_1152x768
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1280
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|768
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1024
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_eq
l_int|768
)paren
op_logical_and
(paren
id|sishw_ext.ulCRT2LCDType
op_ne
id|LCD_1280x768
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1400
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1050
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1600
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1200
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
)paren
(brace
r_case
l_int|512
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|512
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|400
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|480
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|600
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|768
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1280
suffix:colon
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|960
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1024
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_eq
l_int|960
)paren
(brace
r_if
c_cond
(paren
id|sishw_ext.ulCRT2LCDType
op_eq
id|LCD_1400x1050
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|1400
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1050
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1600
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|1200
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
)paren
(brace
r_case
l_int|512
suffix:colon
r_case
l_int|640
suffix:colon
r_case
l_int|800
suffix:colon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|480
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
op_ne
l_int|576
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: LVDS/CHRONTEL does not support 720 */
r_if
c_cond
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
op_logical_or
id|ivideo.hasVB
op_eq
id|HASVB_CHRONTEL
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|bpp
op_eq
l_int|32
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: LVDS/CHRONTEL only supports &lt; 800 (1024 on 650/Ch7019)*/
r_if
c_cond
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
op_logical_or
id|ivideo.hasVB
op_eq
id|HASVB_CHRONTEL
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|DISPTYPE_CRT2
suffix:colon
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
OG
l_int|1280
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|myindex
suffix:semicolon
)brace
DECL|function|sisfb_search_crt2type
r_static
r_void
id|sisfb_search_crt2type
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_crt2type
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
id|sisfb_tvplug
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|tvplug_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid CRT2 type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_queuemode
r_static
r_void
id|sisfb_search_queuemode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sis_queuemode
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_queuemode
op_assign
id|sis_queuemode
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_queuemode
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid queuemode type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
DECL|function|sisfb_search_refresh_rate
r_static
id|u8
id|sisfb_search_refresh_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|xres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|yres
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_rate_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_le
id|xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_eq
id|xres
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|yres
op_eq
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_eq
id|rate
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
OG
id|rate
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_minus
id|rate
)paren
op_le
l_int|3
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d up to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|sisfb_rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_rate_idx
OG
l_int|0
)paren
(brace
r_return
id|sisfb_rate_idx
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unsupported rate %d for %dx%d&bslash;n&quot;
comma
id|rate
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sisfb_search_tvstd
r_static
r_void
id|sisfb_search_tvstd
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|sis_tvtype
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|sisfb_tvmode
op_assign
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
)brace
DECL|function|sisfb_bridgeisslave
r_static
id|BOOLEAN
id|sisfb_bridgeisslave
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|usScratchP1_00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.hasVB
op_eq
id|HASVB_NONE
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
id|usScratchP1_00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|usScratchP1_00
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
op_logical_or
(paren
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
id|usScratchP1_00
op_amp
l_int|0x50
)paren
op_eq
l_int|0x10
)paren
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
DECL|function|sisfbcheckvretracecrt1
r_static
id|BOOLEAN
id|sisfbcheckvretracecrt1
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|temp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp
op_amp
l_int|0x80
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0xc0
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|sisfbcheckvretracecrt2
r_static
id|BOOLEAN
id|sisfbcheckvretracecrt2
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|temp
comma
id|reg
suffix:semicolon
r_switch
c_cond
(paren
id|sisvga_engine
)paren
(brace
r_case
id|SIS_300_VGA
suffix:colon
id|reg
op_assign
l_int|0x25
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_315_VGA
suffix:colon
id|reg
op_assign
l_int|0x30
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
id|reg
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x02
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_else
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_CheckVBRetrace
r_static
id|BOOLEAN
id|sisfb_CheckVBRetrace
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_bridgeisslave
c_func
(paren
)paren
)paren
(brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|sisfbcheckvretracecrt2
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ----------- FBDev related routines for all series ----------- */
DECL|function|sisfb_do_set_var
r_static
r_int
id|sisfb_do_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
r_int
r_int
id|vtotal
op_assign
l_int|0
suffix:semicolon
r_float
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|old_mode
suffix:semicolon
r_int
r_char
id|reg
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;Inside do_set_var&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0x80
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Cannot change display mode, X server is active&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
(paren
id|var-&gt;yres
op_div
l_int|2
)paren
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
)brace
r_else
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Invalid &squot;var&squot; information&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;pixclock
op_logical_and
id|htotal
op_logical_and
id|vtotal
)paren
(brace
id|drate
op_assign
l_float|1E12
op_div
id|var-&gt;pixclock
suffix:semicolon
id|hrate
op_assign
id|drate
op_div
id|htotal
suffix:semicolon
id|ivideo.refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_div
id|vtotal
op_star
l_int|2
op_plus
l_float|0.5
)paren
suffix:semicolon
)brace
r_else
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
multiline_comment|/* TW: Calculation wrong for 1024x600 - force it to 60Hz */
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_eq
l_int|1024
)paren
op_logical_and
(paren
id|var-&gt;yres
op_eq
l_int|600
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Change mode to %dx%dx%d-%dHz&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|old_mode
op_assign
id|sisfb_mode_idx
suffix:semicolon
id|sisfb_mode_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_mode_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|sisfb_mode_idx
)paren
suffix:semicolon
)brace
r_else
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode %dx%dx%d not supported&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|sisfb_mode_idx
op_assign
id|old_mode
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
)paren
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
op_logical_and
id|isactive
)paren
(brace
macro_line|#else
r_if
c_cond
(paren
id|isactive
)paren
(brace
macro_line|#endif
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Set new mode: %dx%dx%d-%d &bslash;n&quot;
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
comma
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_accel
)paren
(brace
id|ivideo.accel
op_assign
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Unsupported depth %d&quot;
comma
id|ivideo.video_bpp
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|TWDEBUG
c_func
(paren
l_string|&quot;End of do_set_var&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef SISFB_PAN
DECL|function|sisfb_pan_var
r_static
r_int
id|sisfb_pan_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
r_int
id|base
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;Inside pan_var&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Pan: xo: %d xv %d xr %d&bslash;n&quot;
comma
id|var-&gt;xoffset
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;xres
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Pan: yo: %d yv %d yr %d&bslash;n&quot;
comma
id|var-&gt;yoffset
comma
id|var-&gt;yres_virtual
comma
id|var-&gt;yres
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
op_plus
id|var-&gt;xoffset
suffix:semicolon
multiline_comment|/* calculate base bpp dep. */
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
id|base
op_rshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_default
suffix:colon
id|base
op_rshift_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0D
comma
id|base
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0C
comma
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0D
comma
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x37
comma
l_int|0xFE
comma
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|sisfb_CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x06
comma
(paren
id|base
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x05
comma
(paren
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x04
comma
(paren
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
l_int|0x7F
comma
(paren
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
)brace
)brace
id|TWDEBUG
c_func
(paren
l_string|&quot;End of pan_var&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sisfb_bpp_to_var
r_static
r_void
id|sisfb_bpp_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|6
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|sis_dispinfo
r_void
id|sis_dispinfo
c_func
(paren
r_struct
id|ap_data
op_star
id|rec
)paren
(brace
id|rec-&gt;minfo.bpp
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|rec-&gt;minfo.xres
op_assign
id|ivideo.video_width
suffix:semicolon
id|rec-&gt;minfo.yres
op_assign
id|ivideo.video_height
suffix:semicolon
id|rec-&gt;minfo.v_xres
op_assign
id|ivideo.video_vwidth
suffix:semicolon
id|rec-&gt;minfo.v_yres
op_assign
id|ivideo.video_vheight
suffix:semicolon
id|rec-&gt;minfo.org_x
op_assign
id|ivideo.org_x
suffix:semicolon
id|rec-&gt;minfo.org_y
op_assign
id|ivideo.org_y
suffix:semicolon
id|rec-&gt;minfo.vrate
op_assign
id|ivideo.refresh_rate
suffix:semicolon
id|rec-&gt;iobase
op_assign
id|ivideo.vga_base
op_minus
l_int|0x30
suffix:semicolon
id|rec-&gt;mem_size
op_assign
id|ivideo.video_size
suffix:semicolon
id|rec-&gt;disp_state
op_assign
id|ivideo.disp_state
suffix:semicolon
id|rec-&gt;version
op_assign
(paren
id|VER_MAJOR
op_lshift
l_int|24
)paren
op_or
(paren
id|VER_MINOR
op_lshift
l_int|16
)paren
op_or
id|VER_LEVEL
suffix:semicolon
id|rec-&gt;hasVB
op_assign
id|ivideo.hasVB
suffix:semicolon
id|rec-&gt;TV_type
op_assign
id|ivideo.TV_type
suffix:semicolon
id|rec-&gt;TV_plug
op_assign
id|ivideo.TV_plug
suffix:semicolon
id|rec-&gt;chip
op_assign
id|ivideo.chip
suffix:semicolon
)brace
multiline_comment|/* ------------ FBDev related routines for 2.4 series ----------- */
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
DECL|function|sisfb_crtc_to_var
r_static
r_void
id|sisfb_crtc_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u16
id|VRE
comma
id|VBE
comma
id|VRS
comma
id|VBS
comma
id|VDE
comma
id|VT
suffix:semicolon
id|u16
id|HRE
comma
id|HBE
comma
id|HRS
comma
id|HBS
comma
id|HDE
comma
id|HT
suffix:semicolon
id|u8
id|sr_data
comma
id|cr_data
comma
id|cr_data2
comma
id|cr_data3
comma
id|mr_data
suffix:semicolon
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|F
comma
id|temp
suffix:semicolon
r_float
id|hrate
comma
id|drate
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;Inside crtc_to_var&quot;
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_COLOR_MODE
comma
id|sr_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr_data
op_amp
id|SIS_INTERLACED_MODE
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|sr_data
op_amp
l_int|0x1C
)paren
op_rshift
l_int|2
)paren
(brace
r_case
id|SIS_8BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_16BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_32BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_bpp_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0A
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x06
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x07
comma
id|cr_data2
)paren
suffix:semicolon
id|VT
op_assign
(paren
id|cr_data
op_amp
l_int|0xFF
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x01
)paren
op_lshift
l_int|10
)paren
suffix:semicolon
id|A
op_assign
id|VT
op_plus
l_int|2
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x12
comma
id|cr_data
)paren
suffix:semicolon
id|VDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x40
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x02
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|E
op_assign
id|VDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x10
comma
id|cr_data
)paren
suffix:semicolon
id|VRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x04
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x08
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|F
op_assign
id|VRS
op_plus
l_int|1
op_minus
id|E
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x15
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x09
comma
id|cr_data3
)paren
suffix:semicolon
id|VBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x08
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data3
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x16
comma
id|cr_data
)paren
suffix:semicolon
id|VBE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_assign
id|VBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|511
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|512
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x11
comma
id|cr_data
)paren
suffix:semicolon
id|VRE
op_assign
(paren
id|cr_data
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x20
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|VRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_minus
l_int|1
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|32
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;yres
op_assign
id|E
suffix:semicolon
macro_line|#ifndef SISFB_PAN
id|var-&gt;yres_virtual
op_assign
id|E
suffix:semicolon
macro_line|#endif
multiline_comment|/* TW: We have to report the physical dimension to the console! */
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|var-&gt;yres
op_lshift_assign
l_int|1
suffix:semicolon
macro_line|#ifndef SISFB_PAN
id|var-&gt;yres_virtual
op_lshift_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;yres
op_rshift_assign
l_int|1
suffix:semicolon
macro_line|#ifndef SISFB_PAN
id|var-&gt;yres_virtual
op_rshift_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
id|var-&gt;upper_margin
op_assign
id|D
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|F
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|C
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0b
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x00
comma
id|cr_data
)paren
suffix:semicolon
id|HT
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|A
op_assign
id|HT
op_plus
l_int|5
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x01
comma
id|cr_data
)paren
suffix:semicolon
id|HDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x0C
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|E
op_assign
id|HDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x04
comma
id|cr_data
)paren
suffix:semicolon
id|HRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0xC0
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|F
op_assign
id|HRS
op_minus
id|E
op_minus
l_int|3
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x02
comma
id|cr_data
)paren
suffix:semicolon
id|HBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0c
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x03
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x05
comma
id|cr_data2
)paren
suffix:semicolon
id|HBE
op_assign
(paren
id|cr_data
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|HRE
op_assign
(paren
id|cr_data2
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|temp
op_assign
id|HBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|256
)paren
suffix:semicolon
id|temp
op_assign
id|HRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_plus
l_int|3
)paren
op_amp
l_int|63
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|64
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|E
op_star
l_int|8
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|D
op_star
l_int|8
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|F
op_star
l_int|8
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|C
op_star
l_int|8
suffix:semicolon
id|var-&gt;activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|mr_data
op_assign
id|inSISREG
c_func
(paren
id|SISMISCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x80
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x40
)paren
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
id|VT
op_add_assign
l_int|2
suffix:semicolon
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
id|HT
op_assign
(paren
id|HT
op_plus
l_int|5
)paren
op_star
l_int|8
suffix:semicolon
id|hrate
op_assign
(paren
r_float
)paren
id|ivideo.refresh_rate
op_star
(paren
r_float
)paren
id|VT
op_div
l_int|2
suffix:semicolon
id|drate
op_assign
id|hrate
op_star
id|HT
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_float|1E12
op_div
id|drate
)paren
suffix:semicolon
macro_line|#ifdef SISFB_PAN
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|ivideo.heapstart
op_div
(paren
id|var-&gt;xres
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of crtc_to_var&quot;
)paren
suffix:semicolon
)brace
DECL|function|sis_getcolreg
r_static
r_int
id|sis_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo.video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|sis_palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo.video_cmap_len
)paren
r_return
l_int|1
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|sis_palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|sis_fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|sis_fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_disp
r_static
r_void
id|sisfb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_struct
id|display_switch
op_star
id|sw
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
)brace
r_else
id|display
op_assign
op_amp
id|sis_disp
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|con
comma
l_int|0
)paren
suffix:semicolon
id|display-&gt;screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|0
suffix:semicolon
id|display-&gt;inverse
op_assign
id|sisfb_inverse
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis8
suffix:colon
op_amp
id|fbcon_cfb8
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis16
suffix:colon
op_amp
id|fbcon_cfb16
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
macro_line|#endif
id|display-&gt;dispsw_data
op_assign
id|sis_fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
macro_line|#ifdef SISFBACCEL
id|sw
op_assign
id|ivideo.accel
ques
c_cond
op_amp
id|fbcon_sis32
suffix:colon
op_amp
id|fbcon_cfb32
suffix:semicolon
macro_line|#else
id|sw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
macro_line|#endif
id|display-&gt;dispsw_data
op_assign
id|sis_fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|sisfb_sw
comma
id|sw
comma
r_sizeof
(paren
op_star
id|sw
)paren
)paren
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|sisfb_sw
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef SISFB_PAN
r_if
c_cond
(paren
(paren
id|ivideo.accel
)paren
op_logical_and
(paren
id|sisfb_ypan
)paren
)paren
(brace
multiline_comment|/* display-&gt;scrollmode = SCROLL_YPAN; - not defined */
)brace
r_else
(brace
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
)brace
macro_line|#else
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
macro_line|#endif
)brace
DECL|function|sisfb_do_install_cmap
r_static
r_void
id|sisfb_do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_ne
id|currcon
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|ivideo.video_cmap_len
)paren
comma
l_int|1
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
DECL|function|sisfb_get_var
r_static
r_int
id|sisfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|TWDEBUG
c_func
(paren
l_string|&quot;inside get_var&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|default_var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
)brace
r_else
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
multiline_comment|/* For FSTN, DSTN */
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|320
op_logical_and
id|var-&gt;yres
op_eq
l_int|480
)paren
id|var-&gt;yres
op_assign
l_int|240
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of get_var&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_var
r_static
r_int
id|sisfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
id|cols
comma
id|rows
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside set_var&quot;
)paren
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_do_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|currcon
comma
id|info
)paren
)paren
(brace
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_crtc_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
id|var
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;changevar
)paren
(brace
(paren
op_star
id|info-&gt;changevar
)paren
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of set_var&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap
r_static
r_int
id|sisfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|TWDEBUG
c_func
(paren
l_string|&quot;inside get_cmap&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|ivideo.video_cmap_len
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of get_cmap&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_cmap
r_static
r_int
id|sisfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside set_cmap&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|ivideo.video_cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of set_cmap&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef SISFB_PAN
DECL|function|sisfb_pan_display
r_static
r_int
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside pan_display&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.xres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.yres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|currcon
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|fb_display
(braket
id|con
)braket
dot
id|var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of pan_display&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
comma
id|mmio_off
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside mmap&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
macro_line|#endif
multiline_comment|/* By Jake Page: Treat mmap request with offset beyond heapstart&n;&t; *               as request for mapping the mmio area &n;&t; */
id|mmio_off
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|mmio_off
)paren
(brace
id|off
op_sub_assign
id|mmio_off
suffix:semicolon
id|sisfb_get_var
c_func
(paren
op_amp
id|var
comma
id|currcon
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var.accel_flags
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
multiline_comment|/* by Jake Page; is that really needed? */
macro_line|#if defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of mmap&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sis_get_glyph
r_static
r_void
id|sis_get_glyph
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
id|SIS_GLYINFO
op_star
id|gly
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|currcon
)braket
suffix:semicolon
id|u16
id|c
suffix:semicolon
id|u8
op_star
id|cdat
suffix:semicolon
r_int
id|widthb
suffix:semicolon
id|u8
op_star
id|gbuf
op_assign
id|gly-&gt;gmask
suffix:semicolon
r_int
id|size
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;Inside get_glyph&quot;
)paren
suffix:semicolon
id|gly-&gt;fontheight
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|gly-&gt;fontwidth
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|widthb
op_assign
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|c
op_assign
id|gly-&gt;ch
op_amp
id|p-&gt;charmask
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|size
op_assign
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|widthb
suffix:semicolon
id|memcpy
c_func
(paren
id|gbuf
comma
id|cdat
comma
id|size
)paren
suffix:semicolon
id|gly-&gt;ngmask
op_assign
id|size
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;End of get_glyph&quot;
)paren
suffix:semicolon
)brace
DECL|function|sisfb_update_var
r_static
r_int
id|sisfb_update_var
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
macro_line|#ifdef SISFB_PAN
r_return
id|sisfb_pan_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif&t;
)brace
DECL|function|sisfb_switch
r_static
r_int
id|sisfb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|cols
comma
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap.len
)paren
(brace
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|currcon
op_assign
id|con
suffix:semicolon
id|sisfb_do_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
id|info
)paren
suffix:semicolon
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|sisfb_update_var
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_void
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
l_int|0
)paren
(brace
id|reg
op_and_assign
l_int|0x7f
suffix:semicolon
)brace
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Synchronous Reset */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* End Reset */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb_blank() called (%d)&bslash;n&quot;
comma
id|blank
)paren
suffix:semicolon
)brace
DECL|function|sisfb_ioctl
r_static
r_int
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|TWDEBUG
c_func
(paren
l_string|&quot;inside ioctl&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_malloc
c_func
(paren
(paren
r_struct
id|sis_memreq
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_free
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_GLYPH
suffix:colon
id|sis_get_glyph
c_func
(paren
id|info
comma
(paren
id|SIS_GLYINFO
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_HWCINFO
suffix:colon
(brace
r_int
r_int
op_star
id|hwc_offset
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_caps
op_amp
id|HW_CURSOR_CAP
)paren
op_star
id|hwc_offset
op_assign
id|sisfb_hwcursor_vbase
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
r_else
op_star
id|hwc_offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOPUT_MODEINFO
suffix:colon
(brace
r_struct
id|mode_info
op_star
id|x
op_assign
(paren
r_struct
id|mode_info
op_star
)paren
id|arg
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|x-&gt;bpp
suffix:semicolon
id|ivideo.video_width
op_assign
id|x-&gt;xres
suffix:semicolon
id|ivideo.video_height
op_assign
id|x-&gt;yres
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|x-&gt;v_xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|x-&gt;v_yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|x-&gt;org_x
suffix:semicolon
id|ivideo.org_y
op_assign
id|x-&gt;org_y
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|x-&gt;vrate
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_vwidth
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Unsupported depth %d&quot;
comma
id|ivideo.video_bpp
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|FBIOGET_DISPINFO
suffix:colon
id|sis_dispinfo
c_func
(paren
(paren
r_struct
id|ap_data
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISFB_GET_INFO
suffix:colon
multiline_comment|/* TW: New for communication with X driver */
(brace
id|sisfb_info
op_star
id|x
op_assign
(paren
id|sisfb_info
op_star
)paren
id|arg
suffix:semicolon
id|x-&gt;sisfb_id
op_assign
id|SISFB_ID
suffix:semicolon
id|x-&gt;sisfb_version
op_assign
id|VER_MAJOR
suffix:semicolon
id|x-&gt;sisfb_revision
op_assign
id|VER_MINOR
suffix:semicolon
id|x-&gt;sisfb_patchlevel
op_assign
id|VER_LEVEL
suffix:semicolon
id|x-&gt;chip_id
op_assign
id|ivideo.chip_id
suffix:semicolon
id|x-&gt;memory
op_assign
id|ivideo.video_size
op_div
l_int|1024
suffix:semicolon
id|x-&gt;heapstart
op_assign
id|ivideo.heapstart
op_div
l_int|1024
suffix:semicolon
id|x-&gt;fbvidmode
op_assign
id|sisfb_mode_no
suffix:semicolon
id|x-&gt;sisfb_caps
op_assign
id|sisfb_caps
suffix:semicolon
id|x-&gt;sisfb_tqlen
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* yet unused */
id|x-&gt;sisfb_pcibus
op_assign
id|ivideo.pcibus
suffix:semicolon
id|x-&gt;sisfb_pcislot
op_assign
id|ivideo.pcislot
suffix:semicolon
id|x-&gt;sisfb_pcifunc
op_assign
id|ivideo.pcifunc
suffix:semicolon
id|x-&gt;sisfb_lcdpdc
op_assign
id|sisfb_detectedpdc
suffix:semicolon
id|x-&gt;sisfb_lcda
op_assign
id|sisfb_detectedlcda
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SISFB_GET_VBRSTATUS
suffix:colon
(brace
r_int
r_int
op_star
id|vbrstatus
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_CheckVBRetrace
c_func
(paren
)paren
)paren
(brace
op_star
id|vbrstatus
op_assign
l_int|1
suffix:semicolon
)brace
r_else
op_star
id|vbrstatus
op_assign
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|TWDEBUG
c_func
(paren
l_string|&quot;end of ioctl&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ------------ FBDev related routines for 2.5 series ----------- */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|function|sisfb_open
r_static
r_int
id|sisfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_release
r_static
r_int
id|sisfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_get_cmap_len
r_static
r_int
id|sisfb_get_cmap_len
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|rc
op_assign
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|rc
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|rc
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|rc
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sisfb_setcolreg
r_static
r_int
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|regno
op_ge
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|info-&gt;var
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_set_par
r_static
r_int
id|sisfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside set_par&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_do_set_var
c_func
(paren
op_amp
id|info-&gt;var
comma
l_int|1
comma
id|info
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|sisfb_get_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
id|info-&gt;currcon
comma
id|info
)paren
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of set_par&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_check_var
r_static
r_int
id|sisfb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
r_int
r_int
id|vtotal
op_assign
l_int|0
suffix:semicolon
r_float
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|refresh_rate
comma
id|search_idx
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;Inside check_var&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
(paren
id|var-&gt;yres
op_div
l_int|2
)paren
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
)brace
r_else
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|SISFAIL
c_func
(paren
l_string|&quot;sisfb: no valid timing data&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;pixclock
)paren
op_logical_and
(paren
id|htotal
)paren
)paren
(brace
id|drate
op_assign
l_float|1E12
op_div
id|var-&gt;pixclock
suffix:semicolon
id|hrate
op_assign
id|drate
op_div
id|htotal
suffix:semicolon
id|refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_div
id|vtotal
op_star
l_int|2
op_plus
l_float|0.5
)paren
suffix:semicolon
)brace
r_else
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
multiline_comment|/* TW: Calculation wrong for 1024x600 - force it to 60Hz */
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_eq
l_int|1024
)paren
op_logical_and
(paren
id|var-&gt;yres
op_eq
l_int|600
)paren
)paren
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|search_idx
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found_mode
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: %dx%dx%d is no valid mode&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
)paren
op_logical_and
(paren
id|var-&gt;yres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
op_eq
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|search_idx
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|var-&gt;xres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Adapted to mode %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Failed to find similar mode to %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: TODO: Check the refresh rate */
multiline_comment|/* Adapt RGB settings */
id|sisfb_bpp_to_var
c_func
(paren
id|var
)paren
suffix:semicolon
multiline_comment|/* Sanity check for offsets */
r_if
c_cond
(paren
id|var-&gt;xoffset
OL
l_int|0
)paren
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
)paren
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Horiz-panning not supported */
r_if
c_cond
(paren
id|var-&gt;xres
op_ne
id|var-&gt;xres_virtual
)paren
(brace
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_ypan
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yres
op_ne
id|var-&gt;yres_virtual
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* TW: Now patch yres_virtual if we use panning */
multiline_comment|/* *** May I do this? *** */
id|var-&gt;yres_virtual
op_assign
id|ivideo.heapstart
op_div
(paren
id|var-&gt;xres
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
multiline_comment|/* TW: Paranoia check */
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
multiline_comment|/* Truncate offsets to maximum if too high */
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
id|var-&gt;xoffset
op_assign
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
id|var-&gt;yoffset
op_assign
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Set everything else to 0 */
id|var-&gt;red.msb_right
op_assign
id|var-&gt;green.msb_right
op_assign
id|var-&gt;blue.msb_right
op_assign
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of check_var&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef SISFB_PAN
DECL|function|sisfb_pan_display
r_static
r_int
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside pan_display&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|info-&gt;var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|info-&gt;var.xres
OG
id|info-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|info-&gt;var.yres
OG
id|info-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of pan_display&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sisfb_mmap
r_static
r_int
id|sisfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
id|u32
id|len
comma
id|mmio_off
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;inside mmap&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.video_size
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
id|off
op_sub_assign
id|len
suffix:semicolon
macro_line|#endif
multiline_comment|/* By Jake Page: Treat mmap request with offset beyond heapstart&n;&t; *               as request for mapping the mmio area &n;&t; */
id|mmio_off
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|mmio_off
)paren
(brace
id|off
op_sub_assign
id|mmio_off
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.accel_flags
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|start
op_assign
(paren
r_int
r_int
)paren
id|ivideo.mmio_base
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|sisfb_mmio_size
)paren
suffix:semicolon
)brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
multiline_comment|/* by Jake Page; is that really needed? */
macro_line|#if defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|TWDEBUG
c_func
(paren
l_string|&quot;end of mmap&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_blank
r_static
r_int
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
l_int|0
)paren
(brace
id|reg
op_and_assign
l_int|0x7f
suffix:semicolon
)brace
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Synchronous Reset */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* End Reset */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_ioctl
r_static
r_int
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|TWDEBUG
c_func
(paren
l_string|&quot;inside ioctl&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_malloc
c_func
(paren
(paren
r_struct
id|sis_memreq
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sis_free
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_HWCINFO
suffix:colon
(brace
r_int
r_int
op_star
id|hwc_offset
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_caps
op_amp
id|HW_CURSOR_CAP
)paren
op_star
id|hwc_offset
op_assign
id|sisfb_hwcursor_vbase
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
r_else
op_star
id|hwc_offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FBIOPUT_MODEINFO
suffix:colon
(brace
r_struct
id|mode_info
op_star
id|x
op_assign
(paren
r_struct
id|mode_info
op_star
)paren
id|arg
suffix:semicolon
id|ivideo.video_bpp
op_assign
id|x-&gt;bpp
suffix:semicolon
id|ivideo.video_width
op_assign
id|x-&gt;xres
suffix:semicolon
id|ivideo.video_height
op_assign
id|x-&gt;yres
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|x-&gt;v_xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|x-&gt;v_yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|x-&gt;org_x
suffix:semicolon
id|ivideo.org_y
op_assign
id|x-&gt;org_y
suffix:semicolon
id|ivideo.refresh_rate
op_assign
id|x-&gt;vrate
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_vwidth
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Unsupported accel depth %d&quot;
comma
id|ivideo.video_bpp
)paren
suffix:semicolon
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|FBIOGET_DISPINFO
suffix:colon
id|sis_dispinfo
c_func
(paren
(paren
r_struct
id|ap_data
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISFB_GET_INFO
suffix:colon
multiline_comment|/* TW: New for communication with X driver */
(brace
id|sisfb_info
op_star
id|x
op_assign
(paren
id|sisfb_info
op_star
)paren
id|arg
suffix:semicolon
id|x-&gt;sisfb_id
op_assign
id|SISFB_ID
suffix:semicolon
id|x-&gt;sisfb_version
op_assign
id|VER_MAJOR
suffix:semicolon
id|x-&gt;sisfb_revision
op_assign
id|VER_MINOR
suffix:semicolon
id|x-&gt;sisfb_patchlevel
op_assign
id|VER_LEVEL
suffix:semicolon
id|x-&gt;chip_id
op_assign
id|ivideo.chip_id
suffix:semicolon
id|x-&gt;memory
op_assign
id|ivideo.video_size
op_div
l_int|1024
suffix:semicolon
id|x-&gt;heapstart
op_assign
id|ivideo.heapstart
op_div
l_int|1024
suffix:semicolon
id|x-&gt;fbvidmode
op_assign
id|sisfb_mode_no
suffix:semicolon
id|x-&gt;sisfb_caps
op_assign
id|sisfb_caps
suffix:semicolon
id|x-&gt;sisfb_tqlen
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* yet unused */
id|x-&gt;sisfb_pcibus
op_assign
id|ivideo.pcibus
suffix:semicolon
id|x-&gt;sisfb_pcislot
op_assign
id|ivideo.pcislot
suffix:semicolon
id|x-&gt;sisfb_pcifunc
op_assign
id|ivideo.pcifunc
suffix:semicolon
id|x-&gt;sisfb_lcdpdc
op_assign
id|sisfb_detectedpdc
suffix:semicolon
id|x-&gt;sisfb_lcda
op_assign
id|sisfb_detectedlcda
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SISFB_GET_VBRSTATUS
suffix:colon
(brace
r_int
r_int
op_star
id|vbrstatus
op_assign
(paren
r_int
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_CheckVBRetrace
c_func
(paren
)paren
)paren
(brace
op_star
id|vbrstatus
op_assign
l_int|1
suffix:semicolon
)brace
r_else
op_star
id|vbrstatus
op_assign
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|TWDEBUG
c_func
(paren
l_string|&quot;end of ioctl&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ----------- FBDev related routines for all series ---------- */
DECL|function|sisfb_get_fix
r_static
r_int
id|sisfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|TWDEBUG
c_func
(paren
l_string|&quot;inside get_fix&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|sis_fb_info.modename
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|myid
)paren
suffix:semicolon
macro_line|#endif&t;
id|fix-&gt;smem_start
op_assign
id|ivideo.video_base
suffix:semicolon
multiline_comment|/* TW */
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|fix-&gt;smem_len
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
id|fix-&gt;smem_len
op_assign
l_int|0x800000
suffix:semicolon
r_else
id|fix-&gt;smem_len
op_assign
l_int|0x400000
suffix:semicolon
)brace
r_else
id|fix-&gt;smem_len
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
id|fix-&gt;type
op_assign
id|video_type
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
(brace
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
)brace
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SISFB_PAN
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|ivideo.video_linelength
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|ivideo.mmio_base
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|sisfb_mmio_size
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_330
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_XABRE
suffix:semicolon
)brace
r_else
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR_2
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;&t;
id|fix-&gt;reserved
(braket
l_int|0
)braket
op_assign
id|ivideo.video_size
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|1
)braket
op_assign
(paren
id|ivideo.video_size
op_rshift
l_int|16
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|fix-&gt;reserved
(braket
l_int|2
)braket
op_assign
id|sisfb_caps
suffix:semicolon
macro_line|#endif&t;
id|TWDEBUG
c_func
(paren
l_string|&quot;end of get_fix&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------  fb_ops structures ----------------- */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|sisfb_get_fix
comma
id|fb_get_var
suffix:colon
id|sisfb_get_var
comma
id|fb_set_var
suffix:colon
id|sisfb_set_var
comma
id|fb_get_cmap
suffix:colon
id|sisfb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|sisfb_set_cmap
comma
macro_line|#ifdef SISFB_PAN
id|fb_pan_display
suffix:colon
id|sisfb_pan_display
comma
macro_line|#endif
id|fb_ioctl
suffix:colon
id|sisfb_ioctl
comma
id|fb_mmap
suffix:colon
id|sisfb_mmap
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|sisfb_open
comma
dot
id|fb_release
op_assign
id|sisfb_release
comma
dot
id|fb_check_var
op_assign
id|sisfb_check_var
comma
dot
id|fb_set_par
op_assign
id|sisfb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|sisfb_setcolreg
comma
macro_line|#ifdef SISFB_PAN
dot
id|fb_pan_display
op_assign
id|sisfb_pan_display
comma
macro_line|#endif&t;
dot
id|fb_blank
op_assign
id|sisfb_blank
comma
dot
id|fb_fillrect
op_assign
id|fbcon_sis_fillrect
comma
dot
id|fb_copyarea
op_assign
id|fbcon_sis_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
dot
id|fb_sync
op_assign
id|fbcon_sis_sync
comma
dot
id|fb_ioctl
op_assign
id|sisfb_ioctl
comma
dot
id|fb_mmap
op_assign
id|sisfb_mmap
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* ---------------- Chip generation dependent routines ---------------- */
macro_line|#ifdef CONFIG_FB_SIS_300 /* for SiS 300/630/540/730 */
DECL|function|sisfb_get_dram_size_300
r_static
r_int
id|sisfb_get_dram_size_300
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
comma
id|reg
suffix:semicolon
id|u16
id|nbridge_id
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_540
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_540
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_630
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_730
suffix:colon
id|nbridge_id
op_assign
id|PCI_DEVICE_ID_SI_730
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|nbridge_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nbridge_id
op_eq
l_int|0
)paren
(brace
multiline_comment|/* 300 */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|reg
op_amp
id|SIS_DRAM_SIZE_MASK
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 540, 630, 730 */
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|nbridge_id
comma
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
id|reg
op_assign
id|SIS_DATA_BUS_64
op_lshift
l_int|6
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_2MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_2MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_300
r_static
r_void
id|sisfb_detect_VB_connect_300
c_func
(paren
)paren
(brace
id|u8
id|sr16
comma
id|sr17
comma
id|cr32
comma
id|temp
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.hasVB
)paren
(brace
r_case
id|HASVB_LVDS_CHRONTEL
suffix:colon
r_case
id|HASVB_CHRONTEL
suffix:colon
id|SiS_SenseCh
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_301
suffix:colon
r_case
id|HASVB_302
suffix:colon
id|SiS_Sense30x
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_17
comma
id|sr17
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR32
comma
id|cr32
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x0F
)paren
op_logical_and
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sr17
op_amp
l_int|0x01
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x0E
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: override detected CRT2 type */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x04
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x02
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x08
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* PR/TW: override detected TV type */
id|ivideo.TV_plug
op_assign
id|sisfb_tvplug
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x20
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sr17
op_amp
l_int|0x10
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_16
comma
id|sr16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr16
op_amp
l_int|0x20
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: override detected CRT2 type */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* TW: Detect TV plug &amp; type */
r_if
c_cond
(paren
id|sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* PR/TW: override with option */
id|ivideo.TV_plug
op_assign
id|sisfb_tvplug
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_POWER_ON_TRAP
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|sisfb_forcecrt1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type_300
r_static
r_void
id|sisfb_get_VB_type_300
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_ne
id|SIS_300
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_has_VB_300
c_func
(paren
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR37
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS_EXTERNAL_CHIP_MASK
)paren
op_rshift
l_int|1
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_TRUMPION
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_TRUMPION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|sisfb_has_VB_300
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|sisfb_has_VB_300
r_static
r_int
id|sisfb_has_VB_300
c_func
(paren
r_void
)paren
(brace
id|u8
id|vb_chipid
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
comma
id|vb_chipid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif  /* CONFIG_FB_SIS_300 */
macro_line|#ifdef CONFIG_FB_SIS_315    /* for SiS 315/550/650/740/330 */
DECL|function|sisfb_get_dram_size_315
r_static
r_int
id|sisfb_get_dram_size_315
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_data
suffix:semicolon
id|u8
id|reg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
op_logical_or
id|ivideo.chip
op_eq
id|SIS_650
op_logical_or
id|ivideo.chip
op_eq
id|SIS_740
)paren
(brace
macro_line|#ifdef LINUXBIOS
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_550
)paren
op_logical_or
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_650
)paren
op_logical_or
(paren
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_SI_740
)paren
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: Initialize SR14 &quot;by hand&quot; */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xC0
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* TODO: set Dual channel and bus width bits here */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|reg
op_amp
id|SIS550_DRAM_SIZE_MASK
)paren
(brace
r_case
id|SIS550_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_24MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_96MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x6000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS550_DRAM_SIZE_256MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x10000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* TW: Some 550 BIOSes don&squot;t seem to initialize SR14 correctly (if at all),&n;&t;&t;&t; *     do it the hard way ourselves in this case. Unfortunately, we don&squot;t&n;&t;&t;&t; *     support 24, 48, 96 and other &quot;odd&quot; amounts here.&n;&t;&t;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Warning: Could not determine memory size, &quot;
l_string|&quot;now reading from PCI config&bslash;n&quot;
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_550
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|IND_BRI_DRAM_STATUS
comma
op_amp
id|pci_data
)paren
suffix:semicolon
id|pci_data
op_assign
(paren
id|pci_data
op_amp
id|BRI_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|ivideo.video_size
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_lshift
(paren
id|pci_data
op_plus
l_int|21
)paren
)paren
suffix:semicolon
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: Initialize SR14=IND_SIS_DRAM_SIZE */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xC0
suffix:semicolon
r_switch
c_cond
(paren
id|pci_data
)paren
(brace
r_case
id|BRI_DRAM_SIZE_4MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_4MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_8MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_8MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_16MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_16MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_32MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_32MB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRI_DRAM_SIZE_64MB
suffix:colon
id|reg
op_or_assign
id|SIS550_DRAM_SIZE_64MB
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unable to determine memory size, giving up.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Total confusion - No SiS PCI VGA device found?!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 315 */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_DRAM_SIZE
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS315_DRAM_SIZE_MASK
)paren
op_rshift
l_int|4
)paren
(brace
r_case
id|SIS315_DRAM_SIZE_2MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_4MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_8MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_16MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_32MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x2000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_64MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x4000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DRAM_SIZE_128MB
suffix:colon
id|ivideo.video_size
op_assign
l_int|0x8000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|reg
op_and_assign
id|SIS315_DUAL_CHANNEL_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_330
)paren
(brace
r_if
c_cond
(paren
id|reg
)paren
(brace
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS315_SINGLE_CHANNEL_2_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_DUAL_CHANNEL_1_RANK
suffix:colon
id|ivideo.video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS315_ASYM_DDR
suffix:colon
multiline_comment|/* TW: DDR asymentric */
id|ivideo.video_size
op_add_assign
(paren
id|ivideo.video_size
op_div
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|sisfb_detect_VB_connect_315
r_static
r_void
id|sisfb_detect_VB_connect_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|cr32
comma
id|temp
op_assign
l_int|0
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|ivideo.TV_type
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.hasVB
)paren
(brace
r_case
id|HASVB_LVDS_CHRONTEL
suffix:colon
r_case
id|HASVB_CHRONTEL
suffix:colon
id|SiS_SenseCh
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_301
suffix:colon
r_case
id|HASVB_302
suffix:colon
id|SiS_Sense30x
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR32
comma
id|cr32
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
op_logical_and
op_logical_neg
id|sisfb_crt1off
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
l_int|0x5F
)paren
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
multiline_comment|/* TW: Override with option */
id|ivideo.disp_state
op_assign
id|sisfb_crt2type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_TV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
id|ivideo.disp_state
op_assign
id|DISPTYPE_CRT2
suffix:semicolon
r_else
id|ivideo.disp_state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* PR/TW: Override with option */
id|ivideo.TV_plug
op_assign
id|sisfb_tvplug
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_HIVISION
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
id|ivideo.TV_plug
op_assign
id|TVPLUG_SCART
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
l_int|0
)paren
(brace
multiline_comment|/* TW: PAL/NTSC changed for 650 */
r_if
c_cond
(paren
(paren
id|ivideo.chip
op_le
id|SIS_315PRO
)paren
op_logical_or
(paren
id|ivideo.chip
op_ge
id|SIS_330
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x10
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
)brace
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
id|ivideo.TV_type
op_assign
id|TVMODE_PAL
suffix:semicolon
)brace
r_else
id|ivideo.TV_type
op_assign
id|TVMODE_NTSC
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|sisfb_forcecrt1
)paren
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
r_else
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type_315
r_static
r_void
id|sisfb_get_VB_type_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisfb_has_VB_315
c_func
(paren
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR37
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_amp
id|SIS_EXTERNAL_CHIP_MASK
)paren
op_rshift
l_int|1
)paren
(brace
r_case
id|SIS310_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS310_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_LVDS_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|sisfb_has_VB_315
r_static
r_int
id|sisfb_has_VB_315
c_func
(paren
r_void
)paren
(brace
id|u8
id|vb_chipid
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
comma
id|vb_chipid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_301
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_302
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.hasVB
op_assign
id|HASVB_NONE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif   /* CONFIG_FB_SIS_315 */
multiline_comment|/* ------------------ Sensing routines ------------------ */
multiline_comment|/* TW: Determine and detect attached devices on SiS30x */
r_int
DECL|function|SISDoSense
id|SISDoSense
c_func
(paren
r_int
id|tempbl
comma
r_int
id|tempbh
comma
r_int
id|tempcl
comma
r_int
id|tempch
)paren
(brace
r_int
id|temp
comma
id|i
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x11
comma
id|tempbl
)paren
suffix:semicolon
id|temp
op_assign
id|tempbh
op_or
id|tempcl
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
l_int|0xe0
comma
id|temp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SiS_LongWait
c_func
(paren
op_amp
id|SiS_Pr
)paren
suffix:semicolon
)brace
id|tempch
op_and_assign
l_int|0x7f
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x03
comma
id|temp
)paren
suffix:semicolon
id|temp
op_xor_assign
l_int|0x0e
suffix:semicolon
id|temp
op_and_assign
id|tempch
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
r_void
DECL|function|SiS_Sense30x
id|SiS_Sense30x
c_func
(paren
r_void
)paren
(brace
id|u8
id|backupP4_0d
suffix:semicolon
id|u8
id|testsvhs_tempbl
comma
id|testsvhs_tempbh
suffix:semicolon
id|u8
id|testsvhs_tempcl
comma
id|testsvhs_tempch
suffix:semicolon
id|u8
id|testcvbs_tempbl
comma
id|testcvbs_tempbh
suffix:semicolon
id|u8
id|testcvbs_tempcl
comma
id|testcvbs_tempch
suffix:semicolon
id|u8
id|testvga2_tempbl
comma
id|testvga2_tempbh
suffix:semicolon
id|u8
id|testvga2_tempcl
comma
id|testvga2_tempch
suffix:semicolon
r_int
id|myflag
comma
id|result
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
(paren
id|backupP4_0d
op_or
l_int|0x04
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0xd1
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0xb9
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0xb3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_301
)paren
op_logical_and
(paren
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_302
)paren
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0x90
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0x6b
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0x74
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myflag
op_amp
l_int|0x04
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0xfd
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0xdd
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0xee
suffix:semicolon
)brace
id|testvga2_tempch
op_assign
l_int|0x0e
suffix:semicolon
id|testvga2_tempcl
op_assign
l_int|0x08
suffix:semicolon
id|testsvhs_tempch
op_assign
l_int|0x06
suffix:semicolon
id|testsvhs_tempcl
op_assign
l_int|0x04
suffix:semicolon
id|testcvbs_tempch
op_assign
l_int|0x08
suffix:semicolon
id|testcvbs_tempcl
op_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3b
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|myflag
op_amp
l_int|0x01
)paren
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempch
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempcl
op_assign
l_int|0x00
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0xd1
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0xb9
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0xb3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_301
)paren
op_logical_and
(paren
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_302
)paren
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0x90
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0x6b
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0x74
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_301LV
op_logical_or
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_302LV
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x02
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0x00
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x01
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0x00
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_301LV
op_logical_and
id|sishw_ext.ujVBChipID
op_ne
id|VB_CHIP_302LV
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myflag
op_amp
l_int|0x04
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0xfd
suffix:semicolon
id|testsvhs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempbl
op_assign
l_int|0xdd
suffix:semicolon
id|testcvbs_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testcvbs_tempbl
op_assign
l_int|0xee
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_301LV
)paren
op_logical_or
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_302LV
)paren
)paren
(brace
id|testvga2_tempbh
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempbl
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempch
op_assign
l_int|0x00
suffix:semicolon
id|testvga2_tempcl
op_assign
l_int|0x00
suffix:semicolon
id|testsvhs_tempch
op_assign
l_int|0x04
suffix:semicolon
id|testsvhs_tempcl
op_assign
l_int|0x08
suffix:semicolon
id|testcvbs_tempch
op_assign
l_int|0x08
suffix:semicolon
id|testcvbs_tempcl
op_assign
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|testvga2_tempch
op_assign
l_int|0x0e
suffix:semicolon
id|testvga2_tempcl
op_assign
l_int|0x08
suffix:semicolon
id|testsvhs_tempch
op_assign
l_int|0x06
suffix:semicolon
id|testsvhs_tempcl
op_assign
l_int|0x04
suffix:semicolon
id|testcvbs_tempch
op_assign
l_int|0x08
suffix:semicolon
id|testcvbs_tempcl
op_assign
l_int|0x04
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|testvga2_tempch
op_logical_or
id|testvga2_tempcl
op_logical_or
id|testvga2_tempbh
op_logical_or
id|testvga2_tempbl
)paren
(brace
id|result
op_assign
id|SISDoSense
c_func
(paren
id|testvga2_tempbl
comma
id|testvga2_tempbh
comma
id|testvga2_tempcl
comma
id|testvga2_tempch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected secondary VGA connection&bslash;n&quot;
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x10
)paren
suffix:semicolon
)brace
)brace
id|result
op_assign
id|SISDoSense
c_func
(paren
id|testsvhs_tempbl
comma
id|testsvhs_tempbh
comma
id|testsvhs_tempcl
comma
id|testsvhs_tempch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected TV connected to SVHS output&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: So we can be sure that there IS a SVHS output */
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
(brace
id|result
op_assign
id|SISDoSense
c_func
(paren
id|testcvbs_tempbl
comma
id|testcvbs_tempbh
comma
id|testcvbs_tempcl
comma
id|testcvbs_tempch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected TV connected to CVBS output&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: So we can be sure that there IS a CVBS output */
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
)brace
)brace
id|SISDoSense
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: Determine and detect attached TV&squot;s on Chrontel */
r_void
DECL|function|SiS_SenseCh
id|SiS_SenseCh
c_func
(paren
r_void
)paren
(brace
id|u8
id|temp1
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|u8
id|temp2
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ivideo.chip
OL
id|SIS_315H
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
id|SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: Chrontel 7005 */
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x25
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_ge
l_int|50
)paren
op_logical_and
(paren
id|temp1
op_le
l_int|100
)paren
)paren
(brace
multiline_comment|/* TW: Read power status */
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x03
)paren
op_ne
l_int|0x03
)paren
(brace
multiline_comment|/* TW: Power all outputs */
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x030E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: Sense connected TV devices */
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0110
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x0010
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x08
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SVHS output&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: So we can be sure that there IS a SVHS output */
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to CVBS output&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: So we can be sure that there IS a CVBS output */
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0
)paren
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
id|SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* TW: Chrontel 7019 */
id|temp1
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x49
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x2049
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|temp2
op_or_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_xor_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|temp1
op_lshift
l_int|8
)paren
op_or
l_int|0x49
)paren
suffix:semicolon
id|temp1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x02
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x10
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x04
)paren
(brace
id|temp1
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|temp1
op_assign
l_int|0x04
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|temp1
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to CVBS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_COMPOSITE
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SVHS output&bslash;n&quot;
)paren
suffix:semicolon
id|ivideo.TV_plug
op_assign
id|TVPLUG_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
multiline_comment|/* TW: This should not happen */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel: Detected TV connected to SCART output&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
multiline_comment|/* ------------------------ Heap routines -------------------------- */
DECL|function|sisfb_heap_init
r_static
r_int
id|sisfb_heap_init
c_func
(paren
r_void
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|u8
id|temp
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_int
id|agp_enabled
op_assign
l_int|1
suffix:semicolon
id|u32
id|agp_size
suffix:semicolon
r_int
r_int
op_star
id|cmdq_baseport
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|read_port
op_assign
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|write_port
op_assign
l_int|0
suffix:semicolon
id|SIS_CMDTYPE
id|cmd_type
suffix:semicolon
macro_line|#ifndef AGPOFF
r_struct
id|agp_kern_info
op_star
id|agp_info
suffix:semicolon
r_struct
id|agp_memory
op_star
id|agp
suffix:semicolon
id|u32
id|agp_phys
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/* TW: The heap start is either set manually using the &quot;mem&quot; parameter, or&n; *     defaults as follows:&n; *     -) If more than 16MB videoRAM available, let our heap start at 12MB.&n; *     -) If more than  8MB videoRAM available, let our heap start at  8MB.&n; *     -) If 4MB or less is available, let it start at 4MB.&n; *     This is for avoiding a clash with X driver which uses the beginning&n; *     of the videoRAM. To limit size of X framebuffer, use Option MaxXFBMem&n; *     in XF86Config-4.&n; *     The heap start can also be specified by parameter &quot;mem&quot; when starting the sisfb&n; *     driver. sisfb mem=1024 lets heap starts at 1MB, etc.&n; */
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisfb_mem
)paren
op_logical_or
(paren
id|sisfb_mem
OG
(paren
id|ivideo.video_size
op_div
l_int|1024
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x1000000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.video_size
OG
l_int|0x800000
)paren
(brace
id|ivideo.heapstart
op_assign
l_int|0x800000
suffix:semicolon
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
l_int|0x400000
suffix:semicolon
)brace
)brace
r_else
(brace
id|ivideo.heapstart
op_assign
id|sisfb_mem
op_star
l_int|1024
suffix:semicolon
)brace
id|sisfb_heap_start
op_assign
(paren
r_int
r_int
)paren
(paren
id|ivideo.video_vbase
op_plus
id|ivideo.heapstart
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Memory heap starting at %dK&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|ivideo.heapstart
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|sisfb_heap_end
op_assign
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
op_plus
id|ivideo.video_size
suffix:semicolon
id|sisfb_heap_size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* TW: Now initialize the 310 series&squot; command queue mode.&n;&t; * On 310/325, there are three queue modes available which&n;&t; * are chosen by setting bits 7:5 in SR26:&n;&t; * 1. MMIO queue mode (bit 5, 0x20). The hardware will keep&n;&t; *    track of the queue, the FIFO, command parsing and so&n;&t; *    on. This is the one comparable to the 300 series.&n;&t; * 2. VRAM queue mode (bit 6, 0x40). In this case, one will&n;&t; *    have to do queue management himself. Register 0x85c4 will&n;&t; *    hold the location of the next free queue slot, 0x85c8&n;&t; *    is the &quot;queue read pointer&quot; whose way of working is&n;&t; *    unknown to me. Anyway, this mode would require a&n;&t; *    translation of the MMIO commands to some kind of&n;&t; *    accelerator assembly and writing these commands&n;&t; *    to the memory location pointed to by 0x85c4.&n;&t; *    We will not use this, as nobody knows how this&n;&t; *    &quot;assembly&quot; works, and as it would require a complete&n;&t; *    re-write of the accelerator code.&n;&t; * 3. AGP queue mode (bit 7, 0x80). Works as 2., but keeps the&n;&t; *    queue in AGP memory space.&n;&t; *&n;&t; * SR26 bit 4 is called &quot;Bypass H/W queue&quot;.&n;&t; * SR26 bit 1 is called &quot;Enable Command Queue Auto Correction&quot;&n;&t; * SR26 bit 0 resets the queue&n;&t; * Size of queue memory is encoded in bits 3:2 like this:&n;&t; *    00  (0x00)  512K&n;&t; *    01  (0x04)  1M&n;&t; *    10  (0x08)  2M&n;&t; *    11  (0x0C)  4M&n;&t; * The queue location is to be written to 0x85C0.&n;&t; *&n;         */
id|cmdq_baseport
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_PHYBASE
)paren
suffix:semicolon
id|write_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_WRITEPORT
)paren
suffix:semicolon
id|read_port
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|ivideo.mmio_vbase
op_plus
id|MMIO_QUEUE_READPORT
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;AGP base: 0x%p, read: 0x%p, write: 0x%p&bslash;n&quot;
comma
id|cmdq_baseport
comma
id|read_port
comma
id|write_port
)paren
suffix:semicolon
id|agp_size
op_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
macro_line|#ifndef AGPOFF
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
(brace
id|agp_info
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|agp_info
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|agp_info
comma
l_int|0x00
comma
r_sizeof
(paren
op_star
id|agp_info
)paren
)paren
suffix:semicolon
id|agp_copy_info
c_func
(paren
id|agp_info
)paren
suffix:semicolon
id|agp_backend_acquire
c_func
(paren
)paren
suffix:semicolon
id|agp
op_assign
id|agp_allocate_memory
c_func
(paren
id|COMMAND_QUEUE_AREA_SIZE
op_div
id|PAGE_SIZE
comma
id|AGP_NORMAL_MEMORY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|agp
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Allocating AGP buffer failed.&bslash;n&quot;
)paren
suffix:semicolon
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|agp_bind_memory
c_func
(paren
id|agp
comma
id|agp-&gt;pg_start
)paren
op_ne
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP: Failed to bind memory&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: Free AGP memory here */
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|agp_enable
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
id|agp_enabled
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* TW: Now select the queue mode */
r_if
c_cond
(paren
(paren
id|agp_enabled
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_eq
id|AGP_CMD_QUEUE
)paren
)paren
(brace
id|cmd_type
op_assign
id|AGP_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using AGP queue mode&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&t;} else if (sisfb_heap_size &gt;= COMMAND_QUEUE_AREA_SIZE)  */
)brace
r_else
r_if
c_cond
(paren
id|sisfb_queuemode
op_eq
id|VM_CMD_QUEUE
)paren
(brace
id|cmd_type
op_assign
id|VM_CMD_QUEUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using VRAM queue mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using MMIO queue mode&bslash;n&quot;
)paren
suffix:semicolon
id|cmd_type
op_assign
id|MMIO_CMD
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|agp_size
)paren
(brace
r_case
l_int|0x80000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_512k
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_1M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x200000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_2M
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x400000
suffix:colon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_4M
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd_type
)paren
(brace
r_case
id|AGP_CMD_QUEUE
suffix:colon
macro_line|#ifndef AGPOFF
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: AGP buffer base = 0x%lx, offset = 0x%x, size = %dK&bslash;n&quot;
comma
id|agp_info-&gt;aper_base
comma
id|agp-&gt;physical
comma
id|agp_size
op_div
l_int|1024
)paren
suffix:semicolon
id|agp_phys
op_assign
id|agp_info-&gt;aper_base
op_plus
id|agp-&gt;physical
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_AGP_IO_PAD
comma
l_int|0
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_AGP_IO_PAD
comma
id|SIS_AGP_2X
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_AGP_CMDQUEUE_ENABLE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|agp_phys
suffix:semicolon
id|sisfb_caps
op_or_assign
id|AGP_CMD_QUEUE_CAP
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|VM_CMD_QUEUE
suffix:colon
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
id|temp
op_or_assign
id|SIS_VRAM_CMDQUEUE_ENABLE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|VM_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: VM Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* MMIO */
multiline_comment|/* TW: This previously only wrote SIS_MMIO_CMD_ENABLE&n;&t;&t; * to IND_SIS_CMDQUEUE_SET. I doubt that this is&n;&t;&t; * enough. Reserve memory in any way.&n;&t;&t; */
id|sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
op_star
id|write_port
op_assign
op_star
id|read_port
suffix:semicolon
multiline_comment|/* TW: Set Auto_Correction bit */
id|temp
op_or_assign
(paren
id|SIS_MMIO_CMD_ENABLE
op_or
id|SIS_CMD_AUTO_CORR
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
op_star
id|cmdq_baseport
op_assign
id|ivideo.video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_caps
op_or_assign
id|MMIO_CMD_QUEUE_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: MMIO Cmd Queue offset = 0x%lx, size is %dK&bslash;n&quot;
comma
op_star
id|cmdq_baseport
comma
id|COMMAND_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* sisvga_engine = 315 */
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
multiline_comment|/* TW: Now initialize TurboQueue. TB is always located at the very&n;&t;     * top of the video RAM. */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|TURBO_QUEUE_AREA_SIZE
)paren
(brace
r_int
r_int
id|tqueue_pos
suffix:semicolon
id|u8
id|tq_state
suffix:semicolon
id|tqueue_pos
op_assign
(paren
id|ivideo.video_size
op_minus
id|TURBO_QUEUE_AREA_SIZE
)paren
op_div
(paren
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_amp
l_int|0xff
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|tq_state
op_or_assign
l_int|0xf0
suffix:semicolon
id|tq_state
op_and_assign
l_int|0xfc
suffix:semicolon
id|tq_state
op_or_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_ADR
comma
id|temp
)paren
suffix:semicolon
id|sisfb_caps
op_or_assign
id|TURBO_QUEUE_CAP
suffix:semicolon
id|sisfb_heap_end
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: TurboQueue start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|TURBO_QUEUE_AREA_SIZE
op_div
l_int|1024
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* TW: Now reserve memory for the HWCursor. It is always located at the very&n;            top of the videoRAM, right below the TB memory area (if used). */
r_if
c_cond
(paren
id|sisfb_heap_size
op_ge
id|sisfb_hwcursor_size
)paren
(brace
id|sisfb_heap_end
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_heap_size
op_sub_assign
id|sisfb_hwcursor_size
suffix:semicolon
id|sisfb_hwcursor_vbase
op_assign
id|sisfb_heap_end
suffix:semicolon
id|sisfb_caps
op_or_assign
id|HW_CURSOR_CAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Hardware Cursor start at 0x%lx, size is %dK&bslash;n&quot;
comma
id|sisfb_heap_end
comma
id|sisfb_hwcursor_size
op_div
l_int|1024
)paren
suffix:semicolon
)brace
id|sisfb_heap.poha_chain
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
l_int|NULL
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;size
op_assign
id|sisfb_heap_end
op_minus
id|sisfb_heap_start
op_plus
l_int|1
suffix:semicolon
id|poh-&gt;offset
op_assign
id|sisfb_heap_start
op_minus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Heap start:0x%p, end:0x%p, len=%dk&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_start
comma
(paren
r_char
op_star
)paren
id|sisfb_heap_end
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: First Node offset:0x%x, size:%dk&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|poh-&gt;offset
comma
(paren
r_int
r_int
)paren
id|poh-&gt;size
op_div
l_int|1024
)paren
suffix:semicolon
id|sisfb_heap.oh_free.poh_next
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.poh_prev
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.size
op_assign
l_int|0
suffix:semicolon
id|sisfb_heap.max_freesize
op_assign
id|poh-&gt;size
suffix:semicolon
id|sisfb_heap.oh_used.poh_next
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.poh_prev
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.size
op_assign
id|SENTINEL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sisfb_poh_new_node
r_static
id|SIS_OH
op_star
id|sisfb_poh_new_node
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|cOhs
suffix:semicolon
id|SIS_OHALLOC
op_star
id|poha
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap.poh_freelist
op_eq
l_int|NULL
)paren
(brace
id|poha
op_assign
id|kmalloc
c_func
(paren
id|OH_ALLOC_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|poha
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|poha-&gt;poha_next
op_assign
id|sisfb_heap.poha_chain
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
id|poha
suffix:semicolon
id|cOhs
op_assign
(paren
id|OH_ALLOC_SIZE
op_minus
r_sizeof
(paren
id|SIS_OHALLOC
)paren
)paren
op_div
r_sizeof
(paren
id|SIS_OH
)paren
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cOhs
op_minus
l_int|1
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|poh-&gt;poh_next
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh-&gt;poh_next
suffix:semicolon
r_return
(paren
id|poh
)paren
suffix:semicolon
)brace
DECL|function|sisfb_poh_allocate
r_static
id|SIS_OH
op_star
id|sisfb_poh_allocate
c_func
(paren
r_int
r_int
id|size
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|pohRoot
suffix:semicolon
r_int
id|bAllocated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|sisfb_heap.max_freesize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|pohThis-&gt;size
)paren
(brace
id|bAllocated
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|bAllocated
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk size on offscreen&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|pohThis-&gt;size
)paren
(brace
id|pohRoot
op_assign
id|pohThis
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|pohThis
)paren
suffix:semicolon
)brace
r_else
(brace
id|pohRoot
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pohRoot
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohRoot-&gt;offset
op_assign
id|pohThis-&gt;offset
suffix:semicolon
id|pohRoot-&gt;size
op_assign
id|size
suffix:semicolon
id|pohThis-&gt;offset
op_add_assign
id|size
suffix:semicolon
id|pohThis-&gt;size
op_sub_assign
id|size
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_sub_assign
id|size
suffix:semicolon
id|pohThis
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_insert_node
c_func
(paren
id|pohThis
comma
id|pohRoot
)paren
suffix:semicolon
r_return
(paren
id|pohRoot
)paren
suffix:semicolon
)brace
DECL|function|sisfb_delete_node
r_static
r_void
id|sisfb_delete_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|poh_prev
op_assign
id|poh-&gt;poh_prev
suffix:semicolon
id|poh_next
op_assign
id|poh-&gt;poh_next
suffix:semicolon
id|poh_prev-&gt;poh_next
op_assign
id|poh_next
suffix:semicolon
id|poh_next-&gt;poh_prev
op_assign
id|poh_prev
suffix:semicolon
)brace
DECL|function|sisfb_insert_node
r_static
r_void
id|sisfb_insert_node
c_func
(paren
id|SIS_OH
op_star
id|pohList
comma
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|pohTemp
suffix:semicolon
id|pohTemp
op_assign
id|pohList-&gt;poh_next
suffix:semicolon
id|pohList-&gt;poh_next
op_assign
id|poh
suffix:semicolon
id|pohTemp-&gt;poh_prev
op_assign
id|poh
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
id|pohList
suffix:semicolon
id|poh-&gt;poh_next
op_assign
id|pohTemp
suffix:semicolon
)brace
DECL|function|sisfb_poh_free
r_static
id|SIS_OH
op_star
id|sisfb_poh_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|poh_freed
suffix:semicolon
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
r_int
r_int
id|ulUpper
suffix:semicolon
r_int
r_int
id|ulLower
suffix:semicolon
r_int
id|foundNode
op_assign
l_int|0
suffix:semicolon
id|poh_freed
op_assign
id|sisfb_heap.oh_used.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|poh_freed
op_ne
op_amp
id|sisfb_heap.oh_used
)paren
(brace
r_if
c_cond
(paren
id|poh_freed-&gt;offset
op_eq
id|base
)paren
(brace
id|foundNode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|poh_freed
op_assign
id|poh_freed-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|foundNode
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
id|sisfb_heap.max_freesize
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_prev
op_assign
id|poh_next
op_assign
l_int|NULL
suffix:semicolon
id|ulUpper
op_assign
id|poh_freed-&gt;offset
op_plus
id|poh_freed-&gt;size
suffix:semicolon
id|ulLower
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|pohThis-&gt;offset
op_eq
id|ulUpper
)paren
(brace
id|poh_next
op_assign
id|pohThis
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pohThis-&gt;offset
op_plus
id|pohThis-&gt;size
)paren
op_eq
id|ulLower
)paren
(brace
id|poh_prev
op_assign
id|pohThis
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
id|sisfb_delete_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh_prev
op_logical_and
id|poh_next
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
(paren
id|poh_freed-&gt;size
op_plus
id|poh_next-&gt;size
)paren
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_prev
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_prev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_next
)paren
(brace
id|poh_next-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_next-&gt;offset
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_next
)paren
suffix:semicolon
)brace
id|sisfb_insert_node
c_func
(paren
op_amp
id|sisfb_heap.oh_free
comma
id|poh_freed
)paren
suffix:semicolon
r_return
(paren
id|poh_freed
)paren
suffix:semicolon
)brace
DECL|function|sisfb_free_node
r_static
r_void
id|sisfb_free_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh
suffix:semicolon
)brace
DECL|function|sis_malloc
r_void
id|sis_malloc
c_func
(paren
r_struct
id|sis_memreq
op_star
id|req
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_allocate
c_func
(paren
id|req-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|req-&gt;offset
op_assign
l_int|0
suffix:semicolon
id|req-&gt;size
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation succeeded: 0x%p&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|poh-&gt;offset
op_plus
(paren
r_int
r_int
)paren
id|ivideo.video_vbase
)paren
)paren
suffix:semicolon
id|req-&gt;offset
op_assign
id|poh-&gt;offset
suffix:semicolon
id|req-&gt;size
op_assign
id|poh-&gt;size
suffix:semicolon
)brace
)brace
DECL|function|sis_free
r_void
id|sis_free
c_func
(paren
r_int
r_int
id|base
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_free
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: sisfb_poh_free() failed at base 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------- SetMode routines ------------------------- */
DECL|function|sisfb_pre_setmode
r_static
r_void
id|sisfb_pre_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|cr30
op_assign
l_int|0
comma
id|cr31
op_assign
l_int|0
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x31
comma
id|cr31
)paren
suffix:semicolon
id|cr31
op_and_assign
op_complement
l_int|0x60
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_CRT2
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_CRT2
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_LCD
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_LCD
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_HIVISION
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_HIVISION
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SVIDEO
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_COMPOSITE
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SCART
)paren
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SCART
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_tvmode
op_eq
l_int|1
op_logical_or
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
id|cr31
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* disable CRT2 */
id|cr30
op_assign
l_int|0x00
suffix:semicolon
id|cr31
op_or_assign
(paren
id|SIS_DRIVER_MODE
op_or
id|SIS_VB_OUTPUT_DISABLE
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR30
comma
id|cr30
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR31
comma
id|cr31
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_SCRATCH_REG_CR33
comma
(paren
id|sisfb_rate_idx
op_amp
l_int|0x0F
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.accel
)paren
(brace
id|sisfb_syncaccel
c_func
(paren
)paren
suffix:semicolon
)brace
id|SiS_Pr.SiS_UseOEM
op_assign
id|sisfb_useoem
suffix:semicolon
)brace
DECL|function|sisfb_post_setmode
r_static
r_void
id|sisfb_post_setmode
c_func
(paren
r_void
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|BOOLEAN
id|doit
op_assign
id|TRUE
suffix:semicolon
macro_line|#if 0&t;/* TW: Wrong: Is not in MMIO space, but in RAM */
multiline_comment|/* Backup mode number to MMIO space */
r_if
c_cond
(paren
id|ivideo.mmio_vbase
)paren
(brace
op_star
(paren
r_volatile
id|u8
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|ivideo.mmio_vbase
)paren
op_plus
l_int|0x449
)paren
op_assign
(paren
r_int
r_char
)paren
id|sisfb_mode_no
suffix:semicolon
)brace
macro_line|#endif&t;
r_if
c_cond
(paren
id|ivideo.video_bpp
op_eq
l_int|8
)paren
(brace
multiline_comment|/* TW: We can&squot;t switch off CRT1 on LVDS/Chrontel in 8bpp Modes */
r_if
c_cond
(paren
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS
)paren
op_logical_or
(paren
id|ivideo.hasVB
op_eq
id|HASVB_LVDS_CHRONTEL
)paren
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* TW: We can&squot;t switch off CRT1 on 301B-DH in 8bpp Modes if using LCD */
r_if
c_cond
(paren
(paren
id|sishw_ext.Is301BDH
)paren
op_logical_and
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_LCD
)paren
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/* TW: We can&squot;t switch off CRT1 if bridge is in slave mode */
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0x50
)paren
op_eq
l_int|0x10
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_crt1off
)paren
op_logical_and
(paren
id|doit
)paren
)paren
(brace
id|reg
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
)brace
r_else
id|reg
op_or_assign
l_int|0x80
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|reg
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_RAMDAC_CONTROL
comma
op_complement
l_int|0x04
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_TV
)paren
op_logical_and
(paren
id|ivideo.hasVB
op_eq
id|HASVB_301
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xB0
)paren
(brace
multiline_comment|/* Set filter for SiS301 */
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|320
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|filter
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|sisfb_CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_NTSC
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3a
comma
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xdf
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x04
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEE
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x0C
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x22
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x15
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0xF6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_type
op_eq
id|TVMODE_PAL
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3A
comma
l_int|0x1F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xDF
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo.TV_plug
op_eq
id|TVPLUG_COMPOSITE
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xF7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1F
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1D
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xFC
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xFB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x14
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x2A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|filter
op_ge
l_int|0
)paren
op_logical_and
(paren
id|filter
op_le
l_int|7
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;FilterTable[%d]-%d: %02x %02x %02x %02x&bslash;n&quot;
comma
id|filter_tb
comma
id|filter
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
comma
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|filter
)braket
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#ifndef MODULE
DECL|function|sisfb_setup
r_int
id|sisfb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|sis_fb_info.fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#endif&t;
id|ivideo.refresh_rate
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Options %s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vesa:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;&t;&t;
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* fb_invert_cmaps(); */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|strcpy
c_func
(paren
id|sis_fb_info.fontname
comma
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vesa:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vrate:&quot;
comma
l_int|6
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;rate:&quot;
comma
l_int|5
)paren
)paren
(brace
id|ivideo.refresh_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;crt1off&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;filter:&quot;
comma
l_int|7
)paren
)paren
(brace
id|filter
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt2type:&quot;
comma
l_int|14
)paren
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt1:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_forcecrt1
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|10
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvmode:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvstandard:&quot;
comma
l_int|11
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mem:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_mem
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;dstn&quot;
comma
l_int|4
)paren
)paren
(brace
id|enable_dstn
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* TW: DSTN overrules forcecrt2type */
id|sisfb_crt2type
op_assign
id|DISPTYPE_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;queuemode:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_search_queuemode
c_func
(paren
id|this_opt
op_plus
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pdc:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_pdc
op_amp
op_complement
l_int|0x3c
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Illegal pdc parameter&bslash;n&quot;
)paren
suffix:semicolon
id|sisfb_pdc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noypan&quot;
comma
l_int|6
)paren
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;userom:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_userom
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;useoem:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_useoem
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid option %s&bslash;n&quot;
comma
id|this_opt
)paren
suffix:semicolon
)brace
multiline_comment|/* TW: Acceleration only with MMIO mode */
r_if
c_cond
(paren
(paren
id|sisfb_queuemode
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_ne
id|MMIO_CMD
)paren
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* TW: Panning only with acceleration */
r_if
c_cond
(paren
id|sisfb_accel
op_eq
l_int|0
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sis_find_rom
r_static
r_char
op_star
id|sis_find_rom
c_func
(paren
r_void
)paren
(brace
macro_line|#if defined(__i386__)
id|u32
id|segstart
suffix:semicolon
r_int
r_char
op_star
id|rom_base
suffix:semicolon
r_int
r_char
op_star
id|rom
suffix:semicolon
r_int
id|stage
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|sis_rom_sig
(braket
)braket
op_assign
l_string|&quot;Silicon Integrated Systems&quot;
suffix:semicolon
r_char
op_star
id|sis_sig_300
(braket
l_int|4
)braket
op_assign
(brace
l_string|&quot;300&quot;
comma
l_string|&quot;540&quot;
comma
l_string|&quot;630&quot;
comma
l_string|&quot;730&quot;
)brace
suffix:semicolon
r_char
op_star
id|sis_sig_310
(braket
l_int|7
)braket
op_assign
(brace
l_string|&quot;315&quot;
comma
l_string|&quot;315&quot;
comma
l_string|&quot;315&quot;
comma
l_string|&quot;5315&quot;
comma
l_string|&quot;6325&quot;
comma
l_string|&quot;6325&quot;
comma
l_string|&quot;Xabre&quot;
)brace
suffix:semicolon
id|ushort
id|sis_nums_300
(braket
l_int|4
)braket
op_assign
(brace
id|SIS_300
comma
id|SIS_540
comma
id|SIS_630
comma
id|SIS_730
)brace
suffix:semicolon
r_int
r_int
id|sis_nums_310
(braket
l_int|7
)braket
op_assign
(brace
id|SIS_315PRO
comma
id|SIS_315H
comma
id|SIS_315
comma
id|SIS_550
comma
id|SIS_650
comma
id|SIS_740
comma
id|SIS_330
)brace
suffix:semicolon
r_for
c_loop
(paren
id|segstart
op_assign
l_int|0x000c0000
suffix:semicolon
id|segstart
OL
l_int|0x000f0000
suffix:semicolon
id|segstart
op_add_assign
l_int|0x00001000
)paren
(brace
id|stage
op_assign
l_int|1
suffix:semicolon
id|rom_base
op_assign
(paren
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|segstart
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|rom_base
op_eq
l_int|0x55
)paren
op_logical_and
(paren
(paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xff
)paren
op_eq
l_int|0xaa
)paren
)paren
id|stage
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stage
op_ne
l_int|2
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
op_plus
(paren
r_int
r_int
)paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x12
)paren
op_or
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x13
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|sis_rom_sig
comma
id|rom
comma
id|strlen
c_func
(paren
id|sis_rom_sig
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|stage
op_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|3
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
op_plus
(paren
r_int
r_int
)paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x14
)paren
op_or
(paren
op_star
(paren
id|rom_base
op_plus
l_int|0x15
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|4
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|sis_sig_300
(braket
id|i
)braket
comma
id|rom
comma
id|strlen
c_func
(paren
id|sis_sig_300
(braket
id|i
)braket
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sis_nums_300
(braket
id|i
)braket
op_eq
id|ivideo.chip
)paren
(brace
id|stage
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|4
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|7
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|sis_sig_310
(braket
id|i
)braket
comma
id|rom
comma
id|strlen
c_func
(paren
id|sis_sig_310
(braket
id|i
)braket
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sis_nums_310
(braket
id|i
)braket
op_eq
id|ivideo.chip
)paren
(brace
id|stage
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|4
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
id|rom_base
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sisfb_init
r_int
id|__init
id|sisfb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|board
op_star
id|b
suffix:semicolon
r_int
id|pdev_valid
op_assign
l_int|0
suffix:semicolon
id|u32
id|reg32
suffix:semicolon
id|u16
id|reg16
suffix:semicolon
id|u8
id|reg
comma
id|reg1
suffix:semicolon
multiline_comment|/* outb(0x77, 0x80); */
multiline_comment|/* What is this? */
macro_line|#if 0 &t;
multiline_comment|/* for DOC VB */
id|sisfb_set_reg4
c_func
(paren
l_int|0xcf8
comma
l_int|0x800000e0
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xcfc
)paren
suffix:semicolon
id|reg32
op_assign
id|reg32
op_or
l_int|0x00001000
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xcfc
comma
id|reg32
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_off
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|enable_dstn
)paren
id|SiS_SetEnableDstn
c_func
(paren
op_amp
id|SiS_Pr
)paren
suffix:semicolon
id|sisfb_registered
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sis_fb_info
comma
l_int|0
comma
r_sizeof
(paren
id|sis_fb_info
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|memset
c_func
(paren
op_amp
id|sis_disp
comma
l_int|0
comma
r_sizeof
(paren
id|sis_disp
)paren
)paren
suffix:semicolon
macro_line|#endif&t;
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|b
op_assign
id|sisdev_list
suffix:semicolon
id|b-&gt;vendor
suffix:semicolon
id|b
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|b-&gt;vendor
op_eq
id|pdev-&gt;vendor
)paren
op_logical_and
(paren
id|b-&gt;device
op_eq
id|pdev-&gt;device
)paren
)paren
(brace
id|pdev_valid
op_assign
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)&t;&t;&t;&t;
id|strcpy
c_func
(paren
id|sis_fb_info.modename
comma
id|b-&gt;name
)paren
suffix:semicolon
macro_line|#else&t;&t;&t;&t;
id|strcpy
c_func
(paren
id|myid
comma
id|b-&gt;name
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
id|ivideo.chip_id
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|ivideo.revision_id
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|reg16
)paren
suffix:semicolon
id|sishw_ext.jChipRevision
op_assign
id|ivideo.revision_id
suffix:semicolon
id|sisvga_enabled
op_assign
id|reg16
op_amp
l_int|0x01
suffix:semicolon
id|ivideo.pcibus
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
id|ivideo.pcislot
op_assign
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo.pcifunc
op_assign
id|PCI_FUNC
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo.subsysvendor
op_assign
id|pdev-&gt;subsystem_vendor
suffix:semicolon
id|ivideo.subsysdevice
op_assign
id|pdev-&gt;subsystem_device
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pdev_valid
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pdev_valid
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.chip_id
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|PCI_DEVICE_ID_SI_300
suffix:colon
id|ivideo.chip
op_assign
id|SIS_300
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
multiline_comment|/* New X driver uses 2 buffers */
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_630_VGA
suffix:colon
(brace
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07301039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_730
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)&t;&t;&t;&t;
id|strcpy
c_func
(paren
id|sis_fb_info.modename
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 730&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
)brace
r_else
id|ivideo.chip
op_assign
id|SIS_630
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_540_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_540
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_300_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_300
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_300
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|PCI_DEVICE_ID_SI_315H
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315H
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_315PRO
suffix:colon
id|ivideo.chip
op_assign
id|SIS_315PRO
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_550_VGA
suffix:colon
id|ivideo.chip
op_assign
id|SIS_550
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_650_VGA
suffix:colon
(brace
id|ivideo.chip
op_assign
id|SIS_650
suffix:semicolon
id|sisfb_set_reg4
c_func
(paren
l_int|0xCF8
comma
l_int|0x80000000
)paren
suffix:semicolon
id|reg32
op_assign
id|sisfb_get_reg3
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg32
op_eq
l_int|0x07401039
)paren
(brace
id|ivideo.chip
op_assign
id|SIS_740
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)&t;&t;&t;&t;
id|strcpy
c_func
(paren
id|sis_fb_info.modename
comma
l_string|&quot;SIS 740&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|myid
comma
l_string|&quot;SIS 740&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;
)brace
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PCI_DEVICE_ID_SI_330
suffix:colon
id|ivideo.chip
op_assign
id|SIS_330
suffix:semicolon
id|sisvga_engine
op_assign
id|SIS_315_VGA
suffix:semicolon
id|sisfb_hwcursor_size
op_assign
id|HW_CURSOR_AREA_SIZE_315
op_star
l_int|2
suffix:semicolon
id|sisfb_CRT2_write_enable
op_assign
id|IND_SIS_CRT2_WRITE_ENABLE_315
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.jChipType
op_assign
id|ivideo.chip
suffix:semicolon
multiline_comment|/* for Debug */
r_if
c_cond
(paren
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|sishw_ext.jChipType
op_eq
id|SIS_315
)paren
)paren
(brace
id|sishw_ext.jChipType
op_assign
id|SIS_315H
suffix:semicolon
)brace
id|ivideo.video_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|ivideo.mmio_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|sishw_ext.ulIOAddress
op_assign
(paren
r_int
r_int
)paren
id|ivideo.vga_base
op_assign
(paren
r_int
r_int
)paren
id|SiS_Pr.RelIO
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
op_plus
l_int|0x30
suffix:semicolon
id|sisfb_mmio_size
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|SiS_Pr.SiS_Backup70xx
op_assign
l_int|0xff
suffix:semicolon
id|SiS_Pr.SiS_CHOverScan
op_assign
op_minus
l_int|1
suffix:semicolon
id|SiS_Pr.SiS_ChSW
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.SiS_UseLCDA
op_assign
id|FALSE
suffix:semicolon
id|SiS_Pr.UsePanelScaler
op_assign
op_minus
l_int|1
suffix:semicolon
id|SiSRegInit
c_func
(paren
op_amp
id|SiS_Pr
comma
(paren
id|USHORT
)paren
id|sishw_ext.ulIOAddress
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* TW: Find PCI systems for Chrontel/ISA bridge manipulation */
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_630
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_eq
id|ivideo.subsysvendor
op_logical_and
id|mychswtable
(braket
id|i
)braket
dot
id|subsysCard
op_eq
id|ivideo.subsysdevice
)paren
(brace
id|SiS_Pr.SiS_ChSW
op_assign
id|TRUE
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_ne
l_int|0
)paren
(brace
suffix:semicolon
)brace
)brace
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;&t;
macro_line|#ifdef MODULE&t;
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Cannot initialize display mode, X server is active&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
macro_line|#endif&t;
macro_line|#endif
macro_line|#ifdef LINUXBIOS  /* -------------------------------- */
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
l_int|0x37
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
l_int|0x61
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_1A
comma
id|SIS_SCRATCH_REG_1A_MASK
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_550
op_logical_or
id|ivideo.chip
op_eq
id|SIS_650
op_logical_or
id|ivideo.chip
op_eq
id|SIS_740
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
l_int|0x5a
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
l_int|0x64
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x3a
comma
l_int|0x00
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;
macro_line|#endif /* LinuxBIOS  -------------------------------- */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.chip
)paren
(brace
r_case
id|SIS_315H
suffix:colon
r_case
id|SIS_315
suffix:colon
r_case
id|SIS_330
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
r_case
id|SIS_650
suffix:colon
r_case
id|SIS_740
suffix:colon
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo.chip
op_eq
id|SIS_300
)paren
(brace
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_SCRATCH_REG_1A
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|SIS_SCRATCH_REG_1A_MASK
)paren
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
r_else
id|sishw_ext.bIntegratedMMEnabled
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
id|sishw_ext.pDevice
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_userom
)paren
(brace
id|sishw_ext.pjVirtualRomBase
op_assign
id|sis_find_rom
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pjVirtualRomBase
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM found and mapped to %p&bslash;n&quot;
comma
id|sishw_ext.pjVirtualRomBase
)paren
suffix:semicolon
id|sishw_ext.UseROM
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM not found&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sishw_ext.pjVirtualRomBase
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM usage disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sishw_ext.pjCustomizedROMImage
op_assign
l_int|NULL
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
l_int|0
suffix:semicolon
id|sishw_ext.pQueryVGAConfigSpace
op_assign
op_amp
id|sisfb_query_VGA_config_space
suffix:semicolon
id|sishw_ext.pQueryNorthBridgeSpace
op_assign
op_amp
id|sisfb_query_north_bridge_space
suffix:semicolon
id|strcpy
c_func
(paren
id|sishw_ext.szVBIOSVer
comma
l_string|&quot;0.84&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: Mode numbers for 1280x960 are different for 300 and 310/325 series */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
)braket
dot
id|mode_no
op_assign
l_int|0x6e
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|1
)braket
dot
id|mode_no
op_assign
l_int|0x6f
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|2
)braket
dot
id|mode_no
op_assign
l_int|0x7b
suffix:semicolon
id|sisbios_mode
(braket
id|MODEINDEX_1280x960
op_plus
l_int|3
)braket
dot
id|mode_no
op_assign
l_int|0x7b
suffix:semicolon
)brace
id|sishw_ext.pSR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|SR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pSR
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Allocating SRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
id|sishw_ext.pCR
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|SIS_DSReg
)paren
op_star
id|CR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pCR
op_eq
l_int|NULL
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Allocating CRReg space failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
id|sishw_ext.pCR
(braket
l_int|0
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 300 Init */
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x4000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
macro_line|#ifdef LINUXBIOS&t;&t;/* TW: SiSInit now for LinuxBIOS only */&t;        
id|SiSInit
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x4000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|SiSInit
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
l_int|0x10
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_get_dram_size_300
c_func
(paren
)paren
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
multiline_comment|/* Mapping Max FB Size for 315 Init */
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
macro_line|#ifdef LINUXBIOS
multiline_comment|/* TW: SISInit is now for LINUXBIOS only */
id|SiSInit
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
)brace
macro_line|#ifdef LINUXBIOS
r_else
(brace
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
l_int|0x8000000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|SiSInit
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sishw_ext.bSkipDramSizing
op_assign
id|TRUE
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jIdx
op_assign
l_int|0x13
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jIdx
op_assign
l_int|0x14
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jIdx
op_assign
l_int|0xFF
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
id|sishw_ext.pSR
(braket
l_int|0
)braket
dot
id|jVal
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|sishw_ext.pSR
(braket
l_int|1
)braket
dot
id|jVal
)paren
suffix:semicolon
id|sishw_ext.pSR
(braket
l_int|2
)braket
dot
id|jVal
op_assign
l_int|0xFF
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_get_dram_size_315
c_func
(paren
)paren
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
multiline_comment|/* Enable PCI_LINEAR_ADDRESSING and MMIO_ENABLE  */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PCI_ADDRESS_SET
comma
(paren
id|SIS_PCI_ADDR_ENABLE
op_or
id|SIS_MEM_MAP_IO_ENABLE
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable 2D accelerator engine */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_MODULE_ENABLE
comma
id|SIS_ENABLE_2D
)paren
suffix:semicolon
)brace
id|sishw_ext.ulVideoMemorySize
op_assign
id|ivideo.video_size
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_pdc
)paren
(brace
id|sishw_ext.pdc
op_assign
id|sisfb_pdc
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.pdc
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
comma
l_string|&quot;sisfb FB&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Is there another framebuffer driver active?&bslash;n&quot;
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
comma
l_string|&quot;sisfb MMIO&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ivideo.video_vbase
op_assign
id|sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|ivideo.mmio_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Framebuffer at 0x%lx, mapped to 0x%p, size %dk&bslash;n&quot;
comma
id|ivideo.video_base
comma
id|ivideo.video_vbase
comma
id|ivideo.video_size
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: MMIO at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo.mmio_base
comma
id|ivideo.mmio_vbase
comma
id|sisfb_mmio_size
op_div
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap_init
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sisfb: Failed to initialize offscreen memory heap&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|ivideo.mtrr
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_get_VB_type_300
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|sisfb_get_VB_type_315
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_UNKNOWN
suffix:semicolon
id|sishw_ext.Is301BDH
op_assign
id|FALSE
suffix:semicolon
id|sishw_ext.usExternalChip
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.hasVB
)paren
(brace
r_case
id|HASVB_301
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xE0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xD0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xB0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301B
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg1
op_amp
l_int|0x02
)paren
)paren
(brace
id|sishw_ext.Is301BDH
op_assign
id|TRUE
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301B%s bridge detected (revision 0x%02x)&bslash;n&quot;
comma
(paren
id|sishw_ext.Is301BDH
ques
c_cond
l_string|&quot;-DH&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS301 bridge detected&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HASVB_302
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xE0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xD0
)paren
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302LV bridge detected (revision 0x%02x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xB0
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg1
op_amp
l_int|0x02
)paren
)paren
(brace
id|sishw_ext.Is301BDH
op_assign
id|TRUE
suffix:semicolon
)brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302B
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302B%s bridge detected (revision 0x%02x)&bslash;n&quot;
comma
(paren
id|sishw_ext.Is301BDH
ques
c_cond
l_string|&quot;-DH&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ujVBChipID
op_assign
id|VB_CHIP_302
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: SiS302 bridge detected&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HASVB_LVDS
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: LVDS transmitter detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_TRUMPION
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Trumpion Zurac LVDS scaler detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Chrontel TV encoder detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HASVB_LVDS_CHRONTEL
suffix:colon
id|sishw_ext.usExternalChip
op_assign
l_int|0x5
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: LVDS transmitter and Chrontel TV encoder detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: No or unknown bridge type detected&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.hasVB
op_ne
id|HASVB_NONE
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_detect_VB_connect_300
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|sisfb_detect_VB_connect_315
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_crt1off
)paren
id|ivideo.disp_state
op_or_assign
id|DISPMODE_SINGLE
suffix:semicolon
r_else
id|ivideo.disp_state
op_or_assign
(paren
id|DISPMODE_MIRROR
op_or
id|DISPTYPE_CRT1
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo.disp_state
op_assign
id|DISPMODE_SINGLE
op_or
id|DISPTYPE_CRT1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_LCD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|enable_dstn
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|IND_SIS_LCD_PANEL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis300paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
r_else
(brace
id|sishw_ext.ulCRT2LCDType
op_assign
id|sis310paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* TW: FSTN/DSTN */
id|sishw_ext.ulCRT2LCDType
op_assign
id|LCD_320x480
suffix:semicolon
)brace
)brace
id|sisfb_detectedpdc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifndef LINUXBIOS
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* TW: Save the current PanelDelayCompensation if the LCD is currently used */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|sishw_ext.usExternalChip
op_eq
l_int|0x01
)paren
op_logical_or
multiline_comment|/* LVDS */
(paren
id|sishw_ext.usExternalChip
op_eq
l_int|0x05
)paren
op_logical_or
multiline_comment|/* LVDS+Chrontel */
(paren
id|sishw_ext.Is301BDH
)paren
)paren
(brace
multiline_comment|/* 301B-DH */
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Currently on LCD? If yes, read current pdc */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
id|sisfb_detectedpdc
op_and_assign
l_int|0x3c
suffix:semicolon
r_if
c_cond
(paren
id|sishw_ext.pdc
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Let option override detection */
id|sishw_ext.pdc
op_assign
id|sisfb_detectedpdc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|sisfb_detectedpdc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sishw_ext.pdc
)paren
op_logical_and
(paren
id|sishw_ext.pdc
op_ne
id|sisfb_detectedpdc
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PanelDelayCompensation %d&bslash;n&quot;
comma
id|sishw_ext.pdc
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#endif
id|sisfb_detectedlcda
op_assign
l_int|0xff
suffix:semicolon
macro_line|#ifndef LINUXBIOS
macro_line|#ifdef CONFIG_FB_SIS_315
multiline_comment|/* TW: Try to find about LCDA */
r_if
c_cond
(paren
id|sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_302B
)paren
op_logical_or
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_301LV
)paren
op_logical_or
(paren
id|sishw_ext.ujVBChipID
op_eq
id|VB_CHIP_302LV
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_le
l_int|0x13
)paren
(brace
multiline_comment|/* Currently on LCDA? (Some BIOSes leave CR38) */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0x03
)paren
op_eq
l_int|0x03
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Currently on LCDA? (Some newer BIOSes set D0 in CR35) */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x35
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x01
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Currently on LCD? If so, we can find out &n;&t;&t;&t;&t;   by peeking the mode register &n;&t;&t;&t;&t; */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x04
)paren
(brace
id|SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|SiS_Pr.SiS_UseLCDA
)paren
(brace
id|sisfb_detectedlcda
op_assign
l_int|0x03
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Bridge uses LCDA for low resolution and text modes&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_mode_idx
op_ge
l_int|0
)paren
id|sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|sisfb_mode_idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_idx
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|ivideo.disp_state
op_amp
id|DISPTYPE_DISP2
)paren
(brace
r_case
id|DISPTYPE_LCD
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_LCDMODE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPTYPE_TV
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_TVMODE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sisfb_mode_no
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|mode_no
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.refresh_rate
op_ne
l_int|0
)paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo.refresh_rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_rate_idx
op_eq
l_int|0
)paren
(brace
id|sisfb_rate_idx
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo.refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|ivideo.video_bpp
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo.video_vwidth
op_assign
id|ivideo.video_width
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo.video_vheight
op_assign
id|ivideo.video_height
op_assign
id|sisbios_mode
(braket
id|sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo.org_x
op_assign
id|ivideo.org_y
op_assign
l_int|0
suffix:semicolon
id|ivideo.video_linelength
op_assign
id|ivideo.video_width
op_star
(paren
id|ivideo.video_bpp
op_rshift
l_int|3
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo.video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo.DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo.SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo.video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unsupported depth %d&quot;
comma
id|ivideo.video_bpp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
multiline_comment|/* ---------------- For 2.4: Now switch the mode ------------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|sisfb_pre_setmode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Setting mode[0x%x] failed, using default mode&bslash;n&quot;
comma
id|sisfb_mode_no
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
)paren
suffix:semicolon
id|sisfb_crtc_to_var
c_func
(paren
op_amp
id|default_var
)paren
suffix:semicolon
macro_line|#else&t;&t;/* --------- For 2.5: Setup a somewhat sane default var ------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Default mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo.video_width
comma
id|ivideo.video_height
comma
id|ivideo.video_bpp
comma
id|ivideo.refresh_rate
)paren
suffix:semicolon
id|default_var.xres
op_assign
id|default_var.xres_virtual
op_assign
id|ivideo.video_width
suffix:semicolon
id|default_var.yres
op_assign
id|default_var.yres_virtual
op_assign
id|ivideo.video_height
suffix:semicolon
id|default_var.bits_per_pixel
op_assign
id|ivideo.video_bpp
suffix:semicolon
id|sisfb_bpp_to_var
c_func
(paren
op_amp
id|default_var
)paren
suffix:semicolon
id|default_var.pixclock
op_assign
(paren
id|u32
)paren
(paren
l_float|1E12
op_div
id|sisfb_mode_rate_to_dclock
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
comma
id|sisfb_rate_idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_rate_to_ddata
c_func
(paren
op_amp
id|SiS_Pr
comma
op_amp
id|sishw_ext
comma
id|sisfb_mode_no
comma
id|sisfb_rate_idx
comma
op_amp
id|default_var.left_margin
comma
op_amp
id|default_var.right_margin
comma
op_amp
id|default_var.upper_margin
comma
op_amp
id|default_var.lower_margin
comma
op_amp
id|default_var.hsync_len
comma
op_amp
id|default_var.vsync_len
comma
op_amp
id|default_var.sync
comma
op_amp
id|default_var.vmode
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|default_var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|default_var.yres
op_lshift_assign
l_int|1
suffix:semicolon
id|default_var.yres_virtual
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|default_var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|default_var.pixclock
op_rshift_assign
l_int|1
suffix:semicolon
id|default_var.yres
op_rshift_assign
l_int|1
suffix:semicolon
id|default_var.yres_virtual
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#ifdef SISFB_PAN
r_if
c_cond
(paren
id|sisfb_ypan
)paren
(brace
id|default_var.yres_virtual
op_assign
id|ivideo.heapstart
op_div
(paren
id|default_var.xres
op_star
(paren
id|default_var.bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_var.yres_virtual
op_le
id|default_var.yres
)paren
(brace
id|default_var.yres_virtual
op_assign
id|default_var.yres
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#endif
id|ivideo.accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_accel
)paren
(brace
id|ivideo.accel
op_assign
op_minus
l_int|1
suffix:semicolon
id|default_var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|sisfb_initaccel
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;&t;/* ---- 2.4 series init ---- */
id|sis_fb_info.node
op_assign
op_minus
l_int|1
suffix:semicolon
id|sis_fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sis_fb_info.blank
op_assign
op_amp
id|sisfb_blank
suffix:semicolon
id|sis_fb_info.fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|sis_fb_info.switch_con
op_assign
op_amp
id|sisfb_switch
suffix:semicolon
id|sis_fb_info.updatevar
op_assign
op_amp
id|sisfb_update_var
suffix:semicolon
id|sis_fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|sis_fb_info.disp
op_assign
op_amp
id|sis_disp
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|default_var
comma
op_amp
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)&t;&t;/* ---- 2.5 series init ---- */
id|sis_fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sis_fb_info.var
op_assign
id|default_var
suffix:semicolon
id|sis_fb_info.fix
op_assign
id|sisfb_fix
suffix:semicolon
id|sis_fb_info.par
op_assign
op_amp
id|ivideo
suffix:semicolon
id|sis_fb_info.screen_base
op_assign
id|ivideo.video_vbase
suffix:semicolon
id|sis_fb_info.fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|sis_fb_info.fix
comma
op_minus
l_int|1
comma
op_amp
id|sis_fb_info
)paren
suffix:semicolon
id|sis_fb_info.pseudo_palette
op_assign
id|pseudo_palette
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|sis_fb_info.cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MTRR
id|ivideo.mtrr
op_assign
id|mtrr_add
c_func
(paren
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo.mtrr
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Added MTRRs&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|vc_resize_con
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|TWDEBUG
c_func
(paren
l_string|&quot;Before calling register_framebuffer&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|sis_fb_info
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_registered
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Installed SISFB_GET_INFO ioctl (%x)&bslash;n&quot;
comma
id|SISFB_GET_INFO
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: 2D acceleration is %s, scrolling mode %s&bslash;n&quot;
comma
id|sisfb_accel
ques
c_cond
l_string|&quot;enabled&quot;
suffix:colon
l_string|&quot;disabled&quot;
comma
id|sisfb_ypan
ques
c_cond
l_string|&quot;ypan&quot;
suffix:colon
l_string|&quot;redraw&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|sis_fb_info.node
)paren
comma
id|sis_fb_info.modename
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%02d&bslash;n&quot;
comma
id|sis_fb_info.node
comma
id|myid
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* TW: if mode = &quot;none&quot; */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|vesa
r_static
r_int
id|vesa
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|rate
r_static
r_int
r_int
id|rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|crt1off
r_static
r_int
r_int
id|crt1off
op_assign
l_int|1
suffix:semicolon
DECL|variable|mem
r_static
r_int
r_int
id|mem
op_assign
l_int|0
suffix:semicolon
DECL|variable|dstn
r_static
r_int
r_int
id|dstn
op_assign
l_int|0
suffix:semicolon
DECL|variable|forcecrt2type
r_static
r_char
op_star
id|forcecrt2type
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|forcecrt1
r_static
r_int
id|forcecrt1
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|queuemode
r_static
r_char
op_star
id|queuemode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|pdc
r_static
r_int
id|pdc
op_assign
l_int|0
suffix:semicolon
DECL|variable|noaccel
r_static
r_int
id|noaccel
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|noypan
r_static
r_int
id|noypan
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|inverse
r_static
r_int
id|inverse
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|userom
r_static
r_int
id|userom
op_assign
l_int|1
suffix:semicolon
DECL|variable|useoem
r_static
r_int
id|useoem
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|tvstandard
r_static
r_char
op_star
id|tvstandard
op_assign
l_int|NULL
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 300/540/630/730/315/550/650/740/330 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;SiS; Thomas Winischhofer &lt;thomas@winischhofer.net&gt;; Various others&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired display mode in the format [X]x[Y]x[Depth], eg.&bslash;n&quot;
l_string|&quot;800x600x16 (default: none if sisfb is a module; this leaves the&bslash;n&quot;
l_string|&quot;console untouched and the driver will only do the video memory&bslash;n&quot;
l_string|&quot;management for eg. DRM/DRI; 800x600x8 if sisfb is in the kernel)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)&t; 
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired default display mode in the format [X]x[Y]x[Depth],&bslash;n&quot;
l_string|&quot;eg. 1024x768x16 (default: 800x600x8)&quot;
)paren
suffix:semicolon
macro_line|#endif&t; 
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|vesa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired display mode by VESA defined mode number, eg. 0x117&bslash;n&quot;
l_string|&quot;(default: 0x0000 if sisfb is a module; this leaves the console untouched&bslash;n&quot;
l_string|&quot;and the driver will only do the video memory management for eg. DRM/DRI;&bslash;n&quot;
l_string|&quot;0x0103 if sisfb is in the kernel)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)&t; 
id|MODULE_PARM
c_func
(paren
id|vesa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired default display mode by VESA defined mode number, eg.&bslash;n&quot;
l_string|&quot;0x117 (default: 0x0103)&quot;
)paren
suffix:semicolon
macro_line|#endif&t; 
id|MODULE_PARM
c_func
(paren
id|rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|rate
comma
l_string|&quot;&bslash;nSelects the desired vertical refresh rate for CRT1 (external VGA) in Hz.&bslash;n&quot;
l_string|&quot;(default: 60)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|crt1off
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|crt1off
comma
l_string|&quot;(Deprecated, please use forcecrt1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|filter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|filter
comma
l_string|&quot;&bslash;nSelects TV flicker filter type (only for systems with a SiS301 video bridge).&bslash;n&quot;
l_string|&quot;(Possible values 0-7, default: [no filter])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dstn
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dstn
comma
l_string|&quot;&bslash;nSelects DSTN/FSTN display mode for SiS550. This sets CRT2 type to LCD and&bslash;n&quot;
l_string|&quot;overrides forcecrt2type setting. (1=ON, 0=OFF) (default: 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|queuemode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|queuemode
comma
l_string|&quot;&bslash;nSelects the queue mode on 315/550/650/740/330. Possible choices are AGP, VRAM or&bslash;n&quot;
l_string|&quot;MMIO. AGP is only available if the kernel has AGP support. The queue mode is&bslash;n&quot;
l_string|&quot;important to programs using the 2D/3D accelerator of the SiS chip. The modes&bslash;n&quot;
l_string|&quot;require a totally different way of programming the engines. If any mode than&bslash;n&quot;
l_string|&quot;MMIO is selected, sisfb will disable its own 2D acceleration. On&bslash;n&quot;
l_string|&quot;300/540/630/730, this option is ignored. (default: MMIO)&quot;
)paren
suffix:semicolon
multiline_comment|/* TW: &quot;Import&quot; the options from the X driver */
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mem
comma
l_string|&quot;&bslash;nDetermines the beginning of the video memory heap in KB. This heap is used&bslash;n&quot;
l_string|&quot;for video RAM management for eg. DRM/DRI. The default depends on the amount&bslash;n&quot;
l_string|&quot;of video RAM available. If 8MB of video RAM or less is available, the heap&bslash;n&quot;
l_string|&quot;starts at 4096KB, if between 8 and 16MB are available at 8192KB, otherwise&bslash;n&quot;
l_string|&quot;at 12288KB. The value is to be specified without &squot;KB&squot; and should match&bslash;n&quot;
l_string|&quot;the MaxXFBMem setting for XFree 4.x (x&gt;=2).&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;&bslash;nIf this option is omitted, the driver autodetects CRT2 output devices, such as&bslash;n&quot;
l_string|&quot;LCD, TV or secondary VGA. With this option, this autodetection can be&bslash;n&quot;
l_string|&quot;overridden. Possible parameters are LCD, TV, VGA or NONE. NONE disables CRT2.&bslash;n&quot;
l_string|&quot;On systems with a 301(B/LV) bridge, parameters SVIDEO, COMPOSITE or SCART can be&bslash;n&quot;
l_string|&quot;used instead of TV to override the TV detection. (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt1
comma
l_string|&quot;&bslash;nNormally, the driver autodetects whether or not CRT1 (external VGA) is &bslash;n&quot;
l_string|&quot;connected. With this option, the detection can be overridden (1=CRT1 ON,&bslash;n&quot;
l_string|&quot; 0=CRT1 off) (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pdc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pdc
comma
l_string|&quot;&bslash;n(300 series only) This is for manually selecting the LCD panel delay&bslash;n&quot;
l_string|&quot;compensation. The driver should detect this correctly in most cases; however,&bslash;n&quot;
l_string|&quot;sometimes this is not possible. If you see &squot;small waves&squot; on the LCD, try&bslash;n&quot;
l_string|&quot;setting this to 4, 32 or 24. If the problem persists, try other values&bslash;n&quot;
l_string|&quot;between 4 and 60 in steps of 4. (default: [autodetected])&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noaccel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;&bslash;nIf set to anything other than 0, 2D acceleration and y-panning will be&bslash;n&quot;
l_string|&quot;disabled. (default: 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noypan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noypan
comma
l_string|&quot;&bslash;nIf set to anything other than 0, y-panning will be disabled and scrolling&bslash;n&quot;
l_string|&quot;will be performed by redrawing the screen. This required 2D acceleration, so&bslash;n&quot;
l_string|&quot;if the option noaccel is set, y-panning will be disabled. (default: 0)&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
id|MODULE_PARM
c_func
(paren
id|inverse
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|inverse
comma
l_string|&quot;&bslash;nSetting this to anything but 0 should invert the display colors, but this&bslash;n&quot;
l_string|&quot;does not seem to work. (default: 0)&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
id|MODULE_PARM
c_func
(paren
id|userom
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|userom
comma
l_string|&quot;&bslash;nSetting this to 0 keeps sisfb from using the video BIOS data which is needed&bslash;n&quot;
l_string|&quot;for some LCD and TV setup. (default: 1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|useoem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|useoem
comma
l_string|&quot;&bslash;nSetting this to 0 keeps sisfb from using its internel OEM data for some LCD&bslash;n&quot;
l_string|&quot;panels and TV connector types. (default: auto)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tvstandard
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tvstandard
comma
l_string|&quot;&bslash;nThis allows overriding the BIOS default for the TV standard. Valid choices are&bslash;n&quot;
l_string|&quot;pal and ntsc. (default: auto)&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|mode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vesa
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|vesa
)paren
suffix:semicolon
)brace
r_else
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
multiline_comment|/* For 2.4, set mode=none if no mode is given  */
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
multiline_comment|/* For 2.5, we don&squot;t need this &quot;mode=none&quot; stuff anymore */
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
macro_line|#endif
id|ivideo.refresh_rate
op_assign
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt2type
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|forcecrt2type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tvstandard
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|tvstandard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|crt1off
op_eq
l_int|0
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sisfb_forcecrt1
op_assign
id|forcecrt1
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|0
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|1
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|0
)paren
(brace
id|sisfb_accel
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noypan
op_eq
l_int|1
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noypan
op_eq
l_int|0
)paren
(brace
id|sisfb_ypan
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* TW: Panning only with acceleration */
r_if
c_cond
(paren
id|sisfb_accel
op_eq
l_int|0
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|mem
)paren
(brace
id|sisfb_mem
op_assign
id|mem
suffix:semicolon
)brace
id|sisfb_userom
op_assign
id|userom
suffix:semicolon
id|sisfb_useoem
op_assign
id|useoem
suffix:semicolon
id|enable_dstn
op_assign
id|dstn
suffix:semicolon
multiline_comment|/* TW: DSTN overrules forcecrt2type */
r_if
c_cond
(paren
id|enable_dstn
)paren
id|sisfb_crt2type
op_assign
id|DISPTYPE_LCD
suffix:semicolon
r_if
c_cond
(paren
id|queuemode
)paren
id|sisfb_search_queuemode
c_func
(paren
id|queuemode
)paren
suffix:semicolon
multiline_comment|/* TW: If other queuemode than MMIO, disable 2D accel and ypan */
r_if
c_cond
(paren
(paren
id|sisfb_queuemode
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|sisfb_queuemode
op_ne
id|MMIO_CMD
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pdc
op_amp
op_complement
l_int|0x3c
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|pdc
op_amp
l_int|0x3c
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* TW: Release mem regions */
id|release_mem_region
c_func
(paren
id|ivideo.video_base
comma
id|ivideo.video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo.mmio_base
comma
id|sisfb_mmio_size
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
multiline_comment|/* TW: Release MTRR region */
r_if
c_cond
(paren
id|ivideo.mtrr
)paren
(brace
id|mtrr_del
c_func
(paren
id|ivideo.mtrr
comma
(paren
r_int
r_int
)paren
id|ivideo.video_base
comma
(paren
r_int
r_int
)paren
id|ivideo.video_size
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Unregister the framebuffer */
r_if
c_cond
(paren
id|sisfb_registered
)paren
(brace
id|unregister_framebuffer
c_func
(paren
op_amp
id|sis_fb_info
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sishw_ext.pSR
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pSR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sishw_ext.pCR
)paren
(brace
id|vfree
c_func
(paren
id|sishw_ext.pCR
)paren
suffix:semicolon
)brace
multiline_comment|/* TODO: Restore the initial mode */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Module unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|sis_malloc
id|EXPORT_SYMBOL
c_func
(paren
id|sis_malloc
)paren
suffix:semicolon
DECL|variable|sis_free
id|EXPORT_SYMBOL
c_func
(paren
id|sis_free
)paren
suffix:semicolon
DECL|variable|sis_dispinfo
id|EXPORT_SYMBOL
c_func
(paren
id|sis_dispinfo
)paren
suffix:semicolon
DECL|variable|ivideo
id|EXPORT_SYMBOL
c_func
(paren
id|ivideo
)paren
suffix:semicolon
eof
