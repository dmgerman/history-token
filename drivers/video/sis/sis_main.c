multiline_comment|/*&n; * SiS 300/305/540/630(S)/730(S)&n; * SiS 315(H/PRO)/55x/(M)65x/(M)661(F/M)X/740/741(GX)/330/(M)760&n; * frame buffer driver for Linux kernels &gt;= 2.4.14 and &gt;=2.6.3&n; *&n; * Copyright (C) 2001-2004 Thomas Winischhofer, Vienna, Austria.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the named License,&n; * or any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA&n; *&n; * Author:   &t;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&n; *&n; * Author of (practically wiped) code base:&n; *&t;&t;SiS (www.sis.com)&n; *&t; &t;Copyright (C) 1999 Silicon Integrated Systems, Inc.&n; *&n; * See http://www.winischhofer.net/ for more information and updates&n; *&n; * Originally based on the VBE 2.0 compliant graphic boards framebuffer driver,&n; * which is (c) 1998 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#endif
macro_line|#include &quot;sis.h&quot;
macro_line|#include &quot;sis_main.h&quot;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,3)
macro_line|#error &quot;This version of sisfb requires at least 2.6.3&quot;
macro_line|#endif
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#ifdef FBCON_HAS_CFB8
r_extern
r_struct
id|display_switch
id|fbcon_sis8
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_extern
r_struct
id|display_switch
id|fbcon_sis16
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_extern
r_struct
id|display_switch
id|fbcon_sis32
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/* ------------------ Internal helper routines ----------------- */
r_static
r_void
id|__init
DECL|function|sisfb_setdefaultparms
id|sisfb_setdefaultparms
c_func
(paren
r_void
)paren
(brace
id|sisfb_off
op_assign
l_int|0
suffix:semicolon
id|sisfb_parm_mem
op_assign
l_int|0
suffix:semicolon
id|sisfb_accel
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_ypan
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_max
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_userom
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_useoem
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/* Module: &quot;None&quot; for 2.4, default mode for 2.5+ */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#endif
macro_line|#else
multiline_comment|/* Static: Default mode */
id|sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
id|sisfb_parm_rate
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
id|sisfb_forcecrt1
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_crt2type
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_crt2flags
op_assign
l_int|0
suffix:semicolon
id|sisfb_pdc
op_assign
l_int|0xff
suffix:semicolon
id|sisfb_pdca
op_assign
l_int|0xff
suffix:semicolon
id|sisfb_scalelcd
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_specialtiming
op_assign
id|CUT_NONE
suffix:semicolon
id|sisfb_lvdshl
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_dstn
op_assign
l_int|0
suffix:semicolon
id|sisfb_fstn
op_assign
l_int|0
suffix:semicolon
id|sisfb_tvplug
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_tvstd
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_tvxposoffset
op_assign
l_int|0
suffix:semicolon
id|sisfb_tvyposoffset
op_assign
l_int|0
suffix:semicolon
id|sisfb_filter
op_assign
op_minus
l_int|1
suffix:semicolon
id|sisfb_nocrt2rate
op_assign
l_int|0
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|sisfb_inverse
op_assign
l_int|0
suffix:semicolon
id|sisfb_fontname
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
id|sisfb_resetcard
op_assign
l_int|0
suffix:semicolon
id|sisfb_videoram
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_static
r_void
id|__init
DECL|function|sisfb_search_vesamode
id|sisfb_search_vesamode
c_func
(paren
r_int
r_int
id|vesamode
comma
id|BOOLEAN
id|quiet
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* BEWARE: We don&squot;t know the hardware specs yet and there is no ivideo */
r_if
c_cond
(paren
id|vesamode
op_eq
l_int|0
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|sisfb_mode_idx
op_assign
id|MODE_INDEX_NONE
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid mode. Using default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|vesamode
op_and_assign
l_int|0x1dff
suffix:semicolon
multiline_comment|/* Clean VESA mode number from other flags */
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
op_increment
)braket
dot
id|mode_no
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|vesa_mode_no_1
op_eq
id|vesamode
)paren
op_logical_or
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|vesa_mode_no_2
op_eq
id|vesamode
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x53
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5b
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
id|sisfb_mode_idx
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|j
)paren
op_logical_and
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid VESA mode 0x%x&squot;&bslash;n&quot;
comma
id|vesamode
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|sisfb_search_mode
id|sisfb_search_mode
c_func
(paren
r_char
op_star
id|name
comma
id|BOOLEAN
id|quiet
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|j
op_assign
l_int|0
comma
id|xres
op_assign
l_int|0
comma
id|yres
op_assign
l_int|0
comma
id|depth
op_assign
l_int|0
comma
id|rate
op_assign
l_int|0
suffix:semicolon
r_char
id|strbuf
(braket
l_int|16
)braket
comma
id|strbuf1
(braket
l_int|20
)braket
suffix:semicolon
r_char
op_star
id|nameptr
op_assign
id|name
suffix:semicolon
multiline_comment|/* BEWARE: We don&squot;t know the hardware specs yet and there is no ivideo */
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Internal error, using default mode.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sisbios_mode
(braket
id|MODE_INDEX_NONE
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|name
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode &squot;none&squot; not supported anymore. Using default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|sisfb_mode_idx
op_assign
id|DEFAULT_MODE
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|name
)paren
op_le
l_int|19
)paren
(brace
id|strcpy
c_func
(paren
id|strbuf1
comma
id|name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strlen
c_func
(paren
id|strbuf1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strbuf1
(braket
id|i
)braket
template_param
l_char|&squot;9&squot;
)paren
(brace
id|strbuf1
(braket
id|i
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
)brace
)brace
multiline_comment|/* This does some fuzzy mode naming detection */
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u %u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
comma
op_amp
id|depth
comma
op_amp
id|rate
)paren
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
(paren
id|rate
op_le
l_int|32
)paren
op_logical_or
(paren
id|depth
OG
l_int|32
)paren
)paren
(brace
id|j
op_assign
id|rate
suffix:semicolon
id|rate
op_assign
id|depth
suffix:semicolon
id|depth
op_assign
id|j
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux%u&quot;
comma
id|xres
comma
id|yres
comma
id|depth
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
id|sisfb_parm_rate
op_assign
id|rate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
comma
op_amp
id|depth
)paren
op_eq
l_int|3
)paren
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux%u&quot;
comma
id|xres
comma
id|yres
comma
id|depth
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
)brace
r_else
(brace
id|xres
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sscanf
c_func
(paren
id|strbuf1
comma
l_string|&quot;%u %u&quot;
comma
op_amp
id|xres
comma
op_amp
id|yres
)paren
op_eq
l_int|2
)paren
op_logical_and
(paren
id|xres
op_ne
l_int|0
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%ux%ux8&quot;
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
id|nameptr
op_assign
id|strbuf
suffix:semicolon
)brace
r_else
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|name
comma
l_int|NULL
comma
l_int|0
)paren
comma
id|quiet
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
id|i
op_assign
l_int|0
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|i
)braket
dot
id|mode_no
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|nameptr
comma
id|sisbios_mode
(braket
id|i
op_increment
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|nameptr
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x53
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|i
op_minus
l_int|1
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5b
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
id|sisfb_mode_idx
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|j
)paren
op_logical_and
op_logical_neg
id|quiet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid mode &squot;%s&squot;&bslash;n&quot;
comma
id|nameptr
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef MODULE
r_static
r_void
id|__devinit
DECL|function|sisfb_get_vga_mode_from_kernel
id|sisfb_get_vga_mode_from_kernel
c_func
(paren
r_void
)paren
(brace
macro_line|#if (defined(__i386__) || defined(__x86_64__)) &amp;&amp; defined(CONFIG_VIDEO_SELECT)
r_char
id|mymode
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|mydepth
op_assign
id|screen_info.lfb_depth
suffix:semicolon
r_if
c_cond
(paren
id|screen_info.orig_video_isVGA
op_ne
id|VIDEO_TYPE_VLFB
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|screen_info.lfb_width
op_ge
l_int|320
)paren
op_logical_and
(paren
id|screen_info.lfb_width
op_le
l_int|2048
)paren
op_logical_and
(paren
id|screen_info.lfb_height
op_ge
l_int|200
)paren
op_logical_and
(paren
id|screen_info.lfb_height
op_le
l_int|1536
)paren
op_logical_and
(paren
id|mydepth
op_ge
l_int|8
)paren
op_logical_and
(paren
id|mydepth
op_le
l_int|32
)paren
)paren
(brace
r_if
c_cond
(paren
id|mydepth
op_eq
l_int|24
)paren
(brace
id|mydepth
op_assign
l_int|32
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|mymode
comma
l_string|&quot;%ux%ux%u&quot;
comma
id|screen_info.lfb_width
comma
id|screen_info.lfb_height
comma
id|mydepth
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Using vga mode %s pre-set by kernel as default&bslash;n&quot;
comma
id|mymode
)paren
suffix:semicolon
id|sisfb_search_mode
c_func
(paren
id|mymode
comma
id|TRUE
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
id|__init
DECL|function|sisfb_search_crt2type
id|sisfb_search_crt2type
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* BEWARE: We don&squot;t know the hardware specs yet and there is no ivideo */
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|sis_crt2type
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|sisfb_crt2type
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
id|sisfb_tvplug
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|tvplug_no
suffix:semicolon
id|sisfb_crt2flags
op_assign
id|sis_crt2type
(braket
id|i
)braket
dot
id|flags
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
id|sisfb_dstn
op_assign
(paren
id|sisfb_crt2flags
op_amp
id|FL_550_DSTN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|sisfb_fstn
op_assign
(paren
id|sisfb_crt2flags
op_amp
id|FL_550_FSTN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_crt2type
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Invalid CRT2 type: %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|sisfb_search_tvstd
id|sisfb_search_tvstd
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* BEWARE: We don&squot;t know the hardware specs yet and there is no ivideo */
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|sis_tvtype
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|sis_tvtype
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
(brace
id|sisfb_tvstd
op_assign
id|sis_tvtype
(braket
id|i
)braket
dot
id|type_no
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|sisfb_search_specialtiming
id|sisfb_search_specialtiming
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|BOOLEAN
id|found
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* BEWARE: We don&squot;t know the hardware specs yet and there is no ivideo */
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
l_string|&quot;none&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_specialtiming
op_assign
id|CUT_FORCENONE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Special timing disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|name
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
)paren
)paren
(brace
id|sisfb_specialtiming
op_assign
id|mycustomttable
(braket
id|i
)braket
dot
id|SpecialID
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Special timing for %s %s forced (&bslash;&quot;%s&bslash;&quot;)&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sisfb: Invalid SpecialTiming parameter, valid are:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;&bslash;t&bslash;&quot;none&bslash;&quot; (to disable special timings)&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;&bslash;t&bslash;&quot;%s&bslash;&quot; (for %s %s)&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
id|BOOLEAN
id|__devinit
DECL|function|sisfb_interpret_edid
id|sisfb_interpret_edid
c_func
(paren
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
id|u8
op_star
id|buffer
)paren
(brace
r_int
id|i
comma
id|j
comma
id|xres
comma
id|yres
comma
id|refresh
comma
id|index
suffix:semicolon
id|u32
id|emodes
suffix:semicolon
r_if
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
op_ne
l_int|0x00
op_logical_or
id|buffer
(braket
l_int|1
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|2
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|3
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|4
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|5
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|6
)braket
op_ne
l_int|0xff
op_logical_or
id|buffer
(braket
l_int|7
)braket
op_ne
l_int|0x00
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Bad EDID header&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0x12
)braket
op_ne
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: EDID version %d not supported&bslash;n&quot;
comma
id|buffer
(braket
l_int|0x12
)braket
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|monitor-&gt;feature
op_assign
id|buffer
(braket
l_int|0x18
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
(braket
l_int|0x14
)braket
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buffer
(braket
l_int|0x14
)braket
op_amp
l_int|0x08
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Monitor does not support separate syncs&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0x13
)braket
op_ge
l_int|0x01
)paren
(brace
multiline_comment|/* EDID V1 rev 1 and 2: Search for monitor descriptor&n;&t;    * to extract ranges&n;&t;    */
id|j
op_assign
l_int|0x36
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|buffer
(braket
id|j
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|1
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|2
)braket
op_eq
l_int|0x00
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|3
)braket
op_eq
l_int|0xfd
op_logical_and
id|buffer
(braket
id|j
op_plus
l_int|4
)braket
op_eq
l_int|0x00
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|buffer
(braket
id|j
op_plus
l_int|7
)braket
suffix:semicolon
id|monitor-&gt;hmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|8
)braket
suffix:semicolon
id|monitor-&gt;vmin
op_assign
id|buffer
(braket
id|j
op_plus
l_int|5
)braket
suffix:semicolon
id|monitor-&gt;vmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|6
)braket
suffix:semicolon
id|monitor-&gt;dclockmax
op_assign
id|buffer
(braket
id|j
op_plus
l_int|9
)braket
op_star
l_int|10
op_star
l_int|1000
suffix:semicolon
id|monitor-&gt;datavalid
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|j
op_add_assign
l_int|18
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|monitor-&gt;datavalid
)paren
(brace
multiline_comment|/* Otherwise: Get a range from the list of supported&n;&t;    * Estabished Timings. This is not entirely accurate,&n;&t;    * because fixed frequency monitors are not supported&n;&t;    * that way.&n;&t;    */
id|monitor-&gt;hmin
op_assign
l_int|65535
suffix:semicolon
id|monitor-&gt;hmax
op_assign
l_int|0
suffix:semicolon
id|monitor-&gt;vmin
op_assign
l_int|65535
suffix:semicolon
id|monitor-&gt;vmax
op_assign
l_int|0
suffix:semicolon
id|monitor-&gt;dclockmax
op_assign
l_int|0
suffix:semicolon
id|emodes
op_assign
id|buffer
(braket
l_int|0x23
)braket
op_or
(paren
id|buffer
(braket
l_int|0x24
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|buffer
(braket
l_int|0x25
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|13
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|emodes
op_amp
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|mask
)paren
(brace
r_if
c_cond
(paren
id|monitor-&gt;hmin
OG
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;hmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|h
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmin
OG
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmin
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;dclockmax
OL
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
)paren
(brace
id|monitor-&gt;dclockmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
suffix:semicolon
)brace
)brace
)brace
id|index
op_assign
l_int|0x26
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|xres
op_assign
(paren
id|buffer
(braket
id|index
)braket
op_plus
l_int|31
)paren
op_star
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|buffer
(braket
id|index
op_plus
l_int|1
)braket
op_amp
l_int|0xc0
)paren
(brace
r_case
l_int|0xc0
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|9
)paren
op_div
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x80
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|4
)paren
op_div
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x40
suffix:colon
id|yres
op_assign
(paren
id|xres
op_star
l_int|3
)paren
op_div
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|yres
op_assign
id|xres
suffix:semicolon
r_break
suffix:semicolon
)brace
id|refresh
op_assign
(paren
id|buffer
(braket
id|index
op_plus
l_int|1
)braket
op_amp
l_int|0x3f
)paren
op_plus
l_int|60
suffix:semicolon
r_if
c_cond
(paren
(paren
id|xres
op_ge
l_int|640
)paren
op_logical_and
(paren
id|yres
op_ge
l_int|480
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|xres
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|x
)paren
op_logical_and
(paren
id|yres
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|y
)paren
op_logical_and
(paren
id|refresh
op_eq
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|v
)paren
)paren
(brace
r_if
c_cond
(paren
id|monitor-&gt;hmin
OG
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmin
op_assign
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;hmax
OL
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
)paren
(brace
id|monitor-&gt;hmax
op_assign
id|sisfb_ddcfmodes
(braket
id|j
)braket
dot
id|h
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmin
OG
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmin
op_assign
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;vmax
OL
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
)paren
(brace
id|monitor-&gt;vmax
op_assign
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monitor-&gt;dclockmax
OL
id|sisfb_ddcsmodes
(braket
id|j
)braket
dot
id|d
)paren
(brace
id|monitor-&gt;dclockmax
op_assign
id|sisfb_ddcsmodes
(braket
id|i
)braket
dot
id|d
suffix:semicolon
)brace
)brace
)brace
)brace
id|index
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|monitor-&gt;hmin
op_le
id|monitor-&gt;hmax
)paren
op_logical_and
(paren
id|monitor-&gt;vmin
op_le
id|monitor-&gt;vmax
)paren
)paren
(brace
id|monitor-&gt;datavalid
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|monitor-&gt;datavalid
suffix:semicolon
)brace
r_static
r_void
id|__devinit
DECL|function|sisfb_handle_ddc
id|sisfb_handle_ddc
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
r_int
id|crtno
)paren
(brace
id|USHORT
id|temp
comma
id|i
comma
id|realcrtno
op_assign
id|crtno
suffix:semicolon
id|u8
id|buffer
(braket
l_int|256
)braket
suffix:semicolon
id|monitor-&gt;datavalid
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|crtno
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|realcrtno
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|realcrtno
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_crt1off
)paren
op_logical_and
(paren
op_logical_neg
id|crtno
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;vbflags
comma
id|ivideo-&gt;sisvga_engine
comma
id|realcrtno
comma
l_int|0
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|temp
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC probing failed&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC supported&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC level: %s%s%s%s&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
comma
(paren
id|temp
op_amp
l_int|0x1a
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;[none of the supported]&quot;
comma
(paren
id|temp
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot;2 &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|temp
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot;D&amp;P&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|temp
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot;FPDI-2&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x02
)paren
(brace
id|i
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Number of retrys */
r_do
(brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;vbflags
comma
id|ivideo-&gt;sisvga_engine
comma
id|realcrtno
comma
l_int|1
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|temp
)paren
op_logical_and
id|i
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
(brace
r_if
c_cond
(paren
id|sisfb_interpret_edid
c_func
(paren
id|monitor
comma
op_amp
id|buffer
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Monitor range H %d-%dKHz, V %d-%dHz, Max. dotclock %dMHz&bslash;n&quot;
comma
id|monitor-&gt;hmin
comma
id|monitor-&gt;hmax
comma
id|monitor-&gt;vmin
comma
id|monitor-&gt;vmax
comma
id|monitor-&gt;dclockmax
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC EDID corrupt&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: CRT%d DDC reading failed&bslash;n&quot;
comma
id|crtno
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: VESA D&amp;P and FPDI-2 not supported yet&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
id|BOOLEAN
DECL|function|sisfb_verify_rate
id|sisfb_verify_rate
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|sisfb_monitor
op_star
id|monitor
comma
r_int
id|mode_idx
comma
r_int
id|rate_idx
comma
r_int
id|rate
)paren
(brace
r_int
id|htotal
comma
id|vtotal
suffix:semicolon
r_int
r_int
id|dclock
comma
id|hsync
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|monitor-&gt;datavalid
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode_idx
OL
l_int|0
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* Skip for 320x200, 320x240, 640x400 */
r_switch
c_cond
(paren
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)paren
(brace
r_case
l_int|0x59
suffix:colon
r_case
l_int|0x41
suffix:colon
r_case
l_int|0x4f
suffix:colon
r_case
l_int|0x50
suffix:colon
r_case
l_int|0x56
suffix:colon
r_case
l_int|0x53
suffix:colon
r_case
l_int|0x2f
suffix:colon
r_case
l_int|0x5d
suffix:colon
r_case
l_int|0x5e
suffix:colon
r_return
id|TRUE
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
l_int|0x5a
suffix:colon
r_case
l_int|0x5b
suffix:colon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|rate
OL
(paren
id|monitor-&gt;vmin
op_minus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rate
OG
(paren
id|monitor-&gt;vmax
op_plus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_gettotalfrommode
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
comma
op_amp
id|htotal
comma
op_amp
id|vtotal
comma
id|rate_idx
)paren
)paren
(brace
id|dclock
op_assign
(paren
id|htotal
op_star
id|vtotal
op_star
id|rate
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|dclock
OG
(paren
id|monitor-&gt;dclockmax
op_plus
l_int|1000
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|hsync
op_assign
id|dclock
op_div
id|htotal
suffix:semicolon
r_if
c_cond
(paren
id|hsync
OL
(paren
id|monitor-&gt;hmin
op_minus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hsync
OG
(paren
id|monitor-&gt;hmax
op_plus
l_int|1
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_validate_mode
id|sisfb_validate_mode
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_int
id|myindex
comma
id|u32
id|vbflags
)paren
(brace
id|u16
id|xres
op_assign
l_int|0
comma
id|yres
comma
id|myres
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS300
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|chipset
op_amp
id|MD_SIS315
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
id|myres
op_assign
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
suffix:semicolon
r_switch
c_cond
(paren
id|vbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_LCD
suffix:colon
id|xres
op_assign
id|ivideo-&gt;lcdxres
suffix:semicolon
id|yres
op_assign
id|ivideo-&gt;lcdyres
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_ne
id|CUT_PANEL848
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
OG
id|xres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|myres
OG
id|yres
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_30xBDH
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
op_eq
l_int|320
)paren
(brace
r_if
c_cond
(paren
(paren
id|myres
op_eq
l_int|240
)paren
op_logical_or
(paren
id|myres
op_eq
l_int|480
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5a
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x5b
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x50
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x56
op_logical_or
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|mode_no
(braket
l_int|1
)braket
op_eq
l_int|0x53
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|SiS_GetModeID_LCD
c_func
(paren
id|ivideo-&gt;sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
comma
id|ivideo-&gt;sisfb_fstn
comma
id|ivideo-&gt;SiS_Pr.SiS_CustomT
comma
id|xres
comma
id|yres
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CRT2_TV
suffix:colon
r_if
c_cond
(paren
id|SiS_GetModeID_TV
c_func
(paren
id|ivideo-&gt;sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CRT2_VGA
suffix:colon
r_if
c_cond
(paren
id|SiS_GetModeID_VGA2
c_func
(paren
id|ivideo-&gt;sisvga_engine
comma
id|vbflags
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|myindex
)braket
dot
id|yres
comma
l_int|0
)paren
OL
l_int|0x14
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|myindex
suffix:semicolon
)brace
r_static
id|u8
DECL|function|sisfb_search_refresh_rate
id|sisfb_search_refresh_rate
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_int
r_int
id|rate
comma
r_int
id|mode_idx
)paren
(brace
id|u16
id|xres
comma
id|yres
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|xres
op_assign
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|xres
suffix:semicolon
id|yres
op_assign
id|sisbios_mode
(braket
id|mode_idx
)braket
dot
id|yres
suffix:semicolon
id|ivideo-&gt;rate_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_le
id|xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|xres
op_eq
id|xres
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|yres
op_eq
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_eq
id|rate
)paren
(brace
id|ivideo-&gt;rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
OG
id|rate
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
op_minus
id|rate
)paren
op_le
l_int|3
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d up to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|ivideo-&gt;rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
id|ivideo-&gt;refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
op_logical_and
(paren
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
op_ne
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
)paren
suffix:semicolon
id|ivideo-&gt;rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|idx
suffix:semicolon
id|ivideo-&gt;refresh_rate
op_assign
id|sisfb_vrate
(braket
id|i
op_minus
l_int|1
)braket
dot
id|refresh
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|rate
op_minus
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
op_le
l_int|2
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Adjusting rate from %d down to %d&bslash;n&quot;
comma
id|rate
comma
id|sisfb_vrate
(braket
id|i
)braket
dot
id|refresh
)paren
suffix:semicolon
id|ivideo-&gt;rate_idx
op_assign
id|sisfb_vrate
(braket
id|i
)braket
dot
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;rate_idx
OG
l_int|0
)paren
(brace
r_return
id|ivideo-&gt;rate_idx
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Unsupported rate %d for %dx%d&bslash;n&quot;
comma
id|rate
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
id|BOOLEAN
DECL|function|sisfb_bridgeisslave
id|sisfb_bridgeisslave
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_int
r_char
id|P1_00
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
id|P1_00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|P1_00
op_amp
l_int|0xa0
)paren
op_eq
l_int|0x20
)paren
op_logical_or
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
id|P1_00
op_amp
l_int|0x50
)paren
op_eq
l_int|0x10
)paren
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_static
id|BOOLEAN
DECL|function|sisfballowretracecrt1
id|sisfballowretracecrt1
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u8
id|temp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp
op_amp
l_int|0x80
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0xc0
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
r_static
id|BOOLEAN
DECL|function|sisfbcheckvretracecrt1
id|sisfbcheckvretracecrt1
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfballowretracecrt1
c_func
(paren
id|ivideo
)paren
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
(brace
r_return
id|TRUE
suffix:semicolon
)brace
r_else
r_return
id|FALSE
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfbwaitretracecrt1
id|sisfbwaitretracecrt1
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_int
id|watchdog
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisfballowretracecrt1
c_func
(paren
id|ivideo
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|watchdog
op_assign
l_int|65536
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
)paren
op_logical_and
op_decrement
id|watchdog
)paren
(brace
suffix:semicolon
)brace
id|watchdog
op_assign
l_int|65536
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
op_amp
l_int|0x08
)paren
op_logical_and
op_decrement
id|watchdog
)paren
(brace
suffix:semicolon
)brace
)brace
r_static
id|BOOLEAN
DECL|function|sisfbcheckvretracecrt2
id|sisfbcheckvretracecrt2
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_int
r_char
id|temp
comma
id|reg
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;sisvga_engine
)paren
(brace
r_case
id|SIS_300_VGA
suffix:colon
id|reg
op_assign
l_int|0x25
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_315_VGA
suffix:colon
id|reg
op_assign
l_int|0x30
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|FALSE
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
id|reg
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x02
)paren
(brace
r_return
id|FALSE
suffix:semicolon
)brace
r_else
r_return
id|TRUE
suffix:semicolon
)brace
r_static
id|BOOLEAN
DECL|function|sisfb_CheckVBRetrace
id|sisfb_CheckVBRetrace
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_if
c_cond
(paren
id|sisfb_bridgeisslave
c_func
(paren
id|ivideo
)paren
)paren
(brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|sisfbcheckvretracecrt2
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
)brace
r_return
id|sisfbcheckvretracecrt1
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
r_static
id|u32
DECL|function|sisfb_setupvbblankflags
id|sisfb_setupvbblankflags
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
id|u32
op_star
id|vcount
comma
id|u32
op_star
id|hcount
)paren
(brace
id|u8
id|idx
comma
id|reg1
comma
id|reg2
comma
id|reg3
comma
id|reg4
suffix:semicolon
id|u32
id|ret
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|vcount
)paren
op_assign
(paren
op_star
id|hcount
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|sisfb_bridgeisslave
c_func
(paren
id|ivideo
)paren
)paren
)paren
)paren
(brace
id|ret
op_or_assign
(paren
id|FB_VBLANK_HAVE_VSYNC
op_or
id|FB_VBLANK_HAVE_HBLANK
op_or
id|FB_VBLANK_HAVE_VBLANK
op_or
id|FB_VBLANK_HAVE_VCOUNT
op_or
id|FB_VBLANK_HAVE_HCOUNT
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;sisvga_engine
)paren
(brace
r_case
id|SIS_300_VGA
suffix:colon
id|idx
op_assign
l_int|0x25
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|SIS_315_VGA
suffix:colon
id|idx
op_assign
l_int|0x30
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
(paren
id|idx
op_plus
l_int|0
)paren
comma
id|reg1
)paren
suffix:semicolon
multiline_comment|/* 30 */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
(paren
id|idx
op_plus
l_int|1
)paren
comma
id|reg2
)paren
suffix:semicolon
multiline_comment|/* 31 */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
(paren
id|idx
op_plus
l_int|2
)paren
comma
id|reg3
)paren
suffix:semicolon
multiline_comment|/* 32 */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
(paren
id|idx
op_plus
l_int|3
)paren
comma
id|reg4
)paren
suffix:semicolon
multiline_comment|/* 33 */
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg1
op_amp
l_int|0x01
)paren
)paren
(brace
id|ret
op_or_assign
id|FB_VBLANK_VBLANKING
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg1
op_amp
l_int|0x02
)paren
)paren
(brace
id|ret
op_or_assign
id|FB_VBLANK_VSYNCING
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg4
op_amp
l_int|0x80
)paren
)paren
(brace
id|ret
op_or_assign
id|FB_VBLANK_HBLANKING
suffix:semicolon
)brace
(paren
op_star
id|vcount
)paren
op_assign
id|reg3
op_or
(paren
(paren
id|reg4
op_amp
l_int|0x70
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
(paren
op_star
id|hcount
)paren
op_assign
id|reg2
op_or
(paren
(paren
id|reg4
op_amp
l_int|0x0f
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sisfballowretracecrt1
c_func
(paren
id|ivideo
)paren
)paren
(brace
id|ret
op_or_assign
(paren
id|FB_VBLANK_HAVE_VSYNC
op_or
id|FB_VBLANK_HAVE_VBLANK
op_or
id|FB_VBLANK_HAVE_VCOUNT
op_or
id|FB_VBLANK_HAVE_HCOUNT
)paren
suffix:semicolon
id|reg1
op_assign
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg1
op_amp
l_int|0x08
)paren
(brace
id|ret
op_or_assign
id|FB_VBLANK_VSYNCING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reg1
op_amp
l_int|0x01
)paren
(brace
id|ret
op_or_assign
id|FB_VBLANK_VBLANKING
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x20
comma
id|reg1
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x1b
comma
id|reg1
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x1c
comma
id|reg2
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x1d
comma
id|reg3
)paren
suffix:semicolon
(paren
op_star
id|vcount
)paren
op_assign
id|reg2
op_or
(paren
(paren
id|reg3
op_amp
l_int|0x07
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
(paren
op_star
id|hcount
)paren
op_assign
(paren
id|reg1
op_or
(paren
(paren
id|reg3
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
)paren
op_lshift
l_int|3
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_myblank
id|sisfb_myblank
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_int
id|blank
)paren
(brace
id|u8
id|sr01
comma
id|sr11
comma
id|sr1f
comma
id|cr63
op_assign
l_int|0
comma
id|p2_0
comma
id|p1_13
suffix:semicolon
id|BOOLEAN
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* on */
id|sr01
op_assign
l_int|0x00
suffix:semicolon
id|sr11
op_assign
l_int|0x00
suffix:semicolon
id|sr1f
op_assign
l_int|0x00
suffix:semicolon
id|cr63
op_assign
l_int|0x00
suffix:semicolon
id|p2_0
op_assign
l_int|0x20
suffix:semicolon
id|p1_13
op_assign
l_int|0x00
suffix:semicolon
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* blank */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x00
suffix:semicolon
id|sr1f
op_assign
l_int|0x00
suffix:semicolon
id|cr63
op_assign
l_int|0x00
suffix:semicolon
id|p2_0
op_assign
l_int|0x20
suffix:semicolon
id|p1_13
op_assign
l_int|0x00
suffix:semicolon
id|backlight
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* no vsync */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0x80
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0x40
suffix:semicolon
id|p1_13
op_assign
l_int|0x80
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* no hsync */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0x40
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0x80
suffix:semicolon
id|p1_13
op_assign
l_int|0x40
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* off */
id|sr01
op_assign
l_int|0x20
suffix:semicolon
id|sr11
op_assign
l_int|0x08
suffix:semicolon
id|sr1f
op_assign
l_int|0xc0
suffix:semicolon
id|cr63
op_assign
l_int|0x40
suffix:semicolon
id|p2_0
op_assign
l_int|0xc0
suffix:semicolon
id|p1_13
op_assign
l_int|0xc0
suffix:semicolon
id|backlight
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_CRT1
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|ivideo-&gt;sisfb_thismonitor.datavalid
)paren
op_logical_or
(paren
(paren
id|ivideo-&gt;sisfb_thismonitor.datavalid
)paren
op_logical_and
(paren
id|ivideo-&gt;sisfb_thismonitor.feature
op_amp
l_int|0xe0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
comma
l_int|0xbf
comma
id|cr63
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisfb_bridgeisslave
c_func
(paren
id|ivideo
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
op_complement
l_int|0x20
comma
id|sr01
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
l_int|0x3f
comma
id|sr1f
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_LCD
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_if
c_cond
(paren
id|backlight
)paren
(brace
id|SiS_SiS30xBLOn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SiS30xBLOff
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
r_if
c_cond
(paren
id|backlight
)paren
(brace
id|SiS_Chrontel701xBLOn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_Chrontel701xBLOff
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_30xBDH
op_or
id|VB_LVDS
)paren
)paren
)paren
op_logical_or
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
)paren
op_eq
id|VB_LVDS
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
op_complement
l_int|0x0c
comma
id|sr11
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_30xBDH
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
l_int|0x3f
comma
id|p1_13
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_30xBDH
)paren
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1f
comma
id|p2_0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1f
comma
id|p2_0
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------- FBDev related routines for all series ----------- */
r_static
r_int
DECL|function|sisfb_get_cmap_len
id|sisfb_get_cmap_len
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_return
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|8
)paren
ques
c_cond
l_int|256
suffix:colon
l_int|16
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_set_vparms
id|sisfb_set_vparms
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_switch
c_cond
(paren
id|ivideo-&gt;video_bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|ivideo-&gt;DstColor
op_assign
l_int|0x0000
suffix:semicolon
id|ivideo-&gt;SiS310_AccelDepth
op_assign
l_int|0x00000000
suffix:semicolon
id|ivideo-&gt;video_cmap_len
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|ivideo-&gt;DstColor
op_assign
l_int|0x8000
suffix:semicolon
id|ivideo-&gt;SiS310_AccelDepth
op_assign
l_int|0x00010000
suffix:semicolon
id|ivideo-&gt;video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|ivideo-&gt;DstColor
op_assign
l_int|0xC000
suffix:semicolon
id|ivideo-&gt;SiS310_AccelDepth
op_assign
l_int|0x00020000
suffix:semicolon
id|ivideo-&gt;video_cmap_len
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo-&gt;video_cmap_len
op_assign
l_int|16
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Unsupported depth %d&quot;
comma
id|ivideo-&gt;video_bpp
)paren
suffix:semicolon
id|ivideo-&gt;accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sisfb_calc_maxyres
id|sisfb_calc_maxyres
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|maxyres
op_assign
id|ivideo-&gt;heapstart
op_div
(paren
id|var-&gt;xres_virtual
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxyres
OG
l_int|32767
)paren
(brace
id|maxyres
op_assign
l_int|32767
suffix:semicolon
)brace
r_return
id|maxyres
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_calc_pitch
id|sisfb_calc_pitch
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|ivideo-&gt;video_linelength
op_assign
id|var-&gt;xres_virtual
op_star
(paren
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
)paren
suffix:semicolon
id|ivideo-&gt;scrnpitchCRT1
op_assign
id|ivideo-&gt;video_linelength
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT1_LCDA
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|ivideo-&gt;scrnpitchCRT1
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|sisfb_set_pitch
id|sisfb_set_pitch
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|BOOLEAN
id|isslavemode
op_assign
id|FALSE
suffix:semicolon
r_int
r_int
id|HDisplay1
op_assign
id|ivideo-&gt;scrnpitchCRT1
op_rshift
l_int|3
suffix:semicolon
r_int
r_int
id|HDisplay2
op_assign
id|ivideo-&gt;video_linelength
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_bridgeisslave
c_func
(paren
id|ivideo
)paren
)paren
(brace
id|isslavemode
op_assign
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* We need to set pitch for CRT1 if bridge is in slave mode, too */
r_if
c_cond
(paren
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP1
)paren
op_logical_or
(paren
id|isslavemode
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x13
comma
(paren
id|HDisplay1
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0E
comma
l_int|0xF0
comma
(paren
id|HDisplay1
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* We must not set the pitch for CRT2 if bridge is in slave mode */
r_if
c_cond
(paren
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
op_logical_and
(paren
op_logical_neg
id|isslavemode
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|ivideo-&gt;CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x07
comma
(paren
id|HDisplay2
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x09
comma
l_int|0xF0
comma
(paren
id|HDisplay2
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|sisfb_bpp_to_var
id|sisfb_bpp_to_var
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|ivideo-&gt;video_cmap_len
op_assign
id|sisfb_get_cmap_len
c_func
(paren
id|var
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sisfb_do_set_var
id|sisfb_do_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_int
id|htotal
op_assign
l_int|0
comma
id|vtotal
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|old_mode
suffix:semicolon
id|u32
id|pixclock
suffix:semicolon
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Invalid &squot;var&squot; information&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pixclock
op_logical_and
id|htotal
op_logical_and
id|vtotal
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|ivideo-&gt;refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|old_mode
op_assign
id|ivideo-&gt;sisfb_mode_idx
suffix:semicolon
id|ivideo-&gt;sisfb_mode_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
id|ivideo-&gt;mode_no
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
suffix:semicolon
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ivideo-&gt;sisfb_mode_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;sisfb_mode_idx
comma
id|ivideo-&gt;currentvbflags
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;sisfb_mode_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_mode_idx
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Mode %dx%dx%d not supported&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|old_mode
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;refresh_rate
comma
id|ivideo-&gt;sisfb_mode_idx
)paren
op_eq
l_int|0
)paren
(brace
id|ivideo-&gt;rate_idx
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo-&gt;refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;sisfb_thismonitor
comma
id|ivideo-&gt;sisfb_mode_idx
comma
id|ivideo-&gt;rate_idx
comma
id|ivideo-&gt;refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
op_logical_and
id|isactive
)paren
(brace
macro_line|#else
r_if
c_cond
(paren
id|isactive
)paren
(brace
macro_line|#endif
id|sisfb_pre_setmode
c_func
(paren
id|ivideo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|ivideo-&gt;mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|ivideo-&gt;mode_no
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|ivideo-&gt;video_bpp
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo-&gt;video_width
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo-&gt;video_height
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_calc_pitch
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
id|sisfb_set_pitch
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|ivideo-&gt;accel
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined(FBINFO_HWACCEL_DISABLED) &amp;&amp; defined(FBINFO_HWACCEL_XPAN)
macro_line|#ifdef STUPID_ACCELF_TEXT_SHIT
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_HWACCEL_DISABLED
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;flags
op_or_assign
id|FBINFO_HWACCEL_DISABLED
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
id|ivideo-&gt;accel
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|ivideo-&gt;accel
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|sisfb_set_vparms
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|ivideo-&gt;current_width
op_assign
id|ivideo-&gt;video_width
suffix:semicolon
id|ivideo-&gt;current_height
op_assign
id|ivideo-&gt;video_height
suffix:semicolon
id|ivideo-&gt;current_bpp
op_assign
id|ivideo-&gt;video_bpp
suffix:semicolon
id|ivideo-&gt;current_htotal
op_assign
id|htotal
suffix:semicolon
id|ivideo-&gt;current_vtotal
op_assign
id|vtotal
suffix:semicolon
id|ivideo-&gt;current_linelength
op_assign
id|ivideo-&gt;video_linelength
suffix:semicolon
id|ivideo-&gt;current_pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
id|ivideo-&gt;current_refresh_rate
op_assign
id|ivideo-&gt;refresh_rate
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|ivideo-&gt;sisfb_lastrates
(braket
id|ivideo-&gt;mode_no
)braket
op_assign
id|ivideo-&gt;refresh_rate
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_pan_var
id|sisfb_pan_var
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
r_int
id|base
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
(paren
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
)paren
op_plus
id|var-&gt;xoffset
suffix:semicolon
multiline_comment|/* calculate base bpp dep. */
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|32
suffix:colon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|base
op_rshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_default
suffix:colon
id|base
op_rshift_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0D
comma
id|base
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x0C
comma
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0D
comma
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x37
comma
l_int|0xFE
comma
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|ivideo-&gt;CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x06
comma
(paren
id|base
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x05
comma
(paren
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x04
comma
(paren
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
l_int|0x7F
comma
(paren
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------ FBDev related routines for 2.4 series ----------- */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_static
r_void
DECL|function|sisfb_crtc_to_var
id|sisfb_crtc_to_var
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u16
id|VRE
comma
id|VBE
comma
id|VRS
comma
id|VBS
comma
id|VDE
comma
id|VT
suffix:semicolon
id|u16
id|HRE
comma
id|HBE
comma
id|HRS
comma
id|HBS
comma
id|HDE
comma
id|HT
suffix:semicolon
id|u8
id|sr_data
comma
id|cr_data
comma
id|cr_data2
comma
id|cr_data3
comma
id|mr_data
suffix:semicolon
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|F
comma
id|temp
suffix:semicolon
r_int
r_int
id|hrate
comma
id|drate
comma
id|maxyres
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_COLOR_MODE
comma
id|sr_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sr_data
op_amp
id|SIS_INTERLACED_MODE
)paren
(brace
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
)brace
r_else
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|sr_data
op_amp
l_int|0x1C
)paren
op_rshift
l_int|2
)paren
(brace
r_case
id|SIS_8BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_16BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_32BPP_COLOR_MODE
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sisfb_bpp_to_var
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0A
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x06
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x07
comma
id|cr_data2
)paren
suffix:semicolon
id|VT
op_assign
(paren
id|cr_data
op_amp
l_int|0xFF
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x01
)paren
op_lshift
l_int|10
)paren
suffix:semicolon
id|A
op_assign
id|VT
op_plus
l_int|2
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x12
comma
id|cr_data
)paren
suffix:semicolon
id|VDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x40
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x02
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|E
op_assign
id|VDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x10
comma
id|cr_data
)paren
suffix:semicolon
id|VRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x04
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x08
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|F
op_assign
id|VRS
op_plus
l_int|1
op_minus
id|E
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x15
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x09
comma
id|cr_data3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr_data3
op_amp
l_int|0x80
)paren
(brace
id|var-&gt;vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
)brace
id|VBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x08
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data3
op_amp
l_int|0x20
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x16
comma
id|cr_data
)paren
suffix:semicolon
id|VBE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_assign
id|VBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|511
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|512
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x11
comma
id|cr_data
)paren
suffix:semicolon
id|VRE
op_assign
(paren
id|cr_data
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x20
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|VRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_minus
l_int|1
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|32
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;yres
op_assign
id|E
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|D
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|F
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|C
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|var-&gt;yres
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;upper_margin
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;lower_margin
op_lshift_assign
l_int|1
suffix:semicolon
id|var-&gt;vsync_len
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;yres
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;upper_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;lower_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;vsync_len
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0b
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x00
comma
id|cr_data
)paren
suffix:semicolon
id|HT
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|A
op_assign
id|HT
op_plus
l_int|5
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x01
comma
id|cr_data
)paren
suffix:semicolon
id|HDE
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x0C
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|E
op_assign
id|HDE
op_plus
l_int|1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x04
comma
id|cr_data
)paren
suffix:semicolon
id|HRS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0xC0
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|F
op_assign
id|HRS
op_minus
id|E
op_minus
l_int|3
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x02
comma
id|cr_data
)paren
suffix:semicolon
id|HBS
op_assign
(paren
id|cr_data
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x0c
comma
id|sr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x03
comma
id|cr_data
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x05
comma
id|cr_data2
)paren
suffix:semicolon
id|HBE
op_assign
(paren
id|cr_data
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|cr_data2
op_amp
l_int|0x80
)paren
op_rshift
l_int|2
)paren
op_or
(paren
(paren
id|u16
)paren
(paren
id|sr_data
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|HRE
op_assign
(paren
id|cr_data2
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
id|sr_data
op_amp
l_int|0x04
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|temp
op_assign
id|HBE
op_minus
(paren
(paren
id|E
op_minus
l_int|1
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|B
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|256
)paren
suffix:semicolon
id|temp
op_assign
id|HRE
op_minus
(paren
(paren
id|E
op_plus
id|F
op_plus
l_int|3
)paren
op_amp
l_int|63
)paren
suffix:semicolon
id|C
op_assign
(paren
id|temp
OG
l_int|0
)paren
ques
c_cond
id|temp
suffix:colon
(paren
id|temp
op_plus
l_int|64
)paren
suffix:semicolon
id|D
op_assign
id|B
op_minus
id|F
op_minus
id|C
suffix:semicolon
id|var-&gt;xres
op_assign
id|E
op_star
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
)paren
(brace
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_eq
l_int|320
)paren
op_logical_and
(paren
id|var-&gt;yres
op_eq
l_int|200
op_logical_or
id|var-&gt;yres
op_eq
l_int|240
)paren
)paren
(brace
multiline_comment|/* Terrible hack, but the correct CRTC data for&n;&t;  &t; * these modes only produces a black screen...&n;&t;  &t; */
id|var-&gt;left_margin
op_assign
(paren
l_int|400
op_minus
l_int|376
)paren
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
l_int|328
op_minus
l_int|320
)paren
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
l_int|376
op_minus
l_int|328
)paren
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;left_margin
op_assign
id|D
op_star
l_int|8
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|F
op_star
l_int|8
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|C
op_star
l_int|8
suffix:semicolon
)brace
id|var-&gt;activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|mr_data
op_assign
id|inSISREG
c_func
(paren
id|SISMISCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x80
)paren
(brace
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
)brace
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|mr_data
op_amp
l_int|0x40
)paren
(brace
id|var-&gt;sync
op_and_assign
op_complement
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
)brace
r_else
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
id|VT
op_add_assign
l_int|2
suffix:semicolon
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
id|HT
op_assign
(paren
id|HT
op_plus
l_int|5
)paren
op_star
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|VT
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|hrate
op_assign
id|ivideo-&gt;refresh_rate
op_star
id|VT
op_div
l_int|2
suffix:semicolon
id|drate
op_assign
(paren
id|hrate
op_star
id|HT
)paren
op_div
l_int|1000
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|drate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_ypan
)paren
(brace
id|maxyres
op_assign
id|sisfb_calc_maxyres
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_max
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OG
id|maxyres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sis_getcolreg
id|sis_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo-&gt;video_cmap_len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
op_star
id|red
op_assign
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_setcolreg
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|ivideo-&gt;video_cmap_len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|ivideo-&gt;sis_palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|ivideo-&gt;sis_fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|ivideo-&gt;sis_fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_set_disp
id|sisfb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_struct
id|display_switch
op_star
id|sw
suffix:semicolon
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|display
op_assign
(paren
id|con
op_ge
l_int|0
)paren
ques
c_cond
op_amp
id|fb_display
(braket
id|con
)braket
suffix:colon
op_amp
id|ivideo-&gt;sis_disp
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|con
comma
id|info
)paren
suffix:semicolon
id|display-&gt;var
op_assign
op_star
id|var
suffix:semicolon
id|display-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|ivideo-&gt;video_vbase
suffix:semicolon
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;line_length
op_assign
id|fix.line_length
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|ivideo-&gt;sisfb_inverse
suffix:semicolon
id|display-&gt;next_line
op_assign
id|fix.line_length
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;video_bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|sw
op_assign
id|ivideo-&gt;accel
ques
c_cond
op_amp
id|fbcon_sis8
suffix:colon
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|sw
op_assign
id|ivideo-&gt;accel
ques
c_cond
op_amp
id|fbcon_sis16
suffix:colon
op_amp
id|fbcon_cfb16
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
op_amp
id|ivideo-&gt;sis_fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|sw
op_assign
id|ivideo-&gt;accel
ques
c_cond
op_amp
id|fbcon_sis32
suffix:colon
op_amp
id|fbcon_cfb32
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
op_amp
id|ivideo-&gt;sis_fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|sw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|ivideo-&gt;sisfb_sw
comma
id|sw
comma
r_sizeof
(paren
op_star
id|sw
)paren
)paren
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|ivideo-&gt;sisfb_sw
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_ypan
)paren
(brace
multiline_comment|/* display-&gt;scrollmode = 0;  */
)brace
r_else
(brace
id|display-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
id|ivideo-&gt;sisfb_sw.bmove
op_assign
id|fbcon_redraw_bmove
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|sisfb_do_install_cmap
id|sisfb_do_install_cmap
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ne
id|ivideo-&gt;currcon
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
id|fb_set_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|size
op_assign
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
id|fb_set_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|size
)paren
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sisfb_get_var
id|sisfb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|ivideo-&gt;default_var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_fstn
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|320
op_logical_and
id|var-&gt;yres
op_eq
l_int|480
)paren
(brace
id|var-&gt;yres
op_assign
l_int|240
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_set_var
id|sisfb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_do_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|ivideo-&gt;currcon
comma
id|info
)paren
)paren
(brace
id|sisfb_crtc_to_var
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sisfb_crtc_to_var
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
id|var
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;changevar
)paren
(brace
(paren
op_star
id|info-&gt;changevar
)paren
(paren
id|con
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
macro_line|#if 0&t;/* Why was this called here? */
r_int
r_int
id|cols
comma
id|rows
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_get_cmap
id|sisfb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
id|display
op_assign
(paren
id|con
op_ge
l_int|0
)paren
ques
c_cond
op_amp
id|fb_display
(braket
id|con
)braket
suffix:colon
op_amp
id|ivideo-&gt;sis_disp
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|ivideo-&gt;currcon
)paren
(brace
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|display-&gt;cmap.len
)paren
(brace
id|fb_copy_cmap
c_func
(paren
op_amp
id|display-&gt;cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|size
op_assign
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|display-&gt;var
)paren
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|size
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_set_cmap
id|sisfb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
r_int
id|err
comma
id|size
suffix:semicolon
id|display
op_assign
(paren
id|con
op_ge
l_int|0
)paren
ques
c_cond
op_amp
id|fb_display
(braket
id|con
)braket
suffix:colon
op_amp
id|ivideo-&gt;sis_disp
suffix:semicolon
id|size
op_assign
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|display-&gt;var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|display-&gt;cmap.len
op_ne
id|size
)paren
(brace
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|display-&gt;cmap
comma
id|size
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|con
op_eq
id|ivideo-&gt;currcon
)paren
(brace
r_return
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|sisfb_setcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
(brace
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|display-&gt;cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_pan_display
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;xoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.xres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.xres_virtual
)paren
op_logical_or
(paren
id|var-&gt;yoffset
op_plus
id|fb_display
(braket
id|con
)braket
dot
id|var.yres
OG
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|ivideo-&gt;currcon
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|ivideo
comma
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_update_var
id|sisfb_update_var
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sisfb_pan_var
c_func
(paren
id|ivideo
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_switch
id|sisfb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|cols
comma
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|ivideo-&gt;currcon
)braket
dot
id|cmap.len
)paren
(brace
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|ivideo-&gt;currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|sis_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
id|fb_display
(braket
id|con
)braket
dot
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|fb_display
(braket
id|ivideo-&gt;currcon
)braket
dot
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
id|ivideo-&gt;currcon
op_assign
id|con
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ivideo-&gt;currcon
op_assign
id|con
suffix:semicolon
id|sisfb_do_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
id|con
comma
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
id|info
)paren
suffix:semicolon
id|sisfb_do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|cols
suffix:semicolon
id|rows
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|rows
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|rows
comma
id|cols
comma
id|fb_display
(braket
id|con
)braket
dot
id|conp-&gt;vc_num
)paren
suffix:semicolon
id|sisfb_update_var
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_blank
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|sisfb_myblank
c_func
(paren
id|ivideo
comma
id|blank
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ------------ FBDev related routines for 2.6 series ----------- */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
r_static
r_int
DECL|function|sisfb_open
id|sisfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_release
id|sisfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_setcolreg
id|sisfb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|sisfb_get_cmap_len
c_func
(paren
op_amp
id|info-&gt;var
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|outSISREG
c_func
(paren
id|SISDACA
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|red
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|green
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDACD
comma
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
id|outSISREG
c_func
(paren
id|SISDAC2A
comma
id|regno
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|red
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|green
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISDAC2D
comma
(paren
id|blue
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_set_par
id|sisfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_do_set_var
c_func
(paren
op_amp
id|info-&gt;var
comma
l_int|1
comma
id|info
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,10)
id|sisfb_get_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
id|info-&gt;currcon
comma
id|info
)paren
suffix:semicolon
macro_line|#else
id|sisfb_get_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
op_minus
l_int|1
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_check_var
id|sisfb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_int
id|htotal
op_assign
l_int|0
comma
id|vtotal
op_assign
l_int|0
comma
id|myrateindex
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|drate
op_assign
l_int|0
comma
id|hrate
op_assign
l_int|0
comma
id|maxyres
suffix:semicolon
r_int
id|found_mode
op_assign
l_int|0
suffix:semicolon
r_int
id|refresh_rate
comma
id|search_idx
suffix:semicolon
id|BOOLEAN
id|recalc_clock
op_assign
id|FALSE
suffix:semicolon
id|u32
id|pixclock
suffix:semicolon
id|htotal
op_assign
id|var-&gt;left_margin
op_plus
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|vtotal
op_assign
id|var-&gt;upper_margin
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_NONINTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|vtotal
op_add_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|htotal
)paren
op_logical_or
op_logical_neg
(paren
id|vtotal
)paren
)paren
(brace
id|SISFAIL
c_func
(paren
l_string|&quot;sisfb: no valid timing data&quot;
)paren
suffix:semicolon
)brace
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_le
id|var-&gt;xres
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
op_eq
id|var-&gt;xres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
op_eq
id|var-&gt;yres
)paren
op_logical_and
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
op_eq
id|var-&gt;bits_per_pixel
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|ivideo
comma
id|search_idx
comma
id|ivideo-&gt;currentvbflags
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found_mode
)paren
(brace
id|search_idx
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|var-&gt;xres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
)paren
op_logical_and
(paren
id|var-&gt;yres
op_le
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
op_eq
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|bpp
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_validate_mode
c_func
(paren
id|ivideo
comma
id|search_idx
comma
id|ivideo-&gt;currentvbflags
)paren
OG
l_int|0
)paren
(brace
id|found_mode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|search_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found_mode
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Adapted from %dx%dx%d to %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|var-&gt;xres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|yres
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Failed to find supported mode near %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_LVDS
)paren
op_logical_or
multiline_comment|/* Slave modes on LVDS and 301B-DH */
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_30xBDH
)paren
op_logical_and
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_LCD
)paren
)paren
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|8
)paren
)paren
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo-&gt;current_htotal
op_eq
id|htotal
)paren
op_logical_and
multiline_comment|/* x=x &amp; y=y &amp; c=c -&gt; assume depth change */
(paren
id|ivideo-&gt;current_vtotal
op_eq
id|vtotal
)paren
op_logical_and
(paren
id|ivideo-&gt;current_pixclock
op_eq
id|pixclock
)paren
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|ivideo-&gt;current_htotal
op_ne
id|htotal
)paren
op_logical_or
multiline_comment|/* x!=x | y!=y &amp; c=c -&gt; invalid pixclock */
(paren
id|ivideo-&gt;current_vtotal
op_ne
id|vtotal
)paren
)paren
op_logical_and
(paren
id|ivideo-&gt;current_pixclock
op_eq
id|var-&gt;pixclock
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_lastrates
(braket
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)braket
)paren
(brace
id|refresh_rate
op_assign
id|ivideo-&gt;sisfb_lastrates
(braket
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_parm_rate
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Sic, sisfb_parm_rate - want to know originally desired rate here */
id|refresh_rate
op_assign
id|ivideo-&gt;sisfb_parm_rate
suffix:semicolon
)brace
r_else
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pixclock
)paren
op_logical_and
(paren
id|htotal
)paren
op_logical_and
(paren
id|vtotal
)paren
)paren
(brace
id|drate
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
id|hrate
op_assign
(paren
id|drate
op_star
l_int|1000
)paren
op_div
id|htotal
suffix:semicolon
id|refresh_rate
op_assign
(paren
r_int
r_int
)paren
(paren
id|hrate
op_star
l_int|2
op_div
id|vtotal
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;current_refresh_rate
)paren
(brace
id|refresh_rate
op_assign
id|ivideo-&gt;current_refresh_rate
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|refresh_rate
op_assign
l_int|60
suffix:semicolon
id|recalc_clock
op_assign
id|TRUE
suffix:semicolon
)brace
id|myrateindex
op_assign
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo
comma
id|refresh_rate
comma
id|search_idx
)paren
suffix:semicolon
multiline_comment|/* Eventually recalculate timing and clock */
r_if
c_cond
(paren
id|recalc_clock
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|myrateindex
)paren
(brace
id|myrateindex
op_assign
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|rate_idx
suffix:semicolon
)brace
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|sisfb_mode_rate_to_dclock
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
comma
id|myrateindex
)paren
)paren
suffix:semicolon
id|sisfb_mode_rate_to_ddata
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|sisbios_mode
(braket
id|search_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
comma
id|myrateindex
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;pixclock
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;sisfb_thismonitor
comma
id|search_idx
comma
id|myrateindex
comma
id|refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Adapt RGB settings */
id|sisfb_bpp_to_var
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
multiline_comment|/* Sanity check for offsets */
r_if
c_cond
(paren
id|var-&gt;xoffset
OL
l_int|0
)paren
(brace
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
)paren
(brace
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;xres
OG
id|var-&gt;xres_virtual
)paren
(brace
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_ypan
)paren
(brace
id|maxyres
op_assign
id|sisfb_calc_maxyres
c_func
(paren
id|ivideo
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_max
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OG
id|maxyres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|maxyres
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;yres
op_ne
id|var-&gt;yres_virtual
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
)brace
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Truncate offsets to maximum if too high */
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
(brace
id|var-&gt;xoffset
op_assign
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
(brace
id|var-&gt;yoffset
op_assign
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set everything else to 0 */
id|var-&gt;red.msb_right
op_assign
id|var-&gt;green.msb_right
op_assign
id|var-&gt;blue.msb_right
op_assign
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_pan_display
id|sisfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|info-&gt;var.xres
OG
id|info-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|info-&gt;var.yres
OG
id|info-&gt;var.yres_virtual
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sisfb_pan_var
c_func
(paren
id|ivideo
comma
id|var
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_blank
id|sisfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sisfb_myblank
c_func
(paren
id|ivideo
comma
id|blank
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ----------- FBDev related routines for all series ---------- */
r_static
r_int
DECL|function|sisfb_ioctl
id|sisfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_int
id|con
comma
macro_line|#endif
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|sis_memreq
id|sismemreq
suffix:semicolon
r_struct
id|fb_vblank
id|sisvbblank
suffix:semicolon
id|sisfb_info
id|x
suffix:semicolon
id|u32
id|gpu32
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|u32
id|__user
op_star
id|argp
op_assign
(paren
id|u32
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIO_ALLOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|sismemreq
comma
id|argp
comma
r_sizeof
(paren
id|sismemreq
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sis_malloc
c_func
(paren
op_amp
id|sismemreq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|sismemreq
comma
r_sizeof
(paren
id|sismemreq
)paren
)paren
)paren
(brace
id|sis_free
c_func
(paren
(paren
id|u32
)paren
id|sismemreq.offset
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FBIO_FREE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|gpu32
comma
id|argp
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sis_free
c_func
(paren
id|gpu32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIOGET_VBLANK
suffix:colon
id|sisvbblank.count
op_assign
l_int|0
suffix:semicolon
id|sisvbblank.flags
op_assign
id|sisfb_setupvbblankflags
c_func
(paren
id|ivideo
comma
op_amp
id|sisvbblank.vcount
comma
op_amp
id|sisvbblank.hcount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|sisvbblank
comma
r_sizeof
(paren
id|sisvbblank
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SISFB_GET_INFO_SIZE
suffix:colon
r_return
id|put_user
c_func
(paren
r_sizeof
(paren
id|sisfb_info
)paren
comma
id|argp
)paren
suffix:semicolon
r_case
id|SISFB_GET_INFO_OLD
suffix:colon
r_if
c_cond
(paren
op_increment
id|count
OL
l_int|50
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Deprecated ioctl call received - update your application!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_case
id|SISFB_GET_INFO
suffix:colon
multiline_comment|/* For communication with X driver */
id|x.sisfb_id
op_assign
id|SISFB_ID
suffix:semicolon
id|x.sisfb_version
op_assign
id|VER_MAJOR
suffix:semicolon
id|x.sisfb_revision
op_assign
id|VER_MINOR
suffix:semicolon
id|x.sisfb_patchlevel
op_assign
id|VER_LEVEL
suffix:semicolon
id|x.chip_id
op_assign
id|ivideo-&gt;chip_id
suffix:semicolon
id|x.memory
op_assign
id|ivideo-&gt;video_size
op_div
l_int|1024
suffix:semicolon
id|x.heapstart
op_assign
id|ivideo-&gt;heapstart
op_div
l_int|1024
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;modechanged
)paren
(brace
id|x.fbvidmode
op_assign
id|ivideo-&gt;mode_no
suffix:semicolon
)brace
r_else
(brace
id|x.fbvidmode
op_assign
id|ivideo-&gt;modeprechange
suffix:semicolon
)brace
id|x.sisfb_caps
op_assign
id|ivideo-&gt;caps
suffix:semicolon
id|x.sisfb_tqlen
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* yet fixed */
id|x.sisfb_pcibus
op_assign
id|ivideo-&gt;pcibus
suffix:semicolon
id|x.sisfb_pcislot
op_assign
id|ivideo-&gt;pcislot
suffix:semicolon
id|x.sisfb_pcifunc
op_assign
id|ivideo-&gt;pcifunc
suffix:semicolon
id|x.sisfb_lcdpdc
op_assign
id|ivideo-&gt;detectedpdc
suffix:semicolon
id|x.sisfb_lcdpdca
op_assign
id|ivideo-&gt;detectedpdca
suffix:semicolon
id|x.sisfb_lcda
op_assign
id|ivideo-&gt;detectedlcda
suffix:semicolon
id|x.sisfb_vbflags
op_assign
id|ivideo-&gt;vbflags
suffix:semicolon
id|x.sisfb_currentvbflags
op_assign
id|ivideo-&gt;currentvbflags
suffix:semicolon
id|x.sisfb_scalelcd
op_assign
id|ivideo-&gt;SiS_Pr.UsePanelScaler
suffix:semicolon
id|x.sisfb_specialtiming
op_assign
id|ivideo-&gt;SiS_Pr.SiS_CustomT
suffix:semicolon
id|x.sisfb_haveemi
op_assign
id|ivideo-&gt;SiS_Pr.HaveEMI
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|x.sisfb_haveemilcd
op_assign
id|ivideo-&gt;SiS_Pr.HaveEMILCD
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|x.sisfb_emi30
op_assign
id|ivideo-&gt;SiS_Pr.EMI_30
suffix:semicolon
id|x.sisfb_emi31
op_assign
id|ivideo-&gt;SiS_Pr.EMI_31
suffix:semicolon
id|x.sisfb_emi32
op_assign
id|ivideo-&gt;SiS_Pr.EMI_32
suffix:semicolon
id|x.sisfb_emi33
op_assign
id|ivideo-&gt;SiS_Pr.EMI_33
suffix:semicolon
id|x.sisfb_tvxpos
op_assign
(paren
id|u16
)paren
(paren
id|ivideo-&gt;tvxpos
op_plus
l_int|32
)paren
suffix:semicolon
id|x.sisfb_tvypos
op_assign
(paren
id|u16
)paren
(paren
id|ivideo-&gt;tvypos
op_plus
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|x
comma
r_sizeof
(paren
id|x
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SISFB_GET_VBRSTATUS_OLD
suffix:colon
r_if
c_cond
(paren
op_increment
id|count
OL
l_int|50
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Deprecated ioctl call received - update your application!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_case
id|SISFB_GET_VBRSTATUS
suffix:colon
r_if
c_cond
(paren
id|sisfb_CheckVBRetrace
c_func
(paren
id|ivideo
)paren
)paren
(brace
r_return
id|put_user
c_func
(paren
(paren
id|u32
)paren
l_int|1
comma
id|argp
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|put_user
c_func
(paren
(paren
id|u32
)paren
l_int|0
comma
id|argp
)paren
suffix:semicolon
)brace
r_case
id|SISFB_GET_AUTOMAXIMIZE_OLD
suffix:colon
r_if
c_cond
(paren
op_increment
id|count
OL
l_int|50
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Deprecated ioctl call received - update your application!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_case
id|SISFB_GET_AUTOMAXIMIZE
suffix:colon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_max
)paren
(brace
r_return
id|put_user
c_func
(paren
(paren
id|u32
)paren
l_int|1
comma
id|argp
)paren
suffix:semicolon
)brace
r_else
r_return
id|put_user
c_func
(paren
(paren
id|u32
)paren
l_int|0
comma
id|argp
)paren
suffix:semicolon
r_case
id|SISFB_SET_AUTOMAXIMIZE_OLD
suffix:colon
r_if
c_cond
(paren
op_increment
id|count
OL
l_int|50
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Deprecated ioctl call received - update your application!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_case
id|SISFB_SET_AUTOMAXIMIZE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|gpu32
comma
id|argp
comma
r_sizeof
(paren
id|gpu32
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|ivideo-&gt;sisfb_max
op_assign
(paren
id|gpu32
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISFB_SET_TVPOSOFFSET
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|gpu32
comma
id|argp
comma
r_sizeof
(paren
id|gpu32
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sisfb_set_TVxposoffset
c_func
(paren
id|ivideo
comma
(paren
(paren
r_int
)paren
(paren
id|gpu32
op_rshift
l_int|16
)paren
)paren
op_minus
l_int|32
)paren
suffix:semicolon
id|sisfb_set_TVyposoffset
c_func
(paren
id|ivideo
comma
(paren
(paren
r_int
)paren
(paren
id|gpu32
op_amp
l_int|0xffff
)paren
)paren
op_minus
l_int|32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISFB_GET_TVPOSOFFSET
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|u32
)paren
(paren
(paren
(paren
id|ivideo-&gt;tvxpos
op_plus
l_int|32
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|ivideo-&gt;tvypos
op_plus
l_int|32
)paren
op_amp
l_int|0xffff
)paren
)paren
comma
id|argp
)paren
suffix:semicolon
r_case
id|SISFB_SET_LOCK
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|gpu32
comma
id|argp
comma
r_sizeof
(paren
id|gpu32
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|ivideo-&gt;sisfblocked
op_assign
(paren
id|gpu32
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisfb_get_fix
id|sisfb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|ivideo-&gt;myid
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|ivideo-&gt;video_base
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|ivideo-&gt;sisfb_mem
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;visual
op_assign
(paren
id|ivideo-&gt;video_bpp
op_eq
l_int|8
)paren
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
(paren
id|ivideo-&gt;sisfb_ypan
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|ivideo-&gt;video_linelength
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|ivideo-&gt;mmio_base
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|ivideo-&gt;mmio_size
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_330
)paren
op_logical_or
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_760
)paren
)paren
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_XABRE
suffix:semicolon
)brace
r_else
(brace
id|fix-&gt;accel
op_assign
id|FB_ACCEL_SIS_GLAMOUR_2
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------  fb_ops structures ----------------- */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_get_fix
op_assign
id|sisfb_get_fix
comma
dot
id|fb_get_var
op_assign
id|sisfb_get_var
comma
dot
id|fb_set_var
op_assign
id|sisfb_set_var
comma
dot
id|fb_get_cmap
op_assign
id|sisfb_get_cmap
comma
dot
id|fb_set_cmap
op_assign
id|sisfb_set_cmap
comma
dot
id|fb_pan_display
op_assign
id|sisfb_pan_display
comma
dot
id|fb_ioctl
op_assign
id|sisfb_ioctl
)brace
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
DECL|variable|sisfb_ops
r_static
r_struct
id|fb_ops
id|sisfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|sisfb_open
comma
dot
id|fb_release
op_assign
id|sisfb_release
comma
dot
id|fb_check_var
op_assign
id|sisfb_check_var
comma
dot
id|fb_set_par
op_assign
id|sisfb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|sisfb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|sisfb_pan_display
comma
dot
id|fb_blank
op_assign
id|sisfb_blank
comma
dot
id|fb_fillrect
op_assign
id|fbcon_sis_fillrect
comma
dot
id|fb_copyarea
op_assign
id|fbcon_sis_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
dot
id|fb_sync
op_assign
id|fbcon_sis_sync
comma
dot
id|fb_ioctl
op_assign
id|sisfb_ioctl
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* ---------------- Chip generation dependent routines ---------------- */
DECL|function|sisfb_get_northbridge
r_static
r_struct
id|pci_dev
op_star
id|sisfb_get_northbridge
c_func
(paren
r_int
id|basechipid
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|nbridgenum
comma
id|nbridgeidx
comma
id|i
suffix:semicolon
r_const
r_int
r_int
id|nbridgeids
(braket
)braket
op_assign
(brace
id|PCI_DEVICE_ID_SI_540
comma
multiline_comment|/* for SiS 540 VGA */
id|PCI_DEVICE_ID_SI_630
comma
multiline_comment|/* for SiS 630/730 VGA */
id|PCI_DEVICE_ID_SI_730
comma
id|PCI_DEVICE_ID_SI_550
comma
multiline_comment|/* for SiS 550 VGA */
id|PCI_DEVICE_ID_SI_650
comma
multiline_comment|/* for SiS 650/651/740 VGA */
id|PCI_DEVICE_ID_SI_651
comma
id|PCI_DEVICE_ID_SI_740
comma
id|PCI_DEVICE_ID_SI_661
comma
multiline_comment|/* for SiS 661/741/660/760 VGA */
id|PCI_DEVICE_ID_SI_741
comma
id|PCI_DEVICE_ID_SI_660
comma
id|PCI_DEVICE_ID_SI_760
)brace
suffix:semicolon
r_switch
c_cond
(paren
id|basechipid
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|SIS_540
suffix:colon
id|nbridgeidx
op_assign
l_int|0
suffix:semicolon
id|nbridgenum
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_630
suffix:colon
id|nbridgeidx
op_assign
l_int|1
suffix:semicolon
id|nbridgenum
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|SIS_550
suffix:colon
id|nbridgeidx
op_assign
l_int|3
suffix:semicolon
id|nbridgenum
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_650
suffix:colon
id|nbridgeidx
op_assign
l_int|4
suffix:semicolon
id|nbridgenum
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_660
suffix:colon
id|nbridgeidx
op_assign
l_int|7
suffix:semicolon
id|nbridgenum
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbridgenum
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|nbridgeids
(braket
id|nbridgeidx
op_plus
id|i
)braket
comma
l_int|NULL
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
id|pdev
suffix:semicolon
)brace
DECL|function|sisfb_get_dram_size
r_static
r_int
id|__devinit
id|sisfb_get_dram_size
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
macro_line|#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)
id|u8
id|reg
suffix:semicolon
macro_line|#endif
id|ivideo-&gt;video_size
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;chip
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|SIS_300
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
(paren
(paren
id|reg
op_amp
l_int|0x3F
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|20
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_540
suffix:colon
r_case
id|SIS_630
suffix:colon
r_case
id|SIS_730
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;nbridge
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|ivideo-&gt;nbridge
comma
l_int|0x63
comma
op_amp
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
l_int|1
op_lshift
(paren
(paren
(paren
id|reg
op_amp
l_int|0x70
)paren
op_rshift
l_int|4
)paren
op_plus
l_int|21
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|SIS_315H
suffix:colon
r_case
id|SIS_315PRO
suffix:colon
r_case
id|SIS_315
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
(paren
l_int|1
op_lshift
(paren
(paren
id|reg
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
)paren
op_lshift
l_int|20
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|reg
op_rshift
l_int|2
)paren
op_amp
l_int|0x03
)paren
(brace
r_case
l_int|0x01
suffix:colon
r_case
l_int|0x03
suffix:colon
id|ivideo-&gt;video_size
op_lshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo-&gt;video_size
op_add_assign
(paren
id|ivideo-&gt;video_size
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIS_330
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
(paren
l_int|1
op_lshift
(paren
(paren
id|reg
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
)paren
op_lshift
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0x0c
)paren
(brace
id|ivideo-&gt;video_size
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIS_550
suffix:colon
r_case
id|SIS_650
suffix:colon
r_case
id|SIS_740
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
(paren
(paren
(paren
id|reg
op_amp
l_int|0x3f
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|2
)paren
op_lshift
l_int|20
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_661
suffix:colon
r_case
id|SIS_741
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|reg
)paren
suffix:semicolon
id|ivideo-&gt;video_size
op_assign
(paren
l_int|1
op_lshift
(paren
(paren
id|reg
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
)paren
op_lshift
l_int|20
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_660
suffix:colon
r_case
id|SIS_760
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|reg
)paren
(brace
id|ivideo-&gt;video_size
op_assign
(paren
l_int|1
op_lshift
id|reg
)paren
op_lshift
l_int|20
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x78
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x30
suffix:semicolon
r_if
c_cond
(paren
id|reg
)paren
(brace
r_if
c_cond
(paren
id|reg
op_eq
l_int|0x10
)paren
(brace
id|ivideo-&gt;video_size
op_add_assign
(paren
l_int|32
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
id|ivideo-&gt;video_size
op_add_assign
(paren
l_int|64
op_lshift
l_int|20
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* -------------- video bridge device detection --------------- */
DECL|function|sisfb_detect_VB_connect
r_static
r_void
id|__devinit
id|sisfb_detect_VB_connect
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u8
id|cr32
comma
id|temp
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
l_int|0x0F
)paren
op_logical_and
(paren
id|ivideo-&gt;chip
op_ne
id|SIS_300
)paren
)paren
(brace
multiline_comment|/* PAL/NTSC is stored on SR16 on such machines */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|TV_PAL
op_or
id|TV_NTSC
op_or
id|TV_PALM
op_or
id|TV_PALN
)paren
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo-&gt;vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
id|cr32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_CRT1
)paren
(brace
id|ivideo-&gt;sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;sisfb_crt1off
op_assign
(paren
id|cr32
op_amp
l_int|0xDF
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
id|ivideo-&gt;vbflags
op_and_assign
op_complement
(paren
id|CRT2_TV
op_or
id|CRT2_LCD
op_or
id|CRT2_VGA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_TV
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_LCD
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_CRT2
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
)brace
multiline_comment|/* Check given parms for hardware compatibility.&n;&t; * (Cannot do this in the search_xx routines since we don&squot;t&n;&t; * know what hardware we are running on then)&n;&t; */
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ne
id|SIS_550
)paren
(brace
id|ivideo-&gt;sisfb_dstn
op_assign
id|ivideo-&gt;sisfb_fstn
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_ne
id|SIS_315_VGA
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvplug
op_amp
id|TV_YPBPR
)paren
(brace
id|ivideo-&gt;sisfb_tvplug
op_assign
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: YPbPr not supported&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_ne
id|SIS_315_VGA
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_301B
op_or
id|VB_302B
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvplug
op_amp
id|TV_HIVISION
)paren
(brace
id|ivideo-&gt;sisfb_tvplug
op_assign
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: HiVision not supported&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvstd
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_SISBRIDGE
)paren
)paren
op_logical_and
(paren
op_logical_neg
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvstd
op_amp
(paren
id|TV_PALN
op_or
id|TV_PALN
op_or
id|TV_NTSCJ
)paren
)paren
(brace
id|ivideo-&gt;sisfb_tvstd
op_assign
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: PALM/PALN/NTSCJ not supported&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Detect/set TV plug &amp; type */
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvplug
op_ne
op_minus
l_int|1
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|ivideo-&gt;sisfb_tvplug
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_YPBPR
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
(paren
id|TV_YPBPR
op_or
id|TV_YPBPR525I
)paren
suffix:semicolon
)brace
multiline_comment|/* default: 480i */
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_HIVISION
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_HIVISION
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SCART
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_SCART
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_SVIDEO
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cr32
op_amp
id|SIS_VB_COMPOSITE
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|TV_YPBPR
op_or
id|TV_HIVISION
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_tvstd
op_ne
op_minus
l_int|1
)paren
(brace
id|ivideo-&gt;vbflags
op_and_assign
op_complement
(paren
id|TV_NTSC
op_or
id|TV_PAL
op_or
id|TV_PALM
op_or
id|TV_PALN
op_or
id|TV_NTSCJ
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|ivideo-&gt;sisfb_tvstd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_SCART
)paren
(brace
id|ivideo-&gt;vbflags
op_and_assign
op_complement
(paren
id|TV_NTSC
op_or
id|TV_PALM
op_or
id|TV_PALN
op_or
id|TV_NTSCJ
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|TV_PAL
op_or
id|TV_NTSC
op_or
id|TV_PALM
op_or
id|TV_PALN
op_or
id|TV_NTSCJ
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x38
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo-&gt;vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo-&gt;chip
op_le
id|SIS_315PRO
)paren
op_logical_or
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_330
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x38
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x01
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo-&gt;vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x79
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|TV_PAL
suffix:semicolon
)brace
r_else
id|ivideo-&gt;vbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Copy forceCRT1 option to CRT1off if option is given */
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_forcecrt1
op_ne
op_minus
l_int|1
)paren
(brace
id|ivideo-&gt;sisfb_crt1off
op_assign
(paren
id|ivideo-&gt;sisfb_forcecrt1
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|sisfb_get_VB_type
r_static
r_void
id|__devinit
id|sisfb_get_VB_type
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Detected&quot;
suffix:semicolon
r_char
id|bridgestr
(braket
)braket
op_assign
l_string|&quot;video bridge&quot;
suffix:semicolon
id|u8
id|vb_chipid
suffix:semicolon
id|u8
id|reg
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
comma
id|vb_chipid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb_chipid
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xb0
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_301
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301 %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xc0
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_301B
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x02
)paren
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_30xBDH
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301B-DH %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301B %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xd0
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_301C
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301C %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
OL
l_int|0xe0
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_301LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg
op_le
l_int|0xe1
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x39
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
l_int|0xff
)paren
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_302LV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302LV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;vbflags
op_or_assign
id|VB_301C
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS301C(P4) %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
macro_line|#if 0
id|ivideo-&gt;vbflags
op_or_assign
id|VB_302ELV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302ELV %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_302B
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SiS302B %s&bslash;n&quot;
comma
id|stdstr
comma
id|bridgestr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
)paren
op_logical_and
(paren
id|ivideo-&gt;chip
op_ne
id|SIS_300
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x37
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
id|SIS_EXTERNAL_CHIP_MASK
suffix:semicolon
id|reg
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_TRUMPION
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_TRUMPION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_CHRONTEL
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_CHRONTEL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|ivideo-&gt;chronteltype
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;chip
OL
id|SIS_661
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|SIS310_EXTERNAL_CHIP_LVDS
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS310_EXTERNAL_CHIP_LVDS_CHRONTEL
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|ivideo-&gt;chronteltype
op_assign
l_int|2
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
id|reg
)paren
suffix:semicolon
id|reg
op_rshift_assign
l_int|5
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
l_int|0x02
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
id|VB_LVDS
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CHRONTEL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|ivideo-&gt;vbflags
op_or_assign
(paren
id|VB_LVDS
op_or
id|VB_CONEXANT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|ivideo-&gt;chronteltype
op_assign
l_int|2
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_LVDS
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s LVDS transmitter&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_TRUMPION
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Trumpion Zurac LCD scaler&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Chrontel TV encoder&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CONEXANT
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Conexant external device&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_SISBRIDGE
)paren
(brace
id|SiS_Sense30x
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
id|SiS_SenseCh
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------ Sensing routines ------------------ */
DECL|function|sisfb_test_DDC1
r_static
id|BOOLEAN
id|__devinit
id|sisfb_test_DDC1
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
r_int
r_int
id|old
suffix:semicolon
r_int
id|count
op_assign
l_int|48
suffix:semicolon
id|old
op_assign
id|SiS_ReadDDC1Bit
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|old
op_ne
id|SiS_ReadDDC1Bit
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_return
(paren
id|count
op_eq
op_minus
l_int|1
)paren
ques
c_cond
id|FALSE
suffix:colon
id|TRUE
suffix:semicolon
)brace
DECL|function|sisfb_sense_crt1
r_static
r_void
id|__devinit
id|sisfb_sense_crt1
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|BOOLEAN
id|mustwait
op_assign
id|FALSE
suffix:semicolon
id|u8
id|SR1F
comma
id|CR17
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|u8
id|CR63
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|u16
id|temp
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|i
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
id|SR1F
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
l_int|0x04
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
l_int|0x3F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SR1F
op_amp
l_int|0xc0
)paren
(brace
id|mustwait
op_assign
id|TRUE
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
comma
id|CR63
)paren
suffix:semicolon
id|CR63
op_and_assign
l_int|0x40
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
comma
l_int|0xBF
)paren
suffix:semicolon
)brace
macro_line|#endif
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
id|CR17
)paren
suffix:semicolon
id|CR17
op_and_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CR17
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x80
)paren
suffix:semicolon
id|mustwait
op_assign
id|TRUE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mustwait
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sisfbwaitretracecrt1
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_330
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_340
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x57
comma
l_int|0x4a
)paren
suffix:semicolon
)brace
r_else
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x57
comma
l_int|0x5f
)paren
suffix:semicolon
)brace
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x53
comma
l_int|0x02
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
)paren
op_amp
l_int|0x01
)paren
(brace
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|inSISREG
c_func
(paren
id|SISINPSTAT
)paren
)paren
op_amp
l_int|0x01
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|inSISREG
c_func
(paren
id|SISMISCW
)paren
)paren
op_amp
l_int|0x10
)paren
(brace
id|temp
op_assign
l_int|1
suffix:semicolon
)brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x53
comma
l_int|0xfd
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x57
comma
l_int|0x00
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|temp
op_eq
l_int|0xffff
)paren
(brace
id|i
op_assign
l_int|3
suffix:semicolon
r_do
(brace
id|temp
op_assign
id|SiS_HandleDDC
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;vbflags
comma
id|ivideo-&gt;sisvga_engine
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
op_logical_and
id|i
op_decrement
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|0xffff
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisfb_test_DDC1
c_func
(paren
id|ivideo
)paren
)paren
(brace
id|temp
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|temp
)paren
op_logical_and
(paren
id|temp
op_ne
l_int|0xffff
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x20
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
comma
l_int|0xBF
comma
id|CR63
)paren
suffix:semicolon
)brace
macro_line|#endif
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x7F
comma
id|CR17
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1F
comma
id|SR1F
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine and detect attached devices on SiS30x */
DECL|function|SISDoSense
r_static
r_int
id|__devinit
id|SISDoSense
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
id|u16
id|type
comma
id|u16
id|test
)paren
(brace
r_int
id|temp
comma
id|mytest
comma
id|result
comma
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|10
suffix:semicolon
id|j
op_increment
)paren
(brace
id|result
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mytest
op_assign
id|test
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x11
comma
(paren
id|type
op_amp
l_int|0x00ff
)paren
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|type
op_rshift
l_int|8
)paren
op_or
(paren
id|mytest
op_amp
l_int|0x00ff
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
l_int|0xe0
comma
id|temp
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x1500
)paren
suffix:semicolon
id|mytest
op_rshift_assign
l_int|8
suffix:semicolon
id|mytest
op_and_assign
l_int|0x7f
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x03
comma
id|temp
)paren
suffix:semicolon
id|temp
op_xor_assign
l_int|0x0e
suffix:semicolon
id|temp
op_and_assign
id|mytest
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
id|mytest
)paren
(brace
id|result
op_increment
suffix:semicolon
)brace
macro_line|#if 1
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x11
comma
l_int|0x00
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
l_int|0xe0
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x1000
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
(paren
id|result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|result
op_ge
l_int|2
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|SiS_Sense30x
r_static
r_void
id|__devinit
id|SiS_Sense30x
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u8
id|backupP4_0d
comma
id|backupP2_00
comma
id|backupP2_4d
comma
id|backupSR_1e
comma
id|biosflag
op_assign
l_int|0
suffix:semicolon
id|u16
id|svhs
op_assign
l_int|0
comma
id|svhs_c
op_assign
l_int|0
suffix:semicolon
id|u16
id|cvbs
op_assign
l_int|0
comma
id|cvbs_c
op_assign
l_int|0
suffix:semicolon
id|u16
id|vga2
op_assign
l_int|0
comma
id|vga2_c
op_assign
l_int|0
suffix:semicolon
r_int
id|myflag
comma
id|result
suffix:semicolon
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Detected&quot;
suffix:semicolon
r_char
id|tvstr
(braket
)braket
op_assign
l_string|&quot;TV connected to&quot;
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301
)paren
(brace
id|svhs
op_assign
l_int|0x00b9
suffix:semicolon
id|cvbs
op_assign
l_int|0x00b3
suffix:semicolon
id|vga2
op_assign
l_int|0x00d1
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myflag
op_amp
l_int|0x04
)paren
(brace
id|svhs
op_assign
l_int|0x00dd
suffix:semicolon
id|cvbs
op_assign
l_int|0x00ee
suffix:semicolon
id|vga2
op_assign
l_int|0x00fd
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_302B
)paren
)paren
(brace
id|svhs
op_assign
l_int|0x016b
suffix:semicolon
id|cvbs
op_assign
l_int|0x0174
suffix:semicolon
id|vga2
op_assign
l_int|0x0190
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
(brace
id|svhs
op_assign
l_int|0x0200
suffix:semicolon
id|cvbs
op_assign
l_int|0x0100
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302ELV
)paren
)paren
(brace
id|svhs
op_assign
l_int|0x016b
suffix:semicolon
id|cvbs
op_assign
l_int|0x0110
suffix:semicolon
id|vga2
op_assign
l_int|0x0190
suffix:semicolon
)brace
r_else
r_return
suffix:semicolon
id|vga2_c
op_assign
l_int|0x0e08
suffix:semicolon
id|svhs_c
op_assign
l_int|0x0404
suffix:semicolon
id|cvbs_c
op_assign
l_int|0x0804
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
id|svhs_c
op_assign
l_int|0x0408
suffix:semicolon
id|cvbs_c
op_assign
l_int|0x0808
suffix:semicolon
)brace
id|biosflag
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_300
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3b
comma
id|myflag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|myflag
op_amp
l_int|0x01
)paren
)paren
(brace
id|vga2
op_assign
id|vga2_c
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1e
comma
id|backupSR_1e
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1e
comma
l_int|0x20
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301C
)paren
(brace
id|setSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
op_complement
l_int|0x07
comma
l_int|0x01
)paren
suffix:semicolon
)brace
r_else
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
l_int|0x04
)paren
suffix:semicolon
)brace
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x2000
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|backupP2_00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
(paren
(paren
id|backupP2_00
op_or
l_int|0x1c
)paren
op_amp
l_int|0xfc
)paren
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x4d
comma
id|backupP2_4d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x4d
comma
(paren
id|backupP2_4d
op_amp
op_complement
l_int|0x10
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301C
)paren
)paren
(brace
id|SISDoSense
c_func
(paren
id|ivideo
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x14
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vga2_c
op_logical_or
id|vga2
)paren
(brace
r_if
c_cond
(paren
id|SISDoSense
c_func
(paren
id|ivideo
comma
id|vga2
comma
id|vga2_c
)paren
)paren
(brace
r_if
c_cond
(paren
id|biosflag
op_amp
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s SCART output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x04
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s secondary VGA connection&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x10
)paren
suffix:semicolon
)brace
)brace
)brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x3f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301C
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
l_int|0x04
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x4d
comma
(paren
id|backupP2_4d
op_or
l_int|0x10
)paren
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x2000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|SISDoSense
c_func
(paren
id|ivideo
comma
id|svhs
comma
l_int|0x0604
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|SISDoSense
c_func
(paren
id|ivideo
comma
id|cvbs
comma
l_int|0x0804
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s YPbPr component output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x80
)paren
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x4d
comma
id|backupP2_4d
)paren
suffix:semicolon
)brace
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x03
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|SISDoSense
c_func
(paren
id|ivideo
comma
id|svhs
comma
id|svhs_c
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s SVIDEO output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|biosflag
op_amp
l_int|0x02
)paren
op_logical_or
(paren
op_logical_neg
id|result
)paren
)paren
(brace
r_if
c_cond
(paren
id|SISDoSense
c_func
(paren
id|ivideo
comma
id|cvbs
comma
id|cvbs_c
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s %s COMPOSITE output&bslash;n&quot;
comma
id|stdstr
comma
id|tvstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
)brace
)brace
)brace
id|SISDoSense
c_func
(paren
id|ivideo
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|backupP2_00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|backupP4_0d
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1e
comma
id|backupSR_1e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301C
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|biosflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|biosflag
op_amp
l_int|0x20
)paren
(brace
r_for
c_loop
(paren
id|myflag
op_assign
l_int|2
suffix:semicolon
id|myflag
OG
l_int|0
suffix:semicolon
id|myflag
op_decrement
)paren
(brace
id|biosflag
op_xor_assign
l_int|0x20
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|biosflag
)paren
suffix:semicolon
)brace
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
id|backupP2_00
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine and detect attached TV&squot;s on Chrontel */
DECL|function|SiS_SenseCh
r_static
r_void
id|__devinit
id|SiS_SenseCh
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
macro_line|#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)
id|u8
id|temp1
comma
id|temp2
suffix:semicolon
r_char
id|stdstr
(braket
)braket
op_assign
l_string|&quot;sisfb: Chrontel: Detected TV connected to&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_int
r_char
id|test
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ivideo-&gt;chip
OL
id|SIS_315H
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
id|ivideo-&gt;SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Chrontel 700x */
id|SiS_SetChrontelGPIO
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x9c
)paren
suffix:semicolon
multiline_comment|/* Set general purpose IO for Chrontel communication */
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|1000
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x25
)paren
suffix:semicolon
multiline_comment|/* See Chrontel TB31 for explanation */
id|temp2
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|temp2
op_amp
l_int|0x07
)paren
op_eq
l_int|0x01
)paren
op_logical_or
(paren
id|temp2
op_amp
l_int|0x04
)paren
)paren
(brace
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0b0e
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|300
)paren
suffix:semicolon
)brace
id|temp2
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x25
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_ne
id|temp1
)paren
(brace
id|temp1
op_assign
id|temp2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_ge
l_int|0x22
)paren
op_logical_and
(paren
id|temp1
op_le
l_int|0x50
)paren
)paren
(brace
multiline_comment|/* Read power status */
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x03
)paren
op_ne
l_int|0x03
)paren
(brace
multiline_comment|/* Power all outputs */
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0B0E
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|300
)paren
suffix:semicolon
)brace
multiline_comment|/* Sense connected TV devices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0110
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0010
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp1
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x08
)paren
)paren
(brace
id|test
(braket
id|i
)braket
op_assign
l_int|0x02
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|test
(braket
id|i
)braket
op_assign
l_int|0x01
suffix:semicolon
)brace
r_else
id|test
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test
(braket
l_int|0
)braket
op_eq
id|test
(braket
l_int|1
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test
(braket
l_int|0
)braket
op_eq
id|test
(braket
l_int|2
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|test
(braket
l_int|1
)braket
op_eq
id|test
(braket
l_int|2
)braket
)paren
(brace
id|temp1
op_assign
id|test
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: TV detection unreliable - test results varied&bslash;n&quot;
)paren
suffix:semicolon
id|temp1
op_assign
id|test
(braket
l_int|2
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0x02
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SVIDEO output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x05
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0x01
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s CVBS output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x06
)paren
suffix:semicolon
)brace
r_else
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|temp1
op_eq
l_int|0
)paren
(brace
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x010E
comma
l_int|0xF8
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
multiline_comment|/* Set general purpose IO for Chrontel communication */
id|SiS_SetChrontelGPIO
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
id|ivideo-&gt;SiS_Pr.SiS_IF_DEF_CH70xx
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Chrontel 7019 */
id|temp1
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x49
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x2049
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|temp2
op_or_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_xor_assign
l_int|0x01
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
id|temp2
op_lshift
l_int|8
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x96
)paren
suffix:semicolon
id|temp2
op_assign
id|SiS_GetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x20
)paren
suffix:semicolon
id|SiS_SetCH701x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
id|temp1
op_lshift
l_int|8
)paren
op_or
l_int|0x49
)paren
suffix:semicolon
id|temp1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x02
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x10
)paren
(brace
id|temp1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp2
op_amp
l_int|0x04
)paren
(brace
id|temp1
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp1
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|temp1
op_amp
l_int|0x02
)paren
)paren
(brace
id|temp1
op_assign
l_int|0x04
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|temp1
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s CVBS output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x06
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SVIDEO output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|ivideo-&gt;vbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x05
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s SCART output&bslash;n&quot;
comma
id|stdstr
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x04
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x03
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|andSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
op_complement
l_int|0x07
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
multiline_comment|/* ------------------------ Heap routines -------------------------- */
r_static
id|u32
id|__devinit
DECL|function|sisfb_getheapstart
id|sisfb_getheapstart
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u32
id|ret
op_assign
id|ivideo-&gt;sisfb_parm_mem
op_star
l_int|1024
suffix:semicolon
id|u32
id|max
op_assign
id|ivideo-&gt;video_size
op_minus
id|ivideo-&gt;hwcursor_size
suffix:semicolon
id|u32
id|def
suffix:semicolon
multiline_comment|/* Calculate heap start = end of memory for console&n;&t; *&n;&t; * CCCCCCCCDDDDDDDDDDDDDDDDDDDDDDDDDDDDHHHHQQQQQQQQQQ&n;&t; * C = console, D = heap, H = HWCursor, Q = cmd-queue&n;&t; *&n;&t; * Basically given by &quot;mem&quot; parameter&n;&t; *&n;&t; * maximum = videosize - cmd_queue - hwcursor&n;&t; *           (results in a heap of size 0)&n;&t; * default = SiS 300: depends on videosize&n;&t; *           SiS 315/330: 32k below max&n;&t; */
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|max
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;video_size
OG
l_int|0x1000000
)paren
(brace
id|def
op_assign
l_int|0xc00000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;video_size
OG
l_int|0x800000
)paren
(brace
id|def
op_assign
l_int|0x800000
suffix:semicolon
)brace
r_else
(brace
id|def
op_assign
l_int|0x400000
suffix:semicolon
)brace
)brace
r_else
(brace
id|max
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|def
op_assign
id|max
op_minus
l_int|0x8000
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|ret
)paren
op_logical_or
(paren
id|ret
OG
id|max
)paren
op_logical_or
(paren
id|ivideo-&gt;cardnumber
op_ne
l_int|0
)paren
)paren
(brace
id|ret
op_assign
id|def
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|sisfb_heap_init
id|sisfb_heap_init
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|SIS_OH
op_star
id|poh
suffix:semicolon
id|ivideo-&gt;heapstart
op_assign
id|ivideo-&gt;sisfb_mem
op_assign
id|sisfb_getheapstart
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|ivideo-&gt;sisfb_heap_start
op_assign
id|ivideo-&gt;video_vbase
op_plus
id|ivideo-&gt;heapstart
suffix:semicolon
id|ivideo-&gt;sisfb_heap_end
op_assign
id|ivideo-&gt;video_vbase
op_plus
id|ivideo-&gt;video_size
suffix:semicolon
multiline_comment|/* Initialize command queue (We use MMIO only) */
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|u32
id|tempq
op_assign
l_int|0
suffix:semicolon
id|u8
id|temp
op_assign
l_int|0
suffix:semicolon
id|ivideo-&gt;sisfb_heap_end
op_sub_assign
id|COMMAND_QUEUE_AREA_SIZE
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_THRESHOLD
comma
id|COMMAND_QUEUE_THRESHOLD
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|SIS_CMD_QUEUE_RESET
)paren
suffix:semicolon
id|tempq
op_assign
id|MMIO_IN32
c_func
(paren
id|ivideo-&gt;mmio_vbase
comma
id|MMIO_QUEUE_READPORT
)paren
suffix:semicolon
id|MMIO_OUT32
c_func
(paren
id|ivideo-&gt;mmio_vbase
comma
id|MMIO_QUEUE_WRITEPORT
comma
id|tempq
)paren
suffix:semicolon
id|temp
op_assign
id|SIS_CMD_QUEUE_SIZE_512k
suffix:semicolon
id|temp
op_or_assign
(paren
id|SIS_MMIO_CMD_ENABLE
op_or
id|SIS_CMD_AUTO_CORR
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_CMDQUEUE_SET
comma
id|temp
)paren
suffix:semicolon
id|tempq
op_assign
(paren
id|u32
)paren
(paren
id|ivideo-&gt;video_size
op_minus
id|COMMAND_QUEUE_AREA_SIZE
)paren
suffix:semicolon
id|MMIO_OUT32
c_func
(paren
id|ivideo-&gt;mmio_vbase
comma
id|MMIO_QUEUE_PHYBASE
comma
id|tempq
)paren
suffix:semicolon
id|ivideo-&gt;caps
op_or_assign
id|MMIO_CMD_QUEUE_CAP
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_int
r_int
id|tqueue_pos
suffix:semicolon
id|u8
id|tq_state
suffix:semicolon
id|ivideo-&gt;sisfb_heap_end
op_sub_assign
id|TURBO_QUEUE_AREA_SIZE
suffix:semicolon
id|tqueue_pos
op_assign
(paren
id|ivideo-&gt;video_size
op_minus
id|TURBO_QUEUE_AREA_SIZE
)paren
op_div
(paren
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|tq_state
op_or_assign
l_int|0xf0
suffix:semicolon
id|tq_state
op_and_assign
l_int|0xfc
suffix:semicolon
id|tq_state
op_or_assign
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_SET
comma
id|tq_state
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_TURBOQUEUE_ADR
comma
(paren
id|u8
)paren
(paren
id|tqueue_pos
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ivideo-&gt;caps
op_or_assign
id|TURBO_QUEUE_CAP
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Reserve memory for the HWCursor */
id|ivideo-&gt;sisfb_heap_end
op_sub_assign
id|ivideo-&gt;hwcursor_size
suffix:semicolon
id|ivideo-&gt;hwcursor_vbase
op_assign
id|ivideo-&gt;sisfb_heap_end
suffix:semicolon
id|ivideo-&gt;caps
op_or_assign
id|HW_CURSOR_CAP
suffix:semicolon
id|ivideo-&gt;sisfb_heap_size
op_assign
id|ivideo-&gt;sisfb_heap_end
op_minus
id|ivideo-&gt;sisfb_heap_start
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;cardnumber
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Memory heap starting at %dK, size %dK&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|ivideo-&gt;heapstart
op_div
l_int|1024
)paren
comma
(paren
r_int
)paren
(paren
id|ivideo-&gt;sisfb_heap_size
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|sisfb_heap.vinfo
op_assign
id|ivideo
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
l_int|NULL
suffix:semicolon
id|poh
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
op_amp
id|sisfb_heap.oh_free
suffix:semicolon
id|poh-&gt;size
op_assign
id|ivideo-&gt;sisfb_heap_size
suffix:semicolon
id|poh-&gt;offset
op_assign
id|ivideo-&gt;heapstart
suffix:semicolon
id|sisfb_heap.oh_free.poh_next
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.poh_prev
op_assign
id|poh
suffix:semicolon
id|sisfb_heap.oh_free.size
op_assign
l_int|0
suffix:semicolon
id|sisfb_heap.max_freesize
op_assign
id|poh-&gt;size
suffix:semicolon
id|sisfb_heap.oh_used.poh_next
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.poh_prev
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_heap.oh_used.size
op_assign
id|SENTINEL
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Skipped heap initialization for secondary cards&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|SIS_OH
op_star
DECL|function|sisfb_poh_new_node
id|sisfb_poh_new_node
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|cOhs
suffix:semicolon
id|SIS_OHALLOC
op_star
id|poha
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_heap.poh_freelist
op_eq
l_int|NULL
)paren
(brace
id|poha
op_assign
id|kmalloc
c_func
(paren
id|SIS_OH_ALLOC_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|poha
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|poha-&gt;poha_next
op_assign
id|sisfb_heap.poha_chain
suffix:semicolon
id|sisfb_heap.poha_chain
op_assign
id|poha
suffix:semicolon
id|cOhs
op_assign
(paren
id|SIS_OH_ALLOC_SIZE
op_minus
r_sizeof
(paren
id|SIS_OHALLOC
)paren
)paren
op_div
r_sizeof
(paren
id|SIS_OH
)paren
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cOhs
op_minus
l_int|1
suffix:semicolon
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|poh-&gt;poh_next
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
id|poh
op_assign
id|poh
op_plus
l_int|1
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
l_int|NULL
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
op_amp
id|poha-&gt;aoh
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh-&gt;poh_next
suffix:semicolon
r_return
(paren
id|poh
)paren
suffix:semicolon
)brace
r_static
id|SIS_OH
op_star
DECL|function|sisfb_poh_allocate
id|sisfb_poh_allocate
c_func
(paren
id|u32
id|size
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|pohRoot
suffix:semicolon
r_int
id|bAllocated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|sisfb_heap.max_freesize
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk video memory&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|pohThis-&gt;size
)paren
(brace
id|bAllocated
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|bAllocated
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Can&squot;t allocate %dk video memory&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|size
op_div
l_int|1024
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|pohThis-&gt;size
)paren
(brace
id|pohRoot
op_assign
id|pohThis
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|pohThis
)paren
suffix:semicolon
)brace
r_else
(brace
id|pohRoot
op_assign
id|sisfb_poh_new_node
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pohRoot
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pohRoot-&gt;offset
op_assign
id|pohThis-&gt;offset
suffix:semicolon
id|pohRoot-&gt;size
op_assign
id|size
suffix:semicolon
id|pohThis-&gt;offset
op_add_assign
id|size
suffix:semicolon
id|pohThis-&gt;size
op_sub_assign
id|size
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_sub_assign
id|size
suffix:semicolon
id|pohThis
op_assign
op_amp
id|sisfb_heap.oh_used
suffix:semicolon
id|sisfb_insert_node
c_func
(paren
id|pohThis
comma
id|pohRoot
)paren
suffix:semicolon
r_return
(paren
id|pohRoot
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_delete_node
id|sisfb_delete_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|poh_prev
op_assign
id|poh-&gt;poh_prev
suffix:semicolon
id|poh_next
op_assign
id|poh-&gt;poh_next
suffix:semicolon
id|poh_prev-&gt;poh_next
op_assign
id|poh_next
suffix:semicolon
id|poh_next-&gt;poh_prev
op_assign
id|poh_prev
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_insert_node
id|sisfb_insert_node
c_func
(paren
id|SIS_OH
op_star
id|pohList
comma
id|SIS_OH
op_star
id|poh
)paren
(brace
id|SIS_OH
op_star
id|pohTemp
suffix:semicolon
id|pohTemp
op_assign
id|pohList-&gt;poh_next
suffix:semicolon
id|pohList-&gt;poh_next
op_assign
id|poh
suffix:semicolon
id|pohTemp-&gt;poh_prev
op_assign
id|poh
suffix:semicolon
id|poh-&gt;poh_prev
op_assign
id|pohList
suffix:semicolon
id|poh-&gt;poh_next
op_assign
id|pohTemp
suffix:semicolon
)brace
r_static
id|SIS_OH
op_star
DECL|function|sisfb_poh_free
id|sisfb_poh_free
c_func
(paren
id|u32
id|base
)paren
(brace
id|SIS_OH
op_star
id|pohThis
suffix:semicolon
id|SIS_OH
op_star
id|poh_freed
suffix:semicolon
id|SIS_OH
op_star
id|poh_prev
suffix:semicolon
id|SIS_OH
op_star
id|poh_next
suffix:semicolon
id|u32
id|ulUpper
suffix:semicolon
id|u32
id|ulLower
suffix:semicolon
r_int
id|foundNode
op_assign
l_int|0
suffix:semicolon
id|poh_freed
op_assign
id|sisfb_heap.oh_used.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|poh_freed
op_ne
op_amp
id|sisfb_heap.oh_used
)paren
(brace
r_if
c_cond
(paren
id|poh_freed-&gt;offset
op_eq
id|base
)paren
(brace
id|foundNode
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|poh_freed
op_assign
id|poh_freed-&gt;poh_next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|foundNode
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|sisfb_heap.max_freesize
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_prev
op_assign
id|poh_next
op_assign
l_int|NULL
suffix:semicolon
id|ulUpper
op_assign
id|poh_freed-&gt;offset
op_plus
id|poh_freed-&gt;size
suffix:semicolon
id|ulLower
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|pohThis
op_assign
id|sisfb_heap.oh_free.poh_next
suffix:semicolon
r_while
c_loop
(paren
id|pohThis
op_ne
op_amp
id|sisfb_heap.oh_free
)paren
(brace
r_if
c_cond
(paren
id|pohThis-&gt;offset
op_eq
id|ulUpper
)paren
(brace
id|poh_next
op_assign
id|pohThis
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pohThis-&gt;offset
op_plus
id|pohThis-&gt;size
)paren
op_eq
id|ulLower
)paren
(brace
id|poh_prev
op_assign
id|pohThis
suffix:semicolon
)brace
id|pohThis
op_assign
id|pohThis-&gt;poh_next
suffix:semicolon
)brace
id|sisfb_delete_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh_prev
op_logical_and
id|poh_next
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
(paren
id|poh_freed-&gt;size
op_plus
id|poh_next-&gt;size
)paren
suffix:semicolon
id|sisfb_delete_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_next
)paren
suffix:semicolon
r_return
id|poh_prev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_prev
)paren
(brace
id|poh_prev-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
id|poh_prev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh_next
)paren
(brace
id|poh_next-&gt;size
op_add_assign
id|poh_freed-&gt;size
suffix:semicolon
id|poh_next-&gt;offset
op_assign
id|poh_freed-&gt;offset
suffix:semicolon
id|sisfb_free_node
c_func
(paren
id|poh_freed
)paren
suffix:semicolon
r_return
id|poh_next
suffix:semicolon
)brace
id|sisfb_insert_node
c_func
(paren
op_amp
id|sisfb_heap.oh_free
comma
id|poh_freed
)paren
suffix:semicolon
r_return
id|poh_freed
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisfb_free_node
id|sisfb_free_node
c_func
(paren
id|SIS_OH
op_star
id|poh
)paren
(brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh-&gt;poh_next
op_assign
id|sisfb_heap.poh_freelist
suffix:semicolon
id|sisfb_heap.poh_freelist
op_assign
id|poh
suffix:semicolon
)brace
r_void
DECL|function|sis_malloc
id|sis_malloc
c_func
(paren
r_struct
id|sis_memreq
op_star
id|req
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|sisfb_heap.vinfo
suffix:semicolon
id|SIS_OH
op_star
id|poh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo
)paren
op_logical_and
(paren
op_logical_neg
id|ivideo-&gt;havenoheap
)paren
)paren
(brace
id|poh
op_assign
id|sisfb_poh_allocate
c_func
(paren
(paren
id|u32
)paren
id|req-&gt;size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|req-&gt;offset
op_assign
id|req-&gt;size
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|req-&gt;offset
op_assign
id|poh-&gt;offset
suffix:semicolon
id|req-&gt;size
op_assign
id|poh-&gt;size
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: Video RAM allocation succeeded: 0x%lx&bslash;n&quot;
comma
(paren
id|poh-&gt;offset
op_plus
id|ivideo-&gt;video_vbase
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* sis_free: u32 because &quot;base&quot; is offset inside video ram, can never be &gt;4GB */
r_void
DECL|function|sis_free
id|sis_free
c_func
(paren
id|u32
id|base
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|sisfb_heap.vinfo
suffix:semicolon
id|SIS_OH
op_star
id|poh
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|ivideo
)paren
op_logical_or
(paren
id|ivideo-&gt;havenoheap
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|poh
op_assign
id|sisfb_poh_free
c_func
(paren
(paren
id|u32
)paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poh
op_eq
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;sisfb: sisfb_poh_free() failed at base 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------- SetMode routines ------------------------- */
r_static
r_void
DECL|function|sisfb_pre_setmode
id|sisfb_pre_setmode
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u8
id|cr30
op_assign
l_int|0
comma
id|cr31
op_assign
l_int|0
comma
id|cr33
op_assign
l_int|0
comma
id|cr35
op_assign
l_int|0
comma
id|cr38
op_assign
l_int|0
suffix:semicolon
r_int
id|tvregnum
op_assign
l_int|0
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_and_assign
(paren
id|VB_VIDEOBRIDGE
op_or
id|VB_DISPTYPE_DISP2
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x31
comma
id|cr31
)paren
suffix:semicolon
id|cr31
op_and_assign
op_complement
l_int|0x60
suffix:semicolon
id|cr31
op_or_assign
l_int|0x04
suffix:semicolon
id|cr33
op_assign
id|ivideo-&gt;rate_idx
op_amp
l_int|0x0F
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
id|cr38
)paren
suffix:semicolon
id|cr38
op_and_assign
op_complement
l_int|0x07
suffix:semicolon
multiline_comment|/* Clear LCDA/DualEdge and YPbPr bits */
)brace
r_else
(brace
id|tvregnum
op_assign
l_int|0x38
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|tvregnum
comma
id|cr38
)paren
suffix:semicolon
id|cr38
op_and_assign
op_complement
l_int|0x3b
suffix:semicolon
multiline_comment|/* Clear LCDA/DualEdge and YPbPr bits */
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|tvregnum
op_assign
l_int|0x35
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
id|tvregnum
comma
id|cr38
)paren
suffix:semicolon
)brace
macro_line|#endif
id|SiS_SetEnableDstn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|FALSE
)paren
suffix:semicolon
id|SiS_SetEnableFstn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|FALSE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_TV
suffix:colon
id|cr38
op_and_assign
op_complement
l_int|0xc0
suffix:semicolon
multiline_comment|/* Clear PAL-M / PAL-N bits */
r_if
c_cond
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_301LV
op_or
id|VB_302LV
)paren
)paren
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|cr38
op_or_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR525P
)paren
(brace
id|cr35
op_or_assign
l_int|0x20
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR750P
)paren
(brace
id|cr35
op_or_assign
l_int|0x40
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR1080I
)paren
(brace
id|cr35
op_or_assign
l_int|0x60
suffix:semicolon
)brace
id|cr30
op_or_assign
id|SIS_SIMULTANEOUS_VIEW_ENABLE
suffix:semicolon
id|cr35
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
(paren
id|TV_YPBPR
op_or
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPRALL
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
id|cr30
op_or_assign
(paren
l_int|0x80
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr38
op_or_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR525P
)paren
(brace
id|cr38
op_or_assign
l_int|0x10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR750P
)paren
(brace
id|cr38
op_or_assign
l_int|0x20
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPR1080I
)paren
(brace
id|cr38
op_or_assign
l_int|0x30
suffix:semicolon
)brace
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
(paren
id|TV_YPBPR
op_or
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_YPBPRALL
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_HIVISION
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_301B
op_or
id|VB_302B
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|cr38
op_or_assign
l_int|0x04
suffix:semicolon
id|cr35
op_or_assign
l_int|0x60
suffix:semicolon
)brace
r_else
(brace
id|cr30
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|cr30
op_or_assign
id|SIS_SIMULTANEOUS_VIEW_ENABLE
suffix:semicolon
id|cr31
op_or_assign
l_int|0x01
suffix:semicolon
id|cr35
op_or_assign
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_HIVISION
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_SCART
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SCART
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
l_int|0x01
suffix:semicolon
id|cr35
op_or_assign
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_SCART
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_SVIDEO
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_SVIDEO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_COMPOSITE
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_AVIDEO
suffix:semicolon
)brace
)brace
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|TV_AVIDEO
op_or
id|TV_SVIDEO
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_PAL
)paren
(brace
id|cr31
op_or_assign
l_int|0x01
suffix:semicolon
id|cr35
op_or_assign
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_PAL
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_PALM
)paren
(brace
id|cr38
op_or_assign
l_int|0x40
suffix:semicolon
id|cr35
op_or_assign
l_int|0x04
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_PALM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_PALN
)paren
(brace
id|cr38
op_or_assign
l_int|0x80
suffix:semicolon
id|cr35
op_or_assign
l_int|0x08
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_PALN
suffix:semicolon
)brace
)brace
r_else
(brace
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|cr35
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_NTSC
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSCJ
)paren
(brace
id|cr38
op_or_assign
l_int|0x40
suffix:semicolon
id|cr35
op_or_assign
l_int|0x02
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|TV_NTSCJ
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|CRT2_LCD
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_LCD
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
id|SiS_SetEnableDstn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;sisfb_dstn
)paren
suffix:semicolon
id|SiS_SetEnableFstn
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;sisfb_fstn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT2_VGA
suffix:colon
id|cr30
op_assign
(paren
id|SIS_VB_OUTPUT_CRT2
op_or
id|SIS_SIMULTANEOUS_VIEW_ENABLE
)paren
suffix:semicolon
id|cr31
op_or_assign
id|SIS_DRIVER_MODE
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_nocrt2rate
)paren
(brace
id|cr33
op_or_assign
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|rate_idx
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|cr33
op_or_assign
(paren
(paren
id|ivideo-&gt;rate_idx
op_amp
l_int|0x0F
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* disable CRT2 */
id|cr30
op_assign
l_int|0x00
suffix:semicolon
id|cr31
op_or_assign
(paren
id|SIS_DRIVER_MODE
op_or
id|SIS_VB_OUTPUT_DISABLE
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|cr30
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x33
comma
id|cr33
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_315
id|cr31
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
multiline_comment|/* Clear PAL flag (now in CR35) */
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x35
comma
op_complement
l_int|0x10
comma
id|cr35
)paren
suffix:semicolon
multiline_comment|/* Leave overscan bit alone */
id|cr38
op_and_assign
l_int|0x07
suffix:semicolon
multiline_comment|/* Use only LCDA and HiVision/YPbPr bits */
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x38
comma
l_int|0xf8
comma
id|cr38
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ne
id|SIS_300
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|tvregnum
comma
id|cr38
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x31
comma
id|cr31
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;accel
)paren
(brace
id|sisfb_syncaccel
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
id|ivideo-&gt;SiS_Pr.SiS_UseOEM
op_assign
id|ivideo-&gt;sisfb_useoem
suffix:semicolon
)brace
multiline_comment|/* Fix SR11 for 661 and later */
macro_line|#ifdef CONFIG_FB_SIS_315
r_static
r_void
DECL|function|sisfb_fixup_SR11
id|sisfb_fixup_SR11
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|u8
id|tmpreg
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
id|tmpreg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmpreg
op_amp
l_int|0x20
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3e
comma
id|tmpreg
)paren
suffix:semicolon
id|tmpreg
op_assign
(paren
id|tmpreg
op_plus
l_int|1
)paren
op_amp
l_int|0xff
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3e
comma
id|tmpreg
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
id|tmpreg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmpreg
op_amp
l_int|0xf0
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
l_int|0x0f
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
DECL|function|sisfb_set_TVxposoffset
r_static
r_void
id|sisfb_set_TVxposoffset
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|val
OG
l_int|32
)paren
(brace
id|val
op_assign
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
OL
op_minus
l_int|32
)paren
(brace
id|val
op_assign
op_minus
l_int|32
suffix:semicolon
)brace
id|ivideo-&gt;tvxpos
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfblocked
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;modechanged
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_TV
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
r_int
id|x
op_assign
id|ivideo-&gt;tvx
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;chronteltype
)paren
(brace
r_case
l_int|1
suffix:colon
id|x
op_add_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|x
OL
l_int|0
)paren
(brace
id|x
op_assign
l_int|0
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
(paren
(paren
id|x
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_or
l_int|0x0a
)paren
)paren
suffix:semicolon
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
(paren
(paren
id|x
op_amp
l_int|0x0100
)paren
op_lshift
l_int|1
)paren
op_or
l_int|0x08
)paren
comma
l_int|0xFD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Not supported by hardware */
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_SISBRIDGE
)paren
(brace
id|u8
id|p2_1f
comma
id|p2_20
comma
id|p2_2b
comma
id|p2_42
comma
id|p2_43
suffix:semicolon
r_int
r_int
id|temp
suffix:semicolon
id|p2_1f
op_assign
id|ivideo-&gt;p2_1f
suffix:semicolon
id|p2_20
op_assign
id|ivideo-&gt;p2_20
suffix:semicolon
id|p2_2b
op_assign
id|ivideo-&gt;p2_2b
suffix:semicolon
id|p2_42
op_assign
id|ivideo-&gt;p2_42
suffix:semicolon
id|p2_43
op_assign
id|ivideo-&gt;p2_43
suffix:semicolon
id|temp
op_assign
id|p2_1f
op_or
(paren
(paren
id|p2_20
op_amp
l_int|0xf0
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_add_assign
(paren
id|val
op_star
l_int|2
)paren
suffix:semicolon
id|p2_1f
op_assign
id|temp
op_amp
l_int|0xff
suffix:semicolon
id|p2_20
op_assign
(paren
id|temp
op_amp
l_int|0xf00
)paren
op_rshift
l_int|4
suffix:semicolon
id|p2_2b
op_assign
(paren
(paren
id|p2_2b
op_amp
l_int|0x0f
)paren
op_plus
(paren
id|val
op_star
l_int|2
)paren
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|temp
op_assign
id|p2_43
op_or
(paren
(paren
id|p2_42
op_amp
l_int|0xf0
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_add_assign
(paren
id|val
op_star
l_int|2
)paren
suffix:semicolon
id|p2_43
op_assign
id|temp
op_amp
l_int|0xff
suffix:semicolon
id|p2_42
op_assign
(paren
id|temp
op_amp
l_int|0xf00
)paren
op_rshift
l_int|4
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x1f
comma
id|p2_1f
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x20
comma
l_int|0x0F
comma
id|p2_20
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x2b
comma
l_int|0xF0
comma
id|p2_2b
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x42
comma
l_int|0x0F
comma
id|p2_42
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x43
comma
id|p2_43
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|sisfb_set_TVyposoffset
r_static
r_void
id|sisfb_set_TVyposoffset
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|val
OG
l_int|32
)paren
(brace
id|val
op_assign
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
OL
op_minus
l_int|32
)paren
(brace
id|val
op_assign
op_minus
l_int|32
suffix:semicolon
)brace
id|ivideo-&gt;tvypos
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfblocked
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;modechanged
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_TV
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
r_int
id|y
op_assign
id|ivideo-&gt;tvy
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;chronteltype
)paren
(brace
r_case
l_int|1
suffix:colon
id|y
op_sub_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|y
OL
l_int|0
)paren
(brace
id|y
op_assign
l_int|0
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
id|SiS_SetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
(paren
(paren
id|y
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_or
l_int|0x0b
)paren
)paren
suffix:semicolon
id|SiS_SetCH70xxANDOR
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
(paren
(paren
id|y
op_amp
l_int|0x0100
)paren
op_or
l_int|0x08
)paren
comma
l_int|0xFE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Not supported by hardware */
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_SISBRIDGE
)paren
(brace
r_char
id|p2_01
comma
id|p2_02
suffix:semicolon
id|val
op_div_assign
l_int|2
suffix:semicolon
id|p2_01
op_assign
id|ivideo-&gt;p2_01
suffix:semicolon
id|p2_02
op_assign
id|ivideo-&gt;p2_02
suffix:semicolon
id|p2_01
op_add_assign
id|val
suffix:semicolon
id|p2_02
op_add_assign
id|val
suffix:semicolon
r_while
c_loop
(paren
(paren
id|p2_01
op_le
l_int|0
)paren
op_logical_or
(paren
id|p2_02
op_le
l_int|0
)paren
)paren
(brace
id|p2_01
op_add_assign
l_int|2
suffix:semicolon
id|p2_02
op_add_assign
l_int|2
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x01
comma
id|p2_01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x02
comma
id|p2_02
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|sisfb_post_setmode
id|sisfb_post_setmode
c_func
(paren
r_struct
id|sis_video_info
op_star
id|ivideo
)paren
(brace
id|BOOLEAN
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
id|BOOLEAN
id|doit
op_assign
id|TRUE
suffix:semicolon
macro_line|#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)
id|u8
id|reg
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
id|u8
id|reg1
suffix:semicolon
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|sisfb_fixup_SR11
c_func
(paren
id|ivideo
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Now we actually HAVE changed the display mode */
id|ivideo-&gt;modechanged
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* We can&squot;t switch off CRT1 if bridge is in slave mode */
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
r_if
c_cond
(paren
id|sisfb_bridgeisslave
c_func
(paren
id|ivideo
)paren
)paren
(brace
id|doit
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_else
id|ivideo-&gt;sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_crt1off
)paren
op_logical_and
(paren
id|doit
)paren
)paren
(brace
id|crt1isoff
op_assign
id|TRUE
suffix:semicolon
id|reg
op_assign
l_int|0x00
suffix:semicolon
)brace
r_else
(brace
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
id|reg
op_assign
l_int|0x80
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x7f
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_crt1off
)paren
op_logical_and
(paren
id|doit
)paren
)paren
(brace
id|crt1isoff
op_assign
id|TRUE
suffix:semicolon
id|reg
op_assign
l_int|0x40
suffix:semicolon
id|reg1
op_assign
l_int|0xc0
suffix:semicolon
)brace
r_else
(brace
id|crt1isoff
op_assign
id|FALSE
suffix:semicolon
id|reg
op_assign
l_int|0x00
suffix:semicolon
id|reg1
op_assign
l_int|0x00
suffix:semicolon
)brace
id|setSISIDXREG
c_func
(paren
id|SISCR
comma
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
comma
op_complement
l_int|0x40
comma
id|reg
)paren
suffix:semicolon
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
op_complement
l_int|0xc0
comma
id|reg1
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|crt1isoff
)paren
(brace
id|ivideo-&gt;currentvbflags
op_and_assign
op_complement
id|VB_DISPTYPE_CRT1
suffix:semicolon
id|ivideo-&gt;currentvbflags
op_or_assign
id|VB_SINGLE_MODE
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|VB_DISPTYPE_CRT1
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_CRT2
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|VB_MIRROR_MODE
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|VB_SINGLE_MODE
suffix:semicolon
)brace
)brace
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_RAMDAC_CONTROL
comma
op_complement
l_int|0x04
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_TV
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_SISBRIDGE
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x1f
comma
id|ivideo-&gt;p2_1f
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x20
comma
id|ivideo-&gt;p2_20
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x2b
comma
id|ivideo-&gt;p2_2b
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x42
comma
id|ivideo-&gt;p2_42
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x43
comma
id|ivideo-&gt;p2_43
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x01
comma
id|ivideo-&gt;p2_01
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x02
comma
id|ivideo-&gt;p2_02
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;chronteltype
op_eq
l_int|1
)paren
(brace
id|ivideo-&gt;tvx
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0a
)paren
suffix:semicolon
id|ivideo-&gt;tvx
op_or_assign
(paren
(paren
(paren
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x08
)paren
op_amp
l_int|0x02
)paren
op_rshift
l_int|1
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|ivideo-&gt;tvy
op_assign
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x0b
)paren
suffix:semicolon
id|ivideo-&gt;tvy
op_or_assign
(paren
(paren
id|SiS_GetCH700x
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
l_int|0x08
)paren
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;tvxpos
)paren
(brace
id|sisfb_set_TVxposoffset
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;tvxpos
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;tvypos
)paren
(brace
id|sisfb_set_TVyposoffset
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;tvypos
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|CRT2_TV
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_301
)paren
)paren
(brace
multiline_comment|/* Set filter for SiS301 */
r_int
r_char
id|filter_tb
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;video_width
)paren
(brace
r_case
l_int|320
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|640
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|filter_tb
op_assign
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSC
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo-&gt;sisfb_filter
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
id|ivideo-&gt;CRT2_write_enable
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_NTSC
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3a
comma
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xdf
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x04
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEE
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x0C
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x22
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xEB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x15
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x25
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0xF6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_PAL
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x3A
comma
l_int|0x1F
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_SVIDEO
)paren
(brace
id|andSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0xDF
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|TV_AVIDEO
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x30
comma
l_int|0x20
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ivideo-&gt;video_width
)paren
(brace
r_case
l_int|640
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xF7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1F
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xF3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x1D
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|400
suffix:colon
r_case
l_int|800
suffix:colon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
l_int|0xFC
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
l_int|0xFB
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
l_int|0x14
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
l_int|0x2A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_filter
op_ge
l_int|0
)paren
op_logical_and
(paren
id|ivideo-&gt;sisfb_filter
op_le
l_int|7
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x35
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|ivideo-&gt;sisfb_filter
)braket
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x36
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|ivideo-&gt;sisfb_filter
)braket
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x37
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|ivideo-&gt;sisfb_filter
)braket
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x38
comma
(paren
id|sis_TV_filter
(braket
id|filter_tb
)braket
dot
id|filter
(braket
id|ivideo-&gt;sisfb_filter
)braket
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifndef MODULE
DECL|function|sisfb_setup
r_int
id|__init
id|sisfb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
id|sisfb_setdefaultparms
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Options %s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
(paren
op_star
id|options
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|this_opt
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_off
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt2type:&quot;
comma
l_int|14
)paren
)paren
(brace
multiline_comment|/* Need to check crt2 type first for fstn/dstn */
id|sisfb_search_crt2type
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvmode:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvstandard:&quot;
comma
l_int|11
)paren
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|this_opt
op_plus
l_int|7
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vesa:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
comma
id|FALSE
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* fb_invert_cmaps(); */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|this_opt
op_plus
l_int|5
)paren
OL
l_int|40
)paren
(brace
id|strncpy
c_func
(paren
id|sisfb_fontname
comma
id|this_opt
op_plus
l_int|5
comma
r_sizeof
(paren
id|sisfb_fontname
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|sisfb_fontname
(braket
r_sizeof
(paren
id|sisfb_fontname
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;rate:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_parm_rate
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;filter:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_filter
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forcecrt1:&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_forcecrt1
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|10
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mem:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_parm_mem
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pdc:&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_pdc
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pdc1:&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_pdca
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;accel&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_accel
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noypan&quot;
comma
l_int|6
)paren
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;ypan&quot;
comma
l_int|4
)paren
)paren
(brace
id|sisfb_ypan
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomax&quot;
comma
l_int|5
)paren
)paren
(brace
id|sisfb_max
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;max&quot;
comma
l_int|3
)paren
)paren
(brace
id|sisfb_max
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;userom:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_userom
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;useoem:&quot;
comma
l_int|7
)paren
)paren
(brace
id|sisfb_useoem
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nocrt2rate&quot;
comma
l_int|10
)paren
)paren
(brace
id|sisfb_nocrt2rate
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;scalelcd:&quot;
comma
l_int|9
)paren
)paren
(brace
r_int
r_int
id|temp
op_assign
l_int|2
suffix:semicolon
id|temp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|9
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_eq
l_int|0
)paren
op_logical_or
(paren
id|temp
op_eq
l_int|1
)paren
)paren
(brace
id|sisfb_scalelcd
op_assign
id|temp
op_xor
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvxposoffset:&quot;
comma
l_int|13
)paren
)paren
(brace
r_int
id|temp
op_assign
l_int|0
suffix:semicolon
id|temp
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|this_opt
op_plus
l_int|13
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ge
op_minus
l_int|32
)paren
op_logical_and
(paren
id|temp
op_le
l_int|32
)paren
)paren
(brace
id|sisfb_tvxposoffset
op_assign
id|temp
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;tvyposoffset:&quot;
comma
l_int|13
)paren
)paren
(brace
r_int
id|temp
op_assign
l_int|0
suffix:semicolon
id|temp
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|this_opt
op_plus
l_int|13
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ge
op_minus
l_int|32
)paren
op_logical_and
(paren
id|temp
op_le
l_int|32
)paren
)paren
(brace
id|sisfb_tvyposoffset
op_assign
id|temp
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;specialtiming:&quot;
comma
l_int|14
)paren
)paren
(brace
id|sisfb_search_specialtiming
c_func
(paren
id|this_opt
op_plus
l_int|14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lvdshl:&quot;
comma
l_int|7
)paren
)paren
(brace
r_int
id|temp
op_assign
l_int|4
suffix:semicolon
id|temp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ge
l_int|0
)paren
op_logical_and
(paren
id|temp
op_le
l_int|3
)paren
)paren
(brace
id|sisfb_lvdshl
op_assign
id|temp
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|this_opt
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
id|this_opt
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|this_opt
comma
id|TRUE
)paren
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;resetcard&quot;
comma
l_int|9
)paren
)paren
(brace
id|sisfb_resetcard
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|this_opt
comma
l_string|&quot;videoram:&quot;
comma
l_int|9
)paren
)paren
(brace
id|sisfb_videoram
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|9
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Invalid option %s&bslash;n&quot;
comma
id|this_opt
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sis_find_rom
r_static
r_void
id|__iomem
op_star
id|__devinit
id|sis_find_rom
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
macro_line|#if defined(__i386__) || defined(__x86_64__)
id|u32
id|segstart
suffix:semicolon
r_void
id|__iomem
op_star
id|rom_base
comma
op_star
id|rom
suffix:semicolon
r_int
id|romptr
suffix:semicolon
r_int
r_int
id|pciid
suffix:semicolon
r_for
c_loop
(paren
id|segstart
op_assign
l_int|0x000c0000
suffix:semicolon
id|segstart
OL
l_int|0x000f0000
suffix:semicolon
id|segstart
op_add_assign
l_int|0x00001000
)paren
(brace
id|rom_base
op_assign
id|ioremap
c_func
(paren
id|segstart
comma
l_int|0x10000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rom_base
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
id|rom_base
)paren
op_ne
l_int|0x55
)paren
op_logical_or
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|1
)paren
op_ne
l_int|0xaa
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|romptr
op_assign
(paren
r_int
r_int
)paren
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|0x18
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|0x19
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|romptr
OG
(paren
l_int|0x10000
op_minus
l_int|8
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
op_plus
id|romptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
id|rom
)paren
op_ne
l_char|&squot;P&squot;
)paren
op_logical_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|1
)paren
op_ne
l_char|&squot;C&squot;
)paren
op_logical_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|2
)paren
op_ne
l_char|&squot;I&squot;
)paren
op_logical_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|3
)paren
op_ne
l_char|&squot;R&squot;
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pciid
op_assign
id|readb
c_func
(paren
id|rom
op_plus
l_int|4
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|5
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_ne
l_int|0x1039
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pciid
op_assign
id|readb
c_func
(paren
id|rom
op_plus
l_int|6
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|7
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_eq
id|ivideo-&gt;chip_id
)paren
(brace
r_return
id|rom_base
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
)brace
macro_line|#else
r_void
id|__iomem
op_star
id|rom_base
comma
op_star
id|rom
comma
op_star
id|myrombase
op_assign
l_int|NULL
suffix:semicolon
r_int
id|romptr
suffix:semicolon
r_int
r_int
id|pciid
suffix:semicolon
id|u32
id|backup
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|PCI_ROM_ADDRESS
comma
op_amp
id|backup
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|PCI_ROM_ADDRESS
comma
(paren
id|ivideo-&gt;video_base
op_amp
id|PCI_ROM_ADDRESS_MASK
)paren
op_or
id|PCI_ROM_ADDRESS_ENABLE
)paren
suffix:semicolon
id|rom_base
op_assign
id|ioremap
c_func
(paren
id|ivideo-&gt;video_base
comma
l_int|65536
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rom_base
)paren
(brace
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
id|rom_base
)paren
op_eq
l_int|0x55
)paren
op_logical_and
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|1
)paren
op_eq
l_int|0xaa
)paren
)paren
(brace
id|romptr
op_assign
(paren
id|u16
)paren
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|0x18
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom_base
op_plus
l_int|0x19
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|romptr
op_le
(paren
l_int|0x10000
op_minus
l_int|8
)paren
)paren
(brace
id|rom
op_assign
id|rom_base
op_plus
id|romptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
id|rom
)paren
op_eq
l_char|&squot;P&squot;
)paren
op_logical_and
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|1
)paren
op_eq
l_char|&squot;C&squot;
)paren
op_logical_and
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|2
)paren
op_eq
l_char|&squot;I&squot;
)paren
op_logical_and
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|3
)paren
op_eq
l_char|&squot;R&squot;
)paren
)paren
(brace
id|pciid
op_assign
id|readb
c_func
(paren
id|rom
op_plus
l_int|4
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|5
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_eq
l_int|0x1039
)paren
(brace
id|pciid
op_assign
id|readb
c_func
(paren
id|rom
op_plus
l_int|6
)paren
op_or
(paren
id|readb
c_func
(paren
id|rom
op_plus
l_int|7
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pciid
op_eq
id|ivideo-&gt;chip_id
)paren
(brace
r_if
c_cond
(paren
(paren
id|myrombase
op_assign
id|vmalloc
c_func
(paren
l_int|65536
)paren
)paren
)paren
(brace
id|memcpy_fromio
c_func
(paren
id|myrombase
comma
id|rom_base
comma
l_int|65536
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
)brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|PCI_ROM_ADDRESS
comma
id|backup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myrombase
)paren
(brace
r_return
id|myrombase
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_static
r_int
id|__devinit
DECL|function|sisfb_chkbuswidth300
id|sisfb_chkbuswidth300
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_void
id|__iomem
op_star
id|FBAddress
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|USHORT
id|temp
suffix:semicolon
id|UCHAR
id|reg
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0xFB
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0x04
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0xBF
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|temp
op_assign
l_int|0x1234
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|writew
c_func
(paren
id|temp
comma
id|FBAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readw
c_func
(paren
id|FBAddress
)paren
op_eq
id|temp
)paren
(brace
r_break
suffix:semicolon
)brace
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
l_int|0x01
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
id|reg
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
id|reg
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
l_int|0xfe
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
id|reg
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
id|reg
)paren
suffix:semicolon
id|temp
op_increment
suffix:semicolon
)brace
)brace
id|writel
c_func
(paren
l_int|0x01234567L
comma
id|FBAddress
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x456789ABL
comma
(paren
id|FBAddress
op_plus
l_int|4
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x89ABCDEFL
comma
(paren
id|FBAddress
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xCDEF0123L
comma
(paren
id|FBAddress
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3b
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0x01
)paren
(brace
r_if
c_cond
(paren
id|readl
c_func
(paren
(paren
id|FBAddress
op_plus
l_int|12
)paren
)paren
op_eq
l_int|0xCDEF0123L
)paren
(brace
r_return
l_int|4
suffix:semicolon
)brace
multiline_comment|/* Channel A 128bit */
)brace
r_if
c_cond
(paren
id|readl
c_func
(paren
(paren
id|FBAddress
op_plus
l_int|4
)paren
)paren
op_eq
l_int|0x456789ABL
)paren
(brace
r_return
l_int|2
suffix:semicolon
)brace
multiline_comment|/* Channel B 64bit */
r_return
l_int|1
suffix:semicolon
multiline_comment|/* 32bit */
)brace
r_static
r_void
id|__devinit
DECL|function|sisfb_setramsize300
id|sisfb_setramsize300
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|FBAddr
op_assign
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
comma
op_star
id|Addr
suffix:semicolon
id|USHORT
id|SR13
comma
id|SR14
op_assign
l_int|0
comma
id|buswidth
comma
id|Done
comma
id|data
comma
id|TotalCapacity
comma
id|PhysicalAdrOtherPage
op_assign
l_int|0
suffix:semicolon
r_int
id|PseudoRankCapacity
comma
id|PseudoTotalCapacity
comma
id|PseudoAdrPinCount
suffix:semicolon
r_int
id|RankCapacity
comma
id|AdrPinCount
comma
id|BankNumHigh
comma
id|BankNumMid
comma
id|MB2Bank
suffix:semicolon
r_int
id|PageCapacity
comma
id|PhysicalAdrHigh
comma
id|PhysicalAdrHalfPage
comma
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_const
id|USHORT
id|SiS_DRAMType
(braket
l_int|17
)braket
(braket
l_int|5
)braket
op_assign
(brace
(brace
l_int|0x0C
comma
l_int|0x0A
comma
l_int|0x02
comma
l_int|0x40
comma
l_int|0x39
)brace
comma
(brace
l_int|0x0D
comma
l_int|0x0A
comma
l_int|0x01
comma
l_int|0x40
comma
l_int|0x48
)brace
comma
(brace
l_int|0x0C
comma
l_int|0x09
comma
l_int|0x02
comma
l_int|0x20
comma
l_int|0x35
)brace
comma
(brace
l_int|0x0D
comma
l_int|0x09
comma
l_int|0x01
comma
l_int|0x20
comma
l_int|0x44
)brace
comma
(brace
l_int|0x0C
comma
l_int|0x08
comma
l_int|0x02
comma
l_int|0x10
comma
l_int|0x31
)brace
comma
(brace
l_int|0x0D
comma
l_int|0x08
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x40
)brace
comma
(brace
l_int|0x0C
comma
l_int|0x0A
comma
l_int|0x01
comma
l_int|0x20
comma
l_int|0x34
)brace
comma
(brace
l_int|0x0C
comma
l_int|0x09
comma
l_int|0x01
comma
l_int|0x08
comma
l_int|0x32
)brace
comma
(brace
l_int|0x0B
comma
l_int|0x08
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x21
)brace
comma
(brace
l_int|0x0C
comma
l_int|0x08
comma
l_int|0x01
comma
l_int|0x08
comma
l_int|0x30
)brace
comma
(brace
l_int|0x0A
comma
l_int|0x08
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x11
)brace
comma
(brace
l_int|0x0B
comma
l_int|0x0A
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x28
)brace
comma
(brace
l_int|0x09
comma
l_int|0x08
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x01
)brace
comma
(brace
l_int|0x0B
comma
l_int|0x09
comma
l_int|0x01
comma
l_int|0x08
comma
l_int|0x24
)brace
comma
(brace
l_int|0x0B
comma
l_int|0x08
comma
l_int|0x01
comma
l_int|0x04
comma
l_int|0x20
)brace
comma
(brace
l_int|0x0A
comma
l_int|0x08
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x10
)brace
comma
(brace
l_int|0x09
comma
l_int|0x08
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
)brace
)brace
suffix:semicolon
id|buswidth
op_assign
id|sisfb_chkbuswidth300
c_func
(paren
id|pdev
comma
id|FBAddr
)paren
suffix:semicolon
id|MB2Bank
op_assign
l_int|16
suffix:semicolon
id|Done
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|6
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|Done
)paren
(brace
r_break
suffix:semicolon
)brace
id|PseudoRankCapacity
op_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|4
suffix:semicolon
id|j
op_ge
l_int|1
suffix:semicolon
id|j
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|Done
)paren
(brace
r_break
suffix:semicolon
)brace
id|PseudoTotalCapacity
op_assign
id|PseudoRankCapacity
op_star
id|j
suffix:semicolon
id|PseudoAdrPinCount
op_assign
l_int|15
op_minus
id|j
suffix:semicolon
r_if
c_cond
(paren
id|PseudoTotalCapacity
op_le
l_int|64
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
op_le
l_int|16
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|Done
)paren
(brace
r_break
suffix:semicolon
)brace
id|RankCapacity
op_assign
id|buswidth
op_star
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|3
)braket
suffix:semicolon
id|AdrPinCount
op_assign
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|2
)braket
op_plus
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|RankCapacity
op_eq
id|PseudoRankCapacity
)paren
r_if
c_cond
(paren
id|AdrPinCount
op_le
id|PseudoAdrPinCount
)paren
(brace
r_if
c_cond
(paren
id|j
op_eq
l_int|3
)paren
(brace
multiline_comment|/* Rank No */
id|BankNumHigh
op_assign
id|RankCapacity
op_star
id|MB2Bank
op_star
l_int|3
op_minus
l_int|1
suffix:semicolon
id|BankNumMid
op_assign
id|RankCapacity
op_star
id|MB2Bank
op_star
l_int|1
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|BankNumHigh
op_assign
id|RankCapacity
op_star
id|MB2Bank
op_star
id|j
op_minus
l_int|1
suffix:semicolon
id|BankNumMid
op_assign
id|RankCapacity
op_star
id|MB2Bank
op_star
id|j
op_div
l_int|2
op_minus
l_int|1
suffix:semicolon
)brace
id|PageCapacity
op_assign
(paren
l_int|1
op_lshift
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|1
)braket
)paren
op_star
id|buswidth
op_star
l_int|4
suffix:semicolon
id|PhysicalAdrHigh
op_assign
id|BankNumHigh
suffix:semicolon
id|PhysicalAdrHalfPage
op_assign
(paren
id|PageCapacity
op_div
l_int|2
op_plus
id|PhysicalAdrHigh
)paren
op_mod
id|PageCapacity
suffix:semicolon
id|PhysicalAdrOtherPage
op_assign
id|PageCapacity
op_star
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|2
)braket
op_plus
id|PhysicalAdrHigh
suffix:semicolon
multiline_comment|/* Write data */
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0xFB
)paren
suffix:semicolon
multiline_comment|/* Test */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* Test */
id|TotalCapacity
op_assign
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|3
)braket
op_star
id|buswidth
suffix:semicolon
id|SR13
op_assign
id|SiS_DRAMType
(braket
id|k
)braket
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buswidth
op_eq
l_int|4
)paren
(brace
id|SR14
op_assign
(paren
id|TotalCapacity
op_minus
l_int|1
)paren
op_or
l_int|0x80
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buswidth
op_eq
l_int|2
)paren
(brace
id|SR14
op_assign
(paren
id|TotalCapacity
op_minus
l_int|1
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buswidth
op_eq
l_int|1
)paren
(brace
id|SR14
op_assign
(paren
id|TotalCapacity
op_minus
l_int|1
)paren
op_or
l_int|0x00
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
id|SR13
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|SR14
)paren
suffix:semicolon
id|Addr
op_assign
id|FBAddr
op_plus
id|BankNumHigh
op_star
l_int|64
op_star
l_int|1024
op_plus
id|PhysicalAdrHigh
suffix:semicolon
multiline_comment|/* *((USHORT *)(Addr)) = (USHORT)PhysicalAdrHigh; */
id|writew
c_func
(paren
(paren
(paren
id|USHORT
)paren
id|PhysicalAdrHigh
)paren
comma
id|Addr
)paren
suffix:semicolon
id|Addr
op_assign
id|FBAddr
op_plus
id|BankNumMid
op_star
l_int|64
op_star
l_int|1024
op_plus
id|PhysicalAdrHigh
suffix:semicolon
multiline_comment|/* *((USHORT *)(Addr)) = (USHORT)BankNumMid; */
id|writew
c_func
(paren
(paren
(paren
id|USHORT
)paren
id|BankNumMid
)paren
comma
id|Addr
)paren
suffix:semicolon
id|Addr
op_assign
id|FBAddr
op_plus
id|BankNumHigh
op_star
l_int|64
op_star
l_int|1024
op_plus
id|PhysicalAdrHalfPage
suffix:semicolon
multiline_comment|/* *((USHORT *)(Addr)) = (USHORT)PhysicalAdrHalfPage; */
id|writew
c_func
(paren
(paren
(paren
id|USHORT
)paren
id|PhysicalAdrHalfPage
)paren
comma
id|Addr
)paren
suffix:semicolon
id|Addr
op_assign
id|FBAddr
op_plus
id|BankNumHigh
op_star
l_int|64
op_star
l_int|1024
op_plus
id|PhysicalAdrOtherPage
suffix:semicolon
multiline_comment|/* *((USHORT *)(Addr)) = PhysicalAdrOtherPage; */
id|writew
c_func
(paren
(paren
(paren
id|USHORT
)paren
id|PhysicalAdrOtherPage
)paren
comma
id|Addr
)paren
suffix:semicolon
multiline_comment|/* Read data */
id|Addr
op_assign
id|FBAddr
op_plus
id|BankNumHigh
op_star
l_int|64
op_star
l_int|1024
op_plus
id|PhysicalAdrHigh
suffix:semicolon
id|data
op_assign
id|readw
c_func
(paren
id|Addr
)paren
suffix:semicolon
multiline_comment|/* *((USHORT *)(Addr)); */
r_if
c_cond
(paren
id|data
op_eq
id|PhysicalAdrHigh
)paren
(brace
id|Done
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* if */
)brace
multiline_comment|/* for k */
)brace
multiline_comment|/* if */
)brace
multiline_comment|/* for j */
)brace
multiline_comment|/* for i */
)brace
DECL|function|sisfb_post_sis300
r_static
r_void
id|__devinit
id|sisfb_post_sis300
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|u8
id|reg
comma
id|v1
comma
id|v2
comma
id|v3
comma
id|v4
comma
id|v5
comma
id|v6
comma
id|v7
comma
id|v8
suffix:semicolon
id|u16
id|index
comma
id|rindex
comma
id|memtype
op_assign
l_int|0
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x52
)braket
op_amp
l_int|0x80
)paren
(brace
id|memtype
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x52
)braket
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
id|memtype
)paren
suffix:semicolon
)brace
id|memtype
op_and_assign
l_int|0x07
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;revision_id
op_le
l_int|0x13
)paren
(brace
id|v1
op_assign
l_int|0x44
suffix:semicolon
id|v2
op_assign
l_int|0x42
suffix:semicolon
id|v3
op_assign
l_int|0x80
suffix:semicolon
id|v4
op_assign
l_int|0x44
suffix:semicolon
id|v5
op_assign
l_int|0x42
suffix:semicolon
id|v6
op_assign
l_int|0x80
suffix:semicolon
)brace
r_else
(brace
id|v1
op_assign
l_int|0x68
suffix:semicolon
id|v2
op_assign
l_int|0x43
suffix:semicolon
id|v3
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Assume 125Mhz MCLK */
id|v4
op_assign
l_int|0x68
suffix:semicolon
id|v5
op_assign
l_int|0x43
suffix:semicolon
id|v6
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Assume 125Mhz ECLK */
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|index
op_assign
id|memtype
op_star
l_int|5
suffix:semicolon
id|rindex
op_assign
id|index
op_plus
l_int|0x54
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|rindex
op_assign
id|index
op_plus
l_int|0x7c
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2a
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2e
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2f
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x30
comma
id|v6
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xa4
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
id|v1
)paren
suffix:semicolon
multiline_comment|/* DAC speed */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
l_int|0x0f
)paren
suffix:semicolon
multiline_comment|/* DDC, power save */
id|v1
op_assign
l_int|0x01
suffix:semicolon
id|v2
op_assign
l_int|0x43
suffix:semicolon
id|v3
op_assign
l_int|0x1e
suffix:semicolon
id|v4
op_assign
l_int|0x2a
suffix:semicolon
id|v5
op_assign
l_int|0x06
suffix:semicolon
id|v6
op_assign
l_int|0x00
suffix:semicolon
id|v7
op_assign
l_int|0x00
suffix:semicolon
id|v8
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|memtype
op_add_assign
l_int|0xa5
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|8
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|16
)braket
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|24
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|32
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|40
)braket
suffix:semicolon
id|v7
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|48
)braket
suffix:semicolon
id|v8
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|memtype
op_plus
l_int|56
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;revision_id
op_ge
l_int|0x80
)paren
(brace
id|v3
op_and_assign
l_int|0xfd
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
id|v1
)paren
suffix:semicolon
multiline_comment|/* Ram type (assuming 0, BIOS 0xa5 step 8) */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x18
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1a
comma
id|v6
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1b
comma
id|v7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1c
comma
id|v8
)paren
suffix:semicolon
multiline_comment|/* ---- */
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0xfb
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0x04
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x53
)braket
op_amp
l_int|0x02
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
l_int|0x20
)paren
suffix:semicolon
)brace
)brace
id|v1
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* DAC pedestal (BIOS 0xe5) */
r_if
c_cond
(paren
id|ivideo-&gt;revision_id
op_ge
l_int|0x80
)paren
(brace
id|v1
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
l_int|0xa0
)paren
suffix:semicolon
multiline_comment|/* linear &amp; relocated io */
id|v1
op_assign
l_int|0xf6
suffix:semicolon
id|v2
op_assign
l_int|0x0d
suffix:semicolon
id|v3
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xe8
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xe9
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xea
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x23
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x24
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x25
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0x84
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x22
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x37
comma
l_int|0x00
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x24
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* unlock crt2 */
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x40
suffix:semicolon
id|v2
op_assign
l_int|0x11
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xec
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xeb
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
id|v1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;revision_id
op_ge
l_int|0x80
)paren
(brace
id|v2
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
)brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_eq
l_int|1
)paren
op_logical_or
(paren
id|reg
op_eq
l_int|2
)paren
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x37
comma
l_int|0x02
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1c
)paren
suffix:semicolon
id|v4
op_assign
l_int|0x00
suffix:semicolon
id|v5
op_assign
l_int|0x00
suffix:semicolon
id|v6
op_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xf5
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xf6
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xf7
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0e
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
id|v6
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0f
comma
l_int|0x3f
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xb0
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x20
suffix:semicolon
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|v2
op_and_assign
op_complement
l_int|0x10
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x32
comma
id|v2
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x24
comma
l_int|0xfe
)paren
suffix:semicolon
multiline_comment|/* Lock CRT2 */
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0xc3
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x35
comma
id|reg
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x83
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
r_if
c_cond
(paren
id|sisfb_videoram
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x28
)paren
suffix:semicolon
multiline_comment|/* ? */
id|reg
op_assign
(paren
(paren
id|sisfb_videoram
op_rshift
l_int|10
)paren
op_minus
l_int|1
)paren
op_or
l_int|0x40
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|reg
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
multiline_comment|/* Need to map max FB size for finding out about RAM size */
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo-&gt;video_base
comma
l_int|0x4000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
)paren
(brace
id|sisfb_setramsize300
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Failed to map memory for size detection, assuming 8MB&bslash;n&quot;
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x28
)paren
suffix:semicolon
multiline_comment|/* ? */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x47
)paren
suffix:semicolon
multiline_comment|/* 8MB, 64bit default */
)brace
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xe6
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xe7
)braket
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0x30
)paren
op_eq
l_int|0x30
)paren
(brace
id|v1
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* PCI */
id|v2
op_assign
l_int|0x92
suffix:semicolon
)brace
r_else
(brace
id|v1
op_assign
l_int|0x14
suffix:semicolon
multiline_comment|/* AGP */
id|v2
op_assign
l_int|0xb2
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x22
comma
id|v2
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
DECL|function|sisfb_post_sis315330
r_static
r_void
id|__devinit
id|sisfb_post_sis315330
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
macro_line|#ifdef YET_TO_BE_DONE
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|u8
id|reg
comma
id|v1
comma
id|v2
comma
id|v3
comma
id|v4
comma
id|v5
comma
id|v6
comma
id|v7
comma
id|v8
suffix:semicolon
id|u16
id|index
comma
id|rindex
comma
id|memtype
op_assign
l_int|0
suffix:semicolon
id|u32
id|reg1_32
comma
id|reg2_32
comma
id|reg3_32
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Unlock */
multiline_comment|/* outSISIDXREG(0x3c4,0x05,0x86); */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
multiline_comment|/* Enable relocated i/o ports */
multiline_comment|/* setSISIDXREG(0x3c4,0x20,~0x10,0x20); */
id|setSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
op_complement
l_int|0x10
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* Clear regs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x22
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
(paren
l_int|0x06
op_plus
id|i
)paren
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|v1
op_assign
l_int|0x0d
suffix:semicolon
r_if
c_cond
(paren
id|is
l_int|330
)paren
(brace
id|v1
op_assign
l_int|0x0b
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|v1
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
(paren
l_int|0x31
op_plus
id|i
)paren
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
(paren
l_int|0x30
op_plus
id|i
)paren
comma
l_int|0x00
)paren
suffix:semicolon
)brace
multiline_comment|/* Reset clocks */
id|reg
op_assign
id|inSISREG
c_func
(paren
id|SISMISCR
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
l_int|0x81
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2A
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
l_int|0xE1
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISMISCW
comma
(paren
id|reg
op_or
l_int|0x0c
)paren
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2B
comma
l_int|0x81
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2D
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2C
comma
l_int|0xE1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2E
comma
l_int|0x81
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x30
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2F
comma
l_int|0xE1
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
dot
dot
dot
dot
)paren
suffix:semicolon
id|outSISREG
c_func
(paren
id|SISMISCW
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Get memory type */
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x52
)braket
op_amp
l_int|0x80
)paren
)paren
(brace
id|memtype
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x52
)braket
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
id|memtype
)paren
suffix:semicolon
)brace
id|memtype
op_and_assign
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|is
l_int|330
)paren
(brace
r_if
c_cond
(paren
id|memtype
op_le
l_int|1
)paren
(brace
id|memtype
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x5F
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x30
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|memtype
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
id|memtype
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x20
suffix:colon
id|memtype
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|memtype
op_assign
l_int|2
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* Set clocks */
id|v1
op_assign
l_int|0x3b
suffix:semicolon
id|v2
op_assign
l_int|0x22
suffix:semicolon
id|v3
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* Assume 143Mhz MCLK */
id|v4
op_assign
l_int|0x5c
suffix:semicolon
id|v5
op_assign
l_int|0x23
suffix:semicolon
id|v6
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* Assume 166Mhz ECLK */
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|index
op_assign
id|memtype
op_star
l_int|5
suffix:semicolon
id|rindex
op_assign
id|index
op_plus
l_int|0x54
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|rindex
op_assign
id|index
op_plus
l_int|0x68
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|rindex
op_increment
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2a
comma
id|v3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is
l_int|330
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|2
)paren
(brace
dot
dot
dot
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2e
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x2f
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x30
comma
id|v6
)paren
suffix:semicolon
multiline_comment|/* End of comp with 330 */
id|v1
op_assign
l_int|0x18
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x7c
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
l_int|0x0f
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x00
suffix:semicolon
id|v2
op_assign
l_int|0x0f
suffix:semicolon
id|v3
op_assign
l_int|0xba
suffix:semicolon
id|v4
op_assign
l_int|0xa9
suffix:semicolon
id|v5
op_assign
l_int|0xa0
suffix:semicolon
id|v6
op_assign
l_int|0x00
suffix:semicolon
id|v7
op_assign
l_int|0x30
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|index
op_assign
id|memtype
op_plus
l_int|0x7d
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|4
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|8
)braket
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|12
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|16
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|20
)braket
suffix:semicolon
id|v7
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|24
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
id|v1
)paren
suffix:semicolon
multiline_comment|/* Ram type (assuming 0, BIOS 0x7d step 4) */
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x18
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1a
comma
id|v6
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1b
comma
id|v7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1c
comma
id|v8
)paren
suffix:semicolon
multiline_comment|/* ---- */
id|v1
op_assign
l_int|0x77
suffix:semicolon
id|v2
op_assign
l_int|0x77
suffix:semicolon
id|v3
op_assign
l_int|0x00
suffix:semicolon
id|v4
op_assign
l_int|0x5b
suffix:semicolon
id|v5
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|index
op_assign
id|memtype
op_plus
l_int|0xa2
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|4
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|8
)braket
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|12
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|16
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x40
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x41
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x42
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x43
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x44
comma
id|v5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is
l_int|330
)paren
(brace
id|v1
op_assign
l_int|0
id|x
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xBA
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x59
comma
id|v1
)paren
suffix:semicolon
id|v1
op_assign
l_int|0
id|x
suffix:semicolon
id|v2
op_assign
l_int|0
id|x
suffix:semicolon
id|v3
op_assign
l_int|0
id|x
suffix:semicolon
id|v4
op_assign
l_int|0
id|x
suffix:semicolon
id|v5
op_assign
l_int|0
id|x
suffix:semicolon
id|v6
op_assign
l_int|0
id|x
suffix:semicolon
id|v7
op_assign
l_int|0
id|x
suffix:semicolon
id|v8
op_assign
l_int|0
id|x
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|index
op_assign
id|memtype
op_plus
l_int|0xbe
suffix:semicolon
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|4
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|8
)braket
suffix:semicolon
id|v4
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|12
)braket
suffix:semicolon
id|v5
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|16
)braket
suffix:semicolon
id|v6
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|20
)braket
suffix:semicolon
id|v7
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|24
)braket
suffix:semicolon
id|v8
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|index
op_plus
l_int|28
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x68
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x69
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6a
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6b
comma
id|v4
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6c
comma
id|v5
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6d
comma
id|v6
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6e
comma
id|v7
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x6f
comma
id|v8
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x20
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3b
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x04
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x5F
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x30
suffix:semicolon
r_if
c_cond
(paren
id|reg
)paren
(brace
id|v1
op_assign
l_int|0x23
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x48
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x4c
comma
l_int|0x20
)paren
suffix:semicolon
id|xx
op_assign
id|xxx
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xx
op_ge
l_int|1
)paren
(brace
id|v1
op_assign
l_int|0
id|x
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xBA
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x59
comma
id|v1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x48
comma
l_int|0x23
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x0f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memtype
op_le
l_int|1
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
(brace
id|v1
op_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x81
op_plus
id|memtype
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|v1
op_amp
l_int|0x10
)paren
)paren
(brace
id|v2
op_assign
l_int|0xc0
suffix:semicolon
)brace
r_else
id|v2
op_assign
l_int|0xd0
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|v2
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x0f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|v1
op_amp
l_int|0x10
)paren
)paren
(brace
id|v2
op_assign
l_int|0x80
suffix:semicolon
)brace
r_else
id|v2
op_assign
l_int|0xA0
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|v2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memtype
op_ge
l_int|2
)paren
(brace
r_const
id|u8
id|sr3cseq1
(braket
)braket
op_assign
(brace
l_int|0xc0
comma
l_int|0xe0
comma
l_int|0xf0
comma
l_int|0xe0
comma
l_int|0xf0
comma
l_int|0xa0
comma
l_int|0xb0
comma
l_int|0xa0
comma
l_int|0xb0
comma
l_int|0x90
comma
l_int|0xd0
)brace
suffix:semicolon
r_const
id|u8
id|sr3cseq2
(braket
)braket
op_assign
(brace
l_int|0xc0
comma
l_int|0xa0
comma
l_int|0xb0
comma
l_int|0xa0
comma
l_int|0xb0
comma
l_int|0xe0
comma
l_int|0xf0
comma
l_int|0xa0
comma
l_int|0xb0
comma
l_int|0x90
comma
l_int|0xd0
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|11
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
id|sr3cseq1
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0x04
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
l_int|0x200
)paren
suffix:semicolon
id|v1
op_assign
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0xEC
)paren
suffix:semicolon
id|v2
op_assign
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0xED
)paren
suffix:semicolon
id|reg1_32
op_assign
(paren
id|v2
op_lshift
l_int|8
)paren
op_or
id|v1
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3D
comma
l_int|0x00
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|11
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
id|sr3cseq2
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0x04
)paren
suffix:semicolon
id|SiS_DDC2Delay
c_func
(paren
l_int|0x200
)paren
suffix:semicolon
id|v1
op_assign
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0xEC
)paren
suffix:semicolon
id|v2
op_assign
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0xED
)paren
suffix:semicolon
id|reg2_32
op_assign
(paren
id|v2
op_lshift
l_int|8
)paren
op_or
id|v1
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x3D
comma
l_int|0x00
)paren
suffix:semicolon
id|reg3_32
op_assign
id|reg2_32
op_lshift
l_int|1
suffix:semicolon
id|reg2_32
op_rshift_assign
l_int|1
suffix:semicolon
id|reg3_32
op_add_assign
id|reg2_32
suffix:semicolon
id|v1
op_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|reg3_32
OG
id|reg1_32
)paren
(brace
id|v1
op_assign
l_int|0x10
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x59
comma
id|v1
)paren
suffix:semicolon
)brace
)brace
id|v1
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x99
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
l_int|0x20
)paren
suffix:semicolon
id|v1
op_assign
l_int|0xf6
suffix:semicolon
id|v2
op_assign
l_int|0x0d
suffix:semicolon
id|v3
op_assign
l_int|0x33
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9c
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9d
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9e
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x23
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x24
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x25
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0x84
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x22
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x27
comma
l_int|0x1f
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x00
suffix:semicolon
id|v2
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9F
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xA1
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x33
comma
id|v2
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x11
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xA0
)braket
suffix:semicolon
)brace
id|v2
op_assign
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v2
op_ne
l_int|1
)paren
op_logical_and
(paren
id|v2
op_ne
l_int|2
)paren
)paren
(brace
id|v1
op_and_assign
l_int|0xef
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x32
comma
id|v1
)paren
suffix:semicolon
multiline_comment|/* AGP */
id|pci_read_config_long
c_func
(paren
id|pdev
comma
l_int|0x50
comma
op_amp
id|reg1_32
)paren
suffix:semicolon
id|reg1_32
op_rshift_assign
l_int|20
suffix:semicolon
id|reg1_32
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|reg1_32
op_eq
l_int|1
)paren
(brace
id|v1
op_assign
l_int|0xAA
suffix:semicolon
id|v2
op_assign
l_int|0x33
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xF7
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9E
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|v1
op_assign
l_int|0x88
suffix:semicolon
id|v2
op_assign
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xF8
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xF6
)braket
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x49
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x25
comma
id|v2
)paren
suffix:semicolon
id|v1
op_assign
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v1
op_eq
l_int|1
)paren
op_logical_or
(paren
id|v1
op_eq
l_int|2
)paren
)paren
(brace
id|orSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x2F
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Unlock CRT2 */
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xb6
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x2E
comma
l_int|0x08
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART2
comma
l_int|0x00
comma
l_int|0x1c
)paren
suffix:semicolon
id|v1
op_assign
l_int|0x40
suffix:semicolon
id|v2
op_assign
l_int|0x00
suffix:semicolon
id|v3
op_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xb7
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xb8
)braket
suffix:semicolon
id|v3
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0xbb
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0d
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0e
comma
id|v2
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x10
comma
id|v3
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x0F
comma
l_int|0x3F
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x01
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0xb0
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x20
suffix:semicolon
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x23
comma
id|reg
)paren
suffix:semicolon
)brace
)brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x37
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/* Why? */
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x83
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x90
comma
l_int|0x00
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x5B
comma
l_int|0xDF
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISVID
comma
l_int|0x00
comma
l_int|0x86
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISVID
comma
l_int|0x32
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISVID
comma
l_int|0x30
comma
l_int|0x00
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISVID
comma
l_int|0x32
comma
l_int|0x01
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISVID
comma
l_int|0x30
comma
l_int|0x00
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x63
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* End of Init1 */
multiline_comment|/* Set Mode 0x2e */
multiline_comment|/* Ramsize */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x0f
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x18
comma
l_int|0xA9
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
l_int|0xA0
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1B
comma
l_int|0x30
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
l_int|0xF8
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
l_int|0x03
)paren
suffix:semicolon
id|andSIDIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Need to map max FB size for finding out about RAM size */
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
op_assign
id|ioremap
c_func
(paren
id|ivideo-&gt;video_base
comma
l_int|0x4000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
)paren
(brace
multiline_comment|/* Find out about bus width */
r_if
c_cond
(paren
id|memtype
op_le
l_int|1
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x02
)paren
suffix:semicolon
id|andSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x0F
)paren
suffix:semicolon
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x80
)paren
suffix:semicolon
dot
dot
dot
)brace
r_else
(brace
dot
dot
dot
)brace
multiline_comment|/* Find out about size */
id|iounmap
c_func
(paren
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Failed to map memory for size detection, assuming 8MB&bslash;n&quot;
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0
id|x
ques
c_cond
ques
c_cond
)paren
suffix:semicolon
multiline_comment|/* 8MB, 64bit default */
)brace
multiline_comment|/* AGP (Missing: Checks for VIA and AMD hosts) */
id|v1
op_assign
l_int|0xA5
suffix:semicolon
id|v2
op_assign
l_int|0xFB
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|v1
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9A
)braket
suffix:semicolon
id|v2
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
l_int|0x9B
)braket
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
id|v1
)paren
suffix:semicolon
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x22
comma
id|v2
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sisfb_probe
r_int
id|__devinit
id|sisfb_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|sisfb_chip_info
op_star
id|chipinfo
op_assign
op_amp
id|sisfb_chip_info
(braket
id|ent-&gt;driver_data
)braket
suffix:semicolon
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fb_info
op_star
id|sis_fb_info
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|reg16
suffix:semicolon
id|u8
id|reg
suffix:semicolon
r_int
id|sisvga_enabled
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_off
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,3))
id|sis_fb_info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
op_star
id|ivideo
)paren
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sis_fb_info
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#else
id|sis_fb_info
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sis_fb_info
)paren
op_plus
r_sizeof
(paren
op_star
id|ivideo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sis_fb_info
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sis_fb_info
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sis_fb_info
)paren
op_plus
r_sizeof
(paren
op_star
id|ivideo
)paren
)paren
suffix:semicolon
id|sis_fb_info-&gt;par
op_assign
(paren
(paren
r_char
op_star
)paren
id|sis_fb_info
op_plus
r_sizeof
(paren
op_star
id|sis_fb_info
)paren
)paren
suffix:semicolon
macro_line|#endif
id|ivideo
op_assign
(paren
r_struct
id|sis_video_info
op_star
)paren
id|sis_fb_info-&gt;par
suffix:semicolon
id|ivideo-&gt;memyselfandi
op_assign
id|sis_fb_info
suffix:semicolon
r_if
c_cond
(paren
id|card_list
op_eq
l_int|NULL
)paren
(brace
id|ivideo-&gt;cardnumber
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sis_video_info
op_star
id|countvideo
op_assign
id|card_list
suffix:semicolon
id|ivideo-&gt;cardnumber
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|countvideo
op_assign
id|countvideo-&gt;next
)paren
op_ne
l_int|NULL
)paren
id|ivideo-&gt;cardnumber
op_increment
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|ivideo-&gt;myid
comma
id|chipinfo-&gt;chip_name
comma
l_int|30
)paren
suffix:semicolon
id|ivideo-&gt;chip_id
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|ivideo-&gt;revision_id
)paren
suffix:semicolon
id|ivideo-&gt;sishw_ext.jChipRevision
op_assign
id|ivideo-&gt;revision_id
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|reg16
)paren
suffix:semicolon
id|sisvga_enabled
op_assign
id|reg16
op_amp
l_int|0x01
suffix:semicolon
id|ivideo-&gt;pcibus
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
id|ivideo-&gt;pcislot
op_assign
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo-&gt;pcifunc
op_assign
id|PCI_FUNC
c_func
(paren
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|ivideo-&gt;subsysvendor
op_assign
id|pdev-&gt;subsystem_vendor
suffix:semicolon
id|ivideo-&gt;subsysdevice
op_assign
id|pdev-&gt;subsystem_device
suffix:semicolon
macro_line|#ifdef SIS_CONFIG_COMPAT
id|ivideo-&gt;ioctl32registered
op_assign
l_int|0
suffix:semicolon
id|ivideo-&gt;ioctl32vblankregistered
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|sisfb_mode_idx
op_eq
op_minus
l_int|1
)paren
(brace
id|sisfb_get_vga_mode_from_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|ivideo-&gt;chip
op_assign
id|chipinfo-&gt;chip
suffix:semicolon
id|ivideo-&gt;sisvga_engine
op_assign
id|chipinfo-&gt;vgaengine
suffix:semicolon
id|ivideo-&gt;hwcursor_size
op_assign
id|chipinfo-&gt;hwcursor_size
suffix:semicolon
id|ivideo-&gt;CRT2_write_enable
op_assign
id|chipinfo-&gt;CRT2_write_enable
suffix:semicolon
id|ivideo-&gt;mni
op_assign
id|chipinfo-&gt;mni
suffix:semicolon
id|ivideo-&gt;detectedpdc
op_assign
l_int|0xff
suffix:semicolon
id|ivideo-&gt;detectedpdca
op_assign
l_int|0xff
suffix:semicolon
id|ivideo-&gt;detectedlcda
op_assign
l_int|0xff
suffix:semicolon
id|ivideo-&gt;sisfb_thismonitor.datavalid
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;sisfb_parm_mem
op_assign
id|sisfb_parm_mem
suffix:semicolon
id|ivideo-&gt;sisfb_accel
op_assign
id|sisfb_accel
suffix:semicolon
id|ivideo-&gt;sisfb_ypan
op_assign
id|sisfb_ypan
suffix:semicolon
id|ivideo-&gt;sisfb_max
op_assign
id|sisfb_max
suffix:semicolon
id|ivideo-&gt;sisfb_userom
op_assign
id|sisfb_userom
suffix:semicolon
id|ivideo-&gt;sisfb_useoem
op_assign
id|sisfb_useoem
suffix:semicolon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|sisfb_mode_idx
suffix:semicolon
id|ivideo-&gt;sisfb_parm_rate
op_assign
id|sisfb_parm_rate
suffix:semicolon
id|ivideo-&gt;sisfb_crt1off
op_assign
id|sisfb_crt1off
suffix:semicolon
id|ivideo-&gt;sisfb_forcecrt1
op_assign
id|sisfb_forcecrt1
suffix:semicolon
id|ivideo-&gt;sisfb_crt2type
op_assign
id|sisfb_crt2type
suffix:semicolon
id|ivideo-&gt;sisfb_crt2flags
op_assign
id|sisfb_crt2flags
suffix:semicolon
multiline_comment|/* pdc(a), scalelcd, special timing, lvdshl handled below */
id|ivideo-&gt;sisfb_dstn
op_assign
id|sisfb_dstn
suffix:semicolon
id|ivideo-&gt;sisfb_fstn
op_assign
id|sisfb_fstn
suffix:semicolon
id|ivideo-&gt;sisfb_tvplug
op_assign
id|sisfb_tvplug
suffix:semicolon
id|ivideo-&gt;sisfb_tvstd
op_assign
id|sisfb_tvstd
suffix:semicolon
id|ivideo-&gt;tvxpos
op_assign
id|sisfb_tvxposoffset
suffix:semicolon
id|ivideo-&gt;tvypos
op_assign
id|sisfb_tvyposoffset
suffix:semicolon
id|ivideo-&gt;sisfb_filter
op_assign
id|sisfb_filter
suffix:semicolon
id|ivideo-&gt;sisfb_nocrt2rate
op_assign
id|sisfb_nocrt2rate
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,5,0)
id|ivideo-&gt;sisfb_inverse
op_assign
id|sisfb_inverse
suffix:semicolon
macro_line|#endif
id|ivideo-&gt;refresh_rate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_parm_rate
op_ne
op_minus
l_int|1
)paren
(brace
id|ivideo-&gt;refresh_rate
op_assign
id|ivideo-&gt;sisfb_parm_rate
suffix:semicolon
)brace
id|ivideo-&gt;SiS_Pr.UsePanelScaler
op_assign
id|sisfb_scalelcd
suffix:semicolon
id|ivideo-&gt;SiS_Pr.CenterScreen
op_assign
op_minus
l_int|1
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_assign
id|sisfb_specialtiming
suffix:semicolon
id|ivideo-&gt;SiS_Pr.LVDSHL
op_assign
id|sisfb_lvdshl
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_Backup70xx
op_assign
l_int|0xff
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_CHOverScan
op_assign
op_minus
l_int|1
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_ChSW
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_UseLCDA
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.HaveEMI
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.HaveEMILCD
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.OverruleEMI
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_SensibleSR11
op_assign
id|FALSE
suffix:semicolon
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
op_assign
l_int|0x63
suffix:semicolon
id|ivideo-&gt;SiS_Pr.PDC
op_assign
op_minus
l_int|1
suffix:semicolon
id|ivideo-&gt;SiS_Pr.PDCA
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_330
)paren
(brace
id|ivideo-&gt;SiS_Pr.SiS_MyCR63
op_assign
l_int|0x53
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|ivideo-&gt;SiS_Pr.SiS_SensibleSR11
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memcpy
c_func
(paren
op_amp
id|ivideo-&gt;default_var
comma
op_amp
id|my_default_var
comma
r_sizeof
(paren
id|my_default_var
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|ivideo
)paren
suffix:semicolon
multiline_comment|/* Patch special cases */
r_if
c_cond
(paren
(paren
id|ivideo-&gt;nbridge
op_assign
id|sisfb_get_northbridge
c_func
(paren
id|ivideo-&gt;chip
)paren
)paren
)paren
(brace
r_switch
c_cond
(paren
id|ivideo-&gt;nbridge-&gt;device
)paren
(brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_case
id|PCI_DEVICE_ID_SI_730
suffix:colon
id|ivideo-&gt;chip
op_assign
id|SIS_730
suffix:semicolon
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 730&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_case
id|PCI_DEVICE_ID_SI_651
suffix:colon
multiline_comment|/* ivideo-&gt;chip is ok */
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 651&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_740
suffix:colon
id|ivideo-&gt;chip
op_assign
id|SIS_740
suffix:semicolon
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 740&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_661
suffix:colon
id|ivideo-&gt;chip
op_assign
id|SIS_661
suffix:semicolon
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 661&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_741
suffix:colon
id|ivideo-&gt;chip
op_assign
id|SIS_741
suffix:semicolon
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 741&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_SI_760
suffix:colon
id|ivideo-&gt;chip
op_assign
id|SIS_760
suffix:semicolon
id|strcpy
c_func
(paren
id|ivideo-&gt;myid
comma
l_string|&quot;SiS 760&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;modename
comma
id|ivideo-&gt;myid
)paren
suffix:semicolon
macro_line|#endif
id|ivideo-&gt;sishw_ext.jChipType
op_assign
id|ivideo-&gt;chip
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sishw_ext.jChipType
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|ivideo-&gt;sishw_ext.jChipType
op_eq
id|SIS_315
)paren
)paren
(brace
id|ivideo-&gt;sishw_ext.jChipType
op_assign
id|SIS_315H
suffix:semicolon
)brace
macro_line|#endif
id|ivideo-&gt;video_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|ivideo-&gt;mmio_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|ivideo-&gt;mmio_size
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|ivideo-&gt;SiS_Pr.RelIO
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
op_plus
l_int|0x30
suffix:semicolon
id|ivideo-&gt;sishw_ext.ulIOAddress
op_assign
id|ivideo-&gt;vga_base
op_assign
id|ivideo-&gt;SiS_Pr.RelIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisvga_enabled
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|SiSRegInit
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
id|ivideo-&gt;sishw_ext.ulIOAddress
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* Find PCI systems for Chrontel/GPIO communication setup */
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_630
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_eq
id|ivideo-&gt;subsysvendor
op_logical_and
id|mychswtable
(braket
id|i
)braket
dot
id|subsysCard
op_eq
id|ivideo-&gt;subsysdevice
)paren
(brace
id|ivideo-&gt;SiS_Pr.SiS_ChSW
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Identified [%s %s] requiring Chrontel/GPIO setup&bslash;n&quot;
comma
id|mychswtable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mychswtable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mychswtable
(braket
id|i
)braket
dot
id|subsysVendor
op_ne
l_int|0
)paren
(brace
suffix:semicolon
)brace
)brace
macro_line|#endif
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisvga_enabled
)paren
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
op_logical_or
(paren
id|sisfb_resetcard
)paren
macro_line|#endif
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x30
suffix:semicolon
id|i
op_le
l_int|0x3f
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outSISIDXREG
c_func
(paren
id|SISCR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Find out about current video mode */
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0x7f
)paren
(brace
id|ivideo-&gt;modeprechange
op_assign
id|reg
op_amp
l_int|0x7f
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;modeprechange
op_assign
l_int|0x03
suffix:semicolon
macro_line|#if defined(__i386__) || defined(__x86_64__)
(brace
r_int
r_char
id|__iomem
op_star
id|tt
op_assign
id|ioremap
c_func
(paren
l_int|0
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tt
)paren
(brace
id|ivideo-&gt;modeprechange
op_assign
id|tt
(braket
l_int|0x449
)braket
suffix:semicolon
id|iounmap
c_func
(paren
id|tt
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
macro_line|#ifdef MODULE
r_if
c_cond
(paren
(paren
id|reg
op_amp
l_int|0x80
)paren
op_logical_and
(paren
id|reg
op_ne
l_int|0xff
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)paren
op_ne
l_int|0xFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Cannot initialize display mode, X server is active&bslash;n&quot;
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
macro_line|#endif&t;
macro_line|#endif
id|ivideo-&gt;sishw_ext.bIntegratedMMEnabled
op_assign
id|TRUE
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ne
id|SIS_300
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISSR
comma
l_int|0x1a
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x10
)paren
)paren
(brace
id|ivideo-&gt;sishw_ext.bIntegratedMMEnabled
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|ivideo-&gt;bios_abase
op_assign
l_int|NULL
suffix:semicolon
id|ivideo-&gt;bios_vbase
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_userom
)paren
(brace
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
op_assign
id|sis_find_rom
c_func
(paren
id|pdev
)paren
suffix:semicolon
macro_line|#if defined(__i386__) || defined(__x86_64__)
id|ivideo-&gt;bios_vbase
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
suffix:semicolon
multiline_comment|/* mapped */
macro_line|#else
id|ivideo-&gt;bios_abase
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
suffix:semicolon
multiline_comment|/* allocated */
macro_line|#endif
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM found and %s to 0x%p&bslash;n&quot;
comma
id|ivideo-&gt;bios_vbase
ques
c_cond
l_string|&quot;mapped&quot;
suffix:colon
l_string|&quot;copied&quot;
comma
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
)paren
suffix:semicolon
id|ivideo-&gt;sishw_ext.UseROM
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM not found&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
op_assign
l_int|NULL
suffix:semicolon
id|ivideo-&gt;sishw_ext.UseROM
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Video ROM usage disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Find systems for special custom timing */
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_eq
id|CUT_NONE
)paren
(brace
r_int
id|j
suffix:semicolon
r_int
r_char
op_star
id|biosver
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|biosdate
op_assign
l_int|NULL
suffix:semicolon
id|BOOLEAN
id|footprint
suffix:semicolon
id|u32
id|chksum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
id|biosver
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
op_plus
l_int|0x06
suffix:semicolon
id|biosdate
op_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
op_plus
l_int|0x2c
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32768
suffix:semicolon
id|i
op_increment
)paren
(brace
id|chksum
op_add_assign
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
op_eq
id|ivideo-&gt;chip
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
)paren
)paren
op_logical_or
(paren
id|ivideo-&gt;sishw_ext.UseROM
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
comma
id|biosver
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosversion
)paren
)paren
)paren
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
)paren
)paren
op_logical_or
(paren
id|ivideo-&gt;sishw_ext.UseROM
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
comma
id|biosdate
comma
id|strlen
c_func
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosdate
)paren
)paren
)paren
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|mycustomttable
(braket
id|i
)braket
dot
id|bioschksum
)paren
op_logical_or
(paren
id|ivideo-&gt;sishw_ext.UseROM
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|bioschksum
op_eq
id|chksum
)paren
)paren
)paren
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|pcisubsysvendor
op_eq
id|ivideo-&gt;subsysvendor
)paren
op_logical_and
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|pcisubsyscard
op_eq
id|ivideo-&gt;subsysdevice
)paren
)paren
(brace
id|footprint
op_assign
id|TRUE
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|5
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintAddr
(braket
id|j
)braket
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.UseROM
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.pjVirtualRomBase
(braket
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintAddr
(braket
id|j
)braket
)braket
op_ne
id|mycustomttable
(braket
id|i
)braket
dot
id|biosFootprintData
(braket
id|j
)braket
)paren
(brace
id|footprint
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_else
id|footprint
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|footprint
)paren
(brace
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_assign
id|mycustomttable
(braket
id|i
)braket
dot
id|SpecialID
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Identified [%s %s], special timing applies&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|vendorName
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|cardName
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: [specialtiming parameter name: %s]&bslash;n&quot;
comma
id|mycustomttable
(braket
id|i
)braket
dot
id|optionName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mycustomttable
(braket
id|i
)braket
dot
id|chipID
)paren
(brace
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_FB_SIS_300
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisvga_enabled
)paren
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
op_logical_or
(paren
id|sisfb_resetcard
)paren
macro_line|#endif
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_300
)paren
(brace
id|sisfb_post_sis300
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|sisvga_enabled
)paren
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
op_logical_or
(paren
id|sisfb_resetcard
)paren
macro_line|#endif
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_315H
)paren
op_logical_or
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_315
)paren
op_logical_or
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_315PRO
)paren
op_logical_or
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_330
)paren
)paren
(brace
id|sisfb_post_sis315330
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sisfb_get_dram_size
c_func
(paren
id|ivideo
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Fatal error: Unable to determine RAM size.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
multiline_comment|/* Enable PCI_LINEAR_ADDRESSING and MMIO_ENABLE  */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PCI_ADDRESS_SET
comma
(paren
id|SIS_PCI_ADDR_ENABLE
op_or
id|SIS_MEM_MAP_IO_ENABLE
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable 2D accelerator engine */
id|orSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_MODULE_ENABLE
comma
id|SIS_ENABLE_2D
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisfb_pdc
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|sisfb_pdc
op_and_assign
l_int|0x3c
suffix:semicolon
)brace
r_else
id|sisfb_pdc
op_and_assign
l_int|0x1f
suffix:semicolon
id|ivideo-&gt;SiS_Pr.PDC
op_assign
id|sisfb_pdc
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
r_if
c_cond
(paren
id|sisfb_pdca
op_ne
l_int|0xff
)paren
(brace
id|ivideo-&gt;SiS_Pr.PDCA
op_assign
id|sisfb_pdca
op_amp
l_int|0x1f
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
comma
l_string|&quot;sisfb FB&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Is there another framebuffer driver active?&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
comma
l_string|&quot;sisfb MMIO&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ivideo-&gt;video_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|ivideo-&gt;sishw_ext.pjVideoMemoryAddress
op_assign
id|ivideo-&gt;video_vbase
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;video_vbase
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to map frame buffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ivideo-&gt;mmio_vbase
op_assign
id|ioremap
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;mmio_vbase
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Unable to map MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;video_vbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Framebuffer at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_vbase
comma
id|ivideo-&gt;video_size
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: MMIO at 0x%lx, mapped to 0x%p, size %ldk&bslash;n&quot;
comma
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_vbase
comma
id|ivideo-&gt;mmio_size
op_div
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo-&gt;havenoheap
op_assign
id|sisfb_heap_init
c_func
(paren
id|ivideo
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sisfb: Failed to initialize offscreen memory heap&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Used for clearing the screen only, therefore respect our mem limit */
id|ivideo-&gt;sishw_ext.ulVideoMemorySize
op_assign
id|ivideo-&gt;sisfb_mem
suffix:semicolon
id|ivideo-&gt;mtrr
op_assign
l_int|0
suffix:semicolon
id|ivideo-&gt;vbflags
op_assign
l_int|0
suffix:semicolon
id|ivideo-&gt;lcddefmodeidx
op_assign
id|DEFAULT_LCDMODE
suffix:semicolon
id|ivideo-&gt;tvdefmodeidx
op_assign
id|DEFAULT_TVMODE
suffix:semicolon
id|ivideo-&gt;defmodeidx
op_assign
id|DEFAULT_MODE
suffix:semicolon
id|ivideo-&gt;newrom
op_assign
id|SiSDetermineROMLayout661
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_mode_idx
OL
l_int|0
)paren
op_logical_or
(paren
(paren
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
)paren
op_ne
l_int|0xFF
)paren
)paren
(brace
id|sisfb_sense_crt1
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|sisfb_get_VB_type
c_func
(paren
id|ivideo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
id|sisfb_detect_VB_connect
c_func
(paren
id|ivideo
)paren
suffix:semicolon
)brace
id|ivideo-&gt;currentvbflags
op_assign
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_VIDEOBRIDGE
op_or
id|TV_STANDARD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_VIDEOBRIDGE
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_crt2type
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisfb_crt2type
op_eq
id|CRT2_LCD
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_LCD
)paren
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_crt2type
op_ne
id|CRT2_LCD
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|ivideo-&gt;sisfb_crt2type
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Chrontel 700x TV detection often unreliable, therefore use a&n;&t;&t;       * different default order on such machines&n;&t;&t;       */
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
id|VB_CHRONTEL
)paren
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_TV
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_TV
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_TV
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_LCD
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_VGA
)paren
(brace
id|ivideo-&gt;currentvbflags
op_or_assign
id|CRT2_VGA
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
id|CRT2_LCD
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x36
comma
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_assign
id|sis300paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;chip
op_ge
id|SIS_661
)paren
(brace
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_assign
id|sis661paneltype
(braket
id|reg
)braket
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_assign
id|sis310paneltype
(braket
id|reg
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ivideo-&gt;chip
op_eq
id|SIS_550
)paren
op_logical_and
(paren
id|sisfb_fstn
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_ne
id|LCD_640x480_2
)paren
op_logical_and
(paren
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_ne
id|LCD_640x480_3
)paren
)paren
(brace
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_assign
id|LCD_320x480
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_eq
id|LCD_UNKNOWN
)paren
(brace
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_assign
id|LCD_1024x768
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Illegal panel ID (%02x), assuming 1024x768&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SIS_LCD_NUMBER
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;sishw_ext.ulCRT2LCDType
op_eq
id|sis_lcd_data
(braket
id|i
)braket
dot
id|lcdtype
)paren
(brace
id|ivideo-&gt;lcdxres
op_assign
id|sis_lcd_data
(braket
id|i
)braket
dot
id|xres
suffix:semicolon
id|ivideo-&gt;lcdyres
op_assign
id|sis_lcd_data
(braket
id|i
)braket
dot
id|yres
suffix:semicolon
id|ivideo-&gt;lcddefmodeidx
op_assign
id|sis_lcd_data
(braket
id|i
)braket
dot
id|default_mode_idx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_eq
id|CUT_BARCO1366
)paren
(brace
id|ivideo-&gt;lcdxres
op_assign
l_int|1360
suffix:semicolon
id|ivideo-&gt;lcdyres
op_assign
l_int|1024
suffix:semicolon
id|ivideo-&gt;lcddefmodeidx
op_assign
l_int|99
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.SiS_CustomT
op_eq
id|CUT_PANEL848
)paren
(brace
id|ivideo-&gt;lcdxres
op_assign
l_int|848
suffix:semicolon
id|ivideo-&gt;lcdyres
op_assign
l_int|480
suffix:semicolon
id|ivideo-&gt;lcddefmodeidx
op_assign
l_int|47
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Detected %dx%d flat panel&bslash;n&quot;
comma
id|ivideo-&gt;lcdxres
comma
id|ivideo-&gt;lcdyres
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_SIS_300
multiline_comment|/* Save the current PanelDelayCompensation if the LCD is currently used */
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_300_VGA
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_LVDS
op_or
id|VB_30xBDH
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Currently on LCD? If yes, read current pdc */
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|ivideo-&gt;detectedpdc
)paren
suffix:semicolon
id|ivideo-&gt;detectedpdc
op_and_assign
l_int|0x3c
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Let option override detection */
id|ivideo-&gt;SiS_Pr.PDC
op_assign
id|ivideo-&gt;detectedpdc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PDC 0x%02x&bslash;n&quot;
comma
id|ivideo-&gt;detectedpdc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_ne
id|ivideo-&gt;detectedpdc
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PDC 0x%02x&bslash;n&quot;
comma
id|ivideo-&gt;SiS_Pr.PDC
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_SIS_315
r_if
c_cond
(paren
id|ivideo-&gt;sisvga_engine
op_eq
id|SIS_315_VGA
)paren
(brace
multiline_comment|/* Try to find about LCDA */
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301C
op_or
id|VB_302B
op_or
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x13
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x04
)paren
(brace
id|ivideo-&gt;SiS_Pr.SiS_UseLCDA
op_assign
id|TRUE
suffix:semicolon
id|ivideo-&gt;detectedlcda
op_assign
l_int|0x03
suffix:semicolon
)brace
)brace
multiline_comment|/* Save PDC */
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISCR
comma
l_int|0x30
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0x20
)paren
op_logical_or
(paren
id|ivideo-&gt;detectedlcda
op_ne
l_int|0xff
)paren
)paren
(brace
multiline_comment|/* Currently on LCD? If yes, read current pdc */
id|u8
id|pdc
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x2D
comma
id|pdc
)paren
suffix:semicolon
id|ivideo-&gt;detectedpdc
op_assign
(paren
id|pdc
op_amp
l_int|0x0f
)paren
op_lshift
l_int|1
suffix:semicolon
id|ivideo-&gt;detectedpdca
op_assign
(paren
id|pdc
op_amp
l_int|0xf0
)paren
op_rshift
l_int|3
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x35
comma
id|pdc
)paren
suffix:semicolon
id|ivideo-&gt;detectedpdc
op_or_assign
(paren
(paren
id|pdc
op_rshift
l_int|7
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART1
comma
l_int|0x20
comma
id|pdc
)paren
suffix:semicolon
id|ivideo-&gt;detectedpdca
op_or_assign
(paren
(paren
id|pdc
op_rshift
l_int|6
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;newrom
)paren
(brace
multiline_comment|/* New ROM invalidates other PDC resp. */
r_if
c_cond
(paren
id|ivideo-&gt;detectedlcda
op_ne
l_int|0xff
)paren
(brace
id|ivideo-&gt;detectedpdc
op_assign
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;detectedpdca
op_assign
l_int|0xff
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;detectedpdc
op_ne
l_int|0xff
)paren
(brace
id|ivideo-&gt;SiS_Pr.PDC
op_assign
id|ivideo-&gt;detectedpdc
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;SiS_Pr.PDCA
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ivideo-&gt;detectedpdca
op_ne
l_int|0xff
)paren
(brace
id|ivideo-&gt;SiS_Pr.PDCA
op_assign
id|ivideo-&gt;detectedpdca
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;detectedpdc
op_ne
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PDC 0x%02x (for LCD=CRT2)&bslash;n&quot;
comma
id|ivideo-&gt;detectedpdc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;detectedpdca
op_ne
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Detected LCD PDC1 0x%02x (for LCD=CRT1)&bslash;n&quot;
comma
id|ivideo-&gt;detectedpdca
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Save EMI */
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x30
comma
id|ivideo-&gt;SiS_Pr.EMI_30
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x31
comma
id|ivideo-&gt;SiS_Pr.EMI_31
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x32
comma
id|ivideo-&gt;SiS_Pr.EMI_32
)paren
suffix:semicolon
id|inSISIDXREG
c_func
(paren
id|SISPART4
comma
l_int|0x33
comma
id|ivideo-&gt;SiS_Pr.EMI_33
)paren
suffix:semicolon
id|ivideo-&gt;SiS_Pr.HaveEMI
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0x20
)paren
op_logical_or
(paren
id|ivideo-&gt;detectedlcda
op_ne
l_int|0xff
)paren
)paren
(brace
id|ivideo-&gt;SiS_Pr.HaveEMILCD
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Let user override detected PDCs (all bridges) */
r_if
c_cond
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_301LV
op_or
id|VB_302LV
op_or
id|VB_302ELV
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|ivideo-&gt;SiS_Pr.PDC
op_ne
id|ivideo-&gt;detectedpdc
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PDC 0x%02x (for LCD=CRT2)&bslash;n&quot;
comma
id|ivideo-&gt;SiS_Pr.PDC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;SiS_Pr.PDCA
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|ivideo-&gt;SiS_Pr.PDCA
op_ne
id|ivideo-&gt;detectedpdca
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Using LCD PDC1 0x%02x (for LCD=CRT1)&bslash;n&quot;
comma
id|ivideo-&gt;SiS_Pr.PDCA
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;sisfb_crt1off
)paren
(brace
id|sisfb_handle_ddc
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;sisfb_thismonitor
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|VB_301
op_or
id|VB_301B
op_or
id|VB_301C
op_or
id|VB_302B
)paren
)paren
op_logical_and
(paren
id|ivideo-&gt;vbflags
op_amp
(paren
id|CRT2_VGA
op_or
id|CRT2_LCD
)paren
)paren
)paren
(brace
id|sisfb_handle_ddc
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;sisfb_thismonitor
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_mode_idx
op_ge
l_int|0
)paren
(brace
r_int
id|bu
op_assign
id|ivideo-&gt;sisfb_mode_idx
suffix:semicolon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|sisfb_validate_mode
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;sisfb_mode_idx
comma
id|ivideo-&gt;currentvbflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bu
op_ne
id|ivideo-&gt;sisfb_mode_idx
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Mode %dx%dx%d failed validation&bslash;n&quot;
comma
id|sisbios_mode
(braket
id|bu
)braket
dot
id|xres
comma
id|sisbios_mode
(braket
id|bu
)braket
dot
id|yres
comma
id|sisbios_mode
(braket
id|bu
)braket
dot
id|bpp
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_mode_idx
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|ivideo-&gt;currentvbflags
op_amp
id|VB_DISPTYPE_DISP2
)paren
(brace
r_case
id|CRT2_LCD
suffix:colon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|ivideo-&gt;lcddefmodeidx
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT2_TV
suffix:colon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|ivideo-&gt;tvdefmodeidx
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ivideo-&gt;sisfb_mode_idx
op_assign
id|ivideo-&gt;defmodeidx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|ivideo-&gt;mode_no
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|mode_no
(braket
id|ivideo-&gt;mni
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;refresh_rate
op_ne
l_int|0
)paren
(brace
id|sisfb_search_refresh_rate
c_func
(paren
id|ivideo
comma
id|ivideo-&gt;refresh_rate
comma
id|ivideo-&gt;sisfb_mode_idx
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;rate_idx
op_eq
l_int|0
)paren
(brace
id|ivideo-&gt;rate_idx
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|rate_idx
suffix:semicolon
id|ivideo-&gt;refresh_rate
op_assign
l_int|60
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_thismonitor.datavalid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisfb_verify_rate
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;sisfb_thismonitor
comma
id|ivideo-&gt;sisfb_mode_idx
comma
id|ivideo-&gt;rate_idx
comma
id|ivideo-&gt;refresh_rate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: WARNING: Refresh rate exceeds monitor specs!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|ivideo-&gt;video_bpp
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|bpp
suffix:semicolon
id|ivideo-&gt;video_width
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|xres
suffix:semicolon
id|ivideo-&gt;video_height
op_assign
id|sisbios_mode
(braket
id|ivideo-&gt;sisfb_mode_idx
)braket
dot
id|yres
suffix:semicolon
id|sisfb_set_vparms
c_func
(paren
id|ivideo
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)&t;
multiline_comment|/* ---------------- For 2.4: Now switch the mode ------------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo-&gt;video_width
comma
id|ivideo-&gt;video_height
comma
id|ivideo-&gt;video_bpp
comma
id|ivideo-&gt;refresh_rate
)paren
suffix:semicolon
id|sisfb_pre_setmode
c_func
(paren
id|ivideo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SiSSetMode
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|ivideo-&gt;mode_no
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Setting mode[0x%x] failed&bslash;n&quot;
comma
id|ivideo-&gt;mode_no
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;video_vbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;mmio_vbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outSISIDXREG
c_func
(paren
id|SISSR
comma
id|IND_SIS_PASSWORD
comma
id|SIS_PASSWORD
)paren
suffix:semicolon
id|sisfb_post_setmode
c_func
(paren
id|ivideo
)paren
suffix:semicolon
multiline_comment|/* Maximize regardless of sisfb_max at startup */
id|ivideo-&gt;default_var.yres_virtual
op_assign
l_int|32767
suffix:semicolon
multiline_comment|/* Force reset of x virtual in crtc_to_var */
id|ivideo-&gt;default_var.xres_virtual
op_assign
l_int|0
suffix:semicolon
id|sisfb_crtc_to_var
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;default_var
)paren
suffix:semicolon
id|sisfb_calc_pitch
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;default_var
)paren
suffix:semicolon
id|sisfb_set_pitch
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|ivideo-&gt;accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_accel
)paren
(brace
id|ivideo-&gt;accel
op_assign
op_minus
l_int|1
suffix:semicolon
id|ivideo-&gt;default_var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
)brace
id|sisfb_initaccel
c_func
(paren
id|ivideo
)paren
suffix:semicolon
id|sis_fb_info-&gt;node
op_assign
op_minus
l_int|1
suffix:semicolon
id|sis_fb_info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|sis_fb_info-&gt;fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|sis_fb_info-&gt;disp
op_assign
op_amp
id|ivideo-&gt;sis_disp
suffix:semicolon
id|sis_fb_info-&gt;blank
op_assign
op_amp
id|sisfb_blank
suffix:semicolon
id|sis_fb_info-&gt;switch_con
op_assign
op_amp
id|sisfb_switch
suffix:semicolon
id|sis_fb_info-&gt;updatevar
op_assign
op_amp
id|sisfb_update_var
suffix:semicolon
id|sis_fb_info-&gt;changevar
op_assign
l_int|NULL
suffix:semicolon
id|strcpy
c_func
(paren
id|sis_fb_info-&gt;fontname
comma
id|sisfb_fontname
)paren
suffix:semicolon
id|sisfb_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|ivideo-&gt;default_var
comma
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#else&t;&t;/* --------- For 2.6: Setup a somewhat sane default var ------------ */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Default mode is %dx%dx%d (%dHz)&bslash;n&quot;
comma
id|ivideo-&gt;video_width
comma
id|ivideo-&gt;video_height
comma
id|ivideo-&gt;video_bpp
comma
id|ivideo-&gt;refresh_rate
)paren
suffix:semicolon
id|ivideo-&gt;default_var.xres
op_assign
id|ivideo-&gt;default_var.xres_virtual
op_assign
id|ivideo-&gt;video_width
suffix:semicolon
id|ivideo-&gt;default_var.yres
op_assign
id|ivideo-&gt;default_var.yres_virtual
op_assign
id|ivideo-&gt;video_height
suffix:semicolon
id|ivideo-&gt;default_var.bits_per_pixel
op_assign
id|ivideo-&gt;video_bpp
suffix:semicolon
id|sisfb_bpp_to_var
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;default_var
)paren
suffix:semicolon
id|ivideo-&gt;default_var.pixclock
op_assign
(paren
id|u32
)paren
(paren
l_int|1000000000
op_div
id|sisfb_mode_rate_to_dclock
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|ivideo-&gt;mode_no
comma
id|ivideo-&gt;rate_idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisfb_mode_rate_to_ddata
c_func
(paren
op_amp
id|ivideo-&gt;SiS_Pr
comma
op_amp
id|ivideo-&gt;sishw_ext
comma
id|ivideo-&gt;mode_no
comma
id|ivideo-&gt;rate_idx
comma
op_amp
id|ivideo-&gt;default_var
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ivideo-&gt;default_var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
(brace
id|ivideo-&gt;default_var.pixclock
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_ypan
)paren
(brace
multiline_comment|/* Maximize regardless of sisfb_max at startup */
id|ivideo-&gt;default_var.yres_virtual
op_assign
id|sisfb_calc_maxyres
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;default_var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;default_var.yres_virtual
OL
id|ivideo-&gt;default_var.yres
)paren
(brace
id|ivideo-&gt;default_var.yres_virtual
op_assign
id|ivideo-&gt;default_var.yres
suffix:semicolon
)brace
)brace
id|sisfb_calc_pitch
c_func
(paren
id|ivideo
comma
op_amp
id|ivideo-&gt;default_var
)paren
suffix:semicolon
id|ivideo-&gt;accel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;sisfb_accel
)paren
(brace
id|ivideo-&gt;accel
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef STUPID_ACCELF_TEXT_SHIT
id|ivideo-&gt;default_var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
macro_line|#endif
)brace
id|sisfb_initaccel
c_func
(paren
id|ivideo
)paren
suffix:semicolon
macro_line|#if defined(FBINFO_HWACCEL_DISABLED) &amp;&amp; defined(FBINFO_HWACCEL_XPAN)
id|sis_fb_info-&gt;flags
op_assign
id|FBINFO_DEFAULT
op_or
id|FBINFO_HWACCEL_YPAN
op_or
id|FBINFO_HWACCEL_XPAN
op_or
id|FBINFO_HWACCEL_COPYAREA
op_or
id|FBINFO_HWACCEL_FILLRECT
op_or
(paren
(paren
id|ivideo-&gt;accel
)paren
ques
c_cond
l_int|0
suffix:colon
id|FBINFO_HWACCEL_DISABLED
)paren
suffix:semicolon
macro_line|#else
id|sis_fb_info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
macro_line|#endif
id|sis_fb_info-&gt;var
op_assign
id|ivideo-&gt;default_var
suffix:semicolon
id|sis_fb_info-&gt;fix
op_assign
id|ivideo-&gt;sisfb_fix
suffix:semicolon
id|sis_fb_info-&gt;screen_base
op_assign
id|ivideo-&gt;video_vbase
suffix:semicolon
id|sis_fb_info-&gt;fbops
op_assign
op_amp
id|sisfb_ops
suffix:semicolon
id|sisfb_get_fix
c_func
(paren
op_amp
id|sis_fb_info-&gt;fix
comma
op_minus
l_int|1
comma
id|sis_fb_info
)paren
suffix:semicolon
id|sis_fb_info-&gt;pseudo_palette
op_assign
id|ivideo-&gt;pseudo_palette
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|sis_fb_info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;&t;/* 2.6 */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Initial vbflags 0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|ivideo-&gt;vbflags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|ivideo-&gt;mtrr
op_assign
id|mtrr_add
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ivideo-&gt;mtrr
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Failed to add MTRRs&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|vc_resize_con
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
id|sis_fb_info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Fatal error: Failed to register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;video_vbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;mmio_vbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ivideo-&gt;registered
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Enlist us */
id|ivideo-&gt;next
op_assign
id|card_list
suffix:semicolon
id|card_list
op_assign
id|ivideo
suffix:semicolon
macro_line|#ifdef SIS_CONFIG_COMPAT
(brace
r_int
id|ret
suffix:semicolon
multiline_comment|/* Our ioctls are all &quot;32/64bit compatible&quot; */
r_if
c_cond
(paren
id|register_ioctl32_conversion
c_func
(paren
id|FBIOGET_VBLANK
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Error registering FBIOGET_VBLANK ioctl32 translation&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ivideo-&gt;ioctl32vblankregistered
op_assign
l_int|1
suffix:semicolon
)brace
id|ret
op_assign
id|register_ioctl32_conversion
c_func
(paren
id|FBIO_ALLOC
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|FBIO_FREE
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_GET_INFO_SIZE
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_GET_INFO
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_GET_TVPOSOFFSET
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_SET_TVPOSOFFSET
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_SET_LOCK
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_GET_VBRSTATUS
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_GET_AUTOMAXIMIZE
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISFB_SET_AUTOMAXIMIZE
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Error registering ioctl32 translations&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|ivideo-&gt;ioctl32registered
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: 2D acceleration is %s, y-panning %s&bslash;n&quot;
comma
id|ivideo-&gt;sisfb_accel
ques
c_cond
l_string|&quot;enabled&quot;
suffix:colon
l_string|&quot;disabled&quot;
comma
id|ivideo-&gt;sisfb_ypan
ques
c_cond
(paren
id|ivideo-&gt;sisfb_max
ques
c_cond
l_string|&quot;enabled (auto-max)&quot;
suffix:colon
l_string|&quot;enabled (no auto-max)&quot;
)paren
suffix:colon
l_string|&quot;disabled&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, Version %d.%d.%d&bslash;n&quot;
comma
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|GET_FB_IDX
c_func
(paren
id|sis_fb_info-&gt;node
)paren
comma
macro_line|#else
id|sis_fb_info-&gt;node
comma
macro_line|#endif
id|ivideo-&gt;myid
comma
id|VER_MAJOR
comma
id|VER_MINOR
comma
id|VER_LEVEL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: (C) 2001-2004 Thomas Winischhofer.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* if mode = &quot;none&quot; */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************/
multiline_comment|/*                PCI DEVICE HANDLING                */
multiline_comment|/*****************************************************/
DECL|function|sisfb_remove
r_static
r_void
id|__devexit
id|sisfb_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|sis_video_info
op_star
id|ivideo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|sis_fb_info
op_assign
id|ivideo-&gt;memyselfandi
suffix:semicolon
r_int
id|registered
op_assign
id|ivideo-&gt;registered
suffix:semicolon
macro_line|#ifdef SIS_CONFIG_COMPAT
r_if
c_cond
(paren
id|ivideo-&gt;ioctl32vblankregistered
)paren
(brace
r_if
c_cond
(paren
id|unregister_ioctl32_conversion
c_func
(paren
id|FBIOGET_VBLANK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Error unregistering FBIOGET_VBLANK ioctl32 translation&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ivideo-&gt;ioctl32registered
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|FBIO_ALLOC
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|FBIO_FREE
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_GET_INFO_SIZE
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_GET_INFO
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_GET_TVPOSOFFSET
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_SET_TVPOSOFFSET
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_SET_LOCK
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_GET_VBRSTATUS
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_GET_AUTOMAXIMIZE
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISFB_SET_AUTOMAXIMIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisfb: Error unregistering ioctl32 translations&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Unmap */
id|iounmap
c_func
(paren
id|ivideo-&gt;video_vbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ivideo-&gt;mmio_vbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ivideo-&gt;bios_vbase
)paren
(brace
id|iounmap
c_func
(paren
id|ivideo-&gt;bios_vbase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ivideo-&gt;bios_abase
)paren
(brace
id|vfree
c_func
(paren
id|ivideo-&gt;bios_abase
)paren
suffix:semicolon
)brace
multiline_comment|/* Release mem regions */
id|release_mem_region
c_func
(paren
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|ivideo-&gt;mmio_base
comma
id|ivideo-&gt;mmio_size
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
multiline_comment|/* Release MTRR region */
r_if
c_cond
(paren
id|ivideo-&gt;mtrr
)paren
(brace
id|mtrr_del
c_func
(paren
id|ivideo-&gt;mtrr
comma
id|ivideo-&gt;video_base
comma
id|ivideo-&gt;video_size
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Unregister the framebuffer */
r_if
c_cond
(paren
id|ivideo-&gt;registered
)paren
(brace
id|unregister_framebuffer
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,3))
id|framebuffer_release
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#else
id|kfree
c_func
(paren
id|sis_fb_info
)paren
suffix:semicolon
macro_line|#endif
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* TODO: Restore the initial mode&n;&t; * This sounds easy but is as good as impossible&n;&t; * on many machines with SiS chip and video bridge&n;&t; * since text modes are always set up differently&n;&t; * from machine to machine. Depends on the type&n;&t; * of integration between chipset and bridge.&n;&t; */
r_if
c_cond
(paren
id|registered
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisfb: Restoring of text mode not supported yet&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
suffix:semicolon
DECL|variable|sisfb_driver
r_static
r_struct
id|pci_driver
id|sisfb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sisfb&quot;
comma
dot
id|id_table
op_assign
id|sisfb_pci_table
comma
dot
id|probe
op_assign
id|sisfb_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|sisfb_remove
)paren
)brace
suffix:semicolon
DECL|function|sisfb_init
r_int
id|__init
id|sisfb_init
c_func
(paren
r_void
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,6,8)
macro_line|#ifndef MODULE
r_char
op_star
id|option
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;sisfb&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|sisfb_setup
c_func
(paren
id|option
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|sisfb_driver
)paren
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,6,8)
macro_line|#ifndef MODULE
DECL|variable|sisfb_init
id|module_init
c_func
(paren
id|sisfb_init
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/*****************************************************/
multiline_comment|/*                      MODULE                       */
multiline_comment|/*****************************************************/
macro_line|#ifdef MODULE
DECL|variable|mode
r_static
r_char
op_star
id|mode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|vesa
r_static
r_int
id|vesa
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|rate
r_static
r_int
r_int
id|rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|crt1off
r_static
r_int
r_int
id|crt1off
op_assign
l_int|1
suffix:semicolon
DECL|variable|mem
r_static
r_int
r_int
id|mem
op_assign
l_int|0
suffix:semicolon
DECL|variable|forcecrt2type
r_static
r_char
op_star
id|forcecrt2type
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|forcecrt1
r_static
r_int
id|forcecrt1
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|pdc
r_static
r_int
id|pdc
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|pdc1
r_static
r_int
id|pdc1
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|noaccel
r_static
r_int
id|noaccel
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|noypan
r_static
r_int
id|noypan
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|nomax
r_static
r_int
id|nomax
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|variable|inverse
r_static
r_int
id|inverse
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|userom
r_static
r_int
id|userom
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|useoem
r_static
r_int
id|useoem
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|tvstandard
r_static
r_char
op_star
id|tvstandard
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|nocrt2rate
r_static
r_int
id|nocrt2rate
op_assign
l_int|0
suffix:semicolon
DECL|variable|scalelcd
r_static
r_int
id|scalelcd
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|specialtiming
r_static
r_char
op_star
id|specialtiming
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|lvdshl
r_static
r_int
id|lvdshl
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|tvxposoffset
DECL|variable|tvyposoffset
r_static
r_int
id|tvxposoffset
op_assign
l_int|0
comma
id|tvyposoffset
op_assign
l_int|0
suffix:semicolon
DECL|variable|filter
r_static
r_int
id|filter
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
DECL|variable|resetcard
r_static
r_int
id|resetcard
op_assign
l_int|0
suffix:semicolon
DECL|variable|videoram
r_static
r_int
id|videoram
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 300/540/630/730/315/550/65x/661/74x/330/760 framebuffer device driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;, Others&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noaccel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noypan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nomax
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|userom
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|useoem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vesa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|scalelcd
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pdc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pdc1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|specialtiming
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|lvdshl
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tvstandard
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tvxposoffset
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tvyposoffset
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|filter
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nocrt2rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|inverse
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
id|MODULE_PARM
c_func
(paren
id|resetcard
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|videoram
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|module_param
c_func
(paren
id|mem
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|noaccel
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|noypan
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|nomax
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|userom
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|useoem
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|mode
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|vesa
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|rate
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|forcecrt1
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|forcecrt2type
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|scalelcd
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|pdc
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|pdc1
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|specialtiming
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|lvdshl
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|tvstandard
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|tvxposoffset
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|tvyposoffset
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|filter
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|nocrt2rate
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
id|module_param
c_func
(paren
id|resetcard
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|videoram
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|MODULE_PARM_DESC
c_func
(paren
id|mem
comma
l_string|&quot;&bslash;nDetermines the beginning of the video memory heap in KB. This heap is used&bslash;n&quot;
l_string|&quot;for video RAM management for eg. DRM/DRI. On 300 series, the default depends&bslash;n&quot;
l_string|&quot;on the amount of video RAM available. If 8MB of video RAM or less is available,&bslash;n&quot;
l_string|&quot;the heap starts at 4096KB, if between 8 and 16MB are available at 8192KB,&bslash;n&quot;
l_string|&quot;otherwise at 12288KB. On 315 and Xabre series, the heap size is 32KB by default.&bslash;n&quot;
l_string|&quot;The value is to be specified without &squot;KB&squot; and must match the MaxXFBMem setting&bslash;n&quot;
l_string|&quot;for XFree86 4.x/X.org 6.7 and later.&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;&bslash;nIf set to anything other than 0, 2D acceleration will be disabled.&bslash;n&quot;
l_string|&quot;(default: 0)&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noypan
comma
l_string|&quot;&bslash;nIf set to anything other than 0, y-panning will be disabled and scrolling&bslash;n&quot;
l_string|&quot;will be performed by redrawing the screen. (default: 0)&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomax
comma
l_string|&quot;&bslash;nIf y-panning is enabled, sisfb will by default use the entire available video&bslash;n&quot;
l_string|&quot;memory for the virtual screen in order to optimize scrolling performance. If&bslash;n&quot;
l_string|&quot;this is set to anything other than 0, sisfb will not do this and thereby &bslash;n&quot;
l_string|&quot;enable the user to positively specify a virtual Y size of the screen using&bslash;n&quot;
l_string|&quot;fbset. (default: 0)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired display mode in the format [X]x[Y]x[Depth], eg.&bslash;n&quot;
l_string|&quot;1024x768x16. Other formats supported include XxY-Depth and&bslash;n&quot;
l_string|&quot;XxY-Depth@Rate. If the parameter is only one (decimal or hexadecimal)&bslash;n&quot;
l_string|&quot;number, it will be interpreted as a VESA mode number. (default: none if&bslash;n&quot;
l_string|&quot;sisfb is a module; this leaves the console untouched and the driver will&bslash;n&quot;
l_string|&quot;only do the video memory management for eg. DRM/DRI; 800x600x8 if sisfb&bslash;n&quot;
l_string|&quot;is in the kernel)&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired display mode by VESA defined mode number, eg. 0x117&bslash;n&quot;
l_string|&quot;(default: 0x0000 if sisfb is a module; this leaves the console untouched&bslash;n&quot;
l_string|&quot;and the driver will only do the video memory management for eg. DRM/DRI;&bslash;n&quot;
l_string|&quot;0x0103 if sisfb is in the kernel)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,5,0)
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;&bslash;nSelects the desired default display mode in the format XxYxDepth,&bslash;n&quot;
l_string|&quot;eg. 1024x768x16. Other formats supported include XxY-Depth and&bslash;n&quot;
l_string|&quot;XxY-Depth@Rate. If the parameter is only one (decimal or hexadecimal)&bslash;n&quot;
l_string|&quot;number, it will be interpreted as a VESA mode number. (default: 800x600x8)&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vesa
comma
l_string|&quot;&bslash;nSelects the desired default display mode by VESA defined mode number, eg.&bslash;n&quot;
l_string|&quot;0x117 (default: 0x0103)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM_DESC
c_func
(paren
id|rate
comma
l_string|&quot;&bslash;nSelects the desired vertical refresh rate for CRT1 (external VGA) in Hz.&bslash;n&quot;
l_string|&quot;If the mode is specified in the format XxY-Depth@Rate, this parameter&bslash;n&quot;
l_string|&quot;will be ignored (default: 60)&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt1
comma
l_string|&quot;&bslash;nNormally, the driver autodetects whether or not CRT1 (external VGA) is &bslash;n&quot;
l_string|&quot;connected. With this option, the detection can be overridden (1=CRT1 ON,&bslash;n&quot;
l_string|&quot;0=CRT1 OFF) (default: [autodetected])&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcecrt2type
comma
l_string|&quot;&bslash;nIf this option is omitted, the driver autodetects CRT2 output devices, such as&bslash;n&quot;
l_string|&quot;LCD, TV or secondary VGA. With this option, this autodetection can be&bslash;n&quot;
l_string|&quot;overridden. Possible parameters are LCD, TV, VGA or NONE. NONE disables CRT2.&bslash;n&quot;
l_string|&quot;On systems with a SiS video bridge, parameters SVIDEO, COMPOSITE or SCART can&bslash;n&quot;
l_string|&quot;be used instead of TV to override the TV detection. Furthermore, on systems&bslash;n&quot;
l_string|&quot;with a SiS video bridge, SVIDEO+COMPOSITE, HIVISION, YPBPR480I, YPBPR480P,&bslash;n&quot;
l_string|&quot;YPBPR720P and YPBPR1080I are understood. However, whether or not these work&bslash;n&quot;
l_string|&quot;depends on the very hardware in use. (default: [autodetected])&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|scalelcd
comma
l_string|&quot;&bslash;nSetting this to 1 will force the driver to scale the LCD image to the panel&squot;s&bslash;n&quot;
l_string|&quot;native resolution. Setting it to 0 will disable scaling; LVDS panels will&bslash;n&quot;
l_string|&quot;show black bars around the image, TMDS panels will probably do the scaling&bslash;n&quot;
l_string|&quot;themselves. Default: 1 on LVDS panels, 0 on TMDS panels&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pdc
comma
l_string|&quot;&bslash;nThis is for manually selecting the LCD panel delay compensation. The driver&bslash;n&quot;
l_string|&quot;should detect this correctly in most cases; however, sometimes this is not&bslash;n&quot;
l_string|&quot;possible. If you see &squot;small waves&squot; on the LCD, try setting this to 4, 32 or 24&bslash;n&quot;
l_string|&quot;on a 300 series chipset; 6 on a 315 series chipset. If the problem persists,&bslash;n&quot;
l_string|&quot;try other values (on 300 series: between 4 and 60 in steps of 4; on 315 series:&bslash;n&quot;
l_string|&quot;any value from 0 to 31). (default: autodetected, if LCD is active during start)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SIS_315
id|MODULE_PARM_DESC
c_func
(paren
id|pdc1
comma
l_string|&quot;&bslash;nThis is same as pdc, but for LCD-via CRT1. Hence, this is for the 315/330&bslash;n&quot;
l_string|&quot;series only. (default: autodetected if LCD is in LCD-via-CRT1 mode during&bslash;n&quot;
l_string|&quot;startup) - Note: currently, this has no effect because LCD-via-CRT1 is not&bslash;n&quot;
l_string|&quot;implemented yet.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM_DESC
c_func
(paren
id|specialtiming
comma
l_string|&quot;&bslash;nPlease refer to documentation for more information on this option.&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|lvdshl
comma
l_string|&quot;&bslash;nPlease refer to documentation for more information on this option.&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tvstandard
comma
l_string|&quot;&bslash;nThis allows overriding the BIOS default for the TV standard. Valid choices are&bslash;n&quot;
l_string|&quot;pal, ntsc, palm and paln. (default: [auto; pal or ntsc only])&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tvxposoffset
comma
l_string|&quot;&bslash;nRelocate TV output horizontally. Possible parameters: -32 through 32.&bslash;n&quot;
l_string|&quot;Default: 0&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tvyposoffset
comma
l_string|&quot;&bslash;nRelocate TV output vertically. Possible parameters: -32 through 32.&bslash;n&quot;
l_string|&quot;Default: 0&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|filter
comma
l_string|&quot;&bslash;nSelects TV flicker filter type (only for systems with a SiS301 video bridge).&bslash;n&quot;
l_string|&quot;(Possible values 0-7, default: [no filter])&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nocrt2rate
comma
l_string|&quot;&bslash;nSetting this to 1 will force the driver to use the default refresh rate for&bslash;n&quot;
l_string|&quot;CRT2 if CRT2 type is VGA. (default: 0, use same rate as CRT1)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
id|MODULE_PARM_DESC
c_func
(paren
id|inverse
comma
l_string|&quot;&bslash;nSetting this to anything but 0 should invert the display colors, but this&bslash;n&quot;
l_string|&quot;does not seem to work. (default: 0)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
macro_line|#ifdef CONFIG_FB_SIS_300
id|MODULE_PARM_DESC
c_func
(paren
id|resetcard
comma
l_string|&quot;&bslash;nSet this to 1 in order to reset (POST) the card on non-x86 machines where&bslash;n&quot;
l_string|&quot;the BIOS did not POST the card (only supported for SiS 300/305 currently).&bslash;n&quot;
l_string|&quot;Default: 0&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|videoram
comma
l_string|&quot;&bslash;nSet this to the amount of video RAM (in kilobyte) the card has. Required on&bslash;n&quot;
l_string|&quot;some non-x86 architectures where the memory auto detection fails. Only&bslash;n&quot;
l_string|&quot;relevant if resetcard is set, too. Default: [auto-detect]&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|function|sisfb_init_module
r_int
id|__init
id|sisfb_init_module
c_func
(paren
r_void
)paren
(brace
id|sisfb_setdefaultparms
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
)paren
(brace
id|sisfb_parm_rate
op_assign
id|rate
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|scalelcd
op_eq
l_int|0
)paren
op_logical_or
(paren
id|scalelcd
op_eq
l_int|1
)paren
)paren
(brace
id|sisfb_scalelcd
op_assign
id|scalelcd
op_xor
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Need to check crt2 type first for fstn/dstn */
r_if
c_cond
(paren
id|forcecrt2type
)paren
(brace
id|sisfb_search_crt2type
c_func
(paren
id|forcecrt2type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tvstandard
)paren
(brace
id|sisfb_search_tvstd
c_func
(paren
id|tvstandard
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
)paren
(brace
id|sisfb_search_mode
c_func
(paren
id|mode
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vesa
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_search_vesamode
c_func
(paren
id|vesa
comma
id|FALSE
)paren
suffix:semicolon
)brace
id|sisfb_crt1off
op_assign
(paren
id|crt1off
op_eq
l_int|0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|sisfb_forcecrt1
op_assign
id|forcecrt1
suffix:semicolon
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|1
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|forcecrt1
op_eq
l_int|0
)paren
(brace
id|sisfb_crt1off
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|1
)paren
(brace
id|sisfb_accel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noaccel
op_eq
l_int|0
)paren
(brace
id|sisfb_accel
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noypan
op_eq
l_int|1
)paren
(brace
id|sisfb_ypan
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|noypan
op_eq
l_int|0
)paren
(brace
id|sisfb_ypan
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nomax
op_eq
l_int|1
)paren
(brace
id|sisfb_max
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nomax
op_eq
l_int|0
)paren
(brace
id|sisfb_max
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
r_if
c_cond
(paren
id|inverse
)paren
(brace
id|sisfb_inverse
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|mem
)paren
(brace
id|sisfb_parm_mem
op_assign
id|mem
suffix:semicolon
)brace
r_if
c_cond
(paren
id|userom
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_userom
op_assign
id|userom
suffix:semicolon
)brace
r_if
c_cond
(paren
id|useoem
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_useoem
op_assign
id|useoem
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdc
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_pdc
op_assign
(paren
id|pdc
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdc1
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_pdca
op_assign
(paren
id|pdc1
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
id|sisfb_nocrt2rate
op_assign
id|nocrt2rate
suffix:semicolon
r_if
c_cond
(paren
id|specialtiming
)paren
(brace
id|sisfb_search_specialtiming
c_func
(paren
id|specialtiming
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lvdshl
op_ge
l_int|0
)paren
op_logical_and
(paren
id|lvdshl
op_le
l_int|3
)paren
)paren
(brace
id|sisfb_lvdshl
op_assign
id|lvdshl
suffix:semicolon
)brace
r_if
c_cond
(paren
id|filter
op_ne
op_minus
l_int|1
)paren
(brace
id|sisfb_filter
op_assign
id|filter
suffix:semicolon
)brace
id|sisfb_tvxposoffset
op_assign
id|tvxposoffset
suffix:semicolon
id|sisfb_tvyposoffset
op_assign
id|tvyposoffset
suffix:semicolon
macro_line|#if !defined(__i386__) &amp;&amp; !defined(__x86_64__)
id|sisfb_resetcard
op_assign
(paren
id|resetcard
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|videoram
)paren
(brace
id|sisfb_videoram
op_assign
id|videoram
suffix:semicolon
)brace
macro_line|#endif
r_return
id|sisfb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|sisfb_remove_module
r_static
r_void
id|__exit
id|sisfb_remove_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|sisfb_driver
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisfb: Module unloaded&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|sisfb_init_module
id|module_init
c_func
(paren
id|sisfb_init_module
)paren
suffix:semicolon
DECL|variable|sisfb_remove_module
id|module_exit
c_func
(paren
id|sisfb_remove_module
)paren
suffix:semicolon
macro_line|#endif &t;   /*  /MODULE  */
DECL|variable|sis_malloc
id|EXPORT_SYMBOL
c_func
(paren
id|sis_malloc
)paren
suffix:semicolon
DECL|variable|sis_free
id|EXPORT_SYMBOL
c_func
(paren
id|sis_free
)paren
suffix:semicolon
eof
