multiline_comment|/*&n; * linux/drivers/video/virgefb.c -- CyberVision64/3D frame buffer device&n; *&n; *    Copyright (C) 1997 Andr&#xfffd; Heynatz&n; *&n; *&n; * This file is based on the CyberVision frame buffer device (cyberfb.c):&n; *&n; *    Copyright (C) 1996 Martin Apel&n; *                       Geert Uytterhoeven&n; *&n; * Zorro II additions :&n; *&n; *    Copyright (C) 1998-2000 Christian T. Steigies&n; *&n; * Initialization additions :&n; *&n; *    Copyright (C) 1998-2000 Ken Tyler&n; *&n; * Parts of the Initialization code are based on Cyberfb.c by Allan Bair,&n; * and on the NetBSD CyberVision64 frame buffer driver by Michael Teske who gave&n; * permission for its use.&n; *&n; * Many thanks to Frank Mariak for his assistance with ZORRO 2 access and other&n; * mysteries.&n; *&n; *&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
DECL|macro|VIRGEFBDEBUG
macro_line|#undef VIRGEFBDEBUG
DECL|macro|VIRGEFBDUMP
macro_line|#undef VIRGEFBDUMP
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/zorro.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &quot;virgefb.h&quot;
macro_line|#ifdef VIRGEFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
macro_line|#ifdef VIRGEFBDUMP
r_static
r_void
id|cv64_dump
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|DUMP
mdefine_line|#define DUMP cv64_dump()
macro_line|#else
DECL|macro|DUMP
mdefine_line|#define DUMP
macro_line|#endif
multiline_comment|/*&n; *&t;Macros for register access and zorro control&n; */
DECL|function|mb_inline
r_static
r_inline
r_void
id|mb_inline
c_func
(paren
r_void
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* for use in comma expressions */
multiline_comment|/* Set zorro 2 map */
DECL|macro|SelectIO
mdefine_line|#define SelectIO &bslash;&n;&t;mb(); &bslash;&n;&t;if (on_zorro2) { &bslash;&n;&t;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base + 0x04)) = 0x01); &bslash;&n;&t;&t;mb(); &bslash;&n;&t;}
DECL|macro|SelectMMIO
mdefine_line|#define&t;SelectMMIO &bslash;&n;&t;mb(); &bslash;&n;&t;if (on_zorro2) { &bslash;&n;&t;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base + 0x04)) = 0x02); &bslash;&n;&t;&t;mb(); &bslash;&n;&t;}
DECL|macro|SelectCFG
mdefine_line|#define&t;SelectCFG &bslash;&n;&t;mb(); &bslash;&n;&t;if (on_zorro2) { &bslash;&n;&t;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base + 0x04)) = 0x03); &bslash;&n;&t;&t;mb(); &bslash;&n;&t;}
multiline_comment|/* Set pass through, 0 = amiga, !=0 = cv64/3d */
DECL|macro|SetVSwitch
mdefine_line|#define SetVSwitch(x) &bslash;&n;&t;mb(); &bslash;&n;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base)) = &bslash;&n;&t;(u16)(x ? 0 : 1)); &bslash;&n;&t;mb();
multiline_comment|/* Zorro2 endian &squot;aperture&squot; */
DECL|macro|ENDIAN_BYTE
mdefine_line|#define ENDIAN_BYTE&t;2
DECL|macro|ENDIAN_WORD
mdefine_line|#define ENDIAN_WORD&t;1
DECL|macro|ENDIAN_LONG
mdefine_line|#define ENDIAN_LONG&t;0
DECL|macro|Select_Zorro2_FrameBuffer
mdefine_line|#define Select_Zorro2_FrameBuffer(x) &bslash;&n;&t;do { &bslash;&n;&t;&t;if (on_zorro2) { &bslash;&n;&t;&t;&t;mb(); &bslash;&n;&t;&t;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base + 0x08)) = &bslash;&n;&t;&t;&t;(x * 0x40)); &bslash;&n;&t;&t;&t;mb(); &bslash;&n;&t;&t;} &bslash;&n;&t;} while (0)
multiline_comment|/* SetPortVal - only used for interrupt enable (not yet implemented) */
macro_line|#if 0
mdefine_line|#define SetPortVal(x) &bslash;&n;&t;mb(); &bslash;&n;&t;(*(volatile u16 *)((u8 *)(vcode_switch_base + 0x0c)) = &bslash;&n;&t;(u16)x); &bslash;&n;&t;mb();
macro_line|#endif
multiline_comment|/* IO access */
DECL|macro|byte_access_io
mdefine_line|#define byte_access_io(x)&t;(((x) &amp; 0x3ffc) | (((x) &amp; 3)^3) | (((x) &amp; 3) &lt;&lt;14))
DECL|macro|byte_access_mmio
mdefine_line|#define byte_access_mmio(x)&t;(((x) &amp; 0xfffc) | (((x) &amp; 3)^3))
multiline_comment|/* Write 8 bit VGA register - used once for chip wakeup */
DECL|macro|wb_vgaio
mdefine_line|#define wb_vgaio(reg, dat) &bslash;&n;&t;SelectIO; &bslash;&n;&t;(*(volatile u8 *)(vgaio_regs + ((u32)byte_access_io(reg) &amp; 0xffff)) = &bslash;&n;&t;(dat &amp; 0xff)); &bslash;&n;&t;SelectMMIO;
multiline_comment|/* Read 8 bit VGA register - only used in dump (SelectIO not needed on read ?) */
macro_line|#ifdef VIRGEFBDUMP
DECL|macro|rb_vgaio
mdefine_line|#define rb_vgaio(reg) &bslash;&n;&t;({ &bslash;&n;&t;u8 __zzyzx; &bslash;&n;&t;SelectIO; &bslash;&n;&t;__zzyzx = (*(volatile u8 *)((vgaio_regs)+(u32)byte_access_io(reg))); &bslash;&n;&t;SelectMMIO; &bslash;&n;&t;__zzyzx; &bslash;&n;&t;})
macro_line|#endif
multiline_comment|/* MMIO access */
multiline_comment|/* Read 8 bit MMIO register */
DECL|macro|rb_mmio
mdefine_line|#define rb_mmio(reg) &bslash;&n;&t;(mb_inline(), &bslash;&n;&t;(*(volatile u8 *)(mmio_regs + 0x8000 + (u32)byte_access_mmio(reg))))
multiline_comment|/* Write 8 bit MMIO register */
DECL|macro|wb_mmio
mdefine_line|#define wb_mmio(reg,dat) &bslash;&n;&t;mb(); &bslash;&n;&t;(*(volatile u8 *)(mmio_regs + 0x8000 + (byte_access_mmio((reg) &amp; 0xffff))) = &bslash;&n;&t;(dat &amp; 0xff)); &bslash;&n;&t;mb();
multiline_comment|/* Read 32 bit MMIO register */
DECL|macro|rl_mmio
mdefine_line|#define rl_mmio(reg) &bslash;&n;&t;(mb_inline(), &bslash;&n;&t;(*((volatile u32 *)((u8 *)((mmio_regs + (on_zorro2 ? 0x20000 : 0)) + (reg))))))
multiline_comment|/* Write 32 bit MMIO register */
DECL|macro|wl_mmio
mdefine_line|#define wl_mmio(reg,dat) &bslash;&n;&t;mb(); &bslash;&n;&t;((*(volatile u32 *)((u8 *)((mmio_regs + (on_zorro2 ? 0x20000 : 0)) + (reg)))) = &bslash;&n;&t;(u32)(dat)); &bslash;&n;&t;mb();
multiline_comment|/* Write to virge graphics register */
DECL|macro|wgfx
mdefine_line|#define wgfx(reg, dat)&t;do { wb_mmio(GCT_ADDRESS, (reg)); wb_mmio(GCT_ADDRESS_W, (dat)); } while (0)
multiline_comment|/* Write to virge sequencer register */
DECL|macro|wseq
mdefine_line|#define wseq(reg, dat)&t;do { wb_mmio(SEQ_ADDRESS, (reg)); wb_mmio(SEQ_ADDRESS_W, (dat)); } while (0)
multiline_comment|/* Write to virge CRT controller register */
DECL|macro|wcrt
mdefine_line|#define wcrt(reg, dat)&t;do { wb_mmio(CRT_ADDRESS, (reg)); wb_mmio(CRT_ADDRESS_W, (dat)); } while (0)
multiline_comment|/* Write to virge attribute register */
DECL|macro|watr
mdefine_line|#define watr(reg, dat) &bslash;&n;&t;do { &bslash;&n;&t;&t;volatile unsigned char watr_tmp; &bslash;&n;&t;&t;watr_tmp = rb_mmio(ACT_ADDRESS_RESET); &bslash;&n;&t;&t;wb_mmio(ACT_ADDRESS_W, (reg)); &bslash;&n;&t;&t;wb_mmio(ACT_ADDRESS_W, (dat)); &bslash;&n;&t;&t;udelay(10); &bslash;&n;&t;} while (0)
multiline_comment|/* end of macros */
DECL|struct|virgefb_par
r_struct
id|virgefb_par
(brace
DECL|member|var
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
DECL|member|type
id|__u32
id|type
suffix:semicolon
DECL|member|type_aux
id|__u32
id|type_aux
suffix:semicolon
DECL|member|visual
id|__u32
id|visual
suffix:semicolon
DECL|member|line_length
id|__u32
id|line_length
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|current_par
r_static
r_struct
id|virgefb_par
id|current_par
suffix:semicolon
DECL|variable|current_par_valid
r_static
r_int
id|current_par_valid
op_assign
l_int|0
suffix:semicolon
DECL|variable|disp
r_static
r_struct
id|display
id|disp
suffix:semicolon
DECL|variable|fb_info
r_static
r_struct
id|fb_info
id|fb_info
suffix:semicolon
r_static
r_union
(brace
macro_line|#ifdef FBCON_HAS_CFB16
DECL|member|cfb16
id|u16
id|cfb16
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|member|cfb32
id|u32
id|cfb32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
DECL|variable|fbcon_cmap
)brace
id|fbcon_cmap
suffix:semicolon
multiline_comment|/*&n; *    Switch for Chipset Independency&n; */
DECL|struct|fb_hwswitch
r_static
r_struct
id|fb_hwswitch
(brace
multiline_comment|/* Initialisation */
DECL|member|init
r_int
(paren
op_star
id|init
)paren
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Display Control */
DECL|member|encode_fix
r_int
(paren
op_star
id|encode_fix
)paren
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
DECL|member|decode_var
r_int
(paren
op_star
id|decode_var
)paren
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
DECL|member|encode_var
r_int
(paren
op_star
id|encode_var
)paren
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
DECL|member|getcolreg
r_int
(paren
op_star
id|getcolreg
)paren
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
DECL|member|blank
r_void
(paren
op_star
id|blank
)paren
(paren
r_int
id|blank
)paren
suffix:semicolon
DECL|variable|fbhw
)brace
op_star
id|fbhw
suffix:semicolon
DECL|variable|blit_maybe_busy
r_static
r_int
r_char
id|blit_maybe_busy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; *    Frame Buffer Name&n; */
DECL|variable|virgefb_name
r_static
r_char
id|virgefb_name
(braket
l_int|16
)braket
op_assign
l_string|&quot;CyberVision/3D&quot;
suffix:semicolon
multiline_comment|/*&n; *    CyberVision64/3d Graphics Board&n; */
DECL|variable|virgefb_colour_table
r_static
r_int
r_char
id|virgefb_colour_table
(braket
l_int|256
)braket
(braket
l_int|3
)braket
suffix:semicolon
DECL|variable|v_ram
r_static
r_int
r_int
id|v_ram
suffix:semicolon
DECL|variable|v_ram_size
r_static
r_int
r_int
id|v_ram_size
suffix:semicolon
DECL|variable|mmio_regs
r_static
r_volatile
r_int
r_char
op_star
id|mmio_regs
suffix:semicolon
DECL|variable|vgaio_regs
r_static
r_volatile
r_int
r_char
op_star
id|vgaio_regs
suffix:semicolon
DECL|variable|v_ram_phys
r_static
r_int
r_int
id|v_ram_phys
suffix:semicolon
DECL|variable|mmio_regs_phys
r_static
r_int
r_int
id|mmio_regs_phys
suffix:semicolon
DECL|variable|vcode_switch_base
r_static
r_int
r_int
id|vcode_switch_base
suffix:semicolon
DECL|variable|on_zorro2
r_static
r_int
r_char
id|on_zorro2
suffix:semicolon
multiline_comment|/*&n; * Offsets from start of video ram to appropriate ZIII aperture&n; */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|macro|CYBMEM_OFFSET_8
mdefine_line|#define CYBMEM_OFFSET_8  0x800000&t;/* BGRX */
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|macro|CYBMEM_OFFSET_16
mdefine_line|#define CYBMEM_OFFSET_16 0x400000&t;/* GBXR */
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|macro|CYBMEM_OFFSET_32
mdefine_line|#define CYBMEM_OFFSET_32 0x000000&t;/* XRGB */
macro_line|#endif
multiline_comment|/*&n; *    MEMCLOCK was 32MHz, 64MHz works, 72MHz doesn&squot;t (on my board)&n; */
DECL|macro|MEMCLOCK
mdefine_line|#define MEMCLOCK 50000000
multiline_comment|/*&n; *    Predefined Video Modes&n; */
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|var
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
DECL|variable|__initdata
)brace
id|virgefb_predefined
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef FBCON_HAS_CFB8
(brace
l_string|&quot;640x480-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|31250
comma
l_int|160
comma
l_int|136
comma
l_int|82
comma
l_int|61
comma
l_int|88
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;768x576-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|768
comma
l_int|576
comma
l_int|768
comma
l_int|576
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|29411
comma
l_int|144
comma
l_int|112
comma
l_int|32
comma
l_int|15
comma
l_int|64
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;800x600-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|800
comma
l_int|600
comma
l_int|800
comma
l_int|600
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|28571
comma
l_int|168
comma
l_int|104
comma
l_int|22
comma
l_int|1
comma
l_int|48
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
macro_line|#if 0 
l_string|&quot;1024x768-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|20833
comma
l_int|272
comma
l_int|168
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#else
l_string|&quot;1024x768-8&quot;
comma
(brace
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
macro_line|#if 0
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|12500
comma
l_int|184
comma
l_int|40
comma
l_int|40
comma
l_int|2
comma
l_int|96
comma
l_int|1
comma
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#else
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|12699
comma
l_int|176
comma
l_int|16
comma
l_int|28
comma
l_int|1
comma
l_int|96
comma
l_int|3
comma
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#endif
macro_line|#endif
)brace
comma
(brace
l_string|&quot;1152x886-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1152
comma
l_int|886
comma
l_int|1152
comma
l_int|886
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|19230
comma
l_int|280
comma
l_int|168
comma
l_int|45
comma
l_int|1
comma
l_int|64
comma
l_int|10
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
macro_line|#if 0
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
)brace
macro_line|#else
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|7414
comma
l_int|232
comma
l_int|64
comma
l_int|38
comma
l_int|1
comma
l_int|112
comma
l_int|3
comma
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#endif
)brace
comma
(brace
l_string|&quot;1600x1200-8&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
macro_line|#if 0
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#else
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|6411
comma
l_int|256
comma
l_int|32
comma
l_int|52
comma
l_int|10
comma
l_int|160
comma
l_int|8
comma
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#endif
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
(brace
l_string|&quot;640x480-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|31250
comma
l_int|152
comma
l_int|144
comma
l_int|82
comma
l_int|61
comma
l_int|88
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;768x576-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|768
comma
l_int|576
comma
l_int|768
comma
l_int|576
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|29411
comma
l_int|144
comma
l_int|112
comma
l_int|32
comma
l_int|15
comma
l_int|64
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;800x600-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|800
comma
l_int|600
comma
l_int|800
comma
l_int|600
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|28571
comma
l_int|168
comma
l_int|104
comma
l_int|22
comma
l_int|1
comma
l_int|48
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
macro_line|#if 0
l_string|&quot;1024x768-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|20833
comma
l_int|272
comma
l_int|168
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#else
l_string|&quot;1024x768-16&quot;
comma
(brace
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|12500
comma
l_int|184
comma
l_int|40
comma
l_int|40
comma
l_int|2
comma
l_int|96
comma
l_int|1
comma
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|FB_VMODE_NONINTERLACED
)brace
macro_line|#endif
)brace
comma
(brace
l_string|&quot;1152x886-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1152
comma
l_int|886
comma
l_int|1152
comma
l_int|886
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|19230
comma
l_int|280
comma
l_int|168
comma
l_int|45
comma
l_int|1
comma
l_int|64
comma
l_int|10
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-16&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
(brace
l_string|&quot;640x480-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|31250
comma
l_int|160
comma
l_int|136
comma
l_int|82
comma
l_int|61
comma
l_int|88
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;768x576-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|768
comma
l_int|576
comma
l_int|768
comma
l_int|576
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|29411
comma
l_int|144
comma
l_int|112
comma
l_int|32
comma
l_int|15
comma
l_int|64
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;800x600-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|800
comma
l_int|600
comma
l_int|800
comma
l_int|600
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|28571
comma
l_int|168
comma
l_int|104
comma
l_int|22
comma
l_int|1
comma
l_int|48
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1024x768-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|20833
comma
l_int|272
comma
l_int|168
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1152x886-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1152
comma
l_int|886
comma
l_int|1152
comma
l_int|886
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|19230
comma
l_int|280
comma
l_int|168
comma
l_int|45
comma
l_int|1
comma
l_int|64
comma
l_int|10
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-32&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
)brace
comma
macro_line|#endif
multiline_comment|/* interlaced modes */
macro_line|#ifdef FBCON_HAS_CFB8
(brace
l_string|&quot;1024x768-8i&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|20833
comma
l_int|272
comma
l_int|168
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-8i&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-8i&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
(brace
l_string|&quot;1024x768-16i&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|20833
comma
l_int|272
comma
l_int|168
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-16i&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-16i&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
(brace
l_string|&quot;1024x768-32i&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1024
comma
l_int|768
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|22222
comma
l_int|216
comma
l_int|144
comma
l_int|39
comma
l_int|2
comma
l_int|72
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1280x1024-32i&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1280
comma
l_int|1024
comma
l_int|1280
comma
l_int|1024
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|23
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|17857
comma
l_int|232
comma
l_int|232
comma
l_int|71
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
(brace
l_string|&quot;1600x1200-32i&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|1600
comma
l_int|1200
comma
l_int|1600
comma
l_int|1200
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|13698
comma
l_int|336
comma
l_int|224
comma
l_int|77
comma
l_int|15
comma
l_int|176
comma
l_int|12
comma
l_int|0
comma
id|FB_VMODE_INTERLACED
)brace
)brace
comma
macro_line|#endif
multiline_comment|/* doublescan modes */
macro_line|#ifdef FBCON_HAS_CFB8
(brace
l_string|&quot;320x240-8d&quot;
comma
(brace
multiline_comment|/* Cybervision 8 bpp */
l_int|320
comma
l_int|240
comma
l_int|320
comma
l_int|240
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|59259
comma
l_int|80
comma
l_int|80
comma
l_int|45
comma
l_int|26
comma
l_int|32
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_DOUBLE
)brace
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
(brace
l_string|&quot;320x240-16d&quot;
comma
(brace
multiline_comment|/* Cybervision 16 bpp */
l_int|320
comma
l_int|240
comma
l_int|320
comma
l_int|240
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|0
comma
(brace
l_int|11
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|59259
comma
l_int|80
comma
l_int|80
comma
l_int|45
comma
l_int|26
comma
l_int|32
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_DOUBLE
)brace
)brace
comma
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
(brace
l_string|&quot;320x240-32d&quot;
comma
(brace
multiline_comment|/* Cybervision 32 bpp */
l_int|320
comma
l_int|240
comma
l_int|320
comma
l_int|240
comma
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|0
comma
(brace
l_int|16
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|8
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|24
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|FB_ACCELF_TEXT
comma
l_int|59259
comma
l_int|80
comma
l_int|80
comma
l_int|45
comma
l_int|26
comma
l_int|32
comma
l_int|1
comma
l_int|0
comma
id|FB_VMODE_DOUBLE
)brace
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|arraysize
mdefine_line|#define arraysize(x)&t;(sizeof(x)/sizeof(*(x)))
DECL|macro|NUM_TOTAL_MODES
mdefine_line|#define NUM_TOTAL_MODES&t;arraysize(virgefb_predefined)
multiline_comment|/*&n; *    Default to 800x600 for video=virge8:, virge16: or virge32:&n; */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|macro|VIRGE8_DEFMODE
mdefine_line|#define VIRGE8_DEFMODE&t;(2)
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|macro|VIRGE16_DEFMODE
mdefine_line|#define VIRGE16_DEFMODE&t;(9)
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|macro|VIRGE32_DEFMODE
mdefine_line|#define VIRGE32_DEFMODE&t;(16)
macro_line|#endif
DECL|variable|virgefb_default
r_static
r_struct
id|fb_var_screeninfo
id|virgefb_default
suffix:semicolon
DECL|variable|virgefb_inverse
r_static
r_int
id|virgefb_inverse
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; *    Interface used by the world&n; */
r_int
id|virgefb_setup
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_static
r_int
id|virgefb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n; *    Interface to the low level console driver&n; */
r_int
id|virgefb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|virgefb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n; *    Text console acceleration&n; */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|fbcon_virge8
r_static
r_struct
id|display_switch
id|fbcon_virge8
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|variable|fbcon_virge16
r_static
r_struct
id|display_switch
id|fbcon_virge16
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|variable|fbcon_virge32
r_static
r_struct
id|display_switch
id|fbcon_virge32
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *   Hardware Specific Routines&n; */
r_static
r_int
id|virge_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|virgefb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|virgefb_decode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|virgefb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|virgefb_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|virgefb_gfx_on_off
c_func
(paren
r_int
id|blank
)paren
suffix:semicolon
r_static
r_inline
r_void
id|virgefb_wait_for_idle
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|virgefb_BitBLT
c_func
(paren
id|u_short
id|curx
comma
id|u_short
id|cury
comma
id|u_short
id|destx
comma
id|u_short
id|desty
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|stride
comma
id|u_short
id|depth
)paren
suffix:semicolon
r_static
r_void
id|virgefb_RectFill
c_func
(paren
id|u_short
id|x
comma
id|u_short
id|y
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|color
comma
id|u_short
id|stride
comma
id|u_short
id|depth
)paren
suffix:semicolon
multiline_comment|/*&n; *    Internal routines&n; */
r_static
r_void
id|virgefb_get_par
c_func
(paren
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_void
id|virgefb_set_par
c_func
(paren
r_struct
id|virgefb_par
op_star
id|par
)paren
suffix:semicolon
r_static
r_int
id|virgefb_do_fb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
)paren
suffix:semicolon
r_static
r_void
id|virgefb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|virgefb_get_video_mode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
suffix:semicolon
r_static
r_void
id|virgefb_set_video
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
multiline_comment|/*&n; *    Additions for Initialization&n; */
r_static
r_void
id|virgefb_load_video_mode
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|video_mode
)paren
suffix:semicolon
r_static
r_int
id|cv3d_has_4mb
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
r_int
id|virgefb_compute_clock
c_func
(paren
r_int
r_int
id|freq
)paren
suffix:semicolon
r_static
r_inline
r_int
r_char
id|rattr
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_inline
r_int
r_char
id|rseq
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_inline
r_int
r_char
id|rcrt
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_inline
r_int
r_char
id|rgfx
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_inline
r_void
id|gfx_on_off
c_func
(paren
r_int
id|toggle
)paren
suffix:semicolon
r_static
r_void
id|virgefb_pci_init
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* -------------------- Hardware specific routines ------------------------- */
multiline_comment|/*&n; *&t;Functions for register access&n; */
multiline_comment|/* Read attribute controller register */
DECL|function|rattr
r_static
r_inline
r_int
r_char
id|rattr
c_func
(paren
r_int
id|idx
)paren
(brace
r_volatile
r_int
r_char
id|rattr_tmp
suffix:semicolon
id|rattr_tmp
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|ACT_ADDRESS_W
comma
id|idx
)paren
suffix:semicolon
r_return
(paren
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read sequencer register */
DECL|function|rseq
r_static
r_inline
r_int
r_char
id|rseq
c_func
(paren
r_int
id|idx
)paren
(brace
id|wb_mmio
c_func
(paren
id|SEQ_ADDRESS
comma
id|idx
)paren
suffix:semicolon
r_return
(paren
id|rb_mmio
c_func
(paren
id|SEQ_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read CRT controller register */
DECL|function|rcrt
r_static
r_inline
r_int
r_char
id|rcrt
c_func
(paren
r_int
id|idx
)paren
(brace
id|wb_mmio
c_func
(paren
id|CRT_ADDRESS
comma
id|idx
)paren
suffix:semicolon
r_return
(paren
id|rb_mmio
c_func
(paren
id|CRT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read graphics controller register */
DECL|function|rgfx
r_static
r_inline
r_int
r_char
id|rgfx
c_func
(paren
r_int
id|idx
)paren
(brace
id|wb_mmio
c_func
(paren
id|GCT_ADDRESS
comma
id|idx
)paren
suffix:semicolon
r_return
(paren
id|rb_mmio
c_func
(paren
id|GCT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Initialization&n; */
multiline_comment|/* PCI init */
DECL|function|virgefb_pci_init
r_void
id|virgefb_pci_init
c_func
(paren
r_void
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|SelectCFG
suffix:semicolon
r_if
c_cond
(paren
id|on_zorro2
)paren
(brace
op_star
(paren
(paren
r_int
op_star
)paren
(paren
id|vgaio_regs
op_plus
l_int|0x00000010
)paren
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
id|vgaio_regs
op_plus
l_int|0x00000004
)paren
)paren
op_assign
l_int|0x02000003
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
r_int
op_star
)paren
(paren
id|vgaio_regs
op_plus
l_int|0x000e0010
)paren
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
id|vgaio_regs
op_plus
l_int|0x000e0004
)paren
)paren
op_assign
l_int|0x02000003
suffix:semicolon
)brace
multiline_comment|/* SelectIO is in wb_vgaio macro */
id|wb_vgaio
c_func
(paren
id|SREG_VIDEO_SUBS_ENABLE
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* SelectMMIO is in wb_vgaio macro */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* &n; * Initalize all mode independent regs, find mem size and clear mem&n;*/
DECL|function|virge_init
r_static
r_int
id|virge_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|virgefb_pci_init
c_func
(paren
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|GREG_MISC_OUTPUT_W
comma
l_int|0x07
)paren
suffix:semicolon
multiline_comment|/* colour, ram enable, clk sel */
id|wseq
c_func
(paren
id|SEQ_ID_UNLOCK_EXT
comma
l_int|0x06
)paren
suffix:semicolon
multiline_comment|/* unlock extensions */
id|tmp
op_assign
id|rb_mmio
c_func
(paren
id|GREG_MISC_OUTPUT_R
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_REGISTER_LOCK_1
comma
l_int|0x48
)paren
suffix:semicolon
multiline_comment|/* unlock CR2D to CR3F */
id|wcrt
c_func
(paren
id|CRT_ID_BACKWAD_COMP_1
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* irq disable */
id|wcrt
c_func
(paren
id|CRT_ID_REGISTER_LOCK_2
comma
l_int|0xa5
)paren
suffix:semicolon
multiline_comment|/* unlock CR40 to CRFF and more */
id|wcrt
c_func
(paren
id|CRT_ID_REGISTER_LOCK
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* unlock h and v timing */
id|wcrt
c_func
(paren
id|CRT_ID_SYSTEM_CONFIG
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* unlock enhanced programming registers */
id|wb_mmio
c_func
(paren
id|GREG_FEATURE_CONTROL_W
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MISC_CNTL
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* b2 = 0 to allow VDAC mmio access */
macro_line|#if 0
multiline_comment|/* write strap options ... ? */
id|wcrt
c_func
(paren
id|CRT_ID_CONFIG_1
comma
l_int|0x08
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_CONFIG_2
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* 0x0x2 bit needs to be set ?? */
id|wcrt
c_func
(paren
id|CRT_ID_CONFIG_3
comma
l_int|0x0f
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_CONFIG_4
comma
l_int|0x1a
)paren
suffix:semicolon
macro_line|#endif
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MISC_CNTL_1
comma
l_int|0x82
)paren
suffix:semicolon
multiline_comment|/* PCI DE and software reset S3D engine */
multiline_comment|/* EXT_MISC_CNTL_1, CR66 bit 0 should be the same as bit 0 MR_ADVANCED_FUNCTION_CONTROL - check */
id|wl_mmio
c_func
(paren
id|MR_ADVANCED_FUNCTION_CONTROL
comma
l_int|0x00000011
)paren
suffix:semicolon
multiline_comment|/* enhanced mode, linear addressing */
multiline_comment|/* crtc registers */
id|wcrt
c_func
(paren
id|CRT_ID_PRESET_ROW_SCAN
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Disable h/w cursor */
id|wcrt
c_func
(paren
id|CRT_ID_CURSOR_START
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_CURSOR_END
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_START_ADDR_HIGH
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_START_ADDR_LOW
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_CURSOR_LOC_HIGH
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_CURSOR_LOC_LOW
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MODE
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_MODE
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_ORIGIN_X_HI
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_ORIGIN_X_LO
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_ORIGIN_Y_HI
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_ORIGIN_Y_LO
comma
l_int|0x00
)paren
suffix:semicolon
id|i
op_assign
id|rcrt
c_func
(paren
id|CRT_ID_HWGC_MODE
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_FG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_FG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_FG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_BG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_BG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_BG_STACK
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_START_AD_HI
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_START_AD_LO
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_DSTART_X
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_HWGC_DSTART_Y
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_UNDERLINE_LOC
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_MODE_CONTROL
comma
l_int|0xe3
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_BACKWAD_COMP_2
comma
l_int|0x22
)paren
suffix:semicolon
multiline_comment|/* blank bdr bit 5 blanking only on 8 bit */
id|wcrt
c_func
(paren
id|CRT_ID_EX_SYNC_1
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* memory */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_SYS_CNTL_3
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_MEMORY_CONF
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* config enhanced map */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MEM_CNTL_1
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* MMIO Select (0x0c works as well)*/
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MEM_CNTL_2
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/* why 02 big endian 00 works ? */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MEM_CNTL_4
comma
l_int|0x9f
)paren
suffix:semicolon
multiline_comment|/* config big endian - 0x00 ?  */
id|wcrt
c_func
(paren
id|CRT_ID_LAW_POS_HI
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_LAW_POS_LO
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MISC_CNTL_1
comma
l_int|0x81
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_MISC_1
comma
l_int|0x90
)paren
suffix:semicolon
multiline_comment|/* must follow CRT_ID_EXT_MISC_CNTL_1 */
id|wcrt
c_func
(paren
id|CRT_ID_LAW_CNTL
comma
l_int|0x13
)paren
suffix:semicolon
multiline_comment|/* force 4 Meg for test */
r_if
c_cond
(paren
id|cv3d_has_4mb
c_func
(paren
)paren
)paren
(brace
id|v_ram_size
op_assign
l_int|0x00400000
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_LAW_CNTL
comma
l_int|0x13
)paren
suffix:semicolon
multiline_comment|/* 4 MB */
)brace
r_else
(brace
id|v_ram_size
op_assign
l_int|0x00200000
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_LAW_CNTL
comma
l_int|0x12
)paren
suffix:semicolon
multiline_comment|/* 2 MB */
)brace
r_if
c_cond
(paren
id|on_zorro2
)paren
id|v_ram_size
op_sub_assign
l_int|0x60000
suffix:semicolon
multiline_comment|/* we need some space for the registers */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_SYS_CNTL_4
comma
l_int|0x00
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_DAC_CNTL
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* 0x10 for X11 cursor mode */
multiline_comment|/* sequencer registers */
id|wseq
c_func
(paren
id|SEQ_ID_CLOCKING_MODE
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* 8 dot clock */
id|wseq
c_func
(paren
id|SEQ_ID_MAP_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_CHAR_MAP_SELECT
comma
l_int|0x00
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_MEMORY_MODE
comma
l_int|0x02
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_RAMDAC_CNTL
comma
l_int|0x00
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_SIGNAL_SELECT
comma
l_int|0x00
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_EXT_SEQ_REG9
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* MMIO and PIO reg access enabled */
id|wseq
c_func
(paren
id|SEQ_ID_EXT_MISC_SEQ
comma
l_int|0x00
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_CLKSYN_CNTL_1
comma
l_int|0x00
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_EXT_SEQ
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* graphic registers */
id|wgfx
c_func
(paren
id|GCT_ID_SET_RESET
comma
l_int|0x00
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_ENABLE_SET_RESET
comma
l_int|0x00
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_COLOR_COMPARE
comma
l_int|0x00
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_DATA_ROTATE
comma
l_int|0x00
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_READ_MAP_SELECT
comma
l_int|0x00
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_GRAPHICS_MODE
comma
l_int|0x40
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_MISC
comma
l_int|0x01
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_COLOR_XCARE
comma
l_int|0x0f
)paren
suffix:semicolon
id|wgfx
c_func
(paren
id|GCT_ID_BITMASK
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* attribute  registers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|15
suffix:semicolon
id|i
op_increment
)paren
(brace
id|watr
c_func
(paren
id|ACT_ID_PALETTE0
op_plus
id|i
comma
id|i
)paren
suffix:semicolon
)brace
id|watr
c_func
(paren
id|ACT_ID_ATTR_MODE_CNTL
comma
l_int|0x41
)paren
suffix:semicolon
id|watr
c_func
(paren
id|ACT_ID_OVERSCAN_COLOR
comma
l_int|0xff
)paren
suffix:semicolon
id|watr
c_func
(paren
id|ACT_ID_COLOR_PLANE_ENA
comma
l_int|0x0f
)paren
suffix:semicolon
id|watr
c_func
(paren
id|ACT_ID_HOR_PEL_PANNING
comma
l_int|0x00
)paren
suffix:semicolon
id|watr
c_func
(paren
id|ACT_ID_COLOR_SELECT
comma
l_int|0x00
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|VDAC_MASK
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* init local cmap as greyscale levels */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|virgefb_colour_table
(braket
id|i
)braket
(braket
l_int|0
)braket
op_assign
id|i
suffix:semicolon
id|virgefb_colour_table
(braket
id|i
)braket
(braket
l_int|1
)braket
op_assign
id|i
suffix:semicolon
id|virgefb_colour_table
(braket
id|i
)braket
(braket
l_int|2
)braket
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/* clear framebuffer memory */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|v_ram
comma
l_int|0x00
comma
id|v_ram_size
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    This function should fill in the `fix&squot; structure based on the&n; *    values in the `par&squot; structure.&n; */
DECL|function|virgefb_encode_fix
r_static
r_int
id|virgefb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER set video phys addr&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|virgefb_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on_zorro2
)paren
id|fix-&gt;smem_start
op_assign
id|v_ram_phys
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
id|on_zorro2
)paren
id|Select_Zorro2_FrameBuffer
c_func
(paren
id|ENDIAN_BYTE
)paren
suffix:semicolon
r_else
id|fix-&gt;smem_start
op_assign
(paren
id|v_ram_phys
op_plus
id|CYBMEM_OFFSET_8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|on_zorro2
)paren
id|Select_Zorro2_FrameBuffer
c_func
(paren
id|ENDIAN_WORD
)paren
suffix:semicolon
r_else
id|fix-&gt;smem_start
op_assign
(paren
id|v_ram_phys
op_plus
id|CYBMEM_OFFSET_16
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|on_zorro2
)paren
id|Select_Zorro2_FrameBuffer
c_func
(paren
id|ENDIAN_LONG
)paren
suffix:semicolon
r_else
id|fix-&gt;smem_start
op_assign
(paren
id|v_ram_phys
op_plus
id|CYBMEM_OFFSET_32
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|fix-&gt;smem_len
op_assign
id|v_ram_size
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|mmio_regs_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
l_int|0x10000
suffix:semicolon
multiline_comment|/* TODO: verify this for the CV64/3D */
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|par-&gt;var.xres_virtual
op_star
id|par-&gt;var.bits_per_pixel
op_div
l_int|8
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_S3_VIRGE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT v_ram_phys = 0x%8.8lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fix-&gt;smem_start
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Fill the `par&squot; structure based on the values in `var&squot;.&n; *&t;TODO: Verify and adjust values, return -EINVAL if bad.&n; */
DECL|function|virgefb_decode_var
r_static
r_int
id|virgefb_decode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;var.xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|par-&gt;var.yres
op_assign
id|var-&gt;yres
suffix:semicolon
id|par-&gt;var.xres_virtual
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|par-&gt;var.yres_virtual
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
multiline_comment|/* roundup and validate */
id|par-&gt;var.xres
op_assign
(paren
id|par-&gt;var.xres
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|par-&gt;var.xres_virtual
op_assign
(paren
id|par-&gt;var.xres_virtual
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;var.xres_virtual
OL
id|par-&gt;var.xres
)paren
id|par-&gt;var.xres_virtual
op_assign
id|par-&gt;var.xres
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;var.yres_virtual
OL
id|par-&gt;var.yres
)paren
id|par-&gt;var.yres_virtual
op_assign
id|par-&gt;var.yres
suffix:semicolon
id|par-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|par-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
id|par-&gt;var.bits_per_pixel
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;var.bits_per_pixel
op_le
l_int|8
)paren
id|par-&gt;var.bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par-&gt;var.bits_per_pixel
op_le
l_int|16
)paren
id|par-&gt;var.bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_else
id|par-&gt;var.bits_per_pixel
op_assign
l_int|32
suffix:semicolon
macro_line|#ifndef FBCON_HAS_CFB32
r_if
c_cond
(paren
id|par-&gt;var.bits_per_pixel
op_eq
l_int|32
)paren
id|par-&gt;var.bits_per_pixel
op_assign
l_int|16
suffix:semicolon
macro_line|#endif
macro_line|#ifndef FBCON_HAS_CFB16
r_if
c_cond
(paren
id|par-&gt;var.bits_per_pixel
op_eq
l_int|16
)paren
id|par-&gt;var.bits_per_pixel
op_assign
l_int|8
suffix:semicolon
macro_line|#endif
id|par-&gt;var.grayscale
op_assign
id|var-&gt;grayscale
suffix:semicolon
id|par-&gt;var.red
op_assign
id|var-&gt;red
suffix:semicolon
id|par-&gt;var.green
op_assign
id|var-&gt;green
suffix:semicolon
id|par-&gt;var.blue
op_assign
id|var-&gt;blue
suffix:semicolon
id|par-&gt;var.transp
op_assign
id|var-&gt;transp
suffix:semicolon
id|par-&gt;var.nonstd
op_assign
id|var-&gt;nonstd
suffix:semicolon
id|par-&gt;var.activate
op_assign
id|var-&gt;activate
suffix:semicolon
id|par-&gt;var.height
op_assign
id|var-&gt;height
suffix:semicolon
id|par-&gt;var.width
op_assign
id|var-&gt;width
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|par-&gt;var.accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;var.accel_flags
op_assign
l_int|0
suffix:semicolon
)brace
id|par-&gt;var.pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
id|par-&gt;var.left_margin
op_assign
id|var-&gt;left_margin
suffix:semicolon
id|par-&gt;var.right_margin
op_assign
id|var-&gt;right_margin
suffix:semicolon
id|par-&gt;var.upper_margin
op_assign
id|var-&gt;upper_margin
suffix:semicolon
id|par-&gt;var.lower_margin
op_assign
id|var-&gt;lower_margin
suffix:semicolon
id|par-&gt;var.hsync_len
op_assign
id|var-&gt;hsync_len
suffix:semicolon
id|par-&gt;var.vsync_len
op_assign
id|var-&gt;vsync_len
suffix:semicolon
id|par-&gt;var.sync
op_assign
id|var-&gt;sync
suffix:semicolon
id|par-&gt;var.vmode
op_assign
id|var-&gt;vmode
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Fill the `var&squot; structure based on the values in `par&squot; and maybe&n; *&t;other values read out of the hardware.&n; */
DECL|function|virgefb_encode_var
r_static
r_int
id|virgefb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|virgefb_par
op_star
id|par
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|var
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
multiline_comment|/* need this ? */
id|var-&gt;xres
op_assign
id|par-&gt;var.xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|par-&gt;var.yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|par-&gt;var.xres_virtual
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|par-&gt;var.yres_virtual
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|par-&gt;var.xoffset
suffix:semicolon
id|var-&gt;yoffset
op_assign
id|par-&gt;var.yoffset
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|par-&gt;var.bits_per_pixel
suffix:semicolon
id|var-&gt;grayscale
op_assign
id|par-&gt;var.grayscale
suffix:semicolon
id|var-&gt;red
op_assign
id|par-&gt;var.red
suffix:semicolon
id|var-&gt;green
op_assign
id|par-&gt;var.green
suffix:semicolon
id|var-&gt;blue
op_assign
id|par-&gt;var.blue
suffix:semicolon
id|var-&gt;transp
op_assign
id|par-&gt;var.transp
suffix:semicolon
id|var-&gt;nonstd
op_assign
id|par-&gt;var.nonstd
suffix:semicolon
id|var-&gt;activate
op_assign
id|par-&gt;var.activate
suffix:semicolon
id|var-&gt;height
op_assign
id|par-&gt;var.height
suffix:semicolon
id|var-&gt;width
op_assign
id|par-&gt;var.width
suffix:semicolon
id|var-&gt;accel_flags
op_assign
id|par-&gt;var.accel_flags
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|par-&gt;var.pixclock
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|par-&gt;var.left_margin
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|par-&gt;var.right_margin
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|par-&gt;var.upper_margin
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|par-&gt;var.lower_margin
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|par-&gt;var.hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|par-&gt;var.vsync_len
suffix:semicolon
id|var-&gt;sync
op_assign
id|par-&gt;var.sync
suffix:semicolon
id|var-&gt;vmode
op_assign
id|par-&gt;var.vmode
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set a single color register. The values supplied are already&n; *    rounded down to the hardware&squot;s capabilities (according to the&n; *    entries in the var structure). Return != 0 for invalid regno.&n; */
DECL|function|virgefb_setcolreg
r_static
r_int
id|virgefb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|current_par.var.bits_per_pixel
op_eq
l_int|8
)paren
op_logical_and
(paren
id|regno
OG
l_int|255
)paren
)paren
op_logical_or
(paren
(paren
id|current_par.var.bits_per_pixel
op_ne
l_int|8
)paren
op_logical_and
(paren
id|regno
OG
l_int|15
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|current_par.var.bits_per_pixel
op_eq
l_int|8
)paren
op_logical_and
(paren
id|regno
OL
l_int|256
)paren
)paren
op_logical_or
(paren
(paren
id|current_par.var.bits_per_pixel
op_ne
l_int|8
)paren
op_logical_and
(paren
id|regno
OL
l_int|16
)paren
)paren
)paren
(brace
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|0
)braket
op_assign
id|red
op_rshift
l_int|10
suffix:semicolon
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|1
)braket
op_assign
id|green
op_rshift
l_int|10
suffix:semicolon
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|2
)braket
op_assign
id|blue
op_rshift
l_int|10
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|current_par.var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|wb_mmio
c_func
(paren
id|VDAC_ADDRESS_W
comma
(paren
r_int
r_char
)paren
id|regno
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|VDAC_DATA
comma
(paren
(paren
r_int
r_char
)paren
(paren
id|red
op_rshift
l_int|10
)paren
)paren
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|VDAC_DATA
comma
(paren
(paren
r_int
r_char
)paren
(paren
id|green
op_rshift
l_int|10
)paren
)paren
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|VDAC_DATA
comma
(paren
(paren
r_int
r_char
)paren
(paren
id|blue
op_rshift
l_int|10
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
multiline_comment|/* transp = 0&squot;s or 1&squot;s  ? */
(paren
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
op_rshift
l_int|0
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Read a single color register and split it into&n; *    colors/transparent. Return != 0 for invalid regno.&n; */
DECL|function|virgefb_getcolreg
r_static
r_int
id|virgefb_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|t
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|current_par.var.bits_per_pixel
op_eq
l_int|8
)paren
op_logical_and
(paren
id|regno
OL
l_int|256
)paren
)paren
op_logical_or
(paren
(paren
id|current_par.var.bits_per_pixel
op_ne
l_int|8
)paren
op_logical_and
(paren
id|regno
OL
l_int|16
)paren
)paren
)paren
(brace
id|t
op_assign
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|red
op_assign
(paren
id|t
op_lshift
l_int|10
)paren
op_or
(paren
id|t
op_lshift
l_int|4
)paren
op_or
(paren
id|t
op_rshift
l_int|2
)paren
suffix:semicolon
id|t
op_assign
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|green
op_assign
(paren
id|t
op_lshift
l_int|10
)paren
op_or
(paren
id|t
op_lshift
l_int|4
)paren
op_or
(paren
id|t
op_rshift
l_int|2
)paren
suffix:semicolon
id|t
op_assign
id|virgefb_colour_table
(braket
id|regno
)braket
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|blue
op_assign
(paren
id|t
op_lshift
l_int|10
)paren
op_or
(paren
id|t
op_lshift
l_int|4
)paren
op_or
(paren
id|t
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    (Un)Blank the screen&n; */
DECL|function|virgefb_gfx_on_off
r_static
r_void
id|virgefb_gfx_on_off
c_func
(paren
r_int
id|blank
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|gfx_on_off
c_func
(paren
id|blank
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * CV3D low-level support&n; */
DECL|function|wait_3d_fifo_slots
r_static
r_inline
r_void
id|wait_3d_fifo_slots
c_func
(paren
r_int
id|n
)paren
multiline_comment|/* WaitQueue */
(brace
r_do
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|rl_mmio
c_func
(paren
id|MR_SUBSYSTEM_STATUS_R
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0x1f
)paren
OL
(paren
id|n
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
DECL|function|virgefb_wait_for_idle
r_static
r_inline
r_void
id|virgefb_wait_for_idle
c_func
(paren
r_void
)paren
multiline_comment|/* WaitIdle */
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|rl_mmio
c_func
(paren
id|MR_SUBSYSTEM_STATUS_R
)paren
op_amp
l_int|0x2000
)paren
)paren
(brace
suffix:semicolon
)brace
id|blit_maybe_busy
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  * BitBLT - Through the Plane&n;  */
DECL|function|virgefb_BitBLT
r_static
r_void
id|virgefb_BitBLT
c_func
(paren
id|u_short
id|curx
comma
id|u_short
id|cury
comma
id|u_short
id|destx
comma
id|u_short
id|desty
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|stride
comma
id|u_short
id|depth
)paren
(brace
r_int
r_int
id|blitcmd
op_assign
id|S3V_BITBLT
op_or
id|S3V_DRAW
op_or
id|S3V_BLT_COPY
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|blitcmd
op_or_assign
id|S3V_DST_8BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|blitcmd
op_or_assign
id|S3V_DST_16BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
multiline_comment|/* 32 bit uses 2 by 16 bit values, see fbcon_virge32_bmove */
id|blitcmd
op_or_assign
id|S3V_DST_16BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Set drawing direction */
multiline_comment|/* -Y, X maj, -X (default) */
r_if
c_cond
(paren
id|curx
OG
id|destx
)paren
(brace
id|blitcmd
op_or_assign
(paren
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
multiline_comment|/* Drawing direction +X */
)brace
r_else
(brace
id|curx
op_add_assign
(paren
id|width
op_minus
l_int|1
)paren
suffix:semicolon
id|destx
op_add_assign
(paren
id|width
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cury
OG
id|desty
)paren
(brace
id|blitcmd
op_or_assign
(paren
l_int|1
op_lshift
l_int|26
)paren
suffix:semicolon
multiline_comment|/* Drawing direction +Y */
)brace
r_else
(brace
id|cury
op_add_assign
(paren
id|height
op_minus
l_int|1
)paren
suffix:semicolon
id|desty
op_add_assign
(paren
id|height
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|wait_3d_fifo_slots
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* wait on fifo slots for 8 writes */
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|blit_maybe_busy
op_assign
l_int|1
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_PATTERN_COLOR
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* pattern fb color */
id|wl_mmio
c_func
(paren
id|BLT_MONO_PATTERN_0
comma
op_complement
l_int|0
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_MONO_PATTERN_1
comma
op_complement
l_int|0
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SIZE_X_Y
comma
(paren
(paren
id|width
op_lshift
l_int|16
)paren
op_or
id|height
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SRC_X_Y
comma
(paren
(paren
id|curx
op_lshift
l_int|16
)paren
op_or
id|cury
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_DEST_X_Y
comma
(paren
(paren
id|destx
op_lshift
l_int|16
)paren
op_or
id|desty
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SRC_DEST_STRIDE
comma
(paren
(paren
(paren
id|stride
op_lshift
l_int|16
)paren
op_or
id|stride
)paren
multiline_comment|/* &amp; 0x0ff80ff8 */
)paren
)paren
suffix:semicolon
multiline_comment|/* why is this needed now ? */
id|wl_mmio
c_func
(paren
id|BLT_COMMAND_SET
comma
id|blitcmd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Rectangle Fill Solid&n; */
DECL|function|virgefb_RectFill
r_static
r_void
id|virgefb_RectFill
c_func
(paren
id|u_short
id|x
comma
id|u_short
id|y
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|color
comma
id|u_short
id|stride
comma
id|u_short
id|depth
)paren
(brace
r_int
r_int
id|blitcmd
op_assign
id|S3V_RECTFILL
op_or
id|S3V_DRAW
op_or
id|S3V_BLT_CLEAR
op_or
id|S3V_MONO_PAT
op_or
(paren
l_int|1
op_lshift
l_int|26
)paren
op_or
(paren
l_int|1
op_lshift
l_int|25
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|blitcmd
op_or_assign
id|S3V_DST_8BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|blitcmd
op_or_assign
id|S3V_DST_16BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
multiline_comment|/* 32 bit uses 2 times 16 bit values, see fbcon_virge32_clear */
id|blitcmd
op_or_assign
id|S3V_DST_16BPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|wait_3d_fifo_slots
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* wait on fifo slots for 5 writes */
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|blit_maybe_busy
op_assign
l_int|1
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_PATTERN_COLOR
comma
(paren
id|color
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SIZE_X_Y
comma
(paren
(paren
id|width
op_lshift
l_int|16
)paren
op_or
id|height
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_DEST_X_Y
comma
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SRC_DEST_STRIDE
comma
(paren
(paren
(paren
id|stride
op_lshift
l_int|16
)paren
op_or
id|stride
)paren
multiline_comment|/* &amp; 0x0ff80ff8 */
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_COMMAND_SET
comma
id|blitcmd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Move cursor to x, y&n; */
macro_line|#if 0
r_static
r_void
id|virgefb_move_cursor
c_func
(paren
id|u_short
id|x
comma
id|u_short
id|y
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Yuck .... MoveCursor on a 3D&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* -------------------- Interfaces to hardware functions -------------------- */
DECL|variable|virgefb_hw_switch
r_static
r_struct
id|fb_hwswitch
id|virgefb_hw_switch
op_assign
(brace
dot
id|init
op_assign
id|virge_init
comma
dot
id|encode_fix
op_assign
id|virgefb_encode_fix
comma
dot
id|decode_var
op_assign
id|virgefb_decode_var
comma
dot
id|encode_var
op_assign
id|virgefb_encode_var
comma
dot
id|getcolreg
op_assign
id|virgefb_getcolreg
comma
dot
id|blank
op_assign
id|virgefb_gfx_on_off
)brace
suffix:semicolon
multiline_comment|/* -------------------- Generic routines ------------------------------------ */
multiline_comment|/*&n; *    Fill the hardware&squot;s `par&squot; structure.&n; */
DECL|function|virgefb_get_par
r_static
r_void
id|virgefb_get_par
c_func
(paren
r_struct
id|virgefb_par
op_star
id|par
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_par_valid
)paren
(brace
op_star
id|par
op_assign
id|current_par
suffix:semicolon
)brace
r_else
(brace
id|fbhw
op_member_access_from_pointer
id|decode_var
c_func
(paren
op_amp
id|virgefb_default
comma
id|par
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|virgefb_set_par
r_static
r_void
id|virgefb_set_par
c_func
(paren
r_struct
id|virgefb_par
op_star
id|par
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|current_par
op_assign
op_star
id|par
suffix:semicolon
id|current_par_valid
op_assign
l_int|1
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|virgefb_set_video
r_static
r_void
id|virgefb_set_video
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
multiline_comment|/* Set clipping rectangle to current screen size */
r_int
r_int
id|clip
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|wait_3d_fifo_slots
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|clip
op_assign
(paren
(paren
l_int|0
op_lshift
l_int|16
)paren
op_or
(paren
id|var-&gt;xres
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_CLIP_LEFT_RIGHT
comma
id|clip
)paren
suffix:semicolon
id|clip
op_assign
(paren
(paren
l_int|0
op_lshift
l_int|16
)paren
op_or
(paren
id|var-&gt;yres
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_CLIP_TOP_BOTTOM
comma
id|clip
)paren
suffix:semicolon
id|wl_mmio
c_func
(paren
id|BLT_SRC_BASE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* seems we need to clear these two */
id|wl_mmio
c_func
(paren
id|BLT_DEST_BASE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Load the video mode defined by the &squot;var&squot; data */
id|virgefb_load_video_mode
c_func
(paren
id|var
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;Merge these two functions, Geert&squot;s suggestion.&n;static int virgefb_set_var(struct fb_var_screeninfo *var, int con, struct fb_info *info);&n;static int virgefb_do_fb_set_var(struct fb_var_screeninfo *var, int isactive);&n;*/
DECL|function|virgefb_do_fb_set_var
r_static
r_int
id|virgefb_do_fb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|isactive
)paren
(brace
r_int
id|err
comma
id|activate
suffix:semicolon
r_struct
id|virgefb_par
id|par
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fbhw
op_member_access_from_pointer
id|decode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|activate
op_assign
id|var-&gt;activate
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
op_logical_and
id|isactive
)paren
id|virgefb_set_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
id|fbhw
op_member_access_from_pointer
id|encode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
suffix:semicolon
id|var-&gt;activate
op_assign
id|activate
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
op_logical_and
id|isactive
)paren
id|virgefb_set_video
c_func
(paren
id|var
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Get the Fixed Part of the Display&n; */
DECL|function|virgefb_get_fix
r_static
r_int
id|virgefb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|virgefb_par
id|par
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|virgefb_get_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
r_else
id|error
op_assign
id|fbhw
op_member_access_from_pointer
id|decode_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
op_amp
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|fbhw
op_member_access_from_pointer
id|encode_fix
c_func
(paren
id|fix
comma
op_amp
id|par
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; *    Get the User Defined Part of the Display&n; */
DECL|function|virgefb_get_var
r_static
r_int
id|virgefb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|virgefb_par
id|par
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
(brace
id|virgefb_get_par
c_func
(paren
op_amp
id|par
)paren
suffix:semicolon
id|error
op_assign
id|fbhw
op_member_access_from_pointer
id|encode_var
c_func
(paren
id|var
comma
op_amp
id|par
)paren
suffix:semicolon
id|disp.var
op_assign
op_star
id|var
suffix:semicolon
multiline_comment|/* ++Andre: don&squot;t know if this is the right place */
)brace
r_else
(brace
op_star
id|var
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|virgefb_set_disp
r_static
r_void
id|virgefb_set_disp
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_struct
id|display
op_star
id|display
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
id|display
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_else
id|display
op_assign
op_amp
id|disp
suffix:semicolon
multiline_comment|/* used during initialization */
id|virgefb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|con
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|con
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|on_zorro2
)paren
(brace
id|info-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|v_ram
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|display-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|info-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
(paren
id|v_ram
op_plus
id|CYBMEM_OFFSET_8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|info-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
(paren
id|v_ram
op_plus
id|CYBMEM_OFFSET_16
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|info-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
(paren
id|v_ram
op_plus
id|CYBMEM_OFFSET_32
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
)brace
id|display-&gt;visual
op_assign
id|fix.visual
suffix:semicolon
id|display-&gt;type
op_assign
id|fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fix.ywrapstep
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|virgefb_inverse
suffix:semicolon
id|display-&gt;line_length
op_assign
id|display-&gt;var.xres_virtual
op_star
id|display-&gt;var.bits_per_pixel
op_div
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|display-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
id|display-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_virge8
suffix:semicolon
macro_line|#warning FIXME: We should reinit the graphics engine here
)brace
r_else
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|display-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_virge16
suffix:semicolon
)brace
r_else
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
op_amp
id|fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|display-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
(brace
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_virge32
suffix:semicolon
)brace
r_else
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
op_amp
id|fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT v_ram virt = 0x%8.8lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|display-&gt;screen_base
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set the User Defined Part of the Display&n; */
DECL|function|virgefb_set_var
r_static
r_int
id|virgefb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|err
comma
id|oldxres
comma
id|oldyres
comma
id|oldvxres
comma
id|oldvyres
comma
id|oldbpp
comma
id|oldaccel
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|virgefb_do_fb_set_var
c_func
(paren
id|var
comma
id|con
op_eq
id|info-&gt;currcon
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
(brace
id|oldxres
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.xres
suffix:semicolon
id|oldyres
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.yres
suffix:semicolon
id|oldvxres
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.xres_virtual
suffix:semicolon
id|oldvyres
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.yres_virtual
suffix:semicolon
id|oldbpp
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
suffix:semicolon
id|oldaccel
op_assign
id|fb_display
(braket
id|con
)braket
dot
id|var.accel_flags
suffix:semicolon
id|fb_display
(braket
id|con
)braket
dot
id|var
op_assign
op_star
id|var
suffix:semicolon
r_if
c_cond
(paren
id|oldxres
op_ne
id|var-&gt;xres
op_logical_or
id|oldyres
op_ne
id|var-&gt;yres
op_logical_or
id|oldvxres
op_ne
id|var-&gt;xres_virtual
op_logical_or
id|oldvyres
op_ne
id|var-&gt;yres_virtual
op_logical_or
id|oldbpp
op_ne
id|var-&gt;bits_per_pixel
op_logical_or
id|oldaccel
op_ne
id|var-&gt;accel_flags
)paren
(brace
id|virgefb_set_disp
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_info.changevar
)paren
(paren
op_star
id|fb_info.changevar
)paren
(paren
id|con
)paren
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
)brace
)brace
id|var-&gt;activate
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Get the Colormap&n; */
DECL|function|virgefb_get_cmap
r_static
r_int
id|virgefb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
(brace
multiline_comment|/* current console? */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - console is current console, fb_get_cmap&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|fbhw-&gt;getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fb_display
(braket
id|con
)braket
dot
id|cmap.len
)paren
(brace
multiline_comment|/* non default colormap? */
id|DPRINTK
c_func
(paren
l_string|&quot;Use console cmap&bslash;n&quot;
)paren
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Use default cmap&bslash;n&quot;
)paren
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
id|fb_display
(braket
id|con
)braket
dot
id|var.bits_per_pixel
op_eq
l_int|8
ques
c_cond
l_int|256
suffix:colon
l_int|16
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|virgefb_ops
r_static
r_struct
id|fb_ops
id|virgefb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_get_fix
op_assign
id|virgefb_get_fix
comma
dot
id|fb_get_var
op_assign
id|virgefb_get_var
comma
dot
id|fb_set_var
op_assign
id|virgefb_set_var
comma
dot
id|fb_get_cmap
op_assign
id|virgefb_get_cmap
comma
dot
id|fb_set_cmap
op_assign
id|gen_set_cmap
comma
dot
id|fb_setcolreg
op_assign
id|virgefb_setcolreg
comma
dot
id|fb_blank
op_assign
id|virgefb_blank
comma
)brace
suffix:semicolon
DECL|function|virgefb_setup
r_int
id|__init
id|virgefb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
id|fb_info.fontname
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_opt
comma
l_string|&quot;inverse&quot;
)paren
)paren
(brace
id|virgefb_inverse
op_assign
l_int|1
suffix:semicolon
id|fb_invert_cmaps
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
id|strcpy
c_func
(paren
id|fb_info.fontname
comma
id|this_opt
op_plus
l_int|5
)paren
suffix:semicolon
macro_line|#ifdef FBCON_HAS_CFB8
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|this_opt
comma
l_string|&quot;virge8&quot;
)paren
)paren
(brace
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE8_DEFMODE
)braket
dot
id|var
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|this_opt
comma
l_string|&quot;virge16&quot;
)paren
)paren
(brace
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE16_DEFMODE
)braket
dot
id|var
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|this_opt
comma
l_string|&quot;virge32&quot;
)paren
)paren
(brace
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE32_DEFMODE
)braket
dot
id|var
suffix:semicolon
)brace
macro_line|#endif
r_else
id|virgefb_get_video_mode
c_func
(paren
id|this_opt
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;mode : xres=%d, yres=%d, bpp=%d&bslash;n&quot;
comma
id|virgefb_default.xres
comma
id|virgefb_default.yres
comma
id|virgefb_default.bits_per_pixel
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Get a Video Mode&n; */
DECL|function|virgefb_get_video_mode
r_static
r_int
id|__init
id|virgefb_get_video_mode
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TOTAL_MODES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|virgefb_predefined
(braket
id|i
)braket
dot
id|name
)paren
)paren
(brace
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|i
)braket
dot
id|var
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
multiline_comment|/* ++Andre: set virgefb default mode */
multiline_comment|/* prefer 16 bit depth, 8 if no 16, if no 8 or 16 use 32 */
macro_line|#ifdef FBCON_HAS_CFB32
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE32_DEFMODE
)braket
dot
id|var
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE8_DEFMODE
)braket
dot
id|var
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
id|virgefb_default
op_assign
id|virgefb_predefined
(braket
id|VIRGE16_DEFMODE
)braket
dot
id|var
suffix:semicolon
macro_line|#endif
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Initialization&n; */
DECL|function|virgefb_init
r_int
id|__init
id|virgefb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|virgefb_par
id|par
suffix:semicolon
r_int
r_int
id|board_addr
comma
id|board_size
suffix:semicolon
r_struct
id|zorro_dev
op_star
id|z
op_assign
l_int|NULL
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|z
op_assign
id|zorro_find_device
c_func
(paren
id|ZORRO_PROD_PHASE5_CYBERVISION64_3D
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|z
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|board_addr
op_assign
id|z-&gt;resource.start
suffix:semicolon
r_if
c_cond
(paren
id|board_addr
OL
l_int|0x01000000
)paren
(brace
multiline_comment|/* board running in Z2 space. This includes the video memory&n;&t;&t;    as well as the S3 register set */
id|on_zorro2
op_assign
l_int|1
suffix:semicolon
id|board_size
op_assign
l_int|0x00400000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|board_addr
comma
id|board_size
comma
l_string|&quot;S3 ViRGE&quot;
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|v_ram_phys
op_assign
id|board_addr
suffix:semicolon
id|v_ram
op_assign
id|ZTWO_VADDR
c_func
(paren
id|v_ram_phys
)paren
suffix:semicolon
id|mmio_regs_phys
op_assign
(paren
r_int
r_int
)paren
(paren
id|board_addr
op_plus
l_int|0x003c0000
)paren
suffix:semicolon
id|vgaio_regs
op_assign
(paren
r_int
r_char
op_star
)paren
id|ZTWO_VADDR
c_func
(paren
id|board_addr
op_plus
l_int|0x003c0000
)paren
suffix:semicolon
id|mmio_regs
op_assign
(paren
r_int
r_char
op_star
)paren
id|ZTWO_VADDR
c_func
(paren
id|mmio_regs_phys
)paren
suffix:semicolon
id|vcode_switch_base
op_assign
(paren
r_int
r_int
)paren
id|ZTWO_VADDR
c_func
(paren
id|board_addr
op_plus
l_int|0x003a0000
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;CV3D detected running in Z2 mode.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* board running in Z3 space. Separate video memory (3 apertures)&n;&t;&t;   and S3 register set */
id|on_zorro2
op_assign
l_int|0
suffix:semicolon
id|board_size
op_assign
l_int|0x01000000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|board_addr
comma
id|board_size
comma
l_string|&quot;S3 ViRGE&quot;
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|v_ram_phys
op_assign
id|board_addr
op_plus
l_int|0x04000000
suffix:semicolon
id|v_ram
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|v_ram_phys
comma
l_int|0x01000000
)paren
suffix:semicolon
id|mmio_regs_phys
op_assign
id|board_addr
op_plus
l_int|0x05000000
suffix:semicolon
id|vgaio_regs
op_assign
(paren
r_int
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|board_addr
op_plus
l_int|0x0c000000
comma
l_int|0x00100000
)paren
suffix:semicolon
multiline_comment|/* includes PCI regs */
id|mmio_regs
op_assign
id|ioremap
c_func
(paren
id|mmio_regs_phys
comma
l_int|0x00010000
)paren
suffix:semicolon
id|vcode_switch_base
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|board_addr
op_plus
l_int|0x08000000
comma
l_int|0x1000
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;CV3D detected running in Z3 mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if defined (VIRGEFBDEBUG)
id|DPRINTK
c_func
(paren
l_string|&quot;board_addr     : 0x%8.8lx&bslash;n&quot;
comma
id|board_addr
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;board_size     : 0x%8.8lx&bslash;n&quot;
comma
id|board_size
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;mmio_regs_phy  : 0x%8.8lx&bslash;n&quot;
comma
id|mmio_regs_phys
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;v_ram_phys     : 0x%8.8lx&bslash;n&quot;
comma
id|v_ram_phys
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;vgaio_regs     : 0x%8.8lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|vgaio_regs
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;mmio_regs      : 0x%8.8lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|mmio_regs
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;v_ram          : 0x%8.8lx&bslash;n&quot;
comma
id|v_ram
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;vcode sw base  : 0x%8.8lx&bslash;n&quot;
comma
id|vcode_switch_base
)paren
suffix:semicolon
macro_line|#endif
id|fbhw
op_assign
op_amp
id|virgefb_hw_switch
suffix:semicolon
id|strcpy
c_func
(paren
id|fb_info.modename
comma
id|virgefb_name
)paren
suffix:semicolon
id|fb_info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fb_info.node
op_assign
id|NODEV
suffix:semicolon
id|fb_info.fbops
op_assign
op_amp
id|virgefb_ops
suffix:semicolon
id|fb_info.disp
op_assign
op_amp
id|disp
suffix:semicolon
id|fb_info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|fb_info.switch_con
op_assign
op_amp
id|virgefb_switch
suffix:semicolon
id|fb_info.updatevar
op_assign
op_amp
id|virgefb_updatevar
suffix:semicolon
id|fb_info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|fbhw
op_member_access_from_pointer
id|init
c_func
(paren
)paren
suffix:semicolon
id|fbhw
op_member_access_from_pointer
id|decode_var
c_func
(paren
op_amp
id|virgefb_default
comma
op_amp
id|par
)paren
suffix:semicolon
id|fbhw
op_member_access_from_pointer
id|encode_var
c_func
(paren
op_amp
id|virgefb_default
comma
op_amp
id|par
)paren
suffix:semicolon
id|virgefb_do_fb_set_var
c_func
(paren
op_amp
id|virgefb_default
comma
l_int|1
)paren
suffix:semicolon
id|virgefb_get_var
c_func
(paren
op_amp
id|fb_display
(braket
l_int|0
)braket
dot
id|var
comma
op_minus
l_int|1
comma
op_amp
id|fb_info
)paren
suffix:semicolon
id|virgefb_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|fb_info
)paren
suffix:semicolon
id|do_install_cmap
c_func
(paren
l_int|0
comma
op_amp
id|fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
OL
l_int|0
)paren
(brace
macro_line|#warning release resources
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;virgefb.c: register_framebuffer failed&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device, using %ldK of video memory&bslash;n&quot;
comma
id|minor
c_func
(paren
id|fb_info.node
)paren
comma
id|fb_info.modename
comma
id|v_ram_size
op_rshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* TODO: This driver cannot be unloaded yet */
id|MOD_INC_USE_COUNT
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|virgefb_switch
r_static
r_int
id|virgefb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Do we have to save the colormap? */
r_if
c_cond
(paren
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap.len
)paren
id|fb_get_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|info-&gt;currcon
)braket
dot
id|cmap
comma
l_int|1
comma
id|fbhw-&gt;getcolreg
comma
id|info
)paren
suffix:semicolon
id|virgefb_do_fb_set_var
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
l_int|1
)paren
suffix:semicolon
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
multiline_comment|/* Install new colormap */
id|do_install_cmap
c_func
(paren
id|con
comma
id|info
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Update the `var&squot; structure (called by fbcon.c)&n; *&n; *    This call looks only at yoffset and the FB_VMODE_YWRAP flag in `var&squot;.&n; *    Since it&squot;s called by a kernel driver, no range checking is done.&n; */
DECL|function|virgefb_updatevar
r_static
r_int
id|virgefb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *    Blank the display.&n; */
DECL|function|virgefb_blank
r_static
r_int
id|virgefb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|fbhw
op_member_access_from_pointer
id|blank
c_func
(paren
id|blank
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Text console acceleration&n; */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|fbcon_virge8_bmove
r_static
r_void
id|fbcon_virge8_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|dx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|virgefb_BitBLT
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|dx
comma
(paren
id|u_short
)paren
(paren
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge8_clear
r_static
r_void
id|fbcon_virge8_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_char
id|bg
suffix:semicolon
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|virgefb_RectFill
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|bg
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge8_putc
r_static
r_void
id|fbcon_virge8_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb8_putc
c_func
(paren
id|conp
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge8_putcs
r_static
r_void
id|fbcon_virge8_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb8_putcs
c_func
(paren
id|conp
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge8_revc
r_static
r_void
id|fbcon_virge8_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb8_revc
c_func
(paren
id|p
comma
id|xx
comma
id|yy
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge8_clear_margins
r_static
r_void
id|fbcon_virge8_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb8_clear_margins
c_func
(paren
id|conp
comma
id|p
comma
id|bottom_only
)paren
suffix:semicolon
)brace
DECL|variable|fbcon_virge8
r_static
r_struct
id|display_switch
id|fbcon_virge8
op_assign
(brace
dot
id|setup
op_assign
id|fbcon_cfb8_setup
comma
dot
id|bmove
op_assign
id|fbcon_virge8_bmove
comma
dot
id|clear
op_assign
id|fbcon_virge8_clear
comma
dot
id|putc
op_assign
id|fbcon_virge8_putc
comma
dot
id|putcs
op_assign
id|fbcon_virge8_putcs
comma
dot
id|revc
op_assign
id|fbcon_virge8_revc
comma
dot
id|clear_margins
op_assign
id|fbcon_virge8_clear_margins
comma
dot
id|fontwidthmask
op_assign
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|fbcon_virge16_bmove
r_static
r_void
id|fbcon_virge16_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|dx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|virgefb_BitBLT
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|dx
comma
(paren
id|u_short
)paren
(paren
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge16_clear
r_static
r_void
id|fbcon_virge16_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_char
id|bg
suffix:semicolon
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|virgefb_RectFill
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|bg
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge16_putc
r_static
r_void
id|fbcon_virge16_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb16_putc
c_func
(paren
id|conp
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge16_putcs
r_static
r_void
id|fbcon_virge16_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb16_putcs
c_func
(paren
id|conp
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge16_revc
r_static
r_void
id|fbcon_virge16_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb16_revc
c_func
(paren
id|p
comma
id|xx
comma
id|yy
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge16_clear_margins
r_static
r_void
id|fbcon_virge16_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb16_clear_margins
c_func
(paren
id|conp
comma
id|p
comma
id|bottom_only
)paren
suffix:semicolon
)brace
DECL|variable|fbcon_virge16
r_static
r_struct
id|display_switch
id|fbcon_virge16
op_assign
(brace
dot
id|setup
op_assign
id|fbcon_cfb16_setup
comma
dot
id|bmove
op_assign
id|fbcon_virge16_bmove
comma
dot
id|clear
op_assign
id|fbcon_virge16_clear
comma
dot
id|putc
op_assign
id|fbcon_virge16_putc
comma
dot
id|putcs
op_assign
id|fbcon_virge16_putcs
comma
dot
id|revc
op_assign
id|fbcon_virge16_revc
comma
dot
id|clear_margins
op_assign
id|fbcon_virge16_clear_margins
comma
dot
id|fontwidthmask
op_assign
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|function|fbcon_virge32_bmove
r_static
r_void
id|fbcon_virge32_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sx
op_mul_assign
l_int|16
suffix:semicolon
id|dx
op_mul_assign
l_int|16
suffix:semicolon
id|width
op_mul_assign
l_int|16
suffix:semicolon
multiline_comment|/* doubled these values to do 32 bit blit */
id|virgefb_BitBLT
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|dx
comma
(paren
id|u_short
)paren
(paren
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge32_clear
r_static
r_void
id|fbcon_virge32_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
r_char
id|bg
suffix:semicolon
id|sx
op_mul_assign
l_int|16
suffix:semicolon
id|width
op_mul_assign
l_int|16
suffix:semicolon
multiline_comment|/* doubled these values to do 32 bit blit */
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|virgefb_RectFill
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
)paren
comma
(paren
id|u_short
)paren
id|bg
comma
(paren
id|u_short
)paren
id|p-&gt;next_line
comma
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge32_putc
r_static
r_void
id|fbcon_virge32_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb32_putc
c_func
(paren
id|conp
comma
id|p
comma
id|c
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge32_putcs
r_static
r_void
id|fbcon_virge32_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb32_putcs
c_func
(paren
id|conp
comma
id|p
comma
id|s
comma
id|count
comma
id|yy
comma
id|xx
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge32_revc
r_static
r_void
id|fbcon_virge32_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb32_revc
c_func
(paren
id|p
comma
id|xx
comma
id|yy
)paren
suffix:semicolon
)brace
DECL|function|fbcon_virge32_clear_margins
r_static
r_void
id|fbcon_virge32_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_if
c_cond
(paren
id|blit_maybe_busy
)paren
id|virgefb_wait_for_idle
c_func
(paren
)paren
suffix:semicolon
id|fbcon_cfb32_clear_margins
c_func
(paren
id|conp
comma
id|p
comma
id|bottom_only
)paren
suffix:semicolon
)brace
DECL|variable|fbcon_virge32
r_static
r_struct
id|display_switch
id|fbcon_virge32
op_assign
(brace
dot
id|setup
op_assign
id|fbcon_cfb32_setup
comma
dot
id|bmove
op_assign
id|fbcon_virge32_bmove
comma
dot
id|clear
op_assign
id|fbcon_virge32_clear
comma
dot
id|putc
op_assign
id|fbcon_virge32_putc
comma
dot
id|putcs
op_assign
id|fbcon_virge32_putcs
comma
dot
id|revc
op_assign
id|fbcon_virge32_revc
comma
dot
id|clear_margins
op_assign
id|fbcon_virge32_clear_margins
comma
dot
id|fontwidthmask
op_assign
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef MODULE
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|virgefb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Not reached because the usecount will never be&n;&t;   decremented to zero */
id|unregister_framebuffer
c_func
(paren
op_amp
id|fb_info
)paren
suffix:semicolon
multiline_comment|/* TODO: clean up ... */
)brace
macro_line|#endif /* MODULE */
DECL|function|cv3d_has_4mb
r_static
r_int
id|cv3d_has_4mb
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* cyberfb version didn&squot;t work, neither does this (not reliably)&n;&t;forced to return 4MB */
macro_line|#if 0
r_volatile
r_int
r_int
op_star
id|t0
comma
op_star
id|t2
suffix:semicolon
macro_line|#endif
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* write patterns in memory and test if they can be read */
id|t0
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
id|v_ram
suffix:semicolon
id|t2
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
(paren
id|v_ram
op_plus
l_int|0x00200000
)paren
suffix:semicolon
op_star
id|t0
op_assign
l_int|0x87654321
suffix:semicolon
op_star
id|t2
op_assign
l_int|0x12345678
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t0
op_ne
l_int|0x87654321
)paren
(brace
multiline_comment|/* read of first location failed */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 0MB !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|t2
op_eq
l_int|0x87654321
)paren
(brace
multiline_comment|/* should read 0x12345678 if 4MB */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 2MB(a) &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|t2
op_ne
l_int|0x12345678
)paren
(brace
multiline_comment|/* upper 2MB read back match failed */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 2MB(b)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* may have 4MB */
op_star
id|t2
op_assign
l_int|0xAAAAAAAA
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t2
op_ne
l_int|0xAAAAAAAA
)paren
(brace
multiline_comment|/* upper 2MB read back match failed */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 2MB(c)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|t2
op_assign
l_int|0x55555555
suffix:semicolon
r_if
c_cond
(paren
op_star
id|t2
op_ne
l_int|0x55555555
)paren
(brace
multiline_comment|/* upper 2MB read back match failed */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 2MB(d)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - 4MB&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Computes M, N, and R pll params for freq arg.&n; * Returns 16 bits - hi 0MMMMMM lo 0RRNNNNN&n; */
DECL|macro|REFCLOCK
mdefine_line|#define REFCLOCK 14318000
DECL|function|virgefb_compute_clock
r_static
r_int
r_int
id|virgefb_compute_clock
c_func
(paren
r_int
r_int
id|freq
)paren
(brace
r_int
r_char
id|m
comma
id|n
comma
id|r
comma
id|rpwr
suffix:semicolon
r_int
r_int
id|diff
comma
id|ftry
comma
id|save
op_assign
op_complement
l_int|0UL
suffix:semicolon
r_int
r_int
id|mnr
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
l_int|0
comma
id|rpwr
op_assign
l_int|1
suffix:semicolon
id|r
OL
l_int|4
suffix:semicolon
id|r
op_increment
comma
id|rpwr
op_mul_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|135000000
op_le
(paren
id|rpwr
op_star
id|freq
)paren
)paren
op_logical_and
(paren
(paren
id|rpwr
op_star
id|freq
)paren
op_le
l_int|270000000
)paren
)paren
(brace
r_for
c_loop
(paren
id|n
op_assign
l_int|1
suffix:semicolon
id|n
OL
l_int|32
suffix:semicolon
id|n
op_increment
)paren
(brace
id|m
op_assign
(paren
(paren
id|freq
op_star
(paren
id|n
op_plus
l_int|2
)paren
op_star
id|rpwr
)paren
op_div
id|REFCLOCK
)paren
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|m
op_eq
l_int|0
op_logical_or
id|m
OG
l_int|127
)paren
r_break
suffix:semicolon
id|ftry
op_assign
(paren
(paren
id|REFCLOCK
op_div
(paren
id|n
op_plus
l_int|2
)paren
)paren
op_star
(paren
id|m
op_plus
l_int|2
)paren
)paren
op_div
id|rpwr
suffix:semicolon
r_if
c_cond
(paren
id|ftry
OG
id|freq
)paren
id|diff
op_assign
id|ftry
op_minus
id|freq
suffix:semicolon
r_else
id|diff
op_assign
id|freq
op_minus
id|ftry
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
id|save
)paren
(brace
id|save
op_assign
id|diff
suffix:semicolon
id|mnr
op_assign
(paren
id|m
op_lshift
l_int|8
)paren
op_or
(paren
id|r
op_lshift
l_int|5
)paren
op_or
(paren
id|n
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|save
op_eq
op_complement
l_int|0UL
)paren
id|printk
c_func
(paren
l_string|&quot;Can&squot;t compute clock PLL values for %ld Hz clock&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|mnr
suffix:semicolon
)brace
DECL|function|virgefb_load_video_mode
r_static
r_void
id|virgefb_load_video_mode
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|video_mode
)paren
(brace
r_int
r_char
id|lace
comma
id|dblscan
comma
id|tmp
suffix:semicolon
r_int
r_int
id|mnr
suffix:semicolon
r_int
r_int
id|HT
comma
id|HDE
comma
id|HBS
comma
id|HBW
comma
id|HSS
comma
id|HSW
suffix:semicolon
r_int
r_int
id|VT
comma
id|VDE
comma
id|VBS
comma
id|VBW
comma
id|VSS
comma
id|VSW
suffix:semicolon
r_int
r_int
id|SCO
suffix:semicolon
r_int
id|cr11
suffix:semicolon
r_int
id|cr67
suffix:semicolon
r_int
id|hmul
suffix:semicolon
r_int
id|xres
comma
id|xres_virtual
comma
id|hfront
comma
id|hsync
comma
id|hback
suffix:semicolon
r_int
id|yres
comma
id|vfront
comma
id|vsync
comma
id|vback
suffix:semicolon
r_int
id|bpp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|freq
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER : %dx%d-%d&bslash;n&quot;
comma
id|video_mode-&gt;xres
comma
id|video_mode-&gt;yres
comma
id|video_mode-&gt;bits_per_pixel
)paren
suffix:semicolon
id|bpp
op_assign
id|video_mode-&gt;bits_per_pixel
suffix:semicolon
id|xres
op_assign
id|video_mode-&gt;xres
suffix:semicolon
id|xres_virtual
op_assign
id|video_mode-&gt;xres_virtual
suffix:semicolon
id|hfront
op_assign
id|video_mode-&gt;right_margin
suffix:semicolon
id|hsync
op_assign
id|video_mode-&gt;hsync_len
suffix:semicolon
id|hback
op_assign
id|video_mode-&gt;left_margin
suffix:semicolon
id|lace
op_assign
l_int|0
suffix:semicolon
id|dblscan
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|video_mode-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|yres
op_assign
id|video_mode-&gt;yres
op_star
l_int|2
suffix:semicolon
id|vfront
op_assign
id|video_mode-&gt;lower_margin
op_star
l_int|2
suffix:semicolon
id|vsync
op_assign
id|video_mode-&gt;vsync_len
op_star
l_int|2
suffix:semicolon
id|vback
op_assign
id|video_mode-&gt;upper_margin
op_star
l_int|2
suffix:semicolon
id|dblscan
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|video_mode-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
id|yres
op_assign
(paren
id|video_mode-&gt;yres
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
id|vfront
op_assign
(paren
id|video_mode-&gt;lower_margin
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
id|vsync
op_assign
(paren
id|video_mode-&gt;vsync_len
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
id|vback
op_assign
(paren
id|video_mode-&gt;upper_margin
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
id|lace
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|yres
op_assign
id|video_mode-&gt;yres
suffix:semicolon
id|vfront
op_assign
id|video_mode-&gt;lower_margin
suffix:semicolon
id|vsync
op_assign
id|video_mode-&gt;vsync_len
suffix:semicolon
id|vback
op_assign
id|video_mode-&gt;upper_margin
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|video_mode-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|hmul
op_assign
l_int|1
suffix:semicolon
id|cr67
op_assign
l_int|0x00
suffix:semicolon
id|SCO
op_assign
id|xres_virtual
op_div
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|video_mode-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|video_mode-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|video_mode-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|video_mode-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|video_mode-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|video_mode-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|hmul
op_assign
l_int|2
suffix:semicolon
id|cr67
op_assign
l_int|0x50
suffix:semicolon
id|SCO
op_assign
id|xres_virtual
op_div
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|video_mode-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|video_mode-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|video_mode-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|video_mode-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|video_mode-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|hmul
op_assign
l_int|1
suffix:semicolon
id|cr67
op_assign
l_int|0xd0
suffix:semicolon
id|SCO
op_assign
id|xres_virtual
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|HT
op_assign
(paren
(paren
(paren
id|xres
op_plus
id|hfront
op_plus
id|hsync
op_plus
id|hback
)paren
op_div
l_int|8
)paren
op_star
id|hmul
)paren
op_minus
l_int|5
suffix:semicolon
id|HDE
op_assign
(paren
(paren
id|xres
op_div
l_int|8
)paren
op_star
id|hmul
)paren
op_minus
l_int|1
suffix:semicolon
id|HBS
op_assign
(paren
id|xres
op_div
l_int|8
)paren
op_star
id|hmul
suffix:semicolon
id|HSS
op_assign
(paren
(paren
id|xres
op_plus
id|hfront
)paren
op_div
l_int|8
)paren
op_star
id|hmul
suffix:semicolon
id|HSW
op_assign
(paren
id|hsync
op_div
l_int|8
)paren
op_star
id|hmul
suffix:semicolon
id|HBW
op_assign
(paren
(paren
(paren
id|hfront
op_plus
id|hsync
op_plus
id|hback
)paren
op_div
l_int|8
)paren
op_star
id|hmul
)paren
op_minus
l_int|2
suffix:semicolon
id|VT
op_assign
id|yres
op_plus
id|vfront
op_plus
id|vsync
op_plus
id|vback
op_minus
l_int|2
suffix:semicolon
id|VDE
op_assign
id|yres
op_minus
l_int|1
suffix:semicolon
id|VBS
op_assign
id|yres
op_minus
l_int|1
suffix:semicolon
id|VSS
op_assign
id|yres
op_plus
id|vfront
suffix:semicolon
id|VSW
op_assign
id|vsync
suffix:semicolon
id|VBW
op_assign
id|vfront
op_plus
id|vsync
op_plus
id|vback
op_minus
l_int|2
suffix:semicolon
macro_line|#ifdef VIRGEFBDEBUG
id|DPRINTK
c_func
(paren
l_string|&quot;HDE       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HDE
comma
id|HDE
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HBS       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HBS
comma
id|HBS
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HSS       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HSS
comma
id|HSS
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HSW       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HSW
comma
id|HSW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HBW       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HBW
comma
id|HBW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HSS + HSW : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HSS
op_plus
id|HSW
comma
id|HSS
op_plus
id|HSW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HBS + HBW : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HBS
op_plus
id|HBW
comma
id|HBS
op_plus
id|HBW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HT        : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|HT
comma
id|HT
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VDE       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VDE
comma
id|VDE
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VBS       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VBS
comma
id|VBS
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VSS       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VSS
comma
id|VSS
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VSW       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VSW
comma
id|VSW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VBW       : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VBW
comma
id|VBW
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VT        : 0x%4.4x, %4.4d&bslash;n&quot;
comma
id|VT
comma
id|VT
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* turn gfx off, don&squot;t mess up the display */
id|gfx_on_off
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* H and V sync polarity */
id|tmp
op_assign
id|rb_mmio
c_func
(paren
id|GREG_MISC_OUTPUT_R
)paren
op_amp
l_int|0x2f
suffix:semicolon
multiline_comment|/* colour, ram enable, clk sr12/s13 sel */
r_if
c_cond
(paren
op_logical_neg
(paren
id|video_mode-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
)paren
id|tmp
op_or_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* neg H sync polarity */
r_if
c_cond
(paren
op_logical_neg
(paren
id|video_mode-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
)paren
id|tmp
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* neg V sync polarity */
id|tmp
op_or_assign
l_int|0x0c
suffix:semicolon
multiline_comment|/* clk from sr12/sr13 */
id|wb_mmio
c_func
(paren
id|GREG_MISC_OUTPUT_W
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* clocks */
id|wseq
c_func
(paren
id|SEQ_ID_BUS_REQ_CNTL
comma
l_int|0xc0
)paren
suffix:semicolon
multiline_comment|/* 2 clk mem wr and /RAS1 */
id|wseq
c_func
(paren
id|SEQ_ID_CLKSYN_CNTL_2
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* b7 is 2 mem clk wr */
id|mnr
op_assign
id|virgefb_compute_clock
c_func
(paren
id|MEMCLOCK
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;mem clock %d, m %d, n %d, r %d.&bslash;n&quot;
comma
id|MEMCLOCK
comma
(paren
(paren
id|mnr
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
comma
(paren
id|mnr
op_amp
l_int|0x1f
)paren
comma
(paren
(paren
id|mnr
op_rshift
l_int|5
)paren
op_amp
l_int|0x03
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_MCLK_LO
comma
(paren
id|mnr
op_amp
l_int|0x7f
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_MCLK_HI
comma
(paren
(paren
id|mnr
op_amp
l_int|0x7f00
)paren
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|freq
op_assign
(paren
l_int|1000000000
op_div
id|video_mode-&gt;pixclock
)paren
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* pixclock is in ps ... convert to Hz */
id|mnr
op_assign
id|virgefb_compute_clock
c_func
(paren
id|freq
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;dot clock %ld, m %d, n %d, r %d.&bslash;n&quot;
comma
id|freq
comma
(paren
(paren
id|mnr
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
comma
(paren
id|mnr
op_amp
l_int|0x1f
)paren
comma
(paren
(paren
id|mnr
op_rshift
l_int|5
)paren
op_amp
l_int|0x03
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_DCLK_LO
comma
(paren
id|mnr
op_amp
l_int|0x7f
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_DCLK_HI
comma
(paren
(paren
id|mnr
op_amp
l_int|0x7f00
)paren
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_CLKSYN_CNTL_2
comma
l_int|0xa0
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_CLKSYN_CNTL_2
comma
l_int|0x80
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* load display parameters into board */
multiline_comment|/* not sure about sync and blanking extensions bits in cr5d and cr5 */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_HOR_OVF
comma
multiline_comment|/* 0x5d */
(paren
(paren
id|HT
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|HDE
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x02
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|HBS
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x04
suffix:colon
l_int|0x00
)paren
op_or
multiline_comment|/*&t;(((HBS + HBW) &amp; 0x40) ? 0x08 : 0x00) |&t;*/
(paren
(paren
id|HSS
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x10
suffix:colon
l_int|0x00
)paren
op_or
multiline_comment|/*&t;(((HSS + HSW) &amp; 0x20) ? 0x20 : 0x00) |&t;*/
(paren
(paren
id|HSW
op_ge
l_int|0x20
)paren
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
(paren
id|HT
op_minus
l_int|5
)paren
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x40
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_VER_OVF
comma
multiline_comment|/* 0x5e */
(paren
(paren
id|VT
op_amp
l_int|0x400
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VDE
op_amp
l_int|0x400
)paren
ques
c_cond
l_int|0x02
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VBS
op_amp
l_int|0x400
)paren
ques
c_cond
l_int|0x04
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VSS
op_amp
l_int|0x400
)paren
ques
c_cond
l_int|0x10
suffix:colon
l_int|0x00
)paren
op_or
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* line compare */
id|wcrt
c_func
(paren
id|CRT_ID_START_VER_RETR
comma
id|VSS
)paren
suffix:semicolon
id|cr11
op_assign
id|rcrt
c_func
(paren
id|CRT_ID_END_VER_RETR
)paren
op_or
l_int|0x20
suffix:semicolon
multiline_comment|/* vert interrupt flag */
id|wcrt
c_func
(paren
id|CRT_ID_END_VER_RETR
comma
(paren
(paren
id|cr11
op_amp
l_int|0x20
)paren
op_or
(paren
(paren
id|VSS
op_plus
id|VSW
)paren
op_amp
l_int|0x0f
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* keeps vert irq enable state, also has unlock bit cr0 to 7 */
id|wcrt
c_func
(paren
id|CRT_ID_VER_DISP_ENA_END
comma
id|VDE
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_START_VER_BLANK
comma
id|VBS
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_END_VER_BLANK
comma
id|VBS
op_plus
id|VBW
)paren
suffix:semicolon
multiline_comment|/* might be +/- 1 out */
id|wcrt
c_func
(paren
id|CRT_ID_HOR_TOTAL
comma
id|HT
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_DISPLAY_FIFO
comma
id|HT
op_minus
l_int|5
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_BACKWAD_COMP_3
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* enable display fifo */
id|wcrt
c_func
(paren
id|CRT_ID_HOR_DISP_ENA_END
comma
id|HDE
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_START_HOR_BLANK
comma
id|HBS
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_END_HOR_BLANK
comma
(paren
id|HBS
op_plus
id|HBW
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_START_HOR_RETR
comma
id|HSS
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_END_HOR_RETR
comma
multiline_comment|/* cr5 */
(paren
(paren
id|HSS
op_plus
id|HSW
)paren
op_amp
l_int|0x1f
)paren
op_or
(paren
(paren
(paren
id|HBS
op_plus
id|HBW
)paren
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_VER_TOTAL
comma
id|VT
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_OVERFLOW
comma
(paren
(paren
id|VT
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VDE
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x02
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VSS
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x04
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VBS
op_amp
l_int|0x100
)paren
ques
c_cond
l_int|0x08
suffix:colon
l_int|0x00
)paren
op_or
l_int|0x10
op_or
(paren
(paren
id|VT
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VDE
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|0x40
suffix:colon
l_int|0x00
)paren
op_or
(paren
(paren
id|VSS
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_MAX_SCAN_LINE
comma
(paren
id|dblscan
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
)paren
op_or
l_int|0x40
op_or
(paren
(paren
id|VBS
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_LINE_COMPARE
comma
l_int|0xff
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_LACE_RETR_START
comma
id|HT
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/* (HT-5)/2 ? */
id|wcrt
c_func
(paren
id|CRT_ID_LACE_CONTROL
comma
(paren
id|lace
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_SCREEN_OFFSET
comma
id|SCO
)paren
suffix:semicolon
id|wcrt
c_func
(paren
id|CRT_ID_EXT_SYS_CNTL_2
comma
(paren
id|SCO
op_rshift
l_int|4
)paren
op_amp
l_int|0x30
)paren
suffix:semicolon
multiline_comment|/* wait for vert sync before cr67 update */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rb_mmio
c_func
(paren
id|GREG_INPUT_STATUS1_R
)paren
op_amp
l_int|0x08
)paren
r_break
suffix:semicolon
)brace
id|wl_mmio
c_func
(paren
l_int|0x8200
comma
l_int|0x0000c000
)paren
suffix:semicolon
multiline_comment|/* fifo control  (0x00110400 ?) */
id|wcrt
c_func
(paren
id|CRT_ID_EXT_MISC_CNTL_2
comma
id|cr67
)paren
suffix:semicolon
multiline_comment|/* enable video */
id|tmp
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|ACT_ADDRESS_W
comma
(paren
(paren
id|bpp
op_eq
l_int|8
)paren
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
multiline_comment|/* set b5, ENB PLT in attr idx reg) */
id|tmp
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
multiline_comment|/* turn gfx on again */
id|gfx_on_off
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* pass-through */
id|SetVSwitch
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* cv3d */
id|DUMP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|gfx_on_off
r_static
r_inline
r_void
id|gfx_on_off
c_func
(paren
r_int
id|toggle
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER gfx %s&bslash;n&quot;
comma
(paren
id|toggle
ques
c_cond
l_string|&quot;off&quot;
suffix:colon
l_string|&quot;on&quot;
)paren
)paren
suffix:semicolon
id|toggle
op_assign
(paren
id|toggle
op_amp
l_int|0x01
)paren
op_lshift
l_int|5
suffix:semicolon
id|tmp
op_assign
id|rseq
c_func
(paren
id|SEQ_ID_CLOCKING_MODE
)paren
op_amp
(paren
op_complement
(paren
l_int|0x01
op_lshift
l_int|5
)paren
)paren
suffix:semicolon
id|wseq
c_func
(paren
id|SEQ_ID_CLOCKING_MODE
comma
id|tmp
op_or
id|toggle
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if defined (VIRGEFBDUMP)
multiline_comment|/*&n; * Dump board registers&n; */
DECL|function|cv64_dump
r_static
r_void
id|cv64_dump
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|c
comma
id|b
suffix:semicolon
id|u16
id|w
suffix:semicolon
id|u32
id|l
suffix:semicolon
multiline_comment|/* crt, seq, gfx and atr regs */
id|SelectMMIO
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x6f
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wb_mmio
c_func
(paren
id|CRT_ADDRESS
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;crt idx : 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|i
comma
id|rb_mmio
c_func
(paren
id|CRT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x1c
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wb_mmio
c_func
(paren
id|SEQ_ADDRESS
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;seq idx : 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|i
comma
id|rb_mmio
c_func
(paren
id|SEQ_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wb_mmio
c_func
(paren
id|GCT_ADDRESS
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;gfx idx : 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|i
comma
id|rb_mmio
c_func
(paren
id|GCT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x14
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|ACT_ADDRESS_W
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;atr idx : 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|i
comma
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_R
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* re-enable video access to palette */
id|c
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|wb_mmio
c_func
(paren
id|ACT_ADDRESS_W
comma
l_int|0x20
)paren
suffix:semicolon
id|c
op_assign
id|rb_mmio
c_func
(paren
id|ACT_ADDRESS_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* general regs */
id|printk
c_func
(paren
l_string|&quot;0x3cc(w 0x3c2) : 0x%2.2x&bslash;n&quot;
comma
id|rb_mmio
c_func
(paren
l_int|0x3cc
)paren
)paren
suffix:semicolon
multiline_comment|/* GREG_MISC_OUTPUT READ */
id|printk
c_func
(paren
l_string|&quot;0x3c2(-------) : 0x%2.2x&bslash;n&quot;
comma
id|rb_mmio
c_func
(paren
l_int|0x3c2
)paren
)paren
suffix:semicolon
multiline_comment|/* GREG_INPUT_STATUS 0 READ */
id|printk
c_func
(paren
l_string|&quot;0x3c3(w 0x3c3) : 0x%2.2x&bslash;n&quot;
comma
id|rb_vgaio
c_func
(paren
l_int|0x3c3
)paren
)paren
suffix:semicolon
multiline_comment|/* GREG_VIDEO_SUBS_ENABLE */
id|printk
c_func
(paren
l_string|&quot;0x3ca(w 0x3da) : 0x%2.2x&bslash;n&quot;
comma
id|rb_vgaio
c_func
(paren
l_int|0x3ca
)paren
)paren
suffix:semicolon
multiline_comment|/* GREG_FEATURE_CONTROL read */
id|printk
c_func
(paren
l_string|&quot;0x3da(-------) : 0x%2.2x&bslash;n&quot;
comma
id|rb_mmio
c_func
(paren
l_int|0x3da
)paren
)paren
suffix:semicolon
multiline_comment|/* GREG_INPUT_STATUS 1 READ */
multiline_comment|/* engine regs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0x8180
suffix:semicolon
id|i
op_le
l_int|0x8200
suffix:semicolon
id|i
op_assign
id|i
op_plus
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;0x%8.8x : 0x%8.8x&bslash;n&quot;
comma
id|i
comma
id|rl_mmio
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|i
op_assign
l_int|0x8504
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;0x%8.8x : 0x%8.8x&bslash;n&quot;
comma
id|i
comma
id|rl_mmio
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|i
op_assign
l_int|0x850c
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;0x%8.8x : 0x%8.8x&bslash;n&quot;
comma
id|i
comma
id|rl_mmio
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0xa4d4
suffix:semicolon
id|i
op_le
l_int|0xa50c
suffix:semicolon
id|i
op_assign
id|i
op_plus
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;0x%8.8x : 0x%8.8x&bslash;n&quot;
comma
id|i
comma
id|rl_mmio
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
multiline_comment|/* PCI regs */
id|SelectCFG
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
l_int|0x08
suffix:semicolon
id|c
op_assign
id|c
op_plus
l_int|2
)paren
(brace
id|w
op_assign
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
op_xor
l_int|2
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%4.4x&bslash;n&quot;
comma
id|c
comma
id|w
)paren
suffix:semicolon
)brace
id|c
op_assign
l_int|8
suffix:semicolon
id|l
op_assign
(paren
op_star
(paren
(paren
id|u32
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%8.8x&bslash;n&quot;
comma
id|c
comma
id|l
)paren
suffix:semicolon
id|c
op_assign
l_int|0x0d
suffix:semicolon
id|b
op_assign
(paren
op_star
(paren
(paren
id|u8
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
op_xor
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|c
comma
id|b
)paren
suffix:semicolon
id|c
op_assign
l_int|0x10
suffix:semicolon
id|l
op_assign
(paren
op_star
(paren
(paren
id|u32
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%8.8x&bslash;n&quot;
comma
id|c
comma
id|l
)paren
suffix:semicolon
id|c
op_assign
l_int|0x30
suffix:semicolon
id|l
op_assign
(paren
op_star
(paren
(paren
id|u32
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%8.8x&bslash;n&quot;
comma
id|c
comma
id|l
)paren
suffix:semicolon
id|c
op_assign
l_int|0x3c
suffix:semicolon
id|b
op_assign
(paren
op_star
(paren
(paren
id|u8
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
op_xor
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|c
comma
id|b
)paren
suffix:semicolon
id|c
op_assign
l_int|0x3d
suffix:semicolon
id|b
op_assign
(paren
op_star
(paren
(paren
id|u8
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
op_xor
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%2.2x&bslash;n&quot;
comma
id|c
comma
id|b
)paren
suffix:semicolon
id|c
op_assign
l_int|0x3e
suffix:semicolon
id|w
op_assign
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
(paren
id|u32
)paren
(paren
id|vgaio_regs
op_plus
id|c
op_plus
(paren
id|on_zorro2
ques
c_cond
l_int|0
suffix:colon
l_int|0x000e0000
)paren
)paren
op_xor
l_int|2
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pci 0x%2.2x : 0x%4.4x&bslash;n&quot;
comma
id|c
comma
id|w
)paren
suffix:semicolon
id|SelectMMIO
suffix:semicolon
)brace
macro_line|#endif
eof
