multiline_comment|/*&n; *  linux/drivers/video/cyber2000fb.c&n; *&n; *  Copyright (C) 1998-2002 Russell King&n; *&n; *  MIPS and 50xx clock support&n; *  Copyright (C) 2001 Bradley D. LaRonde &lt;brad@ltc.com&gt;&n; *&n; *  32 bit support, text color and panning fixes for modes != 8 bit&n; *  Copyright (C) 2002 Denis Oliver Kropp &lt;dok@directfb.org&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; * Integraphics CyberPro 2000, 2010 and 5000 frame buffer device&n; *&n; * Based on cyberfb.c.&n; *&n; * Note that we now use the new fbcon fix, var and cmap scheme.  We do&n; * still have to check which console is the currently displayed one&n; * however, especially for the colourmap stuff.&n; *&n; * We also use the new hotplug PCI subsystem.  I&squot;m not sure if there&n; * are any such cards, but I&squot;m erring on the side of caution.  We don&squot;t&n; * want to go pop just because someone does have one.&n; *&n; * Note that this doesn&squot;t work fully in the case of multiple CyberPro&n; * cards with grabbers.  We currently can only attach to the first&n; * CyberPro card found.&n; *&n; * When we&squot;re in truecolour mode, we power down the LUT RAM as a power&n; * saving feature.  Also, when we enter any of the powersaving modes&n; * (except soft blanking) we power down the RAMDACs.  This saves about&n; * 1W, which is roughly 8% of the power consumption of a NetWinder&n; * (which, incidentally, is about the same saving as a 2.5in hard disk&n; * entering standby mode.)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef __arm__
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#endif
macro_line|#include &quot;cyber2000fb.h&quot;
DECL|struct|cfb_info
r_struct
id|cfb_info
(brace
DECL|member|fb
r_struct
id|fb_info
id|fb
suffix:semicolon
DECL|member|dispsw
r_struct
id|display_switch
op_star
id|dispsw
suffix:semicolon
DECL|member|display
r_struct
id|display
op_star
id|display
suffix:semicolon
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
DECL|member|region
r_int
r_char
op_star
id|region
suffix:semicolon
DECL|member|regs
r_int
r_char
op_star
id|regs
suffix:semicolon
DECL|member|id
id|u_int
id|id
suffix:semicolon
DECL|member|func_use_count
r_int
id|func_use_count
suffix:semicolon
DECL|member|ref_ps
id|u_long
id|ref_ps
suffix:semicolon
multiline_comment|/*&n;&t; * Clock divisors&n;&t; */
DECL|member|divisors
id|u_int
id|divisors
(braket
l_int|4
)braket
suffix:semicolon
r_struct
(brace
DECL|member|red
DECL|member|green
DECL|member|blue
id|u8
id|red
comma
id|green
comma
id|blue
suffix:semicolon
DECL|member|palette
)brace
id|palette
(braket
id|NR_PALETTE
)braket
suffix:semicolon
DECL|member|mem_ctl1
id|u_char
id|mem_ctl1
suffix:semicolon
DECL|member|mem_ctl2
id|u_char
id|mem_ctl2
suffix:semicolon
DECL|member|mclk_mult
id|u_char
id|mclk_mult
suffix:semicolon
DECL|member|mclk_div
id|u_char
id|mclk_div
suffix:semicolon
multiline_comment|/*&n;&t; * RAMDAC control register is both of these or&squot;ed together&n;&t; */
DECL|member|ramdac_ctrl
id|u_char
id|ramdac_ctrl
suffix:semicolon
DECL|member|ramdac_powerdown
id|u_char
id|ramdac_powerdown
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|default_font_storage
r_static
r_char
id|default_font_storage
(braket
l_int|40
)braket
suffix:semicolon
DECL|variable|default_font
r_static
r_char
op_star
id|default_font
op_assign
l_string|&quot;Acorn8x8&quot;
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|default_font
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|default_font
comma
l_string|&quot;Default font name&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Our access methods.&n; */
DECL|macro|cyber2000fb_writel
mdefine_line|#define cyber2000fb_writel(val,reg,cfb)&t;writel(val, (cfb)-&gt;regs + (reg))
DECL|macro|cyber2000fb_writew
mdefine_line|#define cyber2000fb_writew(val,reg,cfb)&t;writew(val, (cfb)-&gt;regs + (reg))
DECL|macro|cyber2000fb_writeb
mdefine_line|#define cyber2000fb_writeb(val,reg,cfb)&t;writeb(val, (cfb)-&gt;regs + (reg))
DECL|macro|cyber2000fb_readb
mdefine_line|#define cyber2000fb_readb(reg,cfb)&t;readb((cfb)-&gt;regs + (reg))
r_static
r_inline
r_void
DECL|function|cyber2000_crtcw
id|cyber2000_crtcw
c_func
(paren
r_int
r_int
id|reg
comma
r_int
r_int
id|val
comma
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyber2000fb_writew
c_func
(paren
(paren
id|reg
op_amp
l_int|255
)paren
op_or
id|val
op_lshift
l_int|8
comma
l_int|0x3d4
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|cyber2000_grphw
id|cyber2000_grphw
c_func
(paren
r_int
r_int
id|reg
comma
r_int
r_int
id|val
comma
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyber2000fb_writew
c_func
(paren
(paren
id|reg
op_amp
l_int|255
)paren
op_or
id|val
op_lshift
l_int|8
comma
l_int|0x3ce
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|cyber2000_grphr
id|cyber2000_grphr
c_func
(paren
r_int
r_int
id|reg
comma
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|reg
comma
l_int|0x3ce
comma
id|cfb
)paren
suffix:semicolon
r_return
id|cyber2000fb_readb
c_func
(paren
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|cyber2000_attrw
id|cyber2000_attrw
c_func
(paren
r_int
r_int
id|reg
comma
r_int
r_int
id|val
comma
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyber2000fb_readb
c_func
(paren
l_int|0x3da
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|reg
comma
l_int|0x3c0
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_readb
c_func
(paren
l_int|0x3c1
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|val
comma
l_int|0x3c0
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|cyber2000_seqw
id|cyber2000_seqw
c_func
(paren
r_int
r_int
id|reg
comma
r_int
r_int
id|val
comma
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyber2000fb_writew
c_func
(paren
(paren
id|reg
op_amp
l_int|255
)paren
op_or
id|val
op_lshift
l_int|8
comma
l_int|0x3c4
comma
id|cfb
)paren
suffix:semicolon
)brace
multiline_comment|/* -------------------- Hardware specific routines ------------------------- */
multiline_comment|/*&n; * Hardware Cyber2000 Acceleration&n; */
r_static
r_void
DECL|function|cyber2000fb_fillrect
id|cyber2000fb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_int
r_int
id|dst
comma
id|col
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfb-&gt;fb.var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
)paren
(brace
id|cfb_fillrect
c_func
(paren
id|info
comma
id|rect
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
id|CO_REG_CONTROL
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|rect-&gt;width
op_minus
l_int|1
comma
id|CO_REG_PIXWIDTH
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|rect-&gt;height
op_minus
l_int|1
comma
id|CO_REG_PIXHEIGHT
comma
id|cfb
)paren
suffix:semicolon
id|col
op_assign
id|rect-&gt;color
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;fb.var.bits_per_pixel
OG
l_int|8
)paren
id|col
op_assign
(paren
(paren
id|u32
op_star
)paren
id|cfb-&gt;fb.pseudo_palette
)paren
(braket
id|col
)braket
suffix:semicolon
id|cyber2000fb_writel
c_func
(paren
id|col
comma
id|CO_REG_FGCOLOUR
comma
id|cfb
)paren
suffix:semicolon
id|dst
op_assign
id|rect-&gt;dx
op_plus
id|rect-&gt;dy
op_star
id|cfb-&gt;fb.var.xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;fb.var.bits_per_pixel
op_eq
l_int|24
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|dst
comma
id|CO_REG_X_PHASE
comma
id|cfb
)paren
suffix:semicolon
id|dst
op_mul_assign
l_int|3
suffix:semicolon
)brace
id|cyber2000fb_writel
c_func
(paren
id|dst
comma
id|CO_REG_DEST_PTR
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|CO_FG_MIX_SRC
comma
id|CO_REG_FGMIX
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|CO_CMD_L_PATTERN_FGCOL
comma
id|CO_REG_CMD_L
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|CO_CMD_H_BLITTER
comma
id|CO_REG_CMD_H
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|cyber2000fb_copyarea
id|cyber2000fb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|region
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_int
r_int
id|cmd
op_assign
id|CO_CMD_L_PATTERN_FGCOL
suffix:semicolon
r_int
r_int
id|src
comma
id|dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfb-&gt;fb.var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
)paren
(brace
id|cfb_copyarea
c_func
(paren
id|info
comma
id|region
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
id|CO_REG_CONTROL
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|region-&gt;width
op_minus
l_int|1
comma
id|CO_REG_PIXWIDTH
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|region-&gt;height
op_minus
l_int|1
comma
id|CO_REG_PIXHEIGHT
comma
id|cfb
)paren
suffix:semicolon
id|src
op_assign
id|region-&gt;sx
op_plus
id|region-&gt;sy
op_star
id|cfb-&gt;fb.var.xres_virtual
suffix:semicolon
id|dst
op_assign
id|region-&gt;dx
op_plus
id|region-&gt;dy
op_star
id|cfb-&gt;fb.var.xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;sx
OL
id|region-&gt;dx
)paren
(brace
id|src
op_add_assign
id|region-&gt;width
op_minus
l_int|1
suffix:semicolon
id|dst
op_add_assign
id|region-&gt;width
op_minus
l_int|1
suffix:semicolon
id|cmd
op_or_assign
id|CO_CMD_L_INC_LEFT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|region-&gt;sy
OL
id|region-&gt;dy
)paren
(brace
id|src
op_add_assign
(paren
id|region-&gt;height
op_minus
l_int|1
)paren
op_star
id|cfb-&gt;fb.var.xres_virtual
suffix:semicolon
id|dst
op_add_assign
(paren
id|region-&gt;height
op_minus
l_int|1
)paren
op_star
id|cfb-&gt;fb.var.xres_virtual
suffix:semicolon
id|cmd
op_or_assign
id|CO_CMD_L_INC_UP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cfb-&gt;fb.var.bits_per_pixel
op_eq
l_int|24
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|dst
comma
id|CO_REG_X_PHASE
comma
id|cfb
)paren
suffix:semicolon
id|src
op_mul_assign
l_int|3
suffix:semicolon
id|dst
op_mul_assign
l_int|3
suffix:semicolon
)brace
id|cyber2000fb_writel
c_func
(paren
id|src
comma
id|CO_REG_SRC1_PTR
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writel
c_func
(paren
id|dst
comma
id|CO_REG_DEST_PTR
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|CO_FG_MIX_SRC
comma
id|CO_REG_FGMIX
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|cmd
comma
id|CO_REG_CMD_L
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|CO_CMD_H_FGSRCMAP
op_or
id|CO_CMD_H_BLITTER
comma
id|CO_REG_CMD_H
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|cyber2000fb_imageblit
id|cyber2000fb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
(brace
singleline_comment|//&t;struct cfb_info *cfb = (struct cfb_info *)info;
singleline_comment|//&t;if (!(cfb-&gt;fb.var.accel_flags &amp; FB_ACCELF_TEXT)) {
id|cfb_imageblit
c_func
(paren
id|info
comma
id|image
)paren
suffix:semicolon
r_return
suffix:semicolon
singleline_comment|//&t;}
)brace
DECL|function|cyber2000fb_sync
r_static
r_int
id|cyber2000fb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_int
id|count
op_assign
l_int|100000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfb-&gt;fb.var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|cyber2000fb_readb
c_func
(paren
id|CO_REG_CONTROL
comma
id|cfb
)paren
op_amp
id|CO_CTRL_BUSY
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|count
op_decrement
)paren
(brace
id|debug_printf
c_func
(paren
l_string|&quot;accel_wait timed out&bslash;n&quot;
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
id|CO_REG_CONTROL
comma
id|cfb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ===========================================================================&n; */
DECL|function|convert_bitfield
r_static
r_inline
id|u32
id|convert_bitfield
c_func
(paren
id|u_int
id|val
comma
r_struct
id|fb_bitfield
op_star
id|bf
)paren
(brace
id|u_int
id|mask
op_assign
(paren
l_int|1
op_lshift
id|bf-&gt;length
)paren
op_minus
l_int|1
suffix:semicolon
r_return
(paren
id|val
op_rshift
(paren
l_int|16
op_minus
id|bf-&gt;length
)paren
op_amp
id|mask
)paren
op_lshift
id|bf-&gt;offset
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set a single color register. Return != 0 for invalid regno.&n; */
r_static
r_int
DECL|function|cyber2000fb_setcolreg
id|cyber2000fb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|cfb-&gt;fb.var
suffix:semicolon
id|u32
id|pseudo_val
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|cfb-&gt;fb.fix.visual
)paren
(brace
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Pseudocolour:&n;&t; *         8     8&n;&t; * pixel --/--+--/--&gt;  red lut  --&gt; red dac&n;&t; *            |  8&n;&t; *            +--/--&gt; green lut --&gt; green dac&n;&t; *            |  8&n;&t; *            +--/--&gt;  blue lut --&gt; blue dac&n;&t; */
r_case
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
r_if
c_cond
(paren
id|regno
op_ge
id|NR_PALETTE
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|regno
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|red
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|green
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|blue
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Direct colour:&n;&t; *          n     rl&n;&t; *  pixel --/--+--/--&gt;  red lut  --&gt; red dac&n;&t; *             |  gl&n;&t; *             +--/--&gt; green lut --&gt; green dac&n;&t; *             |  bl&n;&t; *             +--/--&gt;  blue lut --&gt; blue dac&n;&t; * n = bpp, rl = red length, gl = green length, bl = blue length&n;&t; */
r_case
id|FB_VISUAL_DIRECTCOLOR
suffix:colon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
l_int|6
op_logical_and
id|regno
OL
l_int|64
)paren
(brace
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|2
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * The 6 bits of the green component are applied&n;&t;&t;&t; * to the high 6 bits of the LUT.&n;&t;&t;&t; */
id|cyber2000fb_writeb
c_func
(paren
id|regno
op_lshift
l_int|2
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|cfb-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|red
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|green
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|cfb-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|blue
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|green
op_assign
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|3
)braket
dot
id|green
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;green.length
op_ge
l_int|5
op_logical_and
id|regno
OL
l_int|32
)paren
(brace
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|3
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|3
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|3
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * The 5 bits of each colour component are&n;&t;&t;&t; * applied to the high 5 bits of the LUT.&n;&t;&t;&t; */
id|cyber2000fb_writeb
c_func
(paren
id|regno
op_lshift
l_int|3
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|red
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|green
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|blue
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
l_int|4
op_logical_and
id|regno
OL
l_int|16
)paren
(brace
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|4
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|4
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|cfb-&gt;palette
(braket
id|regno
op_lshift
l_int|4
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * The 5 bits of each colour component are&n;&t;&t;&t; * applied to the high 5 bits of the LUT.&n;&t;&t;&t; */
id|cyber2000fb_writeb
c_func
(paren
id|regno
op_lshift
l_int|4
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|red
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|green
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|blue
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Since this is only used for the first 16 colours, we&n;&t;&t; * don&squot;t have to care about overflowing for regno &gt;= 32&n;&t;&t; */
id|pseudo_val
op_assign
id|regno
op_lshift
id|var-&gt;red.offset
op_or
id|regno
op_lshift
id|var-&gt;green.offset
op_or
id|regno
op_lshift
id|var-&gt;blue.offset
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/*&n;&t; * True colour:&n;&t; *          n     rl&n;&t; *  pixel --/--+--/--&gt; red dac&n;&t; *             |  gl&n;&t; *             +--/--&gt; green dac&n;&t; *             |  bl&n;&t; *             +--/--&gt; blue dac&n;&t; * n = bpp, rl = red length, gl = green length, bl = blue length&n;&t; */
r_case
id|FB_VISUAL_TRUECOLOR
suffix:colon
id|pseudo_val
op_assign
id|convert_bitfield
c_func
(paren
id|transp
op_xor
l_int|0xffff
comma
op_amp
id|var-&gt;transp
)paren
suffix:semicolon
id|pseudo_val
op_or_assign
id|convert_bitfield
c_func
(paren
id|red
comma
op_amp
id|var-&gt;red
)paren
suffix:semicolon
id|pseudo_val
op_or_assign
id|convert_bitfield
c_func
(paren
id|green
comma
op_amp
id|var-&gt;green
)paren
suffix:semicolon
id|pseudo_val
op_or_assign
id|convert_bitfield
c_func
(paren
id|blue
comma
op_amp
id|var-&gt;blue
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Now set our pseudo palette for the CFB16/24/32 drivers.&n;&t; */
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(paren
(paren
id|u32
op_star
)paren
id|cfb-&gt;fb.pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
id|pseudo_val
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|struct|par_info
r_struct
id|par_info
(brace
multiline_comment|/*&n;&t; * Hardware&n;&t; */
DECL|member|clock_mult
id|u_char
id|clock_mult
suffix:semicolon
DECL|member|clock_div
id|u_char
id|clock_div
suffix:semicolon
DECL|member|extseqmisc
id|u_char
id|extseqmisc
suffix:semicolon
DECL|member|co_pixfmt
id|u_char
id|co_pixfmt
suffix:semicolon
DECL|member|crtc_ofl
id|u_char
id|crtc_ofl
suffix:semicolon
DECL|member|crtc
id|u_char
id|crtc
(braket
l_int|19
)braket
suffix:semicolon
DECL|member|width
id|u_int
id|width
suffix:semicolon
DECL|member|pitch
id|u_int
id|pitch
suffix:semicolon
DECL|member|fetch
id|u_int
id|fetch
suffix:semicolon
multiline_comment|/*&n;&t; * Other&n;&t; */
DECL|member|ramdac
id|u_char
id|ramdac
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|crtc_idx
r_static
r_const
id|u_char
id|crtc_idx
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x10
comma
l_int|0x11
comma
l_int|0x12
comma
l_int|0x13
comma
l_int|0x14
comma
l_int|0x15
comma
l_int|0x16
comma
l_int|0x17
comma
l_int|0x18
)brace
suffix:semicolon
DECL|function|cyber2000fb_write_ramdac_ctrl
r_static
r_void
id|cyber2000fb_write_ramdac_ctrl
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|val
op_assign
id|cfb-&gt;ramdac_ctrl
op_or
id|cfb-&gt;ramdac_powerdown
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0x56
comma
l_int|0x3ce
comma
id|cfb
)paren
suffix:semicolon
id|i
op_assign
id|cyber2000fb_readb
c_func
(paren
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|i
op_or
l_int|4
comma
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|val
comma
l_int|0x3c6
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|i
comma
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
)brace
DECL|function|cyber2000fb_set_timing
r_static
r_void
id|cyber2000fb_set_timing
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
comma
r_struct
id|par_info
op_star
id|hw
)paren
(brace
id|u_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * Blank palette&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PALETTE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|i
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
)brace
id|cyber2000fb_writeb
c_func
(paren
l_int|0xef
comma
l_int|0x3c2
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_crtcw
c_func
(paren
l_int|0x11
comma
l_int|0x0b
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x11
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x00
comma
l_int|0x01
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x01
comma
l_int|0x01
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x02
comma
l_int|0x0f
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x03
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x04
comma
l_int|0x0e
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_seqw
c_func
(paren
l_int|0x00
comma
l_int|0x03
comma
id|cfb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|crtc_idx
)paren
suffix:semicolon
id|i
op_increment
)paren
id|cyber2000_crtcw
c_func
(paren
id|crtc_idx
(braket
id|i
)braket
comma
id|hw-&gt;crtc
(braket
id|i
)braket
comma
id|cfb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x0a
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
id|i
op_increment
)paren
id|cyber2000_crtcw
c_func
(paren
id|i
comma
l_int|0
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_CRT_VRTOFL
comma
id|hw-&gt;crtc_ofl
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x00
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x01
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x02
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x03
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x04
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x05
comma
l_int|0x60
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x06
comma
l_int|0x05
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x07
comma
l_int|0x0f
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x08
comma
l_int|0xff
comma
id|cfb
)paren
suffix:semicolon
multiline_comment|/* Attribute controller registers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|cyber2000_attrw
c_func
(paren
id|i
comma
id|i
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x10
comma
l_int|0x01
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x11
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x12
comma
l_int|0x0f
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x13
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_attrw
c_func
(paren
l_int|0x14
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
multiline_comment|/* PLL registers */
id|cyber2000_grphw
c_func
(paren
id|EXT_DCLK_MULT
comma
id|hw-&gt;clock_mult
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_DCLK_DIV
comma
id|hw-&gt;clock_div
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_MCLK_MULT
comma
id|cfb-&gt;mclk_mult
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_MCLK_DIV
comma
id|cfb-&gt;mclk_div
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x90
comma
l_int|0x01
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0xb9
comma
l_int|0x80
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0xb9
comma
l_int|0x00
comma
id|cfb
)paren
suffix:semicolon
id|cfb-&gt;ramdac_ctrl
op_assign
id|hw-&gt;ramdac
suffix:semicolon
id|cyber2000fb_write_ramdac_ctrl
c_func
(paren
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0x20
comma
l_int|0x3c0
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0xff
comma
l_int|0x3c6
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x14
comma
id|hw-&gt;fetch
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x15
comma
(paren
(paren
id|hw-&gt;fetch
op_rshift
l_int|8
)paren
op_amp
l_int|0x03
)paren
op_or
(paren
(paren
id|hw-&gt;pitch
op_rshift
l_int|4
)paren
op_amp
l_int|0x30
)paren
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_SEQ_MISC
comma
id|hw-&gt;extseqmisc
comma
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set up accelerator registers&n;&t; */
id|cyber2000fb_writew
c_func
(paren
id|hw-&gt;width
comma
id|CO_REG_SRC_WIDTH
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writew
c_func
(paren
id|hw-&gt;width
comma
id|CO_REG_DEST_WIDTH
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|hw-&gt;co_pixfmt
comma
id|CO_REG_PIXFMT
comma
id|cfb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|cyber2000fb_update_start
id|cyber2000fb_update_start
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u_int
id|base
op_assign
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
op_plus
id|var-&gt;xoffset
suffix:semicolon
id|base
op_mul_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
multiline_comment|/*&n;&t; * Convert to bytes and shift two extra bits because DAC&n;&t; * can only start on 4 byte aligned data.&n;&t; */
id|base
op_rshift_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|base
op_ge
l_int|1
op_lshift
l_int|20
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
l_int|0x10
comma
id|base
op_rshift
l_int|16
op_or
l_int|0x10
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_crtcw
c_func
(paren
l_int|0x0c
comma
id|base
op_rshift
l_int|8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_crtcw
c_func
(paren
l_int|0x0d
comma
id|base
comma
id|cfb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|cyber2000fb_decode_crtc
id|cyber2000fb_decode_crtc
c_func
(paren
r_struct
id|par_info
op_star
id|hw
comma
r_struct
id|cfb_info
op_star
id|cfb
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u_int
id|Htotal
comma
id|Hblankend
comma
id|Hsyncend
suffix:semicolon
id|u_int
id|Vtotal
comma
id|Vdispend
comma
id|Vblankstart
comma
id|Vblankend
comma
id|Vsyncstart
comma
id|Vsyncend
suffix:semicolon
DECL|macro|BIT
mdefine_line|#define BIT(v,b1,m,b2) (((v &gt;&gt; b1) &amp; m) &lt;&lt; b2)
id|hw-&gt;crtc
(braket
l_int|13
)braket
op_assign
id|hw-&gt;pitch
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|17
)braket
op_assign
l_int|0xe3
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|14
)braket
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
id|Htotal
op_assign
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
op_plus
id|var-&gt;left_margin
suffix:semicolon
r_if
c_cond
(paren
id|Htotal
OG
l_int|2080
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|0
)braket
op_assign
(paren
id|Htotal
op_rshift
l_int|3
)paren
op_minus
l_int|5
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|1
)braket
op_assign
(paren
id|var-&gt;xres
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|2
)braket
op_assign
id|var-&gt;xres
op_rshift
l_int|3
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|4
)braket
op_assign
(paren
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
)paren
op_rshift
l_int|3
suffix:semicolon
id|Hblankend
op_assign
(paren
id|Htotal
op_minus
l_int|4
op_star
l_int|8
)paren
op_rshift
l_int|3
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|3
)braket
op_assign
id|BIT
c_func
(paren
id|Hblankend
comma
l_int|0
comma
l_int|0x1f
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x01
comma
l_int|7
)paren
suffix:semicolon
id|Hsyncend
op_assign
(paren
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
)paren
op_rshift
l_int|3
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|5
)braket
op_assign
id|BIT
c_func
(paren
id|Hsyncend
comma
l_int|0
comma
l_int|0x1f
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
id|Hblankend
comma
l_int|5
comma
l_int|0x01
comma
l_int|7
)paren
suffix:semicolon
id|Vdispend
op_assign
id|var-&gt;yres
op_minus
l_int|1
suffix:semicolon
id|Vsyncstart
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|Vsyncend
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|Vtotal
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|Vtotal
OG
l_int|2047
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|Vblankstart
op_assign
id|var-&gt;yres
op_plus
l_int|6
suffix:semicolon
id|Vblankend
op_assign
id|Vtotal
op_minus
l_int|10
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|6
)braket
op_assign
id|Vtotal
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|7
)braket
op_assign
id|BIT
c_func
(paren
id|Vtotal
comma
l_int|8
comma
l_int|0x01
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
id|Vdispend
comma
l_int|8
comma
l_int|0x01
comma
l_int|1
)paren
op_or
id|BIT
c_func
(paren
id|Vsyncstart
comma
l_int|8
comma
l_int|0x01
comma
l_int|2
)paren
op_or
id|BIT
c_func
(paren
id|Vblankstart
comma
l_int|8
comma
l_int|0x01
comma
l_int|3
)paren
op_or
id|BIT
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x01
comma
l_int|4
)paren
op_or
id|BIT
c_func
(paren
id|Vtotal
comma
l_int|9
comma
l_int|0x01
comma
l_int|5
)paren
op_or
id|BIT
c_func
(paren
id|Vdispend
comma
l_int|9
comma
l_int|0x01
comma
l_int|6
)paren
op_or
id|BIT
c_func
(paren
id|Vsyncstart
comma
l_int|9
comma
l_int|0x01
comma
l_int|7
)paren
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|9
)braket
op_assign
id|BIT
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0x1f
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
id|Vblankstart
comma
l_int|9
comma
l_int|0x01
comma
l_int|5
)paren
op_or
id|BIT
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x01
comma
l_int|6
)paren
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|10
)braket
op_assign
id|Vsyncstart
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|11
)braket
op_assign
id|BIT
c_func
(paren
id|Vsyncend
comma
l_int|0
comma
l_int|0x0f
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x01
comma
l_int|7
)paren
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|12
)braket
op_assign
id|Vdispend
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|15
)braket
op_assign
id|Vblankstart
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|16
)braket
op_assign
id|Vblankend
suffix:semicolon
id|hw-&gt;crtc
(braket
l_int|18
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/*&n;&t; * overflow - graphics reg 0x11&n;&t; * 0=VTOTAL:10 1=VDEND:10 2=VRSTART:10 3=VBSTART:10&n;&t; * 4=LINECOMP:10 5-IVIDEO 6=FIXCNT&n;&t; */
id|hw-&gt;crtc_ofl
op_assign
id|BIT
c_func
(paren
id|Vtotal
comma
l_int|10
comma
l_int|0x01
comma
l_int|0
)paren
op_or
id|BIT
c_func
(paren
id|Vdispend
comma
l_int|10
comma
l_int|0x01
comma
l_int|1
)paren
op_or
id|BIT
c_func
(paren
id|Vsyncstart
comma
l_int|10
comma
l_int|0x01
comma
l_int|2
)paren
op_or
id|BIT
c_func
(paren
id|Vblankstart
comma
l_int|10
comma
l_int|0x01
comma
l_int|3
)paren
op_or
id|EXT_CRT_VRTOFL_LINECOMP10
suffix:semicolon
multiline_comment|/* woody: set the interlaced bit... */
multiline_comment|/* FIXME: what about doublescan? */
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
id|hw-&gt;crtc_ofl
op_or_assign
id|EXT_CRT_VRTOFL_INTERLACE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The following was discovered by a good monitor, bit twiddling, theorising&n; * and but mostly luck.  Strangely, it looks like everyone elses&squot; PLL!&n; *&n; * Clock registers:&n; *   fclock = fpll / div2&n; *   fpll   = fref * mult / div1&n; * where:&n; *   fref = 14.318MHz (69842ps)&n; *   mult = reg0xb0.7:0&n; *   div1 = (reg0xb1.5:0 + 1)&n; *   div2 =  2^(reg0xb1.7:6)&n; *   fpll should be between 115 and 260 MHz&n; *  (8696ps and 3846ps)&n; */
r_static
r_int
DECL|function|cyber2000fb_decode_clock
id|cyber2000fb_decode_clock
c_func
(paren
r_struct
id|par_info
op_star
id|hw
comma
r_struct
id|cfb_info
op_star
id|cfb
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u_long
id|pll_ps
op_assign
id|var-&gt;pixclock
suffix:semicolon
r_const
id|u_long
id|ref_ps
op_assign
id|cfb-&gt;ref_ps
suffix:semicolon
id|u_int
id|div2
comma
id|t_div1
comma
id|best_div1
comma
id|best_mult
suffix:semicolon
r_int
id|best_diff
suffix:semicolon
r_int
id|vco
suffix:semicolon
multiline_comment|/*&n;&t; * Step 1:&n;&t; *   find div2 such that 115MHz &lt; fpll &lt; 260MHz&n;&t; *   and 0 &lt;= div2 &lt; 4&n;&t; */
r_for
c_loop
(paren
id|div2
op_assign
l_int|0
suffix:semicolon
id|div2
OL
l_int|4
suffix:semicolon
id|div2
op_increment
)paren
(brace
id|u_long
id|new_pll
suffix:semicolon
id|new_pll
op_assign
id|pll_ps
op_div
id|cfb-&gt;divisors
(braket
id|div2
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|8696
OG
id|new_pll
op_logical_and
id|new_pll
OG
l_int|3846
)paren
(brace
id|pll_ps
op_assign
id|new_pll
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|div2
op_eq
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * Step 2:&n;&t; *  Given pll_ps and ref_ps, find:&n;&t; *    pll_ps * 0.995 &lt; pll_ps_calc &lt; pll_ps * 1.005&n;&t; *  where { 1 &lt; best_div1 &lt; 32, 1 &lt; best_mult &lt; 256 }&n;&t; *    pll_ps_calc = best_div1 / (ref_ps * best_mult)&n;&t; */
id|best_diff
op_assign
l_int|0x7fffffff
suffix:semicolon
id|best_mult
op_assign
l_int|32
suffix:semicolon
id|best_div1
op_assign
l_int|255
suffix:semicolon
r_for
c_loop
(paren
id|t_div1
op_assign
l_int|32
suffix:semicolon
id|t_div1
OG
l_int|1
suffix:semicolon
id|t_div1
op_sub_assign
l_int|1
)paren
(brace
id|u_int
id|rr
comma
id|t_mult
comma
id|t_pll_ps
suffix:semicolon
r_int
id|diff
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Find the multiplier for this divisor&n;&t;&t; */
id|rr
op_assign
id|ref_ps
op_star
id|t_div1
suffix:semicolon
id|t_mult
op_assign
(paren
id|rr
op_plus
id|pll_ps
op_div
l_int|2
)paren
op_div
id|pll_ps
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Is the multiplier within the correct range?&n;&t;&t; */
r_if
c_cond
(paren
id|t_mult
OG
l_int|256
op_logical_or
id|t_mult
OL
l_int|2
)paren
r_continue
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Calculate the actual clock period from this multiplier&n;&t;&t; * and divisor, and estimate the error.&n;&t;&t; */
id|t_pll_ps
op_assign
(paren
id|rr
op_plus
id|t_mult
op_div
l_int|2
)paren
op_div
id|t_mult
suffix:semicolon
id|diff
op_assign
id|pll_ps
op_minus
id|t_pll_ps
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
id|diff
op_assign
op_minus
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
id|best_diff
)paren
(brace
id|best_diff
op_assign
id|diff
suffix:semicolon
id|best_mult
op_assign
id|t_mult
suffix:semicolon
id|best_div1
op_assign
id|t_div1
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * If we hit an exact value, there is no point in continuing.&n;&t;&t; */
r_if
c_cond
(paren
id|diff
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Step 3:&n;&t; *  combine values&n;&t; */
id|hw-&gt;clock_mult
op_assign
id|best_mult
op_minus
l_int|1
suffix:semicolon
id|hw-&gt;clock_div
op_assign
id|div2
op_lshift
l_int|6
op_or
(paren
id|best_div1
op_minus
l_int|1
)paren
suffix:semicolon
id|vco
op_assign
id|ref_ps
op_star
id|best_div1
op_div
id|best_mult
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ref_ps
op_eq
l_int|40690
)paren
op_logical_and
(paren
id|vco
OL
l_int|5556
)paren
)paren
multiline_comment|/* Set VFSEL when VCO &gt; 180MHz (5.556 ps). */
id|hw-&gt;clock_div
op_or_assign
id|EXT_DCLK_DIV_VFSEL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set the User Defined Part of the Display&n; */
r_static
r_int
DECL|function|cyber2000fb_check_var
id|cyber2000fb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|par_info
id|hw
suffix:semicolon
r_int
r_int
id|mem
suffix:semicolon
r_int
id|err
suffix:semicolon
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.msb_right
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
multiline_comment|/* PSEUDOCOLOUR, 256 */
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
multiline_comment|/* DIRECTCOLOUR, 64k or 32k */
r_switch
c_cond
(paren
id|var-&gt;green.length
)paren
(brace
r_case
l_int|6
suffix:colon
multiline_comment|/* RGB565, 64k */
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
l_int|5
suffix:colon
multiline_comment|/* RGB555, 32k */
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* RGB444, 4k + transparency? */
id|var-&gt;transp.offset
op_assign
l_int|12
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|4
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
multiline_comment|/* TRUECOLOUR, 16m */
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
multiline_comment|/* TRUECOLOUR, 16m */
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mem
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;yres_virtual
op_star
(paren
id|var-&gt;bits_per_pixel
op_div
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
OG
id|cfb-&gt;fb.fix.smem_len
)paren
id|var-&gt;yres_virtual
op_assign
id|cfb-&gt;fb.fix.smem_len
op_star
l_int|8
op_div
(paren
id|var-&gt;bits_per_pixel
op_star
id|var-&gt;xres_virtual
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres
OG
id|var-&gt;xres_virtual
)paren
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|err
op_assign
id|cyber2000fb_decode_clock
c_func
(paren
op_amp
id|hw
comma
id|cfb
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|cyber2000fb_decode_crtc
c_func
(paren
op_amp
id|hw
comma
id|cfb
comma
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cyber2000fb_set_par
r_static
r_int
id|cyber2000fb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|cfb-&gt;fb.var
suffix:semicolon
r_struct
id|par_info
id|hw
suffix:semicolon
r_int
r_int
id|mem
suffix:semicolon
id|hw.width
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|hw.ramdac
op_assign
id|RAMDAC_VREFEN
op_or
id|RAMDAC_DAC8BIT
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|hw.co_pixfmt
op_assign
id|CO_PIXFMT_8BPP
suffix:semicolon
id|hw.pitch
op_assign
id|hw.width
op_rshift
l_int|3
suffix:semicolon
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|hw.co_pixfmt
op_assign
id|CO_PIXFMT_16BPP
suffix:semicolon
id|hw.pitch
op_assign
id|hw.width
op_rshift
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;green.length
)paren
(brace
r_case
l_int|6
suffix:colon
multiline_comment|/* RGB565, 64k */
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_16_RGB565
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* RGB555, 32k */
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_16_RGB555
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* RGB444, 4k + transparency? */
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_16_RGB444
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_case
l_int|24
suffix:colon
multiline_comment|/* TRUECOLOUR, 16m */
id|hw.co_pixfmt
op_assign
id|CO_PIXFMT_24BPP
suffix:semicolon
id|hw.width
op_mul_assign
l_int|3
suffix:semicolon
id|hw.pitch
op_assign
id|hw.width
op_rshift
l_int|3
suffix:semicolon
id|hw.ramdac
op_or_assign
(paren
id|RAMDAC_BYPASS
op_or
id|RAMDAC_RAMPWRDN
)paren
suffix:semicolon
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_24_RGB888
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
multiline_comment|/* TRUECOLOUR, 16m */
id|hw.co_pixfmt
op_assign
id|CO_PIXFMT_32BPP
suffix:semicolon
id|hw.pitch
op_assign
id|hw.width
op_rshift
l_int|1
suffix:semicolon
id|hw.ramdac
op_or_assign
(paren
id|RAMDAC_BYPASS
op_or
id|RAMDAC_RAMPWRDN
)paren
suffix:semicolon
id|hw.extseqmisc
op_assign
id|EXT_SEQ_MISC_32
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Sigh, this is absolutely disgusting, but caused by&n;&t; * the way the fbcon developers want to separate out&n;&t; * the &quot;checking&quot; and the &quot;setting&quot; of the video mode.&n;&t; *&n;&t; * If the mode is not suitable for the hardware here,&n;&t; * we can&squot;t prevent it being set by returning an error.&n;&t; *&n;&t; * In theory, since NetWinders contain just one VGA card,&n;&t; * we should never end up hitting this problem.&n;&t; */
id|BUG_ON
c_func
(paren
id|cyber2000fb_decode_clock
c_func
(paren
op_amp
id|hw
comma
id|cfb
comma
id|var
)paren
op_ne
l_int|0
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|cyber2000fb_decode_crtc
c_func
(paren
op_amp
id|hw
comma
id|cfb
comma
id|var
)paren
op_ne
l_int|0
)paren
suffix:semicolon
id|hw.width
op_sub_assign
l_int|1
suffix:semicolon
id|hw.fetch
op_assign
id|hw.pitch
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfb-&gt;mem_ctl2
op_amp
id|MEM_CTL2_64BIT
)paren
)paren
id|hw.fetch
op_lshift_assign
l_int|1
suffix:semicolon
id|hw.fetch
op_add_assign
l_int|1
suffix:semicolon
id|cfb-&gt;fb.fix.line_length
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
suffix:semicolon
multiline_comment|/*&n;&t; * Same here - if the size of the video mode exceeds the&n;&t; * available RAM, we can&squot;t prevent this mode being set.&n;&t; *&n;&t; * In theory, since NetWinders contain just one VGA card,&n;&t; * we should never end up hitting this problem.&n;&t; */
id|mem
op_assign
id|cfb-&gt;fb.fix.line_length
op_star
id|var-&gt;yres_virtual
suffix:semicolon
id|BUG_ON
c_func
(paren
id|mem
OG
id|cfb-&gt;fb.fix.smem_len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * 8bpp displays are always pseudo colour.  16bpp and above&n;&t; * are direct colour or true colour, depending on whether&n;&t; * the RAMDAC palettes are bypassed.  (Direct colour has&n;&t; * palettes, true colour does not.)&n;&t; */
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|8
)paren
id|cfb-&gt;fb.fix.visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hw.ramdac
op_amp
id|RAMDAC_BYPASS
)paren
id|cfb-&gt;fb.fix.visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
r_else
id|cfb-&gt;fb.fix.visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|cyber2000fb_set_timing
c_func
(paren
id|cfb
comma
op_amp
id|hw
)paren
suffix:semicolon
id|cyber2000fb_update_start
c_func
(paren
id|cfb
comma
id|var
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Pan or Wrap the Display&n; */
r_static
r_int
DECL|function|cyber2000fb_pan_display
id|cyber2000fb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|cyber2000fb_update_start
c_func
(paren
id|cfb
comma
id|var
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cfb-&gt;fb.var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|cfb-&gt;fb.var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
id|cfb-&gt;fb.var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
)brace
r_else
(brace
id|cfb-&gt;fb.var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    (Un)Blank the display.&n; *&n; *  Blank the screen if blank_mode != 0, else unblank. If&n; *  blank == NULL then the caller blanks by setting the CLUT&n; *  (Color Look Up Table) to all black. Return 0 if blanking&n; *  succeeded, != 0 if un-/blanking failed due to e.g. a&n; *  video mode which doesn&squot;t support it. Implements VESA&n; *  suspend and powerdown modes on hardware that supports&n; *  disabling hsync/vsync:&n; *    blank_mode == 2: suspend vsync&n; *    blank_mode == 3: suspend hsync&n; *    blank_mode == 4: powerdown&n; *&n; *  wms...Enable VESA DMPS compatible powerdown mode&n; *  run &quot;setterm -powersave powerdown&quot; to take advantage&n; */
DECL|function|cyber2000fb_blank
r_static
r_int
id|cyber2000fb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
(paren
r_struct
id|cfb_info
op_star
)paren
id|info
suffix:semicolon
r_int
r_int
id|sync
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|4
suffix:colon
multiline_comment|/* powerdown - both sync lines down */
id|sync
op_assign
id|EXT_SYNC_CTL_VS_0
op_or
id|EXT_SYNC_CTL_HS_0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* hsync off */
id|sync
op_assign
id|EXT_SYNC_CTL_VS_NORMAL
op_or
id|EXT_SYNC_CTL_HS_0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* vsync off */
id|sync
op_assign
id|EXT_SYNC_CTL_VS_0
op_or
id|EXT_SYNC_CTL_HS_NORMAL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* soft blank */
r_default
suffix:colon
multiline_comment|/* unblank */
r_break
suffix:semicolon
)brace
id|cyber2000_grphw
c_func
(paren
id|EXT_SYNC_CTL
comma
id|sync
comma
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
op_le
l_int|1
)paren
(brace
multiline_comment|/* turn on ramdacs */
id|cfb-&gt;ramdac_powerdown
op_and_assign
op_complement
(paren
id|RAMDAC_DACPWRDN
op_or
id|RAMDAC_BYPASS
op_or
id|RAMDAC_RAMPWRDN
)paren
suffix:semicolon
id|cyber2000fb_write_ramdac_ctrl
c_func
(paren
id|cfb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Soft blank/unblank the display.&n;&t; */
r_if
c_cond
(paren
id|blank
)paren
(brace
multiline_comment|/* soft blank */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PALETTE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|i
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* unblank */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PALETTE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cyber2000fb_writeb
c_func
(paren
id|i
comma
l_int|0x3c8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|cfb-&gt;palette
(braket
id|i
)braket
dot
id|red
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|cfb-&gt;palette
(braket
id|i
)braket
dot
id|green
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|cfb-&gt;palette
(braket
id|i
)braket
dot
id|blue
comma
l_int|0x3c9
comma
id|cfb
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|blank
op_ge
l_int|2
)paren
(brace
multiline_comment|/* turn off ramdacs */
id|cfb-&gt;ramdac_powerdown
op_or_assign
id|RAMDAC_DACPWRDN
op_or
id|RAMDAC_BYPASS
op_or
id|RAMDAC_RAMPWRDN
suffix:semicolon
id|cyber2000fb_write_ramdac_ctrl
c_func
(paren
id|cfb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cyber2000fb_ops
r_static
r_struct
id|fb_ops
id|cyber2000fb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_check_var
op_assign
id|cyber2000fb_check_var
comma
dot
id|fb_set_par
op_assign
id|cyber2000fb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|cyber2000fb_setcolreg
comma
dot
id|fb_blank
op_assign
id|cyber2000fb_blank
comma
dot
id|fb_pan_display
op_assign
id|cyber2000fb_pan_display
comma
dot
id|fb_fillrect
op_assign
id|cyber2000fb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cyber2000fb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cyber2000fb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
dot
id|fb_sync
op_assign
id|cyber2000fb_sync
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * This is the only &quot;static&quot; reference to the internal data structures&n; * of this driver.  It is here solely at the moment to support the other&n; * CyberPro modules external to this driver.&n; */
DECL|variable|int_cfb_info
r_static
r_struct
id|cfb_info
op_star
id|int_cfb_info
suffix:semicolon
multiline_comment|/*&n; * Enable access to the extended registers&n; */
DECL|function|cyber2000fb_enable_extregs
r_void
id|cyber2000fb_enable_extregs
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cfb-&gt;func_use_count
op_add_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;func_use_count
op_eq
l_int|1
)paren
(brace
r_int
id|old
suffix:semicolon
id|old
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_FUNC_CTL
comma
id|cfb
)paren
suffix:semicolon
id|old
op_or_assign
id|EXT_FUNC_CTL_EXTREGENBL
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_FUNC_CTL
comma
id|old
comma
id|cfb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Disable access to the extended registers&n; */
DECL|function|cyber2000fb_disable_extregs
r_void
id|cyber2000fb_disable_extregs
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
r_if
c_cond
(paren
id|cfb-&gt;func_use_count
op_eq
l_int|1
)paren
(brace
r_int
id|old
suffix:semicolon
id|old
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_FUNC_CTL
comma
id|cfb
)paren
suffix:semicolon
id|old
op_and_assign
op_complement
id|EXT_FUNC_CTL_EXTREGENBL
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_FUNC_CTL
comma
id|old
comma
id|cfb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cfb-&gt;func_use_count
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;disable_extregs: count = 0&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|cfb-&gt;func_use_count
op_sub_assign
l_int|1
suffix:semicolon
)brace
DECL|function|cyber2000fb_get_fb_var
r_void
id|cyber2000fb_get_fb_var
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|cfb-&gt;fb.var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Attach a capture/tv driver to the core CyberX0X0 driver.&n; */
DECL|function|cyber2000fb_attach
r_int
id|cyber2000fb_attach
c_func
(paren
r_struct
id|cyberpro_info
op_star
id|info
comma
r_int
id|idx
)paren
(brace
r_if
c_cond
(paren
id|int_cfb_info
op_ne
l_int|NULL
)paren
(brace
id|info-&gt;dev
op_assign
id|int_cfb_info-&gt;dev
suffix:semicolon
id|info-&gt;regs
op_assign
id|int_cfb_info-&gt;regs
suffix:semicolon
id|info-&gt;fb
op_assign
id|int_cfb_info-&gt;fb.screen_base
suffix:semicolon
id|info-&gt;fb_size
op_assign
id|int_cfb_info-&gt;fb.fix.smem_len
suffix:semicolon
id|info-&gt;enable_extregs
op_assign
id|cyber2000fb_enable_extregs
suffix:semicolon
id|info-&gt;disable_extregs
op_assign
id|cyber2000fb_disable_extregs
suffix:semicolon
id|info-&gt;info
op_assign
id|int_cfb_info
suffix:semicolon
id|strlcpy
c_func
(paren
id|info-&gt;dev_name
comma
id|int_cfb_info-&gt;fb.fix.id
comma
r_sizeof
(paren
id|info-&gt;dev_name
)paren
)paren
suffix:semicolon
)brace
r_return
id|int_cfb_info
op_ne
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Detach a capture/tv driver from the core CyberX0X0 driver.&n; */
DECL|function|cyber2000fb_detach
r_void
id|cyber2000fb_detach
c_func
(paren
r_int
id|idx
)paren
(brace
)brace
DECL|variable|cyber2000fb_attach
id|EXPORT_SYMBOL
c_func
(paren
id|cyber2000fb_attach
)paren
suffix:semicolon
DECL|variable|cyber2000fb_detach
id|EXPORT_SYMBOL
c_func
(paren
id|cyber2000fb_detach
)paren
suffix:semicolon
DECL|variable|cyber2000fb_enable_extregs
id|EXPORT_SYMBOL
c_func
(paren
id|cyber2000fb_enable_extregs
)paren
suffix:semicolon
DECL|variable|cyber2000fb_disable_extregs
id|EXPORT_SYMBOL
c_func
(paren
id|cyber2000fb_disable_extregs
)paren
suffix:semicolon
DECL|variable|cyber2000fb_get_fb_var
id|EXPORT_SYMBOL
c_func
(paren
id|cyber2000fb_get_fb_var
)paren
suffix:semicolon
multiline_comment|/*&n; * These parameters give&n; * 640x480, hsync 31.5kHz, vsync 60Hz&n; */
DECL|variable|cyber2000fb_default_mode
r_static
r_struct
id|fb_videomode
id|__devinitdata
id|cyber2000fb_default_mode
op_assign
(brace
dot
id|refresh
op_assign
l_int|60
comma
dot
id|xres
op_assign
l_int|640
comma
dot
id|yres
op_assign
l_int|480
comma
dot
id|pixclock
op_assign
l_int|39722
comma
dot
id|left_margin
op_assign
l_int|56
comma
dot
id|right_margin
op_assign
l_int|16
comma
dot
id|upper_margin
op_assign
l_int|34
comma
dot
id|lower_margin
op_assign
l_int|9
comma
dot
id|hsync_len
op_assign
l_int|88
comma
dot
id|vsync_len
op_assign
l_int|2
comma
dot
id|sync
op_assign
id|FB_SYNC_COMP_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
DECL|variable|igs_regs
r_static
r_char
id|igs_regs
(braket
)braket
op_assign
(brace
id|EXT_CRT_IRQ
comma
l_int|0
comma
id|EXT_CRT_TEST
comma
l_int|0
comma
id|EXT_SYNC_CTL
comma
l_int|0
comma
id|EXT_SEG_WRITE_PTR
comma
l_int|0
comma
id|EXT_SEG_READ_PTR
comma
l_int|0
comma
id|EXT_BIU_MISC
comma
id|EXT_BIU_MISC_LIN_ENABLE
op_or
id|EXT_BIU_MISC_COP_ENABLE
op_or
id|EXT_BIU_MISC_COP_BFC
comma
id|EXT_FUNC_CTL
comma
l_int|0
comma
id|CURS_H_START
comma
l_int|0
comma
id|CURS_H_START
op_plus
l_int|1
comma
l_int|0
comma
id|CURS_H_PRESET
comma
l_int|0
comma
id|CURS_V_START
comma
l_int|0
comma
id|CURS_V_START
op_plus
l_int|1
comma
l_int|0
comma
id|CURS_V_PRESET
comma
l_int|0
comma
id|CURS_CTL
comma
l_int|0
comma
id|EXT_ATTRIB_CTL
comma
id|EXT_ATTRIB_CTL_EXT
comma
id|EXT_OVERSCAN_RED
comma
l_int|0
comma
id|EXT_OVERSCAN_GREEN
comma
l_int|0
comma
id|EXT_OVERSCAN_BLUE
comma
l_int|0
comma
multiline_comment|/* some of these are questionable when we have a BIOS */
id|EXT_MEM_CTL0
comma
id|EXT_MEM_CTL0_7CLK
op_or
id|EXT_MEM_CTL0_RAS_1
op_or
id|EXT_MEM_CTL0_MULTCAS
comma
id|EXT_HIDDEN_CTL1
comma
l_int|0x30
comma
id|EXT_FIFO_CTL
comma
l_int|0x0b
comma
id|EXT_FIFO_CTL
op_plus
l_int|1
comma
l_int|0x17
comma
l_int|0x76
comma
l_int|0x00
comma
id|EXT_HIDDEN_CTL4
comma
l_int|0xc8
)brace
suffix:semicolon
multiline_comment|/*&n; * Initialise the CyberPro hardware.  On the CyberPro5XXXX,&n; * ensure that we&squot;re using the correct PLL (5XXX&squot;s may be&n; * programmed to use an additional set of PLLs.)&n; */
DECL|function|cyberpro_init_hw
r_static
r_void
id|cyberpro_init_hw
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|igs_regs
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|cyber2000_grphw
c_func
(paren
id|igs_regs
(braket
id|i
)braket
comma
id|igs_regs
(braket
id|i
op_plus
l_int|1
)braket
comma
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;id
op_eq
id|ID_CYBERPRO_5000
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0xba
comma
l_int|0x3ce
comma
id|cfb
)paren
suffix:semicolon
id|val
op_assign
id|cyber2000fb_readb
c_func
(paren
l_int|0x3cf
comma
id|cfb
)paren
op_amp
l_int|0x80
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|val
comma
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
id|cfb_info
op_star
id|__devinit
DECL|function|cyberpro_alloc_fb_info
id|cyberpro_alloc_fb_info
c_func
(paren
r_int
r_int
id|id
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
suffix:semicolon
id|cfb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cfb_info
)paren
op_plus
r_sizeof
(paren
id|u32
)paren
op_star
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfb
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|cfb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cfb_info
)paren
)paren
suffix:semicolon
id|cfb-&gt;id
op_assign
id|id
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|ID_CYBERPRO_5000
)paren
id|cfb-&gt;ref_ps
op_assign
l_int|40690
suffix:semicolon
singleline_comment|// 24.576 MHz
r_else
id|cfb-&gt;ref_ps
op_assign
l_int|69842
suffix:semicolon
singleline_comment|// 14.31818 MHz (69841?)
id|cfb-&gt;divisors
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|cfb-&gt;divisors
(braket
l_int|1
)braket
op_assign
l_int|2
suffix:semicolon
id|cfb-&gt;divisors
(braket
l_int|2
)braket
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|ID_CYBERPRO_2000
)paren
id|cfb-&gt;divisors
(braket
l_int|3
)braket
op_assign
l_int|8
suffix:semicolon
r_else
id|cfb-&gt;divisors
(braket
l_int|3
)braket
op_assign
l_int|6
suffix:semicolon
id|strcpy
c_func
(paren
id|cfb-&gt;fb.fix.id
comma
id|name
)paren
suffix:semicolon
id|cfb-&gt;fb.fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|cfb-&gt;fb.fix.type_aux
op_assign
l_int|0
suffix:semicolon
id|cfb-&gt;fb.fix.xpanstep
op_assign
l_int|0
suffix:semicolon
id|cfb-&gt;fb.fix.ypanstep
op_assign
l_int|1
suffix:semicolon
id|cfb-&gt;fb.fix.ywrapstep
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|ID_IGA_1682
suffix:colon
id|cfb-&gt;fb.fix.accel
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ID_CYBERPRO_2000
suffix:colon
id|cfb-&gt;fb.fix.accel
op_assign
id|FB_ACCEL_IGS_CYBER2000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ID_CYBERPRO_2010
suffix:colon
id|cfb-&gt;fb.fix.accel
op_assign
id|FB_ACCEL_IGS_CYBER2010
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ID_CYBERPRO_5000
suffix:colon
id|cfb-&gt;fb.fix.accel
op_assign
id|FB_ACCEL_IGS_CYBER5000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cfb-&gt;fb.var.nonstd
op_assign
l_int|0
suffix:semicolon
id|cfb-&gt;fb.var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|cfb-&gt;fb.var.height
op_assign
op_minus
l_int|1
suffix:semicolon
id|cfb-&gt;fb.var.width
op_assign
op_minus
l_int|1
suffix:semicolon
id|cfb-&gt;fb.var.accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|cfb-&gt;fb.fbops
op_assign
op_amp
id|cyber2000fb_ops
suffix:semicolon
id|cfb-&gt;fb.flags
op_assign
id|FBINFO_DEFAULT
op_or
id|FBINFO_HWACCEL_YPAN
suffix:semicolon
id|cfb-&gt;fb.pseudo_palette
op_assign
(paren
r_void
op_star
)paren
(paren
id|cfb
op_plus
l_int|1
)paren
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|cfb-&gt;fb.cmap
comma
id|NR_PALETTE
comma
l_int|0
)paren
suffix:semicolon
r_return
id|cfb
suffix:semicolon
)brace
r_static
r_void
DECL|function|cyberpro_free_fb_info
id|cyberpro_free_fb_info
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
r_if
c_cond
(paren
id|cfb
)paren
(brace
multiline_comment|/*&n;&t;&t; * Free the colourmap&n;&t;&t; */
id|fb_alloc_cmap
c_func
(paren
op_amp
id|cfb-&gt;fb.cmap
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cfb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Parse Cyber2000fb options.  Usage:&n; *  video=cyber2000:font:fontname&n; */
r_int
DECL|function|cyber2000fb_setup
id|cyber2000fb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
(brace
id|strlcpy
c_func
(paren
id|default_font_storage
comma
id|opt
op_plus
l_int|5
comma
r_sizeof
(paren
id|default_font_storage
)paren
)paren
suffix:semicolon
id|default_font
op_assign
id|default_font_storage
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;CyberPro20x0: unknown parameter: %s&bslash;n&quot;
comma
id|opt
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The CyberPro chips can be placed on many different bus types.&n; * This probe function is common to all bus types.  The bus-specific&n; * probe function is expected to have:&n; *  - enabled access to the linear memory region&n; *  - memory mapped access to the registers&n; *  - initialised mem_ctl1 and mem_ctl2 appropriately.&n; */
DECL|function|cyberpro_common_probe
r_static
r_int
id|__devinit
id|cyberpro_common_probe
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|u_long
id|smem_size
suffix:semicolon
id|u_int
id|h_sync
comma
id|v_sync
suffix:semicolon
r_int
id|err
suffix:semicolon
id|cyberpro_init_hw
c_func
(paren
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get the video RAM size and width from the VGA register.&n;&t; * This should have been already initialised by the BIOS,&n;&t; * but if it&squot;s garbage, claim default 1MB VRAM (woody)&n;&t; */
id|cfb-&gt;mem_ctl1
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_MEM_CTL1
comma
id|cfb
)paren
suffix:semicolon
id|cfb-&gt;mem_ctl2
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_MEM_CTL2
comma
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Determine the size of the memory.&n;&t; */
r_switch
c_cond
(paren
id|cfb-&gt;mem_ctl2
op_amp
id|MEM_CTL2_SIZE_MASK
)paren
(brace
r_case
id|MEM_CTL2_SIZE_4MB
suffix:colon
id|smem_size
op_assign
l_int|0x00400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_CTL2_SIZE_2MB
suffix:colon
id|smem_size
op_assign
l_int|0x00200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_CTL2_SIZE_1MB
suffix:colon
id|smem_size
op_assign
l_int|0x00100000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|smem_size
op_assign
l_int|0x00100000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cfb-&gt;fb.fix.smem_len
op_assign
id|smem_size
suffix:semicolon
id|cfb-&gt;fb.fix.mmio_len
op_assign
id|MMIO_SIZE
suffix:semicolon
id|cfb-&gt;fb.screen_base
op_assign
id|cfb-&gt;region
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_find_mode
c_func
(paren
op_amp
id|cfb-&gt;fb.var
comma
op_amp
id|cfb-&gt;fb
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|cyber2000fb_default_mode
comma
l_int|8
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no valid mode found&bslash;n&quot;
comma
id|cfb-&gt;fb.fix.id
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|cfb-&gt;fb.var.yres_virtual
op_assign
id|cfb-&gt;fb.fix.smem_len
op_star
l_int|8
op_div
(paren
id|cfb-&gt;fb.var.bits_per_pixel
op_star
id|cfb-&gt;fb.var.xres_virtual
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;fb.var.yres_virtual
OL
id|cfb-&gt;fb.var.yres
)paren
id|cfb-&gt;fb.var.yres_virtual
op_assign
id|cfb-&gt;fb.var.yres
suffix:semicolon
singleline_comment|//&t;fb_set_var(&amp;cfb-&gt;fb.var, -1, &amp;cfb-&gt;fb);
multiline_comment|/*&n;&t; * Calculate the hsync and vsync frequencies.  Note that&n;&t; * we split the 1e12 constant up so that we can preserve&n;&t; * the precision and fit the results into 32-bit registers.&n;&t; *  (1953125000 * 512 = 1e12)&n;&t; */
id|h_sync
op_assign
l_int|1953125000
op_div
id|cfb-&gt;fb.var.pixclock
suffix:semicolon
id|h_sync
op_assign
id|h_sync
op_star
l_int|512
op_div
(paren
id|cfb-&gt;fb.var.xres
op_plus
id|cfb-&gt;fb.var.left_margin
op_plus
id|cfb-&gt;fb.var.right_margin
op_plus
id|cfb-&gt;fb.var.hsync_len
)paren
suffix:semicolon
id|v_sync
op_assign
id|h_sync
op_div
(paren
id|cfb-&gt;fb.var.yres
op_plus
id|cfb-&gt;fb.var.upper_margin
op_plus
id|cfb-&gt;fb.var.lower_margin
op_plus
id|cfb-&gt;fb.var.vsync_len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %dKiB VRAM, using %dx%d, %d.%03dkHz, %dHz&bslash;n&quot;
comma
id|cfb-&gt;fb.fix.id
comma
id|cfb-&gt;fb.fix.smem_len
op_rshift
l_int|10
comma
id|cfb-&gt;fb.var.xres
comma
id|cfb-&gt;fb.var.yres
comma
id|h_sync
op_div
l_int|1000
comma
id|h_sync
op_mod
l_int|1000
comma
id|v_sync
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;dev
)paren
id|cfb-&gt;fb.device
op_assign
op_amp
id|cfb-&gt;dev-&gt;dev
suffix:semicolon
id|err
op_assign
id|register_framebuffer
c_func
(paren
op_amp
id|cfb-&gt;fb
)paren
suffix:semicolon
id|failed
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|cyberpro_common_resume
r_static
r_void
id|cyberpro_common_resume
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
id|cyberpro_init_hw
c_func
(paren
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Reprogram the MEM_CTL1 and MEM_CTL2 registers&n;&t; */
id|cyber2000_grphw
c_func
(paren
id|EXT_MEM_CTL1
comma
id|cfb-&gt;mem_ctl1
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_MEM_CTL2
comma
id|cfb-&gt;mem_ctl2
comma
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Restore the old video mode and the palette.&n;&t; * We also need to tell fbcon to redraw the console.&n;&t; */
id|cyber2000fb_set_par
c_func
(paren
op_amp
id|cfb-&gt;fb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ARCH_SHARK
macro_line|#include &lt;asm/arch/hardware.h&gt;
r_static
r_int
id|__devinit
DECL|function|cyberpro_vl_probe
id|cyberpro_vl_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|FB_START
comma
id|FB_SIZE
comma
l_string|&quot;CyberPro2010&quot;
)paren
)paren
r_return
id|err
suffix:semicolon
id|cfb
op_assign
id|cyberpro_alloc_fb_info
c_func
(paren
id|ID_CYBERPRO_2010
comma
l_string|&quot;CyberPro2010&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfb
)paren
r_goto
id|failed_release
suffix:semicolon
id|cfb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|cfb-&gt;region
op_assign
id|ioremap
c_func
(paren
id|FB_START
comma
id|FB_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfb-&gt;region
)paren
r_goto
id|failed_ioremap
suffix:semicolon
id|cfb-&gt;regs
op_assign
id|cfb-&gt;region
op_plus
id|MMIO_OFFSET
suffix:semicolon
id|cfb-&gt;fb.fix.mmio_start
op_assign
id|FB_START
op_plus
id|MMIO_OFFSET
suffix:semicolon
id|cfb-&gt;fb.fix.smem_start
op_assign
id|FB_START
suffix:semicolon
multiline_comment|/*&n;&t; * Bring up the hardware.  This is expected to enable access&n;&t; * to the linear memory region, and allow access to the memory&n;&t; * mapped registers.  Also, mem_ctl1 and mem_ctl2 must be&n;&t; * initialised.&n;&t; */
id|cyber2000fb_writeb
c_func
(paren
l_int|0x18
comma
l_int|0x46e8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0x01
comma
l_int|0x102
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
l_int|0x08
comma
l_int|0x46e8
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|EXT_BIU_MISC
comma
l_int|0x3ce
comma
id|cfb
)paren
suffix:semicolon
id|cyber2000fb_writeb
c_func
(paren
id|EXT_BIU_MISC_LIN_ENABLE
comma
l_int|0x3cf
comma
id|cfb
)paren
suffix:semicolon
id|cfb-&gt;mclk_mult
op_assign
l_int|0xdb
suffix:semicolon
id|cfb-&gt;mclk_div
op_assign
l_int|0x54
suffix:semicolon
id|err
op_assign
id|cyberpro_common_probe
c_func
(paren
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed
suffix:semicolon
r_if
c_cond
(paren
id|int_cfb_info
op_eq
l_int|NULL
)paren
id|int_cfb_info
op_assign
id|cfb
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
id|iounmap
c_func
(paren
id|cfb-&gt;region
)paren
suffix:semicolon
id|failed_ioremap
suffix:colon
id|cyberpro_free_fb_info
c_func
(paren
id|cfb
)paren
suffix:semicolon
id|failed_release
suffix:colon
id|release_mem_region
c_func
(paren
id|FB_START
comma
id|FB_SIZE
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ARCH_SHARK */
multiline_comment|/*&n; * PCI specific support.&n; */
macro_line|#ifdef CONFIG_PCI
multiline_comment|/*&n; * We need to wake up the CyberPro, and make sure its in linear memory&n; * mode.  Unfortunately, this is specific to the platform and card that&n; * we are running on.&n; *&n; * On x86 and ARM, should we be initialising the CyberPro first via the&n; * IO registers, and then the MMIO registers to catch all cases?  Can we&n; * end up in the situation where the chip is in MMIO mode, but not awake&n; * on an x86 system?&n; */
DECL|function|cyberpro_pci_enable_mmio
r_static
r_int
id|cyberpro_pci_enable_mmio
c_func
(paren
r_struct
id|cfb_info
op_star
id|cfb
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
macro_line|#if defined(__sparc_v9__)
macro_line|#error &quot;You lose, consult DaveM.&quot;
macro_line|#elif defined(__sparc__)
multiline_comment|/*&n;&t; * SPARC does not have an &quot;outb&quot; instruction, so we generate&n;&t; * I/O cycles storing into a reserved memory space at&n;&t; * physical address 0x3000000&n;&t; */
r_int
r_char
op_star
id|iop
suffix:semicolon
id|iop
op_assign
id|ioremap
c_func
(paren
l_int|0x3000000
comma
l_int|0x5000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iop
op_eq
l_int|NULL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;iga5000: cannot map I/O&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0x18
comma
id|iop
op_plus
l_int|0x46e8
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x01
comma
id|iop
op_plus
l_int|0x102
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x08
comma
id|iop
op_plus
l_int|0x46e8
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|EXT_BIU_MISC
comma
id|iop
op_plus
l_int|0x3ce
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|EXT_BIU_MISC_LIN_ENABLE
comma
id|iop
op_plus
l_int|0x3cf
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|iop
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/*&n;&t; * Most other machine types are &quot;normal&quot;, so&n;&t; * we use the standard IO-based wakeup.&n;&t; */
id|outb
c_func
(paren
l_int|0x18
comma
l_int|0x46e8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
l_int|0x102
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
l_int|0x46e8
)paren
suffix:semicolon
id|outb
c_func
(paren
id|EXT_BIU_MISC
comma
l_int|0x3ce
)paren
suffix:semicolon
id|outb
c_func
(paren
id|EXT_BIU_MISC_LIN_ENABLE
comma
l_int|0x3cf
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Allow the CyberPro to accept PCI burst accesses&n;&t; */
id|val
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_BUS_CTL
comma
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|EXT_BUS_CTL_PCIBURST_WRITE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: enabling PCI bursts&bslash;n&quot;
comma
id|cfb-&gt;fb.fix.id
)paren
suffix:semicolon
id|val
op_or_assign
id|EXT_BUS_CTL_PCIBURST_WRITE
suffix:semicolon
r_if
c_cond
(paren
id|cfb-&gt;id
op_eq
id|ID_CYBERPRO_5000
)paren
id|val
op_or_assign
id|EXT_BUS_CTL_PCIBURST_READ
suffix:semicolon
id|cyber2000_grphw
c_func
(paren
id|EXT_BUS_CTL
comma
id|val
comma
id|cfb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|cyberpro_pci_probe
id|cyberpro_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
suffix:semicolon
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;CyberPro%4X&quot;
comma
id|id-&gt;device
)paren
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|dev
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|cfb
op_assign
id|cyberpro_alloc_fb_info
c_func
(paren
id|id-&gt;driver_data
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfb
)paren
r_goto
id|failed_release
suffix:semicolon
id|cfb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cfb-&gt;region
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfb-&gt;region
)paren
r_goto
id|failed_ioremap
suffix:semicolon
id|cfb-&gt;regs
op_assign
id|cfb-&gt;region
op_plus
id|MMIO_OFFSET
suffix:semicolon
id|cfb-&gt;fb.fix.mmio_start
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
op_plus
id|MMIO_OFFSET
suffix:semicolon
id|cfb-&gt;fb.fix.smem_start
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Bring up the hardware.  This is expected to enable access&n;&t; * to the linear memory region, and allow access to the memory&n;&t; * mapped registers.  Also, mem_ctl1 and mem_ctl2 must be&n;&t; * initialised.&n;&t; */
id|err
op_assign
id|cyberpro_pci_enable_mmio
c_func
(paren
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed
suffix:semicolon
multiline_comment|/*&n;&t; * Use MCLK from BIOS. FIXME: what about hotplug?&n;&t; */
id|cfb-&gt;mclk_mult
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_MCLK_MULT
comma
id|cfb
)paren
suffix:semicolon
id|cfb-&gt;mclk_div
op_assign
id|cyber2000_grphr
c_func
(paren
id|EXT_MCLK_DIV
comma
id|cfb
)paren
suffix:semicolon
macro_line|#ifdef __arm__
multiline_comment|/*&n;&t; * MCLK on the NetWinder and the Shark is fixed at 75MHz&n;&t; */
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
id|cfb-&gt;mclk_mult
op_assign
l_int|0xdb
suffix:semicolon
id|cfb-&gt;mclk_div
op_assign
l_int|0x54
suffix:semicolon
)brace
macro_line|#endif
id|err
op_assign
id|cyberpro_common_probe
c_func
(paren
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed
suffix:semicolon
multiline_comment|/*&n;&t; * Our driver data&n;&t; */
id|pci_set_drvdata
c_func
(paren
id|dev
comma
id|cfb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|int_cfb_info
op_eq
l_int|NULL
)paren
id|int_cfb_info
op_assign
id|cfb
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
id|iounmap
c_func
(paren
id|cfb-&gt;region
)paren
suffix:semicolon
id|failed_ioremap
suffix:colon
id|cyberpro_free_fb_info
c_func
(paren
id|cfb
)paren
suffix:semicolon
id|failed_release
suffix:colon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|cyberpro_pci_remove
r_static
r_void
id|__devexit
id|cyberpro_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb
)paren
(brace
multiline_comment|/*&n;&t;&t; * If unregister_framebuffer fails, then&n;&t;&t; * we will be leaving hooks that could cause&n;&t;&t; * oopsen laying around.&n;&t;&t; */
r_if
c_cond
(paren
id|unregister_framebuffer
c_func
(paren
op_amp
id|cfb-&gt;fb
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: danger Will Robinson, &quot;
l_string|&quot;danger danger!  Oopsen imminent!&bslash;n&quot;
comma
id|cfb-&gt;fb.fix.id
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|cfb-&gt;region
)paren
suffix:semicolon
id|cyberpro_free_fb_info
c_func
(paren
id|cfb
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Ensure that the driver data is no longer&n;&t;&t; * valid.&n;&t;&t; */
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb
op_eq
id|int_cfb_info
)paren
id|int_cfb_info
op_assign
l_int|NULL
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|cyberpro_pci_suspend
r_static
r_int
id|cyberpro_pci_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Re-initialise the CyberPro hardware&n; */
DECL|function|cyberpro_pci_resume
r_static
r_int
id|cyberpro_pci_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|cfb_info
op_star
id|cfb
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfb
)paren
(brace
id|cyberpro_pci_enable_mmio
c_func
(paren
id|cfb
)paren
suffix:semicolon
id|cyberpro_common_resume
c_func
(paren
id|cfb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cyberpro_pci_table
r_static
r_struct
id|pci_device_id
id|cyberpro_pci_table
(braket
)braket
op_assign
(brace
singleline_comment|//&t;Not yet
singleline_comment|//&t;{ PCI_VENDOR_ID_INTERG, PCI_DEVICE_ID_INTERG_1682,
singleline_comment|//&t;&t;PCI_ANY_ID, PCI_ANY_ID, 0, 0, ID_IGA_1682 },
(brace
id|PCI_VENDOR_ID_INTERG
comma
id|PCI_DEVICE_ID_INTERG_2000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|ID_CYBERPRO_2000
)brace
comma
(brace
id|PCI_VENDOR_ID_INTERG
comma
id|PCI_DEVICE_ID_INTERG_2010
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|ID_CYBERPRO_2010
)brace
comma
(brace
id|PCI_VENDOR_ID_INTERG
comma
id|PCI_DEVICE_ID_INTERG_5000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|ID_CYBERPRO_5000
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|cyberpro_pci_table
)paren
suffix:semicolon
DECL|variable|cyberpro_driver
r_static
r_struct
id|pci_driver
id|cyberpro_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;CyberPro&quot;
comma
dot
id|probe
op_assign
id|cyberpro_pci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|cyberpro_pci_remove
)paren
comma
dot
id|suspend
op_assign
id|cyberpro_pci_suspend
comma
dot
id|resume
op_assign
id|cyberpro_pci_resume
comma
dot
id|id_table
op_assign
id|cyberpro_pci_table
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * I don&squot;t think we can use the &quot;module_init&quot; stuff here because&n; * the fbcon stuff may not be initialised yet.  Hence the #ifdef&n; * around module_init.&n; *&n; * Tony: &quot;module_init&quot; is now required&n; */
DECL|function|cyber2000fb_init
r_int
id|__init
id|cyber2000fb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
op_minus
l_int|1
comma
id|err
suffix:semicolon
macro_line|#ifndef MODULE
r_char
op_star
id|option
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;cyber2000fb&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|cyber2000fb_setup
c_func
(paren
id|option
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_SHARK
id|err
op_assign
id|cyberpro_vl_probe
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
id|__module_get
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|cyberpro_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|ret
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_return
id|ret
ques
c_cond
id|err
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|cyberpro_exit
r_static
r_void
id|__exit
id|cyberpro_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|cyberpro_driver
)paren
suffix:semicolon
)brace
DECL|variable|cyber2000fb_init
id|module_init
c_func
(paren
id|cyber2000fb_init
)paren
suffix:semicolon
DECL|variable|cyberpro_exit
id|module_exit
c_func
(paren
id|cyberpro_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Russell King&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;CyberPro 2000, 2010 and 5000 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
