multiline_comment|/*&n; * linux/drivers/video/stifb.c - &n; * Low level Frame buffer driver for HP workstations with &n; * STI (standard text interface) video firmware.&n; *&n; * Copyright (C) 2001-2004 Helge Deller &lt;deller@gmx.de&gt;&n; * Portions Copyright (C) 2001 Thomas Bogendoerfer &lt;tsbogend@alpha.franken.de&gt;&n; * &n; * Based on:&n; * - linux/drivers/video/artistfb.c -- Artist frame buffer driver&n; *&t;Copyright (C) 2000 Philipp Rumpf &lt;prumpf@tux.org&gt;&n; *   - based on skeletonfb, which was&n; *&t;Created 28 Dec 1997 by Geert Uytterhoeven&n; * - HP Xhp cfb-based X11 window driver for XFree86&n; *&t;(c)Copyright 1992 Hewlett-Packard Co.&n; *&n; * &n; *  The following graphics display devices (NGLE family) are supported by this driver:&n; *&n; *  HPA4070A&t;known as &quot;HCRX&quot;, a 1280x1024 color device with 8 planes&n; *  HPA4071A&t;known as &quot;HCRX24&quot;, a 1280x1024 color device with 24 planes,&n; *&t;&t;optionally available with a hardware accelerator as HPA4071A_Z&n; *  HPA1659A&t;known as &quot;CRX&quot;, a 1280x1024 color device with 8 planes&n; *  HPA1439A&t;known as &quot;CRX24&quot;, a 1280x1024 color device with 24 planes,&n; *&t;&t;optionally available with a hardware accelerator.&n; *  HPA1924A&t;known as &quot;GRX&quot;, a 1280x1024 grayscale device with 8 planes&n; *  HPA2269A&t;known as &quot;Dual CRX&quot;, a 1280x1024 color device with 8 planes,&n; *&t;&t;implements support for two displays on a single graphics card.&n; *  HP710C&t;internal graphics support optionally available on the HP9000s710 SPU,&n; *&t;&t;supports 1280x1024 color displays with 8 planes.&n; *  HP710G&t;same as HP710C, 1280x1024 grayscale only&n; *  HP710L&t;same as HP710C, 1024x768 color only&n; *  HP712&t;internal graphics support on HP9000s712 SPU, supports 640x480, &n; *&t;&t;1024x768 or 1280x1024 color displays on 8 planes (Artist)&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
multiline_comment|/* TODO:&n; *&t;- 1bpp mode is completely untested&n; *&t;- add support for h/w acceleration&n; *&t;- add hardware cursor&n; *&t;- automatically disable double buffering (e.g. on RDI precisionbook laptop)&n; */
multiline_comment|/* on supported graphic devices you may:&n; * #define FALLBACK_TO_1BPP to fall back to 1 bpp, or&n; * #undef  FALLBACK_TO_1BPP to reject support for unsupported cards */
DECL|macro|FALLBACK_TO_1BPP
macro_line|#undef FALLBACK_TO_1BPP
DECL|macro|DEBUG_STIFB_REGS
macro_line|#undef DEBUG_STIFB_REGS&t;&t;/* debug sti register accesses */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/grfioctl.h&gt;&t;/* for HP-UX compatibility */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;sticore.h&quot;
multiline_comment|/* REGION_BASE(fb_info, index) returns the virtual address for region &lt;index&gt; */
macro_line|#ifdef __LP64__
DECL|macro|REGION_BASE
mdefine_line|#define REGION_BASE(fb_info, index) &bslash;&n;&t;(fb_info-&gt;sti-&gt;glob_cfg-&gt;region_ptrs[index] | 0xffffffff00000000)
macro_line|#else
DECL|macro|REGION_BASE
mdefine_line|#define REGION_BASE(fb_info, index) &bslash;&n;&t;fb_info-&gt;sti-&gt;glob_cfg-&gt;region_ptrs[index]
macro_line|#endif
DECL|macro|NGLEDEVDEPROM_CRT_REGION
mdefine_line|#define NGLEDEVDEPROM_CRT_REGION 1
r_typedef
r_struct
(brace
DECL|member|video_config_reg
id|__s32
id|video_config_reg
suffix:semicolon
DECL|member|misc_video_start
id|__s32
id|misc_video_start
suffix:semicolon
DECL|member|horiz_timing_fmt
id|__s32
id|horiz_timing_fmt
suffix:semicolon
DECL|member|serr_timing_fmt
id|__s32
id|serr_timing_fmt
suffix:semicolon
DECL|member|vert_timing_fmt
id|__s32
id|vert_timing_fmt
suffix:semicolon
DECL|member|horiz_state
id|__s32
id|horiz_state
suffix:semicolon
DECL|member|vert_state
id|__s32
id|vert_state
suffix:semicolon
DECL|member|vtg_state_elements
id|__s32
id|vtg_state_elements
suffix:semicolon
DECL|member|pipeline_delay
id|__s32
id|pipeline_delay
suffix:semicolon
DECL|member|misc_video_end
id|__s32
id|misc_video_end
suffix:semicolon
DECL|typedef|video_setup_t
)brace
id|video_setup_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|sizeof_ngle_data
id|__s16
id|sizeof_ngle_data
suffix:semicolon
DECL|member|x_size_visible
id|__s16
id|x_size_visible
suffix:semicolon
multiline_comment|/* visible screen dim in pixels  */
DECL|member|y_size_visible
id|__s16
id|y_size_visible
suffix:semicolon
DECL|member|pad2
id|__s16
id|pad2
(braket
l_int|15
)braket
suffix:semicolon
DECL|member|cursor_pipeline_delay
id|__s16
id|cursor_pipeline_delay
suffix:semicolon
DECL|member|video_interleaves
id|__s16
id|video_interleaves
suffix:semicolon
DECL|member|pad3
id|__s32
id|pad3
(braket
l_int|11
)braket
suffix:semicolon
DECL|typedef|ngle_rom_t
)brace
id|ngle_rom_t
suffix:semicolon
DECL|struct|stifb_info
r_struct
id|stifb_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|id
r_int
r_int
id|id
suffix:semicolon
DECL|member|ngle_rom
id|ngle_rom_t
id|ngle_rom
suffix:semicolon
DECL|member|sti
r_struct
id|sti_struct
op_star
id|sti
suffix:semicolon
DECL|member|deviceSpecificConfig
r_int
id|deviceSpecificConfig
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|bpp
r_static
r_int
id|__initdata
id|bpp
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* parameter from modprobe */
DECL|variable|stifb_force_bpp
r_static
r_int
id|__initdata
id|stifb_force_bpp
(braket
id|MAX_STI_ROMS
)braket
suffix:semicolon
multiline_comment|/* ------------------- chipset specific functions -------------------------- */
multiline_comment|/* offsets to graphic-chip internal registers */
DECL|macro|REG_1
mdefine_line|#define REG_1&t;&t;0x000118
DECL|macro|REG_2
mdefine_line|#define REG_2&t;&t;0x000480
DECL|macro|REG_3
mdefine_line|#define REG_3&t;&t;0x0004a0
DECL|macro|REG_4
mdefine_line|#define REG_4&t;&t;0x000600
DECL|macro|REG_6
mdefine_line|#define REG_6&t;&t;0x000800
DECL|macro|REG_8
mdefine_line|#define REG_8&t;&t;0x000820
DECL|macro|REG_9
mdefine_line|#define REG_9&t;&t;0x000a04
DECL|macro|REG_10
mdefine_line|#define REG_10&t;&t;0x018000
DECL|macro|REG_11
mdefine_line|#define REG_11&t;&t;0x018004
DECL|macro|REG_12
mdefine_line|#define REG_12&t;&t;0x01800c
DECL|macro|REG_13
mdefine_line|#define REG_13&t;&t;0x018018
DECL|macro|REG_14
mdefine_line|#define REG_14  &t;0x01801c
DECL|macro|REG_15
mdefine_line|#define REG_15&t;&t;0x200000
DECL|macro|REG_15b0
mdefine_line|#define REG_15b0&t;0x200000
DECL|macro|REG_16b1
mdefine_line|#define REG_16b1&t;0x200005
DECL|macro|REG_16b3
mdefine_line|#define REG_16b3&t;0x200007
DECL|macro|REG_21
mdefine_line|#define REG_21&t;&t;0x200218
DECL|macro|REG_22
mdefine_line|#define REG_22&t;&t;0x0005a0
DECL|macro|REG_23
mdefine_line|#define REG_23&t;&t;0x0005c0
DECL|macro|REG_26
mdefine_line|#define REG_26&t;&t;0x200118
DECL|macro|REG_27
mdefine_line|#define REG_27&t;&t;0x200308
DECL|macro|REG_32
mdefine_line|#define REG_32&t;&t;0x21003c
DECL|macro|REG_33
mdefine_line|#define REG_33&t;&t;0x210040
DECL|macro|REG_34
mdefine_line|#define REG_34&t;&t;0x200008
DECL|macro|REG_35
mdefine_line|#define REG_35&t;&t;0x018010
DECL|macro|REG_38
mdefine_line|#define REG_38&t;&t;0x210020
DECL|macro|REG_39
mdefine_line|#define REG_39&t;&t;0x210120
DECL|macro|REG_40
mdefine_line|#define REG_40&t;&t;0x210130
DECL|macro|REG_42
mdefine_line|#define REG_42&t;&t;0x210028
DECL|macro|REG_43
mdefine_line|#define REG_43&t;&t;0x21002c
DECL|macro|REG_44
mdefine_line|#define REG_44&t;&t;0x210030
DECL|macro|REG_45
mdefine_line|#define REG_45&t;&t;0x210034
DECL|macro|READ_BYTE
mdefine_line|#define READ_BYTE(fb,reg)&t;&t;__raw_readb((fb)-&gt;info.fix.mmio_start + (reg))
DECL|macro|READ_WORD
mdefine_line|#define READ_WORD(fb,reg)&t;&t;__raw_readl((fb)-&gt;info.fix.mmio_start + (reg))
macro_line|#ifndef DEBUG_STIFB_REGS
DECL|macro|DEBUG_OFF
macro_line|# define  DEBUG_OFF()
DECL|macro|DEBUG_ON
macro_line|# define  DEBUG_ON()
DECL|macro|WRITE_BYTE
macro_line|# define WRITE_BYTE(value,fb,reg)&t;__raw_writeb((value),(fb)-&gt;info.fix.mmio_start + (reg))
DECL|macro|WRITE_WORD
macro_line|# define WRITE_WORD(value,fb,reg)&t;__raw_writel((value),(fb)-&gt;info.fix.mmio_start + (reg))
macro_line|#else
DECL|variable|debug_on
r_static
r_int
id|debug_on
op_assign
l_int|1
suffix:semicolon
DECL|macro|DEBUG_OFF
macro_line|# define  DEBUG_OFF() debug_on=0
DECL|macro|DEBUG_ON
macro_line|# define  DEBUG_ON()  debug_on=1
DECL|macro|WRITE_BYTE
macro_line|# define WRITE_BYTE(value,fb,reg)&t;do { if (debug_on) &bslash;&n;&t;&t;&t;&t;&t;&t;printk(KERN_DEBUG &quot;%30s: WRITE_BYTE(0x%06x) = 0x%02x (old=0x%02x)&bslash;n&quot;, &bslash;&n;&t;&t;&t;&t;&t;&t;&t;__FUNCTION__, reg, value, READ_BYTE(fb,reg)); &t;&t;  &bslash;&n;&t;&t;&t;&t;&t;__raw_writeb((value),(fb)-&gt;info.fix.mmio_start + (reg)); } while (0)
DECL|macro|WRITE_WORD
macro_line|# define WRITE_WORD(value,fb,reg)&t;do { if (debug_on) &bslash;&n;&t;&t;&t;&t;&t;&t;printk(KERN_DEBUG &quot;%30s: WRITE_WORD(0x%06x) = 0x%08x (old=0x%08x)&bslash;n&quot;, &bslash;&n;&t;&t;&t;&t;&t;&t;&t;__FUNCTION__, reg, value, READ_WORD(fb,reg)); &t;&t;  &bslash;&n;&t;&t;&t;&t;&t;__raw_writel((value),(fb)-&gt;info.fix.mmio_start + (reg)); } while (0)
macro_line|#endif /* DEBUG_STIFB_REGS */
DECL|macro|ENABLE
mdefine_line|#define ENABLE&t;1&t;/* for enabling/disabling screen */&t;
DECL|macro|DISABLE
mdefine_line|#define DISABLE 0
DECL|macro|NGLE_LOCK
mdefine_line|#define NGLE_LOCK(fb_info)&t;do { } while (0) 
DECL|macro|NGLE_UNLOCK
mdefine_line|#define NGLE_UNLOCK(fb_info)&t;do { } while (0)
r_static
r_void
DECL|function|SETUP_HW
id|SETUP_HW
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
r_char
id|stat
suffix:semicolon
r_do
(brace
id|stat
op_assign
id|READ_BYTE
c_func
(paren
id|fb
comma
id|REG_15b0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
id|stat
op_assign
id|READ_BYTE
c_func
(paren
id|fb
comma
id|REG_15b0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|stat
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SETUP_FB
id|SETUP_FB
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
r_int
r_int
id|reg10_value
op_assign
l_int|0
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fb-&gt;id
)paren
(brace
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
r_case
id|S9000_ID_ARTIST
suffix:colon
r_case
id|S9000_ID_A1659A
suffix:colon
id|reg10_value
op_assign
l_int|0x13601000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_A1439A
suffix:colon
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
id|reg10_value
op_assign
l_int|0xBBA0A000
suffix:semicolon
r_else
id|reg10_value
op_assign
l_int|0x13601000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_HCRX
suffix:colon
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
id|reg10_value
op_assign
l_int|0xBBA0A000
suffix:semicolon
r_else
id|reg10_value
op_assign
l_int|0x13602000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_TIMBER
suffix:colon
r_case
id|CRX24_OVERLAY_PLANES
suffix:colon
id|reg10_value
op_assign
l_int|0x13602000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reg10_value
)paren
id|WRITE_WORD
c_func
(paren
id|reg10_value
comma
id|fb
comma
id|REG_10
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x83000300
comma
id|fb
comma
id|REG_14
)paren
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_BYTE
c_func
(paren
l_int|1
comma
id|fb
comma
id|REG_16b1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|START_IMAGE_COLORMAP_ACCESS
id|START_IMAGE_COLORMAP_ACCESS
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xBBE0F000
comma
id|fb
comma
id|REG_10
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x03000300
comma
id|fb
comma
id|REG_14
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
op_complement
l_int|0
comma
id|fb
comma
id|REG_13
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WRITE_IMAGE_COLOR
id|WRITE_IMAGE_COLOR
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|index
comma
r_int
id|color
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
(paren
(paren
l_int|0x100
op_plus
id|index
)paren
op_lshift
l_int|2
)paren
comma
id|fb
comma
id|REG_3
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|color
comma
id|fb
comma
id|REG_4
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|FINISH_IMAGE_COLORMAP_ACCESS
id|FINISH_IMAGE_COLORMAP_ACCESS
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|WRITE_WORD
c_func
(paren
l_int|0x400
comma
id|fb
comma
id|REG_2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
(brace
id|WRITE_WORD
c_func
(paren
l_int|0x83000100
comma
id|fb
comma
id|REG_1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|fb-&gt;id
op_eq
id|S9000_ID_ARTIST
op_logical_or
id|fb-&gt;id
op_eq
id|CRT_ID_VISUALIZE_EG
)paren
id|WRITE_WORD
c_func
(paren
l_int|0x80000100
comma
id|fb
comma
id|REG_26
)paren
suffix:semicolon
r_else
id|WRITE_WORD
c_func
(paren
l_int|0x80000100
comma
id|fb
comma
id|REG_1
)paren
suffix:semicolon
)brace
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SETUP_RAMDAC
id|SETUP_RAMDAC
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x04000000
comma
id|fb
comma
l_int|0x1020
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xff000000
comma
id|fb
comma
l_int|0x1028
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|CRX24_SETUP_RAMDAC
id|CRX24_SETUP_RAMDAC
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x04000000
comma
id|fb
comma
l_int|0x1000
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x02000000
comma
id|fb
comma
l_int|0x1004
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xff000000
comma
id|fb
comma
l_int|0x1008
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x05000000
comma
id|fb
comma
l_int|0x1000
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x02000000
comma
id|fb
comma
l_int|0x1004
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x03000000
comma
id|fb
comma
l_int|0x1008
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|HCRX_SETUP_RAMDAC
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|WRITE_WORD
c_func
(paren
l_int|0xffffffff
comma
id|fb
comma
id|REG_32
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|CRX24_SET_OVLY_MASK
id|CRX24_SET_OVLY_MASK
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x13a02000
comma
id|fb
comma
id|REG_11
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x03000300
comma
id|fb
comma
id|REG_14
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x000017f0
comma
id|fb
comma
id|REG_3
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xffffffff
comma
id|fb
comma
id|REG_13
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xffffffff
comma
id|fb
comma
id|REG_22
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_23
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ENABLE_DISABLE_DISPLAY
id|ENABLE_DISABLE_DISPLAY
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
r_int
r_int
id|value
op_assign
id|enable
ques
c_cond
l_int|0x43000000
suffix:colon
l_int|0x03000000
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x06000000
comma
id|fb
comma
l_int|0x1030
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|value
comma
id|fb
comma
l_int|0x1038
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|CRX24_ENABLE_DISABLE_DISPLAY
id|CRX24_ENABLE_DISABLE_DISPLAY
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
r_int
r_int
id|value
op_assign
id|enable
ques
c_cond
l_int|0x10000000
suffix:colon
l_int|0x30000000
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x01000000
comma
id|fb
comma
l_int|0x1000
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x02000000
comma
id|fb
comma
l_int|0x1004
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|value
comma
id|fb
comma
l_int|0x1008
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ARTIST_ENABLE_DISABLE_DISPLAY
id|ARTIST_ENABLE_DISABLE_DISPLAY
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
id|u32
id|DregsMiscVideo
op_assign
id|REG_21
suffix:semicolon
id|u32
id|DregsMiscCtl
op_assign
id|REG_27
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
id|WRITE_WORD
c_func
(paren
id|READ_WORD
c_func
(paren
id|fb
comma
id|DregsMiscVideo
)paren
op_or
l_int|0x0A000000
comma
id|fb
comma
id|DregsMiscVideo
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|READ_WORD
c_func
(paren
id|fb
comma
id|DregsMiscCtl
)paren
op_or
l_int|0x00800000
comma
id|fb
comma
id|DregsMiscCtl
)paren
suffix:semicolon
)brace
r_else
(brace
id|WRITE_WORD
c_func
(paren
id|READ_WORD
c_func
(paren
id|fb
comma
id|DregsMiscVideo
)paren
op_amp
op_complement
l_int|0x0A000000
comma
id|fb
comma
id|DregsMiscVideo
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|READ_WORD
c_func
(paren
id|fb
comma
id|DregsMiscCtl
)paren
op_amp
op_complement
l_int|0x00800000
comma
id|fb
comma
id|DregsMiscCtl
)paren
suffix:semicolon
)brace
)brace
DECL|macro|GET_ROMTABLE_INDEX
mdefine_line|#define GET_ROMTABLE_INDEX(fb) &bslash;&n;&t;(READ_BYTE(fb, REG_16b3) - 1)
DECL|macro|HYPER_CONFIG_PLANES_24
mdefine_line|#define HYPER_CONFIG_PLANES_24 0x00000100
DECL|macro|IS_24_DEVICE
mdefine_line|#define IS_24_DEVICE(fb) &bslash;&n;&t;(fb-&gt;deviceSpecificConfig &amp; HYPER_CONFIG_PLANES_24)
DECL|macro|IS_888_DEVICE
mdefine_line|#define IS_888_DEVICE(fb) &bslash;&n;&t;(!(IS_24_DEVICE(fb)))
DECL|macro|GET_FIFO_SLOTS
mdefine_line|#define GET_FIFO_SLOTS(fb, cnt, numslots)&t;&t;&t;&bslash;&n;{&t;while (cnt &lt; numslots) &t;&t;&t;&t;&t;&bslash;&n;&t;&t;cnt = READ_WORD(fb, REG_34);&t;&bslash;&n;&t;cnt -= numslots;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|IndexedDcd
mdefine_line|#define&t;    IndexedDcd&t;0&t;/* Pixel data is indexed (pseudo) color */
DECL|macro|Otc04
mdefine_line|#define&t;    Otc04&t;2&t;/* Pixels in each longword transfer (4) */
DECL|macro|Otc32
mdefine_line|#define&t;    Otc32&t;5&t;/* Pixels in each longword transfer (32) */
DECL|macro|Ots08
mdefine_line|#define&t;    Ots08&t;3&t;/* Each pixel is size (8)d transfer (1) */
DECL|macro|OtsIndirect
mdefine_line|#define&t;    OtsIndirect&t;6&t;/* Each bit goes through FG/BG color(8) */
DECL|macro|AddrLong
mdefine_line|#define&t;    AddrLong&t;5&t;/* FB address is Long aligned (pixel) */
DECL|macro|BINovly
mdefine_line|#define&t;    BINovly&t;0x2&t;/* 8 bit overlay */
DECL|macro|BINapp0I
mdefine_line|#define&t;    BINapp0I&t;0x0&t;/* Application Buffer 0, Indexed */
DECL|macro|BINapp1I
mdefine_line|#define&t;    BINapp1I&t;0x1&t;/* Application Buffer 1, Indexed */
DECL|macro|BINapp0F8
mdefine_line|#define&t;    BINapp0F8&t;0xa&t;/* Application Buffer 0, Fractional 8-8-8 */
DECL|macro|BINattr
mdefine_line|#define&t;    BINattr&t;0xd&t;/* Attribute Bitmap */
DECL|macro|RopSrc
mdefine_line|#define&t;    RopSrc &t;0x3
DECL|macro|BitmapExtent08
mdefine_line|#define&t;    BitmapExtent08  3&t;/* Each write hits ( 8) bits in depth */
DECL|macro|BitmapExtent32
mdefine_line|#define&t;    BitmapExtent32  5&t;/* Each write hits (32) bits in depth */
DECL|macro|DataDynamic
mdefine_line|#define&t;    DataDynamic&t;    0&t;/* Data register reloaded by direct access */
DECL|macro|MaskDynamic
mdefine_line|#define&t;    MaskDynamic&t;    1&t;/* Mask register reloaded by direct access */
DECL|macro|MaskOtc
mdefine_line|#define&t;    MaskOtc&t;    0&t;/* Mask contains Object Count valid bits */
DECL|macro|MaskAddrOffset
mdefine_line|#define MaskAddrOffset(offset) (offset)
DECL|macro|StaticReg
mdefine_line|#define StaticReg(en) (en)
DECL|macro|BGx
mdefine_line|#define BGx(en) (en)
DECL|macro|FGx
mdefine_line|#define FGx(en) (en)
DECL|macro|BAJustPoint
mdefine_line|#define BAJustPoint(offset) (offset)
DECL|macro|BAIndexBase
mdefine_line|#define BAIndexBase(base) (base)
DECL|macro|BA
mdefine_line|#define BA(F,C,S,A,J,B,I) &bslash;&n;&t;(((F)&lt;&lt;31)|((C)&lt;&lt;27)|((S)&lt;&lt;24)|((A)&lt;&lt;21)|((J)&lt;&lt;16)|((B)&lt;&lt;12)|(I))
DECL|macro|IBOvals
mdefine_line|#define IBOvals(R,M,X,S,D,L,B,F) &bslash;&n;&t;(((R)&lt;&lt;8)|((M)&lt;&lt;16)|((X)&lt;&lt;24)|((S)&lt;&lt;29)|((D)&lt;&lt;28)|((L)&lt;&lt;31)|((B)&lt;&lt;1)|(F))
DECL|macro|NGLE_QUICK_SET_IMAGE_BITMAP_OP
mdefine_line|#define NGLE_QUICK_SET_IMAGE_BITMAP_OP(fb, val) &bslash;&n;&t;WRITE_WORD(val, fb, REG_14)
DECL|macro|NGLE_QUICK_SET_DST_BM_ACCESS
mdefine_line|#define NGLE_QUICK_SET_DST_BM_ACCESS(fb, val) &bslash;&n;&t;WRITE_WORD(val, fb, REG_11)
DECL|macro|NGLE_QUICK_SET_CTL_PLN_REG
mdefine_line|#define NGLE_QUICK_SET_CTL_PLN_REG(fb, val) &bslash;&n;&t;WRITE_WORD(val, fb, REG_12)
DECL|macro|NGLE_REALLY_SET_IMAGE_PLANEMASK
mdefine_line|#define NGLE_REALLY_SET_IMAGE_PLANEMASK(fb, plnmsk32) &bslash;&n;&t;WRITE_WORD(plnmsk32, fb, REG_13)
DECL|macro|NGLE_REALLY_SET_IMAGE_FG_COLOR
mdefine_line|#define NGLE_REALLY_SET_IMAGE_FG_COLOR(fb, fg32) &bslash;&n;&t;WRITE_WORD(fg32, fb, REG_35)
DECL|macro|NGLE_SET_TRANSFERDATA
mdefine_line|#define NGLE_SET_TRANSFERDATA(fb, val) &bslash;&n;&t;WRITE_WORD(val, fb, REG_8)
DECL|macro|NGLE_SET_DSTXY
mdefine_line|#define NGLE_SET_DSTXY(fb, val) &bslash;&n;&t;WRITE_WORD(val, fb, REG_6)
DECL|macro|NGLE_LONG_FB_ADDRESS
mdefine_line|#define NGLE_LONG_FB_ADDRESS(fbaddrbase, x, y) (&t;&t;&bslash;&n;&t;(u32) (fbaddrbase) +&t;&t;&t;&t;&t;&bslash;&n;&t;    (&t;(unsigned int)  ( (y) &lt;&lt; 13      ) |&t;&t;&bslash;&n;&t;&t;(unsigned int)  ( (x) &lt;&lt; 2       )&t;)&t;&bslash;&n;&t;)
DECL|macro|NGLE_BINC_SET_DSTADDR
mdefine_line|#define NGLE_BINC_SET_DSTADDR(fb, addr) &bslash;&n;&t;WRITE_WORD(addr, fb, REG_3)
DECL|macro|NGLE_BINC_SET_SRCADDR
mdefine_line|#define NGLE_BINC_SET_SRCADDR(fb, addr) &bslash;&n;&t;WRITE_WORD(addr, fb, REG_2)
DECL|macro|NGLE_BINC_SET_DSTMASK
mdefine_line|#define NGLE_BINC_SET_DSTMASK(fb, mask) &bslash;&n;&t;WRITE_WORD(mask, fb, REG_22)
DECL|macro|NGLE_BINC_WRITE32
mdefine_line|#define NGLE_BINC_WRITE32(fb, data32) &bslash;&n;&t;WRITE_WORD(data32, fb, REG_23)
DECL|macro|START_COLORMAPLOAD
mdefine_line|#define START_COLORMAPLOAD(fb, cmapBltCtlData32) &bslash;&n;&t;WRITE_WORD((cmapBltCtlData32), fb, REG_38)
DECL|macro|SET_LENXY_START_RECFILL
mdefine_line|#define SET_LENXY_START_RECFILL(fb, lenxy) &bslash;&n;&t;WRITE_WORD(lenxy, fb, REG_9)
r_static
r_void
DECL|function|HYPER_ENABLE_DISABLE_DISPLAY
id|HYPER_ENABLE_DISABLE_DISPLAY
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
id|u32
id|DregsHypMiscVideo
op_assign
id|REG_33
suffix:semicolon
r_int
r_int
id|value
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|value
op_assign
id|READ_WORD
c_func
(paren
id|fb
comma
id|DregsHypMiscVideo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|value
op_or_assign
l_int|0x0A000000
suffix:semicolon
r_else
id|value
op_and_assign
op_complement
l_int|0x0A000000
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|value
comma
id|fb
comma
id|DregsHypMiscVideo
)paren
suffix:semicolon
)brace
multiline_comment|/* BufferNumbers used by SETUP_ATTR_ACCESS() */
DECL|macro|BUFF0_CMAP0
mdefine_line|#define BUFF0_CMAP0&t;0x00001e02
DECL|macro|BUFF1_CMAP0
mdefine_line|#define BUFF1_CMAP0&t;0x02001e02
DECL|macro|BUFF1_CMAP3
mdefine_line|#define BUFF1_CMAP3&t;0x0c001e02
DECL|macro|ARTIST_CMAP0
mdefine_line|#define ARTIST_CMAP0&t;0x00000102
DECL|macro|HYPER_CMAP8
mdefine_line|#define HYPER_CMAP8&t;0x00000100
DECL|macro|HYPER_CMAP24
mdefine_line|#define HYPER_CMAP24&t;0x00000800
r_static
r_void
DECL|function|SETUP_ATTR_ACCESS
id|SETUP_ATTR_ACCESS
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|BufferNumber
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x2EA0D000
comma
id|fb
comma
id|REG_11
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x23000302
comma
id|fb
comma
id|REG_14
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|BufferNumber
comma
id|fb
comma
id|REG_12
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xffffffff
comma
id|fb
comma
id|REG_8
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SET_ATTR_SIZE
id|SET_ATTR_SIZE
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
multiline_comment|/* REG_6 seems to have special values when run on a &n;&t;   RDI precisionbook parisc laptop (INTERNAL_EG_DX1024 or&n;&t;   INTERNAL_EG_X1024).  The values are:&n;&t;&t;0x2f0: internal (LCD) &amp; external display enabled&n;&t;&t;0x2a0: external display only&n;&t;&t;0x000: zero on standard artist graphic cards&n;&t;*/
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_6
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
(paren
id|width
op_lshift
l_int|16
)paren
op_or
id|height
comma
id|fb
comma
id|REG_9
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x05000000
comma
id|fb
comma
id|REG_6
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00040001
comma
id|fb
comma
id|REG_9
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|FINISH_ATTR_ACCESS
id|FINISH_ATTR_ACCESS
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_12
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|elkSetupPlanes
id|elkSetupPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|SETUP_RAMDAC
c_func
(paren
id|fb
)paren
suffix:semicolon
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ngleSetupAttrPlanes
id|ngleSetupAttrPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|BufferNumber
)paren
(brace
id|SETUP_ATTR_ACCESS
c_func
(paren
id|fb
comma
id|BufferNumber
)paren
suffix:semicolon
id|SET_ATTR_SIZE
c_func
(paren
id|fb
comma
id|fb-&gt;info.var.xres
comma
id|fb-&gt;info.var.yres
)paren
suffix:semicolon
id|FINISH_ATTR_ACCESS
c_func
(paren
id|fb
)paren
suffix:semicolon
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rattlerSetupPlanes
id|rattlerSetupPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
id|CRX24_SETUP_RAMDAC
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* replacement for: SETUP_FB(fb, CRX24_OVERLAY_PLANES); */
id|WRITE_WORD
c_func
(paren
l_int|0x83000300
comma
id|fb
comma
id|REG_14
)paren
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
id|WRITE_BYTE
c_func
(paren
l_int|1
comma
id|fb
comma
id|REG_16b1
)paren
suffix:semicolon
id|fb_memset
c_func
(paren
id|fb-&gt;info.fix.smem_start
comma
l_int|0xff
comma
id|fb-&gt;info.var.yres
op_star
id|fb-&gt;info.fix.line_length
)paren
suffix:semicolon
id|CRX24_SET_OVLY_MASK
c_func
(paren
id|fb
)paren
suffix:semicolon
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
DECL|macro|HYPER_CMAP_TYPE
mdefine_line|#define HYPER_CMAP_TYPE&t;&t;&t;&t;0
DECL|macro|NGLE_CMAP_INDEXED0_TYPE
mdefine_line|#define NGLE_CMAP_INDEXED0_TYPE&t;&t;&t;0
DECL|macro|NGLE_CMAP_OVERLAY_TYPE
mdefine_line|#define NGLE_CMAP_OVERLAY_TYPE&t;&t;&t;3
multiline_comment|/* typedef of LUT (Colormap) BLT Control Register */
r_typedef
r_union
multiline_comment|/* Note assumption that fields are packed left-to-right */
DECL|member|all
(brace
id|u32
id|all
suffix:semicolon
r_struct
(brace
DECL|member|enable
r_int
id|enable
suffix:colon
l_int|1
suffix:semicolon
DECL|member|waitBlank
r_int
id|waitBlank
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|4
suffix:semicolon
DECL|member|lutOffset
r_int
id|lutOffset
suffix:colon
l_int|10
suffix:semicolon
multiline_comment|/* Within destination LUT */
DECL|member|lutType
r_int
id|lutType
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Cursor, image, overlay */
DECL|member|reserved2
r_int
id|reserved2
suffix:colon
l_int|4
suffix:semicolon
DECL|member|length
r_int
id|length
suffix:colon
l_int|10
suffix:semicolon
DECL|member|fields
)brace
id|fields
suffix:semicolon
DECL|typedef|NgleLutBltCtl
)brace
id|NgleLutBltCtl
suffix:semicolon
macro_line|#if 0
r_static
id|NgleLutBltCtl
id|setNgleLutBltCtl
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|offsetWithinLut
comma
r_int
id|length
)paren
(brace
id|NgleLutBltCtl
id|lutBltCtl
suffix:semicolon
multiline_comment|/* set enable, zero reserved fields */
id|lutBltCtl.all
op_assign
l_int|0x80000000
suffix:semicolon
id|lutBltCtl.fields.length
op_assign
id|length
suffix:semicolon
r_switch
c_cond
(paren
id|fb-&gt;id
)paren
(brace
r_case
id|S9000_ID_A1439A
suffix:colon
multiline_comment|/* CRX24 */
r_if
c_cond
(paren
id|fb-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
(brace
id|lutBltCtl.fields.lutType
op_assign
id|NGLE_CMAP_OVERLAY_TYPE
suffix:semicolon
id|lutBltCtl.fields.lutOffset
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|lutBltCtl.fields.lutType
op_assign
id|NGLE_CMAP_INDEXED0_TYPE
suffix:semicolon
id|lutBltCtl.fields.lutOffset
op_assign
l_int|0
op_star
l_int|256
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|S9000_ID_ARTIST
suffix:colon
id|lutBltCtl.fields.lutType
op_assign
id|NGLE_CMAP_INDEXED0_TYPE
suffix:semicolon
id|lutBltCtl.fields.lutOffset
op_assign
l_int|0
op_star
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|lutBltCtl.fields.lutType
op_assign
id|NGLE_CMAP_INDEXED0_TYPE
suffix:semicolon
id|lutBltCtl.fields.lutOffset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Offset points to start of LUT.  Adjust for within LUT */
id|lutBltCtl.fields.lutOffset
op_add_assign
id|offsetWithinLut
suffix:semicolon
r_return
id|lutBltCtl
suffix:semicolon
)brace
macro_line|#endif
r_static
id|NgleLutBltCtl
DECL|function|setHyperLutBltCtl
id|setHyperLutBltCtl
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|offsetWithinLut
comma
r_int
id|length
)paren
(brace
id|NgleLutBltCtl
id|lutBltCtl
suffix:semicolon
multiline_comment|/* set enable, zero reserved fields */
id|lutBltCtl.all
op_assign
l_int|0x80000000
suffix:semicolon
id|lutBltCtl.fields.length
op_assign
id|length
suffix:semicolon
id|lutBltCtl.fields.lutType
op_assign
id|HYPER_CMAP_TYPE
suffix:semicolon
multiline_comment|/* Expect lutIndex to be 0 or 1 for image cmaps, 2 or 3 for overlay cmaps */
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|8
)paren
id|lutBltCtl.fields.lutOffset
op_assign
l_int|2
op_star
l_int|256
suffix:semicolon
r_else
id|lutBltCtl.fields.lutOffset
op_assign
l_int|0
op_star
l_int|256
suffix:semicolon
multiline_comment|/* Offset points to start of LUT.  Adjust for within LUT */
id|lutBltCtl.fields.lutOffset
op_add_assign
id|offsetWithinLut
suffix:semicolon
r_return
id|lutBltCtl
suffix:semicolon
)brace
DECL|function|hyperUndoITE
r_static
r_void
id|hyperUndoITE
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
r_int
id|nFreeFifoSlots
op_assign
l_int|0
suffix:semicolon
id|u32
id|fbAddr
suffix:semicolon
id|NGLE_LOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|1
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0xffffffff
comma
id|fb
comma
id|REG_32
)paren
suffix:semicolon
multiline_comment|/* Write overlay transparency mask so only entry 255 is transparent */
multiline_comment|/* Hardware setup for full-depth write to &quot;magic&quot; location */
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|7
)paren
suffix:semicolon
id|NGLE_QUICK_SET_DST_BM_ACCESS
c_func
(paren
id|fb
comma
id|BA
c_func
(paren
id|IndexedDcd
comma
id|Otc04
comma
id|Ots08
comma
id|AddrLong
comma
id|BAJustPoint
c_func
(paren
l_int|0
)paren
comma
id|BINovly
comma
id|BAIndexBase
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|NGLE_QUICK_SET_IMAGE_BITMAP_OP
c_func
(paren
id|fb
comma
id|IBOvals
c_func
(paren
id|RopSrc
comma
id|MaskAddrOffset
c_func
(paren
l_int|0
)paren
comma
id|BitmapExtent08
comma
id|StaticReg
c_func
(paren
l_int|0
)paren
comma
id|DataDynamic
comma
id|MaskOtc
comma
id|BGx
c_func
(paren
l_int|0
)paren
comma
id|FGx
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Now prepare to write to the &quot;magic&quot; location */
id|fbAddr
op_assign
id|NGLE_LONG_FB_ADDRESS
c_func
(paren
l_int|0
comma
l_int|1532
comma
l_int|0
)paren
suffix:semicolon
id|NGLE_BINC_SET_DSTADDR
c_func
(paren
id|fb
comma
id|fbAddr
)paren
suffix:semicolon
id|NGLE_REALLY_SET_IMAGE_PLANEMASK
c_func
(paren
id|fb
comma
l_int|0xffffff
)paren
suffix:semicolon
id|NGLE_BINC_SET_DSTMASK
c_func
(paren
id|fb
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* Finally, write a zero to clear the mask */
id|NGLE_BINC_WRITE32
c_func
(paren
id|fb
comma
l_int|0
)paren
suffix:semicolon
id|NGLE_UNLOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ngleDepth8_ClearImagePlanes
id|ngleDepth8_ClearImagePlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
multiline_comment|/* FIXME! */
)brace
r_static
r_void
DECL|function|ngleDepth24_ClearImagePlanes
id|ngleDepth24_ClearImagePlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
multiline_comment|/* FIXME! */
)brace
r_static
r_void
DECL|function|ngleResetAttrPlanes
id|ngleResetAttrPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
r_int
id|ctlPlaneReg
)paren
(brace
r_int
id|nFreeFifoSlots
op_assign
l_int|0
suffix:semicolon
id|u32
id|packed_dst
suffix:semicolon
id|u32
id|packed_len
suffix:semicolon
id|NGLE_LOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|4
)paren
suffix:semicolon
id|NGLE_QUICK_SET_DST_BM_ACCESS
c_func
(paren
id|fb
comma
id|BA
c_func
(paren
id|IndexedDcd
comma
id|Otc32
comma
id|OtsIndirect
comma
id|AddrLong
comma
id|BAJustPoint
c_func
(paren
l_int|0
)paren
comma
id|BINattr
comma
id|BAIndexBase
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|NGLE_QUICK_SET_CTL_PLN_REG
c_func
(paren
id|fb
comma
id|ctlPlaneReg
)paren
suffix:semicolon
id|NGLE_SET_TRANSFERDATA
c_func
(paren
id|fb
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|NGLE_QUICK_SET_IMAGE_BITMAP_OP
c_func
(paren
id|fb
comma
id|IBOvals
c_func
(paren
id|RopSrc
comma
id|MaskAddrOffset
c_func
(paren
l_int|0
)paren
comma
id|BitmapExtent08
comma
id|StaticReg
c_func
(paren
l_int|1
)paren
comma
id|DataDynamic
comma
id|MaskOtc
comma
id|BGx
c_func
(paren
l_int|0
)paren
comma
id|FGx
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|packed_dst
op_assign
l_int|0
suffix:semicolon
id|packed_len
op_assign
(paren
id|fb-&gt;info.var.xres
op_lshift
l_int|16
)paren
op_or
id|fb-&gt;info.var.yres
suffix:semicolon
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|2
)paren
suffix:semicolon
id|NGLE_SET_DSTXY
c_func
(paren
id|fb
comma
id|packed_dst
)paren
suffix:semicolon
id|SET_LENXY_START_RECFILL
c_func
(paren
id|fb
comma
id|packed_len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * In order to work around an ELK hardware problem (Buffy doesn&squot;t&n;&t; * always flush it&squot;s buffers when writing to the attribute&n;&t; * planes), at least 4 pixels must be written to the attribute&n;&t; * planes starting at (X == 1280) and (Y != to the last Y written&n;&t; * by BIF):&n;&t; */
r_if
c_cond
(paren
id|fb-&gt;id
op_eq
id|S9000_ID_A1659A
)paren
(brace
multiline_comment|/* ELK_DEVICE_ID */
multiline_comment|/* It&squot;s safe to use scanline zero: */
id|packed_dst
op_assign
(paren
l_int|1280
op_lshift
l_int|16
)paren
suffix:semicolon
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|2
)paren
suffix:semicolon
id|NGLE_SET_DSTXY
c_func
(paren
id|fb
comma
id|packed_dst
)paren
suffix:semicolon
id|packed_len
op_assign
(paren
l_int|4
op_lshift
l_int|16
)paren
op_or
l_int|1
suffix:semicolon
id|SET_LENXY_START_RECFILL
c_func
(paren
id|fb
comma
id|packed_len
)paren
suffix:semicolon
)brace
multiline_comment|/* ELK Hardware Kludge */
multiline_comment|/**** Finally, set the Control Plane Register back to zero: ****/
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|1
)paren
suffix:semicolon
id|NGLE_QUICK_SET_CTL_PLN_REG
c_func
(paren
id|fb
comma
l_int|0
)paren
suffix:semicolon
id|NGLE_UNLOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ngleClearOverlayPlanes
id|ngleClearOverlayPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|mask
comma
r_int
id|data
)paren
(brace
r_int
id|nFreeFifoSlots
op_assign
l_int|0
suffix:semicolon
id|u32
id|packed_dst
suffix:semicolon
id|u32
id|packed_len
suffix:semicolon
id|NGLE_LOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* Hardware setup */
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|8
)paren
suffix:semicolon
id|NGLE_QUICK_SET_DST_BM_ACCESS
c_func
(paren
id|fb
comma
id|BA
c_func
(paren
id|IndexedDcd
comma
id|Otc04
comma
id|Ots08
comma
id|AddrLong
comma
id|BAJustPoint
c_func
(paren
l_int|0
)paren
comma
id|BINovly
comma
id|BAIndexBase
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|NGLE_SET_TRANSFERDATA
c_func
(paren
id|fb
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* Write foreground color */
id|NGLE_REALLY_SET_IMAGE_FG_COLOR
c_func
(paren
id|fb
comma
id|data
)paren
suffix:semicolon
id|NGLE_REALLY_SET_IMAGE_PLANEMASK
c_func
(paren
id|fb
comma
id|mask
)paren
suffix:semicolon
id|packed_dst
op_assign
l_int|0
suffix:semicolon
id|packed_len
op_assign
(paren
id|fb-&gt;info.var.xres
op_lshift
l_int|16
)paren
op_or
id|fb-&gt;info.var.yres
suffix:semicolon
id|NGLE_SET_DSTXY
c_func
(paren
id|fb
comma
id|packed_dst
)paren
suffix:semicolon
multiline_comment|/* Write zeroes to overlay planes */
id|NGLE_QUICK_SET_IMAGE_BITMAP_OP
c_func
(paren
id|fb
comma
id|IBOvals
c_func
(paren
id|RopSrc
comma
id|MaskAddrOffset
c_func
(paren
l_int|0
)paren
comma
id|BitmapExtent08
comma
id|StaticReg
c_func
(paren
l_int|0
)paren
comma
id|DataDynamic
comma
id|MaskOtc
comma
id|BGx
c_func
(paren
l_int|0
)paren
comma
id|FGx
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|SET_LENXY_START_RECFILL
c_func
(paren
id|fb
comma
id|packed_len
)paren
suffix:semicolon
id|NGLE_UNLOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hyperResetPlanes
id|hyperResetPlanes
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
comma
r_int
id|enable
)paren
(brace
r_int
r_int
id|controlPlaneReg
suffix:semicolon
id|NGLE_LOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_24_DEVICE
c_func
(paren
id|fb
)paren
)paren
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
id|controlPlaneReg
op_assign
l_int|0x04000F00
suffix:semicolon
r_else
id|controlPlaneReg
op_assign
l_int|0x00000F00
suffix:semicolon
multiline_comment|/* 0x00000800 should be enought, but lets clear all 4 bits */
r_else
id|controlPlaneReg
op_assign
l_int|0x00000F00
suffix:semicolon
multiline_comment|/* 0x00000100 should be enought, but lets clear all 4 bits */
r_switch
c_cond
(paren
id|enable
)paren
(brace
r_case
id|ENABLE
suffix:colon
multiline_comment|/* clear screen */
r_if
c_cond
(paren
id|IS_24_DEVICE
c_func
(paren
id|fb
)paren
)paren
id|ngleDepth24_ClearImagePlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
r_else
id|ngleDepth8_ClearImagePlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* Paint attribute planes for default case.&n;&t;&t; * On Hyperdrive, this means all windows using overlay cmap 0. */
id|ngleResetAttrPlanes
c_func
(paren
id|fb
comma
id|controlPlaneReg
)paren
suffix:semicolon
multiline_comment|/* clear overlay planes */
id|ngleClearOverlayPlanes
c_func
(paren
id|fb
comma
l_int|0xff
comma
l_int|255
)paren
suffix:semicolon
multiline_comment|/**************************************************&n;&t;&t; ** Also need to counteract ITE settings &n;&t;&t; **************************************************/
id|hyperUndoITE
c_func
(paren
id|fb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISABLE
suffix:colon
multiline_comment|/* clear screen */
r_if
c_cond
(paren
id|IS_24_DEVICE
c_func
(paren
id|fb
)paren
)paren
id|ngleDepth24_ClearImagePlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
r_else
id|ngleDepth8_ClearImagePlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
id|ngleResetAttrPlanes
c_func
(paren
id|fb
comma
id|controlPlaneReg
)paren
suffix:semicolon
id|ngleClearOverlayPlanes
c_func
(paren
id|fb
comma
l_int|0xff
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
l_int|1
suffix:colon
multiline_comment|/* RESET */
id|hyperUndoITE
c_func
(paren
id|fb
)paren
suffix:semicolon
id|ngleResetAttrPlanes
c_func
(paren
id|fb
comma
id|controlPlaneReg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|NGLE_UNLOCK
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
multiline_comment|/* Return pointer to in-memory structure holding ELK device-dependent ROM values. */
r_static
r_void
DECL|function|ngleGetDeviceRomData
id|ngleGetDeviceRomData
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
macro_line|#if 0
id|XXX
suffix:colon
id|FIXME
suffix:colon
op_logical_neg
op_logical_neg
op_logical_neg
r_int
op_star
id|pBytePerLongDevDepData
suffix:semicolon
multiline_comment|/* data byte == LSB */
r_int
op_star
id|pRomTable
suffix:semicolon
id|NgleDevRomData
op_star
id|pPackedDevRomData
suffix:semicolon
r_int
id|sizePackedDevRomData
op_assign
r_sizeof
(paren
op_star
id|pPackedDevRomData
)paren
suffix:semicolon
r_char
op_star
id|pCard8
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|mapOrigin
op_assign
l_int|NULL
suffix:semicolon
r_int
id|romTableIdx
suffix:semicolon
id|pPackedDevRomData
op_assign
id|fb-&gt;ngle_rom
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;id
op_eq
id|S9000_ID_ARTIST
)paren
(brace
id|pPackedDevRomData-&gt;cursor_pipeline_delay
op_assign
l_int|4
suffix:semicolon
id|pPackedDevRomData-&gt;video_interleaves
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Get pointer to unpacked byte/long data in ROM */
id|pBytePerLongDevDepData
op_assign
id|fb-&gt;sti-&gt;regions
(braket
id|NGLEDEVDEPROM_CRT_REGION
)braket
suffix:semicolon
multiline_comment|/* Tomcat supports several resolutions: 1280x1024, 1024x768, 640x480 */
r_if
c_cond
(paren
id|fb-&gt;id
op_eq
id|S9000_ID_TOMCAT
)paren
(brace
multiline_comment|/*  jump to the correct ROM table  */
id|GET_ROMTABLE_INDEX
c_func
(paren
id|romTableIdx
)paren
suffix:semicolon
r_while
c_loop
(paren
id|romTableIdx
OG
l_int|0
)paren
(brace
id|pCard8
op_assign
(paren
id|Card8
op_star
)paren
id|pPackedDevRomData
suffix:semicolon
id|pRomTable
op_assign
id|pBytePerLongDevDepData
suffix:semicolon
multiline_comment|/* Pack every fourth byte from ROM into structure */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sizePackedDevRomData
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|pCard8
op_increment
op_assign
(paren
id|Card8
)paren
(paren
op_star
id|pRomTable
op_increment
)paren
suffix:semicolon
)brace
id|pBytePerLongDevDepData
op_assign
(paren
id|Card32
op_star
)paren
(paren
(paren
id|Card8
op_star
)paren
id|pBytePerLongDevDepData
op_plus
id|pPackedDevRomData-&gt;sizeof_ngle_data
)paren
suffix:semicolon
id|romTableIdx
op_decrement
suffix:semicolon
)brace
)brace
id|pCard8
op_assign
(paren
id|Card8
op_star
)paren
id|pPackedDevRomData
suffix:semicolon
multiline_comment|/* Pack every fourth byte from ROM into structure */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sizePackedDevRomData
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|pCard8
op_increment
op_assign
(paren
id|Card8
)paren
(paren
op_star
id|pBytePerLongDevDepData
op_increment
)paren
suffix:semicolon
)brace
)brace
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|macro|HYPERBOWL_MODE_FOR_8_OVER_88_LUT0_NO_TRANSPARENCIES
mdefine_line|#define HYPERBOWL_MODE_FOR_8_OVER_88_LUT0_NO_TRANSPARENCIES&t;4
DECL|macro|HYPERBOWL_MODE01_8_24_LUT0_TRANSPARENT_LUT1_OPAQUE
mdefine_line|#define HYPERBOWL_MODE01_8_24_LUT0_TRANSPARENT_LUT1_OPAQUE&t;8
DECL|macro|HYPERBOWL_MODE01_8_24_LUT0_OPAQUE_LUT1_OPAQUE
mdefine_line|#define HYPERBOWL_MODE01_8_24_LUT0_OPAQUE_LUT1_OPAQUE&t;&t;10
DECL|macro|HYPERBOWL_MODE2_8_24
mdefine_line|#define HYPERBOWL_MODE2_8_24&t;&t;&t;&t;&t;15
multiline_comment|/* HCRX specific boot-time initialization */
r_static
r_void
id|__init
DECL|function|SETUP_HCRX
id|SETUP_HCRX
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
r_int
id|hyperbowl
suffix:semicolon
r_int
id|nFreeFifoSlots
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;id
op_ne
id|S9000_ID_HCRX
)paren
r_return
suffix:semicolon
multiline_comment|/* Initialize Hyperbowl registers */
id|GET_FIFO_SLOTS
c_func
(paren
id|fb
comma
id|nFreeFifoSlots
comma
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_24_DEVICE
c_func
(paren
id|fb
)paren
)paren
(brace
id|hyperbowl
op_assign
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
ques
c_cond
id|HYPERBOWL_MODE01_8_24_LUT0_TRANSPARENT_LUT1_OPAQUE
suffix:colon
id|HYPERBOWL_MODE01_8_24_LUT0_OPAQUE_LUT1_OPAQUE
suffix:semicolon
multiline_comment|/* First write to Hyperbowl must happen twice (bug) */
id|WRITE_WORD
c_func
(paren
id|hyperbowl
comma
id|fb
comma
id|REG_40
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|hyperbowl
comma
id|fb
comma
id|REG_40
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|HYPERBOWL_MODE2_8_24
comma
id|fb
comma
id|REG_39
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x014c0148
comma
id|fb
comma
id|REG_42
)paren
suffix:semicolon
multiline_comment|/* Set lut 0 to be the direct color */
id|WRITE_WORD
c_func
(paren
l_int|0x404c4048
comma
id|fb
comma
id|REG_43
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x034c0348
comma
id|fb
comma
id|REG_44
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x444c4448
comma
id|fb
comma
id|REG_45
)paren
suffix:semicolon
)brace
r_else
(brace
id|hyperbowl
op_assign
id|HYPERBOWL_MODE_FOR_8_OVER_88_LUT0_NO_TRANSPARENCIES
suffix:semicolon
multiline_comment|/* First write to Hyperbowl must happen twice (bug) */
id|WRITE_WORD
c_func
(paren
id|hyperbowl
comma
id|fb
comma
id|REG_40
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
id|hyperbowl
comma
id|fb
comma
id|REG_40
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_42
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_43
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x00000000
comma
id|fb
comma
id|REG_44
)paren
suffix:semicolon
id|WRITE_WORD
c_func
(paren
l_int|0x444c4048
comma
id|fb
comma
id|REG_45
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------- driver specific functions --------------------------- */
DECL|macro|TMPBUFLEN
mdefine_line|#define TMPBUFLEN 2048
r_static
id|ssize_t
DECL|function|stifb_read
id|stifb_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
r_int
id|p
op_assign
op_star
id|ppos
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
r_char
id|tmpbuf
(braket
id|TMPBUFLEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|info-&gt;screen_base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|info-&gt;fix.smem_len
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|info-&gt;fix.smem_len
)paren
id|count
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
r_if
c_cond
(paren
id|count
op_plus
id|p
OG
id|info-&gt;fix.smem_len
)paren
id|count
op_assign
id|info-&gt;fix.smem_len
op_minus
id|p
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
r_sizeof
(paren
id|tmpbuf
)paren
)paren
id|count
op_assign
r_sizeof
(paren
id|tmpbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
r_char
op_star
id|base_addr
suffix:semicolon
id|base_addr
op_assign
id|info-&gt;screen_base
suffix:semicolon
id|memcpy_fromio
c_func
(paren
op_amp
id|tmpbuf
comma
id|base_addr
op_plus
id|p
comma
id|count
)paren
suffix:semicolon
id|count
op_sub_assign
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|tmpbuf
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|ppos
op_add_assign
id|count
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|stifb_write
id|stifb_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
r_int
r_int
id|p
op_assign
op_star
id|ppos
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|err
suffix:semicolon
r_char
id|tmpbuf
(braket
id|TMPBUFLEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|info-&gt;screen_base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|info-&gt;fix.smem_len
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|info-&gt;fix.smem_len
)paren
id|count
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_plus
id|p
OG
id|info-&gt;fix.smem_len
)paren
(brace
id|count
op_assign
id|info-&gt;fix.smem_len
op_minus
id|p
suffix:semicolon
id|err
op_assign
op_minus
id|ENOSPC
suffix:semicolon
)brace
id|p
op_add_assign
(paren
r_int
r_int
)paren
id|info-&gt;screen_base
suffix:semicolon
id|c
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
r_int
id|len
op_assign
id|c
OG
r_sizeof
(paren
id|tmpbuf
)paren
ques
c_cond
r_sizeof
(paren
id|tmpbuf
)paren
suffix:colon
id|c
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tmpbuf
comma
id|buf
comma
id|len
)paren
)paren
r_break
suffix:semicolon
id|memcpy_toio
c_func
(paren
id|p
comma
op_amp
id|tmpbuf
comma
id|len
)paren
suffix:semicolon
id|c
op_sub_assign
id|len
suffix:semicolon
id|p
op_add_assign
id|len
suffix:semicolon
id|buf
op_add_assign
id|len
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_minus
id|c
)paren
r_return
(paren
id|count
op_minus
id|c
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|stifb_setcolreg
id|stifb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|stifb_info
op_star
id|fb
op_assign
(paren
r_struct
id|stifb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|color
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
l_int|256
)paren
multiline_comment|/* no. of hw registers */
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|DEBUG_OFF
c_func
(paren
)paren
suffix:semicolon
id|START_IMAGE_COLORMAP_ACCESS
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;info.var.grayscale
)paren
(brace
multiline_comment|/* gray = 0.30*R + 0.59*G + 0.11*B */
id|color
op_assign
(paren
(paren
id|red
op_star
l_int|77
)paren
op_plus
(paren
id|green
op_star
l_int|151
)paren
op_plus
(paren
id|blue
op_star
l_int|28
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|color
op_assign
(paren
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|blue
)paren
)paren
suffix:semicolon
)brace
id|WRITE_IMAGE_COLOR
c_func
(paren
id|fb
comma
id|regno
comma
id|color
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;id
op_eq
id|S9000_ID_HCRX
)paren
(brace
id|NgleLutBltCtl
id|lutBltCtl
suffix:semicolon
id|lutBltCtl
op_assign
id|setHyperLutBltCtl
c_func
(paren
id|fb
comma
l_int|0
comma
multiline_comment|/* Offset w/i LUT */
l_int|256
)paren
suffix:semicolon
multiline_comment|/* Load entire LUT */
id|NGLE_BINC_SET_SRCADDR
c_func
(paren
id|fb
comma
id|NGLE_LONG_FB_ADDRESS
c_func
(paren
l_int|0
comma
l_int|0x100
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* 0x100 is same as used in WRITE_IMAGE_COLOR() */
id|START_COLORMAPLOAD
c_func
(paren
id|fb
comma
id|lutBltCtl.all
)paren
suffix:semicolon
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* cleanup colormap hardware */
id|FINISH_IMAGE_COLORMAP_ACCESS
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
id|DEBUG_ON
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|stifb_blank
id|stifb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|stifb_info
op_star
id|fb
op_assign
(paren
r_struct
id|stifb_info
op_star
)paren
id|info
suffix:semicolon
r_int
id|enable
op_assign
(paren
id|blank_mode
op_eq
l_int|0
)paren
ques
c_cond
id|ENABLE
suffix:colon
id|DISABLE
suffix:semicolon
r_switch
c_cond
(paren
id|fb-&gt;id
)paren
(brace
r_case
id|S9000_ID_A1439A
suffix:colon
id|CRX24_ENABLE_DISABLE_DISPLAY
c_func
(paren
id|fb
comma
id|enable
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
r_case
id|S9000_ID_ARTIST
suffix:colon
id|ARTIST_ENABLE_DISABLE_DISPLAY
c_func
(paren
id|fb
comma
id|enable
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_HCRX
suffix:colon
id|HYPER_ENABLE_DISABLE_DISPLAY
c_func
(paren
id|fb
comma
id|enable
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_A1659A
suffix:colon
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|S9000_ID_TIMBER
suffix:colon
suffix:semicolon
r_case
id|CRX24_OVERLAY_PLANES
suffix:colon
suffix:semicolon
r_default
suffix:colon
id|ENABLE_DISABLE_DISPLAY
c_func
(paren
id|fb
comma
id|enable
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|stifb_init_display
id|stifb_init_display
c_func
(paren
r_struct
id|stifb_info
op_star
id|fb
)paren
(brace
r_int
id|id
op_assign
id|fb-&gt;id
suffix:semicolon
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* HCRX specific initialization */
id|SETUP_HCRX
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/*&n;&t;if (id == S9000_ID_HCRX)&n;&t;&t;hyperInitSprite(fb);&n;&t;else&n;&t;&t;ngleInitSprite(fb);&n;&t;*/
multiline_comment|/* Initialize the image planes. */
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|S9000_ID_HCRX
suffix:colon
id|hyperResetPlanes
c_func
(paren
id|fb
comma
id|ENABLE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_A1439A
suffix:colon
id|rattlerSetupPlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_A1659A
suffix:colon
r_case
id|S9000_ID_ARTIST
suffix:colon
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
id|elkSetupPlanes
c_func
(paren
id|fb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Clear attribute planes on non HCRX devices. */
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|S9000_ID_A1659A
suffix:colon
r_case
id|S9000_ID_A1439A
suffix:colon
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
id|ngleSetupAttrPlanes
c_func
(paren
id|fb
comma
id|BUFF1_CMAP3
)paren
suffix:semicolon
r_else
(brace
id|ngleSetupAttrPlanes
c_func
(paren
id|fb
comma
id|BUFF1_CMAP0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
id|S9000_ID_A1439A
)paren
id|ngleClearOverlayPlanes
c_func
(paren
id|fb
comma
l_int|0xff
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_ARTIST
suffix:colon
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
r_if
c_cond
(paren
id|fb-&gt;info.var.bits_per_pixel
op_eq
l_int|32
)paren
id|ngleSetupAttrPlanes
c_func
(paren
id|fb
comma
id|BUFF1_CMAP3
)paren
suffix:semicolon
r_else
(brace
id|ngleSetupAttrPlanes
c_func
(paren
id|fb
comma
id|ARTIST_CMAP0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|stifb_blank
c_func
(paren
l_int|0
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* 0=enable screen */
id|SETUP_FB
c_func
(paren
id|fb
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------ Interfaces to hardware functions ------------ */
DECL|variable|stifb_ops
r_static
r_struct
id|fb_ops
id|stifb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_read
op_assign
id|stifb_read
comma
dot
id|fb_write
op_assign
id|stifb_write
comma
dot
id|fb_setcolreg
op_assign
id|stifb_setcolreg
comma
dot
id|fb_blank
op_assign
id|stifb_blank
comma
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Initialization&n; */
r_int
id|__init
DECL|function|stifb_init_fb
id|stifb_init_fb
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|force_bpp
)paren
(brace
r_struct
id|fb_fix_screeninfo
op_star
id|fix
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
suffix:semicolon
r_struct
id|stifb_info
op_star
id|fb
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_int
r_int
id|sti_rom_address
suffix:semicolon
r_char
op_star
id|dev_name
suffix:semicolon
r_int
id|bpp
comma
id|xres
comma
id|yres
suffix:semicolon
id|fb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|fb
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;stifb: Could not allocate stifb structure&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|info
op_assign
op_amp
id|fb-&gt;info
suffix:semicolon
multiline_comment|/* set struct to a known state */
id|memset
c_func
(paren
id|fb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fb
)paren
)paren
suffix:semicolon
id|fix
op_assign
op_amp
id|info-&gt;fix
suffix:semicolon
id|var
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
id|fb-&gt;sti
op_assign
id|sti
suffix:semicolon
multiline_comment|/* store upper 32bits of the graphics id */
id|fb-&gt;id
op_assign
id|fb-&gt;sti-&gt;graphics_id
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* only supported cards are allowed */
r_switch
c_cond
(paren
id|fb-&gt;id
)paren
(brace
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
multiline_comment|/* look for a double buffering device like e.g. the &n;&t;&t;   &quot;INTERNAL_EG_DX1024&quot; in the RDI precisionbook laptop&n;&t;&t;   which won&squot;t work. The same device in non-double &n;&t;&t;   buffering mode returns &quot;INTERNAL_EG_X1024&quot;. */
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|sti-&gt;outptr.dev_name
comma
l_string|&quot;EG_DX&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;stifb: ignoring &squot;%s&squot;. Disable double buffering in IPL menu.&bslash;n&quot;
comma
id|sti-&gt;outptr.dev_name
)paren
suffix:semicolon
r_goto
id|out_err0
suffix:semicolon
)brace
multiline_comment|/* fall though */
r_case
id|S9000_ID_ARTIST
suffix:colon
r_case
id|S9000_ID_HCRX
suffix:colon
r_case
id|S9000_ID_TIMBER
suffix:colon
r_case
id|S9000_ID_A1659A
suffix:colon
r_case
id|S9000_ID_A1439A
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;stifb: &squot;%s&squot; (id: 0x%08x) not supported.&bslash;n&quot;
comma
id|sti-&gt;outptr.dev_name
comma
id|fb-&gt;id
)paren
suffix:semicolon
r_goto
id|out_err0
suffix:semicolon
)brace
multiline_comment|/* default to 8 bpp on most graphic chips */
id|bpp
op_assign
l_int|8
suffix:semicolon
id|xres
op_assign
id|sti_onscreen_x
c_func
(paren
id|fb-&gt;sti
)paren
suffix:semicolon
id|yres
op_assign
id|sti_onscreen_y
c_func
(paren
id|fb-&gt;sti
)paren
suffix:semicolon
id|ngleGetDeviceRomData
c_func
(paren
id|fb
)paren
suffix:semicolon
multiline_comment|/* get (virtual) io region base addr */
id|fix-&gt;mmio_start
op_assign
id|REGION_BASE
c_func
(paren
id|fb
comma
l_int|2
)paren
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
l_int|0x400000
suffix:semicolon
multiline_comment|/* Reject any device not in the NGLE family */
r_switch
c_cond
(paren
id|fb-&gt;id
)paren
(brace
r_case
id|S9000_ID_A1659A
suffix:colon
multiline_comment|/* CRX/A1659A */
r_break
suffix:semicolon
r_case
id|S9000_ID_ELM
suffix:colon
multiline_comment|/* GRX, grayscale but else same as A1659A */
id|var-&gt;grayscale
op_assign
l_int|1
suffix:semicolon
id|fb-&gt;id
op_assign
id|S9000_ID_A1659A
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_TIMBER
suffix:colon
multiline_comment|/* HP9000/710 Any (may be a grayscale device) */
id|dev_name
op_assign
id|fb-&gt;sti-&gt;outptr.dev_name
suffix:semicolon
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|dev_name
comma
l_string|&quot;GRAYSCALE&quot;
)paren
op_logical_or
id|strstr
c_func
(paren
id|dev_name
comma
l_string|&quot;Grayscale&quot;
)paren
op_logical_or
id|strstr
c_func
(paren
id|dev_name
comma
l_string|&quot;grayscale&quot;
)paren
)paren
id|var-&gt;grayscale
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_TOMCAT
suffix:colon
multiline_comment|/* Dual CRX, behaves else like a CRX */
multiline_comment|/* FIXME: TomCat supports two heads:&n;&t;&t; * fb.iobase = REGION_BASE(fb_info,3);&n;&t;&t; * fb.screen_base = (void*) REGION_BASE(fb_info,2);&n;&t;&t; * for now we only support the left one ! */
id|xres
op_assign
id|fb-&gt;ngle_rom.x_size_visible
suffix:semicolon
id|yres
op_assign
id|fb-&gt;ngle_rom.y_size_visible
suffix:semicolon
id|fb-&gt;id
op_assign
id|S9000_ID_A1659A
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_A1439A
suffix:colon
multiline_comment|/* CRX24/A1439A */
id|bpp
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S9000_ID_HCRX
suffix:colon
multiline_comment|/* Hyperdrive/HCRX */
id|memset
c_func
(paren
op_amp
id|fb-&gt;ngle_rom
comma
l_int|0
comma
r_sizeof
(paren
id|fb-&gt;ngle_rom
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fb-&gt;sti-&gt;regions_phys
(braket
l_int|0
)braket
op_amp
l_int|0xfc000000
)paren
op_eq
(paren
id|fb-&gt;sti-&gt;regions_phys
(braket
l_int|2
)braket
op_amp
l_int|0xfc000000
)paren
)paren
id|sti_rom_address
op_assign
id|fb-&gt;sti-&gt;regions_phys
(braket
l_int|0
)braket
suffix:semicolon
r_else
id|sti_rom_address
op_assign
id|fb-&gt;sti-&gt;regions_phys
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#ifdef __LP64__
id|sti_rom_address
op_or_assign
l_int|0xffffffff00000000
suffix:semicolon
macro_line|#endif
id|fb-&gt;deviceSpecificConfig
op_assign
id|__raw_readl
c_func
(paren
id|sti_rom_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_24_DEVICE
c_func
(paren
id|fb
)paren
)paren
(brace
r_if
c_cond
(paren
id|force_bpp
op_eq
l_int|8
op_logical_or
id|force_bpp
op_eq
l_int|32
)paren
id|bpp
op_assign
id|force_bpp
suffix:semicolon
r_else
id|bpp
op_assign
l_int|32
suffix:semicolon
)brace
r_else
id|bpp
op_assign
l_int|8
suffix:semicolon
id|READ_WORD
c_func
(paren
id|fb
comma
id|REG_15
)paren
suffix:semicolon
id|SETUP_HW
c_func
(paren
id|fb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRT_ID_VISUALIZE_EG
suffix:colon
r_case
id|S9000_ID_ARTIST
suffix:colon
multiline_comment|/* Artist */
r_break
suffix:semicolon
r_default
suffix:colon
macro_line|#ifdef FALLBACK_TO_1BPP
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;stifb: Unsupported graphics card (id=0x%08x) &quot;
l_string|&quot;- now trying 1bpp mode instead&bslash;n&quot;
comma
id|fb-&gt;id
)paren
suffix:semicolon
id|bpp
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* default to 1 bpp */
r_break
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;stifb: Unsupported graphics card (id=0x%08x) &quot;
l_string|&quot;- skipping.&bslash;n&quot;
comma
id|fb-&gt;id
)paren
suffix:semicolon
r_goto
id|out_err0
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* get framebuffer physical and virtual base addr &amp; len (64bit ready) */
id|fix-&gt;smem_start
op_assign
id|F_EXTEND
c_func
(paren
id|fb-&gt;sti-&gt;regions_phys
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|fb-&gt;sti-&gt;regions
(braket
l_int|1
)braket
dot
id|region_desc.length
op_star
l_int|4096
suffix:semicolon
id|fix-&gt;line_length
op_assign
(paren
id|fb-&gt;sti-&gt;glob_cfg-&gt;total_x
op_star
id|bpp
)paren
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fix-&gt;line_length
)paren
id|fix-&gt;line_length
op_assign
l_int|2048
suffix:semicolon
multiline_comment|/* default */
multiline_comment|/* limit fbsize to max visible screen size */
r_if
c_cond
(paren
id|fix-&gt;smem_len
OG
id|yres
op_star
id|fix-&gt;line_length
)paren
id|fix-&gt;smem_len
op_assign
id|yres
op_star
id|fix-&gt;line_length
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|1
suffix:colon
id|fix-&gt;type
op_assign
id|FB_TYPE_PLANES
suffix:semicolon
multiline_comment|/* well, sort of */
id|fix-&gt;visual
op_assign
id|FB_VISUAL_MONO10
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
op_assign
id|yres
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|bpp
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;stifb&quot;
)paren
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|stifb_ops
suffix:semicolon
id|info-&gt;screen_base
op_assign
(paren
r_void
op_star
)paren
id|REGION_BASE
c_func
(paren
id|fb
comma
l_int|1
)paren
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_DEFAULT
suffix:semicolon
id|info-&gt;currcon
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* This has to been done !!! */
id|fb_alloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
id|stifb_init_display
c_func
(paren
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|fix-&gt;smem_start
comma
id|fix-&gt;smem_len
comma
l_string|&quot;stifb fb&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;stifb: cannot reserve fb region 0x%04lx-0x%04lx&bslash;n&quot;
comma
id|fix-&gt;smem_start
comma
id|fix-&gt;smem_start
op_plus
id|fix-&gt;smem_len
)paren
suffix:semicolon
r_goto
id|out_err1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|fix-&gt;mmio_start
comma
id|fix-&gt;mmio_len
comma
l_string|&quot;stifb mmio&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;stifb: cannot reserve sti mmio region 0x%04lx-0x%04lx&bslash;n&quot;
comma
id|fix-&gt;mmio_start
comma
id|fix-&gt;mmio_start
op_plus
id|fix-&gt;mmio_len
)paren
suffix:semicolon
r_goto
id|out_err2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb-&gt;info
)paren
OL
l_int|0
)paren
r_goto
id|out_err3
suffix:semicolon
id|sti-&gt;info
op_assign
id|info
suffix:semicolon
multiline_comment|/* save for unregister_framebuffer() */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s %dx%d-%d frame buffer device, %s, id: %04x, mmio: 0x%04lx&bslash;n&quot;
comma
id|fb-&gt;info.node
comma
id|fix-&gt;id
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
comma
id|sti-&gt;outptr.dev_name
comma
id|fb-&gt;id
comma
id|fix-&gt;mmio_start
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_err3
suffix:colon
id|release_mem_region
c_func
(paren
id|fix-&gt;mmio_start
comma
id|fix-&gt;mmio_len
)paren
suffix:semicolon
id|out_err2
suffix:colon
id|release_mem_region
c_func
(paren
id|fix-&gt;smem_start
comma
id|fix-&gt;smem_len
)paren
suffix:semicolon
id|out_err1
suffix:colon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
)paren
suffix:semicolon
id|out_err0
suffix:colon
id|kfree
c_func
(paren
id|fb
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_int
id|stifb_disabled
id|__initdata
suffix:semicolon
r_int
id|__init
id|stifb_setup
c_func
(paren
r_char
op_star
id|options
)paren
suffix:semicolon
r_int
id|__init
DECL|function|stifb_init
id|stifb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifndef MODULE
id|stifb_setup
c_func
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;stifb&quot;
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|stifb_disabled
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;stifb: disabled by &bslash;&quot;stifb=off&bslash;&quot; kernel parameter&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_STI_ROMS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sti
op_assign
id|sti_get_rom
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|bpp
OG
l_int|0
)paren
id|stifb_force_bpp
(braket
id|i
)braket
op_assign
id|bpp
suffix:semicolon
id|stifb_init_fb
c_func
(paren
id|sti
comma
id|stifb_force_bpp
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Cleanup&n; */
r_static
r_void
id|__exit
DECL|function|stifb_cleanup
id|stifb_cleanup
c_func
(paren
r_void
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_STI_ROMS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sti
op_assign
id|sti_get_rom
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sti-&gt;info
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|sti-&gt;info
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
id|sti-&gt;info
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|info-&gt;fix.mmio_start
comma
id|info-&gt;fix.mmio_len
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|info-&gt;fix.smem_start
comma
id|info-&gt;fix.smem_len
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|sti-&gt;info
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|stifb_setup
id|stifb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
op_eq
l_int|0
)paren
(brace
id|stifb_disabled
op_assign
l_int|1
suffix:semicolon
id|options
op_add_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;bpp&quot;
comma
l_int|3
)paren
op_eq
l_int|0
)paren
(brace
id|options
op_add_assign
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_STI_ROMS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|options
op_increment
op_eq
l_char|&squot;:&squot;
)paren
(brace
id|stifb_force_bpp
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|options
comma
l_int|10
)paren
suffix:semicolon
id|bpp
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;stifb=&quot;
comma
id|stifb_setup
)paren
suffix:semicolon
DECL|variable|stifb_init
id|module_init
c_func
(paren
id|stifb_init
)paren
suffix:semicolon
DECL|variable|stifb_cleanup
id|module_exit
c_func
(paren
id|stifb_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Helge Deller &lt;deller@gmx.de&gt;, Thomas Bogendoerfer &lt;tsbogend@alpha.franken.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Framebuffer driver for HP&squot;s NGLE series graphics cards in HP PARISC machines&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL v2&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bpp
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mem
comma
l_string|&quot;Bits per pixel (default: 8)&quot;
)paren
suffix:semicolon
eof
