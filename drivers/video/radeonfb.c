multiline_comment|/*&n; *&t;drivers/video/radeonfb.c&n; *&t;framebuffer driver for ATI Radeon chipset video boards&n; *&n; *&t;Copyright 2000&t;Ani Joshi &lt;ajoshi@kernel.crashing.org&gt;&n; *&n; *&n; *&t;ChangeLog:&n; *&t;2000-08-03&t;initial version 0.0.1&n; *&t;2000-09-10&t;more bug fixes, public release 0.0.5&n; *&t;2001-02-19&t;mode bug fixes, 0.0.7&n; *&t;2001-07-05&t;fixed scrolling issues, engine initialization,&n; *&t;&t;&t;and minor mode tweaking, 0.0.9&n; *&t;2001-09-07&t;Radeon VE support, Nick Kurshev&n; *&t;&t;&t;blanking, pan_display, and cmap fixes, 0.1.0&n; *&t;2001-10-10&t;Radeon 7500 and 8500 support, and experimental&n; *&t;&t;&t;flat panel support, 0.1.1&n; *&t;2001-11-17&t;Radeon M6 (ppc) support, Daniel Berlin, 0.1.2&n; *&t;2001-11-18&t;DFP fixes, Kevin Hendricks, 0.1.3&n; *&t;2001-11-29&t;more cmap, backlight fixes, Benjamin Herrenschmidt&n; *&t;2002-01-18&t;DFP panel detection via BIOS, Michael Clark, 0.1.4&n; *&t;2002-06-02&t;console switching, mode set fixes, accel fixes&n; *&t;2002-06-03&t;MTRR support, Peter Horton, 0.1.5&n; *&t;2002-09-21&t;rv250, r300, m9 initial support,&n; *&t;&t;&t;added mirror option, 0.1.6&n; *&n; *&t;Special thanks to ATI DevRel team for their hardware donations.&n; *&n; */
DECL|macro|RADEON_VERSION
mdefine_line|#define RADEON_VERSION&t;&quot;0.1.6&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#if defined(__powerpc__)
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &quot;macmodes.h&quot;
macro_line|#ifdef CONFIG_NVRAM
macro_line|#include &lt;linux/nvram.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
macro_line|#include &lt;asm/backlight.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_BOOTX_TEXT
macro_line|#include &lt;asm/btext.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_ADB_PMU
macro_line|#include &lt;linux/adb.h&gt;
macro_line|#include &lt;linux/pmu.h&gt;
macro_line|#endif
macro_line|#endif /* __powerpc__ */
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#include &lt;video/radeon.h&gt;
macro_line|#include &lt;linux/radeonfb.h&gt;
DECL|macro|DEBUG
mdefine_line|#define DEBUG&t;1
macro_line|#if DEBUG
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;printk
macro_line|#else
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;if(0) printk
macro_line|#endif
singleline_comment|// XXX
DECL|macro|CONFIG_PMAC_PBOOK
macro_line|#undef CONFIG_PMAC_PBOOK
DECL|enum|radeon_chips
r_enum
id|radeon_chips
(brace
DECL|enumerator|RADEON_QD
id|RADEON_QD
comma
DECL|enumerator|RADEON_QE
id|RADEON_QE
comma
DECL|enumerator|RADEON_QF
id|RADEON_QF
comma
DECL|enumerator|RADEON_QG
id|RADEON_QG
comma
DECL|enumerator|RADEON_QY
id|RADEON_QY
comma
DECL|enumerator|RADEON_QZ
id|RADEON_QZ
comma
DECL|enumerator|RADEON_LW
id|RADEON_LW
comma
DECL|enumerator|RADEON_LX
id|RADEON_LX
comma
DECL|enumerator|RADEON_LY
id|RADEON_LY
comma
DECL|enumerator|RADEON_LZ
id|RADEON_LZ
comma
DECL|enumerator|RADEON_QL
id|RADEON_QL
comma
DECL|enumerator|RADEON_QN
id|RADEON_QN
comma
DECL|enumerator|RADEON_QO
id|RADEON_QO
comma
DECL|enumerator|RADEON_Ql
id|RADEON_Ql
comma
DECL|enumerator|RADEON_BB
id|RADEON_BB
comma
DECL|enumerator|RADEON_QW
id|RADEON_QW
comma
DECL|enumerator|RADEON_QX
id|RADEON_QX
comma
DECL|enumerator|RADEON_Id
id|RADEON_Id
comma
DECL|enumerator|RADEON_Ie
id|RADEON_Ie
comma
DECL|enumerator|RADEON_If
id|RADEON_If
comma
DECL|enumerator|RADEON_Ig
id|RADEON_Ig
comma
DECL|enumerator|RADEON_Ya
id|RADEON_Ya
comma
DECL|enumerator|RADEON_Yd
id|RADEON_Yd
comma
DECL|enumerator|RADEON_Ld
id|RADEON_Ld
comma
DECL|enumerator|RADEON_Le
id|RADEON_Le
comma
DECL|enumerator|RADEON_Lf
id|RADEON_Lf
comma
DECL|enumerator|RADEON_Lg
id|RADEON_Lg
comma
DECL|enumerator|RADEON_ND
id|RADEON_ND
comma
DECL|enumerator|RADEON_NE
id|RADEON_NE
comma
DECL|enumerator|RADEON_NF
id|RADEON_NF
comma
DECL|enumerator|RADEON_NG
id|RADEON_NG
comma
DECL|enumerator|RADEON_QM
id|RADEON_QM
)brace
suffix:semicolon
DECL|enum|radeon_arch
r_enum
id|radeon_arch
(brace
DECL|enumerator|RADEON_R100
id|RADEON_R100
comma
DECL|enumerator|RADEON_RV100
id|RADEON_RV100
comma
DECL|enumerator|RADEON_R200
id|RADEON_R200
comma
DECL|enumerator|RADEON_RV200
id|RADEON_RV200
comma
DECL|enumerator|RADEON_RV250
id|RADEON_RV250
comma
DECL|enumerator|RADEON_R300
id|RADEON_R300
comma
DECL|enumerator|RADEON_M6
id|RADEON_M6
comma
DECL|enumerator|RADEON_M7
id|RADEON_M7
comma
DECL|enumerator|RADEON_M9
id|RADEON_M9
)brace
suffix:semicolon
DECL|struct|radeon_chip_info
r_static
r_struct
id|radeon_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|arch
r_int
r_char
id|arch
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|radeon_chip_info
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;QD&quot;
comma
id|RADEON_R100
)brace
comma
(brace
l_string|&quot;QE&quot;
comma
id|RADEON_R100
)brace
comma
(brace
l_string|&quot;QF&quot;
comma
id|RADEON_R100
)brace
comma
(brace
l_string|&quot;QG&quot;
comma
id|RADEON_R100
)brace
comma
(brace
l_string|&quot;VE QY&quot;
comma
id|RADEON_RV100
)brace
comma
(brace
l_string|&quot;VE QZ&quot;
comma
id|RADEON_RV100
)brace
comma
(brace
l_string|&quot;M7 LW&quot;
comma
id|RADEON_M7
)brace
comma
(brace
l_string|&quot;M7 LX&quot;
comma
id|RADEON_M7
)brace
comma
(brace
l_string|&quot;M6 LY&quot;
comma
id|RADEON_M6
)brace
comma
(brace
l_string|&quot;M6 LZ&quot;
comma
id|RADEON_M6
)brace
comma
(brace
l_string|&quot;8500 QL&quot;
comma
id|RADEON_R200
)brace
comma
(brace
l_string|&quot;8500 QN&quot;
comma
id|RADEON_R200
)brace
comma
(brace
l_string|&quot;8500 QO&quot;
comma
id|RADEON_R200
)brace
comma
(brace
l_string|&quot;8500 Ql&quot;
comma
id|RADEON_R200
)brace
comma
(brace
l_string|&quot;8500 BB&quot;
comma
id|RADEON_R200
)brace
comma
(brace
l_string|&quot;7500 QW&quot;
comma
id|RADEON_RV200
)brace
comma
(brace
l_string|&quot;7500 QX&quot;
comma
id|RADEON_RV200
)brace
comma
(brace
l_string|&quot;9000 Id&quot;
comma
id|RADEON_RV250
)brace
comma
(brace
l_string|&quot;9000 Ie&quot;
comma
id|RADEON_RV250
)brace
comma
(brace
l_string|&quot;9000 If&quot;
comma
id|RADEON_RV250
)brace
comma
(brace
l_string|&quot;9000 Ig&quot;
comma
id|RADEON_RV250
)brace
comma
(brace
l_string|&quot;M9 Ld&quot;
comma
id|RADEON_M9
)brace
comma
(brace
l_string|&quot;M9 Le&quot;
comma
id|RADEON_M9
)brace
comma
(brace
l_string|&quot;M9 Lf&quot;
comma
id|RADEON_M9
)brace
comma
(brace
l_string|&quot;M9 Lg&quot;
comma
id|RADEON_M9
)brace
comma
(brace
l_string|&quot;9700 ND&quot;
comma
id|RADEON_R300
)brace
comma
(brace
l_string|&quot;9700 NE&quot;
comma
id|RADEON_R300
)brace
comma
(brace
l_string|&quot;9700 NF&quot;
comma
id|RADEON_R300
)brace
comma
(brace
l_string|&quot;9700 NG&quot;
comma
id|RADEON_R300
)brace
comma
(brace
l_string|&quot;9100 QM&quot;
comma
id|RADEON_R200
)brace
)brace
suffix:semicolon
DECL|enum|radeon_montype
r_enum
id|radeon_montype
(brace
DECL|enumerator|MT_NONE
id|MT_NONE
comma
DECL|enumerator|MT_CRT
id|MT_CRT
comma
multiline_comment|/* CRT */
DECL|enumerator|MT_LCD
id|MT_LCD
comma
multiline_comment|/* LCD */
DECL|enumerator|MT_DFP
id|MT_DFP
comma
multiline_comment|/* DVI */
DECL|enumerator|MT_CTV
id|MT_CTV
comma
multiline_comment|/* composite TV */
DECL|enumerator|MT_STV
id|MT_STV
multiline_comment|/* S-Video out */
)brace
suffix:semicolon
DECL|variable|radeonfb_pci_table
r_static
r_struct
id|pci_device_id
id|radeonfb_pci_table
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QD
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QD
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QE
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QF
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QF
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QG
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QG
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QY
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QY
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QZ
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QZ
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_LW
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_LW
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_LX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_LX
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_LY
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_LY
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_LZ
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_LZ
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QL
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QN
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QN
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QO
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Ql
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Ql
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_BB
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_BB
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QW
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QW
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QX
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Id
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Id
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Ie
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Ie
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_If
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_If
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Ig
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Ig
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Ya
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Ya
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Yd
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Yd
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Ld
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Ld
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Le
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Le
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Lf
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Lf
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_Lg
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_Lg
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_ND
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_ND
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_NE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_NE
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_NF
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_NF
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_NG
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_NG
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_ATI_RADEON_QM
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QM
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|radeonfb_pci_table
)paren
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|reg
id|u16
id|reg
suffix:semicolon
DECL|member|val
id|u32
id|val
suffix:semicolon
DECL|typedef|reg_val
)brace
id|reg_val
suffix:semicolon
multiline_comment|/* these common regs are cleared before mode setting so they do not&n; * interfere with anything&n; */
DECL|variable|common_regs
r_static
id|reg_val
id|common_regs
(braket
)braket
op_assign
(brace
(brace
id|OVR_CLR
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_LEFT_RIGHT
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_TOP_BOTTOM
comma
l_int|0
)brace
comma
(brace
id|OV0_SCALE_CNTL
comma
l_int|0
)brace
comma
(brace
id|SUBPIC_CNTL
comma
l_int|0
)brace
comma
(brace
id|VIPH_CONTROL
comma
l_int|0
)brace
comma
(brace
id|I2C_CNTL_1
comma
l_int|0
)brace
comma
(brace
id|GEN_INT_CNTL
comma
l_int|0
)brace
comma
(brace
id|CAP0_TRIG_CNTL
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|variable|common_regs_m6
r_static
id|reg_val
id|common_regs_m6
(braket
)braket
op_assign
(brace
(brace
id|OVR_CLR
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_LEFT_RIGHT
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_TOP_BOTTOM
comma
l_int|0
)brace
comma
(brace
id|OV0_SCALE_CNTL
comma
l_int|0
)brace
comma
(brace
id|SUBPIC_CNTL
comma
l_int|0
)brace
comma
(brace
id|GEN_INT_CNTL
comma
l_int|0
)brace
comma
(brace
id|CAP0_TRIG_CNTL
comma
l_int|0
)brace
)brace
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|clock_chip_type
id|u8
id|clock_chip_type
suffix:semicolon
DECL|member|struct_size
id|u8
id|struct_size
suffix:semicolon
DECL|member|accelerator_entry
id|u8
id|accelerator_entry
suffix:semicolon
DECL|member|VGA_entry
id|u8
id|VGA_entry
suffix:semicolon
DECL|member|VGA_table_offset
id|u16
id|VGA_table_offset
suffix:semicolon
DECL|member|POST_table_offset
id|u16
id|POST_table_offset
suffix:semicolon
DECL|member|XCLK
id|u16
id|XCLK
suffix:semicolon
DECL|member|MCLK
id|u16
id|MCLK
suffix:semicolon
DECL|member|num_PLL_blocks
id|u8
id|num_PLL_blocks
suffix:semicolon
DECL|member|size_PLL_blocks
id|u8
id|size_PLL_blocks
suffix:semicolon
DECL|member|PCLK_ref_freq
id|u16
id|PCLK_ref_freq
suffix:semicolon
DECL|member|PCLK_ref_divider
id|u16
id|PCLK_ref_divider
suffix:semicolon
DECL|member|PCLK_min_freq
id|u32
id|PCLK_min_freq
suffix:semicolon
DECL|member|PCLK_max_freq
id|u32
id|PCLK_max_freq
suffix:semicolon
DECL|member|MCLK_ref_freq
id|u16
id|MCLK_ref_freq
suffix:semicolon
DECL|member|MCLK_ref_divider
id|u16
id|MCLK_ref_divider
suffix:semicolon
DECL|member|MCLK_min_freq
id|u32
id|MCLK_min_freq
suffix:semicolon
DECL|member|MCLK_max_freq
id|u32
id|MCLK_max_freq
suffix:semicolon
DECL|member|XCLK_ref_freq
id|u16
id|XCLK_ref_freq
suffix:semicolon
DECL|member|XCLK_ref_divider
id|u16
id|XCLK_ref_divider
suffix:semicolon
DECL|member|XCLK_min_freq
id|u32
id|XCLK_min_freq
suffix:semicolon
DECL|member|XCLK_max_freq
id|u32
id|XCLK_max_freq
suffix:semicolon
DECL|typedef|PLL_BLOCK
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|PLL_BLOCK
suffix:semicolon
DECL|struct|pll_info
r_struct
id|pll_info
(brace
DECL|member|ppll_max
r_int
id|ppll_max
suffix:semicolon
DECL|member|ppll_min
r_int
id|ppll_min
suffix:semicolon
DECL|member|xclk
r_int
id|xclk
suffix:semicolon
DECL|member|ref_div
r_int
id|ref_div
suffix:semicolon
DECL|member|ref_clk
r_int
id|ref_clk
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ram_info
r_struct
id|ram_info
(brace
DECL|member|ml
r_int
id|ml
suffix:semicolon
DECL|member|mb
r_int
id|mb
suffix:semicolon
DECL|member|trcd
r_int
id|trcd
suffix:semicolon
DECL|member|trp
r_int
id|trp
suffix:semicolon
DECL|member|twr
r_int
id|twr
suffix:semicolon
DECL|member|cl
r_int
id|cl
suffix:semicolon
DECL|member|tr2w
r_int
id|tr2w
suffix:semicolon
DECL|member|loop_latency
r_int
id|loop_latency
suffix:semicolon
DECL|member|rloop
r_int
id|rloop
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|radeon_regs
r_struct
id|radeon_regs
(brace
multiline_comment|/* CRTC regs */
DECL|member|crtc_h_total_disp
id|u32
id|crtc_h_total_disp
suffix:semicolon
DECL|member|crtc_h_sync_strt_wid
id|u32
id|crtc_h_sync_strt_wid
suffix:semicolon
DECL|member|crtc_v_total_disp
id|u32
id|crtc_v_total_disp
suffix:semicolon
DECL|member|crtc_v_sync_strt_wid
id|u32
id|crtc_v_sync_strt_wid
suffix:semicolon
DECL|member|crtc_pitch
id|u32
id|crtc_pitch
suffix:semicolon
DECL|member|crtc_gen_cntl
id|u32
id|crtc_gen_cntl
suffix:semicolon
DECL|member|crtc_ext_cntl
id|u32
id|crtc_ext_cntl
suffix:semicolon
DECL|member|dac_cntl
id|u32
id|dac_cntl
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|pix_clock
id|u32
id|pix_clock
suffix:semicolon
DECL|member|xres
DECL|member|yres
r_int
id|xres
comma
id|yres
suffix:semicolon
multiline_comment|/* DDA regs */
DECL|member|dda_config
id|u32
id|dda_config
suffix:semicolon
DECL|member|dda_on_off
id|u32
id|dda_on_off
suffix:semicolon
multiline_comment|/* PLL regs */
DECL|member|ppll_div_3
id|u32
id|ppll_div_3
suffix:semicolon
DECL|member|ppll_ref_div
id|u32
id|ppll_ref_div
suffix:semicolon
DECL|member|vclk_ecp_cntl
id|u32
id|vclk_ecp_cntl
suffix:semicolon
multiline_comment|/* Flat panel regs */
DECL|member|fp_crtc_h_total_disp
id|u32
id|fp_crtc_h_total_disp
suffix:semicolon
DECL|member|fp_crtc_v_total_disp
id|u32
id|fp_crtc_v_total_disp
suffix:semicolon
DECL|member|fp_gen_cntl
id|u32
id|fp_gen_cntl
suffix:semicolon
DECL|member|fp_h_sync_strt_wid
id|u32
id|fp_h_sync_strt_wid
suffix:semicolon
DECL|member|fp_horz_stretch
id|u32
id|fp_horz_stretch
suffix:semicolon
DECL|member|fp_panel_cntl
id|u32
id|fp_panel_cntl
suffix:semicolon
DECL|member|fp_v_sync_strt_wid
id|u32
id|fp_v_sync_strt_wid
suffix:semicolon
DECL|member|fp_vert_stretch
id|u32
id|fp_vert_stretch
suffix:semicolon
DECL|member|lvds_gen_cntl
id|u32
id|lvds_gen_cntl
suffix:semicolon
DECL|member|lvds_pll_cntl
id|u32
id|lvds_pll_cntl
suffix:semicolon
DECL|member|tmds_crc
id|u32
id|tmds_crc
suffix:semicolon
DECL|member|tmds_transmitter_cntl
id|u32
id|tmds_transmitter_cntl
suffix:semicolon
macro_line|#if defined(__BIG_ENDIAN)
DECL|member|surface_cntl
id|u32
id|surface_cntl
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|struct|radeonfb_info
r_struct
id|radeonfb_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|state
r_struct
id|radeon_regs
id|state
suffix:semicolon
DECL|member|init_state
r_struct
id|radeon_regs
id|init_state
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|ram_type
r_char
id|ram_type
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|mmio_base_phys
r_int
r_int
id|mmio_base_phys
suffix:semicolon
DECL|member|fb_base_phys
r_int
r_int
id|fb_base_phys
suffix:semicolon
DECL|member|mmio_base
r_void
id|__iomem
op_star
id|mmio_base
suffix:semicolon
DECL|member|fb_base
r_void
id|__iomem
op_star
id|fb_base
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|EDID
r_int
r_char
op_star
id|EDID
suffix:semicolon
DECL|member|bios_seg
r_int
r_char
id|__iomem
op_star
id|bios_seg
suffix:semicolon
DECL|member|pseudo_palette
id|u32
id|pseudo_palette
(braket
l_int|17
)braket
suffix:semicolon
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
DECL|member|palette
r_struct
(brace
id|u8
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|chipset
r_int
id|chipset
suffix:semicolon
DECL|member|arch
r_int
r_char
id|arch
suffix:semicolon
DECL|member|video_ram
r_int
id|video_ram
suffix:semicolon
DECL|member|rev
id|u8
id|rev
suffix:semicolon
DECL|member|pitch
DECL|member|bpp
DECL|member|depth
r_int
id|pitch
comma
id|bpp
comma
id|depth
suffix:semicolon
DECL|member|xres
DECL|member|yres
DECL|member|pixclock
r_int
id|xres
comma
id|yres
comma
id|pixclock
suffix:semicolon
DECL|member|xres_virtual
DECL|member|yres_virtual
r_int
id|xres_virtual
comma
id|yres_virtual
suffix:semicolon
DECL|member|accel_flags
id|u32
id|accel_flags
suffix:semicolon
DECL|member|use_default_var
r_int
id|use_default_var
suffix:semicolon
DECL|member|got_dfpinfo
r_int
id|got_dfpinfo
suffix:semicolon
DECL|member|hasCRTC2
r_int
id|hasCRTC2
suffix:semicolon
DECL|member|crtDisp_type
r_int
id|crtDisp_type
suffix:semicolon
DECL|member|dviDisp_type
r_int
id|dviDisp_type
suffix:semicolon
DECL|member|panel_xres
DECL|member|panel_yres
r_int
id|panel_xres
comma
id|panel_yres
suffix:semicolon
DECL|member|clock
r_int
id|clock
suffix:semicolon
DECL|member|hOver_plus
DECL|member|hSync_width
DECL|member|hblank
r_int
id|hOver_plus
comma
id|hSync_width
comma
id|hblank
suffix:semicolon
DECL|member|vOver_plus
DECL|member|vSync_width
DECL|member|vblank
r_int
id|vOver_plus
comma
id|vSync_width
comma
id|vblank
suffix:semicolon
DECL|member|hAct_high
DECL|member|vAct_high
DECL|member|interlaced
r_int
id|hAct_high
comma
id|vAct_high
comma
id|interlaced
suffix:semicolon
DECL|member|synct
DECL|member|misc
r_int
id|synct
comma
id|misc
suffix:semicolon
DECL|member|dp_gui_master_cntl
id|u32
id|dp_gui_master_cntl
suffix:semicolon
DECL|member|pll
r_struct
id|pll_info
id|pll
suffix:semicolon
DECL|member|pll_output_freq
DECL|member|post_div
DECL|member|fb_div
r_int
id|pll_output_freq
comma
id|post_div
comma
id|fb_div
suffix:semicolon
DECL|member|ram
r_struct
id|ram_info
id|ram
suffix:semicolon
DECL|member|mtrr_hdl
r_int
id|mtrr_hdl
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
DECL|member|pm_reg
r_int
id|pm_reg
suffix:semicolon
DECL|member|save_regs
id|u32
id|save_regs
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|mdll
DECL|member|mdll2
id|u32
id|mdll
comma
id|mdll2
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
DECL|member|asleep
r_int
id|asleep
suffix:semicolon
DECL|member|next
r_struct
id|radeonfb_info
op_star
id|next
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|radeonfb_default_var
r_static
r_struct
id|fb_var_screeninfo
id|radeonfb_default_var
op_assign
(brace
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|39721
comma
l_int|40
comma
l_int|24
comma
l_int|32
comma
l_int|11
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
multiline_comment|/*&n; * IO macros&n; */
DECL|macro|INREG8
mdefine_line|#define INREG8(addr)&t;&t;readb((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG8
mdefine_line|#define OUTREG8(addr,val)&t;writeb(val, (rinfo-&gt;mmio_base)+addr)
DECL|macro|INREG
mdefine_line|#define INREG(addr)&t;&t;readl((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG
mdefine_line|#define OUTREG(addr,val)&t;writel(val, (rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTPLL
mdefine_line|#define OUTPLL(addr,val)&t;&bslash;&n;&t;do {&t;&bslash;&n;&t;&t;OUTREG8(CLOCK_CNTL_INDEX, (addr &amp; 0x0000003f) | 0x00000080); &bslash;&n;&t;&t;OUTREG(CLOCK_CNTL_DATA, val); &bslash;&n;&t;} while(0)
DECL|macro|OUTPLLP
mdefine_line|#define OUTPLLP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned int _tmp = INPLL(addr);&t;&t;&t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;OUTPLL(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|macro|OUTREGP
mdefine_line|#define OUTREGP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned int _tmp = INREG(addr);&t;&t;&t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;OUTREG(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|function|_INPLL
r_static
id|__inline__
id|u32
id|_INPLL
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|addr
)paren
(brace
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|addr
op_amp
l_int|0x0000003f
)paren
suffix:semicolon
r_return
(paren
id|INREG
c_func
(paren
id|CLOCK_CNTL_DATA
)paren
)paren
suffix:semicolon
)brace
DECL|macro|INPLL
mdefine_line|#define INPLL(addr)&t;&t;_INPLL(rinfo, addr)
DECL|macro|PRIMARY_MONITOR
mdefine_line|#define PRIMARY_MONITOR(rinfo)&t;((rinfo-&gt;dviDisp_type != MT_NONE) &amp;&amp;&t;&bslash;&n;&t;&t;&t;&t; (rinfo-&gt;dviDisp_type != MT_STV) &amp;&amp;&t;&bslash;&n;&t;&t;&t;&t; (rinfo-&gt;dviDisp_type != MT_CTV) ?&t;&bslash;&n;&t;&t;&t;&t; rinfo-&gt;dviDisp_type : rinfo-&gt;crtDisp_type)
DECL|function|GET_MON_NAME
r_static
r_char
op_star
id|GET_MON_NAME
c_func
(paren
r_int
id|type
)paren
(brace
r_char
op_star
id|pret
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|MT_NONE
suffix:colon
id|pret
op_assign
l_string|&quot;no&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_CRT
suffix:colon
id|pret
op_assign
l_string|&quot;CRT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_DFP
suffix:colon
id|pret
op_assign
l_string|&quot;DFP&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_LCD
suffix:colon
id|pret
op_assign
l_string|&quot;LCD&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_CTV
suffix:colon
id|pret
op_assign
l_string|&quot;CTV&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_STV
suffix:colon
id|pret
op_assign
l_string|&quot;STV&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|pret
suffix:semicolon
)brace
multiline_comment|/*&n; * 2D engine routines&n; */
DECL|function|radeon_engine_flush
r_static
id|__inline__
r_void
id|radeon_engine_flush
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* initiate flush */
id|OUTREGP
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
comma
id|RB2D_DC_FLUSH_ALL
comma
op_complement
id|RB2D_DC_FLUSH_ALL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|INREG
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
)paren
op_amp
id|RB2D_DC_BUSY
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|_radeon_fifo_wait
r_static
id|__inline__
r_void
id|_radeon_fifo_wait
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|entries
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
l_int|0x7f
)paren
op_ge
id|entries
)paren
r_return
suffix:semicolon
)brace
DECL|function|_radeon_engine_idle
r_static
id|__inline__
r_void
id|_radeon_engine_idle
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* ensure FIFO is empty before waiting for idle */
id|_radeon_fifo_wait
(paren
id|rinfo
comma
l_int|64
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
id|GUI_ACTIVE
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|radeon_engine_flush
(paren
id|rinfo
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
DECL|macro|radeon_engine_idle
mdefine_line|#define radeon_engine_idle()&t;&t;_radeon_engine_idle(rinfo)
DECL|macro|radeon_fifo_wait
mdefine_line|#define radeon_fifo_wait(entries)&t;_radeon_fifo_wait(rinfo,entries)
multiline_comment|/*&n; * helper routines&n; */
DECL|function|radeon_get_dstbpp
r_static
id|__inline__
id|u32
id|radeon_get_dstbpp
c_func
(paren
id|u16
id|depth
)paren
(brace
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
id|DST_8BPP
suffix:semicolon
r_case
l_int|15
suffix:colon
r_return
id|DST_15BPP
suffix:semicolon
r_case
l_int|16
suffix:colon
r_return
id|DST_16BPP
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
id|DST_32BPP
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|var_to_depth
r_static
r_inline
r_int
id|var_to_depth
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_ne
l_int|16
)paren
r_return
id|var-&gt;bits_per_pixel
suffix:semicolon
r_return
(paren
id|var-&gt;green.length
op_eq
l_int|6
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|15
suffix:semicolon
)brace
DECL|function|_radeon_engine_reset
r_static
r_void
id|_radeon_engine_reset
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|clock_cntl_index
comma
id|mclk_cntl
comma
id|rbbm_soft_reset
suffix:semicolon
id|radeon_engine_flush
(paren
id|rinfo
)paren
suffix:semicolon
id|clock_cntl_index
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
suffix:semicolon
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
(paren
id|mclk_cntl
op_or
id|FORCEON_MCLKA
op_or
id|FORCEON_MCLKB
op_or
id|FORCEON_YCLKA
op_or
id|FORCEON_YCLKB
op_or
id|FORCEON_MC
op_or
id|FORCEON_AIC
)paren
)paren
suffix:semicolon
id|rbbm_soft_reset
op_assign
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
op_or
id|SOFT_RESET_CP
op_or
id|SOFT_RESET_HI
op_or
id|SOFT_RESET_SE
op_or
id|SOFT_RESET_RE
op_or
id|SOFT_RESET_PP
op_or
id|SOFT_RESET_E2
op_or
id|SOFT_RESET_RB
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
op_amp
(paren
id|u32
)paren
op_complement
(paren
id|SOFT_RESET_CP
op_or
id|SOFT_RESET_HI
op_or
id|SOFT_RESET_SE
op_or
id|SOFT_RESET_RE
op_or
id|SOFT_RESET_PP
op_or
id|SOFT_RESET_E2
op_or
id|SOFT_RESET_RB
)paren
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|mclk_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|clock_cntl_index
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|macro|radeon_engine_reset
mdefine_line|#define radeon_engine_reset()&t;&t;_radeon_engine_reset(rinfo)
DECL|function|round_div
r_static
id|__inline__
r_int
id|round_div
c_func
(paren
r_int
id|num
comma
r_int
id|den
)paren
(brace
r_return
(paren
id|num
op_plus
(paren
id|den
op_div
l_int|2
)paren
)paren
op_div
id|den
suffix:semicolon
)brace
DECL|function|min_bits_req
r_static
id|__inline__
r_int
id|min_bits_req
c_func
(paren
r_int
id|val
)paren
(brace
r_int
id|bits_req
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|0
)paren
id|bits_req
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|val
)paren
(brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
id|bits_req
op_increment
suffix:semicolon
)brace
r_return
(paren
id|bits_req
)paren
suffix:semicolon
)brace
DECL|function|_max
r_static
id|__inline__
r_int
id|_max
c_func
(paren
r_int
id|val1
comma
r_int
id|val2
)paren
(brace
r_if
c_cond
(paren
id|val1
op_ge
id|val2
)paren
r_return
id|val1
suffix:semicolon
r_else
r_return
id|val2
suffix:semicolon
)brace
multiline_comment|/*&n; * globals&n; */
DECL|variable|__initdata
r_static
r_char
op_star
id|mode_option
id|__initdata
suffix:semicolon
DECL|variable|noaccel
r_static
r_char
id|noaccel
op_assign
l_int|0
suffix:semicolon
DECL|variable|mirror
r_static
r_char
id|mirror
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|panel_yres
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|force_dfp
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|board_list
r_static
r_struct
id|radeonfb_info
op_star
id|board_list
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|nomtrr
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; * prototypes&n; */
r_static
r_void
id|radeon_save_state
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|save
)paren
suffix:semicolon
r_static
r_void
id|radeon_engine_init
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_write_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|mode
)paren
suffix:semicolon
r_static
r_int
id|__devinit
id|radeon_set_fbinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|__devinit
id|radeon_init_disp
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_init_disp_var
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
r_static
r_void
id|__iomem
op_star
id|radeon_find_rom
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_get_pllinfo
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_void
id|__iomem
op_star
id|bios_seg
)paren
suffix:semicolon
r_static
r_void
id|radeon_get_moninfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_get_dfpinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_get_dfpinfo_BIOS
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_get_EDID
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_dfp_parse_EDID
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_update_default_var
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_OF
r_static
r_int
id|radeon_read_OF
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_get_EDID_OF
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_struct
id|device_node
op_star
id|pci_device_to_OF_node
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
r_int
id|radeon_sleep_notify
c_func
(paren
r_struct
id|pmu_sleep_notifier
op_star
id|self
comma
r_int
id|when
)paren
suffix:semicolon
DECL|variable|radeon_sleep_notifier
r_static
r_struct
id|pmu_sleep_notifier
id|radeon_sleep_notifier
op_assign
(brace
id|radeon_sleep_notify
comma
id|SLEEP_LEVEL_VIDEO
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_static
r_int
id|radeon_set_backlight_enable
c_func
(paren
r_int
id|on
comma
r_int
id|level
comma
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|radeon_set_backlight_level
c_func
(paren
r_int
id|level
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|variable|radeon_backlight_controller
r_static
r_struct
id|backlight_controller
id|radeon_backlight_controller
op_assign
(brace
id|radeon_set_backlight_enable
comma
id|radeon_set_backlight_level
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
macro_line|#endif /* CONFIG_PPC_OF */
DECL|function|radeon_find_rom
r_static
r_void
id|__iomem
op_star
id|radeon_find_rom
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
macro_line|#if defined(__i386__)
id|u32
id|segstart
suffix:semicolon
r_char
id|__iomem
op_star
id|rom_base
suffix:semicolon
r_char
id|__iomem
op_star
id|rom
suffix:semicolon
r_int
id|stage
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_char
id|aty_rom_sig
(braket
)braket
op_assign
l_string|&quot;761295520&quot;
suffix:semicolon
r_char
op_star
id|radeon_sig
(braket
)braket
op_assign
(brace
l_string|&quot;RG6&quot;
comma
l_string|&quot;RADEON&quot;
)brace
suffix:semicolon
r_for
c_loop
(paren
id|segstart
op_assign
l_int|0x000c0000
suffix:semicolon
id|segstart
OL
l_int|0x000f0000
suffix:semicolon
id|segstart
op_add_assign
l_int|0x00001000
)paren
(brace
id|stage
op_assign
l_int|1
suffix:semicolon
id|rom_base
op_assign
id|ioremap
c_func
(paren
id|segstart
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|rom_base
op_eq
l_int|0x55
)paren
op_logical_and
(paren
(paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xff
)paren
op_eq
l_int|0xaa
)paren
)paren
id|stage
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stage
op_ne
l_int|2
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|128
op_minus
id|strlen
c_func
(paren
id|aty_rom_sig
)paren
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|3
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aty_rom_sig
(braket
l_int|0
)braket
op_eq
op_star
id|rom
)paren
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|aty_rom_sig
comma
id|rom
comma
id|strlen
c_func
(paren
id|aty_rom_sig
)paren
)paren
op_eq
l_int|0
)paren
id|stage
op_assign
l_int|3
suffix:semicolon
id|rom
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|3
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|512
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
r_sizeof
(paren
id|radeon_sig
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|radeon_sig
(braket
id|j
)braket
(braket
l_int|0
)braket
op_eq
op_star
id|rom
)paren
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|radeon_sig
(braket
id|j
)braket
comma
id|rom
comma
id|strlen
c_func
(paren
id|radeon_sig
(braket
id|j
)braket
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|stage
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|rom
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|4
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
id|rom_base
suffix:semicolon
)brace
macro_line|#endif          
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|radeon_get_pllinfo
r_static
r_void
id|radeon_get_pllinfo
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_void
id|__iomem
op_star
id|bios_seg
)paren
(brace
r_void
id|__iomem
op_star
id|bios_header
suffix:semicolon
r_void
id|__iomem
op_star
id|header_ptr
suffix:semicolon
id|u16
id|bios_header_offset
comma
id|pll_info_offset
suffix:semicolon
id|PLL_BLOCK
id|pll
suffix:semicolon
r_if
c_cond
(paren
id|bios_seg
)paren
(brace
id|bios_header
op_assign
id|bios_seg
op_plus
l_int|0x48L
suffix:semicolon
id|header_ptr
op_assign
id|bios_header
suffix:semicolon
id|bios_header_offset
op_assign
id|readw
c_func
(paren
id|header_ptr
)paren
suffix:semicolon
id|bios_header
op_assign
id|bios_seg
op_plus
id|bios_header_offset
suffix:semicolon
id|bios_header
op_add_assign
l_int|0x30
suffix:semicolon
id|header_ptr
op_assign
id|bios_header
suffix:semicolon
id|pll_info_offset
op_assign
id|readw
c_func
(paren
id|header_ptr
)paren
suffix:semicolon
id|header_ptr
op_assign
id|bios_seg
op_plus
id|pll_info_offset
suffix:semicolon
id|memcpy_fromio
c_func
(paren
op_amp
id|pll
comma
id|header_ptr
comma
l_int|50
)paren
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
(paren
id|u32
)paren
id|pll.XCLK
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
(paren
id|u32
)paren
id|pll.PCLK_ref_freq
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
(paren
id|u32
)paren
id|pll.PCLK_ref_divider
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
id|pll.PCLK_min_freq
suffix:semicolon
id|rinfo-&gt;pll.ppll_max
op_assign
id|pll.PCLK_max_freq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: ref_clk=%d, ref_div=%d, xclk=%d from BIOS&bslash;n&quot;
comma
id|rinfo-&gt;pll.ref_clk
comma
id|rinfo-&gt;pll.ref_div
comma
id|rinfo-&gt;pll.xclk
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef CONFIG_PPC_OF
r_if
c_cond
(paren
id|radeon_read_OF
c_func
(paren
id|rinfo
)paren
)paren
(brace
r_int
r_int
id|tmp
comma
id|Nx
comma
id|M
comma
id|ref_div
comma
id|xclk
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|ref_div
op_assign
id|INPLL
c_func
(paren
id|PPLL_REF_DIV
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|Nx
op_assign
(paren
id|tmp
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|M
op_assign
(paren
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|xclk
op_assign
(paren
(paren
(paren
(paren
l_int|2
op_star
id|Nx
op_star
id|rinfo-&gt;pll.ref_clk
)paren
op_plus
(paren
id|M
)paren
)paren
op_div
(paren
l_int|2
op_star
id|M
)paren
)paren
)paren
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
id|xclk
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
id|ref_div
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: ref_clk=%d, ref_div=%d, xclk=%d from OF&bslash;n&quot;
comma
id|rinfo-&gt;pll.ref_clk
comma
id|rinfo-&gt;pll.ref_div
comma
id|rinfo-&gt;pll.xclk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* no BIOS or BIOS not found, use defaults */
r_switch
c_cond
(paren
id|rinfo-&gt;chipset
)paren
(brace
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QW
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QX
suffix:colon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|23000
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|12
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QL
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QN
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QO
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_Ql
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_BB
suffix:colon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|27500
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|12
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_Id
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_Ie
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_If
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_Ig
suffix:colon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|25000
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|12
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_ND
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_NE
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_NF
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_NG
suffix:colon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|40000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|20000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|27000
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|12
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QD
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QE
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QF
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_QG
suffix:colon
r_default
suffix:colon
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|16600
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|67
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: ref_clk=%d, ref_div=%d, xclk=%d defaults&bslash;n&quot;
comma
id|rinfo-&gt;pll.ref_clk
comma
id|rinfo-&gt;pll.ref_div
comma
id|rinfo-&gt;pll.xclk
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeon_get_moninfo
r_static
r_void
id|radeon_get_moninfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|force_dfp
)paren
(brace
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_DFP
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|BIOS_4_SCRATCH
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeon_get_moninfo: bios 4 scratch = %x&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;hasCRTC2
)paren
(brace
multiline_comment|/* primary DVI port */
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x08
)paren
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_DFP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x4
)paren
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x200
)paren
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_CRT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x10
)paren
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_CTV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x20
)paren
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_STV
suffix:semicolon
multiline_comment|/* secondary CRT port */
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x2
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_CRT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x800
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_DFP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x400
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_LCD
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x1000
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_CTV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x2000
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_STV
suffix:semicolon
)brace
r_else
(brace
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_NONE
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|FP_EN_TMDS
)paren
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_DFP
suffix:semicolon
r_else
id|rinfo-&gt;crtDisp_type
op_assign
id|MT_CRT
suffix:semicolon
)brace
)brace
DECL|function|radeon_get_EDID
r_static
r_void
id|radeon_get_EDID
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
macro_line|#ifdef CONFIG_PPC_OF
r_if
c_cond
(paren
op_logical_neg
id|radeon_get_EDID_OF
c_func
(paren
id|rinfo
)paren
)paren
id|RTRACE
c_func
(paren
l_string|&quot;radeonfb: could not retrieve EDID from OF&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* XXX use other methods later */
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_PPC_OF
DECL|function|radeon_get_EDID_OF
r_static
r_int
id|radeon_get_EDID_OF
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|device_node
op_star
id|dp
suffix:semicolon
r_int
r_char
op_star
id|pedid
op_assign
l_int|NULL
suffix:semicolon
r_static
r_char
op_star
id|propnames
(braket
)braket
op_assign
(brace
l_string|&quot;DFP,EDID&quot;
comma
l_string|&quot;LCD,EDID&quot;
comma
l_string|&quot;EDID&quot;
comma
l_string|&quot;EDID1&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dp
op_assign
id|pci_device_to_OF_node
c_func
(paren
id|rinfo-&gt;pdev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dp
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|propnames
(braket
id|i
)braket
op_ne
l_int|NULL
suffix:semicolon
op_increment
id|i
)paren
(brace
id|pedid
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_property
c_func
(paren
id|dp
comma
id|propnames
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pedid
op_ne
l_int|NULL
)paren
(brace
id|rinfo-&gt;EDID
op_assign
id|pedid
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
id|dp
op_assign
id|dp-&gt;child
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PPC_OF */
DECL|function|radeon_dfp_parse_EDID
r_static
r_int
id|radeon_dfp_parse_EDID
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
r_char
op_star
id|block
op_assign
id|rinfo-&gt;EDID
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|block
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* jump to the detailed timing block section */
id|block
op_add_assign
l_int|54
suffix:semicolon
id|rinfo-&gt;clock
op_assign
(paren
id|block
(braket
l_int|0
)braket
op_plus
(paren
id|block
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|rinfo-&gt;panel_xres
op_assign
(paren
id|block
(braket
l_int|2
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|4
)braket
op_amp
l_int|0xf0
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|rinfo-&gt;hblank
op_assign
(paren
id|block
(braket
l_int|3
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|4
)braket
op_amp
l_int|0x0f
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|rinfo-&gt;panel_yres
op_assign
(paren
id|block
(braket
l_int|5
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|7
)braket
op_amp
l_int|0xf0
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|rinfo-&gt;vblank
op_assign
(paren
id|block
(braket
l_int|6
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|7
)braket
op_amp
l_int|0x0f
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|rinfo-&gt;hOver_plus
op_assign
(paren
id|block
(braket
l_int|8
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|11
)braket
op_amp
l_int|0xc0
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|rinfo-&gt;hSync_width
op_assign
(paren
id|block
(braket
l_int|9
)braket
op_plus
(paren
(paren
id|block
(braket
l_int|11
)braket
op_amp
l_int|0x30
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|rinfo-&gt;vOver_plus
op_assign
(paren
(paren
id|block
(braket
l_int|10
)braket
op_rshift
l_int|4
)paren
op_plus
(paren
(paren
id|block
(braket
l_int|11
)braket
op_amp
l_int|0x0c
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|rinfo-&gt;vSync_width
op_assign
(paren
(paren
id|block
(braket
l_int|10
)braket
op_amp
l_int|0x0f
)paren
op_plus
(paren
(paren
id|block
(braket
l_int|11
)braket
op_amp
l_int|0x03
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|rinfo-&gt;interlaced
op_assign
(paren
(paren
id|block
(braket
l_int|17
)braket
op_amp
l_int|0x80
)paren
op_rshift
l_int|7
)paren
suffix:semicolon
id|rinfo-&gt;synct
op_assign
(paren
(paren
id|block
(braket
l_int|17
)braket
op_amp
l_int|0x18
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|rinfo-&gt;misc
op_assign
(paren
(paren
id|block
(braket
l_int|17
)braket
op_amp
l_int|0x06
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|rinfo-&gt;hAct_high
op_assign
id|rinfo-&gt;vAct_high
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;synct
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;misc
op_amp
l_int|2
)paren
id|rinfo-&gt;hAct_high
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;misc
op_amp
l_int|1
)paren
id|rinfo-&gt;vAct_high
op_assign
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: detected DFP panel size from EDID: %dx%d&bslash;n&quot;
comma
id|rinfo-&gt;panel_xres
comma
id|rinfo-&gt;panel_yres
)paren
suffix:semicolon
id|rinfo-&gt;got_dfpinfo
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|radeon_update_default_var
r_static
r_void
id|radeon_update_default_var
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|radeonfb_default_var
suffix:semicolon
id|var-&gt;xres
op_assign
id|rinfo-&gt;panel_xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|rinfo-&gt;panel_yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|rinfo-&gt;panel_xres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|rinfo-&gt;panel_yres
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|var-&gt;pixclock
op_assign
l_int|100000000
op_div
id|rinfo-&gt;clock
suffix:semicolon
id|var-&gt;left_margin
op_assign
(paren
id|rinfo-&gt;hblank
op_minus
id|rinfo-&gt;hOver_plus
op_minus
id|rinfo-&gt;hSync_width
)paren
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|rinfo-&gt;hOver_plus
suffix:semicolon
id|var-&gt;upper_margin
op_assign
(paren
id|rinfo-&gt;vblank
op_minus
id|rinfo-&gt;vOver_plus
op_minus
id|rinfo-&gt;vSync_width
)paren
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|rinfo-&gt;vOver_plus
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|rinfo-&gt;hSync_width
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|rinfo-&gt;vSync_width
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;synct
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;hAct_high
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;vAct_high
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
)brace
id|var-&gt;vmode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;interlaced
)paren
id|var-&gt;vmode
op_or_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
id|rinfo-&gt;use_default_var
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|radeon_get_dfpinfo_BIOS
r_static
r_int
id|radeon_get_dfpinfo_BIOS
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_char
id|__iomem
op_star
id|fpbiosstart
comma
op_star
id|tmp
comma
op_star
id|tmp0
suffix:semicolon
r_char
id|stmp
(braket
l_int|30
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;bios_seg
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fpbiosstart
op_assign
id|rinfo-&gt;bios_seg
op_plus
id|readw
c_func
(paren
id|rinfo-&gt;bios_seg
op_plus
l_int|0x48
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: Failed to detect DFP panel info using BIOS&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_assign
id|rinfo-&gt;bios_seg
op_plus
id|readw
c_func
(paren
id|fpbiosstart
op_plus
l_int|0x40
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: Failed to detect DFP panel info using BIOS&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|24
suffix:semicolon
id|i
op_increment
)paren
(brace
id|stmp
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
id|tmp
op_plus
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
id|stmp
(braket
l_int|24
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: panel ID string: %s&bslash;n&quot;
comma
id|stmp
)paren
suffix:semicolon
id|rinfo-&gt;panel_xres
op_assign
id|readw
c_func
(paren
id|tmp
op_plus
l_int|25
)paren
suffix:semicolon
id|rinfo-&gt;panel_yres
op_assign
id|readw
c_func
(paren
id|tmp
op_plus
l_int|27
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: detected DFP panel size from BIOS: %dx%d&bslash;n&quot;
comma
id|rinfo-&gt;panel_xres
comma
id|rinfo-&gt;panel_yres
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp0
op_assign
id|rinfo-&gt;bios_seg
op_plus
id|readw
c_func
(paren
id|tmp
op_plus
l_int|64
op_plus
id|i
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp0
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|readw
c_func
(paren
id|tmp0
)paren
op_eq
id|rinfo-&gt;panel_xres
)paren
op_logical_and
(paren
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|2
)paren
op_eq
id|rinfo-&gt;panel_yres
)paren
)paren
(brace
id|rinfo-&gt;hblank
op_assign
(paren
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|17
)paren
op_minus
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|19
)paren
)paren
op_star
l_int|8
suffix:semicolon
id|rinfo-&gt;hOver_plus
op_assign
(paren
(paren
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|21
)paren
op_minus
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|19
)paren
op_minus
l_int|1
)paren
op_star
l_int|8
)paren
op_amp
l_int|0x7fff
suffix:semicolon
id|rinfo-&gt;hSync_width
op_assign
id|readb
c_func
(paren
id|tmp0
op_plus
l_int|23
)paren
op_star
l_int|8
suffix:semicolon
id|rinfo-&gt;vblank
op_assign
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|24
)paren
op_minus
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|26
)paren
suffix:semicolon
id|rinfo-&gt;vOver_plus
op_assign
(paren
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|28
)paren
op_amp
l_int|0x7ff
)paren
op_minus
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|26
)paren
suffix:semicolon
id|rinfo-&gt;vSync_width
op_assign
(paren
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|28
)paren
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
suffix:semicolon
id|rinfo-&gt;clock
op_assign
id|readw
c_func
(paren
id|tmp0
op_plus
l_int|9
)paren
suffix:semicolon
id|rinfo-&gt;got_dfpinfo
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_get_dfpinfo
r_static
r_int
id|radeon_get_dfpinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|a
comma
id|b
suffix:semicolon
r_if
c_cond
(paren
id|radeon_get_dfpinfo_BIOS
c_func
(paren
id|rinfo
)paren
)paren
id|radeon_update_default_var
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_dfp_parse_EDID
c_func
(paren
id|rinfo
)paren
)paren
id|radeon_update_default_var
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;got_dfpinfo
)paren
(brace
multiline_comment|/*&n;&t;&t; * it seems all else has failed now and we&n;&t;&t; * resort to probing registers for our DFP info&n;&t;         */
r_if
c_cond
(paren
id|panel_yres
)paren
(brace
id|rinfo-&gt;panel_yres
op_assign
id|panel_yres
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_VERT_STRETCH
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0x00fff000
suffix:semicolon
id|rinfo-&gt;panel_yres
op_assign
(paren
r_int
r_int
)paren
(paren
id|tmp
op_rshift
l_int|0x0c
)paren
op_plus
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rinfo-&gt;panel_yres
)paren
(brace
r_case
l_int|480
suffix:colon
id|rinfo-&gt;panel_xres
op_assign
l_int|640
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|600
suffix:colon
id|rinfo-&gt;panel_xres
op_assign
l_int|800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|768
suffix:colon
macro_line|#if defined(__powerpc__)
r_if
c_cond
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_LCD
)paren
id|rinfo-&gt;panel_xres
op_assign
l_int|1152
suffix:semicolon
r_else
macro_line|#endif
id|rinfo-&gt;panel_xres
op_assign
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
id|rinfo-&gt;panel_xres
op_assign
l_int|1280
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1050
suffix:colon
id|rinfo-&gt;panel_xres
op_assign
l_int|1400
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1200
suffix:colon
id|rinfo-&gt;panel_xres
op_assign
l_int|1600
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;radeonfb: Failed to detect DFP panel size&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: detected DFP panel size from registers: %dx%d&bslash;n&quot;
comma
id|rinfo-&gt;panel_xres
comma
id|rinfo-&gt;panel_yres
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_CRTC_H_TOTAL_DISP
)paren
suffix:semicolon
id|a
op_assign
(paren
id|tmp
op_amp
id|FP_CRTC_H_TOTAL_MASK
)paren
op_plus
l_int|4
suffix:semicolon
id|b
op_assign
(paren
id|tmp
op_amp
l_int|0x01ff0000
)paren
op_rshift
id|FP_CRTC_H_DISP_SHIFT
suffix:semicolon
id|rinfo-&gt;hblank
op_assign
(paren
id|a
op_minus
id|b
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_H_SYNC_STRT_WID
)paren
suffix:semicolon
id|rinfo-&gt;hOver_plus
op_assign
(paren
r_int
r_int
)paren
(paren
(paren
id|tmp
op_amp
id|FP_H_SYNC_STRT_CHAR_MASK
)paren
op_rshift
id|FP_H_SYNC_STRT_CHAR_SHIFT
)paren
op_minus
id|b
op_minus
l_int|1
suffix:semicolon
id|rinfo-&gt;hOver_plus
op_mul_assign
l_int|8
suffix:semicolon
id|rinfo-&gt;hSync_width
op_assign
(paren
r_int
r_int
)paren
(paren
(paren
id|tmp
op_amp
id|FP_H_SYNC_WID_MASK
)paren
op_rshift
id|FP_H_SYNC_WID_SHIFT
)paren
suffix:semicolon
id|rinfo-&gt;hSync_width
op_mul_assign
l_int|8
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_CRTC_V_TOTAL_DISP
)paren
suffix:semicolon
id|a
op_assign
(paren
id|tmp
op_amp
id|FP_CRTC_V_TOTAL_MASK
)paren
op_plus
l_int|1
suffix:semicolon
id|b
op_assign
(paren
id|tmp
op_amp
id|FP_CRTC_V_DISP_MASK
)paren
op_rshift
id|FP_CRTC_V_DISP_SHIFT
suffix:semicolon
id|rinfo-&gt;vblank
op_assign
id|a
op_minus
id|b
multiline_comment|/* + 24 */
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_V_SYNC_STRT_WID
)paren
suffix:semicolon
id|rinfo-&gt;vOver_plus
op_assign
(paren
r_int
r_int
)paren
(paren
id|tmp
op_amp
id|FP_V_SYNC_STRT_MASK
)paren
op_minus
id|b
op_plus
l_int|1
suffix:semicolon
id|rinfo-&gt;vSync_width
op_assign
(paren
r_int
r_int
)paren
(paren
(paren
id|tmp
op_amp
id|FP_V_SYNC_WID_MASK
)paren
op_rshift
id|FP_V_SYNC_WID_SHIFT
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PPC_OF
DECL|function|radeon_read_OF
r_static
r_int
id|radeon_read_OF
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|device_node
op_star
id|dp
suffix:semicolon
r_int
r_int
op_star
id|xtal
suffix:semicolon
id|dp
op_assign
id|pci_device_to_OF_node
c_func
(paren
id|rinfo-&gt;pdev
)paren
suffix:semicolon
id|xtal
op_assign
(paren
r_int
r_int
op_star
)paren
id|get_property
c_func
(paren
id|dp
comma
l_string|&quot;ATY,RefCLK&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
op_star
id|xtal
op_div
l_int|10
suffix:semicolon
r_if
c_cond
(paren
op_star
id|xtal
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;
DECL|function|radeon_engine_init
r_static
r_void
id|radeon_engine_init
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|temp
suffix:semicolon
multiline_comment|/* disable 3D engine */
id|OUTREG
c_func
(paren
id|RB3D_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|radeon_engine_reset
(paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RB2D_DSTCACHE_MODE
comma
l_int|0
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|INREG
c_func
(paren
id|DEFAULT_PITCH_OFFSET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DEFAULT_PITCH_OFFSET
comma
(paren
(paren
id|temp
op_amp
l_int|0xc0000000
)paren
op_or
(paren
id|rinfo-&gt;pitch
op_lshift
l_int|0x16
)paren
)paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|DP_DATATYPE
comma
l_int|0
comma
op_complement
id|HOST_BIG_ENDIAN_EN
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DEFAULT_SC_BOTTOM_RIGHT
comma
(paren
id|DEFAULT_SC_RIGHT_MAX
op_or
id|DEFAULT_SC_BOTTOM_MAX
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|radeon_get_dstbpp
c_func
(paren
id|rinfo-&gt;depth
)paren
suffix:semicolon
id|rinfo-&gt;dp_gui_master_cntl
op_assign
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_or
id|GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_GUI_MASTER_CNTL
comma
(paren
id|rinfo-&gt;dp_gui_master_cntl
op_or
id|GMC_BRUSH_SOLID_COLOR
op_or
id|GMC_SRC_DATATYPE_COLOR
)paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|7
)paren
suffix:semicolon
multiline_comment|/* clear line drawing regs */
id|OUTREG
c_func
(paren
id|DST_LINE_START
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_LINE_END
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set brush color regs */
id|OUTREG
c_func
(paren
id|DP_BRUSH_FRGD_CLR
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_BRUSH_BKGD_CLR
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* set source color regs */
id|OUTREG
c_func
(paren
id|DP_SRC_FRGD_CLR
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_SRC_BKGD_CLR
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* default write mask */
id|OUTREG
c_func
(paren
id|DP_WRITE_MSK
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|radeon_engine_idle
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_init_disp
r_static
r_int
id|__devinit
id|radeon_init_disp
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
id|var
op_assign
id|radeonfb_default_var
suffix:semicolon
r_if
c_cond
(paren
(paren
id|radeon_init_disp_var
c_func
(paren
id|rinfo
comma
op_amp
id|var
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|rinfo-&gt;depth
op_assign
id|var_to_depth
c_func
(paren
op_amp
id|var
)paren
suffix:semicolon
id|rinfo-&gt;bpp
op_assign
id|var.bits_per_pixel
suffix:semicolon
id|info-&gt;var
op_assign
id|var
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_init_disp_var
r_static
r_int
id|radeon_init_disp_var
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|mode_option
)paren
id|fb_find_mode
(paren
id|var
comma
op_amp
id|rinfo-&gt;info
comma
id|mode_option
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|8
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|rinfo-&gt;use_default_var
)paren
multiline_comment|/* We will use the modified default far */
op_star
id|var
op_assign
id|radeonfb_default_var
suffix:semicolon
r_else
id|fb_find_mode
(paren
id|var
comma
op_amp
id|rinfo-&gt;info
comma
l_string|&quot;640x480-8@60&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|var-&gt;accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|var-&gt;accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_do_maximize
r_static
r_int
id|radeon_do_maximize
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_var_screeninfo
op_star
id|v
comma
r_int
id|nom
comma
r_int
id|den
)paren
(brace
r_static
r_struct
(brace
r_int
id|xres
comma
id|yres
suffix:semicolon
)brace
id|modes
(braket
)braket
op_assign
(brace
(brace
l_int|1600
comma
l_int|1280
)brace
comma
(brace
l_int|1280
comma
l_int|1024
)brace
comma
(brace
l_int|1024
comma
l_int|768
)brace
comma
(brace
l_int|800
comma
l_int|600
)brace
comma
(brace
l_int|640
comma
l_int|480
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* use highest possible virtual resolution */
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_eq
op_minus
l_int|1
op_logical_and
id|v-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: using max available virtual resolution&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|modes
(braket
id|i
)braket
dot
id|xres
op_ne
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_star
id|nom
op_div
id|den
op_star
id|modes
(braket
id|i
)braket
dot
id|yres
OL
id|rinfo-&gt;video_ram
op_div
l_int|2
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: could not find virtual resolution that fits into video memory!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|v-&gt;xres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|xres
suffix:semicolon
id|v-&gt;yres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|yres
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: virtual resolution set to max of %dx%d&bslash;n&quot;
comma
id|v-&gt;xres_virtual
comma
id|v-&gt;yres_virtual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|v-&gt;xres_virtual
op_assign
(paren
id|rinfo-&gt;video_ram
op_star
id|den
op_div
(paren
id|nom
op_star
id|v-&gt;yres_virtual
op_star
l_int|2
)paren
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|v-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|v-&gt;xres_virtual
op_assign
(paren
id|v-&gt;xres_virtual
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|v-&gt;yres_virtual
op_assign
id|rinfo-&gt;video_ram
op_star
id|den
op_div
(paren
id|nom
op_star
id|v-&gt;xres_virtual
op_star
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_star
id|v-&gt;yres_virtual
OG
id|rinfo-&gt;video_ram
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_ge
l_int|8192
)paren
(brace
id|v-&gt;xres_virtual
op_assign
l_int|8192
op_star
id|den
op_div
id|nom
op_minus
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v-&gt;xres_virtual
OL
id|v-&gt;xres
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;yres_virtual
OL
id|v-&gt;yres
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_check_var
r_static
r_int
id|radeonfb_check_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|v
suffix:semicolon
r_int
id|nom
comma
id|den
suffix:semicolon
id|memcpy
(paren
op_amp
id|v
comma
id|var
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|v.bits_per_pixel
)paren
(brace
r_case
l_int|0
dot
dot
dot
l_int|8
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
dot
dot
dot
l_int|16
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|17
dot
dot
dot
l_int|24
suffix:colon
macro_line|#if 0 /* Doesn&squot;t seem to work */
id|v.bits_per_pixel
op_assign
l_int|24
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;&t;&t;
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
l_int|25
dot
dot
dot
l_int|32
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|var_to_depth
c_func
(paren
op_amp
id|v
)paren
)paren
(brace
r_case
l_int|8
suffix:colon
id|nom
op_assign
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
id|v.green.offset
op_assign
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|nom
op_assign
l_int|2
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|10
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|nom
op_assign
l_int|2
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|11
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|6
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|nom
op_assign
l_int|4
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.blue.length
op_assign
id|v.green.length
op_assign
l_int|8
suffix:semicolon
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|nom
op_assign
l_int|4
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.blue.length
op_assign
id|v.green.length
op_assign
l_int|8
suffix:semicolon
id|v.transp.offset
op_assign
l_int|24
suffix:semicolon
id|v.transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
(paren
l_string|&quot;radeonfb: mode %dx%dx%d rejected, color depth invalid&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|radeon_do_maximize
c_func
(paren
id|rinfo
comma
id|var
comma
op_amp
id|v
comma
id|nom
comma
id|den
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|v.xoffset
OL
l_int|0
)paren
id|v.xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OL
l_int|0
)paren
id|v.yoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v.xoffset
OG
id|v.xres_virtual
op_minus
id|v.xres
)paren
id|v.xoffset
op_assign
id|v.xres_virtual
op_minus
id|v.xres
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OG
id|v.yres_virtual
op_minus
id|v.yres
)paren
id|v.yoffset
op_assign
id|v.yres_virtual
op_minus
id|v.yres
op_minus
l_int|1
suffix:semicolon
id|v.red.msb_right
op_assign
id|v.green.msb_right
op_assign
id|v.blue.msb_right
op_assign
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
id|v.transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|v.accel_flags
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|var
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pan_display
r_static
r_int
id|radeonfb_pan_display
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;xoffset
op_plus
id|var-&gt;xres
OG
id|var-&gt;xres_virtual
)paren
op_logical_or
(paren
id|var-&gt;yoffset
op_plus
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET
comma
(paren
(paren
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
op_plus
id|var-&gt;xoffset
)paren
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
)paren
op_amp
op_complement
l_int|7
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_ioctl
r_static
r_int
id|radeonfb_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/*&n;&t;&t; * TODO:  set mirror accordingly for non-Mobility chipsets with 2 CRTC&squot;s&n;&t;&t; */
r_case
id|FBIO_RADEON_SET_MIRROR
suffix:colon
r_switch
c_cond
(paren
id|rinfo-&gt;arch
)paren
(brace
r_case
id|RADEON_R100
suffix:colon
r_case
id|RADEON_RV100
suffix:colon
r_case
id|RADEON_R200
suffix:colon
r_case
id|RADEON_RV200
suffix:colon
r_case
id|RADEON_RV250
suffix:colon
r_case
id|RADEON_R300
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* RADEON M6, RADEON_M7, RADEON_M9 */
r_break
suffix:semicolon
)brace
id|rc
op_assign
id|get_user
c_func
(paren
id|value
comma
(paren
id|__u32
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|value
op_amp
l_int|0x01
)paren
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_amp
l_int|0x02
)paren
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CRTC_CRT_ON
suffix:semicolon
id|mirror
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CRTC_CRT_ON
suffix:semicolon
id|mirror
op_assign
l_int|0
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FBIO_RADEON_GET_MIRROR
suffix:colon
r_switch
c_cond
(paren
id|rinfo-&gt;arch
)paren
(brace
r_case
id|RADEON_R100
suffix:colon
r_case
id|RADEON_RV100
suffix:colon
r_case
id|RADEON_R200
suffix:colon
r_case
id|RADEON_RV200
suffix:colon
r_case
id|RADEON_RV250
suffix:colon
r_case
id|RADEON_R300
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* RADEON M6, RADEON_M7, RADEON_M9 */
r_break
suffix:semicolon
)brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
op_amp
id|tmp
)paren
id|value
op_or_assign
l_int|0x01
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CRTC_CRT_ON
op_amp
id|tmp
)paren
id|value
op_or_assign
l_int|0x02
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|value
comma
(paren
id|__u32
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|radeonfb_blank
r_static
r_int
id|radeonfb_blank
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|val
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|u32
id|val2
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_LCD
op_logical_and
id|_machine
op_eq
id|_MACH_Pmac
)paren
(brace
id|set_backlight_enable
c_func
(paren
op_logical_neg
id|blank
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* reset it */
id|val
op_and_assign
op_complement
(paren
id|CRTC_DISPLAY_DIS
op_or
id|CRTC_HSYNC_DIS
op_or
id|CRTC_VSYNC_DIS
)paren
suffix:semicolon
id|val2
op_and_assign
op_complement
(paren
id|LVDS_DISPLAY_DIS
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
id|FB_BLANK_UNBLANK
suffix:colon
r_case
id|FB_BLANK_NORMAL
suffix:colon
r_break
suffix:semicolon
r_case
id|FB_BLANK_VSYNC_SUSPEND
suffix:colon
id|val
op_or_assign
(paren
id|CRTC_DISPLAY_DIS
op_or
id|CRTC_VSYNC_DIS
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_HSYNC_SUSPEND
suffix:colon
id|val
op_or_assign
(paren
id|CRTC_DISPLAY_DIS
op_or
id|CRTC_HSYNC_DIS
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_POWERDOWN
suffix:colon
id|val
op_or_assign
(paren
id|CRTC_DISPLAY_DIS
op_or
id|CRTC_VSYNC_DIS
op_or
id|CRTC_HSYNC_DIS
)paren
suffix:semicolon
id|val2
op_or_assign
(paren
id|LVDS_DISPLAY_DIS
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rinfo-&gt;dviDisp_type
)paren
(brace
r_case
id|MT_LCD
suffix:colon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|val2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_CRT
suffix:colon
r_default
suffix:colon
id|OUTREG
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* let fbcon do a soft blank for us */
r_return
(paren
id|blank
op_eq
id|FB_BLANK_NORMAL
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_setcolreg
r_static
r_int
id|radeonfb_setcolreg
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|pindex
comma
id|vclk_cntl
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
multiline_comment|/* default */
id|pindex
op_assign
id|regno
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;asleep
)paren
(brace
id|vclk_cntl
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|vclk_cntl
op_amp
op_complement
id|PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;bpp
op_eq
l_int|16
)paren
(brace
id|pindex
op_assign
id|regno
op_star
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;depth
op_eq
l_int|16
op_logical_and
id|regno
OG
l_int|63
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;depth
op_eq
l_int|15
op_logical_and
id|regno
OG
l_int|31
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* For 565, the green component is mixed one order below */
r_if
c_cond
(paren
id|rinfo-&gt;depth
op_eq
l_int|16
)paren
(brace
id|OUTREG
c_func
(paren
id|PALETTE_INDEX
comma
id|pindex
op_rshift
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PALETTE_DATA
comma
(paren
id|rinfo-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|rinfo-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|blue
)paren
)paren
suffix:semicolon
id|green
op_assign
id|rinfo-&gt;palette
(braket
id|regno
op_lshift
l_int|1
)braket
dot
id|green
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rinfo-&gt;depth
op_ne
l_int|16
op_logical_or
id|regno
OL
l_int|32
)paren
(brace
id|OUTREG
c_func
(paren
id|PALETTE_INDEX
comma
id|pindex
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PALETTE_DATA
comma
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
id|blue
)paren
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|vclk_cntl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|rinfo-&gt;depth
)paren
(brace
r_case
l_int|15
suffix:colon
(paren
(paren
id|u16
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|10
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
(paren
(paren
id|u16
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|11
)paren
op_or
(paren
id|regno
op_lshift
l_int|6
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|16
)paren
op_or
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|i
op_assign
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
(paren
id|info-&gt;pseudo_palette
)paren
)paren
(braket
id|regno
)braket
op_assign
(paren
id|i
op_lshift
l_int|16
)paren
op_or
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_save_state
r_static
r_void
id|radeon_save_state
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|save
)paren
(brace
multiline_comment|/* CRTC regs */
id|save-&gt;crtc_gen_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|save-&gt;crtc_ext_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|save-&gt;dac_cntl
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|save-&gt;crtc_h_total_disp
op_assign
id|INREG
c_func
(paren
id|CRTC_H_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;crtc_h_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;crtc_v_total_disp
op_assign
id|INREG
c_func
(paren
id|CRTC_V_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;crtc_v_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;crtc_pitch
op_assign
id|INREG
c_func
(paren
id|CRTC_PITCH
)paren
suffix:semicolon
macro_line|#if defined(__BIG_ENDIAN)
id|save-&gt;surface_cntl
op_assign
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* FP regs */
id|save-&gt;fp_crtc_h_total_disp
op_assign
id|INREG
c_func
(paren
id|FP_CRTC_H_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;fp_crtc_v_total_disp
op_assign
id|INREG
c_func
(paren
id|FP_CRTC_V_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;fp_gen_cntl
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|save-&gt;fp_h_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|FP_H_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;fp_horz_stretch
op_assign
id|INREG
c_func
(paren
id|FP_HORZ_STRETCH
)paren
suffix:semicolon
id|save-&gt;fp_v_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|FP_V_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;fp_vert_stretch
op_assign
id|INREG
c_func
(paren
id|FP_VERT_STRETCH
)paren
suffix:semicolon
id|save-&gt;lvds_gen_cntl
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|save-&gt;lvds_pll_cntl
op_assign
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
suffix:semicolon
id|save-&gt;tmds_crc
op_assign
id|INREG
c_func
(paren
id|TMDS_CRC
)paren
suffix:semicolon
id|save-&gt;tmds_transmitter_cntl
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|save-&gt;vclk_ecp_cntl
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
)brace
DECL|function|radeonfb_set_par
r_static
r_int
id|radeonfb_set_par
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|mode
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
r_struct
id|radeon_regs
id|newmode
suffix:semicolon
r_int
id|hTotal
comma
id|vTotal
comma
id|hSyncStart
comma
id|hSyncEnd
comma
id|hSyncPol
comma
id|vSyncStart
comma
id|vSyncEnd
comma
id|vSyncPol
comma
id|cSync
suffix:semicolon
id|u8
id|hsync_adj_tab
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0x12
comma
l_int|9
comma
l_int|9
comma
l_int|6
comma
l_int|5
)brace
suffix:semicolon
id|u8
id|hsync_fudge_fp
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|5
comma
l_int|5
)brace
suffix:semicolon
id|u32
id|dotClock
op_assign
l_int|1000000000
op_div
id|mode-&gt;pixclock
comma
id|sync
comma
id|h_sync_pol
comma
id|v_sync_pol
suffix:semicolon
r_int
id|freq
op_assign
id|dotClock
op_div
l_int|10
suffix:semicolon
multiline_comment|/* x 100 */
r_int
id|xclk_freq
comma
id|vclk_freq
comma
id|xclk_per_trans
comma
id|xclk_per_trans_precise
suffix:semicolon
r_int
id|useable_precision
comma
id|roff
comma
id|ron
suffix:semicolon
r_int
id|min_bits
comma
id|format
op_assign
l_int|0
suffix:semicolon
r_int
id|hsync_start
comma
id|hsync_fudge
comma
id|bytpp
comma
id|hsync_wid
comma
id|vsync_wid
suffix:semicolon
r_int
id|primary_mon
op_assign
id|PRIMARY_MONITOR
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_int
id|depth
op_assign
id|var_to_depth
c_func
(paren
id|mode
)paren
suffix:semicolon
r_int
id|accel
op_assign
(paren
id|mode-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
op_ne
l_int|0
suffix:semicolon
id|rinfo-&gt;xres
op_assign
id|mode-&gt;xres
suffix:semicolon
id|rinfo-&gt;yres
op_assign
id|mode-&gt;yres
suffix:semicolon
id|rinfo-&gt;xres_virtual
op_assign
id|mode-&gt;xres_virtual
suffix:semicolon
id|rinfo-&gt;yres_virtual
op_assign
id|mode-&gt;yres_virtual
suffix:semicolon
id|rinfo-&gt;pixclock
op_assign
id|mode-&gt;pixclock
suffix:semicolon
id|hSyncStart
op_assign
id|mode-&gt;xres
op_plus
id|mode-&gt;right_margin
suffix:semicolon
id|hSyncEnd
op_assign
id|hSyncStart
op_plus
id|mode-&gt;hsync_len
suffix:semicolon
id|hTotal
op_assign
id|hSyncEnd
op_plus
id|mode-&gt;left_margin
suffix:semicolon
id|vSyncStart
op_assign
id|mode-&gt;yres
op_plus
id|mode-&gt;lower_margin
suffix:semicolon
id|vSyncEnd
op_assign
id|vSyncStart
op_plus
id|mode-&gt;vsync_len
suffix:semicolon
id|vTotal
op_assign
id|vSyncEnd
op_plus
id|mode-&gt;upper_margin
suffix:semicolon
r_if
c_cond
(paren
(paren
id|primary_mon
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;panel_xres
OL
id|mode-&gt;xres
)paren
id|rinfo-&gt;xres
op_assign
id|mode-&gt;xres
op_assign
id|rinfo-&gt;panel_xres
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;panel_yres
OL
id|mode-&gt;yres
)paren
id|rinfo-&gt;yres
op_assign
id|mode-&gt;yres
op_assign
id|rinfo-&gt;panel_yres
suffix:semicolon
id|hTotal
op_assign
id|mode-&gt;xres
op_plus
id|rinfo-&gt;hblank
suffix:semicolon
id|hSyncStart
op_assign
id|mode-&gt;xres
op_plus
id|rinfo-&gt;hOver_plus
suffix:semicolon
id|hSyncEnd
op_assign
id|hSyncStart
op_plus
id|rinfo-&gt;hSync_width
suffix:semicolon
id|vTotal
op_assign
id|mode-&gt;yres
op_plus
id|rinfo-&gt;vblank
suffix:semicolon
id|vSyncStart
op_assign
id|mode-&gt;yres
op_plus
id|rinfo-&gt;vOver_plus
suffix:semicolon
id|vSyncEnd
op_assign
id|vSyncStart
op_plus
id|rinfo-&gt;vSync_width
suffix:semicolon
)brace
id|sync
op_assign
id|mode-&gt;sync
suffix:semicolon
id|h_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|v_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;hStart = %d, hEnd = %d, hTotal = %d&bslash;n&quot;
comma
id|hSyncStart
comma
id|hSyncEnd
comma
id|hTotal
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;vStart = %d, vEnd = %d, vTotal = %d&bslash;n&quot;
comma
id|vSyncStart
comma
id|vSyncEnd
comma
id|vTotal
)paren
suffix:semicolon
id|hsync_wid
op_assign
(paren
id|hSyncEnd
op_minus
id|hSyncStart
)paren
op_div
l_int|8
suffix:semicolon
id|vsync_wid
op_assign
id|vSyncEnd
op_minus
id|vSyncStart
suffix:semicolon
r_if
c_cond
(paren
id|hsync_wid
op_eq
l_int|0
)paren
id|hsync_wid
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hsync_wid
OG
l_int|0x3f
)paren
multiline_comment|/* max */
id|hsync_wid
op_assign
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|vsync_wid
op_eq
l_int|0
)paren
id|vsync_wid
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vsync_wid
OG
l_int|0x1f
)paren
multiline_comment|/* max */
id|vsync_wid
op_assign
l_int|0x1f
suffix:semicolon
id|hSyncPol
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|vSyncPol
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|cSync
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
ques
c_cond
(paren
l_int|1
op_lshift
l_int|4
)paren
suffix:colon
l_int|0
suffix:semicolon
id|format
op_assign
id|radeon_get_dstbpp
c_func
(paren
id|depth
)paren
suffix:semicolon
id|bytpp
op_assign
id|mode-&gt;bits_per_pixel
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|primary_mon
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
)paren
id|hsync_fudge
op_assign
id|hsync_fudge_fp
(braket
id|format
op_minus
l_int|1
)braket
suffix:semicolon
r_else
id|hsync_fudge
op_assign
id|hsync_adj_tab
(braket
id|format
op_minus
l_int|1
)braket
suffix:semicolon
id|hsync_start
op_assign
id|hSyncStart
op_minus
l_int|8
op_plus
id|hsync_fudge
suffix:semicolon
id|newmode.crtc_gen_cntl
op_assign
id|CRTC_EXT_DISP_EN
op_or
id|CRTC_EN
op_or
(paren
id|format
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|primary_mon
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
)paren
(brace
id|newmode.crtc_ext_cntl
op_assign
id|VGA_ATI_LINEAR
op_or
id|XCRT_CNT_EN
suffix:semicolon
r_if
c_cond
(paren
id|mirror
)paren
id|newmode.crtc_ext_cntl
op_or_assign
id|CRTC_CRT_ON
suffix:semicolon
id|newmode.crtc_gen_cntl
op_and_assign
op_complement
(paren
id|CRTC_DBL_SCAN_EN
op_or
id|CRTC_INTERLACE_EN
)paren
suffix:semicolon
)brace
r_else
(brace
id|newmode.crtc_ext_cntl
op_assign
id|VGA_ATI_LINEAR
op_or
id|XCRT_CNT_EN
op_or
id|CRTC_CRT_ON
suffix:semicolon
)brace
id|newmode.dac_cntl
op_assign
multiline_comment|/* INREG(DAC_CNTL) | */
id|DAC_MASK_ALL
op_or
id|DAC_VGA_ADR_EN
op_or
id|DAC_8BIT_EN
suffix:semicolon
id|newmode.crtc_h_total_disp
op_assign
(paren
(paren
(paren
(paren
id|hTotal
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0x3ff
)paren
op_or
(paren
(paren
(paren
id|mode-&gt;xres
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|newmode.crtc_h_sync_strt_wid
op_assign
(paren
(paren
id|hsync_start
op_amp
l_int|0x1fff
)paren
op_or
(paren
id|hsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|h_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
id|newmode.crtc_v_total_disp
op_assign
(paren
(paren
id|vTotal
op_minus
l_int|1
)paren
op_amp
l_int|0xffff
)paren
op_or
(paren
(paren
id|mode-&gt;yres
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|newmode.crtc_v_sync_strt_wid
op_assign
(paren
(paren
(paren
id|vSyncStart
op_minus
l_int|1
)paren
op_amp
l_int|0xfff
)paren
op_or
(paren
id|vsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|v_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
multiline_comment|/* We first calculate the engine pitch */
id|rinfo-&gt;pitch
op_assign
(paren
(paren
id|mode-&gt;xres_virtual
op_star
(paren
(paren
id|mode-&gt;bits_per_pixel
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
op_plus
l_int|0x3f
)paren
op_amp
op_complement
(paren
l_int|0x3f
)paren
)paren
op_rshift
l_int|6
suffix:semicolon
multiline_comment|/* Then, re-multiply it to get the CRTC pitch */
id|newmode.crtc_pitch
op_assign
(paren
id|rinfo-&gt;pitch
op_lshift
l_int|3
)paren
op_div
(paren
(paren
id|mode-&gt;bits_per_pixel
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|newmode.crtc_pitch
op_assign
(paren
id|mode-&gt;xres_virtual
op_rshift
l_int|3
)paren
suffix:semicolon
id|newmode.crtc_pitch
op_or_assign
(paren
id|newmode.crtc_pitch
op_lshift
l_int|16
)paren
suffix:semicolon
macro_line|#if defined(__BIG_ENDIAN)
multiline_comment|/*&n;&t; * It looks like recent chips have a problem with SURFACE_CNTL,&n;&t; * setting SURF_TRANSLATION_DIS completely disables the&n;&t; * swapper as well, so we leave it unset now.&n;&t; */
id|newmode.surface_cntl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Setup swapping on both apertures, though we currently&n;&t; * only use aperture 0, enabling swapper on aperture 1&n;&t; * won&squot;t harm&n;&t; */
r_switch
c_cond
(paren
id|mode-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
id|newmode.surface_cntl
op_or_assign
id|NONSURF_AP0_SWP_16BPP
suffix:semicolon
id|newmode.surface_cntl
op_or_assign
id|NONSURF_AP1_SWP_16BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|newmode.surface_cntl
op_or_assign
id|NONSURF_AP0_SWP_32BPP
suffix:semicolon
id|newmode.surface_cntl
op_or_assign
id|NONSURF_AP1_SWP_32BPP
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
id|rinfo-&gt;pitch
op_assign
(paren
(paren
id|mode-&gt;xres_virtual
op_star
(paren
(paren
id|mode-&gt;bits_per_pixel
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
op_plus
l_int|0x3f
)paren
op_amp
op_complement
(paren
l_int|0x3f
)paren
)paren
op_div
l_int|64
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;h_total_disp = 0x%x&bslash;t   hsync_strt_wid = 0x%x&bslash;n&quot;
comma
id|newmode.crtc_h_total_disp
comma
id|newmode.crtc_h_sync_strt_wid
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;v_total_disp = 0x%x&bslash;t   vsync_strt_wid = 0x%x&bslash;n&quot;
comma
id|newmode.crtc_v_total_disp
comma
id|newmode.crtc_v_sync_strt_wid
)paren
suffix:semicolon
id|newmode.xres
op_assign
id|mode-&gt;xres
suffix:semicolon
id|newmode.yres
op_assign
id|mode-&gt;yres
suffix:semicolon
id|rinfo-&gt;bpp
op_assign
id|mode-&gt;bits_per_pixel
suffix:semicolon
id|rinfo-&gt;depth
op_assign
id|depth
suffix:semicolon
r_if
c_cond
(paren
id|freq
OG
id|rinfo-&gt;pll.ppll_max
)paren
id|freq
op_assign
id|rinfo-&gt;pll.ppll_max
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_star
l_int|12
OL
id|rinfo-&gt;pll.ppll_min
)paren
id|freq
op_assign
id|rinfo-&gt;pll.ppll_min
op_div
l_int|12
suffix:semicolon
(brace
r_struct
(brace
r_int
id|divider
suffix:semicolon
r_int
id|bitvalue
suffix:semicolon
)brace
op_star
id|post_div
comma
id|post_divs
(braket
)braket
op_assign
(brace
(brace
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|2
comma
l_int|1
)brace
comma
(brace
l_int|4
comma
l_int|2
)brace
comma
(brace
l_int|8
comma
l_int|3
)brace
comma
(brace
l_int|3
comma
l_int|4
)brace
comma
(brace
l_int|16
comma
l_int|5
)brace
comma
(brace
l_int|6
comma
l_int|6
)brace
comma
(brace
l_int|12
comma
l_int|7
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
r_for
c_loop
(paren
id|post_div
op_assign
op_amp
id|post_divs
(braket
l_int|0
)braket
suffix:semicolon
id|post_div-&gt;divider
suffix:semicolon
op_increment
id|post_div
)paren
(brace
id|rinfo-&gt;pll_output_freq
op_assign
id|post_div-&gt;divider
op_star
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;pll_output_freq
op_ge
id|rinfo-&gt;pll.ppll_min
op_logical_and
id|rinfo-&gt;pll_output_freq
op_le
id|rinfo-&gt;pll.ppll_max
)paren
r_break
suffix:semicolon
)brace
id|rinfo-&gt;post_div
op_assign
id|post_div-&gt;divider
suffix:semicolon
id|rinfo-&gt;fb_div
op_assign
id|round_div
c_func
(paren
id|rinfo-&gt;pll.ref_div
op_star
id|rinfo-&gt;pll_output_freq
comma
id|rinfo-&gt;pll.ref_clk
)paren
suffix:semicolon
id|newmode.ppll_ref_div
op_assign
id|rinfo-&gt;pll.ref_div
suffix:semicolon
id|newmode.ppll_div_3
op_assign
id|rinfo-&gt;fb_div
op_or
(paren
id|post_div-&gt;bitvalue
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
id|newmode.vclk_ecp_cntl
op_assign
id|rinfo-&gt;init_state.vclk_ecp_cntl
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_OF
multiline_comment|/* Gross hack for iBook with M7 until I find out a proper fix */
r_if
c_cond
(paren
id|machine_is_compatible
c_func
(paren
l_string|&quot;PowerBook4,3&quot;
)paren
op_logical_and
id|rinfo-&gt;arch
op_eq
id|RADEON_M7
)paren
id|newmode.ppll_div_3
op_assign
l_int|0x000600ad
suffix:semicolon
macro_line|#endif /* CONFIG_PPC_OF */&t;
id|RTRACE
c_func
(paren
l_string|&quot;post div = 0x%x&bslash;n&quot;
comma
id|rinfo-&gt;post_div
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;fb_div = 0x%x&bslash;n&quot;
comma
id|rinfo-&gt;fb_div
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;ppll_div_3 = 0x%x&bslash;n&quot;
comma
id|newmode.ppll_div_3
)paren
suffix:semicolon
multiline_comment|/* DDA */
id|vclk_freq
op_assign
id|round_div
c_func
(paren
id|rinfo-&gt;pll.ref_clk
op_star
id|rinfo-&gt;fb_div
comma
id|rinfo-&gt;pll.ref_div
op_star
id|rinfo-&gt;post_div
)paren
suffix:semicolon
id|xclk_freq
op_assign
id|rinfo-&gt;pll.xclk
suffix:semicolon
id|xclk_per_trans
op_assign
id|round_div
c_func
(paren
id|xclk_freq
op_star
l_int|128
comma
id|vclk_freq
op_star
id|mode-&gt;bits_per_pixel
)paren
suffix:semicolon
id|min_bits
op_assign
id|min_bits_req
c_func
(paren
id|xclk_per_trans
)paren
suffix:semicolon
id|useable_precision
op_assign
id|min_bits
op_plus
l_int|1
suffix:semicolon
id|xclk_per_trans_precise
op_assign
id|round_div
c_func
(paren
(paren
id|xclk_freq
op_star
l_int|128
)paren
op_lshift
(paren
l_int|11
op_minus
id|useable_precision
)paren
comma
id|vclk_freq
op_star
id|mode-&gt;bits_per_pixel
)paren
suffix:semicolon
id|ron
op_assign
(paren
l_int|4
op_star
id|rinfo-&gt;ram.mb
op_plus
l_int|3
op_star
id|_max
c_func
(paren
id|rinfo-&gt;ram.trcd
op_minus
l_int|2
comma
l_int|0
)paren
op_plus
l_int|2
op_star
id|rinfo-&gt;ram.trp
op_plus
id|rinfo-&gt;ram.twr
op_plus
id|rinfo-&gt;ram.cl
op_plus
id|rinfo-&gt;ram.tr2w
op_plus
id|xclk_per_trans
)paren
op_lshift
(paren
l_int|11
op_minus
id|useable_precision
)paren
suffix:semicolon
id|roff
op_assign
id|xclk_per_trans_precise
op_star
(paren
l_int|32
op_minus
l_int|4
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;ron = %d, roff = %d&bslash;n&quot;
comma
id|ron
comma
id|roff
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;vclk_freq = %d, per = %d&bslash;n&quot;
comma
id|vclk_freq
comma
id|xclk_per_trans_precise
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ron
op_plus
id|rinfo-&gt;ram.rloop
)paren
op_ge
id|roff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: error ron out of range&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|newmode.dda_config
op_assign
(paren
id|xclk_per_trans_precise
op_or
(paren
id|useable_precision
op_lshift
l_int|16
)paren
op_or
(paren
id|rinfo-&gt;ram.rloop
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
id|newmode.dda_on_off
op_assign
(paren
id|ron
op_lshift
l_int|16
)paren
op_or
id|roff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|primary_mon
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
)paren
(brace
r_int
r_int
id|hRatio
comma
id|vRatio
suffix:semicolon
multiline_comment|/* We force the pixel clock to be always enabled. Allowing it&n;&t;&t; * to be power managed during blanking would save power, but has&n;&t;&t; * nasty interactions with the 2D engine &amp; sleep code that haven&squot;t&n;&t;&t; * been solved yet. --BenH&n;&t;&t; */
id|newmode.vclk_ecp_cntl
op_and_assign
op_complement
id|PIXCLK_DAC_ALWAYS_ONb
suffix:semicolon
r_if
c_cond
(paren
id|mode-&gt;xres
OG
id|rinfo-&gt;panel_xres
)paren
id|mode-&gt;xres
op_assign
id|rinfo-&gt;panel_xres
suffix:semicolon
r_if
c_cond
(paren
id|mode-&gt;yres
OG
id|rinfo-&gt;panel_yres
)paren
id|mode-&gt;yres
op_assign
id|rinfo-&gt;panel_yres
suffix:semicolon
id|newmode.fp_horz_stretch
op_assign
(paren
(paren
(paren
id|rinfo-&gt;panel_xres
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_lshift
id|HORZ_PANEL_SHIFT
)paren
suffix:semicolon
id|newmode.fp_vert_stretch
op_assign
(paren
(paren
id|rinfo-&gt;panel_yres
op_minus
l_int|1
)paren
op_lshift
id|VERT_PANEL_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode-&gt;xres
op_ne
id|rinfo-&gt;panel_xres
)paren
(brace
id|hRatio
op_assign
id|round_div
c_func
(paren
id|mode-&gt;xres
op_star
id|HORZ_STRETCH_RATIO_MAX
comma
id|rinfo-&gt;panel_xres
)paren
suffix:semicolon
id|newmode.fp_horz_stretch
op_assign
(paren
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|hRatio
)paren
op_amp
id|HORZ_STRETCH_RATIO_MASK
)paren
)paren
op_or
(paren
id|newmode.fp_horz_stretch
op_amp
(paren
id|HORZ_PANEL_SIZE
op_or
id|HORZ_FP_LOOP_STRETCH
op_or
id|HORZ_AUTO_RATIO_INC
)paren
)paren
)paren
suffix:semicolon
id|newmode.fp_horz_stretch
op_or_assign
(paren
id|HORZ_STRETCH_BLEND
op_or
id|HORZ_STRETCH_ENABLE
)paren
suffix:semicolon
)brace
id|newmode.fp_horz_stretch
op_and_assign
op_complement
id|HORZ_AUTO_RATIO
suffix:semicolon
r_if
c_cond
(paren
id|mode-&gt;yres
op_ne
id|rinfo-&gt;panel_yres
)paren
(brace
id|vRatio
op_assign
id|round_div
c_func
(paren
id|mode-&gt;yres
op_star
id|VERT_STRETCH_RATIO_MAX
comma
id|rinfo-&gt;panel_yres
)paren
suffix:semicolon
id|newmode.fp_vert_stretch
op_assign
(paren
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vRatio
)paren
op_amp
id|VERT_STRETCH_RATIO_MASK
)paren
)paren
op_or
(paren
id|newmode.fp_vert_stretch
op_amp
(paren
id|VERT_PANEL_SIZE
op_or
id|VERT_STRETCH_RESERVED
)paren
)paren
)paren
suffix:semicolon
id|newmode.fp_vert_stretch
op_or_assign
(paren
id|VERT_STRETCH_BLEND
op_or
id|VERT_STRETCH_ENABLE
)paren
suffix:semicolon
)brace
id|newmode.fp_vert_stretch
op_and_assign
op_complement
id|VERT_AUTO_RATIO_EN
suffix:semicolon
id|newmode.fp_gen_cntl
op_assign
(paren
id|rinfo-&gt;init_state.fp_gen_cntl
op_amp
(paren
id|u32
)paren
op_complement
(paren
id|FP_SEL_CRTC2
op_or
id|FP_RMX_HVSYNC_CONTROL_EN
op_or
id|FP_DFP_SYNC_SEL
op_or
id|FP_CRT_SYNC_SEL
op_or
id|FP_CRTC_LOCK_8DOT
op_or
id|FP_USE_SHADOW_EN
op_or
id|FP_CRTC_USE_SHADOW_VEND
op_or
id|FP_CRT_SYNC_ALT
)paren
)paren
suffix:semicolon
id|newmode.fp_gen_cntl
op_or_assign
(paren
id|FP_CRTC_DONT_SHADOW_VPAR
op_or
id|FP_CRTC_DONT_SHADOW_HEND
)paren
suffix:semicolon
id|newmode.lvds_gen_cntl
op_assign
id|rinfo-&gt;init_state.lvds_gen_cntl
suffix:semicolon
id|newmode.lvds_pll_cntl
op_assign
id|rinfo-&gt;init_state.lvds_pll_cntl
suffix:semicolon
id|newmode.tmds_crc
op_assign
id|rinfo-&gt;init_state.tmds_crc
suffix:semicolon
id|newmode.tmds_transmitter_cntl
op_assign
id|rinfo-&gt;init_state.tmds_transmitter_cntl
suffix:semicolon
r_if
c_cond
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
(brace
id|newmode.lvds_gen_cntl
op_or_assign
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
suffix:semicolon
id|newmode.fp_gen_cntl
op_and_assign
op_complement
(paren
id|FP_FPON
op_or
id|FP_TMDS_EN
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* DFP */
id|newmode.fp_gen_cntl
op_or_assign
(paren
id|FP_FPON
op_or
id|FP_TMDS_EN
)paren
suffix:semicolon
id|newmode.tmds_transmitter_cntl
op_assign
(paren
id|TMDS_RAN_PAT_RST
op_or
id|TMDS_ICHCSEL
op_or
id|TMDS_PLL_EN
)paren
op_amp
op_complement
(paren
id|TMDS_PLLRST
)paren
suffix:semicolon
id|newmode.crtc_ext_cntl
op_and_assign
op_complement
id|CRTC_CRT_ON
suffix:semicolon
)brace
id|newmode.fp_crtc_h_total_disp
op_assign
(paren
(paren
(paren
id|rinfo-&gt;hblank
op_div
l_int|8
)paren
op_amp
l_int|0x3ff
)paren
op_or
(paren
(paren
(paren
id|mode-&gt;xres
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|newmode.fp_crtc_v_total_disp
op_assign
(paren
id|rinfo-&gt;vblank
op_amp
l_int|0xffff
)paren
op_or
(paren
(paren
id|mode-&gt;yres
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|newmode.fp_h_sync_strt_wid
op_assign
(paren
(paren
id|rinfo-&gt;hOver_plus
op_amp
l_int|0x1fff
)paren
op_or
(paren
id|hsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|h_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
id|newmode.fp_v_sync_strt_wid
op_assign
(paren
(paren
id|rinfo-&gt;vOver_plus
op_amp
l_int|0xfff
)paren
op_or
(paren
id|vsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|v_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* do it! */
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;asleep
)paren
(brace
id|radeon_write_mode
(paren
id|rinfo
comma
op_amp
id|newmode
)paren
suffix:semicolon
multiline_comment|/* (re)initialize the engine */
r_if
c_cond
(paren
id|noaccel
)paren
id|radeon_engine_init
(paren
id|rinfo
)paren
suffix:semicolon
)brace
multiline_comment|/* Update fix */
r_if
c_cond
(paren
id|accel
)paren
id|info-&gt;fix.line_length
op_assign
id|rinfo-&gt;pitch
op_star
l_int|64
suffix:semicolon
r_else
id|info-&gt;fix.line_length
op_assign
id|mode-&gt;xres_virtual
op_star
(paren
(paren
id|mode-&gt;bits_per_pixel
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|rinfo-&gt;depth
op_eq
l_int|8
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
macro_line|#ifdef CONFIG_BOOTX_TEXT
multiline_comment|/* Update debug text engine */
id|btext_update_display
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|mode-&gt;xres
comma
id|mode-&gt;yres
comma
id|rinfo-&gt;depth
comma
id|info-&gt;fix.line_length
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_write_mode
r_static
r_void
id|radeon_write_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|mode
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|primary_mon
op_assign
id|PRIMARY_MONITOR
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeonfb_blank
c_func
(paren
id|VESA_POWERDOWN
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;arch
op_eq
id|RADEON_M6
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|common_regs_m6
(braket
id|i
)braket
dot
id|reg
comma
id|common_regs_m6
(braket
id|i
)braket
dot
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|common_regs
(braket
id|i
)braket
dot
id|reg
comma
id|common_regs
(braket
id|i
)braket
dot
id|val
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|mode-&gt;crtc_gen_cntl
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|mode-&gt;crtc_ext_cntl
comma
id|CRTC_HSYNC_DIS
op_or
id|CRTC_VSYNC_DIS
op_or
id|CRTC_DISPLAY_DIS
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|DAC_CNTL
comma
id|mode-&gt;dac_cntl
comma
id|DAC_RANGE_CNTL
op_or
id|DAC_BLANKING
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|mode-&gt;crtc_h_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|mode-&gt;crtc_h_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|mode-&gt;crtc_v_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|mode-&gt;crtc_v_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_PITCH
comma
id|mode-&gt;crtc_pitch
)paren
suffix:semicolon
macro_line|#if defined(__BIG_ENDIAN)
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
id|mode-&gt;surface_cntl
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
(paren
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
op_amp
id|PPLL_DIV_SEL_MASK
)paren
op_ne
id|PPLL_DIV_SEL_MASK
)paren
(brace
id|OUTREGP
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|PPLL_DIV_SEL_MASK
comma
l_int|0xffff
)paren
suffix:semicolon
)brace
id|OUTPLLP
c_func
(paren
id|PPLL_CNTL
comma
id|PPLL_RESET
comma
l_int|0xffff
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_REF_DIV
)paren
op_amp
id|PPLL_REF_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_ref_div
op_amp
id|PPLL_REF_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_REF_DIV
comma
id|mode-&gt;ppll_ref_div
comma
op_complement
id|PPLL_REF_DIV_MASK
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_DIV_3
)paren
op_amp
id|PPLL_FB3_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_div_3
op_amp
id|PPLL_FB3_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_DIV_3
comma
id|mode-&gt;ppll_div_3
comma
op_complement
id|PPLL_FB3_DIV_MASK
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_DIV_3
)paren
op_amp
id|PPLL_POST3_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_div_3
op_amp
id|PPLL_POST3_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_DIV_3
comma
id|mode-&gt;ppll_div_3
comma
op_complement
id|PPLL_POST3_DIV_MASK
)paren
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|HTOTAL_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLLP
c_func
(paren
id|PPLL_CNTL
comma
l_int|0
comma
op_complement
id|PPLL_RESET
)paren
suffix:semicolon
singleline_comment|//&t;OUTREG(DDA_CONFIG, mode-&gt;dda_config);
singleline_comment|//&t;OUTREG(DDA_ON_OFF, mode-&gt;dda_on_off);
r_if
c_cond
(paren
(paren
id|primary_mon
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
)paren
(brace
id|OUTREG
c_func
(paren
id|FP_CRTC_H_TOTAL_DISP
comma
id|mode-&gt;fp_crtc_h_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_CRTC_V_TOTAL_DISP
comma
id|mode-&gt;fp_crtc_v_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_H_SYNC_STRT_WID
comma
id|mode-&gt;fp_h_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_V_SYNC_STRT_WID
comma
id|mode-&gt;fp_v_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_HORZ_STRETCH
comma
id|mode-&gt;fp_horz_stretch
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_VERT_STRETCH
comma
id|mode-&gt;fp_vert_stretch
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|mode-&gt;fp_gen_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_CRC
comma
id|mode-&gt;tmds_crc
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|mode-&gt;tmds_transmitter_cntl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|primary_mon
op_eq
id|MT_LCD
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|mode-&gt;lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_STATE_MASK
suffix:semicolon
id|mode-&gt;lvds_gen_cntl
op_or_assign
(paren
id|rinfo-&gt;init_state.lvds_gen_cntl
op_amp
id|LVDS_STATE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
)paren
op_eq
(paren
id|mode-&gt;lvds_gen_cntl
op_amp
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
)paren
)paren
(brace
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|mode-&gt;lvds_gen_cntl
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mode-&gt;lvds_gen_cntl
op_amp
(paren
id|LVDS_ON
op_or
id|LVDS_BLON
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|mode-&gt;lvds_gen_cntl
)paren
suffix:semicolon
)brace
r_else
(brace
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|mode-&gt;lvds_gen_cntl
op_or
id|LVDS_BLON
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|mode-&gt;lvds_gen_cntl
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|radeonfb_blank
c_func
(paren
id|VESA_NO_BLANKING
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|mode-&gt;vclk_ecp_cntl
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|radeonfb_ops
r_static
r_struct
id|fb_ops
id|radeonfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_check_var
op_assign
id|radeonfb_check_var
comma
dot
id|fb_set_par
op_assign
id|radeonfb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|radeonfb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|radeonfb_pan_display
comma
dot
id|fb_blank
op_assign
id|radeonfb_blank
comma
dot
id|fb_ioctl
op_assign
id|radeonfb_ioctl
comma
macro_line|#if 0
dot
id|fb_fillrect
op_assign
id|radeonfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|radeonfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|radeonfb_imageblit
comma
dot
id|fb_rasterimg
op_assign
id|radeonfb_rasterimg
comma
macro_line|#else
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
macro_line|#endif
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
DECL|function|radeon_set_fbinfo
r_static
r_int
id|__devinit
id|radeon_set_fbinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
id|info-&gt;par
op_assign
id|rinfo
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|rinfo-&gt;pseudo_palette
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_DEFAULT
op_or
id|FBINFO_HWACCEL_YPAN
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|radeonfb_ops
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|rinfo-&gt;fb_base
suffix:semicolon
multiline_comment|/* Fill fix common fields */
id|strlcpy
c_func
(paren
id|info-&gt;fix.id
comma
id|rinfo-&gt;name
comma
r_sizeof
(paren
id|info-&gt;fix.id
)paren
)paren
suffix:semicolon
id|info-&gt;fix.smem_start
op_assign
id|rinfo-&gt;fb_base_phys
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
id|rinfo-&gt;video_ram
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|info-&gt;fix.xpanstep
op_assign
l_int|8
suffix:semicolon
id|info-&gt;fix.ypanstep
op_assign
l_int|1
suffix:semicolon
id|info-&gt;fix.ywrapstep
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.type_aux
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.mmio_start
op_assign
id|rinfo-&gt;mmio_base_phys
suffix:semicolon
id|info-&gt;fix.mmio_len
op_assign
id|RADEON_REGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
r_else
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_ATI_RADEON
suffix:semicolon
r_if
c_cond
(paren
id|radeon_init_disp
(paren
id|rinfo
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
multiline_comment|/* TODO: Dbl check these tables, we don&squot;t go up to full ON backlight&n; * in these, possibly because we noticed MacOS doesn&squot;t, but I&squot;d prefer&n; * having some more official numbers from ATI&n; */
DECL|variable|backlight_conv_m6
r_static
r_int
id|backlight_conv_m6
(braket
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xc0
comma
l_int|0xb5
comma
l_int|0xaa
comma
l_int|0x9f
comma
l_int|0x94
comma
l_int|0x89
comma
l_int|0x7e
comma
l_int|0x73
comma
l_int|0x68
comma
l_int|0x5d
comma
l_int|0x52
comma
l_int|0x47
comma
l_int|0x3c
comma
l_int|0x31
comma
l_int|0x24
)brace
suffix:semicolon
DECL|variable|backlight_conv_m7
r_static
r_int
id|backlight_conv_m7
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x3f
comma
l_int|0x4a
comma
l_int|0x55
comma
l_int|0x60
comma
l_int|0x6b
comma
l_int|0x76
comma
l_int|0x81
comma
l_int|0x8c
comma
l_int|0x97
comma
l_int|0xa2
comma
l_int|0xad
comma
l_int|0xb8
comma
l_int|0xc3
comma
l_int|0xce
comma
l_int|0xd9
)brace
suffix:semicolon
DECL|macro|BACKLIGHT_LVDS_OFF
mdefine_line|#define BACKLIGHT_LVDS_OFF
DECL|macro|BACKLIGHT_DAC_OFF
macro_line|#undef BACKLIGHT_DAC_OFF
multiline_comment|/* We turn off the LCD completely instead of just dimming the backlight.&n; * This provides some greater power saving and the display is useless&n; * without backlight anyway.&n; */
DECL|function|radeon_set_backlight_enable
r_static
r_int
id|radeon_set_backlight_enable
c_func
(paren
r_int
id|on
comma
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|data
suffix:semicolon
r_int
r_int
id|lvds_gen_cntl
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
r_int
op_star
id|conv_table
suffix:semicolon
multiline_comment|/* Pardon me for that hack... maybe some day we can figure&n;&t; * out in what direction backlight should work on a given&n;&t; * panel ?&n;&t; */
r_if
c_cond
(paren
(paren
id|rinfo-&gt;arch
op_eq
id|RADEON_M7
op_logical_or
id|rinfo-&gt;arch
op_eq
id|RADEON_M9
)paren
op_logical_and
op_logical_neg
id|machine_is_compatible
c_func
(paren
l_string|&quot;PowerBook4,3&quot;
)paren
)paren
id|conv_table
op_assign
id|backlight_conv_m7
suffix:semicolon
r_else
id|conv_table
op_assign
id|backlight_conv_m6
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
(paren
id|LVDS_BL_MOD_EN
op_or
id|LVDS_BLON
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
op_logical_and
(paren
id|level
OG
id|BACKLIGHT_OFF
)paren
)paren
(brace
id|lvds_gen_cntl
op_or_assign
id|LVDS_DIGON
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lvds_gen_cntl
op_amp
id|LVDS_ON
)paren
)paren
(brace
id|lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_BLON
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|lvds_gen_cntl
)paren
suffix:semicolon
(paren
r_void
)paren
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
id|LVDS_BLON
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|lvds_gen_cntl
)paren
suffix:semicolon
)brace
id|lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_BL_MOD_LEVEL_MASK
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
(paren
id|conv_table
(braket
id|level
)braket
op_lshift
id|LVDS_BL_MOD_LEVEL_SHIFT
)paren
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
(paren
id|LVDS_ON
op_or
id|LVDS_EN
)paren
suffix:semicolon
id|lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_DISPLAY_DIS
suffix:semicolon
)brace
r_else
(brace
id|lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_BL_MOD_LEVEL_MASK
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
(paren
id|conv_table
(braket
l_int|0
)braket
op_lshift
id|LVDS_BL_MOD_LEVEL_SHIFT
)paren
suffix:semicolon
id|lvds_gen_cntl
op_or_assign
id|LVDS_DISPLAY_DIS
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|lvds_gen_cntl
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|lvds_gen_cntl
op_and_assign
op_complement
(paren
id|LVDS_ON
op_or
id|LVDS_EN
op_or
id|LVDS_BLON
op_or
id|LVDS_DIGON
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|lvds_gen_cntl
)paren
suffix:semicolon
id|rinfo-&gt;init_state.lvds_gen_cntl
op_and_assign
op_complement
id|LVDS_STATE_MASK
suffix:semicolon
id|rinfo-&gt;init_state.lvds_gen_cntl
op_or_assign
(paren
id|lvds_gen_cntl
op_amp
id|LVDS_STATE_MASK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_set_backlight_level
r_static
r_int
id|radeon_set_backlight_level
c_func
(paren
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|radeon_set_backlight_enable
c_func
(paren
l_int|1
comma
id|level
comma
id|data
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
macro_line|#ifdef CONFIG_PMAC_PBOOK
DECL|variable|dbg_clk
r_static
id|u32
id|dbg_clk
suffix:semicolon
multiline_comment|/*&n; * Radeon M6 Power Management code. This code currently only supports&n; * the mobile chips, it&squot;s based from some informations provided by ATI&n; * along with hours of tracing of MacOS drivers&n; */
DECL|function|radeon_pm_save_regs
r_static
r_void
id|radeon_pm_save_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
op_assign
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PIN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
op_assign
id|INPLL
c_func
(paren
id|PIXCLKS_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_MISC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_assign
id|INPLL
c_func
(paren
id|P2PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
op_assign
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_VGA_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_DVI_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_MONID
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_CRT2_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
op_assign
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
op_assign
id|INREG
c_func
(paren
id|MC_FB_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
op_assign
id|INREG
c_func
(paren
id|DISPLAY_BASE_ADDR
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
op_assign
id|INREG
c_func
(paren
id|MC_AGP_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_restore_regs
r_static
r_void
id|radeon_pm_restore_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_amp
l_int|0xFFFFFFFE
)paren
suffix:semicolon
multiline_comment|/* First */
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PIXCLKS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_MISC
comma
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
)paren
suffix:semicolon
singleline_comment|// wait VBL before that one  ?
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_disable_iopad
r_static
r_void
id|radeon_pm_disable_iopad
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
l_int|0x0001ffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
l_int|0x00000400
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_program_v2clk
r_static
r_void
id|radeon_pm_program_v2clk
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
singleline_comment|//
singleline_comment|//&t;u32 reg;
singleline_comment|//
singleline_comment|//&t;OUTPLL(P2PLL_REF_DIV, 0x0c);
singleline_comment|//
singleline_comment|//      .../... figure out what macos does here
)brace
DECL|function|radeon_pm_low_current
r_static
r_void
id|radeon_pm_low_current
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|reg
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_MASK
suffix:semicolon
id|reg
op_or_assign
id|BUS_CNTL1_AGPCLK_VALID
op_or
(paren
l_int|1
op_lshift
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|reg
op_or_assign
id|PLL_PWRMGT_CNTL_SPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_PPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_P2PLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_TVPLL_TURNOFF
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_SU_MCLK_USE_BCLK
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_MOBILE_SU
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|reg
)paren
suffix:semicolon
singleline_comment|//&t;reg  = INPLL(TV_PLL_CNTL1);
singleline_comment|//&t;reg |= TV_PLL_CNTL1__TVPLL_RESET | TV_PLL_CNTL1__TVPLL_SLEEP;
singleline_comment|//&t;OUTPLL(TV_PLL_CNTL1, reg);
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TV_DAC_CNTL_BGADJ_MASK
op_or
id|TV_DAC_CNTL_DACADJ_MASK
)paren
suffix:semicolon
id|reg
op_or_assign
id|TV_DAC_CNTL_BGSLEEP
op_or
id|TV_DAC_CNTL_RDACPD
op_or
id|TV_DAC_CNTL_GDACPD
op_or
id|TV_DAC_CNTL_BDACPD
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_BGADJ__SHIFT
)paren
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_DACADJ__SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TMDS_PLL_EN
op_or
id|TMDS_PLLRST
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|reg
)paren
suffix:semicolon
singleline_comment|//&t;lvds_pll_cntl  = regr32(g, LVDS_PLL_CNTL);
singleline_comment|//&t;lvds_pll_cntl &amp;= ~LVDS_PLL_CNTL__LVDS_PLL_EN;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;
singleline_comment|//&t;lvds_pll_cntl |=  LVDS_PLL_CNTL__LVDS_PLL_RESET;&t;
singleline_comment|//&t;regw32(g, LVDS_PLL_CNTL, lvds_pll_cntl);
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC2_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|TV_DAC_CNTL_DETECT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_setup_for_suspend
r_static
r_void
id|radeon_pm_setup_for_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
multiline_comment|/* This code is disabled. It does what is in the pm_init&n;&t; * function of the MacOS driver code ATI sent me. However,&n;&t; * it doesn&squot;t fix my sleep problem, and is causing other issues&n;&t; * on wakeup (bascially the machine dying when switching consoles&n;&t; * I haven&squot;t had time to investigate this yet&n;&t; */
macro_line|#if 0
id|u32
id|disp_misc_cntl
suffix:semicolon
id|u32
id|disp_pwr_man
suffix:semicolon
id|u32
id|temp
suffix:semicolon
singleline_comment|// set SPLL, MPLL, PPLL, P2PLL, TVPLL, SCLK, MCLK, PCLK, P2CLK,
singleline_comment|// TCLK and TEST_MODE to 0
id|temp
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|temp
op_amp
op_complement
l_int|0xc00002ff
)paren
suffix:semicolon
singleline_comment|// Turn on Power Management
id|temp
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|temp
op_or
l_int|0x00000400
)paren
suffix:semicolon
singleline_comment|// Turn off display clock if using mobile chips
id|temp
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|temp
op_or
l_int|0x00100000
)paren
suffix:semicolon
singleline_comment|// Force PIXCLK_ALWAYS_ON and PIXCLK_DAC_ALWAYS_ON
id|temp
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|temp
op_amp
op_complement
l_int|0x000000c0
)paren
suffix:semicolon
singleline_comment|// Force ECP_FORCE_ON to 1
id|temp
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|temp
op_or
l_int|0x00040000
)paren
suffix:semicolon
singleline_comment|// Force PIXCLK_BLEND_ALWAYS_ON and PIXCLK_GV_ALWAYS_ON
id|temp
op_assign
id|INPLL
c_func
(paren
id|PIXCLKS_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PIXCLKS_CNTL
comma
id|temp
op_amp
op_complement
l_int|0x00001800
)paren
suffix:semicolon
singleline_comment|// Forcing SCLK_CNTL to ON
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
(paren
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
op_amp
l_int|0x00000007
)paren
op_or
l_int|0xffff8000
)paren
suffix:semicolon
singleline_comment|// Set PM control over XTALIN pad
id|temp
op_assign
id|INPLL
c_func
(paren
id|CLK_PIN_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|temp
op_or
l_int|0x00080000
)paren
suffix:semicolon
singleline_comment|// Force MCLK and YCLK and MC as dynamic
id|temp
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|temp
op_amp
l_int|0xffeaffff
)paren
suffix:semicolon
singleline_comment|// PLL_TURNOFF
id|temp
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|temp
op_or
l_int|0x0000001f
)paren
suffix:semicolon
singleline_comment|// set MOBILE_SU to 1 if M6 or DDR64 is detected
id|temp
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|temp
op_or
l_int|0x00010000
)paren
suffix:semicolon
singleline_comment|// select PM access mode (PM_MODE_SEL) (use ACPI mode)
singleline_comment|//      temp = INPLL(PLL_PWRMGT_CNTL);
singleline_comment|//      OUTPLL(PLL_PWRMGT_CNTL, temp | 0x00002000);
id|temp
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|temp
op_amp
op_complement
l_int|0x00002000
)paren
suffix:semicolon
singleline_comment|// set DISP_MISC_CNTL register
id|disp_misc_cntl
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|disp_misc_cntl
op_and_assign
op_complement
(paren
id|DISP_MISC_CNTL_SOFT_RESET_GRPH_PP
op_or
id|DISP_MISC_CNTL_SOFT_RESET_SUBPIC_PP
op_or
id|DISP_MISC_CNTL_SOFT_RESET_OV0_PP
op_or
id|DISP_MISC_CNTL_SOFT_RESET_GRPH_SCLK
op_or
id|DISP_MISC_CNTL_SOFT_RESET_SUBPIC_SCLK
op_or
id|DISP_MISC_CNTL_SOFT_RESET_OV0_SCLK
op_or
id|DISP_MISC_CNTL_SOFT_RESET_GRPH2_PP
op_or
id|DISP_MISC_CNTL_SOFT_RESET_GRPH2_SCLK
op_or
id|DISP_MISC_CNTL_SOFT_RESET_LVDS
op_or
id|DISP_MISC_CNTL_SOFT_RESET_TMDS
op_or
id|DISP_MISC_CNTL_SOFT_RESET_DIG_TMDS
op_or
id|DISP_MISC_CNTL_SOFT_RESET_TV
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|disp_misc_cntl
)paren
suffix:semicolon
singleline_comment|// set DISP_PWR_MAN register
id|disp_pwr_man
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
singleline_comment|// clau - 9.29.2000 - changes made to bit23:18 to set to 1 as requested by George
id|disp_pwr_man
op_or_assign
(paren
id|DISP_PWR_MAN_DIG_TMDS_ENABLE_RST
op_or
id|DISP_PWR_MAN_TV_ENABLE_RST
op_or
singleline_comment|//                 DISP_PWR_MAN_AUTO_PWRUP_EN |
id|DISP_PWR_MAN_DISP_D3_GRPH_RST
op_or
id|DISP_PWR_MAN_DISP_D3_SUBPIC_RST
op_or
id|DISP_PWR_MAN_DISP_D3_OV0_RST
op_or
id|DISP_PWR_MAN_DISP_D1D2_GRPH_RST
op_or
id|DISP_PWR_MAN_DISP_D1D2_SUBPIC_RST
op_or
id|DISP_PWR_MAN_DISP_D1D2_OV0_RST
)paren
suffix:semicolon
id|disp_pwr_man
op_and_assign
op_complement
(paren
id|DISP_PWR_MAN_DISP_PWR_MAN_D3_CRTC_EN
op_or
id|DISP_PWR_MAN_DISP2_PWR_MAN_D3_CRTC2_EN
op_or
id|DISP_PWR_MAN_DISP_D3_RST
op_or
id|DISP_PWR_MAN_DISP_D3_REG_RST
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|disp_pwr_man
)paren
suffix:semicolon
singleline_comment|// clau - 10.24.2000
singleline_comment|// - add in setting for BUS_CNTL1 b27:26 = 0x01 and b31 = 0x1
singleline_comment|// - add in setting for AGP_CNTL  b7:0 = 0x20
singleline_comment|// - add in setting for DVI_DDC_DATA_OUT_EN b17:16 = 0x0
singleline_comment|// the following settings (two lines) are applied at a later part of this function, only on mobile platform
singleline_comment|// requres -mobile flag
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
(paren
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_amp
l_int|0xf3ffffff
)paren
op_or
l_int|0x04000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_or
l_int|0x80000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
(paren
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
op_amp
l_int|0xffffff00
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
id|INREG
c_func
(paren
id|GPIO_DVI_DDC
)paren
op_amp
l_int|0xfffcffff
)paren
suffix:semicolon
singleline_comment|// yulee - 12.12.2000
singleline_comment|// A12 only
singleline_comment|// EN_MCLK_TRISTATE_IN_SUSPEND@MCLK_MISC = 1
singleline_comment|// ACCESS_REGS_IN_SUSPEND@CLK_PIN_CNTL = 0
singleline_comment|// only on mobile platform
id|OUTPLL
c_func
(paren
id|MCLK_MISC
comma
id|INPLL
c_func
(paren
id|MCLK_MISC
)paren
op_or
l_int|0x00040000
)paren
suffix:semicolon
singleline_comment|// yulee -12.12.2000
singleline_comment|// AGPCLK_VALID@BUS_CNTL1 = 1
singleline_comment|// MOBILE_PLATFORM_SEL@BUS_CNTL1 = 01
singleline_comment|// CRTC_STEREO_SYNC_OUT_EN@CRTC_OFFSET_CNTL = 0
singleline_comment|// CG_CLK_TO_OUTPIN@CLK_PIN_CNTL = 0
singleline_comment|// only on mobile platform
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|INPLL
c_func
(paren
id|CLK_PIN_CNTL
)paren
op_amp
l_int|0xFFFFF7FF
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
(paren
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_amp
l_int|0xF3FFFFFF
)paren
op_or
l_int|0x84000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
op_amp
l_int|0xFFEFFFFF
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Disable CRTCs */
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC_EN
)paren
op_or
id|CRTC_DISP_REQ_EN_B
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC2_EN
)paren
op_or
id|CRTC2_DISP_REQ_EN_B
)paren
suffix:semicolon
(paren
r_void
)paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|17
)paren
suffix:semicolon
)brace
DECL|function|radeon_set_suspend
r_static
r_void
id|radeon_set_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|suspend
)paren
(brace
id|u16
id|pwr_cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;pm_reg
)paren
r_return
suffix:semicolon
multiline_comment|/* Set the chip into appropriate suspend mode (we use D2,&n;&t; * D3 would require a compete re-initialization of the chip,&n;&t; * including PCI config registers, clocks, AGP conf, ...)&n;&t; */
r_if
c_cond
(paren
id|suspend
)paren
(brace
multiline_comment|/* According to ATI, we should program V2CLK here, I have&n;&t;&t; * to verify what&squot;s up exactly&n;&t;&t; */
multiline_comment|/* Save some registers */
id|radeon_pm_save_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Check that on M7 too, might work might not. M7 may also&n;&t;&t; * need explicit enabling of PM&n;&t;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;arch
op_eq
id|RADEON_M6
)paren
(brace
multiline_comment|/* Program V2CLK */
id|radeon_pm_program_v2clk
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Disable IO PADs */
id|radeon_pm_disable_iopad
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Set low current */
id|radeon_pm_low_current
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Prepare chip for power management */
id|radeon_pm_setup_for_suspend
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Reset the MDLL */
id|OUTPLL
c_func
(paren
id|MDLL_CKO
comma
id|INPLL
c_func
(paren
id|MDLL_CKO
)paren
op_or
id|MCKOA_RESET
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|MDLL_RDCKA
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MDLL_CKO
comma
id|INPLL
c_func
(paren
id|MDLL_CKO
)paren
op_amp
op_complement
id|MCKOA_RESET
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|MDLL_RDCKA
)paren
suffix:semicolon
)brace
multiline_comment|/* Switch PCI power managment to D2. */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|pci_read_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
op_amp
id|pwr_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pwr_cmd
op_amp
l_int|2
)paren
r_break
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
(paren
id|pwr_cmd
op_amp
op_complement
id|PCI_PM_CTRL_STATE_MASK
)paren
op_or
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Switch back PCI powermanagment to D0 */
id|mdelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|dbg_clk
op_assign
id|INPLL
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Do we need that on M7 ? */
r_if
c_cond
(paren
id|rinfo-&gt;arch
op_eq
id|RADEON_M6
)paren
(brace
multiline_comment|/* Restore the MDLL */
id|OUTPLL
c_func
(paren
id|MDLL_CKO
comma
id|INPLL
c_func
(paren
id|MDLL_CKO
)paren
op_amp
op_complement
id|MCKOA_RESET
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|MDLL_CKO
)paren
suffix:semicolon
)brace
multiline_comment|/* Restore some registers */
id|radeon_pm_restore_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Save the contents of the framebuffer when we go to sleep,&n; * and restore it when we wake up again.&n; */
DECL|function|radeon_sleep_notify
r_int
id|radeon_sleep_notify
c_func
(paren
r_struct
id|pmu_sleep_notifier
op_star
id|self
comma
r_int
id|when
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
suffix:semicolon
r_for
c_loop
(paren
id|rinfo
op_assign
id|board_list
suffix:semicolon
id|rinfo
op_ne
l_int|NULL
suffix:semicolon
id|rinfo
op_assign
id|rinfo-&gt;next
)paren
(brace
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_int
id|nb
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
id|disp
op_assign
(paren
id|rinfo-&gt;currcon
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|rinfo-&gt;currcon
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|rinfo-&gt;arch
)paren
(brace
r_case
id|RADEON_M6
suffix:colon
r_case
id|RADEON_M7
suffix:colon
r_case
id|RADEON_M9
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|PBOOK_SLEEP_REFUSE
suffix:semicolon
)brace
id|radeonfb_get_fix
c_func
(paren
op_amp
id|fix
comma
id|fg_console
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|nb
op_assign
id|fb_display
(braket
id|fg_console
)braket
dot
id|var.yres
op_star
id|fix.line_length
suffix:semicolon
r_switch
c_cond
(paren
id|when
)paren
(brace
r_case
id|PBOOK_SLEEP_NOW
suffix:colon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|noaccel
)paren
(brace
multiline_comment|/* Make sure engine is reset */
id|radeon_engine_reset
c_func
(paren
)paren
suffix:semicolon
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Blank display and LCD */
id|radeonfb_blank
c_func
(paren
id|VESA_POWERDOWN
op_plus
l_int|1
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Sleep */
id|rinfo-&gt;asleep
op_assign
l_int|1
suffix:semicolon
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|1
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PBOOK_WAKE
suffix:colon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Wakeup */
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|noaccel
)paren
id|radeon_engine_init
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|rinfo-&gt;asleep
op_assign
l_int|0
suffix:semicolon
id|radeon_set_dispsw
c_func
(paren
id|rinfo
comma
id|disp
)paren
suffix:semicolon
id|radeon_load_video_mode
c_func
(paren
id|rinfo
comma
op_amp
id|disp-&gt;var
)paren
suffix:semicolon
id|do_install_cmap
c_func
(paren
id|rinfo-&gt;currcon
OL
l_int|0
ques
c_cond
l_int|0
suffix:colon
id|rinfo-&gt;currcon
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|radeonfb_blank
c_func
(paren
l_int|0
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CLK_PIN_CNTL on wakeup was: %08x&bslash;n&quot;
comma
id|dbg_clk
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|PBOOK_SLEEP_OK
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC_PBOOK */
DECL|function|radeonfb_pci_register
r_static
r_int
id|radeonfb_pci_register
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
suffix:semicolon
r_struct
id|radeon_chip_info
op_star
id|rci
op_assign
op_amp
id|radeon_chip_info
(braket
id|ent-&gt;driver_data
)braket
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;radeonfb_pci_register BEGIN&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Enable device in PCI config */
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb: Cannot enable PCI device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|rinfo
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|radeonfb_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: could not allocate memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|memset
(paren
id|rinfo
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|radeonfb_info
)paren
)paren
suffix:semicolon
singleline_comment|//info = &amp;rinfo-&gt;info;
id|rinfo-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|strcpy
c_func
(paren
id|rinfo-&gt;name
comma
id|rci-&gt;name
)paren
suffix:semicolon
id|rinfo-&gt;arch
op_assign
id|rci-&gt;arch
suffix:semicolon
multiline_comment|/* Set base addrs */
id|rinfo-&gt;fb_base_phys
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;mmio_base_phys
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* request the mem regions */
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
l_string|&quot;radeonfb&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot reserve FB region&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
comma
l_string|&quot;radeonfb&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* map the regions */
id|rinfo-&gt;mmio_base
op_assign
id|ioremap
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|RADEON_REGSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;mmio_base
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot map MMIO&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|rinfo-&gt;chipset
op_assign
id|pdev-&gt;device
suffix:semicolon
r_switch
c_cond
(paren
id|rinfo-&gt;arch
)paren
(brace
r_case
id|RADEON_R100
suffix:colon
id|rinfo-&gt;hasCRTC2
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* all the rest have it */
id|rinfo-&gt;hasCRTC2
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#if 0
r_if
c_cond
(paren
id|rinfo-&gt;arch
op_eq
id|RADEON_M7
)paren
(brace
multiline_comment|/*&n;&t;&t; * Noticed some errors in accel with M7, will have to work these out...&n;&t;&t; */
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|mirror
)paren
id|printk
c_func
(paren
l_string|&quot;radeonfb: mirroring display to CRT&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* framebuffer size */
id|tmp
op_assign
id|INREG
c_func
(paren
id|CONFIG_MEMSIZE
)paren
suffix:semicolon
multiline_comment|/* mem size is bits [28:0], mask off the rest */
id|rinfo-&gt;video_ram
op_assign
id|tmp
op_amp
id|CONFIG_MEMSIZE_MASK
suffix:semicolon
multiline_comment|/* ram type */
id|tmp
op_assign
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|MEM_CFG_TYPE
op_amp
id|tmp
)paren
op_rshift
l_int|30
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* SDR SGRAM (2:1) */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;SDR SGRAM&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|16
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* DDR SGRAM */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;DDR SGRAM&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.tr2w
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|16
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* 64-bit SDR SGRAM */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;SDR SGRAM 64&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|8
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.tr2w
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|17
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|17
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rinfo-&gt;bios_seg
op_assign
id|radeon_find_rom
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_get_pllinfo
c_func
(paren
id|rinfo
comma
id|rinfo-&gt;bios_seg
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Hack to get around some busted production M6&squot;s&n;&t; * reporting no ram&n;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;video_ram
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|pdev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LY
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LZ
suffix:colon
id|rinfo-&gt;video_ram
op_assign
l_int|8192
op_star
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
id|RTRACE
c_func
(paren
l_string|&quot;radeonfb: probed %s %dk videoram&bslash;n&quot;
comma
(paren
id|rinfo-&gt;ram_type
)paren
comma
(paren
id|rinfo-&gt;video_ram
op_div
l_int|1024
)paren
)paren
suffix:semicolon
macro_line|#if !defined(__powerpc__)
id|radeon_get_moninfo
c_func
(paren
id|rinfo
)paren
suffix:semicolon
macro_line|#else
r_switch
c_cond
(paren
id|pdev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LW
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LX
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LY
suffix:colon
r_case
id|PCI_DEVICE_ID_ATI_RADEON_LZ
suffix:colon
id|rinfo-&gt;dviDisp_type
op_assign
id|MT_LCD
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|radeon_get_moninfo
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
id|radeon_get_EDID
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_DFP
)paren
op_logical_or
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_LCD
)paren
op_logical_or
(paren
id|rinfo-&gt;crtDisp_type
op_eq
id|MT_DFP
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|radeon_get_dfpinfo
c_func
(paren
id|rinfo
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|rinfo-&gt;fb_base
op_assign
id|ioremap
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;fb_base
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot map FB&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* I SHOULD FIX THAT CRAP ! I should probably mimmic XFree DRI&n;&t; * driver setup here.&n;&t; * &n;&t; * On PPC, OF based cards setup the internal memory&n;&t; * mapping in strange ways. We change it so that the&n;&t; * framebuffer is mapped at 0 and given half of the card&squot;s&n;&t; * address space (2Gb). AGP is mapped high (0xe0000000) and&n;&t; * can use up to 512Mb. Once DRI is fully implemented, we&n;&t; * will have to setup the PCI remapper to remap the agp_special_page&n;&t; * memory page somewhere between those regions so that the card&n;&t; * use a normal PCI bus master cycle to access the ring read ptr.&n;&t; * --BenH.&n;&t; */
macro_line|#ifdef CONFIG_ALL_PPC
r_if
c_cond
(paren
id|rinfo-&gt;hasCRTC2
)paren
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC2_EN
)paren
op_or
id|CRTC2_DISP_REQ_EN_B
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
op_or
id|CRTC_DISPLAY_DIS
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
l_int|0x7fff0000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
l_int|0xffffe000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
l_int|0x00000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;hasCRTC2
)paren
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SRC_OFFSET
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_OFFSET
comma
l_int|0x00000000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
op_amp
op_complement
id|CRTC_DISPLAY_DIS
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ALL_PPC */
multiline_comment|/* save current mode regs before we switch into the new one&n;&t; * so we can restore this upon __exit&n;&t; */
id|radeon_save_state
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;init_state
)paren
suffix:semicolon
multiline_comment|/* set all the vital stuff */
id|radeon_set_fbinfo
(paren
id|rinfo
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|rinfo
)paren
suffix:semicolon
id|rinfo-&gt;next
op_assign
id|board_list
suffix:semicolon
id|board_list
op_assign
id|rinfo
suffix:semicolon
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
op_member_access_from_pointer
id|device
op_assign
op_amp
id|pdev-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: could not register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|rinfo-&gt;fb_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MTRR
id|rinfo-&gt;mtrr_hdl
op_assign
id|nomtrr
ques
c_cond
op_minus
l_int|1
suffix:colon
id|mtrr_add
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;video_ram
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_LCD
)paren
id|register_backlight_controller
c_func
(paren
op_amp
id|radeon_backlight_controller
comma
id|rinfo
comma
l_string|&quot;ati&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_PBOOK
r_if
c_cond
(paren
id|rinfo-&gt;dviDisp_type
op_eq
id|MT_LCD
)paren
(brace
id|rinfo-&gt;pm_reg
op_assign
id|pci_find_capability
c_func
(paren
id|pdev
comma
id|PCI_CAP_ID_PM
)paren
suffix:semicolon
id|pmu_register_sleep_notifier
c_func
(paren
op_amp
id|radeon_sleep_notifier
)paren
suffix:semicolon
)brace
macro_line|#endif
id|printk
(paren
l_string|&quot;radeonfb: ATI Radeon %s %s %d MB&bslash;n&quot;
comma
id|rinfo-&gt;name
comma
id|rinfo-&gt;ram_type
comma
(paren
id|rinfo-&gt;video_ram
op_div
(paren
l_int|1024
op_star
l_int|1024
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;hasCRTC2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: DVI port %s monitor connected&bslash;n&quot;
comma
id|GET_MON_NAME
c_func
(paren
id|rinfo-&gt;dviDisp_type
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: CRT port %s monitor connected&bslash;n&quot;
comma
id|GET_MON_NAME
c_func
(paren
id|rinfo-&gt;crtDisp_type
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: CRT port %s monitor connected&bslash;n&quot;
comma
id|GET_MON_NAME
c_func
(paren
id|rinfo-&gt;crtDisp_type
)paren
)paren
suffix:semicolon
)brace
id|RTRACE
c_func
(paren
l_string|&quot;radeonfb_pci_register END&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pci_unregister
r_static
r_void
id|__devexit
id|radeonfb_pci_unregister
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo
)paren
r_return
suffix:semicolon
multiline_comment|/* restore original state&n;&t; * &n;&t; * Doesn&squot;t quite work yet, possibly because of the PPC hacking&n;&t; * I do on startup, disable for now. --BenH&n;&t; */
id|radeon_write_mode
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;init_state
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
id|rinfo-&gt;mtrr_hdl
op_ge
l_int|0
)paren
id|mtrr_del
c_func
(paren
id|rinfo-&gt;mtrr_hdl
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|unregister_framebuffer
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|rinfo-&gt;fb_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
)brace
DECL|variable|radeonfb_driver
r_static
r_struct
id|pci_driver
id|radeonfb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;radeonfb&quot;
comma
dot
id|id_table
op_assign
id|radeonfb_pci_table
comma
dot
id|probe
op_assign
id|radeonfb_pci_register
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|radeonfb_pci_unregister
)paren
comma
)brace
suffix:semicolon
r_int
id|__init
id|radeonfb_old_setup
(paren
r_char
op_star
id|options
)paren
suffix:semicolon
DECL|function|radeonfb_old_init
r_int
id|__init
id|radeonfb_old_init
(paren
r_void
)paren
(brace
macro_line|#ifndef MODULE
r_char
op_star
id|option
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;radeonfb_old&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|radeonfb_old_setup
c_func
(paren
id|option
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
(paren
op_amp
id|radeonfb_driver
)paren
suffix:semicolon
)brace
DECL|function|radeonfb_old_exit
r_void
id|__exit
id|radeonfb_old_exit
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|radeonfb_driver
)paren
suffix:semicolon
)brace
DECL|function|radeonfb_old_setup
r_int
id|__init
id|radeonfb_old_setup
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mirror&quot;
comma
l_int|6
)paren
)paren
(brace
id|mirror
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;dfp&quot;
comma
l_int|3
)paren
)paren
(brace
id|force_dfp
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;panel_yres:&quot;
comma
l_int|11
)paren
)paren
(brace
id|panel_yres
op_assign
id|simple_strtoul
c_func
(paren
(paren
id|this_opt
op_plus
l_int|11
)paren
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomtrr&quot;
comma
l_int|6
)paren
)paren
(brace
id|nomtrr
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|radeonfb_old_init
id|module_init
c_func
(paren
id|radeonfb_old_init
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|variable|radeonfb_old_exit
id|module_exit
c_func
(paren
id|radeonfb_old_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ani Joshi&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for ATI Radeon chipset&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
