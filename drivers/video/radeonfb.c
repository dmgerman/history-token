multiline_comment|/*&n; *&t;drivers/video/radeonfb.c&n; *&t;framebuffer driver for ATI Radeon chipset video boards&n; *&n; *&t;Copyright 2000&t;Ani Joshi &lt;ajoshi@unixbox.com&gt;&n; *&n; *&n; *&t;ChangeLog:&n; *&t;2000-08-03&t;initial version 0.0.1&n; *&t;2000-09-10&t;more bug fixes, public release 0.0.5&n; *&t;2001-02-19&t;mode bug fixes, 0.0.7&n; *&t;2001-07-05&t;fixed scrolling issues, engine initialization,&n; *&t;&t;&t;and minor mode tweaking, 0.0.9&n; *&n; *&n; *&t;Special thanks to ATI DevRel team for their hardware donations.&n; *&n; */
DECL|macro|RADEON_VERSION
mdefine_line|#define RADEON_VERSION&t;&quot;0.0.9&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/fbcon.h&gt; 
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &quot;radeon.h&quot;
DECL|macro|DEBUG
mdefine_line|#define DEBUG&t;0
macro_line|#if DEBUG
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;printk
macro_line|#else
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;if(0) printk
macro_line|#endif
DECL|enum|radeon_chips
r_enum
id|radeon_chips
(brace
DECL|enumerator|RADEON_QD
id|RADEON_QD
comma
DECL|enumerator|RADEON_QE
id|RADEON_QE
comma
DECL|enumerator|RADEON_QF
id|RADEON_QF
comma
DECL|enumerator|RADEON_QG
id|RADEON_QG
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|radeonfb_pci_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_RADEON_QD
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QD
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_RADEON_QE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QE
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_RADEON_QF
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QF
)brace
comma
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_DEVICE_ID_RADEON_QG
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RADEON_QG
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|radeonfb_pci_table
)paren
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|reg
id|u16
id|reg
suffix:semicolon
DECL|member|val
id|u32
id|val
suffix:semicolon
DECL|typedef|reg_val
)brace
id|reg_val
suffix:semicolon
multiline_comment|/* these common regs are cleared before mode setting so they do not&n; * interfere with anything&n; */
DECL|variable|common_regs
id|reg_val
id|common_regs
(braket
)braket
op_assign
(brace
(brace
id|OVR_CLR
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_LEFT_RIGHT
comma
l_int|0
)brace
comma
(brace
id|OVR_WID_TOP_BOTTOM
comma
l_int|0
)brace
comma
(brace
id|OV0_SCALE_CNTL
comma
l_int|0
)brace
comma
(brace
id|SUBPIC_CNTL
comma
l_int|0
)brace
comma
(brace
id|VIPH_CONTROL
comma
l_int|0
)brace
comma
(brace
id|I2C_CNTL_1
comma
l_int|0
)brace
comma
(brace
id|GEN_INT_CNTL
comma
l_int|0
)brace
comma
(brace
id|CAP0_TRIG_CNTL
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|macro|COMMON_REGS_SIZE
mdefine_line|#define COMMON_REGS_SIZE = (sizeof(common_regs)/sizeof(common_regs[0]))
r_typedef
r_struct
(brace
DECL|member|clock_chip_type
id|u8
id|clock_chip_type
suffix:semicolon
DECL|member|struct_size
id|u8
id|struct_size
suffix:semicolon
DECL|member|accelerator_entry
id|u8
id|accelerator_entry
suffix:semicolon
DECL|member|VGA_entry
id|u8
id|VGA_entry
suffix:semicolon
DECL|member|VGA_table_offset
id|u16
id|VGA_table_offset
suffix:semicolon
DECL|member|POST_table_offset
id|u16
id|POST_table_offset
suffix:semicolon
DECL|member|XCLK
id|u16
id|XCLK
suffix:semicolon
DECL|member|MCLK
id|u16
id|MCLK
suffix:semicolon
DECL|member|num_PLL_blocks
id|u8
id|num_PLL_blocks
suffix:semicolon
DECL|member|size_PLL_blocks
id|u8
id|size_PLL_blocks
suffix:semicolon
DECL|member|PCLK_ref_freq
id|u16
id|PCLK_ref_freq
suffix:semicolon
DECL|member|PCLK_ref_divider
id|u16
id|PCLK_ref_divider
suffix:semicolon
DECL|member|PCLK_min_freq
id|u32
id|PCLK_min_freq
suffix:semicolon
DECL|member|PCLK_max_freq
id|u32
id|PCLK_max_freq
suffix:semicolon
DECL|member|MCLK_ref_freq
id|u16
id|MCLK_ref_freq
suffix:semicolon
DECL|member|MCLK_ref_divider
id|u16
id|MCLK_ref_divider
suffix:semicolon
DECL|member|MCLK_min_freq
id|u32
id|MCLK_min_freq
suffix:semicolon
DECL|member|MCLK_max_freq
id|u32
id|MCLK_max_freq
suffix:semicolon
DECL|member|XCLK_ref_freq
id|u16
id|XCLK_ref_freq
suffix:semicolon
DECL|member|XCLK_ref_divider
id|u16
id|XCLK_ref_divider
suffix:semicolon
DECL|member|XCLK_min_freq
id|u32
id|XCLK_min_freq
suffix:semicolon
DECL|member|XCLK_max_freq
id|u32
id|XCLK_max_freq
suffix:semicolon
DECL|typedef|PLL_BLOCK
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|PLL_BLOCK
suffix:semicolon
DECL|struct|pll_info
r_struct
id|pll_info
(brace
DECL|member|ppll_max
r_int
id|ppll_max
suffix:semicolon
DECL|member|ppll_min
r_int
id|ppll_min
suffix:semicolon
DECL|member|xclk
r_int
id|xclk
suffix:semicolon
DECL|member|ref_div
r_int
id|ref_div
suffix:semicolon
DECL|member|ref_clk
r_int
id|ref_clk
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ram_info
r_struct
id|ram_info
(brace
DECL|member|ml
r_int
id|ml
suffix:semicolon
DECL|member|mb
r_int
id|mb
suffix:semicolon
DECL|member|trcd
r_int
id|trcd
suffix:semicolon
DECL|member|trp
r_int
id|trp
suffix:semicolon
DECL|member|twr
r_int
id|twr
suffix:semicolon
DECL|member|cl
r_int
id|cl
suffix:semicolon
DECL|member|tr2w
r_int
id|tr2w
suffix:semicolon
DECL|member|loop_latency
r_int
id|loop_latency
suffix:semicolon
DECL|member|rloop
r_int
id|rloop
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|radeon_regs
r_struct
id|radeon_regs
(brace
DECL|member|crtc_h_total_disp
id|u32
id|crtc_h_total_disp
suffix:semicolon
DECL|member|crtc_h_sync_strt_wid
id|u32
id|crtc_h_sync_strt_wid
suffix:semicolon
DECL|member|crtc_v_total_disp
id|u32
id|crtc_v_total_disp
suffix:semicolon
DECL|member|crtc_v_sync_strt_wid
id|u32
id|crtc_v_sync_strt_wid
suffix:semicolon
DECL|member|crtc_pitch
id|u32
id|crtc_pitch
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|pix_clock
id|u32
id|pix_clock
suffix:semicolon
DECL|member|xres
DECL|member|yres
r_int
id|xres
comma
id|yres
suffix:semicolon
DECL|member|bpp
r_int
id|bpp
suffix:semicolon
DECL|member|crtc_gen_cntl
id|u32
id|crtc_gen_cntl
suffix:semicolon
DECL|member|crtc_ext_cntl
id|u32
id|crtc_ext_cntl
suffix:semicolon
DECL|member|dac_cntl
id|u32
id|dac_cntl
suffix:semicolon
DECL|member|dda_config
id|u32
id|dda_config
suffix:semicolon
DECL|member|dda_on_off
id|u32
id|dda_on_off
suffix:semicolon
DECL|member|ppll_div_3
id|u32
id|ppll_div_3
suffix:semicolon
DECL|member|ppll_ref_div
id|u32
id|ppll_ref_div
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|radeonfb_info
r_struct
id|radeonfb_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|state
r_struct
id|radeon_regs
id|state
suffix:semicolon
DECL|member|init_state
r_struct
id|radeon_regs
id|init_state
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|10
)braket
suffix:semicolon
DECL|member|ram_type
r_char
id|ram_type
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|mmio_base_phys
id|u32
id|mmio_base_phys
suffix:semicolon
DECL|member|fb_base_phys
id|u32
id|fb_base_phys
suffix:semicolon
DECL|member|mmio_base
id|u32
id|mmio_base
suffix:semicolon
DECL|member|fb_base
id|u32
id|fb_base
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|disp
r_struct
id|display
id|disp
suffix:semicolon
DECL|member|currcon
r_int
id|currcon
suffix:semicolon
DECL|member|currcon_display
r_struct
id|display
op_star
id|currcon_display
suffix:semicolon
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
DECL|member|palette
r_struct
(brace
id|u8
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|chipset
r_int
id|chipset
suffix:semicolon
DECL|member|video_ram
r_int
id|video_ram
suffix:semicolon
DECL|member|rev
id|u8
id|rev
suffix:semicolon
DECL|member|pitch
DECL|member|bpp
DECL|member|depth
r_int
id|pitch
comma
id|bpp
comma
id|depth
suffix:semicolon
DECL|member|xres
DECL|member|yres
DECL|member|pixclock
r_int
id|xres
comma
id|yres
comma
id|pixclock
suffix:semicolon
DECL|member|dp_gui_master_cntl
id|u32
id|dp_gui_master_cntl
suffix:semicolon
DECL|member|pll
r_struct
id|pll_info
id|pll
suffix:semicolon
DECL|member|pll_output_freq
DECL|member|post_div
DECL|member|fb_div
r_int
id|pll_output_freq
comma
id|post_div
comma
id|fb_div
suffix:semicolon
DECL|member|ram
r_struct
id|ram_info
id|ram
suffix:semicolon
macro_line|#if defined(FBCON_HAS_CFB16) || defined(FBCON_HAS_CFB32)
r_union
(brace
macro_line|#if defined(FBCON_HAS_CFB16)
DECL|member|cfb16
id|u_int16_t
id|cfb16
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#if defined(FBCON_HAS_CFB32)
DECL|member|cfb32
id|u_int32_t
id|cfb32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif  
DECL|member|con_cmap
)brace
id|con_cmap
suffix:semicolon
macro_line|#endif  
)brace
suffix:semicolon
DECL|variable|radeonfb_default_var
r_static
r_struct
id|fb_var_screeninfo
id|radeonfb_default_var
op_assign
(brace
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|39721
comma
l_int|40
comma
l_int|24
comma
l_int|32
comma
l_int|11
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
multiline_comment|/*&n; * IO macros&n; */
DECL|macro|INREG8
mdefine_line|#define INREG8(addr)&t;&t;readb((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG8
mdefine_line|#define OUTREG8(addr,val)&t;writeb(val, (rinfo-&gt;mmio_base)+addr)
DECL|macro|INREG
mdefine_line|#define INREG(addr)&t;&t;readl((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG
mdefine_line|#define OUTREG(addr,val)&t;writel(val, (rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTPLL
mdefine_line|#define OUTPLL(addr,val)&t;OUTREG8(CLOCK_CNTL_INDEX, (addr &amp; 0x0000001f) | 0x00000080); &bslash;&n;&t;&t;&t;&t;OUTREG(CLOCK_CNTL_DATA, val)
DECL|macro|OUTPLLP
mdefine_line|#define OUTPLLP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned int _tmp = INPLL(addr);&t;&t;&t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;OUTPLL(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|macro|OUTREGP
mdefine_line|#define OUTREGP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned int _tmp = INREG(addr);&t;&t;&t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;OUTREG(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|function|_INPLL
r_static
id|__inline__
id|u32
id|_INPLL
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|addr
)paren
(brace
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|addr
op_amp
l_int|0x0000001f
)paren
suffix:semicolon
r_return
(paren
id|INREG
c_func
(paren
id|CLOCK_CNTL_DATA
)paren
)paren
suffix:semicolon
)brace
DECL|macro|INPLL
mdefine_line|#define INPLL(addr)&t;&t;_INPLL(rinfo, addr)
multiline_comment|/*&n; * 2D engine routines&n; */
DECL|function|radeon_engine_flush
r_static
id|__inline__
r_void
id|radeon_engine_flush
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* initiate flush */
id|OUTREGP
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
comma
id|RB2D_DC_FLUSH_ALL
comma
op_complement
id|RB2D_DC_FLUSH_ALL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|INREG
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
)paren
op_amp
id|RB2D_DC_BUSY
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|_radeon_fifo_wait
r_static
id|__inline__
r_void
id|_radeon_fifo_wait
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|entries
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
l_int|0x7f
)paren
op_ge
id|entries
)paren
r_return
suffix:semicolon
)brace
DECL|function|_radeon_engine_idle
r_static
id|__inline__
r_void
id|_radeon_engine_idle
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* ensure FIFO is empty before waiting for idle */
id|_radeon_fifo_wait
(paren
id|rinfo
comma
l_int|64
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
id|GUI_ACTIVE
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|radeon_engine_flush
(paren
id|rinfo
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
DECL|macro|radeon_engine_idle
mdefine_line|#define radeon_engine_idle()&t;&t;_radeon_engine_idle(rinfo)
DECL|macro|radeon_fifo_wait
mdefine_line|#define radeon_fifo_wait(entries)&t;_radeon_fifo_wait(rinfo,entries)
multiline_comment|/*&n; * helper routines&n; */
DECL|function|radeon_get_dstbpp
r_static
id|__inline__
id|u32
id|radeon_get_dstbpp
c_func
(paren
id|u16
id|depth
)paren
(brace
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
id|DST_8BPP
suffix:semicolon
r_case
l_int|15
suffix:colon
r_return
id|DST_15BPP
suffix:semicolon
r_case
l_int|16
suffix:colon
r_return
id|DST_16BPP
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
id|DST_32BPP
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|_radeon_engine_reset
r_static
r_void
id|_radeon_engine_reset
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|clock_cntl_index
comma
id|mclk_cntl
comma
id|rbbm_soft_reset
suffix:semicolon
id|radeon_engine_flush
(paren
id|rinfo
)paren
suffix:semicolon
id|clock_cntl_index
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
suffix:semicolon
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
(paren
id|mclk_cntl
op_or
id|FORCEON_MCLKA
op_or
id|FORCEON_MCLKB
op_or
id|FORCEON_YCLKA
op_or
id|FORCEON_YCLKB
op_or
id|FORCEON_MC
op_or
id|FORCEON_AIC
)paren
)paren
suffix:semicolon
id|rbbm_soft_reset
op_assign
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
op_or
id|SOFT_RESET_CP
op_or
id|SOFT_RESET_HI
op_or
id|SOFT_RESET_SE
op_or
id|SOFT_RESET_RE
op_or
id|SOFT_RESET_PP
op_or
id|SOFT_RESET_E2
op_or
id|SOFT_RESET_RB
op_or
id|SOFT_RESET_HDP
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
op_amp
(paren
id|u32
)paren
op_complement
(paren
id|SOFT_RESET_CP
op_or
id|SOFT_RESET_HI
op_or
id|SOFT_RESET_SE
op_or
id|SOFT_RESET_RE
op_or
id|SOFT_RESET_PP
op_or
id|SOFT_RESET_E2
op_or
id|SOFT_RESET_RB
op_or
id|SOFT_RESET_HDP
)paren
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|RBBM_SOFT_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|mclk_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|clock_cntl_index
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_SOFT_RESET
comma
id|rbbm_soft_reset
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|macro|radeon_engine_reset
mdefine_line|#define radeon_engine_reset()&t;&t;_radeon_engine_reset(rinfo)
DECL|function|radeon_get_post_div_bitval
r_static
id|__inline__
id|u8
id|radeon_get_post_div_bitval
c_func
(paren
r_int
id|post_div
)paren
(brace
r_switch
c_cond
(paren
id|post_div
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
l_int|0x00
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
l_int|0x01
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
l_int|0x04
suffix:semicolon
r_case
l_int|4
suffix:colon
r_return
l_int|0x02
suffix:semicolon
r_case
l_int|6
suffix:colon
r_return
l_int|0x06
suffix:semicolon
r_case
l_int|8
suffix:colon
r_return
l_int|0x03
suffix:semicolon
r_case
l_int|12
suffix:colon
r_return
l_int|0x07
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0x02
suffix:semicolon
)brace
)brace
DECL|function|round_div
r_static
id|__inline__
r_int
id|round_div
c_func
(paren
r_int
id|num
comma
r_int
id|den
)paren
(brace
r_return
(paren
id|num
op_plus
(paren
id|den
op_div
l_int|2
)paren
)paren
op_div
id|den
suffix:semicolon
)brace
DECL|function|min_bits_req
r_static
id|__inline__
r_int
id|min_bits_req
c_func
(paren
r_int
id|val
)paren
(brace
r_int
id|bits_req
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|0
)paren
id|bits_req
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|val
)paren
(brace
id|val
op_rshift_assign
l_int|1
suffix:semicolon
id|bits_req
op_increment
suffix:semicolon
)brace
r_return
(paren
id|bits_req
)paren
suffix:semicolon
)brace
DECL|function|_max
r_static
id|__inline__
r_int
id|_max
c_func
(paren
r_int
id|val1
comma
r_int
id|val2
)paren
(brace
r_if
c_cond
(paren
id|val1
op_ge
id|val2
)paren
r_return
id|val1
suffix:semicolon
r_else
r_return
id|val2
suffix:semicolon
)brace
multiline_comment|/*&n; * globals&n; */
DECL|variable|__initdata
r_static
r_char
id|fontname
(braket
l_int|40
)braket
id|__initdata
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
op_star
id|mode_option
id|__initdata
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|noaccel
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|fbcon_radeon8
r_static
r_struct
id|display_switch
id|fbcon_radeon8
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * prototypes&n; */
r_static
r_int
id|radeonfb_get_fix
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_get_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_set_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_get_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_set_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_pan_display
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_switch
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_updatevar
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|radeonfb_blank
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeon_get_cmap_len
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
r_static
r_int
id|radeon_getcolreg
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|radeon_setcolreg
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|radeon_set_dispsw
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_save_state
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|save
)paren
suffix:semicolon
r_static
r_void
id|radeon_engine_init
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_load_video_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|mode
)paren
suffix:semicolon
r_static
r_void
id|radeon_write_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|mode
)paren
suffix:semicolon
r_static
r_int
id|__devinit
id|radeon_set_fbinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|__devinit
id|radeon_init_disp
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeon_init_disp_var
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_int
id|radeonfb_pci_register
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
suffix:semicolon
r_static
r_void
id|__devexit
id|radeonfb_pci_unregister
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
suffix:semicolon
r_static
r_char
op_star
id|radeon_find_rom
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_static
r_void
id|radeon_get_pllinfo
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_char
op_star
id|bios_seg
)paren
suffix:semicolon
DECL|variable|radeon_fb_ops
r_static
r_struct
id|fb_ops
id|radeon_fb_ops
op_assign
(brace
id|fb_get_fix
suffix:colon
id|radeonfb_get_fix
comma
id|fb_get_var
suffix:colon
id|radeonfb_get_var
comma
id|fb_set_var
suffix:colon
id|radeonfb_set_var
comma
id|fb_get_cmap
suffix:colon
id|radeonfb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|radeonfb_set_cmap
comma
id|fb_pan_display
suffix:colon
id|radeonfb_pan_display
comma
id|fb_ioctl
suffix:colon
id|radeonfb_ioctl
comma
)brace
suffix:semicolon
DECL|variable|radeonfb_driver
r_static
r_struct
id|pci_driver
id|radeonfb_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;radeonfb&quot;
comma
id|id_table
suffix:colon
id|radeonfb_pci_table
comma
id|probe
suffix:colon
id|radeonfb_pci_register
comma
id|remove
suffix:colon
id|radeonfb_pci_unregister
comma
)brace
suffix:semicolon
DECL|function|radeonfb_init
r_int
id|__init
id|radeonfb_init
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
(paren
op_amp
id|radeonfb_driver
)paren
suffix:semicolon
)brace
DECL|function|radeonfb_exit
r_void
id|__exit
id|radeonfb_exit
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|radeonfb_driver
)paren
suffix:semicolon
)brace
DECL|function|radeonfb_setup
r_int
id|__init
id|radeonfb_setup
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|this_opt
op_assign
id|strtok
(paren
id|options
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|this_opt
suffix:semicolon
id|this_opt
op_assign
id|strtok
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
id|this_opt
op_plus
l_int|5
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|fontname
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
op_logical_or
op_star
id|p
op_eq
l_char|&squot; &squot;
op_logical_or
op_star
id|p
op_eq
l_char|&squot;,&squot;
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
id|fontname
comma
id|this_opt
op_plus
l_int|5
comma
id|i
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|radeonfb_init
id|module_init
c_func
(paren
id|radeonfb_init
)paren
suffix:semicolon
DECL|variable|radeonfb_exit
id|module_exit
c_func
(paren
id|radeonfb_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ani Joshi&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for ATI Radeon chipset&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|radeonfb_pci_register
r_static
r_int
id|radeonfb_pci_register
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_char
op_star
id|bios_seg
op_assign
l_int|NULL
suffix:semicolon
id|rinfo
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|radeonfb_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: could not allocate memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|memset
(paren
id|rinfo
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|radeonfb_info
)paren
)paren
suffix:semicolon
multiline_comment|/* enable device */
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: cannot enable device&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/* set base addrs */
id|rinfo-&gt;fb_base_phys
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;mmio_base_phys
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* request the mem regions */
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
l_string|&quot;radeonfb&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot reserve FB region&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
comma
l_string|&quot;radeonfb&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* map the regions */
id|rinfo-&gt;mmio_base
op_assign
(paren
id|u32
)paren
id|ioremap
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|RADEON_REGSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;mmio_base
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot map MMIO&bslash;n&quot;
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* chipset */
r_switch
c_cond
(paren
id|pdev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_RADEON_QD
suffix:colon
id|strcpy
c_func
(paren
id|rinfo-&gt;name
comma
l_string|&quot;Radeon QD &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_RADEON_QE
suffix:colon
id|strcpy
c_func
(paren
id|rinfo-&gt;name
comma
l_string|&quot;Radeon QE &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_RADEON_QF
suffix:colon
id|strcpy
c_func
(paren
id|rinfo-&gt;name
comma
l_string|&quot;Radeon QF &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_RADEON_QG
suffix:colon
id|strcpy
c_func
(paren
id|rinfo-&gt;name
comma
l_string|&quot;Radeon QG &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* framebuffer size */
id|tmp
op_assign
id|INREG
c_func
(paren
id|CONFIG_MEMSIZE
)paren
suffix:semicolon
multiline_comment|/* mem size is bits [28:0], mask off the rest */
id|rinfo-&gt;video_ram
op_assign
id|tmp
op_amp
id|CONFIG_MEMSIZE_MASK
suffix:semicolon
multiline_comment|/* ram type */
id|tmp
op_assign
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|MEM_CFG_TYPE
op_amp
id|tmp
)paren
op_rshift
l_int|30
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* SDR SGRAM (2:1) */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;SDR SGRAM&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|16
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* DDR SGRAM */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;DDR SGRAM&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|2
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.tr2w
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|16
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* 64-bit SDR SGRAM */
id|strcpy
c_func
(paren
id|rinfo-&gt;ram_type
comma
l_string|&quot;SDR SGRAM 64&quot;
)paren
suffix:semicolon
id|rinfo-&gt;ram.ml
op_assign
l_int|4
suffix:semicolon
id|rinfo-&gt;ram.mb
op_assign
l_int|8
suffix:semicolon
id|rinfo-&gt;ram.trcd
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.trp
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.twr
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.cl
op_assign
l_int|3
suffix:semicolon
id|rinfo-&gt;ram.tr2w
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;ram.loop_latency
op_assign
l_int|17
suffix:semicolon
id|rinfo-&gt;ram.rloop
op_assign
l_int|17
suffix:semicolon
r_break
suffix:semicolon
)brace
id|bios_seg
op_assign
id|radeon_find_rom
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_get_pllinfo
c_func
(paren
id|rinfo
comma
id|bios_seg
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: ref_clk=%d, ref_div=%d, xclk=%d&bslash;n&quot;
comma
id|rinfo-&gt;pll.ref_clk
comma
id|rinfo-&gt;pll.ref_div
comma
id|rinfo-&gt;pll.xclk
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;radeonfb: probed %s %dk videoram&bslash;n&quot;
comma
(paren
id|rinfo-&gt;ram_type
)paren
comma
(paren
id|rinfo-&gt;video_ram
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|rinfo-&gt;fb_base
op_assign
(paren
id|u32
)paren
id|ioremap
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;fb_base
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: cannot map FB&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* XXX turn off accel for now, blts aren&squot;t working right */
id|noaccel
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* set all the vital stuff */
id|radeon_set_fbinfo
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* save current mode regs before we switch into the new one&n;&t; * so we can restore this upon __exit&n;&t; */
id|radeon_save_state
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;init_state
)paren
suffix:semicolon
multiline_comment|/* init palette */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
id|color_table
(braket
id|i
)braket
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|i
)braket
dot
id|red
op_assign
id|default_red
(braket
id|j
)braket
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|i
)braket
dot
id|green
op_assign
id|default_grn
(braket
id|j
)braket
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|i
)braket
dot
id|blue
op_assign
id|default_blu
(braket
id|j
)braket
suffix:semicolon
)brace
id|pdev-&gt;driver_data
op_assign
id|rinfo
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: could not register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|rinfo-&gt;fb_base
)paren
suffix:semicolon
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|noaccel
)paren
(brace
multiline_comment|/* initialize the engine */
id|radeon_engine_init
(paren
id|rinfo
)paren
suffix:semicolon
)brace
id|printk
(paren
l_string|&quot;radeonfb: ATI Radeon %s %d MB&bslash;n&quot;
comma
id|rinfo-&gt;ram_type
comma
(paren
id|rinfo-&gt;video_ram
op_div
(paren
l_int|1024
op_star
l_int|1024
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pci_unregister
r_static
r_void
id|__devexit
id|radeonfb_pci_unregister
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo
)paren
r_return
suffix:semicolon
multiline_comment|/* restore original state */
id|radeon_write_mode
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;init_state
)paren
suffix:semicolon
id|unregister_framebuffer
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|rinfo-&gt;mmio_base
)paren
suffix:semicolon
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|rinfo-&gt;fb_base
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;mmio_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
)paren
suffix:semicolon
id|release_mem_region
(paren
id|rinfo-&gt;fb_base_phys
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
(paren
id|rinfo
)paren
suffix:semicolon
)brace
DECL|function|radeon_find_rom
r_static
r_char
op_star
id|radeon_find_rom
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|segstart
suffix:semicolon
r_char
op_star
id|rom_base
suffix:semicolon
r_char
op_star
id|rom
suffix:semicolon
r_int
id|stage
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|aty_rom_sig
(braket
)braket
op_assign
l_string|&quot;761295520&quot;
suffix:semicolon
r_char
id|radeon_sig
(braket
)braket
op_assign
l_string|&quot;RG6&quot;
suffix:semicolon
macro_line|#if defined(__i386__)
r_for
c_loop
(paren
id|segstart
op_assign
l_int|0x000c0000
suffix:semicolon
id|segstart
OL
l_int|0x000f0000
suffix:semicolon
id|segstart
op_add_assign
l_int|0x00001000
)paren
(brace
id|stage
op_assign
l_int|1
suffix:semicolon
id|rom_base
op_assign
(paren
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|segstart
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|rom_base
op_eq
l_int|0x55
)paren
op_logical_and
(paren
(paren
(paren
op_star
(paren
id|rom_base
op_plus
l_int|1
)paren
)paren
op_amp
l_int|0xff
)paren
op_eq
l_int|0xaa
)paren
)paren
id|stage
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stage
op_ne
l_int|2
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|128
op_minus
id|strlen
c_func
(paren
id|aty_rom_sig
)paren
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|3
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aty_rom_sig
(braket
l_int|0
)braket
op_eq
op_star
id|rom
)paren
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|aty_rom_sig
comma
id|rom
comma
id|strlen
c_func
(paren
id|aty_rom_sig
)paren
)paren
op_eq
l_int|0
)paren
id|stage
op_assign
l_int|3
suffix:semicolon
id|rom
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|3
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rom
op_assign
id|rom_base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|512
)paren
op_logical_and
(paren
id|stage
op_ne
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|radeon_sig
(braket
l_int|0
)braket
op_eq
op_star
id|rom
)paren
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|radeon_sig
comma
id|rom
comma
id|strlen
c_func
(paren
id|radeon_sig
)paren
)paren
op_eq
l_int|0
)paren
id|stage
op_assign
l_int|4
suffix:semicolon
id|rom
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stage
op_ne
l_int|4
)paren
(brace
id|iounmap
c_func
(paren
id|rom_base
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
id|rom_base
suffix:semicolon
)brace
macro_line|#endif                        
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|radeon_get_pllinfo
r_static
r_void
id|radeon_get_pllinfo
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_char
op_star
id|bios_seg
)paren
(brace
r_void
op_star
id|bios_header
suffix:semicolon
r_void
op_star
id|header_ptr
suffix:semicolon
id|u16
id|bios_header_offset
comma
id|pll_info_offset
suffix:semicolon
id|PLL_BLOCK
id|pll
suffix:semicolon
r_if
c_cond
(paren
id|bios_seg
)paren
(brace
id|bios_header
op_assign
id|bios_seg
op_plus
l_int|0x48L
suffix:semicolon
id|header_ptr
op_assign
id|bios_header
suffix:semicolon
id|bios_header_offset
op_assign
id|readw
c_func
(paren
id|header_ptr
)paren
suffix:semicolon
id|bios_header
op_assign
id|bios_seg
op_plus
id|bios_header_offset
suffix:semicolon
id|bios_header
op_add_assign
l_int|0x30
suffix:semicolon
id|header_ptr
op_assign
id|bios_header
suffix:semicolon
id|pll_info_offset
op_assign
id|readw
c_func
(paren
id|header_ptr
)paren
suffix:semicolon
id|header_ptr
op_assign
id|bios_seg
op_plus
id|pll_info_offset
suffix:semicolon
id|memcpy_fromio
c_func
(paren
op_amp
id|pll
comma
id|header_ptr
comma
l_int|50
)paren
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
(paren
id|u32
)paren
id|pll.XCLK
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
(paren
id|u32
)paren
id|pll.PCLK_ref_freq
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
(paren
id|u32
)paren
id|pll.PCLK_ref_divider
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
id|pll.PCLK_min_freq
suffix:semicolon
id|rinfo-&gt;pll.ppll_max
op_assign
id|pll.PCLK_max_freq
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* no BIOS or BIOS not found, use defaults */
id|rinfo-&gt;pll.ppll_max
op_assign
l_int|35000
suffix:semicolon
id|rinfo-&gt;pll.ppll_min
op_assign
l_int|12000
suffix:semicolon
id|rinfo-&gt;pll.xclk
op_assign
l_int|16600
suffix:semicolon
id|rinfo-&gt;pll.ref_div
op_assign
l_int|67
suffix:semicolon
id|rinfo-&gt;pll.ref_clk
op_assign
l_int|2700
suffix:semicolon
)brace
)brace
DECL|function|radeon_engine_init
r_static
r_void
id|radeon_engine_init
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|temp
suffix:semicolon
multiline_comment|/* disable 3D engine */
id|OUTREG
c_func
(paren
id|RB3D_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|radeon_engine_reset
(paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSTCACHE_MODE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* XXX */
id|rinfo-&gt;pitch
op_assign
(paren
(paren
id|rinfo-&gt;xres
op_star
(paren
id|rinfo-&gt;depth
op_div
l_int|8
)paren
op_plus
l_int|0x3f
)paren
)paren
op_rshift
l_int|6
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|INREG
c_func
(paren
id|DEFAULT_PITCH_OFFSET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DEFAULT_PITCH_OFFSET
comma
(paren
(paren
id|temp
op_amp
l_int|0xc0000000
)paren
op_or
(paren
id|rinfo-&gt;pitch
op_lshift
l_int|0x16
)paren
)paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|DP_DATATYPE
comma
l_int|0
comma
op_complement
id|HOST_BIG_ENDIAN_EN
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DEFAULT_SC_BOTTOM_RIGHT
comma
(paren
id|DEFAULT_SC_RIGHT_MAX
op_or
id|DEFAULT_SC_BOTTOM_MAX
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|radeon_get_dstbpp
c_func
(paren
id|rinfo-&gt;depth
)paren
suffix:semicolon
id|rinfo-&gt;dp_gui_master_cntl
op_assign
(paren
(paren
id|temp
op_lshift
l_int|8
)paren
op_or
id|GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_GUI_MASTER_CNTL
comma
(paren
id|rinfo-&gt;dp_gui_master_cntl
op_or
id|GMC_BRUSH_SOLID_COLOR
op_or
id|GMC_SRC_DATATYPE_COLOR
)paren
)paren
suffix:semicolon
id|radeon_fifo_wait
(paren
l_int|7
)paren
suffix:semicolon
multiline_comment|/* clear line drawing regs */
id|OUTREG
c_func
(paren
id|DST_LINE_START
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_LINE_END
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set brush color regs */
id|OUTREG
c_func
(paren
id|DP_BRUSH_FRGD_CLR
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_BRUSH_BKGD_CLR
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* set source color regs */
id|OUTREG
c_func
(paren
id|DP_SRC_FRGD_CLR
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_SRC_BKGD_CLR
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* default write mask */
id|OUTREG
c_func
(paren
id|DP_WRITE_MSK
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|radeon_engine_idle
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_set_fbinfo
r_static
r_int
id|__devinit
id|radeon_set_fbinfo
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
id|strcpy
(paren
id|info-&gt;modename
comma
id|rinfo-&gt;name
)paren
suffix:semicolon
id|info-&gt;node
op_assign
op_minus
l_int|1
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|radeon_fb_ops
suffix:semicolon
id|info-&gt;display_fg
op_assign
l_int|NULL
suffix:semicolon
id|strncpy
(paren
id|info-&gt;fontname
comma
id|fontname
comma
r_sizeof
(paren
id|info-&gt;fontname
)paren
)paren
suffix:semicolon
id|info-&gt;fontname
(braket
r_sizeof
(paren
id|info-&gt;fontname
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|info-&gt;changevar
op_assign
l_int|NULL
suffix:semicolon
id|info-&gt;switch_con
op_assign
id|radeonfb_switch
suffix:semicolon
id|info-&gt;updatevar
op_assign
id|radeonfb_updatevar
suffix:semicolon
id|info-&gt;blank
op_assign
id|radeonfb_blank
suffix:semicolon
r_if
c_cond
(paren
id|radeon_init_disp
(paren
id|rinfo
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_init_disp
r_static
r_int
id|__devinit
id|radeon_init_disp
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
id|disp
op_assign
op_amp
id|rinfo-&gt;disp
suffix:semicolon
id|disp-&gt;var
op_assign
id|radeonfb_default_var
suffix:semicolon
id|info-&gt;disp
op_assign
id|disp
suffix:semicolon
id|radeon_set_dispsw
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|disp-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
r_else
id|disp-&gt;scrollmode
op_assign
l_int|0
suffix:semicolon
id|rinfo-&gt;currcon_display
op_assign
id|disp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|radeon_init_disp_var
(paren
id|rinfo
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_init_disp_var
r_static
r_int
id|radeon_init_disp_var
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|mode_option
)paren
id|fb_find_mode
(paren
op_amp
id|rinfo-&gt;disp.var
comma
op_amp
id|rinfo-&gt;info
comma
id|mode_option
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|8
)paren
suffix:semicolon
r_else
macro_line|#endif
id|fb_find_mode
(paren
op_amp
id|rinfo-&gt;disp.var
comma
op_amp
id|rinfo-&gt;info
comma
l_string|&quot;640x480-8@60&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|rinfo-&gt;disp.var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|rinfo-&gt;disp.var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_set_dispsw
r_static
r_void
id|radeon_set_dispsw
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|display
op_star
id|disp
op_assign
op_amp
id|rinfo-&gt;disp
suffix:semicolon
r_int
id|accel
suffix:semicolon
id|accel
op_assign
id|disp-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
l_int|NULL
suffix:semicolon
id|disp-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
id|rinfo-&gt;fb_base
suffix:semicolon
id|disp-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|disp-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|disp-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|disp-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;inverse
op_assign
l_int|0
suffix:semicolon
id|rinfo-&gt;depth
op_assign
id|disp-&gt;var.bits_per_pixel
suffix:semicolon
r_switch
c_cond
(paren
id|disp-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|disp-&gt;dispsw
op_assign
id|accel
ques
c_cond
op_amp
id|fbcon_radeon8
suffix:colon
op_amp
id|fbcon_cfb8
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;&t;&t;
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
op_amp
id|rinfo-&gt;con_cmap.cfb16
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
op_amp
id|rinfo-&gt;con_cmap.cfb32
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
op_star
l_int|4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
(paren
l_string|&quot;radeonfb: setting fbcon_dummy renderer&bslash;n&quot;
)paren
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * fb ops&n; */
DECL|function|radeonfb_get_fix
r_static
r_int
id|radeonfb_get_fix
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
id|memset
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
(paren
id|fix-&gt;id
comma
id|rinfo-&gt;name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|rinfo-&gt;fb_base_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|rinfo-&gt;video_ram
suffix:semicolon
id|fix-&gt;type
op_assign
id|disp-&gt;type
suffix:semicolon
id|fix-&gt;type_aux
op_assign
id|disp-&gt;type_aux
suffix:semicolon
id|fix-&gt;visual
op_assign
id|disp-&gt;visual
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|disp-&gt;line_length
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|rinfo-&gt;mmio_base_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|RADEON_REGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
r_else
id|fix-&gt;accel
op_assign
l_int|40
suffix:semicolon
multiline_comment|/* XXX */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_get_var
r_static
r_int
id|radeonfb_get_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
op_star
id|var
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;disp.var
suffix:colon
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_set_var
r_static
r_int
id|radeonfb_set_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|v
suffix:semicolon
r_int
id|nom
comma
id|den
comma
id|i
comma
id|accel
suffix:semicolon
r_int
id|chgvar
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
(brace
r_int
id|xres
comma
id|yres
suffix:semicolon
)brace
id|modes
(braket
)braket
op_assign
(brace
(brace
l_int|1600
comma
l_int|1280
)brace
comma
(brace
l_int|1280
comma
l_int|1024
)brace
comma
(brace
l_int|1024
comma
l_int|768
)brace
comma
(brace
l_int|800
comma
l_int|600
)brace
comma
(brace
l_int|640
comma
l_int|480
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
id|accel
op_assign
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
suffix:semicolon
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|chgvar
op_assign
(paren
(paren
id|disp-&gt;var.xres
op_ne
id|var-&gt;xres
)paren
op_logical_or
(paren
id|disp-&gt;var.yres
op_ne
id|var-&gt;yres
)paren
op_logical_or
(paren
id|disp-&gt;var.xres_virtual
op_ne
id|var-&gt;xres_virtual
)paren
op_logical_or
(paren
id|disp-&gt;var.yres_virtual
op_ne
id|var-&gt;yres_virtual
)paren
op_logical_or
id|memcmp
(paren
op_amp
id|disp-&gt;var.red
comma
op_amp
id|var-&gt;red
comma
r_sizeof
(paren
id|var-&gt;red
)paren
)paren
op_logical_or
id|memcmp
(paren
op_amp
id|disp-&gt;var.green
comma
op_amp
id|var-&gt;green
comma
r_sizeof
(paren
id|var-&gt;green
)paren
)paren
op_logical_or
id|memcmp
(paren
op_amp
id|disp-&gt;var.blue
comma
op_amp
id|var-&gt;blue
comma
r_sizeof
(paren
id|var-&gt;blue
)paren
)paren
)paren
suffix:semicolon
)brace
id|memcpy
(paren
op_amp
id|v
comma
id|var
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|v.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|disp-&gt;dispsw
op_assign
id|accel
ques
c_cond
op_amp
id|fbcon_radeon8
suffix:colon
op_amp
id|fbcon_cfb8
suffix:semicolon
id|nom
op_assign
id|den
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|v.xres_virtual
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|v.red.offset
op_assign
id|v.green.offset
op_assign
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.green.length
op_assign
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|16
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
op_amp
id|rinfo-&gt;con_cmap.cfb16
suffix:semicolon
id|nom
op_assign
l_int|2
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|v.xres_virtual
op_star
l_int|2
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|v.red.offset
op_assign
l_int|11
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|6
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32    
r_case
l_int|32
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|32
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|rinfo-&gt;con_cmap.cfb32
suffix:semicolon
id|nom
op_assign
l_int|4
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|v.xres_virtual
op_star
l_int|4
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
id|v.blue.length
op_assign
id|v.green.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
(paren
l_string|&quot;radeonfb: mode %dx%dx%d rejected, color depth invalid&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.xres
op_star
id|nom
op_div
id|den
op_star
id|v.yres
OG
(paren
id|rinfo-&gt;video_ram
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: mode %dx%dx%d rejected, not enough video ram&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.xres_virtual
op_eq
op_minus
l_int|1
op_logical_and
id|v.yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: using maximum available virtual resolution&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|modes
(braket
id|i
)braket
dot
id|xres
op_ne
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_star
id|nom
op_div
id|den
op_star
id|modes
(braket
id|i
)braket
dot
id|yres
OL
(paren
id|rinfo-&gt;video_ram
op_div
l_int|2
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
(paren
l_string|&quot;radeonfb: could not find a virtual res&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|v.xres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|xres
suffix:semicolon
id|v.yres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|yres
suffix:semicolon
id|printk
(paren
l_string|&quot;radeonfb: virtual resolution set to maximum of %dx%d&bslash;n&quot;
comma
id|v.xres_virtual
comma
id|v.yres_virtual
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.xoffset
OL
l_int|0
)paren
id|v.xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OL
l_int|0
)paren
id|v.yoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v.xoffset
OG
id|v.xres_virtual
op_minus
id|v.xres
)paren
id|v.xoffset
op_assign
id|v.xres_virtual
op_minus
id|v.xres
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OG
id|v.yres_virtual
op_minus
id|v.yres
)paren
id|v.yoffset
op_assign
id|v.yres_virtual
op_minus
id|v.yres
op_minus
l_int|1
suffix:semicolon
id|v.red.msb_right
op_assign
id|v.green.msb_right
op_assign
id|v.blue.msb_right
op_assign
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
id|v.transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|v.activate
op_amp
id|FB_ACTIVATE_MASK
)paren
(brace
r_case
id|FB_ACTIVATE_TEST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|FB_ACTIVATE_NXTOPEN
suffix:colon
r_case
id|FB_ACTIVATE_NOW
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|disp-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|memcpy
(paren
op_amp
id|disp-&gt;var
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
id|radeon_load_video_mode
(paren
id|rinfo
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chgvar
op_logical_and
id|info
op_logical_and
id|info-&gt;changevar
)paren
id|info-&gt;changevar
(paren
id|con
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_get_cmap
r_static
r_int
id|radeonfb_get_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|rinfo-&gt;currcon
)paren
(brace
r_int
id|rc
op_assign
id|fb_get_cmap
(paren
id|cmap
comma
id|kspc
comma
id|radeon_getcolreg
comma
id|info
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|disp-&gt;cmap.len
)paren
id|fb_copy_cmap
(paren
op_amp
id|disp-&gt;cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
(paren
id|fb_default_cmap
(paren
id|radeon_get_cmap_len
(paren
op_amp
id|disp-&gt;var
)paren
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_set_cmap
r_static
r_int
id|radeonfb_set_cmap
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_int
r_int
id|cmap_len
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
id|cmap_len
op_assign
id|radeon_get_cmap_len
(paren
op_amp
id|disp-&gt;var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disp-&gt;cmap.len
op_ne
id|cmap_len
)paren
(brace
r_int
id|err
op_assign
id|fb_alloc_cmap
(paren
op_amp
id|disp-&gt;cmap
comma
id|cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|con
op_eq
id|rinfo-&gt;currcon
)paren
(brace
r_int
id|rc
op_assign
id|fb_set_cmap
(paren
id|cmap
comma
id|kspc
comma
id|radeon_setcolreg
comma
id|info
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
id|fb_copy_cmap
(paren
id|cmap
comma
op_amp
id|disp-&gt;cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pan_display
r_static
r_int
id|radeonfb_pan_display
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|disp-&gt;var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|disp-&gt;var.xres
OG
id|disp-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|disp-&gt;var.yres
OG
id|disp-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
id|var-&gt;yoffset
op_star
id|disp-&gt;line_length
op_plus
id|var-&gt;xoffset
suffix:semicolon
id|disp-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|disp-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|disp-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|disp-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_ioctl
r_static
r_int
id|radeonfb_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|radeonfb_switch
r_static
r_int
id|radeonfb_switch
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_struct
id|fb_cmap
op_star
id|cmap
suffix:semicolon
r_int
id|switchcon
op_assign
l_int|0
suffix:semicolon
id|disp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rinfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;currcon
op_ge
l_int|0
)paren
(brace
id|cmap
op_assign
op_amp
(paren
id|rinfo-&gt;currcon_display-&gt;cmap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmap-&gt;len
)paren
id|fb_get_cmap
(paren
id|cmap
comma
l_int|1
comma
id|radeon_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|disp-&gt;var.xres
op_ne
id|rinfo-&gt;xres
)paren
op_logical_or
(paren
id|disp-&gt;var.yres
op_ne
id|rinfo-&gt;yres
)paren
op_logical_or
(paren
id|disp-&gt;var.pixclock
op_ne
id|rinfo-&gt;pixclock
)paren
op_logical_or
(paren
id|disp-&gt;var.bits_per_pixel
op_ne
id|rinfo-&gt;depth
)paren
)paren
id|switchcon
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|switchcon
)paren
(brace
id|rinfo-&gt;currcon
op_assign
id|con
suffix:semicolon
id|rinfo-&gt;currcon_display
op_assign
id|disp
suffix:semicolon
id|disp-&gt;var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|radeonfb_set_var
(paren
op_amp
id|disp-&gt;var
comma
id|con
comma
id|info
)paren
suffix:semicolon
id|radeon_set_dispsw
(paren
id|rinfo
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_updatevar
r_static
r_int
id|radeonfb_updatevar
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
op_minus
id|EINVAL
suffix:colon
id|radeonfb_pan_display
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
id|con
comma
id|info
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|radeonfb_blank
r_static
r_void
id|radeonfb_blank
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
id|u8
id|mode
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* unblank */
id|mode
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* blank */
id|mode
op_assign
(paren
(paren
id|INREG8
c_func
(paren
id|CRTC_EXT_CNTL
op_plus
l_int|1
)paren
op_amp
l_int|3
)paren
op_or
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|4
suffix:colon
id|mode
op_assign
id|blank
op_or
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|OUTREG8
c_func
(paren
id|CRTC_EXT_CNTL
op_plus
l_int|1
comma
id|mode
)paren
suffix:semicolon
)brace
DECL|function|radeon_get_cmap_len
r_static
r_int
id|radeon_get_cmap_len
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|rc
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* reasonable default */
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|rc
op_assign
l_int|256
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|rc
op_assign
l_int|64
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|radeon_getcolreg
r_static
r_int
id|radeon_getcolreg
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
(paren
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_lshift
l_int|8
)paren
op_or
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
(paren
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_lshift
l_int|8
)paren
op_or
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
(paren
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_lshift
l_int|8
)paren
op_or
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_setcolreg
r_static
r_int
id|radeon_setcolreg
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|pindex
comma
id|col
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|rinfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
multiline_comment|/* init gamma for hicolor */
r_if
c_cond
(paren
(paren
id|rinfo-&gt;depth
OG
l_int|8
)paren
op_logical_and
(paren
id|regno
op_eq
l_int|0
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|255
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OUTREG
c_func
(paren
id|PALETTE_INDEX
comma
id|i
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|i
op_lshift
l_int|16
)paren
op_or
(paren
id|i
op_lshift
l_int|8
)paren
op_or
id|i
suffix:semicolon
id|radeon_fifo_wait
c_func
(paren
l_int|32
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PALETTE_DATA
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* default */
id|pindex
op_assign
id|regno
suffix:semicolon
id|col
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;depth
op_eq
l_int|16
)paren
(brace
id|pindex
op_assign
id|regno
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rinfo-&gt;depth
op_eq
l_int|16
)paren
op_logical_and
(paren
id|regno
op_ge
l_int|32
)paren
)paren
(brace
id|pindex
op_sub_assign
l_int|252
suffix:semicolon
id|col
op_assign
(paren
id|rinfo-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
(paren
id|rinfo-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|blue
)paren
suffix:semicolon
)brace
r_else
(brace
id|col
op_assign
(paren
id|red
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
id|blue
suffix:semicolon
)brace
)brace
id|OUTREG8
c_func
(paren
id|PALETTE_INDEX
comma
id|pindex
)paren
suffix:semicolon
id|radeon_fifo_wait
c_func
(paren
l_int|32
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PALETTE_DATA
comma
id|col
)paren
suffix:semicolon
macro_line|#if defined(FBCON_HAS_CFB16) || defined(FBCON_HAS_CFB32)
r_if
c_cond
(paren
id|regno
OL
l_int|32
)paren
(brace
r_switch
c_cond
(paren
id|rinfo-&gt;depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|rinfo-&gt;con_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|10
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
(brace
id|u32
id|i
suffix:semicolon
id|i
op_assign
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
id|rinfo-&gt;con_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
id|i
op_lshift
l_int|16
)paren
op_or
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_save_state
r_static
r_void
id|radeon_save_state
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|save
)paren
(brace
id|save-&gt;crtc_gen_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|save-&gt;crtc_ext_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|save-&gt;dac_cntl
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|save-&gt;crtc_h_total_disp
op_assign
id|INREG
c_func
(paren
id|CRTC_H_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;crtc_h_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;crtc_v_total_disp
op_assign
id|INREG
c_func
(paren
id|CRTC_V_TOTAL_DISP
)paren
suffix:semicolon
id|save-&gt;crtc_v_sync_strt_wid
op_assign
id|INREG
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
)paren
suffix:semicolon
id|save-&gt;crtc_pitch
op_assign
id|INREG
c_func
(paren
id|CRTC_PITCH
)paren
suffix:semicolon
)brace
DECL|function|radeon_load_video_mode
r_static
r_void
id|radeon_load_video_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|mode
)paren
(brace
r_struct
id|radeon_regs
id|newmode
suffix:semicolon
r_int
id|hTotal
comma
id|vTotal
comma
id|hSyncStart
comma
id|hSyncEnd
comma
id|hSyncPol
comma
id|vSyncStart
comma
id|vSyncEnd
comma
id|vSyncPol
comma
id|cSync
suffix:semicolon
id|u8
id|hsync_adj_tab
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0x12
comma
l_int|9
comma
l_int|9
comma
l_int|6
comma
l_int|5
)brace
suffix:semicolon
id|u32
id|dotClock
op_assign
l_int|1000000000
op_div
id|mode-&gt;pixclock
comma
id|sync
comma
id|h_sync_pol
comma
id|v_sync_pol
suffix:semicolon
r_int
id|freq
op_assign
id|dotClock
op_div
l_int|10
suffix:semicolon
multiline_comment|/* x 100 */
r_int
id|xclk_freq
comma
id|vclk_freq
comma
id|xclk_per_trans
comma
id|xclk_per_trans_precise
suffix:semicolon
r_int
id|useable_precision
comma
id|roff
comma
id|ron
suffix:semicolon
r_int
id|min_bits
comma
id|format
op_assign
l_int|0
suffix:semicolon
r_int
id|hsync_start
comma
id|hsync_fudge
comma
id|bytpp
comma
id|hsync_wid
comma
id|vsync_wid
suffix:semicolon
id|rinfo-&gt;xres
op_assign
id|mode-&gt;xres
suffix:semicolon
id|rinfo-&gt;yres
op_assign
id|mode-&gt;yres
suffix:semicolon
id|rinfo-&gt;pixclock
op_assign
id|mode-&gt;pixclock
suffix:semicolon
id|hSyncStart
op_assign
id|mode-&gt;xres
op_plus
id|mode-&gt;right_margin
suffix:semicolon
id|hSyncEnd
op_assign
id|hSyncStart
op_plus
id|mode-&gt;hsync_len
suffix:semicolon
id|hTotal
op_assign
id|hSyncEnd
op_plus
id|mode-&gt;left_margin
suffix:semicolon
id|vSyncStart
op_assign
id|mode-&gt;yres
op_plus
id|mode-&gt;lower_margin
suffix:semicolon
id|vSyncEnd
op_assign
id|vSyncStart
op_plus
id|mode-&gt;vsync_len
suffix:semicolon
id|vTotal
op_assign
id|vSyncEnd
op_plus
id|mode-&gt;upper_margin
suffix:semicolon
id|sync
op_assign
id|mode-&gt;sync
suffix:semicolon
id|h_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|v_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;hStart = %d, hEnd = %d, hTotal = %d&bslash;n&quot;
comma
id|hSyncStart
comma
id|hSyncEnd
comma
id|hTotal
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;vStart = %d, vEnd = %d, vTotal = %d&bslash;n&quot;
comma
id|vSyncStart
comma
id|vSyncEnd
comma
id|vTotal
)paren
suffix:semicolon
id|hsync_wid
op_assign
(paren
id|hSyncEnd
op_minus
id|hSyncStart
)paren
op_div
l_int|8
suffix:semicolon
id|vsync_wid
op_assign
id|vSyncEnd
op_minus
id|vSyncStart
suffix:semicolon
r_if
c_cond
(paren
id|hsync_wid
op_eq
l_int|0
)paren
id|hsync_wid
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hsync_wid
OG
l_int|0x3f
)paren
multiline_comment|/* max */
id|hsync_wid
op_assign
l_int|0x3f
suffix:semicolon
id|vsync_wid
op_assign
id|mode-&gt;vsync_len
suffix:semicolon
r_if
c_cond
(paren
id|vsync_wid
op_eq
l_int|0
)paren
id|vsync_wid
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vsync_wid
OG
l_int|0x1f
)paren
multiline_comment|/* max */
id|vsync_wid
op_assign
l_int|0x1f
suffix:semicolon
id|hSyncPol
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|vSyncPol
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|cSync
op_assign
id|mode-&gt;sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
ques
c_cond
(paren
l_int|1
op_lshift
l_int|4
)paren
suffix:colon
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|mode-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|format
op_assign
id|DST_8BPP
suffix:semicolon
id|bytpp
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|format
op_assign
id|DST_16BPP
suffix:semicolon
id|bytpp
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|format
op_assign
id|DST_24BPP
suffix:semicolon
id|bytpp
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|format
op_assign
id|DST_32BPP
suffix:semicolon
id|bytpp
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hsync_fudge
op_assign
id|hsync_adj_tab
(braket
id|format
op_minus
l_int|1
)braket
suffix:semicolon
id|hsync_start
op_assign
id|hSyncStart
op_minus
l_int|8
op_plus
id|hsync_fudge
suffix:semicolon
id|newmode.crtc_gen_cntl
op_assign
id|CRTC_EXT_DISP_EN
op_or
id|CRTC_EN
op_or
(paren
id|format
op_lshift
l_int|8
)paren
suffix:semicolon
id|newmode.crtc_ext_cntl
op_assign
id|VGA_ATI_LINEAR
op_or
id|XCRT_CNT_EN
suffix:semicolon
id|newmode.dac_cntl
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
op_or
id|DAC_MASK_ALL
op_or
id|DAC_VGA_ADR_EN
op_or
id|DAC_8BIT_EN
suffix:semicolon
id|newmode.crtc_h_total_disp
op_assign
(paren
(paren
(paren
(paren
id|hTotal
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0xffff
)paren
op_or
(paren
(paren
(paren
id|mode-&gt;xres
op_div
l_int|8
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|newmode.crtc_h_sync_strt_wid
op_assign
(paren
(paren
id|hsync_start
op_amp
l_int|0x1fff
)paren
op_or
(paren
id|hsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|h_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
id|newmode.crtc_v_total_disp
op_assign
(paren
(paren
id|vTotal
op_minus
l_int|1
)paren
op_amp
l_int|0xffff
)paren
op_or
(paren
(paren
id|mode-&gt;yres
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|newmode.crtc_v_sync_strt_wid
op_assign
(paren
(paren
(paren
id|vSyncStart
op_minus
l_int|1
)paren
op_amp
l_int|0xfff
)paren
op_or
(paren
id|vsync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|v_sync_pol
op_lshift
l_int|23
)paren
)paren
suffix:semicolon
id|newmode.crtc_pitch
op_assign
(paren
id|mode-&gt;xres
op_rshift
l_int|3
)paren
suffix:semicolon
id|rinfo-&gt;pitch
op_assign
(paren
(paren
id|mode-&gt;xres
op_star
(paren
(paren
id|mode-&gt;bits_per_pixel
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
op_plus
l_int|0x3f
)paren
op_amp
op_complement
(paren
l_int|0x3f
)paren
)paren
op_div
l_int|64
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;h_total_disp = 0x%x&bslash;t   hsync_strt_wid = 0x%x&bslash;n&quot;
comma
id|newmode.crtc_h_total_disp
comma
id|newmode.crtc_h_sync_strt_wid
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;v_total_disp = 0x%x&bslash;t   vsync_strt_wid = 0x%x&bslash;n&quot;
comma
id|newmode.crtc_v_total_disp
comma
id|newmode.crtc_v_sync_strt_wid
)paren
suffix:semicolon
id|newmode.xres
op_assign
id|mode-&gt;xres
suffix:semicolon
id|newmode.yres
op_assign
id|mode-&gt;yres
suffix:semicolon
id|rinfo-&gt;bpp
op_assign
id|mode-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|freq
OG
id|rinfo-&gt;pll.ppll_max
)paren
id|freq
op_assign
id|rinfo-&gt;pll.ppll_max
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_star
l_int|12
OL
id|rinfo-&gt;pll.ppll_min
)paren
id|freq
op_assign
id|rinfo-&gt;pll.ppll_min
op_div
l_int|12
suffix:semicolon
(brace
r_struct
(brace
r_int
id|divider
suffix:semicolon
r_int
id|bitvalue
suffix:semicolon
)brace
op_star
id|post_div
comma
id|post_divs
(braket
)braket
op_assign
(brace
(brace
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|2
comma
l_int|1
)brace
comma
(brace
l_int|4
comma
l_int|2
)brace
comma
(brace
l_int|8
comma
l_int|3
)brace
comma
(brace
l_int|3
comma
l_int|4
)brace
comma
(brace
l_int|16
comma
l_int|5
)brace
comma
(brace
l_int|6
comma
l_int|6
)brace
comma
(brace
l_int|12
comma
l_int|7
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
r_for
c_loop
(paren
id|post_div
op_assign
op_amp
id|post_divs
(braket
l_int|0
)braket
suffix:semicolon
id|post_div-&gt;divider
suffix:semicolon
op_increment
id|post_div
)paren
(brace
id|rinfo-&gt;pll_output_freq
op_assign
id|post_div-&gt;divider
op_star
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;pll_output_freq
op_ge
id|rinfo-&gt;pll.ppll_min
op_logical_and
id|rinfo-&gt;pll_output_freq
op_le
id|rinfo-&gt;pll.ppll_max
)paren
r_break
suffix:semicolon
)brace
id|rinfo-&gt;post_div
op_assign
id|post_div-&gt;divider
suffix:semicolon
id|rinfo-&gt;fb_div
op_assign
id|round_div
c_func
(paren
id|rinfo-&gt;pll.ref_div
op_star
id|rinfo-&gt;pll_output_freq
comma
id|rinfo-&gt;pll.ref_clk
)paren
suffix:semicolon
id|newmode.ppll_ref_div
op_assign
id|rinfo-&gt;pll.ref_div
suffix:semicolon
id|newmode.ppll_div_3
op_assign
id|rinfo-&gt;fb_div
op_or
(paren
id|post_div-&gt;bitvalue
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
id|RTRACE
c_func
(paren
l_string|&quot;post div = 0x%x&bslash;n&quot;
comma
id|rinfo-&gt;post_div
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;fb_div = 0x%x&bslash;n&quot;
comma
id|rinfo-&gt;fb_div
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;ppll_div_3 = 0x%x&bslash;n&quot;
comma
id|newmode.ppll_div_3
)paren
suffix:semicolon
multiline_comment|/* DDA */
id|vclk_freq
op_assign
id|round_div
c_func
(paren
id|rinfo-&gt;pll.ref_clk
op_star
id|rinfo-&gt;fb_div
comma
id|rinfo-&gt;pll.ref_div
op_star
id|rinfo-&gt;post_div
)paren
suffix:semicolon
id|xclk_freq
op_assign
id|rinfo-&gt;pll.xclk
suffix:semicolon
id|xclk_per_trans
op_assign
id|round_div
c_func
(paren
id|xclk_freq
op_star
l_int|128
comma
id|vclk_freq
op_star
id|mode-&gt;bits_per_pixel
)paren
suffix:semicolon
id|min_bits
op_assign
id|min_bits_req
c_func
(paren
id|xclk_per_trans
)paren
suffix:semicolon
id|useable_precision
op_assign
id|min_bits
op_plus
l_int|1
suffix:semicolon
id|xclk_per_trans_precise
op_assign
id|round_div
c_func
(paren
(paren
id|xclk_freq
op_star
l_int|128
)paren
op_lshift
(paren
l_int|11
op_minus
id|useable_precision
)paren
comma
id|vclk_freq
op_star
id|mode-&gt;bits_per_pixel
)paren
suffix:semicolon
id|ron
op_assign
(paren
l_int|4
op_star
id|rinfo-&gt;ram.mb
op_plus
l_int|3
op_star
id|_max
c_func
(paren
id|rinfo-&gt;ram.trcd
op_minus
l_int|2
comma
l_int|0
)paren
op_plus
l_int|2
op_star
id|rinfo-&gt;ram.trp
op_plus
id|rinfo-&gt;ram.twr
op_plus
id|rinfo-&gt;ram.cl
op_plus
id|rinfo-&gt;ram.tr2w
op_plus
id|xclk_per_trans
)paren
op_lshift
(paren
l_int|11
op_minus
id|useable_precision
)paren
suffix:semicolon
id|roff
op_assign
id|xclk_per_trans_precise
op_star
(paren
l_int|32
op_minus
l_int|4
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;ron = %d, roff = %d&bslash;n&quot;
comma
id|ron
comma
id|roff
)paren
suffix:semicolon
id|RTRACE
c_func
(paren
l_string|&quot;vclk_freq = %d, per = %d&bslash;n&quot;
comma
id|vclk_freq
comma
id|xclk_per_trans_precise
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ron
op_plus
id|rinfo-&gt;ram.rloop
)paren
op_ge
id|roff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;radeonfb: error ron out of range&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|newmode.dda_config
op_assign
(paren
id|xclk_per_trans_precise
op_or
(paren
id|useable_precision
op_lshift
l_int|16
)paren
op_or
(paren
id|rinfo-&gt;ram.rloop
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
id|newmode.dda_on_off
op_assign
(paren
id|ron
op_lshift
l_int|16
)paren
op_or
id|roff
suffix:semicolon
multiline_comment|/* do it! */
id|radeon_write_mode
(paren
id|rinfo
comma
op_amp
id|newmode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|radeon_write_mode
r_static
r_void
id|radeon_write_mode
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|radeon_regs
op_star
id|mode
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* blank screen */
id|OUTREG8
c_func
(paren
id|CRTC_EXT_CNTL
op_plus
l_int|1
comma
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|common_regs
(braket
id|i
)braket
dot
id|reg
comma
id|common_regs
(braket
id|i
)braket
dot
id|val
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|mode-&gt;crtc_gen_cntl
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|mode-&gt;crtc_ext_cntl
comma
id|CRTC_HSYNC_DIS
op_or
id|CRTC_VSYNC_DIS
op_or
id|CRTC_DISPLAY_DIS
)paren
suffix:semicolon
id|OUTREGP
c_func
(paren
id|DAC_CNTL
comma
id|mode-&gt;dac_cntl
comma
id|DAC_RANGE_CNTL
op_or
id|DAC_BLANKING
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|mode-&gt;crtc_h_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|mode-&gt;crtc_h_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|mode-&gt;crtc_v_total_disp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|mode-&gt;crtc_v_sync_strt_wid
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_PITCH
comma
id|mode-&gt;crtc_pitch
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
op_amp
id|PPLL_DIV_SEL_MASK
)paren
op_ne
id|PPLL_DIV_SEL_MASK
)paren
(brace
id|OUTREGP
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|PPLL_DIV_SEL_MASK
comma
l_int|0xffff
)paren
suffix:semicolon
)brace
id|OUTPLLP
c_func
(paren
id|PPLL_CNTL
comma
id|PPLL_RESET
comma
l_int|0xffff
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_REF_DIV
)paren
op_amp
id|PPLL_REF_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_ref_div
op_amp
id|PPLL_REF_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_REF_DIV
comma
id|mode-&gt;ppll_ref_div
comma
op_complement
id|PPLL_REF_DIV_MASK
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_DIV_3
)paren
op_amp
id|PPLL_FB3_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_div_3
op_amp
id|PPLL_FB3_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_DIV_3
comma
id|mode-&gt;ppll_div_3
comma
op_complement
id|PPLL_FB3_DIV_MASK
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|INPLL
c_func
(paren
id|PPLL_DIV_3
)paren
op_amp
id|PPLL_POST3_DIV_MASK
)paren
op_ne
(paren
id|mode-&gt;ppll_div_3
op_amp
id|PPLL_POST3_DIV_MASK
)paren
)paren
(brace
id|OUTPLLP
c_func
(paren
id|PPLL_DIV_3
comma
id|mode-&gt;ppll_div_3
comma
op_complement
id|PPLL_POST3_DIV_MASK
)paren
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|HTOTAL_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLLP
c_func
(paren
id|PPLL_CNTL
comma
l_int|0
comma
op_complement
id|PPLL_RESET
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DDA_CONFIG
comma
id|mode-&gt;dda_config
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DDA_ON_OFF
comma
id|mode-&gt;dda_on_off
)paren
suffix:semicolon
multiline_comment|/* unblank screen */
id|OUTREG8
c_func
(paren
id|CRTC_EXT_CNTL
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * text console acceleration&n; */
DECL|function|fbcon_radeon_bmove
r_static
r_void
id|fbcon_radeon_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|srcy
comma
r_int
id|srcx
comma
r_int
id|dsty
comma
r_int
id|dstx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
(paren
id|p-&gt;fb_info
)paren
suffix:semicolon
id|u32
id|dp_cntl
op_assign
id|DST_LAST_PEL
suffix:semicolon
id|srcx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|srcy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dstx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dsty
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srcy
OL
id|dsty
)paren
(brace
id|srcy
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
id|dsty
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|dp_cntl
op_or_assign
id|DST_Y_TOP_TO_BOTTOM
suffix:semicolon
r_if
c_cond
(paren
id|srcx
OL
id|dstx
)paren
(brace
id|srcx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|dstx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|dp_cntl
op_or_assign
id|DST_X_LEFT_TO_RIGHT
suffix:semicolon
id|radeon_fifo_wait
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_GUI_MASTER_CNTL
comma
(paren
id|rinfo-&gt;dp_gui_master_cntl
op_or
id|GMC_BRUSH_NONE
op_or
id|GMC_SRC_DATATYPE_COLOR
op_or
id|ROP3_S
op_or
id|DP_SRC_SOURCE_MEMORY
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_WRITE_MSK
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_CNTL
comma
id|dp_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SRC_Y_X
comma
(paren
id|srcy
op_lshift
l_int|16
)paren
op_or
id|srcx
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_Y_X
comma
(paren
id|dsty
op_lshift
l_int|16
)paren
op_or
id|dstx
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_HEIGHT_WIDTH
comma
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|width
)paren
suffix:semicolon
)brace
DECL|function|fbcon_radeon_clear
r_static
r_void
id|fbcon_radeon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|srcy
comma
r_int
id|srcx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|radeonfb_info
op_star
)paren
(paren
id|p-&gt;fb_info
)paren
suffix:semicolon
id|u32
id|clr
suffix:semicolon
id|clr
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|clr
op_or_assign
(paren
id|clr
op_lshift
l_int|8
)paren
suffix:semicolon
id|clr
op_or_assign
(paren
id|clr
op_lshift
l_int|16
)paren
suffix:semicolon
id|srcx
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|srcy
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_mul_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_mul_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|radeon_fifo_wait
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_GUI_MASTER_CNTL
comma
(paren
id|rinfo-&gt;dp_gui_master_cntl
op_or
id|GMC_BRUSH_SOLID_COLOR
op_or
id|GMC_SRC_DATATYPE_COLOR
op_or
id|ROP3_P
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_BRUSH_FRGD_CLR
comma
id|clr
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_WRITE_MSK
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DP_CNTL
comma
(paren
id|DST_X_LEFT_TO_RIGHT
op_or
id|DST_Y_TOP_TO_BOTTOM
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_Y_X
comma
(paren
id|srcy
op_lshift
l_int|16
)paren
op_or
id|srcx
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DST_WIDTH_HEIGHT
comma
(paren
id|width
op_lshift
l_int|16
)paren
op_or
id|height
)paren
suffix:semicolon
)brace
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|fbcon_radeon8
r_static
r_struct
id|display_switch
id|fbcon_radeon8
op_assign
(brace
id|setup
suffix:colon
id|fbcon_cfb8_setup
comma
id|bmove
suffix:colon
id|fbcon_radeon_bmove
comma
id|clear
suffix:colon
id|fbcon_cfb8_clear
comma
id|putc
suffix:colon
id|fbcon_cfb8_putc
comma
id|putcs
suffix:colon
id|fbcon_cfb8_putcs
comma
id|revc
suffix:colon
id|fbcon_cfb8_revc
comma
id|clear_margins
suffix:colon
id|fbcon_cfb8_clear_margins
comma
id|fontwidthmask
suffix:colon
id|FONTWIDTH
c_func
(paren
l_int|4
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|8
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|12
)paren
op_or
id|FONTWIDTH
c_func
(paren
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#endif
eof
