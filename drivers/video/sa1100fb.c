multiline_comment|/*&n; *  linux/drivers/video/sa1100fb.c&n; *&n; *  Copyright (C) 1999 Eric A. Thomas&n; *   Based on acornfb.c Copyright (C) Russell King.&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive for&n; * more details.&n; *&n; *&t;        StrongARM 1100 LCD Controller Frame Buffer Driver&n; *&n; * Please direct your questions and comments on this driver to the following&n; * email address:&n; *&n; *&t;linux-arm-kernel@lists.arm.linux.org.uk&n; *&n; * Clean patches should be sent to the ARM Linux Patch System.  Please see the&n; * following web page for more information:&n; *&n; *&t;http://www.arm.linux.org.uk/developer/patches/info.shtml&n; *&n; * Thank you.&n; *&n; * Known problems:&n; *&t;- With the Neponset plugged into an Assabet, LCD powerdown&n; *&t;  doesn&squot;t work (LCD stays powered up).  Therefore we shouldn&squot;t&n; *&t;  blank the screen.&n; *&t;- We don&squot;t limit the CPU clock rate nor the mode selection&n; *&t;  according to the available SDRAM bandwidth.&n; *&n; * Other notes:&n; *&t;- Linear grayscale palettes and the kernel.&n; *&t;  Such code does not belong in the kernel.  The kernel frame buffer&n; *&t;  drivers do not expect a linear colourmap, but a colourmap based on&n; *&t;  the VT100 standard mapping.&n; *&n; *&t;  If your _userspace_ requires a linear colourmap, then the setup of&n; *&t;  such a colourmap belongs _in userspace_, not in the kernel.  Code&n; *&t;  to set the colourmap correctly from user space has been sent to&n; *&t;  David Neuer.  It&squot;s around 8 lines of C code, plus another 4 to&n; *&t;  detect if we are using grayscale.&n; *&n; *&t;- The following must never be specified in a panel definition:&n; *&t;     LCCR0_LtlEnd, LCCR3_PixClkDiv, LCCR3_VrtSnchL, LCCR3_HorSnchL&n; *&n; *&t;- The following should be specified:&n; *&t;     either LCCR0_Color or LCCR0_Mono&n; *&t;     either LCCR0_Sngl or LCCR0_Dual&n; *&t;     either LCCR0_Act or LCCR0_Pas&n; *&t;     either LCCR3_OutEnH or LCCD3_OutEnL&n; *&t;     either LCCR3_PixRsEdg or LCCR3_PixFlEdg&n; *&t;     either LCCR3_ACBsDiv or LCCR3_ACBsCntOff&n; *&n; * Code Status:&n; * 1999/04/01:&n; *&t;- Driver appears to be working for Brutus 320x200x8bpp mode.  Other&n; *&t;  resolutions are working, but only the 8bpp mode is supported.&n; *&t;  Changes need to be made to the palette encode and decode routines&n; *&t;  to support 4 and 16 bpp modes.  &n; *&t;  Driver is not designed to be a module.  The FrameBuffer is statically&n; *&t;  allocated since dynamic allocation of a 300k buffer cannot be &n; *&t;  guaranteed. &n; *&n; * 1999/06/17:&n; *&t;- FrameBuffer memory is now allocated at run-time when the&n; *&t;  driver is initialized.    &n; *&n; * 2000/04/10: Nicolas Pitre &lt;nico@cam.org&gt;&n; *&t;- Big cleanup for dynamic selection of machine type at run time.&n; *&n; * 2000/07/19: Jamey Hicks &lt;jamey@crl.dec.com&gt;&n; *&t;- Support for Bitsy aka Compaq iPAQ H3600 added.&n; *&n; * 2000/08/07: Tak-Shing Chan &lt;tchan.rd@idthk.com&gt;&n; *&t;       Jeff Sutherland &lt;jsutherland@accelent.com&gt;&n; *&t;- Resolved an issue caused by a change made to the Assabet&squot;s PLD &n; *&t;  earlier this year which broke the framebuffer driver for newer &n; *&t;  Phase 4 Assabets.  Some other parameters were changed to optimize&n; *&t;  for the Sharp display.&n; *&n; * 2000/08/09: Kunihiko IMAI &lt;imai@vasara.co.jp&gt;&n; *&t;- XP860 support added&n; *&n; * 2000/08/19: Mark Huang &lt;mhuang@livetoy.com&gt;&n; *&t;- Allows standard options to be passed on the kernel command line&n; *&t;  for most common passive displays.&n; *&n; * 2000/08/29:&n; *&t;- s/save_flags_cli/local_irq_save/&n; *&t;- remove unneeded extra save_flags_cli in sa1100fb_enable_lcd_controller&n; *&n; * 2000/10/10: Erik Mouw &lt;J.A.K.Mouw@its.tudelft.nl&gt;&n; *&t;- Updated LART stuff. Fixed some minor bugs.&n; *&n; * 2000/10/30: Murphy Chen &lt;murphy@mail.dialogue.com.tw&gt;&n; *&t;- Pangolin support added&n; *&n; * 2000/10/31: Roman Jordan &lt;jor@hoeft-wessel.de&gt;&n; *&t;- Huw Webpanel support added&n; *&n; * 2000/11/23: Eric Peng &lt;ericpeng@coventive.com&gt;&n; *&t;- Freebird add&n; *&n; * 2001/02/07: Jamey Hicks &lt;jamey.hicks@compaq.com&gt; &n; *&t;       Cliff Brake &lt;cbrake@accelent.com&gt;&n; *&t;- Added PM callback&n; *&n; * 2001/05/26: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Fix 16bpp so that (a) we use the right colours rather than some&n; *&t;  totally random colour depending on what was in page 0, and (b)&n; *&t;  we don&squot;t de-reference a NULL pointer.&n; *&t;- remove duplicated implementation of consistent_alloc()&n; *&t;- convert dma address types to dma_addr_t&n; *&t;- remove unused &squot;montype&squot; stuff&n; *&t;- remove redundant zero inits of init_var after the initial&n; *&t;  memzero.&n; *&t;- remove allow_modeset (acornfb idea does not belong here)&n; *&n; * 2001/05/28: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- massive cleanup - move machine dependent data into structures&n; *&t;- I&squot;ve left various #warnings in - if you see one, and know&n; *&t;  the hardware concerned, please get in contact with me.&n; *&n; * 2001/05/31: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Fix LCCR1 HSW value, fix all machine type specifications to&n; *&t;  keep values in line.  (Please check your machine type specs)&n; *&n; * 2001/06/10: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Fiddle with the LCD controller from task context only; mainly&n; *&t;  so that we can run with interrupts on, and sleep.&n; *&t;- Convert #warnings into #errors.  No pain, no gain. ;)&n; *&n; * 2001/06/14: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Make the palette BPS value for 12bpp come out correctly.&n; *&t;- Take notice of &quot;greyscale&quot; on any colour depth.&n; *&t;- Make truecolor visuals use the RGB channel encoding information.&n; *&n; * 2001/07/02: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Fix colourmap problems.&n; *&n; * 2001/07/13: &lt;abraham@2d3d.co.za&gt;&n; *&t;- Added support for the ICP LCD-Kit01 on LART. This LCD is&n; *&t;  manufactured by Prime View, model no V16C6448AB&n; *&n; * 2001/07/23: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Hand merge version from handhelds.org CVS tree.  See patch&n; *&t;  notes for 595/1 for more information.&n; *&t;- Drop 12bpp (it&squot;s 16bpp with different colour register mappings).&n; *&t;- This hardware can not do direct colour.  Therefore we don&squot;t&n; *&t;  support it.&n; *&n; * 2001/07/27: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Halve YRES on dual scan LCDs.&n; *&n; * 2001/08/22: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Add b/w iPAQ pixclock value.&n; *&n; * 2001/10/12: &lt;rmk@arm.linux.org.uk&gt;&n; *&t;- Add patch 681/1 and clean up stork definitions.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/arch/assabet.h&gt;
macro_line|#include &lt;asm/arch/shannon.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-mfb.h&gt;
macro_line|#include &lt;video/fbcon-cfb4.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
multiline_comment|/*&n; * debugging?&n; */
DECL|macro|DEBUG
mdefine_line|#define DEBUG 0
multiline_comment|/*&n; * Complain if VAR is out of range.&n; */
DECL|macro|DEBUG_VAR
mdefine_line|#define DEBUG_VAR 1
DECL|macro|ASSABET_PAL_VIDEO
macro_line|#undef ASSABET_PAL_VIDEO
macro_line|#include &quot;sa1100fb.h&quot;
r_extern
r_void
(paren
op_star
id|sa1100fb_backlight_power
)paren
(paren
r_int
id|on
)paren
suffix:semicolon
r_extern
r_void
(paren
op_star
id|sa1100fb_lcd_power
)paren
(paren
r_int
id|on
)paren
suffix:semicolon
DECL|variable|sa1100fb_blank_helper
r_void
(paren
op_star
id|sa1100fb_blank_helper
)paren
(paren
r_int
id|blank
)paren
suffix:semicolon
DECL|variable|sa1100fb_blank_helper
id|EXPORT_SYMBOL
c_func
(paren
id|sa1100fb_blank_helper
)paren
suffix:semicolon
multiline_comment|/*&n; * IMHO this looks wrong.  In 8BPP, length should be 8.&n; */
DECL|variable|rgb_8
r_static
r_struct
id|sa1100fb_rgb
id|rgb_8
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|def_rgb_16
r_static
r_struct
id|sa1100fb_rgb
id|def_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|11
comma
id|length
suffix:colon
l_int|5
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|5
comma
id|length
suffix:colon
l_int|6
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|5
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_ASSABET
macro_line|#ifndef ASSABET_PAL_VIDEO
multiline_comment|/*&n; * The assabet uses a sharp LQ039Q2DS54 LCD module.  It is actually&n; * takes an RGB666 signal, but we provide it with an RGB565 signal&n; * instead (def_rgb_16).&n; */
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|lq039q2ds54_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|5
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|61
comma
id|upper_margin
suffix:colon
l_int|3
comma
id|right_margin
suffix:colon
l_int|9
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
comma
)brace
suffix:semicolon
macro_line|#else
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|pal_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|67797
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|512
comma
id|hsync_len
suffix:colon
l_int|64
comma
id|vsync_len
suffix:colon
l_int|6
comma
id|left_margin
suffix:colon
l_int|125
comma
id|upper_margin
suffix:colon
l_int|70
comma
id|right_margin
suffix:colon
l_int|115
comma
id|lower_margin
suffix:colon
l_int|36
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_H3XXX
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|h3800_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|174757
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|12
comma
id|upper_margin
suffix:colon
l_int|10
comma
id|right_margin
suffix:colon
l_int|17
comma
id|lower_margin
suffix:colon
l_int|1
comma
id|sync
suffix:colon
l_int|0
comma
id|cmap_static
suffix:colon
l_int|1
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_ACBsCntOff
op_or
id|LCCR3_PixFlEdg
op_or
id|LCCR3_OutEnH
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|h3600_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|174757
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|12
comma
id|upper_margin
suffix:colon
l_int|10
comma
id|right_margin
suffix:colon
l_int|17
comma
id|lower_margin
suffix:colon
l_int|1
comma
id|sync
suffix:colon
l_int|0
comma
id|cmap_static
suffix:colon
l_int|1
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_ACBsCntOff
op_or
id|LCCR3_OutEnH
op_or
id|LCCR3_PixFlEdg
comma
)brace
suffix:semicolon
DECL|variable|h3600_rgb_16
r_static
r_struct
id|sa1100fb_rgb
id|h3600_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|12
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|7
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|1
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|h3100_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|406977
comma
id|bpp
suffix:colon
l_int|4
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|26
comma
id|vsync_len
suffix:colon
l_int|41
comma
id|left_margin
suffix:colon
l_int|4
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|4
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|cmap_greyscale
suffix:colon
l_int|1
comma
id|cmap_inverse
suffix:colon
l_int|1
comma
id|lccr0
suffix:colon
id|LCCR0_Mono
op_or
id|LCCR0_4PixMono
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BRUTUS
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|brutus_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|0
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|41
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|101
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|44
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|cerf_info
id|__initdata
op_assign
(brace
macro_line|#if defined(CONFIG_CERF_LCD_72_A)
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Dual
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|38
)paren
comma
macro_line|#elif defined(CONFIG_CERF_LCD_57_A)
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|38
)paren
comma
macro_line|#elif defined(CONFIG_CERF_LCD_38_A)
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|240
comma
id|yres
suffix:colon
l_int|320
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|56
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|38
)paren
comma
macro_line|#elif defined(CONFIG_CERF_LCD_38_B)
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|4
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|lccr0
suffix:colon
id|LCCR0_Mono
op_or
id|LCCR0_4PixMono
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|56
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|38
)paren
comma
macro_line|#else
macro_line|#error &quot;Must have a CerfBoard LCD form factor selected&quot;
macro_line|#endif
id|hsync_len
suffix:colon
l_int|5
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|61
comma
id|upper_margin
suffix:colon
l_int|3
comma
id|right_margin
suffix:colon
l_int|9
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
)brace
suffix:semicolon
macro_line|#if 0
r_static
r_struct
id|sa1100fb_rgb
id|cerf_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|8
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|4
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
macro_line|#warning Please check this carefully
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|freebird_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|171521
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|240
comma
id|yres
suffix:colon
l_int|320
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|left_margin
suffix:colon
l_int|2
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|2
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixFlEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
comma
)brace
suffix:semicolon
DECL|variable|freebird_rgb_16
r_static
r_struct
id|sa1100fb_rgb
id|freebird_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|8
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|4
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|12
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|graphicsclient_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|53500
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|9
comma
id|vsync_len
suffix:colon
l_int|9
comma
id|left_margin
suffix:colon
l_int|54
comma
id|upper_margin
suffix:colon
l_int|24
comma
id|right_margin
suffix:colon
l_int|54
comma
id|lower_margin
suffix:colon
l_int|32
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|huw_webpanel_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|0
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|41
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|101
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Dual
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|2
)paren
op_or
l_int|8
comma
macro_line|#error FIXME
multiline_comment|/*&n;&t; * FIXME: please get rid of the &squot;| 8&squot; in preference to an&n;&t; * LCCR3_PixClkDiv() version. --rmk&n;&t; */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_GREY_LCD
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|lart_grey_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|150000
comma
id|bpp
suffix:colon
l_int|4
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|1
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|4
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|2
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|cmap_greyscale
suffix:colon
l_int|1
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Mono
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
op_or
id|LCCR0_4PixMono
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_COLOR_LCD
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|lart_color_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|150000
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|320
comma
id|yres
suffix:colon
l_int|240
comma
id|hsync_len
suffix:colon
l_int|2
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|69
comma
id|upper_margin
suffix:colon
l_int|14
comma
id|right_margin
suffix:colon
l_int|8
comma
id|lower_margin
suffix:colon
l_int|4
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixFlEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_VIDEO_OUT
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|lart_video_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|39721
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|95
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|left_margin
suffix:colon
l_int|40
comma
id|upper_margin
suffix:colon
l_int|32
comma
id|right_margin
suffix:colon
l_int|24
comma
id|lower_margin
suffix:colon
l_int|11
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnL
op_or
id|LCCR3_PixFlEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_KIT01_LCD
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|lart_kit01_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|63291
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|64
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|122
comma
id|upper_margin
suffix:colon
l_int|45
comma
id|right_margin
suffix:colon
l_int|10
comma
id|lower_margin
suffix:colon
l_int|10
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixFlEdg
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHANNON
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|shannon_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|152500
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|4
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|2
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|1
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Dual
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_OMNIMETER
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|omnimeter_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|0
comma
id|bpp
suffix:colon
l_int|4
comma
id|xres
suffix:colon
l_int|480
comma
id|yres
suffix:colon
l_int|320
comma
id|hsync_len
suffix:colon
l_int|1
comma
id|vsync_len
suffix:colon
l_int|1
comma
id|left_margin
suffix:colon
l_int|10
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|10
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|cmap_greyscale
suffix:colon
l_int|1
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Mono
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Pas
op_or
id|LCCR0_8PixMono
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|255
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|44
)paren
comma
macro_line|#error FIXME: fix pixclock, ACBsDiv
multiline_comment|/*&n;&t; * FIXME: I think ACBsDiv is wrong above - should it be 512 (disabled)?&n;&t; *   - rmk&n;&t; */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|pangolin_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|341521
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|800
comma
id|yres
suffix:colon
l_int|600
comma
id|hsync_len
suffix:colon
l_int|64
comma
id|vsync_len
suffix:colon
l_int|7
comma
id|left_margin
suffix:colon
l_int|160
comma
id|upper_margin
suffix:colon
l_int|7
comma
id|right_margin
suffix:colon
l_int|24
comma
id|lower_margin
suffix:colon
l_int|1
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixFlEdg
op_or
id|LCCR3_ACBsCntOff
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_STORK
macro_line|#if STORK_TFT&t;&t;&t;/* ie the NEC TFT */
multiline_comment|/*&n; * pixclock is ps per clock. say 72Hz, 800x600 clocks =&gt; (1/72)/(800*600)&n; * = 28935 and a bit&n; * NB likely to be increased to ease bus timings wrt pcmcia interface&n; */
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|stork_tft_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|28935
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|64
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|left_margin
suffix:colon
l_int|48
comma
id|upper_margin
suffix:colon
l_int|12
comma
id|right_margin
suffix:colon
l_int|48
comma
id|lower_margin
suffix:colon
l_int|31
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
comma
)brace
suffix:semicolon
DECL|variable|stork_tft_rgb_16
r_static
r_struct
id|sa1100fb_rgb
id|stork_tft_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|11
comma
id|length
suffix:colon
l_int|5
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|5
comma
id|length
suffix:colon
l_int|6
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|5
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#else&t;/* Kyocera DSTN */
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|stork_dstn_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|0
comma
id|bpp
suffix:colon
l_int|16
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|2
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|left_margin
suffix:colon
l_int|2
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|2
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Dual
op_or
id|LCCR0_Pas
comma
macro_line|#error Fixme
id|lccr3
suffix:colon
l_int|0xff00
op_or
l_int|0x18
multiline_comment|/* ought to be 0x14 but DMA isn&squot;t up to that as yet */
)brace
suffix:semicolon
DECL|variable|stork_dstn_rgb_16
r_static
r_struct
id|sa1100fb_rgb
id|stork_dstn_rgb_16
op_assign
(brace
id|red
suffix:colon
(brace
id|offset
suffix:colon
l_int|8
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|green
suffix:colon
(brace
id|offset
suffix:colon
l_int|4
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|blue
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|4
comma
)brace
comma
id|transp
suffix:colon
(brace
id|offset
suffix:colon
l_int|0
comma
id|length
suffix:colon
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PT_SYSTEM3
multiline_comment|/*&n; * 648 x 480 x 8bpp x 75Hz Dual Panel Color STN Display&n; *&n; * pixclock = 1/( 640*3/8*240 ), [pixclock]=1e-12s=ps&n; *&t;3 due to r,g,b lines&n; *&t;8 due to 8 bit data bus&n; *&t;640 due to 640 pixels per line&n; *&t;240 = 480/2 due to dual panel display&n; *&t;=&gt;4.32Mhz =&gt; 231481E-12s&n; */
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|system3_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|231481
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|hsync_len
suffix:colon
l_int|2
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|left_margin
suffix:colon
l_int|2
comma
id|upper_margin
suffix:colon
l_int|0
comma
id|right_margin
suffix:colon
l_int|2
comma
id|lower_margin
suffix:colon
l_int|0
comma
id|sync
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Dual
op_or
id|LCCR0_Pas
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_ACBsDiv
c_func
(paren
l_int|512
)paren
op_or
id|LCCR3_ACBsCntOff
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_XP860
DECL|variable|__initdata
r_static
r_struct
id|sa1100fb_mach_info
id|xp860_info
id|__initdata
op_assign
(brace
id|pixclock
suffix:colon
l_int|0
comma
id|bpp
suffix:colon
l_int|8
comma
id|xres
suffix:colon
l_int|1024
comma
id|yres
suffix:colon
l_int|768
comma
id|hsync_len
suffix:colon
l_int|3
comma
id|vsync_len
suffix:colon
l_int|3
comma
id|left_margin
suffix:colon
l_int|3
comma
id|upper_margin
suffix:colon
l_int|2
comma
id|right_margin
suffix:colon
l_int|2
comma
id|lower_margin
suffix:colon
l_int|1
comma
id|sync
suffix:colon
l_int|0
comma
id|lccr0
suffix:colon
id|LCCR0_Color
op_or
id|LCCR0_Sngl
op_or
id|LCCR0_Act
comma
id|lccr3
suffix:colon
id|LCCR3_OutEnH
op_or
id|LCCR3_PixRsEdg
op_or
id|LCCR3_PixClkDiv
c_func
(paren
l_int|6
)paren
comma
)brace
suffix:semicolon
macro_line|#endif
r_static
r_struct
id|sa1100fb_mach_info
op_star
id|__init
DECL|function|sa1100fb_get_machine_info
id|sa1100fb_get_machine_info
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
r_struct
id|sa1100fb_mach_info
op_star
id|inf
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; *            R        G       B       T&n;&t; * default  {11,5}, { 5,6}, { 0,5}, { 0,0}&n;&t; * h3600    {12,4}, { 7,4}, { 1,4}, { 0,0}&n;&t; * freebird { 8,4}, { 4,4}, { 0,4}, {12,4}&n;&t; */
macro_line|#ifdef CONFIG_SA1100_ASSABET
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
macro_line|#ifndef ASSABET_PAL_VIDEO
id|inf
op_assign
op_amp
id|lq039q2ds54_info
suffix:semicolon
macro_line|#else
id|inf
op_assign
op_amp
id|pal_info
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_H3XXX
r_if
c_cond
(paren
id|machine_is_h3600
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|h3600_info
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_16
)braket
op_assign
op_amp
id|h3600_rgb_16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_h3100
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|h3100_info
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_h3800
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|h3800_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BRUTUS
r_if
c_cond
(paren
id|machine_is_brutus
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|brutus_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|cerf_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
r_if
c_cond
(paren
id|machine_is_freebird
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|freebird_info
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_16
)braket
op_assign
op_amp
id|freebird_rgb16
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|graphicsclient_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
r_if
c_cond
(paren
id|machine_is_huw_webpanel
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|huw_webpanel_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_LART
r_if
c_cond
(paren
id|machine_is_lart
c_func
(paren
)paren
)paren
(brace
macro_line|#ifdef LART_GREY_LCD
id|inf
op_assign
op_amp
id|lart_grey_info
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_COLOR_LCD
id|inf
op_assign
op_amp
id|lart_color_info
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_VIDEO_OUT
id|inf
op_assign
op_amp
id|lart_video_info
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LART_KIT01_LCD
id|inf
op_assign
op_amp
id|lart_kit01_info
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_OMNIMETER
r_if
c_cond
(paren
id|machine_is_omnimeter
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|omnimeter_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
r_if
c_cond
(paren
id|machine_is_pangolin
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|pangolin_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PT_SYSTEM3
r_if
c_cond
(paren
id|machine_is_pt_system3
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|system3_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHANNON
r_if
c_cond
(paren
id|machine_is_shannon
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|shannon_info
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_STORK
r_if
c_cond
(paren
id|machine_is_stork
c_func
(paren
)paren
)paren
(brace
macro_line|#if STORK_TFT
id|inf
op_assign
op_amp
id|stork_tft_info
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_16
)braket
op_assign
op_amp
id|stork_tft_rgb_16
suffix:semicolon
macro_line|#else
id|inf
op_assign
op_amp
id|stork_dstn_info
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_16
)braket
op_assign
op_amp
id|stork_dstn_rgb_16
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_XP860
r_if
c_cond
(paren
id|machine_is_xp860
c_func
(paren
)paren
)paren
(brace
id|inf
op_assign
op_amp
id|xp860_info
suffix:semicolon
)brace
macro_line|#endif
r_return
id|inf
suffix:semicolon
)brace
r_static
r_int
id|sa1100fb_activate_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|sa1100fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|set_ctrlr_state
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
comma
id|u_int
id|state
)paren
suffix:semicolon
DECL|function|sa1100fb_schedule_task
r_static
r_inline
r_void
id|sa1100fb_schedule_task
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
comma
id|u_int
id|state
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We need to handle two requests being made at the same time.&n;&t; * There are two important cases:&n;&t; *  1. When we are changing VT (C_REENABLE) while unblanking (C_ENABLE)&n;&t; *     We must perform the unblanking, which will do our REENABLE for us.&n;&t; *  2. When we are blanking, but immediately unblank before we have&n;&t; *     blanked.  We do the &quot;REENABLE&quot; thing here as well, just to be sure.&n;&t; */
r_if
c_cond
(paren
id|fbi-&gt;task_state
op_eq
id|C_ENABLE
op_logical_and
id|state
op_eq
id|C_REENABLE
)paren
id|state
op_assign
(paren
id|u_int
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;task_state
op_eq
id|C_DISABLE
op_logical_and
id|state
op_eq
id|C_ENABLE
)paren
id|state
op_assign
id|C_REENABLE
suffix:semicolon
r_if
c_cond
(paren
id|state
op_ne
(paren
id|u_int
)paren
op_minus
l_int|1
)paren
(brace
id|fbi-&gt;task_state
op_assign
id|state
suffix:semicolon
id|schedule_task
c_func
(paren
op_amp
id|fbi-&gt;task
)paren
suffix:semicolon
)brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the VAR structure pointer for the specified console&n; */
DECL|function|get_con_var
r_static
r_inline
r_struct
id|fb_var_screeninfo
op_star
id|get_con_var
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|con
)paren
(brace
r_return
(paren
id|con
op_eq
id|info-&gt;currcon
op_logical_or
id|con
op_eq
op_minus
l_int|1
)paren
ques
c_cond
op_amp
id|info-&gt;var
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the DISPLAY structure pointer for the specified console&n; */
DECL|function|get_con_display
r_static
r_inline
r_struct
id|display
op_star
id|get_con_display
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|con
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_return
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|fbi-&gt;fb.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the CMAP pointer for the specified console&n; */
DECL|function|get_con_cmap
r_static
r_inline
r_struct
id|fb_cmap
op_star
id|get_con_cmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|con
)paren
(brace
r_return
(paren
id|con
op_eq
id|info-&gt;currcon
op_logical_or
id|con
op_eq
op_minus
l_int|1
)paren
ques
c_cond
op_amp
id|info-&gt;cmap
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
suffix:semicolon
)brace
r_static
r_inline
id|u_int
DECL|function|chan_to_field
id|chan_to_field
c_func
(paren
id|u_int
id|chan
comma
r_struct
id|fb_bitfield
op_star
id|bf
)paren
(brace
id|chan
op_and_assign
l_int|0xffff
suffix:semicolon
id|chan
op_rshift_assign
l_int|16
op_minus
id|bf-&gt;length
suffix:semicolon
r_return
id|chan
op_lshift
id|bf-&gt;offset
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert bits-per-pixel to a hardware palette PBS value.&n; */
r_static
r_inline
id|u_int
DECL|function|palette_pbs
id|palette_pbs
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB4
r_case
l_int|4
suffix:colon
id|ret
op_assign
l_int|0
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|ret
op_assign
l_int|1
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|ret
op_assign
l_int|2
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_setpalettereg
id|sa1100fb_setpalettereg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|trans
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
id|u_int
id|val
comma
id|ret
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
id|fbi-&gt;palette_size
)paren
(brace
id|val
op_assign
(paren
(paren
id|red
op_rshift
l_int|4
)paren
op_amp
l_int|0xf00
)paren
suffix:semicolon
id|val
op_or_assign
(paren
(paren
id|green
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f0
)paren
suffix:semicolon
id|val
op_or_assign
(paren
(paren
id|blue
op_rshift
l_int|12
)paren
op_amp
l_int|0x00f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_eq
l_int|0
)paren
id|val
op_or_assign
id|palette_pbs
c_func
(paren
op_amp
id|fbi-&gt;fb.var
)paren
suffix:semicolon
id|fbi-&gt;palette_cpu
(braket
id|regno
)braket
op_assign
id|val
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_setcolreg
id|sa1100fb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|trans
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
op_assign
id|get_con_display
c_func
(paren
id|info
comma
id|info-&gt;currcon
)paren
suffix:semicolon
id|u_int
id|val
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * If inverse mode was selected, invert all the colours&n;&t; * rather than the register number.  The register number&n;&t; * is what you poke into the framebuffer to produce the&n;&t; * colour you requested.&n;&t; */
r_if
c_cond
(paren
id|disp-&gt;inverse
)paren
(brace
id|red
op_assign
l_int|0xffff
op_minus
id|red
suffix:semicolon
id|green
op_assign
l_int|0xffff
op_minus
id|green
suffix:semicolon
id|blue
op_assign
l_int|0xffff
op_minus
id|blue
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If greyscale is true, then we convert the RGB value&n;&t; * to greyscale no mater what visual we are using.&n;&t; */
r_if
c_cond
(paren
id|fbi-&gt;fb.var.grayscale
)paren
id|red
op_assign
id|green
op_assign
id|blue
op_assign
(paren
l_int|19595
op_star
id|red
op_plus
l_int|38470
op_star
id|green
op_plus
l_int|7471
op_star
id|blue
)paren
op_rshift
l_int|16
suffix:semicolon
r_switch
c_cond
(paren
id|fbi-&gt;fb.disp-&gt;visual
)paren
(brace
r_case
id|FB_VISUAL_TRUECOLOR
suffix:colon
multiline_comment|/*&n;&t;&t; * 12 or 16-bit True Colour.  We encode the RGB value&n;&t;&t; * according to the RGB bitfield information.&n;&t;&t; */
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
id|u16
op_star
id|pal
op_assign
id|fbi-&gt;fb.pseudo_palette
suffix:semicolon
id|val
op_assign
id|chan_to_field
c_func
(paren
id|red
comma
op_amp
id|fbi-&gt;fb.var.red
)paren
suffix:semicolon
id|val
op_or_assign
id|chan_to_field
c_func
(paren
id|green
comma
op_amp
id|fbi-&gt;fb.var.green
)paren
suffix:semicolon
id|val
op_or_assign
id|chan_to_field
c_func
(paren
id|blue
comma
op_amp
id|fbi-&gt;fb.var.blue
)paren
suffix:semicolon
id|pal
(braket
id|regno
)braket
op_assign
id|val
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FB_VISUAL_STATIC_PSEUDOCOLOR
suffix:colon
r_case
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|ret
op_assign
id|sa1100fb_setpalettereg
c_func
(paren
id|regno
comma
id|red
comma
id|green
comma
id|blue
comma
id|trans
comma
id|info
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; *  sa1100fb_display_dma_period()&n; *    Calculate the minimum period (in picoseconds) between two DMA&n; *    requests for the LCD controller.&n; */
r_static
r_int
r_int
DECL|function|sa1100fb_display_dma_period
id|sa1100fb_display_dma_period
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
r_int
id|mem_bits_per_pixel
suffix:semicolon
id|mem_bits_per_pixel
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|mem_bits_per_pixel
op_eq
l_int|12
)paren
id|mem_bits_per_pixel
op_assign
l_int|16
suffix:semicolon
multiline_comment|/*&n;&t; * Period = pixclock * bits_per_byte * bytes_per_transfer&n;&t; *&t;&t;/ memory_bits_per_pixel;&n;&t; */
r_return
id|var-&gt;pixclock
op_star
l_int|8
op_star
l_int|16
op_div
id|mem_bits_per_pixel
suffix:semicolon
)brace
multiline_comment|/*&n; *  sa1100fb_decode_var():&n; *    Get the video params out of &squot;var&squot;. If a value doesn&squot;t fit, round it up,&n; *    if it&squot;s too big, return -EINVAL.&n; *&n; *    Suggestion: Round up in the following order: bits_per_pixel, xres,&n; *    yres, xres_virtual, yres_virtual, xoffset, yoffset, grayscale,&n; *    bitfields, horizontal timing, vertical timing.&n; */
r_static
r_int
DECL|function|sa1100fb_validate_var
id|sa1100fb_validate_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres
OL
id|MIN_XRES
)paren
id|var-&gt;xres
op_assign
id|MIN_XRES
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres
OL
id|MIN_YRES
)paren
id|var-&gt;yres
op_assign
id|MIN_YRES
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres
OG
id|fbi-&gt;max_xres
)paren
id|var-&gt;xres
op_assign
id|fbi-&gt;max_xres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres
OG
id|fbi-&gt;max_yres
)paren
id|var-&gt;yres
op_assign
id|fbi-&gt;max_yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
ques
c_cond
id|var-&gt;xres
suffix:colon
id|var-&gt;xres_virtual
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
ques
c_cond
id|var-&gt;yres
suffix:colon
id|var-&gt;yres_virtual
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;var-&gt;bits_per_pixel=%d&bslash;n&quot;
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB4
r_case
l_int|4
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CPU_FREQ
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dma period = %d ps, clock = %d kHz&bslash;n&quot;
comma
id|sa1100fb_display_dma_period
c_func
(paren
id|var
)paren
comma
id|cpufreq_get
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sa1100fb_set_truecolor
r_static
r_inline
r_void
id|sa1100fb_set_truecolor
c_func
(paren
id|u_int
id|is_true_color
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;true_color = %d&bslash;n&quot;
comma
id|is_true_color
)paren
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
macro_line|#if 1
singleline_comment|// phase 4 or newer Assabet&squot;s
r_if
c_cond
(paren
id|is_true_color
)paren
id|ASSABET_BCR_set
c_func
(paren
id|ASSABET_BCR_LCD_12RGB
)paren
suffix:semicolon
r_else
id|ASSABET_BCR_clear
c_func
(paren
id|ASSABET_BCR_LCD_12RGB
)paren
suffix:semicolon
macro_line|#else
singleline_comment|// older Assabet&squot;s
r_if
c_cond
(paren
id|is_true_color
)paren
id|ASSABET_BCR_clear
c_func
(paren
id|ASSABET_BCR_LCD_12RGB
)paren
suffix:semicolon
r_else
id|ASSABET_BCR_set
c_func
(paren
id|ASSABET_BCR_LCD_12RGB
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_static
r_void
DECL|function|sa1100fb_hw_set_var
id|sa1100fb_hw_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|u_long
id|palette_mem_size
suffix:semicolon
id|fbi-&gt;palette_size
op_assign
id|var-&gt;bits_per_pixel
op_eq
l_int|8
ques
c_cond
l_int|256
suffix:colon
l_int|16
suffix:semicolon
id|palette_mem_size
op_assign
id|fbi-&gt;palette_size
op_star
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;palette_mem_size = 0x%08lx&bslash;n&quot;
comma
(paren
id|u_long
)paren
id|palette_mem_size
)paren
suffix:semicolon
id|fbi-&gt;palette_cpu
op_assign
(paren
id|u16
op_star
)paren
(paren
id|fbi-&gt;map_cpu
op_plus
id|PAGE_SIZE
op_minus
id|palette_mem_size
)paren
suffix:semicolon
id|fbi-&gt;palette_dma
op_assign
id|fbi-&gt;map_dma
op_plus
id|PAGE_SIZE
op_minus
id|palette_mem_size
suffix:semicolon
id|fb_set_cmap
c_func
(paren
op_amp
id|fbi-&gt;fb.cmap
comma
l_int|1
comma
op_amp
id|fbi-&gt;fb
)paren
suffix:semicolon
multiline_comment|/* Set board control register to handle new color depth */
id|sa1100fb_set_truecolor
c_func
(paren
id|var-&gt;bits_per_pixel
op_ge
l_int|16
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_OMNIMETER
macro_line|#error Do we have to do this here?   We already do it at init time.
r_if
c_cond
(paren
id|machine_is_omnimeter
c_func
(paren
)paren
)paren
id|SetLCDContrast
c_func
(paren
id|DefaultLCDContrast
)paren
suffix:semicolon
macro_line|#endif
id|sa1100fb_activate_var
c_func
(paren
id|var
comma
id|fbi
)paren
suffix:semicolon
id|fbi-&gt;palette_cpu
(braket
l_int|0
)braket
op_assign
(paren
id|fbi-&gt;palette_cpu
(braket
l_int|0
)braket
op_amp
l_int|0xcfff
)paren
op_or
id|palette_pbs
c_func
(paren
id|var
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * sa1100fb_set_var():&n; *&t;Set the user defined part of the display for the specified console&n; */
r_static
r_int
DECL|function|sa1100fb_set_var
id|sa1100fb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|dvar
op_assign
id|get_con_var
c_func
(paren
op_amp
id|fbi-&gt;fb
comma
id|con
)paren
suffix:semicolon
r_struct
id|display
op_star
id|display
op_assign
id|get_con_display
c_func
(paren
op_amp
id|fbi-&gt;fb
comma
id|con
)paren
suffix:semicolon
r_int
id|err
comma
id|chgvar
op_assign
l_int|0
comma
id|rgbidx
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;set_var&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Decode var contents into a par structure, adjusting any&n;&t; * out of range values.&n;&t; */
id|err
op_assign
id|sa1100fb_validate_var
c_func
(paren
id|var
comma
id|fbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_TEST
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_ne
id|FB_ACTIVATE_NOW
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dvar-&gt;xres
op_ne
id|var-&gt;xres
)paren
id|chgvar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dvar-&gt;yres
op_ne
id|var-&gt;yres
)paren
id|chgvar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dvar-&gt;xres_virtual
op_ne
id|var-&gt;xres_virtual
)paren
id|chgvar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dvar-&gt;yres_virtual
op_ne
id|var-&gt;yres_virtual
)paren
id|chgvar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dvar-&gt;bits_per_pixel
op_ne
id|var-&gt;bits_per_pixel
)paren
id|chgvar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|con
OL
l_int|0
)paren
id|chgvar
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB4
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|fbi-&gt;cmap_static
)paren
id|display-&gt;visual
op_assign
id|FB_VISUAL_STATIC_PSEUDOCOLOR
suffix:semicolon
r_else
id|display-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|display-&gt;line_length
op_assign
id|var-&gt;xres
op_div
l_int|2
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb4
suffix:semicolon
id|rgbidx
op_assign
id|RGB_8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
id|fbi-&gt;cmap_static
)paren
id|display-&gt;visual
op_assign
id|FB_VISUAL_STATIC_PSEUDOCOLOR
suffix:semicolon
r_else
id|display-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|display-&gt;line_length
op_assign
id|var-&gt;xres
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
id|rgbidx
op_assign
id|RGB_8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|display-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|display-&gt;line_length
op_assign
id|var-&gt;xres
op_star
l_int|2
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|display-&gt;dispsw_data
op_assign
id|fbi-&gt;fb.pseudo_palette
suffix:semicolon
id|rgbidx
op_assign
id|RGB_16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|rgbidx
op_assign
l_int|0
suffix:semicolon
id|display-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
r_break
suffix:semicolon
)brace
id|display-&gt;next_line
op_assign
id|display-&gt;line_length
suffix:semicolon
id|display-&gt;type
op_assign
id|fbi-&gt;fb.fix.type
suffix:semicolon
id|display-&gt;type_aux
op_assign
id|fbi-&gt;fb.fix.type_aux
suffix:semicolon
id|display-&gt;ypanstep
op_assign
id|fbi-&gt;fb.fix.ypanstep
suffix:semicolon
id|display-&gt;ywrapstep
op_assign
id|fbi-&gt;fb.fix.ywrapstep
suffix:semicolon
id|display-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|display-&gt;inverse
op_assign
id|fbi-&gt;cmap_inverse
suffix:semicolon
op_star
id|dvar
op_assign
op_star
id|var
suffix:semicolon
id|dvar-&gt;activate
op_and_assign
op_complement
id|FB_ACTIVATE_ALL
suffix:semicolon
multiline_comment|/*&n;&t; * Copy the RGB parameters for this display&n;&t; * from the machine specific parameters.&n;&t; */
id|dvar-&gt;red
op_assign
id|fbi-&gt;rgb
(braket
id|rgbidx
)braket
op_member_access_from_pointer
id|red
suffix:semicolon
id|dvar-&gt;green
op_assign
id|fbi-&gt;rgb
(braket
id|rgbidx
)braket
op_member_access_from_pointer
id|green
suffix:semicolon
id|dvar-&gt;blue
op_assign
id|fbi-&gt;rgb
(braket
id|rgbidx
)braket
op_member_access_from_pointer
id|blue
suffix:semicolon
id|dvar-&gt;transp
op_assign
id|fbi-&gt;rgb
(braket
id|rgbidx
)braket
op_member_access_from_pointer
id|transp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;RGBT length = %d:%d:%d:%d&bslash;n&quot;
comma
id|dvar-&gt;red.length
comma
id|dvar-&gt;green.length
comma
id|dvar-&gt;blue.length
comma
id|dvar-&gt;transp.length
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;RGBT offset = %d:%d:%d:%d&bslash;n&quot;
comma
id|dvar-&gt;red.offset
comma
id|dvar-&gt;green.offset
comma
id|dvar-&gt;blue.offset
comma
id|dvar-&gt;transp.offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Update the old var.  The fbcon drivers still use this.&n;&t; * Once they are using fbi-&gt;fb.var, this can be dropped.&n;&t; */
id|display-&gt;var
op_assign
op_star
id|dvar
suffix:semicolon
multiline_comment|/*&n;&t; * If we are setting all the virtual consoles, also set the&n;&t; * defaults used to create new consoles.&n;&t; */
r_if
c_cond
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_ALL
)paren
id|fbi-&gt;fb.disp-&gt;var
op_assign
op_star
id|dvar
suffix:semicolon
multiline_comment|/*&n;&t; * If the console has changed and the console has defined&n;&t; * a changevar function, call that function.&n;&t; */
r_if
c_cond
(paren
id|chgvar
op_logical_and
id|info
op_logical_and
id|fbi-&gt;fb.changevar
)paren
id|fbi-&gt;fb
dot
id|changevar
c_func
(paren
id|con
)paren
suffix:semicolon
multiline_comment|/* If the current console is selected, activate the new var. */
r_if
c_cond
(paren
id|con
op_ne
id|fbi-&gt;fb.currcon
)paren
r_return
l_int|0
suffix:semicolon
id|sa1100fb_hw_set_var
c_func
(paren
id|dvar
comma
id|fbi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|__do_set_cmap
id|__do_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|fb_cmap
op_star
id|dcmap
op_assign
id|get_con_cmap
c_func
(paren
id|info
comma
id|con
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
op_minus
l_int|1
)paren
id|con
op_assign
id|info-&gt;currcon
suffix:semicolon
multiline_comment|/* no colormap allocated? (we always have &quot;this&quot; colour map allocated) */
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|cmap
comma
id|fbi-&gt;palette_size
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|con
op_eq
id|info-&gt;currcon
)paren
id|err
op_assign
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
id|dcmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_set_cmap
id|sa1100fb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|display
op_star
id|disp
op_assign
id|get_con_display
c_func
(paren
id|info
comma
id|con
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disp-&gt;visual
op_eq
id|FB_VISUAL_TRUECOLOR
op_logical_or
id|disp-&gt;visual
op_eq
id|FB_VISUAL_STATIC_PSEUDOCOLOR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|__do_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|con
comma
id|info
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_get_fix
id|sa1100fb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|display
op_star
id|display
op_assign
id|get_con_display
c_func
(paren
id|info
comma
id|con
)paren
suffix:semicolon
op_star
id|fix
op_assign
id|info-&gt;fix
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|display-&gt;line_length
suffix:semicolon
id|fix-&gt;visual
op_assign
id|display-&gt;visual
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_get_var
id|sa1100fb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
op_star
id|var
op_assign
op_star
id|get_con_var
c_func
(paren
id|info
comma
id|con
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sa1100fb_get_cmap
id|sa1100fb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_cmap
op_star
id|dcmap
op_assign
id|get_con_cmap
c_func
(paren
id|info
comma
id|con
)paren
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
id|dcmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sa1100fb_ops
r_static
r_struct
id|fb_ops
id|sa1100fb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|sa1100fb_get_fix
comma
id|fb_get_var
suffix:colon
id|sa1100fb_get_var
comma
id|fb_set_var
suffix:colon
id|sa1100fb_set_var
comma
id|fb_get_cmap
suffix:colon
id|sa1100fb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|sa1100fb_set_cmap
comma
id|fb_setcolreg
suffix:colon
id|sa1100fb_setcolreg
comma
id|fb_blank
suffix:colon
id|sa1100fb_blank
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  sa1100fb_switch():       &n; *&t;Change to the specified console.  Palette and video mode&n; *      are changed to the console&squot;s stored parameters.&n; *&n; *&t;Uh oh, this can be called from a tasklet (IRQ)&n; */
DECL|function|sa1100fb_switch
r_static
r_int
id|sa1100fb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
r_struct
id|fb_cmap
op_star
id|cmap
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;con=%d info-&gt;modename=%s&bslash;n&quot;
comma
id|con
comma
id|fbi-&gt;fb.modename
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;currcon
op_ge
l_int|0
)paren
(brace
id|disp
op_assign
id|fb_display
op_plus
id|info-&gt;currcon
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Save the old colormap and video mode.&n;&t;&t; */
id|disp-&gt;var
op_assign
id|fbi-&gt;fb.var
suffix:semicolon
r_if
c_cond
(paren
id|disp-&gt;cmap.len
)paren
id|fb_copy_cmap
c_func
(paren
op_amp
id|fbi-&gt;fb.cmap
comma
op_amp
id|disp-&gt;cmap
comma
l_int|0
)paren
suffix:semicolon
)brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
id|disp
op_assign
id|fb_display
op_plus
id|con
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure that our colourmap contains 256 entries.&n;&t; */
id|fb_alloc_cmap
c_func
(paren
op_amp
id|fbi-&gt;fb.cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disp-&gt;cmap.len
)paren
id|cmap
op_assign
op_amp
id|disp-&gt;cmap
suffix:semicolon
r_else
id|cmap
op_assign
id|fb_default_cmap
c_func
(paren
l_int|1
op_lshift
id|disp-&gt;var.bits_per_pixel
)paren
suffix:semicolon
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|fbi-&gt;fb.cmap
comma
l_int|0
)paren
suffix:semicolon
id|fbi-&gt;fb.var
op_assign
id|disp-&gt;var
suffix:semicolon
id|fbi-&gt;fb.var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|sa1100fb_set_var
c_func
(paren
op_amp
id|fbi-&gt;fb.var
comma
id|con
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Formal definition of the VESA spec:&n; *  On&n; *  &t;This refers to the state of the display when it is in full operation&n; *  Stand-By&n; *  &t;This defines an optional operating state of minimal power reduction with&n; *  &t;the shortest recovery time&n; *  Suspend&n; *  &t;This refers to a level of power management in which substantial power&n; *  &t;reduction is achieved by the display.  The display can have a longer &n; *  &t;recovery time from this state than from the Stand-by state&n; *  Off&n; *  &t;This indicates that the display is consuming the lowest level of power&n; *  &t;and is non-operational. Recovery from this state may optionally require&n; *  &t;the user to manually power on the monitor&n; *&n; *  Now, the fbdev driver adds an additional state, (blank), where they&n; *  turn off the video (maybe by colormap tricks), but don&squot;t mess with the&n; *  video itself: think of it semantically between on and Stand-By.&n; *&n; *  So here&squot;s what we should do in our fbdev blank routine:&n; *&n; *  &t;VESA_NO_BLANKING (mode 0)&t;Video on,  front/back light on&n; *  &t;VESA_VSYNC_SUSPEND (mode 1)  &t;Video on,  front/back light off&n; *  &t;VESA_HSYNC_SUSPEND (mode 2)  &t;Video on,  front/back light off&n; *  &t;VESA_POWERDOWN (mode 3)&t;&t;Video off, front/back light off&n; *&n; *  This will match the matrox implementation.&n; */
multiline_comment|/*&n; * sa1100fb_blank():&n; *&t;Blank the display by setting all palette values to zero.  Note, the &n; * &t;12 and 16 bpp modes don&squot;t really use the palette, so this will not&n; *      blank the display in all modes.  &n; */
DECL|function|sa1100fb_blank
r_static
r_int
id|sa1100fb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
(paren
r_struct
id|sa1100fb_info
op_star
)paren
id|info
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;sa1100fb_blank: blank=%d info-&gt;modename=%s&bslash;n&quot;
comma
id|blank
comma
id|fbi-&gt;fb.modename
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
id|VESA_POWERDOWN
suffix:colon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
r_if
c_cond
(paren
id|fbi-&gt;fb.disp-&gt;visual
op_eq
id|FB_VISUAL_PSEUDOCOLOR
op_logical_or
id|fbi-&gt;fb.disp-&gt;visual
op_eq
id|FB_VISUAL_STATIC_PSEUDOCOLOR
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fbi-&gt;palette_size
suffix:semicolon
id|i
op_increment
)paren
id|sa1100fb_setpalettereg
c_func
(paren
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|info
)paren
suffix:semicolon
id|sa1100fb_schedule_task
c_func
(paren
id|fbi
comma
id|C_DISABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa1100fb_blank_helper
)paren
id|sa1100fb_blank_helper
c_func
(paren
id|blank
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_NO_BLANKING
suffix:colon
r_if
c_cond
(paren
id|sa1100fb_blank_helper
)paren
id|sa1100fb_blank_helper
c_func
(paren
id|blank
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;fb.disp-&gt;visual
op_eq
id|FB_VISUAL_PSEUDOCOLOR
op_logical_or
id|fbi-&gt;fb.disp-&gt;visual
op_eq
id|FB_VISUAL_STATIC_PSEUDOCOLOR
)paren
id|fb_set_cmap
c_func
(paren
op_amp
id|fbi-&gt;fb.cmap
comma
l_int|1
comma
id|info
)paren
suffix:semicolon
id|sa1100fb_schedule_task
c_func
(paren
id|fbi
comma
id|C_ENABLE
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sa1100fb_updatevar
r_static
r_int
id|sa1100fb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;entered&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Calculate the PCD value from the clock rate (in picoseconds).&n; * We take account of the PPCR clock setting.&n; */
DECL|function|get_pcd
r_static
r_inline
r_int
id|get_pcd
c_func
(paren
r_int
r_int
id|pixclock
)paren
(brace
r_int
r_int
id|pcd
suffix:semicolon
r_if
c_cond
(paren
id|pixclock
)paren
(brace
id|pcd
op_assign
id|cpufreq_get
c_func
(paren
l_int|0
)paren
op_div
l_int|100
suffix:semicolon
id|pcd
op_mul_assign
id|pixclock
suffix:semicolon
id|pcd
op_div_assign
l_int|10000000
suffix:semicolon
id|pcd
op_add_assign
l_int|1
suffix:semicolon
multiline_comment|/* make up for integer math truncations */
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * People seem to be missing this message.  Make it big.&n;&t;&t; * Make it stand out.  Make sure people see it.&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;******************************************************&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;**            ZERO PIXEL CLOCK DETECTED             **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** You are using a zero pixclock.  This means that  **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** clock scaling will not be able to adjust your    **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** your timing parameters appropriately, and the    **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** bandwidth calculations will fail to work.  This  **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** will shortly become an error condition, which    **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** will prevent your LCD display working.  Please   **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** send your patches in as soon as possible to shut **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;** this message up.                                 **&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;******************************************************&bslash;n&quot;
)paren
suffix:semicolon
id|pcd
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|pcd
suffix:semicolon
)brace
multiline_comment|/*&n; * sa1100fb_activate_var():&n; *&t;Configures LCD Controller based on entries in var parameter.  Settings are      &n; *&t;only written to the controller if changes were made.  &n; */
DECL|function|sa1100fb_activate_var
r_static
r_int
id|sa1100fb_activate_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
r_struct
id|sa1100fb_lcd_reg
id|new_regs
suffix:semicolon
id|u_int
id|half_screen_size
comma
id|yres
comma
id|pcd
op_assign
id|get_pcd
c_func
(paren
id|var-&gt;pixclock
)paren
suffix:semicolon
id|u_long
id|flags
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Configuring SA1100 LCD&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;var: xres=%d hslen=%d lm=%d rm=%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;hsync_len
comma
id|var-&gt;left_margin
comma
id|var-&gt;right_margin
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;var: yres=%d vslen=%d um=%d bm=%d&bslash;n&quot;
comma
id|var-&gt;yres
comma
id|var-&gt;vsync_len
comma
id|var-&gt;upper_margin
comma
id|var-&gt;lower_margin
)paren
suffix:semicolon
macro_line|#if DEBUG_VAR
r_if
c_cond
(paren
id|var-&gt;xres
template_param
l_int|1024
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid xres %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;xres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;hsync_len
template_param
l_int|64
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid hsync_len %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;hsync_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;left_margin
template_param
l_int|255
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid left_margin %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;left_margin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;right_margin
template_param
l_int|255
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid right_margin %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;right_margin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres
template_param
l_int|1024
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid yres %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;yres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vsync_len
template_param
l_int|64
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid vsync_len %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;vsync_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;upper_margin
template_param
l_int|255
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid upper_margin %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;upper_margin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;lower_margin
template_param
l_int|255
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid lower_margin %d&bslash;n&quot;
comma
id|fbi-&gt;fb.fix.id
comma
id|var-&gt;lower_margin
)paren
suffix:semicolon
macro_line|#endif
id|new_regs.lccr0
op_assign
id|fbi-&gt;lccr0
op_or
id|LCCR0_LEN
op_or
id|LCCR0_LDM
op_or
id|LCCR0_BAM
op_or
id|LCCR0_ERM
op_or
id|LCCR0_LtlEnd
op_or
id|LCCR0_DMADel
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|new_regs.lccr1
op_assign
id|LCCR1_DisWdth
c_func
(paren
id|var-&gt;xres
)paren
op_plus
id|LCCR1_HorSnchWdth
c_func
(paren
id|var-&gt;hsync_len
)paren
op_plus
id|LCCR1_BegLnDel
c_func
(paren
id|var-&gt;left_margin
)paren
op_plus
id|LCCR1_EndLnDel
c_func
(paren
id|var-&gt;right_margin
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we have a dual scan LCD, then we need to halve&n;&t; * the YRES parameter.&n;&t; */
id|yres
op_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;lccr0
op_amp
id|LCCR0_Dual
)paren
id|yres
op_div_assign
l_int|2
suffix:semicolon
id|new_regs.lccr2
op_assign
id|LCCR2_DisHght
c_func
(paren
id|yres
)paren
op_plus
id|LCCR2_VrtSnchWdth
c_func
(paren
id|var-&gt;vsync_len
)paren
op_plus
id|LCCR2_BegFrmDel
c_func
(paren
id|var-&gt;upper_margin
)paren
op_plus
id|LCCR2_EndFrmDel
c_func
(paren
id|var-&gt;lower_margin
)paren
suffix:semicolon
id|new_regs.lccr3
op_assign
id|fbi-&gt;lccr3
op_or
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
id|LCCR3_HorSnchH
suffix:colon
id|LCCR3_HorSnchL
)paren
op_or
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
id|LCCR3_VrtSnchH
suffix:colon
id|LCCR3_VrtSnchL
)paren
op_or
id|LCCR3_ACBsCntOff
suffix:semicolon
r_if
c_cond
(paren
id|pcd
)paren
id|new_regs.lccr3
op_or_assign
id|LCCR3_PixClkDiv
c_func
(paren
id|pcd
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;nlccr0 = 0x%08x&bslash;n&quot;
comma
id|new_regs.lccr0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;nlccr1 = 0x%08x&bslash;n&quot;
comma
id|new_regs.lccr1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;nlccr2 = 0x%08x&bslash;n&quot;
comma
id|new_regs.lccr2
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;nlccr3 = 0x%08x&bslash;n&quot;
comma
id|new_regs.lccr3
)paren
suffix:semicolon
id|half_screen_size
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|half_screen_size
op_assign
id|half_screen_size
op_star
id|var-&gt;xres
op_star
id|var-&gt;yres
op_div
l_int|16
suffix:semicolon
multiline_comment|/* Update shadow copy atomically */
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|fbi-&gt;dbar1
op_assign
id|fbi-&gt;palette_dma
suffix:semicolon
id|fbi-&gt;dbar2
op_assign
id|fbi-&gt;screen_dma
op_plus
id|half_screen_size
suffix:semicolon
id|fbi-&gt;reg_lccr0
op_assign
id|new_regs.lccr0
suffix:semicolon
id|fbi-&gt;reg_lccr1
op_assign
id|new_regs.lccr1
suffix:semicolon
id|fbi-&gt;reg_lccr2
op_assign
id|new_regs.lccr2
suffix:semicolon
id|fbi-&gt;reg_lccr3
op_assign
id|new_regs.lccr3
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Only update the registers if the controller is enabled&n;&t; * and something has changed.&n;&t; */
r_if
c_cond
(paren
(paren
id|LCCR0
op_ne
id|fbi-&gt;reg_lccr0
)paren
op_logical_or
(paren
id|LCCR1
op_ne
id|fbi-&gt;reg_lccr1
)paren
op_logical_or
(paren
id|LCCR2
op_ne
id|fbi-&gt;reg_lccr2
)paren
op_logical_or
(paren
id|LCCR3
op_ne
id|fbi-&gt;reg_lccr3
)paren
op_logical_or
(paren
id|DBAR1
op_ne
id|fbi-&gt;dbar1
)paren
op_logical_or
(paren
id|DBAR2
op_ne
id|fbi-&gt;dbar2
)paren
)paren
id|sa1100fb_schedule_task
c_func
(paren
id|fbi
comma
id|C_REENABLE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * NOTE!  The following functions are purely helpers for set_ctrlr_state.&n; * Do not call them directly; set_ctrlr_state does the correct serialisation&n; * to ensure that things happen in the right way 100% of time time.&n; *&t;-- rmk&n; */
multiline_comment|/*&n; * FIXME: move LCD power stuff into sa1100fb_power_up_lcd()&n; * Also, I&squot;m expecting that the backlight stuff should&n; * be handled differently.&n; */
DECL|function|sa1100fb_backlight_on
r_static
r_inline
r_void
id|sa1100fb_backlight_on
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;backlight on&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa1100fb_backlight_power
)paren
id|sa1100fb_backlight_power
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * FIXME: move LCD power stuf into sa1100fb_power_down_lcd()&n; * Also, I&squot;m expecting that the backlight stuff should&n; * be handled differently.&n; */
DECL|function|sa1100fb_backlight_off
r_static
r_inline
r_void
id|sa1100fb_backlight_off
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;backlight off&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa1100fb_backlight_power
)paren
id|sa1100fb_backlight_power
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sa1100fb_power_up_lcd
r_static
r_inline
r_void
id|sa1100fb_power_up_lcd
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;LCD power on&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa1100fb_lcd_power
)paren
id|sa1100fb_lcd_power
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_STORK
r_if
c_cond
(paren
id|machine_is_stork
c_func
(paren
)paren
)paren
(brace
id|storkSetLCDCPLD
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|storkSetLatchA
c_func
(paren
id|STORK_LCD_BACKLIGHT_INVERTER_ON
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|sa1100fb_power_down_lcd
r_static
r_inline
r_void
id|sa1100fb_power_down_lcd
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;LCD power off&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa1100fb_lcd_power
)paren
id|sa1100fb_lcd_power
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_STORK
r_if
c_cond
(paren
id|machine_is_stork
c_func
(paren
)paren
)paren
(brace
id|storkSetLCDCPLD
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|storkClearLatchA
c_func
(paren
id|STORK_LCD_BACKLIGHT_INVERTER_ON
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|sa1100fb_setup_gpio
r_static
r_void
id|sa1100fb_setup_gpio
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|u_int
id|mask
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Enable GPIO&lt;9:2&gt; for LCD use if:&n;&t; *  1. Active display, or&n;&t; *  2. Color Dual Passive display&n;&t; *&n;&t; * see table 11.8 on page 11-27 in the SA1100 manual&n;&t; *   -- Erik.&n;&t; *&n;&t; * SA1110 spec update nr. 25 says we can and should&n;&t; * clear LDD15 to 12 for 4 or 8bpp modes with active&n;&t; * panels.  &n;&t; */
r_if
c_cond
(paren
(paren
id|fbi-&gt;reg_lccr0
op_amp
id|LCCR0_CMS
)paren
op_eq
id|LCCR0_Color
op_logical_and
(paren
id|fbi-&gt;reg_lccr0
op_amp
(paren
id|LCCR0_Dual
op_or
id|LCCR0_Act
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|mask
op_assign
id|GPIO_LDD11
op_or
id|GPIO_LDD10
op_or
id|GPIO_LDD9
op_or
id|GPIO_LDD8
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;fb.var.bits_per_pixel
OG
l_int|8
op_logical_or
(paren
id|fbi-&gt;reg_lccr0
op_amp
(paren
id|LCCR0_Dual
op_or
id|LCCR0_Act
)paren
)paren
op_eq
id|LCCR0_Dual
)paren
id|mask
op_or_assign
id|GPIO_LDD15
op_or
id|GPIO_LDD14
op_or
id|GPIO_LDD13
op_or
id|GPIO_LDD12
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* GPIO15 is used as a bypass for 3.8&quot; displays */
id|mask
op_or_assign
id|GPIO_GPIO15
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_CERF
macro_line|#warning Read Me Now!
macro_line|#endif
macro_line|#if 0 /* if this causes you problems, mail &lt;rmk@arm.linux.org.uk&gt; please. */
multiline_comment|/*&n;       * This was enabled for the 72_A version only, which is a _color_&n;       * _dual_ LCD.  Now look at the generic test above, and calculate&n;       * the mask value for a colour dual display...&n;       *&n;       * I therefore conclude that the code below is redundant, and will&n;       * be killed at the start of November 2001.&n;       */
multiline_comment|/* FIXME: why is this? The Cerf&squot;s display doesn&squot;t seem&n;&t;&t; * to be dual scan or active. I just leave it here,&n;&t;&t; * but in my opinion this is definitively wrong.&n;&t;&t; *  -- Erik &lt;J.A.K.Mouw@its.tudelft.nl&gt;&n;&t;&t; */
multiline_comment|/* REPLY: Umm.. Well to be honest, the 5.7&quot; LCD which&n;&t;&t; * this was used for does not use these pins, but&n;&t;&t; * apparently all hell breaks loose if they are not&n;&t;&t; * set on the Cerf, so we decided to leave them in ;)&n;&t;&t; *  -- Daniel Chemko &lt;dchemko@intrinsyc.com&gt;&n;&t;&t; */
multiline_comment|/* color {dual/single} passive */
id|mask
op_or_assign
id|GPIO_LDD15
op_or
id|GPIO_LDD14
op_or
id|GPIO_LDD13
op_or
id|GPIO_LDD12
op_or
id|GPIO_LDD11
op_or
id|GPIO_LDD10
op_or
id|GPIO_LDD9
op_or
id|GPIO_LDD8
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|mask
)paren
(brace
id|GPDR
op_or_assign
id|mask
suffix:semicolon
id|GAFR
op_or_assign
id|mask
suffix:semicolon
)brace
)brace
DECL|function|sa1100fb_enable_controller
r_static
r_void
id|sa1100fb_enable_controller
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Enabling LCD controller&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure the mode bits are present in the first palette entry&n;&t; */
id|fbi-&gt;palette_cpu
(braket
l_int|0
)braket
op_and_assign
l_int|0xcfff
suffix:semicolon
id|fbi-&gt;palette_cpu
(braket
l_int|0
)braket
op_or_assign
id|palette_pbs
c_func
(paren
op_amp
id|fbi-&gt;fb.var
)paren
suffix:semicolon
multiline_comment|/* Sequence from 11.7.10 */
id|LCCR3
op_assign
id|fbi-&gt;reg_lccr3
suffix:semicolon
id|LCCR2
op_assign
id|fbi-&gt;reg_lccr2
suffix:semicolon
id|LCCR1
op_assign
id|fbi-&gt;reg_lccr1
suffix:semicolon
id|LCCR0
op_assign
id|fbi-&gt;reg_lccr0
op_amp
op_complement
id|LCCR0_LEN
suffix:semicolon
id|DBAR1
op_assign
id|fbi-&gt;dbar1
suffix:semicolon
id|DBAR2
op_assign
id|fbi-&gt;dbar2
suffix:semicolon
id|LCCR0
op_or_assign
id|LCCR0_LEN
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
macro_line|#error Where is GPIO24 set as an output?  Can we fit this in somewhere else?
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
singleline_comment|// From ADS doc again...same as disable
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|20
op_star
id|HZ
op_div
l_int|1000
)paren
suffix:semicolon
id|GPSR
op_or_assign
id|GPIO_GPIO24
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|machine_is_shannon
c_func
(paren
)paren
)paren
(brace
id|GPDR
op_or_assign
id|SHANNON_GPIO_DISP_EN
suffix:semicolon
id|GPSR
op_or_assign
id|SHANNON_GPIO_DISP_EN
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;DBAR1 = %p&bslash;n&quot;
comma
id|DBAR1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;DBAR2 = %p&bslash;n&quot;
comma
id|DBAR2
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LCCR0 = 0x%08x&bslash;n&quot;
comma
id|LCCR0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LCCR1 = 0x%08x&bslash;n&quot;
comma
id|LCCR1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LCCR2 = 0x%08x&bslash;n&quot;
comma
id|LCCR2
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LCCR3 = 0x%08x&bslash;n&quot;
comma
id|LCCR3
)paren
suffix:semicolon
)brace
DECL|function|sa1100fb_disable_controller
r_static
r_void
id|sa1100fb_disable_controller
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Disabling LCD controller&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
macro_line|#error Where is GPIO24 set as an output?  Can we fit this in somewhere else?
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * From ADS internal document:&n;&t;&t; *  GPIO24 should be LOW at least 10msec prior to disabling&n;&t;&t; *  the LCD interface.&n;&t;&t; *&n;&t;&t; * We&squot;ll wait 20msec.&n;&t;&t; */
id|GPCR
op_or_assign
id|GPIO_GPIO24
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|20
op_star
id|HZ
op_div
l_int|1000
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
macro_line|#error Move me into sa1100fb_power_up_lcd and/or sa1100fb_backlight_on
r_if
c_cond
(paren
id|machine_is_huw_webpanel
c_func
(paren
)paren
)paren
(brace
singleline_comment|// dont forget to set the control lines to zero (?)
id|DPRINTK
c_func
(paren
l_string|&quot;ShutDown HuW LCD controller&bslash;n&quot;
)paren
suffix:semicolon
id|BCR_clear
c_func
(paren
id|BCR_TFT_ENA
op_plus
id|BCR_CCFL_POW
op_plus
id|BCR_PWM_BACKLIGHT
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|machine_is_shannon
c_func
(paren
)paren
)paren
(brace
id|GPCR
op_or_assign
id|SHANNON_GPIO_DISP_EN
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|LCSR
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Clear LCD Status Register */
id|LCCR0
op_and_assign
op_complement
id|LCCR0_LDM
suffix:semicolon
multiline_comment|/* Enable LCD Disable Done Interrupt */
id|LCCR0
op_and_assign
op_complement
id|LCCR0_LEN
suffix:semicolon
multiline_comment|/* Disable LCD Controller */
id|schedule_timeout
c_func
(paren
l_int|20
op_star
id|HZ
op_div
l_int|1000
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  sa1100fb_handle_irq: Handle &squot;LCD DONE&squot; interrupts.&n; */
DECL|function|sa1100fb_handle_irq
r_static
r_void
id|sa1100fb_handle_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|lcsr
op_assign
id|LCSR
suffix:semicolon
r_if
c_cond
(paren
id|lcsr
op_amp
id|LCSR_LDD
)paren
(brace
id|LCCR0
op_or_assign
id|LCCR0_LDM
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_wait
)paren
suffix:semicolon
)brace
id|LCSR
op_assign
id|lcsr
suffix:semicolon
)brace
multiline_comment|/*&n; * This function must be called from task context only, since it will&n; * sleep when disabling the LCD controller, or if we get two contending&n; * processes trying to alter state.&n; */
DECL|function|set_ctrlr_state
r_static
r_void
id|set_ctrlr_state
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
comma
id|u_int
id|state
)paren
(brace
id|u_int
id|old_state
suffix:semicolon
id|down
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_sem
)paren
suffix:semicolon
id|old_state
op_assign
id|fbi-&gt;state
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|C_DISABLE_CLKCHANGE
suffix:colon
multiline_comment|/*&n;&t;&t; * Disable controller for clock change.  If the&n;&t;&t; * controller is already disabled, then do nothing.&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_ne
id|C_DISABLE
op_logical_and
id|old_state
op_ne
id|C_DISABLE_PM
)paren
(brace
id|fbi-&gt;state
op_assign
id|state
suffix:semicolon
id|sa1100fb_disable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C_DISABLE_PM
suffix:colon
r_case
id|C_DISABLE
suffix:colon
multiline_comment|/*&n;&t;&t; * Disable controller&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_ne
id|C_DISABLE
)paren
(brace
id|fbi-&gt;state
op_assign
id|state
suffix:semicolon
id|sa1100fb_backlight_off
c_func
(paren
id|fbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_state
op_ne
id|C_DISABLE_CLKCHANGE
)paren
id|sa1100fb_disable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_power_down_lcd
c_func
(paren
id|fbi
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C_ENABLE_CLKCHANGE
suffix:colon
multiline_comment|/*&n;&t;&t; * Enable the controller after clock change.  Only&n;&t;&t; * do this if we were disabled for the clock change.&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_eq
id|C_DISABLE_CLKCHANGE
)paren
(brace
id|fbi-&gt;state
op_assign
id|C_ENABLE
suffix:semicolon
id|sa1100fb_enable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C_REENABLE
suffix:colon
multiline_comment|/*&n;&t;&t; * Re-enable the controller only if it was already&n;&t;&t; * enabled.  This is so we reprogram the control&n;&t;&t; * registers.&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_eq
id|C_ENABLE
)paren
(brace
id|sa1100fb_disable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_setup_gpio
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_enable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C_ENABLE_PM
suffix:colon
multiline_comment|/*&n;&t;&t; * Re-enable the controller after PM.  This is not&n;&t;&t; * perfect - think about the case where we were doing&n;&t;&t; * a clock change, and we suspended half-way through.&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_ne
id|C_DISABLE_PM
)paren
r_break
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|C_ENABLE
suffix:colon
multiline_comment|/*&n;&t;&t; * Power up the LCD screen, enable controller, and&n;&t;&t; * turn on the backlight.&n;&t;&t; */
r_if
c_cond
(paren
id|old_state
op_ne
id|C_ENABLE
)paren
(brace
id|fbi-&gt;state
op_assign
id|C_ENABLE
suffix:semicolon
id|sa1100fb_setup_gpio
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_power_up_lcd
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_enable_controller
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|sa1100fb_backlight_on
c_func
(paren
id|fbi
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_sem
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Our LCD controller task (which is called when we blank or unblank)&n; * via keventd.&n; */
DECL|function|sa1100fb_task
r_static
r_void
id|sa1100fb_task
c_func
(paren
r_void
op_star
id|dummy
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
id|dummy
suffix:semicolon
id|u_int
id|state
op_assign
id|xchg
c_func
(paren
op_amp
id|fbi-&gt;task_state
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|state
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CPU_FREQ
multiline_comment|/*&n; * Calculate the minimum DMA period over all displays that we own.&n; * This, together with the SDRAM bandwidth defines the slowest CPU&n; * frequency that can be selected.&n; */
DECL|function|sa1100fb_min_dma_period
r_static
r_int
r_int
id|sa1100fb_min_dma_period
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
r_int
r_int
id|min_period
op_assign
(paren
r_int
r_int
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|period
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Do we own this display?&n;&t;&t; */
r_if
c_cond
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fb_info
op_ne
op_amp
id|fbi-&gt;fb
)paren
r_continue
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Ok, calculate its DMA period&n;&t;&t; */
id|period
op_assign
id|sa1100fb_display_dma_period
c_func
(paren
id|get_con_var
c_func
(paren
op_amp
id|fbi-&gt;fb
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|period
OL
id|min_period
)paren
id|min_period
op_assign
id|period
suffix:semicolon
)brace
r_return
id|min_period
suffix:semicolon
)brace
multiline_comment|/*&n; * CPU clock speed change handler.  We need to adjust the LCD timing&n; * parameters when the CPU clock is adjusted by the power management&n; * subsystem.&n; */
r_static
r_int
DECL|function|sa1100fb_clkchg_notifier
id|sa1100fb_clkchg_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
r_int
r_int
id|val
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
id|TO_INF
c_func
(paren
id|nb
comma
id|clockchg
)paren
suffix:semicolon
r_struct
id|cpufreq_minmax
op_star
id|mm
op_assign
id|data
suffix:semicolon
id|u_int
id|pcd
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|CPUFREQ_MINMAX
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;min dma period: %d ps, old clock %d kHz, &quot;
l_string|&quot;new clock %d kHz&bslash;n&quot;
comma
id|sa1100fb_min_dma_period
c_func
(paren
id|fbi
)paren
comma
id|mm-&gt;cur_freq
comma
id|mm-&gt;new_freq
)paren
suffix:semicolon
multiline_comment|/* todo: fill in min/max values */
r_break
suffix:semicolon
r_case
id|CPUFREQ_PRECHANGE
suffix:colon
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|C_DISABLE_CLKCHANGE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CPUFREQ_POSTCHANGE
suffix:colon
id|pcd
op_assign
id|get_pcd
c_func
(paren
id|fbi-&gt;fb.var.pixclock
)paren
suffix:semicolon
id|fbi-&gt;reg_lccr3
op_assign
(paren
id|fbi-&gt;reg_lccr3
op_amp
op_complement
l_int|0xff
)paren
op_or
id|LCCR3_PixClkDiv
c_func
(paren
id|pcd
)paren
suffix:semicolon
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|C_ENABLE_CLKCHANGE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n; * Power management hook.  Note that we won&squot;t be called from IRQ context,&n; * unlike the blank functions above, so we may sleep.&n; */
r_static
r_int
DECL|function|sa1100fb_pm_callback
id|sa1100fb_pm_callback
c_func
(paren
r_struct
id|pm_dev
op_star
id|pm_dev
comma
id|pm_request_t
id|req
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
op_assign
id|pm_dev-&gt;data
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;pm_callback: %d&bslash;n&quot;
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req
op_eq
id|PM_SUSPEND
op_logical_or
id|req
op_eq
id|PM_RESUME
)paren
(brace
r_int
id|state
op_assign
(paren
r_int
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Enter D0. */
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|C_ENABLE_PM
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Enter D1-D3.  Disable the LCD controller.  */
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|C_DISABLE_PM
)paren
suffix:semicolon
)brace
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;done&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * sa1100fb_map_video_memory():&n; *      Allocates the DRAM memory for the frame buffer.  This buffer is  &n; *&t;remapped into a non-cached, non-buffered, memory region to  &n; *      allow palette and pixel writes to occur without flushing the &n; *      cache.  Once this area is remapped, all virtual memory&n; *      access to the video memory should occur at the new region.&n; */
DECL|function|sa1100fb_map_video_memory
r_static
r_int
id|__init
id|sa1100fb_map_video_memory
c_func
(paren
r_struct
id|sa1100fb_info
op_star
id|fbi
)paren
(brace
multiline_comment|/*&n;&t; * We reserve one page for the palette, plus the size&n;&t; * of the framebuffer.&n;&t; */
id|fbi-&gt;map_size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|fbi-&gt;fb.fix.smem_len
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
id|fbi-&gt;map_cpu
op_assign
id|consistent_alloc
c_func
(paren
id|GFP_KERNEL
comma
id|fbi-&gt;map_size
comma
op_amp
id|fbi-&gt;map_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;map_cpu
)paren
(brace
id|fbi-&gt;fb.screen_base
op_assign
id|fbi-&gt;map_cpu
op_plus
id|PAGE_SIZE
suffix:semicolon
id|fbi-&gt;screen_dma
op_assign
id|fbi-&gt;map_dma
op_plus
id|PAGE_SIZE
suffix:semicolon
id|fbi-&gt;fb.fix.smem_start
op_assign
id|fbi-&gt;screen_dma
suffix:semicolon
)brace
r_return
id|fbi-&gt;map_cpu
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Fake monspecs to fill in fbinfo structure */
DECL|variable|__initdata
r_static
r_struct
id|fb_monspecs
id|monspecs
id|__initdata
op_assign
(brace
l_int|30000
comma
l_int|70000
comma
l_int|50
comma
l_int|65
comma
l_int|0
multiline_comment|/* Generic */
)brace
suffix:semicolon
DECL|function|sa1100fb_init_fbinfo
r_static
r_struct
id|sa1100fb_info
op_star
id|__init
id|sa1100fb_init_fbinfo
c_func
(paren
r_void
)paren
(brace
r_struct
id|sa1100fb_mach_info
op_star
id|inf
suffix:semicolon
r_struct
id|sa1100fb_info
op_star
id|fbi
suffix:semicolon
id|fbi
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sa1100fb_info
)paren
op_plus
r_sizeof
(paren
r_struct
id|display
)paren
op_plus
r_sizeof
(paren
id|u16
)paren
op_star
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbi
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|fbi
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sa1100fb_info
)paren
op_plus
r_sizeof
(paren
r_struct
id|display
)paren
)paren
suffix:semicolon
id|fbi-&gt;fb.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|fbi-&gt;fb.fix.id
comma
id|SA1100_NAME
)paren
suffix:semicolon
id|fbi-&gt;fb.fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fbi-&gt;fb.fix.type_aux
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.fix.xpanstep
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.fix.ypanstep
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.fix.ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.fix.accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
id|fbi-&gt;fb.var.nonstd
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|fbi-&gt;fb.var.height
op_assign
op_minus
l_int|1
suffix:semicolon
id|fbi-&gt;fb.var.width
op_assign
op_minus
l_int|1
suffix:semicolon
id|fbi-&gt;fb.var.accel_flags
op_assign
l_int|0
suffix:semicolon
id|fbi-&gt;fb.var.vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
id|strcpy
c_func
(paren
id|fbi-&gt;fb.modename
comma
id|SA1100_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fbi-&gt;fb.fontname
comma
l_string|&quot;Acorn8x8&quot;
)paren
suffix:semicolon
id|fbi-&gt;fb.fbops
op_assign
op_amp
id|sa1100fb_ops
suffix:semicolon
id|fbi-&gt;fb.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fbi-&gt;fb.switch_con
op_assign
id|sa1100fb_switch
suffix:semicolon
id|fbi-&gt;fb.updatevar
op_assign
id|sa1100fb_updatevar
suffix:semicolon
id|fbi-&gt;fb.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|fbi-&gt;fb.node
op_assign
id|NODEV
suffix:semicolon
id|fbi-&gt;fb.monspecs
op_assign
id|monspecs
suffix:semicolon
id|fbi-&gt;fb.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|fbi-&gt;fb.disp
op_assign
(paren
r_struct
id|display
op_star
)paren
(paren
id|fbi
op_plus
l_int|1
)paren
suffix:semicolon
id|fbi-&gt;fb.pseudo_palette
op_assign
(paren
r_void
op_star
)paren
(paren
id|fbi-&gt;fb.disp
op_plus
l_int|1
)paren
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_8
)braket
op_assign
op_amp
id|rgb_8
suffix:semicolon
id|fbi-&gt;rgb
(braket
id|RGB_16
)braket
op_assign
op_amp
id|def_rgb_16
suffix:semicolon
id|inf
op_assign
id|sa1100fb_get_machine_info
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|fbi-&gt;max_xres
op_assign
id|inf-&gt;xres
suffix:semicolon
id|fbi-&gt;fb.var.xres
op_assign
id|inf-&gt;xres
suffix:semicolon
id|fbi-&gt;fb.var.xres_virtual
op_assign
id|inf-&gt;xres
suffix:semicolon
id|fbi-&gt;max_yres
op_assign
id|inf-&gt;yres
suffix:semicolon
id|fbi-&gt;fb.var.yres
op_assign
id|inf-&gt;yres
suffix:semicolon
id|fbi-&gt;fb.var.yres_virtual
op_assign
id|inf-&gt;yres
suffix:semicolon
id|fbi-&gt;max_bpp
op_assign
id|inf-&gt;bpp
suffix:semicolon
id|fbi-&gt;fb.var.bits_per_pixel
op_assign
id|inf-&gt;bpp
suffix:semicolon
id|fbi-&gt;fb.var.pixclock
op_assign
id|inf-&gt;pixclock
suffix:semicolon
id|fbi-&gt;fb.var.hsync_len
op_assign
id|inf-&gt;hsync_len
suffix:semicolon
id|fbi-&gt;fb.var.left_margin
op_assign
id|inf-&gt;left_margin
suffix:semicolon
id|fbi-&gt;fb.var.right_margin
op_assign
id|inf-&gt;right_margin
suffix:semicolon
id|fbi-&gt;fb.var.vsync_len
op_assign
id|inf-&gt;vsync_len
suffix:semicolon
id|fbi-&gt;fb.var.upper_margin
op_assign
id|inf-&gt;upper_margin
suffix:semicolon
id|fbi-&gt;fb.var.lower_margin
op_assign
id|inf-&gt;lower_margin
suffix:semicolon
id|fbi-&gt;fb.var.sync
op_assign
id|inf-&gt;sync
suffix:semicolon
id|fbi-&gt;fb.var.grayscale
op_assign
id|inf-&gt;cmap_greyscale
suffix:semicolon
id|fbi-&gt;cmap_inverse
op_assign
id|inf-&gt;cmap_inverse
suffix:semicolon
id|fbi-&gt;cmap_static
op_assign
id|inf-&gt;cmap_static
suffix:semicolon
id|fbi-&gt;lccr0
op_assign
id|inf-&gt;lccr0
suffix:semicolon
id|fbi-&gt;lccr3
op_assign
id|inf-&gt;lccr3
suffix:semicolon
id|fbi-&gt;state
op_assign
id|C_DISABLE
suffix:semicolon
id|fbi-&gt;task_state
op_assign
(paren
id|u_char
)paren
op_minus
l_int|1
suffix:semicolon
id|fbi-&gt;fb.fix.smem_len
op_assign
id|fbi-&gt;max_xres
op_star
id|fbi-&gt;max_yres
op_star
id|fbi-&gt;max_bpp
op_div
l_int|8
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_wait
)paren
suffix:semicolon
id|INIT_TQUEUE
c_func
(paren
op_amp
id|fbi-&gt;task
comma
id|sa1100fb_task
comma
id|fbi
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|fbi-&gt;ctrlr_sem
)paren
suffix:semicolon
r_return
id|fbi
suffix:semicolon
)brace
DECL|function|sa1100fb_init
r_int
id|__init
id|sa1100fb_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sa1100fb_info
op_star
id|fbi
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
l_int|0xb0100000
comma
l_int|0x10000
comma
l_string|&quot;LCD&quot;
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|fbi
op_assign
id|sa1100fb_init_fbinfo
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbi
)paren
r_goto
id|failed
suffix:semicolon
multiline_comment|/* Initialize video memory */
id|ret
op_assign
id|sa1100fb_map_video_memory
c_func
(paren
id|fbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|failed
suffix:semicolon
id|ret
op_assign
id|request_irq
c_func
(paren
id|IRQ_LCD
comma
id|sa1100fb_handle_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;LCD&quot;
comma
id|fbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sa1100fb: request_irq failed: %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
macro_line|#ifdef ASSABET_PAL_VIDEO
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
id|ASSABET_BCR_clear
c_func
(paren
id|ASSABET_BCR_LCD_ON
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
macro_line|#error Please move this into sa1100fb_power_up_lcd
r_if
c_cond
(paren
id|machine_is_freebird
c_func
(paren
)paren
)paren
(brace
id|BCR_set
c_func
(paren
id|BCR_FREEBIRD_LCD_DISP
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|BCR_set
c_func
(paren
id|BCR_FREEBIRD_LCD_PWR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
macro_line|#endif
id|sa1100fb_set_var
c_func
(paren
op_amp
id|fbi-&gt;fb.var
comma
op_minus
l_int|1
comma
op_amp
id|fbi-&gt;fb
)paren
suffix:semicolon
id|ret
op_assign
id|register_framebuffer
c_func
(paren
op_amp
id|fbi-&gt;fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_goto
id|failed
suffix:semicolon
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n;&t; * Note that the console registers this as well, but we want to&n;&t; * power down the display prior to sleeping.&n;&t; */
id|fbi-&gt;pm
op_assign
id|pm_register
c_func
(paren
id|PM_SYS_DEV
comma
id|PM_SYS_VGA
comma
id|sa1100fb_pm_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fbi-&gt;pm
)paren
id|fbi-&gt;pm-&gt;data
op_assign
id|fbi
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_CPU_FREQ
id|fbi-&gt;clockchg.notifier_call
op_assign
id|sa1100fb_clkchg_notifier
suffix:semicolon
id|cpufreq_register_notifier
c_func
(paren
op_amp
id|fbi-&gt;clockchg
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Ok, now enable the LCD controller&n;&t; */
id|set_ctrlr_state
c_func
(paren
id|fbi
comma
id|C_ENABLE
)paren
suffix:semicolon
multiline_comment|/* This driver cannot be unloaded at the moment */
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
r_if
c_cond
(paren
id|fbi
)paren
id|kfree
c_func
(paren
id|fbi
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
l_int|0xb0100000
comma
l_int|0x10000
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sa1100fb_setup
r_int
id|__init
id|sa1100fb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
macro_line|#if 0
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;bpp:&quot;
comma
l_int|4
)paren
)paren
id|current_par.max_bpp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lccr0:&quot;
comma
l_int|6
)paren
)paren
id|lcd_shadow.lccr0
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lccr1:&quot;
comma
l_int|6
)paren
)paren
(brace
id|lcd_shadow.lccr1
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|current_par.max_xres
op_assign
(paren
id|lcd_shadow.lccr1
op_amp
l_int|0x3ff
)paren
op_plus
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lccr2:&quot;
comma
l_int|6
)paren
)paren
(brace
id|lcd_shadow.lccr2
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|current_par.max_yres
op_assign
(paren
id|lcd_shadow
dot
id|lccr0
op_amp
id|LCCR0_SDS
)paren
ques
c_cond
(paren
(paren
id|lcd_shadow
dot
id|lccr2
op_amp
l_int|0x3ff
)paren
op_plus
l_int|1
)paren
op_star
l_int|2
suffix:colon
(paren
(paren
id|lcd_shadow.lccr2
op_amp
l_int|0x3ff
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;lccr3:&quot;
comma
l_int|6
)paren
)paren
id|lcd_shadow.lccr3
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;StrongARM-1100/1110 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
