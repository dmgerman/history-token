multiline_comment|/*&n; * intelfb&n; *&n; * Linux framebuffer driver for Intel(R) 865G integrated graphics chips.&n; *&n; * Copyright &#xfffd; 2002, 2003 David Dawes &lt;dawes@xfree86.org&gt;&n; *                   2004 Sylvain Meyer&n; *&n; * This driver consists of two parts.  The first part (intelfbdrv.c) provides&n; * the basic fbdev interfaces, is derived in part from the radeonfb and&n; * vesafb drivers, and is covered by the GPL.  The second part (intelfbhw.c)&n; * provides the code to program the hardware.  Most of it is derived from&n; * the i810/i830 XFree86 driver.  The HW-specific code is covered here&n; * under a dual license (GPL and MIT/XFree86 license).&n; *&n; * Author: David Dawes&n; *&n; */
multiline_comment|/* $DHD: intelfb/intelfbhw.c,v 1.9 2003/06/27 15:06:25 dawes Exp $ */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;intelfb.h&quot;
macro_line|#include &quot;intelfbhw.h&quot;
r_int
DECL|function|intelfbhw_get_chipset
id|intelfbhw_get_chipset
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_char
op_star
op_star
id|name
comma
r_int
op_star
id|chipset
comma
r_int
op_star
id|mobile
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev
op_logical_or
op_logical_neg
id|name
op_logical_or
op_logical_neg
id|chipset
op_logical_or
op_logical_neg
id|mobile
)paren
r_return
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_INTEL_830M
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 830M&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_830M
suffix:semicolon
op_star
id|mobile
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|PCI_DEVICE_ID_INTEL_845G
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 845G&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_845G
suffix:semicolon
op_star
id|mobile
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|PCI_DEVICE_ID_INTEL_85XGM
suffix:colon
id|tmp
op_assign
l_int|0
suffix:semicolon
op_star
id|mobile
op_assign
l_int|1
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|INTEL_85X_CAPID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tmp
op_rshift
id|INTEL_85X_VARIANT_SHIFT
)paren
op_amp
id|INTEL_85X_VARIANT_MASK
)paren
(brace
r_case
id|INTEL_VAR_855GME
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 855GME&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_855GME
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_VAR_855GM
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 855GM&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_855GM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_VAR_852GME
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 852GME&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_852GME
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_VAR_852GM
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 852GM&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_852GM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 852GM/855GM&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_85XGM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_INTEL_865G
suffix:colon
op_star
id|name
op_assign
l_string|&quot;Intel(R) 865G&quot;
suffix:semicolon
op_star
id|chipset
op_assign
id|INTEL_865G
suffix:semicolon
op_star
id|mobile
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_int
DECL|function|intelfbhw_get_memory
id|intelfbhw_get_memory
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
op_star
id|aperture_size
comma
r_int
op_star
id|stolen_size
)paren
(brace
r_struct
id|pci_dev
op_star
id|bridge_dev
suffix:semicolon
id|u16
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev
op_logical_or
op_logical_neg
id|aperture_size
op_logical_or
op_logical_neg
id|stolen_size
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Find the bridge device.  It is always 0:0.0 */
r_if
c_cond
(paren
op_logical_neg
(paren
id|bridge_dev
op_assign
id|pci_find_slot
c_func
(paren
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
)paren
)paren
)paren
(brace
id|ERR_MSG
c_func
(paren
l_string|&quot;cannot find bridge device&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Get the fb aperture size and &quot;stolen&quot; memory amount. */
id|tmp
op_assign
l_int|0
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|bridge_dev
comma
id|INTEL_GMCH_CTRL
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_INTEL_830M
suffix:colon
r_case
id|PCI_DEVICE_ID_INTEL_845G
suffix:colon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
id|INTEL_GMCH_MEM_MASK
)paren
op_eq
id|INTEL_GMCH_MEM_64M
)paren
op_star
id|aperture_size
op_assign
id|MB
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_else
op_star
id|aperture_size
op_assign
id|MB
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tmp
op_amp
id|INTEL_830_GMCH_GMS_MASK
)paren
(brace
r_case
id|INTEL_830_GMCH_GMS_STOLEN_512
suffix:colon
op_star
id|stolen_size
op_assign
id|KB
c_func
(paren
l_int|512
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_830_GMCH_GMS_STOLEN_1024
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|1
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_830_GMCH_GMS_STOLEN_8192
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|8
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_830_GMCH_GMS_LOCAL
suffix:colon
id|ERR_MSG
c_func
(paren
l_string|&quot;only local memory found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|INTEL_830_GMCH_GMS_DISABLED
suffix:colon
id|ERR_MSG
c_func
(paren
l_string|&quot;video memory is disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
id|ERR_MSG
c_func
(paren
l_string|&quot;unexpected GMCH_GMS value: 0x%02x&bslash;n&quot;
comma
id|tmp
op_amp
id|INTEL_830_GMCH_GMS_MASK
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
op_star
id|aperture_size
op_assign
id|MB
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tmp
op_amp
id|INTEL_855_GMCH_GMS_MASK
)paren
(brace
r_case
id|INTEL_855_GMCH_GMS_STOLEN_1M
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|1
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_855_GMCH_GMS_STOLEN_4M
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|4
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_855_GMCH_GMS_STOLEN_8M
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|8
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_855_GMCH_GMS_STOLEN_16M
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|16
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_855_GMCH_GMS_STOLEN_32M
suffix:colon
op_star
id|stolen_size
op_assign
id|MB
c_func
(paren
l_int|32
)paren
op_minus
id|KB
c_func
(paren
l_int|132
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|INTEL_855_GMCH_GMS_DISABLED
suffix:colon
id|ERR_MSG
c_func
(paren
l_string|&quot;video memory is disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|ERR_MSG
c_func
(paren
l_string|&quot;unexpected GMCH_GMS value: 0x%02x&bslash;n&quot;
comma
id|tmp
op_amp
id|INTEL_855_GMCH_GMS_MASK
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_int
DECL|function|intelfbhw_check_non_crt
id|intelfbhw_check_non_crt
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
r_int
id|dvo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|LVDS
)paren
op_amp
id|PORT_ENABLE
)paren
id|dvo
op_or_assign
id|LVDS_PORT
suffix:semicolon
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|DVOA
)paren
op_amp
id|PORT_ENABLE
)paren
id|dvo
op_or_assign
id|DVOA_PORT
suffix:semicolon
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|DVOB
)paren
op_amp
id|PORT_ENABLE
)paren
id|dvo
op_or_assign
id|DVOB_PORT
suffix:semicolon
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|DVOC
)paren
op_amp
id|PORT_ENABLE
)paren
id|dvo
op_or_assign
id|DVOC_PORT
suffix:semicolon
r_return
id|dvo
suffix:semicolon
)brace
r_const
r_char
op_star
DECL|function|intelfbhw_dvo_to_string
id|intelfbhw_dvo_to_string
c_func
(paren
r_int
id|dvo
)paren
(brace
r_if
c_cond
(paren
id|dvo
op_amp
id|DVOA_PORT
)paren
r_return
l_string|&quot;DVO port A&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dvo
op_amp
id|DVOB_PORT
)paren
r_return
l_string|&quot;DVO port B&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dvo
op_amp
id|DVOC_PORT
)paren
r_return
l_string|&quot;DVO port C&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dvo
op_amp
id|LVDS_PORT
)paren
r_return
l_string|&quot;LVDS port&quot;
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
r_int
DECL|function|intelfbhw_validate_mode
id|intelfbhw_validate_mode
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|bytes_per_pixel
suffix:semicolon
r_int
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_validate_mode&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|bytes_per_pixel
op_assign
id|var-&gt;bits_per_pixel
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|bytes_per_pixel
op_eq
l_int|3
)paren
id|bytes_per_pixel
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Check if enough video memory. */
id|tmp
op_assign
id|var-&gt;yres_virtual
op_star
id|var-&gt;xres_virtual
op_star
id|bytes_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OG
id|dinfo-&gt;fb.size
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Not enough video ram for mode &quot;
l_string|&quot;(%d KByte vs %d KByte).&bslash;n&quot;
comma
id|BtoKB
c_func
(paren
id|tmp
)paren
comma
id|BtoKB
c_func
(paren
id|dinfo-&gt;fb.size
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Check if x/y limits are OK. */
r_if
c_cond
(paren
id|var-&gt;xres
op_minus
l_int|1
OG
id|HACTIVE_MASK
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;X resolution too large (%d vs %d).&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|HACTIVE_MASK
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres
op_minus
l_int|1
OG
id|VACTIVE_MASK
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Y resolution too large (%d vs %d).&bslash;n&quot;
comma
id|var-&gt;yres
comma
id|VACTIVE_MASK
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Check for interlaced/doublescan modes. */
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Mode is interlaced.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Mode is double-scan.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Check if clock is OK. */
id|tmp
op_assign
l_int|1000000000
op_div
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
id|MIN_CLOCK
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Pixel clock is too low (%d MHz vs %d MHz).&bslash;n&quot;
comma
(paren
id|tmp
op_plus
l_int|500
)paren
op_div
l_int|1000
comma
id|MIN_CLOCK
op_div
l_int|1000
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp
OG
id|MAX_CLOCK
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;Pixel clock is too high (%d MHz vs %d MHz).&bslash;n&quot;
comma
(paren
id|tmp
op_plus
l_int|500
)paren
op_div
l_int|1000
comma
id|MAX_CLOCK
op_div
l_int|1000
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|intelfbhw_pan_display
id|intelfbhw_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|intelfb_info
op_star
id|dinfo
op_assign
id|GET_DINFO
c_func
(paren
id|info
)paren
suffix:semicolon
id|u32
id|offset
comma
id|xoffset
comma
id|yoffset
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_pan_display&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|xoffset
op_assign
id|ROUND_DOWN_TO
c_func
(paren
id|var-&gt;xoffset
comma
l_int|8
)paren
suffix:semicolon
id|yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|xoffset
op_plus
id|var-&gt;xres
OG
id|var-&gt;xres_virtual
)paren
op_logical_or
(paren
id|yoffset
op_plus
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|offset
op_assign
(paren
id|yoffset
op_star
id|dinfo-&gt;pitch
)paren
op_plus
(paren
id|xoffset
op_star
id|var-&gt;bits_per_pixel
)paren
op_div
l_int|8
suffix:semicolon
id|offset
op_add_assign
id|dinfo-&gt;fb.offset
op_lshift
l_int|12
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPABASE
comma
id|offset
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Blank the screen. */
r_void
DECL|function|intelfbhw_do_blank
id|intelfbhw_do_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|intelfb_info
op_star
id|dinfo
op_assign
id|GET_DINFO
c_func
(paren
id|info
)paren
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_do_blank: blank is %d&bslash;n&quot;
comma
id|blank
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Turn plane A on or off */
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPACNTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
)paren
id|tmp
op_and_assign
op_complement
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
r_else
id|tmp
op_or_assign
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Flush */
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPABASE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPABASE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Turn off/on the HW cursor */
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;cursor_on is %d&bslash;n&quot;
comma
id|dinfo-&gt;cursor_on
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dinfo-&gt;cursor_on
)paren
(brace
r_if
c_cond
(paren
id|blank
)paren
(brace
id|intelfbhw_cursor_hide
c_func
(paren
id|dinfo
)paren
suffix:semicolon
)brace
r_else
(brace
id|intelfbhw_cursor_show
c_func
(paren
id|dinfo
)paren
suffix:semicolon
)brace
id|dinfo-&gt;cursor_on
op_assign
l_int|1
suffix:semicolon
)brace
id|dinfo-&gt;cursor_blanked
op_assign
id|blank
suffix:semicolon
multiline_comment|/* Set DPMS level */
id|tmp
op_assign
id|INREG
c_func
(paren
id|ADPA
)paren
op_amp
op_complement
id|ADPA_DPMS_CONTROL_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
id|FB_BLANK_UNBLANK
suffix:colon
r_case
id|FB_BLANK_NORMAL
suffix:colon
id|tmp
op_or_assign
id|ADPA_DPMS_D0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_VSYNC_SUSPEND
suffix:colon
id|tmp
op_or_assign
id|ADPA_DPMS_D1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_HSYNC_SUSPEND
suffix:colon
id|tmp
op_or_assign
id|ADPA_DPMS_D2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_BLANK_POWERDOWN
suffix:colon
id|tmp
op_or_assign
id|ADPA_DPMS_D3
suffix:semicolon
r_break
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|ADPA
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|intelfbhw_setcolreg
id|intelfbhw_setcolreg
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_setcolreg: %d: (%d, %d, %d)&bslash;n&quot;
comma
id|regno
comma
id|red
comma
id|green
comma
id|blue
)paren
suffix:semicolon
macro_line|#endif
id|u32
id|palette_reg
op_assign
(paren
id|dinfo-&gt;pipe
op_eq
id|PIPE_A
)paren
ques
c_cond
id|PALETTE_A
suffix:colon
id|PALETTE_B
suffix:semicolon
id|OUTREG
c_func
(paren
id|palette_reg
op_plus
(paren
id|regno
op_lshift
l_int|2
)paren
comma
(paren
id|red
op_lshift
id|PALETTE_8_RED_SHIFT
)paren
op_or
(paren
id|green
op_lshift
id|PALETTE_8_GREEN_SHIFT
)paren
op_or
(paren
id|blue
op_lshift
id|PALETTE_8_BLUE_SHIFT
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|intelfbhw_read_hw_state
id|intelfbhw_read_hw_state
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_struct
id|intelfb_hwstate
op_star
id|hw
comma
r_int
id|flag
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_read_hw_state&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|hw
op_logical_or
op_logical_neg
id|dinfo
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Read in as much of the HW state as possible. */
id|hw-&gt;vga0_divisor
op_assign
id|INREG
c_func
(paren
id|VGA0_DIVISOR
)paren
suffix:semicolon
id|hw-&gt;vga1_divisor
op_assign
id|INREG
c_func
(paren
id|VGA1_DIVISOR
)paren
suffix:semicolon
id|hw-&gt;vga_pd
op_assign
id|INREG
c_func
(paren
id|VGAPD
)paren
suffix:semicolon
id|hw-&gt;dpll_a
op_assign
id|INREG
c_func
(paren
id|DPLL_A
)paren
suffix:semicolon
id|hw-&gt;dpll_b
op_assign
id|INREG
c_func
(paren
id|DPLL_B
)paren
suffix:semicolon
id|hw-&gt;fpa0
op_assign
id|INREG
c_func
(paren
id|FPA0
)paren
suffix:semicolon
id|hw-&gt;fpa1
op_assign
id|INREG
c_func
(paren
id|FPA1
)paren
suffix:semicolon
id|hw-&gt;fpb0
op_assign
id|INREG
c_func
(paren
id|FPB0
)paren
suffix:semicolon
id|hw-&gt;fpb1
op_assign
id|INREG
c_func
(paren
id|FPB1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|1
)paren
r_return
id|flag
suffix:semicolon
macro_line|#if 0
multiline_comment|/* This seems to be a problem with the 852GM/855GM */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PALETTE_8_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;palette_a
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|PALETTE_A
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|hw-&gt;palette_b
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|PALETTE_B
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|flag
op_eq
l_int|2
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;htotal_a
op_assign
id|INREG
c_func
(paren
id|HTOTAL_A
)paren
suffix:semicolon
id|hw-&gt;hblank_a
op_assign
id|INREG
c_func
(paren
id|HBLANK_A
)paren
suffix:semicolon
id|hw-&gt;hsync_a
op_assign
id|INREG
c_func
(paren
id|HSYNC_A
)paren
suffix:semicolon
id|hw-&gt;vtotal_a
op_assign
id|INREG
c_func
(paren
id|VTOTAL_A
)paren
suffix:semicolon
id|hw-&gt;vblank_a
op_assign
id|INREG
c_func
(paren
id|VBLANK_A
)paren
suffix:semicolon
id|hw-&gt;vsync_a
op_assign
id|INREG
c_func
(paren
id|VSYNC_A
)paren
suffix:semicolon
id|hw-&gt;src_size_a
op_assign
id|INREG
c_func
(paren
id|SRC_SIZE_A
)paren
suffix:semicolon
id|hw-&gt;bclrpat_a
op_assign
id|INREG
c_func
(paren
id|BCLRPAT_A
)paren
suffix:semicolon
id|hw-&gt;htotal_b
op_assign
id|INREG
c_func
(paren
id|HTOTAL_B
)paren
suffix:semicolon
id|hw-&gt;hblank_b
op_assign
id|INREG
c_func
(paren
id|HBLANK_B
)paren
suffix:semicolon
id|hw-&gt;hsync_b
op_assign
id|INREG
c_func
(paren
id|HSYNC_B
)paren
suffix:semicolon
id|hw-&gt;vtotal_b
op_assign
id|INREG
c_func
(paren
id|VTOTAL_B
)paren
suffix:semicolon
id|hw-&gt;vblank_b
op_assign
id|INREG
c_func
(paren
id|VBLANK_B
)paren
suffix:semicolon
id|hw-&gt;vsync_b
op_assign
id|INREG
c_func
(paren
id|VSYNC_B
)paren
suffix:semicolon
id|hw-&gt;src_size_b
op_assign
id|INREG
c_func
(paren
id|SRC_SIZE_B
)paren
suffix:semicolon
id|hw-&gt;bclrpat_b
op_assign
id|INREG
c_func
(paren
id|BCLRPAT_B
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|3
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;adpa
op_assign
id|INREG
c_func
(paren
id|ADPA
)paren
suffix:semicolon
id|hw-&gt;dvoa
op_assign
id|INREG
c_func
(paren
id|DVOA
)paren
suffix:semicolon
id|hw-&gt;dvob
op_assign
id|INREG
c_func
(paren
id|DVOB
)paren
suffix:semicolon
id|hw-&gt;dvoc
op_assign
id|INREG
c_func
(paren
id|DVOC
)paren
suffix:semicolon
id|hw-&gt;dvoa_srcdim
op_assign
id|INREG
c_func
(paren
id|DVOA_SRCDIM
)paren
suffix:semicolon
id|hw-&gt;dvob_srcdim
op_assign
id|INREG
c_func
(paren
id|DVOB_SRCDIM
)paren
suffix:semicolon
id|hw-&gt;dvoc_srcdim
op_assign
id|INREG
c_func
(paren
id|DVOC_SRCDIM
)paren
suffix:semicolon
id|hw-&gt;lvds
op_assign
id|INREG
c_func
(paren
id|LVDS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|4
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;pipe_a_conf
op_assign
id|INREG
c_func
(paren
id|PIPEACONF
)paren
suffix:semicolon
id|hw-&gt;pipe_b_conf
op_assign
id|INREG
c_func
(paren
id|PIPEBCONF
)paren
suffix:semicolon
id|hw-&gt;disp_arb
op_assign
id|INREG
c_func
(paren
id|DISPARB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|5
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;cursor_a_control
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_CONTROL
)paren
suffix:semicolon
id|hw-&gt;cursor_b_control
op_assign
id|INREG
c_func
(paren
id|CURSOR_B_CONTROL
)paren
suffix:semicolon
id|hw-&gt;cursor_a_base
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_BASEADDR
)paren
suffix:semicolon
id|hw-&gt;cursor_b_base
op_assign
id|INREG
c_func
(paren
id|CURSOR_B_BASEADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|6
)paren
r_return
id|flag
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;cursor_a_palette
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_PALETTE0
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|hw-&gt;cursor_b_palette
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|CURSOR_B_PALETTE0
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag
op_eq
l_int|7
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;cursor_size
op_assign
id|INREG
c_func
(paren
id|CURSOR_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|8
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;disp_a_ctrl
op_assign
id|INREG
c_func
(paren
id|DSPACNTR
)paren
suffix:semicolon
id|hw-&gt;disp_b_ctrl
op_assign
id|INREG
c_func
(paren
id|DSPBCNTR
)paren
suffix:semicolon
id|hw-&gt;disp_a_base
op_assign
id|INREG
c_func
(paren
id|DSPABASE
)paren
suffix:semicolon
id|hw-&gt;disp_b_base
op_assign
id|INREG
c_func
(paren
id|DSPBBASE
)paren
suffix:semicolon
id|hw-&gt;disp_a_stride
op_assign
id|INREG
c_func
(paren
id|DSPASTRIDE
)paren
suffix:semicolon
id|hw-&gt;disp_b_stride
op_assign
id|INREG
c_func
(paren
id|DSPBSTRIDE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|9
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;vgacntrl
op_assign
id|INREG
c_func
(paren
id|VGACNTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|10
)paren
r_return
id|flag
suffix:semicolon
id|hw-&gt;add_id
op_assign
id|INREG
c_func
(paren
id|ADD_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_eq
l_int|11
)paren
r_return
id|flag
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;swf0x
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|SWF00
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|hw-&gt;swf1x
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|SWF10
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|3
)paren
id|hw-&gt;swf3x
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|SWF30
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|hw-&gt;fence
(braket
id|i
)braket
op_assign
id|INREG
c_func
(paren
id|FENCE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|hw-&gt;instpm
op_assign
id|INREG
c_func
(paren
id|INSTPM
)paren
suffix:semicolon
id|hw-&gt;mem_mode
op_assign
id|INREG
c_func
(paren
id|MEM_MODE
)paren
suffix:semicolon
id|hw-&gt;fw_blc_0
op_assign
id|INREG
c_func
(paren
id|FW_BLC_0
)paren
suffix:semicolon
id|hw-&gt;fw_blc_1
op_assign
id|INREG
c_func
(paren
id|FW_BLC_1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|intelfbhw_print_hw_state
id|intelfbhw_print_hw_state
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_struct
id|intelfb_hwstate
op_star
id|hw
)paren
(brace
macro_line|#if REGDUMP
r_int
id|i
comma
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_print_hw_state&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hw
op_logical_or
op_logical_neg
id|dinfo
)paren
r_return
suffix:semicolon
multiline_comment|/* Read in as much of the HW state as possible. */
id|printk
c_func
(paren
l_string|&quot;hw state dump start&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA0_DIVISOR:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vga0_divisor
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA1_DIVISOR:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vga1_divisor
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGAPD: &t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vga_pd
)paren
suffix:semicolon
id|n
op_assign
(paren
id|hw-&gt;vga0_divisor
op_rshift
id|FP_N_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m1
op_assign
(paren
id|hw-&gt;vga0_divisor
op_rshift
id|FP_M1_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m2
op_assign
(paren
id|hw-&gt;vga0_divisor
op_rshift
id|FP_M2_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;vga_pd
op_amp
id|VGAPD_0_P1_FORCE_DIV2
)paren
id|p1
op_assign
l_int|0
suffix:semicolon
r_else
id|p1
op_assign
(paren
id|hw-&gt;vga_pd
op_rshift
id|VGAPD_0_P1_SHIFT
)paren
op_amp
id|DPLL_P1_MASK
suffix:semicolon
id|p2
op_assign
(paren
id|hw-&gt;vga_pd
op_rshift
id|VGAPD_0_P2_SHIFT
)paren
op_amp
id|DPLL_P2_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA0: (m1, m2, n, p1, p2) = (%d, %d, %d, %d, %d)&bslash;n&quot;
comma
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA0: clock is %d&bslash;n&quot;
comma
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
)paren
suffix:semicolon
id|n
op_assign
(paren
id|hw-&gt;vga1_divisor
op_rshift
id|FP_N_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m1
op_assign
(paren
id|hw-&gt;vga1_divisor
op_rshift
id|FP_M1_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m2
op_assign
(paren
id|hw-&gt;vga1_divisor
op_rshift
id|FP_M2_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;vga_pd
op_amp
id|VGAPD_1_P1_FORCE_DIV2
)paren
id|p1
op_assign
l_int|0
suffix:semicolon
r_else
id|p1
op_assign
(paren
id|hw-&gt;vga_pd
op_rshift
id|VGAPD_1_P1_SHIFT
)paren
op_amp
id|DPLL_P1_MASK
suffix:semicolon
id|p2
op_assign
(paren
id|hw-&gt;vga_pd
op_rshift
id|VGAPD_1_P2_SHIFT
)paren
op_amp
id|DPLL_P2_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA1: (m1, m2, n, p1, p2) = (%d, %d, %d, %d, %d)&bslash;n&quot;
comma
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGA1: clock is %d&bslash;n&quot;
comma
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DPLL_A:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dpll_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DPLL_B:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dpll_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FPA0:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fpa0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FPA1:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fpa1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FPB0:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fpb0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FPB1:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fpb1
)paren
suffix:semicolon
id|n
op_assign
(paren
id|hw-&gt;fpa0
op_rshift
id|FP_N_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m1
op_assign
(paren
id|hw-&gt;fpa0
op_rshift
id|FP_M1_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m2
op_assign
(paren
id|hw-&gt;fpa0
op_rshift
id|FP_M2_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;dpll_a
op_amp
id|DPLL_P1_FORCE_DIV2
)paren
id|p1
op_assign
l_int|0
suffix:semicolon
r_else
id|p1
op_assign
(paren
id|hw-&gt;dpll_a
op_rshift
id|DPLL_P1_SHIFT
)paren
op_amp
id|DPLL_P1_MASK
suffix:semicolon
id|p2
op_assign
(paren
id|hw-&gt;dpll_a
op_rshift
id|DPLL_P2_SHIFT
)paren
op_amp
id|DPLL_P2_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PLLA0: (m1, m2, n, p1, p2) = (%d, %d, %d, %d, %d)&bslash;n&quot;
comma
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PLLA0: clock is %d&bslash;n&quot;
comma
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
)paren
suffix:semicolon
id|n
op_assign
(paren
id|hw-&gt;fpa1
op_rshift
id|FP_N_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m1
op_assign
(paren
id|hw-&gt;fpa1
op_rshift
id|FP_M1_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
id|m2
op_assign
(paren
id|hw-&gt;fpa1
op_rshift
id|FP_M2_DIVISOR_SHIFT
)paren
op_amp
id|FP_DIVISOR_MASK
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;dpll_a
op_amp
id|DPLL_P1_FORCE_DIV2
)paren
id|p1
op_assign
l_int|0
suffix:semicolon
r_else
id|p1
op_assign
(paren
id|hw-&gt;dpll_a
op_rshift
id|DPLL_P1_SHIFT
)paren
op_amp
id|DPLL_P1_MASK
suffix:semicolon
id|p2
op_assign
(paren
id|hw-&gt;dpll_a
op_rshift
id|DPLL_P2_SHIFT
)paren
op_amp
id|DPLL_P2_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PLLA1: (m1, m2, n, p1, p2) = (%d, %d, %d, %d, %d)&bslash;n&quot;
comma
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PLLA1: clock is %d&bslash;n&quot;
comma
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
)paren
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;&t;PALETTE_A:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PALETTE_8_ENTRIES
)paren
id|printk
(paren
l_string|&quot;&t;%3d:&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;palette_a
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PALETTE_B:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PALETTE_8_ENTRIES
)paren
id|printk
(paren
l_string|&quot;&t;%3d:&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;palette_b
(braket
id|i
)braket
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;&t;HTOTAL_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;htotal_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;HBLANK_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;hblank_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;HSYNC_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;hsync_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VTOTAL_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vtotal_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VBLANK_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vblank_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VSYNC_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vsync_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;SRC_SIZE_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;src_size_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;BCLRPAT_A:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;bclrpat_a
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;HTOTAL_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;htotal_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;HBLANK_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;hblank_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;HSYNC_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;hsync_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VTOTAL_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vtotal_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VBLANK_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vblank_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VSYNC_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vsync_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;SRC_SIZE_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;src_size_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;BCLRPAT_B:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;bclrpat_b
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;ADPA:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;adpa
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOA:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvoa
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOB:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvob
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOC:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvoc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOA_SRCDIM:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvoa_srcdim
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOB_SRCDIM:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvob_srcdim
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DVOC_SRCDIM:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;dvoc_srcdim
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;LVDS:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;lvds
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PIPEACONF:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;pipe_a_conf
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;PIPEBCONF:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;pipe_b_conf
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DISPARB:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_arb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_A_CONTROL:&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;cursor_a_control
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_B_CONTROL:&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;cursor_b_control
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_A_BASEADDR:&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;cursor_a_base
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_B_BASEADDR:&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;cursor_b_base
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_A_PALETTE:&t;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;0x%08x&quot;
comma
id|hw-&gt;cursor_a_palette
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;, &quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_B_PALETTE:&t;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;0x%08x&quot;
comma
id|hw-&gt;cursor_b_palette
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;, &quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;CURSOR_SIZE:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;cursor_size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPACNTR:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_a_ctrl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPBCNTR:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_b_ctrl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPABASE:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_a_base
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPBBASE:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_b_base
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPASTRIDE:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_a_stride
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;DSPBSTRIDE:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;disp_b_stride
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;VGACNTRL:&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;vgacntrl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;ADD_ID:&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;add_id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&t;SWF0%d&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;swf0x
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&t;SWF1%d&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;swf1x
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&t;SWF3%d&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;swf3x
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;&t;FENCE%d&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|i
comma
id|hw-&gt;fence
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;INSTPM&t;&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;instpm
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;MEM_MODE&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;mem_mode
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FW_BLC_0&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fw_blc_0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&t;FW_BLC_1&t;&t;0x%08x&bslash;n&quot;
comma
id|hw-&gt;fw_blc_1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;hw state dump end&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Split the M parameter into M1 and M2. */
r_static
r_int
DECL|function|splitm
id|splitm
c_func
(paren
r_int
r_int
id|m
comma
r_int
r_int
op_star
id|retm1
comma
r_int
r_int
op_star
id|retm2
)paren
(brace
r_int
id|m1
comma
id|m2
suffix:semicolon
id|m1
op_assign
(paren
id|m
op_minus
l_int|2
op_minus
(paren
id|MIN_M2
op_plus
id|MAX_M2
)paren
op_div
l_int|2
)paren
op_div
l_int|5
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|m1
OL
id|MIN_M1
)paren
id|m1
op_assign
id|MIN_M1
suffix:semicolon
r_if
c_cond
(paren
id|m1
OG
id|MAX_M1
)paren
id|m1
op_assign
id|MAX_M1
suffix:semicolon
id|m2
op_assign
id|m
op_minus
l_int|5
op_star
(paren
id|m1
op_plus
l_int|2
)paren
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|m2
template_param
id|MAX_M2
op_logical_or
id|m2
op_ge
id|m1
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
op_star
id|retm1
op_assign
(paren
r_int
r_int
)paren
id|m1
suffix:semicolon
op_star
id|retm2
op_assign
(paren
r_int
r_int
)paren
id|m2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Split the P parameter into P1 and P2. */
r_static
r_int
DECL|function|splitp
id|splitp
c_func
(paren
r_int
r_int
id|p
comma
r_int
r_int
op_star
id|retp1
comma
r_int
r_int
op_star
id|retp2
)paren
(brace
r_int
id|p1
comma
id|p2
suffix:semicolon
r_if
c_cond
(paren
id|p
op_mod
l_int|4
op_eq
l_int|0
)paren
id|p2
op_assign
l_int|1
suffix:semicolon
r_else
id|p2
op_assign
l_int|0
suffix:semicolon
id|p1
op_assign
(paren
id|p
op_div
(paren
l_int|1
op_lshift
(paren
id|p2
op_plus
l_int|1
)paren
)paren
)paren
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|p
op_mod
l_int|4
op_eq
l_int|0
op_logical_and
id|p1
OL
id|MIN_P1
)paren
(brace
id|p2
op_assign
l_int|0
suffix:semicolon
id|p1
op_assign
(paren
id|p
op_div
(paren
l_int|1
op_lshift
(paren
id|p2
op_plus
l_int|1
)paren
)paren
)paren
op_minus
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p1
template_param
id|MAX_P1
op_logical_or
(paren
id|p1
op_plus
l_int|2
)paren
op_star
(paren
l_int|1
op_lshift
(paren
id|p2
op_plus
l_int|1
)paren
)paren
op_ne
id|p
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
op_star
id|retp1
op_assign
(paren
r_int
r_int
)paren
id|p1
suffix:semicolon
op_star
id|retp2
op_assign
(paren
r_int
r_int
)paren
id|p2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|calc_pll_params
id|calc_pll_params
c_func
(paren
r_int
id|clock
comma
id|u32
op_star
id|retm1
comma
id|u32
op_star
id|retm2
comma
id|u32
op_star
id|retn
comma
id|u32
op_star
id|retp1
comma
id|u32
op_star
id|retp2
comma
id|u32
op_star
id|retclock
)paren
(brace
id|u32
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
comma
id|n1
suffix:semicolon
id|u32
id|f_vco
comma
id|p
comma
id|p_best
op_assign
l_int|0
comma
id|m
comma
id|f_out
suffix:semicolon
id|u32
id|err_max
comma
id|err_target
comma
id|err_best
op_assign
l_int|10000000
suffix:semicolon
id|u32
id|n_best
op_assign
l_int|0
comma
id|m_best
op_assign
l_int|0
comma
id|f_best
comma
id|f_err
suffix:semicolon
id|u32
id|p_min
comma
id|p_max
comma
id|p_inc
comma
id|div_min
comma
id|div_max
suffix:semicolon
multiline_comment|/* Accept 0.5% difference, but aim for 0.1% */
id|err_max
op_assign
l_int|5
op_star
id|clock
op_div
l_int|1000
suffix:semicolon
id|err_target
op_assign
id|clock
op_div
l_int|1000
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;Clock is %d&bslash;n&quot;
comma
id|clock
)paren
suffix:semicolon
id|div_max
op_assign
id|MAX_VCO_FREQ
op_div
id|clock
suffix:semicolon
id|div_min
op_assign
id|ROUND_UP_TO
c_func
(paren
id|MIN_VCO_FREQ
comma
id|clock
)paren
op_div
id|clock
suffix:semicolon
r_if
c_cond
(paren
id|clock
op_le
id|P_TRANSITION_CLOCK
)paren
id|p_inc
op_assign
l_int|4
suffix:semicolon
r_else
id|p_inc
op_assign
l_int|2
suffix:semicolon
id|p_min
op_assign
id|ROUND_UP_TO
c_func
(paren
id|div_min
comma
id|p_inc
)paren
suffix:semicolon
id|p_max
op_assign
id|ROUND_DOWN_TO
c_func
(paren
id|div_max
comma
id|p_inc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p_min
OL
id|MIN_P
)paren
id|p_min
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|p_max
OG
id|MAX_P
)paren
id|p_max
op_assign
l_int|128
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;p range is %d-%d (%d)&bslash;n&quot;
comma
id|p_min
comma
id|p_max
comma
id|p_inc
)paren
suffix:semicolon
id|p
op_assign
id|p_min
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|splitp
c_func
(paren
id|p
comma
op_amp
id|p1
comma
op_amp
id|p2
)paren
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;cannot split p = %d&bslash;n&quot;
comma
id|p
)paren
suffix:semicolon
id|p
op_add_assign
id|p_inc
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|n
op_assign
id|MIN_N
suffix:semicolon
id|f_vco
op_assign
id|clock
op_star
id|p
suffix:semicolon
r_do
(brace
id|m
op_assign
id|ROUND_UP_TO
c_func
(paren
id|f_vco
op_star
id|n
comma
id|PLL_REFCLK
)paren
op_div
id|PLL_REFCLK
suffix:semicolon
r_if
c_cond
(paren
id|m
OL
id|MIN_M
)paren
id|m
op_assign
id|MIN_M
suffix:semicolon
r_if
c_cond
(paren
id|m
OG
id|MAX_M
)paren
id|m
op_assign
id|MAX_M
suffix:semicolon
id|f_out
op_assign
id|CALC_VCLOCK3
c_func
(paren
id|m
comma
id|n
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|splitm
c_func
(paren
id|m
comma
op_amp
id|m1
comma
op_amp
id|m2
)paren
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;cannot split m = %d&bslash;n&quot;
comma
id|m
)paren
suffix:semicolon
id|n
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clock
OG
id|f_out
)paren
id|f_err
op_assign
id|clock
op_minus
id|f_out
suffix:semicolon
r_else
id|f_err
op_assign
id|f_out
op_minus
id|clock
suffix:semicolon
r_if
c_cond
(paren
id|f_err
OL
id|err_best
)paren
(brace
id|m_best
op_assign
id|m
suffix:semicolon
id|n_best
op_assign
id|n
suffix:semicolon
id|p_best
op_assign
id|p
suffix:semicolon
id|f_best
op_assign
id|f_out
suffix:semicolon
id|err_best
op_assign
id|f_err
suffix:semicolon
)brace
id|n
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|n
op_le
id|MAX_N
)paren
op_logical_and
(paren
id|f_out
op_ge
id|clock
)paren
)paren
suffix:semicolon
id|p
op_add_assign
id|p_inc
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|p
op_le
id|p_max
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|m_best
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;cannot find parameters for clock %d&bslash;n&quot;
comma
id|clock
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|m
op_assign
id|m_best
suffix:semicolon
id|n
op_assign
id|n_best
suffix:semicolon
id|p
op_assign
id|p_best
suffix:semicolon
id|splitm
c_func
(paren
id|m
comma
op_amp
id|m1
comma
op_amp
id|m2
)paren
suffix:semicolon
id|splitp
c_func
(paren
id|p
comma
op_amp
id|p1
comma
op_amp
id|p2
)paren
suffix:semicolon
id|n1
op_assign
id|n
op_minus
l_int|2
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;m, n, p: %d (%d,%d), %d (%d), %d (%d,%d), &quot;
l_string|&quot;f: %d (%d), VCO: %d&bslash;n&quot;
comma
id|m
comma
id|m1
comma
id|m2
comma
id|n
comma
id|n1
comma
id|p
comma
id|p1
comma
id|p2
comma
id|CALC_VCLOCK3
c_func
(paren
id|m
comma
id|n
comma
id|p
)paren
comma
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n1
comma
id|p1
comma
id|p2
)paren
comma
id|CALC_VCLOCK3
c_func
(paren
id|m
comma
id|n
comma
id|p
)paren
op_star
id|p
)paren
suffix:semicolon
op_star
id|retm1
op_assign
id|m1
suffix:semicolon
op_star
id|retm2
op_assign
id|m2
suffix:semicolon
op_star
id|retn
op_assign
id|n1
suffix:semicolon
op_star
id|retp1
op_assign
id|p1
suffix:semicolon
op_star
id|retp2
op_assign
id|p2
suffix:semicolon
op_star
id|retclock
op_assign
id|CALC_VCLOCK
c_func
(paren
id|m1
comma
id|m2
comma
id|n1
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|__inline__
r_int
DECL|function|check_overflow
id|check_overflow
c_func
(paren
id|u32
id|value
comma
id|u32
id|limit
comma
r_const
r_char
op_star
id|description
)paren
(brace
r_if
c_cond
(paren
id|value
OG
id|limit
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;%s value %d exceeds limit %d&bslash;n&quot;
comma
id|description
comma
id|value
comma
id|limit
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* It is assumed that hw is filled in with the initial state information. */
r_int
DECL|function|intelfbhw_mode_to_hw
id|intelfbhw_mode_to_hw
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_struct
id|intelfb_hwstate
op_star
id|hw
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|pipe
op_assign
id|PIPE_A
suffix:semicolon
id|u32
op_star
id|dpll
comma
op_star
id|fp0
comma
op_star
id|fp1
suffix:semicolon
id|u32
id|m1
comma
id|m2
comma
id|n
comma
id|p1
comma
id|p2
comma
id|clock_target
comma
id|clock
suffix:semicolon
id|u32
id|hsync_start
comma
id|hsync_end
comma
id|hblank_start
comma
id|hblank_end
comma
id|htotal
comma
id|hactive
suffix:semicolon
id|u32
id|vsync_start
comma
id|vsync_end
comma
id|vblank_start
comma
id|vblank_end
comma
id|vtotal
comma
id|vactive
suffix:semicolon
id|u32
id|vsync_pol
comma
id|hsync_pol
suffix:semicolon
id|u32
op_star
id|vs
comma
op_star
id|vb
comma
op_star
id|vt
comma
op_star
id|hs
comma
op_star
id|hb
comma
op_star
id|ht
comma
op_star
id|ss
comma
op_star
id|pipe_conf
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_mode_to_hw&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Disable VGA */
id|hw-&gt;vgacntrl
op_or_assign
id|VGA_DISABLE
suffix:semicolon
multiline_comment|/* Check whether pipe A or pipe B is enabled. */
r_if
c_cond
(paren
id|hw-&gt;pipe_a_conf
op_amp
id|PIPECONF_ENABLE
)paren
id|pipe
op_assign
id|PIPE_A
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hw-&gt;pipe_b_conf
op_amp
id|PIPECONF_ENABLE
)paren
id|pipe
op_assign
id|PIPE_B
suffix:semicolon
multiline_comment|/* Set which pipe&squot;s registers will be set. */
r_if
c_cond
(paren
id|pipe
op_eq
id|PIPE_B
)paren
(brace
id|dpll
op_assign
op_amp
id|hw-&gt;dpll_b
suffix:semicolon
id|fp0
op_assign
op_amp
id|hw-&gt;fpb0
suffix:semicolon
id|fp1
op_assign
op_amp
id|hw-&gt;fpb1
suffix:semicolon
id|hs
op_assign
op_amp
id|hw-&gt;hsync_b
suffix:semicolon
id|hb
op_assign
op_amp
id|hw-&gt;hblank_b
suffix:semicolon
id|ht
op_assign
op_amp
id|hw-&gt;htotal_b
suffix:semicolon
id|vs
op_assign
op_amp
id|hw-&gt;vsync_b
suffix:semicolon
id|vb
op_assign
op_amp
id|hw-&gt;vblank_b
suffix:semicolon
id|vt
op_assign
op_amp
id|hw-&gt;vtotal_b
suffix:semicolon
id|ss
op_assign
op_amp
id|hw-&gt;src_size_b
suffix:semicolon
id|pipe_conf
op_assign
op_amp
id|hw-&gt;pipe_b_conf
suffix:semicolon
)brace
r_else
(brace
id|dpll
op_assign
op_amp
id|hw-&gt;dpll_a
suffix:semicolon
id|fp0
op_assign
op_amp
id|hw-&gt;fpa0
suffix:semicolon
id|fp1
op_assign
op_amp
id|hw-&gt;fpa1
suffix:semicolon
id|hs
op_assign
op_amp
id|hw-&gt;hsync_a
suffix:semicolon
id|hb
op_assign
op_amp
id|hw-&gt;hblank_a
suffix:semicolon
id|ht
op_assign
op_amp
id|hw-&gt;htotal_a
suffix:semicolon
id|vs
op_assign
op_amp
id|hw-&gt;vsync_a
suffix:semicolon
id|vb
op_assign
op_amp
id|hw-&gt;vblank_a
suffix:semicolon
id|vt
op_assign
op_amp
id|hw-&gt;vtotal_a
suffix:semicolon
id|ss
op_assign
op_amp
id|hw-&gt;src_size_a
suffix:semicolon
id|pipe_conf
op_assign
op_amp
id|hw-&gt;pipe_a_conf
suffix:semicolon
)brace
multiline_comment|/* Use ADPA register for sync control. */
id|hw-&gt;adpa
op_and_assign
op_complement
id|ADPA_USE_VGA_HVPOLARITY
suffix:semicolon
multiline_comment|/* sync polarity */
id|hsync_pol
op_assign
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
ques
c_cond
id|ADPA_SYNC_ACTIVE_HIGH
suffix:colon
id|ADPA_SYNC_ACTIVE_LOW
suffix:semicolon
id|vsync_pol
op_assign
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
ques
c_cond
id|ADPA_SYNC_ACTIVE_HIGH
suffix:colon
id|ADPA_SYNC_ACTIVE_LOW
suffix:semicolon
id|hw-&gt;adpa
op_and_assign
op_complement
(paren
(paren
id|ADPA_SYNC_ACTIVE_MASK
op_lshift
id|ADPA_VSYNC_ACTIVE_SHIFT
)paren
op_or
(paren
id|ADPA_SYNC_ACTIVE_MASK
op_lshift
id|ADPA_HSYNC_ACTIVE_SHIFT
)paren
)paren
suffix:semicolon
id|hw-&gt;adpa
op_or_assign
(paren
id|hsync_pol
op_lshift
id|ADPA_HSYNC_ACTIVE_SHIFT
)paren
op_or
(paren
id|vsync_pol
op_lshift
id|ADPA_VSYNC_ACTIVE_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Connect correct pipe to the analog port DAC */
id|hw-&gt;adpa
op_and_assign
op_complement
(paren
id|PIPE_MASK
op_lshift
id|ADPA_PIPE_SELECT_SHIFT
)paren
suffix:semicolon
id|hw-&gt;adpa
op_or_assign
(paren
id|pipe
op_lshift
id|ADPA_PIPE_SELECT_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Set DPMS state to D0 (on) */
id|hw-&gt;adpa
op_and_assign
op_complement
id|ADPA_DPMS_CONTROL_MASK
suffix:semicolon
id|hw-&gt;adpa
op_or_assign
id|ADPA_DPMS_D0
suffix:semicolon
id|hw-&gt;adpa
op_or_assign
id|ADPA_DAC_ENABLE
suffix:semicolon
op_star
id|dpll
op_or_assign
(paren
id|DPLL_VCO_ENABLE
op_or
id|DPLL_VGA_MODE_DISABLE
)paren
suffix:semicolon
op_star
id|dpll
op_and_assign
op_complement
(paren
id|DPLL_RATE_SELECT_MASK
op_or
id|DPLL_REFERENCE_SELECT_MASK
)paren
suffix:semicolon
op_star
id|dpll
op_or_assign
(paren
id|DPLL_REFERENCE_DEFAULT
op_or
id|DPLL_RATE_SELECT_FP0
)paren
suffix:semicolon
multiline_comment|/* Desired clock in kHz */
id|clock_target
op_assign
l_int|1000000000
op_div
id|var-&gt;pixclock
suffix:semicolon
r_if
c_cond
(paren
id|calc_pll_params
c_func
(paren
id|clock_target
comma
op_amp
id|m1
comma
op_amp
id|m2
comma
op_amp
id|n
comma
op_amp
id|p1
comma
op_amp
id|p2
comma
op_amp
id|clock
)paren
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;calc_pll_params failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Check for overflow. */
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|p1
comma
id|DPLL_P1_MASK
comma
l_string|&quot;PLL P1 parameter&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|p2
comma
id|DPLL_P2_MASK
comma
l_string|&quot;PLL P2 parameter&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|m1
comma
id|FP_DIVISOR_MASK
comma
l_string|&quot;PLL M1 parameter&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|m2
comma
id|FP_DIVISOR_MASK
comma
l_string|&quot;PLL M2 parameter&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|n
comma
id|FP_DIVISOR_MASK
comma
l_string|&quot;PLL N parameter&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|dpll
op_and_assign
op_complement
id|DPLL_P1_FORCE_DIV2
suffix:semicolon
op_star
id|dpll
op_and_assign
op_complement
(paren
(paren
id|DPLL_P2_MASK
op_lshift
id|DPLL_P2_SHIFT
)paren
op_or
(paren
id|DPLL_P1_MASK
op_lshift
id|DPLL_P1_SHIFT
)paren
)paren
suffix:semicolon
op_star
id|dpll
op_or_assign
(paren
id|p2
op_lshift
id|DPLL_P2_SHIFT
)paren
op_or
(paren
id|p1
op_lshift
id|DPLL_P1_SHIFT
)paren
suffix:semicolon
op_star
id|fp0
op_assign
(paren
id|n
op_lshift
id|FP_N_DIVISOR_SHIFT
)paren
op_or
(paren
id|m1
op_lshift
id|FP_M1_DIVISOR_SHIFT
)paren
op_or
(paren
id|m2
op_lshift
id|FP_M2_DIVISOR_SHIFT
)paren
suffix:semicolon
op_star
id|fp1
op_assign
op_star
id|fp0
suffix:semicolon
id|hw-&gt;dvob
op_and_assign
op_complement
id|PORT_ENABLE
suffix:semicolon
id|hw-&gt;dvoc
op_and_assign
op_complement
id|PORT_ENABLE
suffix:semicolon
multiline_comment|/* Use display plane A. */
id|hw-&gt;disp_a_ctrl
op_or_assign
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|hw-&gt;disp_a_ctrl
op_and_assign
op_complement
id|DISPPLANE_GAMMA_ENABLE
suffix:semicolon
id|hw-&gt;disp_a_ctrl
op_and_assign
op_complement
id|DISPPLANE_PIXFORMAT_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|intelfb_var_to_depth
c_func
(paren
id|var
)paren
)paren
(brace
r_case
l_int|8
suffix:colon
id|hw-&gt;disp_a_ctrl
op_or_assign
id|DISPPLANE_8BPP
op_or
id|DISPPLANE_GAMMA_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|hw-&gt;disp_a_ctrl
op_or_assign
id|DISPPLANE_15_16BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|hw-&gt;disp_a_ctrl
op_or_assign
id|DISPPLANE_16BPP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|hw-&gt;disp_a_ctrl
op_or_assign
id|DISPPLANE_32BPP_NO_ALPHA
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hw-&gt;disp_a_ctrl
op_and_assign
op_complement
(paren
id|PIPE_MASK
op_lshift
id|DISPPLANE_SEL_PIPE_SHIFT
)paren
suffix:semicolon
id|hw-&gt;disp_a_ctrl
op_or_assign
(paren
id|pipe
op_lshift
id|DISPPLANE_SEL_PIPE_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Set CRTC registers. */
id|hactive
op_assign
id|var-&gt;xres
suffix:semicolon
id|hsync_start
op_assign
id|hactive
op_plus
id|var-&gt;right_margin
suffix:semicolon
id|hsync_end
op_assign
id|hsync_start
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|htotal
op_assign
id|hsync_end
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|hblank_start
op_assign
id|hactive
suffix:semicolon
id|hblank_end
op_assign
id|htotal
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;H: act %d, ss %d, se %d, tot %d bs %d, be %d&bslash;n&quot;
comma
id|hactive
comma
id|hsync_start
comma
id|hsync_end
comma
id|htotal
comma
id|hblank_start
comma
id|hblank_end
)paren
suffix:semicolon
id|vactive
op_assign
id|var-&gt;yres
suffix:semicolon
id|vsync_start
op_assign
id|vactive
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|vsync_end
op_assign
id|vsync_start
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|vtotal
op_assign
id|vsync_end
op_plus
id|var-&gt;upper_margin
suffix:semicolon
id|vblank_start
op_assign
id|vactive
suffix:semicolon
id|vblank_end
op_assign
id|vtotal
suffix:semicolon
id|vblank_end
op_assign
id|vsync_end
op_plus
l_int|1
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;V: act %d, ss %d, se %d, tot %d bs %d, be %d&bslash;n&quot;
comma
id|vactive
comma
id|vsync_start
comma
id|vsync_end
comma
id|vtotal
comma
id|vblank_start
comma
id|vblank_end
)paren
suffix:semicolon
multiline_comment|/* Adjust for register values, and check for overflow. */
id|hactive
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|hactive
comma
id|HACTIVE_MASK
comma
l_string|&quot;CRTC hactive&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hsync_start
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|hsync_start
comma
id|HSYNCSTART_MASK
comma
l_string|&quot;CRTC hsync_start&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hsync_end
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|hsync_end
comma
id|HSYNCEND_MASK
comma
l_string|&quot;CRTC hsync_end&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|htotal
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|htotal
comma
id|HTOTAL_MASK
comma
l_string|&quot;CRTC htotal&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hblank_start
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|hblank_start
comma
id|HBLANKSTART_MASK
comma
l_string|&quot;CRTC hblank_start&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hblank_end
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|hblank_end
comma
id|HBLANKEND_MASK
comma
l_string|&quot;CRTC hblank_end&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vactive
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vactive
comma
id|VACTIVE_MASK
comma
l_string|&quot;CRTC vactive&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vsync_start
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vsync_start
comma
id|VSYNCSTART_MASK
comma
l_string|&quot;CRTC vsync_start&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vsync_end
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vsync_end
comma
id|VSYNCEND_MASK
comma
l_string|&quot;CRTC vsync_end&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vtotal
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vtotal
comma
id|VTOTAL_MASK
comma
l_string|&quot;CRTC vtotal&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vblank_start
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vblank_start
comma
id|VBLANKSTART_MASK
comma
l_string|&quot;CRTC vblank_start&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|vblank_end
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|check_overflow
c_func
(paren
id|vblank_end
comma
id|VBLANKEND_MASK
comma
l_string|&quot;CRTC vblank_end&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|ht
op_assign
(paren
id|htotal
op_lshift
id|HTOTAL_SHIFT
)paren
op_or
(paren
id|hactive
op_lshift
id|HACTIVE_SHIFT
)paren
suffix:semicolon
op_star
id|hb
op_assign
(paren
id|hblank_start
op_lshift
id|HBLANKSTART_SHIFT
)paren
op_or
(paren
id|hblank_end
op_lshift
id|HSYNCEND_SHIFT
)paren
suffix:semicolon
op_star
id|hs
op_assign
(paren
id|hsync_start
op_lshift
id|HSYNCSTART_SHIFT
)paren
op_or
(paren
id|hsync_end
op_lshift
id|HSYNCEND_SHIFT
)paren
suffix:semicolon
op_star
id|vt
op_assign
(paren
id|vtotal
op_lshift
id|VTOTAL_SHIFT
)paren
op_or
(paren
id|vactive
op_lshift
id|VACTIVE_SHIFT
)paren
suffix:semicolon
op_star
id|vb
op_assign
(paren
id|vblank_start
op_lshift
id|VBLANKSTART_SHIFT
)paren
op_or
(paren
id|vblank_end
op_lshift
id|VSYNCEND_SHIFT
)paren
suffix:semicolon
op_star
id|vs
op_assign
(paren
id|vsync_start
op_lshift
id|VSYNCSTART_SHIFT
)paren
op_or
(paren
id|vsync_end
op_lshift
id|VSYNCEND_SHIFT
)paren
suffix:semicolon
op_star
id|ss
op_assign
(paren
id|hactive
op_lshift
id|SRC_SIZE_HORIZ_SHIFT
)paren
op_or
(paren
id|vactive
op_lshift
id|SRC_SIZE_VERT_SHIFT
)paren
suffix:semicolon
id|hw-&gt;disp_a_stride
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
suffix:semicolon
id|DBG_MSG
c_func
(paren
l_string|&quot;pitch is %d&bslash;n&quot;
comma
id|hw-&gt;disp_a_stride
)paren
suffix:semicolon
id|hw-&gt;disp_a_base
op_assign
id|hw-&gt;disp_a_stride
op_star
id|var-&gt;yoffset
op_plus
id|var-&gt;xoffset
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
suffix:semicolon
id|hw-&gt;disp_a_base
op_add_assign
id|dinfo-&gt;fb.offset
op_lshift
l_int|12
suffix:semicolon
multiline_comment|/* Check stride alignment. */
r_if
c_cond
(paren
id|hw-&gt;disp_a_stride
op_mod
id|STRIDE_ALIGNMENT
op_ne
l_int|0
)paren
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;display stride %d has bad alignment %d&bslash;n&quot;
comma
id|hw-&gt;disp_a_stride
comma
id|STRIDE_ALIGNMENT
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set the palette to 8-bit mode. */
op_star
id|pipe_conf
op_and_assign
op_complement
id|PIPECONF_GAMMA
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Program a (non-VGA) video mode. */
r_int
DECL|function|intelfbhw_program_mode
id|intelfbhw_program_mode
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_const
r_struct
id|intelfb_hwstate
op_star
id|hw
comma
r_int
id|blank
)paren
(brace
r_int
id|pipe
op_assign
id|PIPE_A
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_const
id|u32
op_star
id|dpll
comma
op_star
id|fp0
comma
op_star
id|fp1
comma
op_star
id|pipe_conf
suffix:semicolon
r_const
id|u32
op_star
id|hs
comma
op_star
id|ht
comma
op_star
id|hb
comma
op_star
id|vs
comma
op_star
id|vt
comma
op_star
id|vb
comma
op_star
id|ss
suffix:semicolon
id|u32
id|dpll_reg
comma
id|fp0_reg
comma
id|fp1_reg
comma
id|pipe_conf_reg
suffix:semicolon
id|u32
id|hsync_reg
comma
id|htotal_reg
comma
id|hblank_reg
suffix:semicolon
id|u32
id|vsync_reg
comma
id|vtotal_reg
comma
id|vblank_reg
suffix:semicolon
id|u32
id|src_size_reg
suffix:semicolon
multiline_comment|/* Assume single pipe, display plane A, analog CRT. */
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_program_mode&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Disable VGA */
id|tmp
op_assign
id|INREG
c_func
(paren
id|VGACNTRL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|VGA_DISABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|VGACNTRL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Check whether pipe A or pipe B is enabled. */
r_if
c_cond
(paren
id|hw-&gt;pipe_a_conf
op_amp
id|PIPECONF_ENABLE
)paren
id|pipe
op_assign
id|PIPE_A
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hw-&gt;pipe_b_conf
op_amp
id|PIPECONF_ENABLE
)paren
id|pipe
op_assign
id|PIPE_B
suffix:semicolon
id|dinfo-&gt;pipe
op_assign
id|pipe
suffix:semicolon
r_if
c_cond
(paren
id|pipe
op_eq
id|PIPE_B
)paren
(brace
id|dpll
op_assign
op_amp
id|hw-&gt;dpll_b
suffix:semicolon
id|fp0
op_assign
op_amp
id|hw-&gt;fpb0
suffix:semicolon
id|fp1
op_assign
op_amp
id|hw-&gt;fpb1
suffix:semicolon
id|pipe_conf
op_assign
op_amp
id|hw-&gt;pipe_b_conf
suffix:semicolon
id|hs
op_assign
op_amp
id|hw-&gt;hsync_b
suffix:semicolon
id|hb
op_assign
op_amp
id|hw-&gt;hblank_b
suffix:semicolon
id|ht
op_assign
op_amp
id|hw-&gt;htotal_b
suffix:semicolon
id|vs
op_assign
op_amp
id|hw-&gt;vsync_b
suffix:semicolon
id|vb
op_assign
op_amp
id|hw-&gt;vblank_b
suffix:semicolon
id|vt
op_assign
op_amp
id|hw-&gt;vtotal_b
suffix:semicolon
id|ss
op_assign
op_amp
id|hw-&gt;src_size_b
suffix:semicolon
id|dpll_reg
op_assign
id|DPLL_B
suffix:semicolon
id|fp0_reg
op_assign
id|FPB0
suffix:semicolon
id|fp1_reg
op_assign
id|FPB1
suffix:semicolon
id|pipe_conf_reg
op_assign
id|PIPEBCONF
suffix:semicolon
id|hsync_reg
op_assign
id|HSYNC_B
suffix:semicolon
id|htotal_reg
op_assign
id|HTOTAL_B
suffix:semicolon
id|hblank_reg
op_assign
id|HBLANK_B
suffix:semicolon
id|vsync_reg
op_assign
id|VSYNC_B
suffix:semicolon
id|vtotal_reg
op_assign
id|VTOTAL_B
suffix:semicolon
id|vblank_reg
op_assign
id|VBLANK_B
suffix:semicolon
id|src_size_reg
op_assign
id|SRC_SIZE_B
suffix:semicolon
)brace
r_else
(brace
id|dpll
op_assign
op_amp
id|hw-&gt;dpll_a
suffix:semicolon
id|fp0
op_assign
op_amp
id|hw-&gt;fpa0
suffix:semicolon
id|fp1
op_assign
op_amp
id|hw-&gt;fpa1
suffix:semicolon
id|pipe_conf
op_assign
op_amp
id|hw-&gt;pipe_a_conf
suffix:semicolon
id|hs
op_assign
op_amp
id|hw-&gt;hsync_a
suffix:semicolon
id|hb
op_assign
op_amp
id|hw-&gt;hblank_a
suffix:semicolon
id|ht
op_assign
op_amp
id|hw-&gt;htotal_a
suffix:semicolon
id|vs
op_assign
op_amp
id|hw-&gt;vsync_a
suffix:semicolon
id|vb
op_assign
op_amp
id|hw-&gt;vblank_a
suffix:semicolon
id|vt
op_assign
op_amp
id|hw-&gt;vtotal_a
suffix:semicolon
id|ss
op_assign
op_amp
id|hw-&gt;src_size_a
suffix:semicolon
id|dpll_reg
op_assign
id|DPLL_A
suffix:semicolon
id|fp0_reg
op_assign
id|FPA0
suffix:semicolon
id|fp1_reg
op_assign
id|FPA1
suffix:semicolon
id|pipe_conf_reg
op_assign
id|PIPEACONF
suffix:semicolon
id|hsync_reg
op_assign
id|HSYNC_A
suffix:semicolon
id|htotal_reg
op_assign
id|HTOTAL_A
suffix:semicolon
id|hblank_reg
op_assign
id|HBLANK_A
suffix:semicolon
id|vsync_reg
op_assign
id|VSYNC_A
suffix:semicolon
id|vtotal_reg
op_assign
id|VTOTAL_A
suffix:semicolon
id|vblank_reg
op_assign
id|VBLANK_A
suffix:semicolon
id|src_size_reg
op_assign
id|SRC_SIZE_A
suffix:semicolon
)brace
multiline_comment|/* Disable planes A and B. */
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPACNTR
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPBCNTR
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPBCNTR
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Wait for vblank.  For now, just wait for a 50Hz cycle (20ms)) */
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Disable Sync */
id|tmp
op_assign
id|INREG
c_func
(paren
id|ADPA
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|ADPA_DPMS_CONTROL_MASK
suffix:semicolon
id|tmp
op_or_assign
id|ADPA_DPMS_D3
suffix:semicolon
id|OUTREG
c_func
(paren
id|ADPA
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* turn off pipe */
id|tmp
op_assign
id|INREG
c_func
(paren
id|pipe_conf_reg
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|PIPECONF_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|pipe_conf_reg
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* turn off PLL */
id|tmp
op_assign
id|INREG
c_func
(paren
id|dpll_reg
)paren
suffix:semicolon
id|dpll_reg
op_and_assign
op_complement
id|DPLL_VCO_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|dpll_reg
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set PLL parameters */
id|OUTREG
c_func
(paren
id|dpll_reg
comma
op_star
id|dpll
op_amp
op_complement
id|DPLL_VCO_ENABLE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|fp0_reg
comma
op_star
id|fp0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|fp1_reg
comma
op_star
id|fp1
)paren
suffix:semicolon
multiline_comment|/* Set pipe parameters */
id|OUTREG
c_func
(paren
id|hsync_reg
comma
op_star
id|hs
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|hblank_reg
comma
op_star
id|hb
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|htotal_reg
comma
op_star
id|ht
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|vsync_reg
comma
op_star
id|vs
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|vblank_reg
comma
op_star
id|vb
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|vtotal_reg
comma
op_star
id|vt
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|src_size_reg
comma
op_star
id|ss
)paren
suffix:semicolon
multiline_comment|/* Set DVOs B/C */
id|OUTREG
c_func
(paren
id|DVOB
comma
id|hw-&gt;dvob
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DVOC
comma
id|hw-&gt;dvoc
)paren
suffix:semicolon
multiline_comment|/* Set ADPA */
id|OUTREG
c_func
(paren
id|ADPA
comma
(paren
id|hw-&gt;adpa
op_amp
op_complement
(paren
id|ADPA_DPMS_CONTROL_MASK
)paren
)paren
op_or
id|ADPA_DPMS_D3
)paren
suffix:semicolon
multiline_comment|/* Enable PLL */
id|tmp
op_assign
id|INREG
c_func
(paren
id|dpll_reg
)paren
suffix:semicolon
id|tmp
op_or_assign
id|DPLL_VCO_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|dpll_reg
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Enable pipe */
id|OUTREG
c_func
(paren
id|pipe_conf_reg
comma
op_star
id|pipe_conf
op_or
id|PIPECONF_ENABLE
)paren
suffix:semicolon
multiline_comment|/* Enable sync */
id|tmp
op_assign
id|INREG
c_func
(paren
id|ADPA
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|ADPA_DPMS_CONTROL_MASK
suffix:semicolon
id|tmp
op_or_assign
id|ADPA_DPMS_D0
suffix:semicolon
id|OUTREG
c_func
(paren
id|ADPA
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* setup display plane */
r_if
c_cond
(paren
id|dinfo-&gt;pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_INTEL_830M
)paren
(brace
multiline_comment|/*&n;&t;&t; *      i830M errata: the display plane must be enabled&n;&t;&t; *      to allow writes to the other bits in the plane&n;&t;&t; *      control register.&n;&t;&t; */
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPACNTR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
id|DISPPLANE_PLANE_ENABLE
)paren
op_ne
id|DISPPLANE_PLANE_ENABLE
)paren
(brace
id|tmp
op_or_assign
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|hw-&gt;disp_a_ctrl
op_or
id|DISPPLANE_PLANE_ENABLE
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|hw-&gt;disp_a_ctrl
op_amp
op_complement
id|DISPPLANE_PLANE_ENABLE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPASTRIDE
comma
id|hw-&gt;disp_a_stride
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPABASE
comma
id|hw-&gt;disp_a_base
)paren
suffix:semicolon
multiline_comment|/* Enable plane */
r_if
c_cond
(paren
op_logical_neg
id|blank
)paren
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|DSPACNTR
)paren
suffix:semicolon
id|tmp
op_or_assign
id|DISPPLANE_PLANE_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPACNTR
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DSPABASE
comma
id|hw-&gt;disp_a_base
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* forward declarations */
r_static
r_void
id|refresh_ring
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
suffix:semicolon
r_static
r_void
id|reset_state
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
suffix:semicolon
r_static
r_void
id|do_flush
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
suffix:semicolon
r_static
r_int
DECL|function|wait_ring
id|wait_ring
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_int
id|n
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
id|u32
id|last_head
op_assign
id|INREG
c_func
(paren
id|PRI_RING_HEAD
)paren
op_amp
id|RING_HEAD_MASK
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;wait_ring: %d&bslash;n&quot;
comma
id|n
)paren
suffix:semicolon
macro_line|#endif
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dinfo-&gt;ring_space
OL
id|n
)paren
(brace
id|dinfo-&gt;ring_head
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
(paren
id|INREG
c_func
(paren
id|PRI_RING_HEAD
)paren
op_amp
id|RING_HEAD_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
OL
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
)paren
id|dinfo-&gt;ring_space
op_assign
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
op_minus
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
)paren
suffix:semicolon
r_else
id|dinfo-&gt;ring_space
op_assign
(paren
id|dinfo-&gt;ring.size
op_plus
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
)paren
op_minus
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
op_ne
id|last_head
)paren
(brace
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|last_head
op_assign
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|end
comma
id|jiffies
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
multiline_comment|/* Try again */
id|reset_state
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|refresh_ring
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|do_flush
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|end
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|WRN_MSG
c_func
(paren
l_string|&quot;ring buffer : space: %d wanted %d&bslash;n&quot;
comma
id|dinfo-&gt;ring_space
comma
id|n
)paren
suffix:semicolon
id|WRN_MSG
c_func
(paren
l_string|&quot;lockup - turning off hardware &quot;
l_string|&quot;acceleration&bslash;n&quot;
)paren
suffix:semicolon
id|dinfo-&gt;ring_lockup
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
r_static
r_void
DECL|function|do_flush
id|do_flush
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
id|START_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|MI_FLUSH
op_or
id|MI_WRITE_DIRTY_STATE
op_or
id|MI_INVALIDATE_MAP_CACHE
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|MI_NOOP
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|intelfbhw_do_sync
id|intelfbhw_do_sync
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_do_sync&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;accel
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * Send a flush, then wait until the ring is empty.  This is what&n;&t; * the XFree86 driver does, and actually it doesn&squot;t seem a lot worse&n;&t; * than the recommended method (both have problems).&n;&t; */
id|do_flush
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|wait_ring
c_func
(paren
id|dinfo
comma
id|dinfo-&gt;ring.size
op_minus
id|RING_MIN_FREE
)paren
suffix:semicolon
id|dinfo-&gt;ring_space
op_assign
id|dinfo-&gt;ring.size
op_minus
id|RING_MIN_FREE
suffix:semicolon
)brace
r_static
r_void
DECL|function|refresh_ring
id|refresh_ring
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;refresh_ring&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dinfo-&gt;ring_head
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
(paren
id|INREG
c_func
(paren
id|PRI_RING_HEAD
)paren
op_amp
id|RING_HEAD_MASK
)paren
suffix:semicolon
id|dinfo-&gt;ring_tail
op_assign
id|INREG
c_func
(paren
id|PRI_RING_TAIL
)paren
op_amp
id|RING_TAIL_MASK
suffix:semicolon
r_if
c_cond
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
OL
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
)paren
id|dinfo-&gt;ring_space
op_assign
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
op_minus
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
)paren
suffix:semicolon
r_else
id|dinfo-&gt;ring_space
op_assign
(paren
id|dinfo-&gt;ring.size
op_plus
(paren
id|u32
id|__iomem
)paren
id|dinfo-&gt;ring_head
)paren
op_minus
(paren
id|dinfo-&gt;ring_tail
op_plus
id|RING_MIN_FREE
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|reset_state
id|reset_state
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;reset_state&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FENCE_NUM
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|FENCE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Flush the ring buffer if it&squot;s enabled. */
id|tmp
op_assign
id|INREG
c_func
(paren
id|PRI_RING_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RING_ENABLE
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;reset_state: ring was enabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|refresh_ring
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|intelfbhw_do_sync
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|DO_RING_IDLE
c_func
(paren
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|PRI_RING_LENGTH
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_HEAD
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_TAIL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_START
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Stop the 2D engine, and turn off the ring buffer. */
r_void
DECL|function|intelfbhw_2d_stop
id|intelfbhw_2d_stop
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_2d_stop: accel: %d, ring_active: %d&bslash;n&quot;
comma
id|dinfo-&gt;accel
comma
id|dinfo-&gt;ring_active
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;accel
)paren
r_return
suffix:semicolon
id|dinfo-&gt;ring_active
op_assign
l_int|0
suffix:semicolon
id|reset_state
c_func
(paren
id|dinfo
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enable the ring buffer, and initialise the 2D engine.&n; * It is assumed that the graphics engine has been stopped by previously&n; * calling intelfb_2d_stop().&n; */
r_void
DECL|function|intelfbhw_2d_start
id|intelfbhw_2d_start
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_2d_start: accel: %d, ring_active: %d&bslash;n&quot;
comma
id|dinfo-&gt;accel
comma
id|dinfo-&gt;ring_active
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;accel
)paren
r_return
suffix:semicolon
multiline_comment|/* Initialise the primary ring buffer. */
id|OUTREG
c_func
(paren
id|PRI_RING_LENGTH
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_TAIL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_HEAD
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_START
comma
id|dinfo-&gt;ring.physical
op_amp
id|RING_START_MASK
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PRI_RING_LENGTH
comma
(paren
(paren
id|dinfo-&gt;ring.size
op_minus
id|GTT_PAGE_SIZE
)paren
op_amp
id|RING_LENGTH_MASK
)paren
op_or
id|RING_NO_REPORT
op_or
id|RING_ENABLE
)paren
suffix:semicolon
id|refresh_ring
c_func
(paren
id|dinfo
)paren
suffix:semicolon
id|dinfo-&gt;ring_active
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* 2D fillrect (solid fill or invert) */
r_void
DECL|function|intelfbhw_do_fillrect
id|intelfbhw_do_fillrect
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
id|u32
id|x
comma
id|u32
id|y
comma
id|u32
id|w
comma
id|u32
id|h
comma
id|u32
id|color
comma
id|u32
id|pitch
comma
id|u32
id|bpp
comma
id|u32
id|rop
)paren
(brace
id|u32
id|br00
comma
id|br09
comma
id|br13
comma
id|br14
comma
id|br16
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_do_fillrect: (%d,%d) %dx%d, c 0x%06x, p %d bpp %d, &quot;
l_string|&quot;rop 0x%02x&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|color
comma
id|pitch
comma
id|bpp
comma
id|rop
)paren
suffix:semicolon
macro_line|#endif
id|br00
op_assign
id|COLOR_BLT_CMD
suffix:semicolon
id|br09
op_assign
id|dinfo-&gt;fb_start
op_plus
(paren
id|y
op_star
id|pitch
op_plus
id|x
op_star
(paren
id|bpp
op_div
l_int|8
)paren
)paren
suffix:semicolon
id|br13
op_assign
(paren
id|rop
op_lshift
id|ROP_SHIFT
)paren
op_or
id|pitch
suffix:semicolon
id|br14
op_assign
(paren
id|h
op_lshift
id|HEIGHT_SHIFT
)paren
op_or
(paren
(paren
id|w
op_star
(paren
id|bpp
op_div
l_int|8
)paren
)paren
op_lshift
id|WIDTH_SHIFT
)paren
suffix:semicolon
id|br16
op_assign
id|color
suffix:semicolon
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_32
suffix:semicolon
id|br00
op_or_assign
id|WRITE_ALPHA
op_or
id|WRITE_RGB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|START_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br00
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br13
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br14
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br09
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br16
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|MI_NOOP
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;ring = 0x%08x, 0x%08x (%d)&bslash;n&quot;
comma
id|dinfo-&gt;ring_head
comma
id|dinfo-&gt;ring_tail
comma
id|dinfo-&gt;ring_space
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|intelfbhw_do_bitblt
id|intelfbhw_do_bitblt
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
id|u32
id|curx
comma
id|u32
id|cury
comma
id|u32
id|dstx
comma
id|u32
id|dsty
comma
id|u32
id|w
comma
id|u32
id|h
comma
id|u32
id|pitch
comma
id|u32
id|bpp
)paren
(brace
id|u32
id|br00
comma
id|br09
comma
id|br11
comma
id|br12
comma
id|br13
comma
id|br22
comma
id|br23
comma
id|br26
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_do_bitblt: (%d,%d)-&gt;(%d,%d) %dx%d, p %d bpp %d&bslash;n&quot;
comma
id|curx
comma
id|cury
comma
id|dstx
comma
id|dsty
comma
id|w
comma
id|h
comma
id|pitch
comma
id|bpp
)paren
suffix:semicolon
macro_line|#endif
id|br00
op_assign
id|XY_SRC_COPY_BLT_CMD
suffix:semicolon
id|br09
op_assign
id|dinfo-&gt;fb_start
suffix:semicolon
id|br11
op_assign
(paren
id|pitch
op_lshift
id|PITCH_SHIFT
)paren
suffix:semicolon
id|br12
op_assign
id|dinfo-&gt;fb_start
suffix:semicolon
id|br13
op_assign
(paren
id|SRC_ROP_GXCOPY
op_lshift
id|ROP_SHIFT
)paren
op_or
(paren
id|pitch
op_lshift
id|PITCH_SHIFT
)paren
suffix:semicolon
id|br22
op_assign
(paren
id|dstx
op_lshift
id|WIDTH_SHIFT
)paren
op_or
(paren
id|dsty
op_lshift
id|HEIGHT_SHIFT
)paren
suffix:semicolon
id|br23
op_assign
(paren
(paren
id|dstx
op_plus
id|w
)paren
op_lshift
id|WIDTH_SHIFT
)paren
op_or
(paren
(paren
id|dsty
op_plus
id|h
)paren
op_lshift
id|HEIGHT_SHIFT
)paren
suffix:semicolon
id|br26
op_assign
(paren
id|curx
op_lshift
id|WIDTH_SHIFT
)paren
op_or
(paren
id|cury
op_lshift
id|HEIGHT_SHIFT
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_32
suffix:semicolon
id|br00
op_or_assign
id|WRITE_ALPHA
op_or
id|WRITE_RGB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|START_RING
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br00
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br13
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br22
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br23
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br09
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br26
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br11
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br12
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|intelfbhw_do_drawglyph
id|intelfbhw_do_drawglyph
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
id|u32
id|fg
comma
id|u32
id|bg
comma
id|u32
id|w
comma
id|u32
id|h
comma
r_const
id|u8
op_star
id|cdat
comma
id|u32
id|x
comma
id|u32
id|y
comma
id|u32
id|pitch
comma
id|u32
id|bpp
)paren
(brace
r_int
id|nbytes
comma
id|ndwords
comma
id|pad
comma
id|tmp
suffix:semicolon
id|u32
id|br00
comma
id|br09
comma
id|br13
comma
id|br18
comma
id|br19
comma
id|br22
comma
id|br23
suffix:semicolon
r_int
id|dat
comma
id|ix
comma
id|iy
comma
id|iw
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_do_drawglyph: (%d,%d) %dx%d&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* size in bytes of a padded scanline */
id|nbytes
op_assign
id|ROUND_UP_TO
c_func
(paren
id|w
comma
l_int|16
)paren
op_div
l_int|8
suffix:semicolon
multiline_comment|/* Total bytes of padded scanline data to write out. */
id|nbytes
op_assign
id|nbytes
op_star
id|h
suffix:semicolon
multiline_comment|/*&n;&t; * Check if the glyph data exceeds the immediate mode limit.&n;&t; * It would take a large font (1K pixels) to hit this limit.&n;&t; */
r_if
c_cond
(paren
id|nbytes
OG
id|MAX_MONO_IMM_SIZE
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Src data is packaged a dword (32-bit) at a time. */
id|ndwords
op_assign
id|ROUND_UP_TO
c_func
(paren
id|nbytes
comma
l_int|4
)paren
op_div
l_int|4
suffix:semicolon
multiline_comment|/*&n;&t; * Ring has to be padded to a quad word. But because the command starts&n;&t;   with 7 bytes, pad only if there is an even number of ndwords&n;&t; */
id|pad
op_assign
op_logical_neg
(paren
id|ndwords
op_mod
l_int|2
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|XY_MONO_SRC_IMM_BLT_CMD
op_amp
id|DW_LENGTH_MASK
)paren
op_plus
id|ndwords
suffix:semicolon
id|br00
op_assign
(paren
id|XY_MONO_SRC_IMM_BLT_CMD
op_amp
op_complement
id|DW_LENGTH_MASK
)paren
op_or
id|tmp
suffix:semicolon
id|br09
op_assign
id|dinfo-&gt;fb_start
suffix:semicolon
id|br13
op_assign
(paren
id|SRC_ROP_GXCOPY
op_lshift
id|ROP_SHIFT
)paren
op_or
(paren
id|pitch
op_lshift
id|PITCH_SHIFT
)paren
suffix:semicolon
id|br18
op_assign
id|bg
suffix:semicolon
id|br19
op_assign
id|fg
suffix:semicolon
id|br22
op_assign
(paren
id|x
op_lshift
id|WIDTH_SHIFT
)paren
op_or
(paren
id|y
op_lshift
id|HEIGHT_SHIFT
)paren
suffix:semicolon
id|br23
op_assign
(paren
(paren
id|x
op_plus
id|w
)paren
op_lshift
id|WIDTH_SHIFT
)paren
op_or
(paren
(paren
id|y
op_plus
id|h
)paren
op_lshift
id|HEIGHT_SHIFT
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bpp
)paren
(brace
r_case
l_int|8
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|br13
op_or_assign
id|COLOR_DEPTH_32
suffix:semicolon
id|br00
op_or_assign
id|WRITE_ALPHA
op_or
id|WRITE_RGB
suffix:semicolon
r_break
suffix:semicolon
)brace
id|START_RING
c_func
(paren
l_int|8
op_plus
id|ndwords
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br00
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br13
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br22
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br23
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br09
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br18
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|br19
)paren
suffix:semicolon
id|ix
op_assign
id|iy
op_assign
l_int|0
suffix:semicolon
id|iw
op_assign
id|ROUND_UP_TO
c_func
(paren
id|w
comma
l_int|8
)paren
op_div
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|ndwords
op_decrement
)paren
(brace
id|dat
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
op_increment
id|j
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ix
op_ne
id|iw
op_logical_or
id|i
op_eq
l_int|0
)paren
id|dat
op_or_assign
id|cdat
(braket
id|iy
op_star
id|iw
op_plus
id|ix
op_increment
)braket
op_lshift
(paren
id|i
op_plus
id|j
op_star
l_int|2
)paren
op_star
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ix
op_eq
id|iw
op_logical_and
id|iy
op_ne
(paren
id|h
op_minus
l_int|1
)paren
)paren
(brace
id|ix
op_assign
l_int|0
suffix:semicolon
op_increment
id|iy
suffix:semicolon
)brace
)brace
id|OUT_RING
c_func
(paren
id|dat
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pad
)paren
id|OUT_RING
c_func
(paren
id|MI_NOOP
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* HW cursor functions. */
r_void
DECL|function|intelfbhw_cursor_init
id|intelfbhw_cursor_init
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_init&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dinfo-&gt;mobile
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;cursor.physical
)paren
r_return
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_CONTROL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|CURSOR_MODE_MASK
op_or
id|CURSOR_MOBILE_GAMMA_ENABLE
op_or
id|CURSOR_MEM_TYPE_LOCAL
op_or
(paren
l_int|1
op_lshift
id|CURSOR_PIPE_SELECT_SHIFT
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CURSOR_MODE_DISABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_CONTROL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_BASEADDR
comma
id|dinfo-&gt;cursor.physical
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_CONTROL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|CURSOR_FORMAT_MASK
op_or
id|CURSOR_GAMMA_ENABLE
op_or
id|CURSOR_ENABLE
op_or
id|CURSOR_STRIDE_MASK
)paren
suffix:semicolon
id|tmp
op_assign
id|CURSOR_FORMAT_3C
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_CONTROL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_BASEADDR
comma
id|dinfo-&gt;cursor.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|tmp
op_assign
(paren
l_int|64
op_lshift
id|CURSOR_SIZE_H_SHIFT
)paren
op_or
(paren
l_int|64
op_lshift
id|CURSOR_SIZE_V_SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_SIZE
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|intelfbhw_cursor_hide
id|intelfbhw_cursor_hide
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_hide&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dinfo-&gt;cursor_on
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dinfo-&gt;mobile
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;cursor.physical
)paren
r_return
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_CONTROL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CURSOR_MODE_MASK
suffix:semicolon
id|tmp
op_or_assign
id|CURSOR_MODE_DISABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_CONTROL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Flush changes */
id|OUTREG
c_func
(paren
id|CURSOR_A_BASEADDR
comma
id|dinfo-&gt;cursor.physical
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_CONTROL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CURSOR_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_CONTROL
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|intelfbhw_cursor_show
id|intelfbhw_cursor_show
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_show&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dinfo-&gt;cursor_on
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dinfo-&gt;cursor_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|dinfo-&gt;mobile
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;cursor.physical
)paren
r_return
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_A_CONTROL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CURSOR_MODE_MASK
suffix:semicolon
id|tmp
op_or_assign
id|CURSOR_MODE_64_4C_AX
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_CONTROL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Flush changes */
id|OUTREG
c_func
(paren
id|CURSOR_A_BASEADDR
comma
id|dinfo-&gt;cursor.physical
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|INREG
c_func
(paren
id|CURSOR_CONTROL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CURSOR_ENABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_CONTROL
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|intelfbhw_cursor_setpos
id|intelfbhw_cursor_setpos
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u32
id|tmp
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_setpos: (%d, %d)&bslash;n&quot;
comma
id|x
comma
id|y
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Sets the position.  The coordinates are assumed to already&n;&t; * have any offset adjusted.  Assume that the cursor is never&n;&t; * completely off-screen, and that x, y are always &gt;= 0.&n;&t; */
id|tmp
op_assign
(paren
(paren
id|x
op_amp
id|CURSOR_POS_MASK
)paren
op_lshift
id|CURSOR_X_SHIFT
)paren
op_or
(paren
(paren
id|y
op_amp
id|CURSOR_POS_MASK
)paren
op_lshift
id|CURSOR_Y_SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_POSITION
comma
id|tmp
)paren
suffix:semicolon
)brace
r_void
DECL|function|intelfbhw_cursor_setcolor
id|intelfbhw_cursor_setcolor
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
id|u32
id|bg
comma
id|u32
id|fg
)paren
(brace
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_setcolor&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|OUTREG
c_func
(paren
id|CURSOR_A_PALETTE0
comma
id|bg
op_amp
id|CURSOR_PALETTE_MASK
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_PALETTE1
comma
id|fg
op_amp
id|CURSOR_PALETTE_MASK
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_PALETTE2
comma
id|fg
op_amp
id|CURSOR_PALETTE_MASK
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CURSOR_A_PALETTE3
comma
id|bg
op_amp
id|CURSOR_PALETTE_MASK
)paren
suffix:semicolon
)brace
r_void
DECL|function|intelfbhw_cursor_load
id|intelfbhw_cursor_load
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
comma
r_int
id|width
comma
r_int
id|height
comma
id|u8
op_star
id|data
)paren
(brace
id|u8
id|__iomem
op_star
id|addr
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|dinfo-&gt;cursor
dot
r_virtual
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|w
op_assign
id|width
op_div
l_int|8
suffix:semicolon
r_int
id|mod
op_assign
id|width
op_mod
l_int|8
comma
id|t_mask
comma
id|d_mask
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_load&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;cursor
dot
r_virtual
)paren
r_return
suffix:semicolon
id|t_mask
op_assign
l_int|0xff
op_rshift
id|mod
suffix:semicolon
id|d_mask
op_assign
op_complement
(paren
l_int|0xff
op_rshift
id|mod
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|w
suffix:semicolon
id|j
op_increment
)paren
(brace
id|writeb
c_func
(paren
l_int|0x00
comma
id|addr
op_plus
id|j
)paren
suffix:semicolon
id|writeb
c_func
(paren
op_star
(paren
id|data
op_increment
)paren
comma
id|addr
op_plus
id|j
op_plus
l_int|8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mod
)paren
(brace
id|writeb
c_func
(paren
id|t_mask
comma
id|addr
op_plus
id|j
)paren
suffix:semicolon
id|writeb
c_func
(paren
op_star
(paren
id|data
op_increment
)paren
op_amp
id|d_mask
comma
id|addr
op_plus
id|j
op_plus
l_int|8
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
r_void
DECL|function|intelfbhw_cursor_reset
id|intelfbhw_cursor_reset
c_func
(paren
r_struct
id|intelfb_info
op_star
id|dinfo
)paren
(brace
id|u8
id|__iomem
op_star
id|addr
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|dinfo-&gt;cursor
dot
r_virtual
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
macro_line|#if VERBOSE &gt; 0
id|DBG_MSG
c_func
(paren
l_string|&quot;intelfbhw_cursor_reset&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dinfo-&gt;cursor
dot
r_virtual
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|64
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|writeb
c_func
(paren
l_int|0xff
comma
id|addr
op_plus
id|j
op_plus
l_int|0
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x00
comma
id|addr
op_plus
id|j
op_plus
l_int|8
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
eof
