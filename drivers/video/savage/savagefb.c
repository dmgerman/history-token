multiline_comment|/*&n; * linux/drivers/video/savagefb.c -- S3 Savage Framebuffer Driver&n; *&n; * Copyright (c) 2001-2002  Denis Oliver Kropp &lt;dok@directfb.org&gt;&n; *                          Sven Neumann &lt;neo@directfb.org&gt;&n; *&n; *&n; * Card specific code is based on XFree86&squot;s savage driver.&n; * Framebuffer framework code is based on code of cyber2000fb and tdfxfb.&n; *&n; * This file is subject to the terms and conditions of the GNU General&n; * Public License.  See the file COPYING in the main directory of this&n; * archive for more details.&n; *&n; * 0.4.0 (neo)&n; *  - hardware accelerated clear and move&n; *&n; * 0.3.2 (dok)&n; *  - wait for vertical retrace before writing to cr67&n; *    at the beginning of savagefb_set_par&n; *  - use synchronization registers cr23 and cr26&n; *&n; * 0.3.1 (dok)&n; *  - reset 3D engine&n; *  - don&squot;t return alpha bits for 32bit format&n; *&n; * 0.3.0 (dok)&n; *  - added WaitIdle functions for all Savage types&n; *  - do WaitIdle before mode switching&n; *  - code cleanup&n; *&n; * 0.2.0 (dok)&n; *  - first working version&n; *&n; *&n; * TODO&n; * - clock validations in decode_var&n; *&n; * BUGS&n; * - white margin on bootup&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#include &quot;savagefb.h&quot;
DECL|macro|SAVAGEFB_VERSION
mdefine_line|#define SAVAGEFB_VERSION &quot;0.4.0_2.6&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|__initdata
r_static
r_char
op_star
id|mode_option
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|paletteEnabled
r_static
r_int
id|paletteEnabled
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;(c) 2001-2002  Denis Oliver Kropp &lt;dok@directfb.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FBDev driver for S3 Savage PCI/AGP Chips&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|disabled
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|disabled
comma
l_string|&quot;Disable this driver&squot;s initialization.&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|vgaHWSeqReset
r_static
r_void
id|vgaHWSeqReset
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_int
id|start
)paren
(brace
r_if
c_cond
(paren
id|start
)paren
id|VGAwSEQ
(paren
l_int|0x00
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Synchronous Reset */
r_else
id|VGAwSEQ
(paren
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* End Reset */
)brace
DECL|function|vgaHWProtect
r_static
r_void
id|vgaHWProtect
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_int
id|on
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
(brace
multiline_comment|/*&n;&t;&t; * Turn off screen and disable sequencer.&n;&t;&t; */
id|tmp
op_assign
id|VGArSEQ
(paren
l_int|0x01
)paren
suffix:semicolon
id|vgaHWSeqReset
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* start synchronous reset */
id|VGAwSEQ
(paren
l_int|0x01
comma
id|tmp
op_or
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* disable the display */
id|VGAenablePalette
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Reenable sequencer, then turn on screen.&n;&t;&t; */
id|tmp
op_assign
id|VGArSEQ
(paren
l_int|0x01
)paren
suffix:semicolon
id|VGAwSEQ
(paren
l_int|0x01
comma
id|tmp
op_amp
op_complement
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* reenable display */
id|vgaHWSeqReset
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clear synchronous reset */
id|VGAdisablePalette
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|vgaHWRestore
r_static
r_void
id|vgaHWRestore
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
id|i
suffix:semicolon
id|VGAwMISC
(paren
id|par-&gt;MiscOutReg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|VGAwSEQ
(paren
id|i
comma
id|par-&gt;Sequencer
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Ensure CRTC registers 0-7 are unlocked by clearing bit 7 or&n;&t;   CRTC[17] */
id|VGAwCR
(paren
l_int|17
comma
id|par-&gt;CRTC
(braket
l_int|17
)braket
op_amp
op_complement
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
id|VGAwCR
(paren
id|i
comma
id|par-&gt;CRTC
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|VGAwGR
(paren
id|i
comma
id|par-&gt;Graphics
(braket
id|i
)braket
)paren
suffix:semicolon
id|VGAenablePalette
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
id|VGAwATTR
(paren
id|i
comma
id|par-&gt;Attribute
(braket
id|i
)braket
)paren
suffix:semicolon
id|VGAdisablePalette
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|vgaHWInit
r_static
r_void
id|vgaHWInit
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|savagefb_par
op_star
id|par
comma
r_struct
id|xtimings
op_star
id|timings
)paren
(brace
id|par-&gt;MiscOutReg
op_assign
l_int|0x23
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|timings-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
)paren
id|par-&gt;MiscOutReg
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|timings-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
)paren
id|par-&gt;MiscOutReg
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/*&n;&t; * Time Sequencer&n;&t; */
id|par-&gt;Sequencer
(braket
l_int|0x00
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Sequencer
(braket
l_int|0x01
)braket
op_assign
l_int|0x01
suffix:semicolon
id|par-&gt;Sequencer
(braket
l_int|0x02
)braket
op_assign
l_int|0x0F
suffix:semicolon
id|par-&gt;Sequencer
(braket
l_int|0x03
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Font select */
id|par-&gt;Sequencer
(braket
l_int|0x04
)braket
op_assign
l_int|0x0E
suffix:semicolon
multiline_comment|/* Misc */
multiline_comment|/*&n;&t; * CRTC Controller&n;&t; */
id|par-&gt;CRTC
(braket
l_int|0x00
)braket
op_assign
(paren
id|timings-&gt;HTotal
op_rshift
l_int|3
)paren
op_minus
l_int|5
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x01
)braket
op_assign
(paren
id|timings-&gt;HDisplay
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x02
)braket
op_assign
(paren
id|timings-&gt;HSyncStart
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x03
)braket
op_assign
(paren
(paren
(paren
id|timings-&gt;HSyncEnd
op_rshift
l_int|3
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0x1f
)paren
op_or
l_int|0x80
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x04
)braket
op_assign
(paren
id|timings-&gt;HSyncStart
op_rshift
l_int|3
)paren
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x05
)braket
op_assign
(paren
(paren
(paren
(paren
id|timings-&gt;HSyncEnd
op_rshift
l_int|3
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0x20
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
(paren
id|timings-&gt;HSyncEnd
op_rshift
l_int|3
)paren
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x06
)braket
op_assign
(paren
id|timings-&gt;VTotal
op_minus
l_int|2
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x07
)braket
op_assign
(paren
(paren
(paren
id|timings-&gt;VTotal
op_minus
l_int|2
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|timings-&gt;VDisplay
op_minus
l_int|1
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|7
)paren
op_or
(paren
(paren
id|timings-&gt;VSyncStart
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
(paren
id|timings-&gt;VSyncStart
op_minus
l_int|1
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|5
)paren
op_or
l_int|0x10
op_or
(paren
(paren
(paren
id|timings-&gt;VTotal
op_minus
l_int|2
)paren
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|timings-&gt;VDisplay
op_minus
l_int|1
)paren
op_amp
l_int|0x200
)paren
op_rshift
l_int|3
)paren
op_or
(paren
(paren
id|timings-&gt;VSyncStart
op_amp
l_int|0x200
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x08
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x09
)braket
op_assign
(paren
(paren
(paren
id|timings-&gt;VSyncStart
op_minus
l_int|1
)paren
op_amp
l_int|0x200
)paren
op_rshift
l_int|4
)paren
op_or
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|timings-&gt;dblscan
)paren
id|par-&gt;CRTC
(braket
l_int|0x09
)braket
op_or_assign
l_int|0x80
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0a
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0b
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0c
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0d
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0e
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x0f
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x10
)braket
op_assign
id|timings-&gt;VSyncStart
op_amp
l_int|0xff
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x11
)braket
op_assign
(paren
id|timings-&gt;VSyncEnd
op_amp
l_int|0x0f
)paren
op_or
l_int|0x20
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x12
)braket
op_assign
(paren
id|timings-&gt;VDisplay
op_minus
l_int|1
)paren
op_amp
l_int|0xff
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x13
)braket
op_assign
id|var-&gt;xres_virtual
op_rshift
l_int|4
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x14
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x15
)braket
op_assign
(paren
id|timings-&gt;VSyncStart
op_minus
l_int|1
)paren
op_amp
l_int|0xff
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x16
)braket
op_assign
(paren
id|timings-&gt;VSyncEnd
op_minus
l_int|1
)paren
op_amp
l_int|0xff
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x17
)braket
op_assign
l_int|0xc3
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x18
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/*&n;&t; * are these unnecessary?&n;&t; * vgaHWHBlankKGA(mode, regp, 0, KGA_FIX_OVERSCAN|KGA_ENABLE_ON_ZERO);&n;&t; * vgaHWVBlankKGA(mode, regp, 0, KGA_FIX_OVERSCAN|KGA_ENABLE_ON_ZERO);&n;&t; */
multiline_comment|/*&n;&t; * Graphics Display Controller&n;&t; */
id|par-&gt;Graphics
(braket
l_int|0x00
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x01
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x02
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x03
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x04
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x05
)braket
op_assign
l_int|0x40
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x06
)braket
op_assign
l_int|0x05
suffix:semicolon
multiline_comment|/* only map 64k VGA memory !!!! */
id|par-&gt;Graphics
(braket
l_int|0x07
)braket
op_assign
l_int|0x0F
suffix:semicolon
id|par-&gt;Graphics
(braket
l_int|0x08
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x00
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* standard colormap translation */
id|par-&gt;Attribute
(braket
l_int|0x01
)braket
op_assign
l_int|0x01
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x02
)braket
op_assign
l_int|0x02
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x03
)braket
op_assign
l_int|0x03
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x04
)braket
op_assign
l_int|0x04
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x05
)braket
op_assign
l_int|0x05
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x06
)braket
op_assign
l_int|0x06
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x07
)braket
op_assign
l_int|0x07
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x08
)braket
op_assign
l_int|0x08
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x09
)braket
op_assign
l_int|0x09
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0a
)braket
op_assign
l_int|0x0A
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0b
)braket
op_assign
l_int|0x0B
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0c
)braket
op_assign
l_int|0x0C
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0d
)braket
op_assign
l_int|0x0D
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0e
)braket
op_assign
l_int|0x0E
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x0f
)braket
op_assign
l_int|0x0F
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x10
)braket
op_assign
l_int|0x41
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x11
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x12
)braket
op_assign
l_int|0x0F
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x13
)braket
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;Attribute
(braket
l_int|0x14
)braket
op_assign
l_int|0x00
suffix:semicolon
)brace
multiline_comment|/* -------------------- Hardware specific routines ------------------------- */
multiline_comment|/*&n; * Hardware Acceleration for SavageFB&n; */
multiline_comment|/* Wait for fifo space */
r_static
r_void
DECL|function|savage3D_waitfifo
id|savage3D_waitfifo
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_int
id|space
)paren
(brace
r_int
id|slots
op_assign
id|MAXFIFO
op_minus
id|space
suffix:semicolon
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C00
)paren
op_amp
l_int|0x0000ffff
)paren
OG
id|slots
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|savage4_waitfifo
id|savage4_waitfifo
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_int
id|space
)paren
(brace
r_int
id|slots
op_assign
id|MAXFIFO
op_minus
id|space
suffix:semicolon
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C60
)paren
op_amp
l_int|0x001fffff
)paren
OG
id|slots
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|savage2000_waitfifo
id|savage2000_waitfifo
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_int
id|space
)paren
(brace
r_int
id|slots
op_assign
id|MAXFIFO
op_minus
id|space
suffix:semicolon
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C60
)paren
op_amp
l_int|0x0000ffff
)paren
OG
id|slots
)paren
suffix:semicolon
)brace
multiline_comment|/* Wait for idle accelerator */
r_static
r_void
DECL|function|savage3D_waitidle
id|savage3D_waitidle
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C00
)paren
op_amp
l_int|0x0008ffff
)paren
op_ne
l_int|0x80000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|savage4_waitidle
id|savage4_waitidle
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C60
)paren
op_amp
l_int|0x00a00000
)paren
op_ne
l_int|0x00a00000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|savage2000_waitidle
id|savage2000_waitidle
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_while
c_loop
(paren
(paren
id|savage_in32
c_func
(paren
l_int|0x48C60
)paren
op_amp
l_int|0x009fffff
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SavageSetup2DEngine
id|SavageSetup2DEngine
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_int
id|GlobalBitmapDescriptor
suffix:semicolon
id|GlobalBitmapDescriptor
op_assign
l_int|1
op_or
l_int|8
op_or
id|BCI_BD_BW_DISABLE
suffix:semicolon
id|BCI_BD_SET_BPP
(paren
id|GlobalBitmapDescriptor
comma
id|par-&gt;depth
)paren
suffix:semicolon
id|BCI_BD_SET_STRIDE
(paren
id|GlobalBitmapDescriptor
comma
id|par-&gt;vwidth
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;chip
)paren
(brace
r_case
id|S3_SAVAGE3D
suffix:colon
r_case
id|S3_SAVAGE_MX
suffix:colon
multiline_comment|/* Disable BCI */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
id|savage_in32
c_func
(paren
l_int|0x48C18
)paren
op_amp
l_int|0x3FF0
)paren
suffix:semicolon
multiline_comment|/* Setup BCI command overflow buffer */
id|savage_out32
c_func
(paren
l_int|0x48C14
comma
(paren
id|par-&gt;cob_offset
op_rshift
l_int|11
)paren
op_or
(paren
id|par-&gt;cob_index
op_lshift
l_int|29
)paren
)paren
suffix:semicolon
multiline_comment|/* Program shadow status update. */
id|savage_out32
c_func
(paren
l_int|0x48C10
comma
l_int|0x78207220
)paren
suffix:semicolon
id|savage_out32
c_func
(paren
l_int|0x48C0C
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Enable BCI and command overflow buffer */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
id|savage_in32
c_func
(paren
l_int|0x48C18
)paren
op_or
l_int|0x0C
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S3_SAVAGE4
suffix:colon
r_case
id|S3_PROSAVAGE
suffix:colon
r_case
id|S3_SUPERSAVAGE
suffix:colon
multiline_comment|/* Disable BCI */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
id|savage_in32
c_func
(paren
l_int|0x48C18
)paren
op_amp
l_int|0x3FF0
)paren
suffix:semicolon
multiline_comment|/* Program shadow status update */
id|savage_out32
c_func
(paren
l_int|0x48C10
comma
l_int|0x00700040
)paren
suffix:semicolon
id|savage_out32
c_func
(paren
l_int|0x48C0C
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Enable BCI without the COB */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
id|savage_in32
c_func
(paren
l_int|0x48C18
)paren
op_or
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S3_SAVAGE2000
suffix:colon
multiline_comment|/* Disable BCI */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Setup BCI command overflow buffer */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
(paren
id|par-&gt;cob_offset
op_rshift
l_int|7
)paren
op_or
(paren
id|par-&gt;cob_index
)paren
)paren
suffix:semicolon
multiline_comment|/* Disable shadow status update */
id|savage_out32
c_func
(paren
l_int|0x48A30
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Enable BCI and command overflow buffer */
id|savage_out32
c_func
(paren
l_int|0x48C18
comma
id|savage_in32
c_func
(paren
l_int|0x48C18
)paren
op_or
l_int|0x00280000
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* Turn on 16-bit register access. */
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x31
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d5
comma
l_int|0x0c
)paren
suffix:semicolon
multiline_comment|/* Set stride to use GBD. */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x50
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|vga_in8
(paren
l_int|0x3d5
)paren
op_or
l_int|0xC1
)paren
suffix:semicolon
multiline_comment|/* Enable 2D engine. */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
l_int|0x01
)paren
suffix:semicolon
id|savage_out32
(paren
id|MONO_PAT_0
comma
op_complement
l_int|0
)paren
suffix:semicolon
id|savage_out32
(paren
id|MONO_PAT_1
comma
op_complement
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Setup plane masks */
id|savage_out32
(paren
l_int|0x8128
comma
op_complement
l_int|0
)paren
suffix:semicolon
multiline_comment|/* enable all write planes */
id|savage_out32
(paren
l_int|0x812C
comma
op_complement
l_int|0
)paren
suffix:semicolon
multiline_comment|/* enable all read planes */
id|savage_out16
(paren
l_int|0x8134
comma
l_int|0x27
)paren
suffix:semicolon
id|savage_out16
(paren
l_int|0x8136
comma
l_int|0x07
)paren
suffix:semicolon
multiline_comment|/* Now set the GBD */
id|par-&gt;bci_ptr
op_assign
l_int|0
suffix:semicolon
id|par-&gt;SavageWaitFifo
(paren
id|par
comma
l_int|4
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|BCI_CMD_SETREG
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
op_or
id|BCI_GBD1
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|BCI_CMD_SETREG
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
op_or
id|BCI_GBD2
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|GlobalBitmapDescriptor
)paren
suffix:semicolon
)brace
DECL|function|SavageCalcClock
r_static
r_void
id|SavageCalcClock
c_func
(paren
r_int
id|freq
comma
r_int
id|min_m
comma
r_int
id|min_n1
comma
r_int
id|max_n1
comma
r_int
id|min_n2
comma
r_int
id|max_n2
comma
r_int
id|freq_min
comma
r_int
id|freq_max
comma
r_int
r_int
op_star
id|mdiv
comma
r_int
r_int
op_star
id|ndiv
comma
r_int
r_int
op_star
id|r
)paren
(brace
r_int
id|diff
comma
id|best_diff
suffix:semicolon
r_int
r_int
id|m
suffix:semicolon
r_int
r_char
id|n1
comma
id|n2
comma
id|best_n1
op_assign
l_int|16
op_plus
l_int|2
comma
id|best_n2
op_assign
l_int|2
comma
id|best_m
op_assign
l_int|125
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|freq
OL
id|freq_min
op_div
(paren
l_int|1
op_lshift
id|max_n2
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;invalid frequency %ld Khz&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
id|freq
op_assign
id|freq_min
op_div
(paren
l_int|1
op_lshift
id|max_n2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freq
OG
id|freq_max
op_div
(paren
l_int|1
op_lshift
id|min_n2
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;invalid frequency %ld Khz&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
id|freq
op_assign
id|freq_max
op_div
(paren
l_int|1
op_lshift
id|min_n2
)paren
suffix:semicolon
)brace
multiline_comment|/* work out suitable timings */
id|best_diff
op_assign
id|freq
suffix:semicolon
r_for
c_loop
(paren
id|n2
op_assign
id|min_n2
suffix:semicolon
id|n2
op_le
id|max_n2
suffix:semicolon
id|n2
op_increment
)paren
(brace
r_for
c_loop
(paren
id|n1
op_assign
id|min_n1
op_plus
l_int|2
suffix:semicolon
id|n1
op_le
id|max_n1
op_plus
l_int|2
suffix:semicolon
id|n1
op_increment
)paren
(brace
id|m
op_assign
(paren
id|freq
op_star
id|n1
op_star
(paren
l_int|1
op_lshift
id|n2
)paren
op_plus
id|HALF_BASE_FREQ
)paren
op_div
id|BASE_FREQ
suffix:semicolon
r_if
c_cond
(paren
id|m
template_param
l_int|127
op_plus
l_int|2
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_star
id|BASE_FREQ
op_ge
id|freq_min
op_star
id|n1
)paren
op_logical_and
(paren
id|m
op_star
id|BASE_FREQ
op_le
id|freq_max
op_star
id|n1
)paren
)paren
(brace
id|diff
op_assign
id|freq
op_star
(paren
l_int|1
op_lshift
id|n2
)paren
op_star
id|n1
op_minus
id|BASE_FREQ
op_star
id|m
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
id|diff
op_assign
op_minus
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
id|best_diff
)paren
(brace
id|best_diff
op_assign
id|diff
suffix:semicolon
id|best_m
op_assign
id|m
suffix:semicolon
id|best_n1
op_assign
id|n1
suffix:semicolon
id|best_n2
op_assign
id|n2
suffix:semicolon
)brace
)brace
)brace
)brace
op_star
id|ndiv
op_assign
id|best_n1
op_minus
l_int|2
suffix:semicolon
op_star
id|r
op_assign
id|best_n2
suffix:semicolon
op_star
id|mdiv
op_assign
id|best_m
op_minus
l_int|2
suffix:semicolon
)brace
DECL|function|common_calc_clock
r_static
r_int
id|common_calc_clock
c_func
(paren
r_int
id|freq
comma
r_int
id|min_m
comma
r_int
id|min_n1
comma
r_int
id|max_n1
comma
r_int
id|min_n2
comma
r_int
id|max_n2
comma
r_int
id|freq_min
comma
r_int
id|freq_max
comma
r_int
r_char
op_star
id|mdiv
comma
r_int
r_char
op_star
id|ndiv
)paren
(brace
r_int
id|diff
comma
id|best_diff
suffix:semicolon
r_int
r_int
id|m
suffix:semicolon
r_int
r_char
id|n1
comma
id|n2
suffix:semicolon
r_int
r_char
id|best_n1
op_assign
l_int|16
op_plus
l_int|2
comma
id|best_n2
op_assign
l_int|2
comma
id|best_m
op_assign
l_int|125
op_plus
l_int|2
suffix:semicolon
id|best_diff
op_assign
id|freq
suffix:semicolon
r_for
c_loop
(paren
id|n2
op_assign
id|min_n2
suffix:semicolon
id|n2
op_le
id|max_n2
suffix:semicolon
id|n2
op_increment
)paren
(brace
r_for
c_loop
(paren
id|n1
op_assign
id|min_n1
op_plus
l_int|2
suffix:semicolon
id|n1
op_le
id|max_n1
op_plus
l_int|2
suffix:semicolon
id|n1
op_increment
)paren
(brace
id|m
op_assign
(paren
id|freq
op_star
id|n1
op_star
(paren
l_int|1
op_lshift
id|n2
)paren
op_plus
id|HALF_BASE_FREQ
)paren
op_div
id|BASE_FREQ
suffix:semicolon
r_if
c_cond
(paren
id|m
template_param
l_int|127
op_plus
l_int|2
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m
op_star
id|BASE_FREQ
op_ge
id|freq_min
op_star
id|n1
)paren
op_logical_and
(paren
id|m
op_star
id|BASE_FREQ
op_le
id|freq_max
op_star
id|n1
)paren
)paren
(brace
id|diff
op_assign
id|freq
op_star
(paren
l_int|1
op_lshift
id|n2
)paren
op_star
id|n1
op_minus
id|BASE_FREQ
op_star
id|m
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
(brace
id|diff
op_assign
op_minus
id|diff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|diff
OL
id|best_diff
)paren
(brace
id|best_diff
op_assign
id|diff
suffix:semicolon
id|best_m
op_assign
id|m
suffix:semicolon
id|best_n1
op_assign
id|n1
suffix:semicolon
id|best_n2
op_assign
id|n2
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|max_n1
op_eq
l_int|63
)paren
(brace
op_star
id|ndiv
op_assign
(paren
id|best_n1
op_minus
l_int|2
)paren
op_or
(paren
id|best_n2
op_lshift
l_int|6
)paren
suffix:semicolon
)brace
r_else
op_star
id|ndiv
op_assign
(paren
id|best_n1
op_minus
l_int|2
)paren
op_or
(paren
id|best_n2
op_lshift
l_int|5
)paren
suffix:semicolon
op_star
id|mdiv
op_assign
id|best_m
op_minus
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef SAVAGEFB_DEBUG
multiline_comment|/* This function is used to debug, it prints out the contents of s3 regs */
DECL|function|SavagePrintRegs
r_static
r_void
id|SavagePrintRegs
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|i
suffix:semicolon
r_int
id|vgaCRIndex
op_assign
l_int|0x3d4
suffix:semicolon
r_int
id|vgaCRReg
op_assign
l_int|0x3d5
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;SR    x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC xD xE &quot;
l_string|&quot;xF&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x70
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&bslash;nSR%xx &quot;
comma
id|i
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
id|vga_out8
c_func
(paren
l_int|0x3c4
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; %02x&quot;
comma
id|vga_in8
c_func
(paren
l_int|0x3c5
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&bslash;n&bslash;nCR    x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC &quot;
l_string|&quot;xD xE xF&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xB7
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&bslash;nCR%xx &quot;
comma
id|i
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
id|vga_out8
c_func
(paren
id|vgaCRIndex
comma
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; %02x&quot;
comma
id|vga_in8
c_func
(paren
id|vgaCRReg
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|savage_get_default_par
r_static
r_void
id|savage_get_default_par
c_func
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_char
id|cr3a
comma
id|cr53
comma
id|cr66
suffix:semicolon
id|vga_out16
(paren
l_int|0x3d4
comma
l_int|0x4838
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3d4
comma
l_int|0xa039
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3c4
comma
l_int|0x0608
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|cr66
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
op_or
l_int|0x80
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|cr3a
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
op_or
l_int|0x80
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x53
)paren
suffix:semicolon
id|cr53
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr53
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
)paren
suffix:semicolon
multiline_comment|/* unlock extended seq regs */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x08
)paren
suffix:semicolon
id|par-&gt;SR08
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
l_int|0x06
)paren
suffix:semicolon
multiline_comment|/* now save all the extended regs we need */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x31
)paren
suffix:semicolon
id|par-&gt;CR31
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x32
)paren
suffix:semicolon
id|par-&gt;CR32
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x34
)paren
suffix:semicolon
id|par-&gt;CR34
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x36
)paren
suffix:semicolon
id|par-&gt;CR36
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|par-&gt;CR3A
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|par-&gt;CR40
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x42
)paren
suffix:semicolon
id|par-&gt;CR42
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x45
)paren
suffix:semicolon
id|par-&gt;CR45
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x50
)paren
suffix:semicolon
id|par-&gt;CR50
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x51
)paren
suffix:semicolon
id|par-&gt;CR51
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x53
)paren
suffix:semicolon
id|par-&gt;CR53
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x58
)paren
suffix:semicolon
id|par-&gt;CR58
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x60
)paren
suffix:semicolon
id|par-&gt;CR60
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|par-&gt;CR66
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x67
)paren
suffix:semicolon
id|par-&gt;CR67
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x68
)paren
suffix:semicolon
id|par-&gt;CR68
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x69
)paren
suffix:semicolon
id|par-&gt;CR69
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x6f
)paren
suffix:semicolon
id|par-&gt;CR6F
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x33
)paren
suffix:semicolon
id|par-&gt;CR33
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x86
)paren
suffix:semicolon
id|par-&gt;CR86
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x88
)paren
suffix:semicolon
id|par-&gt;CR88
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x90
)paren
suffix:semicolon
id|par-&gt;CR90
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x91
)paren
suffix:semicolon
id|par-&gt;CR91
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0xb0
)paren
suffix:semicolon
id|par-&gt;CRB0
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_or
l_int|0x80
suffix:semicolon
multiline_comment|/* extended mode timing regs */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3b
)paren
suffix:semicolon
id|par-&gt;CR3B
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3c
)paren
suffix:semicolon
id|par-&gt;CR3C
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x43
)paren
suffix:semicolon
id|par-&gt;CR43
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x5d
)paren
suffix:semicolon
id|par-&gt;CR5D
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x5e
)paren
suffix:semicolon
id|par-&gt;CR5E
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x65
)paren
suffix:semicolon
id|par-&gt;CR65
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
multiline_comment|/* save seq extended regs for DCLK PLL programming */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0e
)paren
suffix:semicolon
id|par-&gt;SR0E
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0f
)paren
suffix:semicolon
id|par-&gt;SR0F
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x10
)paren
suffix:semicolon
id|par-&gt;SR10
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x11
)paren
suffix:semicolon
id|par-&gt;SR11
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x12
)paren
suffix:semicolon
id|par-&gt;SR12
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x13
)paren
suffix:semicolon
id|par-&gt;SR13
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x29
)paren
suffix:semicolon
id|par-&gt;SR29
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x15
)paren
suffix:semicolon
id|par-&gt;SR15
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x30
)paren
suffix:semicolon
id|par-&gt;SR30
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x18
)paren
suffix:semicolon
id|par-&gt;SR18
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
multiline_comment|/* Save flat panel expansion regsters. */
r_if
c_cond
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE_MX
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x54
op_plus
id|i
)paren
suffix:semicolon
id|par-&gt;SR54
(braket
id|i
)braket
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
suffix:semicolon
)brace
)brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|cr66
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
op_or
l_int|0x80
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|cr3a
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
op_or
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* now save MIU regs */
r_if
c_cond
(paren
id|par-&gt;chip
op_ne
id|S3_SAVAGE_MX
)paren
(brace
id|par-&gt;MMPR0
op_assign
id|savage_in32
c_func
(paren
id|FIFO_CONTROL_REG
)paren
suffix:semicolon
id|par-&gt;MMPR1
op_assign
id|savage_in32
c_func
(paren
id|MIU_CONTROL_REG
)paren
suffix:semicolon
id|par-&gt;MMPR2
op_assign
id|savage_in32
c_func
(paren
id|STREAMS_TIMEOUT_REG
)paren
suffix:semicolon
id|par-&gt;MMPR3
op_assign
id|savage_in32
c_func
(paren
id|MISC_TIMEOUT_REG
)paren
suffix:semicolon
)brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
)paren
suffix:semicolon
)brace
DECL|function|savage_update_var
r_static
r_void
id|savage_update_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_videomode
op_star
id|modedb
)paren
(brace
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|modedb-&gt;xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|modedb-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
)paren
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|modedb-&gt;pixclock
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|modedb-&gt;left_margin
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|modedb-&gt;right_margin
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|modedb-&gt;upper_margin
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|modedb-&gt;lower_margin
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|modedb-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|modedb-&gt;vsync_len
suffix:semicolon
id|var-&gt;sync
op_assign
id|modedb-&gt;sync
suffix:semicolon
id|var-&gt;vmode
op_assign
id|modedb-&gt;vmode
suffix:semicolon
)brace
DECL|function|savagefb_check_var
r_static
r_int
id|savagefb_check_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|memlen
comma
id|vramlen
comma
id|mode_valid
op_assign
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_check_var&quot;
)paren
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fb_validate_mode
c_func
(paren
id|var
comma
id|info
)paren
)paren
id|mode_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* calculate modeline if supported by monitor */
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
op_logical_and
id|info-&gt;monspecs.gtf
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fb_get_mode
c_func
(paren
id|FB_MAXTIMINGS
comma
l_int|0
comma
id|var
comma
id|info
)paren
)paren
id|mode_valid
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
)paren
(brace
r_struct
id|fb_videomode
op_star
id|mode
suffix:semicolon
id|mode
op_assign
id|fb_find_best_mode
c_func
(paren
id|var
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
(brace
id|savage_update_var
c_func
(paren
id|var
comma
id|mode
)paren
suffix:semicolon
id|mode_valid
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
op_logical_and
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|info-&gt;modelist
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Is the mode larger than the LCD panel? */
r_if
c_cond
(paren
id|par-&gt;SavagePanelWidth
op_logical_and
(paren
id|var-&gt;xres
OG
id|par-&gt;SavagePanelWidth
op_logical_or
id|var-&gt;yres
OG
id|par-&gt;SavagePanelHeight
)paren
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Mode (%dx%d) larger than the LCD panel &quot;
l_string|&quot;(%dx%d)&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|par-&gt;SavagePanelWidth
comma
id|par-&gt;SavagePanelHeight
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
)paren
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
)paren
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
id|vramlen
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
id|memlen
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
op_star
id|var-&gt;yres_virtual
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|memlen
OG
id|vramlen
)paren
(brace
id|var-&gt;yres_virtual
op_assign
id|vramlen
op_star
l_int|8
op_div
(paren
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|memlen
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
op_star
id|var-&gt;yres_virtual
op_div
l_int|8
suffix:semicolon
)brace
multiline_comment|/* we must round yres/xres down, we already rounded y/xres_virtual up&n;&t;   if it was possible. We should return -EINVAL, but I disagree */
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
)paren
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
)paren
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|var-&gt;xres
OG
id|var-&gt;xres_virtual
)paren
id|var-&gt;xoffset
op_assign
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
op_plus
id|var-&gt;yres
OG
id|var-&gt;yres_virtual
)paren
id|var-&gt;yoffset
op_assign
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savagefb_decode_var
r_static
r_int
id|savagefb_decode_var
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_struct
id|xtimings
id|timings
suffix:semicolon
r_int
id|width
comma
id|dclk
comma
id|i
comma
id|j
suffix:semicolon
multiline_comment|/*, refresh; */
r_int
r_int
id|m
comma
id|n
comma
id|r
suffix:semicolon
r_int
r_char
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_decode_var&quot;
)paren
suffix:semicolon
id|memset
(paren
op_amp
id|timings
comma
l_int|0
comma
r_sizeof
(paren
id|timings
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pixclock
)paren
id|pixclock
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10ns = 100MHz */
id|timings.Clock
op_assign
l_int|1000000000
op_div
id|pixclock
suffix:semicolon
r_if
c_cond
(paren
id|timings.Clock
OL
l_int|1
)paren
id|timings.Clock
op_assign
l_int|1
suffix:semicolon
id|timings.dblscan
op_assign
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
suffix:semicolon
id|timings.interlaced
op_assign
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
suffix:semicolon
id|timings.HDisplay
op_assign
id|var-&gt;xres
suffix:semicolon
id|timings.HSyncStart
op_assign
id|timings.HDisplay
op_plus
id|var-&gt;right_margin
suffix:semicolon
id|timings.HSyncEnd
op_assign
id|timings.HSyncStart
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|timings.HTotal
op_assign
id|timings.HSyncEnd
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|timings.VDisplay
op_assign
id|var-&gt;yres
suffix:semicolon
id|timings.VSyncStart
op_assign
id|timings.VDisplay
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|timings.VSyncEnd
op_assign
id|timings.VSyncStart
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|timings.VTotal
op_assign
id|timings.VSyncEnd
op_plus
id|var-&gt;upper_margin
suffix:semicolon
id|timings.sync
op_assign
id|var-&gt;sync
suffix:semicolon
id|par-&gt;depth
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|par-&gt;vwidth
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|16
op_logical_and
id|par-&gt;chip
op_eq
id|S3_SAVAGE3D
)paren
(brace
id|timings.HDisplay
op_mul_assign
l_int|2
suffix:semicolon
id|timings.HSyncStart
op_mul_assign
l_int|2
suffix:semicolon
id|timings.HSyncEnd
op_mul_assign
l_int|2
suffix:semicolon
id|timings.HTotal
op_mul_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * This will allocate the datastructure and initialize all of the&n;&t; * generic VGA registers.&n;&t; */
id|vgaHWInit
(paren
id|var
comma
id|par
comma
op_amp
id|timings
)paren
suffix:semicolon
multiline_comment|/* We need to set CR67 whether or not we use the BIOS. */
id|dclk
op_assign
id|timings.Clock
suffix:semicolon
id|par-&gt;CR67
op_assign
l_int|0x00
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE2000
)paren
op_logical_and
(paren
id|dclk
op_ge
l_int|230000
)paren
)paren
(brace
id|par-&gt;CR67
op_assign
l_int|0x10
suffix:semicolon
)brace
multiline_comment|/* 8bpp, 2 pixels/clock */
r_else
id|par-&gt;CR67
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* 8bpp, 1 pixel/clock */
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
r_if
c_cond
(paren
id|S3_SAVAGE_MOBILE_SERIES
c_func
(paren
id|par-&gt;chip
)paren
op_logical_or
(paren
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE2000
)paren
op_logical_and
(paren
id|dclk
op_ge
l_int|230000
)paren
)paren
)paren
id|par-&gt;CR67
op_assign
l_int|0x30
suffix:semicolon
multiline_comment|/* 15bpp, 2 pixel/clock */
r_else
id|par-&gt;CR67
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* 15bpp, 1 pixels/clock */
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|S3_SAVAGE_MOBILE_SERIES
c_func
(paren
id|par-&gt;chip
)paren
op_logical_or
(paren
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE2000
)paren
op_logical_and
(paren
id|dclk
op_ge
l_int|230000
)paren
)paren
)paren
(brace
id|par-&gt;CR67
op_assign
l_int|0x50
suffix:semicolon
)brace
multiline_comment|/* 16bpp, 2 pixel/clock */
r_else
id|par-&gt;CR67
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* 16bpp, 1 pixels/clock */
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|par-&gt;CR67
op_assign
l_int|0x70
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|par-&gt;CR67
op_assign
l_int|0xd0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Either BIOS use is disabled, or we failed to find a suitable&n;&t; * match.  Fall back to traditional register-crunching.&n;&t; */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|tmp
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
multiline_comment|/*FIXME:psav-&gt;pci_burst*/
)paren
id|par-&gt;CR3A
op_assign
(paren
id|tmp
op_amp
l_int|0x7f
)paren
op_or
l_int|0x15
suffix:semicolon
r_else
id|par-&gt;CR3A
op_assign
id|tmp
op_or
l_int|0x95
suffix:semicolon
id|par-&gt;CR53
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CR31
op_assign
l_int|0x8c
suffix:semicolon
id|par-&gt;CR66
op_assign
l_int|0x89
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x58
)paren
suffix:semicolon
id|par-&gt;CR58
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_amp
l_int|0x80
suffix:semicolon
id|par-&gt;CR58
op_or_assign
l_int|0x13
suffix:semicolon
id|par-&gt;SR15
op_assign
l_int|0x03
op_or
l_int|0x80
suffix:semicolon
id|par-&gt;SR18
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CR43
op_assign
id|par-&gt;CR45
op_assign
id|par-&gt;CR65
op_assign
l_int|0x00
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|par-&gt;CR40
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_amp
op_complement
l_int|0x01
suffix:semicolon
id|par-&gt;MMPR0
op_assign
l_int|0x010400
suffix:semicolon
id|par-&gt;MMPR1
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;MMPR2
op_assign
l_int|0x0808
suffix:semicolon
id|par-&gt;MMPR3
op_assign
l_int|0x08080810
suffix:semicolon
id|SavageCalcClock
(paren
id|dclk
comma
l_int|1
comma
l_int|1
comma
l_int|127
comma
l_int|0
comma
l_int|4
comma
l_int|180000
comma
l_int|360000
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|r
)paren
suffix:semicolon
multiline_comment|/* m = 107; n = 4; r = 2; */
r_if
c_cond
(paren
id|par-&gt;MCLK
op_le
l_int|0
)paren
(brace
id|par-&gt;SR10
op_assign
l_int|255
suffix:semicolon
id|par-&gt;SR11
op_assign
l_int|255
suffix:semicolon
)brace
r_else
(brace
id|common_calc_clock
(paren
id|par-&gt;MCLK
comma
l_int|1
comma
l_int|1
comma
l_int|31
comma
l_int|0
comma
l_int|3
comma
l_int|135000
comma
l_int|270000
comma
op_amp
id|par-&gt;SR11
comma
op_amp
id|par-&gt;SR10
)paren
suffix:semicolon
multiline_comment|/*      par-&gt;SR10 = 80; // MCLK == 286000 */
multiline_comment|/*      par-&gt;SR11 = 125; */
)brace
id|par-&gt;SR12
op_assign
(paren
id|r
op_lshift
l_int|6
)paren
op_or
(paren
id|n
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|par-&gt;SR13
op_assign
id|m
op_amp
l_int|0xff
suffix:semicolon
id|par-&gt;SR29
op_assign
(paren
id|r
op_amp
l_int|4
)paren
op_or
(paren
id|m
op_amp
l_int|0x100
)paren
op_rshift
l_int|5
op_or
(paren
id|n
op_amp
l_int|0x40
)paren
op_rshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
OL
l_int|24
)paren
id|par-&gt;MMPR0
op_sub_assign
l_int|0x8000
suffix:semicolon
r_else
id|par-&gt;MMPR0
op_sub_assign
l_int|0x4000
suffix:semicolon
r_if
c_cond
(paren
id|timings.interlaced
)paren
id|par-&gt;CR42
op_assign
l_int|0x20
suffix:semicolon
r_else
id|par-&gt;CR42
op_assign
l_int|0x00
suffix:semicolon
id|par-&gt;CR34
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* display fifo */
id|i
op_assign
(paren
(paren
(paren
(paren
id|timings.HTotal
op_rshift
l_int|3
)paren
op_minus
l_int|5
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
(paren
(paren
id|timings.HDisplay
op_rshift
l_int|3
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|7
)paren
op_or
(paren
(paren
(paren
(paren
id|timings.HSyncStart
op_rshift
l_int|3
)paren
op_minus
l_int|1
)paren
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|timings.HSyncStart
op_amp
l_int|0x800
)paren
op_rshift
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|timings.HSyncEnd
op_rshift
l_int|3
)paren
op_minus
(paren
id|timings.HSyncStart
op_rshift
l_int|3
)paren
OG
l_int|64
)paren
id|i
op_or_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
(paren
id|timings.HSyncEnd
op_rshift
l_int|3
)paren
op_minus
(paren
id|timings.HSyncStart
op_rshift
l_int|3
)paren
OG
l_int|32
)paren
id|i
op_or_assign
l_int|0x20
suffix:semicolon
id|j
op_assign
(paren
id|par-&gt;CRTC
(braket
l_int|0
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_plus
id|par-&gt;CRTC
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|j
op_minus
(paren
id|par-&gt;CRTC
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
)paren
OL
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;CRTC
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
op_plus
l_int|4
op_le
id|par-&gt;CRTC
(braket
l_int|0
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
)paren
id|j
op_assign
id|par-&gt;CRTC
(braket
l_int|4
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x10
)paren
op_lshift
l_int|4
)paren
op_plus
l_int|4
suffix:semicolon
r_else
id|j
op_assign
id|par-&gt;CRTC
(braket
l_int|0
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
op_plus
l_int|1
suffix:semicolon
)brace
id|par-&gt;CR3B
op_assign
id|j
op_amp
l_int|0xff
suffix:semicolon
id|i
op_or_assign
(paren
id|j
op_amp
l_int|0x100
)paren
op_rshift
l_int|2
suffix:semicolon
id|par-&gt;CR3C
op_assign
(paren
id|par-&gt;CRTC
(braket
l_int|0
)braket
op_plus
(paren
(paren
id|i
op_amp
l_int|0x01
)paren
op_lshift
l_int|8
)paren
)paren
op_div
l_int|2
suffix:semicolon
id|par-&gt;CR5D
op_assign
id|i
suffix:semicolon
id|par-&gt;CR5E
op_assign
(paren
(paren
(paren
id|timings.VTotal
op_minus
l_int|2
)paren
op_amp
l_int|0x400
)paren
op_rshift
l_int|10
)paren
op_or
(paren
(paren
(paren
id|timings.VDisplay
op_minus
l_int|1
)paren
op_amp
l_int|0x400
)paren
op_rshift
l_int|9
)paren
op_or
(paren
(paren
(paren
id|timings.VSyncStart
)paren
op_amp
l_int|0x400
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|timings.VSyncStart
)paren
op_amp
l_int|0x400
)paren
op_rshift
l_int|6
)paren
op_or
l_int|0x40
suffix:semicolon
id|width
op_assign
(paren
id|var-&gt;xres_virtual
op_star
(paren
(paren
id|var-&gt;bits_per_pixel
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
)paren
op_rshift
l_int|3
suffix:semicolon
id|par-&gt;CR91
op_assign
id|par-&gt;CRTC
(braket
l_int|19
)braket
op_assign
l_int|0xff
op_amp
id|width
suffix:semicolon
id|par-&gt;CR51
op_assign
(paren
l_int|0x300
op_amp
id|width
)paren
op_rshift
l_int|4
suffix:semicolon
id|par-&gt;CR90
op_assign
l_int|0x80
op_or
(paren
id|width
op_rshift
l_int|8
)paren
suffix:semicolon
id|par-&gt;MiscOutReg
op_or_assign
l_int|0x0c
suffix:semicolon
multiline_comment|/* Set frame buffer description. */
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|8
)paren
id|par-&gt;CR50
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|16
)paren
id|par-&gt;CR50
op_assign
l_int|0x10
suffix:semicolon
r_else
id|par-&gt;CR50
op_assign
l_int|0x30
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_le
l_int|640
)paren
id|par-&gt;CR50
op_or_assign
l_int|0x40
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
l_int|800
)paren
id|par-&gt;CR50
op_or_assign
l_int|0x80
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
l_int|1024
)paren
id|par-&gt;CR50
op_or_assign
l_int|0x00
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
l_int|1152
)paren
id|par-&gt;CR50
op_or_assign
l_int|0x01
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
l_int|1280
)paren
id|par-&gt;CR50
op_or_assign
l_int|0xc0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
l_int|1600
)paren
id|par-&gt;CR50
op_or_assign
l_int|0x81
suffix:semicolon
r_else
id|par-&gt;CR50
op_or_assign
l_int|0xc1
suffix:semicolon
multiline_comment|/* Use GBD */
r_if
c_cond
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE2000
)paren
(brace
id|par-&gt;CR33
op_assign
l_int|0x08
suffix:semicolon
)brace
r_else
id|par-&gt;CR33
op_assign
l_int|0x20
suffix:semicolon
id|par-&gt;CRTC
(braket
l_int|0x17
)braket
op_assign
l_int|0xeb
suffix:semicolon
id|par-&gt;CR67
op_or_assign
l_int|1
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x36
)paren
suffix:semicolon
id|par-&gt;CR36
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x68
)paren
suffix:semicolon
id|par-&gt;CR68
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|par-&gt;CR69
op_assign
l_int|0
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x6f
)paren
suffix:semicolon
id|par-&gt;CR6F
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x86
)paren
suffix:semicolon
id|par-&gt;CR86
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x88
)paren
suffix:semicolon
id|par-&gt;CR88
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_or
l_int|0x08
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0xb0
)paren
suffix:semicolon
id|par-&gt;CRB0
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_or
l_int|0x80
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; *    Set a single color register. Return != 0 for invalid regno.&n; */
DECL|function|savagefb_setcolreg
r_static
r_int
id|savagefb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|NR_PALETTE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|transp
op_assign
id|transp
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|vga_out8
(paren
l_int|0x3c8
comma
id|regno
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c9
comma
id|red
op_rshift
l_int|10
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c9
comma
id|green
op_rshift
l_int|10
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c9
comma
id|blue
op_rshift
l_int|10
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|transp
op_amp
l_int|0xff00
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savagefb_set_par_int
r_static
r_void
id|savagefb_set_par_int
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_char
id|tmp
comma
id|cr3a
comma
id|cr66
comma
id|cr67
suffix:semicolon
id|DBG
(paren
l_string|&quot;savagefb_set_par_int&quot;
)paren
suffix:semicolon
id|par-&gt;SavageWaitIdle
(paren
id|par
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c2
comma
l_int|0x23
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3d4
comma
l_int|0x4838
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3d4
comma
l_int|0xa539
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3c4
comma
l_int|0x0608
)paren
suffix:semicolon
id|vgaHWProtect
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Some Savage/MX and /IX systems go nuts when trying to exit the&n;&t; * server after WindowMaker has displayed a gradient background.  I&n;&t; * haven&squot;t been able to find what causes it, but a non-destructive&n;&t; * switch to mode 3 here seems to eliminate the issue.&n;&t; */
id|VerticalRetraceWait
c_func
(paren
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x67
)paren
suffix:semicolon
id|cr67
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr67
multiline_comment|/*par-&gt;CR67*/
op_amp
op_complement
l_int|0x0c
)paren
suffix:semicolon
multiline_comment|/* no STREAMS yet */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x23
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
l_int|0x00
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x26
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* restore extended regs */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR3A
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x31
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR31
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x32
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR32
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x58
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR58
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x53
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR53
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|vga_out16
(paren
l_int|0x3c4
comma
l_int|0x0608
)paren
suffix:semicolon
multiline_comment|/* Restore DCLK registers. */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0e
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR0E
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0f
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR0F
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x29
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR29
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x15
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR15
)paren
suffix:semicolon
multiline_comment|/* Restore flat panel expansion regsters. */
r_if
c_cond
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE_MX
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x54
op_plus
id|i
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR54
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|vgaHWRestore
(paren
id|par
)paren
suffix:semicolon
multiline_comment|/* extended mode timing registers */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x53
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR53
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x5d
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR5D
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x5e
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR5E
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3b
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR3B
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3c
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR3C
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x43
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR43
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x65
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR65
)paren
suffix:semicolon
multiline_comment|/* restore the desired video mode with cr67 */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x67
)paren
suffix:semicolon
multiline_comment|/* following part not present in X11 driver */
id|cr67
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
op_amp
l_int|0xf
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
l_int|0x50
op_or
id|cr67
)paren
suffix:semicolon
id|udelay
(paren
l_int|10000
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x67
)paren
suffix:semicolon
multiline_comment|/* end of part */
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR67
op_amp
op_complement
l_int|0x0c
)paren
suffix:semicolon
multiline_comment|/* other mode timing and extended regs */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x34
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR34
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR40
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x42
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR42
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x45
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR45
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x50
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR50
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x51
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR51
)paren
suffix:semicolon
multiline_comment|/* memory timings */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x36
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR36
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x60
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR60
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x68
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR68
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x69
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR69
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x6f
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR6F
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x33
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR33
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x86
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR86
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x88
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR88
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x90
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR90
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x91
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR91
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE4
)paren
(brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0xb0
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CRB0
)paren
suffix:semicolon
)brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x32
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR32
)paren
suffix:semicolon
multiline_comment|/* unlock extended seq regs */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x08
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
l_int|0x06
)paren
suffix:semicolon
multiline_comment|/* Restore extended sequencer regs for MCLK. SR10 == 255 indicates&n;&t; * that we should leave the default SR10 and SR11 values there.&n;&t; */
r_if
c_cond
(paren
id|par-&gt;SR10
op_ne
l_int|255
)paren
(brace
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x10
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR10
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x11
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR11
)paren
suffix:semicolon
)brace
multiline_comment|/* restore extended seq regs for dclk */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0e
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR0E
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x0f
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR0F
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x12
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR12
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x13
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR13
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x29
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR29
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x18
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR18
)paren
suffix:semicolon
multiline_comment|/* load new m, n pll values for dclk &amp; mclk */
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x15
)paren
suffix:semicolon
id|tmp
op_assign
id|vga_in8
(paren
l_int|0x3c5
)paren
op_amp
op_complement
l_int|0x21
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|tmp
op_or
l_int|0x03
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|tmp
op_or
l_int|0x23
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|tmp
op_or
l_int|0x03
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR15
)paren
suffix:semicolon
id|udelay
(paren
l_int|100
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x30
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR30
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c4
comma
l_int|0x08
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c5
comma
id|par-&gt;SR08
)paren
suffix:semicolon
multiline_comment|/* now write out cr67 in full, possibly starting STREAMS */
id|VerticalRetraceWait
c_func
(paren
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x67
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|par-&gt;CR67
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|cr66
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
op_or
l_int|0x80
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|cr3a
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
op_or
l_int|0x80
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;chip
op_ne
id|S3_SAVAGE_MX
)paren
(brace
id|VerticalRetraceWait
c_func
(paren
)paren
suffix:semicolon
id|savage_out32
(paren
id|FIFO_CONTROL_REG
comma
id|par-&gt;MMPR0
)paren
suffix:semicolon
id|par-&gt;SavageWaitIdle
(paren
id|par
)paren
suffix:semicolon
id|savage_out32
(paren
id|MIU_CONTROL_REG
comma
id|par-&gt;MMPR1
)paren
suffix:semicolon
id|par-&gt;SavageWaitIdle
(paren
id|par
)paren
suffix:semicolon
id|savage_out32
(paren
id|STREAMS_TIMEOUT_REG
comma
id|par-&gt;MMPR2
)paren
suffix:semicolon
id|par-&gt;SavageWaitIdle
(paren
id|par
)paren
suffix:semicolon
id|savage_out32
(paren
id|MISC_TIMEOUT_REG
comma
id|par-&gt;MMPR3
)paren
suffix:semicolon
)brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3a
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3a
)paren
suffix:semicolon
id|SavageSetup2DEngine
(paren
id|par
)paren
suffix:semicolon
id|vgaHWProtect
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|savagefb_update_start
r_static
r_void
id|savagefb_update_start
(paren
r_struct
id|savagefb_par
op_star
id|par
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|base
suffix:semicolon
id|base
op_assign
(paren
(paren
id|var-&gt;yoffset
op_star
id|var-&gt;xres_virtual
op_plus
(paren
id|var-&gt;xoffset
op_amp
op_complement
l_int|1
)paren
)paren
op_star
(paren
(paren
id|var-&gt;bits_per_pixel
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
)paren
op_rshift
l_int|2
suffix:semicolon
multiline_comment|/* now program the start address registers */
id|vga_out16
c_func
(paren
l_int|0x3d4
comma
(paren
id|base
op_amp
l_int|0x00ff00
)paren
op_or
l_int|0x0c
)paren
suffix:semicolon
id|vga_out16
c_func
(paren
l_int|0x3d4
comma
(paren
(paren
id|base
op_amp
l_int|0x00ff
)paren
op_lshift
l_int|8
)paren
op_or
l_int|0x0d
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x69
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
(paren
id|base
op_amp
l_int|0x7f0000
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|savagefb_set_fix
r_static
r_void
id|savagefb_set_fix
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|info-&gt;fix.line_length
op_assign
id|info-&gt;var.xres_virtual
op_star
id|info-&gt;var.bits_per_pixel
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_else
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_FB_SAVAGE_ACCEL)
DECL|function|savagefb_set_clip
r_static
r_void
id|savagefb_set_clip
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|cmd
suffix:semicolon
id|cmd
op_assign
id|BCI_CMD_NOP
op_or
id|BCI_CMD_CLIP_NEW
suffix:semicolon
id|par-&gt;bci_ptr
op_assign
l_int|0
suffix:semicolon
id|par
op_member_access_from_pointer
id|SavageWaitFifo
c_func
(paren
id|par
comma
l_int|3
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|BCI_CLIP_TL
c_func
(paren
l_int|0
comma
l_int|0
)paren
)paren
suffix:semicolon
id|BCI_SEND
c_func
(paren
id|BCI_CLIP_BR
c_func
(paren
l_int|0xfff
comma
l_int|0xfff
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|savagefb_set_par
r_static
r_int
id|savagefb_set_par
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
r_int
id|err
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_set_par&quot;
)paren
suffix:semicolon
id|err
op_assign
id|savagefb_decode_var
(paren
id|var
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;dacSpeedBpp
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
OG
l_int|24
)paren
id|par-&gt;dacSpeedBpp
op_assign
id|par-&gt;clock
(braket
l_int|3
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_ge
l_int|24
)paren
id|par-&gt;dacSpeedBpp
op_assign
id|par-&gt;clock
(braket
l_int|2
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;bits_per_pixel
OG
l_int|8
)paren
op_logical_and
(paren
id|var-&gt;bits_per_pixel
OL
l_int|24
)paren
)paren
id|par-&gt;dacSpeedBpp
op_assign
id|par-&gt;clock
(braket
l_int|1
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_le
l_int|8
)paren
id|par-&gt;dacSpeedBpp
op_assign
id|par-&gt;clock
(braket
l_int|0
)braket
suffix:semicolon
)brace
multiline_comment|/* Set ramdac limits */
id|par-&gt;maxClock
op_assign
id|par-&gt;dacSpeedBpp
suffix:semicolon
id|par-&gt;minClock
op_assign
l_int|10000
suffix:semicolon
id|savagefb_set_par_int
(paren
id|par
)paren
suffix:semicolon
id|savagefb_update_start
(paren
id|par
comma
id|var
)paren
suffix:semicolon
id|fb_set_cmap
(paren
op_amp
id|info-&gt;cmap
comma
id|info
)paren
suffix:semicolon
id|savagefb_set_fix
c_func
(paren
id|info
)paren
suffix:semicolon
id|savagefb_set_clip
c_func
(paren
id|info
)paren
suffix:semicolon
id|SavagePrintRegs
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *    Pan or Wrap the Display&n; */
DECL|function|savagefb_pan_display
r_static
r_int
id|savagefb_pan_display
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u_int
id|y_bottom
suffix:semicolon
id|y_bottom
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
)paren
id|y_bottom
op_add_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|y_bottom
OG
id|info-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|savagefb_update_start
(paren
id|par
comma
id|var
)paren
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|savagefb_ops
r_static
r_struct
id|fb_ops
id|savagefb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_check_var
op_assign
id|savagefb_check_var
comma
dot
id|fb_set_par
op_assign
id|savagefb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|savagefb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|savagefb_pan_display
comma
macro_line|#if defined(CONFIG_FB_SAVAGE_ACCEL)
dot
id|fb_fillrect
op_assign
id|savagefb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|savagefb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|savagefb_imageblit
comma
dot
id|fb_sync
op_assign
id|savagefb_sync
comma
macro_line|#else
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
macro_line|#endif
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|savagefb_var800x600x8
r_static
r_struct
id|fb_var_screeninfo
id|__devinitdata
id|savagefb_var800x600x8
op_assign
(brace
dot
id|accel_flags
op_assign
id|FB_ACCELF_TEXT
comma
dot
id|xres
op_assign
l_int|800
comma
dot
id|yres
op_assign
l_int|600
comma
dot
id|xres_virtual
op_assign
l_int|800
comma
dot
id|yres_virtual
op_assign
l_int|600
comma
dot
id|bits_per_pixel
op_assign
l_int|8
comma
dot
id|pixclock
op_assign
l_int|25000
comma
dot
id|left_margin
op_assign
l_int|88
comma
dot
id|right_margin
op_assign
l_int|40
comma
dot
id|upper_margin
op_assign
l_int|23
comma
dot
id|lower_margin
op_assign
l_int|1
comma
dot
id|hsync_len
op_assign
l_int|128
comma
dot
id|vsync_len
op_assign
l_int|4
comma
dot
id|sync
op_assign
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
DECL|function|savage_enable_mmio
r_static
r_void
id|savage_enable_mmio
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
id|DBG
(paren
l_string|&quot;savage_enable_mmio&bslash;n&quot;
)paren
suffix:semicolon
id|val
op_assign
id|vga_in8
(paren
l_int|0x3c3
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c3
comma
id|val
op_or
l_int|0x01
)paren
suffix:semicolon
id|val
op_assign
id|vga_in8
(paren
l_int|0x3cc
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3c2
comma
id|val
op_or
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;chip
op_ge
id|S3_SAVAGE4
)paren
(brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|val
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|val
op_or
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|savage_disable_mmio
r_void
id|savage_disable_mmio
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
id|DBG
(paren
l_string|&quot;savage_disable_mmio&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;chip
op_ge
id|S3_SAVAGE4
)paren
(brace
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|val
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|val
op_or
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|savage_map_mmio
r_static
r_int
id|__devinit
id|savage_map_mmio
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|DBG
(paren
l_string|&quot;savage_map_mmio&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S3_SAVAGE3D_SERIES
(paren
id|par-&gt;chip
)paren
)paren
id|par-&gt;mmio.pbase
op_assign
id|pci_resource_start
(paren
id|par-&gt;pcidev
comma
l_int|0
)paren
op_plus
id|SAVAGE_NEWMMIO_REGBASE_S3
suffix:semicolon
r_else
id|par-&gt;mmio.pbase
op_assign
id|pci_resource_start
(paren
id|par-&gt;pcidev
comma
l_int|0
)paren
op_plus
id|SAVAGE_NEWMMIO_REGBASE_S4
suffix:semicolon
id|par-&gt;mmio.len
op_assign
id|SAVAGE_NEWMMIO_REGSIZE
suffix:semicolon
id|par-&gt;mmio.vbase
op_assign
id|ioremap
(paren
id|par-&gt;mmio.pbase
comma
id|par-&gt;mmio.len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;mmio.vbase
)paren
(brace
id|printk
(paren
l_string|&quot;savagefb: unable to map memory mapped IO&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_else
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: mapped io at %p&bslash;n&quot;
comma
id|par-&gt;mmio.vbase
)paren
suffix:semicolon
id|info-&gt;fix.mmio_start
op_assign
id|par-&gt;mmio.pbase
suffix:semicolon
id|info-&gt;fix.mmio_len
op_assign
id|par-&gt;mmio.len
suffix:semicolon
id|par-&gt;bci_base
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
(paren
id|par-&gt;mmio.vbase
op_plus
id|BCI_BUFFER_OFFSET
)paren
suffix:semicolon
id|par-&gt;bci_ptr
op_assign
l_int|0
suffix:semicolon
id|savage_enable_mmio
(paren
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savage_unmap_mmio
r_static
r_void
id|__devinit
id|savage_unmap_mmio
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|DBG
(paren
l_string|&quot;savage_unmap_mmio&quot;
)paren
suffix:semicolon
id|savage_disable_mmio
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;mmio.vbase
)paren
(brace
id|iounmap
(paren
(paren
r_void
id|__iomem
op_star
)paren
id|par-&gt;mmio.vbase
)paren
suffix:semicolon
id|par-&gt;mmio.vbase
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|savage_map_video
r_static
r_int
id|__devinit
id|savage_map_video
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|video_len
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|resource
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savage_map_video&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S3_SAVAGE3D_SERIES
(paren
id|par-&gt;chip
)paren
)paren
id|resource
op_assign
l_int|0
suffix:semicolon
r_else
id|resource
op_assign
l_int|1
suffix:semicolon
id|par-&gt;video.pbase
op_assign
id|pci_resource_start
(paren
id|par-&gt;pcidev
comma
id|resource
)paren
suffix:semicolon
id|par-&gt;video.len
op_assign
id|video_len
suffix:semicolon
id|par-&gt;video.vbase
op_assign
id|ioremap
(paren
id|par-&gt;video.pbase
comma
id|par-&gt;video.len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;video.vbase
)paren
(brace
id|printk
(paren
l_string|&quot;savagefb: unable to map screen memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_else
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: mapped framebuffer at %p, &quot;
l_string|&quot;pbase == %x&bslash;n&quot;
comma
id|par-&gt;video.vbase
comma
id|par-&gt;video.pbase
)paren
suffix:semicolon
id|info-&gt;fix.smem_start
op_assign
id|par-&gt;video.pbase
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
id|par-&gt;video.len
op_minus
id|par-&gt;cob_size
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|par-&gt;video.vbase
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|par-&gt;video.mtrr
op_assign
id|mtrr_add
(paren
id|par-&gt;video.pbase
comma
id|video_len
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savage_unmap_video
r_static
r_void
id|__devinit
id|savage_unmap_video
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savage_unmap_video&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;video.vbase
)paren
(brace
macro_line|#ifdef CONFIG_MTRR
id|mtrr_del
(paren
id|par-&gt;video.mtrr
comma
id|par-&gt;video.pbase
comma
id|par-&gt;video.len
)paren
suffix:semicolon
macro_line|#endif
id|iounmap
(paren
id|par-&gt;video.vbase
)paren
suffix:semicolon
id|par-&gt;video.vbase
op_assign
l_int|NULL
suffix:semicolon
id|info-&gt;screen_base
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|savage_init_hw
r_static
r_int
id|__devinit
id|savage_init_hw
(paren
r_struct
id|savagefb_par
op_star
id|par
)paren
(brace
r_int
r_char
id|config1
comma
id|m
comma
id|n
comma
id|n1
comma
id|n2
comma
id|sr8
comma
id|cr3f
comma
id|cr66
op_assign
l_int|0
comma
id|tmp
suffix:semicolon
r_static
r_int
r_char
id|RamSavage3D
(braket
)braket
op_assign
(brace
l_int|8
comma
l_int|4
comma
l_int|4
comma
l_int|2
)brace
suffix:semicolon
r_static
r_int
r_char
id|RamSavage4
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|12
comma
l_int|16
comma
l_int|32
comma
l_int|64
comma
l_int|32
)brace
suffix:semicolon
r_static
r_int
r_char
id|RamSavageMX
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|8
comma
l_int|4
comma
l_int|16
comma
l_int|8
comma
l_int|16
comma
l_int|4
comma
l_int|16
)brace
suffix:semicolon
r_static
r_int
r_char
id|RamSavageNB
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|16
comma
l_int|32
comma
l_int|2
comma
l_int|2
)brace
suffix:semicolon
r_int
id|videoRam
comma
id|videoRambytes
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savage_init_hw&quot;
)paren
suffix:semicolon
multiline_comment|/* unprotect CRTC[0-7] */
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x11
)paren
suffix:semicolon
id|tmp
op_assign
id|vga_in8
c_func
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d5
comma
id|tmp
op_amp
l_int|0x7f
)paren
suffix:semicolon
multiline_comment|/* unlock extended regs */
id|vga_out16
c_func
(paren
l_int|0x3d4
comma
l_int|0x4838
)paren
suffix:semicolon
id|vga_out16
c_func
(paren
l_int|0x3d4
comma
l_int|0xa039
)paren
suffix:semicolon
id|vga_out16
c_func
(paren
l_int|0x3c4
comma
l_int|0x0608
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x40
)paren
suffix:semicolon
id|tmp
op_assign
id|vga_in8
c_func
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d5
comma
id|tmp
op_amp
op_complement
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* unlock sys regs */
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x38
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3d5
comma
l_int|0x48
)paren
suffix:semicolon
multiline_comment|/* Unlock system registers. */
id|vga_out16
c_func
(paren
l_int|0x3d4
comma
l_int|0x4838
)paren
suffix:semicolon
multiline_comment|/* Next go on to detect amount of installed ram */
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x36
)paren
suffix:semicolon
multiline_comment|/* for register CR36 (CONFG_REG1), */
id|config1
op_assign
id|vga_in8
c_func
(paren
l_int|0x3d5
)paren
suffix:semicolon
multiline_comment|/* get amount of vram installed */
multiline_comment|/* Compute the amount of video memory and offscreen memory. */
r_switch
c_cond
(paren
id|par-&gt;chip
)paren
(brace
r_case
id|S3_SAVAGE3D
suffix:colon
id|videoRam
op_assign
id|RamSavage3D
(braket
(paren
id|config1
op_amp
l_int|0xC0
)paren
op_rshift
l_int|6
)braket
op_star
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S3_SAVAGE4
suffix:colon
multiline_comment|/*&n;&t;&t; * The Savage4 has one ugly special case to consider.  On&n;&t;&t; * systems with 4 banks of 2Mx32 SDRAM, the BIOS says 4MB&n;&t;&t; * when it really means 8MB.  Why do it the same when you&n;&t;&t; * can do it different...&n;&t;&t; */
id|vga_out8
c_func
(paren
l_int|0x3d4
comma
l_int|0x68
)paren
suffix:semicolon
multiline_comment|/* memory control 1 */
r_if
c_cond
(paren
(paren
id|vga_in8
c_func
(paren
l_int|0x3d5
)paren
op_amp
l_int|0xC0
)paren
op_eq
(paren
l_int|0x01
op_lshift
l_int|6
)paren
)paren
(brace
id|RamSavage4
(braket
l_int|1
)braket
op_assign
l_int|8
suffix:semicolon
)brace
multiline_comment|/*FALLTHROUGH*/
r_case
id|S3_SAVAGE2000
suffix:colon
id|videoRam
op_assign
id|RamSavage4
(braket
(paren
id|config1
op_amp
l_int|0xE0
)paren
op_rshift
l_int|5
)braket
op_star
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S3_SAVAGE_MX
suffix:colon
r_case
id|S3_SUPERSAVAGE
suffix:colon
id|videoRam
op_assign
id|RamSavageMX
(braket
(paren
id|config1
op_amp
l_int|0x0E
)paren
op_rshift
l_int|1
)braket
op_star
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S3_PROSAVAGE
suffix:colon
id|videoRam
op_assign
id|RamSavageNB
(braket
(paren
id|config1
op_amp
l_int|0xE0
)paren
op_rshift
l_int|5
)braket
op_star
l_int|1024
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* How did we get here? */
id|videoRam
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|videoRambytes
op_assign
id|videoRam
op_star
l_int|1024
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: probed videoram:  %dk&bslash;n&quot;
comma
id|videoRam
)paren
suffix:semicolon
multiline_comment|/* reset graphics engine to avoid memory corruption */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|cr66
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
op_or
l_int|0x02
)paren
suffix:semicolon
id|udelay
(paren
l_int|10000
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x66
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr66
op_amp
op_complement
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/* clear reset flag */
id|udelay
(paren
l_int|10000
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * reset memory interface, 3D engine, AGP master, PCI master,&n;&t; * master engine unit, motion compensation/LPB&n;&t; */
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3f
)paren
suffix:semicolon
id|cr3f
op_assign
id|vga_in8
(paren
l_int|0x3d5
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3f
op_or
l_int|0x08
)paren
suffix:semicolon
id|udelay
(paren
l_int|10000
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d4
comma
l_int|0x3f
)paren
suffix:semicolon
id|vga_out8
(paren
l_int|0x3d5
comma
id|cr3f
op_amp
op_complement
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* clear reset flags */
id|udelay
(paren
l_int|10000
)paren
suffix:semicolon
multiline_comment|/* Savage ramdac speeds */
id|par-&gt;numClocks
op_assign
l_int|4
suffix:semicolon
id|par-&gt;clock
(braket
l_int|0
)braket
op_assign
l_int|250000
suffix:semicolon
id|par-&gt;clock
(braket
l_int|1
)braket
op_assign
l_int|250000
suffix:semicolon
id|par-&gt;clock
(braket
l_int|2
)braket
op_assign
l_int|220000
suffix:semicolon
id|par-&gt;clock
(braket
l_int|3
)braket
op_assign
l_int|220000
suffix:semicolon
multiline_comment|/* detect current mclk */
id|vga_out8
c_func
(paren
l_int|0x3c4
comma
l_int|0x08
)paren
suffix:semicolon
id|sr8
op_assign
id|vga_in8
c_func
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3c5
comma
l_int|0x06
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3c4
comma
l_int|0x10
)paren
suffix:semicolon
id|n
op_assign
id|vga_in8
c_func
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3c4
comma
l_int|0x11
)paren
suffix:semicolon
id|m
op_assign
id|vga_in8
c_func
(paren
l_int|0x3c5
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3c4
comma
l_int|0x08
)paren
suffix:semicolon
id|vga_out8
c_func
(paren
l_int|0x3c5
comma
id|sr8
)paren
suffix:semicolon
id|m
op_and_assign
l_int|0x7f
suffix:semicolon
id|n1
op_assign
id|n
op_amp
l_int|0x1f
suffix:semicolon
id|n2
op_assign
(paren
id|n
op_rshift
l_int|5
)paren
op_amp
l_int|0x03
suffix:semicolon
id|par-&gt;MCLK
op_assign
(paren
(paren
l_int|1431818
op_star
(paren
id|m
op_plus
l_int|2
)paren
)paren
op_div
(paren
id|n1
op_plus
l_int|2
)paren
op_div
(paren
l_int|1
op_lshift
id|n2
)paren
op_plus
l_int|50
)paren
op_div
l_int|100
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: Detected current MCLK value of %d kHz&bslash;n&quot;
comma
id|par-&gt;MCLK
)paren
suffix:semicolon
multiline_comment|/* Check LCD panel parrmation */
r_if
c_cond
(paren
id|par-&gt;chip
op_eq
id|S3_SAVAGE_MX
)paren
(brace
r_int
r_char
id|cr6b
op_assign
id|VGArCR
c_func
(paren
l_int|0x6b
)paren
suffix:semicolon
r_int
id|panelX
op_assign
(paren
id|VGArSEQ
(paren
l_int|0x61
)paren
op_plus
(paren
(paren
id|VGArSEQ
(paren
l_int|0x66
)paren
op_amp
l_int|0x02
)paren
op_lshift
l_int|7
)paren
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
r_int
id|panelY
op_assign
(paren
id|VGArSEQ
(paren
l_int|0x69
)paren
op_plus
(paren
(paren
id|VGArSEQ
(paren
l_int|0x6e
)paren
op_amp
l_int|0x70
)paren
op_lshift
l_int|4
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_char
op_star
id|sTechnology
op_assign
l_string|&quot;Unknown&quot;
suffix:semicolon
multiline_comment|/* OK, I admit it.  I don&squot;t know how to limit the max dot clock&n;&t;&t; * for LCD panels of various sizes.  I thought I copied the&n;&t;&t; * formula from the BIOS, but many users have parrmed me of&n;&t;&t; * my folly.&n;&t;&t; *&n;&t;&t; * Instead, I&squot;ll abandon any attempt to automatically limit the&n;&t;&t; * clock, and add an LCDClock option to XF86Config.  Some day,&n;&t;&t; * I should come back to this.&n;&t;&t; */
r_enum
id|ACTIVE_DISPLAYS
(brace
multiline_comment|/* These are the bits in CR6B */
id|ActiveCRT
op_assign
l_int|0x01
comma
id|ActiveLCD
op_assign
l_int|0x02
comma
id|ActiveTV
op_assign
l_int|0x04
comma
id|ActiveCRT2
op_assign
l_int|0x20
comma
id|ActiveDUO
op_assign
l_int|0x80
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|VGArSEQ
(paren
l_int|0x39
)paren
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
id|sTechnology
op_assign
l_string|&quot;TFT&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|VGArSEQ
(paren
l_int|0x30
)paren
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
(brace
id|sTechnology
op_assign
l_string|&quot;DSTN&quot;
suffix:semicolon
)brace
r_else
(brace
id|sTechnology
op_assign
l_string|&quot;STN&quot;
suffix:semicolon
)brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: %dx%d %s LCD panel detected %s&bslash;n&quot;
comma
id|panelX
comma
id|panelY
comma
id|sTechnology
comma
id|cr6b
op_amp
id|ActiveLCD
ques
c_cond
l_string|&quot;and active&quot;
suffix:colon
l_string|&quot;but not active&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr6b
op_amp
id|ActiveLCD
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * If the LCD is active and panel expansion is enabled,&n;&t;&t;&t; * we probably want to kill the HW cursor.&n;&t;&t;&t; */
id|printk
(paren
id|KERN_INFO
l_string|&quot;savagefb: Limiting video mode to &quot;
l_string|&quot;%dx%d&bslash;n&quot;
comma
id|panelX
comma
id|panelY
)paren
suffix:semicolon
id|par-&gt;SavagePanelWidth
op_assign
id|panelX
suffix:semicolon
id|par-&gt;SavagePanelHeight
op_assign
id|panelY
suffix:semicolon
)brace
)brace
id|savage_get_default_par
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S3_SAVAGE4_SERIES
c_func
(paren
id|par-&gt;chip
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * The Savage4 and ProSavage have COB coherency bugs which&n;&t;&t; * render the buffer useless.  We disable it.&n;&t;&t; */
id|par-&gt;cob_index
op_assign
l_int|2
suffix:semicolon
id|par-&gt;cob_size
op_assign
l_int|0x8000
op_lshift
id|par-&gt;cob_index
suffix:semicolon
id|par-&gt;cob_offset
op_assign
id|videoRambytes
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* We use 128kB for the COB on all chips. */
id|par-&gt;cob_index
op_assign
l_int|7
suffix:semicolon
id|par-&gt;cob_size
op_assign
l_int|0x400
op_lshift
id|par-&gt;cob_index
suffix:semicolon
id|par-&gt;cob_offset
op_assign
id|videoRambytes
op_minus
id|par-&gt;cob_size
suffix:semicolon
)brace
r_return
id|videoRambytes
suffix:semicolon
)brace
DECL|function|savage_init_fb_info
r_static
r_int
id|__devinit
id|savage_init_fb_info
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|par-&gt;pcidev
op_assign
id|dev
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.type_aux
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.xpanstep
op_assign
l_int|2
suffix:semicolon
id|info-&gt;fix.ypanstep
op_assign
l_int|1
suffix:semicolon
id|info-&gt;fix.ywrapstep
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|id-&gt;driver_data
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;fix.accel
)paren
(brace
r_case
id|FB_ACCEL_SUPERSAVAGE
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SUPERSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 SuperSavage&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE4
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE4
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage4&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE3D
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE3D
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage3D&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE3D_MV
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE3D
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage3D-MV&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE2000
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE2000
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage2000&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE_MX_MV
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE_MX
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage/MX-MV&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE_MX
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE_MX
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage/MX&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE_IX_MV
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE_MX
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage/IX-MV&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_SAVAGE_IX
suffix:colon
id|par-&gt;chip
op_assign
id|S3_SAVAGE_MX
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Savage/IX&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_PROSAVAGE_PM
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 ProSavage&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_PROSAVAGE_KM
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 ProSavage&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_S3TWISTER_P
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 Twister&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_S3TWISTER_K
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 TwisterK&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_PROSAVAGE_DDR
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 ProSavage DDR&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_ACCEL_PROSAVAGE_DDRK
suffix:colon
id|par-&gt;chip
op_assign
id|S3_PROSAVAGE
suffix:semicolon
id|snprintf
(paren
id|info-&gt;fix.id
comma
l_int|16
comma
l_string|&quot;S3 ProSavage DDR-K&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|S3_SAVAGE3D_SERIES
c_func
(paren
id|par-&gt;chip
)paren
)paren
(brace
id|par-&gt;SavageWaitIdle
op_assign
id|savage3D_waitidle
suffix:semicolon
id|par-&gt;SavageWaitFifo
op_assign
id|savage3D_waitfifo
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S3_SAVAGE4_SERIES
c_func
(paren
id|par-&gt;chip
)paren
op_logical_or
id|S3_SUPERSAVAGE
op_eq
id|par-&gt;chip
)paren
(brace
id|par-&gt;SavageWaitIdle
op_assign
id|savage4_waitidle
suffix:semicolon
id|par-&gt;SavageWaitFifo
op_assign
id|savage4_waitfifo
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;SavageWaitIdle
op_assign
id|savage2000_waitidle
suffix:semicolon
id|par-&gt;SavageWaitFifo
op_assign
id|savage2000_waitfifo
suffix:semicolon
)brace
id|info-&gt;var.nonstd
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|info-&gt;var.width
op_assign
op_minus
l_int|1
suffix:semicolon
id|info-&gt;var.height
op_assign
op_minus
l_int|1
suffix:semicolon
id|info-&gt;var.accel_flags
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|savagefb_ops
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_DEFAULT
op_or
id|FBINFO_HWACCEL_YPAN
op_or
id|FBINFO_HWACCEL_XPAN
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|par-&gt;pseudo_palette
suffix:semicolon
macro_line|#if defined(CONFIG_FB_SAVAGE_ACCEL)
multiline_comment|/* FIFO size + padding for commands */
id|info-&gt;pixmap.addr
op_assign
id|kmalloc
c_func
(paren
l_int|8
op_star
l_int|1024
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;pixmap.addr
)paren
(brace
id|memset
c_func
(paren
id|info-&gt;pixmap.addr
comma
l_int|0
comma
l_int|8
op_star
l_int|1024
)paren
suffix:semicolon
id|info-&gt;pixmap.size
op_assign
l_int|8
op_star
l_int|1024
suffix:semicolon
id|info-&gt;pixmap.scan_align
op_assign
l_int|4
suffix:semicolon
id|info-&gt;pixmap.buf_align
op_assign
l_int|4
suffix:semicolon
id|info-&gt;pixmap.access_align
op_assign
l_int|4
suffix:semicolon
id|fb_alloc_cmap
(paren
op_amp
id|info-&gt;cmap
comma
id|NR_PALETTE
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;flags
op_or_assign
id|FBINFO_HWACCEL_COPYAREA
op_or
id|FBINFO_HWACCEL_FILLRECT
op_or
id|FBINFO_HWACCEL_IMAGEBLIT
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|savagefb_probe
r_static
r_int
id|__devinit
id|savagefb_probe
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|savagefb_par
op_star
id|par
suffix:semicolon
id|u_int
id|h_sync
comma
id|v_sync
suffix:semicolon
r_int
id|err
comma
id|lpitch
suffix:semicolon
r_int
id|video_len
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_probe&quot;
)paren
suffix:semicolon
id|SavagePrintRegs
c_func
(paren
)paren
suffix:semicolon
id|info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|savagefb_par
)paren
comma
op_amp
id|dev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed_enable
suffix:semicolon
r_if
c_cond
(paren
id|pci_request_regions
c_func
(paren
id|dev
comma
l_string|&quot;savagefb&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot request PCI regions&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_enable
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|savage_init_fb_info
c_func
(paren
id|info
comma
id|dev
comma
id|id
)paren
)paren
r_goto
id|failed_init
suffix:semicolon
id|err
op_assign
id|savage_map_mmio
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed_mmio
suffix:semicolon
id|video_len
op_assign
id|savage_init_hw
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_len
OL
l_int|0
)paren
(brace
id|err
op_assign
id|video_len
suffix:semicolon
r_goto
id|failed_mmio
suffix:semicolon
)brace
id|err
op_assign
id|savage_map_video
c_func
(paren
id|info
comma
id|video_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|failed_video
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_FB_SAVAGE_I2C)
id|savagefb_create_i2c_busses
c_func
(paren
id|info
)paren
suffix:semicolon
id|savagefb_probe_i2c_connector
c_func
(paren
id|par
comma
op_amp
id|par-&gt;edid
)paren
suffix:semicolon
id|fb_edid_to_monspecs
c_func
(paren
id|par-&gt;edid
comma
op_amp
id|info-&gt;monspecs
)paren
suffix:semicolon
id|fb_videomode_to_modelist
c_func
(paren
id|info-&gt;monspecs.modedb
comma
id|info-&gt;monspecs.modedb_len
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
macro_line|#endif
id|info-&gt;var
op_assign
id|savagefb_var800x600x8
suffix:semicolon
r_if
c_cond
(paren
id|mode_option
)paren
(brace
id|fb_find_mode
c_func
(paren
op_amp
id|info-&gt;var
comma
id|info
comma
id|mode_option
comma
id|info-&gt;monspecs.modedb
comma
id|info-&gt;monspecs.modedb_len
comma
l_int|NULL
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;monspecs.modedb
op_ne
l_int|NULL
)paren
(brace
r_struct
id|fb_monspecs
op_star
id|specs
op_assign
op_amp
id|info-&gt;monspecs
suffix:semicolon
r_struct
id|fb_videomode
id|modedb
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;monspecs.misc
op_amp
id|FB_MISC_1ST_DETAIL
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|specs-&gt;modedb_len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|specs-&gt;modedb
(braket
id|i
)braket
dot
id|flag
op_amp
id|FB_MODE_IS_FIRST
)paren
(brace
id|modedb
op_assign
id|specs-&gt;modedb
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* otherwise, get first mode in database */
id|modedb
op_assign
id|specs-&gt;modedb
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|savage_update_var
c_func
(paren
op_amp
id|info-&gt;var
comma
op_amp
id|modedb
)paren
suffix:semicolon
)brace
multiline_comment|/* maximize virtual vertical length */
id|lpitch
op_assign
id|info-&gt;var.xres_virtual
op_star
(paren
(paren
id|info-&gt;var.bits_per_pixel
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|info-&gt;var.yres_virtual
op_assign
id|info-&gt;fix.smem_len
op_div
id|lpitch
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.yres_virtual
OL
id|info-&gt;var.yres
)paren
r_goto
id|failed
suffix:semicolon
macro_line|#if defined(CONFIG_FB_SAVAGE_ACCEL)
multiline_comment|/*&n;&t; * The clipping coordinates are masked with 0xFFF, so limit our&n;&t; * virtual resolutions to these sizes.&n;&t; */
r_if
c_cond
(paren
id|info-&gt;var.yres_virtual
OG
l_int|0x1000
)paren
id|info-&gt;var.yres_virtual
op_assign
l_int|0x1000
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.xres_virtual
OG
l_int|0x1000
)paren
id|info-&gt;var.xres_virtual
op_assign
l_int|0x1000
suffix:semicolon
macro_line|#endif
id|savagefb_check_var
c_func
(paren
op_amp
id|info-&gt;var
comma
id|info
)paren
suffix:semicolon
id|savagefb_set_fix
c_func
(paren
id|info
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Calculate the hsync and vsync frequencies.  Note that&n;&t; * we split the 1e12 constant up so that we can preserve&n;&t; * the precision and fit the results into 32-bit registers.&n;&t; *  (1953125000 * 512 = 1e12)&n;&t; */
id|h_sync
op_assign
l_int|1953125000
op_div
id|info-&gt;var.pixclock
suffix:semicolon
id|h_sync
op_assign
id|h_sync
op_star
l_int|512
op_div
(paren
id|info-&gt;var.xres
op_plus
id|info-&gt;var.left_margin
op_plus
id|info-&gt;var.right_margin
op_plus
id|info-&gt;var.hsync_len
)paren
suffix:semicolon
id|v_sync
op_assign
id|h_sync
op_div
(paren
id|info-&gt;var.yres
op_plus
id|info-&gt;var.upper_margin
op_plus
id|info-&gt;var.lower_margin
op_plus
id|info-&gt;var.vsync_len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;savagefb v&quot;
id|SAVAGEFB_VERSION
l_string|&quot;: &quot;
l_string|&quot;%dkB VRAM, using %dx%d, %d.%03dkHz, %dHz&bslash;n&quot;
comma
id|info-&gt;fix.smem_len
op_rshift
l_int|10
comma
id|info-&gt;var.xres
comma
id|info-&gt;var.yres
comma
id|h_sync
op_div
l_int|1000
comma
id|h_sync
op_mod
l_int|1000
comma
id|v_sync
)paren
suffix:semicolon
id|fb_destroy_modedb
c_func
(paren
id|info-&gt;monspecs.modedb
)paren
suffix:semicolon
id|info-&gt;monspecs.modedb_len
op_assign
l_int|0
suffix:semicolon
id|info-&gt;monspecs.modedb
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|register_framebuffer
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|failed
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;fb: %s frame buffer device&bslash;n&quot;
comma
id|info-&gt;fix.id
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Our driver data&n;&t; */
id|pci_set_drvdata
c_func
(paren
id|dev
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
macro_line|#ifdef CONFIG_FB_SAVAGE_I2C
id|savagefb_delete_i2c_busses
c_func
(paren
id|info
)paren
suffix:semicolon
macro_line|#endif
id|fb_alloc_cmap
(paren
op_amp
id|info-&gt;cmap
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|savage_unmap_video
c_func
(paren
id|info
)paren
suffix:semicolon
id|failed_video
suffix:colon
id|savage_unmap_mmio
(paren
id|info
)paren
suffix:semicolon
id|failed_mmio
suffix:colon
id|kfree
c_func
(paren
id|info-&gt;pixmap.addr
)paren
suffix:semicolon
id|failed_init
suffix:colon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
id|failed_enable
suffix:colon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|savagefb_remove
r_static
r_void
id|__devexit
id|savagefb_remove
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_remove&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info
)paren
(brace
multiline_comment|/*&n;&t;&t; * If unregister_framebuffer fails, then&n;&t;&t; * we will be leaving hooks that could cause&n;&t;&t; * oopsen laying around.&n;&t;&t; */
r_if
c_cond
(paren
id|unregister_framebuffer
(paren
id|info
)paren
)paren
id|printk
(paren
id|KERN_WARNING
l_string|&quot;savagefb: danger danger! &quot;
l_string|&quot;Oopsen imminent!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_SAVAGE_I2C
id|savagefb_delete_i2c_busses
c_func
(paren
id|info
)paren
suffix:semicolon
macro_line|#endif
id|fb_alloc_cmap
(paren
op_amp
id|info-&gt;cmap
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|savage_unmap_video
(paren
id|info
)paren
suffix:semicolon
id|savage_unmap_mmio
(paren
id|info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|info-&gt;pixmap.addr
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Ensure that the driver data is no longer&n;&t;&t; * valid.&n;&t;&t; */
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
DECL|function|savagefb_suspend
r_static
r_int
id|savagefb_suspend
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_suspend&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;state: %u&bslash;n&quot;
comma
id|state
)paren
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|fb_set_suspend
c_func
(paren
id|info
comma
id|state
)paren
suffix:semicolon
id|savage_disable_mmio
c_func
(paren
id|par
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|dev
comma
id|state
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savagefb_resume
r_static
r_int
id|savagefb_resume
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|savagefb_par
op_star
id|par
op_assign
(paren
r_struct
id|savagefb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savage_resume&quot;
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|pci_restore_state
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev
)paren
)paren
(brace
id|DBG
c_func
(paren
l_string|&quot;err&quot;
)paren
suffix:semicolon
)brace
id|SavagePrintRegs
c_func
(paren
)paren
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|savage_enable_mmio
c_func
(paren
id|par
)paren
suffix:semicolon
id|savage_init_hw
c_func
(paren
id|par
)paren
suffix:semicolon
id|savagefb_set_par
(paren
id|info
)paren
suffix:semicolon
id|fb_set_suspend
(paren
id|info
comma
l_int|0
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|savagefb_devices
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_MX128
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_MX64
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_MX64C
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IX128SDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IX128DDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IX64SDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IX64DDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IXCSDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SUPSAV_IXCDDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SUPERSAVAGE
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE4
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE4
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE3D
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE3D
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE3D_MV
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE3D_MV
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE2000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE2000
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE_MX_MV
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE_MX_MV
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE_MX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE_MX
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE_IX_MV
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE_IX_MV
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_SAVAGE_IX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_SAVAGE_IX
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_PROSAVAGE_PM
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_PROSAVAGE_PM
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_PROSAVAGE_KM
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_PROSAVAGE_KM
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_S3TWISTER_P
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_S3TWISTER_P
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_S3TWISTER_K
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_S3TWISTER_K
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_PROSAVAGE_DDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_PROSAVAGE_DDR
)brace
comma
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_CHIP_PROSAVAGE_DDRK
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|FB_ACCEL_PROSAVAGE_DDRK
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|savagefb_devices
)paren
suffix:semicolon
DECL|variable|savagefb_driver
r_static
r_struct
id|pci_driver
id|savagefb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;savagefb&quot;
comma
dot
id|id_table
op_assign
id|savagefb_devices
comma
dot
id|probe
op_assign
id|savagefb_probe
comma
dot
id|suspend
op_assign
id|savagefb_suspend
comma
dot
id|resume
op_assign
id|savagefb_resume
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|savagefb_remove
)paren
)brace
suffix:semicolon
multiline_comment|/* **************************** exit-time only **************************** */
DECL|function|savage_done
r_static
r_void
id|__exit
id|savage_done
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
l_string|&quot;savage_done&quot;
)paren
suffix:semicolon
id|pci_unregister_driver
(paren
op_amp
id|savagefb_driver
)paren
suffix:semicolon
)brace
multiline_comment|/* ************************* init in-kernel code ************************** */
DECL|function|savagefb_setup
r_int
id|__init
id|savagefb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
macro_line|#ifndef MODULE
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
macro_line|#endif /* !MODULE */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savagefb_init
r_int
id|__init
id|savagefb_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|option
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;savagefb_init&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;savagefb&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|savagefb_setup
c_func
(paren
id|option
)paren
suffix:semicolon
r_return
id|pci_register_driver
(paren
op_amp
id|savagefb_driver
)paren
suffix:semicolon
)brace
DECL|variable|savagefb_init
id|module_init
c_func
(paren
id|savagefb_init
)paren
suffix:semicolon
DECL|variable|savage_done
id|module_exit
c_func
(paren
id|savage_done
)paren
suffix:semicolon
eof
