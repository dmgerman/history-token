multiline_comment|/*&n; * fbsysfs.c - framebuffer device class and attributes&n; *&n; * Copyright (c) 2004 James Simmons &lt;jsimmons@infradead.org&gt;&n; * &n; *&t;This program is free software you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
DECL|macro|to_fb_info
mdefine_line|#define to_fb_info(class) container_of(class, struct fb_info, class_dev)
DECL|function|release_fb_info
r_static
r_void
id|release_fb_info
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|to_fb_info
c_func
(paren
id|class_dev
)paren
suffix:semicolon
multiline_comment|/* This doesn&squot;t harm */
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
DECL|variable|fb_class
r_struct
r_class
id|fb_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;graphics&quot;
comma
dot
id|release
op_assign
op_amp
id|release_fb_info
comma
)brace
suffix:semicolon
DECL|function|show_dev
r_static
id|ssize_t
id|show_dev
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|to_fb_info
c_func
(paren
id|class_dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u:%u&bslash;n&quot;
comma
id|FB_MAJOR
comma
id|info-&gt;node
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|dev
comma
id|S_IRUGO
comma
id|show_dev
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|fb_add_class_device
r_int
id|fb_add_class_device
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|retval
suffix:semicolon
id|info-&gt;class_dev
dot
r_class
op_assign
op_amp
id|fb_class
suffix:semicolon
id|snprintf
c_func
(paren
id|info-&gt;class_dev.class_id
comma
id|BUS_ID_SIZE
comma
l_string|&quot;fb%d&quot;
comma
id|info-&gt;node
)paren
suffix:semicolon
id|retval
op_assign
id|class_device_register
c_func
(paren
op_amp
id|info-&gt;class_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
r_return
id|class_device_create_file
c_func
(paren
op_amp
id|info-&gt;class_dev
comma
op_amp
id|class_device_attr_dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * framebuffer_alloc - creates a new frame buffer info structure&n; *&n; * @size: size of driver private data, can be zero&n; * @dev: pointer to the device for this fb, this can be NULL&n; *&n; * Creates a new frame buffer info structure. Also reserves @size bytes&n; * for driver private data (info-&gt;par). info-&gt;par (if any) will be&n; * aligned to sizeof(long).&n; *&n; * Returns the new structure, or NULL if an error occured.&n; *&n; */
DECL|function|framebuffer_alloc
r_struct
id|fb_info
op_star
id|framebuffer_alloc
c_func
(paren
r_int
id|size
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
DECL|macro|BYTES_PER_LONG
mdefine_line|#define BYTES_PER_LONG (BITS_PER_LONG/8)
DECL|macro|PADDING
mdefine_line|#define PADDING (BYTES_PER_LONG - (sizeof(struct fb_info) % BYTES_PER_LONG))
r_int
id|fb_info_size
op_assign
r_sizeof
(paren
r_struct
id|fb_info
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|fb_info_size
op_add_assign
id|PADDING
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
id|fb_info_size
op_plus
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
id|fb_info_size
op_plus
id|size
)paren
suffix:semicolon
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|p
suffix:semicolon
id|info-&gt;class_dev.dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|info-&gt;par
op_assign
id|p
op_plus
id|fb_info_size
suffix:semicolon
r_return
id|info
suffix:semicolon
DECL|macro|PADDING
macro_line|#undef PADDING
DECL|macro|BYTES_PER_LONG
macro_line|#undef BYTES_PER_LONG
)brace
multiline_comment|/**&n; * framebuffer_release - marks the structure available for freeing&n; *&n; * @info: frame buffer info structure&n; *&n; * Drop the reference count of the class_device embedded in the&n; * framebuffer info structure.&n; *&n; */
DECL|function|framebuffer_release
r_void
id|framebuffer_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|class_device_put
c_func
(paren
op_amp
id|info-&gt;class_dev
)paren
suffix:semicolon
)brace
DECL|variable|framebuffer_release
id|EXPORT_SYMBOL
c_func
(paren
id|framebuffer_release
)paren
suffix:semicolon
DECL|variable|framebuffer_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|framebuffer_alloc
)paren
suffix:semicolon
eof
