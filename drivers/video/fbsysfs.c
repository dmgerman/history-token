multiline_comment|/*&n; * fbsysfs.c - framebuffer device class and attributes&n; *&n; * Copyright (c) 2004 James Simmons &lt;jsimmons@infradead.org&gt;&n; * &n; *&t;This program is free software you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; * Note:  currently there&squot;s only stubs for framebuffer_alloc and&n; * framebuffer_release here.  The reson for that is that until all drivers&n; * are converted to use it a sysfsification will open OOPSable races.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
multiline_comment|/**&n; * framebuffer_alloc - creates a new frame buffer info structure&n; *&n; * @size: size of driver private data, can be zero&n; * @dev: pointer to the device for this fb, this can be NULL&n; *&n; * Creates a new frame buffer info structure. Also reserves @size bytes&n; * for driver private data (info-&gt;par). info-&gt;par (if any) will be&n; * aligned to sizeof(long).&n; *&n; * Returns the new structure, or NULL if an error occured.&n; *&n; */
DECL|function|framebuffer_alloc
r_struct
id|fb_info
op_star
id|framebuffer_alloc
c_func
(paren
r_int
id|size
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
DECL|macro|BYTES_PER_LONG
mdefine_line|#define BYTES_PER_LONG (BITS_PER_LONG/8)
DECL|macro|PADDING
mdefine_line|#define PADDING (BYTES_PER_LONG - (sizeof(struct fb_info) % BYTES_PER_LONG))
r_int
id|fb_info_size
op_assign
r_sizeof
(paren
r_struct
id|fb_info
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|fb_info_size
op_add_assign
id|PADDING
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
id|fb_info_size
op_plus
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
id|fb_info_size
op_plus
id|size
)paren
suffix:semicolon
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|info-&gt;par
op_assign
id|p
op_plus
id|fb_info_size
suffix:semicolon
id|info-&gt;device
op_assign
id|dev
suffix:semicolon
r_return
id|info
suffix:semicolon
DECL|macro|PADDING
macro_line|#undef PADDING
DECL|macro|BYTES_PER_LONG
macro_line|#undef BYTES_PER_LONG
)brace
multiline_comment|/**&n; * framebuffer_release - marks the structure available for freeing&n; *&n; * @info: frame buffer info structure&n; *&n; * Drop the reference count of the class_device embedded in the&n; * framebuffer info structure.&n; *&n; */
DECL|function|framebuffer_release
r_void
id|framebuffer_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|kfree
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
DECL|variable|framebuffer_release
id|EXPORT_SYMBOL
c_func
(paren
id|framebuffer_release
)paren
suffix:semicolon
DECL|variable|framebuffer_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|framebuffer_alloc
)paren
suffix:semicolon
eof
