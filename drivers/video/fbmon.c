multiline_comment|/*&n; *   linux/drivers/video/fbmon.c&n; *&n; *  Copyright (C) 2002 James Simmons &lt;jsimmons@users.sf.net&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; *&n; */
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#ifdef CONFIG_PCI
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_ALL_PPC
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#endif
multiline_comment|/* &n; * EDID parser&n; *&n; * portions of this file were based on the EDID parser by&n; * John Fremlin &lt;vii@users.sourceforge.net&gt; and Ani Joshi &lt;ajoshi@unixbox.com&gt;&n; */
DECL|macro|EDID_LENGTH
mdefine_line|#define EDID_LENGTH&t;&t;&t;&t;0x80
DECL|macro|EDID_HEADER
mdefine_line|#define EDID_HEADER&t;&t;&t;&t;0x00
DECL|macro|EDID_HEADER_END
mdefine_line|#define EDID_HEADER_END&t;&t;&t;&t;0x07
DECL|macro|ID_MANUFACTURER_NAME
mdefine_line|#define ID_MANUFACTURER_NAME&t;&t;&t;0x08
DECL|macro|ID_MANUFACTURER_NAME_END
mdefine_line|#define ID_MANUFACTURER_NAME_END&t;&t;0x09
DECL|macro|ID_MODEL
mdefine_line|#define ID_MODEL&t;&t;&t;&t;0x0a
DECL|macro|ID_SERIAL_NUMBER
mdefine_line|#define ID_SERIAL_NUMBER&t;&t;&t;0x0c
DECL|macro|MANUFACTURE_WEEK
mdefine_line|#define MANUFACTURE_WEEK&t;&t;&t;0x10
DECL|macro|MANUFACTURE_YEAR
mdefine_line|#define MANUFACTURE_YEAR&t;&t;&t;0x11
DECL|macro|EDID_STRUCT_VERSION
mdefine_line|#define EDID_STRUCT_VERSION&t;&t;&t;0x12
DECL|macro|EDID_STRUCT_REVISION
mdefine_line|#define EDID_STRUCT_REVISION&t;&t;&t;0x13
DECL|macro|DPMS_FLAGS
mdefine_line|#define DPMS_FLAGS&t;&t;&t;&t;0x18
DECL|macro|ESTABLISHED_TIMING_1
mdefine_line|#define ESTABLISHED_TIMING_1&t;&t;&t;0x23
DECL|macro|ESTABLISHED_TIMING_2
mdefine_line|#define ESTABLISHED_TIMING_2&t;&t;&t;0x24
DECL|macro|MANUFACTURERS_TIMINGS
mdefine_line|#define MANUFACTURERS_TIMINGS&t;&t;&t;0x25
DECL|macro|DETAILED_TIMING_DESCRIPTIONS_START
mdefine_line|#define DETAILED_TIMING_DESCRIPTIONS_START&t;0x36
DECL|macro|DETAILED_TIMING_DESCRIPTION_SIZE
mdefine_line|#define DETAILED_TIMING_DESCRIPTION_SIZE&t;18
DECL|macro|NO_DETAILED_TIMING_DESCRIPTIONS
mdefine_line|#define NO_DETAILED_TIMING_DESCRIPTIONS&t;&t;4
DECL|macro|DETAILED_TIMING_DESCRIPTION_1
mdefine_line|#define DETAILED_TIMING_DESCRIPTION_1&t;&t;0x36
DECL|macro|DETAILED_TIMING_DESCRIPTION_2
mdefine_line|#define DETAILED_TIMING_DESCRIPTION_2&t;&t;0x48
DECL|macro|DETAILED_TIMING_DESCRIPTION_3
mdefine_line|#define DETAILED_TIMING_DESCRIPTION_3&t;&t;0x5a
DECL|macro|DETAILED_TIMING_DESCRIPTION_4
mdefine_line|#define DETAILED_TIMING_DESCRIPTION_4&t;&t;0x6c
DECL|macro|DESCRIPTOR_DATA
mdefine_line|#define DESCRIPTOR_DATA&t;&t;&t;&t;5
DECL|macro|UPPER_NIBBLE
mdefine_line|#define UPPER_NIBBLE( x ) &bslash;&n;        (((128|64|32|16) &amp; (x)) &gt;&gt; 4)
DECL|macro|LOWER_NIBBLE
mdefine_line|#define LOWER_NIBBLE( x ) &bslash;&n;        ((1|2|4|8) &amp; (x))
DECL|macro|COMBINE_HI_8LO
mdefine_line|#define COMBINE_HI_8LO( hi, lo ) &bslash;&n;        ( (((unsigned)hi) &lt;&lt; 8) | (unsigned)lo )
DECL|macro|COMBINE_HI_4LO
mdefine_line|#define COMBINE_HI_4LO( hi, lo ) &bslash;&n;        ( (((unsigned)hi) &lt;&lt; 4) | (unsigned)lo )
DECL|macro|PIXEL_CLOCK_LO
mdefine_line|#define PIXEL_CLOCK_LO     (unsigned)block[ 0 ]
DECL|macro|PIXEL_CLOCK_HI
mdefine_line|#define PIXEL_CLOCK_HI     (unsigned)block[ 1 ]
DECL|macro|PIXEL_CLOCK
mdefine_line|#define PIXEL_CLOCK&t;   (COMBINE_HI_8LO( PIXEL_CLOCK_HI,PIXEL_CLOCK_LO )*1000)
DECL|macro|H_ACTIVE_LO
mdefine_line|#define H_ACTIVE_LO        (unsigned)block[ 2 ]
DECL|macro|H_BLANKING_LO
mdefine_line|#define H_BLANKING_LO      (unsigned)block[ 3 ]
DECL|macro|H_ACTIVE_HI
mdefine_line|#define H_ACTIVE_HI        UPPER_NIBBLE( (unsigned)block[ 4 ] )
DECL|macro|H_ACTIVE
mdefine_line|#define H_ACTIVE           COMBINE_HI_8LO( H_ACTIVE_HI, H_ACTIVE_LO )
DECL|macro|H_BLANKING_HI
mdefine_line|#define H_BLANKING_HI      LOWER_NIBBLE( (unsigned)block[ 4 ] )
DECL|macro|H_BLANKING
mdefine_line|#define H_BLANKING         COMBINE_HI_8LO( H_BLANKING_HI, H_BLANKING_LO )
DECL|macro|V_ACTIVE_LO
mdefine_line|#define V_ACTIVE_LO        (unsigned)block[ 5 ]
DECL|macro|V_BLANKING_LO
mdefine_line|#define V_BLANKING_LO      (unsigned)block[ 6 ]
DECL|macro|V_ACTIVE_HI
mdefine_line|#define V_ACTIVE_HI        UPPER_NIBBLE( (unsigned)block[ 7 ] )
DECL|macro|V_ACTIVE
mdefine_line|#define V_ACTIVE           COMBINE_HI_8LO( V_ACTIVE_HI, V_ACTIVE_LO )
DECL|macro|V_BLANKING_HI
mdefine_line|#define V_BLANKING_HI      LOWER_NIBBLE( (unsigned)block[ 7 ] )
DECL|macro|V_BLANKING
mdefine_line|#define V_BLANKING         COMBINE_HI_8LO( V_BLANKING_HI, V_BLANKING_LO )
DECL|macro|H_SYNC_OFFSET_LO
mdefine_line|#define H_SYNC_OFFSET_LO   (unsigned)block[ 8 ]
DECL|macro|H_SYNC_WIDTH_LO
mdefine_line|#define H_SYNC_WIDTH_LO    (unsigned)block[ 9 ]
DECL|macro|V_SYNC_OFFSET_LO
mdefine_line|#define V_SYNC_OFFSET_LO   UPPER_NIBBLE( (unsigned)block[ 10 ] )
DECL|macro|V_SYNC_WIDTH_LO
mdefine_line|#define V_SYNC_WIDTH_LO    LOWER_NIBBLE( (unsigned)block[ 10 ] )
DECL|macro|V_SYNC_WIDTH_HI
mdefine_line|#define V_SYNC_WIDTH_HI    ((unsigned)block[ 11 ] &amp; (1|2))
DECL|macro|V_SYNC_OFFSET_HI
mdefine_line|#define V_SYNC_OFFSET_HI   (((unsigned)block[ 11 ] &amp; (4|8)) &gt;&gt; 2)
DECL|macro|H_SYNC_WIDTH_HI
mdefine_line|#define H_SYNC_WIDTH_HI    (((unsigned)block[ 11 ] &amp; (16|32)) &gt;&gt; 4)
DECL|macro|H_SYNC_OFFSET_HI
mdefine_line|#define H_SYNC_OFFSET_HI   (((unsigned)block[ 11 ] &amp; (64|128)) &gt;&gt; 6)
DECL|macro|V_SYNC_WIDTH
mdefine_line|#define V_SYNC_WIDTH       COMBINE_HI_4LO( V_SYNC_WIDTH_HI, V_SYNC_WIDTH_LO )
DECL|macro|V_SYNC_OFFSET
mdefine_line|#define V_SYNC_OFFSET      COMBINE_HI_4LO( V_SYNC_OFFSET_HI, V_SYNC_OFFSET_LO )
DECL|macro|H_SYNC_WIDTH
mdefine_line|#define H_SYNC_WIDTH       COMBINE_HI_4LO( H_SYNC_WIDTH_HI, H_SYNC_WIDTH_LO )
DECL|macro|H_SYNC_OFFSET
mdefine_line|#define H_SYNC_OFFSET      COMBINE_HI_4LO( H_SYNC_OFFSET_HI, H_SYNC_OFFSET_LO )
DECL|macro|H_SIZE_LO
mdefine_line|#define H_SIZE_LO          (unsigned)block[ 12 ]
DECL|macro|V_SIZE_LO
mdefine_line|#define V_SIZE_LO          (unsigned)block[ 13 ]
DECL|macro|H_SIZE_HI
mdefine_line|#define H_SIZE_HI          UPPER_NIBBLE( (unsigned)block[ 14 ] )
DECL|macro|V_SIZE_HI
mdefine_line|#define V_SIZE_HI          LOWER_NIBBLE( (unsigned)block[ 14 ] )
DECL|macro|H_SIZE
mdefine_line|#define H_SIZE             COMBINE_HI_8LO( H_SIZE_HI, H_SIZE_LO )
DECL|macro|V_SIZE
mdefine_line|#define V_SIZE             COMBINE_HI_8LO( V_SIZE_HI, V_SIZE_LO )
DECL|macro|H_BORDER
mdefine_line|#define H_BORDER           (unsigned)block[ 15 ]
DECL|macro|V_BORDER
mdefine_line|#define V_BORDER           (unsigned)block[ 16 ]
DECL|macro|FLAGS
mdefine_line|#define FLAGS              (unsigned)block[ 17 ]
DECL|macro|INTERLACED
mdefine_line|#define INTERLACED         (FLAGS&amp;128)
DECL|macro|SYNC_TYPE
mdefine_line|#define SYNC_TYPE          (FLAGS&amp;3&lt;&lt;3)&t;/* bits 4,3 */
DECL|macro|SYNC_SEPARATE
mdefine_line|#define SYNC_SEPARATE      (3&lt;&lt;3)
DECL|macro|HSYNC_POSITIVE
mdefine_line|#define HSYNC_POSITIVE     (FLAGS &amp; 4)
DECL|macro|VSYNC_POSITIVE
mdefine_line|#define VSYNC_POSITIVE     (FLAGS &amp; 2)
DECL|variable|edid_v1_header
r_const
r_int
r_char
id|edid_v1_header
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|edid_v1_descriptor_flag
r_const
r_int
r_char
id|edid_v1_descriptor_flag
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|function|edid_checksum
r_static
r_int
id|edid_checksum
c_func
(paren
r_int
r_char
op_star
id|edid
)paren
(brace
r_int
r_char
id|i
comma
id|csum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EDID_LENGTH
suffix:semicolon
id|i
op_increment
)paren
id|csum
op_add_assign
id|edid
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|csum
op_eq
l_int|0x00
)paren
(brace
multiline_comment|/* checksum passed, everything&squot;s good */
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;EDID checksum failed, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|edid_check_header
r_static
r_int
id|edid_check_header
c_func
(paren
r_int
r_char
op_star
id|edid
)paren
(brace
r_if
c_cond
(paren
(paren
id|edid
(braket
l_int|0
)braket
op_ne
l_int|0x00
)paren
op_logical_or
(paren
id|edid
(braket
l_int|1
)braket
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|edid
(braket
l_int|2
)braket
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|edid
(braket
l_int|3
)braket
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|edid
(braket
l_int|4
)braket
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|edid
(braket
l_int|5
)braket
op_ne
l_int|0xff
)paren
op_logical_or
(paren
id|edid
(braket
l_int|6
)braket
op_ne
l_int|0xff
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;EDID header doesn&squot;t match EDID v1 header, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|edid_get_vendor
r_static
r_char
op_star
id|edid_get_vendor
c_func
(paren
r_int
r_char
op_star
id|block
)paren
(brace
r_static
r_char
id|sign
(braket
l_int|4
)braket
suffix:semicolon
r_int
r_int
id|h
suffix:semicolon
id|h
op_assign
id|COMBINE_HI_8LO
c_func
(paren
id|block
(braket
l_int|0
)braket
comma
id|block
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|sign
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|h
op_rshift
l_int|10
)paren
op_amp
l_int|0x1f
)paren
op_plus
l_char|&squot;A&squot;
op_minus
l_int|1
suffix:semicolon
id|sign
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|h
op_rshift
l_int|5
)paren
op_amp
l_int|0x1f
)paren
op_plus
l_char|&squot;A&squot;
op_minus
l_int|1
suffix:semicolon
id|sign
(braket
l_int|2
)braket
op_assign
(paren
id|h
op_amp
l_int|0x1f
)paren
op_plus
l_char|&squot;A&squot;
op_minus
l_int|1
suffix:semicolon
id|sign
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_return
id|sign
suffix:semicolon
)brace
DECL|function|edid_get_monitor
r_static
r_char
op_star
id|edid_get_monitor
c_func
(paren
r_int
r_char
op_star
id|block
)paren
(brace
r_static
r_char
id|name
(braket
l_int|13
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_const
r_int
r_char
op_star
id|ptr
op_assign
id|block
op_plus
id|DESCRIPTOR_DATA
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|13
suffix:semicolon
id|i
op_increment
comma
id|ptr
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|ptr
op_eq
l_int|0xa
)paren
(brace
id|name
(braket
id|i
)braket
op_assign
l_int|0x00
suffix:semicolon
r_return
id|name
suffix:semicolon
)brace
id|name
(braket
id|i
)braket
op_assign
op_star
id|ptr
suffix:semicolon
)brace
r_return
id|name
suffix:semicolon
)brace
DECL|function|edid_is_timing_block
r_static
r_int
id|edid_is_timing_block
c_func
(paren
r_int
r_char
op_star
id|block
)paren
(brace
r_if
c_cond
(paren
(paren
id|block
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|block
(braket
l_int|1
)braket
op_eq
l_int|0x00
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|edid_is_monitor_block
r_static
r_int
id|edid_is_monitor_block
c_func
(paren
r_int
r_char
op_star
id|block
)paren
(brace
r_if
c_cond
(paren
(paren
id|block
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|block
(braket
l_int|1
)braket
op_eq
l_int|0x00
)paren
op_logical_and
(paren
id|block
(braket
l_int|3
)braket
op_eq
l_int|0xfc
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_timing_block
r_static
r_void
id|parse_timing_block
c_func
(paren
r_int
r_char
op_star
id|block
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|H_ACTIVE
suffix:semicolon
id|var-&gt;yres
op_assign
id|var-&gt;yres_virtual
op_assign
id|V_ACTIVE
suffix:semicolon
id|var-&gt;height
op_assign
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|H_SYNC_OFFSET
suffix:semicolon
id|var-&gt;left_margin
op_assign
(paren
id|H_ACTIVE
op_plus
id|H_BLANKING
)paren
op_minus
(paren
id|H_ACTIVE
op_plus
id|H_SYNC_OFFSET
op_plus
id|H_SYNC_WIDTH
)paren
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|V_BLANKING
op_minus
id|V_SYNC_OFFSET
op_minus
id|V_SYNC_WIDTH
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|V_SYNC_OFFSET
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|H_SYNC_WIDTH
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|V_SYNC_WIDTH
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|PIXEL_CLOCK
suffix:semicolon
id|var-&gt;pixclock
op_div_assign
l_int|1000
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|KHZ2PICOS
c_func
(paren
id|var-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|HSYNC_POSITIVE
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|VSYNC_POSITIVE
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
)brace
DECL|function|parse_edid
r_int
id|parse_edid
c_func
(paren
r_int
r_char
op_star
id|edid
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
r_char
op_star
id|block
comma
op_star
id|vendor
comma
op_star
id|monitor
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|edid_checksum
c_func
(paren
id|edid
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|edid_check_header
c_func
(paren
id|edid
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EDID ver %d rev %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|edid
(braket
id|EDID_STRUCT_VERSION
)braket
comma
(paren
r_int
)paren
id|edid
(braket
id|EDID_STRUCT_REVISION
)braket
)paren
suffix:semicolon
id|vendor
op_assign
id|edid_get_vendor
c_func
(paren
id|edid
op_plus
id|ID_MANUFACTURER_NAME
)paren
suffix:semicolon
id|block
op_assign
id|edid
op_plus
id|DETAILED_TIMING_DESCRIPTIONS_START
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
comma
id|block
op_add_assign
id|DETAILED_TIMING_DESCRIPTION_SIZE
)paren
(brace
r_if
c_cond
(paren
id|edid_is_monitor_block
c_func
(paren
id|block
)paren
)paren
(brace
id|monitor
op_assign
id|edid_get_monitor
c_func
(paren
id|block
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;EDID: detected %s %s&bslash;n&quot;
comma
id|vendor
comma
id|monitor
)paren
suffix:semicolon
id|block
op_assign
id|edid
op_plus
id|DETAILED_TIMING_DESCRIPTIONS_START
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
comma
id|block
op_add_assign
id|DETAILED_TIMING_DESCRIPTION_SIZE
)paren
(brace
r_if
c_cond
(paren
id|edid_is_timing_block
c_func
(paren
id|block
)paren
)paren
(brace
id|parse_timing_block
c_func
(paren
id|block
comma
id|var
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|get_EDID
r_char
op_star
id|get_EDID
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
macro_line|#ifdef CONFIG_ALL_PPC
r_static
r_char
op_star
id|propnames
(braket
)braket
op_assign
(brace
l_string|&quot;DFP,EDID&quot;
comma
l_string|&quot;LCD,EDID&quot;
comma
l_string|&quot;EDID&quot;
comma
l_string|&quot;EDID1&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_int
r_char
op_star
id|pedid
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|device_node
op_star
id|dp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dp
op_assign
id|pci_device_to_OF_node
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dp
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|propnames
(braket
id|i
)braket
op_ne
l_int|NULL
suffix:semicolon
op_increment
id|i
)paren
(brace
id|pedid
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_property
c_func
(paren
id|dp
comma
id|propnames
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pedid
op_ne
l_int|NULL
)paren
r_return
id|pedid
suffix:semicolon
)brace
id|dp
op_assign
id|dp-&gt;child
suffix:semicolon
)brace
r_return
id|pedid
suffix:semicolon
macro_line|#else
r_return
l_int|NULL
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
multiline_comment|/* &n; * VESA Generalized Timing Formula (GTF) &n; */
DECL|macro|FLYBACK
mdefine_line|#define FLYBACK                     550
DECL|macro|V_FRONTPORCH
mdefine_line|#define V_FRONTPORCH                1
DECL|macro|H_OFFSET
mdefine_line|#define H_OFFSET                    40
DECL|macro|H_SCALEFACTOR
mdefine_line|#define H_SCALEFACTOR               20
DECL|macro|H_BLANKSCALE
mdefine_line|#define H_BLANKSCALE                128
DECL|macro|H_GRADIENT
mdefine_line|#define H_GRADIENT                  600
DECL|macro|C_VAL
mdefine_line|#define C_VAL                       30
DECL|macro|M_VAL
mdefine_line|#define M_VAL                       300
DECL|struct|__fb_timings
r_struct
id|__fb_timings
(brace
DECL|member|dclk
id|u32
id|dclk
suffix:semicolon
DECL|member|hfreq
id|u32
id|hfreq
suffix:semicolon
DECL|member|vfreq
id|u32
id|vfreq
suffix:semicolon
DECL|member|hactive
id|u32
id|hactive
suffix:semicolon
DECL|member|vactive
id|u32
id|vactive
suffix:semicolon
DECL|member|hblank
id|u32
id|hblank
suffix:semicolon
DECL|member|vblank
id|u32
id|vblank
suffix:semicolon
DECL|member|htotal
id|u32
id|htotal
suffix:semicolon
DECL|member|vtotal
id|u32
id|vtotal
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * a simple function to get the square root of integers &n; */
DECL|function|fb_sqrt
r_static
id|u32
id|fb_sqrt
c_func
(paren
r_int
id|x
)paren
(brace
r_register
r_int
id|op
comma
id|res
comma
id|one
suffix:semicolon
id|op
op_assign
id|x
suffix:semicolon
id|res
op_assign
l_int|0
suffix:semicolon
id|one
op_assign
l_int|1
op_lshift
l_int|30
suffix:semicolon
r_while
c_loop
(paren
id|one
OG
id|op
)paren
id|one
op_rshift_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|one
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|op
op_ge
id|res
op_plus
id|one
)paren
(brace
id|op
op_assign
id|op
op_minus
(paren
id|res
op_plus
id|one
)paren
suffix:semicolon
id|res
op_assign
id|res
op_plus
l_int|2
op_star
id|one
suffix:semicolon
)brace
id|res
op_div_assign
l_int|2
suffix:semicolon
id|one
op_div_assign
l_int|4
suffix:semicolon
)brace
r_return
(paren
id|u32
)paren
id|res
suffix:semicolon
)brace
multiline_comment|/**&n; * fb_get_vblank - get vertical blank time&n; * @hfreq: horizontal freq&n; *&n; * DESCRIPTION:&n; * vblank = right_margin + vsync_len + left_margin &n; *&n; *    given: right_margin = 1 (V_FRONTPORCH)&n; *           vsync_len    = 3&n; *           flyback      = 550&n; *&n; *                          flyback * hfreq&n; *           left_margin  = --------------- - vsync_len&n; *                           1000000&n; */
DECL|function|fb_get_vblank
r_static
id|u32
id|fb_get_vblank
c_func
(paren
id|u32
id|hfreq
)paren
(brace
id|u32
id|vblank
suffix:semicolon
id|vblank
op_assign
(paren
id|hfreq
op_star
id|FLYBACK
)paren
op_div
l_int|1000
suffix:semicolon
id|vblank
op_assign
(paren
id|vblank
op_plus
l_int|500
)paren
op_div
l_int|1000
suffix:semicolon
r_return
(paren
id|vblank
op_plus
id|V_FRONTPORCH
)paren
suffix:semicolon
)brace
multiline_comment|/** &n; * fb_get_hblank_by_freq - get horizontal blank time given hfreq&n; * @hfreq: horizontal freq&n; * @xres: horizontal resolution in pixels&n; *&n; * DESCRIPTION:&n; *&n; *           xres * duty_cycle&n; * hblank = ------------------&n; *           100 - duty_cycle&n; *&n; * duty cycle = percent of htotal assigned to inactive display&n; * duty cycle = C - (M/Hfreq)&n; *&n; * where: C = ((offset - scale factor) * blank_scale)&n; *            -------------------------------------- + scale factor&n; *                        256 &n; *        M = blank_scale * gradient&n; *&n; */
DECL|function|fb_get_hblank_by_hfreq
r_static
id|u32
id|fb_get_hblank_by_hfreq
c_func
(paren
id|u32
id|hfreq
comma
id|u32
id|xres
)paren
(brace
id|u32
id|c_val
comma
id|m_val
comma
id|duty_cycle
comma
id|hblank
suffix:semicolon
id|c_val
op_assign
(paren
(paren
(paren
id|H_OFFSET
op_minus
id|H_SCALEFACTOR
)paren
op_star
id|H_BLANKSCALE
)paren
op_div
l_int|256
op_plus
id|H_SCALEFACTOR
)paren
op_star
l_int|1000
suffix:semicolon
id|m_val
op_assign
(paren
id|H_BLANKSCALE
op_star
id|H_GRADIENT
)paren
op_div
l_int|256
suffix:semicolon
id|m_val
op_assign
(paren
id|m_val
op_star
l_int|1000000
)paren
op_div
id|hfreq
suffix:semicolon
id|duty_cycle
op_assign
id|c_val
op_minus
id|m_val
suffix:semicolon
id|hblank
op_assign
(paren
id|xres
op_star
id|duty_cycle
)paren
op_div
(paren
l_int|100000
op_minus
id|duty_cycle
)paren
suffix:semicolon
r_return
(paren
id|hblank
)paren
suffix:semicolon
)brace
multiline_comment|/** &n; * fb_get_hblank_by_dclk - get horizontal blank time given pixelclock&n; * @dclk: pixelclock in Hz&n; * @xres: horizontal resolution in pixels&n; *&n; * DESCRIPTION:&n; *&n; *           xres * duty_cycle&n; * hblank = ------------------&n; *           100 - duty_cycle&n; *&n; * duty cycle = percent of htotal assigned to inactive display&n; * duty cycle = C - (M * h_period)&n; * &n; * where: h_period = SQRT(100 - C + (0.4 * xres * M)/dclk) + C - 100&n; *                   -----------------------------------------------&n; *                                    2 * M&n; *        M = 300;&n; *        C = 30;&n;&n; */
DECL|function|fb_get_hblank_by_dclk
r_static
id|u32
id|fb_get_hblank_by_dclk
c_func
(paren
id|u32
id|dclk
comma
id|u32
id|xres
)paren
(brace
id|u32
id|duty_cycle
comma
id|h_period
comma
id|hblank
suffix:semicolon
suffix:semicolon
id|dclk
op_div_assign
l_int|1000
suffix:semicolon
id|h_period
op_assign
l_int|100
op_minus
id|C_VAL
suffix:semicolon
id|h_period
op_mul_assign
id|h_period
suffix:semicolon
id|h_period
op_add_assign
(paren
id|M_VAL
op_star
id|xres
op_star
l_int|2
op_star
l_int|1000
)paren
op_div
(paren
l_int|5
op_star
id|dclk
)paren
suffix:semicolon
id|h_period
op_mul_assign
l_int|10000
suffix:semicolon
id|h_period
op_assign
id|fb_sqrt
c_func
(paren
(paren
r_int
)paren
id|h_period
)paren
suffix:semicolon
id|h_period
op_sub_assign
(paren
l_int|100
op_minus
id|C_VAL
)paren
op_star
l_int|100
suffix:semicolon
id|h_period
op_mul_assign
l_int|1000
suffix:semicolon
id|h_period
op_div_assign
l_int|2
op_star
id|M_VAL
suffix:semicolon
id|duty_cycle
op_assign
id|C_VAL
op_star
l_int|1000
op_minus
(paren
id|M_VAL
op_star
id|h_period
)paren
op_div
l_int|100
suffix:semicolon
id|hblank
op_assign
(paren
id|xres
op_star
id|duty_cycle
)paren
op_div
(paren
l_int|100000
op_minus
id|duty_cycle
)paren
op_plus
l_int|8
suffix:semicolon
id|hblank
op_and_assign
op_complement
l_int|15
suffix:semicolon
r_return
(paren
id|hblank
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fb_get_hfreq - estimate hsync&n; * @vfreq: vertical refresh rate&n; * @yres: vertical resolution&n; *&n; * DESCRIPTION:&n; *&n; *          (yres + front_port) * vfreq * 1000000&n; * hfreq = -------------------------------------&n; *          (1000000 - (vfreq * FLYBACK)&n; * &n; */
DECL|function|fb_get_hfreq
r_static
id|u32
id|fb_get_hfreq
c_func
(paren
id|u32
id|vfreq
comma
id|u32
id|yres
)paren
(brace
id|u32
id|divisor
comma
id|hfreq
suffix:semicolon
id|divisor
op_assign
(paren
l_int|1000000
op_minus
(paren
id|vfreq
op_star
id|FLYBACK
)paren
)paren
op_div
l_int|1000
suffix:semicolon
id|hfreq
op_assign
(paren
id|yres
op_plus
id|V_FRONTPORCH
)paren
op_star
id|vfreq
op_star
l_int|1000
suffix:semicolon
r_return
(paren
id|hfreq
op_div
id|divisor
)paren
suffix:semicolon
)brace
DECL|function|fb_timings_vfreq
r_static
r_void
id|fb_timings_vfreq
c_func
(paren
r_struct
id|__fb_timings
op_star
id|timings
)paren
(brace
id|timings-&gt;hfreq
op_assign
id|fb_get_hfreq
c_func
(paren
id|timings-&gt;vfreq
comma
id|timings-&gt;vactive
)paren
suffix:semicolon
id|timings-&gt;vblank
op_assign
id|fb_get_vblank
c_func
(paren
id|timings-&gt;hfreq
)paren
suffix:semicolon
id|timings-&gt;vtotal
op_assign
id|timings-&gt;vactive
op_plus
id|timings-&gt;vblank
suffix:semicolon
id|timings-&gt;hblank
op_assign
id|fb_get_hblank_by_hfreq
c_func
(paren
id|timings-&gt;hfreq
comma
id|timings-&gt;hactive
)paren
suffix:semicolon
id|timings-&gt;htotal
op_assign
id|timings-&gt;hactive
op_plus
id|timings-&gt;hblank
suffix:semicolon
id|timings-&gt;dclk
op_assign
id|timings-&gt;htotal
op_star
id|timings-&gt;hfreq
suffix:semicolon
)brace
DECL|function|fb_timings_hfreq
r_static
r_void
id|fb_timings_hfreq
c_func
(paren
r_struct
id|__fb_timings
op_star
id|timings
)paren
(brace
id|timings-&gt;vblank
op_assign
id|fb_get_vblank
c_func
(paren
id|timings-&gt;hfreq
)paren
suffix:semicolon
id|timings-&gt;vtotal
op_assign
id|timings-&gt;vactive
op_plus
id|timings-&gt;vblank
suffix:semicolon
id|timings-&gt;vfreq
op_assign
id|timings-&gt;hfreq
op_div
id|timings-&gt;vtotal
suffix:semicolon
id|timings-&gt;hblank
op_assign
id|fb_get_hblank_by_hfreq
c_func
(paren
id|timings-&gt;hfreq
comma
id|timings-&gt;hactive
)paren
suffix:semicolon
id|timings-&gt;htotal
op_assign
id|timings-&gt;hactive
op_plus
id|timings-&gt;hblank
suffix:semicolon
id|timings-&gt;dclk
op_assign
id|timings-&gt;htotal
op_star
id|timings-&gt;hfreq
suffix:semicolon
)brace
DECL|function|fb_timings_dclk
r_static
r_void
id|fb_timings_dclk
c_func
(paren
r_struct
id|__fb_timings
op_star
id|timings
)paren
(brace
id|timings-&gt;hblank
op_assign
id|fb_get_hblank_by_dclk
c_func
(paren
id|timings-&gt;dclk
comma
id|timings-&gt;hactive
)paren
suffix:semicolon
id|timings-&gt;htotal
op_assign
id|timings-&gt;hactive
op_plus
id|timings-&gt;hblank
suffix:semicolon
id|timings-&gt;hfreq
op_assign
id|timings-&gt;dclk
op_div
id|timings-&gt;htotal
suffix:semicolon
id|timings-&gt;vblank
op_assign
id|fb_get_vblank
c_func
(paren
id|timings-&gt;hfreq
)paren
suffix:semicolon
id|timings-&gt;vtotal
op_assign
id|timings-&gt;vactive
op_plus
id|timings-&gt;vblank
suffix:semicolon
id|timings-&gt;vfreq
op_assign
id|timings-&gt;hfreq
op_div
id|timings-&gt;vtotal
suffix:semicolon
)brace
multiline_comment|/*&n; * fb_get_mode - calculates video mode using VESA GTF&n; * @flags: if: 0 - maximize vertical refresh rate&n; *             1 - vrefresh-driven calculation;&n; *             2 - hscan-driven calculation;&n; *             3 - pixelclock-driven calculation;&n; * @val: depending on @flags, ignored, vrefresh, hsync or pixelclock&n; * @var: pointer to fb_var_screeninfo&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * Calculates video mode based on monitor specs using VESA GTF. &n; * The GTF is best for VESA GTF compliant monitors but is &n; * specifically formulated to work for older monitors as well.&n; *&n; * If @flag==0, the function will attempt to maximize the &n; * refresh rate.  Otherwise, it will calculate timings based on&n; * the flag and accompanying value.  &n; *&n; * If FB_IGNOREMON bit is set in @flags, monitor specs will be &n; * ignored and @var will be filled with the calculated timings.&n; *&n; * All calculations are based on the VESA GTF Spreadsheet&n; * available at VESA&squot;s public ftp (http://www.vesa.org).&n; * &n; * NOTES:&n; * The timings generated by the GTF will be different from VESA&n; * DMT.  It might be a good idea to keep a table of standard&n; * VESA modes as well.  The GTF may also not work for some displays,&n; * such as, and especially, analog TV.&n; *   &n; * REQUIRES:&n; * A valid info-&gt;monspecs, otherwise &squot;safe numbers&squot; will be used.&n; */
DECL|function|fb_get_mode
r_int
id|fb_get_mode
c_func
(paren
r_int
id|flags
comma
id|u32
id|val
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|__fb_timings
id|timings
suffix:semicolon
id|u32
id|interlace
op_assign
l_int|1
comma
id|dscan
op_assign
l_int|1
suffix:semicolon
id|u32
id|hfmin
comma
id|hfmax
comma
id|vfmin
comma
id|vfmax
comma
id|dclkmin
comma
id|dclkmax
suffix:semicolon
multiline_comment|/* &n;&t; * If monspecs are invalid, use values that are enough&n;&t; * for 640x480@60&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;monspecs.hfmax
op_logical_or
op_logical_neg
id|info-&gt;monspecs.vfmax
op_logical_or
op_logical_neg
id|info-&gt;monspecs.dclkmax
op_logical_or
id|info-&gt;monspecs.hfmax
OL
id|info-&gt;monspecs.hfmin
op_logical_or
id|info-&gt;monspecs.vfmax
OL
id|info-&gt;monspecs.vfmin
op_logical_or
id|info-&gt;monspecs.dclkmax
OL
id|info-&gt;monspecs.dclkmin
)paren
(brace
id|hfmin
op_assign
l_int|29000
suffix:semicolon
id|hfmax
op_assign
l_int|30000
suffix:semicolon
id|vfmin
op_assign
l_int|60
suffix:semicolon
id|vfmax
op_assign
l_int|60
suffix:semicolon
id|dclkmin
op_assign
l_int|0
suffix:semicolon
id|dclkmax
op_assign
l_int|25000000
suffix:semicolon
)brace
r_else
(brace
id|hfmin
op_assign
id|info-&gt;monspecs.hfmin
suffix:semicolon
id|hfmax
op_assign
id|info-&gt;monspecs.hfmax
suffix:semicolon
id|vfmin
op_assign
id|info-&gt;monspecs.vfmin
suffix:semicolon
id|vfmax
op_assign
id|info-&gt;monspecs.vfmax
suffix:semicolon
id|dclkmin
op_assign
id|info-&gt;monspecs.dclkmin
suffix:semicolon
id|dclkmax
op_assign
id|info-&gt;monspecs.dclkmax
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|timings
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|__fb_timings
)paren
)paren
suffix:semicolon
id|timings.hactive
op_assign
id|var-&gt;xres
suffix:semicolon
id|timings.vactive
op_assign
id|var-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
id|timings.vactive
op_div_assign
l_int|2
suffix:semicolon
id|interlace
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|timings.vactive
op_mul_assign
l_int|2
suffix:semicolon
id|dscan
op_assign
l_int|2
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|flags
op_amp
op_complement
id|FB_IGNOREMON
)paren
(brace
r_case
id|FB_MAXTIMINGS
suffix:colon
multiline_comment|/* maximize refresh rate */
id|timings.hfreq
op_assign
id|hfmax
suffix:semicolon
id|fb_timings_hfreq
c_func
(paren
op_amp
id|timings
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timings.vfreq
OG
id|vfmax
)paren
(brace
id|timings.vfreq
op_assign
id|vfmax
suffix:semicolon
id|fb_timings_vfreq
c_func
(paren
op_amp
id|timings
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FB_VSYNCTIMINGS
suffix:colon
multiline_comment|/* vrefresh driven */
id|timings.vfreq
op_assign
id|val
suffix:semicolon
id|fb_timings_vfreq
c_func
(paren
op_amp
id|timings
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_HSYNCTIMINGS
suffix:colon
multiline_comment|/* hsync driven */
id|timings.hfreq
op_assign
id|val
suffix:semicolon
id|fb_timings_hfreq
c_func
(paren
op_amp
id|timings
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_DCLKTIMINGS
suffix:colon
multiline_comment|/* pixelclock driven */
id|timings.dclk
op_assign
id|PICOS2KHZ
c_func
(paren
id|val
)paren
op_star
l_int|1000
suffix:semicolon
id|fb_timings_dclk
c_func
(paren
op_amp
id|timings
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|FB_IGNOREMON
)paren
op_logical_and
(paren
id|timings.vfreq
template_param
id|vfmax
op_logical_or
id|timings.hfreq
template_param
id|hfmax
op_logical_or
id|timings.dclk
template_param
id|dclkmax
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|KHZ2PICOS
c_func
(paren
id|timings.dclk
op_div
l_int|1000
)paren
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
id|timings.htotal
op_star
l_int|8
)paren
op_div
l_int|100
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
id|timings.hblank
op_div
l_int|2
)paren
op_minus
id|var-&gt;hsync_len
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|timings.hblank
op_minus
id|var-&gt;right_margin
op_minus
id|var-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
(paren
l_int|3
op_star
id|interlace
)paren
op_div
id|dscan
suffix:semicolon
id|var-&gt;lower_margin
op_assign
(paren
l_int|1
op_star
id|interlace
)paren
op_div
id|dscan
suffix:semicolon
id|var-&gt;upper_margin
op_assign
(paren
id|timings.vblank
op_star
id|interlace
)paren
op_div
id|dscan
op_minus
(paren
id|var-&gt;vsync_len
op_plus
id|var-&gt;lower_margin
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * fb_validate_mode - validates var against monitor capabilities&n; * @var: pointer to fb_var_screeninfo&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * Validates video mode against monitor capabilities specified in&n; * info-&gt;monspecs.&n; *&n; * REQUIRES:&n; * A valid info-&gt;monspecs.&n; */
DECL|function|fb_validate_mode
r_int
id|fb_validate_mode
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
id|hfreq
comma
id|vfreq
comma
id|htotal
comma
id|vtotal
comma
id|pixclock
suffix:semicolon
id|u32
id|hfmin
comma
id|hfmax
comma
id|vfmin
comma
id|vfmax
comma
id|dclkmin
comma
id|dclkmax
suffix:semicolon
multiline_comment|/* &n;&t; * If monspecs are invalid, use values that are enough&n;&t; * for 640x480@60&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;monspecs.hfmax
op_logical_or
op_logical_neg
id|info-&gt;monspecs.vfmax
op_logical_or
op_logical_neg
id|info-&gt;monspecs.dclkmax
op_logical_or
id|info-&gt;monspecs.hfmax
OL
id|info-&gt;monspecs.hfmin
op_logical_or
id|info-&gt;monspecs.vfmax
OL
id|info-&gt;monspecs.vfmin
op_logical_or
id|info-&gt;monspecs.dclkmax
OL
id|info-&gt;monspecs.dclkmin
)paren
(brace
id|hfmin
op_assign
l_int|29000
suffix:semicolon
id|hfmax
op_assign
l_int|30000
suffix:semicolon
id|vfmin
op_assign
l_int|60
suffix:semicolon
id|vfmax
op_assign
l_int|60
suffix:semicolon
id|dclkmin
op_assign
l_int|0
suffix:semicolon
id|dclkmax
op_assign
l_int|25000000
suffix:semicolon
)brace
r_else
(brace
id|hfmin
op_assign
id|info-&gt;monspecs.hfmin
suffix:semicolon
id|hfmax
op_assign
id|info-&gt;monspecs.hfmax
suffix:semicolon
id|vfmin
op_assign
id|info-&gt;monspecs.vfmin
suffix:semicolon
id|vfmax
op_assign
id|info-&gt;monspecs.vfmax
suffix:semicolon
id|dclkmin
op_assign
id|info-&gt;monspecs.dclkmin
suffix:semicolon
id|dclkmax
op_assign
id|info-&gt;monspecs.dclkmax
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|var-&gt;pixclock
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pixclock
op_assign
id|PICOS2KHZ
c_func
(paren
id|var-&gt;pixclock
)paren
op_star
l_int|1000
suffix:semicolon
id|htotal
op_assign
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|vtotal
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
id|vtotal
op_div_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
id|vtotal
op_mul_assign
l_int|2
suffix:semicolon
id|hfreq
op_assign
id|pixclock
op_div
id|htotal
suffix:semicolon
id|vfreq
op_assign
id|hfreq
op_div
id|vtotal
suffix:semicolon
r_return
(paren
id|vfreq
template_param
id|vfmax
op_logical_or
id|hfreq
template_param
id|hfmax
)paren
ques
c_cond
op_minus
id|EINVAL
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|variable|parse_edid
id|EXPORT_SYMBOL
c_func
(paren
id|parse_edid
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|variable|get_EDID
id|EXPORT_SYMBOL
c_func
(paren
id|get_EDID
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|fb_get_mode
id|EXPORT_SYMBOL
c_func
(paren
id|fb_get_mode
)paren
suffix:semicolon
DECL|variable|fb_validate_mode
id|EXPORT_SYMBOL
c_func
(paren
id|fb_validate_mode
)paren
suffix:semicolon
eof
