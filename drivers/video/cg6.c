multiline_comment|/* cg6.c: CGSIX (GX, GXplus, TGX) frame buffer driver&n; *&n; * Copyright (C) 2003 David S. Miller (davem@redhat.com)&n; * Copyright (C) 1996,1998 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)&n; *&n; * Driver layout based loosely on tgafb.c, see that file for credits.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &quot;sbuslib.h&quot;
multiline_comment|/*&n; * Local functions.&n; */
r_static
r_int
id|cg6_setcolreg
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg6_blank
c_func
(paren
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|cg6_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|fb_image
op_star
)paren
suffix:semicolon
r_static
r_void
id|cg6_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|fb_fillrect
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg6_sync
c_func
(paren
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg6_mmap
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|cg6_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *  Frame buffer operations&n; */
DECL|variable|cg6_ops
r_static
r_struct
id|fb_ops
id|cg6_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_setcolreg
op_assign
id|cg6_setcolreg
comma
dot
id|fb_blank
op_assign
id|cg6_blank
comma
dot
id|fb_fillrect
op_assign
id|cg6_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cg6_imageblit
comma
dot
id|fb_sync
op_assign
id|cg6_sync
comma
dot
id|fb_mmap
op_assign
id|cg6_mmap
comma
dot
id|fb_ioctl
op_assign
id|cg6_ioctl
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/* Offset of interesting structures in the OBIO space */
multiline_comment|/*&n; * Brooktree is the video dac and is funny to program on the cg6.&n; * (it&squot;s even funnier on the cg3)&n; * The FBC could be the frame buffer control&n; * The FHC could is the frame buffer hardware control.&n; */
DECL|macro|CG6_ROM_OFFSET
mdefine_line|#define CG6_ROM_OFFSET       0x0UL
DECL|macro|CG6_BROOKTREE_OFFSET
mdefine_line|#define CG6_BROOKTREE_OFFSET 0x200000UL
DECL|macro|CG6_DHC_OFFSET
mdefine_line|#define CG6_DHC_OFFSET       0x240000UL
DECL|macro|CG6_ALT_OFFSET
mdefine_line|#define CG6_ALT_OFFSET       0x280000UL
DECL|macro|CG6_FHC_OFFSET
mdefine_line|#define CG6_FHC_OFFSET       0x300000UL
DECL|macro|CG6_THC_OFFSET
mdefine_line|#define CG6_THC_OFFSET       0x301000UL
DECL|macro|CG6_FBC_OFFSET
mdefine_line|#define CG6_FBC_OFFSET       0x700000UL
DECL|macro|CG6_TEC_OFFSET
mdefine_line|#define CG6_TEC_OFFSET       0x701000UL
DECL|macro|CG6_RAM_OFFSET
mdefine_line|#define CG6_RAM_OFFSET       0x800000UL
multiline_comment|/* FHC definitions */
DECL|macro|CG6_FHC_FBID_SHIFT
mdefine_line|#define CG6_FHC_FBID_SHIFT           24
DECL|macro|CG6_FHC_FBID_MASK
mdefine_line|#define CG6_FHC_FBID_MASK            255
DECL|macro|CG6_FHC_REV_SHIFT
mdefine_line|#define CG6_FHC_REV_SHIFT            20
DECL|macro|CG6_FHC_REV_MASK
mdefine_line|#define CG6_FHC_REV_MASK             15
DECL|macro|CG6_FHC_FROP_DISABLE
mdefine_line|#define CG6_FHC_FROP_DISABLE         (1 &lt;&lt; 19)
DECL|macro|CG6_FHC_ROW_DISABLE
mdefine_line|#define CG6_FHC_ROW_DISABLE          (1 &lt;&lt; 18)
DECL|macro|CG6_FHC_SRC_DISABLE
mdefine_line|#define CG6_FHC_SRC_DISABLE          (1 &lt;&lt; 17)
DECL|macro|CG6_FHC_DST_DISABLE
mdefine_line|#define CG6_FHC_DST_DISABLE          (1 &lt;&lt; 16)
DECL|macro|CG6_FHC_RESET
mdefine_line|#define CG6_FHC_RESET                (1 &lt;&lt; 15)
DECL|macro|CG6_FHC_LITTLE_ENDIAN
mdefine_line|#define CG6_FHC_LITTLE_ENDIAN        (1 &lt;&lt; 13)
DECL|macro|CG6_FHC_RES_MASK
mdefine_line|#define CG6_FHC_RES_MASK             (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_1024
mdefine_line|#define CG6_FHC_1024                 (0 &lt;&lt; 11)
DECL|macro|CG6_FHC_1152
mdefine_line|#define CG6_FHC_1152                 (1 &lt;&lt; 11)
DECL|macro|CG6_FHC_1280
mdefine_line|#define CG6_FHC_1280                 (2 &lt;&lt; 11)
DECL|macro|CG6_FHC_1600
mdefine_line|#define CG6_FHC_1600                 (3 &lt;&lt; 11)
DECL|macro|CG6_FHC_CPU_MASK
mdefine_line|#define CG6_FHC_CPU_MASK             (3 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_SPARC
mdefine_line|#define CG6_FHC_CPU_SPARC            (0 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_68020
mdefine_line|#define CG6_FHC_CPU_68020            (1 &lt;&lt; 9)
DECL|macro|CG6_FHC_CPU_386
mdefine_line|#define CG6_FHC_CPU_386              (2 &lt;&lt; 9)
DECL|macro|CG6_FHC_TEST
mdefine_line|#define CG6_FHC_TEST&t;&t;     (1 &lt;&lt; 8)
DECL|macro|CG6_FHC_TEST_X_SHIFT
mdefine_line|#define CG6_FHC_TEST_X_SHIFT&t;     4
DECL|macro|CG6_FHC_TEST_X_MASK
mdefine_line|#define CG6_FHC_TEST_X_MASK&t;     15
DECL|macro|CG6_FHC_TEST_Y_SHIFT
mdefine_line|#define CG6_FHC_TEST_Y_SHIFT&t;     0
DECL|macro|CG6_FHC_TEST_Y_MASK
mdefine_line|#define CG6_FHC_TEST_Y_MASK&t;     15
multiline_comment|/* FBC mode definitions */
DECL|macro|CG6_FBC_BLIT_IGNORE
mdefine_line|#define CG6_FBC_BLIT_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BLIT_NOSRC
mdefine_line|#define CG6_FBC_BLIT_NOSRC&t;&t;0x00100000
DECL|macro|CG6_FBC_BLIT_SRC
mdefine_line|#define CG6_FBC_BLIT_SRC&t;&t;0x00200000
DECL|macro|CG6_FBC_BLIT_ILLEGAL
mdefine_line|#define CG6_FBC_BLIT_ILLEGAL&t;&t;0x00300000
DECL|macro|CG6_FBC_BLIT_MASK
mdefine_line|#define CG6_FBC_BLIT_MASK&t;&t;0x00300000
DECL|macro|CG6_FBC_VBLANK
mdefine_line|#define CG6_FBC_VBLANK&t;&t;&t;0x00080000
DECL|macro|CG6_FBC_MODE_IGNORE
mdefine_line|#define CG6_FBC_MODE_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_MODE_COLOR8
mdefine_line|#define CG6_FBC_MODE_COLOR8&t;&t;0x00020000
DECL|macro|CG6_FBC_MODE_COLOR1
mdefine_line|#define CG6_FBC_MODE_COLOR1&t;&t;0x00040000
DECL|macro|CG6_FBC_MODE_HRMONO
mdefine_line|#define CG6_FBC_MODE_HRMONO&t;&t;0x00060000
DECL|macro|CG6_FBC_MODE_MASK
mdefine_line|#define CG6_FBC_MODE_MASK&t;&t;0x00060000
DECL|macro|CG6_FBC_DRAW_IGNORE
mdefine_line|#define CG6_FBC_DRAW_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_DRAW_RENDER
mdefine_line|#define CG6_FBC_DRAW_RENDER&t;&t;0x00008000
DECL|macro|CG6_FBC_DRAW_PICK
mdefine_line|#define CG6_FBC_DRAW_PICK&t;&t;0x00010000
DECL|macro|CG6_FBC_DRAW_ILLEGAL
mdefine_line|#define CG6_FBC_DRAW_ILLEGAL&t;&t;0x00018000
DECL|macro|CG6_FBC_DRAW_MASK
mdefine_line|#define CG6_FBC_DRAW_MASK&t;&t;0x00018000
DECL|macro|CG6_FBC_BWRITE0_IGNORE
mdefine_line|#define CG6_FBC_BWRITE0_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE0_ENABLE
mdefine_line|#define CG6_FBC_BWRITE0_ENABLE&t;&t;0x00002000
DECL|macro|CG6_FBC_BWRITE0_DISABLE
mdefine_line|#define CG6_FBC_BWRITE0_DISABLE&t;&t;0x00004000
DECL|macro|CG6_FBC_BWRITE0_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE0_ILLEGAL&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE0_MASK
mdefine_line|#define CG6_FBC_BWRITE0_MASK&t;&t;0x00006000
DECL|macro|CG6_FBC_BWRITE1_IGNORE
mdefine_line|#define CG6_FBC_BWRITE1_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BWRITE1_ENABLE
mdefine_line|#define CG6_FBC_BWRITE1_ENABLE&t;&t;0x00000800
DECL|macro|CG6_FBC_BWRITE1_DISABLE
mdefine_line|#define CG6_FBC_BWRITE1_DISABLE&t;&t;0x00001000
DECL|macro|CG6_FBC_BWRITE1_ILLEGAL
mdefine_line|#define CG6_FBC_BWRITE1_ILLEGAL&t;&t;0x00001800
DECL|macro|CG6_FBC_BWRITE1_MASK
mdefine_line|#define CG6_FBC_BWRITE1_MASK&t;&t;0x00001800
DECL|macro|CG6_FBC_BREAD_IGNORE
mdefine_line|#define CG6_FBC_BREAD_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BREAD_0
mdefine_line|#define CG6_FBC_BREAD_0&t;&t;&t;0x00000200
DECL|macro|CG6_FBC_BREAD_1
mdefine_line|#define CG6_FBC_BREAD_1&t;&t;&t;0x00000400
DECL|macro|CG6_FBC_BREAD_ILLEGAL
mdefine_line|#define CG6_FBC_BREAD_ILLEGAL&t;&t;0x00000600
DECL|macro|CG6_FBC_BREAD_MASK
mdefine_line|#define CG6_FBC_BREAD_MASK&t;&t;0x00000600
DECL|macro|CG6_FBC_BDISP_IGNORE
mdefine_line|#define CG6_FBC_BDISP_IGNORE&t;&t;0x00000000
DECL|macro|CG6_FBC_BDISP_0
mdefine_line|#define CG6_FBC_BDISP_0&t;&t;&t;0x00000080
DECL|macro|CG6_FBC_BDISP_1
mdefine_line|#define CG6_FBC_BDISP_1&t;&t;&t;0x00000100
DECL|macro|CG6_FBC_BDISP_ILLEGAL
mdefine_line|#define CG6_FBC_BDISP_ILLEGAL&t;&t;0x00000180
DECL|macro|CG6_FBC_BDISP_MASK
mdefine_line|#define CG6_FBC_BDISP_MASK&t;&t;0x00000180
DECL|macro|CG6_FBC_INDEX_MOD
mdefine_line|#define CG6_FBC_INDEX_MOD&t;&t;0x00000040
DECL|macro|CG6_FBC_INDEX_MASK
mdefine_line|#define CG6_FBC_INDEX_MASK&t;&t;0x00000030
multiline_comment|/* THC definitions */
DECL|macro|CG6_THC_MISC_REV_SHIFT
mdefine_line|#define CG6_THC_MISC_REV_SHIFT       16
DECL|macro|CG6_THC_MISC_REV_MASK
mdefine_line|#define CG6_THC_MISC_REV_MASK        15
DECL|macro|CG6_THC_MISC_RESET
mdefine_line|#define CG6_THC_MISC_RESET           (1 &lt;&lt; 12)
DECL|macro|CG6_THC_MISC_VIDEO
mdefine_line|#define CG6_THC_MISC_VIDEO           (1 &lt;&lt; 10)
DECL|macro|CG6_THC_MISC_SYNC
mdefine_line|#define CG6_THC_MISC_SYNC            (1 &lt;&lt; 9)
DECL|macro|CG6_THC_MISC_VSYNC
mdefine_line|#define CG6_THC_MISC_VSYNC           (1 &lt;&lt; 8)
DECL|macro|CG6_THC_MISC_SYNC_ENAB
mdefine_line|#define CG6_THC_MISC_SYNC_ENAB       (1 &lt;&lt; 7)
DECL|macro|CG6_THC_MISC_CURS_RES
mdefine_line|#define CG6_THC_MISC_CURS_RES        (1 &lt;&lt; 6)
DECL|macro|CG6_THC_MISC_INT_ENAB
mdefine_line|#define CG6_THC_MISC_INT_ENAB        (1 &lt;&lt; 5)
DECL|macro|CG6_THC_MISC_INT
mdefine_line|#define CG6_THC_MISC_INT             (1 &lt;&lt; 4)
DECL|macro|CG6_THC_MISC_INIT
mdefine_line|#define CG6_THC_MISC_INIT            0x9f
multiline_comment|/* The contents are unknown */
DECL|struct|cg6_tec
r_struct
id|cg6_tec
(brace
DECL|member|tec_matrix
r_volatile
r_int
id|tec_matrix
suffix:semicolon
DECL|member|tec_clip
r_volatile
r_int
id|tec_clip
suffix:semicolon
DECL|member|tec_vdc
r_volatile
r_int
id|tec_vdc
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cg6_thc
r_struct
id|cg6_thc
(brace
DECL|member|thc_pad0
id|uint
id|thc_pad0
(braket
l_int|512
)braket
suffix:semicolon
DECL|member|thc_hs
r_volatile
id|uint
id|thc_hs
suffix:semicolon
multiline_comment|/* hsync timing */
DECL|member|thc_hsdvs
r_volatile
id|uint
id|thc_hsdvs
suffix:semicolon
DECL|member|thc_hd
r_volatile
id|uint
id|thc_hd
suffix:semicolon
DECL|member|thc_vs
r_volatile
id|uint
id|thc_vs
suffix:semicolon
multiline_comment|/* vsync timing */
DECL|member|thc_vd
r_volatile
id|uint
id|thc_vd
suffix:semicolon
DECL|member|thc_refresh
r_volatile
id|uint
id|thc_refresh
suffix:semicolon
DECL|member|thc_misc
r_volatile
id|uint
id|thc_misc
suffix:semicolon
DECL|member|thc_pad1
id|uint
id|thc_pad1
(braket
l_int|56
)braket
suffix:semicolon
DECL|member|thc_cursxy
r_volatile
id|uint
id|thc_cursxy
suffix:semicolon
multiline_comment|/* cursor x,y position (16 bits each) */
DECL|member|thc_cursmask
r_volatile
id|uint
id|thc_cursmask
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* cursor mask bits */
DECL|member|thc_cursbits
r_volatile
id|uint
id|thc_cursbits
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* what to show where mask enabled */
)brace
suffix:semicolon
DECL|struct|cg6_fbc
r_struct
id|cg6_fbc
(brace
DECL|member|xxx0
id|u32
id|xxx0
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|mode
r_volatile
id|u32
id|mode
suffix:semicolon
DECL|member|clip
r_volatile
id|u32
id|clip
suffix:semicolon
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|s
r_volatile
id|u32
id|s
suffix:semicolon
DECL|member|draw
r_volatile
id|u32
id|draw
suffix:semicolon
DECL|member|blit
r_volatile
id|u32
id|blit
suffix:semicolon
DECL|member|font
r_volatile
id|u32
id|font
suffix:semicolon
DECL|member|xxx2
id|u32
id|xxx2
(braket
l_int|24
)braket
suffix:semicolon
DECL|member|x0
DECL|member|y0
DECL|member|z0
DECL|member|color0
r_volatile
id|u32
id|x0
comma
id|y0
comma
id|z0
comma
id|color0
suffix:semicolon
DECL|member|x1
DECL|member|y1
DECL|member|z1
DECL|member|color1
r_volatile
id|u32
id|x1
comma
id|y1
comma
id|z1
comma
id|color1
suffix:semicolon
DECL|member|x2
DECL|member|y2
DECL|member|z2
DECL|member|color2
r_volatile
id|u32
id|x2
comma
id|y2
comma
id|z2
comma
id|color2
suffix:semicolon
DECL|member|x3
DECL|member|y3
DECL|member|z3
DECL|member|color3
r_volatile
id|u32
id|x3
comma
id|y3
comma
id|z3
comma
id|color3
suffix:semicolon
DECL|member|offx
DECL|member|offy
r_volatile
id|u32
id|offx
comma
id|offy
suffix:semicolon
DECL|member|xxx3
id|u32
id|xxx3
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|incx
DECL|member|incy
r_volatile
id|u32
id|incx
comma
id|incy
suffix:semicolon
DECL|member|xxx4
id|u32
id|xxx4
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipminx
DECL|member|clipminy
r_volatile
id|u32
id|clipminx
comma
id|clipminy
suffix:semicolon
DECL|member|xxx5
id|u32
id|xxx5
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|clipmaxx
DECL|member|clipmaxy
r_volatile
id|u32
id|clipmaxx
comma
id|clipmaxy
suffix:semicolon
DECL|member|xxx6
id|u32
id|xxx6
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|fg
r_volatile
id|u32
id|fg
suffix:semicolon
DECL|member|bg
r_volatile
id|u32
id|bg
suffix:semicolon
DECL|member|alu
r_volatile
id|u32
id|alu
suffix:semicolon
DECL|member|pm
r_volatile
id|u32
id|pm
suffix:semicolon
DECL|member|pixelm
r_volatile
id|u32
id|pixelm
suffix:semicolon
DECL|member|xxx7
id|u32
id|xxx7
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|patalign
r_volatile
id|u32
id|patalign
suffix:semicolon
DECL|member|pattern
r_volatile
id|u32
id|pattern
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|xxx8
id|u32
id|xxx8
(braket
l_int|432
)braket
suffix:semicolon
DECL|member|apointx
DECL|member|apointy
DECL|member|apointz
r_volatile
id|u32
id|apointx
comma
id|apointy
comma
id|apointz
suffix:semicolon
DECL|member|xxx9
id|u32
id|xxx9
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rpointx
DECL|member|rpointy
DECL|member|rpointz
r_volatile
id|u32
id|rpointx
comma
id|rpointy
comma
id|rpointz
suffix:semicolon
DECL|member|xxx10
id|u32
id|xxx10
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|pointr
DECL|member|pointg
DECL|member|pointb
DECL|member|pointa
r_volatile
id|u32
id|pointr
comma
id|pointg
comma
id|pointb
comma
id|pointa
suffix:semicolon
DECL|member|alinex
DECL|member|aliney
DECL|member|alinez
r_volatile
id|u32
id|alinex
comma
id|aliney
comma
id|alinez
suffix:semicolon
DECL|member|xxx11
id|u32
id|xxx11
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rlinex
DECL|member|rliney
DECL|member|rlinez
r_volatile
id|u32
id|rlinex
comma
id|rliney
comma
id|rlinez
suffix:semicolon
DECL|member|xxx12
id|u32
id|xxx12
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|liner
DECL|member|lineg
DECL|member|lineb
DECL|member|linea
r_volatile
id|u32
id|liner
comma
id|lineg
comma
id|lineb
comma
id|linea
suffix:semicolon
DECL|member|atrix
DECL|member|atriy
DECL|member|atriz
r_volatile
id|u32
id|atrix
comma
id|atriy
comma
id|atriz
suffix:semicolon
DECL|member|xxx13
id|u32
id|xxx13
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rtrix
DECL|member|rtriy
DECL|member|rtriz
r_volatile
id|u32
id|rtrix
comma
id|rtriy
comma
id|rtriz
suffix:semicolon
DECL|member|xxx14
id|u32
id|xxx14
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|trir
DECL|member|trig
DECL|member|trib
DECL|member|tria
r_volatile
id|u32
id|trir
comma
id|trig
comma
id|trib
comma
id|tria
suffix:semicolon
DECL|member|aquadx
DECL|member|aquady
DECL|member|aquadz
r_volatile
id|u32
id|aquadx
comma
id|aquady
comma
id|aquadz
suffix:semicolon
DECL|member|xxx15
id|u32
id|xxx15
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rquadx
DECL|member|rquady
DECL|member|rquadz
r_volatile
id|u32
id|rquadx
comma
id|rquady
comma
id|rquadz
suffix:semicolon
DECL|member|xxx16
id|u32
id|xxx16
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|quadr
DECL|member|quadg
DECL|member|quadb
DECL|member|quada
r_volatile
id|u32
id|quadr
comma
id|quadg
comma
id|quadb
comma
id|quada
suffix:semicolon
DECL|member|arectx
DECL|member|arecty
DECL|member|arectz
r_volatile
id|u32
id|arectx
comma
id|arecty
comma
id|arectz
suffix:semicolon
DECL|member|xxx17
id|u32
id|xxx17
(braket
l_int|1
)braket
suffix:semicolon
DECL|member|rrectx
DECL|member|rrecty
DECL|member|rrectz
r_volatile
id|u32
id|rrectx
comma
id|rrecty
comma
id|rrectz
suffix:semicolon
DECL|member|xxx18
id|u32
id|xxx18
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|rectr
DECL|member|rectg
DECL|member|rectb
DECL|member|recta
r_volatile
id|u32
id|rectr
comma
id|rectg
comma
id|rectb
comma
id|recta
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|bt_regs
r_struct
id|bt_regs
(brace
DECL|member|addr
r_volatile
id|u32
id|addr
suffix:semicolon
DECL|member|color_map
r_volatile
id|u32
id|color_map
suffix:semicolon
DECL|member|control
r_volatile
id|u32
id|control
suffix:semicolon
DECL|member|cursor
r_volatile
id|u32
id|cursor
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cg6_par
r_struct
id|cg6_par
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|bt
r_struct
id|bt_regs
op_star
id|bt
suffix:semicolon
DECL|member|fbc
r_struct
id|cg6_fbc
op_star
id|fbc
suffix:semicolon
DECL|member|thc
r_struct
id|cg6_thc
op_star
id|thc
suffix:semicolon
DECL|member|tec
r_struct
id|cg6_tec
op_star
id|tec
suffix:semicolon
DECL|member|fhc
r_volatile
id|u32
op_star
id|fhc
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|CG6_FLAG_BLANKED
mdefine_line|#define CG6_FLAG_BLANKED&t;0x00000001
DECL|member|physbase
r_int
r_int
id|physbase
suffix:semicolon
DECL|member|fbsize
r_int
r_int
id|fbsize
suffix:semicolon
DECL|member|sdev
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
DECL|function|cg6_sync
r_static
r_int
id|cg6_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_int
id|limit
op_assign
l_int|10000
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
op_amp
l_int|0x10000000
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|limit
OG
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      cg6_fillrect - REQUIRED function. Can use generic routines if &n; *                     non acclerated hardware and packed pixel based.&n; *                     Draws a rectangle on the screen.               &n; *&n; *      @info: frame buffer structure that represents a single frame buffer&n; *      @rect: structure defining the rectagle and operation.&n; */
DECL|function|cg6_fillrect
r_static
r_void
id|cg6_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|s32
id|val
suffix:semicolon
multiline_comment|/* XXX doesn&squot;t handle ROP_XOR */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cg6_sync
c_func
(paren
id|info
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|rect-&gt;color
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xea80ff00
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|rect-&gt;dy
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|rect-&gt;dx
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|rect-&gt;dy
op_plus
id|rect-&gt;height
comma
op_amp
id|fbc-&gt;arecty
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|rect-&gt;dx
op_plus
id|rect-&gt;width
comma
op_amp
id|fbc-&gt;arectx
)paren
suffix:semicolon
r_do
(brace
id|val
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;draw
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|val
OL
l_int|0
op_logical_and
(paren
id|val
op_amp
l_int|0x20000000
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *      cg6_imageblit - REQUIRED function. Can use generic routines if&n; *                      non acclerated hardware and packed pixel based.&n; *                      Copies a image from system memory to the screen. &n; *&n; *      @info: frame buffer structure that represents a single frame buffer&n; *      @image: structure defining the image.&n; */
DECL|function|cg6_imageblit
r_static
r_void
id|cg6_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_image
op_star
id|image
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|image-&gt;data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|x
comma
id|y
suffix:semicolon
r_int
id|i
comma
id|width
suffix:semicolon
r_if
c_cond
(paren
id|image-&gt;depth
OG
l_int|1
)paren
(brace
id|cfb_imageblit
c_func
(paren
id|info
comma
id|image
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cg6_sync
c_func
(paren
id|info
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|image-&gt;fg_color
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|image-&gt;bg_color
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x140000
comma
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xe880fc30
comma
op_amp
id|fbc-&gt;alu
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
comma
op_amp
id|fbc-&gt;pixelm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0xff
comma
op_amp
id|fbc-&gt;pm
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|32
comma
op_amp
id|fbc-&gt;incx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;incy
)paren
suffix:semicolon
id|x
op_assign
id|image-&gt;dx
suffix:semicolon
id|y
op_assign
id|image-&gt;dy
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|image-&gt;height
suffix:semicolon
id|i
op_increment
)paren
(brace
id|width
op_assign
id|image-&gt;width
suffix:semicolon
r_while
c_loop
(paren
id|width
op_ge
l_int|32
)paren
(brace
id|u32
id|val
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
op_plus
l_int|32
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|3
)braket
op_lshift
l_int|0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
id|x
op_add_assign
l_int|32
suffix:semicolon
id|width
op_sub_assign
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
)paren
(brace
id|u32
id|val
suffix:semicolon
id|sbus_writel
c_func
(paren
id|y
comma
op_amp
id|fbc-&gt;y0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
comma
op_amp
id|fbc-&gt;x0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|x
op_plus
id|width
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;x1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
op_le
l_int|8
)paren
(brace
id|val
op_assign
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
suffix:semicolon
id|data
op_add_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|width
op_le
l_int|16
)paren
(brace
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
id|data
op_add_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|data
op_add_assign
l_int|3
suffix:semicolon
)brace
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
id|y
op_add_assign
l_int|1
suffix:semicolon
id|x
op_assign
id|image-&gt;dx
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *      cg6_setcolreg - Optional function. Sets a color register.&n; *      @regno: boolean, 0 copy local, 1 get_user() function&n; *      @red: frame buffer colormap structure&n; *      @green: The green value which can be up to 16 bits wide&n; *      @blue:  The blue value which can be up to 16 bits wide.&n; *      @transp: If supported the alpha value which can be up to 16 bits wide.&n; *      @info: frame buffer info structure&n; */
DECL|function|cg6_setcolreg
r_static
r_int
id|cg6_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|par-&gt;bt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
l_int|256
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|u32
)paren
id|regno
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|u32
)paren
id|red
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|u32
)paren
id|green
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
(paren
id|u32
)paren
id|blue
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;color_map
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      cg6_blank - Optional function.  Blanks the display.&n; *      @blank_mode: the blank mode we want.&n; *      @info: frame buffer structure that represents a single frame buffer&n; */
r_static
r_int
DECL|function|cg6_blank
id|cg6_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg6_thc
op_star
id|thc
op_assign
id|par-&gt;thc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Unblanking */
id|val
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|thc-&gt;thc_misc
)paren
suffix:semicolon
id|val
op_or_assign
id|CG6_THC_MISC_VIDEO
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|thc-&gt;thc_misc
)paren
suffix:semicolon
id|par-&gt;flags
op_and_assign
op_complement
id|CG6_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Normal blanking */
r_case
l_int|2
suffix:colon
multiline_comment|/* VESA blank (vsync off) */
r_case
l_int|3
suffix:colon
multiline_comment|/* VESA blank (hsync off) */
r_case
l_int|4
suffix:colon
multiline_comment|/* Poweroff */
id|val
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|thc-&gt;thc_misc
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|CG6_THC_MISC_VIDEO
suffix:semicolon
id|sbus_writel
c_func
(paren
id|val
comma
op_amp
id|thc-&gt;thc_misc
)paren
suffix:semicolon
id|par-&gt;flags
op_or_assign
id|CG6_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cg6_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|cg6_mmap_map
(braket
)braket
op_assign
(brace
(brace
id|CG6_FBC
comma
id|CG6_FBC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_TEC
comma
id|CG6_TEC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_BTREGS
comma
id|CG6_BROOKTREE_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_FHC
comma
id|CG6_FHC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_THC
comma
id|CG6_THC_OFFSET
comma
id|PAGE_SIZE
)brace
comma
(brace
id|CG6_ROM
comma
id|CG6_ROM_OFFSET
comma
l_int|0x10000
)brace
comma
(brace
id|CG6_RAM
comma
id|CG6_RAM_OFFSET
comma
id|SBUS_MMAP_FBSIZE
c_func
(paren
l_int|1
)paren
)brace
comma
(brace
id|CG6_DHC
comma
id|CG6_DHC_OFFSET
comma
l_int|0x40000
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|cg6_mmap
r_static
r_int
id|cg6_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_mmap_helper
c_func
(paren
id|cg6_mmap_map
comma
id|par-&gt;physbase
comma
id|par-&gt;fbsize
comma
id|par-&gt;sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
id|vma
)paren
suffix:semicolon
)brace
DECL|function|cg6_ioctl
r_static
r_int
id|cg6_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_ioctl_helper
c_func
(paren
id|cmd
comma
id|arg
comma
id|info
comma
id|FBTYPE_SUNFAST_COLOR
comma
l_int|8
comma
id|par-&gt;fbsize
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Initialisation&n; */
r_static
r_void
DECL|function|cg6_init_fix
id|cg6_init_fix
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|linebytes
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_const
r_char
op_star
id|cg6_cpu_name
comma
op_star
id|cg6_card_name
suffix:semicolon
id|u32
id|conf
suffix:semicolon
id|conf
op_assign
id|sbus_readl
c_func
(paren
id|par-&gt;fhc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf
op_amp
id|CG6_FHC_CPU_MASK
)paren
(brace
r_case
id|CG6_FHC_CPU_SPARC
suffix:colon
id|cg6_cpu_name
op_assign
l_string|&quot;sparc&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CG6_FHC_CPU_68020
suffix:colon
id|cg6_cpu_name
op_assign
l_string|&quot;68020&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cg6_cpu_name
op_assign
l_string|&quot;i386&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|conf
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
)paren
op_ge
l_int|11
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;fbsize
op_le
l_int|0x100000
)paren
(brace
id|cg6_card_name
op_assign
l_string|&quot;TGX&quot;
suffix:semicolon
)brace
r_else
(brace
id|cg6_card_name
op_assign
l_string|&quot;TGX+&quot;
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|par-&gt;fbsize
op_le
l_int|0x100000
)paren
(brace
id|cg6_card_name
op_assign
l_string|&quot;GX&quot;
suffix:semicolon
)brace
r_else
(brace
id|cg6_card_name
op_assign
l_string|&quot;GX+&quot;
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|info-&gt;fix.id
comma
l_string|&quot;%s %s&quot;
comma
id|cg6_card_name
comma
id|cg6_cpu_name
)paren
suffix:semicolon
id|info-&gt;fix.id
(braket
r_sizeof
(paren
id|info-&gt;fix.id
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
id|info-&gt;fix.line_length
op_assign
id|linebytes
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_SUN_CGSIX
suffix:semicolon
)brace
multiline_comment|/* Initialize Brooktree DAC */
DECL|function|cg6_bt_init
r_static
r_void
id|cg6_bt_init
c_func
(paren
r_struct
id|cg6_par
op_star
id|par
)paren
(brace
r_struct
id|bt_regs
op_star
id|bt
op_assign
id|par-&gt;bt
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x04
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* color planes */
id|sbus_writel
c_func
(paren
l_int|0xff
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x05
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x06
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* overlay plane */
id|sbus_writel
c_func
(paren
l_int|0x73
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x07
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;addr
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
op_lshift
l_int|24
comma
op_amp
id|bt-&gt;control
)paren
suffix:semicolon
)brace
DECL|function|cg6_chip_init
r_static
r_void
id|cg6_chip_init
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|cg6_par
op_star
id|par
op_assign
(paren
r_struct
id|cg6_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|cg6_tec
op_star
id|tec
op_assign
id|par-&gt;tec
suffix:semicolon
r_struct
id|cg6_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
id|u32
id|rev
comma
id|conf
comma
id|mode
comma
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Turn off stuff in the Transform Engine. */
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_matrix
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|tec-&gt;tec_vdc
)paren
suffix:semicolon
multiline_comment|/* Take care of bugs in old revisions. */
id|rev
op_assign
(paren
id|sbus_readl
c_func
(paren
id|par-&gt;fhc
)paren
op_rshift
id|CG6_FHC_REV_SHIFT
)paren
op_amp
id|CG6_FHC_REV_MASK
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|5
)paren
(brace
id|conf
op_assign
(paren
id|sbus_readl
c_func
(paren
id|par-&gt;fhc
)paren
op_amp
id|CG6_FHC_RES_MASK
)paren
op_or
id|CG6_FHC_CPU_68020
op_or
id|CG6_FHC_TEST
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_X_SHIFT
)paren
op_or
(paren
l_int|11
op_lshift
id|CG6_FHC_TEST_Y_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
OL
l_int|2
)paren
id|conf
op_or_assign
id|CG6_FHC_DST_DISABLE
suffix:semicolon
id|sbus_writel
c_func
(paren
id|conf
comma
id|par-&gt;fhc
)paren
suffix:semicolon
)brace
multiline_comment|/* Set things in the FBC. Bad things appear to happen if we do&n;&t; * back to back store/loads on the mode register, so copy it&n;&t; * out instead. */
id|mode
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
r_do
(brace
id|i
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|fbc-&gt;s
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_amp
l_int|0x10000000
)paren
suffix:semicolon
id|mode
op_and_assign
op_complement
(paren
id|CG6_FBC_BLIT_MASK
op_or
id|CG6_FBC_MODE_MASK
op_or
id|CG6_FBC_DRAW_MASK
op_or
id|CG6_FBC_BWRITE0_MASK
op_or
id|CG6_FBC_BWRITE1_MASK
op_or
id|CG6_FBC_BREAD_MASK
op_or
id|CG6_FBC_BDISP_MASK
)paren
suffix:semicolon
id|mode
op_or_assign
(paren
id|CG6_FBC_BLIT_SRC
op_or
id|CG6_FBC_MODE_COLOR8
op_or
id|CG6_FBC_DRAW_RENDER
op_or
id|CG6_FBC_BWRITE0_ENABLE
op_or
id|CG6_FBC_BWRITE1_DISABLE
op_or
id|CG6_FBC_BREAD_0
op_or
id|CG6_FBC_BDISP_0
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|mode
comma
op_amp
id|fbc-&gt;mode
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clip
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;offx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;offy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clipminx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0
comma
op_amp
id|fbc-&gt;clipminy
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|info-&gt;var.xres
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;clipmaxx
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|info-&gt;var.yres
op_minus
l_int|1
comma
op_amp
id|fbc-&gt;clipmaxy
)paren
suffix:semicolon
multiline_comment|/* Disable cursor in Brooktree DAC. */
id|sbus_writel
c_func
(paren
l_int|0x06
op_lshift
l_int|24
comma
op_amp
id|par-&gt;bt-&gt;addr
)paren
suffix:semicolon
id|tmp
op_assign
id|sbus_readl
c_func
(paren
op_amp
id|par-&gt;bt-&gt;control
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0x03
op_lshift
l_int|24
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|tmp
comma
op_amp
id|par-&gt;bt-&gt;control
)paren
suffix:semicolon
)brace
DECL|struct|all_info
r_struct
id|all_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|par
r_struct
id|cg6_par
id|par
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|cg6_list
)paren
suffix:semicolon
DECL|function|cg6_init_one
r_static
r_void
id|cg6_init_one
c_func
(paren
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_struct
id|all_info
op_star
id|all
suffix:semicolon
r_int
id|linebytes
suffix:semicolon
id|all
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|all
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|all
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg6: Cannot allocate memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|all
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|all
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|all-&gt;list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|all-&gt;par.lock
)paren
suffix:semicolon
id|all-&gt;par.sdev
op_assign
id|sdev
suffix:semicolon
id|all-&gt;par.physbase
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|sbusfb_fill_var
c_func
(paren
op_amp
id|all-&gt;info.var
comma
id|sdev-&gt;prom_node
comma
l_int|8
)paren
suffix:semicolon
id|linebytes
op_assign
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;linebytes&quot;
comma
id|all-&gt;info.var.xres
)paren
suffix:semicolon
id|all-&gt;par.fbsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|linebytes
op_star
id|all-&gt;info.var.yres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prom_getbool
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;dblbuf&quot;
)paren
)paren
id|all-&gt;par.fbsize
op_mul_assign
l_int|4
suffix:semicolon
id|all-&gt;par.fbc
op_assign
(paren
r_struct
id|cg6_fbc
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_FBC_OFFSET
comma
l_int|4096
comma
l_string|&quot;cgsix fbc&quot;
)paren
suffix:semicolon
id|all-&gt;par.tec
op_assign
(paren
r_struct
id|cg6_tec
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_TEC_OFFSET
comma
r_sizeof
(paren
r_struct
id|cg6_tec
)paren
comma
l_string|&quot;cgsix tec&quot;
)paren
suffix:semicolon
id|all-&gt;par.thc
op_assign
(paren
r_struct
id|cg6_thc
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_THC_OFFSET
comma
r_sizeof
(paren
r_struct
id|cg6_thc
)paren
comma
l_string|&quot;cgsix thc&quot;
)paren
suffix:semicolon
id|all-&gt;par.bt
op_assign
(paren
r_struct
id|bt_regs
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_BROOKTREE_OFFSET
comma
r_sizeof
(paren
r_struct
id|bt_regs
)paren
comma
l_string|&quot;cgsix dac&quot;
)paren
suffix:semicolon
id|all-&gt;par.fhc
op_assign
(paren
id|u32
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_FHC_OFFSET
comma
r_sizeof
(paren
id|u32
)paren
comma
l_string|&quot;cgsix fhc&quot;
)paren
suffix:semicolon
id|all-&gt;info.node
op_assign
id|NODEV
suffix:semicolon
id|all-&gt;info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|all-&gt;info.fbops
op_assign
op_amp
id|cg6_ops
suffix:semicolon
macro_line|#ifdef CONFIG_SPARC32
id|all-&gt;info.screen_base
op_assign
(paren
r_char
op_star
)paren
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;address&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|all-&gt;info.screen_base
)paren
id|all-&gt;info.screen_base
op_assign
(paren
r_char
op_star
)paren
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
id|CG6_RAM_OFFSET
comma
id|all-&gt;par.fbsize
comma
l_string|&quot;cgsix ram&quot;
)paren
suffix:semicolon
id|all-&gt;info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|all-&gt;info.par
op_assign
op_amp
id|all-&gt;par
suffix:semicolon
id|all-&gt;info.var.accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|cg6_bt_init
c_func
(paren
op_amp
id|all-&gt;par
)paren
suffix:semicolon
id|cg6_chip_init
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|cg6_blank
c_func
(paren
l_int|0
comma
op_amp
id|all-&gt;info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_alloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
comma
l_int|256
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg6: Could not allocate color map.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cg6_init_fix
c_func
(paren
op_amp
id|all-&gt;info
comma
id|linebytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cg6: Could not register framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|all-&gt;list
comma
op_amp
id|cg6_list
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;cg6: CGsix [%s] at %lx:%lx&bslash;n&quot;
comma
id|all-&gt;info.fix.id
comma
(paren
r_int
)paren
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
(paren
r_int
)paren
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
)paren
suffix:semicolon
)brace
DECL|function|cg6_init
r_int
id|__init
id|cg6_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;cgsix&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;cgthree+&quot;
)paren
)paren
id|cg6_init_one
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cg6_exit
r_void
id|__exit
id|cg6_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|tmp
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|tmp
comma
op_amp
id|cg6_list
)paren
(brace
r_struct
id|all_info
op_star
id|all
op_assign
id|list_entry
c_func
(paren
id|pos
comma
id|typeof
c_func
(paren
op_star
id|all
)paren
comma
id|list
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|cg6_setup
id|cg6_setup
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
multiline_comment|/* No cmdline options yet... */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|cg6_init
id|module_init
c_func
(paren
id|cg6_init
)paren
suffix:semicolon
DECL|variable|cg6_exit
id|module_exit
c_func
(paren
id|cg6_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for CGsix chipsets&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller &lt;davem@redhat.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
