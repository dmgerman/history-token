multiline_comment|/*&n; * linux/drivers/video/w100fb.c&n; *&n; * Frame Buffer Device for ATI Imageon w100 (Wallaby)&n; *&n; * Copyright (C) 2002, ATI Corp.&n; * Copyright (C) 2004-2005 Richard Purdie&n; *&n; * Rewritten for 2.6 by Richard Purdie &lt;rpurdie@rpsys.net&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;video/w100fb.h&gt;
macro_line|#include &quot;w100fb.h&quot;
multiline_comment|/*&n; * Prototypes&n; */
r_static
r_void
id|w100fb_save_buffer
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100fb_clear_buffer
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100fb_restore_buffer
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100fb_clear_screen
c_func
(paren
id|u32
id|mode
comma
r_int
r_int
id|offset
)paren
suffix:semicolon
r_static
r_void
id|w100_resume
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100_suspend
c_func
(paren
id|u32
id|mode
)paren
suffix:semicolon
r_static
r_void
id|w100_init_qvga_rotation
c_func
(paren
id|u16
id|deg
)paren
suffix:semicolon
r_static
r_void
id|w100_init_vga_rotation
c_func
(paren
id|u16
id|deg
)paren
suffix:semicolon
r_static
r_void
id|w100_vsync
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100_init_sharp_lcd
c_func
(paren
id|u32
id|mode
)paren
suffix:semicolon
r_static
r_void
id|w100_pwm_setup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|w100_InitExtMem
c_func
(paren
id|u32
id|mode
)paren
suffix:semicolon
r_static
r_void
id|w100_hw_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
id|u16
id|w100_set_fastsysclk
c_func
(paren
id|u16
id|Freq
)paren
suffix:semicolon
r_static
r_void
id|lcdtg_hw_init
c_func
(paren
id|u32
id|mode
)paren
suffix:semicolon
r_static
r_void
id|lcdtg_lcd_change
c_func
(paren
id|u32
id|mode
)paren
suffix:semicolon
r_static
r_void
id|lcdtg_resume
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|lcdtg_suspend
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Register offsets &amp; lengths */
DECL|macro|REMAPPED_FB_LEN
mdefine_line|#define REMAPPED_FB_LEN   0x15ffff
DECL|macro|BITS_PER_PIXEL
mdefine_line|#define BITS_PER_PIXEL    16
multiline_comment|/* Pseudo palette size */
DECL|macro|MAX_PALETTES
mdefine_line|#define MAX_PALETTES      16
multiline_comment|/* for resolution change */
DECL|macro|LCD_MODE_INIT
mdefine_line|#define LCD_MODE_INIT (-1)
DECL|macro|LCD_MODE_480
mdefine_line|#define LCD_MODE_480    0
DECL|macro|LCD_MODE_320
mdefine_line|#define LCD_MODE_320    1
DECL|macro|LCD_MODE_240
mdefine_line|#define LCD_MODE_240    2
DECL|macro|LCD_MODE_640
mdefine_line|#define LCD_MODE_640    3
DECL|macro|LCD_SHARP_QVGA
mdefine_line|#define LCD_SHARP_QVGA 0
DECL|macro|LCD_SHARP_VGA
mdefine_line|#define LCD_SHARP_VGA  1
DECL|macro|LCD_MODE_PORTRAIT
mdefine_line|#define LCD_MODE_PORTRAIT&t;0
DECL|macro|LCD_MODE_LANDSCAPE
mdefine_line|#define LCD_MODE_LANDSCAPE&t;1
DECL|macro|W100_SUSPEND_EXTMEM
mdefine_line|#define W100_SUSPEND_EXTMEM 0
DECL|macro|W100_SUSPEND_ALL
mdefine_line|#define W100_SUSPEND_ALL    1
multiline_comment|/* General frame buffer data structures */
DECL|struct|w100fb_par
r_struct
id|w100fb_par
(brace
DECL|member|xres
id|u32
id|xres
suffix:semicolon
DECL|member|yres
id|u32
id|yres
suffix:semicolon
DECL|member|fastsysclk_mode
r_int
id|fastsysclk_mode
suffix:semicolon
DECL|member|lcdMode
r_int
id|lcdMode
suffix:semicolon
DECL|member|rotation_flag
r_int
id|rotation_flag
suffix:semicolon
DECL|member|blanking_flag
r_int
id|blanking_flag
suffix:semicolon
DECL|member|comadj
r_int
id|comadj
suffix:semicolon
DECL|member|phadadj
r_int
id|phadadj
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|current_par
r_static
r_struct
id|w100fb_par
op_star
id|current_par
suffix:semicolon
DECL|variable|gSaveImagePtr
r_static
id|u16
op_star
id|gSaveImagePtr
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Remapped addresses for base cfg, memmapped regs and the frame buffer itself */
DECL|variable|remapped_base
r_static
r_void
op_star
id|remapped_base
suffix:semicolon
DECL|variable|remapped_regs
r_static
r_void
op_star
id|remapped_regs
suffix:semicolon
DECL|variable|remapped_fbuf
r_static
r_void
op_star
id|remapped_fbuf
suffix:semicolon
multiline_comment|/* External Function */
DECL|variable|w100fb_ssp_send
r_static
r_void
(paren
op_star
id|w100fb_ssp_send
)paren
(paren
id|u8
id|adrs
comma
id|u8
id|data
)paren
suffix:semicolon
multiline_comment|/*&n; * Sysfs functions&n; */
DECL|function|rotation_show
r_static
id|ssize_t
id|rotation_show
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|par-&gt;rotation_flag
)paren
suffix:semicolon
)brace
DECL|function|rotation_store
r_static
id|ssize_t
id|rotation_store
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|rotate
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|rotate
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rotate
OG
l_int|0
)paren
id|par-&gt;rotation_flag
op_assign
l_int|1
suffix:semicolon
r_else
id|par-&gt;rotation_flag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_320
)paren
id|w100_init_qvga_rotation
c_func
(paren
id|par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_240
)paren
id|w100_init_qvga_rotation
c_func
(paren
id|par-&gt;rotation_flag
ques
c_cond
l_int|180
suffix:colon
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_640
)paren
id|w100_init_vga_rotation
c_func
(paren
id|par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_480
)paren
id|w100_init_vga_rotation
c_func
(paren
id|par-&gt;rotation_flag
ques
c_cond
l_int|180
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|rotation
comma
l_int|0644
comma
id|rotation_show
comma
id|rotation_store
)paren
suffix:semicolon
DECL|function|w100fb_reg_read
r_static
id|ssize_t
id|w100fb_reg_read
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|param
suffix:semicolon
r_int
r_int
id|regs
suffix:semicolon
id|regs
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|16
)paren
suffix:semicolon
id|param
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|regs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Read Register 0x%08lX: 0x%08lX&bslash;n&quot;
comma
id|regs
comma
id|param
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|reg_read
comma
l_int|0200
comma
l_int|NULL
comma
id|w100fb_reg_read
)paren
suffix:semicolon
DECL|function|w100fb_reg_write
r_static
id|ssize_t
id|w100fb_reg_write
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|regs
suffix:semicolon
r_int
r_int
id|param
suffix:semicolon
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%lx %lx&quot;
comma
op_amp
id|regs
comma
op_amp
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs
op_le
l_int|0x2000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Write Register 0x%08lX: 0x%08lX&bslash;n&quot;
comma
id|regs
comma
id|param
)paren
suffix:semicolon
id|writel
c_func
(paren
id|param
comma
id|remapped_regs
op_plus
id|regs
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|reg_write
comma
l_int|0200
comma
l_int|NULL
comma
id|w100fb_reg_write
)paren
suffix:semicolon
DECL|function|fastsysclk_show
r_static
id|ssize_t
id|fastsysclk_show
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|par-&gt;fastsysclk_mode
)paren
suffix:semicolon
)brace
DECL|function|fastsysclk_store
r_static
id|ssize_t
id|fastsysclk_store
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|param
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|param
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
op_eq
l_int|75
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Set fastsysclk %d&bslash;n&quot;
comma
id|param
)paren
suffix:semicolon
id|par-&gt;fastsysclk_mode
op_assign
id|param
suffix:semicolon
id|w100_set_fastsysclk
c_func
(paren
id|par-&gt;fastsysclk_mode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|param
op_eq
l_int|100
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Set fastsysclk %d&bslash;n&quot;
comma
id|param
)paren
suffix:semicolon
id|par-&gt;fastsysclk_mode
op_assign
id|param
suffix:semicolon
id|w100_set_fastsysclk
c_func
(paren
id|par-&gt;fastsysclk_mode
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|fastsysclk
comma
l_int|0644
comma
id|fastsysclk_show
comma
id|fastsysclk_store
)paren
suffix:semicolon
multiline_comment|/*&n; * The touchscreen on this device needs certain information&n; * from the video driver to function correctly. We export it here.&n; */
DECL|function|w100fb_get_xres
r_int
id|w100fb_get_xres
c_func
(paren
r_void
)paren
(brace
r_return
id|current_par-&gt;xres
suffix:semicolon
)brace
DECL|function|w100fb_get_blanking
r_int
id|w100fb_get_blanking
c_func
(paren
r_void
)paren
(brace
r_return
id|current_par-&gt;blanking_flag
suffix:semicolon
)brace
DECL|function|w100fb_get_fastsysclk
r_int
id|w100fb_get_fastsysclk
c_func
(paren
r_void
)paren
(brace
r_return
id|current_par-&gt;fastsysclk_mode
suffix:semicolon
)brace
DECL|variable|w100fb_get_xres
id|EXPORT_SYMBOL
c_func
(paren
id|w100fb_get_xres
)paren
suffix:semicolon
DECL|variable|w100fb_get_blanking
id|EXPORT_SYMBOL
c_func
(paren
id|w100fb_get_blanking
)paren
suffix:semicolon
DECL|variable|w100fb_get_fastsysclk
id|EXPORT_SYMBOL
c_func
(paren
id|w100fb_get_fastsysclk
)paren
suffix:semicolon
multiline_comment|/*&n; * Set a palette value from rgb components&n; */
DECL|function|w100fb_setcolreg
r_static
r_int
id|w100fb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|trans
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * If greyscale is true, then we convert the RGB value&n;&t; * to greyscale no matter what visual we are using.&n;&t; */
r_if
c_cond
(paren
id|info-&gt;var.grayscale
)paren
id|red
op_assign
id|green
op_assign
id|blue
op_assign
(paren
l_int|19595
op_star
id|red
op_plus
l_int|38470
op_star
id|green
op_plus
l_int|7471
op_star
id|blue
)paren
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/*&n;&t; * 16-bit True Colour.  We encode the RGB value&n;&t; * according to the RGB bitfield information.&n;&t; */
r_if
c_cond
(paren
id|regno
OL
id|MAX_PALETTES
)paren
(brace
id|u32
op_star
id|pal
op_assign
id|info-&gt;pseudo_palette
suffix:semicolon
id|val
op_assign
(paren
id|red
op_amp
l_int|0xf800
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
id|pal
(braket
id|regno
)braket
op_assign
id|val
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Blank the display based on value in blank_mode&n; */
DECL|function|w100fb_blank
r_static
r_int
id|w100fb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|w100fb_par
op_star
id|par
suffix:semicolon
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_switch
c_cond
(paren
id|blank_mode
)paren
(brace
r_case
id|FB_BLANK_NORMAL
suffix:colon
multiline_comment|/* Normal blanking */
r_case
id|FB_BLANK_VSYNC_SUSPEND
suffix:colon
multiline_comment|/* VESA blank (vsync off) */
r_case
id|FB_BLANK_HSYNC_SUSPEND
suffix:colon
multiline_comment|/* VESA blank (hsync off) */
r_case
id|FB_BLANK_POWERDOWN
suffix:colon
multiline_comment|/* Poweroff */
r_if
c_cond
(paren
id|par-&gt;blanking_flag
op_eq
l_int|0
)paren
(brace
id|w100fb_save_buffer
c_func
(paren
)paren
suffix:semicolon
id|lcdtg_suspend
c_func
(paren
)paren
suffix:semicolon
id|par-&gt;blanking_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FB_BLANK_UNBLANK
suffix:colon
multiline_comment|/* Unblanking */
r_if
c_cond
(paren
id|par-&gt;blanking_flag
op_ne
l_int|0
)paren
(brace
id|w100fb_restore_buffer
c_func
(paren
)paren
suffix:semicolon
id|lcdtg_resume
c_func
(paren
)paren
suffix:semicolon
id|par-&gt;blanking_flag
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Change the resolution by calling the appropriate hardware functions&n; */
DECL|function|w100fb_changeres
r_static
r_void
id|w100fb_changeres
c_func
(paren
r_int
id|rotate_mode
comma
id|u32
id|mode
)paren
(brace
id|u16
id|rotation
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|rotate_mode
)paren
(brace
r_case
id|LCD_MODE_LANDSCAPE
suffix:colon
id|rotation
op_assign
(paren
id|current_par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_MODE_PORTRAIT
suffix:colon
id|rotation
op_assign
(paren
id|current_par-&gt;rotation_flag
ques
c_cond
l_int|180
suffix:colon
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|w100_pwm_setup
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|LCD_SHARP_QVGA
suffix:colon
id|w100_vsync
c_func
(paren
)paren
suffix:semicolon
id|w100_suspend
c_func
(paren
id|W100_SUSPEND_EXTMEM
)paren
suffix:semicolon
id|w100_init_sharp_lcd
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
id|w100_init_qvga_rotation
c_func
(paren
id|rotation
)paren
suffix:semicolon
id|w100_InitExtMem
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
id|w100fb_clear_screen
c_func
(paren
id|LCD_SHARP_QVGA
comma
l_int|0
)paren
suffix:semicolon
id|lcdtg_lcd_change
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_SHARP_VGA
suffix:colon
id|w100fb_clear_screen
c_func
(paren
id|LCD_SHARP_QVGA
comma
l_int|0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xBFFFA000
comma
id|remapped_regs
op_plus
id|mmMC_EXT_MEM_LOCATION
)paren
suffix:semicolon
id|w100_InitExtMem
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
id|w100fb_clear_screen
c_func
(paren
id|LCD_SHARP_VGA
comma
l_int|0x200000
)paren
suffix:semicolon
id|w100_vsync
c_func
(paren
)paren
suffix:semicolon
id|w100_init_sharp_lcd
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rotation
op_ne
l_int|0
)paren
id|w100_init_vga_rotation
c_func
(paren
id|rotation
)paren
suffix:semicolon
id|lcdtg_lcd_change
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Set up the display for the fb subsystem&n; */
DECL|function|w100fb_activate_var
r_static
r_void
id|w100fb_activate_var
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
id|temp32
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
multiline_comment|/* Set the hardware to 565 */
id|temp32
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
id|temp32
op_and_assign
l_int|0xff7fffff
suffix:semicolon
id|temp32
op_or_assign
l_int|0x00800000
suffix:semicolon
id|writel
c_func
(paren
id|temp32
comma
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_INIT
)paren
(brace
id|w100_init_sharp_lcd
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
id|w100_init_vga_rotation
c_func
(paren
id|par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_640
suffix:semicolon
id|lcdtg_hw_init
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|320
op_logical_and
id|var-&gt;yres
op_eq
l_int|240
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_ne
id|LCD_MODE_320
)paren
(brace
id|w100fb_changeres
c_func
(paren
id|LCD_MODE_LANDSCAPE
comma
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_320
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|240
op_logical_and
id|var-&gt;yres
op_eq
l_int|320
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_ne
id|LCD_MODE_240
)paren
(brace
id|w100fb_changeres
c_func
(paren
id|LCD_MODE_PORTRAIT
comma
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_240
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|640
op_logical_and
id|var-&gt;yres
op_eq
l_int|480
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_ne
id|LCD_MODE_640
)paren
(brace
id|w100fb_changeres
c_func
(paren
id|LCD_MODE_LANDSCAPE
comma
id|LCD_SHARP_VGA
)paren
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_640
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;xres
op_eq
l_int|480
op_logical_and
id|var-&gt;yres
op_eq
l_int|640
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_ne
id|LCD_MODE_480
)paren
(brace
id|w100fb_changeres
c_func
(paren
id|LCD_MODE_PORTRAIT
comma
id|LCD_SHARP_VGA
)paren
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_480
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;W100FB: Resolution error!&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  w100fb_check_var():&n; *  Get the video params out of &squot;var&squot;. If a value doesn&squot;t fit, round it up,&n; *  if it&squot;s too big, return -EINVAL.&n; *&n; */
DECL|function|w100fb_check_var
r_static
r_int
id|w100fb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;xres
OL
id|var-&gt;yres
)paren
(brace
multiline_comment|/* Portrait mode */
r_if
c_cond
(paren
(paren
id|var-&gt;xres
OG
l_int|480
)paren
op_logical_or
(paren
id|var-&gt;yres
OG
l_int|640
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;xres
OG
l_int|240
)paren
op_logical_or
(paren
id|var-&gt;yres
OG
l_int|320
)paren
)paren
(brace
id|var-&gt;xres
op_assign
l_int|480
suffix:semicolon
id|var-&gt;yres
op_assign
l_int|640
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;xres
op_assign
l_int|240
suffix:semicolon
id|var-&gt;yres
op_assign
l_int|320
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Landscape mode */
r_if
c_cond
(paren
(paren
id|var-&gt;xres
OG
l_int|640
)paren
op_logical_or
(paren
id|var-&gt;yres
OG
l_int|480
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|var-&gt;xres
OG
l_int|320
)paren
op_logical_or
(paren
id|var-&gt;yres
OG
l_int|240
)paren
)paren
(brace
id|var-&gt;xres
op_assign
l_int|640
suffix:semicolon
id|var-&gt;yres
op_assign
l_int|480
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;xres
op_assign
l_int|320
suffix:semicolon
id|var-&gt;yres
op_assign
l_int|240
suffix:semicolon
)brace
)brace
id|var-&gt;xres_virtual
op_assign
id|max
c_func
(paren
id|var-&gt;xres_virtual
comma
id|var-&gt;xres
)paren
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|max
c_func
(paren
id|var-&gt;yres_virtual
comma
id|var-&gt;yres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
OG
id|BITS_PER_PIXEL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
id|var-&gt;bits_per_pixel
op_assign
id|BITS_PER_PIXEL
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;nonstd
op_assign
l_int|0
suffix:semicolon
id|var-&gt;height
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|var-&gt;pixclock
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 171521; */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * w100fb_set_par():&n; *&t;Set the user defined part of the display for the specified console&n; *  by looking at the values in info.var&n; */
DECL|function|w100fb_set_par
r_static
r_int
id|w100fb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|par-&gt;xres
op_assign
id|info-&gt;var.xres
suffix:semicolon
id|par-&gt;yres
op_assign
id|info-&gt;var.yres
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|info-&gt;fix.ypanstep
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.ywrapstep
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;blanking_flag
)paren
id|w100fb_clear_buffer
c_func
(paren
)paren
suffix:semicolon
id|w100fb_activate_var
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_480
)paren
(brace
id|info-&gt;fix.line_length
op_assign
(paren
l_int|480
op_star
id|BITS_PER_PIXEL
)paren
op_div
l_int|8
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
l_int|0x200000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_320
)paren
(brace
id|info-&gt;fix.line_length
op_assign
(paren
l_int|320
op_star
id|BITS_PER_PIXEL
)paren
op_div
l_int|8
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
l_int|0x60000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_240
)paren
(brace
id|info-&gt;fix.line_length
op_assign
(paren
l_int|240
op_star
id|BITS_PER_PIXEL
)paren
op_div
l_int|8
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
l_int|0x60000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_INIT
op_logical_or
id|par-&gt;lcdMode
op_eq
id|LCD_MODE_640
)paren
(brace
id|info-&gt;fix.line_length
op_assign
(paren
l_int|640
op_star
id|BITS_PER_PIXEL
)paren
op_div
l_int|8
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
l_int|0x200000
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *      Frame buffer operations&n; */
DECL|variable|w100fb_ops
r_static
r_struct
id|fb_ops
id|w100fb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_check_var
op_assign
id|w100fb_check_var
comma
dot
id|fb_set_par
op_assign
id|w100fb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|w100fb_setcolreg
comma
dot
id|fb_blank
op_assign
id|w100fb_blank
comma
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
DECL|function|w100fb_clear_screen
r_static
r_void
id|w100fb_clear_screen
c_func
(paren
id|u32
id|mode
comma
r_int
r_int
id|offset
)paren
(brace
r_int
id|i
comma
id|numPix
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|LCD_SHARP_VGA
)paren
id|numPix
op_assign
l_int|640
op_star
l_int|480
suffix:semicolon
r_else
r_if
c_cond
(paren
id|mode
op_eq
id|LCD_SHARP_QVGA
)paren
id|numPix
op_assign
l_int|320
op_star
l_int|240
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numPix
suffix:semicolon
id|i
op_increment
)paren
id|writew
c_func
(paren
l_int|0xffff
comma
id|remapped_fbuf
op_plus
id|offset
op_plus
(paren
l_int|2
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
DECL|function|w100fb_save_buffer
r_static
r_void
id|w100fb_save_buffer
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|gSaveImagePtr
op_ne
l_int|NULL
)paren
(brace
id|vfree
c_func
(paren
id|gSaveImagePtr
)paren
suffix:semicolon
id|gSaveImagePtr
op_assign
l_int|NULL
suffix:semicolon
)brace
id|gSaveImagePtr
op_assign
id|vmalloc
c_func
(paren
id|current_par-&gt;xres
op_star
id|current_par-&gt;yres
op_star
id|BITS_PER_PIXEL
op_div
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gSaveImagePtr
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|current_par-&gt;xres
op_star
id|current_par-&gt;yres
)paren
suffix:semicolon
id|i
op_increment
)paren
op_star
(paren
id|gSaveImagePtr
op_plus
id|i
)paren
op_assign
id|readw
c_func
(paren
id|remapped_fbuf
op_plus
(paren
l_int|2
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;can&squot;t alloc pre-off image buffer&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|w100fb_restore_buffer
r_static
r_void
id|w100fb_restore_buffer
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|gSaveImagePtr
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|current_par-&gt;xres
op_star
id|current_par-&gt;yres
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
op_star
(paren
id|gSaveImagePtr
op_plus
id|i
)paren
comma
id|remapped_fbuf
op_plus
(paren
l_int|2
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|gSaveImagePtr
)paren
suffix:semicolon
id|gSaveImagePtr
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|w100fb_clear_buffer
r_static
r_void
id|w100fb_clear_buffer
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|gSaveImagePtr
op_ne
l_int|NULL
)paren
(brace
id|vfree
c_func
(paren
id|gSaveImagePtr
)paren
suffix:semicolon
id|gSaveImagePtr
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|w100fb_suspend
r_static
r_int
id|w100fb_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_POWER_DOWN
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|w100fb_save_buffer
c_func
(paren
)paren
suffix:semicolon
id|lcdtg_suspend
c_func
(paren
)paren
suffix:semicolon
id|w100_suspend
c_func
(paren
id|W100_SUSPEND_ALL
)paren
suffix:semicolon
id|par-&gt;blanking_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w100fb_resume
r_static
r_int
id|w100fb_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|level
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
id|RESUME_POWER_ON
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|w100_resume
c_func
(paren
)paren
suffix:semicolon
id|w100fb_restore_buffer
c_func
(paren
)paren
suffix:semicolon
id|lcdtg_resume
c_func
(paren
)paren
suffix:semicolon
id|par-&gt;blanking_flag
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
DECL|macro|w100fb_suspend
mdefine_line|#define w100fb_suspend&t;NULL
DECL|macro|w100fb_resume
mdefine_line|#define w100fb_resume&t;NULL
macro_line|#endif
DECL|function|w100fb_probe
r_int
id|__init
id|w100fb_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|w100fb_mach_info
op_star
id|inf
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|w100fb_par
op_star
id|par
suffix:semicolon
r_struct
id|platform_device
op_star
id|pdev
op_assign
id|to_platform_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|resource
op_star
id|mem
op_assign
id|platform_get_resource
c_func
(paren
id|pdev
comma
id|IORESOURCE_MEM
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* remap the areas we&squot;re going to use */
id|remapped_base
op_assign
id|ioremap_nocache
c_func
(paren
id|mem-&gt;start
op_plus
id|W100_CFG_BASE
comma
id|W100_CFG_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remapped_base
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|remapped_regs
op_assign
id|ioremap_nocache
c_func
(paren
id|mem-&gt;start
op_plus
id|W100_REG_BASE
comma
id|W100_REG_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remapped_regs
op_eq
l_int|NULL
)paren
(brace
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|remapped_fbuf
op_assign
id|ioremap_nocache
c_func
(paren
id|mem-&gt;start
op_plus
id|MEM_EXT_BASE_VALUE
comma
id|REMAPPED_FB_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remapped_fbuf
op_eq
l_int|NULL
)paren
(brace
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_regs
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|w100fb_par
)paren
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_regs
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_fbuf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|info-&gt;device
op_assign
id|dev
suffix:semicolon
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|current_par
op_assign
id|info-&gt;par
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
id|dev
comma
id|info
)paren
suffix:semicolon
id|inf
op_assign
id|dev-&gt;platform_data
suffix:semicolon
id|par-&gt;phadadj
op_assign
id|inf-&gt;phadadj
suffix:semicolon
id|par-&gt;comadj
op_assign
id|inf-&gt;comadj
suffix:semicolon
id|par-&gt;fastsysclk_mode
op_assign
l_int|75
suffix:semicolon
id|par-&gt;lcdMode
op_assign
id|LCD_MODE_INIT
suffix:semicolon
id|par-&gt;rotation_flag
op_assign
l_int|0
suffix:semicolon
id|par-&gt;blanking_flag
op_assign
l_int|0
suffix:semicolon
id|w100fb_ssp_send
op_assign
id|inf-&gt;w100fb_ssp_send
suffix:semicolon
id|w100_hw_init
c_func
(paren
)paren
suffix:semicolon
id|w100_pwm_setup
c_func
(paren
)paren
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|u32
)paren
op_star
id|MAX_PALETTES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;pseudo_palette
)paren
(brace
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_regs
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_fbuf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|info-&gt;fbops
op_assign
op_amp
id|w100fb_ops
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_DEFAULT
suffix:semicolon
id|info-&gt;node
op_assign
op_minus
l_int|1
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|remapped_fbuf
suffix:semicolon
id|info-&gt;screen_size
op_assign
id|REMAPPED_FB_LEN
suffix:semicolon
id|info-&gt;var.xres
op_assign
l_int|640
suffix:semicolon
id|info-&gt;var.xres_virtual
op_assign
id|info-&gt;var.xres
suffix:semicolon
id|info-&gt;var.yres
op_assign
l_int|480
suffix:semicolon
id|info-&gt;var.yres_virtual
op_assign
id|info-&gt;var.yres
suffix:semicolon
id|info-&gt;var.pixclock
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 171521; */
id|info-&gt;var.sync
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.grayscale
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.accel_flags
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;fix.id
comma
l_string|&quot;w100fb&quot;
)paren
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.type_aux
op_assign
l_int|0
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
id|info-&gt;fix.smem_start
op_assign
id|mem-&gt;start
op_plus
id|MEM_EXT_BASE_VALUE
suffix:semicolon
id|info-&gt;fix.mmio_start
op_assign
id|mem-&gt;start
op_plus
id|W100_REG_BASE
suffix:semicolon
id|info-&gt;fix.mmio_len
op_assign
id|W100_REG_LEN
suffix:semicolon
id|w100fb_check_var
c_func
(paren
op_amp
id|info-&gt;var
comma
id|info
)paren
suffix:semicolon
id|w100fb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
id|info
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|info-&gt;pseudo_palette
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_regs
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_fbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_fastsysclk
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_reg_read
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_reg_write
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_rotation
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device&bslash;n&quot;
comma
id|info-&gt;node
comma
id|info-&gt;fix.id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w100fb_remove
r_static
r_int
id|w100fb_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_fastsysclk
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_reg_read
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_reg_write
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_rotation
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
id|w100fb_clear_buffer
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|info-&gt;pseudo_palette
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_regs
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|remapped_fbuf
)paren
suffix:semicolon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------- chipset specific functions -------------------------- */
DECL|function|w100_soft_reset
r_static
r_void
id|w100_soft_reset
c_func
(paren
r_void
)paren
(brace
id|u16
id|val
op_assign
id|readw
c_func
(paren
(paren
id|u16
op_star
)paren
id|remapped_base
op_plus
id|cfgSTATUS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|val
op_or
l_int|0x08
comma
(paren
id|u16
op_star
)paren
id|remapped_base
op_plus
id|cfgSTATUS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0x00
comma
(paren
id|u16
op_star
)paren
id|remapped_base
op_plus
id|cfgSTATUS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialization of critical w100 hardware&n; */
DECL|function|w100_hw_init
r_static
r_void
id|w100_hw_init
c_func
(paren
r_void
)paren
(brace
id|u32
id|temp32
suffix:semicolon
r_union
id|cif_cntl_u
id|cif_cntl
suffix:semicolon
r_union
id|intf_cntl_u
id|intf_cntl
suffix:semicolon
r_union
id|cfgreg_base_u
id|cfgreg_base
suffix:semicolon
r_union
id|wrap_top_dir_u
id|wrap_top_dir
suffix:semicolon
r_union
id|cif_read_dbg_u
id|cif_read_dbg
suffix:semicolon
r_union
id|cpu_defaults_u
id|cpu_default
suffix:semicolon
r_union
id|cif_write_dbg_u
id|cif_write_dbg
suffix:semicolon
r_union
id|wrap_start_dir_u
id|wrap_start_dir
suffix:semicolon
r_union
id|mc_ext_mem_location_u
id|mc_ext_mem_loc
suffix:semicolon
r_union
id|cif_io_u
id|cif_io
suffix:semicolon
id|w100_soft_reset
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This is what the fpga_init code does on reset. May be wrong&n;&t;   but there is little info available */
id|writel
c_func
(paren
l_int|0x31
comma
id|remapped_regs
op_plus
id|mmSCRATCH_UMSK
)paren
suffix:semicolon
r_for
c_loop
(paren
id|temp32
op_assign
l_int|0
suffix:semicolon
id|temp32
OL
l_int|10000
suffix:semicolon
id|temp32
op_increment
)paren
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmSCRATCH_UMSK
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x30
comma
id|remapped_regs
op_plus
id|mmSCRATCH_UMSK
)paren
suffix:semicolon
multiline_comment|/* Set up CIF */
id|cif_io.val
op_assign
id|defCIF_IO
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|cif_io.val
)paren
comma
id|remapped_regs
op_plus
id|mmCIF_IO
)paren
suffix:semicolon
id|cif_write_dbg.val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmCIF_WRITE_DBG
)paren
suffix:semicolon
id|cif_write_dbg.f.dis_packer_ful_during_rbbm_timeout
op_assign
l_int|0
suffix:semicolon
id|cif_write_dbg.f.en_dword_split_to_rbbm
op_assign
l_int|1
suffix:semicolon
id|cif_write_dbg.f.dis_timeout_during_rbbm
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|cif_write_dbg.val
)paren
comma
id|remapped_regs
op_plus
id|mmCIF_WRITE_DBG
)paren
suffix:semicolon
id|cif_read_dbg.val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmCIF_READ_DBG
)paren
suffix:semicolon
id|cif_read_dbg.f.dis_rd_same_byte_to_trig_fetch
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|cif_read_dbg.val
)paren
comma
id|remapped_regs
op_plus
id|mmCIF_READ_DBG
)paren
suffix:semicolon
id|cif_cntl.val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmCIF_CNTL
)paren
suffix:semicolon
id|cif_cntl.f.dis_system_bits
op_assign
l_int|1
suffix:semicolon
id|cif_cntl.f.dis_mr
op_assign
l_int|1
suffix:semicolon
id|cif_cntl.f.en_wait_to_compensate_dq_prop_dly
op_assign
l_int|0
suffix:semicolon
id|cif_cntl.f.intb_oe
op_assign
l_int|1
suffix:semicolon
id|cif_cntl.f.interrupt_active_high
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|cif_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCIF_CNTL
)paren
suffix:semicolon
multiline_comment|/* Setup cfgINTF_CNTL and cfgCPU defaults */
id|intf_cntl.val
op_assign
id|defINTF_CNTL
suffix:semicolon
id|intf_cntl.f.ad_inc_a
op_assign
l_int|1
suffix:semicolon
id|intf_cntl.f.ad_inc_b
op_assign
l_int|1
suffix:semicolon
id|intf_cntl.f.rd_data_rdy_a
op_assign
l_int|0
suffix:semicolon
id|intf_cntl.f.rd_data_rdy_b
op_assign
l_int|0
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|u8
)paren
(paren
id|intf_cntl.val
)paren
comma
id|remapped_base
op_plus
id|cfgINTF_CNTL
)paren
suffix:semicolon
id|cpu_default.val
op_assign
id|defCPU_DEFAULTS
suffix:semicolon
id|cpu_default.f.access_ind_addr_a
op_assign
l_int|1
suffix:semicolon
id|cpu_default.f.access_ind_addr_b
op_assign
l_int|1
suffix:semicolon
id|cpu_default.f.access_scratch_reg
op_assign
l_int|1
suffix:semicolon
id|cpu_default.f.transition_size
op_assign
l_int|0
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|u8
)paren
(paren
id|cpu_default.val
)paren
comma
id|remapped_base
op_plus
id|cfgCPU_DEFAULTS
)paren
suffix:semicolon
multiline_comment|/* set up the apertures */
id|writeb
c_func
(paren
(paren
id|u8
)paren
(paren
id|W100_REG_BASE
op_rshift
l_int|16
)paren
comma
id|remapped_base
op_plus
id|cfgREG_BASE
)paren
suffix:semicolon
id|cfgreg_base.val
op_assign
id|defCFGREG_BASE
suffix:semicolon
id|cfgreg_base.f.cfgreg_base
op_assign
id|W100_CFG_BASE
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|cfgreg_base.val
)paren
comma
id|remapped_regs
op_plus
id|mmCFGREG_BASE
)paren
suffix:semicolon
multiline_comment|/* This location is relative to internal w100 addresses */
id|writel
c_func
(paren
l_int|0x15FF1000
comma
id|remapped_regs
op_plus
id|mmMC_FB_LOCATION
)paren
suffix:semicolon
id|mc_ext_mem_loc.val
op_assign
id|defMC_EXT_MEM_LOCATION
suffix:semicolon
id|mc_ext_mem_loc.f.mc_ext_mem_start
op_assign
id|MEM_EXT_BASE_VALUE
op_rshift
l_int|8
suffix:semicolon
id|mc_ext_mem_loc.f.mc_ext_mem_top
op_assign
id|MEM_EXT_TOP_VALUE
op_rshift
l_int|8
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|mc_ext_mem_loc.val
)paren
comma
id|remapped_regs
op_plus
id|mmMC_EXT_MEM_LOCATION
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_240
)paren
op_logical_or
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_320
)paren
)paren
id|w100_InitExtMem
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
r_else
id|w100_InitExtMem
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
id|wrap_start_dir.val
op_assign
id|defWRAP_START_DIR
suffix:semicolon
id|wrap_start_dir.f.start_addr
op_assign
id|WRAP_BUF_BASE_VALUE
op_rshift
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|wrap_start_dir.val
)paren
comma
id|remapped_regs
op_plus
id|mmWRAP_START_DIR
)paren
suffix:semicolon
id|wrap_top_dir.val
op_assign
id|defWRAP_TOP_DIR
suffix:semicolon
id|wrap_top_dir.f.top_addr
op_assign
id|WRAP_BUF_TOP_VALUE
op_rshift
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|wrap_top_dir.val
)paren
comma
id|remapped_regs
op_plus
id|mmWRAP_TOP_DIR
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
l_int|0x2440
comma
id|remapped_regs
op_plus
id|mmRBBM_CNTL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Types&n; */
DECL|struct|pll_parm
r_struct
id|pll_parm
(brace
DECL|member|freq
id|u16
id|freq
suffix:semicolon
multiline_comment|/* desired Fout for PLL */
DECL|member|M
id|u8
id|M
suffix:semicolon
DECL|member|N_int
id|u8
id|N_int
suffix:semicolon
DECL|member|N_fac
id|u8
id|N_fac
suffix:semicolon
DECL|member|tfgoal
id|u8
id|tfgoal
suffix:semicolon
DECL|member|lock_time
id|u8
id|lock_time
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|power_state
r_struct
id|power_state
(brace
DECL|member|clk_pin_cntl
r_union
id|clk_pin_cntl_u
id|clk_pin_cntl
suffix:semicolon
DECL|member|pll_ref_fb_div
r_union
id|pll_ref_fb_div_u
id|pll_ref_fb_div
suffix:semicolon
DECL|member|pll_cntl
r_union
id|pll_cntl_u
id|pll_cntl
suffix:semicolon
DECL|member|sclk_cntl
r_union
id|sclk_cntl_u
id|sclk_cntl
suffix:semicolon
DECL|member|pclk_cntl
r_union
id|pclk_cntl_u
id|pclk_cntl
suffix:semicolon
DECL|member|clk_test_cntl
r_union
id|clk_test_cntl_u
id|clk_test_cntl
suffix:semicolon
DECL|member|pwrmgt_cntl
r_union
id|pwrmgt_cntl_u
id|pwrmgt_cntl
suffix:semicolon
DECL|member|freq
id|u32
id|freq
suffix:semicolon
multiline_comment|/* Fout for PLL calibration */
DECL|member|tf100
id|u8
id|tf100
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|tf80
id|u8
id|tf80
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|tf20
id|u8
id|tf20
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|M
id|u8
id|M
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|N_int
id|u8
id|N_int
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|N_fac
id|u8
id|N_fac
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|lock_time
id|u8
id|lock_time
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|tfgoal
id|u8
id|tfgoal
suffix:semicolon
multiline_comment|/* for pll calibration */
DECL|member|auto_mode
id|u8
id|auto_mode
suffix:semicolon
multiline_comment|/* hardware auto switch? */
DECL|member|pwm_mode
id|u8
id|pwm_mode
suffix:semicolon
multiline_comment|/* 0 fast, 1 normal/slow */
DECL|member|fast_sclk
id|u16
id|fast_sclk
suffix:semicolon
multiline_comment|/* fast clk freq */
DECL|member|norm_sclk
id|u16
id|norm_sclk
suffix:semicolon
multiline_comment|/* slow clk freq */
)brace
suffix:semicolon
multiline_comment|/*&n; * Global state variables&n; */
DECL|variable|w100_pwr_state
r_static
r_struct
id|power_state
id|w100_pwr_state
suffix:semicolon
multiline_comment|/* This table is specific for 12.5MHz ref crystal.  */
DECL|variable|gPLLTable
r_static
r_struct
id|pll_parm
id|gPLLTable
(braket
)braket
op_assign
(brace
multiline_comment|/*freq     M   N_int    N_fac  tfgoal  lock_time */
(brace
l_int|50
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0xE0
comma
l_int|56
)brace
comma
multiline_comment|/*  50.00 MHz */
(brace
l_int|75
comma
l_int|0
comma
l_int|5
comma
l_int|0
comma
l_int|0xDE
comma
l_int|37
)brace
comma
multiline_comment|/*  75.00 MHz */
(brace
l_int|100
comma
l_int|0
comma
l_int|7
comma
l_int|0
comma
l_int|0xE0
comma
l_int|28
)brace
comma
multiline_comment|/* 100.00 MHz */
(brace
l_int|125
comma
l_int|0
comma
l_int|9
comma
l_int|0
comma
l_int|0xE0
comma
l_int|22
)brace
comma
multiline_comment|/* 125.00 MHz */
(brace
l_int|150
comma
l_int|0
comma
l_int|11
comma
l_int|0
comma
l_int|0xE0
comma
l_int|17
)brace
comma
multiline_comment|/* 150.00 MHz */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
multiline_comment|/* Terminator */
)brace
suffix:semicolon
DECL|function|w100_pll_get_testcount
r_static
id|u8
id|w100_pll_get_testcount
c_func
(paren
id|u8
id|testclk_sel
)paren
(brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.start_check_freq
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.testclk_sel
op_assign
id|testclk_sel
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.tstcount_rst
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/*reset test count */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_test_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.tstcount_rst
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_test_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.start_check_freq
op_assign
l_int|0x1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_test_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.start_check_freq
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_test_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
r_return
id|w100_pwr_state.clk_test_cntl.f.test_count
suffix:semicolon
)brace
DECL|function|w100_pll_adjust
r_static
id|u8
id|w100_pll_adjust
c_func
(paren
r_void
)paren
(brace
r_do
(brace
multiline_comment|/* Wai Ming 80 percent of VDD 1.3V gives 1.04V, minimum operating voltage is 1.08V&n;&t;&t; * therefore, commented out the following lines&n;&t;&t; * tf80 meant tf100&n;&t;&t; * set VCO input = 0.8 * VDD&n;&t;&t; */
id|w100_pwr_state.pll_cntl.f.pll_dactal
op_assign
l_int|0xd
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.tf80
op_assign
id|w100_pll_get_testcount
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* PLLCLK */
r_if
c_cond
(paren
id|w100_pwr_state.tf80
op_ge
(paren
id|w100_pwr_state.tfgoal
)paren
)paren
(brace
multiline_comment|/* set VCO input = 0.2 * VDD */
id|w100_pwr_state.pll_cntl.f.pll_dactal
op_assign
l_int|0x7
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.tf20
op_assign
id|w100_pll_get_testcount
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* PLLCLK */
r_if
c_cond
(paren
id|w100_pwr_state.tf20
op_le
(paren
id|w100_pwr_state.tfgoal
)paren
)paren
r_return
l_int|1
suffix:semicolon
singleline_comment|// Success
r_if
c_cond
(paren
(paren
id|w100_pwr_state.pll_cntl.f.pll_vcofr
op_eq
l_int|0x0
)paren
op_logical_and
(paren
(paren
id|w100_pwr_state.pll_cntl.f.pll_pvg
op_eq
l_int|0x7
)paren
op_logical_or
(paren
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_eq
l_int|0x0
)paren
)paren
)paren
(brace
multiline_comment|/* slow VCO config */
id|w100_pwr_state.pll_cntl.f.pll_vcofr
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pvg
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|w100_pwr_state.pll_cntl.f.pll_ioffset
)paren
OL
l_int|0x3
)paren
(brace
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_add_assign
l_int|0x1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|w100_pwr_state.pll_cntl.f.pll_pvg
)paren
OL
l_int|0x7
)paren
(brace
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pvg
op_add_assign
l_int|0x1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
singleline_comment|// error
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * w100_pll_calibration&n; *                freq = target frequency of the PLL&n; *                (note: crystal = 14.3MHz)&n; */
DECL|function|w100_pll_calibration
r_static
id|u8
id|w100_pll_calibration
c_func
(paren
id|u32
id|freq
)paren
(brace
id|u8
id|status
suffix:semicolon
multiline_comment|/* initial setting */
id|w100_pwr_state.pll_cntl.f.pll_pwdn
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* power down */
id|w100_pwr_state.pll_cntl.f.pll_reset
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* not reset */
id|w100_pwr_state.pll_cntl.f.pll_tcpoff
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* Hi-Z */
id|w100_pwr_state.pll_cntl.f.pll_pvg
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* VCO gain = 0 */
id|w100_pwr_state.pll_cntl.f.pll_vcofr
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* VCO frequency range control = off */
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* current offset inside VCO = 0 */
id|w100_pwr_state.pll_cntl.f.pll_ring_off
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
multiline_comment|/* check for (tf80 &gt;= tfgoal) &amp;&amp; (tf20 =&lt; tfgoal) */
r_if
c_cond
(paren
(paren
id|w100_pwr_state.tf80
OL
id|w100_pwr_state.tfgoal
)paren
op_logical_or
(paren
id|w100_pwr_state.tf20
OG
id|w100_pwr_state.tfgoal
)paren
)paren
(brace
id|status
op_assign
id|w100_pll_adjust
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* PLL Reset And Lock */
multiline_comment|/* set VCO input = 0.5 * VDD */
id|w100_pwr_state.pll_cntl.f.pll_dactal
op_assign
l_int|0xa
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
multiline_comment|/* reset time */
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* enable charge pump */
id|w100_pwr_state.pll_cntl.f.pll_tcpoff
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* normal */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
multiline_comment|/* set VCO input = Hi-Z */
multiline_comment|/* disable DAC */
id|w100_pwr_state.pll_cntl.f.pll_dactal
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
multiline_comment|/* lock time */
id|udelay
c_func
(paren
l_int|400
)paren
suffix:semicolon
multiline_comment|/* delay 400 us */
multiline_comment|/* PLL locked */
id|w100_pwr_state.sclk_cntl.f.sclk_src_sel
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* PLL clock */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.sclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.tf100
op_assign
id|w100_pll_get_testcount
c_func
(paren
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* PLLCLK */
r_return
id|status
suffix:semicolon
)brace
DECL|function|w100_pll_set_clk
r_static
id|u8
id|w100_pll_set_clk
c_func
(paren
r_void
)paren
(brace
id|u8
id|status
suffix:semicolon
r_if
c_cond
(paren
id|w100_pwr_state.auto_mode
op_eq
l_int|1
)paren
multiline_comment|/* auto mode */
(brace
id|w100_pwr_state.pwrmgt_cntl.f.pwm_fast_noml_hw_en
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* disable fast to normal */
id|w100_pwr_state.pwrmgt_cntl.f.pwm_noml_fast_hw_en
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* disable normal to fast */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pwrmgt_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
)brace
id|w100_pwr_state.sclk_cntl.f.sclk_src_sel
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* crystal clock */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.sclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_ref_div
op_assign
id|w100_pwr_state.M
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_fb_div_int
op_assign
id|w100_pwr_state.N_int
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_fb_div_frac
op_assign
id|w100_pwr_state.N_fac
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_lock_time
op_assign
id|w100_pwr_state.lock_time
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_ref_fb_div.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_REF_FB_DIV
)paren
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_mode_req
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pwrmgt_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
id|status
op_assign
id|w100_pll_calibration
(paren
id|w100_pwr_state.freq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w100_pwr_state.auto_mode
op_eq
l_int|1
)paren
multiline_comment|/* auto mode */
(brace
id|w100_pwr_state.pwrmgt_cntl.f.pwm_fast_noml_hw_en
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* reenable fast to normal */
id|w100_pwr_state.pwrmgt_cntl.f.pwm_noml_fast_hw_en
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* reenable normal to fast  */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pwrmgt_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/* assume reference crystal clk is 12.5MHz,&n; * and that doubling is not enabled.&n; *&n; * Freq = 12 == 12.5MHz.&n; */
DECL|function|w100_set_slowsysclk
r_static
id|u16
id|w100_set_slowsysclk
c_func
(paren
id|u16
id|freq
)paren
(brace
r_if
c_cond
(paren
id|w100_pwr_state.norm_sclk
op_eq
id|freq
)paren
r_return
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|w100_pwr_state.auto_mode
op_eq
l_int|1
)paren
multiline_comment|/* auto mode */
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_eq
l_int|12
)paren
(brace
id|w100_pwr_state.norm_sclk
op_assign
id|freq
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_slow
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Pslow = 1 */
id|w100_pwr_state.sclk_cntl.f.sclk_src_sel
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* crystal src */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.sclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.clk_pin_cntl.f.xtalin_pm_en
op_assign
l_int|0x1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_pin_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_PIN_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_enable
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_mode_req
op_assign
l_int|0x1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pwrmgt_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pwm_mode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* normal mode */
r_return
id|freq
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w100_set_fastsysclk
r_static
id|u16
id|w100_set_fastsysclk
c_func
(paren
id|u16
id|freq
)paren
(brace
id|u16
id|pll_freq
suffix:semicolon
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|pll_freq
op_assign
(paren
id|u16
)paren
(paren
id|freq
op_star
(paren
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_fast
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|pll_freq
op_eq
id|gPLLTable
(braket
id|i
)braket
dot
id|freq
)paren
(brace
id|w100_pwr_state.freq
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|freq
op_star
l_int|1000000
suffix:semicolon
id|w100_pwr_state.M
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|M
suffix:semicolon
id|w100_pwr_state.N_int
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|N_int
suffix:semicolon
id|w100_pwr_state.N_fac
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|N_fac
suffix:semicolon
id|w100_pwr_state.tfgoal
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|tfgoal
suffix:semicolon
id|w100_pwr_state.lock_time
op_assign
id|gPLLTable
(braket
id|i
)braket
dot
id|lock_time
suffix:semicolon
id|w100_pwr_state.tf20
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* set highest */
id|w100_pwr_state.tf80
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* set lowest */
id|w100_pll_set_clk
c_func
(paren
)paren
suffix:semicolon
id|w100_pwr_state.pwm_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* fast mode */
id|w100_pwr_state.fast_sclk
op_assign
id|freq
suffix:semicolon
r_return
id|freq
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|gPLLTable
(braket
id|i
)braket
dot
id|freq
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w100_pwr_state.auto_mode
op_eq
l_int|1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_fast
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_fast
op_sub_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.sclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set up an initial state.  Some values/fields set&n;   here will be overwritten. */
DECL|function|w100_pwm_setup
r_static
r_void
id|w100_pwm_setup
c_func
(paren
r_void
)paren
(brace
id|w100_pwr_state.clk_pin_cntl.f.osc_en
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.clk_pin_cntl.f.osc_gain
op_assign
l_int|0x1f
suffix:semicolon
id|w100_pwr_state.clk_pin_cntl.f.dont_use_xtalin
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.clk_pin_cntl.f.xtalin_pm_en
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.clk_pin_cntl.f.xtalin_dbl_en
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* no freq doubling */
id|w100_pwr_state.clk_pin_cntl.f.cg_debug
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_pin_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_PIN_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.sclk_src_sel
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Crystal Clk */
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_fast
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Pfast = 1 */
id|w100_pwr_state.sclk_cntl.f.sclk_clkon_hys
op_assign
l_int|0x3
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.sclk_post_div_slow
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Pslow = 1 */
id|w100_pwr_state.sclk_cntl.f.disp_cg_ok2switch_en
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.sclk_force_reg
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_disp
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_mc
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_extmc
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_cp
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_e2
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_e3
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_idct
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.sclk_force_bist
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|w100_pwr_state.sclk_cntl.f.busy_extend_cp
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.busy_extend_e2
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.busy_extend_e3
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.sclk_cntl.f.busy_extend_idct
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.sclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pclk_cntl.f.pclk_src_sel
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Crystal Clk */
id|w100_pwr_state.pclk_cntl.f.pclk_post_div
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* P = 2 */
id|w100_pwr_state.pclk_cntl.f.pclk_force_disp
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Dynamic */
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPCLK_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_ref_div
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* M = 1 */
id|w100_pwr_state.pll_ref_fb_div.f.pll_fb_div_int
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* N = 1.0 */
id|w100_pwr_state.pll_ref_fb_div.f.pll_fb_div_frac
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_reset_time
op_assign
l_int|0x5
suffix:semicolon
id|w100_pwr_state.pll_ref_fb_div.f.pll_lock_time
op_assign
l_int|0xff
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_ref_fb_div.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_REF_FB_DIV
)paren
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pwdn
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_reset
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pm_en
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_mode
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* uses VCO clock */
id|w100_pwr_state.pll_cntl.f.pll_refclk_sel
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_fbclk_sel
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_tcpoff
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pcp
op_assign
l_int|0x4
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pvg
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_vcofr
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_ioffset
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pecc_mode
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_pecc_scon
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_dactal
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* Hi-Z */
id|w100_pwr_state.pll_cntl.f.pll_cp_clip
op_assign
l_int|0x3
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_conf
op_assign
l_int|0x2
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_mbctrl
op_assign
l_int|0x2
suffix:semicolon
id|w100_pwr_state.pll_cntl.f.pll_ring_off
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pll_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.testclk_sel
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* PLLCLK (for testing) */
id|w100_pwr_state.clk_test_cntl.f.start_check_freq
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.clk_test_cntl.f.tstcount_rst
op_assign
l_int|0x0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.clk_test_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmCLK_TEST_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_enable
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_mode_req
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* normal mode (0, 1, 3) */
id|w100_pwr_state.pwrmgt_cntl.f.pwm_wakeup_cond
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_fast_noml_hw_en
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_noml_fast_hw_en
op_assign
l_int|0x0
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_fast_noml_cond
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* PM4,ENG */
id|w100_pwr_state.pwrmgt_cntl.f.pwm_noml_fast_cond
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* PM4,ENG */
id|w100_pwr_state.pwrmgt_cntl.f.pwm_idle_timer
op_assign
l_int|0xFF
suffix:semicolon
id|w100_pwr_state.pwrmgt_cntl.f.pwm_busy_timer
op_assign
l_int|0xFF
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pwrmgt_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
id|w100_pwr_state.auto_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* manual mode */
id|w100_pwr_state.pwm_mode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* normal mode (0, 1, 2) */
id|w100_pwr_state.freq
op_assign
l_int|50000000
suffix:semicolon
multiline_comment|/* 50 MHz */
id|w100_pwr_state.M
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* M = 4 */
id|w100_pwr_state.N_int
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* N = 7.0 */
id|w100_pwr_state.N_fac
op_assign
l_int|0
suffix:semicolon
id|w100_pwr_state.tfgoal
op_assign
l_int|0xE0
suffix:semicolon
id|w100_pwr_state.lock_time
op_assign
l_int|56
suffix:semicolon
id|w100_pwr_state.tf20
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* set highest */
id|w100_pwr_state.tf80
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* set lowest */
id|w100_pwr_state.tf100
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* set lowest */
id|w100_pwr_state.fast_sclk
op_assign
l_int|50
suffix:semicolon
multiline_comment|/* 50.0 MHz */
id|w100_pwr_state.norm_sclk
op_assign
l_int|12
suffix:semicolon
multiline_comment|/* 12.5 MHz */
)brace
DECL|function|w100_init_sharp_lcd
r_static
r_void
id|w100_init_sharp_lcd
c_func
(paren
id|u32
id|mode
)paren
(brace
id|u32
id|temp32
suffix:semicolon
r_union
id|disp_db_buf_cntl_wr_u
id|disp_db_buf_wr_cntl
suffix:semicolon
multiline_comment|/* Prevent display updates */
id|disp_db_buf_wr_cntl.f.db_buf_cntl
op_assign
l_int|0x1e
suffix:semicolon
id|disp_db_buf_wr_cntl.f.update_db_buf
op_assign
l_int|0
suffix:semicolon
id|disp_db_buf_wr_cntl.f.en_db_buf
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|disp_db_buf_wr_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmDISP_DB_BUF_CNTL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|LCD_SHARP_QVGA
suffix:colon
id|w100_set_slowsysclk
c_func
(paren
l_int|12
)paren
suffix:semicolon
multiline_comment|/* use crystal -- 12.5MHz */
multiline_comment|/* not use PLL */
id|writel
c_func
(paren
l_int|0x7FFF8000
comma
id|remapped_regs
op_plus
id|mmMC_EXT_MEM_LOCATION
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x85FF8000
comma
id|remapped_regs
op_plus
id|mmMC_FB_LOCATION
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000003
comma
id|remapped_regs
op_plus
id|mmLCD_FORMAT
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00CF1C06
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_CTRL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01410145
comma
id|remapped_regs
op_plus
id|mmCRTC_TOTAL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01170027
comma
id|remapped_regs
op_plus
id|mmACTIVE_H_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01410001
comma
id|remapped_regs
op_plus
id|mmACTIVE_V_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01170027
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_H_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01410001
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_V_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x81170027
comma
id|remapped_regs
op_plus
id|mmCRTC_SS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xA0140000
comma
id|remapped_regs
op_plus
id|mmCRTC_LS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00400008
comma
id|remapped_regs
op_plus
id|mmCRTC_REV
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xA0000000
comma
id|remapped_regs
op_plus
id|mmCRTC_DCLK
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xC0140014
comma
id|remapped_regs
op_plus
id|mmCRTC_GS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00010141
comma
id|remapped_regs
op_plus
id|mmCRTC_VPOS_GS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x8015010F
comma
id|remapped_regs
op_plus
id|mmCRTC_GCLK
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x80100110
comma
id|remapped_regs
op_plus
id|mmCRTC_GOE
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_FRAME
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_FRAME_VPOS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01CC0000
comma
id|remapped_regs
op_plus
id|mmLCDD_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0003FFFF
comma
id|remapped_regs
op_plus
id|mmLCDD_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00FFFF0D
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x003F3003
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_DEFAULT_COUNT
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0000FF00
comma
id|remapped_regs
op_plus
id|mmLCD_BACKGROUND_COLOR
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000102aa
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL3
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00800000
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_OFFSET
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000001e0
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_PITCH
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000000bf
comma
id|remapped_regs
op_plus
id|mmGPIO_DATA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x03c0feff
comma
id|remapped_regs
op_plus
id|mmGPIO_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmGPIO_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x41060010
comma
id|remapped_regs
op_plus
id|mmCRTC_PS1_ACTIVE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_SHARP_VGA
suffix:colon
id|w100_set_slowsysclk
c_func
(paren
l_int|12
)paren
suffix:semicolon
multiline_comment|/* use crystal -- 12.5MHz */
id|w100_set_fastsysclk
c_func
(paren
id|current_par-&gt;fastsysclk_mode
)paren
suffix:semicolon
multiline_comment|/* use PLL -- 75.0MHz */
id|w100_pwr_state.pclk_cntl.f.pclk_src_sel
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pclk_cntl.f.pclk_post_div
op_assign
l_int|0x2
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPCLK_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x15FF1000
comma
id|remapped_regs
op_plus
id|mmMC_FB_LOCATION
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x9FFF8000
comma
id|remapped_regs
op_plus
id|mmMC_EXT_MEM_LOCATION
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000003
comma
id|remapped_regs
op_plus
id|mmLCD_FORMAT
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00DE1D66
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_CTRL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0283028B
comma
id|remapped_regs
op_plus
id|mmCRTC_TOTAL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x02360056
comma
id|remapped_regs
op_plus
id|mmACTIVE_H_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x02830003
comma
id|remapped_regs
op_plus
id|mmACTIVE_V_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x02360056
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_H_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x02830003
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_V_DISP
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x82360056
comma
id|remapped_regs
op_plus
id|mmCRTC_SS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xA0280000
comma
id|remapped_regs
op_plus
id|mmCRTC_LS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00400008
comma
id|remapped_regs
op_plus
id|mmCRTC_REV
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xA0000000
comma
id|remapped_regs
op_plus
id|mmCRTC_DCLK
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x80280028
comma
id|remapped_regs
op_plus
id|mmCRTC_GS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x02830002
comma
id|remapped_regs
op_plus
id|mmCRTC_VPOS_GS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x8015010F
comma
id|remapped_regs
op_plus
id|mmCRTC_GCLK
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x80100110
comma
id|remapped_regs
op_plus
id|mmCRTC_GOE
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_FRAME
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_FRAME_VPOS
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x01CC0000
comma
id|remapped_regs
op_plus
id|mmLCDD_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0003FFFF
comma
id|remapped_regs
op_plus
id|mmLCDD_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00FFFF0D
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x003F3003
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmCRTC_DEFAULT_COUNT
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0000FF00
comma
id|remapped_regs
op_plus
id|mmLCD_BACKGROUND_COLOR
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000102aa
comma
id|remapped_regs
op_plus
id|mmGENLCD_CNTL3
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00800000
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_OFFSET
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000003C0
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_PITCH
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000000bf
comma
id|remapped_regs
op_plus
id|mmGPIO_DATA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x03c0feff
comma
id|remapped_regs
op_plus
id|mmGPIO_CNTL2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmGPIO_CNTL1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x41060010
comma
id|remapped_regs
op_plus
id|mmCRTC_PS1_ACTIVE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* Hack for overlay in ext memory */
id|temp32
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
id|temp32
op_or_assign
l_int|0xc0000000
suffix:semicolon
id|writel
c_func
(paren
id|temp32
comma
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
multiline_comment|/* Re-enable display updates */
id|disp_db_buf_wr_cntl.f.db_buf_cntl
op_assign
l_int|0x1e
suffix:semicolon
id|disp_db_buf_wr_cntl.f.update_db_buf
op_assign
l_int|1
suffix:semicolon
id|disp_db_buf_wr_cntl.f.en_db_buf
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|disp_db_buf_wr_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmDISP_DB_BUF_CNTL
)paren
suffix:semicolon
)brace
DECL|function|w100_set_vga_rotation_regs
r_static
r_void
id|w100_set_vga_rotation_regs
c_func
(paren
id|u16
id|divider
comma
r_int
r_int
id|ctrl
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|pitch
)paren
(brace
id|w100_pwr_state.pclk_cntl.f.pclk_src_sel
op_assign
l_int|0x1
suffix:semicolon
id|w100_pwr_state.pclk_cntl.f.pclk_post_div
op_assign
id|divider
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|w100_pwr_state.pclk_cntl.val
)paren
comma
id|remapped_regs
op_plus
id|mmPCLK_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
id|ctrl
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_CTRL
)paren
suffix:semicolon
id|writel
c_func
(paren
id|offset
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_OFFSET
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pitch
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_PITCH
)paren
suffix:semicolon
multiline_comment|/* Re-enable display updates */
id|writel
c_func
(paren
l_int|0x0000007b
comma
id|remapped_regs
op_plus
id|mmDISP_DB_BUF_CNTL
)paren
suffix:semicolon
)brace
DECL|function|w100_init_vga_rotation
r_static
r_void
id|w100_init_vga_rotation
c_func
(paren
id|u16
id|deg
)paren
(brace
r_switch
c_cond
(paren
id|deg
)paren
(brace
r_case
l_int|0
suffix:colon
id|w100_set_vga_rotation_regs
c_func
(paren
l_int|0x02
comma
l_int|0x00DE1D66
comma
l_int|0x00800000
comma
l_int|0x000003c0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|90
suffix:colon
id|w100_set_vga_rotation_regs
c_func
(paren
l_int|0x06
comma
l_int|0x00DE1D0e
comma
l_int|0x00895b00
comma
l_int|0x00000500
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|180
suffix:colon
id|w100_set_vga_rotation_regs
c_func
(paren
l_int|0x02
comma
l_int|0x00DE1D7e
comma
l_int|0x00895ffc
comma
l_int|0x000003c0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|270
suffix:colon
id|w100_set_vga_rotation_regs
c_func
(paren
l_int|0x06
comma
l_int|0x00DE1D16
comma
l_int|0x008004fc
comma
l_int|0x00000500
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* not-support */
r_break
suffix:semicolon
)brace
)brace
DECL|function|w100_set_qvga_rotation_regs
r_static
r_void
id|w100_set_qvga_rotation_regs
c_func
(paren
r_int
r_int
id|ctrl
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|pitch
)paren
(brace
id|writel
c_func
(paren
id|ctrl
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_CTRL
)paren
suffix:semicolon
id|writel
c_func
(paren
id|offset
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_OFFSET
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pitch
comma
id|remapped_regs
op_plus
id|mmGRAPHIC_PITCH
)paren
suffix:semicolon
multiline_comment|/* Re-enable display updates */
id|writel
c_func
(paren
l_int|0x0000007b
comma
id|remapped_regs
op_plus
id|mmDISP_DB_BUF_CNTL
)paren
suffix:semicolon
)brace
DECL|function|w100_init_qvga_rotation
r_static
r_void
id|w100_init_qvga_rotation
c_func
(paren
id|u16
id|deg
)paren
(brace
r_switch
c_cond
(paren
id|deg
)paren
(brace
r_case
l_int|0
suffix:colon
id|w100_set_qvga_rotation_regs
c_func
(paren
l_int|0x00d41c06
comma
l_int|0x00800000
comma
l_int|0x000001e0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|90
suffix:colon
id|w100_set_qvga_rotation_regs
c_func
(paren
l_int|0x00d41c0E
comma
l_int|0x00825580
comma
l_int|0x00000280
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|180
suffix:colon
id|w100_set_qvga_rotation_regs
c_func
(paren
l_int|0x00d41c1e
comma
l_int|0x008257fc
comma
l_int|0x000001e0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|270
suffix:colon
id|w100_set_qvga_rotation_regs
c_func
(paren
l_int|0x00d41c16
comma
l_int|0x0080027c
comma
l_int|0x00000280
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* not-support */
r_break
suffix:semicolon
)brace
)brace
DECL|function|w100_suspend
r_static
r_void
id|w100_suspend
c_func
(paren
id|u32
id|mode
)paren
(brace
id|u32
id|val
suffix:semicolon
id|writel
c_func
(paren
l_int|0x7FFF8000
comma
id|remapped_regs
op_plus
id|mmMC_EXT_MEM_LOCATION
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00FF0000
comma
id|remapped_regs
op_plus
id|mmMC_PERF_MON_CNTL
)paren
suffix:semicolon
id|val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmMEM_EXT_TIMING_CNTL
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
l_int|0x00100000
)paren
suffix:semicolon
multiline_comment|/* bit20=0 */
id|val
op_or_assign
l_int|0xFF000000
suffix:semicolon
multiline_comment|/* bit31:24=0xff */
id|writel
c_func
(paren
id|val
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_TIMING_CNTL
)paren
suffix:semicolon
id|val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
l_int|0x00040000
)paren
suffix:semicolon
multiline_comment|/* bit18=0 */
id|val
op_or_assign
l_int|0x00080000
suffix:semicolon
multiline_comment|/* bit19=1 */
id|writel
c_func
(paren
id|val
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* wait 1us */
r_if
c_cond
(paren
id|mode
op_eq
id|W100_SUSPEND_EXTMEM
)paren
(brace
multiline_comment|/* CKE: Tri-State */
id|val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x40000000
suffix:semicolon
multiline_comment|/* bit30=1 */
id|writel
c_func
(paren
id|val
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
multiline_comment|/* CLK: Stop */
id|val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
l_int|0x00000001
)paren
suffix:semicolon
multiline_comment|/* bit0=0 */
id|writel
c_func
(paren
id|val
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
)brace
r_else
(brace
id|writel
c_func
(paren
l_int|0x00000000
comma
id|remapped_regs
op_plus
id|mmSCLK_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x000000BF
comma
id|remapped_regs
op_plus
id|mmCLK_PIN_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000015
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|val
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x00000004
suffix:semicolon
multiline_comment|/* bit2=1 */
id|writel
c_func
(paren
id|val
comma
id|remapped_regs
op_plus
id|mmPLL_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0000001d
comma
id|remapped_regs
op_plus
id|mmPWRMGT_CNTL
)paren
suffix:semicolon
)brace
)brace
DECL|function|w100_resume
r_static
r_void
id|w100_resume
c_func
(paren
r_void
)paren
(brace
id|u32
id|temp32
suffix:semicolon
id|w100_hw_init
c_func
(paren
)paren
suffix:semicolon
id|w100_pwm_setup
c_func
(paren
)paren
suffix:semicolon
id|temp32
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
id|temp32
op_and_assign
l_int|0xff7fffff
suffix:semicolon
id|temp32
op_or_assign
l_int|0x00800000
suffix:semicolon
id|writel
c_func
(paren
id|temp32
comma
id|remapped_regs
op_plus
id|mmDISP_DEBUG2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_480
op_logical_or
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_640
)paren
(brace
id|w100_init_sharp_lcd
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_640
)paren
(brace
id|w100_init_vga_rotation
c_func
(paren
id|current_par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|w100_init_sharp_lcd
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_320
)paren
(brace
id|w100_init_qvga_rotation
c_func
(paren
id|current_par-&gt;rotation_flag
ques
c_cond
l_int|270
suffix:colon
l_int|90
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|w100_vsync
r_static
r_void
id|w100_vsync
c_func
(paren
r_void
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_int
id|timeout
op_assign
l_int|30000
suffix:semicolon
multiline_comment|/* VSync timeout = 30[ms] &gt; 16.8[ms] */
id|tmp
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmACTIVE_V_DISP
)paren
suffix:semicolon
multiline_comment|/* set vline pos  */
id|writel
c_func
(paren
(paren
id|tmp
op_rshift
l_int|16
)paren
op_amp
l_int|0x3ff
comma
id|remapped_regs
op_plus
id|mmDISP_INT_CNTL
)paren
suffix:semicolon
multiline_comment|/* disable vline irq */
id|tmp
op_assign
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmGEN_INT_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x00000002
suffix:semicolon
id|writel
c_func
(paren
id|tmp
comma
id|remapped_regs
op_plus
id|mmGEN_INT_CNTL
)paren
suffix:semicolon
multiline_comment|/* clear vline irq status */
id|writel
c_func
(paren
l_int|0x00000002
comma
id|remapped_regs
op_plus
id|mmGEN_INT_STATUS
)paren
suffix:semicolon
multiline_comment|/* enable vline irq */
id|writel
c_func
(paren
(paren
id|tmp
op_or
l_int|0x00000002
)paren
comma
id|remapped_regs
op_plus
id|mmGEN_INT_CNTL
)paren
suffix:semicolon
multiline_comment|/* clear vline irq status */
id|writel
c_func
(paren
l_int|0x00000002
comma
id|remapped_regs
op_plus
id|mmGEN_INT_STATUS
)paren
suffix:semicolon
r_while
c_loop
(paren
id|timeout
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|readl
c_func
(paren
id|remapped_regs
op_plus
id|mmGEN_INT_STATUS
)paren
op_amp
l_int|0x00000002
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|timeout
op_decrement
suffix:semicolon
)brace
multiline_comment|/* disable vline irq */
id|writel
c_func
(paren
id|tmp
comma
id|remapped_regs
op_plus
id|mmGEN_INT_CNTL
)paren
suffix:semicolon
multiline_comment|/* clear vline irq status */
id|writel
c_func
(paren
l_int|0x00000002
comma
id|remapped_regs
op_plus
id|mmGEN_INT_STATUS
)paren
suffix:semicolon
)brace
DECL|function|w100_InitExtMem
r_static
r_void
id|w100_InitExtMem
c_func
(paren
id|u32
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|LCD_SHARP_QVGA
suffix:colon
multiline_comment|/* QVGA doesn&squot;t use external memory&n;&t;&t;   nothing to do, really. */
r_break
suffix:semicolon
r_case
id|LCD_SHARP_VGA
suffix:colon
id|writel
c_func
(paren
l_int|0x00007800
comma
id|remapped_regs
op_plus
id|mmMC_BIST_CTRL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00040003
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00200021
comma
id|remapped_regs
op_plus
id|mmMEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x80200021
comma
id|remapped_regs
op_plus
id|mmMEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00650021
comma
id|remapped_regs
op_plus
id|mmMEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x10002a4a
comma
id|remapped_regs
op_plus
id|mmMEM_EXT_TIMING_CNTL
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x7ff87012
comma
id|remapped_regs
op_plus
id|mmMEM_IO_CNTL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|macro|RESCTL_ADRS
mdefine_line|#define RESCTL_ADRS     0x00
DECL|macro|PHACTRL_ADRS
mdefine_line|#define PHACTRL_ADRS&t;0x01
DECL|macro|DUTYCTRL_ADRS
mdefine_line|#define DUTYCTRL_ADRS&t;0x02
DECL|macro|POWERREG0_ADRS
mdefine_line|#define POWERREG0_ADRS&t;0x03
DECL|macro|POWERREG1_ADRS
mdefine_line|#define POWERREG1_ADRS&t;0x04
DECL|macro|GPOR3_ADRS
mdefine_line|#define GPOR3_ADRS&t;&t;0x05
DECL|macro|PICTRL_ADRS
mdefine_line|#define PICTRL_ADRS     0x06
DECL|macro|POLCTRL_ADRS
mdefine_line|#define POLCTRL_ADRS    0x07
DECL|macro|RESCTL_QVGA
mdefine_line|#define RESCTL_QVGA     0x01
DECL|macro|RESCTL_VGA
mdefine_line|#define RESCTL_VGA      0x00
DECL|macro|POWER1_VW_ON
mdefine_line|#define POWER1_VW_ON&t;0x01&t;/* VW Supply FET ON */
DECL|macro|POWER1_GVSS_ON
mdefine_line|#define POWER1_GVSS_ON&t;0x02&t;/* GVSS(-8V) Power Supply ON */
DECL|macro|POWER1_VDD_ON
mdefine_line|#define POWER1_VDD_ON&t;0x04&t;/* VDD(8V),SVSS(-4V) Power Supply ON */
DECL|macro|POWER1_VW_OFF
mdefine_line|#define POWER1_VW_OFF&t;0x00&t;/* VW Supply FET OFF */
DECL|macro|POWER1_GVSS_OFF
mdefine_line|#define POWER1_GVSS_OFF&t;0x00&t;/* GVSS(-8V) Power Supply OFF */
DECL|macro|POWER1_VDD_OFF
mdefine_line|#define POWER1_VDD_OFF&t;0x00&t;/* VDD(8V),SVSS(-4V) Power Supply OFF */
DECL|macro|POWER0_COM_DCLK
mdefine_line|#define POWER0_COM_DCLK&t;0x01&t;/* COM Voltage DC Bias DAC Serial Data Clock */
DECL|macro|POWER0_COM_DOUT
mdefine_line|#define POWER0_COM_DOUT&t;0x02&t;/* COM Voltage DC Bias DAC Serial Data Out */
DECL|macro|POWER0_DAC_ON
mdefine_line|#define POWER0_DAC_ON&t;0x04&t;/* DAC Power Supply ON */
DECL|macro|POWER0_COM_ON
mdefine_line|#define POWER0_COM_ON&t;0x08&t;/* COM Powewr Supply ON */
DECL|macro|POWER0_VCC5_ON
mdefine_line|#define POWER0_VCC5_ON&t;0x10&t;/* VCC5 Power Supply ON */
DECL|macro|POWER0_DAC_OFF
mdefine_line|#define POWER0_DAC_OFF&t;0x00&t;/* DAC Power Supply OFF */
DECL|macro|POWER0_COM_OFF
mdefine_line|#define POWER0_COM_OFF&t;0x00&t;/* COM Powewr Supply OFF */
DECL|macro|POWER0_VCC5_OFF
mdefine_line|#define POWER0_VCC5_OFF&t;0x00&t;/* VCC5 Power Supply OFF */
DECL|macro|PICTRL_INIT_STATE
mdefine_line|#define PICTRL_INIT_STATE&t;0x01
DECL|macro|PICTRL_INIOFF
mdefine_line|#define PICTRL_INIOFF&t;&t;0x02
DECL|macro|PICTRL_POWER_DOWN
mdefine_line|#define PICTRL_POWER_DOWN&t;0x04
DECL|macro|PICTRL_COM_SIGNAL_OFF
mdefine_line|#define PICTRL_COM_SIGNAL_OFF&t;0x08
DECL|macro|PICTRL_DAC_SIGNAL_OFF
mdefine_line|#define PICTRL_DAC_SIGNAL_OFF&t;0x10
DECL|macro|PICTRL_POWER_ACTIVE
mdefine_line|#define PICTRL_POWER_ACTIVE&t;(0)
DECL|macro|POLCTRL_SYNC_POL_FALL
mdefine_line|#define POLCTRL_SYNC_POL_FALL&t;0x01
DECL|macro|POLCTRL_EN_POL_FALL
mdefine_line|#define POLCTRL_EN_POL_FALL&t;0x02
DECL|macro|POLCTRL_DATA_POL_FALL
mdefine_line|#define POLCTRL_DATA_POL_FALL&t;0x04
DECL|macro|POLCTRL_SYNC_ACT_H
mdefine_line|#define POLCTRL_SYNC_ACT_H&t;0x08
DECL|macro|POLCTRL_EN_ACT_L
mdefine_line|#define POLCTRL_EN_ACT_L&t;0x10
DECL|macro|POLCTRL_SYNC_POL_RISE
mdefine_line|#define POLCTRL_SYNC_POL_RISE&t;0x00
DECL|macro|POLCTRL_EN_POL_RISE
mdefine_line|#define POLCTRL_EN_POL_RISE&t;0x00
DECL|macro|POLCTRL_DATA_POL_RISE
mdefine_line|#define POLCTRL_DATA_POL_RISE&t;0x00
DECL|macro|POLCTRL_SYNC_ACT_L
mdefine_line|#define POLCTRL_SYNC_ACT_L&t;0x00
DECL|macro|POLCTRL_EN_ACT_H
mdefine_line|#define POLCTRL_EN_ACT_H&t;0x00
DECL|macro|PHACTRL_PHASE_MANUAL
mdefine_line|#define PHACTRL_PHASE_MANUAL&t;0x01
DECL|macro|PHAD_QVGA_DEFAULT_VAL
mdefine_line|#define PHAD_QVGA_DEFAULT_VAL (9)
DECL|macro|COMADJ_DEFAULT
mdefine_line|#define COMADJ_DEFAULT        (125)
DECL|function|lcdtg_ssp_send
r_static
r_void
id|lcdtg_ssp_send
c_func
(paren
id|u8
id|adrs
comma
id|u8
id|data
)paren
(brace
id|w100fb_ssp_send
c_func
(paren
id|adrs
comma
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is only a psuedo I2C interface. We can&squot;t use the standard kernel&n; * routines as the interface is write only. We just assume the data is acked...&n; */
DECL|function|lcdtg_ssp_i2c_send
r_static
r_void
id|lcdtg_ssp_i2c_send
c_func
(paren
id|u8
id|data
)paren
(brace
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG0_ADRS
comma
id|data
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_i2c_send_bit
r_static
r_void
id|lcdtg_i2c_send_bit
c_func
(paren
id|u8
id|data
)paren
(brace
id|lcdtg_ssp_i2c_send
c_func
(paren
id|data
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|data
op_or
id|POWER0_COM_DCLK
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_i2c_send_start
r_static
r_void
id|lcdtg_i2c_send_start
c_func
(paren
id|u8
id|base
)paren
(brace
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
op_or
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
op_or
id|POWER0_COM_DCLK
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_i2c_send_stop
r_static
r_void
id|lcdtg_i2c_send_stop
c_func
(paren
id|u8
id|base
)paren
(brace
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
op_or
id|POWER0_COM_DCLK
)paren
suffix:semicolon
id|lcdtg_ssp_i2c_send
c_func
(paren
id|base
op_or
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_i2c_send_byte
r_static
r_void
id|lcdtg_i2c_send_byte
c_func
(paren
id|u8
id|base
comma
id|u8
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|0x80
)paren
id|lcdtg_i2c_send_bit
c_func
(paren
id|base
op_or
id|POWER0_COM_DOUT
)paren
suffix:semicolon
r_else
id|lcdtg_i2c_send_bit
c_func
(paren
id|base
)paren
suffix:semicolon
id|data
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|lcdtg_i2c_wait_ack
r_static
r_void
id|lcdtg_i2c_wait_ack
c_func
(paren
id|u8
id|base
)paren
(brace
id|lcdtg_i2c_send_bit
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_set_common_voltage
r_static
r_void
id|lcdtg_set_common_voltage
c_func
(paren
id|u8
id|base_data
comma
id|u8
id|data
)paren
(brace
multiline_comment|/* Set Common Voltage to M62332FP via I2C */
id|lcdtg_i2c_send_start
c_func
(paren
id|base_data
)paren
suffix:semicolon
id|lcdtg_i2c_send_byte
c_func
(paren
id|base_data
comma
l_int|0x9c
)paren
suffix:semicolon
id|lcdtg_i2c_wait_ack
c_func
(paren
id|base_data
)paren
suffix:semicolon
id|lcdtg_i2c_send_byte
c_func
(paren
id|base_data
comma
l_int|0x00
)paren
suffix:semicolon
id|lcdtg_i2c_wait_ack
c_func
(paren
id|base_data
)paren
suffix:semicolon
id|lcdtg_i2c_send_byte
c_func
(paren
id|base_data
comma
id|data
)paren
suffix:semicolon
id|lcdtg_i2c_wait_ack
c_func
(paren
id|base_data
)paren
suffix:semicolon
id|lcdtg_i2c_send_stop
c_func
(paren
id|base_data
)paren
suffix:semicolon
)brace
DECL|struct|lcdtg_register_setting
r_static
r_struct
id|lcdtg_register_setting
(brace
DECL|member|adrs
id|u8
id|adrs
suffix:semicolon
DECL|member|data
id|u8
id|data
suffix:semicolon
DECL|member|wait
id|u32
id|wait
suffix:semicolon
DECL|variable|lcdtg_power_on_table
)brace
id|lcdtg_power_on_table
(braket
)braket
op_assign
(brace
multiline_comment|/* Initialize Internal Logic &amp; Port */
(brace
id|PICTRL_ADRS
comma
id|PICTRL_POWER_DOWN
op_or
id|PICTRL_INIOFF
op_or
id|PICTRL_INIT_STATE
op_or
id|PICTRL_COM_SIGNAL_OFF
op_or
id|PICTRL_DAC_SIGNAL_OFF
comma
l_int|0
)brace
comma
(brace
id|POWERREG0_ADRS
comma
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
op_or
id|POWER0_DAC_OFF
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_OFF
comma
l_int|0
)brace
comma
(brace
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_OFF
op_or
id|POWER1_VDD_OFF
comma
l_int|0
)brace
comma
multiline_comment|/* VDD(+8V),SVSS(-4V) ON */
(brace
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_OFF
op_or
id|POWER1_VDD_ON
multiline_comment|/* VDD ON */
comma
l_int|3000
)brace
comma
multiline_comment|/* DAC ON */
(brace
id|POWERREG0_ADRS
comma
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
op_or
id|POWER0_DAC_ON
multiline_comment|/* DAC ON */
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_OFF
comma
l_int|0
)brace
comma
multiline_comment|/* INIB = H, INI = L  */
(brace
id|PICTRL_ADRS
comma
multiline_comment|/* PICTL[0] = H , PICTL[1] = PICTL[2] = PICTL[4] = L */
id|PICTRL_INIT_STATE
op_or
id|PICTRL_COM_SIGNAL_OFF
comma
l_int|0
)brace
comma
multiline_comment|/* Set Common Voltage */
(brace
l_int|0xfe
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* VCC5 ON */
(brace
id|POWERREG0_ADRS
comma
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
op_or
id|POWER0_DAC_ON
multiline_comment|/* DAC ON */
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_ON
multiline_comment|/* VCC5 ON */
comma
l_int|0
)brace
comma
multiline_comment|/* GVSS(-8V) ON */
(brace
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_ON
multiline_comment|/* GVSS ON */
op_or
id|POWER1_VDD_ON
multiline_comment|/* VDD ON */
comma
l_int|2000
)brace
comma
multiline_comment|/* COM SIGNAL ON (PICTL[3] = L) */
(brace
id|PICTRL_ADRS
comma
id|PICTRL_INIT_STATE
comma
l_int|0
)brace
comma
multiline_comment|/* COM ON */
(brace
id|POWERREG0_ADRS
comma
id|POWER0_COM_DCLK
op_or
id|POWER0_COM_DOUT
op_or
id|POWER0_DAC_ON
multiline_comment|/* DAC ON */
op_or
id|POWER0_COM_ON
multiline_comment|/* COM ON */
op_or
id|POWER0_VCC5_ON
multiline_comment|/* VCC5_ON */
comma
l_int|0
)brace
comma
multiline_comment|/* VW ON */
(brace
id|POWERREG1_ADRS
comma
id|POWER1_VW_ON
multiline_comment|/* VW ON */
op_or
id|POWER1_GVSS_ON
multiline_comment|/* GVSS ON */
op_or
id|POWER1_VDD_ON
multiline_comment|/* VDD ON */
comma
l_int|0
multiline_comment|/* Wait 100ms */
)brace
comma
multiline_comment|/* Signals output enable */
(brace
id|PICTRL_ADRS
comma
l_int|0
multiline_comment|/* Signals output enable */
comma
l_int|0
)brace
comma
(brace
id|PHACTRL_ADRS
comma
id|PHACTRL_PHASE_MANUAL
comma
l_int|0
)brace
comma
multiline_comment|/* Initialize for Input Signals from ATI */
(brace
id|POLCTRL_ADRS
comma
id|POLCTRL_SYNC_POL_RISE
op_or
id|POLCTRL_EN_POL_RISE
op_or
id|POLCTRL_DATA_POL_RISE
op_or
id|POLCTRL_SYNC_ACT_L
op_or
id|POLCTRL_EN_ACT_H
comma
l_int|1000
multiline_comment|/*100000*/
multiline_comment|/* Wait 100ms */
)brace
comma
multiline_comment|/* end mark */
(brace
l_int|0xff
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|lcdtg_resume
r_static
r_void
id|lcdtg_resume
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_480
op_logical_or
id|current_par-&gt;lcdMode
op_eq
id|LCD_MODE_640
)paren
(brace
id|lcdtg_hw_init
c_func
(paren
id|LCD_SHARP_VGA
)paren
suffix:semicolon
)brace
r_else
(brace
id|lcdtg_hw_init
c_func
(paren
id|LCD_SHARP_QVGA
)paren
suffix:semicolon
)brace
)brace
DECL|function|lcdtg_suspend
r_static
r_void
id|lcdtg_suspend
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|current_par-&gt;xres
op_star
id|current_par-&gt;yres
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
l_int|0xffff
comma
id|remapped_fbuf
op_plus
(paren
l_int|2
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* 60Hz x 2 frame = 16.7msec x 2 = 33.4 msec */
id|mdelay
c_func
(paren
l_int|34
)paren
suffix:semicolon
multiline_comment|/* (1)VW OFF */
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_ON
op_or
id|POWER1_VDD_ON
)paren
suffix:semicolon
multiline_comment|/* (2)COM OFF */
id|lcdtg_ssp_send
c_func
(paren
id|PICTRL_ADRS
comma
id|PICTRL_COM_SIGNAL_OFF
)paren
suffix:semicolon
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG0_ADRS
comma
id|POWER0_DAC_ON
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_ON
)paren
suffix:semicolon
multiline_comment|/* (3)Set Common Voltage Bias 0V */
id|lcdtg_set_common_voltage
c_func
(paren
id|POWER0_DAC_ON
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_ON
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* (4)GVSS OFF */
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_OFF
op_or
id|POWER1_VDD_ON
)paren
suffix:semicolon
multiline_comment|/* (5)VCC5 OFF */
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG0_ADRS
comma
id|POWER0_DAC_ON
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_OFF
)paren
suffix:semicolon
multiline_comment|/* (6)Set PDWN, INIOFF, DACOFF */
id|lcdtg_ssp_send
c_func
(paren
id|PICTRL_ADRS
comma
id|PICTRL_INIOFF
op_or
id|PICTRL_DAC_SIGNAL_OFF
op_or
id|PICTRL_POWER_DOWN
op_or
id|PICTRL_COM_SIGNAL_OFF
)paren
suffix:semicolon
multiline_comment|/* (7)DAC OFF */
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG0_ADRS
comma
id|POWER0_DAC_OFF
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_OFF
)paren
suffix:semicolon
multiline_comment|/* (8)VDD OFF */
id|lcdtg_ssp_send
c_func
(paren
id|POWERREG1_ADRS
comma
id|POWER1_VW_OFF
op_or
id|POWER1_GVSS_OFF
op_or
id|POWER1_VDD_OFF
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_set_phadadj
r_static
r_void
id|lcdtg_set_phadadj
c_func
(paren
id|u32
id|mode
)paren
(brace
r_int
id|adj
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|LCD_SHARP_VGA
)paren
(brace
multiline_comment|/* Setting for VGA */
id|adj
op_assign
id|current_par-&gt;phadadj
suffix:semicolon
r_if
c_cond
(paren
id|adj
OL
l_int|0
)paren
(brace
id|adj
op_assign
id|PHACTRL_PHASE_MANUAL
suffix:semicolon
)brace
r_else
(brace
id|adj
op_assign
(paren
(paren
id|adj
op_amp
l_int|0x0f
)paren
op_lshift
l_int|1
)paren
op_or
id|PHACTRL_PHASE_MANUAL
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Setting for QVGA */
id|adj
op_assign
(paren
id|PHAD_QVGA_DEFAULT_VAL
op_lshift
l_int|1
)paren
op_or
id|PHACTRL_PHASE_MANUAL
suffix:semicolon
)brace
id|lcdtg_ssp_send
c_func
(paren
id|PHACTRL_ADRS
comma
id|adj
)paren
suffix:semicolon
)brace
DECL|function|lcdtg_hw_init
r_static
r_void
id|lcdtg_hw_init
c_func
(paren
id|u32
id|mode
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|comadj
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|adrs
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|adrs
op_eq
l_int|0xfe
)paren
(brace
multiline_comment|/* Set Common Voltage */
id|comadj
op_assign
id|current_par-&gt;comadj
suffix:semicolon
r_if
c_cond
(paren
id|comadj
OL
l_int|0
)paren
(brace
id|comadj
op_assign
id|COMADJ_DEFAULT
suffix:semicolon
)brace
id|lcdtg_set_common_voltage
c_func
(paren
(paren
id|POWER0_DAC_ON
op_or
id|POWER0_COM_OFF
op_or
id|POWER0_VCC5_OFF
)paren
comma
id|comadj
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|adrs
op_eq
id|PHACTRL_ADRS
)paren
(brace
multiline_comment|/* Set Phase Adjuct */
id|lcdtg_set_phadadj
c_func
(paren
id|mode
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Other */
id|lcdtg_ssp_send
c_func
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|adrs
comma
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|wait
op_ne
l_int|0
)paren
id|udelay
c_func
(paren
id|lcdtg_power_on_table
(braket
id|i
)braket
dot
id|wait
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|LCD_SHARP_QVGA
suffix:colon
multiline_comment|/* Set Lcd Resolution (QVGA) */
id|lcdtg_ssp_send
c_func
(paren
id|RESCTL_ADRS
comma
id|RESCTL_QVGA
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LCD_SHARP_VGA
suffix:colon
multiline_comment|/* Set Lcd Resolution (VGA) */
id|lcdtg_ssp_send
c_func
(paren
id|RESCTL_ADRS
comma
id|RESCTL_VGA
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|function|lcdtg_lcd_change
r_static
r_void
id|lcdtg_lcd_change
c_func
(paren
id|u32
id|mode
)paren
(brace
multiline_comment|/* Set Phase Adjuct */
id|lcdtg_set_phadadj
c_func
(paren
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|LCD_SHARP_VGA
)paren
multiline_comment|/* Set Lcd Resolution (VGA) */
id|lcdtg_ssp_send
c_func
(paren
id|RESCTL_ADRS
comma
id|RESCTL_VGA
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|mode
op_eq
id|LCD_SHARP_QVGA
)paren
multiline_comment|/* Set Lcd Resolution (QVGA) */
id|lcdtg_ssp_send
c_func
(paren
id|RESCTL_ADRS
comma
id|RESCTL_QVGA
)paren
suffix:semicolon
)brace
DECL|variable|w100fb_driver
r_static
r_struct
id|device_driver
id|w100fb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;w100fb&quot;
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
dot
id|probe
op_assign
id|w100fb_probe
comma
dot
id|remove
op_assign
id|w100fb_remove
comma
dot
id|suspend
op_assign
id|w100fb_suspend
comma
dot
id|resume
op_assign
id|w100fb_resume
comma
)brace
suffix:semicolon
DECL|function|w100fb_init
r_int
id|__devinit
id|w100fb_init
c_func
(paren
r_void
)paren
(brace
r_return
id|driver_register
c_func
(paren
op_amp
id|w100fb_driver
)paren
suffix:semicolon
)brace
DECL|function|w100fb_cleanup
r_void
id|__exit
id|w100fb_cleanup
c_func
(paren
r_void
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|w100fb_driver
)paren
suffix:semicolon
)brace
DECL|variable|w100fb_init
id|module_init
c_func
(paren
id|w100fb_init
)paren
suffix:semicolon
DECL|variable|w100fb_cleanup
id|module_exit
c_func
(paren
id|w100fb_cleanup
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ATI Imageon w100 framebuffer driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPLv2&quot;
)paren
suffix:semicolon
eof
