multiline_comment|/*&n; *  ATI Frame Buffer Device Driver Core&n; *&n; *&t;Copyright (C) 2004  Alex Kern &lt;alex.kern@gmx.de&gt;&n; *&t;Copyright (C) 1997-2001  Geert Uytterhoeven&n; *&t;Copyright (C) 1998  Bernd Harries&n; *&t;Copyright (C) 1998  Eddie C. Dost  (ecd@skynet.be)&n; *&n; *  This driver supports the following ATI graphics chips:&n; *    - ATI Mach64&n; *&n; *  To do: add support for&n; *    - ATI Rage128 (from aty128fb.c)&n; *    - ATI Radeon (from radeonfb.c)&n; *&n; *  This driver is partly based on the PowerMac console driver:&n; *&n; *&t;Copyright (C) 1996 Paul Mackerras&n; *&n; *  and on the PowerMac ATI/mach64 display driver:&n; *&n; *&t;Copyright (C) 1997 Michael AK Tesch&n; *&n; *&t;      with work by Jon Howell&n; *&t;&t;&t;   Harry AC Eaton&n; *&t;&t;&t;   Anthony Tong &lt;atong@uiuc.edu&gt;&n; *&n; *  Generic LCD support written by Daniel Mantione, ported from 2.4.20 by Alex Kern&n; *  Many Thanks to Ville Syrj&#xfffd;l&#xfffd; for patches and fixing nasting 16 bit color bug.&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License. See the file COPYING in the main directory of this archive for&n; *  more details.&n; *&n; *  Many thanks to Nitya from ATI devrel for support and patience !&n; */
multiline_comment|/******************************************************************************&n;&n;  TODO:&n;&n;    - cursor support on all cards and all ramdacs.&n;    - cursor parameters controlable via ioctl()s.&n;    - guess PLL and MCLK based on the original PLL register values initialized&n;      by Open Firmware (if they are initialized). BIOS is done&n;&n;    (Anyone with Mac to help with this?)&n;&n;******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;video/mach64.h&gt;
macro_line|#include &quot;atyfb.h&quot;
macro_line|#include &quot;ati_ids.h&quot;
macro_line|#ifdef __powerpc__
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &quot;../macmodes.h&quot;
macro_line|#endif
macro_line|#ifdef __sparc__
macro_line|#include &lt;asm/pbm.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_ADB_PMU
macro_line|#include &lt;linux/adb.h&gt;
macro_line|#include &lt;linux/pmu.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_BOOTX_TEXT
macro_line|#include &lt;asm/btext.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
macro_line|#include &lt;asm/backlight.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
multiline_comment|/*&n; * Debug flags.&n; */
multiline_comment|/*#undef DEBUG*/
DECL|macro|DEBUG
mdefine_line|#define DEBUG
multiline_comment|/* Make sure n * PAGE_SIZE is protected at end of Aperture for GUI-regs */
multiline_comment|/*  - must be large enough to catch all GUI-Regs   */
multiline_comment|/*  - must be aligned to a PAGE boundary           */
DECL|macro|GUI_RESERVE
mdefine_line|#define GUI_RESERVE&t;(1 * PAGE_SIZE)
multiline_comment|/* FIXME: remove the FAIL definition */
DECL|macro|FAIL
mdefine_line|#define FAIL(msg) do { printk(KERN_CRIT &quot;atyfb: &quot; msg &quot;&bslash;n&quot;); return -EINVAL; } while (0)
DECL|macro|FAIL_MAX
mdefine_line|#define FAIL_MAX(msg, x, _max_) do { if(x &gt; _max_) { printk(KERN_CRIT &quot;atyfb: &quot; msg &quot; %x(%x)&bslash;n&quot;, x, _max_); return -EINVAL; } } while (0)
macro_line|#ifdef DEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)&t;printk(KERN_DEBUG &quot;atyfb: &quot; fmt, ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
DECL|macro|PRINTKI
mdefine_line|#define PRINTKI(fmt, args...)&t;printk(KERN_INFO &quot;atyfb: &quot; fmt, ## args)
DECL|macro|PRINTKE
mdefine_line|#define PRINTKE(fmt, args...)&t; printk(KERN_ERR &quot;atyfb: &quot; fmt, ## args)
macro_line|#if defined(CONFIG_PM) || defined(CONFIG_PMAC_BACKLIGHT) || defined (CONFIG_FB_ATY_GENERIC_LCD)
DECL|variable|lt_lcd_regs
r_static
r_const
id|u32
id|lt_lcd_regs
(braket
)braket
op_assign
(brace
id|CONFIG_PANEL_LG
comma
id|LCD_GEN_CNTL_LG
comma
id|DSTN_CONTROL_LG
comma
id|HFB_PITCH_ADDR_LG
comma
id|HORZ_STRETCHING_LG
comma
id|VERT_STRETCHING_LG
comma
l_int|0
comma
multiline_comment|/* EXT_VERT_STRETCH */
id|LT_GIO_LG
comma
id|POWER_MANAGEMENT_LG
)brace
suffix:semicolon
DECL|function|aty_st_lcd
r_void
id|aty_st_lcd
c_func
(paren
r_int
id|index
comma
id|u32
id|val
comma
r_const
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
id|aty_st_le32
c_func
(paren
id|lt_lcd_regs
(braket
id|index
)braket
comma
id|val
comma
id|par
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|temp
suffix:semicolon
multiline_comment|/* write addr byte */
id|temp
op_assign
id|aty_ld_le32
c_func
(paren
id|LCD_INDEX
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_INDEX
comma
(paren
id|temp
op_amp
op_complement
id|LCD_INDEX_MASK
)paren
op_or
id|index
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* write the register value */
id|aty_st_le32
c_func
(paren
id|LCD_DATA
comma
id|val
comma
id|par
)paren
suffix:semicolon
)brace
)brace
DECL|function|aty_ld_lcd
id|u32
id|aty_ld_lcd
c_func
(paren
r_int
id|index
comma
r_const
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
r_return
id|aty_ld_le32
c_func
(paren
id|lt_lcd_regs
(braket
id|index
)braket
comma
id|par
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|temp
suffix:semicolon
multiline_comment|/* write addr byte */
id|temp
op_assign
id|aty_ld_le32
c_func
(paren
id|LCD_INDEX
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_INDEX
comma
(paren
id|temp
op_amp
op_complement
id|LCD_INDEX_MASK
)paren
op_or
id|index
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* read the register value */
r_return
id|aty_ld_le32
c_func
(paren
id|LCD_DATA
comma
id|par
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* defined(CONFIG_PM) || defined(CONFIG_PMAC_BACKLIGHT) || defined (CONFIG_FB_ATY_GENERIC_LCD) */
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
multiline_comment|/*&n; * ATIReduceRatio --&n; *&n; * Reduce a fraction by factoring out the largest common divider of the&n; * fraction&squot;s numerator and denominator.&n; */
DECL|function|ATIReduceRatio
r_static
r_void
id|ATIReduceRatio
c_func
(paren
r_int
op_star
id|Numerator
comma
r_int
op_star
id|Denominator
)paren
(brace
r_int
id|Multiplier
comma
id|Divider
comma
id|Remainder
suffix:semicolon
id|Multiplier
op_assign
op_star
id|Numerator
suffix:semicolon
id|Divider
op_assign
op_star
id|Denominator
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Remainder
op_assign
id|Multiplier
op_mod
id|Divider
)paren
)paren
(brace
id|Multiplier
op_assign
id|Divider
suffix:semicolon
id|Divider
op_assign
id|Remainder
suffix:semicolon
)brace
op_star
id|Numerator
op_div_assign
id|Divider
suffix:semicolon
op_star
id|Denominator
op_div_assign
id|Divider
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;     *  The Hardware parameters for each card&n;     */
DECL|struct|aty_cmap_regs
r_struct
id|aty_cmap_regs
(brace
DECL|member|windex
id|u8
id|windex
suffix:semicolon
DECL|member|lut
id|u8
id|lut
suffix:semicolon
DECL|member|mask
id|u8
id|mask
suffix:semicolon
DECL|member|rindex
id|u8
id|rindex
suffix:semicolon
DECL|member|cntl
id|u8
id|cntl
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|pci_mmap_map
r_struct
id|pci_mmap_map
(brace
DECL|member|voff
r_int
r_int
id|voff
suffix:semicolon
DECL|member|poff
r_int
r_int
id|poff
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|prot_flag
r_int
r_int
id|prot_flag
suffix:semicolon
DECL|member|prot_mask
r_int
r_int
id|prot_mask
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|fb_fix_screeninfo
id|atyfb_fix
id|__initdata
op_assign
(brace
dot
id|id
op_assign
l_string|&quot;ATY Mach64&quot;
comma
dot
id|type
op_assign
id|FB_TYPE_PACKED_PIXELS
comma
dot
id|visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
comma
dot
id|xpanstep
op_assign
l_int|8
comma
dot
id|ypanstep
op_assign
l_int|1
comma
)brace
suffix:semicolon
multiline_comment|/*&n;     *  Frame buffer device API&n;     */
r_static
r_int
id|atyfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
suffix:semicolon
r_static
r_int
id|atyfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
suffix:semicolon
r_static
r_int
id|atyfb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|atyfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|atyfb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|atyfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|atyfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|atyfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_extern
r_void
id|atyfb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
suffix:semicolon
r_extern
r_void
id|atyfb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
suffix:semicolon
r_extern
r_void
id|atyfb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
suffix:semicolon
macro_line|#ifdef __sparc__
r_static
r_int
id|atyfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|atyfb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n;     *  Internal routines&n;     */
r_static
r_int
id|aty_init
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_char
op_star
id|name
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_static
r_int
id|store_video_par
c_func
(paren
r_char
op_star
id|videopar
comma
r_int
r_char
id|m64_num
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|saved_crtc
r_static
r_struct
id|crtc
id|saved_crtc
suffix:semicolon
DECL|variable|saved_pll
r_static
r_union
id|aty_pll
id|saved_pll
suffix:semicolon
r_static
r_void
id|aty_get_crtc
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
comma
r_struct
id|crtc
op_star
id|crtc
)paren
suffix:semicolon
r_static
r_void
id|aty_set_crtc
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
comma
r_const
r_struct
id|crtc
op_star
id|crtc
)paren
suffix:semicolon
r_static
r_int
id|aty_var_to_crtc
c_func
(paren
r_const
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|crtc
op_star
id|crtc
)paren
suffix:semicolon
r_static
r_int
id|aty_crtc_to_var
c_func
(paren
r_const
r_struct
id|crtc
op_star
id|crtc
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
suffix:semicolon
r_static
r_void
id|set_off_pitch
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC
r_static
r_int
id|read_aty_sense
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;     *  Interface used by the world&n;     */
DECL|variable|default_var
r_struct
id|fb_var_screeninfo
id|default_var
op_assign
(brace
multiline_comment|/* 640x480, 60 Hz, Non-Interlaced (25.175 MHz dotclock) */
l_int|640
comma
l_int|480
comma
l_int|640
comma
l_int|480
comma
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|39722
comma
l_int|48
comma
l_int|16
comma
l_int|33
comma
l_int|10
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
DECL|variable|defmode
r_static
r_struct
id|fb_videomode
id|defmode
op_assign
(brace
multiline_comment|/* 640x480 @ 60 Hz, 31.5 kHz hsync */
l_int|NULL
comma
l_int|60
comma
l_int|640
comma
l_int|480
comma
l_int|39721
comma
l_int|40
comma
l_int|24
comma
l_int|32
comma
l_int|11
comma
l_int|96
comma
l_int|2
comma
l_int|0
comma
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
DECL|variable|atyfb_ops
r_static
r_struct
id|fb_ops
id|atyfb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|atyfb_open
comma
dot
id|fb_release
op_assign
id|atyfb_release
comma
dot
id|fb_check_var
op_assign
id|atyfb_check_var
comma
dot
id|fb_set_par
op_assign
id|atyfb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|atyfb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|atyfb_pan_display
comma
dot
id|fb_blank
op_assign
id|atyfb_blank
comma
dot
id|fb_ioctl
op_assign
id|atyfb_ioctl
comma
dot
id|fb_fillrect
op_assign
id|atyfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|atyfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|atyfb_imageblit
comma
dot
id|fb_cursor
op_assign
id|atyfb_cursor
comma
macro_line|#ifdef __sparc__
dot
id|fb_mmap
op_assign
id|atyfb_mmap
comma
macro_line|#endif
dot
id|fb_sync
op_assign
id|atyfb_sync
comma
)brace
suffix:semicolon
DECL|variable|noaccel
r_static
r_int
id|noaccel
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
DECL|variable|nomtrr
r_static
r_int
id|nomtrr
suffix:semicolon
macro_line|#endif
DECL|variable|vram
r_static
r_int
id|vram
suffix:semicolon
DECL|variable|pll
r_static
r_int
id|pll
suffix:semicolon
DECL|variable|mclk
r_static
r_int
id|mclk
suffix:semicolon
DECL|variable|xclk
r_static
r_int
id|xclk
suffix:semicolon
DECL|variable|mode
r_static
r_char
op_star
id|mode
suffix:semicolon
macro_line|#ifdef CONFIG_PPC
DECL|variable|__initdata
r_static
r_int
id|default_vmode
id|__initdata
op_assign
id|VMODE_CHOOSE
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|default_cmode
id|__initdata
op_assign
id|CMODE_CHOOSE
suffix:semicolon
id|module_param_named
c_func
(paren
id|vmode
comma
id|default_vmode
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vmode
comma
l_string|&quot;int: video mode for mac&quot;
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|cmode
comma
id|default_cmode
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|cmode
comma
l_string|&quot;int: color mode for mac&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ATARI
DECL|variable|__initdata
r_static
r_int
r_int
id|mach64_count
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_int
id|phys_vmembase
(braket
id|FB_MAX
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_int
id|phys_size
(braket
id|FB_MAX
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_int
id|phys_guiregbase
(braket
id|FB_MAX
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* top -&gt; down is an evolution of mach64 chipset, any corrections? */
DECL|macro|ATI_CHIP_88800GX
mdefine_line|#define ATI_CHIP_88800GX   (M64F_GX)
DECL|macro|ATI_CHIP_88800CX
mdefine_line|#define ATI_CHIP_88800CX   (M64F_GX)
DECL|macro|ATI_CHIP_264CT
mdefine_line|#define ATI_CHIP_264CT     (M64F_CT | M64F_INTEGRATED | M64F_CT_BUS | M64F_MAGIC_FIFO)
DECL|macro|ATI_CHIP_264ET
mdefine_line|#define ATI_CHIP_264ET     (M64F_CT | M64F_INTEGRATED | M64F_CT_BUS | M64F_MAGIC_FIFO)
DECL|macro|ATI_CHIP_264VT
mdefine_line|#define ATI_CHIP_264VT     (M64F_VT | M64F_INTEGRATED | M64F_VT_BUS | M64F_MAGIC_FIFO)
DECL|macro|ATI_CHIP_264GT
mdefine_line|#define ATI_CHIP_264GT     (M64F_GT | M64F_INTEGRATED               | M64F_MAGIC_FIFO | M64F_EXTRA_BRIGHT)
DECL|macro|ATI_CHIP_264VTB
mdefine_line|#define ATI_CHIP_264VTB    (M64F_VT | M64F_INTEGRATED | M64F_VT_BUS | M64F_GTB_DSP)
DECL|macro|ATI_CHIP_264VT3
mdefine_line|#define ATI_CHIP_264VT3    (M64F_VT | M64F_INTEGRATED | M64F_VT_BUS | M64F_GTB_DSP | M64F_SDRAM_MAGIC_PLL)
DECL|macro|ATI_CHIP_264VT4
mdefine_line|#define ATI_CHIP_264VT4    (M64F_VT | M64F_INTEGRATED               | M64F_GTB_DSP)
DECL|macro|ATI_CHIP_264LT
mdefine_line|#define ATI_CHIP_264LT     (M64F_GT | M64F_INTEGRATED               | M64F_GTB_DSP)
multiline_comment|/* make sets shorter */
DECL|macro|ATI_MODERN_SET
mdefine_line|#define ATI_MODERN_SET     (M64F_GT | M64F_INTEGRATED               | M64F_GTB_DSP | M64F_EXTRA_BRIGHT)
DECL|macro|ATI_CHIP_264GTB
mdefine_line|#define ATI_CHIP_264GTB    (ATI_MODERN_SET | M64F_SDRAM_MAGIC_PLL)
multiline_comment|/*#define ATI_CHIP_264GTDVD  ?*/
DECL|macro|ATI_CHIP_264LTG
mdefine_line|#define ATI_CHIP_264LTG    (ATI_MODERN_SET | M64F_SDRAM_MAGIC_PLL)
DECL|macro|ATI_CHIP_264GT2C
mdefine_line|#define ATI_CHIP_264GT2C   (ATI_MODERN_SET | M64F_SDRAM_MAGIC_PLL | M64F_HW_TRIPLE)
DECL|macro|ATI_CHIP_264GTPRO
mdefine_line|#define ATI_CHIP_264GTPRO  (ATI_MODERN_SET | M64F_SDRAM_MAGIC_PLL | M64F_HW_TRIPLE | M64F_FIFO_32 | M64F_RESET_3D)
DECL|macro|ATI_CHIP_264LTPRO
mdefine_line|#define ATI_CHIP_264LTPRO  (ATI_MODERN_SET | M64F_HW_TRIPLE | M64F_FIFO_32 | M64F_RESET_3D)
DECL|macro|ATI_CHIP_264XL
mdefine_line|#define ATI_CHIP_264XL     (ATI_MODERN_SET | M64F_HW_TRIPLE | M64F_FIFO_32 | M64F_RESET_3D | M64F_XL_DLL | M64F_MFB_FORCE_4)
DECL|macro|ATI_CHIP_MOBILITY
mdefine_line|#define ATI_CHIP_MOBILITY  (ATI_MODERN_SET | M64F_HW_TRIPLE | M64F_FIFO_32 | M64F_RESET_3D | M64F_XL_DLL | M64F_MFB_FORCE_4 | M64F_MOBIL_BUS)
r_static
r_struct
(brace
DECL|member|pci_id
id|u16
id|pci_id
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|pll
DECL|member|mclk
DECL|member|xclk
r_int
id|pll
comma
id|mclk
comma
id|xclk
suffix:semicolon
DECL|member|features
id|u32
id|features
suffix:semicolon
DECL|variable|__initdata
)brace
id|aty_chips
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_FB_ATY_GX
multiline_comment|/* Mach64 GX */
(brace
id|PCI_CHIP_MACH64GX
comma
l_string|&quot;ATI888GX00 (Mach64 GX)&quot;
comma
l_int|135
comma
l_int|50
comma
l_int|50
comma
id|ATI_CHIP_88800GX
)brace
comma
(brace
id|PCI_CHIP_MACH64CX
comma
l_string|&quot;ATI888CX00 (Mach64 CX)&quot;
comma
l_int|135
comma
l_int|50
comma
l_int|50
comma
id|ATI_CHIP_88800CX
)brace
comma
macro_line|#endif /* CONFIG_FB_ATY_GX */
macro_line|#ifdef CONFIG_FB_ATY_CT
(brace
id|PCI_CHIP_MACH64CT
comma
l_string|&quot;ATI264CT (Mach64 CT)&quot;
comma
l_int|135
comma
l_int|60
comma
l_int|60
comma
id|ATI_CHIP_264CT
)brace
comma
(brace
id|PCI_CHIP_MACH64ET
comma
l_string|&quot;ATI264ET (Mach64 ET)&quot;
comma
l_int|135
comma
l_int|60
comma
l_int|60
comma
id|ATI_CHIP_264ET
)brace
comma
(brace
id|PCI_CHIP_MACH64VT
comma
l_string|&quot;ATI264VT? (Mach64 VT)&quot;
comma
l_int|170
comma
l_int|67
comma
l_int|67
comma
id|ATI_CHIP_264VT
)brace
comma
(brace
id|PCI_CHIP_MACH64GT
comma
l_string|&quot;3D RAGE (Mach64 GT)&quot;
comma
l_int|135
comma
l_int|63
comma
l_int|63
comma
id|ATI_CHIP_264GT
)brace
comma
multiline_comment|/* FIXME { ...ATI_264GU, maybe ATI_CHIP_264GTDVD }, */
(brace
id|PCI_CHIP_MACH64GU
comma
l_string|&quot;3D RAGE II+ (Mach64 GTB)&quot;
comma
l_int|200
comma
l_int|67
comma
l_int|67
comma
id|ATI_CHIP_264GTB
)brace
comma
(brace
id|PCI_CHIP_MACH64VU
comma
l_string|&quot;ATI264VTB (Mach64 VU)&quot;
comma
l_int|200
comma
l_int|67
comma
l_int|67
comma
id|ATI_CHIP_264VT3
)brace
comma
(brace
id|PCI_CHIP_MACH64LT
comma
l_string|&quot;3D RAGE LT (Mach64 LT)&quot;
comma
l_int|135
comma
l_int|63
comma
l_int|63
comma
id|ATI_CHIP_264LT
)brace
comma
multiline_comment|/* FIXME chipset maybe ATI_CHIP_264LTPRO ? */
(brace
id|PCI_CHIP_MACH64LG
comma
l_string|&quot;3D RAGE LT-G (Mach64 LG)&quot;
comma
l_int|230
comma
l_int|63
comma
l_int|63
comma
id|ATI_CHIP_264LTG
op_or
id|M64F_LT_LCD_REGS
op_or
id|M64F_G3_PB_1024x768
)brace
comma
(brace
id|PCI_CHIP_MACH64VV
comma
l_string|&quot;ATI264VT4 (Mach64 VV)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|83
comma
id|ATI_CHIP_264VT4
)brace
comma
(brace
id|PCI_CHIP_MACH64GV
comma
l_string|&quot;3D RAGE IIC (Mach64 GV, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|83
comma
id|ATI_CHIP_264GT2C
)brace
comma
(brace
id|PCI_CHIP_MACH64GW
comma
l_string|&quot;3D RAGE IIC (Mach64 GW, AGP)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|83
comma
id|ATI_CHIP_264GT2C
)brace
comma
(brace
id|PCI_CHIP_MACH64GY
comma
l_string|&quot;3D RAGE IIC (Mach64 GY, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|83
comma
id|ATI_CHIP_264GT2C
)brace
comma
(brace
id|PCI_CHIP_MACH64GZ
comma
l_string|&quot;3D RAGE IIC (Mach64 GZ, AGP)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|83
comma
id|ATI_CHIP_264GT2C
)brace
comma
(brace
id|PCI_CHIP_MACH64GB
comma
l_string|&quot;3D RAGE PRO (Mach64 GB, BGA, AGP)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264GTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64GD
comma
l_string|&quot;3D RAGE PRO (Mach64 GD, BGA, AGP 1x)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264GTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64GI
comma
l_string|&quot;3D RAGE PRO (Mach64 GI, BGA, PCI)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264GTPRO
op_or
id|M64F_MAGIC_VRAM_SIZE
)brace
comma
(brace
id|PCI_CHIP_MACH64GP
comma
l_string|&quot;3D RAGE PRO (Mach64 GP, PQFP, PCI)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264GTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64GQ
comma
l_string|&quot;3D RAGE PRO (Mach64 GQ, PQFP, PCI, limited 3D)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264GTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64LB
comma
l_string|&quot;3D RAGE LT PRO (Mach64 LB, AGP)&quot;
comma
l_int|236
comma
l_int|75
comma
l_int|100
comma
id|ATI_CHIP_264LTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64LD
comma
l_string|&quot;3D RAGE LT PRO (Mach64 LD, AGP)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264LTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64LI
comma
l_string|&quot;3D RAGE LT PRO (Mach64 LI, PCI)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264LTPRO
op_or
id|M64F_G3_PB_1_1
op_or
id|M64F_G3_PB_1024x768
)brace
comma
(brace
id|PCI_CHIP_MACH64LP
comma
l_string|&quot;3D RAGE LT PRO (Mach64 LP, PCI)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264LTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64LQ
comma
l_string|&quot;3D RAGE LT PRO (Mach64 LQ, PCI)&quot;
comma
l_int|230
comma
l_int|100
comma
l_int|100
comma
id|ATI_CHIP_264LTPRO
)brace
comma
(brace
id|PCI_CHIP_MACH64GM
comma
l_string|&quot;3D RAGE XL (Mach64 GM, AGP)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64GN
comma
l_string|&quot;3D RAGE XL (Mach64 GN, AGP)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64GO
comma
l_string|&quot;3D RAGE XL (Mach64 GO, PCI-66/BGA)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64GR
comma
l_string|&quot;3D RAGE XL (Mach64 GR, PCI-33MHz)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64GL
comma
l_string|&quot;3D RAGE XL (Mach64 GL, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64GS
comma
l_string|&quot;3D RAGE XL (Mach64 GS, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|63
comma
id|ATI_CHIP_264XL
)brace
comma
(brace
id|PCI_CHIP_MACH64LM
comma
l_string|&quot;3D RAGE Mobility P/M (Mach64 LM, AGP 2x)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|125
comma
id|ATI_CHIP_MOBILITY
)brace
comma
(brace
id|PCI_CHIP_MACH64LN
comma
l_string|&quot;3D RAGE Mobility L (Mach64 LN, AGP 2x)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|125
comma
id|ATI_CHIP_MOBILITY
)brace
comma
(brace
id|PCI_CHIP_MACH64LR
comma
l_string|&quot;3D RAGE Mobility P/M (Mach64 LR, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|125
comma
id|ATI_CHIP_MOBILITY
)brace
comma
(brace
id|PCI_CHIP_MACH64LS
comma
l_string|&quot;3D RAGE Mobility L (Mach64 LS, PCI)&quot;
comma
l_int|230
comma
l_int|83
comma
l_int|125
comma
id|ATI_CHIP_MOBILITY
)brace
comma
macro_line|#endif /* CONFIG_FB_ATY_CT */
)brace
suffix:semicolon
multiline_comment|/* can not fail */
DECL|function|correct_chipset
r_static
r_int
id|__devinit
id|correct_chipset
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u8
id|rev
suffix:semicolon
id|u16
id|type
suffix:semicolon
id|u32
id|chip_id
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
r_sizeof
(paren
id|aty_chips
)paren
op_div
r_sizeof
(paren
op_star
id|aty_chips
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|par-&gt;pci_id
op_eq
id|aty_chips
(braket
id|i
)braket
dot
id|pci_id
)paren
r_break
suffix:semicolon
id|name
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|name
suffix:semicolon
id|par-&gt;pll_limits.pll_max
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|pll
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|mclk
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|xclk
suffix:semicolon
id|par-&gt;features
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|features
suffix:semicolon
id|chip_id
op_assign
id|aty_ld_le32
c_func
(paren
id|CONFIG_CHIP_ID
comma
id|par
)paren
suffix:semicolon
id|type
op_assign
id|chip_id
op_amp
id|CFG_CHIP_TYPE
suffix:semicolon
id|rev
op_assign
(paren
id|chip_id
op_amp
id|CFG_CHIP_REV
)paren
op_rshift
l_int|24
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;pci_id
)paren
(brace
macro_line|#ifdef CONFIG_FB_ATY_GX
r_case
id|PCI_CHIP_MACH64GX
suffix:colon
r_if
c_cond
(paren
id|type
op_ne
l_int|0x00d7
)paren
(brace
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_CHIP_MACH64CX
suffix:colon
r_if
c_cond
(paren
id|type
op_ne
l_int|0x0057
)paren
(brace
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_ATY_CT
r_case
id|PCI_CHIP_MACH64VT
suffix:colon
id|rev
op_and_assign
l_int|0xc7
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x00
)paren
(brace
id|name
op_assign
l_string|&quot;ATI264VTA3 (Mach64 VT)&quot;
suffix:semicolon
id|par-&gt;pll_limits.pll_max
op_assign
l_int|170
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;features
op_assign
id|ATI_CHIP_264VT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x40
)paren
(brace
id|name
op_assign
l_string|&quot;ATI264VTA4 (Mach64 VT)&quot;
suffix:semicolon
id|par-&gt;pll_limits.pll_max
op_assign
l_int|200
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;features
op_assign
id|ATI_CHIP_264VT
op_or
id|M64F_MAGIC_POSTDIV
suffix:semicolon
)brace
r_else
(brace
id|name
op_assign
l_string|&quot;ATI264VTB (Mach64 VT)&quot;
suffix:semicolon
id|par-&gt;pll_limits.pll_max
op_assign
l_int|200
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;features
op_assign
id|ATI_CHIP_264VTB
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PCI_CHIP_MACH64GT
suffix:colon
id|rev
op_and_assign
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x01
)paren
(brace
id|par-&gt;pll_limits.pll_max
op_assign
l_int|170
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;features
op_assign
id|ATI_CHIP_264GTB
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x02
)paren
(brace
id|par-&gt;pll_limits.pll_max
op_assign
l_int|200
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
l_int|67
suffix:semicolon
id|par-&gt;features
op_assign
id|ATI_CHIP_264GTB
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
)brace
id|PRINTKI
c_func
(paren
l_string|&quot;%s [0x%04x rev 0x%02x]&bslash;n&quot;
comma
id|name
comma
id|type
comma
id|rev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_char
id|ram_dram
(braket
)braket
id|__initdata
op_assign
l_string|&quot;DRAM&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|ram_resv
(braket
)braket
id|__initdata
op_assign
l_string|&quot;RESV&quot;
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GX
DECL|variable|__initdata
r_static
r_char
id|ram_vram
(braket
)braket
id|__initdata
op_assign
l_string|&quot;VRAM&quot;
suffix:semicolon
macro_line|#endif /* CONFIG_FB_ATY_GX */
macro_line|#ifdef CONFIG_FB_ATY_CT
DECL|variable|__initdata
r_static
r_char
id|ram_edo
(braket
)braket
id|__initdata
op_assign
l_string|&quot;EDO&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|ram_sdram
(braket
)braket
id|__initdata
op_assign
l_string|&quot;SDRAM (1:1)&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|ram_sgram
(braket
)braket
id|__initdata
op_assign
l_string|&quot;SGRAM (1:1)&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|ram_sdram32
(braket
)braket
id|__initdata
op_assign
l_string|&quot;SDRAM (2:1) (32-bit)&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|ram_off
(braket
)braket
id|__initdata
op_assign
l_string|&quot;OFF&quot;
suffix:semicolon
macro_line|#endif /* CONFIG_FB_ATY_CT */
DECL|variable|pseudo_palette
r_static
id|u32
id|pseudo_palette
(braket
l_int|17
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GX
DECL|variable|__initdata
r_static
r_char
op_star
id|aty_gx_ram
(braket
l_int|8
)braket
id|__initdata
op_assign
(brace
id|ram_dram
comma
id|ram_vram
comma
id|ram_vram
comma
id|ram_dram
comma
id|ram_dram
comma
id|ram_vram
comma
id|ram_vram
comma
id|ram_resv
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FB_ATY_GX */
macro_line|#ifdef CONFIG_FB_ATY_CT
DECL|variable|__initdata
r_static
r_char
op_star
id|aty_ct_ram
(braket
l_int|8
)braket
id|__initdata
op_assign
(brace
id|ram_off
comma
id|ram_dram
comma
id|ram_edo
comma
id|ram_edo
comma
id|ram_sdram
comma
id|ram_sgram
comma
id|ram_sdram32
comma
id|ram_resv
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FB_ATY_CT */
DECL|function|atyfb_get_pixclock
r_static
id|u32
id|atyfb_get_pixclock
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u32
id|pixclock
op_assign
id|var-&gt;pixclock
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
id|u32
id|lcd_on_off
suffix:semicolon
id|par-&gt;pll.ct.xres
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
id|lcd_on_off
op_assign
id|aty_ld_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lcd_on_off
op_amp
id|LCD_ON
)paren
(brace
id|par-&gt;pll.ct.xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|pixclock
op_assign
id|par-&gt;lcd_pixclock
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|pixclock
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PPC)
multiline_comment|/*&n; *  Apple monitor sense&n; */
DECL|function|read_aty_sense
r_static
r_int
id|__init
id|read_aty_sense
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
r_int
id|sense
comma
id|i
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x31003100
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive outputs high */
id|__delay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* turn off outputs */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|i
op_assign
id|aty_ld_le32
c_func
(paren
id|GP_IO
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* get primary sense value */
id|sense
op_assign
(paren
(paren
id|i
op_amp
l_int|0x3000
)paren
op_rshift
l_int|3
)paren
op_or
(paren
id|i
op_amp
l_int|0x100
)paren
suffix:semicolon
multiline_comment|/* drive each sense line low in turn and collect the other 2 */
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x20000000
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive A low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|i
op_assign
id|aty_ld_le32
c_func
(paren
id|GP_IO
comma
id|par
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
(paren
id|i
op_amp
l_int|0x1000
)paren
op_rshift
l_int|7
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|0x100
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x20002000
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive A high again */
id|__delay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x10000000
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive B low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|i
op_assign
id|aty_ld_le32
c_func
(paren
id|GP_IO
comma
id|par
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
(paren
id|i
op_amp
l_int|0x2000
)paren
op_rshift
l_int|10
)paren
op_or
(paren
(paren
id|i
op_amp
l_int|0x100
)paren
op_rshift
l_int|6
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x10001000
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive B high again */
id|__delay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0x01000000
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* drive C low */
id|__delay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|sense
op_or_assign
(paren
id|aty_ld_le32
c_func
(paren
id|GP_IO
comma
id|par
)paren
op_amp
l_int|0x3000
)paren
op_rshift
l_int|12
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|GP_IO
comma
l_int|0
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* turn off outputs */
r_return
id|sense
suffix:semicolon
)brace
macro_line|#endif /* defined(CONFIG_PPC) */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*&n; *  CRTC programming&n; */
DECL|function|aty_get_crtc
r_static
r_void
id|aty_get_crtc
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
comma
r_struct
id|crtc
op_star
id|crtc
)paren
(brace
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
id|crtc-&gt;lcd_index
op_assign
id|aty_ld_le32
c_func
(paren
id|LCD_INDEX
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_INDEX
comma
id|crtc-&gt;lcd_index
comma
id|par
)paren
suffix:semicolon
)brace
id|crtc-&gt;lcd_config_panel
op_assign
id|aty_ld_lcd
c_func
(paren
id|CONFIG_PANEL
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_assign
id|aty_ld_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* switch to non shadow registers */
id|aty_st_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|crtc-&gt;lcd_gen_cntl
op_amp
op_complement
(paren
id|CRTC_RW_SELECT
op_or
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
)paren
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* save stretching */
id|crtc-&gt;horz_stretching
op_assign
id|aty_ld_lcd
c_func
(paren
id|HORZ_STRETCHING
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;vert_stretching
op_assign
id|aty_ld_lcd
c_func
(paren
id|VERT_STRETCHING
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
id|crtc-&gt;ext_vert_stretch
op_assign
id|aty_ld_lcd
c_func
(paren
id|EXT_VERT_STRETCH
comma
id|par
)paren
suffix:semicolon
)brace
macro_line|#endif
id|crtc-&gt;h_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;h_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;v_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;v_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;vline_crnt_vline
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_VLINE_CRNT_VLINE
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;off_pitch
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;gen_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
multiline_comment|/* switch to shadow registers */
id|aty_st_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
op_complement
id|CRTC_RW_SELECT
)paren
op_or
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;shadow_h_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;shadow_h_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;shadow_v_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;shadow_v_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_GEN_CNTL
comma
id|crtc-&gt;lcd_gen_cntl
comma
id|par
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
)brace
DECL|function|aty_set_crtc
r_static
r_void
id|aty_set_crtc
c_func
(paren
r_const
r_struct
id|atyfb_par
op_star
id|par
comma
r_const
r_struct
id|crtc
op_star
id|crtc
)paren
(brace
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
multiline_comment|/* stop CRTC */
id|aty_st_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|crtc-&gt;gen_cntl
op_amp
op_complement
(paren
id|CRTC_EXT_DISP_EN
op_or
id|CRTC_EN
)paren
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* update non-shadow registers first */
id|aty_st_lcd
c_func
(paren
id|CONFIG_PANEL
comma
id|crtc-&gt;lcd_config_panel
comma
id|par
)paren
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|crtc-&gt;lcd_gen_cntl
op_amp
op_complement
(paren
id|CRTC_RW_SELECT
op_or
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
)paren
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* temporarily disable stretching */
id|aty_st_lcd
c_func
(paren
id|HORZ_STRETCHING
comma
id|crtc-&gt;horz_stretching
op_amp
op_complement
(paren
id|HORZ_STRETCH_MODE
op_or
id|HORZ_STRETCH_EN
)paren
comma
id|par
)paren
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|VERT_STRETCHING
comma
id|crtc-&gt;vert_stretching
op_amp
op_complement
(paren
id|VERT_STRETCH_RATIO1
op_or
id|VERT_STRETCH_RATIO2
op_or
id|VERT_STRETCH_USE0
op_or
id|VERT_STRETCH_EN
)paren
comma
id|par
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* turn off CRT */
id|aty_st_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|crtc-&gt;gen_cntl
op_amp
op_complement
id|CRTC_EN
comma
id|par
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;setting up CRTC&bslash;n&quot;
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;set primary CRT to %ix%i %c%c composite %c&bslash;n&quot;
comma
(paren
(paren
(paren
(paren
id|crtc-&gt;h_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|3
)paren
comma
(paren
(paren
(paren
id|crtc-&gt;v_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_plus
l_int|1
)paren
comma
(paren
id|crtc-&gt;h_sync_strt_wid
op_amp
l_int|0x200000
)paren
ques
c_cond
l_char|&squot;N&squot;
suffix:colon
l_char|&squot;P&squot;
comma
(paren
id|crtc-&gt;v_sync_strt_wid
op_amp
l_int|0x200000
)paren
ques
c_cond
l_char|&squot;N&squot;
suffix:colon
l_char|&squot;P&squot;
comma
(paren
id|crtc-&gt;gen_cntl
op_amp
id|CRTC_CSYNC_EN
)paren
ques
c_cond
l_char|&squot;P&squot;
suffix:colon
l_char|&squot;N&squot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_H_TOTAL_DISP: %x&bslash;n&quot;
comma
id|crtc-&gt;h_tot_disp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_H_SYNC_STRT_WID: %x&bslash;n&quot;
comma
id|crtc-&gt;h_sync_strt_wid
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_V_TOTAL_DISP: %x&bslash;n&quot;
comma
id|crtc-&gt;v_tot_disp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_V_SYNC_STRT_WID: %x&bslash;n&quot;
comma
id|crtc-&gt;v_sync_strt_wid
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_OFF_PITCH: %x&bslash;n&quot;
comma
id|crtc-&gt;off_pitch
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_VLINE_CRNT_VLINE: %x&bslash;n&quot;
comma
id|crtc-&gt;vline_crnt_vline
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;CRTC_GEN_CNTL: %x&bslash;n&quot;
comma
id|crtc-&gt;gen_cntl
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|crtc-&gt;h_tot_disp
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|crtc-&gt;h_sync_strt_wid
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|crtc-&gt;v_tot_disp
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|crtc-&gt;v_sync_strt_wid
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|crtc-&gt;off_pitch
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_VLINE_CRNT_VLINE
comma
id|crtc-&gt;vline_crnt_vline
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|crtc-&gt;gen_cntl
comma
id|par
)paren
suffix:semicolon
macro_line|#if 0
id|FIXME
r_if
c_cond
(paren
id|par-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
id|aty_init_engine
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
multiline_comment|/* after setting the CRTC registers we should set the LCD registers. */
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
multiline_comment|/* switch to shadow registers */
id|aty_st_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
op_complement
id|CRTC_RW_SELECT
)paren
op_or
(paren
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
)paren
comma
id|par
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;set secondary CRT to %ix%i %c%c&bslash;n&quot;
comma
(paren
(paren
(paren
(paren
id|crtc-&gt;shadow_h_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|3
)paren
comma
(paren
(paren
(paren
id|crtc-&gt;shadow_v_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_plus
l_int|1
)paren
comma
(paren
id|crtc-&gt;shadow_h_sync_strt_wid
op_amp
l_int|0x200000
)paren
ques
c_cond
l_char|&squot;N&squot;
suffix:colon
l_char|&squot;P&squot;
comma
(paren
id|crtc-&gt;shadow_v_sync_strt_wid
op_amp
l_int|0x200000
)paren
ques
c_cond
l_char|&squot;N&squot;
suffix:colon
l_char|&squot;P&squot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;SHADOW CRTC_H_TOTAL_DISP: %x&bslash;n&quot;
comma
id|crtc-&gt;shadow_h_tot_disp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;SHADOW CRTC_H_SYNC_STRT_WID: %x&bslash;n&quot;
comma
id|crtc-&gt;shadow_h_sync_strt_wid
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;SHADOW CRTC_V_TOTAL_DISP: %x&bslash;n&quot;
comma
id|crtc-&gt;shadow_v_tot_disp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;SHADOW CRTC_V_SYNC_STRT_WID: %x&bslash;n&quot;
comma
id|crtc-&gt;shadow_v_sync_strt_wid
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|crtc-&gt;shadow_h_tot_disp
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|crtc-&gt;shadow_h_sync_strt_wid
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|crtc-&gt;shadow_v_tot_disp
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|crtc-&gt;shadow_v_sync_strt_wid
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* restore CRTC selection &amp; shadow state and enable stretching */
id|DPRINTK
c_func
(paren
l_string|&quot;LCD_GEN_CNTL: %x&bslash;n&quot;
comma
id|crtc-&gt;lcd_gen_cntl
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;HORZ_STRETCHING: %x&bslash;n&quot;
comma
id|crtc-&gt;horz_stretching
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VERT_STRETCHING: %x&bslash;n&quot;
comma
id|crtc-&gt;vert_stretching
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXT_VERT_STRETCH: %x&bslash;n&quot;
comma
id|crtc-&gt;ext_vert_stretch
)paren
suffix:semicolon
)brace
id|aty_st_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|crtc-&gt;lcd_gen_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|HORZ_STRETCHING
comma
id|crtc-&gt;horz_stretching
comma
id|par
)paren
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|VERT_STRETCHING
comma
id|crtc-&gt;vert_stretching
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
id|aty_st_lcd
c_func
(paren
id|EXT_VERT_STRETCH
comma
id|crtc-&gt;ext_vert_stretch
comma
id|par
)paren
suffix:semicolon
id|aty_ld_le32
c_func
(paren
id|LCD_INDEX
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_INDEX
comma
id|crtc-&gt;lcd_index
comma
id|par
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
)brace
DECL|function|aty_var_to_crtc
r_static
r_int
id|aty_var_to_crtc
c_func
(paren
r_const
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|crtc
op_star
id|crtc
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|xres
comma
id|yres
comma
id|vxres
comma
id|vyres
comma
id|xoffset
comma
id|yoffset
comma
id|bpp
suffix:semicolon
id|u32
id|sync
comma
id|vmode
comma
id|vdisplay
suffix:semicolon
id|u32
id|h_total
comma
id|h_disp
comma
id|h_sync_strt
comma
id|h_sync_end
comma
id|h_sync_dly
comma
id|h_sync_wid
comma
id|h_sync_pol
suffix:semicolon
id|u32
id|v_total
comma
id|v_disp
comma
id|v_sync_strt
comma
id|v_sync_end
comma
id|v_sync_wid
comma
id|v_sync_pol
comma
id|c_sync
suffix:semicolon
id|u32
id|pix_width
comma
id|dp_pix_width
comma
id|dp_chain_mask
suffix:semicolon
multiline_comment|/* input */
id|xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|yres
op_assign
id|var-&gt;yres
suffix:semicolon
id|vxres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|vyres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
id|xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
id|bpp
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|bpp
op_eq
l_int|16
)paren
id|bpp
op_assign
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
ques
c_cond
l_int|15
suffix:colon
l_int|16
suffix:semicolon
id|sync
op_assign
id|var-&gt;sync
suffix:semicolon
id|vmode
op_assign
id|var-&gt;vmode
suffix:semicolon
multiline_comment|/* convert (and round up) and validate */
r_if
c_cond
(paren
id|vxres
OL
id|xres
op_plus
id|xoffset
)paren
id|vxres
op_assign
id|xres
op_plus
id|xoffset
suffix:semicolon
id|h_disp
op_assign
id|xres
suffix:semicolon
r_if
c_cond
(paren
id|vyres
OL
id|yres
op_plus
id|yoffset
)paren
id|vyres
op_assign
id|yres
op_plus
id|yoffset
suffix:semicolon
id|v_disp
op_assign
id|yres
suffix:semicolon
r_if
c_cond
(paren
id|bpp
op_le
l_int|8
)paren
(brace
id|bpp
op_assign
l_int|8
suffix:semicolon
id|pix_width
op_assign
id|CRTC_PIX_WIDTH_8BPP
suffix:semicolon
id|dp_pix_width
op_assign
id|HOST_8BPP
op_or
id|SRC_8BPP
op_or
id|DST_8BPP
op_or
id|BYTE_ORDER_LSB_TO_MSB
suffix:semicolon
id|dp_chain_mask
op_assign
id|DP_CHAIN_8BPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bpp
op_le
l_int|15
)paren
(brace
id|bpp
op_assign
l_int|16
suffix:semicolon
id|pix_width
op_assign
id|CRTC_PIX_WIDTH_15BPP
suffix:semicolon
id|dp_pix_width
op_assign
id|HOST_15BPP
op_or
id|SRC_15BPP
op_or
id|DST_15BPP
op_or
id|BYTE_ORDER_LSB_TO_MSB
suffix:semicolon
id|dp_chain_mask
op_assign
id|DP_CHAIN_15BPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bpp
op_le
l_int|16
)paren
(brace
id|bpp
op_assign
l_int|16
suffix:semicolon
id|pix_width
op_assign
id|CRTC_PIX_WIDTH_16BPP
suffix:semicolon
id|dp_pix_width
op_assign
id|HOST_16BPP
op_or
id|SRC_16BPP
op_or
id|DST_16BPP
op_or
id|BYTE_ORDER_LSB_TO_MSB
suffix:semicolon
id|dp_chain_mask
op_assign
id|DP_CHAIN_16BPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bpp
op_le
l_int|24
op_logical_and
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
id|bpp
op_assign
l_int|24
suffix:semicolon
id|pix_width
op_assign
id|CRTC_PIX_WIDTH_24BPP
suffix:semicolon
id|dp_pix_width
op_assign
id|HOST_8BPP
op_or
id|SRC_8BPP
op_or
id|DST_8BPP
op_or
id|BYTE_ORDER_LSB_TO_MSB
suffix:semicolon
id|dp_chain_mask
op_assign
id|DP_CHAIN_24BPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bpp
op_le
l_int|32
)paren
(brace
id|bpp
op_assign
l_int|32
suffix:semicolon
id|pix_width
op_assign
id|CRTC_PIX_WIDTH_32BPP
suffix:semicolon
id|dp_pix_width
op_assign
id|HOST_32BPP
op_or
id|SRC_32BPP
op_or
id|DST_32BPP
op_or
id|BYTE_ORDER_LSB_TO_MSB
suffix:semicolon
id|dp_chain_mask
op_assign
id|DP_CHAIN_32BPP
suffix:semicolon
)brace
r_else
id|FAIL
c_func
(paren
l_string|&quot;invalid bpp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vxres
op_star
id|vyres
op_star
id|bpp
op_div
l_int|8
OG
id|info-&gt;fix.smem_len
)paren
id|FAIL
c_func
(paren
l_string|&quot;not enough video RAM&quot;
)paren
suffix:semicolon
id|h_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|v_sync_pol
op_assign
id|sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|xres
OG
l_int|1600
)paren
op_logical_or
(paren
id|yres
OG
l_int|1200
)paren
)paren
(brace
id|FAIL
c_func
(paren
l_string|&quot;MACH64 chips are designed for max 1600x1200&bslash;n&quot;
l_string|&quot;select anoter resolution.&quot;
)paren
suffix:semicolon
)brace
id|h_sync_strt
op_assign
id|h_disp
op_plus
id|var-&gt;right_margin
suffix:semicolon
id|h_sync_end
op_assign
id|h_sync_strt
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|h_sync_dly
op_assign
id|var-&gt;right_margin
op_amp
l_int|7
suffix:semicolon
id|h_total
op_assign
id|h_sync_end
op_plus
id|h_sync_dly
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|v_sync_strt
op_assign
id|v_disp
op_plus
id|var-&gt;lower_margin
suffix:semicolon
id|v_sync_end
op_assign
id|v_sync_strt
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|v_total
op_assign
id|v_sync_end
op_plus
id|var-&gt;upper_margin
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
id|u32
id|lcd_index
op_assign
id|aty_ld_le32
c_func
(paren
id|LCD_INDEX
comma
id|par
)paren
suffix:semicolon
id|crtc-&gt;lcd_index
op_assign
id|lcd_index
op_amp
op_complement
(paren
id|LCD_INDEX_MASK
op_or
id|LCD_DISPLAY_DIS
op_or
id|LCD_SRC_SEL
op_or
id|CRTC2_DISPLAY_DIS
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_INDEX
comma
id|lcd_index
comma
id|par
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|MOBIL_BUS
)paren
)paren
id|crtc-&gt;lcd_index
op_or_assign
id|CRTC2_DISPLAY_DIS
suffix:semicolon
id|crtc-&gt;lcd_config_panel
op_assign
id|aty_ld_lcd
c_func
(paren
id|CONFIG_PANEL
comma
id|par
)paren
op_or
l_int|0x4000
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_assign
id|aty_ld_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|par
)paren
op_amp
op_complement
id|CRTC_RW_SELECT
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_and_assign
op_complement
(paren
id|HORZ_DIVBY2_EN
op_or
id|DIS_HOR_CRT_DIVBY2
op_or
id|TVCLK_PM_EN
op_or
multiline_comment|/*VCLK_DAC_PM_EN | USE_SHADOWED_VEND |*/
id|USE_SHADOWED_ROWCUR
op_or
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
)paren
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_or_assign
id|DONT_SHADOW_VPAR
op_or
id|LOCK_8DOT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
id|LCD_ON
)paren
op_logical_and
(paren
(paren
id|xres
OG
id|par-&gt;lcd_width
)paren
op_logical_or
(paren
id|yres
OG
id|par-&gt;lcd_height
)paren
)paren
)paren
(brace
multiline_comment|/* We cannot display the mode on the LCD. If the CRT is enabled&n;&t;&t;&t;   we can turn off the LCD.&n;&t;&t;&t;   If the CRT is off, it isn&squot;t a good idea to switch it on; we don&squot;t&n;&t;&t;&t;   know if one is connected. So it&squot;s better to fail then.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
id|CRT_ON
)paren
(brace
id|PRINTKI
c_func
(paren
l_string|&quot;Disable lcd panel, because video mode does not fit.&bslash;n&quot;
)paren
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_and_assign
op_complement
id|LCD_ON
suffix:semicolon
multiline_comment|/*aty_st_lcd(LCD_GEN_CNTL, crtc-&gt;lcd_gen_cntl, par);*/
)brace
r_else
(brace
id|FAIL
c_func
(paren
l_string|&quot;Video mode exceeds size of lcd panel.&bslash;nConnect this computer to a conventional monitor if you really need this mode.&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
op_logical_and
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
id|LCD_ON
)paren
)paren
(brace
r_int
id|VScan
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* bpp -&gt; bytespp, 1,4 -&gt; 0; 8 -&gt; 2; 15,16 -&gt; 1; 24 -&gt; 6; 32 -&gt; 5&n;&t;&t;const u8 DFP_h_sync_dly_LT[] = { 0, 2, 1, 6, 5 };&n;&t;&t;const u8 ADD_to_strt_wid_and_dly_LT_DAC[] = { 0, 5, 6, 9, 9, 12, 12 };  */
id|vmode
op_and_assign
op_complement
(paren
id|FB_VMODE_DOUBLE
op_or
id|FB_VMODE_INTERLACED
)paren
suffix:semicolon
multiline_comment|/* This is horror! When we simulate, say 640x480 on an 800x600&n;&t;&t;   lcd monitor, the CRTC should be programmed 800x600 values for&n;&t;&t;   the non visible part, but 640x480 for the visible part.&n;&t;&t;   This code has been tested on a laptop with it&squot;s 1400x1050 lcd&n;&t;&t;   monitor and a conventional monitor both switched on.&n;&t;&t;   Tested modes: 1280x1024, 1152x864, 1024x768, 800x600,&n;&t;&t;    works with little glitches also with DOUBLESCAN modes&n;&t;&t; */
r_if
c_cond
(paren
id|yres
OL
id|par-&gt;lcd_height
)paren
(brace
id|VScan
op_assign
id|par-&gt;lcd_height
op_div
id|yres
suffix:semicolon
r_if
c_cond
(paren
id|VScan
OG
l_int|1
)paren
(brace
id|VScan
op_assign
l_int|2
suffix:semicolon
id|vmode
op_or_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
)brace
)brace
id|h_sync_strt
op_assign
id|h_disp
op_plus
id|par-&gt;lcd_right_margin
suffix:semicolon
id|h_sync_end
op_assign
id|h_sync_strt
op_plus
id|par-&gt;lcd_hsync_len
suffix:semicolon
id|h_sync_dly
op_assign
multiline_comment|/*DFP_h_sync_dly[ ( bpp + 1 ) / 3 ]; */
id|par-&gt;lcd_hsync_dly
suffix:semicolon
id|h_total
op_assign
id|h_disp
op_plus
id|par-&gt;lcd_hblank_len
suffix:semicolon
id|v_sync_strt
op_assign
id|v_disp
op_plus
id|par-&gt;lcd_lower_margin
op_div
id|VScan
suffix:semicolon
id|v_sync_end
op_assign
id|v_sync_strt
op_plus
id|par-&gt;lcd_vsync_len
op_div
id|VScan
suffix:semicolon
id|v_total
op_assign
id|v_disp
op_plus
id|par-&gt;lcd_vblank_len
op_div
id|VScan
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
id|h_disp
op_assign
(paren
id|h_disp
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|h_sync_strt
op_assign
(paren
id|h_sync_strt
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|h_sync_end
op_assign
(paren
id|h_sync_end
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|h_total
op_assign
(paren
id|h_total
op_rshift
l_int|3
)paren
op_minus
l_int|1
suffix:semicolon
id|h_sync_wid
op_assign
id|h_sync_end
op_minus
id|h_sync_strt
suffix:semicolon
id|FAIL_MAX
c_func
(paren
l_string|&quot;h_disp too large&quot;
comma
id|h_disp
comma
l_int|0xff
)paren
suffix:semicolon
id|FAIL_MAX
c_func
(paren
l_string|&quot;h_sync_strt too large&quot;
comma
id|h_sync_strt
comma
l_int|0x1ff
)paren
suffix:semicolon
multiline_comment|/*FAIL_MAX(&quot;h_sync_wid too large&quot;, h_sync_wid, 0x1f);*/
r_if
c_cond
(paren
id|h_sync_wid
OG
l_int|0x1f
)paren
(brace
id|h_sync_wid
op_assign
l_int|0x1f
suffix:semicolon
)brace
id|FAIL_MAX
c_func
(paren
l_string|&quot;h_total too large&quot;
comma
id|h_total
comma
l_int|0x1ff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|v_disp
op_lshift_assign
l_int|1
suffix:semicolon
id|v_sync_strt
op_lshift_assign
l_int|1
suffix:semicolon
id|v_sync_end
op_lshift_assign
l_int|1
suffix:semicolon
id|v_total
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|vdisplay
op_assign
id|yres
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
op_logical_and
(paren
id|crtc-&gt;lcd_gen_cntl
op_amp
id|LCD_ON
)paren
)paren
id|vdisplay
op_assign
id|par-&gt;lcd_height
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|vdisplay
OL
l_int|400
)paren
(brace
id|h_sync_pol
op_assign
l_int|1
suffix:semicolon
id|v_sync_pol
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vdisplay
OL
l_int|480
)paren
(brace
id|h_sync_pol
op_assign
l_int|0
suffix:semicolon
id|v_sync_pol
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vdisplay
OL
l_int|768
)paren
(brace
id|h_sync_pol
op_assign
l_int|0
suffix:semicolon
id|v_sync_pol
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|h_sync_pol
op_assign
l_int|1
suffix:semicolon
id|v_sync_pol
op_assign
l_int|1
suffix:semicolon
)brace
id|v_disp
op_decrement
suffix:semicolon
id|v_sync_strt
op_decrement
suffix:semicolon
id|v_sync_end
op_decrement
suffix:semicolon
id|v_total
op_decrement
suffix:semicolon
id|v_sync_wid
op_assign
id|v_sync_end
op_minus
id|v_sync_strt
suffix:semicolon
id|FAIL_MAX
c_func
(paren
l_string|&quot;v_disp too large&quot;
comma
id|v_disp
comma
l_int|0x7ff
)paren
suffix:semicolon
id|FAIL_MAX
c_func
(paren
l_string|&quot;v_sync_stsrt too large&quot;
comma
id|v_sync_strt
comma
l_int|0x7ff
)paren
suffix:semicolon
multiline_comment|/*FAIL_MAX(&quot;v_sync_wid too large&quot;, v_sync_wid, 0x1f);*/
r_if
c_cond
(paren
id|v_sync_wid
OG
l_int|0x1f
)paren
(brace
id|v_sync_wid
op_assign
l_int|0x1f
suffix:semicolon
)brace
id|FAIL_MAX
c_func
(paren
l_string|&quot;v_total too large&quot;
comma
id|v_total
comma
l_int|0x7ff
)paren
suffix:semicolon
id|c_sync
op_assign
id|sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
ques
c_cond
id|CRTC_CSYNC_EN
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* output */
id|crtc-&gt;vxres
op_assign
id|vxres
suffix:semicolon
id|crtc-&gt;vyres
op_assign
id|vyres
suffix:semicolon
id|crtc-&gt;xoffset
op_assign
id|xoffset
suffix:semicolon
id|crtc-&gt;yoffset
op_assign
id|yoffset
suffix:semicolon
id|crtc-&gt;bpp
op_assign
id|bpp
suffix:semicolon
id|crtc-&gt;off_pitch
op_assign
(paren
(paren
id|yoffset
op_star
id|vxres
op_plus
id|xoffset
)paren
op_star
id|bpp
op_div
l_int|64
)paren
op_or
(paren
id|vxres
op_lshift
l_int|19
)paren
suffix:semicolon
id|crtc-&gt;vline_crnt_vline
op_assign
l_int|0
suffix:semicolon
id|crtc-&gt;h_tot_disp
op_assign
id|h_total
op_or
(paren
id|h_disp
op_lshift
l_int|16
)paren
suffix:semicolon
id|crtc-&gt;h_sync_strt_wid
op_assign
(paren
id|h_sync_strt
op_amp
l_int|0xff
)paren
op_or
(paren
id|h_sync_dly
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|h_sync_strt
op_amp
l_int|0x100
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|h_sync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|h_sync_pol
op_lshift
l_int|21
)paren
suffix:semicolon
id|crtc-&gt;v_tot_disp
op_assign
id|v_total
op_or
(paren
id|v_disp
op_lshift
l_int|16
)paren
suffix:semicolon
id|crtc-&gt;v_sync_strt_wid
op_assign
id|v_sync_strt
op_or
(paren
id|v_sync_wid
op_lshift
l_int|16
)paren
op_or
(paren
id|v_sync_pol
op_lshift
l_int|21
)paren
suffix:semicolon
multiline_comment|/* crtc-&gt;gen_cntl = aty_ld_le32(CRTC_GEN_CNTL, par) &amp; CRTC_PRESERVED_MASK; */
id|crtc-&gt;gen_cntl
op_assign
id|CRTC_EXT_DISP_EN
op_or
id|CRTC_EN
op_or
id|pix_width
op_or
id|c_sync
suffix:semicolon
id|crtc-&gt;gen_cntl
op_or_assign
id|CRTC_VGA_LINEAR
suffix:semicolon
multiline_comment|/* Enable doublescan mode if requested */
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
id|crtc-&gt;gen_cntl
op_or_assign
id|CRTC_DBL_SCAN_EN
suffix:semicolon
multiline_comment|/* Enable interlaced mode if requested */
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
id|crtc-&gt;gen_cntl
op_or_assign
id|CRTC_INTERLACE_EN
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
id|vdisplay
op_assign
id|yres
suffix:semicolon
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|vdisplay
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
id|vdisplay
op_rshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* The prefered mode for the lcd is not interlaced, so disable it if&n;&t;&t;&t;   it was enabled. For doublescan there is no problem, because we can&n;&t;&t;&t;   compensate for it in the hardware stretching (we stretch half as much)&n;&t;&t;&t; */
id|vmode
op_and_assign
op_complement
id|FB_VMODE_INTERLACED
suffix:semicolon
multiline_comment|/*crtc-&gt;gen_cntl &amp;= ~CRTC_INTERLACE_EN;*/
)brace
id|crtc-&gt;gen_cntl
op_and_assign
op_complement
(paren
id|CRTC2_EN
op_or
id|CRTC2_PIX_WIDTH
)paren
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_and_assign
op_complement
(paren
id|HORZ_DIVBY2_EN
op_or
id|DIS_HOR_CRT_DIVBY2
op_or
multiline_comment|/*TVCLK_PM_EN | VCLK_DAC_PM_EN |*/
id|USE_SHADOWED_VEND
op_or
id|USE_SHADOWED_ROWCUR
op_or
id|SHADOW_EN
op_or
id|SHADOW_RW_EN
)paren
suffix:semicolon
id|crtc-&gt;lcd_gen_cntl
op_or_assign
(paren
id|DONT_SHADOW_VPAR
multiline_comment|/* | LOCK_8DOT*/
)paren
suffix:semicolon
multiline_comment|/* MOBILITY M1 tested, FIXME: LT */
id|crtc-&gt;horz_stretching
op_assign
id|aty_ld_lcd
c_func
(paren
id|HORZ_STRETCHING
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
id|crtc-&gt;ext_vert_stretch
op_assign
id|aty_ld_lcd
c_func
(paren
id|EXT_VERT_STRETCH
comma
id|par
)paren
op_amp
op_complement
(paren
id|AUTO_VERT_RATIO
op_or
id|VERT_STRETCH_MODE
op_or
id|VERT_STRETCH_RATIO3
)paren
suffix:semicolon
id|crtc-&gt;horz_stretching
op_and_assign
op_complement
(paren
id|HORZ_STRETCH_RATIO
op_or
id|HORZ_STRETCH_LOOP
op_or
id|AUTO_HORZ_RATIO
op_or
id|HORZ_STRETCH_MODE
op_or
id|HORZ_STRETCH_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xres
OL
id|par-&gt;lcd_width
)paren
(brace
r_do
(brace
multiline_comment|/*&n;&t;&t;&t;&t;* The horizontal blender misbehaves when HDisplay is less than a&n;&t;&t;&t;&t;* a certain threshold (440 for a 1024-wide panel).  It doesn&squot;t&n;&t;&t;&t;&t;* stretch such modes enough.  Use pixel replication instead of&n;&t;&t;&t;&t;* blending to stretch modes that can be made to exactly fit the&n;&t;&t;&t;&t;* panel width.  The undocumented &quot;NoLCDBlend&quot; option allows the&n;&t;&t;&t;&t;* pixel-replicated mode to be slightly wider or narrower than the&n;&t;&t;&t;&t;* panel width.  It also causes a mode that is exactly half as wide&n;&t;&t;&t;&t;* as the panel to be pixel-replicated, rather than blended.&n;&t;&t;&t;&t;*/
r_int
id|HDisplay
op_assign
id|xres
op_amp
op_complement
l_int|7
suffix:semicolon
r_int
id|nStretch
op_assign
id|par-&gt;lcd_width
op_div
id|HDisplay
suffix:semicolon
r_int
id|Remainder
op_assign
id|par-&gt;lcd_width
op_mod
id|HDisplay
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|Remainder
op_logical_and
(paren
(paren
id|nStretch
OG
l_int|2
)paren
)paren
)paren
op_logical_or
(paren
(paren
(paren
id|HDisplay
op_star
l_int|16
)paren
op_div
id|par-&gt;lcd_width
)paren
OL
l_int|7
)paren
)paren
(brace
r_static
r_const
r_char
id|StretchLoops
(braket
)braket
op_assign
(brace
l_int|10
comma
l_int|12
comma
l_int|13
comma
l_int|15
comma
l_int|16
)brace
suffix:semicolon
r_int
id|horz_stretch_loop
op_assign
op_minus
l_int|1
comma
id|BestRemainder
suffix:semicolon
r_int
id|Numerator
op_assign
id|HDisplay
comma
id|Denominator
op_assign
id|par-&gt;lcd_width
suffix:semicolon
r_int
id|Index
op_assign
l_int|5
suffix:semicolon
id|ATIReduceRatio
c_func
(paren
op_amp
id|Numerator
comma
op_amp
id|Denominator
)paren
suffix:semicolon
id|BestRemainder
op_assign
(paren
id|Numerator
op_star
l_int|16
)paren
op_div
id|Denominator
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|Index
op_ge
l_int|0
)paren
(brace
id|Remainder
op_assign
(paren
(paren
id|Denominator
op_minus
id|Numerator
)paren
op_star
id|StretchLoops
(braket
id|Index
)braket
)paren
op_mod
id|Denominator
suffix:semicolon
r_if
c_cond
(paren
id|Remainder
OL
id|BestRemainder
)paren
(brace
id|horz_stretch_loop
op_assign
id|Index
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|BestRemainder
op_assign
id|Remainder
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|horz_stretch_loop
op_ge
l_int|0
)paren
op_logical_and
op_logical_neg
id|BestRemainder
)paren
(brace
r_int
id|horz_stretch_ratio
op_assign
l_int|0
comma
id|Accumulator
op_assign
l_int|0
suffix:semicolon
r_int
id|reuse_previous
op_assign
l_int|1
suffix:semicolon
id|Index
op_assign
id|StretchLoops
(braket
id|horz_stretch_loop
)braket
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|Index
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|Accumulator
OG
l_int|0
)paren
id|horz_stretch_ratio
op_or_assign
id|reuse_previous
suffix:semicolon
r_else
id|Accumulator
op_add_assign
id|Denominator
suffix:semicolon
id|Accumulator
op_sub_assign
id|Numerator
suffix:semicolon
id|reuse_previous
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|crtc-&gt;horz_stretching
op_or_assign
(paren
id|HORZ_STRETCH_EN
op_or
(paren
(paren
id|horz_stretch_loop
op_amp
id|HORZ_STRETCH_LOOP
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|horz_stretch_ratio
op_amp
id|HORZ_STRETCH_RATIO
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Out of the do { ... } while (0) */
)brace
)brace
id|crtc-&gt;horz_stretching
op_or_assign
(paren
id|HORZ_STRETCH_MODE
op_or
id|HORZ_STRETCH_EN
op_or
(paren
(paren
(paren
id|HDisplay
op_star
(paren
id|HORZ_STRETCH_BLEND
op_plus
l_int|1
)paren
)paren
op_div
id|par-&gt;lcd_width
)paren
op_amp
id|HORZ_STRETCH_BLEND
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vdisplay
OL
id|par-&gt;lcd_height
)paren
(brace
id|crtc-&gt;vert_stretching
op_assign
(paren
id|VERT_STRETCH_USE0
op_or
id|VERT_STRETCH_EN
op_or
(paren
(paren
(paren
id|vdisplay
op_star
(paren
id|VERT_STRETCH_RATIO0
op_plus
l_int|1
)paren
)paren
op_div
id|par-&gt;lcd_height
)paren
op_amp
id|VERT_STRETCH_RATIO0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
op_logical_and
id|xres
op_le
(paren
id|M64_HAS
c_func
(paren
id|MOBIL_BUS
)paren
ques
c_cond
l_int|1024
suffix:colon
l_int|800
)paren
)paren
id|crtc-&gt;ext_vert_stretch
op_or_assign
id|VERT_STRETCH_MODE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * Don&squot;t use vertical blending if the mode is too wide or not&n;&t;&t;&t; * vertically stretched.&n;&t;&t;&t; */
id|crtc-&gt;vert_stretching
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* copy to shadow crtc */
id|crtc-&gt;shadow_h_tot_disp
op_assign
id|crtc-&gt;h_tot_disp
suffix:semicolon
id|crtc-&gt;shadow_h_sync_strt_wid
op_assign
id|crtc-&gt;h_sync_strt_wid
suffix:semicolon
id|crtc-&gt;shadow_v_tot_disp
op_assign
id|crtc-&gt;v_tot_disp
suffix:semicolon
id|crtc-&gt;shadow_v_sync_strt_wid
op_assign
id|crtc-&gt;v_sync_strt_wid
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|MAGIC_FIFO
)paren
)paren
(brace
multiline_comment|/* Not VTB/GTB */
multiline_comment|/* FIXME: magic FIFO values */
id|crtc-&gt;gen_cntl
op_or_assign
(paren
id|aty_ld_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
op_amp
id|CRTC2_PIX_WIDTH
)paren
suffix:semicolon
)brace
id|crtc-&gt;dp_pix_width
op_assign
id|dp_pix_width
suffix:semicolon
id|crtc-&gt;dp_chain_mask
op_assign
id|dp_chain_mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aty_crtc_to_var
r_static
r_int
id|aty_crtc_to_var
c_func
(paren
r_const
r_struct
id|crtc
op_star
id|crtc
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u32
id|xres
comma
id|yres
comma
id|bpp
comma
id|left
comma
id|right
comma
id|upper
comma
id|lower
comma
id|hslen
comma
id|vslen
comma
id|sync
suffix:semicolon
id|u32
id|h_total
comma
id|h_disp
comma
id|h_sync_strt
comma
id|h_sync_dly
comma
id|h_sync_wid
comma
id|h_sync_pol
suffix:semicolon
id|u32
id|v_total
comma
id|v_disp
comma
id|v_sync_strt
comma
id|v_sync_wid
comma
id|v_sync_pol
comma
id|c_sync
suffix:semicolon
id|u32
id|pix_width
suffix:semicolon
id|u32
id|double_scan
comma
id|interlace
suffix:semicolon
multiline_comment|/* input */
id|h_total
op_assign
id|crtc-&gt;h_tot_disp
op_amp
l_int|0x1ff
suffix:semicolon
id|h_disp
op_assign
(paren
id|crtc-&gt;h_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|h_sync_strt
op_assign
(paren
id|crtc-&gt;h_sync_strt_wid
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|crtc-&gt;h_sync_strt_wid
op_rshift
l_int|4
)paren
op_amp
l_int|0x100
)paren
suffix:semicolon
id|h_sync_dly
op_assign
(paren
id|crtc-&gt;h_sync_strt_wid
op_rshift
l_int|8
)paren
op_amp
l_int|0x7
suffix:semicolon
id|h_sync_wid
op_assign
(paren
id|crtc-&gt;h_sync_strt_wid
op_rshift
l_int|16
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|h_sync_pol
op_assign
(paren
id|crtc-&gt;h_sync_strt_wid
op_rshift
l_int|21
)paren
op_amp
l_int|0x1
suffix:semicolon
id|v_total
op_assign
id|crtc-&gt;v_tot_disp
op_amp
l_int|0x7ff
suffix:semicolon
id|v_disp
op_assign
(paren
id|crtc-&gt;v_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
suffix:semicolon
id|v_sync_strt
op_assign
id|crtc-&gt;v_sync_strt_wid
op_amp
l_int|0x7ff
suffix:semicolon
id|v_sync_wid
op_assign
(paren
id|crtc-&gt;v_sync_strt_wid
op_rshift
l_int|16
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|v_sync_pol
op_assign
(paren
id|crtc-&gt;v_sync_strt_wid
op_rshift
l_int|21
)paren
op_amp
l_int|0x1
suffix:semicolon
id|c_sync
op_assign
id|crtc-&gt;gen_cntl
op_amp
id|CRTC_CSYNC_EN
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|pix_width
op_assign
id|crtc-&gt;gen_cntl
op_amp
id|CRTC_PIX_WIDTH_MASK
suffix:semicolon
id|double_scan
op_assign
id|crtc-&gt;gen_cntl
op_amp
id|CRTC_DBL_SCAN_EN
suffix:semicolon
id|interlace
op_assign
id|crtc-&gt;gen_cntl
op_amp
id|CRTC_INTERLACE_EN
suffix:semicolon
multiline_comment|/* convert */
id|xres
op_assign
(paren
id|h_disp
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|yres
op_assign
id|v_disp
op_plus
l_int|1
suffix:semicolon
id|left
op_assign
(paren
id|h_total
op_minus
id|h_sync_strt
op_minus
id|h_sync_wid
)paren
op_star
l_int|8
op_minus
id|h_sync_dly
suffix:semicolon
id|right
op_assign
(paren
id|h_sync_strt
op_minus
id|h_disp
)paren
op_star
l_int|8
op_plus
id|h_sync_dly
suffix:semicolon
id|hslen
op_assign
id|h_sync_wid
op_star
l_int|8
suffix:semicolon
id|upper
op_assign
id|v_total
op_minus
id|v_sync_strt
op_minus
id|v_sync_wid
suffix:semicolon
id|lower
op_assign
id|v_sync_strt
op_minus
id|v_disp
suffix:semicolon
id|vslen
op_assign
id|v_sync_wid
suffix:semicolon
id|sync
op_assign
(paren
id|h_sync_pol
ques
c_cond
l_int|0
suffix:colon
id|FB_SYNC_HOR_HIGH_ACT
)paren
op_or
(paren
id|v_sync_pol
ques
c_cond
l_int|0
suffix:colon
id|FB_SYNC_VERT_HIGH_ACT
)paren
op_or
(paren
id|c_sync
ques
c_cond
id|FB_SYNC_COMP_HIGH_ACT
suffix:colon
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pix_width
)paren
(brace
macro_line|#if 0
r_case
id|CRTC_PIX_WIDTH_4BPP
suffix:colon
id|bpp
op_assign
l_int|4
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|CRTC_PIX_WIDTH_8BPP
suffix:colon
id|bpp
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRTC_PIX_WIDTH_15BPP
suffix:colon
multiline_comment|/* RGB 555 */
id|bpp
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRTC_PIX_WIDTH_16BPP
suffix:colon
multiline_comment|/* RGB 565 */
id|bpp
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRTC_PIX_WIDTH_24BPP
suffix:colon
multiline_comment|/* RGB 888 */
id|bpp
op_assign
l_int|24
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CRTC_PIX_WIDTH_32BPP
suffix:colon
multiline_comment|/* ARGB 8888 */
id|bpp
op_assign
l_int|32
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|FAIL
c_func
(paren
l_string|&quot;Invalid pixel width&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* output */
id|var-&gt;xres
op_assign
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|crtc-&gt;vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|crtc-&gt;vyres
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|bpp
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|left
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|right
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|upper
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|lower
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|hslen
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|vslen
suffix:semicolon
id|var-&gt;sync
op_assign
id|sync
suffix:semicolon
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
multiline_comment|/* In double scan mode, the vertical parameters are doubled, so we need to&n;&t;   half them to get the right values.&n;&t;   In interlaced mode the values are already correct, so no correction is&n;&t;   necessary.&n;&t; */
r_if
c_cond
(paren
id|interlace
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_INTERLACED
suffix:semicolon
r_if
c_cond
(paren
id|double_scan
)paren
(brace
id|var-&gt;vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
id|var-&gt;yres
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;upper_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;lower_margin
op_rshift_assign
l_int|1
suffix:semicolon
id|var-&gt;vsync_len
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|function|atyfb_set_par
r_static
r_int
id|atyfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
id|u32
id|tmp
comma
id|pixclock
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifdef DEBUG
r_struct
id|fb_var_screeninfo
id|debug
suffix:semicolon
id|u32
id|pixclock_in_ps
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|par-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|aty_var_to_crtc
c_func
(paren
id|info
comma
id|var
comma
op_amp
id|par-&gt;crtc
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|pixclock
op_assign
id|atyfb_get_pixclock
c_func
(paren
id|var
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pixclock
op_eq
l_int|0
)paren
(brace
id|FAIL
c_func
(paren
l_string|&quot;Invalid pixclock&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|par-&gt;pll_ops
op_member_access_from_pointer
id|var_to_pll
c_func
(paren
id|info
comma
id|pixclock
comma
id|var-&gt;bits_per_pixel
comma
op_amp
id|par-&gt;pll
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
id|par-&gt;accel_flags
op_assign
id|var-&gt;accel_flags
suffix:semicolon
multiline_comment|/* hack */
r_if
c_cond
(paren
id|par-&gt;blitter_may_be_busy
)paren
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
id|aty_set_crtc
c_func
(paren
id|par
comma
op_amp
id|par-&gt;crtc
)paren
suffix:semicolon
id|par-&gt;dac_ops
op_member_access_from_pointer
id|set_dac
c_func
(paren
id|info
comma
op_amp
id|par-&gt;pll
comma
id|var-&gt;bits_per_pixel
comma
id|par-&gt;accel_flags
)paren
suffix:semicolon
id|par-&gt;pll_ops
op_member_access_from_pointer
id|set_pll
c_func
(paren
id|info
comma
op_amp
id|par-&gt;pll
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|par-&gt;pll_ops
op_logical_and
id|par-&gt;pll_ops-&gt;pll_to_var
)paren
(brace
id|pixclock_in_ps
op_assign
id|par-&gt;pll_ops
op_member_access_from_pointer
id|pll_to_var
c_func
(paren
id|info
comma
op_amp
(paren
id|par-&gt;pll
)paren
)paren
suffix:semicolon
)brace
r_else
id|pixclock_in_ps
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|pixclock_in_ps
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;ALERT ops-&gt;pll_to_var get 0&bslash;n&quot;
)paren
suffix:semicolon
id|pixclock_in_ps
op_assign
id|pixclock
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|debug
comma
l_int|0
comma
r_sizeof
(paren
id|debug
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aty_crtc_to_var
c_func
(paren
op_amp
(paren
id|par-&gt;crtc
)paren
comma
op_amp
id|debug
)paren
)paren
(brace
id|u32
id|hSync
comma
id|vRefresh
suffix:semicolon
id|u32
id|h_disp
comma
id|h_sync_strt
comma
id|h_sync_end
comma
id|h_total
suffix:semicolon
id|u32
id|v_disp
comma
id|v_sync_strt
comma
id|v_sync_end
comma
id|v_total
suffix:semicolon
id|h_disp
op_assign
id|debug.xres
suffix:semicolon
id|h_sync_strt
op_assign
id|h_disp
op_plus
id|debug.right_margin
suffix:semicolon
id|h_sync_end
op_assign
id|h_sync_strt
op_plus
id|debug.hsync_len
suffix:semicolon
id|h_total
op_assign
id|h_sync_end
op_plus
id|debug.left_margin
suffix:semicolon
id|v_disp
op_assign
id|debug.yres
suffix:semicolon
id|v_sync_strt
op_assign
id|v_disp
op_plus
id|debug.lower_margin
suffix:semicolon
id|v_sync_end
op_assign
id|v_sync_strt
op_plus
id|debug.vsync_len
suffix:semicolon
id|v_total
op_assign
id|v_sync_end
op_plus
id|debug.upper_margin
suffix:semicolon
id|hSync
op_assign
l_int|1000000000
op_div
(paren
id|pixclock_in_ps
op_star
id|h_total
)paren
suffix:semicolon
id|vRefresh
op_assign
(paren
id|hSync
op_star
l_int|1000
)paren
op_div
id|v_total
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;crtc.gen_cntl
op_amp
id|CRTC_INTERLACE_EN
)paren
id|vRefresh
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;crtc.gen_cntl
op_amp
id|CRTC_DBL_SCAN_EN
)paren
id|vRefresh
op_div_assign
l_int|2
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;atyfb_set_par&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; Set Visible Mode to %ix%i-%i&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; Virtual resolution %ix%i, pixclock_in_ps %i (calculated %i)&bslash;n&quot;
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;yres_virtual
comma
id|pixclock
comma
id|pixclock_in_ps
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; Dot clock:           %i MHz&bslash;n&quot;
comma
l_int|1000000
op_div
id|pixclock_in_ps
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; Horizontal sync:     %i kHz&bslash;n&quot;
comma
id|hSync
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; Vertical refresh:    %i Hz&bslash;n&quot;
comma
id|vRefresh
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; x  style: %i.%03i %i %i %i %i   %i %i %i %i&bslash;n&quot;
comma
l_int|1000000
op_div
id|pixclock_in_ps
comma
l_int|1000000
op_mod
id|pixclock_in_ps
comma
id|h_disp
comma
id|h_sync_strt
comma
id|h_sync_end
comma
id|h_total
comma
id|v_disp
comma
id|v_sync_strt
comma
id|v_sync_end
comma
id|v_total
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; fb style: %i  %i %i %i %i %i %i %i %i&bslash;n&quot;
comma
id|pixclock_in_ps
comma
id|debug.left_margin
comma
id|h_disp
comma
id|debug.right_margin
comma
id|debug.hsync_len
comma
id|debug.upper_margin
comma
id|v_disp
comma
id|debug.lower_margin
comma
id|debug.vsync_len
)paren
suffix:semicolon
)brace
macro_line|#endif /* DEBUG */
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
multiline_comment|/* Don&squot;t forget MEM_CNTL */
id|tmp
op_assign
id|aty_ld_le32
c_func
(paren
id|MEM_CNTL
comma
id|par
)paren
op_amp
l_int|0xf0ffffff
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|tmp
op_or_assign
l_int|0x02000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|tmp
op_or_assign
l_int|0x03000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|tmp
op_or_assign
l_int|0x06000000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
id|tmp
comma
id|par
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|aty_ld_le32
c_func
(paren
id|MEM_CNTL
comma
id|par
)paren
op_amp
l_int|0xf00fffff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|MAGIC_POSTDIV
)paren
)paren
id|tmp
op_or_assign
id|par-&gt;mem_refresh_rate
op_lshift
l_int|20
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
r_case
l_int|24
suffix:colon
id|tmp
op_or_assign
l_int|0x00000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|tmp
op_or_assign
l_int|0x04000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|tmp
op_or_assign
l_int|0x08000000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|CT_BUS
)paren
)paren
(brace
id|aty_st_le32
c_func
(paren
id|DAC_CNTL
comma
l_int|0x87010184
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
l_int|0x680000f9
comma
id|par
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|VT_BUS
)paren
)paren
(brace
id|aty_st_le32
c_func
(paren
id|DAC_CNTL
comma
l_int|0x87010184
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
l_int|0x680000f9
comma
id|par
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|MOBIL_BUS
)paren
)paren
(brace
id|aty_st_le32
c_func
(paren
id|DAC_CNTL
comma
l_int|0x80010102
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
l_int|0x7b33a040
op_or
(paren
id|par-&gt;aux_start
ques
c_cond
id|BUS_APER_REG_DIS
suffix:colon
l_int|0
)paren
comma
id|par
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GT */
id|aty_st_le32
c_func
(paren
id|DAC_CNTL
comma
l_int|0x86010102
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
l_int|0x7b23a040
op_or
(paren
id|par-&gt;aux_start
ques
c_cond
id|BUS_APER_REG_DIS
suffix:colon
l_int|0
)paren
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|EXT_MEM_CNTL
comma
id|aty_ld_le32
c_func
(paren
id|EXT_MEM_CNTL
comma
id|par
)paren
op_or
l_int|0x5000001
comma
id|par
)paren
suffix:semicolon
)brace
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
id|tmp
comma
id|par
)paren
suffix:semicolon
)brace
id|aty_st_8
c_func
(paren
id|DAC_MASK
comma
l_int|0xff
comma
id|par
)paren
suffix:semicolon
id|info-&gt;fix.line_length
op_assign
id|var-&gt;xres_virtual
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|var-&gt;bits_per_pixel
op_le
l_int|8
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
multiline_comment|/* Initialize the graphics engine */
r_if
c_cond
(paren
id|par-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
id|aty_init_engine
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BOOTX_TEXT
id|btext_update_display
c_func
(paren
id|info-&gt;fix.smem_start
comma
(paren
(paren
(paren
id|par-&gt;crtc.h_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
op_plus
l_int|1
)paren
op_star
l_int|8
comma
(paren
(paren
id|par-&gt;crtc.v_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_plus
l_int|1
comma
id|var-&gt;bits_per_pixel
comma
id|par-&gt;crtc.vxres
op_star
id|var-&gt;bits_per_pixel
op_div
l_int|8
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BOOTX_TEXT */
macro_line|#if 0
multiline_comment|/* switch to accelerator mode */
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;crtc.gen_cntl
op_amp
id|CRTC_EXT_DISP_EN
)paren
)paren
id|aty_st_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par-&gt;crtc.gen_cntl
op_or
id|CRTC_EXT_DISP_EN
comma
id|par
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DEBUG
(brace
multiline_comment|/* dump non shadow CRTC, pll, LCD registers */
r_int
id|i
suffix:semicolon
id|u32
id|base
suffix:semicolon
multiline_comment|/* CRTC registers */
id|base
op_assign
l_int|0x2000
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;debug atyfb: Mach64 non-shadow register values:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_assign
id|i
op_plus
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|16
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;ndebug atyfb: 0x%04X: &quot;
comma
id|base
op_plus
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; %08X&quot;
comma
id|aty_ld_le32
c_func
(paren
id|i
comma
id|par
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_CT
multiline_comment|/* PLL registers */
id|base
op_assign
l_int|0x00
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;debug atyfb: Mach64 PLL register values:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|16
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;ndebug atyfb: 0x%02X: &quot;
comma
id|base
op_plus
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_mod
l_int|4
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%02X&quot;
comma
id|aty_ld_pll_ct
c_func
(paren
id|i
comma
id|par
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;/* CONFIG_FB_ATY_CT */
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
multiline_comment|/* LCD registers */
id|base
op_assign
l_int|0x00
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;debug atyfb: LCD register values:&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|LT_LCD_REGS
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|POWER_MANAGEMENT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|EXT_VERT_STRETCH
)paren
(brace
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;ndebug atyfb: 0x%04X: &quot;
comma
id|lt_lcd_regs
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08X&quot;
comma
id|aty_ld_lcd
c_func
(paren
id|i
comma
id|par
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|4
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;ndebug atyfb: 0x%02X: &quot;
comma
id|base
op_plus
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; %08X&quot;
comma
id|aty_ld_lcd
c_func
(paren
id|i
comma
id|par
)paren
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
)brace
macro_line|#endif /* DEBUG */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_check_var
r_static
r_int
id|atyfb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|crtc
id|crtc
suffix:semicolon
r_union
id|aty_pll
id|pll
suffix:semicolon
id|u32
id|pixclock
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|pll
comma
op_amp
(paren
id|par-&gt;pll
)paren
comma
r_sizeof
(paren
id|pll
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|aty_var_to_crtc
c_func
(paren
id|info
comma
id|var
comma
op_amp
id|crtc
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|pixclock
op_assign
id|atyfb_get_pixclock
c_func
(paren
id|var
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pixclock
op_eq
l_int|0
)paren
(brace
id|FAIL
c_func
(paren
l_string|&quot;Invalid pixclock&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|par-&gt;pll_ops
op_member_access_from_pointer
id|var_to_pll
c_func
(paren
id|info
comma
id|pixclock
comma
id|var-&gt;bits_per_pixel
comma
op_amp
id|pll
)paren
)paren
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
id|info-&gt;var.accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|info-&gt;var.accel_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0 /* fbmon is not done. uncomment for 2.5.x -brad */
r_if
c_cond
(paren
op_logical_neg
id|fbmon_valid_timings
c_func
(paren
id|pixclock
comma
id|htotal
comma
id|vtotal
comma
id|info
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
id|aty_crtc_to_var
c_func
(paren
op_amp
id|crtc
comma
id|var
)paren
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|par-&gt;pll_ops
op_member_access_from_pointer
id|pll_to_var
c_func
(paren
id|info
comma
op_amp
id|pll
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_off_pitch
r_static
r_void
id|set_off_pitch
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
id|xoffset
op_assign
id|info-&gt;var.xoffset
suffix:semicolon
id|u32
id|yoffset
op_assign
id|info-&gt;var.yoffset
suffix:semicolon
id|u32
id|vxres
op_assign
id|par-&gt;crtc.vxres
suffix:semicolon
id|u32
id|bpp
op_assign
id|info-&gt;var.bits_per_pixel
suffix:semicolon
id|par-&gt;crtc.off_pitch
op_assign
(paren
(paren
id|yoffset
op_star
id|vxres
op_plus
id|xoffset
)paren
op_star
id|bpp
op_div
l_int|64
)paren
op_or
(paren
id|vxres
op_lshift
l_int|19
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Open/Release the frame buffer device&n;     */
DECL|function|atyfb_open
r_static
r_int
id|atyfb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
(brace
id|par-&gt;open
op_increment
suffix:semicolon
macro_line|#ifdef __sparc__
id|par-&gt;mmaped
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|aty_irq
r_static
id|irqreturn_t
id|aty_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
id|dev_id
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|u32
id|int_cntl
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|int_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|int_cntl
op_amp
id|CRTC_VBLANK_INT
)paren
(brace
multiline_comment|/* clear interrupt */
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
(paren
id|int_cntl
op_amp
id|CRTC_INT_EN_MASK
)paren
op_or
id|CRTC_VBLANK_INT_AK
comma
id|par
)paren
suffix:semicolon
id|par-&gt;vblank.count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;vblank.pan_display
)paren
(brace
id|par-&gt;vblank.pan_display
op_assign
l_int|0
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|par-&gt;crtc.off_pitch
comma
id|par
)paren
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|par-&gt;vblank.wait
)paren
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
DECL|function|aty_enable_irq
r_static
r_int
id|aty_enable_irq
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_int
id|reenable
)paren
(brace
id|u32
id|int_cntl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|par-&gt;irq_flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|par-&gt;irq
comma
id|aty_irq
comma
id|SA_SHIRQ
comma
l_string|&quot;atyfb&quot;
comma
id|par
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|par-&gt;irq_flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|int_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|par
)paren
op_amp
id|CRTC_INT_EN_MASK
suffix:semicolon
multiline_comment|/* clear interrupt */
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|int_cntl
op_or
id|CRTC_VBLANK_INT_AK
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* enable interrupt */
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|int_cntl
op_or
id|CRTC_VBLANK_INT_EN
comma
id|par
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reenable
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|int_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|par
)paren
op_amp
id|CRTC_INT_EN_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|int_cntl
op_amp
id|CRTC_VBLANK_INT_EN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;atyfb: someone disabled IRQ [%08x]&bslash;n&quot;
comma
id|int_cntl
)paren
suffix:semicolon
multiline_comment|/* re-enable interrupt */
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|int_cntl
op_or
id|CRTC_VBLANK_INT_EN
comma
id|par
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aty_disable_irq
r_static
r_int
id|aty_disable_irq
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u32
id|int_cntl
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|par-&gt;irq_flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;vblank.pan_display
)paren
(brace
id|par-&gt;vblank.pan_display
op_assign
l_int|0
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|par-&gt;crtc.off_pitch
comma
id|par
)paren
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|int_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|par
)paren
op_amp
id|CRTC_INT_EN_MASK
suffix:semicolon
multiline_comment|/* disable interrupt */
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
id|int_cntl
op_amp
op_complement
id|CRTC_VBLANK_INT_EN
comma
id|par
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|par-&gt;irq
comma
id|par
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_release
r_static
r_int
id|atyfb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
(brace
id|par-&gt;open
op_decrement
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;open
)paren
(brace
macro_line|#ifdef __sparc__
r_int
id|was_mmaped
op_assign
id|par-&gt;mmaped
suffix:semicolon
id|par-&gt;mmaped
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|was_mmaped
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
multiline_comment|/* Now reset the default display config, we have no&n;&t;&t;&t;&t; * idea what the program(s) which mmap&squot;d the chip did&n;&t;&t;&t;&t; * to the configuration, nor whether it restored it&n;&t;&t;&t;&t; * correctly.&n;&t;&t;&t;&t; */
id|var
op_assign
id|default_var
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_if
c_cond
(paren
id|var.yres
op_eq
id|var.yres_virtual
)paren
(brace
id|u32
id|videoram
op_assign
(paren
id|info-&gt;fix.smem_len
op_minus
(paren
id|PAGE_SIZE
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|var.yres_virtual
op_assign
(paren
(paren
id|videoram
op_star
l_int|8
)paren
op_div
id|var.bits_per_pixel
)paren
op_div
id|var.xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var.yres_virtual
OL
id|var.yres
)paren
id|var.yres_virtual
op_assign
id|var.yres
suffix:semicolon
)brace
)brace
macro_line|#endif
id|aty_disable_irq
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Pan or Wrap the Display&n;     *&n;     *  This call looks only at xoffset, yoffset and the FB_VMODE_YWRAP flag&n;     */
DECL|function|atyfb_pan_display
r_static
r_int
id|atyfb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|xres
comma
id|yres
comma
id|xoffset
comma
id|yoffset
suffix:semicolon
id|xres
op_assign
(paren
(paren
(paren
id|par-&gt;crtc.h_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|yres
op_assign
(paren
(paren
id|par-&gt;crtc.v_tot_disp
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;crtc.gen_cntl
op_amp
id|CRTC_DBL_SCAN_EN
)paren
id|yres
op_rshift_assign
l_int|1
suffix:semicolon
id|xoffset
op_assign
(paren
id|var-&gt;xoffset
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|xoffset
op_plus
id|xres
OG
id|par-&gt;crtc.vxres
op_logical_or
id|yoffset
op_plus
id|yres
OG
id|par-&gt;crtc.vyres
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|yoffset
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
id|set_off_pitch
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_VBL
)paren
op_logical_and
op_logical_neg
id|aty_enable_irq
c_func
(paren
id|par
comma
l_int|0
)paren
)paren
(brace
id|par-&gt;vblank.pan_display
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;vblank.pan_display
op_assign
l_int|0
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|par-&gt;crtc.off_pitch
comma
id|par
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aty_waitforvblank
r_static
r_int
id|aty_waitforvblank
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
id|u32
id|crtc
)paren
(brace
r_struct
id|aty_interrupt
op_star
id|vbl
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|crtc
)paren
(brace
r_case
l_int|0
suffix:colon
id|vbl
op_assign
op_amp
id|par-&gt;vblank
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ret
op_assign
id|aty_enable_irq
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|count
op_assign
id|vbl-&gt;count
suffix:semicolon
id|ret
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|vbl-&gt;wait
comma
id|count
op_ne
id|vbl-&gt;count
comma
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
id|aty_enable_irq
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
DECL|macro|ATYIO_CLKR
mdefine_line|#define ATYIO_CLKR&t;&t;0x41545900&t;/* ATY&bslash;00 */
DECL|macro|ATYIO_CLKW
mdefine_line|#define ATYIO_CLKW&t;&t;0x41545901&t;/* ATY&bslash;01 */
DECL|struct|atyclk
r_struct
id|atyclk
(brace
DECL|member|ref_clk_per
id|u32
id|ref_clk_per
suffix:semicolon
DECL|member|pll_ref_div
id|u8
id|pll_ref_div
suffix:semicolon
DECL|member|mclk_fb_div
id|u8
id|mclk_fb_div
suffix:semicolon
DECL|member|mclk_post_div
id|u8
id|mclk_post_div
suffix:semicolon
multiline_comment|/* 1,2,3,4,8 */
DECL|member|mclk_fb_mult
id|u8
id|mclk_fb_mult
suffix:semicolon
multiline_comment|/* 2 or 4 */
DECL|member|xclk_post_div
id|u8
id|xclk_post_div
suffix:semicolon
multiline_comment|/* 1,2,3,4,8 */
DECL|member|vclk_fb_div
id|u8
id|vclk_fb_div
suffix:semicolon
DECL|member|vclk_post_div
id|u8
id|vclk_post_div
suffix:semicolon
multiline_comment|/* 1,2,3,4,6,8,12 */
DECL|member|dsp_xclks_per_row
id|u32
id|dsp_xclks_per_row
suffix:semicolon
multiline_comment|/* 0-16383 */
DECL|member|dsp_loop_latency
id|u32
id|dsp_loop_latency
suffix:semicolon
multiline_comment|/* 0-15 */
DECL|member|dsp_precision
id|u32
id|dsp_precision
suffix:semicolon
multiline_comment|/* 0-7 */
DECL|member|dsp_on
id|u32
id|dsp_on
suffix:semicolon
multiline_comment|/* 0-2047 */
DECL|member|dsp_off
id|u32
id|dsp_off
suffix:semicolon
multiline_comment|/* 0-2047 */
)brace
suffix:semicolon
DECL|macro|ATYIO_FEATR
mdefine_line|#define ATYIO_FEATR&t;&t;0x41545902&t;/* ATY&bslash;02 */
DECL|macro|ATYIO_FEATW
mdefine_line|#define ATYIO_FEATW&t;&t;0x41545903&t;/* ATY&bslash;03 */
macro_line|#endif
macro_line|#ifndef FBIO_WAITFORVSYNC
DECL|macro|FBIO_WAITFORVSYNC
mdefine_line|#define FBIO_WAITFORVSYNC _IOW(&squot;F&squot;, 0x20, __u32)
macro_line|#endif
DECL|function|atyfb_ioctl
r_static
r_int
id|atyfb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
macro_line|#ifdef __sparc__
r_struct
id|fbtype
id|fbtyp
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
macro_line|#ifdef __sparc__
r_case
id|FBIOGTYPE
suffix:colon
id|fbtyp.fb_type
op_assign
id|FBTYPE_PCI_GENERIC
suffix:semicolon
id|fbtyp.fb_width
op_assign
id|par-&gt;crtc.vxres
suffix:semicolon
id|fbtyp.fb_height
op_assign
id|par-&gt;crtc.vyres
suffix:semicolon
id|fbtyp.fb_depth
op_assign
id|info-&gt;var.bits_per_pixel
suffix:semicolon
id|fbtyp.fb_cmsize
op_assign
id|info-&gt;cmap.len
suffix:semicolon
id|fbtyp.fb_size
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_struct
id|fbtype
id|__user
op_star
)paren
id|arg
comma
op_amp
id|fbtyp
comma
r_sizeof
(paren
id|fbtyp
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* __sparc__ */
r_case
id|FBIO_WAITFORVSYNC
suffix:colon
(brace
id|u32
id|crtc
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|crtc
comma
(paren
id|__u32
id|__user
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|aty_waitforvblank
c_func
(paren
id|par
comma
id|crtc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#if defined(DEBUG) &amp;&amp; defined(CONFIG_FB_ATY_CT)
r_case
id|ATYIO_CLKR
suffix:colon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
r_struct
id|atyclk
id|clk
suffix:semicolon
r_union
id|aty_pll
op_star
id|pll
op_assign
op_amp
(paren
id|par-&gt;pll
)paren
suffix:semicolon
id|u32
id|dsp_config
op_assign
id|pll-&gt;ct.dsp_config
suffix:semicolon
id|u32
id|dsp_on_off
op_assign
id|pll-&gt;ct.dsp_on_off
suffix:semicolon
id|clk.ref_clk_per
op_assign
id|par-&gt;ref_clk_per
suffix:semicolon
id|clk.pll_ref_div
op_assign
id|pll-&gt;ct.pll_ref_div
suffix:semicolon
id|clk.mclk_fb_div
op_assign
id|pll-&gt;ct.mclk_fb_div
suffix:semicolon
id|clk.mclk_post_div
op_assign
id|pll-&gt;ct.mclk_post_div_real
suffix:semicolon
id|clk.mclk_fb_mult
op_assign
id|pll-&gt;ct.mclk_fb_mult
suffix:semicolon
id|clk.xclk_post_div
op_assign
id|pll-&gt;ct.xclk_post_div_real
suffix:semicolon
id|clk.vclk_fb_div
op_assign
id|pll-&gt;ct.vclk_fb_div
suffix:semicolon
id|clk.vclk_post_div
op_assign
id|pll-&gt;ct.vclk_post_div_real
suffix:semicolon
id|clk.dsp_xclks_per_row
op_assign
id|dsp_config
op_amp
l_int|0x3fff
suffix:semicolon
id|clk.dsp_loop_latency
op_assign
(paren
id|dsp_config
op_rshift
l_int|16
)paren
op_amp
l_int|0xf
suffix:semicolon
id|clk.dsp_precision
op_assign
(paren
id|dsp_config
op_rshift
l_int|20
)paren
op_amp
l_int|7
suffix:semicolon
id|clk.dsp_off
op_assign
id|dsp_on_off
op_amp
l_int|0x7ff
suffix:semicolon
id|clk.dsp_on
op_assign
(paren
id|dsp_on_off
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_struct
id|atyclk
id|__user
op_star
)paren
id|arg
comma
op_amp
id|clk
comma
r_sizeof
(paren
id|clk
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATYIO_CLKW
suffix:colon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
r_struct
id|atyclk
id|clk
suffix:semicolon
r_union
id|aty_pll
op_star
id|pll
op_assign
op_amp
(paren
id|par-&gt;pll
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clk
comma
(paren
r_struct
id|atyclk
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clk
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|par-&gt;ref_clk_per
op_assign
id|clk.ref_clk_per
suffix:semicolon
id|pll-&gt;ct.pll_ref_div
op_assign
id|clk.pll_ref_div
suffix:semicolon
id|pll-&gt;ct.mclk_fb_div
op_assign
id|clk.mclk_fb_div
suffix:semicolon
id|pll-&gt;ct.mclk_post_div_real
op_assign
id|clk.mclk_post_div
suffix:semicolon
id|pll-&gt;ct.mclk_fb_mult
op_assign
id|clk.mclk_fb_mult
suffix:semicolon
id|pll-&gt;ct.xclk_post_div_real
op_assign
id|clk.xclk_post_div
suffix:semicolon
id|pll-&gt;ct.vclk_fb_div
op_assign
id|clk.vclk_fb_div
suffix:semicolon
id|pll-&gt;ct.vclk_post_div_real
op_assign
id|clk.vclk_post_div
suffix:semicolon
id|pll-&gt;ct.dsp_config
op_assign
(paren
id|clk.dsp_xclks_per_row
op_amp
l_int|0x3fff
)paren
op_or
(paren
(paren
id|clk.dsp_loop_latency
op_amp
l_int|0xf
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|clk.dsp_precision
op_amp
l_int|7
)paren
op_lshift
l_int|20
)paren
suffix:semicolon
id|pll-&gt;ct.dsp_on_off
op_assign
(paren
id|clk.dsp_off
op_amp
l_int|0x7ff
)paren
op_or
(paren
(paren
id|clk.dsp_on
op_amp
l_int|0x7ff
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/*aty_calc_pll_ct(info, &amp;pll-&gt;ct);*/
id|aty_set_pll_ct
c_func
(paren
id|info
comma
id|pll
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATYIO_FEATR
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|par-&gt;features
comma
(paren
id|u32
id|__user
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATYIO_FEATW
suffix:colon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|par-&gt;features
comma
(paren
id|u32
id|__user
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* DEBUG &amp;&amp; CONFIG_FB_ATY_CT */
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_sync
r_static
r_int
id|atyfb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;blitter_may_be_busy
)paren
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef __sparc__
DECL|function|atyfb_mmap
r_static
r_int
id|atyfb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_int
id|size
comma
id|page
comma
id|map_size
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|map_offset
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;mmap_map
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
multiline_comment|/* To stop the swapper from even considering these pages. */
id|vma-&gt;vm_flags
op_or_assign
(paren
id|VM_SHM
op_or
id|VM_LOCKED
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|vma-&gt;vm_pgoff
op_eq
l_int|0
)paren
op_logical_and
(paren
id|size
op_eq
id|info-&gt;fix.smem_len
)paren
)paren
op_logical_or
(paren
(paren
id|off
op_eq
id|info-&gt;fix.smem_len
)paren
op_logical_and
(paren
id|size
op_eq
id|PAGE_SIZE
)paren
)paren
)paren
id|off
op_add_assign
l_int|0x8000000000000000UL
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
multiline_comment|/* propagate off changes */
multiline_comment|/* Each page, see which map applies */
r_for
c_loop
(paren
id|page
op_assign
l_int|0
suffix:semicolon
id|page
OL
id|size
suffix:semicolon
)paren
(brace
id|map_size
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|start
op_assign
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|voff
suffix:semicolon
r_int
r_int
id|end
op_assign
id|start
op_plus
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|size
suffix:semicolon
r_int
r_int
id|offset
op_assign
id|off
op_plus
id|page
suffix:semicolon
r_if
c_cond
(paren
id|start
OG
id|offset
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_ge
id|end
)paren
r_continue
suffix:semicolon
id|map_size
op_assign
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|size
op_minus
(paren
id|offset
op_minus
id|start
)paren
suffix:semicolon
id|map_offset
op_assign
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|poff
op_plus
(paren
id|offset
op_minus
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|map_size
)paren
(brace
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|page
op_plus
id|map_size
OG
id|size
)paren
id|map_size
op_assign
id|size
op_minus
id|page
suffix:semicolon
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_and_assign
op_complement
(paren
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|prot_mask
)paren
suffix:semicolon
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|par-&gt;mmap_map
(braket
id|i
)braket
dot
id|prot_flag
suffix:semicolon
r_if
c_cond
(paren
id|remap_pfn_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
op_plus
id|page
comma
id|map_offset
op_rshift
id|PAGE_SHIFT
comma
id|map_size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|page
op_add_assign
id|map_size
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|map_size
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;mmaped
)paren
id|par-&gt;mmaped
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|yoffset
id|u32
id|yoffset
suffix:semicolon
DECL|member|r
id|u8
id|r
(braket
l_int|2
)braket
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|g
id|u8
id|g
(braket
l_int|2
)braket
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|b
id|u8
id|b
(braket
l_int|2
)braket
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|atyfb_save
)brace
id|atyfb_save
suffix:semicolon
DECL|function|atyfb_save_palette
r_static
r_void
id|atyfb_save_palette
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_int
id|enter
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
id|aty_ld_8
c_func
(paren
id|DAC_CNTL
comma
id|par
)paren
op_amp
l_int|0xfc
suffix:semicolon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|EXTRA_BRIGHT
)paren
)paren
id|tmp
op_or_assign
l_int|0x2
suffix:semicolon
id|aty_st_8
c_func
(paren
id|DAC_CNTL
comma
id|tmp
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|DAC_MASK
comma
l_int|0xff
comma
id|par
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|i
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;rindex
)paren
suffix:semicolon
id|atyfb_save.r
(braket
id|enter
)braket
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|atyfb_save.g
(braket
id|enter
)braket
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|atyfb_save.b
(braket
id|enter
)braket
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|i
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;windex
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|atyfb_save.r
(braket
l_int|1
op_minus
id|enter
)braket
(braket
id|i
)braket
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|atyfb_save.g
(braket
l_int|1
op_minus
id|enter
)braket
(braket
id|i
)braket
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|atyfb_save.b
(braket
l_int|1
op_minus
id|enter
)braket
(braket
id|i
)braket
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
)brace
)brace
DECL|function|atyfb_palette
r_static
r_void
id|atyfb_palette
c_func
(paren
r_int
id|enter
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|info
op_assign
id|registered_fb
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
id|info-&gt;fbops
op_eq
op_amp
id|atyfb_ops
)paren
(brace
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|atyfb_save_palette
c_func
(paren
id|par
comma
id|enter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enter
)paren
(brace
id|atyfb_save.yoffset
op_assign
id|info-&gt;var.yoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
l_int|0
suffix:semicolon
id|set_off_pitch
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;var.yoffset
op_assign
id|atyfb_save.yoffset
suffix:semicolon
id|set_off_pitch
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
)brace
id|aty_st_le32
c_func
(paren
id|CRTC_OFF_PITCH
comma
id|par-&gt;crtc.off_pitch
comma
id|par
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* __sparc__ */
macro_line|#if defined(CONFIG_PM) &amp;&amp; defined(CONFIG_PCI)
multiline_comment|/* Power management routines. Those are used for PowerBook sleep.&n; */
DECL|function|aty_power_mgmt
r_static
r_int
id|aty_power_mgmt
c_func
(paren
r_int
id|sleep
comma
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u32
id|pm
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
(paren
id|pm
op_amp
op_complement
id|PWR_MGT_MODE_MASK
)paren
op_or
id|PWR_MGT_MODE_REG
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|timeout
op_assign
l_int|2000
suffix:semicolon
r_if
c_cond
(paren
id|sleep
)paren
(brace
multiline_comment|/* Sleep */
id|pm
op_and_assign
op_complement
id|PWR_MGT_ON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|pm
op_and_assign
op_complement
(paren
id|PWR_BLON
op_or
id|AUTO_PWR_UP
)paren
suffix:semicolon
id|pm
op_or_assign
id|SUSPEND_NOW
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|pm
op_or_assign
id|PWR_MGT_ON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
r_do
(brace
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_decrement
id|timeout
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|pm
op_amp
id|PWR_MGT_STATUS_MASK
)paren
op_ne
id|PWR_MGT_STATUS_SUSPEND
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Wakeup */
id|pm
op_and_assign
op_complement
id|PWR_MGT_ON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|pm
op_and_assign
op_complement
id|SUSPEND_NOW
suffix:semicolon
id|pm
op_or_assign
(paren
id|PWR_BLON
op_or
id|AUTO_PWR_UP
)paren
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|pm
op_or_assign
id|PWR_MGT_ON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
r_do
(brace
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_decrement
id|timeout
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|pm
op_amp
id|PWR_MGT_STATUS_MASK
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_return
id|timeout
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_pci_suspend
r_static
r_int
id|atyfb_pci_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_PMAC
multiline_comment|/* HACK ALERT ! Once I find a proper way to say to each driver&n;&t; * individually what will happen with it&squot;s PCI slot, I&squot;ll change&n;&t; * that. On laptops, the AGP slot is just unclocked, so D2 is&n;&t; * expected, while on desktops, the card is powered off&n;&t; */
r_if
c_cond
(paren
id|state
op_ge
l_int|3
)paren
id|state
op_assign
l_int|2
suffix:semicolon
macro_line|#endif /* CONFIG_PPC_PMAC */
r_if
c_cond
(paren
id|state
op_ne
l_int|2
op_logical_or
id|state
op_eq
id|pdev-&gt;dev.power_state
)paren
r_return
l_int|0
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Idle &amp; reset engine */
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
id|aty_reset_engine
c_func
(paren
id|par
)paren
suffix:semicolon
multiline_comment|/* Blank display and LCD */
id|atyfb_blank
c_func
(paren
id|VESA_POWERDOWN
op_plus
l_int|1
comma
id|info
)paren
suffix:semicolon
id|par-&gt;asleep
op_assign
l_int|1
suffix:semicolon
id|par-&gt;lock_blank
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Set chip to &quot;suspend&quot; mode */
r_if
c_cond
(paren
id|aty_power_mgmt
c_func
(paren
l_int|1
comma
id|par
)paren
)paren
(brace
id|par-&gt;asleep
op_assign
l_int|0
suffix:semicolon
id|par-&gt;lock_blank
op_assign
l_int|0
suffix:semicolon
id|atyfb_blank
c_func
(paren
l_int|0
comma
id|info
)paren
suffix:semicolon
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|0
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|pdev-&gt;dev.power_state
op_assign
id|state
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_pci_resume
r_static
r_int
id|atyfb_pci_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;dev.power_state
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;dev.power_state
op_eq
l_int|2
)paren
id|aty_power_mgmt
c_func
(paren
l_int|0
comma
id|par
)paren
suffix:semicolon
id|par-&gt;asleep
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Restore display */
id|atyfb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
multiline_comment|/* Refresh */
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Unblank */
id|par-&gt;lock_blank
op_assign
l_int|0
suffix:semicolon
id|atyfb_blank
c_func
(paren
l_int|0
comma
id|info
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|pdev-&gt;dev.power_state
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /*  defined(CONFIG_PM) &amp;&amp; defined(CONFIG_PCI) */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
multiline_comment|/*&n;     *   LCD backlight control&n;     */
DECL|variable|backlight_conv
r_static
r_int
id|backlight_conv
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x3f
comma
l_int|0x4c
comma
l_int|0x59
comma
l_int|0x66
comma
l_int|0x73
comma
l_int|0x80
comma
l_int|0x8d
comma
l_int|0x9a
comma
l_int|0xa7
comma
l_int|0xb4
comma
l_int|0xc1
comma
l_int|0xcf
comma
l_int|0xdc
comma
l_int|0xe9
comma
l_int|0xff
)brace
suffix:semicolon
DECL|function|aty_set_backlight_enable
r_static
r_int
id|aty_set_backlight_enable
c_func
(paren
r_int
id|on
comma
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|data
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_int
id|reg
op_assign
id|aty_ld_lcd
c_func
(paren
id|LCD_MISC_CNTL
comma
id|par
)paren
suffix:semicolon
id|reg
op_or_assign
(paren
id|BLMOD_EN
op_or
id|BIASMOD_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
op_logical_and
id|level
OG
id|BACKLIGHT_OFF
)paren
(brace
id|reg
op_and_assign
op_complement
id|BIAS_MOD_LEVEL_MASK
suffix:semicolon
id|reg
op_or_assign
(paren
id|backlight_conv
(braket
id|level
)braket
op_lshift
id|BIAS_MOD_LEVEL_SHIFT
)paren
suffix:semicolon
)brace
r_else
(brace
id|reg
op_and_assign
op_complement
id|BIAS_MOD_LEVEL_MASK
suffix:semicolon
id|reg
op_or_assign
(paren
id|backlight_conv
(braket
l_int|0
)braket
op_lshift
id|BIAS_MOD_LEVEL_SHIFT
)paren
suffix:semicolon
)brace
id|aty_st_lcd
c_func
(paren
id|LCD_MISC_CNTL
comma
id|reg
comma
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aty_set_backlight_level
r_static
r_int
id|aty_set_backlight_level
c_func
(paren
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|aty_set_backlight_enable
c_func
(paren
l_int|1
comma
id|level
comma
id|data
)paren
suffix:semicolon
)brace
DECL|variable|aty_backlight_controller
r_static
r_struct
id|backlight_controller
id|aty_backlight_controller
op_assign
(brace
id|aty_set_backlight_enable
comma
id|aty_set_backlight_level
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
DECL|function|aty_calc_mem_refresh
r_static
r_void
id|__init
id|aty_calc_mem_refresh
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_int
id|xclk
)paren
(brace
r_const
r_int
id|ragepro_tbl
(braket
)braket
op_assign
(brace
l_int|44
comma
l_int|50
comma
l_int|55
comma
l_int|66
comma
l_int|75
comma
l_int|80
comma
l_int|100
)brace
suffix:semicolon
r_const
r_int
id|ragexl_tbl
(braket
)braket
op_assign
(brace
l_int|50
comma
l_int|66
comma
l_int|75
comma
l_int|83
comma
l_int|90
comma
l_int|95
comma
l_int|100
comma
l_int|105
comma
l_int|110
comma
l_int|115
comma
l_int|120
comma
l_int|125
comma
l_int|133
comma
l_int|143
comma
l_int|166
)brace
suffix:semicolon
r_const
r_int
op_star
id|refresh_tbl
suffix:semicolon
r_int
id|i
comma
id|size
suffix:semicolon
r_if
c_cond
(paren
id|IS_XL
c_func
(paren
id|par-&gt;pci_id
)paren
op_logical_or
id|IS_MOBILITY
c_func
(paren
id|par-&gt;pci_id
)paren
)paren
(brace
id|refresh_tbl
op_assign
id|ragexl_tbl
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
id|ragexl_tbl
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
)brace
r_else
(brace
id|refresh_tbl
op_assign
id|ragepro_tbl
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
id|ragepro_tbl
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xclk
OL
id|refresh_tbl
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
)brace
id|par-&gt;mem_refresh_rate
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Initialisation&n;     */
DECL|variable|fb_list
r_static
r_struct
id|fb_info
op_star
id|fb_list
op_assign
l_int|NULL
suffix:semicolon
DECL|function|aty_init
r_static
r_int
id|__init
id|aty_init
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_const
r_char
op_star
id|ramname
op_assign
l_int|NULL
comma
op_star
id|xtal
suffix:semicolon
r_int
id|gtb_memsize
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
id|u8
id|pll_ref_div
suffix:semicolon
id|u32
id|i
suffix:semicolon
macro_line|#if defined(CONFIG_PPC)
r_int
id|sense
suffix:semicolon
macro_line|#endif
id|init_waitqueue_head
c_func
(paren
op_amp
id|par-&gt;vblank.wait
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|par-&gt;int_lock
)paren
suffix:semicolon
id|par-&gt;aty_cmap_regs
op_assign
(paren
r_struct
id|aty_cmap_regs
id|__iomem
op_star
)paren
(paren
id|par-&gt;ati_regbase
op_plus
l_int|0xc0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pll
)paren
id|par-&gt;pll_limits.pll_max
op_assign
id|pll
suffix:semicolon
r_if
c_cond
(paren
id|mclk
)paren
id|par-&gt;pll_limits.mclk
op_assign
id|mclk
suffix:semicolon
r_if
c_cond
(paren
id|xclk
)paren
id|par-&gt;pll_limits.xclk
op_assign
id|xclk
suffix:semicolon
id|aty_calc_mem_refresh
c_func
(paren
id|par
comma
id|par-&gt;pll_limits.xclk
)paren
suffix:semicolon
id|par-&gt;pll_per
op_assign
l_int|1000000
op_div
id|par-&gt;pll_limits.pll_max
suffix:semicolon
id|par-&gt;mclk_per
op_assign
l_int|1000000
op_div
id|par-&gt;pll_limits.mclk
suffix:semicolon
id|par-&gt;xclk_per
op_assign
l_int|1000000
op_div
id|par-&gt;pll_limits.xclk
suffix:semicolon
id|par-&gt;ref_clk_per
op_assign
l_int|1000000000000ULL
op_div
l_int|14318180
suffix:semicolon
id|xtal
op_assign
l_string|&quot;14.31818&quot;
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GX
r_if
c_cond
(paren
op_logical_neg
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
id|u32
id|stat0
suffix:semicolon
id|u8
id|dac_type
comma
id|dac_subtype
comma
id|clk_type
suffix:semicolon
id|stat0
op_assign
id|aty_ld_le32
c_func
(paren
id|CONFIG_STAT0
comma
id|par
)paren
suffix:semicolon
id|par-&gt;bus_type
op_assign
(paren
id|stat0
op_rshift
l_int|0
)paren
op_amp
l_int|0x07
suffix:semicolon
id|par-&gt;ram_type
op_assign
(paren
id|stat0
op_rshift
l_int|3
)paren
op_amp
l_int|0x07
suffix:semicolon
id|ramname
op_assign
id|aty_gx_ram
(braket
id|par-&gt;ram_type
)braket
suffix:semicolon
multiline_comment|/* FIXME: clockchip/RAMDAC probing? */
id|dac_type
op_assign
(paren
id|aty_ld_le32
c_func
(paren
id|DAC_CNTL
comma
id|par
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
id|clk_type
op_assign
id|CLK_ATI18818_1
suffix:semicolon
id|dac_type
op_assign
(paren
id|stat0
op_rshift
l_int|9
)paren
op_amp
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|dac_type
op_eq
l_int|0x07
)paren
id|dac_subtype
op_assign
id|DAC_ATT20C408
suffix:semicolon
r_else
id|dac_subtype
op_assign
(paren
id|aty_ld_8
c_func
(paren
id|SCRATCH_REG1
op_plus
l_int|1
comma
id|par
)paren
op_amp
l_int|0xF0
)paren
op_or
id|dac_type
suffix:semicolon
macro_line|#else
id|dac_type
op_assign
id|DAC_IBMRGB514
suffix:semicolon
id|dac_subtype
op_assign
id|DAC_IBMRGB514
suffix:semicolon
id|clk_type
op_assign
id|CLK_IBMRGB514
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|dac_subtype
)paren
(brace
r_case
id|DAC_IBMRGB514
suffix:colon
id|par-&gt;dac_ops
op_assign
op_amp
id|aty_dac_ibm514
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC_ATI68860_B
suffix:colon
r_case
id|DAC_ATI68860_C
suffix:colon
id|par-&gt;dac_ops
op_assign
op_amp
id|aty_dac_ati68860b
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC_ATT20C408
suffix:colon
r_case
id|DAC_ATT21C498
suffix:colon
id|par-&gt;dac_ops
op_assign
op_amp
id|aty_dac_att21c498
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINTKI
c_func
(paren
l_string|&quot;aty_init: DAC type not implemented yet!&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;dac_ops
op_assign
op_amp
id|aty_dac_unsupported
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|clk_type
)paren
(brace
r_case
id|CLK_ATI18818_1
suffix:colon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_ati18818_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CLK_STG1703
suffix:colon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_stg1703
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CLK_CH8398
suffix:colon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_ch8398
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CLK_ATT20C408
suffix:colon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_att20c408
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CLK_IBMRGB514
suffix:colon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_ibm514
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINTKI
c_func
(paren
l_string|&quot;aty_init: CLK type not implemented yet!&quot;
)paren
suffix:semicolon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_unsupported
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FB_ATY_GX */
macro_line|#ifdef CONFIG_FB_ATY_CT
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
id|par-&gt;dac_ops
op_assign
op_amp
id|aty_dac_ct
suffix:semicolon
id|par-&gt;pll_ops
op_assign
op_amp
id|aty_pll_ct
suffix:semicolon
id|par-&gt;bus_type
op_assign
id|PCI
suffix:semicolon
id|par-&gt;ram_type
op_assign
(paren
id|aty_ld_le32
c_func
(paren
id|CONFIG_STAT0
comma
id|par
)paren
op_amp
l_int|0x07
)paren
suffix:semicolon
id|ramname
op_assign
id|aty_ct_ram
(braket
id|par-&gt;ram_type
)braket
suffix:semicolon
multiline_comment|/* for many chips, the mclk is 67 MHz for SDRAM, 63 MHz otherwise */
r_if
c_cond
(paren
id|par-&gt;pll_limits.mclk
op_eq
l_int|67
op_logical_and
id|par-&gt;ram_type
OL
id|SDRAM
)paren
id|par-&gt;pll_limits.mclk
op_assign
l_int|63
suffix:semicolon
)brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|GTB_DSP
)paren
op_logical_and
(paren
id|pll_ref_div
op_assign
id|aty_ld_pll_ct
c_func
(paren
id|PLL_REF_DIV
comma
id|par
)paren
)paren
)paren
(brace
r_int
id|diff1
comma
id|diff2
suffix:semicolon
id|diff1
op_assign
l_int|510
op_star
l_int|14
op_div
id|pll_ref_div
op_minus
id|par-&gt;pll_limits.pll_max
suffix:semicolon
id|diff2
op_assign
l_int|510
op_star
l_int|29
op_div
id|pll_ref_div
op_minus
id|par-&gt;pll_limits.pll_max
suffix:semicolon
r_if
c_cond
(paren
id|diff1
OL
l_int|0
)paren
id|diff1
op_assign
op_minus
id|diff1
suffix:semicolon
r_if
c_cond
(paren
id|diff2
OL
l_int|0
)paren
id|diff2
op_assign
op_minus
id|diff2
suffix:semicolon
r_if
c_cond
(paren
id|diff2
OL
id|diff1
)paren
(brace
id|par-&gt;ref_clk_per
op_assign
l_int|1000000000000ULL
op_div
l_int|29498928
suffix:semicolon
id|xtal
op_assign
l_string|&quot;29.498928&quot;
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FB_ATY_CT */
multiline_comment|/* save previous video mode */
id|aty_get_crtc
c_func
(paren
id|par
comma
op_amp
id|saved_crtc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;pll_ops-&gt;get_pll
)paren
(brace
id|par-&gt;pll_ops
op_member_access_from_pointer
id|get_pll
c_func
(paren
id|info
comma
op_amp
id|saved_pll
)paren
suffix:semicolon
)brace
id|i
op_assign
id|aty_ld_le32
c_func
(paren
id|MEM_CNTL
comma
id|par
)paren
suffix:semicolon
id|gtb_memsize
op_assign
id|M64_HAS
c_func
(paren
id|GTB_DSP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gtb_memsize
)paren
r_switch
c_cond
(paren
id|i
op_amp
l_int|0xF
)paren
(brace
multiline_comment|/* 0xF used instead of MEM_SIZE_ALIAS */
r_case
id|MEM_SIZE_512K
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x80000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_1M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x100000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_2M_GTB
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_4M_GTB
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_6M_GTB
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x600000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_8M_GTB
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x80000
suffix:semicolon
)brace
r_else
r_switch
c_cond
(paren
id|i
op_amp
id|MEM_SIZE_ALIAS
)paren
(brace
r_case
id|MEM_SIZE_512K
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x80000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_1M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x100000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_2M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x200000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_4M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x400000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_6M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x600000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEM_SIZE_8M
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x800000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|info-&gt;fix.smem_len
op_assign
l_int|0x80000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|MAGIC_VRAM_SIZE
)paren
)paren
(brace
r_if
c_cond
(paren
id|aty_ld_le32
c_func
(paren
id|CONFIG_STAT1
comma
id|par
)paren
op_amp
l_int|0x40000000
)paren
id|info-&gt;fix.smem_len
op_add_assign
l_int|0x400000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vram
)paren
(brace
id|info-&gt;fix.smem_len
op_assign
id|vram
op_star
l_int|1024
suffix:semicolon
id|i
op_assign
id|i
op_amp
op_complement
(paren
id|gtb_memsize
ques
c_cond
l_int|0xF
suffix:colon
id|MEM_SIZE_ALIAS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.smem_len
op_le
l_int|0x80000
)paren
id|i
op_or_assign
id|MEM_SIZE_512K
suffix:semicolon
r_else
r_if
c_cond
(paren
id|info-&gt;fix.smem_len
op_le
l_int|0x100000
)paren
id|i
op_or_assign
id|MEM_SIZE_1M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|info-&gt;fix.smem_len
op_le
l_int|0x200000
)paren
id|i
op_or_assign
id|gtb_memsize
ques
c_cond
id|MEM_SIZE_2M_GTB
suffix:colon
id|MEM_SIZE_2M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|info-&gt;fix.smem_len
op_le
l_int|0x400000
)paren
id|i
op_or_assign
id|gtb_memsize
ques
c_cond
id|MEM_SIZE_4M_GTB
suffix:colon
id|MEM_SIZE_4M
suffix:semicolon
r_else
r_if
c_cond
(paren
id|info-&gt;fix.smem_len
op_le
l_int|0x600000
)paren
id|i
op_or_assign
id|gtb_memsize
ques
c_cond
id|MEM_SIZE_6M_GTB
suffix:colon
id|MEM_SIZE_6M
suffix:semicolon
r_else
id|i
op_or_assign
id|gtb_memsize
ques
c_cond
id|MEM_SIZE_8M_GTB
suffix:colon
id|MEM_SIZE_8M
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
id|i
comma
id|par
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Reg Block 0 (CT-compatible block) is at mmio_start&n;&t; *  Reg Block 1 (multimedia extensions) is at mmio_start - 0x400&n;&t; */
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|GX
)paren
)paren
(brace
id|info-&gt;fix.mmio_len
op_assign
l_int|0x400
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_ATI_MACH64GX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|CT
)paren
)paren
(brace
id|info-&gt;fix.mmio_len
op_assign
l_int|0x400
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_ATI_MACH64CT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|VT
)paren
)paren
(brace
id|info-&gt;fix.mmio_start
op_sub_assign
l_int|0x400
suffix:semicolon
id|info-&gt;fix.mmio_len
op_assign
l_int|0x800
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_ATI_MACH64VT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GT */
id|info-&gt;fix.mmio_start
op_sub_assign
l_int|0x400
suffix:semicolon
id|info-&gt;fix.mmio_len
op_assign
l_int|0x800
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_ATI_MACH64GT
suffix:semicolon
)brace
id|PRINTKI
c_func
(paren
l_string|&quot;%d%c %s, %s MHz XTAL, %d MHz PLL, %d Mhz MCLK, %d MHz XCLK&bslash;n&quot;
comma
id|info-&gt;fix.smem_len
op_eq
l_int|0x80000
ques
c_cond
l_int|512
suffix:colon
(paren
id|info-&gt;fix.smem_len
op_rshift
l_int|20
)paren
comma
id|info-&gt;fix.smem_len
op_eq
l_int|0x80000
ques
c_cond
l_char|&squot;K&squot;
suffix:colon
l_char|&squot;M&squot;
comma
id|ramname
comma
id|xtal
comma
id|par-&gt;pll_limits.pll_max
comma
id|par-&gt;pll_limits.mclk
comma
id|par-&gt;pll_limits.xclk
)paren
suffix:semicolon
macro_line|#if defined(DEBUG) &amp;&amp; defined(CONFIG_ATY_CT)
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;debug atyfb: BUS_CNTL DAC_CNTL MEM_CNTL EXT_MEM_CNTL CRTC_GEN_CNTL &quot;
l_string|&quot;DSP_CONFIG DSP_ON_OFF CLOCK_CNTL&bslash;n&quot;
l_string|&quot;debug atyfb: %08x %08x %08x %08x     %08x      %08x   %08x   %08x&bslash;n&quot;
l_string|&quot;debug atyfb: PLL&quot;
comma
id|aty_ld_le32
c_func
(paren
id|BUS_CNTL
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|DAC_CNTL
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|MEM_CNTL
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|EXT_MEM_CNTL
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|DSP_CONFIG
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|DSP_ON_OFF
comma
id|par
)paren
comma
id|aty_ld_le32
c_func
(paren
id|CLOCK_CNTL
comma
id|par
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|40
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|aty_ld_pll_ct
c_func
(paren
id|i
comma
id|par
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|par-&gt;pll_ops-&gt;init_pll
)paren
(brace
id|par-&gt;pll_ops
op_member_access_from_pointer
id|init_pll
c_func
(paren
id|info
comma
op_amp
id|par-&gt;pll
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Last page of 8 MB (4 MB on ISA) aperture is MMIO&n;&t; *  FIXME: we should use the auxiliary aperture instead so we can access&n;&t; *  the full 8 MB of video RAM on 8 MB boards&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;aux_start
op_logical_and
(paren
id|info-&gt;fix.smem_len
op_eq
l_int|0x800000
op_logical_or
(paren
id|par-&gt;bus_type
op_eq
id|ISA
op_logical_and
id|info-&gt;fix.smem_len
op_eq
l_int|0x400000
)paren
)paren
)paren
id|info-&gt;fix.smem_len
op_sub_assign
id|GUI_RESERVE
suffix:semicolon
multiline_comment|/*&n;&t; *  Disable register access through the linear aperture&n;&t; *  if the auxiliary aperture is used so we can access&n;&t; *  the full 8 MB of video RAM on 8 MB boards.&n;&t; */
r_if
c_cond
(paren
id|par-&gt;aux_start
)paren
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
id|aty_ld_le32
c_func
(paren
id|BUS_CNTL
comma
id|par
)paren
op_or
id|BUS_APER_REG_DIS
comma
id|par
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|par-&gt;mtrr_aper
op_assign
op_minus
l_int|1
suffix:semicolon
id|par-&gt;mtrr_reg
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nomtrr
)paren
(brace
multiline_comment|/* Cover the whole resource. */
id|par-&gt;mtrr_aper
op_assign
id|mtrr_add
c_func
(paren
id|par-&gt;res_start
comma
id|par-&gt;res_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;mtrr_aper
op_ge
l_int|0
op_logical_and
op_logical_neg
id|par-&gt;aux_start
)paren
(brace
multiline_comment|/* Make a hole for mmio. */
id|par-&gt;mtrr_reg
op_assign
id|mtrr_add
c_func
(paren
id|par-&gt;res_start
op_plus
l_int|0x800000
op_minus
id|GUI_RESERVE
comma
id|GUI_RESERVE
comma
id|MTRR_TYPE_UNCACHABLE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;mtrr_reg
OL
l_int|0
)paren
(brace
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr_aper
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mtrr_aper
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|info-&gt;fbops
op_assign
op_amp
id|atyfb_ops
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|pseudo_palette
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|G3_PB_1_1
)paren
op_logical_and
id|machine_is_compatible
c_func
(paren
l_string|&quot;PowerBook1,1&quot;
)paren
)paren
(brace
multiline_comment|/* these bits let the 101 powerbook wake up from sleep -- paulus */
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
op_or
(paren
id|USE_F32KHZ
op_or
id|TRISTATE_MEM_EN
)paren
comma
id|par
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|MOBIL_BUS
)paren
)paren
id|register_backlight_controller
c_func
(paren
op_amp
id|aty_backlight_controller
comma
id|info
comma
l_string|&quot;ati&quot;
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
id|memset
c_func
(paren
op_amp
id|var
comma
l_int|0
comma
r_sizeof
(paren
id|var
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC
r_if
c_cond
(paren
id|_machine
op_eq
id|_MACH_Pmac
)paren
(brace
multiline_comment|/*&n;&t;&t; *  FIXME: The NVRAM stuff should be put in a Mac-specific file, as it&n;&t;&t; *         applies to all Mac video cards&n;&t;&t; */
r_if
c_cond
(paren
id|mode
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mac_find_mode
c_func
(paren
op_amp
id|var
comma
id|info
comma
id|mode
comma
l_int|8
)paren
)paren
id|var
op_assign
id|default_var
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|default_vmode
op_eq
id|VMODE_CHOOSE
)paren
(brace
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|G3_PB_1024x768
)paren
)paren
multiline_comment|/* G3 PowerBook with 1024x768 LCD */
id|default_vmode
op_assign
id|VMODE_1024_768_60
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_compatible
c_func
(paren
l_string|&quot;iMac&quot;
)paren
)paren
id|default_vmode
op_assign
id|VMODE_1024_768_75
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_compatible
(paren
l_string|&quot;PowerBook2,1&quot;
)paren
)paren
multiline_comment|/* iBook with 800x600 LCD */
id|default_vmode
op_assign
id|VMODE_800_600_60
suffix:semicolon
r_else
id|default_vmode
op_assign
id|VMODE_640_480_67
suffix:semicolon
id|sense
op_assign
id|read_aty_sense
c_func
(paren
id|par
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;monitor sense=%x, mode %d&bslash;n&quot;
comma
id|sense
comma
id|mac_map_monitor_sense
c_func
(paren
id|sense
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|default_vmode
op_le
l_int|0
op_logical_or
id|default_vmode
OG
id|VMODE_MAX
)paren
id|default_vmode
op_assign
id|VMODE_640_480_60
suffix:semicolon
r_if
c_cond
(paren
id|default_cmode
template_param
id|CMODE_32
)paren
id|default_cmode
op_assign
id|CMODE_8
suffix:semicolon
r_if
c_cond
(paren
id|mac_vmode_to_var
c_func
(paren
id|default_vmode
comma
id|default_cmode
comma
op_amp
id|var
)paren
)paren
id|var
op_assign
id|default_var
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif /* !CONFIG_PPC */
r_if
c_cond
(paren
op_logical_neg
id|fb_find_mode
c_func
(paren
op_amp
id|var
comma
id|info
comma
id|mode
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|defmode
comma
l_int|8
)paren
)paren
id|var
op_assign
id|default_var
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
r_if
c_cond
(paren
id|var.yres
op_eq
id|var.yres_virtual
)paren
(brace
id|u32
id|videoram
op_assign
(paren
id|info-&gt;fix.smem_len
op_minus
(paren
id|PAGE_SIZE
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|var.yres_virtual
op_assign
(paren
(paren
id|videoram
op_star
l_int|8
)paren
op_div
id|var.bits_per_pixel
)paren
op_div
id|var.xres_virtual
suffix:semicolon
r_if
c_cond
(paren
id|var.yres_virtual
OL
id|var.yres
)paren
id|var.yres_virtual
op_assign
id|var.yres
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atyfb_check_var
c_func
(paren
op_amp
id|var
comma
id|info
)paren
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;can&squot;t set default video mode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|aty_init_exit
suffix:semicolon
)brace
macro_line|#ifdef __sparc__
id|atyfb_save_palette
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_ATY_CT
r_if
c_cond
(paren
op_logical_neg
id|noaccel
op_logical_and
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
id|aty_init_cursor
c_func
(paren
id|info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FB_ATY_CT */
id|info-&gt;var
op_assign
id|var
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
id|info
)paren
OL
l_int|0
)paren
r_goto
id|aty_init_exit
suffix:semicolon
id|fb_list
op_assign
id|info
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;fb%d: %s frame buffer device on %s&bslash;n&quot;
comma
id|info-&gt;node
comma
id|info-&gt;fix.id
comma
id|name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|aty_init_exit
suffix:colon
multiline_comment|/* restore video mode */
id|aty_set_crtc
c_func
(paren
id|par
comma
op_amp
id|saved_crtc
)paren
suffix:semicolon
id|par-&gt;pll_ops
op_member_access_from_pointer
id|set_pll
c_func
(paren
id|info
comma
op_amp
id|saved_pll
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
id|par-&gt;mtrr_reg
op_ge
l_int|0
)paren
(brace
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr_reg
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mtrr_reg
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;mtrr_aper
op_ge
l_int|0
)paren
(brace
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr_aper
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mtrr_aper
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATARI
DECL|function|store_video_par
r_static
r_int
id|__init
id|store_video_par
c_func
(paren
r_char
op_star
id|video_str
comma
r_int
r_char
id|m64_num
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
r_int
id|vmembase
comma
id|size
comma
id|guiregbase
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;store_video_par() &squot;%s&squot; &bslash;n&quot;
comma
id|video_str
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strsep
c_func
(paren
op_amp
id|video_str
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|mach64_invalid
suffix:semicolon
id|vmembase
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strsep
c_func
(paren
op_amp
id|video_str
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|mach64_invalid
suffix:semicolon
id|size
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|strsep
c_func
(paren
op_amp
id|video_str
comma
l_string|&quot;;&quot;
)paren
)paren
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_goto
id|mach64_invalid
suffix:semicolon
id|guiregbase
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|phys_vmembase
(braket
id|m64_num
)braket
op_assign
id|vmembase
suffix:semicolon
id|phys_size
(braket
id|m64_num
)braket
op_assign
id|size
suffix:semicolon
id|phys_guiregbase
(braket
id|m64_num
)braket
op_assign
id|guiregbase
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;stored them all: $%08lX $%08lX $%08lX &bslash;n&quot;
comma
id|vmembase
comma
id|size
comma
id|guiregbase
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|mach64_invalid
suffix:colon
id|phys_vmembase
(braket
id|m64_num
)braket
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
multiline_comment|/*&n;     *  Blank the display.&n;     */
DECL|function|atyfb_blank
r_static
r_int
id|atyfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
id|gen_cntl
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;lock_blank
op_logical_or
id|par-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
(paren
id|_machine
op_eq
id|_MACH_Pmac
)paren
op_logical_and
id|blank
)paren
id|set_backlight_enable
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_FB_ATY_GENERIC_LCD)
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_logical_and
id|blank
op_logical_and
(paren
id|aty_ld_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|par
)paren
op_amp
id|LCD_ON
)paren
)paren
(brace
id|u32
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|pm
op_and_assign
op_complement
id|PWR_BLON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
)brace
macro_line|#endif
id|gen_cntl
op_assign
id|aty_ld_8
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
l_int|0
)paren
r_switch
c_cond
(paren
id|blank
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
id|gen_cntl
op_or_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|gen_cntl
op_or_assign
l_int|0x8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|gen_cntl
op_or_assign
l_int|0x4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|gen_cntl
op_or_assign
l_int|0x4c
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|gen_cntl
op_and_assign
op_complement
(paren
l_int|0x4c
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|gen_cntl
comma
id|par
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
(paren
id|_machine
op_eq
id|_MACH_Pmac
)paren
op_logical_and
op_logical_neg
id|blank
)paren
id|set_backlight_enable
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_FB_ATY_GENERIC_LCD)
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_logical_and
op_logical_neg
id|blank
op_logical_and
(paren
id|aty_ld_lcd
c_func
(paren
id|LCD_GEN_CNTL
comma
id|par
)paren
op_amp
id|LCD_ON
)paren
)paren
(brace
id|u32
id|pm
op_assign
id|aty_ld_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|par
)paren
suffix:semicolon
id|pm
op_or_assign
id|PWR_BLON
suffix:semicolon
id|aty_st_lcd
c_func
(paren
id|POWER_MANAGEMENT
comma
id|pm
comma
id|par
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aty_st_pal
r_static
r_void
id|aty_st_pal
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
r_const
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
id|out_8
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;windex
comma
id|regno
)paren
suffix:semicolon
id|out_8
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
comma
id|red
)paren
suffix:semicolon
id|out_8
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
comma
id|green
)paren
suffix:semicolon
id|out_8
c_func
(paren
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
comma
id|blue
)paren
suffix:semicolon
macro_line|#else
id|writeb
c_func
(paren
id|regno
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;windex
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|red
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|green
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|blue
comma
op_amp
id|par-&gt;aty_cmap_regs-&gt;lut
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;     *  Set a single color register. The values supplied are already&n;     *  rounded down to the hardware&squot;s capabilities (according to the&n;     *  entries in the var structure). Return != 0 for invalid regno.&n;     *  !! 4 &amp; 8 =  PSEUDO, &gt; 8 = DIRECTCOLOR&n;     */
DECL|function|atyfb_setcolreg
r_static
r_int
id|atyfb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|i
comma
id|depth
suffix:semicolon
id|u32
op_star
id|pal
op_assign
id|info-&gt;pseudo_palette
suffix:semicolon
id|depth
op_assign
id|info-&gt;var.bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|depth
op_eq
l_int|16
)paren
id|depth
op_assign
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
ques
c_cond
l_int|15
suffix:colon
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;asleep
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
op_logical_or
(paren
id|depth
op_eq
l_int|16
op_logical_and
id|regno
OG
l_int|63
)paren
op_logical_or
(paren
id|depth
op_eq
l_int|15
op_logical_and
id|regno
OG
l_int|31
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|par-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|15
suffix:colon
id|pal
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|10
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|pal
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|11
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|pal
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|16
)paren
op_or
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|i
op_assign
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
id|pal
(braket
id|regno
)braket
op_assign
(paren
id|i
op_lshift
l_int|16
)paren
op_or
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|i
op_assign
id|aty_ld_8
c_func
(paren
id|DAC_CNTL
comma
id|par
)paren
op_amp
l_int|0xfc
suffix:semicolon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|EXTRA_BRIGHT
)paren
)paren
id|i
op_or_assign
l_int|0x2
suffix:semicolon
multiline_comment|/* DAC_CNTL | 0x2 turns off the extra brightness for gt */
id|aty_st_8
c_func
(paren
id|DAC_CNTL
comma
id|i
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|DAC_MASK
comma
l_int|0xff
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|M64_HAS
c_func
(paren
id|INTEGRATED
)paren
)paren
(brace
r_if
c_cond
(paren
id|depth
op_eq
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|regno
OL
l_int|32
)paren
id|aty_st_pal
c_func
(paren
id|regno
op_lshift
l_int|3
comma
id|red
comma
id|par-&gt;palette
(braket
id|regno
op_lshift
l_int|1
)braket
dot
id|green
comma
id|blue
comma
id|par
)paren
suffix:semicolon
id|red
op_assign
id|par-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|red
suffix:semicolon
id|blue
op_assign
id|par-&gt;palette
(braket
id|regno
op_rshift
l_int|1
)braket
dot
id|blue
suffix:semicolon
id|regno
op_lshift_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|depth
op_eq
l_int|15
)paren
(brace
id|regno
op_lshift_assign
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|aty_st_pal
c_func
(paren
id|regno
op_plus
id|i
comma
id|red
comma
id|green
comma
id|blue
comma
id|par
)paren
suffix:semicolon
)brace
)brace
)brace
id|aty_st_pal
c_func
(paren
id|regno
comma
id|red
comma
id|green
comma
id|blue
comma
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef __sparc__
r_extern
r_void
(paren
op_star
id|prom_palette
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|function|atyfb_setup_sparc
r_static
r_int
id|__devinit
id|atyfb_setup_sparc
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
r_int
id|addr
)paren
(brace
r_extern
r_int
id|con_is_present
c_func
(paren
r_void
)paren
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_struct
id|pcidev_cookie
op_star
id|pcp
suffix:semicolon
r_char
id|prop
(braket
l_int|128
)braket
suffix:semicolon
r_int
id|node
comma
id|len
comma
id|i
comma
id|j
comma
id|ret
suffix:semicolon
id|u32
id|mem
comma
id|chip_id
suffix:semicolon
multiline_comment|/* Do not attach when we have a serial console. */
r_if
c_cond
(paren
op_logical_neg
id|con_is_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/*&n;&t; * Map memory-mapped registers.&n;&t; */
id|par-&gt;ati_regbase
op_assign
(paren
r_void
op_star
)paren
id|addr
op_plus
l_int|0x7ffc00UL
suffix:semicolon
id|info-&gt;fix.mmio_start
op_assign
id|addr
op_plus
l_int|0x7ffc00UL
suffix:semicolon
multiline_comment|/*&n;&t; * Map in big-endian aperture.&n;&t; */
id|info-&gt;screen_base
op_assign
(paren
r_char
op_star
)paren
(paren
id|addr
op_plus
l_int|0x800000UL
)paren
suffix:semicolon
id|info-&gt;fix.smem_start
op_assign
id|addr
op_plus
l_int|0x800000UL
suffix:semicolon
multiline_comment|/*&n;&t; * Figure mmap addresses from PCI config space.&n;&t; * Split Framebuffer in big- and little-endian halfs.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
op_logical_and
id|pdev-&gt;resource
(braket
id|i
)braket
dot
id|start
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* nothing */
suffix:semicolon
id|j
op_assign
id|i
op_plus
l_int|4
suffix:semicolon
id|par-&gt;mmap_map
op_assign
id|kmalloc
c_func
(paren
id|j
op_star
r_sizeof
(paren
op_star
id|par-&gt;mmap_map
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;mmap_map
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;atyfb_setup_sparc() can&squot;t alloc mmap_map&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|par-&gt;mmap_map
comma
l_int|0
comma
id|j
op_star
r_sizeof
(paren
op_star
id|par-&gt;mmap_map
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|2
suffix:semicolon
id|i
OL
l_int|6
op_logical_and
id|pdev-&gt;resource
(braket
id|i
)braket
dot
id|start
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|resource
op_star
id|rp
op_assign
op_amp
id|pdev-&gt;resource
(braket
id|i
)braket
suffix:semicolon
r_int
id|io
comma
id|breg
op_assign
id|PCI_BASE_ADDRESS_0
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
id|u32
id|size
comma
id|pbase
suffix:semicolon
id|base
op_assign
id|rp-&gt;start
suffix:semicolon
id|io
op_assign
(paren
id|rp-&gt;flags
op_amp
id|IORESOURCE_IO
)paren
suffix:semicolon
id|size
op_assign
id|rp-&gt;end
op_minus
id|base
op_plus
l_int|1
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|breg
comma
op_amp
id|pbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io
)paren
id|size
op_and_assign
op_complement
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Map the framebuffer a second time, this time without&n;&t;&t; * the braindead _PAGE_IE setting. This is used by the&n;&t;&t; * fixed Xserver, but we need to maintain the old mapping&n;&t;&t; * to stay compatible with older ones...&n;&t;&t; */
r_if
c_cond
(paren
id|base
op_eq
id|addr
)paren
(brace
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|voff
op_assign
(paren
id|pbase
op_plus
l_int|0x10000000
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|poff
op_assign
id|base
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|size
op_assign
(paren
id|size
op_plus
op_complement
id|PAGE_MASK
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_mask
op_assign
id|_PAGE_CACHE
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_flag
op_assign
id|_PAGE_E
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Here comes the old framebuffer mapping with _PAGE_IE&n;&t;&t; * set for the big endian half of the framebuffer...&n;&t;&t; */
r_if
c_cond
(paren
id|base
op_eq
id|addr
)paren
(brace
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|voff
op_assign
(paren
id|pbase
op_plus
l_int|0x800000
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|poff
op_assign
(paren
id|base
op_plus
l_int|0x800000
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|size
op_assign
l_int|0x800000
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_mask
op_assign
id|_PAGE_CACHE
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_flag
op_assign
id|_PAGE_E
op_or
id|_PAGE_IE
suffix:semicolon
id|size
op_sub_assign
l_int|0x800000
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|voff
op_assign
id|pbase
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|poff
op_assign
id|base
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|size
op_assign
(paren
id|size
op_plus
op_complement
id|PAGE_MASK
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_mask
op_assign
id|_PAGE_CACHE
suffix:semicolon
id|par-&gt;mmap_map
(braket
id|j
)braket
dot
id|prot_flag
op_assign
id|_PAGE_E
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|correct_chipset
c_func
(paren
id|par
)paren
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IS_XL
c_func
(paren
id|pdev-&gt;device
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Fix PROMs idea of MEM_CNTL settings...&n;&t;&t; */
id|mem
op_assign
id|aty_ld_le32
c_func
(paren
id|MEM_CNTL
comma
id|par
)paren
suffix:semicolon
id|chip_id
op_assign
id|aty_ld_le32
c_func
(paren
id|CONFIG_CHIP_ID
comma
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|chip_id
op_amp
id|CFG_CHIP_TYPE
)paren
op_eq
id|VT_CHIP_ID
)paren
op_logical_and
op_logical_neg
(paren
(paren
id|chip_id
op_rshift
l_int|24
)paren
op_amp
l_int|1
)paren
)paren
(brace
r_switch
c_cond
(paren
id|mem
op_amp
l_int|0x0f
)paren
(brace
r_case
l_int|3
suffix:colon
id|mem
op_assign
(paren
id|mem
op_amp
op_complement
(paren
l_int|0x0f
)paren
)paren
op_or
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|mem
op_assign
(paren
id|mem
op_amp
op_complement
(paren
l_int|0x0f
)paren
)paren
op_or
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|mem
op_assign
(paren
id|mem
op_amp
op_complement
(paren
l_int|0x0f
)paren
)paren
op_or
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|mem
op_assign
(paren
id|mem
op_amp
op_complement
(paren
l_int|0x0f
)paren
)paren
op_or
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|aty_ld_le32
c_func
(paren
id|CONFIG_STAT0
comma
id|par
)paren
op_amp
l_int|7
)paren
op_ge
id|SDRAM
)paren
id|mem
op_and_assign
op_complement
(paren
l_int|0x00700000
)paren
suffix:semicolon
)brace
id|mem
op_and_assign
op_complement
(paren
l_int|0xcf80e000
)paren
suffix:semicolon
multiline_comment|/* Turn off all undocumented bits. */
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
id|mem
comma
id|par
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If this is the console device, we will set default video&n;&t; * settings to what the PROM left us with.&n;&t; */
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|node
comma
l_string|&quot;aliases&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
)paren
(brace
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;screen&quot;
comma
id|prop
comma
r_sizeof
(paren
id|prop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|prop
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|node
op_assign
id|prom_finddevice
c_func
(paren
id|prop
)paren
suffix:semicolon
)brace
r_else
id|node
op_assign
l_int|0
suffix:semicolon
)brace
id|pcp
op_assign
id|pdev-&gt;sysdata
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
id|pcp-&gt;prom_node
)paren
(brace
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|default_var
suffix:semicolon
r_int
r_int
id|N
comma
id|P
comma
id|Q
comma
id|M
comma
id|T
comma
id|R
suffix:semicolon
id|u32
id|v_total
comma
id|h_total
suffix:semicolon
r_struct
id|crtc
id|crtc
suffix:semicolon
id|u8
id|pll_regs
(braket
l_int|16
)braket
suffix:semicolon
id|u8
id|clock_cntl
suffix:semicolon
id|crtc.vxres
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;width&quot;
comma
l_int|1024
)paren
suffix:semicolon
id|crtc.vyres
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;height&quot;
comma
l_int|768
)paren
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;depth&quot;
comma
l_int|8
)paren
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|crtc.h_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc.h_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|crtc.v_tot_disp
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
id|par
)paren
suffix:semicolon
id|crtc.v_sync_strt_wid
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
id|par
)paren
suffix:semicolon
id|crtc.gen_cntl
op_assign
id|aty_ld_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
suffix:semicolon
id|aty_crtc_to_var
c_func
(paren
op_amp
id|crtc
comma
id|var
)paren
suffix:semicolon
id|h_total
op_assign
id|var-&gt;xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|v_total
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Read the PLL to figure actual Refresh Rate.&n;&t;&t; */
id|clock_cntl
op_assign
id|aty_ld_8
c_func
(paren
id|CLOCK_CNTL
comma
id|par
)paren
suffix:semicolon
multiline_comment|/* DPRINTK(&quot;CLOCK_CNTL %02x&bslash;n&quot;, clock_cntl); */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|pll_regs
(braket
id|i
)braket
op_assign
id|aty_ld_pll_ct
c_func
(paren
id|i
comma
id|par
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * PLL Reference Divider M:&n;&t;&t; */
id|M
op_assign
id|pll_regs
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/*&n;&t;&t; * PLL Feedback Divider N (Dependant on CLOCK_CNTL):&n;&t;&t; */
id|N
op_assign
id|pll_regs
(braket
l_int|7
op_plus
(paren
id|clock_cntl
op_amp
l_int|3
)paren
)braket
suffix:semicolon
multiline_comment|/*&n;&t;&t; * PLL Post Divider P (Dependant on CLOCK_CNTL):&n;&t;&t; */
id|P
op_assign
l_int|1
op_lshift
(paren
id|pll_regs
(braket
l_int|6
)braket
op_rshift
(paren
(paren
id|clock_cntl
op_amp
l_int|3
)paren
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * PLL Divider Q:&n;&t;&t; */
id|Q
op_assign
id|N
op_div
id|P
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Target Frequency:&n;&t;&t; *&n;&t;&t; *      T * M&n;&t;&t; * Q = -------&n;&t;&t; *      2 * R&n;&t;&t; *&n;&t;&t; * where R is XTALIN (= 14318 or 29498 kHz).&n;&t;&t; */
r_if
c_cond
(paren
id|IS_XL
c_func
(paren
id|pdev-&gt;device
)paren
)paren
id|R
op_assign
l_int|29498
suffix:semicolon
r_else
id|R
op_assign
l_int|14318
suffix:semicolon
id|T
op_assign
l_int|2
op_star
id|Q
op_star
id|R
op_div
id|M
suffix:semicolon
id|default_var.pixclock
op_assign
l_int|1000000000
op_div
id|T
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else /* __sparc__ */
macro_line|#ifdef __i386__
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
DECL|function|aty_init_lcd
r_void
id|aty_init_lcd
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
id|u32
id|bios_base
)paren
(brace
id|u32
id|driv_inf_tab
comma
id|sig
suffix:semicolon
id|u16
id|lcd_ofs
suffix:semicolon
multiline_comment|/* To support an LCD panel, we should know it&squot;s dimensions and&n;&t; *  it&squot;s desired pixel clock.&n;&t; * There are two ways to do it:&n;&t; *  - Check the startup video mode and calculate the panel&n;&t; *    size from it. This is unreliable.&n;&t; *  - Read it from the driver information table in the video BIOS.&n;&t;*/
multiline_comment|/* Address of driver information table is at offset 0x78. */
id|driv_inf_tab
op_assign
id|bios_base
op_plus
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|bios_base
op_plus
l_int|0x78
)paren
)paren
suffix:semicolon
multiline_comment|/* Check for the driver information table signature. */
id|sig
op_assign
(paren
op_star
(paren
id|u32
op_star
)paren
id|driv_inf_tab
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sig
op_eq
l_int|0x54504c24
)paren
op_logical_or
multiline_comment|/* Rage LT pro */
(paren
id|sig
op_eq
l_int|0x544d5224
)paren
op_logical_or
multiline_comment|/* Rage mobility */
(paren
id|sig
op_eq
l_int|0x54435824
)paren
op_logical_or
multiline_comment|/* Rage XC */
(paren
id|sig
op_eq
l_int|0x544c5824
)paren
)paren
(brace
multiline_comment|/* Rage XL */
id|PRINTKI
c_func
(paren
l_string|&quot;BIOS contains driver information table.&bslash;n&quot;
)paren
suffix:semicolon
id|lcd_ofs
op_assign
(paren
op_star
(paren
id|u16
op_star
)paren
(paren
id|driv_inf_tab
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|par-&gt;lcd_table
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lcd_ofs
op_ne
l_int|0
)paren
(brace
id|par-&gt;lcd_table
op_assign
id|bios_base
op_plus
id|lcd_ofs
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|par-&gt;lcd_table
op_ne
l_int|0
)paren
(brace
r_char
id|model
(braket
l_int|24
)braket
suffix:semicolon
r_char
id|strbuf
(braket
l_int|16
)braket
suffix:semicolon
r_char
id|refresh_rates_buf
(braket
l_int|100
)braket
suffix:semicolon
r_int
id|id
comma
id|tech
comma
id|f
comma
id|i
comma
id|m
comma
id|default_refresh_rate
suffix:semicolon
r_char
op_star
id|txtcolour
suffix:semicolon
r_char
op_star
id|txtmonitor
suffix:semicolon
r_char
op_star
id|txtdual
suffix:semicolon
r_char
op_star
id|txtformat
suffix:semicolon
id|u16
id|width
comma
id|height
comma
id|panel_type
comma
id|refresh_rates
suffix:semicolon
id|u16
op_star
id|lcdmodeptr
suffix:semicolon
id|u32
id|format
suffix:semicolon
id|u8
id|lcd_refresh_rates
(braket
l_int|16
)braket
op_assign
(brace
l_int|50
comma
l_int|56
comma
l_int|60
comma
l_int|67
comma
l_int|70
comma
l_int|72
comma
l_int|75
comma
l_int|76
comma
l_int|85
comma
l_int|90
comma
l_int|100
comma
l_int|120
comma
l_int|140
comma
l_int|150
comma
l_int|160
comma
l_int|200
)brace
suffix:semicolon
multiline_comment|/* The most important information is the panel size at&n;&t;&t; * offset 25 and 27, but there&squot;s some other nice information&n;&t;&t; * which we print to the screen.&n;&t;&t; */
id|id
op_assign
op_star
(paren
id|u8
op_star
)paren
id|par-&gt;lcd_table
suffix:semicolon
id|strncpy
c_func
(paren
id|model
comma
(paren
r_char
op_star
)paren
id|par-&gt;lcd_table
op_plus
l_int|1
comma
l_int|24
)paren
suffix:semicolon
id|model
(braket
l_int|23
)braket
op_assign
l_int|0
suffix:semicolon
id|width
op_assign
id|par-&gt;lcd_width
op_assign
op_star
(paren
id|u16
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|25
)paren
suffix:semicolon
id|height
op_assign
id|par-&gt;lcd_height
op_assign
op_star
(paren
id|u16
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|27
)paren
suffix:semicolon
id|panel_type
op_assign
op_star
(paren
id|u16
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|29
)paren
suffix:semicolon
r_if
c_cond
(paren
id|panel_type
op_amp
l_int|1
)paren
id|txtcolour
op_assign
l_string|&quot;colour&quot;
suffix:semicolon
r_else
id|txtcolour
op_assign
l_string|&quot;monochrome&quot;
suffix:semicolon
r_if
c_cond
(paren
id|panel_type
op_amp
l_int|2
)paren
id|txtdual
op_assign
l_string|&quot;dual (split) &quot;
suffix:semicolon
r_else
id|txtdual
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|tech
op_assign
(paren
id|panel_type
op_rshift
l_int|2
)paren
op_amp
l_int|63
suffix:semicolon
r_switch
c_cond
(paren
id|tech
)paren
(brace
r_case
l_int|0
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;passive matrix&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;active matrix&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;active addressed STN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;EL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;plasma&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|txtmonitor
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
)brace
id|format
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|57
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tech
op_eq
l_int|0
op_logical_or
id|tech
op_eq
l_int|2
)paren
(brace
r_switch
c_cond
(paren
id|format
op_amp
l_int|7
)paren
(brace
r_case
l_int|0
suffix:colon
id|txtformat
op_assign
l_string|&quot;12 bit interface&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|txtformat
op_assign
l_string|&quot;16 bit interface&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|txtformat
op_assign
l_string|&quot;24 bit interface&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|txtformat
op_assign
l_string|&quot;unkown format&quot;
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|format
op_amp
l_int|7
)paren
(brace
r_case
l_int|0
suffix:colon
id|txtformat
op_assign
l_string|&quot;8 colours&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|txtformat
op_assign
l_string|&quot;512 colours&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|txtformat
op_assign
l_string|&quot;4096 colours&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|txtformat
op_assign
l_string|&quot;262144 colours (LT mode)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|txtformat
op_assign
l_string|&quot;16777216 colours&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|txtformat
op_assign
l_string|&quot;262144 colours (FDPI-2 mode)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|txtformat
op_assign
l_string|&quot;unkown format&quot;
suffix:semicolon
)brace
)brace
id|PRINTKI
c_func
(paren
l_string|&quot;%s%s %s monitor detected: %s&bslash;n&quot;
comma
id|txtdual
comma
id|txtcolour
comma
id|txtmonitor
comma
id|model
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;       id=%d, %dx%d pixels, %s&bslash;n&quot;
comma
id|id
comma
id|width
comma
id|height
comma
id|txtformat
)paren
suffix:semicolon
id|refresh_rates_buf
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|refresh_rates
op_assign
op_star
(paren
id|u16
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|62
)paren
suffix:semicolon
id|m
op_assign
l_int|1
suffix:semicolon
id|f
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|refresh_rates
op_amp
id|m
)paren
(brace
r_if
c_cond
(paren
id|f
op_eq
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;%d&quot;
comma
id|lcd_refresh_rates
(braket
id|i
)braket
)paren
suffix:semicolon
id|f
op_increment
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|strbuf
comma
l_string|&quot;,%d&quot;
comma
id|lcd_refresh_rates
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|strcat
c_func
(paren
id|refresh_rates_buf
comma
id|strbuf
)paren
suffix:semicolon
)brace
id|m
op_assign
id|m
op_lshift
l_int|1
suffix:semicolon
)brace
id|default_refresh_rate
op_assign
(paren
op_star
(paren
id|u8
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|61
)paren
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;       supports refresh rates [%s], default %d Hz&bslash;n&quot;
comma
id|refresh_rates_buf
comma
id|lcd_refresh_rates
(braket
id|default_refresh_rate
)braket
)paren
suffix:semicolon
id|par-&gt;lcd_refreshrate
op_assign
id|lcd_refresh_rates
(braket
id|default_refresh_rate
)braket
suffix:semicolon
multiline_comment|/* We now need to determine the crtc parameters for the&n;&t;&t; * lcd monitor. This is tricky, because they are not stored&n;&t;&t; * individually in the BIOS. Instead, the BIOS contains a&n;&t;&t; * table of display modes that work for this monitor.&n;&t;&t; *&n;&t;&t; * The idea is that we search for a mode of the same dimensions&n;&t;&t; * as the dimensions of the lcd monitor. Say our lcd monitor&n;&t;&t; * is 800x600 pixels, we search for a 800x600 monitor.&n;&t;&t; * The CRTC parameters we find here are the ones that we need&n;&t;&t; * to use to simulate other resolutions on the lcd screen.&n;&t;&t; */
id|lcdmodeptr
op_assign
(paren
id|u16
op_star
)paren
(paren
id|par-&gt;lcd_table
op_plus
l_int|64
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|lcdmodeptr
op_ne
l_int|0
)paren
(brace
id|u32
id|modeptr
suffix:semicolon
id|u16
id|mwidth
comma
id|mheight
comma
id|lcd_hsync_start
comma
id|lcd_vsync_start
suffix:semicolon
id|modeptr
op_assign
id|bios_base
op_plus
op_star
id|lcdmodeptr
suffix:semicolon
id|mwidth
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|0
)paren
)paren
suffix:semicolon
id|mheight
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mwidth
op_eq
id|width
op_logical_and
id|mheight
op_eq
id|height
)paren
(brace
id|par-&gt;lcd_pixclock
op_assign
l_int|100000000
op_div
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|9
)paren
)paren
suffix:semicolon
id|par-&gt;lcd_htotal
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|17
)paren
)paren
op_amp
l_int|511
suffix:semicolon
id|par-&gt;lcd_hdisp
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|19
)paren
)paren
op_amp
l_int|511
suffix:semicolon
id|lcd_hsync_start
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|21
)paren
)paren
op_amp
l_int|511
suffix:semicolon
id|par-&gt;lcd_hsync_dly
op_assign
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|21
)paren
)paren
op_rshift
l_int|9
)paren
op_amp
l_int|7
suffix:semicolon
id|par-&gt;lcd_hsync_len
op_assign
op_star
(paren
(paren
id|u8
op_star
)paren
(paren
id|modeptr
op_plus
l_int|23
)paren
)paren
op_amp
l_int|63
suffix:semicolon
id|par-&gt;lcd_vtotal
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|24
)paren
)paren
op_amp
l_int|2047
suffix:semicolon
id|par-&gt;lcd_vdisp
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|26
)paren
)paren
op_amp
l_int|2047
suffix:semicolon
id|lcd_vsync_start
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|28
)paren
)paren
op_amp
l_int|2047
suffix:semicolon
id|par-&gt;lcd_vsync_len
op_assign
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|modeptr
op_plus
l_int|28
)paren
)paren
op_rshift
l_int|11
)paren
op_amp
l_int|31
suffix:semicolon
id|par-&gt;lcd_htotal
op_assign
(paren
id|par-&gt;lcd_htotal
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|par-&gt;lcd_hdisp
op_assign
(paren
id|par-&gt;lcd_hdisp
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|lcd_hsync_start
op_assign
(paren
id|lcd_hsync_start
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|par-&gt;lcd_hsync_len
op_assign
id|par-&gt;lcd_hsync_len
op_star
l_int|8
suffix:semicolon
id|par-&gt;lcd_vtotal
op_increment
suffix:semicolon
id|par-&gt;lcd_vdisp
op_increment
suffix:semicolon
id|lcd_vsync_start
op_increment
suffix:semicolon
id|par-&gt;lcd_right_margin
op_assign
id|lcd_hsync_start
op_minus
id|par-&gt;lcd_hdisp
suffix:semicolon
id|par-&gt;lcd_lower_margin
op_assign
id|lcd_vsync_start
op_minus
id|par-&gt;lcd_vdisp
suffix:semicolon
id|par-&gt;lcd_hblank_len
op_assign
id|par-&gt;lcd_htotal
op_minus
id|par-&gt;lcd_hdisp
suffix:semicolon
id|par-&gt;lcd_vblank_len
op_assign
id|par-&gt;lcd_vtotal
op_minus
id|par-&gt;lcd_vdisp
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lcdmodeptr
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|lcdmodeptr
op_eq
l_int|0
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;LCD monitor CRTC parameters not found!!!&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* To do: Switch to CRT if possible. */
)brace
r_else
(brace
id|PRINTKI
c_func
(paren
l_string|&quot;       LCD CRTC parameters: %d.%d  %d %d %d %d  %d %d %d %d&bslash;n&quot;
comma
l_int|1000000
op_div
id|par-&gt;lcd_pixclock
comma
l_int|1000000
op_mod
id|par-&gt;lcd_pixclock
comma
id|par-&gt;lcd_hdisp
comma
id|par-&gt;lcd_hdisp
op_plus
id|par-&gt;lcd_right_margin
comma
id|par-&gt;lcd_hdisp
op_plus
id|par-&gt;lcd_right_margin
op_plus
id|par-&gt;lcd_hsync_dly
op_plus
id|par-&gt;lcd_hsync_len
comma
id|par-&gt;lcd_htotal
comma
id|par-&gt;lcd_vdisp
comma
id|par-&gt;lcd_vdisp
op_plus
id|par-&gt;lcd_lower_margin
comma
id|par-&gt;lcd_vdisp
op_plus
id|par-&gt;lcd_lower_margin
op_plus
id|par-&gt;lcd_vsync_len
comma
id|par-&gt;lcd_vtotal
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;                          : %d %d %d %d %d %d %d %d %d&bslash;n&quot;
comma
id|par-&gt;lcd_pixclock
comma
id|par-&gt;lcd_hblank_len
op_minus
(paren
id|par-&gt;lcd_right_margin
op_plus
id|par-&gt;lcd_hsync_dly
op_plus
id|par-&gt;lcd_hsync_len
)paren
comma
id|par-&gt;lcd_hdisp
comma
id|par-&gt;lcd_right_margin
comma
id|par-&gt;lcd_hsync_len
comma
id|par-&gt;lcd_vblank_len
op_minus
(paren
id|par-&gt;lcd_lower_margin
op_plus
id|par-&gt;lcd_vsync_len
)paren
comma
id|par-&gt;lcd_vdisp
comma
id|par-&gt;lcd_lower_margin
comma
id|par-&gt;lcd_vsync_len
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* CONFIG_FB_ATY_GENERIC_LCD */
DECL|function|init_from_bios
r_static
r_int
id|__devinit
id|init_from_bios
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u32
id|bios_base
comma
id|rom_addr
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|rom_addr
op_assign
l_int|0xc0000
op_plus
(paren
(paren
id|aty_ld_le32
c_func
(paren
id|SCRATCH_REG1
comma
id|par
)paren
op_amp
l_int|0x7f
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|bios_base
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|rom_addr
comma
l_int|0x10000
)paren
suffix:semicolon
multiline_comment|/* The BIOS starts with 0xaa55. */
r_if
c_cond
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
id|bios_base
)paren
op_eq
l_int|0xaa55
)paren
(brace
id|u8
op_star
id|bios_ptr
suffix:semicolon
id|u16
id|rom_table_offset
comma
id|freq_table_offset
suffix:semicolon
id|PLL_BLOCK_MACH64
id|pll_block
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;Mach64 BIOS is located at %x, mapped at %x.&bslash;n&quot;
comma
id|rom_addr
comma
id|bios_base
)paren
suffix:semicolon
multiline_comment|/* check for frequncy table */
id|bios_ptr
op_assign
(paren
id|u8
op_star
)paren
id|bios_base
suffix:semicolon
id|rom_table_offset
op_assign
(paren
id|u16
)paren
(paren
id|bios_ptr
(braket
l_int|0x48
)braket
op_or
(paren
id|bios_ptr
(braket
l_int|0x49
)braket
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|freq_table_offset
op_assign
id|bios_ptr
(braket
id|rom_table_offset
op_plus
l_int|16
)braket
op_or
(paren
id|bios_ptr
(braket
id|rom_table_offset
op_plus
l_int|17
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|pll_block
comma
id|bios_ptr
op_plus
id|freq_table_offset
comma
r_sizeof
(paren
id|PLL_BLOCK_MACH64
)paren
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;BIOS frequency table:&bslash;n&quot;
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;PCLK_min_freq %d, PCLK_max_freq %d, ref_freq %d, ref_divider %d&bslash;n&quot;
comma
id|pll_block.PCLK_min_freq
comma
id|pll_block.PCLK_max_freq
comma
id|pll_block.ref_freq
comma
id|pll_block.ref_divider
)paren
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;MCLK_pwd %d, MCLK_max_freq %d, XCLK_max_freq %d, SCLK_freq %d&bslash;n&quot;
comma
id|pll_block.MCLK_pwd
comma
id|pll_block.MCLK_max_freq
comma
id|pll_block.XCLK_max_freq
comma
id|pll_block.SCLK_freq
)paren
suffix:semicolon
id|par-&gt;pll_limits.pll_min
op_assign
id|pll_block.PCLK_min_freq
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.pll_max
op_assign
id|pll_block.PCLK_max_freq
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.ref_clk
op_assign
id|pll_block.ref_freq
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.ref_div
op_assign
id|pll_block.ref_divider
suffix:semicolon
id|par-&gt;pll_limits.sclk
op_assign
id|pll_block.SCLK_freq
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.mclk
op_assign
id|pll_block.MCLK_max_freq
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.mclk_pm
op_assign
id|pll_block.MCLK_pwd
op_div
l_int|100
suffix:semicolon
id|par-&gt;pll_limits.xclk
op_assign
id|pll_block.XCLK_max_freq
op_div
l_int|100
suffix:semicolon
macro_line|#ifdef CONFIG_FB_ATY_GENERIC_LCD
id|aty_init_lcd
c_func
(paren
id|par
comma
id|bios_base
)paren
suffix:semicolon
macro_line|#endif
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;no BIOS frequency table found, use parameters&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
id|__iomem
)paren
id|bios_base
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif /* __i386__ */
DECL|function|atyfb_setup_generic
r_static
r_int
id|__devinit
id|atyfb_setup_generic
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
r_int
id|addr
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|u16
id|tmp
suffix:semicolon
r_int
r_int
id|raddr
suffix:semicolon
r_struct
id|resource
op_star
id|rrp
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|raddr
op_assign
id|addr
op_plus
l_int|0x7ff000UL
suffix:semicolon
id|rrp
op_assign
op_amp
id|pdev-&gt;resource
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rrp-&gt;flags
op_amp
id|IORESOURCE_MEM
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|rrp-&gt;start
comma
id|rrp-&gt;end
op_minus
id|rrp-&gt;start
op_plus
l_int|1
comma
l_string|&quot;atyfb&quot;
)paren
)paren
(brace
id|par-&gt;aux_start
op_assign
id|rrp-&gt;start
suffix:semicolon
id|par-&gt;aux_size
op_assign
id|rrp-&gt;end
op_minus
id|rrp-&gt;start
op_plus
l_int|1
suffix:semicolon
id|raddr
op_assign
id|rrp-&gt;start
suffix:semicolon
id|PRINTKI
c_func
(paren
l_string|&quot;using auxiliary register aperture&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|info-&gt;fix.mmio_start
op_assign
id|raddr
suffix:semicolon
id|par-&gt;ati_regbase
op_assign
id|ioremap
c_func
(paren
id|info-&gt;fix.mmio_start
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;ati_regbase
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|info-&gt;fix.mmio_start
op_add_assign
id|par-&gt;aux_start
ques
c_cond
l_int|0x400
suffix:colon
l_int|0xc00
suffix:semicolon
id|par-&gt;ati_regbase
op_add_assign
id|par-&gt;aux_start
ques
c_cond
l_int|0x400
suffix:colon
l_int|0xc00
suffix:semicolon
multiline_comment|/*&n;&t; * Enable memory-space accesses using config-space&n;&t; * command register.&n;&t; */
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|PCI_COMMAND_MEMORY
)paren
)paren
(brace
id|tmp
op_or_assign
id|PCI_COMMAND_MEMORY
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#ifdef __BIG_ENDIAN
multiline_comment|/* Use the big-endian aperture */
id|addr
op_add_assign
l_int|0x800000
suffix:semicolon
macro_line|#endif
multiline_comment|/* Map in frame buffer */
id|info-&gt;fix.smem_start
op_assign
id|addr
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|ioremap
c_func
(paren
id|addr
comma
l_int|0x800000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;screen_base
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|atyfb_setup_generic_fail
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|correct_chipset
c_func
(paren
id|par
)paren
)paren
)paren
(brace
r_goto
id|atyfb_setup_generic_fail
suffix:semicolon
)brace
macro_line|#ifdef __i386__
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|init_from_bios
c_func
(paren
id|par
)paren
)paren
)paren
(brace
r_goto
id|atyfb_setup_generic_fail
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|aty_ld_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|par
)paren
op_amp
id|CRTC_EXT_DISP_EN
)paren
)paren
id|par-&gt;clk_wr_offset
op_assign
(paren
id|inb
c_func
(paren
id|R_GENMO
)paren
op_amp
l_int|0x0CU
)paren
op_rshift
l_int|2
suffix:semicolon
r_else
id|par-&gt;clk_wr_offset
op_assign
id|aty_ld_8
c_func
(paren
id|CLOCK_CNTL
comma
id|par
)paren
op_amp
l_int|0x03U
suffix:semicolon
multiline_comment|/* according to ATI, we should use clock 3 for acelerated mode */
id|par-&gt;clk_wr_offset
op_assign
l_int|3
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|atyfb_setup_generic_fail
suffix:colon
id|iounmap
c_func
(paren
id|par-&gt;ati_regbase
)paren
suffix:semicolon
id|par-&gt;ati_regbase
op_assign
l_int|NULL
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif /* !__sparc__ */
DECL|function|atyfb_pci_probe
r_static
r_int
id|__devinit
id|atyfb_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
r_int
id|addr
comma
id|res_start
comma
id|res_size
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|resource
op_star
id|rp
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
suffix:semicolon
r_int
id|i
comma
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
r_sizeof
(paren
id|aty_chips
)paren
op_div
r_sizeof
(paren
op_star
id|aty_chips
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|pdev-&gt;device
op_eq
id|aty_chips
(braket
id|i
)braket
dot
id|pci_id
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Enable device in PCI config */
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;Cannot enable PCI device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/* Find which resource to use */
id|rp
op_assign
op_amp
id|pdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rp-&gt;flags
op_amp
id|IORESOURCE_IO
)paren
id|rp
op_assign
op_amp
id|pdev-&gt;resource
(braket
l_int|1
)braket
suffix:semicolon
id|addr
op_assign
id|rp-&gt;start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/* Reserve space */
id|res_start
op_assign
id|rp-&gt;start
suffix:semicolon
id|res_size
op_assign
id|rp-&gt;end
op_minus
id|rp-&gt;start
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|res_start
comma
id|res_size
comma
l_string|&quot;atyfb&quot;
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* Allocate framebuffer */
id|info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|atyfb_par
)paren
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;atyfb_pci_probe() can&squot;t alloc fb_info&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|info-&gt;fix
op_assign
id|atyfb_fix
suffix:semicolon
id|info-&gt;device
op_assign
op_amp
id|pdev-&gt;dev
suffix:semicolon
id|par-&gt;pci_id
op_assign
id|aty_chips
(braket
id|i
)braket
dot
id|pci_id
suffix:semicolon
id|par-&gt;res_start
op_assign
id|res_start
suffix:semicolon
id|par-&gt;res_size
op_assign
id|res_size
suffix:semicolon
id|par-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
multiline_comment|/* Setup &quot;info&quot; structure */
macro_line|#ifdef __sparc__
id|rc
op_assign
id|atyfb_setup_sparc
c_func
(paren
id|pdev
comma
id|info
comma
id|addr
)paren
suffix:semicolon
macro_line|#else
id|rc
op_assign
id|atyfb_setup_generic
c_func
(paren
id|pdev
comma
id|info
comma
id|addr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_release_mem
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|info
)paren
suffix:semicolon
multiline_comment|/* Init chip &amp; register framebuffer */
r_if
c_cond
(paren
id|aty_init
c_func
(paren
id|info
comma
l_string|&quot;PCI&quot;
)paren
)paren
r_goto
id|err_release_io
suffix:semicolon
macro_line|#ifdef __sparc__
r_if
c_cond
(paren
op_logical_neg
id|prom_palette
)paren
id|prom_palette
op_assign
id|atyfb_palette
suffix:semicolon
multiline_comment|/*&n;&t; * Add /dev/fb mmap values.&n;&t; */
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|voff
op_assign
l_int|0x8000000000000000UL
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|poff
op_assign
(paren
r_int
r_int
)paren
id|info-&gt;screen_base
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|size
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|prot_mask
op_assign
id|_PAGE_CACHE
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|prot_flag
op_assign
id|_PAGE_E
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|1
)braket
dot
id|voff
op_assign
id|par-&gt;mmap_map
(braket
l_int|0
)braket
dot
id|voff
op_plus
id|info-&gt;fix.smem_len
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|1
)braket
dot
id|poff
op_assign
(paren
r_int
)paren
id|par-&gt;ati_regbase
op_amp
id|PAGE_MASK
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|1
)braket
dot
id|size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|1
)braket
dot
id|prot_mask
op_assign
id|_PAGE_CACHE
suffix:semicolon
id|par-&gt;mmap_map
(braket
l_int|1
)braket
dot
id|prot_flag
op_assign
id|_PAGE_E
suffix:semicolon
macro_line|#endif /* __sparc__ */
r_return
l_int|0
suffix:semicolon
id|err_release_io
suffix:colon
macro_line|#ifdef __sparc__
r_if
c_cond
(paren
id|par-&gt;mmap_map
)paren
id|kfree
c_func
(paren
id|par-&gt;mmap_map
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|par-&gt;ati_regbase
)paren
id|iounmap
c_func
(paren
id|par-&gt;ati_regbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;screen_base
)paren
id|iounmap
c_func
(paren
id|info-&gt;screen_base
)paren
suffix:semicolon
macro_line|#endif
id|err_release_mem
suffix:colon
r_if
c_cond
(paren
id|par-&gt;aux_start
)paren
(brace
id|release_mem_region
c_func
(paren
id|par-&gt;aux_start
comma
id|par-&gt;aux_size
)paren
suffix:semicolon
)brace
id|release_mem_region
c_func
(paren
id|par-&gt;res_start
comma
id|par-&gt;res_size
)paren
suffix:semicolon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
macro_line|#ifdef CONFIG_ATARI
DECL|function|atyfb_atari_probe
r_static
r_int
id|__devinit
id|atyfb_atari_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|aty_par
op_star
id|par
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_int
id|m64_num
suffix:semicolon
id|u32
id|clock_r
suffix:semicolon
r_for
c_loop
(paren
id|m64_num
op_assign
l_int|0
suffix:semicolon
id|m64_num
OL
id|mach64_count
suffix:semicolon
id|m64_num
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|phys_vmembase
(braket
id|m64_num
)braket
op_logical_or
op_logical_neg
id|phys_size
(braket
id|m64_num
)braket
op_logical_or
op_logical_neg
id|phys_guiregbase
(braket
id|m64_num
)braket
)paren
(brace
id|PRINTKI
c_func
(paren
l_string|&quot;phys_*[%d] parameters not set =&gt; returning early. &bslash;n&quot;
comma
id|m64_num
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|atyfb_par
)paren
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|PRINTKE
c_func
(paren
l_string|&quot;atyfb_atari_probe() can&squot;t alloc fb_info&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|par
op_assign
id|info-&gt;par
suffix:semicolon
id|info-&gt;fix
op_assign
id|atyfb_fix
suffix:semicolon
id|par-&gt;irq
op_assign
(paren
r_int
r_int
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* something invalid */
multiline_comment|/*&n;&t;&t; *  Map the video memory (physical address given) to somewhere in the&n;&t;&t; *  kernel address space.&n;&t;&t; */
id|info-&gt;screen_base
op_assign
id|ioremap
c_func
(paren
id|phys_vmembase
(braket
id|m64_num
)braket
comma
id|phys_size
(braket
id|m64_num
)braket
)paren
suffix:semicolon
id|info-&gt;fix.smem_start
op_assign
(paren
r_int
r_int
)paren
id|info-&gt;screen_base
suffix:semicolon
multiline_comment|/* Fake! */
id|par-&gt;ati_regbase
op_assign
id|ioremap
c_func
(paren
id|phys_guiregbase
(braket
id|m64_num
)braket
comma
l_int|0x10000
)paren
op_plus
l_int|0xFC00ul
suffix:semicolon
id|info-&gt;fix.mmio_start
op_assign
(paren
r_int
r_int
)paren
id|par-&gt;ati_regbase
suffix:semicolon
multiline_comment|/* Fake! */
id|aty_st_le32
c_func
(paren
id|CLOCK_CNTL
comma
l_int|0x12345678
comma
id|par
)paren
suffix:semicolon
id|clock_r
op_assign
id|aty_ld_le32
c_func
(paren
id|CLOCK_CNTL
comma
id|par
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|clock_r
op_amp
l_int|0x003F
)paren
(brace
r_case
l_int|0x12
suffix:colon
id|par-&gt;clk_wr_offset
op_assign
l_int|3
suffix:semicolon
multiline_comment|/*  */
r_break
suffix:semicolon
r_case
l_int|0x34
suffix:colon
id|par-&gt;clk_wr_offset
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Medusa ST-IO ISA Adapter etc. */
r_break
suffix:semicolon
r_case
l_int|0x16
suffix:colon
id|par-&gt;clk_wr_offset
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*  */
r_break
suffix:semicolon
r_case
l_int|0x38
suffix:colon
id|par-&gt;clk_wr_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Panther 1 ISA Adapter (Gerald) */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aty_init
c_func
(paren
id|info
comma
l_string|&quot;ISA bus&quot;
)paren
)paren
(brace
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
multiline_comment|/* This is insufficient! kernel_map has added two large chunks!! */
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* CONFIG_ATARI */
DECL|function|atyfb_remove
r_static
r_void
id|__devexit
id|atyfb_remove
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
multiline_comment|/* restore video mode */
id|aty_set_crtc
c_func
(paren
id|par
comma
op_amp
id|saved_crtc
)paren
suffix:semicolon
id|par-&gt;pll_ops
op_member_access_from_pointer
id|set_pll
c_func
(paren
id|info
comma
op_amp
id|saved_pll
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
id|par-&gt;mtrr_reg
op_ge
l_int|0
)paren
(brace
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr_reg
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mtrr_reg
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;mtrr_aper
op_ge
l_int|0
)paren
(brace
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr_aper
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mtrr_aper
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifndef __sparc__
r_if
c_cond
(paren
id|par-&gt;ati_regbase
)paren
id|iounmap
c_func
(paren
id|par-&gt;ati_regbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;screen_base
)paren
id|iounmap
c_func
(paren
id|info-&gt;screen_base
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
r_if
c_cond
(paren
id|info-&gt;sprite.addr
)paren
id|iounmap
c_func
(paren
id|info-&gt;sprite.addr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef __sparc__
r_if
c_cond
(paren
id|par-&gt;mmap_map
)paren
id|kfree
c_func
(paren
id|par-&gt;mmap_map
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|par-&gt;aux_start
)paren
id|release_mem_region
c_func
(paren
id|par-&gt;aux_start
comma
id|par-&gt;aux_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;res_start
)paren
id|release_mem_region
c_func
(paren
id|par-&gt;res_start
comma
id|par-&gt;res_size
)paren
suffix:semicolon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|atyfb_pci_remove
r_static
r_void
id|__devexit
id|atyfb_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|atyfb_remove
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This driver uses its own matching table. That will be more difficult&n; * to fix, so for now, we just match against any ATI ID and let the&n; * probe() function find out what&squot;s up. That also mean we don&squot;t have&n; * a module ID table though.&n; */
DECL|variable|atyfb_pci_tbl
r_static
r_struct
id|pci_device_id
id|atyfb_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ATI
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|PCI_BASE_CLASS_DISPLAY
op_lshift
l_int|16
comma
l_int|0xff0000
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|atyfb_driver
r_static
r_struct
id|pci_driver
id|atyfb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;atyfb&quot;
comma
dot
id|id_table
op_assign
id|atyfb_pci_tbl
comma
dot
id|probe
op_assign
id|atyfb_pci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|atyfb_pci_remove
)paren
comma
macro_line|#ifdef CONFIG_PM
dot
id|suspend
op_assign
id|atyfb_pci_suspend
comma
dot
id|resume
op_assign
id|atyfb_pci_resume
comma
macro_line|#endif /* CONFIG_PM */
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PCI */
DECL|function|atyfb_setup
r_int
id|__init
id|atyfb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomtrr&quot;
comma
l_int|6
)paren
)paren
(brace
id|nomtrr
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vram:&quot;
comma
l_int|5
)paren
)paren
id|vram
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;pll:&quot;
comma
l_int|4
)paren
)paren
id|pll
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mclk:&quot;
comma
l_int|5
)paren
)paren
id|mclk
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;xclk:&quot;
comma
l_int|5
)paren
)paren
id|xclk
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vmode:&quot;
comma
l_int|6
)paren
)paren
(brace
r_int
r_int
id|vmode
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vmode
OG
l_int|0
op_logical_and
id|vmode
op_le
id|VMODE_MAX
)paren
id|default_vmode
op_assign
id|vmode
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;cmode:&quot;
comma
l_int|6
)paren
)paren
(brace
r_int
r_int
id|cmode
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmode
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|8
suffix:colon
id|default_cmode
op_assign
id|CMODE_8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|default_cmode
op_assign
id|CMODE_16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|default_cmode
op_assign
id|CMODE_32
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ATARI
multiline_comment|/*&n;&t;&t; * Why do we need this silly Mach64 argument?&n;&t;&t; * We are already here because of mach64= so its redundant.&n;&t;&t; */
r_else
r_if
c_cond
(paren
id|MACH_IS_ATARI
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;Mach64:&quot;
comma
l_int|7
)paren
)paren
)paren
(brace
r_static
r_int
r_char
id|m64_num
suffix:semicolon
r_static
r_char
id|mach64_str
(braket
l_int|80
)braket
suffix:semicolon
id|strlcpy
c_func
(paren
id|mach64_str
comma
id|this_opt
op_plus
l_int|7
comma
r_sizeof
(paren
id|mach64_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|store_video_par
c_func
(paren
id|mach64_str
comma
id|m64_num
)paren
)paren
(brace
id|m64_num
op_increment
suffix:semicolon
id|mach64_count
op_assign
id|m64_num
suffix:semicolon
)brace
)brace
macro_line|#endif
r_else
id|mode
op_assign
id|this_opt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_init
r_int
id|__init
id|atyfb_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef MODULE
r_char
op_star
id|option
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;atyfb&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|atyfb_setup
c_func
(paren
id|option
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
id|pci_module_init
c_func
(paren
op_amp
id|atyfb_driver
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ATARI
id|atyfb_atari_probe
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atyfb_exit
r_void
id|__exit
id|atyfb_exit
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PCI
id|pci_unregister_driver
c_func
(paren
op_amp
id|atyfb_driver
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|atyfb_init
id|module_init
c_func
(paren
id|atyfb_init
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|variable|atyfb_exit
id|module_exit
c_func
(paren
id|atyfb_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FBDev driver for ATI Mach64 cards&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|noaccel
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;bool: disable acceleration&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|vram
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vram
comma
l_string|&quot;int: override size of video ram&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|pll
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pll
comma
l_string|&quot;int: override video clock&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|mclk
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mclk
comma
l_string|&quot;int: override memory clock&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|xclk
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|xclk
comma
l_string|&quot;int: override accelerated engine clock&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|mode
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;Specify resolution as &bslash;&quot;&lt;xres&gt;x&lt;yres&gt;[-&lt;bpp&gt;][@&lt;refresh&gt;]&bslash;&quot; &quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|module_param
c_func
(paren
id|nomtrr
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomtrr
comma
l_string|&quot;bool: disable use of MTRR registers&quot;
)paren
suffix:semicolon
macro_line|#endif
eof
