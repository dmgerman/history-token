macro_line|#ifndef __RADEONFB_H__
DECL|macro|__RADEONFB_H__
mdefine_line|#define __RADEONFB_H__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-id.h&gt;
macro_line|#include &lt;linux/i2c-algo-bit.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/radeon.h&gt;
multiline_comment|/***************************************************************&n; * Most of the definitions here are adapted right from XFree86 *&n; ***************************************************************/
multiline_comment|/*&n; * Chip families. Must fit in the low 16 bits of a long word&n; */
DECL|enum|radeon_family
r_enum
id|radeon_family
(brace
DECL|enumerator|CHIP_FAMILY_UNKNOW
id|CHIP_FAMILY_UNKNOW
comma
DECL|enumerator|CHIP_FAMILY_LEGACY
id|CHIP_FAMILY_LEGACY
comma
DECL|enumerator|CHIP_FAMILY_RADEON
id|CHIP_FAMILY_RADEON
comma
DECL|enumerator|CHIP_FAMILY_RV100
id|CHIP_FAMILY_RV100
comma
DECL|enumerator|CHIP_FAMILY_RS100
id|CHIP_FAMILY_RS100
comma
multiline_comment|/* U1 (IGP320M) or A3 (IGP320)*/
DECL|enumerator|CHIP_FAMILY_RV200
id|CHIP_FAMILY_RV200
comma
DECL|enumerator|CHIP_FAMILY_RS200
id|CHIP_FAMILY_RS200
comma
multiline_comment|/* U2 (IGP330M/340M/350M) or A4 (IGP330/340/345/350), RS250 (IGP 7000) */
DECL|enumerator|CHIP_FAMILY_R200
id|CHIP_FAMILY_R200
comma
DECL|enumerator|CHIP_FAMILY_RV250
id|CHIP_FAMILY_RV250
comma
DECL|enumerator|CHIP_FAMILY_RS300
id|CHIP_FAMILY_RS300
comma
multiline_comment|/* Radeon 9000 IGP */
DECL|enumerator|CHIP_FAMILY_RV280
id|CHIP_FAMILY_RV280
comma
DECL|enumerator|CHIP_FAMILY_R300
id|CHIP_FAMILY_R300
comma
DECL|enumerator|CHIP_FAMILY_R350
id|CHIP_FAMILY_R350
comma
DECL|enumerator|CHIP_FAMILY_RV350
id|CHIP_FAMILY_RV350
comma
DECL|enumerator|CHIP_FAMILY_LAST
id|CHIP_FAMILY_LAST
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Chip flags&n; */
DECL|enum|radeon_chip_flags
r_enum
id|radeon_chip_flags
(brace
DECL|enumerator|CHIP_FAMILY_MASK
id|CHIP_FAMILY_MASK
op_assign
l_int|0x0000ffffUL
comma
DECL|enumerator|CHIP_FLAGS_MASK
id|CHIP_FLAGS_MASK
op_assign
l_int|0xffff0000UL
comma
DECL|enumerator|CHIP_IS_MOBILITY
id|CHIP_IS_MOBILITY
op_assign
l_int|0x00010000UL
comma
DECL|enumerator|CHIP_IS_IGP
id|CHIP_IS_IGP
op_assign
l_int|0x00020000UL
comma
DECL|enumerator|CHIP_HAS_CRTC2
id|CHIP_HAS_CRTC2
op_assign
l_int|0x00040000UL
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Monitor types&n; */
DECL|enum|radeon_montype
r_enum
id|radeon_montype
(brace
DECL|enumerator|MT_NONE
id|MT_NONE
op_assign
l_int|0
comma
DECL|enumerator|MT_CRT
id|MT_CRT
comma
multiline_comment|/* CRT */
DECL|enumerator|MT_LCD
id|MT_LCD
comma
multiline_comment|/* LCD */
DECL|enumerator|MT_DFP
id|MT_DFP
comma
multiline_comment|/* DVI */
DECL|enumerator|MT_CTV
id|MT_CTV
comma
multiline_comment|/* composite TV */
DECL|enumerator|MT_STV
id|MT_STV
multiline_comment|/* S-Video out */
)brace
suffix:semicolon
multiline_comment|/*&n; * DDC i2c ports&n; */
DECL|enum|ddc_type
r_enum
id|ddc_type
(brace
DECL|enumerator|ddc_none
id|ddc_none
comma
DECL|enumerator|ddc_monid
id|ddc_monid
comma
DECL|enumerator|ddc_dvi
id|ddc_dvi
comma
DECL|enumerator|ddc_vga
id|ddc_vga
comma
DECL|enumerator|ddc_crt2
id|ddc_crt2
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Connector types&n; */
DECL|enum|conn_type
r_enum
id|conn_type
(brace
DECL|enumerator|conn_none
id|conn_none
comma
DECL|enumerator|conn_proprietary
id|conn_proprietary
comma
DECL|enumerator|conn_crt
id|conn_crt
comma
DECL|enumerator|conn_DVI_I
id|conn_DVI_I
comma
DECL|enumerator|conn_DVI_D
id|conn_DVI_D
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * PLL infos&n; */
DECL|struct|pll_info
r_struct
id|pll_info
(brace
DECL|member|ppll_max
r_int
id|ppll_max
suffix:semicolon
DECL|member|ppll_min
r_int
id|ppll_min
suffix:semicolon
DECL|member|sclk
DECL|member|mclk
r_int
id|sclk
comma
id|mclk
suffix:semicolon
DECL|member|ref_div
r_int
id|ref_div
suffix:semicolon
DECL|member|ref_clk
r_int
id|ref_clk
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * VRAM infos&n; */
DECL|struct|ram_info
r_struct
id|ram_info
(brace
DECL|member|ml
r_int
id|ml
suffix:semicolon
DECL|member|mb
r_int
id|mb
suffix:semicolon
DECL|member|trcd
r_int
id|trcd
suffix:semicolon
DECL|member|trp
r_int
id|trp
suffix:semicolon
DECL|member|twr
r_int
id|twr
suffix:semicolon
DECL|member|cl
r_int
id|cl
suffix:semicolon
DECL|member|tr2w
r_int
id|tr2w
suffix:semicolon
DECL|member|loop_latency
r_int
id|loop_latency
suffix:semicolon
DECL|member|rloop
r_int
id|rloop
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * This structure contains the various registers manipulated by this&n; * driver for setting or restoring a mode. It&squot;s mostly copied from&n; * XFree&squot;s RADEONSaveRec structure. A few chip settings might still be&n; * tweaked without beeing reflected or saved in these registers though&n; */
DECL|struct|radeon_regs
r_struct
id|radeon_regs
(brace
multiline_comment|/* Common registers */
DECL|member|ovr_clr
id|u32
id|ovr_clr
suffix:semicolon
DECL|member|ovr_wid_left_right
id|u32
id|ovr_wid_left_right
suffix:semicolon
DECL|member|ovr_wid_top_bottom
id|u32
id|ovr_wid_top_bottom
suffix:semicolon
DECL|member|ov0_scale_cntl
id|u32
id|ov0_scale_cntl
suffix:semicolon
DECL|member|mpp_tb_config
id|u32
id|mpp_tb_config
suffix:semicolon
DECL|member|mpp_gp_config
id|u32
id|mpp_gp_config
suffix:semicolon
DECL|member|subpic_cntl
id|u32
id|subpic_cntl
suffix:semicolon
DECL|member|viph_control
id|u32
id|viph_control
suffix:semicolon
DECL|member|i2c_cntl_1
id|u32
id|i2c_cntl_1
suffix:semicolon
DECL|member|gen_int_cntl
id|u32
id|gen_int_cntl
suffix:semicolon
DECL|member|cap0_trig_cntl
id|u32
id|cap0_trig_cntl
suffix:semicolon
DECL|member|cap1_trig_cntl
id|u32
id|cap1_trig_cntl
suffix:semicolon
DECL|member|bus_cntl
id|u32
id|bus_cntl
suffix:semicolon
DECL|member|surface_cntl
id|u32
id|surface_cntl
suffix:semicolon
DECL|member|bios_5_scratch
id|u32
id|bios_5_scratch
suffix:semicolon
multiline_comment|/* Other registers to save for VT switches or driver load/unload */
DECL|member|dp_datatype
id|u32
id|dp_datatype
suffix:semicolon
DECL|member|rbbm_soft_reset
id|u32
id|rbbm_soft_reset
suffix:semicolon
DECL|member|clock_cntl_index
id|u32
id|clock_cntl_index
suffix:semicolon
DECL|member|amcgpio_en_reg
id|u32
id|amcgpio_en_reg
suffix:semicolon
DECL|member|amcgpio_mask
id|u32
id|amcgpio_mask
suffix:semicolon
multiline_comment|/* Surface/tiling registers */
DECL|member|surf_lower_bound
id|u32
id|surf_lower_bound
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|surf_upper_bound
id|u32
id|surf_upper_bound
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|surf_info
id|u32
id|surf_info
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* CRTC registers */
DECL|member|crtc_gen_cntl
id|u32
id|crtc_gen_cntl
suffix:semicolon
DECL|member|crtc_ext_cntl
id|u32
id|crtc_ext_cntl
suffix:semicolon
DECL|member|dac_cntl
id|u32
id|dac_cntl
suffix:semicolon
DECL|member|crtc_h_total_disp
id|u32
id|crtc_h_total_disp
suffix:semicolon
DECL|member|crtc_h_sync_strt_wid
id|u32
id|crtc_h_sync_strt_wid
suffix:semicolon
DECL|member|crtc_v_total_disp
id|u32
id|crtc_v_total_disp
suffix:semicolon
DECL|member|crtc_v_sync_strt_wid
id|u32
id|crtc_v_sync_strt_wid
suffix:semicolon
DECL|member|crtc_offset
id|u32
id|crtc_offset
suffix:semicolon
DECL|member|crtc_offset_cntl
id|u32
id|crtc_offset_cntl
suffix:semicolon
DECL|member|crtc_pitch
id|u32
id|crtc_pitch
suffix:semicolon
DECL|member|disp_merge_cntl
id|u32
id|disp_merge_cntl
suffix:semicolon
DECL|member|grph_buffer_cntl
id|u32
id|grph_buffer_cntl
suffix:semicolon
DECL|member|crtc_more_cntl
id|u32
id|crtc_more_cntl
suffix:semicolon
multiline_comment|/* CRTC2 registers */
DECL|member|crtc2_gen_cntl
id|u32
id|crtc2_gen_cntl
suffix:semicolon
DECL|member|dac2_cntl
id|u32
id|dac2_cntl
suffix:semicolon
DECL|member|disp_output_cntl
id|u32
id|disp_output_cntl
suffix:semicolon
DECL|member|disp_hw_debug
id|u32
id|disp_hw_debug
suffix:semicolon
DECL|member|disp2_merge_cntl
id|u32
id|disp2_merge_cntl
suffix:semicolon
DECL|member|grph2_buffer_cntl
id|u32
id|grph2_buffer_cntl
suffix:semicolon
DECL|member|crtc2_h_total_disp
id|u32
id|crtc2_h_total_disp
suffix:semicolon
DECL|member|crtc2_h_sync_strt_wid
id|u32
id|crtc2_h_sync_strt_wid
suffix:semicolon
DECL|member|crtc2_v_total_disp
id|u32
id|crtc2_v_total_disp
suffix:semicolon
DECL|member|crtc2_v_sync_strt_wid
id|u32
id|crtc2_v_sync_strt_wid
suffix:semicolon
DECL|member|crtc2_offset
id|u32
id|crtc2_offset
suffix:semicolon
DECL|member|crtc2_offset_cntl
id|u32
id|crtc2_offset_cntl
suffix:semicolon
DECL|member|crtc2_pitch
id|u32
id|crtc2_pitch
suffix:semicolon
multiline_comment|/* Flat panel regs */
DECL|member|fp_crtc_h_total_disp
id|u32
id|fp_crtc_h_total_disp
suffix:semicolon
DECL|member|fp_crtc_v_total_disp
id|u32
id|fp_crtc_v_total_disp
suffix:semicolon
DECL|member|fp_gen_cntl
id|u32
id|fp_gen_cntl
suffix:semicolon
DECL|member|fp2_gen_cntl
id|u32
id|fp2_gen_cntl
suffix:semicolon
DECL|member|fp_h_sync_strt_wid
id|u32
id|fp_h_sync_strt_wid
suffix:semicolon
DECL|member|fp2_h_sync_strt_wid
id|u32
id|fp2_h_sync_strt_wid
suffix:semicolon
DECL|member|fp_horz_stretch
id|u32
id|fp_horz_stretch
suffix:semicolon
DECL|member|fp_panel_cntl
id|u32
id|fp_panel_cntl
suffix:semicolon
DECL|member|fp_v_sync_strt_wid
id|u32
id|fp_v_sync_strt_wid
suffix:semicolon
DECL|member|fp2_v_sync_strt_wid
id|u32
id|fp2_v_sync_strt_wid
suffix:semicolon
DECL|member|fp_vert_stretch
id|u32
id|fp_vert_stretch
suffix:semicolon
DECL|member|lvds_gen_cntl
id|u32
id|lvds_gen_cntl
suffix:semicolon
DECL|member|lvds_pll_cntl
id|u32
id|lvds_pll_cntl
suffix:semicolon
DECL|member|tmds_crc
id|u32
id|tmds_crc
suffix:semicolon
DECL|member|tmds_transmitter_cntl
id|u32
id|tmds_transmitter_cntl
suffix:semicolon
multiline_comment|/* Computed values for PLL */
DECL|member|dot_clock_freq
id|u32
id|dot_clock_freq
suffix:semicolon
DECL|member|feedback_div
r_int
id|feedback_div
suffix:semicolon
DECL|member|post_div
r_int
id|post_div
suffix:semicolon
multiline_comment|/* PLL registers */
DECL|member|ppll_div_3
id|u32
id|ppll_div_3
suffix:semicolon
DECL|member|ppll_ref_div
id|u32
id|ppll_ref_div
suffix:semicolon
DECL|member|vclk_ecp_cntl
id|u32
id|vclk_ecp_cntl
suffix:semicolon
multiline_comment|/* Computed values for PLL2 */
DECL|member|dot_clock_freq_2
id|u32
id|dot_clock_freq_2
suffix:semicolon
DECL|member|feedback_div_2
r_int
id|feedback_div_2
suffix:semicolon
DECL|member|post_div_2
r_int
id|post_div_2
suffix:semicolon
multiline_comment|/* PLL2 registers */
DECL|member|p2pll_ref_div
id|u32
id|p2pll_ref_div
suffix:semicolon
DECL|member|p2pll_div_0
id|u32
id|p2pll_div_0
suffix:semicolon
DECL|member|htotal_cntl2
id|u32
id|htotal_cntl2
suffix:semicolon
multiline_comment|/* Palette */
DECL|member|palette_valid
r_int
id|palette_valid
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|panel_info
r_struct
id|panel_info
(brace
DECL|member|xres
DECL|member|yres
r_int
id|xres
comma
id|yres
suffix:semicolon
DECL|member|valid
r_int
id|valid
suffix:semicolon
DECL|member|clock
r_int
id|clock
suffix:semicolon
DECL|member|hOver_plus
DECL|member|hSync_width
DECL|member|hblank
r_int
id|hOver_plus
comma
id|hSync_width
comma
id|hblank
suffix:semicolon
DECL|member|vOver_plus
DECL|member|vSync_width
DECL|member|vblank
r_int
id|vOver_plus
comma
id|vSync_width
comma
id|vblank
suffix:semicolon
DECL|member|hAct_high
DECL|member|vAct_high
DECL|member|interlaced
r_int
id|hAct_high
comma
id|vAct_high
comma
id|interlaced
suffix:semicolon
DECL|member|pwr_delay
r_int
id|pwr_delay
suffix:semicolon
DECL|member|use_bios_dividers
r_int
id|use_bios_dividers
suffix:semicolon
DECL|member|ref_divider
r_int
id|ref_divider
suffix:semicolon
DECL|member|post_divider
r_int
id|post_divider
suffix:semicolon
DECL|member|fbk_divider
r_int
id|fbk_divider
suffix:semicolon
)brace
suffix:semicolon
r_struct
id|radeonfb_info
suffix:semicolon
macro_line|#ifdef CONFIG_FB_RADEON_I2C
DECL|struct|radeon_i2c_chan
r_struct
id|radeon_i2c_chan
(brace
DECL|member|rinfo
r_struct
id|radeonfb_info
op_star
id|rinfo
suffix:semicolon
DECL|member|ddc_reg
id|u32
id|ddc_reg
suffix:semicolon
DECL|member|adapter
r_struct
id|i2c_adapter
id|adapter
suffix:semicolon
DECL|member|algo
r_struct
id|i2c_algo_bit_data
id|algo
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
DECL|struct|radeonfb_info
r_struct
id|radeonfb_info
(brace
DECL|member|info
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
DECL|member|state
r_struct
id|radeon_regs
id|state
suffix:semicolon
DECL|member|init_state
r_struct
id|radeon_regs
id|init_state
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
id|DEVICE_NAME_SIZE
)braket
suffix:semicolon
DECL|member|ram_type
r_char
id|ram_type
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|mmio_base_phys
r_int
r_int
id|mmio_base_phys
suffix:semicolon
DECL|member|fb_base_phys
r_int
r_int
id|fb_base_phys
suffix:semicolon
DECL|member|mmio_base
r_int
r_int
id|mmio_base
suffix:semicolon
DECL|member|fb_base
r_int
r_int
id|fb_base
suffix:semicolon
DECL|member|fb_local_base
r_int
r_int
id|fb_local_base
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|bios_seg
id|u8
op_star
id|bios_seg
suffix:semicolon
DECL|member|fp_bios_start
r_int
id|fp_bios_start
suffix:semicolon
DECL|member|pseudo_palette
id|u32
id|pseudo_palette
(braket
l_int|17
)braket
suffix:semicolon
DECL|member|red
DECL|member|green
DECL|member|blue
DECL|member|pad
r_struct
(brace
id|u8
id|red
comma
id|green
comma
id|blue
comma
id|pad
suffix:semicolon
)brace
DECL|member|palette
id|palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|chipset
r_int
id|chipset
suffix:semicolon
DECL|member|family
id|u8
id|family
suffix:semicolon
DECL|member|rev
id|u8
id|rev
suffix:semicolon
DECL|member|video_ram
r_int
r_int
id|video_ram
suffix:semicolon
DECL|member|mapped_vram
r_int
r_int
id|mapped_vram
suffix:semicolon
DECL|member|pitch
DECL|member|bpp
DECL|member|depth
r_int
id|pitch
comma
id|bpp
comma
id|depth
suffix:semicolon
DECL|member|has_CRTC2
r_int
id|has_CRTC2
suffix:semicolon
DECL|member|is_mobility
r_int
id|is_mobility
suffix:semicolon
DECL|member|is_IGP
r_int
id|is_IGP
suffix:semicolon
DECL|member|R300_cg_workaround
r_int
id|R300_cg_workaround
suffix:semicolon
DECL|member|reversed_DAC
r_int
id|reversed_DAC
suffix:semicolon
DECL|member|reversed_TMDS
r_int
id|reversed_TMDS
suffix:semicolon
DECL|member|panel_info
r_struct
id|panel_info
id|panel_info
suffix:semicolon
DECL|member|mon1_type
r_int
id|mon1_type
suffix:semicolon
DECL|member|mon1_EDID
id|u8
op_star
id|mon1_EDID
suffix:semicolon
DECL|member|mon1_modedb
r_struct
id|fb_videomode
op_star
id|mon1_modedb
suffix:semicolon
DECL|member|mon1_dbsize
r_int
id|mon1_dbsize
suffix:semicolon
DECL|member|mon2_type
r_int
id|mon2_type
suffix:semicolon
DECL|member|mon2_EDID
id|u8
op_star
id|mon2_EDID
suffix:semicolon
DECL|member|dp_gui_master_cntl
id|u32
id|dp_gui_master_cntl
suffix:semicolon
DECL|member|pll
r_struct
id|pll_info
id|pll
suffix:semicolon
DECL|member|ram
r_struct
id|ram_info
id|ram
suffix:semicolon
DECL|member|mtrr_hdl
r_int
id|mtrr_hdl
suffix:semicolon
DECL|member|pm_reg
r_int
id|pm_reg
suffix:semicolon
DECL|member|save_regs
id|u32
id|save_regs
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|asleep
r_int
id|asleep
suffix:semicolon
DECL|member|lock_blank
r_int
id|lock_blank
suffix:semicolon
multiline_comment|/* Lock on register access */
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
multiline_comment|/* Timer used for delayed LVDS operations */
DECL|member|lvds_timer
r_struct
id|timer_list
id|lvds_timer
suffix:semicolon
DECL|member|pending_lvds_gen_cntl
id|u32
id|pending_lvds_gen_cntl
suffix:semicolon
DECL|member|pending_pixclks_cntl
id|u32
id|pending_pixclks_cntl
suffix:semicolon
macro_line|#ifdef CONFIG_FB_RADEON_I2C
DECL|member|i2c
r_struct
id|radeon_i2c_chan
id|i2c
(braket
l_int|4
)braket
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|PRIMARY_MONITOR
mdefine_line|#define PRIMARY_MONITOR(rinfo)&t;(rinfo-&gt;mon1_type)
multiline_comment|/*&n; * Debugging stuffs&n; */
macro_line|#ifdef CONFIG_FB_RADEON_DEBUG
DECL|macro|DEBUG
mdefine_line|#define DEBUG&t;&t;1
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG&t;&t;0
macro_line|#endif
macro_line|#if DEBUG
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;printk
macro_line|#else
DECL|macro|RTRACE
mdefine_line|#define RTRACE&t;&t;if(0) printk
macro_line|#endif
multiline_comment|/*&n; * IO macros&n; */
DECL|macro|INREG8
mdefine_line|#define INREG8(addr)&t;&t;readb((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG8
mdefine_line|#define OUTREG8(addr,val)&t;writeb(val, (rinfo-&gt;mmio_base)+addr)
DECL|macro|INREG
mdefine_line|#define INREG(addr)&t;&t;readl((rinfo-&gt;mmio_base)+addr)
DECL|macro|OUTREG
mdefine_line|#define OUTREG(addr,val)&t;writel(val, (rinfo-&gt;mmio_base)+addr)
DECL|function|R300_cg_workardound
r_static
r_inline
r_void
id|R300_cg_workardound
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|save
comma
id|tmp
suffix:semicolon
id|save
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
suffix:semicolon
id|tmp
op_assign
id|save
op_amp
op_complement
(paren
l_int|0x3f
op_or
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_DATA
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|save
)paren
suffix:semicolon
)brace
DECL|macro|__OUTPLL
mdefine_line|#define __OUTPLL(addr,val)&t;&bslash;&n;&t;do {&t;&bslash;&n;&t;&t;OUTREG8(CLOCK_CNTL_INDEX, (addr &amp; 0x0000003f) | 0x00000080); &bslash;&n;&t;&t;OUTREG(CLOCK_CNTL_DATA, val); &bslash;&n;} while(0)
DECL|function|__INPLL
r_static
r_inline
id|u32
id|__INPLL
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|addr
)paren
(brace
id|u32
id|data
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|addr
op_amp
l_int|0x0000003f
)paren
suffix:semicolon
id|data
op_assign
(paren
id|INREG
c_func
(paren
id|CLOCK_CNTL_DATA
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;R300_cg_workaround
)paren
id|R300_cg_workardound
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|_INPLL
r_static
r_inline
id|u32
id|_INPLL
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|data
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|rinfo-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|data
op_assign
id|__INPLL
c_func
(paren
id|rinfo
comma
id|addr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|rinfo-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|macro|INPLL
mdefine_line|#define INPLL(addr)&t;&t;_INPLL(rinfo, addr)
DECL|macro|OUTPLL
mdefine_line|#define OUTPLL(addr,val)&t;&bslash;&n;&t;do {&t;&bslash;&n;&t;&t;unsigned long flags;&bslash;&n;&t;&t;spin_lock_irqsave(&amp;rinfo-&gt;reg_lock, flags); &bslash;&n;&t;&t;__OUTPLL(addr, val); &bslash;&n;&t;&t;spin_unlock_irqrestore(&amp;rinfo-&gt;reg_lock, flags); &bslash;&n;&t;} while(0)
DECL|macro|OUTPLLP
mdefine_line|#define OUTPLLP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned long flags;                                    &bslash;&n;&t;&t;unsigned int _tmp;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_lock_irqsave(&amp;rinfo-&gt;reg_lock, flags); &t;&t;&bslash;&n;&t;&t;_tmp  = __INPLL(rinfo,addr);&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;__OUTPLL(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_unlock_irqrestore(&amp;rinfo-&gt;reg_lock, flags); &t;&bslash;&n;&t;} while (0)
DECL|macro|OUTREGP
mdefine_line|#define OUTREGP(addr,val,mask)  &t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned long flags;                                    &bslash;&n;&t;&t;unsigned int _tmp;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_lock_irqsave(&amp;rinfo-&gt;reg_lock, flags); &t;&t;&bslash;&n;&t;&t;_tmp = INREG(addr);&t;&t;&t;&t;       &t;&bslash;&n;&t;&t;_tmp &amp;= (mask);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;_tmp |= (val);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;OUTREG(addr, _tmp);&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_unlock_irqrestore(&amp;rinfo-&gt;reg_lock, flags); &t;&bslash;&n;&t;} while (0)
DECL|macro|MS_TO_HZ
mdefine_line|#define MS_TO_HZ(ms)       ((ms * HZ + 999) / 1000)
DECL|macro|BIOS_IN8
mdefine_line|#define BIOS_IN8(v)  &t;(readb(rinfo-&gt;bios_seg + (v)))
DECL|macro|BIOS_IN16
mdefine_line|#define BIOS_IN16(v) &t;(readb(rinfo-&gt;bios_seg + (v)) | &bslash;&n;&t;&t;&t;  (readb(rinfo-&gt;bios_seg + (v) + 1) &lt;&lt; 8))
DECL|macro|BIOS_IN32
mdefine_line|#define BIOS_IN32(v) &t;(readb(rinfo-&gt;bios_seg + (v)) | &bslash;&n;&t;&t;&t;  (readb(rinfo-&gt;bios_seg + (v) + 1) &lt;&lt; 8) | &bslash;&n;&t;&t;&t;  (readb(rinfo-&gt;bios_seg + (v) + 2) &lt;&lt; 16) | &bslash;&n;&t;&t;&t;  (readb(rinfo-&gt;bios_seg + (v) + 3) &lt;&lt; 24))
multiline_comment|/*&n; * Inline utilities&n; */
DECL|function|wait_ms
r_static
r_inline
r_void
id|wait_ms
c_func
(paren
r_int
r_int
id|ms
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|ms
op_star
id|HZ
op_plus
l_int|999
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
DECL|function|round_div
r_static
r_inline
r_int
id|round_div
c_func
(paren
r_int
id|num
comma
r_int
id|den
)paren
(brace
r_return
(paren
id|num
op_plus
(paren
id|den
op_div
l_int|2
)paren
)paren
op_div
id|den
suffix:semicolon
)brace
DECL|function|var_to_depth
r_static
r_inline
r_int
id|var_to_depth
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_ne
l_int|16
)paren
r_return
id|var-&gt;bits_per_pixel
suffix:semicolon
r_return
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
ques
c_cond
l_int|15
suffix:colon
l_int|16
suffix:semicolon
)brace
DECL|function|radeon_get_dstbpp
r_static
r_inline
id|u32
id|radeon_get_dstbpp
c_func
(paren
id|u16
id|depth
)paren
(brace
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
id|DST_8BPP
suffix:semicolon
r_case
l_int|15
suffix:colon
r_return
id|DST_15BPP
suffix:semicolon
r_case
l_int|16
suffix:colon
r_return
id|DST_16BPP
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
id|DST_32BPP
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * 2D Engine helper routines&n; */
DECL|function|radeon_engine_flush
r_static
r_inline
r_void
id|radeon_engine_flush
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* initiate flush */
id|OUTREGP
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
comma
id|RB2D_DC_FLUSH_ALL
comma
op_complement
id|RB2D_DC_FLUSH_ALL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|INREG
c_func
(paren
id|RB2D_DSTCACHE_CTLSTAT
)paren
op_amp
id|RB2D_DC_BUSY
)paren
)paren
r_return
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb: Flush Timeout !&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|_radeon_fifo_wait
r_static
r_inline
r_void
id|_radeon_fifo_wait
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|entries
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
l_int|0x7f
)paren
op_ge
id|entries
)paren
r_return
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb: FIFO Timeout !&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|_radeon_engine_idle
r_static
r_inline
r_void
id|_radeon_engine_idle
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* ensure FIFO is empty before waiting for idle */
id|_radeon_fifo_wait
(paren
id|rinfo
comma
l_int|64
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
op_amp
id|GUI_ACTIVE
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|radeon_engine_flush
(paren
id|rinfo
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb: Idle Timeout !&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|radeon_accel_disabled
r_static
r_inline
r_int
id|radeon_accel_disabled
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
id|radeonfb_noaccel
suffix:semicolon
r_return
id|radeonfb_noaccel
suffix:semicolon
)brace
DECL|macro|radeon_engine_idle
mdefine_line|#define radeon_engine_idle()&t;&t;_radeon_engine_idle(rinfo)
DECL|macro|radeon_fifo_wait
mdefine_line|#define radeon_fifo_wait(entries)&t;_radeon_fifo_wait(rinfo,entries)
multiline_comment|/* I2C Functions */
r_extern
r_void
id|radeon_create_i2c_busses
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_void
id|radeon_delete_i2c_busses
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_int
id|radeon_probe_i2c_connector
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|conn
comma
id|u8
op_star
op_star
id|out_edid
)paren
suffix:semicolon
multiline_comment|/* PM Functions */
r_extern
r_void
id|radeon_pm_disable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_void
id|radeon_pm_enable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_int
id|radeonfb_pci_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
suffix:semicolon
r_extern
r_int
id|radeonfb_pci_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
suffix:semicolon
multiline_comment|/* Monitor probe functions */
r_extern
r_void
id|radeon_probe_screens
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_const
r_char
op_star
id|monitor_layout
comma
r_int
id|ignore_edid
)paren
suffix:semicolon
r_extern
r_void
id|radeon_check_modes
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_const
r_char
op_star
id|mode_option
)paren
suffix:semicolon
r_extern
r_int
id|radeon_match_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|dest
comma
r_const
r_struct
id|fb_var_screeninfo
op_star
id|src
)paren
suffix:semicolon
multiline_comment|/* Accel functions */
r_extern
r_void
id|radeonfb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|region
)paren
suffix:semicolon
r_extern
r_void
id|radeonfb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
suffix:semicolon
r_extern
r_void
id|radeonfb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|p
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
suffix:semicolon
r_extern
r_int
id|radeonfb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_extern
r_void
id|radeonfb_engine_init
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_void
id|radeonfb_engine_reset
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Other functions */
r_extern
r_int
id|radeonfb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_extern
r_int
id|radeonfb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
macro_line|#endif /* __RADEONFB_H__ */
eof
