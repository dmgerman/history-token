macro_line|#include &quot;radeonfb.h&quot;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
multiline_comment|/*&n; * Currently, only PowerMac do D2 state&n; */
DECL|macro|CONFIG_RADEON_HAS_D2
mdefine_line|#define CONFIG_RADEON_HAS_D2&t;CONFIG_PPC_PMAC
macro_line|#ifdef CONFIG_RADEON_HAS_D2
multiline_comment|/*&n; * On PowerMac, we assume any mobility chip based machine does D2&n; */
macro_line|#ifdef CONFIG_PPC_PMAC
DECL|function|radeon_suspend_to_d2
r_static
r_inline
r_int
id|radeon_suspend_to_d2
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|state
)paren
(brace
r_return
id|rinfo-&gt;is_mobility
suffix:semicolon
)brace
macro_line|#else
DECL|function|radeon_suspend_to_d2
r_static
r_inline
r_int
id|radeon_suspend_to_d2
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u32
id|state
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif /* CONFIG_RADEON_HAS_D2 */
multiline_comment|/*&n; * Radeon M6, M7 and M9 Power Management code. This code currently&n; * only supports the mobile chips in D2 mode, that is typically what&n; * is used on Apple laptops, it&squot;s based from some informations provided&n; * by ATI along with hours of tracing of MacOS drivers.&n; * &n; * New version of this code almost totally rewritten by ATI, many thanks&n; * for their support.&n; */
DECL|function|radeon_pm_disable_dynamic_mode
r_void
id|radeon_pm_disable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|sclk_cntl
suffix:semicolon
id|u32
id|mclk_cntl
suffix:semicolon
id|u32
id|sclk_more_cntl
suffix:semicolon
id|u32
id|vclk_ecp_cntl
suffix:semicolon
id|u32
id|pixclks_cntl
suffix:semicolon
multiline_comment|/* Mobility chips only, untested on M9+/M10/11 */
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;is_mobility
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
OG
id|CHIP_FAMILY_RV250
)paren
r_return
suffix:semicolon
multiline_comment|/* Force Core Clocks */
id|sclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL_M6
)paren
suffix:semicolon
id|sclk_cntl
op_or_assign
id|SCLK_CNTL_M6__FORCE_CP
op_or
id|SCLK_CNTL_M6__FORCE_HDP
op_or
id|SCLK_CNTL_M6__FORCE_DISP1
op_or
id|SCLK_CNTL_M6__FORCE_DISP2
op_or
id|SCLK_CNTL_M6__FORCE_TOP
op_or
id|SCLK_CNTL_M6__FORCE_E2
op_or
id|SCLK_CNTL_M6__FORCE_SE
op_or
id|SCLK_CNTL_M6__FORCE_IDCT
op_or
id|SCLK_CNTL_M6__FORCE_VIP
op_or
id|SCLK_CNTL_M6__FORCE_RE
op_or
id|SCLK_CNTL_M6__FORCE_PB
op_or
id|SCLK_CNTL_M6__FORCE_TAM
op_or
id|SCLK_CNTL_M6__FORCE_TDM
op_or
id|SCLK_CNTL_M6__FORCE_RB
op_or
id|SCLK_CNTL_M6__FORCE_TV_SCLK
op_or
id|SCLK_CNTL_M6__FORCE_SUBPIC
op_or
id|SCLK_CNTL_M6__FORCE_OV0
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL_M6
comma
id|sclk_cntl
)paren
suffix:semicolon
id|sclk_more_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|sclk_more_cntl
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|sclk_more_cntl
)paren
suffix:semicolon
multiline_comment|/* Force Display clocks&t;*/
id|vclk_ecp_cntl
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_and_assign
op_complement
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|vclk_ecp_cntl
)paren
suffix:semicolon
id|pixclks_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|pixclks_cntl
op_and_assign
op_complement
(paren
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|pixclks_cntl
)paren
suffix:semicolon
multiline_comment|/* Force Memory Clocks */
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL_M6
)paren
suffix:semicolon
id|mclk_cntl
op_and_assign
op_complement
(paren
id|MCLK_CNTL_M6__FORCE_MCLKA
op_or
id|MCLK_CNTL_M6__FORCE_MCLKB
op_or
id|MCLK_CNTL_M6__FORCE_YCLKA
op_or
id|MCLK_CNTL_M6__FORCE_YCLKB
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL_M6
comma
id|mclk_cntl
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_enable_dynamic_mode
r_void
id|radeon_pm_enable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|clk_pwrmgt_cntl
suffix:semicolon
id|u32
id|sclk_cntl
suffix:semicolon
id|u32
id|sclk_more_cntl
suffix:semicolon
id|u32
id|clk_pin_cntl
suffix:semicolon
id|u32
id|pixclks_cntl
suffix:semicolon
id|u32
id|vclk_ecp_cntl
suffix:semicolon
id|u32
id|mclk_cntl
suffix:semicolon
id|u32
id|mclk_misc
suffix:semicolon
multiline_comment|/* Mobility chips only, untested on M9+/M10/11 */
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;is_mobility
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
OG
id|CHIP_FAMILY_RV250
)paren
r_return
suffix:semicolon
multiline_comment|/* Set Latencies */
id|clk_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_and_assign
op_complement
(paren
id|CLK_PWRMGT_CNTL_M6__ENGINE_DYNCLK_MODE_MASK
op_or
id|CLK_PWRMGT_CNTL_M6__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL_M6__DISP_DYN_STOP_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL_M6__DYN_STOP_MODE_MASK
)paren
suffix:semicolon
multiline_comment|/* Mode 1 */
id|clk_pwrmgt_cntl
op_assign
id|CLK_PWRMGT_CNTL_M6__MC_CH_MODE
op_or
id|CLK_PWRMGT_CNTL_M6__ENGINE_DYNCLK_MODE
op_or
(paren
l_int|1
op_lshift
id|CLK_PWRMGT_CNTL_M6__ACTIVE_HILO_LAT__SHIFT
)paren
op_or
(paren
l_int|0
op_lshift
id|CLK_PWRMGT_CNTL_M6__DISP_DYN_STOP_LAT__SHIFT
)paren
op_or
(paren
l_int|0
op_lshift
id|CLK_PWRMGT_CNTL_M6__DYN_STOP_MODE__SHIFT
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
comma
id|clk_pwrmgt_cntl
)paren
suffix:semicolon
id|clk_pin_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|clk_pin_cntl
op_or_assign
id|CLK_PIN_CNTL__SCLK_DYN_START_CNTL
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|clk_pin_cntl
)paren
suffix:semicolon
multiline_comment|/* Enable Dyanmic mode for SCLK */
id|sclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL_M6
)paren
suffix:semicolon
id|sclk_cntl
op_and_assign
id|SCLK_CNTL_M6__SCLK_SRC_SEL_MASK
suffix:semicolon
id|sclk_cntl
op_or_assign
id|SCLK_CNTL_M6__FORCE_VIP
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL_M6
comma
id|sclk_cntl
)paren
suffix:semicolon
id|sclk_more_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|sclk_more_cntl
op_and_assign
op_complement
(paren
id|SCLK_MORE_CNTL__FORCE_DISPREGS
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|sclk_more_cntl
)paren
suffix:semicolon
multiline_comment|/* Enable Dynamic mode for PIXCLK &amp; PIX2CLK */
id|pixclks_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|pixclks_cntl
op_or_assign
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|pixclks_cntl
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_or_assign
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|vclk_ecp_cntl
)paren
suffix:semicolon
multiline_comment|/* Enable Dynamic mode for MCLK&t;*/
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL_M6
)paren
suffix:semicolon
id|mclk_cntl
op_or_assign
id|MCLK_CNTL_M6__FORCE_MCLKA
op_or
id|MCLK_CNTL_M6__FORCE_MCLKB
op_or
id|MCLK_CNTL_M6__FORCE_YCLKA
op_or
id|MCLK_CNTL_M6__FORCE_YCLKB
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL_M6
comma
id|mclk_cntl
)paren
suffix:semicolon
id|mclk_misc
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
suffix:semicolon
id|mclk_misc
op_or_assign
id|MCLK_MISC__MC_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__IO_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__MC_MCLK_DYN_ENABLE
op_or
id|MCLK_MISC__IO_MCLK_DYN_ENABLE
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|mclk_misc
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|OUTMC
r_static
r_void
id|OUTMC
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u8
id|indx
comma
id|u32
id|value
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
id|indx
op_or
id|MC_IND_INDEX__MC_IND_WR_EN
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_DATA
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|INMC
r_static
id|u32
id|INMC
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u8
id|indx
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
id|indx
)paren
suffix:semicolon
r_return
id|INREG
c_func
(paren
id|MC_IND_DATA
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_save_regs
r_static
r_void
id|radeon_pm_save_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
op_assign
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PIN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
op_assign
id|INPLL
c_func
(paren
id|PIXCLKS_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_MISC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_assign
id|INPLL
c_func
(paren
id|P2PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
op_assign
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_VGA_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_DVI_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_MONID
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_CRT2_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
op_assign
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
op_assign
id|INREG
c_func
(paren
id|MC_FB_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
op_assign
id|INREG
c_func
(paren
id|DISPLAY_BASE_ADDR
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
op_assign
id|INREG
c_func
(paren
id|MC_AGP_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_restore_regs
r_static
r_void
id|radeon_pm_restore_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_amp
l_int|0xFFFFFFFE
)paren
suffix:semicolon
multiline_comment|/* First */
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PIXCLKS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_MISC
comma
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
)paren
suffix:semicolon
singleline_comment|// wait VBL before that one  ?
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_disable_iopad
r_static
r_void
id|radeon_pm_disable_iopad
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
l_int|0x0001ffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
l_int|0x00000400
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_program_v2clk
r_static
r_void
id|radeon_pm_program_v2clk
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
multiline_comment|/* we use __INPLL and _OUTPLL and do the locking ourselves... */
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|rinfo-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Set v2clk to 65MHz */
id|__OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|__INPLL
c_func
(paren
id|rinfo
comma
id|pllPIXCLKS_CNTL
)paren
op_amp
op_complement
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL_MASK
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllP2PLL_REF_DIV
comma
l_int|0x0000000c
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
l_int|0x0000bf00
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllP2PLL_DIV_0
comma
l_int|0x00020074
op_or
id|P2PLL_DIV_0__P2PLL_ATOMIC_UPDATE_W
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|__INPLL
c_func
(paren
id|rinfo
comma
id|pllP2PLL_CNTL
)paren
op_amp
op_complement
id|P2PLL_CNTL__P2PLL_SLEEP
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|__INPLL
c_func
(paren
id|rinfo
comma
id|pllP2PLL_CNTL
)paren
op_amp
op_complement
id|P2PLL_CNTL__P2PLL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|__OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
(paren
id|__INPLL
c_func
(paren
id|rinfo
comma
id|pllPIXCLKS_CNTL
)paren
op_amp
op_complement
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL_MASK
)paren
op_or
(paren
l_int|0x03
op_lshift
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL__SHIFT
)paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|rinfo-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_low_current
r_static
r_void
id|radeon_pm_low_current
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|reg
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_MASK
suffix:semicolon
id|reg
op_or_assign
id|BUS_CNTL1_AGPCLK_VALID
op_or
(paren
l_int|1
op_lshift
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|reg
op_or_assign
id|PLL_PWRMGT_CNTL_SPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_PPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_P2PLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_TVPLL_TURNOFF
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_SU_MCLK_USE_BCLK
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_MOBILE_SU
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TV_DAC_CNTL_BGADJ_MASK
op_or
id|TV_DAC_CNTL_DACADJ_MASK
)paren
suffix:semicolon
id|reg
op_or_assign
id|TV_DAC_CNTL_BGSLEEP
op_or
id|TV_DAC_CNTL_RDACPD
op_or
id|TV_DAC_CNTL_GDACPD
op_or
id|TV_DAC_CNTL_BDACPD
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_BGADJ__SHIFT
)paren
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_DACADJ__SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TMDS_PLL_EN
op_or
id|TMDS_PLLRST
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC2_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|TV_DAC_CNTL_DETECT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_setup_for_suspend
r_static
r_void
id|radeon_pm_setup_for_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|sclk_cntl
comma
id|mclk_cntl
comma
id|sclk_more_cntl
suffix:semicolon
id|u32
id|pll_pwrmgt_cntl
suffix:semicolon
id|u32
id|clk_pwrmgt_cntl
suffix:semicolon
id|u32
id|clk_pin_cntl
suffix:semicolon
id|u32
id|vclk_ecp_cntl
suffix:semicolon
id|u32
id|pixclks_cntl
suffix:semicolon
id|u32
id|disp_mis_cntl
suffix:semicolon
id|u32
id|disp_pwr_man
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Force Core Clocks */
id|sclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL_M6
)paren
suffix:semicolon
id|sclk_cntl
op_or_assign
id|SCLK_CNTL_M6__IDCT_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__VIP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__RE_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__PB_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__TAM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__TDM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__RB_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL_M6__FORCE_DISP2
op_or
id|SCLK_CNTL_M6__FORCE_CP
op_or
id|SCLK_CNTL_M6__FORCE_HDP
op_or
id|SCLK_CNTL_M6__FORCE_DISP1
op_or
id|SCLK_CNTL_M6__FORCE_TOP
op_or
id|SCLK_CNTL_M6__FORCE_E2
op_or
id|SCLK_CNTL_M6__FORCE_SE
op_or
id|SCLK_CNTL_M6__FORCE_IDCT
op_or
id|SCLK_CNTL_M6__FORCE_VIP
op_or
id|SCLK_CNTL_M6__FORCE_RE
op_or
id|SCLK_CNTL_M6__FORCE_PB
op_or
id|SCLK_CNTL_M6__FORCE_TAM
op_or
id|SCLK_CNTL_M6__FORCE_TDM
op_or
id|SCLK_CNTL_M6__FORCE_RB
op_or
id|SCLK_CNTL_M6__FORCE_TV_SCLK
op_or
id|SCLK_CNTL_M6__FORCE_SUBPIC
op_or
id|SCLK_CNTL_M6__FORCE_OV0
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL_M6
comma
id|sclk_cntl
)paren
suffix:semicolon
id|sclk_more_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|sclk_more_cntl
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|sclk_more_cntl
)paren
suffix:semicolon
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL_M6
)paren
suffix:semicolon
id|mclk_cntl
op_and_assign
op_complement
(paren
id|MCLK_CNTL_M6__FORCE_MCLKA
op_or
id|MCLK_CNTL_M6__FORCE_MCLKB
op_or
id|MCLK_CNTL_M6__FORCE_YCLKA
op_or
id|MCLK_CNTL_M6__FORCE_YCLKB
op_or
id|MCLK_CNTL_M6__FORCE_MC
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL_M6
comma
id|mclk_cntl
)paren
suffix:semicolon
multiline_comment|/* Force Display clocks&t;*/
id|vclk_ecp_cntl
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_and_assign
op_complement
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_or_assign
id|VCLK_ECP_CNTL__ECP_FORCE_ON
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|vclk_ecp_cntl
)paren
suffix:semicolon
id|pixclks_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|pixclks_cntl
op_and_assign
op_complement
(paren
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|pixclks_cntl
)paren
suffix:semicolon
multiline_comment|/* Switch off LVDS interface */
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_amp
op_complement
(paren
id|LVDS_BLON
op_or
id|LVDS_EN
op_or
id|LVDS_ON
op_or
id|LVDS_DIGON
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable System power management */
id|pll_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|pll_pwrmgt_cntl
op_or_assign
id|PLL_PWRMGT_CNTL__SPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__MPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__PPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__P2PLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__TVPLL_TURNOFF
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|pll_pwrmgt_cntl
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_and_assign
op_complement
(paren
id|CLK_PWRMGT_CNTL_M6__MPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL_M6__SPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL_M6__PPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL_M6__P2PLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL_M6__MCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL_M6__SCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL_M6__PCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL_M6__P2CLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL_M6__TVPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL_M6__GLOBAL_PMAN_EN
op_or
id|CLK_PWRMGT_CNTL_M6__ENGINE_DYNCLK_MODE
op_or
id|CLK_PWRMGT_CNTL_M6__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL_M6__CG_NO1_DEBUG_MASK
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_or_assign
id|CLK_PWRMGT_CNTL_M6__GLOBAL_PMAN_EN
op_or
id|CLK_PWRMGT_CNTL_M6__DISP_PM
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
comma
id|clk_pwrmgt_cntl
)paren
suffix:semicolon
id|clk_pin_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|clk_pin_cntl
op_and_assign
op_complement
id|CLK_PIN_CNTL__ACCESS_REGS_IN_SUSPEND
suffix:semicolon
multiline_comment|/* because both INPLL and OUTPLL take the same lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
op_or
id|MCLK_MISC__EN_MCLK_TRISTATE_IN_SUSPEND
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* AGP PLL control */
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_or
id|BUS_CNTL1__AGPCLK_VALID
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
(paren
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_amp
op_complement
id|BUS_CNTL1__MOBILE_PLATFORM_SEL_MASK
)paren
op_or
(paren
l_int|2
op_lshift
id|BUS_CNTL1__MOBILE_PLATFORM_SEL__SHIFT
)paren
)paren
suffix:semicolon
singleline_comment|// 440BX
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
op_amp
op_complement
id|CRTC_OFFSET_CNTL__CRTC_STEREO_SYNC_OUT_EN
)paren
)paren
suffix:semicolon
id|clk_pin_cntl
op_and_assign
op_complement
id|CLK_PIN_CNTL__CG_CLK_TO_OUTPIN
suffix:semicolon
id|clk_pin_cntl
op_or_assign
id|CLK_PIN_CNTL__XTALIN_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|clk_pin_cntl
)paren
suffix:semicolon
multiline_comment|/* Solano2M */
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
(paren
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
op_amp
op_complement
(paren
id|AGP_CNTL__MAX_IDLE_CLK_MASK
)paren
)paren
op_or
(paren
l_int|0x20
op_lshift
id|AGP_CNTL__MAX_IDLE_CLK__SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* ACPI mode */
multiline_comment|/* because both INPLL and OUTPLL take the same lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
op_amp
op_complement
id|PLL_PWRMGT_CNTL__PM_MODE_SEL
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|disp_mis_cntl
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|disp_mis_cntl
op_and_assign
op_complement
(paren
id|DISP_MISC_CNTL__SOFT_RESET_GRPH_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_SUBPIC_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_OV0_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_SUBPIC_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_OV0_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH2_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH2_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_LVDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_TMDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_DIG_TMDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_TV
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|disp_mis_cntl
)paren
suffix:semicolon
id|disp_pwr_man
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
id|disp_pwr_man
op_and_assign
op_complement
(paren
id|DISP_PWR_MAN__DISP_PWR_MAN_D3_CRTC_EN
op_or
id|DISP_PWR_MAN__DISP2_PWR_MAN_D3_CRTC2_EN
op_or
id|DISP_PWR_MAN__DISP_PWR_MAN_DPMS_MASK
op_or
id|DISP_PWR_MAN__DISP_D3_RST
op_or
id|DISP_PWR_MAN__DISP_D3_REG_RST
)paren
suffix:semicolon
id|disp_pwr_man
op_or_assign
id|DISP_PWR_MAN__DISP_D3_GRPH_RST
op_or
id|DISP_PWR_MAN__DISP_D3_SUBPIC_RST
op_or
id|DISP_PWR_MAN__DISP_D3_OV0_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_GRPH_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_SUBPIC_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_OV0_RST
op_or
id|DISP_PWR_MAN__DIG_TMDS_ENABLE_RST
op_or
id|DISP_PWR_MAN__TV_ENABLE_RST
op_or
singleline_comment|//&t;&t;&t;&t;&t;DISP_PWR_MAN__AUTO_PWRUP_EN|
l_int|0
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|disp_pwr_man
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
)paren
suffix:semicolon
id|pll_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|clk_pin_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|disp_pwr_man
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
multiline_comment|/* D2 */
id|clk_pwrmgt_cntl
op_or_assign
id|CLK_PWRMGT_CNTL_M6__DISP_PM
suffix:semicolon
id|pll_pwrmgt_cntl
op_or_assign
id|PLL_PWRMGT_CNTL__MOBILE_SU
op_or
id|PLL_PWRMGT_CNTL__SU_SCLK_USE_BCLK
suffix:semicolon
id|clk_pin_cntl
op_or_assign
id|CLK_PIN_CNTL__XTALIN_ALWAYS_ONb
suffix:semicolon
id|disp_pwr_man
op_and_assign
op_complement
(paren
id|DISP_PWR_MAN__DISP_PWR_MAN_D3_CRTC_EN_MASK
op_or
id|DISP_PWR_MAN__DISP2_PWR_MAN_D3_CRTC2_EN_MASK
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL_M6
comma
id|clk_pwrmgt_cntl
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|pll_pwrmgt_cntl
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|clk_pin_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|disp_pwr_man
)paren
suffix:semicolon
multiline_comment|/* disable display request &amp; disable display */
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC_GEN_CNTL__CRTC_EN
)paren
op_or
id|CRTC_GEN_CNTL__CRTC_DISP_REQ_EN_B
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC2_GEN_CNTL__CRTC2_EN
)paren
op_or
id|CRTC2_GEN_CNTL__CRTC2_DISP_REQ_EN_B
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|17
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_yclk_mclk_sync
r_static
r_void
id|radeon_pm_yclk_mclk_sync
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|mc_chp_io_cntl_a1
comma
id|mc_chp_io_cntl_b1
suffix:semicolon
id|mc_chp_io_cntl_a1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA_MASK
suffix:semicolon
id|mc_chp_io_cntl_b1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB_MASK
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA__SHIFT
)paren
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB__SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* Wassup ? This doesn&squot;t seem to be defined, let&squot;s hope we are ok this way --BenH */
macro_line|#ifdef MCLK_YCLK_SYNC_ENABLE
id|mc_chp_io_cntl_a1
op_or_assign
(paren
l_int|2
op_lshift
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA__SHIFT
)paren
suffix:semicolon
id|mc_chp_io_cntl_b1
op_or_assign
(paren
l_int|2
op_lshift
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB__SHIFT
)paren
suffix:semicolon
macro_line|#endif
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_program_mode_reg
r_static
r_void
id|radeon_pm_program_mode_reg
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u16
id|value
comma
id|u8
id|delay_required
)paren
(brace
id|u32
id|mem_sdram_mode
suffix:semicolon
id|mem_sdram_mode
op_assign
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|mem_sdram_mode
op_and_assign
op_complement
id|MEM_SDRAM_MODE_REG__MEM_MODE_REG_MASK
suffix:semicolon
id|mem_sdram_mode
op_or_assign
(paren
id|value
op_lshift
id|MEM_SDRAM_MODE_REG__MEM_MODE_REG__SHIFT
)paren
op_or
id|MEM_SDRAM_MODE_REG__MEM_CFG_TYPE
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
id|mem_sdram_mode
op_or_assign
id|MEM_SDRAM_MODE_REG__MEM_SDRAM_RESET
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
id|mem_sdram_mode
op_and_assign
op_complement
id|MEM_SDRAM_MODE_REG__MEM_SDRAM_RESET
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay_required
op_eq
l_int|1
)paren
r_while
c_loop
(paren
(paren
id|INREG
c_func
(paren
id|MC_STATUS
)paren
op_amp
(paren
id|MC_STATUS__MEM_PWRUP_COMPL_A
op_or
id|MC_STATUS__MEM_PWRUP_COMPL_B
)paren
)paren
op_eq
l_int|0
)paren
(brace
)brace
suffix:semicolon
)brace
DECL|function|radeon_pm_enable_dll
r_static
r_void
id|radeon_pm_enable_dll
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
DECL|macro|DLL_RESET_DELAY
mdefine_line|#define DLL_RESET_DELAY &t;5
DECL|macro|DLL_SLEEP_DELAY
mdefine_line|#define DLL_SLEEP_DELAY&t;&t;1
id|u32
id|DLL_CKO_Value
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
op_or
id|MDLL_CKO__MCKOA_SLEEP
op_or
id|MDLL_CKO__MCKOA_RESET
suffix:semicolon
id|u32
id|DLL_CKA_Value
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKA
)paren
op_or
id|MDLL_RDCKA__MRDCKA0_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA1_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA0_RESET
op_or
id|MDLL_RDCKA__MRDCKA1_RESET
suffix:semicolon
id|u32
id|DLL_CKB_Value
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKB
)paren
op_or
id|MDLL_RDCKB__MRDCKB0_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB1_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB0_RESET
op_or
id|MDLL_RDCKB__MRDCKB1_RESET
suffix:semicolon
multiline_comment|/* Setting up the DLL range for write */
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|DLL_CKO_Value
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|DLL_CKA_Value
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|DLL_CKB_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Channel A */
multiline_comment|/* Power Up */
id|DLL_CKO_Value
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|DLL_CKO_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKO_Value
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|DLL_CKO_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Power Up */
id|DLL_CKA_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|DLL_CKA_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKA_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|DLL_CKA_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Power Up */
id|DLL_CKA_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|DLL_CKA_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKA_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|DLL_CKA_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Channel B */
multiline_comment|/* Power Up */
id|DLL_CKO_Value
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOB_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|DLL_CKO_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKO_Value
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOB_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|DLL_CKO_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Power Up */
id|DLL_CKB_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|DLL_CKB_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKB_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|DLL_CKB_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
multiline_comment|/* Power Up */
id|DLL_CKB_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|DLL_CKB_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|DLL_CKB_Value
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|DLL_CKB_Value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
DECL|macro|DLL_RESET_DELAY
macro_line|#undef DLL_RESET_DELAY 
DECL|macro|DLL_SLEEP_DELAY
macro_line|#undef DLL_SLEEP_DELAY
)brace
DECL|function|radeon_pm_full_reset_sdram
r_static
r_void
id|radeon_pm_full_reset_sdram
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|crtcGenCntl
comma
id|crtcGenCntl2
comma
id|memRefreshCntl
comma
id|crtc_more_cntl
comma
id|fp_gen_cntl
comma
id|fp2_gen_cntl
suffix:semicolon
id|crtcGenCntl
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|crtcGenCntl2
op_assign
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
suffix:semicolon
id|memRefreshCntl
op_assign
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
suffix:semicolon
id|crtc_more_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_MORE_CNTL
)paren
suffix:semicolon
id|fp_gen_cntl
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|fp2_gen_cntl
op_assign
id|INREG
c_func
(paren
id|FP2_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
(paren
id|crtcGenCntl
op_or
id|CRTC_GEN_CNTL__CRTC_DISP_REQ_EN_B
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|crtcGenCntl2
op_or
id|CRTC2_GEN_CNTL__CRTC2_DISP_REQ_EN_B
)paren
)paren
suffix:semicolon
multiline_comment|/* Disable refresh */
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
multiline_comment|/* Reset memory */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
singleline_comment|// Init  Not Complete
multiline_comment|/* DLL */
id|radeon_pm_enable_dll
c_func
(paren
id|rinfo
)paren
suffix:semicolon
singleline_comment|// MLCK /YCLK sync 
id|radeon_pm_yclk_mclk_sync
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* M6, M7 and M9 so far ... */
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
op_logical_and
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV250
)paren
(brace
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2000
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2001
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2002
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0132
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0032
comma
l_int|1
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_or
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
singleline_comment|// Init Complete
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|crtcGenCntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|crtcGenCntl2
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|fp_gen_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
id|fp2_gen_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
id|crtc_more_cntl
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
DECL|function|radeon_set_suspend
r_static
r_void
id|radeon_set_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|suspend
)paren
(brace
id|u16
id|pwr_cmd
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;pm_reg
)paren
r_return
suffix:semicolon
multiline_comment|/* Set the chip into appropriate suspend mode (we use D2,&n;&t; * D3 would require a compete re-initialization of the chip,&n;&t; * including PCI config registers, clocks, AGP conf, ...)&n;&t; */
r_if
c_cond
(paren
id|suspend
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: switching to D2 state...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Disable dynamic power management of clocks for the&n;&t;&t; * duration of the suspend/resume process&n;&t;&t; */
id|radeon_pm_disable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Save some registers */
id|radeon_pm_save_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Prepare mobility chips for suspend. Only do that on &lt;= RV250 chips that&n;&t;&t; * have been tested&n;&t;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
op_logical_and
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV250
)paren
(brace
multiline_comment|/* Program V2CLK */
id|radeon_pm_program_v2clk
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Disable IO PADs */
id|radeon_pm_disable_iopad
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Set low current */
id|radeon_pm_low_current
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Prepare chip for power management */
id|radeon_pm_setup_for_suspend
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Reset the MDLL */
multiline_comment|/* because both INPLL and OUTPLL take the same lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
op_or
id|MDLL_CKO__MCKOA_RESET
op_or
id|MDLL_CKO__MCKOB_RESET
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* Switch PCI power managment to D2. */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|pci_read_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
op_amp
id|pwr_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pwr_cmd
op_amp
l_int|2
)paren
r_break
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
(paren
id|pwr_cmd
op_amp
op_complement
id|PCI_PM_CTRL_STATE_MASK
)paren
op_or
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: switching to D0 state...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Switch back PCI powermanagment to D0 */
id|mdelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
multiline_comment|/* Reset the SDRAM controller  */
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Restore some registers */
id|radeon_pm_restore_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_pm_enable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeonfb_pci_suspend
r_int
id|radeonfb_pci_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|info-&gt;par
suffix:semicolon
multiline_comment|/* We don&squot;t do anything but D2, for now we return 0, but&n;&t; * we may want to change that. How do we know if the BIOS&n;&t; * can properly take care of D3 ? Also, with swsusp, we&n;&t; * know we&squot;ll be rebooted, ...&n;&t; */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: suspending to state: %d...&bslash;n&quot;
comma
id|state
)paren
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Userland should do this but doesn&squot;t... bridge gets suspended&n;&t; * too late. Unfortunately, that works only when AGP is built-in,&n;&t; * not for a module.&n;&t; */
macro_line|#ifdef CONFIG_AGP
id|agp_enable
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
multiline_comment|/* Make sure engine is reset */
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
id|radeonfb_engine_reset
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Blank display and LCD */
id|radeonfb_blank
c_func
(paren
id|VESA_POWERDOWN
comma
id|info
)paren
suffix:semicolon
multiline_comment|/* Sleep */
id|rinfo-&gt;asleep
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;lock_blank
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Suspend the chip to D2 state when supported&n;&t; */
macro_line|#ifdef CONFIG_RADEON_HAS_D2
r_if
c_cond
(paren
id|radeon_suspend_to_d2
c_func
(paren
id|rinfo
comma
id|state
)paren
)paren
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_RADEON_HAS_D2 */
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|pdev-&gt;dev.power.power_state
op_assign
id|state
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pci_resume
r_int
id|radeonfb_pci_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;dev.power.power_state
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Wakeup chip */
macro_line|#ifdef CONFIG_RADEON_HAS_D2
r_if
c_cond
(paren
id|radeon_suspend_to_d2
c_func
(paren
id|rinfo
comma
l_int|0
)paren
)paren
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_RADEON_HAS_D2 */
id|rinfo-&gt;asleep
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Restore display &amp; engine */
id|radeonfb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
id|fb_pan_display
c_func
(paren
id|info
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
id|fb_set_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
id|info
)paren
suffix:semicolon
multiline_comment|/* Refresh */
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Unblank */
id|rinfo-&gt;lock_blank
op_assign
l_int|0
suffix:semicolon
id|radeonfb_blank
c_func
(paren
l_int|0
comma
id|info
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|pdev-&gt;dev.power.power_state
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: resumed !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
eof
