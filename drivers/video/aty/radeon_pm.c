multiline_comment|/*&n; *&t;drivers/video/aty/radeon_pm.c&n; *&n; *&t;Copyright 2003,2004 Ben. Herrenschmidt &lt;benh@kernel.crashing.org&gt;&n; *&t;Copyright 2004 Paul Mackerras &lt;paulus@samba.org&gt;&n; *&n; *&t;This is the power management code for ATI radeon chipsets. It contains&n; *&t;some dynamic clock PM enable/disable code similar to what X.org does,&n; *&t;some D2-state (APM-style) sleep/wakeup code for use on some PowerMacs,&n; *&t;and the necessary bits to re-initialize from scratch a few chips found&n; *&t;on PowerMacs as well. The later could be extended to more platforms&n; *&t;provided the memory controller configuration code be made more generic,&n; *&t;and you can get the proper mode register commands for your RAMs.&n; *&t;Those things may be found in the BIOS image...&n; */
macro_line|#include &quot;radeonfb.h&quot;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/agp_backend.h&gt;
macro_line|#ifdef CONFIG_PPC_PMAC
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/pmac_feature.h&gt;
macro_line|#endif
macro_line|#include &quot;ati_ids.h&quot;
DECL|function|radeon_pm_disable_dynamic_mode
r_void
id|radeon_pm_disable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* RV100 */
r_if
c_cond
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV100
)paren
op_logical_and
(paren
op_logical_neg
id|rinfo-&gt;is_mobility
)paren
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;has_CRTC2
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SCLK_CNTL__DYN_STOP_LAT_MASK
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__CP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__FORCEON_MASK
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
)brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_AIC
op_or
id|MCLK_CNTL__FORCE_MC
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* R100 */
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;has_CRTC2
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__FORCE_RE
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
op_or
id|SCLK_CNTL__FORCE_RB
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* RV350 (M10) */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV350
)paren
(brace
multiline_comment|/* for RV350/M10, no delays are required. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL2
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_CNTL2__R300_FORCE_TCL
op_or
id|SCLK_CNTL2__R300_FORCE_GA
op_or
id|SCLK_CNTL2__R300_FORCE_CBA
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL2
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__R300_FORCE_VAP
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__R300_FORCE_SR
op_or
id|SCLK_CNTL__R300_FORCE_PX
op_or
id|SCLK_CNTL__R300_FORCE_TX
op_or
id|SCLK_CNTL__R300_FORCE_US
op_or
id|SCLK_CNTL__FORCE_TV_SCLK
op_or
id|SCLK_CNTL__R300_FORCE_SU
op_or
id|SCLK_CNTL__FORCE_OV0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_MC
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__R300_DISP_DAC_PIXCLK_DAC_BLANK_OFF
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_DVOCLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_DVO_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_TRANS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_TVO_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_P2G2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_P2G2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_DISP_DAC_PIXCLK_DAC2_BLANK_OFF
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Default */
multiline_comment|/* Force Core Clocks */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_E2
)paren
suffix:semicolon
multiline_comment|/* XFree doesn&squot;t do that case, but we had this code from Apple and it&n;&t; * seem necessary for proper suspend/resume operations&n;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_RE
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
op_or
id|SCLK_CNTL__FORCE_RB
op_or
id|SCLK_CNTL__FORCE_TV_SCLK
op_or
id|SCLK_CNTL__FORCE_SUBPIC
op_or
id|SCLK_CNTL__FORCE_OV0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R300
op_logical_or
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R350
)paren
(brace
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R300
op_logical_or
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R350
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL2
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL2__R300_FORCE_TCL
op_or
id|SCLK_CNTL2__R300_FORCE_GA
op_or
id|SCLK_CNTL2__R300_FORCE_CBA
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL2
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
)brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|CLK_PIN_CNTL__SCLK_DYN_START_CNTL
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;is_IGP
)paren
(brace
multiline_comment|/* Weird  ... X is _un_ forcing clocks here, I think it&squot;s&n;&t;&t; * doing backward. Imitate it for now...&n;&t;&t; */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKA
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/* Hrm... same shit, X doesn&squot;t do that but I have to */
r_else
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|MCLK_MISC__MC_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__IO_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__MC_MCLK_DYN_ENABLE
op_or
id|MCLK_MISC__IO_MCLK_DYN_ENABLE
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
)brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|16
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_enable_dynamic_mode
r_void
id|radeon_pm_enable_dynamic_mode
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* R100 */
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;has_CRTC2
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|INREG
c_func
(paren
id|CONFIG_CNTL
)paren
op_amp
id|CFG_ATI_REV_ID_MASK
)paren
OG
id|CFG_ATI_REV_A13
)paren
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_RB
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_RE
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* M10 */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV350
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL2
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL2__R300_FORCE_TCL
op_or
id|SCLK_CNTL2__R300_FORCE_GA
op_or
id|SCLK_CNTL2__R300_FORCE_CBA
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SCLK_CNTL2__R300_TCL_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL2__R300_GA_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL2__R300_CBA_MAX_DYN_STOP_LAT
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL2
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__R300_FORCE_VAP
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__R300_FORCE_SR
op_or
id|SCLK_CNTL__R300_FORCE_PX
op_or
id|SCLK_CNTL__R300_FORCE_TX
op_or
id|SCLK_CNTL__R300_FORCE_US
op_or
id|SCLK_CNTL__FORCE_TV_SCLK
op_or
id|SCLK_CNTL__R300_FORCE_SU
op_or
id|SCLK_CNTL__FORCE_OV0
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__DYN_STOP_LAT_MASK
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SCLK_MORE_CNTL__FORCEON
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__DISPREGS_MAX_DYN_STOP_LAT
op_or
id|SCLK_MORE_CNTL__MC_GUI_MAX_DYN_STOP_LAT
op_or
id|SCLK_MORE_CNTL__MC_HOST_MAX_DYN_STOP_LAT
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__DISP_TVOUT_PIXCLK_TV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_DVOCLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_DVO_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_TRANS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_PIXCLK_TVO_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_P2G2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__R300_P2G2CLK_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|MCLK_MISC__MC_MCLK_DYN_ENABLE
op_or
id|MCLK_MISC__IO_MCLK_DYN_ENABLE
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_MC
)paren
suffix:semicolon
multiline_comment|/* Some releases of vbios have set DISABLE_MC_MCLKA&n;&t;&t; * and DISABLE_MC_MCLKB bits in the vbios table.  Setting these&n;&t;&t; * bits will cause H/W hang when reading video memory with dynamic&n;&t;&t; * clocking enabled.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|tmp
op_amp
id|MCLK_CNTL__R300_DISABLE_MC_MCLKA
)paren
op_logical_and
(paren
id|tmp
op_amp
id|MCLK_CNTL__R300_DISABLE_MC_MCLKB
)paren
)paren
(brace
multiline_comment|/* If both bits are set, then check the active channels */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;vram_width
op_eq
l_int|64
)paren
(brace
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|MEM_CNTL
)paren
op_amp
id|R300_MEM_USE_CD_CH_ONLY
)paren
id|tmp
op_and_assign
op_complement
id|MCLK_CNTL__R300_DISABLE_MC_MCLKB
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|MCLK_CNTL__R300_DISABLE_MC_MCLKA
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_and_assign
op_complement
(paren
id|MCLK_CNTL__R300_DISABLE_MC_MCLKA
op_or
id|MCLK_CNTL__R300_DISABLE_MC_MCLKB
)paren
suffix:semicolon
)brace
)brace
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* R300 */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R300
op_logical_or
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_R350
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL__R300_FORCE_VAP
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_CP
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL2
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|SCLK_CNTL2__R300_FORCE_TCL
op_or
id|SCLK_CNTL2__R300_FORCE_GA
op_or
id|SCLK_CNTL2__R300_FORCE_CBA
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL2
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* Others */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|CLK_PWRMGT_CNTL__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL__DISP_DYN_STOP_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL__DYN_STOP_MODE_MASK
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CLK_PWRMGT_CNTL__ENGINE_DYNCLK_MODE_MASK
op_or
(paren
l_int|0x01
op_lshift
id|CLK_PWRMGT_CNTL__ACTIVE_HILO_LAT__SHIFT
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|CLK_PIN_CNTL__SCLK_DYN_START_CNTL
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
multiline_comment|/* When DRI is enabled, setting DYN_STOP_LAT to zero can cause some R200&n;&t; * to lockup randomly, leave them as set by BIOS.&n;&t; */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SCLK_CNTL__FORCEON_MASK
suffix:semicolon
multiline_comment|/*RAGE_6::A11 A12 A12N1 A13, RV250::A11 A12, R300*/
r_if
c_cond
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV250
op_logical_and
(paren
(paren
id|INREG
c_func
(paren
id|CONFIG_CNTL
)paren
op_amp
id|CFG_ATI_REV_ID_MASK
)paren
OL
id|CFG_ATI_REV_A13
)paren
)paren
op_logical_or
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV100
)paren
op_logical_and
(paren
(paren
id|INREG
c_func
(paren
id|CONFIG_CNTL
)paren
op_amp
id|CFG_ATI_REV_ID_MASK
)paren
op_le
id|CFG_ATI_REV_A13
)paren
)paren
)paren
(brace
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_CP
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_VIP
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV200
)paren
op_logical_or
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV250
)paren
op_logical_or
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV280
)paren
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SCLK_MORE_CNTL__FORCEON
suffix:semicolon
multiline_comment|/* RV200::A11 A12 RV250::A11 A12 */
r_if
c_cond
(paren
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV200
)paren
op_logical_or
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV250
)paren
)paren
op_logical_and
(paren
(paren
id|INREG
c_func
(paren
id|CONFIG_CNTL
)paren
op_amp
id|CFG_ATI_REV_ID_MASK
)paren
OL
id|CFG_ATI_REV_A13
)paren
)paren
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__FORCEON
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
multiline_comment|/* RV200::A11 A12, RV250::A11 A12 */
r_if
c_cond
(paren
(paren
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV200
)paren
op_logical_or
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV250
)paren
)paren
op_logical_and
(paren
(paren
id|INREG
c_func
(paren
id|CONFIG_CNTL
)paren
op_amp
id|CFG_ATI_REV_ID_MASK
)paren
OL
id|CFG_ATI_REV_A13
)paren
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PLL_PWRMGT_CNTL__TCL_BYPASS_DISABLE
suffix:semicolon
id|OUTREG
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* X doesn&squot;t do that ... hrm, we do on mobility &amp;&amp; Macs */
macro_line|#ifdef CONFIG_PPC_OF
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
suffix:semicolon
id|tmp
op_or_assign
id|MCLK_MISC__MC_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__IO_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__MC_MCLK_DYN_ENABLE
op_or
id|MCLK_MISC__IO_MCLK_DYN_ENABLE
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
id|radeon_msleep
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PPC_OF */
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|OUTMC
r_static
r_void
id|OUTMC
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u8
id|indx
comma
id|u32
id|value
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
id|indx
op_or
id|MC_IND_INDEX__MC_IND_WR_EN
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_DATA
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|INMC
r_static
id|u32
id|INMC
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u8
id|indx
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
id|indx
)paren
suffix:semicolon
r_return
id|INREG
c_func
(paren
id|MC_IND_DATA
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_save_regs
r_static
r_void
id|radeon_pm_save_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|saving_for_d3
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
op_assign
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
op_assign
id|INPLL
c_func
(paren
id|CLK_PIN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
op_assign
id|INPLL
c_func
(paren
id|PIXCLKS_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
op_assign
id|INPLL
c_func
(paren
id|MCLK_MISC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_assign
id|INPLL
c_func
(paren
id|P2PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
op_assign
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
op_assign
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
l_int|0xfdffffff
)paren
op_or
l_int|0x04000000
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
op_assign
id|INREG
c_func
(paren
id|GPIOPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_A
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_EN
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
op_assign
id|INREG
c_func
(paren
id|ZV_LCDPAD_MASK
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_VGA_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_DVI_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_MONID
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
op_assign
id|INREG
c_func
(paren
id|GPIO_CRT2_DDC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
op_assign
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
op_assign
id|INREG
c_func
(paren
id|MC_FB_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
op_assign
id|INREG
c_func
(paren
id|DISPLAY_BASE_ADDR
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
op_assign
id|INREG
c_func
(paren
id|MC_AGP_LOCATION
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
op_assign
id|INREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|34
)braket
op_assign
id|INPLL
c_func
(paren
id|SCLK_MORE_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|35
)braket
op_assign
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|36
)braket
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|39
)braket
op_assign
id|INREG
c_func
(paren
id|RBBM_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|40
)braket
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|41
)braket
op_assign
id|INREG
c_func
(paren
id|HOST_PATH_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|37
)braket
op_assign
id|INREG
c_func
(paren
id|MPP_TB_CONFIG
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|38
)braket
op_assign
id|INREG
c_func
(paren
id|FCP_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|43
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|44
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_REF_DIV
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|45
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_DIV_0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|90
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSS_INT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|91
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSS_TST_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|81
)braket
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rinfo-&gt;family
op_ge
id|CHIP_FAMILY_RV200
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|42
)braket
op_assign
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|46
)braket
op_assign
id|INREG
c_func
(paren
id|MC_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|47
)braket
op_assign
id|INREG
c_func
(paren
id|MC_INIT_GFX_LAT_TIMER
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|48
)braket
op_assign
id|INREG
c_func
(paren
id|MC_INIT_MISC_LAT_TIMER
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|49
)braket
op_assign
id|INREG
c_func
(paren
id|MC_TIMING_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|50
)braket
op_assign
id|INREG
c_func
(paren
id|MC_READ_CNTL_AB
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|51
)braket
op_assign
id|INREG
c_func
(paren
id|MC_IOPAD_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|52
)braket
op_assign
id|INREG
c_func
(paren
id|MC_CHIP_IO_OE_CNTL_AB
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|53
)braket
op_assign
id|INREG
c_func
(paren
id|MC_DEBUG
)paren
suffix:semicolon
)brace
id|rinfo-&gt;save_regs
(braket
l_int|54
)braket
op_assign
id|INREG
c_func
(paren
id|PAMAC0_DLY_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|55
)braket
op_assign
id|INREG
c_func
(paren
id|PAMAC1_DLY_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|56
)braket
op_assign
id|INREG
c_func
(paren
id|PAD_CTLR_MISC
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|57
)braket
op_assign
id|INREG
c_func
(paren
id|FW_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_ge
id|CHIP_FAMILY_R300
)paren
(brace
id|rinfo-&gt;save_regs
(braket
l_int|58
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_MC_INIT_WR_LAT_TIMER
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|59
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_IMP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|60
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_C0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|61
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_C1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|62
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_D0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|63
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_D1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|64
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_BIST_CNTL_3
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|65
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|66
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|67
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|68
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|69
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DEBUG_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|70
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|71
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_IMP_CNTL_0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|72
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_ELPIDA_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|96
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_READ_CNTL_CD
)paren
suffix:semicolon
)brace
r_else
(brace
id|rinfo-&gt;save_regs
(braket
l_int|59
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|65
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|66
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|67
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|68
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|71
)braket
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL_0
)paren
suffix:semicolon
)brace
id|rinfo-&gt;save_regs
(braket
l_int|73
)braket
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|74
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|75
)braket
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_AUX_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|76
)braket
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_AUX_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|77
)braket
op_assign
id|INPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|78
)braket
op_assign
id|INPLL
c_func
(paren
id|pllAGP_PLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|79
)braket
op_assign
id|INREG
c_func
(paren
id|PAMAC2_DLY_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|80
)braket
op_assign
id|INREG
c_func
(paren
id|OV0_BASE_ADDR
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|82
)braket
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|83
)braket
op_assign
id|INREG
c_func
(paren
id|FP2_GEN_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|84
)braket
op_assign
id|INREG
c_func
(paren
id|TMDS_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|85
)braket
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|86
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_OUTPUT_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|87
)braket
op_assign
id|INREG
c_func
(paren
id|DISP_HW_DEBUG
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|88
)braket
op_assign
id|INREG
c_func
(paren
id|TV_MASTER_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|89
)braket
op_assign
id|INPLL
c_func
(paren
id|pllP2PLL_REF_DIV
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|92
)braket
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_DIV_0
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|93
)braket
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|94
)braket
op_assign
id|INREG
c_func
(paren
id|GRPH_BUFFER_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|95
)braket
op_assign
id|INREG
c_func
(paren
id|GRPH2_BUFFER_CNTL
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|96
)braket
op_assign
id|INREG
c_func
(paren
id|HDP_DEBUG
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|97
)braket
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|98
)braket
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKA
)paren
suffix:semicolon
id|rinfo-&gt;save_regs
(braket
l_int|99
)braket
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKB
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_restore_regs
r_static
r_void
id|radeon_pm_restore_regs
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_amp
l_int|0xFFFFFFFE
)paren
suffix:semicolon
multiline_comment|/* First */
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PIXCLKS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_MISC
comma
id|rinfo-&gt;save_regs
(braket
l_int|7
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV350
)paren
id|OUTPLL
c_func
(paren
id|SCLK_MORE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|34
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CONFIG_MEMSIZE
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|rinfo-&gt;save_regs
(braket
l_int|10
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|17
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|18
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|22
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|23
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|24
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|25
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|26
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
id|rinfo-&gt;save_regs
(braket
l_int|27
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
id|rinfo-&gt;save_regs
(braket
l_int|28
)braket
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_disable_iopad
r_static
r_void
id|radeon_pm_disable_iopad
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
l_int|0x0001ffff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
l_int|0x00000400
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_MASK
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_EN
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|ZV_LCDPAD_A
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_VGA_DDC
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_DVI_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_MONID
comma
l_int|0x00030000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIO_CRT2_DDC
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_program_v2clk
r_static
r_void
id|radeon_pm_program_v2clk
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
multiline_comment|/* Set v2clk to 65MHz */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV280
)paren
(brace
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|__INPLL
c_func
(paren
id|rinfo
comma
id|pllPIXCLKS_CNTL
)paren
op_amp
op_complement
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL_MASK
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_REF_DIV
comma
l_int|0x0000000c
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
l_int|0x0000bf00
)paren
suffix:semicolon
)brace
r_else
(brace
id|OUTPLL
c_func
(paren
id|pllP2PLL_REF_DIV
comma
l_int|0x0000000c
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|pllP2PLL_REF_DIV
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
l_int|0x0000a700
)paren
suffix:semicolon
)brace
id|OUTPLL
c_func
(paren
id|pllP2PLL_DIV_0
comma
l_int|0x00020074
op_or
id|P2PLL_DIV_0__P2PLL_ATOMIC_UPDATE_W
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|INPLL
c_func
(paren
id|pllP2PLL_CNTL
)paren
op_amp
op_complement
id|P2PLL_CNTL__P2PLL_SLEEP
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|INPLL
c_func
(paren
id|pllP2PLL_CNTL
)paren
op_amp
op_complement
id|P2PLL_CNTL__P2PLL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
(paren
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
op_amp
op_complement
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL_MASK
)paren
op_or
(paren
l_int|0x03
op_lshift
id|PIXCLKS_CNTL__PIX2CLK_SRC_SEL__SHIFT
)paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_low_current
r_static
r_void
id|radeon_pm_low_current
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|reg
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV280
)paren
(brace
id|reg
op_and_assign
op_complement
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_MASK
suffix:semicolon
id|reg
op_or_assign
id|BUS_CNTL1_AGPCLK_VALID
op_or
(paren
l_int|1
op_lshift
id|BUS_CNTL1_MOBILE_PLATFORM_SEL_SHIFT
)paren
suffix:semicolon
)brace
r_else
(brace
id|reg
op_or_assign
l_int|0x4080
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|reg
op_or_assign
id|PLL_PWRMGT_CNTL_SPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_PPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_P2PLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL_TVPLL_TURNOFF
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_SU_MCLK_USE_BCLK
suffix:semicolon
id|reg
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_MOBILE_SU
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TV_DAC_CNTL_BGADJ_MASK
op_or
id|TV_DAC_CNTL_DACADJ_MASK
)paren
suffix:semicolon
id|reg
op_or_assign
id|TV_DAC_CNTL_BGSLEEP
op_or
id|TV_DAC_CNTL_RDACPD
op_or
id|TV_DAC_CNTL_GDACPD
op_or
id|TV_DAC_CNTL_BDACPD
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_BGADJ__SHIFT
)paren
op_or
(paren
l_int|8
op_lshift
id|TV_DAC_CNTL_DACADJ__SHIFT
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TMDS_PLL_EN
op_or
id|TMDS_PLLRST
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|DAC2_CMP_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
id|TV_DAC_CNTL_DETECT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_setup_for_suspend
r_static
r_void
id|radeon_pm_setup_for_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|sclk_cntl
comma
id|mclk_cntl
comma
id|sclk_more_cntl
suffix:semicolon
id|u32
id|pll_pwrmgt_cntl
suffix:semicolon
id|u32
id|clk_pwrmgt_cntl
suffix:semicolon
id|u32
id|clk_pin_cntl
suffix:semicolon
id|u32
id|vclk_ecp_cntl
suffix:semicolon
id|u32
id|pixclks_cntl
suffix:semicolon
id|u32
id|disp_mis_cntl
suffix:semicolon
id|u32
id|disp_pwr_man
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Force Core Clocks */
id|sclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|sclk_cntl
op_or_assign
id|SCLK_CNTL__IDCT_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__VIP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__RE_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__PB_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TAM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TDM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__RB_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
op_or
id|SCLK_CNTL__FORCE_RB
op_or
id|SCLK_CNTL__FORCE_TV_SCLK
op_or
id|SCLK_CNTL__FORCE_SUBPIC
op_or
id|SCLK_CNTL__FORCE_OV0
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV280
)paren
id|sclk_cntl
op_or_assign
id|SCLK_CNTL__FORCE_RE
suffix:semicolon
r_else
id|sclk_cntl
op_or_assign
id|SCLK_CNTL__SE_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__E2_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TV_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__HDP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__CP_MAX_DYN_STOP_LAT
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|sclk_cntl
)paren
suffix:semicolon
id|sclk_more_cntl
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|sclk_more_cntl
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|sclk_more_cntl
)paren
suffix:semicolon
id|mclk_cntl
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|mclk_cntl
op_and_assign
op_complement
(paren
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_MC
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|mclk_cntl
)paren
suffix:semicolon
multiline_comment|/* Force Display clocks&t;*/
id|vclk_ecp_cntl
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_and_assign
op_complement
(paren
id|VCLK_ECP_CNTL__PIXCLK_ALWAYS_ONb
op_or
id|VCLK_ECP_CNTL__PIXCLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|vclk_ecp_cntl
op_or_assign
id|VCLK_ECP_CNTL__ECP_FORCE_ON
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|vclk_ecp_cntl
)paren
suffix:semicolon
id|pixclks_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|pixclks_cntl
op_and_assign
op_complement
(paren
id|PIXCLKS_CNTL__PIXCLK_GV_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_BLEND_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_DIG_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_LVDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIXCLK_TMDS_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_ALWAYS_ONb
op_or
id|PIXCLKS_CNTL__PIX2CLK_DAC_ALWAYS_ONb
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|pixclks_cntl
)paren
suffix:semicolon
multiline_comment|/* Switch off LVDS interface */
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_amp
op_complement
(paren
id|LVDS_BLON
op_or
id|LVDS_EN
op_or
id|LVDS_ON
op_or
id|LVDS_DIGON
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable System power management */
id|pll_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|pll_pwrmgt_cntl
op_or_assign
id|PLL_PWRMGT_CNTL__SPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__MPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__PPLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__P2PLL_TURNOFF
op_or
id|PLL_PWRMGT_CNTL__TVPLL_TURNOFF
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|pll_pwrmgt_cntl
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_and_assign
op_complement
(paren
id|CLK_PWRMGT_CNTL__MPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL__SPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL__PPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL__P2PLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL__MCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL__SCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL__PCLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL__P2CLK_TURNOFF
op_or
id|CLK_PWRMGT_CNTL__TVPLL_PWRMGT_OFF
op_or
id|CLK_PWRMGT_CNTL__GLOBAL_PMAN_EN
op_or
id|CLK_PWRMGT_CNTL__ENGINE_DYNCLK_MODE
op_or
id|CLK_PWRMGT_CNTL__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL__CG_NO1_DEBUG_MASK
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_or_assign
id|CLK_PWRMGT_CNTL__GLOBAL_PMAN_EN
op_or
id|CLK_PWRMGT_CNTL__DISP_PM
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
comma
id|clk_pwrmgt_cntl
)paren
suffix:semicolon
id|clk_pin_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|clk_pin_cntl
op_and_assign
op_complement
id|CLK_PIN_CNTL__ACCESS_REGS_IN_SUSPEND
suffix:semicolon
multiline_comment|/* because both INPLL and OUTPLL take the same lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_MISC
)paren
op_or
id|MCLK_MISC__EN_MCLK_TRISTATE_IN_SUSPEND
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* AGP PLL control */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV280
)paren
(brace
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_or
id|BUS_CNTL1__AGPCLK_VALID
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
(paren
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_amp
op_complement
id|BUS_CNTL1__MOBILE_PLATFORM_SEL_MASK
)paren
op_or
(paren
l_int|2
op_lshift
id|BUS_CNTL1__MOBILE_PLATFORM_SEL__SHIFT
)paren
)paren
suffix:semicolon
singleline_comment|// 440BX
)brace
r_else
(brace
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
(paren
id|INREG
c_func
(paren
id|BUS_CNTL1
)paren
op_amp
op_complement
l_int|0x4000
)paren
op_or
l_int|0x8000
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC_OFFSET_CNTL
)paren
op_amp
op_complement
id|CRTC_OFFSET_CNTL__CRTC_STEREO_SYNC_OUT_EN
)paren
)paren
suffix:semicolon
id|clk_pin_cntl
op_and_assign
op_complement
id|CLK_PIN_CNTL__CG_CLK_TO_OUTPIN
suffix:semicolon
id|clk_pin_cntl
op_or_assign
id|CLK_PIN_CNTL__XTALIN_ALWAYS_ONb
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|clk_pin_cntl
)paren
suffix:semicolon
multiline_comment|/* Solano2M */
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
(paren
id|INREG
c_func
(paren
id|AGP_CNTL
)paren
op_amp
op_complement
(paren
id|AGP_CNTL__MAX_IDLE_CLK_MASK
)paren
)paren
op_or
(paren
l_int|0x20
op_lshift
id|AGP_CNTL__MAX_IDLE_CLK__SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* ACPI mode */
multiline_comment|/* because both INPLL and OUTPLL take the same lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
op_amp
op_complement
id|PLL_PWRMGT_CNTL__PM_MODE_SEL
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|disp_mis_cntl
op_assign
id|INREG
c_func
(paren
id|DISP_MISC_CNTL
)paren
suffix:semicolon
id|disp_mis_cntl
op_and_assign
op_complement
(paren
id|DISP_MISC_CNTL__SOFT_RESET_GRPH_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_SUBPIC_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_OV0_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_SUBPIC_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_OV0_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH2_PP
op_or
id|DISP_MISC_CNTL__SOFT_RESET_GRPH2_SCLK
op_or
id|DISP_MISC_CNTL__SOFT_RESET_LVDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_TMDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_DIG_TMDS
op_or
id|DISP_MISC_CNTL__SOFT_RESET_TV
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|disp_mis_cntl
)paren
suffix:semicolon
id|disp_pwr_man
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
id|disp_pwr_man
op_and_assign
op_complement
(paren
id|DISP_PWR_MAN__DISP_PWR_MAN_D3_CRTC_EN
op_or
id|DISP_PWR_MAN__DISP2_PWR_MAN_D3_CRTC2_EN
op_or
id|DISP_PWR_MAN__DISP_PWR_MAN_DPMS_MASK
op_or
id|DISP_PWR_MAN__DISP_D3_RST
op_or
id|DISP_PWR_MAN__DISP_D3_REG_RST
)paren
suffix:semicolon
id|disp_pwr_man
op_or_assign
id|DISP_PWR_MAN__DISP_D3_GRPH_RST
op_or
id|DISP_PWR_MAN__DISP_D3_SUBPIC_RST
op_or
id|DISP_PWR_MAN__DISP_D3_OV0_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_GRPH_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_SUBPIC_RST
op_or
id|DISP_PWR_MAN__DISP_D1D2_OV0_RST
op_or
id|DISP_PWR_MAN__DIG_TMDS_ENABLE_RST
op_or
id|DISP_PWR_MAN__TV_ENABLE_RST
op_or
singleline_comment|//&t;&t;&t;&t;&t;DISP_PWR_MAN__AUTO_PWRUP_EN|
l_int|0
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|disp_pwr_man
)paren
suffix:semicolon
id|clk_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
)paren
suffix:semicolon
id|pll_pwrmgt_cntl
op_assign
id|INPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
)paren
suffix:semicolon
id|clk_pin_cntl
op_assign
id|INPLL
c_func
(paren
id|pllCLK_PIN_CNTL
)paren
suffix:semicolon
id|disp_pwr_man
op_assign
id|INREG
c_func
(paren
id|DISP_PWR_MAN
)paren
suffix:semicolon
multiline_comment|/* D2 */
id|clk_pwrmgt_cntl
op_or_assign
id|CLK_PWRMGT_CNTL__DISP_PM
suffix:semicolon
id|pll_pwrmgt_cntl
op_or_assign
id|PLL_PWRMGT_CNTL__MOBILE_SU
op_or
id|PLL_PWRMGT_CNTL__SU_SCLK_USE_BCLK
suffix:semicolon
id|clk_pin_cntl
op_or_assign
id|CLK_PIN_CNTL__XTALIN_ALWAYS_ONb
suffix:semicolon
id|disp_pwr_man
op_and_assign
op_complement
(paren
id|DISP_PWR_MAN__DISP_PWR_MAN_D3_CRTC_EN_MASK
op_or
id|DISP_PWR_MAN__DISP2_PWR_MAN_D3_CRTC2_EN_MASK
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
comma
id|clk_pwrmgt_cntl
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|pll_pwrmgt_cntl
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|clk_pin_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_PWR_MAN
comma
id|disp_pwr_man
)paren
suffix:semicolon
multiline_comment|/* disable display request &amp; disable display */
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC_GEN_CNTL__CRTC_EN
)paren
op_or
id|CRTC_GEN_CNTL__CRTC_DISP_REQ_EN_B
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_amp
op_complement
id|CRTC2_GEN_CNTL__CRTC2_EN
)paren
op_or
id|CRTC2_GEN_CNTL__CRTC2_DISP_REQ_EN_B
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|17
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_yclk_mclk_sync
r_static
r_void
id|radeon_pm_yclk_mclk_sync
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|mc_chp_io_cntl_a1
comma
id|mc_chp_io_cntl_b1
suffix:semicolon
id|mc_chp_io_cntl_a1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA_MASK
suffix:semicolon
id|mc_chp_io_cntl_b1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB_MASK
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA__SHIFT
)paren
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB__SHIFT
)paren
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_yclk_mclk_sync_m10
r_static
r_void
id|radeon_pm_yclk_mclk_sync_m10
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|mc_chp_io_cntl_a1
comma
id|mc_chp_io_cntl_b1
suffix:semicolon
id|mc_chp_io_cntl_a1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA_MASK
suffix:semicolon
id|mc_chp_io_cntl_b1
op_assign
id|INMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B1
)paren
op_amp
op_complement
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB_MASK
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_A1__MEM_SYNC_ENA__SHIFT
)paren
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
op_or
(paren
l_int|1
op_lshift
id|MC_CHP_IO_CNTL_B1__MEM_SYNC_ENB__SHIFT
)paren
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A1
comma
id|mc_chp_io_cntl_a1
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B1
comma
id|mc_chp_io_cntl_b1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_program_mode_reg
r_static
r_void
id|radeon_pm_program_mode_reg
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
id|u16
id|value
comma
id|u8
id|delay_required
)paren
(brace
id|u32
id|mem_sdram_mode
suffix:semicolon
id|mem_sdram_mode
op_assign
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
suffix:semicolon
id|mem_sdram_mode
op_and_assign
op_complement
id|MEM_SDRAM_MODE_REG__MEM_MODE_REG_MASK
suffix:semicolon
id|mem_sdram_mode
op_or_assign
(paren
id|value
op_lshift
id|MEM_SDRAM_MODE_REG__MEM_MODE_REG__SHIFT
)paren
op_or
id|MEM_SDRAM_MODE_REG__MEM_CFG_TYPE
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay_required
op_ge
l_int|2
)paren
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|mem_sdram_mode
op_or_assign
id|MEM_SDRAM_MODE_REG__MEM_SDRAM_RESET
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay_required
op_ge
l_int|2
)paren
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|mem_sdram_mode
op_and_assign
op_complement
id|MEM_SDRAM_MODE_REG__MEM_SDRAM_RESET
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|mem_sdram_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay_required
op_ge
l_int|2
)paren
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay_required
)paren
(brace
r_do
(brace
r_if
c_cond
(paren
id|delay_required
op_ge
l_int|2
)paren
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|INREG
c_func
(paren
id|MC_STATUS
)paren
op_amp
(paren
id|MC_STATUS__MEM_PWRUP_COMPL_A
op_or
id|MC_STATUS__MEM_PWRUP_COMPL_B
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeon_pm_m10_program_mode_wait
r_static
r_void
id|radeon_pm_m10_program_mode_wait
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|cnt
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
l_int|100
suffix:semicolon
op_increment
id|cnt
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INREG
c_func
(paren
id|MC_STATUS
)paren
op_amp
(paren
id|MC_STATUS__MEM_PWRUP_COMPL_A
op_or
id|MC_STATUS__MEM_PWRUP_COMPL_B
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|radeon_pm_enable_dll
r_static
r_void
id|radeon_pm_enable_dll
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
DECL|macro|DLL_RESET_DELAY
mdefine_line|#define DLL_RESET_DELAY &t;5
DECL|macro|DLL_SLEEP_DELAY
mdefine_line|#define DLL_SLEEP_DELAY&t;&t;1
id|u32
id|cko
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
op_or
id|MDLL_CKO__MCKOA_SLEEP
op_or
id|MDLL_CKO__MCKOA_RESET
suffix:semicolon
id|u32
id|cka
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKA
)paren
op_or
id|MDLL_RDCKA__MRDCKA0_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA1_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA0_RESET
op_or
id|MDLL_RDCKA__MRDCKA1_RESET
suffix:semicolon
id|u32
id|ckb
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKB
)paren
op_or
id|MDLL_RDCKB__MRDCKB0_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB1_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB0_RESET
op_or
id|MDLL_RDCKB__MRDCKB1_RESET
suffix:semicolon
multiline_comment|/* Setting up the DLL range for write */
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|cko
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|cka
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|ckb
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
op_star
l_int|2
)paren
suffix:semicolon
id|cko
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_SLEEP
op_or
id|MDLL_CKO__MCKOB_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|cko
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|cko
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_RESET
op_or
id|MDLL_CKO__MCKOB_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|cko
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
id|cka
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|cka
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|cka
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_RESET
op_or
id|MDLL_RDCKA__MRDCKA1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|cka
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
id|ckb
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|ckb
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|ckb
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_RESET
op_or
id|MDLL_RDCKB__MRDCKB1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|ckb
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
DECL|macro|DLL_RESET_DELAY
macro_line|#undef DLL_RESET_DELAY
DECL|macro|DLL_SLEEP_DELAY
macro_line|#undef DLL_SLEEP_DELAY
)brace
DECL|function|radeon_pm_enable_dll_m10
r_static
r_void
id|radeon_pm_enable_dll_m10
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|dll_value
suffix:semicolon
id|u32
id|dll_sleep_mask
op_assign
l_int|0
suffix:semicolon
id|u32
id|dll_reset_mask
op_assign
l_int|0
suffix:semicolon
id|u32
id|mc
suffix:semicolon
DECL|macro|DLL_RESET_DELAY
mdefine_line|#define DLL_RESET_DELAY &t;5
DECL|macro|DLL_SLEEP_DELAY
mdefine_line|#define DLL_SLEEP_DELAY&t;&t;1
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|70
)braket
)paren
suffix:semicolon
id|mc
op_assign
id|INREG
c_func
(paren
id|MC_CNTL
)paren
suffix:semicolon
multiline_comment|/* Check which channels are enabled */
r_switch
c_cond
(paren
id|mc
op_amp
l_int|0x3
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|mc
op_amp
l_int|0x4
)paren
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|dll_sleep_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKB_SLEEP
suffix:semicolon
id|dll_reset_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKB_RESET
suffix:semicolon
r_case
l_int|0
suffix:colon
id|dll_sleep_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKA_SLEEP
suffix:semicolon
id|dll_reset_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKA_RESET
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mc
op_amp
l_int|0x3
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mc
op_amp
l_int|0x4
)paren
)paren
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|dll_sleep_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKD_SLEEP
suffix:semicolon
id|dll_reset_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKD_RESET
suffix:semicolon
id|dll_sleep_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKC_SLEEP
suffix:semicolon
id|dll_reset_mask
op_or_assign
id|MDLL_R300_RDCK__MRDCKC_RESET
suffix:semicolon
)brace
id|dll_value
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKA
)paren
suffix:semicolon
multiline_comment|/* Power Up */
id|dll_value
op_and_assign
op_complement
(paren
id|dll_sleep_mask
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|dll_value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_SLEEP_DELAY
)paren
suffix:semicolon
id|dll_value
op_and_assign
op_complement
(paren
id|dll_reset_mask
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|dll_value
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|DLL_RESET_DELAY
)paren
suffix:semicolon
DECL|macro|DLL_RESET_DELAY
macro_line|#undef DLL_RESET_DELAY 
DECL|macro|DLL_SLEEP_DELAY
macro_line|#undef DLL_SLEEP_DELAY
)brace
DECL|function|radeon_pm_full_reset_sdram
r_static
r_void
id|radeon_pm_full_reset_sdram
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|crtcGenCntl
comma
id|crtcGenCntl2
comma
id|memRefreshCntl
comma
id|crtc_more_cntl
comma
id|fp_gen_cntl
comma
id|fp2_gen_cntl
suffix:semicolon
id|crtcGenCntl
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|crtcGenCntl2
op_assign
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
suffix:semicolon
id|crtc_more_cntl
op_assign
id|INREG
c_func
(paren
id|CRTC_MORE_CNTL
)paren
suffix:semicolon
id|fp_gen_cntl
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|fp2_gen_cntl
op_assign
id|INREG
c_func
(paren
id|FP2_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
(paren
id|crtcGenCntl
op_or
id|CRTC_GEN_CNTL__CRTC_DISP_REQ_EN_B
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
(paren
id|crtcGenCntl2
op_or
id|CRTC2_GEN_CNTL__CRTC2_DISP_REQ_EN_B
)paren
)paren
suffix:semicolon
multiline_comment|/* This is the code for the Aluminium PowerBooks M10 */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV350
)paren
(brace
id|u32
id|sdram_mode_reg
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|35
)braket
suffix:semicolon
r_static
id|u32
id|default_mrtable
(braket
)braket
op_assign
(brace
l_int|0x21320032
comma
l_int|0x21321000
comma
l_int|0xa1321000
comma
l_int|0x21321000
comma
l_int|0xffffffff
comma
l_int|0x21320032
comma
l_int|0xa1320032
comma
l_int|0x21320032
comma
l_int|0xffffffff
comma
l_int|0x21321002
comma
l_int|0xa1321002
comma
l_int|0x21321002
comma
l_int|0xffffffff
comma
l_int|0x21320132
comma
l_int|0xa1320132
comma
l_int|0x21320132
comma
l_int|0xffffffff
comma
l_int|0x21320032
comma
l_int|0xa1320032
comma
l_int|0x21320032
comma
l_int|0xffffffff
comma
l_int|0x31320032
)brace
suffix:semicolon
id|u32
op_star
id|mrtable
op_assign
id|default_mrtable
suffix:semicolon
r_int
id|i
comma
id|mrtable_size
op_assign
id|ARRAY_SIZE
c_func
(paren
id|default_mrtable
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* Disable refresh */
id|memRefreshCntl
op_assign
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
op_amp
op_complement
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
multiline_comment|/* Configure and enable M &amp; SPLLs */
id|radeon_pm_enable_dll_m10
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_pm_yclk_mclk_sync_m10
c_func
(paren
id|rinfo
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_OF
r_if
c_cond
(paren
id|rinfo-&gt;of_node
op_ne
l_int|NULL
)paren
(brace
r_int
id|size
suffix:semicolon
id|mrtable
op_assign
(paren
id|u32
op_star
)paren
id|get_property
c_func
(paren
id|rinfo-&gt;of_node
comma
l_string|&quot;ATY,MRT&quot;
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mrtable
)paren
id|mrtable_size
op_assign
id|size
op_rshift
l_int|2
suffix:semicolon
r_else
id|mrtable
op_assign
id|default_mrtable
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PPC_OF */
multiline_comment|/* Program the SDRAM */
id|sdram_mode_reg
op_assign
id|mrtable
(braket
l_int|0
)braket
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|sdram_mode_reg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mrtable_size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mrtable
(braket
id|i
)braket
op_eq
l_int|0xffffffffu
)paren
id|radeon_pm_m10_program_mode_wait
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_else
(brace
id|sdram_mode_reg
op_and_assign
op_complement
(paren
id|MEM_SDRAM_MODE_REG__MEM_MODE_REG_MASK
op_or
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
op_or
id|MEM_SDRAM_MODE_REG__MEM_SDRAM_RESET
)paren
suffix:semicolon
id|sdram_mode_reg
op_or_assign
id|mrtable
(braket
id|i
)braket
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|sdram_mode_reg
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Restore memory refresh */
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
)brace
multiline_comment|/* Here come the desktop RV200 &quot;QW&quot; card */
r_else
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;is_mobility
op_logical_and
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV200
)paren
(brace
multiline_comment|/* Disable refresh */
id|memRefreshCntl
op_assign
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
op_amp
op_complement
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* Reset memory */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2002
comma
l_int|2
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0132
comma
l_int|2
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0032
comma
l_int|2
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_or
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
)paren
suffix:semicolon
)brace
multiline_comment|/* The M6 */
r_else
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
op_logical_and
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV100
)paren
(brace
multiline_comment|/* Disable refresh */
id|memRefreshCntl
op_assign
id|INREG
c_func
(paren
id|EXT_MEM_CNTL
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|20
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|EXT_MEM_CNTL
comma
id|memRefreshCntl
op_or
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
multiline_comment|/* Reset memory */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
multiline_comment|/* DLL */
id|radeon_pm_enable_dll
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* MLCK / YCLK sync */
id|radeon_pm_yclk_mclk_sync
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Program Mode Register */
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2000
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2001
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2002
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0132
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0032
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Complete &amp; re-enable refresh */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_or
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|EXT_MEM_CNTL
comma
id|memRefreshCntl
)paren
suffix:semicolon
)brace
multiline_comment|/* And finally, the M7..M9 models, including M9+ (RV280) */
r_else
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
multiline_comment|/* Disable refresh */
id|memRefreshCntl
op_assign
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
op_amp
op_complement
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
multiline_comment|/* Reset memory */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
multiline_comment|/* DLL */
id|radeon_pm_enable_dll
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* MLCK / YCLK sync */
id|radeon_pm_yclk_mclk_sync
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* M6, M7 and M9 so far ... */
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV250
)paren
(brace
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2000
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2001
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2002
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0132
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0032
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* M9+ (iBook G4) */
r_else
r_if
c_cond
(paren
id|rinfo-&gt;family
op_eq
id|CHIP_FAMILY_RV280
)paren
(brace
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x2000
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0132
comma
l_int|1
)paren
suffix:semicolon
id|radeon_pm_program_mode_reg
c_func
(paren
id|rinfo
comma
l_int|0x0032
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Complete &amp; re-enable refresh */
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|INREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
)paren
op_or
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|memRefreshCntl
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|crtcGenCntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|crtcGenCntl2
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|fp_gen_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
id|fp2_gen_cntl
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
id|crtc_more_cntl
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|15
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PPC_OF
DECL|function|radeon_pm_reset_pad_ctlr_strength
r_static
r_void
id|radeon_pm_reset_pad_ctlr_strength
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
comma
id|tmp2
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
multiline_comment|/* Reset the PAD_CTLR_STRENGTH &amp; wait for it to be stable */
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAD_CTLR_STRENGTH
comma
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
op_amp
op_complement
id|PAD_MANUAL_OVERRIDE
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|65
suffix:semicolon
op_increment
id|i
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp2
op_assign
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|tmp2
)paren
(brace
id|tmp
op_assign
id|tmp2
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|j
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;radeon: PAD_CTLR_STRENGTH doesn&squot;t &quot;
l_string|&quot;stabilize !&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|radeon_pm_all_ppls_off
r_static
r_void
id|radeon_pm_all_ppls_off
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_CNTL
comma
id|tmp
op_or
l_int|0x3
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllP2PLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|tmp
op_or
l_int|0x3
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_CNTL
comma
id|tmp
op_or
l_int|0x3
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_CNTL
comma
id|tmp
op_or
l_int|0x3
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_start_mclk_sclk
r_static
r_void
id|radeon_pm_start_mclk_sclk
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Switch SPLL to PCI source */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
op_amp
op_complement
id|SCLK_CNTL__SCLK_SRC_SEL_MASK
)paren
suffix:semicolon
multiline_comment|/* Reconfigure SPLL charge pump, VCO gain, duty cycle */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|pllSPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Set SPLL feedback divider */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
l_int|0xff00fffful
)paren
op_or
(paren
id|rinfo-&gt;save_regs
(braket
l_int|77
)braket
op_amp
l_int|0x00ff0000ul
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Power up SPLL */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|1
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Release SPLL reset */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllSPLL_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Select SCLK source  */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SCLK_CNTL__SCLK_SRC_SEL_MASK
suffix:semicolon
id|tmp
op_or_assign
id|rinfo-&gt;save_regs
(braket
l_int|3
)braket
op_amp
id|SCLK_CNTL__SCLK_SRC_SEL_MASK
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Reconfigure MPLL charge pump, VCO gain, duty cycle */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|pllMPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Set MPLL feedback divider */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
l_int|0xffff00fful
)paren
op_or
(paren
id|rinfo-&gt;save_regs
(braket
l_int|77
)braket
op_amp
l_int|0x0000ff00ul
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Power up MPLL */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Un-reset MPLL */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllMPLL_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Select source for MCLK */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_amp
l_int|0xffff
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
(paren
r_void
)paren
id|INPLL
c_func
(paren
id|pllMCLK_CNTL
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_m10_disable_spread_spectrum
r_static
r_void
id|radeon_pm_m10_disable_spread_spectrum
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|r2ec
suffix:semicolon
multiline_comment|/* GACK ! I though we didn&squot;t have a DDA on Radeon&squot;s anymore&n;&t; * here we rewrite with the same value, ... I suppose we clear&n;&t; * some bits that are already clear ? Or maybe this 0x2ec&n;&t; * register is something new ?&n;&t; */
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|r2ec
op_assign
id|INREG
c_func
(paren
id|VGA_DDA_ON_OFF
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|VGA_DDA_ON_OFF
comma
id|r2ec
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Spread spectrum PLLL off */
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
l_int|0xbf03
)paren
suffix:semicolon
multiline_comment|/* Spread spectrum disabled */
id|OUTPLL
c_func
(paren
id|pllSS_INT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|90
)braket
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
multiline_comment|/* The trace shows read &amp; rewrite of LVDS_PLL_CNTL here with same&n;&t; * value, not sure what for...&n;&t; */
id|r2ec
op_or_assign
l_int|0x3f0
suffix:semicolon
id|OUTREG
c_func
(paren
id|VGA_DDA_ON_OFF
comma
id|r2ec
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_m10_enable_lvds_spread_spectrum
r_static
r_void
id|radeon_pm_m10_enable_lvds_spread_spectrum
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|r2ec
comma
id|tmp
suffix:semicolon
multiline_comment|/* GACK (bis) ! I though we didn&squot;t have a DDA on Radeon&squot;s anymore&n;&t; * here we rewrite with the same value, ... I suppose we clear/set&n;&t; * some bits that are already clear/set ?&n;&t; */
id|r2ec
op_assign
id|INREG
c_func
(paren
id|VGA_DDA_ON_OFF
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|VGA_DDA_ON_OFF
comma
id|r2ec
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable spread spectrum */
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|43
)braket
op_or
l_int|3
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_REF_DIV
comma
id|rinfo-&gt;save_regs
(braket
l_int|44
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_DIV_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|45
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSS_INT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|90
)braket
)paren
suffix:semicolon
id|r2ec
op_or_assign
l_int|8
suffix:semicolon
id|OUTREG
c_func
(paren
id|VGA_DDA_ON_OFF
comma
id|r2ec
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Enable LVDS interface */
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|tmp
op_or
id|LVDS_EN
)paren
suffix:semicolon
multiline_comment|/* Enable LVDS_PLL */
id|tmp
op_assign
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x30000
suffix:semicolon
id|tmp
op_or_assign
l_int|0x10000
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|34
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSS_TST_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|91
)braket
)paren
suffix:semicolon
multiline_comment|/* The trace reads that one here, waiting for something to settle down ? */
id|INREG
c_func
(paren
id|RBBM_STATUS
)paren
suffix:semicolon
multiline_comment|/* Ugh ? SS_TST_DEC is supposed to be a read register in the&n;&t; * R300 register spec at least...&n;&t; */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSS_TST_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00400000
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSS_TST_CNTL
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_restore_pixel_pll
r_static
r_void
id|radeon_pm_restore_pixel_pll
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|pllHTOTAL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
comma
l_int|0
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
op_or
l_int|0x80
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_REF_DIV
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
op_complement
id|PPLL_REF_DIV_MASK
)paren
op_or
id|rinfo-&gt;pll.ref_div
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_REF_DIV
comma
id|tmp
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|pllPPLL_REF_DIV
)paren
suffix:semicolon
multiline_comment|/* Reconfigure SPLL charge pump, VCO gain, duty cycle,&n;&t; * probably useless since we already did it ...&n;&t; */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_CNTL
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|pllSPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Not sure what was intended here ... */
id|tmp
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Restore our &quot;reference&quot; PPLL divider set by firmware&n;&t; * according to proper spread spectrum calculations&n;&t; */
id|OUTPLL
c_func
(paren
id|pllPPLL_DIV_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|92
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
op_or
l_int|3
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
op_or
l_int|3
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Switch pixel clock to firmware default div 0 */
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_m10_reconfigure_mc
r_static
r_void
id|radeon_pm_m10_reconfigure_mc
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|46
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_INIT_GFX_LAT_TIMER
comma
id|rinfo-&gt;save_regs
(braket
l_int|47
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_INIT_MISC_LAT_TIMER
comma
id|rinfo-&gt;save_regs
(braket
l_int|48
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|rinfo-&gt;save_regs
(braket
l_int|35
)braket
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_TIMING_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|49
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|42
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_READ_CNTL_AB
comma
id|rinfo-&gt;save_regs
(braket
l_int|50
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_CHIP_IO_OE_CNTL_AB
comma
id|rinfo-&gt;save_regs
(braket
l_int|52
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IOPAD_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|51
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_DEBUG
comma
id|rinfo-&gt;save_regs
(braket
l_int|53
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_MC_INIT_WR_LAT_TIMER
comma
id|rinfo-&gt;save_regs
(braket
l_int|58
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_IMP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|59
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_C0
comma
id|rinfo-&gt;save_regs
(braket
l_int|60
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_C1
comma
id|rinfo-&gt;save_regs
(braket
l_int|61
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_D0
comma
id|rinfo-&gt;save_regs
(braket
l_int|62
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_D1
comma
id|rinfo-&gt;save_regs
(braket
l_int|63
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_BIST_CNTL_3
comma
id|rinfo-&gt;save_regs
(braket
l_int|64
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A0
comma
id|rinfo-&gt;save_regs
(braket
l_int|65
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_A1
comma
id|rinfo-&gt;save_regs
(braket
l_int|66
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B0
comma
id|rinfo-&gt;save_regs
(braket
l_int|67
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_CHP_IO_CNTL_B1
comma
id|rinfo-&gt;save_regs
(braket
l_int|68
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DEBUG_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|69
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|70
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_IMP_CNTL_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|71
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_ELPIDA_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|72
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_READ_CNTL_CD
comma
id|rinfo-&gt;save_regs
(braket
l_int|96
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|radeon_reinitialize_M10
r_static
r_void
id|radeon_reinitialize_M10
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
comma
id|i
suffix:semicolon
multiline_comment|/* Restore a bunch of registers first */
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OV0_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|80
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CONFIG_MEMSIZE
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|36
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MPP_TB_CONFIG
comma
id|rinfo-&gt;save_regs
(braket
l_int|37
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FCP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|38
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|39
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|40
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_MACRO_CNTL
comma
(paren
id|INREG
c_func
(paren
id|DAC_MACRO_CNTL
)paren
op_amp
op_complement
l_int|0x6
)paren
op_or
l_int|8
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_MACRO_CNTL
comma
(paren
id|INREG
c_func
(paren
id|DAC_MACRO_CNTL
)paren
op_amp
op_complement
l_int|0x6
)paren
op_or
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Hrm... */
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_or
id|DAC2_EXPAND_MODE
)paren
suffix:semicolon
multiline_comment|/* Reset the PAD CTLR */
id|radeon_pm_reset_pad_ctlr_strength
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Some PLLs are Read &amp; written identically in the trace here...&n;&t; * I suppose it&squot;s actually to switch them all off &amp; reset,&n;&t; * let&squot;s assume off is what we want. I&squot;m just doing that for all major PLLs now.&n;&t; */
id|radeon_pm_all_ppls_off
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Clear tiling, reset swappers */
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Some black magic with TV_DAC_CNTL, we should restore those from backups&n;&t; * rather than hard coding...&n;&t; */
id|tmp
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
op_amp
op_complement
id|TV_DAC_CNTL_BGADJ_MASK
suffix:semicolon
id|tmp
op_or_assign
l_int|8
op_lshift
id|TV_DAC_CNTL_BGADJ__SHIFT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
op_amp
op_complement
id|TV_DAC_CNTL_DACADJ_MASK
suffix:semicolon
id|tmp
op_or_assign
l_int|7
op_lshift
id|TV_DAC_CNTL_DACADJ__SHIFT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* More registers restored */
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|HOST_PATH_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|41
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
multiline_comment|/* Hrmmm ... What is that ? */
id|tmp
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
op_amp
op_complement
(paren
id|CLK_PWRMGT_CNTL__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL__MC_BUSY
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAD_CTLR_MISC
comma
id|rinfo-&gt;save_regs
(braket
l_int|56
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FW_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|57
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|HDP_DEBUG
comma
id|rinfo-&gt;save_regs
(braket
l_int|96
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC0_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|54
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC1_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|55
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC2_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|79
)braket
)paren
suffix:semicolon
multiline_comment|/* Restore Memory Controller configuration */
id|radeon_pm_m10_reconfigure_mc
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Make sure CRTC&squot;s dont touch memory */
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
op_or
id|CRTC_GEN_CNTL__CRTC_DISP_REQ_EN_B
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
op_or
id|CRTC2_GEN_CNTL__CRTC2_DISP_REQ_EN_B
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* Disable SDRAM refresh */
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
multiline_comment|/* Restore XTALIN routing (CLK_PIN_CNTL) */
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
multiline_comment|/* Switch MCLK, YCLK and SCLK PLLs to PCI source &amp; force them ON */
id|tmp
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_amp
l_int|0xff000000
suffix:semicolon
id|tmp
op_or_assign
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_MC
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Force all clocks on in SCLK */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
op_or
id|SCLK_CNTL__FORCE_RB
op_or
id|SCLK_CNTL__FORCE_TV_SCLK
op_or
id|SCLK_CNTL__FORCE_SUBPIC
op_or
id|SCLK_CNTL__FORCE_OV0
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_CNTL__CP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__HDP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TV_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__E2_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__SE_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__IDCT_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__VIP_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__RE_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__PB_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TAM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__TDM_MAX_DYN_STOP_LAT
op_or
id|SCLK_CNTL__RB_MAX_DYN_STOP_LAT
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|MCLK_MISC__MC_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__IO_MCLK_MAX_DYN_STOP_LAT
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Restore the M_SPLL_REF_FB_DIV, MPLL_AUX_CNTL and SPLL_AUX_CNTL values */
id|OUTPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
comma
id|rinfo-&gt;save_regs
(braket
l_int|77
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_AUX_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|75
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_AUX_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|76
)braket
)paren
suffix:semicolon
multiline_comment|/* Now restore the major PLLs settings, keeping them off &amp; reset though */
id|OUTPLL
c_func
(paren
id|pllPPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|93
)braket
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|73
)braket
op_or
l_int|0x03
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|74
)braket
op_or
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* Restore MC DLL state and switch it off/reset too  */
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixR300_MC_DLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|70
)braket
)paren
suffix:semicolon
multiline_comment|/* Switch MDLL off &amp; reset */
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|rinfo-&gt;save_regs
(braket
l_int|98
)braket
op_or
l_int|0xff
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Setup some black magic bits in PLL_PWRMGT_CNTL. Hrm... we saved&n;&t; * 0xa1100007... and MacOS writes 0xa1000007 ..&n;&t; */
id|OUTPLL
c_func
(paren
id|pllPLL_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Restore more stuffs */
id|OUTPLL
c_func
(paren
id|pllHTOTAL_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllHTOTAL2_CNTL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* More PLL initial configuration */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_CNTL2
)paren
suffix:semicolon
multiline_comment|/* What for ? */
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL2
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
op_or
multiline_comment|/* a guess */
id|SCLK_MORE_CNTL__FORCE_MC_GUI
op_or
id|SCLK_MORE_CNTL__FORCE_MC_HOST
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Now we actually start MCLK and SCLK */
id|radeon_pm_start_mclk_sclk
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Full reset sdrams, this also re-inits the MDLL */
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Fill palettes */
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|PALETTE_30_DATA
comma
l_int|0x15555555
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_amp
op_complement
l_int|20
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|PALETTE_30_DATA
comma
l_int|0x15555555
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_amp
op_complement
l_int|0x20
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Restore TMDS */
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|82
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|83
)braket
)paren
suffix:semicolon
multiline_comment|/* Set LVDS registers but keep interface &amp; pll down */
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
op_amp
op_complement
(paren
id|LVDS_EN
op_or
id|LVDS_ON
op_or
id|LVDS_DIGON
op_or
id|LVDS_BLON
op_or
id|LVDS_BL_MOD_EN
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
(paren
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
op_amp
op_complement
l_int|0xf0000
)paren
op_or
l_int|0x20000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_OUTPUT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|86
)braket
)paren
suffix:semicolon
multiline_comment|/* Restore GPIOPAD state */
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
)paren
suffix:semicolon
multiline_comment|/* write some stuff to the framebuffer... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x8000
suffix:semicolon
op_increment
id|i
)paren
id|writeb
c_func
(paren
l_int|0
comma
id|rinfo-&gt;fb_base
op_plus
id|i
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_or
id|LVDS_DIGON
op_or
id|LVDS_ON
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
multiline_comment|/* Restore a few more things */
id|OUTREG
c_func
(paren
id|GRPH_BUFFER_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|94
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GRPH2_BUFFER_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|95
)braket
)paren
suffix:semicolon
multiline_comment|/* Take care of spread spectrum &amp; PPLLs now */
id|radeon_pm_m10_disable_spread_spectrum
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_pm_restore_pixel_pll
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* GRRRR... I can&squot;t figure out the proper LVDS power sequence, and the&n;&t; * code I have for blank/unblank doesn&squot;t quite work on some laptop models&n;&t; * it seems ... Hrm. What I have here works most of the time ...&n;&t; */
id|radeon_pm_m10_enable_lvds_spread_spectrum
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
DECL|function|radeon_pm_m9p_reconfigure_mc
r_static
r_void
id|radeon_pm_m9p_reconfigure_mc
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|OUTREG
c_func
(paren
id|MC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|46
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_INIT_GFX_LAT_TIMER
comma
id|rinfo-&gt;save_regs
(braket
l_int|47
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_INIT_MISC_LAT_TIMER
comma
id|rinfo-&gt;save_regs
(braket
l_int|48
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
id|rinfo-&gt;save_regs
(braket
l_int|35
)braket
op_amp
op_complement
id|MEM_SDRAM_MODE_REG__MC_INIT_COMPLETE
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_TIMING_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|49
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_READ_CNTL_AB
comma
id|rinfo-&gt;save_regs
(braket
l_int|50
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|42
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IOPAD_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|51
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_DEBUG
comma
id|rinfo-&gt;save_regs
(braket
l_int|53
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_CHIP_IO_OE_CNTL_AB
comma
id|rinfo-&gt;save_regs
(braket
l_int|52
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|59
)braket
multiline_comment|/*0x00f460d6*/
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A0
comma
id|rinfo-&gt;save_regs
(braket
l_int|65
)braket
multiline_comment|/*0xfecfa666*/
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
id|rinfo-&gt;save_regs
(braket
l_int|66
)braket
multiline_comment|/*0x141555ff*/
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B0
comma
id|rinfo-&gt;save_regs
(braket
l_int|67
)braket
multiline_comment|/*0xfecfa666*/
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
id|rinfo-&gt;save_regs
(braket
l_int|68
)braket
multiline_comment|/*0x141555ff*/
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|71
)braket
multiline_comment|/*0x00009249*/
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CONFIG_MEMSIZE
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
DECL|function|radeon_reinitialize_M9P
r_static
r_void
id|radeon_reinitialize_M9P
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
id|u32
id|tmp
comma
id|i
suffix:semicolon
multiline_comment|/* Restore a bunch of registers first */
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OV0_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|80
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|36
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL1
comma
id|rinfo-&gt;save_regs
(braket
l_int|14
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MPP_TB_CONFIG
comma
id|rinfo-&gt;save_regs
(braket
l_int|37
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FCP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|38
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|39
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|40
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_or
id|DAC2_EXPAND_MODE
)paren
suffix:semicolon
multiline_comment|/* Reset the PAD CTLR */
id|radeon_pm_reset_pad_ctlr_strength
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Some PLLs are Read &amp; written identically in the trace here...&n;&t; * I suppose it&squot;s actually to switch them all off &amp; reset,&n;&t; * let&squot;s assume off is what we want. I&squot;m just doing that for all major PLLs now.&n;&t; */
id|radeon_pm_all_ppls_off
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Clear tiling, reset swappers */
id|INREG
c_func
(paren
id|SURFACE_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Some black magic with TV_DAC_CNTL, we should restore those from backups&n;&t; * rather than hard coding...&n;&t; */
id|tmp
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
op_amp
op_complement
id|TV_DAC_CNTL_BGADJ_MASK
suffix:semicolon
id|tmp
op_or_assign
l_int|6
op_lshift
id|TV_DAC_CNTL_BGADJ__SHIFT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
op_amp
op_complement
id|TV_DAC_CNTL_DACADJ_MASK
suffix:semicolon
id|tmp
op_or_assign
l_int|6
op_lshift
id|TV_DAC_CNTL_DACADJ__SHIFT
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllAGP_PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|78
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC0_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|54
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC1_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|55
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAMAC2_DLY_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|79
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|HOST_PATH_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|41
)braket
)paren
suffix:semicolon
multiline_comment|/* MacOS sets that to 0 !!! */
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
op_amp
op_complement
(paren
id|CLK_PWRMGT_CNTL__ACTIVE_HILO_LAT_MASK
op_or
id|CLK_PWRMGT_CNTL__MC_BUSY
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllCLK_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FW_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|57
)braket
)paren
suffix:semicolon
multiline_comment|/* Disable SDRAM refresh */
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
id|INREG
c_func
(paren
id|MEM_REFRESH_CNTL
)paren
op_or
id|MEM_REFRESH_CNTL__MEM_REFRESH_DIS
)paren
suffix:semicolon
multiline_comment|/* Restore XTALIN routing (CLK_PIN_CNTL) */
id|OUTPLL
c_func
(paren
id|pllCLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
multiline_comment|/* Force MCLK to be PCI sourced and forced ON */
id|tmp
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|2
)braket
op_amp
l_int|0xff000000
suffix:semicolon
id|tmp
op_or_assign
id|MCLK_CNTL__FORCE_MCLKA
op_or
id|MCLK_CNTL__FORCE_MCLKB
op_or
id|MCLK_CNTL__FORCE_YCLKA
op_or
id|MCLK_CNTL__FORCE_YCLKB
op_or
id|MCLK_CNTL__FORCE_MC
op_or
id|MCLK_CNTL__FORCE_AIC
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Force SCLK to be PCI sourced with a bunch forced */
id|tmp
op_assign
l_int|0
op_or
id|SCLK_CNTL__FORCE_DISP2
op_or
id|SCLK_CNTL__FORCE_CP
op_or
id|SCLK_CNTL__FORCE_HDP
op_or
id|SCLK_CNTL__FORCE_DISP1
op_or
id|SCLK_CNTL__FORCE_TOP
op_or
id|SCLK_CNTL__FORCE_E2
op_or
id|SCLK_CNTL__FORCE_SE
op_or
id|SCLK_CNTL__FORCE_IDCT
op_or
id|SCLK_CNTL__FORCE_VIP
op_or
id|SCLK_CNTL__FORCE_RE
op_or
id|SCLK_CNTL__FORCE_PB
op_or
id|SCLK_CNTL__FORCE_TAM
op_or
id|SCLK_CNTL__FORCE_TDM
op_or
id|SCLK_CNTL__FORCE_RB
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Clear VCLK_ECP_CNTL &amp; PIXCLKS_CNTL  */
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Setup MCLK_MISC, non dynamic mode */
id|OUTPLL
c_func
(paren
id|pllMCLK_MISC
comma
id|MCLK_MISC__MC_MCLK_MAX_DYN_STOP_LAT
op_or
id|MCLK_MISC__IO_MCLK_MAX_DYN_STOP_LAT
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Set back the default clock dividers */
id|OUTPLL
c_func
(paren
id|pllM_SPLL_REF_FB_DIV
comma
id|rinfo-&gt;save_regs
(braket
l_int|77
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_AUX_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|75
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_AUX_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|76
)braket
)paren
suffix:semicolon
multiline_comment|/* PPLL and P2PLL default values &amp; off */
id|OUTPLL
c_func
(paren
id|pllPPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|93
)braket
op_or
l_int|0x3
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllP2PLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|8
)braket
op_or
l_int|0x3
)paren
suffix:semicolon
multiline_comment|/* S and M PLLs are reset &amp; off, configure them */
id|OUTPLL
c_func
(paren
id|pllMPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|73
)braket
op_or
l_int|0x03
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|74
)braket
op_or
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* Default values for MDLL ... fixme */
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
l_int|0x9c009c
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
l_int|0x08830883
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
l_int|0x08830883
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Restore PLL_PWRMGT_CNTL */
singleline_comment|// XXXX
id|tmp
op_assign
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|PLL_PWRMGT_CNTL_SU_SCLK_USE_BCLK
suffix:semicolon
id|tmp
op_or_assign
id|PLL_PWRMGT_CNTL_SU_MCLK_USE_BCLK
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Clear HTOTAL_CNTL &amp; HTOTAL2_CNTL */
id|OUTPLL
c_func
(paren
id|pllHTOTAL_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllHTOTAL2_CNTL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* All outputs off */
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
l_int|0x04000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
l_int|0x04000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
l_int|0x00004008
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP2_GEN_CNTL
comma
l_int|0x00000008
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
l_int|0x08000008
)paren
suffix:semicolon
multiline_comment|/* Restore Memory Controller configuration */
id|radeon_pm_m9p_reconfigure_mc
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Now we actually start MCLK and SCLK */
id|radeon_pm_start_mclk_sclk
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Full reset sdrams, this also re-inits the MDLL */
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Fill palettes */
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|PALETTE_30_DATA
comma
l_int|0x15555555
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_amp
op_complement
l_int|20
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|OUTREG
c_func
(paren
id|PALETTE_30_DATA
comma
l_int|0x15555555
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_amp
op_complement
l_int|0x20
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Restore TV stuff, make sure TV DAC is down */
id|OUTREG
c_func
(paren
id|TV_MASTER_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|88
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|13
)braket
op_or
l_int|0x07000000
)paren
suffix:semicolon
multiline_comment|/* Restore GPIOS. MacOS does some magic here with one of the GPIO bits,&n;&t; * possibly related to the weird PLL related workarounds and to the&n;&t; * fact that CLK_PIN_CNTL is tweaked in ways I don&squot;t fully understand,&n;&t; * but we keep things the simple way here&n;&t; */
id|OUTREG
c_func
(paren
id|GPIOPAD_A
comma
id|rinfo-&gt;save_regs
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_EN
comma
id|rinfo-&gt;save_regs
(braket
l_int|20
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GPIOPAD_MASK
comma
id|rinfo-&gt;save_regs
(braket
l_int|21
)braket
)paren
suffix:semicolon
multiline_comment|/* Now do things with SCLK_MORE_CNTL. Force bits are already set, copy&n;&t; * high bits from backup&n;&t; */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
id|tmp
op_or_assign
id|rinfo-&gt;save_regs
(braket
l_int|34
)braket
op_amp
l_int|0xffff0000
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
id|tmp
op_or_assign
id|rinfo-&gt;save_regs
(braket
l_int|34
)braket
op_amp
l_int|0xffff0000
suffix:semicolon
id|tmp
op_or_assign
id|SCLK_MORE_CNTL__FORCE_DISPREGS
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSCLK_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|11
)braket
op_amp
op_complement
(paren
id|LVDS_EN
op_or
id|LVDS_ON
op_or
id|LVDS_DIGON
op_or
id|LVDS_BLON
op_or
id|LVDS_BL_MOD_EN
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_or
id|LVDS_BLON
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
(paren
id|rinfo-&gt;save_regs
(braket
l_int|12
)braket
op_amp
op_complement
l_int|0xf0000
)paren
op_or
l_int|0x20000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
multiline_comment|/* write some stuff to the framebuffer... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x8000
suffix:semicolon
op_increment
id|i
)paren
id|writeb
c_func
(paren
l_int|0
comma
id|rinfo-&gt;fb_base
op_plus
id|i
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
l_int|0x2ec
comma
l_int|0x6332a020
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_REF_DIV
comma
id|rinfo-&gt;save_regs
(braket
l_int|44
)braket
multiline_comment|/*0x3f */
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_DIV_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|45
)braket
multiline_comment|/*0x000081bb */
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllSSPLL_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|2
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp
op_or_assign
l_int|3
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSSPLL_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSS_INT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|90
)braket
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
multiline_comment|/*0x0020300c*/
id|OUTREG
c_func
(paren
l_int|0x2ec
comma
l_int|0x6332a3f0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|17
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_REF_DIV
comma
id|rinfo-&gt;pll.ref_div
)paren
suffix:semicolon
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPPLL_DIV_0
comma
id|rinfo-&gt;save_regs
(braket
l_int|92
)braket
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_or
id|LVDS_DIGON
op_or
id|LVDS_ON
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
multiline_comment|/* Restore a few more things */
id|OUTREG
c_func
(paren
id|GRPH_BUFFER_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|94
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GRPH2_BUFFER_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|95
)braket
)paren
suffix:semicolon
multiline_comment|/* Restore PPLL, spread spectrum &amp; LVDS */
id|radeon_pm_m10_disable_spread_spectrum
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_pm_restore_pixel_pll
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_pm_m10_enable_lvds_spread_spectrum
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* Not ready yet */
r_static
r_void
id|radeon_reinitialize_QW
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|tmp
comma
id|tmp2
suffix:semicolon
id|u32
id|cko
comma
id|cka
comma
id|ckb
suffix:semicolon
id|u32
id|cgc
comma
id|cec
comma
id|c2gc
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_AGP_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|31
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_DISPLAY_BASE_ADDR
comma
id|rinfo-&gt;save_regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_FB_LOCATION
comma
id|rinfo-&gt;save_regs
(braket
l_int|30
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|BUS_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|36
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|RBBM_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|39
)braket
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|PAD_CTLR_STRENGTH
comma
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
op_amp
op_complement
l_int|0x10000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|65
suffix:semicolon
op_increment
id|i
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|PAD_CTLR_STRENGTH
)paren
suffix:semicolon
)brace
id|OUTREG
c_func
(paren
id|DISP_TEST_DEBUG_CNTL
comma
id|INREG
c_func
(paren
id|DISP_TEST_DEBUG_CNTL
)paren
op_or
l_int|0x10000000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OV0_FLAG_CNTRL
comma
id|INREG
c_func
(paren
id|OV0_FLAG_CNTRL
)paren
op_or
l_int|0x100
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL
comma
l_int|0xff00410a
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DAC_CNTL2
comma
id|INREG
c_func
(paren
id|DAC_CNTL2
)paren
op_or
l_int|0x4000
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|SURFACE_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|29
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|AGP_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|HOST_PATH_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|41
)braket
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_MISC_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A0
comma
l_int|0xf7bb4433
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B0
comma
l_int|0xf7bb4433
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
id|INREG
c_func
(paren
id|CRTC_MORE_CNTL
)paren
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllVCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllPIXCLKS_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllPIXCLKS_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
l_int|0xaa3f0000
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
l_int|0xffff0000
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMPLL_AUX_CNTL
comma
l_int|6
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllSPLL_AUX_CNTL
comma
l_int|1
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MDLL_CKO
comma
l_int|0x9f009f
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MDLL_RDCKA
comma
l_int|0x830083
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
l_int|0x830083
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_CNTL
comma
l_int|0xa433
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|P2PLL_CNTL
comma
l_int|0xa433
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MPLL_CNTL
comma
l_int|0x0400a403
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SPLL_CNTL
comma
l_int|0x0400a433
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
comma
id|tmp
op_or
l_int|0xc
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|MPLL_CNTL
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|MPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
comma
id|tmp
op_or
l_int|0x5900
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|MPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|MPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_CNTL
comma
l_int|0xaa3f1212
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|MCLK_CNTL
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|SPLL_CNTL
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|SPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|M_SPLL_REF_FB_DIV
comma
id|tmp
op_or
l_int|0x780000
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|SPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|SPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
id|tmp
op_or
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cko
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
suffix:semicolon
id|cka
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKA
)paren
suffix:semicolon
id|ckb
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_RDCKB
)paren
suffix:semicolon
id|cko
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_SLEEP
op_or
id|MDLL_CKO__MCKOB_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|cko
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cko
op_and_assign
op_complement
(paren
id|MDLL_CKO__MCKOA_RESET
op_or
id|MDLL_CKO__MCKOB_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|cko
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|cka
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_SLEEP
op_or
id|MDLL_RDCKA__MRDCKA1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|cka
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cka
op_and_assign
op_complement
(paren
id|MDLL_RDCKA__MRDCKA0_RESET
op_or
id|MDLL_RDCKA__MRDCKA1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKA
comma
id|cka
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|ckb
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_SLEEP
op_or
id|MDLL_RDCKB__MRDCKB1_SLEEP
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|ckb
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|ckb
op_and_assign
op_complement
(paren
id|MDLL_RDCKB__MRDCKB0_RESET
op_or
id|MDLL_RDCKB__MRDCKB1_RESET
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_RDCKB
comma
id|ckb
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
l_int|0x151550ff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
l_int|0x151550ff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_A1
comma
l_int|0x141550ff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_CHP_IO_CNTL_B1
comma
l_int|0x141550ff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllHTOTAL_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllHTOTAL2_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_CNTL
comma
l_int|0x29002901
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_SDRAM_MODE_REG
comma
l_int|0x45320032
)paren
suffix:semicolon
multiline_comment|/* XXX use save_regs[35]? */
id|OUTREG
c_func
(paren
id|EXT_MEM_CNTL
comma
l_int|0x1a394333
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_IO_CNTL_A1
comma
l_int|0x0aac0aac
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_INIT_LATENCY_TIMER
comma
l_int|0x34444444
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_REFRESH_CNTL
comma
l_int|0x1f1f7218
)paren
suffix:semicolon
multiline_comment|/* XXX or save_regs[42]? */
id|OUTREG
c_func
(paren
id|MC_DEBUG
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MEM_IO_OE_CNTL
comma
l_int|0x04300430
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL
comma
l_int|0x00f460d6
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTMC
c_func
(paren
id|rinfo
comma
id|ixMC_IMP_CNTL_0
comma
l_int|0x00009249
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|MC_IND_INDEX
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CONFIG_MEMSIZE
comma
id|rinfo-&gt;video_ram
)paren
suffix:semicolon
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_CNTL
comma
l_int|0x01000000
)paren
suffix:semicolon
multiline_comment|/* XXX ? */
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
id|FP_CRTC_DONT_SHADOW_HEND
op_or
id|FP_CRTC_DONT_SHADOW_VPAR
op_or
l_int|0x200
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|DISP_OUTPUT_CNTL
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x400
suffix:semicolon
id|OUTREG
c_func
(paren
id|DISP_OUTPUT_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PIN_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|CLK_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PLL_PWRMGT_CNTL
comma
id|rinfo-&gt;save_regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|MCLK_MISC
)paren
suffix:semicolon
id|tmp
op_or_assign
id|MCLK_MISC__MC_MCLK_DYN_ENABLE
op_or
id|MCLK_MISC__IO_MCLK_DYN_ENABLE
suffix:semicolon
id|OUTPLL
c_func
(paren
id|MCLK_MISC
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|SCLK_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|SCLK_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|1
comma
l_int|6
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_PITCH
comma
l_int|32
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|PPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_CNTL
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* palette stuff and BIOS_1_SCRATCH... */
id|tmp
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|tmp2
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|tmp
op_or_assign
l_int|2
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|tmp2
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CRTC_MORE_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_MORE_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|cgc
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|cec
op_assign
id|INREG
c_func
(paren
id|CRTC_EXT_CNTL
)paren
suffix:semicolon
id|c2gc
op_assign
id|INREG
c_func
(paren
id|CRTC2_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_SYNC_STRT_WID
comma
l_int|0x008e0580
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_H_TOTAL_DISP
comma
l_int|0x009f00d2
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|HTOTAL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_SYNC_STRT_WID
comma
l_int|0x00830403
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_V_TOTAL_DISP
comma
l_int|0x03ff0429
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_CRTC_H_TOTAL_DISP
comma
l_int|0x009f0033
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_H_SYNC_STRT_WID
comma
l_int|0x008e0080
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRT_CRTC_H_SYNC_STRT_WID
comma
l_int|0x008e0080
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_CRTC_V_TOTAL_DISP
comma
l_int|0x03ff002a
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_V_SYNC_STRT_WID
comma
l_int|0x00830004
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRT_CRTC_V_SYNC_STRT_WID
comma
l_int|0x00830004
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_HORZ_VERT_ACTIVE
comma
l_int|0x009f03ff
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_HORZ_STRETCH
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_VERT_STRETCH
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OVR_CLR
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OVR_WID_LEFT_RIGHT
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|OVR_WID_TOP_BOTTOM
comma
l_int|0
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|PPLL_REF_DIV
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
op_complement
id|PPLL_REF_DIV_MASK
)paren
op_or
id|rinfo-&gt;pll.ref_div
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_REF_DIV
comma
id|tmp
)paren
suffix:semicolon
id|INPLL
c_func
(paren
id|PPLL_REF_DIV
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|PPLL_CNTL
op_plus
id|PLL_WR_EN
)paren
suffix:semicolon
id|OUTREG8
c_func
(paren
id|CLOCK_CNTL_DATA
op_plus
l_int|1
comma
l_int|0xbc
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|CLOCK_CNTL_INDEX
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CLOCK_CNTL_INDEX
comma
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_DIV_0
comma
l_int|0x48090
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|PPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|PPLL_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|PPLL_CNTL
comma
id|tmp
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|tmp
op_or
l_int|3
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_assign
id|INPLL
c_func
(paren
id|VCLK_ECP_CNTL
)paren
suffix:semicolon
id|OUTPLL
c_func
(paren
id|VCLK_ECP_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|c2gc
op_or_assign
id|CRTC2_DISP_REQ_EN_B
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC2_GEN_CNTL
comma
id|c2gc
)paren
suffix:semicolon
id|cgc
op_or_assign
id|CRTC_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_GEN_CNTL
comma
id|cgc
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_EXT_CNTL
comma
id|cec
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_PITCH
comma
l_int|0xa0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CRTC_OFFSET_CNTL
comma
l_int|0
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GRPH_BUFFER_CNTL
comma
l_int|0x20117c7c
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|GRPH2_BUFFER_CNTL
comma
l_int|0x00205c5c
)paren
suffix:semicolon
id|tmp2
op_assign
id|INREG
c_func
(paren
id|FP_GEN_CNTL
)paren
suffix:semicolon
id|tmp
op_assign
id|INREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
l_int|0x2a8
comma
l_int|0x0000061b
)paren
suffix:semicolon
id|tmp
op_or_assign
id|TMDS_PLL_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|TMDS_PLLRST
suffix:semicolon
id|OUTREG
c_func
(paren
id|TMDS_TRANSMITTER_CNTL
comma
id|tmp
)paren
suffix:semicolon
id|tmp2
op_and_assign
op_complement
l_int|2
suffix:semicolon
id|tmp2
op_or_assign
id|FP_TMDS_EN
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|tmp2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|tmp2
op_or_assign
id|FP_FPON
suffix:semicolon
id|OUTREG
c_func
(paren
id|FP_GEN_CNTL
comma
id|tmp2
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CUR_HORZ_VERT_OFF
comma
id|CUR_LOCK
op_or
l_int|1
)paren
suffix:semicolon
id|cgc
op_assign
id|INREG
c_func
(paren
id|CRTC_GEN_CNTL
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|CUR_HORZ_VERT_POSN
comma
l_int|0xbfff0fff
)paren
suffix:semicolon
id|cgc
op_or_assign
l_int|0x10000
suffix:semicolon
id|OUTREG
c_func
(paren
id|CUR_OFFSET
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif /* 0 */
macro_line|#endif /* CONFIG_PPC_OF */
DECL|function|radeon_set_suspend
r_static
r_void
id|radeon_set_suspend
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|suspend
)paren
(brace
id|u16
id|pwr_cmd
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;pm_reg
)paren
r_return
suffix:semicolon
multiline_comment|/* Set the chip into appropriate suspend mode (we use D2,&n;&t; * D3 would require a compete re-initialization of the chip,&n;&t; * including PCI config registers, clocks, AGP conf, ...)&n;&t; */
r_if
c_cond
(paren
id|suspend
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: switching to D2 state...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Disable dynamic power management of clocks for the&n;&t;&t; * duration of the suspend/resume process&n;&t;&t; */
id|radeon_pm_disable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Save some registers */
id|radeon_pm_save_regs
c_func
(paren
id|rinfo
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Prepare mobility chips for suspend.&n;&t;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
)paren
(brace
multiline_comment|/* Program V2CLK */
id|radeon_pm_program_v2clk
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Disable IO PADs */
id|radeon_pm_disable_iopad
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Set low current */
id|radeon_pm_low_current
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Prepare chip for power management */
id|radeon_pm_setup_for_suspend
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV280
)paren
(brace
multiline_comment|/* Reset the MDLL */
multiline_comment|/* because both INPLL and OUTPLL take the same&n;&t;&t;&t;&t; * lock, that&squot;s why. */
id|tmp
op_assign
id|INPLL
c_func
(paren
id|pllMDLL_CKO
)paren
op_or
id|MDLL_CKO__MCKOA_RESET
op_or
id|MDLL_CKO__MCKOB_RESET
suffix:semicolon
id|OUTPLL
c_func
(paren
id|pllMDLL_CKO
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
op_increment
id|i
)paren
id|pci_read_config_dword
c_func
(paren
id|rinfo-&gt;pdev
comma
id|i
op_star
l_int|4
comma
op_amp
id|rinfo-&gt;cfg_save
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Switch PCI power managment to D2. */
id|pci_disable_device
c_func
(paren
id|rinfo-&gt;pdev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|pci_read_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
op_amp
id|pwr_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pwr_cmd
op_amp
l_int|2
)paren
r_break
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
(paren
id|pwr_cmd
op_amp
op_complement
id|PCI_PM_CTRL_STATE_MASK
)paren
op_or
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb: switching to D0 state...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Switch back PCI powermanagment to D0 */
id|mdelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|rinfo-&gt;pm_reg
op_plus
id|PCI_PM_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV250
)paren
(brace
multiline_comment|/* Reset the SDRAM controller  */
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* Restore some registers */
id|radeon_pm_restore_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Restore registers first */
id|radeon_pm_restore_regs
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* init sdram controller */
id|radeon_pm_full_reset_sdram
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|radeon_restore_pci_cfg
r_static
r_int
id|radeon_restore_pci_cfg
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
suffix:semicolon
r_static
id|u32
id|radeon_cfg_after_resume
(braket
l_int|64
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
op_increment
id|i
)paren
id|pci_read_config_dword
c_func
(paren
id|rinfo-&gt;pdev
comma
id|i
op_star
l_int|4
comma
op_amp
id|radeon_cfg_after_resume
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_cfg_after_resume
(braket
id|PCI_BASE_ADDRESS_0
op_div
l_int|4
)braket
op_eq
id|rinfo-&gt;cfg_save
(braket
id|PCI_BASE_ADDRESS_0
op_div
l_int|4
)braket
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* assume everything is ok */
r_for
c_loop
(paren
id|i
op_assign
id|PCI_BASE_ADDRESS_0
op_div
l_int|4
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|radeon_cfg_after_resume
(braket
id|i
)braket
op_ne
id|rinfo-&gt;cfg_save
(braket
id|i
)braket
)paren
id|pci_write_config_dword
c_func
(paren
id|rinfo-&gt;pdev
comma
id|i
op_star
l_int|4
comma
id|rinfo-&gt;cfg_save
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
id|rinfo-&gt;cfg_save
(braket
id|PCI_CACHE_LINE_SIZE
op_div
l_int|4
)braket
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|rinfo-&gt;pdev
comma
id|PCI_COMMAND
comma
id|rinfo-&gt;cfg_save
(braket
id|PCI_COMMAND
op_div
l_int|4
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|susdisking
r_static
multiline_comment|/*extern*/
r_int
id|susdisking
op_assign
l_int|0
suffix:semicolon
DECL|function|radeonfb_pci_suspend
r_int
id|radeonfb_pci_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|info-&gt;par
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|pdev-&gt;dev.power.power_state
)paren
r_return
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb (%s): suspending to state: %d...&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
comma
id|state
)paren
suffix:semicolon
multiline_comment|/* For suspend-to-disk, we cheat here. We don&squot;t suspend anything and&n;&t; * let fbcon continue drawing until we are all set. That shouldn&squot;t&n;&t; * really cause any problem at this point, provided that the wakeup&n;&t; * code knows that any state in memory may not match the HW&n;&t; */
r_if
c_cond
(paren
id|state
op_ne
id|PM_SUSPEND_MEM
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|susdisking
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;suspending to disk but state = %d&bslash;n&quot;
comma
id|state
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
multiline_comment|/* Make sure engine is reset */
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
id|radeonfb_engine_reset
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Blank display and LCD */
id|radeon_screen_blank
c_func
(paren
id|rinfo
comma
id|FB_BLANK_POWERDOWN
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Sleep */
id|rinfo-&gt;asleep
op_assign
l_int|1
suffix:semicolon
id|rinfo-&gt;lock_blank
op_assign
l_int|1
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|rinfo-&gt;lvds_timer
)paren
suffix:semicolon
multiline_comment|/* If we support wakeup from poweroff, we save all regs we can including cfg&n;&t; * space&n;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;pm_mode
op_amp
id|radeon_pm_off
)paren
(brace
multiline_comment|/* Always disable dynamic clocks or weird things are happening when&n;&t;&t; * the chip goes off (basically the panel doesn&squot;t shut down properly&n;&t;&t; * and we crash on wakeup),&n;&t;&t; * also, we want the saved regs context to have no dynamic clocks in&n;&t;&t; * it, we&squot;ll restore the dynamic clocks state on wakeup&n;&t;&t; */
id|radeon_pm_disable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|radeon_pm_save_regs
c_func
(paren
id|rinfo
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
op_logical_and
op_logical_neg
(paren
id|rinfo-&gt;pm_mode
op_amp
id|radeon_pm_d2
)paren
)paren
(brace
multiline_comment|/* Switch off LVDS interface */
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_amp
op_complement
(paren
id|LVDS_BL_MOD_EN
)paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_amp
op_complement
(paren
id|LVDS_EN
op_or
id|LVDS_ON
)paren
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_PLL_CNTL
comma
(paren
id|INREG
c_func
(paren
id|LVDS_PLL_CNTL
)paren
op_amp
op_complement
l_int|30000
)paren
op_or
l_int|0x20000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|OUTREG
c_func
(paren
id|LVDS_GEN_CNTL
comma
id|INREG
c_func
(paren
id|LVDS_GEN_CNTL
)paren
op_amp
op_complement
(paren
id|LVDS_DIGON
)paren
)paren
suffix:semicolon
singleline_comment|// FIXME: Use PCI layer
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
op_increment
id|i
)paren
id|pci_read_config_dword
c_func
(paren
id|rinfo-&gt;pdev
comma
id|i
op_star
l_int|4
comma
op_amp
id|rinfo-&gt;cfg_save
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* If we support D2, we go to it (should be fixed later with a flag forcing&n;&t; * D3 only for some laptops)&n;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;pm_mode
op_amp
id|radeon_pm_d2
)paren
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|1
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|done
suffix:colon
id|pdev-&gt;dev.power.power_state
op_assign
id|state
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeonfb_pci_resume
r_int
id|radeonfb_pci_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|info-&gt;par
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;dev.power.power_state
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;no_schedule
)paren
(brace
r_if
c_cond
(paren
id|try_acquire_console_sem
c_func
(paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;radeonfb (%s): resuming from state: %d...&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
comma
id|pdev-&gt;dev.power.power_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb (%s): can&squot;t enable PCI device !&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
r_goto
id|bail
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;dev.power.power_state
op_eq
id|PM_SUSPEND_MEM
)paren
(brace
multiline_comment|/* Wakeup chip. Check from config space if we were powered off&n;&t;&t; * (todo: additionally, check CLK_PIN_CNTL too)&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|rinfo-&gt;pm_mode
op_amp
id|radeon_pm_off
)paren
op_logical_and
id|radeon_restore_pci_cfg
c_func
(paren
id|rinfo
)paren
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;reinit_func
op_ne
l_int|NULL
)paren
id|rinfo
op_member_access_from_pointer
id|reinit_func
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;radeonfb (%s): can&squot;t resume radeon from&quot;
l_string|&quot; D3 cold, need softboot !&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|bail
suffix:semicolon
)brace
)brace
multiline_comment|/* If we support D2, try to resume... we should check what was our&n;&t;&t; * state though... (were we really in D2 state ?). Right now, this code&n;&t;&t; * is only enable on Macs so it&squot;s fine.&n;&t;&t; */
r_else
r_if
c_cond
(paren
id|rinfo-&gt;pm_mode
op_amp
id|radeon_pm_d2
)paren
id|radeon_set_suspend
c_func
(paren
id|rinfo
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;asleep
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|radeon_engine_idle
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Restore display &amp; engine */
id|radeon_write_mode
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;state
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
id|radeonfb_engine_init
(paren
id|rinfo
)paren
suffix:semicolon
id|fb_pan_display
c_func
(paren
id|info
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
id|fb_set_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
id|info
)paren
suffix:semicolon
multiline_comment|/* Refresh */
id|fb_set_suspend
c_func
(paren
id|info
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Unblank */
id|rinfo-&gt;lock_blank
op_assign
l_int|0
suffix:semicolon
id|radeon_screen_blank
c_func
(paren
id|rinfo
comma
id|FB_BLANK_UNBLANK
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Check status of dynclk */
r_if
c_cond
(paren
id|rinfo-&gt;dynclk
op_eq
l_int|1
)paren
id|radeon_pm_enable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rinfo-&gt;dynclk
op_eq
l_int|0
)paren
id|radeon_pm_disable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|pdev-&gt;dev.power.power_state
op_assign
l_int|0
suffix:semicolon
id|bail
suffix:colon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PPC_OF
DECL|function|radeonfb_early_resume
r_static
r_void
id|radeonfb_early_resume
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|radeonfb_info
op_star
id|rinfo
op_assign
id|data
suffix:semicolon
id|rinfo-&gt;no_schedule
op_assign
l_int|1
suffix:semicolon
id|radeonfb_pci_resume
c_func
(paren
id|rinfo-&gt;pdev
)paren
suffix:semicolon
id|rinfo-&gt;no_schedule
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PPC_OF */
macro_line|#endif /* CONFIG_PM */
DECL|function|radeonfb_pm_init
r_void
id|radeonfb_pm_init
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
comma
r_int
id|dynclk
)paren
(brace
multiline_comment|/* Find PM registers in config space if any*/
id|rinfo-&gt;pm_reg
op_assign
id|pci_find_capability
c_func
(paren
id|rinfo-&gt;pdev
comma
id|PCI_CAP_ID_PM
)paren
suffix:semicolon
multiline_comment|/* Enable/Disable dynamic clocks: TODO add sysfs access */
id|rinfo-&gt;dynclk
op_assign
id|dynclk
suffix:semicolon
r_if
c_cond
(paren
id|dynclk
op_eq
l_int|1
)paren
(brace
id|radeon_pm_enable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: Dynamic Clock Power Management enabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dynclk
op_eq
l_int|0
)paren
(brace
id|radeon_pm_disable_dynamic_mode
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;radeonfb: Dynamic Clock Power Management disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if we can power manage on suspend/resume. We can do&n;&t; * D2 on M6, M7 and M9, and we can resume from D3 cold a few other&n;&t; * &quot;Mac&quot; cards, but that&squot;s all. We need more infos about what the&n;&t; * BIOS does tho. Right now, all this PM stuff is pmac-only for that&n;&t; * reason. --BenH&n;&t; */
macro_line|#if defined(CONFIG_PM) &amp;&amp; defined(CONFIG_PPC_OF)
r_if
c_cond
(paren
id|_machine
op_eq
id|_MACH_Pmac
op_logical_and
id|rinfo-&gt;of_node
)paren
(brace
r_if
c_cond
(paren
id|rinfo-&gt;is_mobility
op_logical_and
id|rinfo-&gt;pm_reg
op_logical_and
id|rinfo-&gt;family
op_le
id|CHIP_FAMILY_RV250
)paren
id|rinfo-&gt;pm_mode
op_or_assign
id|radeon_pm_d2
suffix:semicolon
multiline_comment|/* We can restart Jasper (M10 chip in albooks), BlueStone (7500 chip&n;&t;&t; * in some desktop G4s), and Via (M9+ chip on iBook G4)&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|rinfo-&gt;of_node-&gt;name
comma
l_string|&quot;ATY,JasperParent&quot;
)paren
)paren
(brace
id|rinfo-&gt;reinit_func
op_assign
id|radeon_reinitialize_M10
suffix:semicolon
id|rinfo-&gt;pm_mode
op_or_assign
id|radeon_pm_off
suffix:semicolon
)brace
macro_line|#if 0 /* Not ready yet */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|rinfo-&gt;of_node-&gt;name
comma
l_string|&quot;ATY,BlueStoneParent&quot;
)paren
)paren
(brace
id|rinfo-&gt;reinit_func
op_assign
id|radeon_reinitialize_QW
suffix:semicolon
id|rinfo-&gt;pm_mode
op_or_assign
id|radeon_pm_off
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|rinfo-&gt;of_node-&gt;name
comma
l_string|&quot;ATY,ViaParent&quot;
)paren
)paren
(brace
id|rinfo-&gt;reinit_func
op_assign
id|radeon_reinitialize_M9P
suffix:semicolon
id|rinfo-&gt;pm_mode
op_or_assign
id|radeon_pm_off
suffix:semicolon
multiline_comment|/* Workaround not used for now */
id|rinfo-&gt;m9p_workaround
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* If any of the above is set, we assume the machine can sleep/resume.&n;&t;&t; * It&squot;s a bit of a &quot;shortcut&quot; but will work fine. Ideally, we need infos&n;&t;&t; * from the platform about what happens to the chip...&n;&t;&t; * Now we tell the platform about our capability&n;&t;&t; */
r_if
c_cond
(paren
id|rinfo-&gt;pm_mode
op_ne
id|radeon_pm_none
)paren
(brace
id|pmac_call_feature
c_func
(paren
id|PMAC_FTR_DEVICE_CAN_WAKE
comma
id|rinfo-&gt;of_node
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|pmac_set_early_video_resume
c_func
(paren
id|radeonfb_early_resume
comma
id|rinfo
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Power down TV DAC, taht saves a significant amount of power,&n;&t;&t; * we&squot;ll have something better once we actually have some TVOut&n;&t;&t; * support&n;&t;&t; */
id|OUTREG
c_func
(paren
id|TV_DAC_CNTL
comma
id|INREG
c_func
(paren
id|TV_DAC_CNTL
)paren
op_or
l_int|0x07000000
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* defined(CONFIG_PM) &amp;&amp; defined(CONFIG_PPC_OF) */
)brace
DECL|function|radeonfb_pm_exit
r_void
id|radeonfb_pm_exit
c_func
(paren
r_struct
id|radeonfb_info
op_star
id|rinfo
)paren
(brace
macro_line|#if defined(CONFIG_PM) &amp;&amp; defined(CONFIG_PPC_OF)
r_if
c_cond
(paren
id|rinfo-&gt;pm_mode
op_ne
id|radeon_pm_none
)paren
id|pmac_set_early_video_resume
c_func
(paren
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
