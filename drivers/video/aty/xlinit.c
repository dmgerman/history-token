multiline_comment|/*&n; *  ATI Rage XL Initialization. Support for Xpert98 and Victoria&n; *  PCI cards.&n; *&n; *  Copyright (C) 2002 MontaVista Software Inc.&n; *  Author: MontaVista Software, Inc.&n; *         &t;stevel@mvista.com or source@mvista.com&n; *&n; *  This program is free software; you can redistribute  it and/or modify it&n; *  under  the terms of  the GNU General  Public License as published by the&n; *  Free Software Foundation;  either version 2 of the  License, or (at your&n; *  option) any later version.&n; *&n; *  THIS  SOFTWARE  IS PROVIDED   ``AS  IS&squot;&squot; AND   ANY  EXPRESS OR IMPLIED&n; *  WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN&n; *  NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; *  NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF&n; *  USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; *  ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT&n; *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; *  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the  GNU General Public License along&n; *  with this program; if not, write  to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt; 
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;video/mach64.h&gt;
macro_line|#include &quot;atyfb.h&quot;
DECL|macro|MPLL_GAIN
mdefine_line|#define MPLL_GAIN       0xad
DECL|macro|VPLL_GAIN
mdefine_line|#define VPLL_GAIN       0xd5
r_enum
(brace
DECL|enumerator|VICTORIA
id|VICTORIA
op_assign
l_int|0
comma
DECL|enumerator|XPERT98
id|XPERT98
comma
DECL|enumerator|NUM_XL_CARDS
id|NUM_XL_CARDS
)brace
suffix:semicolon
r_extern
r_const
r_struct
id|aty_pll_ops
id|aty_pll_ct
suffix:semicolon
DECL|macro|DEFAULT_CARD
mdefine_line|#define DEFAULT_CARD XPERT98
DECL|variable|xl_card
r_static
r_int
id|xl_card
op_assign
id|DEFAULT_CARD
suffix:semicolon
DECL|struct|xl_card_cfg_t
r_static
r_const
r_struct
id|xl_card_cfg_t
(brace
DECL|member|ref_crystal
r_int
id|ref_crystal
suffix:semicolon
singleline_comment|// 10^4 Hz
DECL|member|mem_type
r_int
id|mem_type
suffix:semicolon
DECL|member|mem_size
r_int
id|mem_size
suffix:semicolon
DECL|member|mem_cntl
id|u32
id|mem_cntl
suffix:semicolon
DECL|member|ext_mem_cntl
id|u32
id|ext_mem_cntl
suffix:semicolon
DECL|member|mem_addr_config
id|u32
id|mem_addr_config
suffix:semicolon
DECL|member|bus_cntl
id|u32
id|bus_cntl
suffix:semicolon
DECL|member|dac_cntl
id|u32
id|dac_cntl
suffix:semicolon
DECL|member|hw_debug
id|u32
id|hw_debug
suffix:semicolon
DECL|member|custom_macro_cntl
id|u32
id|custom_macro_cntl
suffix:semicolon
DECL|member|dll2_cntl
id|u8
id|dll2_cntl
suffix:semicolon
DECL|member|pll_yclk_cntl
id|u8
id|pll_yclk_cntl
suffix:semicolon
DECL|variable|card_cfg
)brace
id|card_cfg
(braket
id|NUM_XL_CARDS
)braket
op_assign
(brace
singleline_comment|// VICTORIA
(brace
l_int|2700
comma
id|SDRAM
comma
l_int|0x800000
comma
l_int|0x10757A3B
comma
l_int|0x64000C81
comma
l_int|0x00110202
comma
l_int|0x7b33A040
comma
l_int|0x82010102
comma
l_int|0x48803800
comma
l_int|0x005E0179
comma
l_int|0x50
comma
l_int|0x25
)brace
comma
singleline_comment|// XPERT98
(brace
l_int|1432
comma
id|WRAM
comma
l_int|0x800000
comma
l_int|0x00165A2B
comma
l_int|0xE0000CF1
comma
l_int|0x00200213
comma
l_int|0x7333A001
comma
l_int|0x8000000A
comma
l_int|0x48833800
comma
l_int|0x007F0779
comma
l_int|0x10
comma
l_int|0x19
)brace
)brace
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|lcd_reg
id|u8
id|lcd_reg
suffix:semicolon
DECL|member|val
id|u32
id|val
suffix:semicolon
DECL|typedef|lcd_tbl_t
)brace
id|lcd_tbl_t
suffix:semicolon
DECL|variable|lcd_tbl
r_static
r_const
id|lcd_tbl_t
id|lcd_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x01
comma
l_int|0x000520C0
)brace
comma
(brace
l_int|0x08
comma
l_int|0x02000408
)brace
comma
(brace
l_int|0x03
comma
l_int|0x00000F00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x02
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x04
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x05
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x06
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x33
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x34
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x35
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x36
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x37
comma
l_int|0x00000000
)brace
)brace
suffix:semicolon
DECL|function|reset_gui
r_static
r_void
id|reset_gui
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x01
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x02
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
DECL|function|reset_sdram
r_static
r_void
id|reset_sdram
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
id|u8
id|temp
suffix:semicolon
id|temp
op_assign
id|aty_ld_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|par
)paren
suffix:semicolon
id|temp
op_or_assign
l_int|0x02
suffix:semicolon
id|aty_st_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|temp
comma
id|par
)paren
suffix:semicolon
singleline_comment|// MEM_SDRAM_RESET = 1b
id|temp
op_or_assign
l_int|0x08
suffix:semicolon
id|aty_st_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|temp
comma
id|par
)paren
suffix:semicolon
singleline_comment|// MEM_CYC_TEST    = 10b
id|temp
op_or_assign
l_int|0x0c
suffix:semicolon
id|aty_st_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|temp
comma
id|par
)paren
suffix:semicolon
singleline_comment|// MEM_CYC_TEST    = 11b
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|temp
op_and_assign
l_int|0xf3
suffix:semicolon
id|aty_st_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|temp
comma
id|par
)paren
suffix:semicolon
singleline_comment|// MEM_CYC_TEST    = 00b
id|temp
op_and_assign
l_int|0xfd
suffix:semicolon
id|aty_st_8
c_func
(paren
id|EXT_MEM_CNTL
comma
id|temp
comma
id|par
)paren
suffix:semicolon
singleline_comment|// MEM_SDRAM_REST  = 0b
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
DECL|function|init_dll
r_static
r_void
id|init_dll
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
)paren
(brace
singleline_comment|// enable DLL
id|aty_st_pll_ct
c_func
(paren
id|PLL_GEN_CNTL
comma
id|aty_ld_pll_ct
c_func
(paren
id|PLL_GEN_CNTL
comma
id|par
)paren
op_amp
l_int|0x7f
comma
id|par
)paren
suffix:semicolon
singleline_comment|// reset DLL
id|aty_st_pll_ct
c_func
(paren
id|DLL_CNTL
comma
l_int|0x82
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|DLL_CNTL
comma
l_int|0xE2
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|DLL_CNTL
comma
l_int|0x82
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|6
)paren
suffix:semicolon
)brace
DECL|function|reset_clocks
r_static
r_void
id|reset_clocks
c_func
(paren
r_struct
id|atyfb_par
op_star
id|par
comma
r_struct
id|pll_ct
op_star
id|pll
comma
r_int
id|hsync_enb
)paren
(brace
id|reset_gui
c_func
(paren
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|MCLK_FB_DIV
comma
id|pll-&gt;mclk_fb_div
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|SCLK_FB_DIV
comma
id|pll-&gt;sclk_fb_div
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|init_dll
c_func
(paren
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|0x04
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|reset_sdram
c_func
(paren
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
id|hsync_enb
ques
c_cond
l_int|0x00
suffix:colon
l_int|0x04
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|SPLL_CNTL2
comma
id|pll-&gt;spll_cntl2
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_GEN_CNTL
comma
id|pll-&gt;pll_gen_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_VCLK_CNTL
comma
id|pll-&gt;pll_vclk_cntl
comma
id|par
)paren
suffix:semicolon
)brace
DECL|function|atyfb_xl_init
r_int
id|atyfb_xl_init
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_const
r_struct
id|xl_card_cfg_t
op_star
id|card
op_assign
op_amp
id|card_cfg
(braket
id|xl_card
)braket
suffix:semicolon
r_struct
id|atyfb_par
op_star
id|par
op_assign
(paren
r_struct
id|atyfb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_union
id|aty_pll
id|pll
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|u32
id|temp
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CONFIG_STAT0
comma
l_int|0x85
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The following needs to be set before the call&n;&t; * to var_to_pll() below. They&squot;ll be re-set again&n;&t; * to the same values in aty_init().&n;&t; */
id|par-&gt;ref_clk_per
op_assign
l_int|100000000UL
op_div
id|card-&gt;ref_crystal
suffix:semicolon
id|par-&gt;ram_type
op_assign
id|card-&gt;mem_type
suffix:semicolon
id|info-&gt;fix.smem_len
op_assign
id|card-&gt;mem_size
suffix:semicolon
r_if
c_cond
(paren
id|xl_card
op_eq
id|VICTORIA
)paren
(brace
singleline_comment|// the MCLK, XCLK are 120MHz on victoria card
id|par-&gt;mclk_per
op_assign
l_int|1000000
op_div
l_int|120
suffix:semicolon
id|par-&gt;xclk_per
op_assign
l_int|1000000
op_div
l_int|120
suffix:semicolon
id|par-&gt;features
op_and_assign
op_complement
id|M64F_MFB_FORCE_4
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Calculate mclk and xclk dividers, etc. The passed&n;&t; * pixclock and bpp values don&squot;t matter yet, the vclk&n;&t; * isn&squot;t programmed until later.&n;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|aty_pll_ct
dot
id|var_to_pll
c_func
(paren
id|info
comma
l_int|39726
comma
l_int|8
comma
op_amp
id|pll
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|LVDS_CNTL0
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|DLL2_CNTL
comma
id|card-&gt;dll2_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|V2PLL_CNTL
comma
l_int|0x10
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|MPLL_CNTL
comma
id|MPLL_GAIN
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VPLL_CNTL
comma
id|VPLL_GAIN
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_VCLK_CNTL
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VFC_CNTL
comma
l_int|0x1B
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_REF_DIV
comma
id|pll.ct.pll_ref_div
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_EXT_CNTL
comma
id|pll.ct.pll_ext_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|SPLL_CNTL2
comma
l_int|0x03
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_GEN_CNTL
comma
l_int|0x44
comma
id|par
)paren
suffix:semicolon
id|reset_clocks
c_func
(paren
id|par
comma
op_amp
id|pll.ct
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK_POST_DIV
comma
l_int|0x03
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK0_FB_DIV
comma
l_int|0xDA
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK_POST_DIV
comma
l_int|0x0F
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK1_FB_DIV
comma
l_int|0xF5
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK_POST_DIV
comma
l_int|0x3F
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_EXT_CNTL
comma
l_int|0x40
op_or
id|pll.ct.pll_ext_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK2_FB_DIV
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK_POST_DIV
comma
l_int|0xFF
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_EXT_CNTL
comma
l_int|0xC0
op_or
id|pll.ct.pll_ext_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|VCLK3_FB_DIV
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|BUS_CNTL
comma
l_int|0x01
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|BUS_CNTL
comma
id|card-&gt;bus_cntl
op_or
l_int|0x08000000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_GEN_CNTL
comma
l_int|0x04000200
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|CONFIG_STAT0
comma
l_int|0x0020
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
l_int|0x10151A33
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|EXT_MEM_CNTL
comma
l_int|0xE0000C01
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|2
comma
l_int|0x0000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|DAC_CNTL
comma
id|card-&gt;dac_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|GEN_TEST_CNTL
comma
l_int|0x0100
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CUSTOM_MACRO_CNTL
comma
l_int|0x003C0171
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|MEM_BUF_CNTL
comma
l_int|0x00382848
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|HW_DEBUG
comma
id|card-&gt;hw_debug
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|MEM_ADDR_CONFIG
comma
l_int|0x0000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|GP_IO
op_plus
l_int|2
comma
l_int|0x0000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|GEN_TEST_CNTL
comma
l_int|0x0000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|EXT_DAC_REGS
op_plus
l_int|2
comma
l_int|0x0000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|CRTC_INT_CNTL
comma
l_int|0x00000000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|TIMER_CONFIG
comma
l_int|0x00000000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
l_int|0xEC
comma
l_int|0x00000000
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
l_int|0xFC
comma
l_int|0x00000000
comma
id|par
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|lcd_tbl
)paren
op_div
r_sizeof
(paren
id|lcd_tbl_t
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|aty_st_lcd
c_func
(paren
id|lcd_tbl
(braket
id|i
)braket
dot
id|lcd_reg
comma
id|lcd_tbl
(braket
id|i
)braket
dot
id|val
comma
id|par
)paren
suffix:semicolon
)brace
id|aty_st_le16
c_func
(paren
id|CONFIG_STAT0
comma
l_int|0x00A4
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|BUS_CNTL
op_plus
l_int|1
comma
l_int|0xA0
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|reset_clocks
c_func
(paren
id|par
comma
op_amp
id|pll.ct
comma
l_int|1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
singleline_comment|// something about power management
id|aty_st_8
c_func
(paren
id|LCD_INDEX
comma
l_int|0x08
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_DATA
comma
l_int|0x0A
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_INDEX
comma
l_int|0x08
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_DATA
op_plus
l_int|3
comma
l_int|0x02
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_INDEX
comma
l_int|0x08
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_DATA
comma
l_int|0x0B
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
singleline_comment|// enable display requests, enable CRTC
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|0x02
comma
id|par
)paren
suffix:semicolon
singleline_comment|// disable display
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
comma
l_int|0x40
comma
id|par
)paren
suffix:semicolon
singleline_comment|// disable display requests, disable CRTC
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|0x04
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_YCLK_CNTL
comma
l_int|0x25
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|CUSTOM_MACRO_CNTL
comma
l_int|0x0179
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|CUSTOM_MACRO_CNTL
op_plus
l_int|2
comma
l_int|0x005E
comma
id|par
)paren
suffix:semicolon
id|aty_st_le16
c_func
(paren
id|CUSTOM_MACRO_CNTL
op_plus
l_int|2
comma
id|card-&gt;custom_macro_cntl
op_rshift
l_int|16
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CUSTOM_MACRO_CNTL
op_plus
l_int|1
comma
(paren
id|card-&gt;custom_macro_cntl
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|MEM_ADDR_CONFIG
comma
id|card-&gt;mem_addr_config
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|MEM_CNTL
comma
id|card-&gt;mem_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|EXT_MEM_CNTL
comma
id|card-&gt;ext_mem_cntl
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CONFIG_STAT0
comma
l_int|0xA0
op_or
id|card-&gt;mem_type
comma
id|par
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_YCLK_CNTL
comma
l_int|0x01
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|aty_st_pll_ct
c_func
(paren
id|PLL_YCLK_CNTL
comma
id|card-&gt;pll_yclk_cntl
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|reset_clocks
c_func
(paren
id|par
comma
op_amp
id|pll.ct
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|reset_clocks
c_func
(paren
id|par
comma
op_amp
id|pll.ct
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
singleline_comment|// enable extended register block
id|aty_st_8
c_func
(paren
id|BUS_CNTL
op_plus
l_int|3
comma
l_int|0x7B
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
singleline_comment|// disable extended register block
id|aty_st_8
c_func
(paren
id|BUS_CNTL
op_plus
l_int|3
comma
l_int|0x73
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|CONFIG_STAT0
comma
l_int|0x80
op_or
id|card-&gt;mem_type
comma
id|par
)paren
suffix:semicolon
singleline_comment|// disable display requests, disable CRTC
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|0x04
comma
id|par
)paren
suffix:semicolon
singleline_comment|// disable mapping registers in VGA aperture
id|aty_st_8
c_func
(paren
id|CONFIG_CNTL
comma
id|aty_ld_8
c_func
(paren
id|CONFIG_CNTL
comma
id|par
)paren
op_amp
op_complement
l_int|0x04
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
singleline_comment|// enable display requests, enable CRTC
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
op_plus
l_int|3
comma
l_int|0x02
comma
id|par
)paren
suffix:semicolon
singleline_comment|// make GPIO&squot;s 14,15,16 all inputs
id|aty_st_8
c_func
(paren
id|LCD_INDEX
comma
l_int|0x07
comma
id|par
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|LCD_DATA
op_plus
l_int|3
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
singleline_comment|// enable the display
id|aty_st_8
c_func
(paren
id|CRTC_GEN_CNTL
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|17
)paren
suffix:semicolon
singleline_comment|// reset the memory controller
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x02
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|aty_st_8
c_func
(paren
id|GEN_TEST_CNTL
op_plus
l_int|1
comma
l_int|0x00
comma
id|par
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
singleline_comment|// enable extended register block
id|aty_st_8
c_func
(paren
id|BUS_CNTL
op_plus
l_int|3
comma
(paren
id|u8
)paren
(paren
id|aty_ld_8
c_func
(paren
id|BUS_CNTL
op_plus
l_int|3
comma
id|par
)paren
op_or
l_int|0x08
)paren
comma
id|par
)paren
suffix:semicolon
singleline_comment|// set FIFO size to 512 (PIO)
id|aty_st_le32
c_func
(paren
id|GUI_CNTL
comma
id|aty_ld_le32
c_func
(paren
id|GUI_CNTL
comma
id|par
)paren
op_amp
op_complement
l_int|0x3
comma
id|par
)paren
suffix:semicolon
singleline_comment|// enable CRT and disable lcd
id|aty_st_8
c_func
(paren
id|LCD_INDEX
comma
l_int|0x01
comma
id|par
)paren
suffix:semicolon
id|temp
op_assign
id|aty_ld_le32
c_func
(paren
id|LCD_DATA
comma
id|par
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_or
l_int|0x01
)paren
op_amp
op_complement
l_int|0x02
suffix:semicolon
id|aty_st_le32
c_func
(paren
id|LCD_DATA
comma
id|temp
comma
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
