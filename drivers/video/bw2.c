multiline_comment|/* bw2.c: BWTWO frame buffer driver&n; *&n; * Copyright (C) 2003 David S. Miller (davem@redhat.com)&n; * Copyright (C) 1996,1998 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1996 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1997 Eddie C. Dost (ecd@skynet.be)&n; *&n; * Driver layout based loosely on tgafb.c, see that file for credits.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#ifdef CONFIG_SPARC32
macro_line|#include &lt;asm/sun4paddr.h&gt;
macro_line|#endif
macro_line|#include &quot;sbuslib.h&quot;
multiline_comment|/*&n; * Local functions.&n; */
r_static
r_int
id|bw2_blank
c_func
(paren
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|bw2_mmap
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|bw2_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *  Frame buffer operations&n; */
DECL|variable|bw2_ops
r_static
r_struct
id|fb_ops
id|bw2_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_blank
op_assign
id|bw2_blank
comma
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
comma
dot
id|fb_mmap
op_assign
id|bw2_mmap
comma
dot
id|fb_ioctl
op_assign
id|bw2_ioctl
comma
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/* OBio addresses for the bwtwo registers */
DECL|macro|BWTWO_REGISTER_OFFSET
mdefine_line|#define BWTWO_REGISTER_OFFSET 0x400000
DECL|struct|bt_regs
r_struct
id|bt_regs
(brace
DECL|member|addr
r_volatile
id|u32
id|addr
suffix:semicolon
DECL|member|color_map
r_volatile
id|u32
id|color_map
suffix:semicolon
DECL|member|control
r_volatile
id|u32
id|control
suffix:semicolon
DECL|member|cursor
r_volatile
id|u32
id|cursor
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|bw2_regs
r_struct
id|bw2_regs
(brace
DECL|member|cmap
r_struct
id|bt_regs
id|cmap
suffix:semicolon
DECL|member|control
r_volatile
id|u8
id|control
suffix:semicolon
DECL|member|status
r_volatile
id|u8
id|status
suffix:semicolon
DECL|member|cursor_start
r_volatile
id|u8
id|cursor_start
suffix:semicolon
DECL|member|cursor_end
r_volatile
id|u8
id|cursor_end
suffix:semicolon
DECL|member|h_blank_start
r_volatile
id|u8
id|h_blank_start
suffix:semicolon
DECL|member|h_blank_end
r_volatile
id|u8
id|h_blank_end
suffix:semicolon
DECL|member|h_sync_start
r_volatile
id|u8
id|h_sync_start
suffix:semicolon
DECL|member|h_sync_end
r_volatile
id|u8
id|h_sync_end
suffix:semicolon
DECL|member|comp_sync_end
r_volatile
id|u8
id|comp_sync_end
suffix:semicolon
DECL|member|v_blank_start_high
r_volatile
id|u8
id|v_blank_start_high
suffix:semicolon
DECL|member|v_blank_start_low
r_volatile
id|u8
id|v_blank_start_low
suffix:semicolon
DECL|member|v_blank_end
r_volatile
id|u8
id|v_blank_end
suffix:semicolon
DECL|member|v_sync_start
r_volatile
id|u8
id|v_sync_start
suffix:semicolon
DECL|member|v_sync_end
r_volatile
id|u8
id|v_sync_end
suffix:semicolon
DECL|member|xfer_holdoff_start
r_volatile
id|u8
id|xfer_holdoff_start
suffix:semicolon
DECL|member|xfer_holdoff_end
r_volatile
id|u8
id|xfer_holdoff_end
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Status Register Constants */
DECL|macro|BWTWO_SR_RES_MASK
mdefine_line|#define BWTWO_SR_RES_MASK&t;0x70
DECL|macro|BWTWO_SR_1600_1280
mdefine_line|#define BWTWO_SR_1600_1280&t;0x50
DECL|macro|BWTWO_SR_1152_900_76_A
mdefine_line|#define BWTWO_SR_1152_900_76_A&t;0x40
DECL|macro|BWTWO_SR_1152_900_76_B
mdefine_line|#define BWTWO_SR_1152_900_76_B&t;0x60
DECL|macro|BWTWO_SR_ID_MASK
mdefine_line|#define BWTWO_SR_ID_MASK&t;0x0f
DECL|macro|BWTWO_SR_ID_MONO
mdefine_line|#define BWTWO_SR_ID_MONO&t;0x02
DECL|macro|BWTWO_SR_ID_MONO_ECL
mdefine_line|#define BWTWO_SR_ID_MONO_ECL&t;0x03
DECL|macro|BWTWO_SR_ID_MSYNC
mdefine_line|#define BWTWO_SR_ID_MSYNC&t;0x04
DECL|macro|BWTWO_SR_ID_NOCONN
mdefine_line|#define BWTWO_SR_ID_NOCONN&t;0x0a
multiline_comment|/* Control Register Constants */
DECL|macro|BWTWO_CTL_ENABLE_INTS
mdefine_line|#define BWTWO_CTL_ENABLE_INTS   0x80
DECL|macro|BWTWO_CTL_ENABLE_VIDEO
mdefine_line|#define BWTWO_CTL_ENABLE_VIDEO  0x40
DECL|macro|BWTWO_CTL_ENABLE_TIMING
mdefine_line|#define BWTWO_CTL_ENABLE_TIMING 0x20
DECL|macro|BWTWO_CTL_ENABLE_CURCMP
mdefine_line|#define BWTWO_CTL_ENABLE_CURCMP 0x10
DECL|macro|BWTWO_CTL_XTAL_MASK
mdefine_line|#define BWTWO_CTL_XTAL_MASK     0x0C
DECL|macro|BWTWO_CTL_DIVISOR_MASK
mdefine_line|#define BWTWO_CTL_DIVISOR_MASK  0x03
multiline_comment|/* Status Register Constants */
DECL|macro|BWTWO_STAT_PENDING_INT
mdefine_line|#define BWTWO_STAT_PENDING_INT  0x80
DECL|macro|BWTWO_STAT_MSENSE_MASK
mdefine_line|#define BWTWO_STAT_MSENSE_MASK  0x70
DECL|macro|BWTWO_STAT_ID_MASK
mdefine_line|#define BWTWO_STAT_ID_MASK      0x0f
DECL|struct|bw2_par
r_struct
id|bw2_par
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|regs
r_struct
id|bw2_regs
op_star
id|regs
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|BW2_FLAG_BLANKED
mdefine_line|#define BW2_FLAG_BLANKED&t;0x00000001
DECL|member|physbase
r_int
r_int
id|physbase
suffix:semicolon
DECL|member|fbsize
r_int
r_int
id|fbsize
suffix:semicolon
DECL|member|sdev
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/**&n; *      bw2_blank - Optional function.  Blanks the display.&n; *      @blank_mode: the blank mode we want.&n; *      @info: frame buffer structure that represents a single frame buffer&n; */
r_static
r_int
DECL|function|bw2_blank
id|bw2_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|bw2_par
op_star
id|par
op_assign
(paren
r_struct
id|bw2_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|bw2_regs
op_star
id|regs
op_assign
id|par-&gt;regs
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Unblanking */
id|val
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|val
op_or_assign
id|BWTWO_CTL_ENABLE_VIDEO
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|val
comma
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|par-&gt;flags
op_and_assign
op_complement
id|BW2_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Normal blanking */
r_case
l_int|2
suffix:colon
multiline_comment|/* VESA blank (vsync off) */
r_case
l_int|3
suffix:colon
multiline_comment|/* VESA blank (hsync off) */
r_case
l_int|4
suffix:colon
multiline_comment|/* Poweroff */
id|val
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|BWTWO_CTL_ENABLE_VIDEO
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|val
comma
op_amp
id|regs-&gt;control
)paren
suffix:semicolon
id|par-&gt;flags
op_or_assign
id|BW2_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|bw2_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|bw2_mmap_map
(braket
)braket
op_assign
(brace
(brace
dot
id|size
op_assign
id|SBUS_MMAP_FBSIZE
c_func
(paren
l_int|1
)paren
)brace
comma
(brace
dot
id|size
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|bw2_mmap
r_static
r_int
id|bw2_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|bw2_par
op_star
id|par
op_assign
(paren
r_struct
id|bw2_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_mmap_helper
c_func
(paren
id|bw2_mmap_map
comma
id|par-&gt;physbase
comma
id|par-&gt;fbsize
comma
(paren
id|par-&gt;sdev
ques
c_cond
id|par-&gt;sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
suffix:colon
l_int|0
)paren
comma
id|vma
)paren
suffix:semicolon
)brace
DECL|function|bw2_ioctl
r_static
r_int
id|bw2_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|bw2_par
op_star
id|par
op_assign
(paren
r_struct
id|bw2_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_ioctl_helper
c_func
(paren
id|cmd
comma
id|arg
comma
id|info
comma
id|FBTYPE_SUN2BW
comma
l_int|1
comma
id|par-&gt;fbsize
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Initialisation&n; */
r_static
r_void
DECL|function|bw2_init_fix
id|bw2_init_fix
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|linebytes
)paren
(brace
id|strlcpy
c_func
(paren
id|info-&gt;fix.id
comma
l_string|&quot;bwtwo&quot;
comma
r_sizeof
(paren
id|info-&gt;fix.id
)paren
)paren
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_MONO01
suffix:semicolon
id|info-&gt;fix.line_length
op_assign
id|linebytes
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_SUN_BWTWO
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
id|u8
id|bw2regs_1600
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x14
comma
l_int|0x8b
comma
l_int|0x15
comma
l_int|0x28
comma
l_int|0x16
comma
l_int|0x03
comma
l_int|0x17
comma
l_int|0x13
comma
l_int|0x18
comma
l_int|0x7b
comma
l_int|0x19
comma
l_int|0x05
comma
l_int|0x1a
comma
l_int|0x34
comma
l_int|0x1b
comma
l_int|0x2e
comma
l_int|0x1c
comma
l_int|0x00
comma
l_int|0x1d
comma
l_int|0x0a
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x21
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|bw2regs_ecl
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x14
comma
l_int|0x65
comma
l_int|0x15
comma
l_int|0x1e
comma
l_int|0x16
comma
l_int|0x04
comma
l_int|0x17
comma
l_int|0x0c
comma
l_int|0x18
comma
l_int|0x5e
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xa7
comma
l_int|0x1b
comma
l_int|0x23
comma
l_int|0x1c
comma
l_int|0x00
comma
l_int|0x1d
comma
l_int|0x08
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x20
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|bw2regs_analog
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x14
comma
l_int|0xbb
comma
l_int|0x15
comma
l_int|0x2b
comma
l_int|0x16
comma
l_int|0x03
comma
l_int|0x17
comma
l_int|0x13
comma
l_int|0x18
comma
l_int|0xb0
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xa6
comma
l_int|0x1b
comma
l_int|0x22
comma
l_int|0x1c
comma
l_int|0x01
comma
l_int|0x1d
comma
l_int|0x05
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x20
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|bw2regs_76hz
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x14
comma
l_int|0xb7
comma
l_int|0x15
comma
l_int|0x27
comma
l_int|0x16
comma
l_int|0x03
comma
l_int|0x17
comma
l_int|0x0f
comma
l_int|0x18
comma
l_int|0xae
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xae
comma
l_int|0x1b
comma
l_int|0x2a
comma
l_int|0x1c
comma
l_int|0x01
comma
l_int|0x1d
comma
l_int|0x09
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x24
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u8
id|bw2regs_66hz
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x14
comma
l_int|0xbb
comma
l_int|0x15
comma
l_int|0x2b
comma
l_int|0x16
comma
l_int|0x04
comma
l_int|0x17
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0xae
comma
l_int|0x19
comma
l_int|0x03
comma
l_int|0x1a
comma
l_int|0xa8
comma
l_int|0x1b
comma
l_int|0x24
comma
l_int|0x1c
comma
l_int|0x01
comma
l_int|0x1d
comma
l_int|0x05
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x1f
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0x20
comma
l_int|0
)brace
suffix:semicolon
DECL|function|bw2_do_default_mode
r_static
r_void
id|bw2_do_default_mode
c_func
(paren
r_struct
id|bw2_par
op_star
id|par
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
op_star
id|linebytes
)paren
(brace
id|u8
id|status
comma
id|mon
suffix:semicolon
id|u8
op_star
id|p
suffix:semicolon
id|status
op_assign
id|sbus_readb
c_func
(paren
op_amp
id|par-&gt;regs-&gt;status
)paren
suffix:semicolon
id|mon
op_assign
id|status
op_amp
id|BWTWO_SR_RES_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|status
op_amp
id|BWTWO_SR_ID_MASK
)paren
(brace
r_case
id|BWTWO_SR_ID_MONO_ECL
suffix:colon
r_if
c_cond
(paren
id|mon
op_eq
id|BWTWO_SR_1600_1280
)paren
(brace
id|p
op_assign
id|bw2regs_1600
suffix:semicolon
id|info-&gt;var.xres
op_assign
id|info-&gt;var.xres_virtual
op_assign
l_int|1600
suffix:semicolon
id|info-&gt;var.yres
op_assign
id|info-&gt;var.yres_virtual
op_assign
l_int|1280
suffix:semicolon
op_star
id|linebytes
op_assign
l_int|1600
op_div
l_int|8
suffix:semicolon
)brace
r_else
id|p
op_assign
id|bw2regs_ecl
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BWTWO_SR_ID_MONO
suffix:colon
id|p
op_assign
id|bw2regs_analog
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BWTWO_SR_ID_MSYNC
suffix:colon
r_if
c_cond
(paren
id|mon
op_eq
id|BWTWO_SR_1152_900_76_A
op_logical_or
id|mon
op_eq
id|BWTWO_SR_1152_900_76_B
)paren
id|p
op_assign
id|bw2regs_76hz
suffix:semicolon
r_else
id|p
op_assign
id|bw2regs_66hz
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BWTWO_SR_ID_NOCONN
suffix:colon
r_return
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;bw2: can&squot;t handle SR %02x&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
)paren
(brace
id|u8
op_star
id|regp
op_assign
op_amp
(paren
(paren
id|u8
op_star
)paren
id|par-&gt;regs
)paren
(braket
id|p
(braket
l_int|0
)braket
)braket
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|p
(braket
l_int|1
)braket
comma
id|regp
)paren
suffix:semicolon
)brace
)brace
DECL|struct|all_info
r_struct
id|all_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|par
r_struct
id|bw2_par
id|par
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|bw2_list
)paren
suffix:semicolon
DECL|function|bw2_init_one
r_static
r_void
id|bw2_init_one
c_func
(paren
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_struct
id|all_info
op_star
id|all
suffix:semicolon
r_struct
id|resource
op_star
id|resp
suffix:semicolon
macro_line|#ifdef CONFIG_SUN4
r_struct
id|resource
id|res
suffix:semicolon
macro_line|#endif
r_int
id|linebytes
suffix:semicolon
id|all
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|all
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|all
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bw2: Cannot allocate memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|all
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|all
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|all-&gt;list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|all-&gt;par.lock
)paren
suffix:semicolon
id|all-&gt;par.sdev
op_assign
id|sdev
suffix:semicolon
macro_line|#ifdef CONFIG_SUN4
r_if
c_cond
(paren
op_logical_neg
id|sdev
)paren
(brace
id|all-&gt;par.physbase
op_assign
id|sun4_bwtwo_physaddr
suffix:semicolon
id|res.start
op_assign
id|sun4_bwtwo_physaddr
suffix:semicolon
id|res.end
op_assign
id|res.start
op_plus
id|BWTWO_REGISTER_OFFSET
op_plus
r_sizeof
(paren
r_struct
id|bw2_regs
)paren
op_minus
l_int|1
suffix:semicolon
id|res.flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
id|resp
op_assign
op_amp
id|res
suffix:semicolon
id|all-&gt;info.var.xres
op_assign
id|all-&gt;info.var.xres_virtual
op_assign
l_int|1152
suffix:semicolon
id|all-&gt;info.var.yres
op_assign
id|all-&gt;info.var.yres_virtual
op_assign
l_int|900
suffix:semicolon
id|all-&gt;info.bits_per_pixel
op_assign
l_int|1
suffix:semicolon
id|linebytes
op_assign
l_int|1152
op_div
l_int|8
suffix:semicolon
)brace
r_else
macro_line|#else
(brace
r_if
c_cond
(paren
op_logical_neg
id|sdev
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|all-&gt;par.physbase
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|resp
op_assign
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
id|sbusfb_fill_var
c_func
(paren
op_amp
id|all-&gt;info.var
comma
(paren
id|sdev
ques
c_cond
id|sdev-&gt;prom_node
suffix:colon
l_int|0
)paren
comma
l_int|1
)paren
suffix:semicolon
id|linebytes
op_assign
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;linebytes&quot;
comma
id|all-&gt;info.var.xres
)paren
suffix:semicolon
)brace
macro_line|#endif
id|all-&gt;par.regs
op_assign
(paren
r_struct
id|bw2_regs
op_star
)paren
id|sbus_ioremap
c_func
(paren
id|resp
comma
id|BWTWO_REGISTER_OFFSET
comma
r_sizeof
(paren
r_struct
id|bw2_regs
)paren
comma
l_string|&quot;bw2 regs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdev
op_logical_and
op_logical_neg
id|prom_getbool
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;width&quot;
)paren
)paren
id|bw2_do_default_mode
c_func
(paren
op_amp
id|all-&gt;par
comma
op_amp
id|all-&gt;info
comma
op_amp
id|linebytes
)paren
suffix:semicolon
id|all-&gt;par.fbsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|linebytes
op_star
id|all-&gt;info.var.yres
)paren
suffix:semicolon
id|all-&gt;info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|all-&gt;info.fbops
op_assign
op_amp
id|bw2_ops
suffix:semicolon
macro_line|#if defined(CONFIG_SPARC32)
r_if
c_cond
(paren
id|sdev
)paren
id|all-&gt;info.screen_base
op_assign
(paren
r_char
op_star
)paren
id|prom_getintdefault
c_func
(paren
id|sdev-&gt;prom_node
comma
l_string|&quot;address&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|all-&gt;info.screen_base
)paren
id|all-&gt;info.screen_base
op_assign
(paren
r_char
op_star
)paren
id|sbus_ioremap
c_func
(paren
id|resp
comma
l_int|0
comma
id|all-&gt;par.fbsize
comma
l_string|&quot;bw2 ram&quot;
)paren
suffix:semicolon
id|all-&gt;info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|all-&gt;info.par
op_assign
op_amp
id|all-&gt;par
suffix:semicolon
id|bw2_blank
c_func
(paren
l_int|0
comma
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|bw2_init_fix
c_func
(paren
op_amp
id|all-&gt;info
comma
id|linebytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bw2: Could not register framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|all-&gt;list
comma
op_amp
id|bw2_list
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;bw2: bwtwo at %lx:%lx&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|sdev
ques
c_cond
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
suffix:colon
l_int|0
)paren
comma
(paren
r_int
)paren
id|all-&gt;par.physbase
)paren
suffix:semicolon
)brace
DECL|function|bw2_init
r_int
id|__init
id|bw2_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
macro_line|#ifdef CONFIG_SUN4
id|bw2_init_one
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;bwtwo&quot;
)paren
)paren
id|bw2_init_one
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bw2_exit
r_void
id|__exit
id|bw2_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|tmp
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|tmp
comma
op_amp
id|bw2_list
)paren
(brace
r_struct
id|all_info
op_star
id|all
op_assign
id|list_entry
c_func
(paren
id|pos
comma
id|typeof
c_func
(paren
op_star
id|all
)paren
comma
id|list
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|bw2_setup
id|bw2_setup
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
multiline_comment|/* No cmdline options yet... */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|bw2_init
id|module_init
c_func
(paren
id|bw2_init
)paren
suffix:semicolon
DECL|variable|bw2_exit
id|module_exit
c_func
(paren
id|bw2_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for BWTWO chipsets&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller &lt;davem@redhat.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
