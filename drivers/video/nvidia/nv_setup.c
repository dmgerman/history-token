multiline_comment|/***************************************************************************&bslash;&n;|*                                                                           *|&n;|*       Copyright 2003 NVIDIA, Corporation.  All rights reserved.           *|&n;|*                                                                           *|&n;|*     NOTICE TO USER:   The source code  is copyrighted under  U.S. and     *|&n;|*     international laws.  Users and possessors of this source code are     *|&n;|*     hereby granted a nonexclusive,  royalty-free copyright license to     *|&n;|*     use this code in individual and commercial software.                  *|&n;|*                                                                           *|&n;|*     Any use of this source code must include,  in the user documenta-     *|&n;|*     tion and  internal comments to the code,  notices to the end user     *|&n;|*     as follows:                                                           *|&n;|*                                                                           *|&n;|*       Copyright 2003 NVIDIA, Corporation.  All rights reserved.           *|&n;|*                                                                           *|&n;|*     NVIDIA, CORPORATION MAKES NO REPRESENTATION ABOUT THE SUITABILITY     *|&n;|*     OF  THIS SOURCE  CODE  FOR ANY PURPOSE.  IT IS  PROVIDED  &quot;AS IS&quot;     *|&n;|*     WITHOUT EXPRESS OR IMPLIED WARRANTY OF ANY KIND.  NVIDIA, CORPOR-     *|&n;|*     ATION DISCLAIMS ALL WARRANTIES  WITH REGARD  TO THIS SOURCE CODE,     *|&n;|*     INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY, NONINFRINGE-     *|&n;|*     MENT,  AND FITNESS  FOR A PARTICULAR PURPOSE.   IN NO EVENT SHALL     *|&n;|*     NVIDIA, CORPORATION  BE LIABLE FOR ANY SPECIAL,  INDIRECT,  INCI-     *|&n;|*     DENTAL, OR CONSEQUENTIAL DAMAGES,  OR ANY DAMAGES  WHATSOEVER RE-     *|&n;|*     SULTING FROM LOSS OF USE,  DATA OR PROFITS,  WHETHER IN AN ACTION     *|&n;|*     OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION,  ARISING OUT OF     *|&n;|*     OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOURCE CODE.     *|&n;|*                                                                           *|&n;|*     U.S. Government  End  Users.   This source code  is a &quot;commercial     *|&n;|*     item,&quot;  as that  term is  defined at  48 C.F.R. 2.101 (OCT 1995),     *|&n;|*     consisting  of &quot;commercial  computer  software&quot;  and  &quot;commercial     *|&n;|*     computer  software  documentation,&quot;  as such  terms  are  used in     *|&n;|*     48 C.F.R. 12.212 (SEPT 1995)  and is provided to the U.S. Govern-     *|&n;|*     ment only as  a commercial end item.   Consistent with  48 C.F.R.     *|&n;|*     12.212 and  48 C.F.R. 227.7202-1 through  227.7202-4 (JUNE 1995),     *|&n;|*     all U.S. Government End Users  acquire the source code  with only     *|&n;|*     those rights set forth herein.                                        *|&n;|*                                                                           *|&n; &bslash;***************************************************************************/
multiline_comment|/*&n; * GPL Licensing Note - According to Mark Vojkovich, author of the Xorg/&n; * XFree86 &squot;nv&squot; driver, this source code is provided under MIT-style licensing&n; * where the source code is provided &quot;as is&quot; without warranty of any kind.&n; * The only usage restriction is for the copyright notices to be retained&n; * whenever code is used.&n; *&n; * Antonino Daplas &lt;adaplas@pol.net&gt; 2005-03-11&n; */
macro_line|#include &lt;video/vga.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;nv_type.h&quot;
macro_line|#include &quot;nv_local.h&quot;
macro_line|#include &quot;nv_proto.h&quot;
multiline_comment|/*&n; * Override VGA I/O routines.&n; */
DECL|function|NVWriteCrtc
r_void
id|NVWriteCrtc
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x04
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x05
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadCrtc
id|u8
id|NVReadCrtc
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x04
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x05
)paren
)paren
suffix:semicolon
)brace
DECL|function|NVWriteGr
r_void
id|NVWriteGr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_GFX_I
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_GFX_D
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadGr
id|u8
id|NVReadGr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_GFX_I
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_GFX_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|NVWriteSeq
r_void
id|NVWriteSeq
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_SEQ_I
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_SEQ_D
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadSeq
id|u8
id|NVReadSeq
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_SEQ_I
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_SEQ_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|NVWriteAttr
r_void
id|NVWriteAttr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
comma
id|u8
id|value
)paren
(brace
r_volatile
id|u8
id|tmp
suffix:semicolon
id|tmp
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x0a
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;paletteEnabled
)paren
id|index
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
r_else
id|index
op_or_assign
l_int|0x20
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_IW
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_W
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadAttr
id|u8
id|NVReadAttr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|index
)paren
(brace
r_volatile
id|u8
id|tmp
suffix:semicolon
id|tmp
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x0a
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;paletteEnabled
)paren
id|index
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
r_else
id|index
op_or_assign
l_int|0x20
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_IW
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_R
)paren
)paren
suffix:semicolon
)brace
DECL|function|NVWriteMiscOut
r_void
id|NVWriteMiscOut
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_MIS_W
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadMiscOut
id|u8
id|NVReadMiscOut
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PVIO
comma
id|VGA_MIS_R
)paren
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_void
id|NVEnablePalette
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_volatile
id|u8
id|tmp
suffix:semicolon
id|tmp
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x0a
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_IW
comma
l_int|0x00
)paren
suffix:semicolon
id|par-&gt;paletteEnabled
op_assign
l_int|1
suffix:semicolon
)brace
r_void
id|NVDisablePalette
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_volatile
id|u8
id|tmp
suffix:semicolon
id|tmp
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
id|par-&gt;IOBase
op_plus
l_int|0x0a
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
id|VGA_ATT_IW
comma
l_int|0x20
)paren
suffix:semicolon
id|par-&gt;paletteEnabled
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif  /*  0  */
DECL|function|NVWriteDacMask
r_void
id|NVWriteDacMask
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_MSK
comma
id|value
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|u8
id|NVReadDacMask
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_MSK
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif  /*  0  */
DECL|function|NVWriteDacReadAddr
r_void
id|NVWriteDacReadAddr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_IR
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVWriteDacWriteAddr
r_void
id|NVWriteDacWriteAddr
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_IW
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVWriteDacData
r_void
id|NVWriteDacData
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
id|u8
id|value
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_D
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|NVReadDacData
id|u8
id|NVReadDacData
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PDIO
comma
id|VGA_PEL_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|NVIsConnected
r_static
r_int
id|NVIsConnected
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
r_int
id|output
)paren
(brace
r_volatile
id|u32
id|__iomem
op_star
id|PRAMDAC
op_assign
id|par-&gt;PRAMDAC0
suffix:semicolon
id|u32
id|reg52C
comma
id|reg608
suffix:semicolon
r_int
id|present
suffix:semicolon
r_if
c_cond
(paren
id|output
)paren
id|PRAMDAC
op_add_assign
l_int|0x800
suffix:semicolon
id|reg52C
op_assign
id|NV_RD32
c_func
(paren
id|PRAMDAC
comma
l_int|0x052C
)paren
suffix:semicolon
id|reg608
op_assign
id|NV_RD32
c_func
(paren
id|PRAMDAC
comma
l_int|0x0608
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|PRAMDAC
comma
l_int|0x0608
comma
id|reg608
op_amp
op_complement
l_int|0x00010000
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|PRAMDAC
comma
l_int|0x052C
comma
id|reg52C
op_amp
l_int|0x0000FEEE
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|PRAMDAC
comma
l_int|0x052C
comma
id|NV_RD32
c_func
(paren
id|PRAMDAC
comma
l_int|0x052C
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0610
comma
l_int|0x94050140
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0608
comma
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0608
)paren
op_or
l_int|0x00001000
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|present
op_assign
(paren
id|NV_RD32
c_func
(paren
id|PRAMDAC
comma
l_int|0x0608
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|28
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|present
)paren
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC%i found&bslash;n&quot;
comma
id|output
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC%i not found&bslash;n&quot;
comma
id|output
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0608
comma
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0608
)paren
op_amp
l_int|0x0000EFFF
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|PRAMDAC
comma
l_int|0x052C
comma
id|reg52C
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|PRAMDAC
comma
l_int|0x0608
comma
id|reg608
)paren
suffix:semicolon
r_return
id|present
suffix:semicolon
)brace
DECL|function|NVSelectHeadRegisters
r_static
r_void
id|NVSelectHeadRegisters
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
comma
r_int
id|head
)paren
(brace
r_if
c_cond
(paren
id|head
)paren
(brace
id|par-&gt;PCIO
op_assign
id|par-&gt;PCIO0
op_plus
l_int|0x2000
suffix:semicolon
id|par-&gt;PCRTC
op_assign
id|par-&gt;PCRTC0
op_plus
l_int|0x800
suffix:semicolon
id|par-&gt;PRAMDAC
op_assign
id|par-&gt;PRAMDAC0
op_plus
l_int|0x800
suffix:semicolon
id|par-&gt;PDIO
op_assign
id|par-&gt;PDIO0
op_plus
l_int|0x2000
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;PCIO
op_assign
id|par-&gt;PCIO0
suffix:semicolon
id|par-&gt;PCRTC
op_assign
id|par-&gt;PCRTC0
suffix:semicolon
id|par-&gt;PRAMDAC
op_assign
id|par-&gt;PRAMDAC0
suffix:semicolon
id|par-&gt;PDIO
op_assign
id|par-&gt;PDIO0
suffix:semicolon
)brace
)brace
DECL|function|nv4GetConfig
r_static
r_void
id|nv4GetConfig
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_if
c_cond
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PFB
comma
l_int|0x0000
)paren
op_amp
l_int|0x00000100
)paren
(brace
id|par-&gt;RamAmountKBytes
op_assign
(paren
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PFB
comma
l_int|0x0000
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0x0F
)paren
op_star
l_int|1024
op_star
l_int|2
op_plus
l_int|1024
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PFB
comma
l_int|0x0000
)paren
op_amp
l_int|0x00000003
)paren
(brace
r_case
l_int|0
suffix:colon
id|par-&gt;RamAmountKBytes
op_assign
l_int|1024
op_star
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|par-&gt;RamAmountKBytes
op_assign
l_int|1024
op_star
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|par-&gt;RamAmountKBytes
op_assign
l_int|1024
op_star
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_default
suffix:colon
id|par-&gt;RamAmountKBytes
op_assign
l_int|1024
op_star
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|par-&gt;CrystalFreqKHz
op_assign
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PEXTDEV
comma
l_int|0x0000
)paren
op_amp
l_int|0x00000040
)paren
ques
c_cond
l_int|14318
suffix:colon
l_int|13500
suffix:semicolon
id|par-&gt;CURSOR
op_assign
op_amp
id|par-&gt;PRAMIN
(braket
l_int|0x1E00
)braket
suffix:semicolon
id|par-&gt;MinVClockFreqKHz
op_assign
l_int|12000
suffix:semicolon
id|par-&gt;MaxVClockFreqKHz
op_assign
l_int|350000
suffix:semicolon
)brace
DECL|function|nv10GetConfig
r_static
r_void
id|nv10GetConfig
c_func
(paren
r_struct
id|nvidia_par
op_star
id|par
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|u32
id|implementation
op_assign
id|par-&gt;Chipset
op_amp
l_int|0x0ff0
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
multiline_comment|/* turn on big endian register access */
r_if
c_cond
(paren
op_logical_neg
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PMC
comma
l_int|0x0004
)paren
op_amp
l_int|0x01000001
)paren
)paren
(brace
id|NV_WR32
c_func
(paren
id|par-&gt;PMC
comma
l_int|0x0004
comma
l_int|0x01000001
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|dev
op_assign
id|pci_find_slot
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par-&gt;Chipset
op_logical_and
l_int|0xffff
)paren
op_eq
l_int|0x01a0
)paren
(brace
r_int
id|amt
op_assign
l_int|0
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
l_int|0x7c
comma
op_amp
id|amt
)paren
suffix:semicolon
id|par-&gt;RamAmountKBytes
op_assign
(paren
(paren
(paren
id|amt
op_rshift
l_int|6
)paren
op_amp
l_int|31
)paren
op_plus
l_int|1
)paren
op_star
l_int|1024
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|par-&gt;Chipset
op_amp
l_int|0xffff
)paren
op_eq
l_int|0x01f0
)paren
(brace
r_int
id|amt
op_assign
l_int|0
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
l_int|0x84
comma
op_amp
id|amt
)paren
suffix:semicolon
id|par-&gt;RamAmountKBytes
op_assign
(paren
(paren
(paren
id|amt
op_rshift
l_int|4
)paren
op_amp
l_int|127
)paren
op_plus
l_int|1
)paren
op_star
l_int|1024
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;RamAmountKBytes
op_assign
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PFB
comma
l_int|0x020C
)paren
op_amp
l_int|0xFFF00000
)paren
op_rshift
l_int|10
suffix:semicolon
)brace
id|par-&gt;CrystalFreqKHz
op_assign
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PEXTDEV
comma
l_int|0x0000
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
ques
c_cond
l_int|14318
suffix:colon
l_int|13500
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;twoHeads
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0110
)paren
)paren
(brace
r_if
c_cond
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PEXTDEV
comma
l_int|0x0000
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|22
)paren
)paren
id|par-&gt;CrystalFreqKHz
op_assign
l_int|27000
suffix:semicolon
)brace
id|par-&gt;CursorStart
op_assign
(paren
id|par-&gt;RamAmountKBytes
op_minus
l_int|96
)paren
op_star
l_int|1024
suffix:semicolon
id|par-&gt;CURSOR
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* can&squot;t set this here */
id|par-&gt;MinVClockFreqKHz
op_assign
l_int|12000
suffix:semicolon
id|par-&gt;MaxVClockFreqKHz
op_assign
id|par-&gt;twoStagePLL
ques
c_cond
l_int|400000
suffix:colon
l_int|350000
suffix:semicolon
)brace
DECL|function|NVCommonSetup
r_void
id|NVCommonSetup
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|nvidia_par
op_star
id|par
op_assign
id|info-&gt;par
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
id|u16
id|implementation
op_assign
id|par-&gt;Chipset
op_amp
l_int|0x0ff0
suffix:semicolon
id|u8
op_star
id|edidA
op_assign
l_int|NULL
comma
op_star
id|edidB
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fb_monspecs
id|monitorA
comma
id|monitorB
suffix:semicolon
r_struct
id|fb_monspecs
op_star
id|monA
op_assign
l_int|NULL
comma
op_star
id|monB
op_assign
l_int|NULL
suffix:semicolon
r_int
id|mobile
op_assign
l_int|0
suffix:semicolon
r_int
id|tvA
op_assign
l_int|0
suffix:semicolon
r_int
id|tvB
op_assign
l_int|0
suffix:semicolon
r_int
id|FlatPanel
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* really means the CRTC is slaved */
r_int
id|Television
op_assign
l_int|0
suffix:semicolon
id|par-&gt;PRAMIN
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00710000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PCRTC0
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00600000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PRAMDAC0
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00680000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PFB
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00100000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PFIFO
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00002000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PGRAPH
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00400000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PEXTDEV
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00101000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PTIMER
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00009000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;PMC
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00000000
op_div
l_int|4
)paren
suffix:semicolon
id|par-&gt;FIFO
op_assign
id|par-&gt;REGS
op_plus
(paren
l_int|0x00800000
op_div
l_int|4
)paren
suffix:semicolon
multiline_comment|/* 8 bit registers */
id|par-&gt;PCIO0
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|par-&gt;REGS
op_plus
l_int|0x00601000
suffix:semicolon
id|par-&gt;PDIO0
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|par-&gt;REGS
op_plus
l_int|0x00681000
suffix:semicolon
id|par-&gt;PVIO
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|par-&gt;REGS
op_plus
l_int|0x000C0000
suffix:semicolon
id|par-&gt;twoHeads
op_assign
(paren
id|par-&gt;Architecture
op_ge
id|NV_ARCH_10
)paren
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0100
)paren
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0150
)paren
op_logical_and
(paren
id|implementation
op_ne
l_int|0x01A0
)paren
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0200
)paren
suffix:semicolon
id|par-&gt;fpScaler
op_assign
(paren
id|par-&gt;FpScale
op_logical_and
id|par-&gt;twoHeads
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0110
)paren
)paren
suffix:semicolon
id|par-&gt;twoStagePLL
op_assign
(paren
id|implementation
op_eq
l_int|0x0310
)paren
op_logical_or
(paren
id|implementation
op_eq
l_int|0x0340
)paren
op_logical_or
(paren
id|par-&gt;Architecture
op_ge
id|NV_ARCH_40
)paren
suffix:semicolon
id|par-&gt;WaitVSyncPossible
op_assign
(paren
id|par-&gt;Architecture
op_ge
id|NV_ARCH_10
)paren
op_logical_and
(paren
id|implementation
op_ne
l_int|0x0100
)paren
suffix:semicolon
id|par-&gt;BlendingPossible
op_assign
(paren
(paren
id|par-&gt;Chipset
op_amp
l_int|0xffff
)paren
op_ne
l_int|0x0020
)paren
suffix:semicolon
multiline_comment|/* look for known laptop chips */
r_switch
c_cond
(paren
id|par-&gt;Chipset
op_amp
l_int|0xffff
)paren
(brace
r_case
l_int|0x0112
suffix:colon
r_case
l_int|0x0174
suffix:colon
r_case
l_int|0x0175
suffix:colon
r_case
l_int|0x0176
suffix:colon
r_case
l_int|0x0177
suffix:colon
r_case
l_int|0x0179
suffix:colon
r_case
l_int|0x017C
suffix:colon
r_case
l_int|0x017D
suffix:colon
r_case
l_int|0x0186
suffix:colon
r_case
l_int|0x0187
suffix:colon
r_case
l_int|0x018D
suffix:colon
r_case
l_int|0x0286
suffix:colon
r_case
l_int|0x028C
suffix:colon
r_case
l_int|0x0316
suffix:colon
r_case
l_int|0x0317
suffix:colon
r_case
l_int|0x031A
suffix:colon
r_case
l_int|0x031B
suffix:colon
r_case
l_int|0x031C
suffix:colon
r_case
l_int|0x031D
suffix:colon
r_case
l_int|0x031E
suffix:colon
r_case
l_int|0x031F
suffix:colon
r_case
l_int|0x0324
suffix:colon
r_case
l_int|0x0325
suffix:colon
r_case
l_int|0x0328
suffix:colon
r_case
l_int|0x0329
suffix:colon
r_case
l_int|0x032C
suffix:colon
r_case
l_int|0x032D
suffix:colon
r_case
l_int|0x0347
suffix:colon
r_case
l_int|0x0348
suffix:colon
r_case
l_int|0x0349
suffix:colon
r_case
l_int|0x034B
suffix:colon
r_case
l_int|0x034C
suffix:colon
r_case
l_int|0x0160
suffix:colon
r_case
l_int|0x0166
suffix:colon
r_case
l_int|0x00C8
suffix:colon
r_case
l_int|0x00CC
suffix:colon
r_case
l_int|0x0144
suffix:colon
r_case
l_int|0x0146
suffix:colon
r_case
l_int|0x0147
suffix:colon
r_case
l_int|0x0148
suffix:colon
id|mobile
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;Architecture
op_eq
id|NV_ARCH_04
)paren
id|nv4GetConfig
c_func
(paren
id|par
)paren
suffix:semicolon
r_else
id|nv10GetConfig
c_func
(paren
id|par
)paren
suffix:semicolon
id|NVSelectHeadRegisters
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|NVLockUnlock
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;IOBase
op_assign
(paren
id|NVReadMiscOut
c_func
(paren
id|par
)paren
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|0x3d0
suffix:colon
l_int|0x3b0
suffix:semicolon
id|par-&gt;Television
op_assign
l_int|0
suffix:semicolon
id|nvidia_create_i2c_busses
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;twoHeads
)paren
(brace
id|par-&gt;CRTCnumber
op_assign
l_int|0
suffix:semicolon
id|nvidia_probe_i2c_connector
c_func
(paren
id|par
comma
l_int|1
comma
op_amp
id|edidA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edidA
op_logical_and
op_logical_neg
id|fb_parse_edid
c_func
(paren
id|edidA
comma
op_amp
id|var
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: EDID found from BUS1&bslash;n&quot;
)paren
suffix:semicolon
id|monA
op_assign
op_amp
id|monitorA
suffix:semicolon
id|fb_edid_to_monspecs
c_func
(paren
id|edidA
comma
id|monA
)paren
suffix:semicolon
id|FlatPanel
op_assign
(paren
id|monA-&gt;input
op_amp
id|FB_DISP_DDI
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* NV4 doesn&squot;t support FlatPanels */
r_if
c_cond
(paren
(paren
id|par-&gt;Chipset
op_amp
l_int|0x0fff
)paren
op_le
l_int|0x0020
)paren
id|FlatPanel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x28
)paren
suffix:semicolon
r_if
c_cond
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x80
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x33
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x01
)paren
)paren
id|Television
op_assign
l_int|1
suffix:semicolon
id|FlatPanel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|FlatPanel
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: HW is currently programmed for %s&bslash;n&quot;
comma
id|FlatPanel
ques
c_cond
(paren
id|Television
ques
c_cond
l_string|&quot;TV&quot;
suffix:colon
l_string|&quot;DFP&quot;
)paren
suffix:colon
l_string|&quot;CRT&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_eq
op_minus
l_int|1
)paren
(brace
id|par-&gt;FlatPanel
op_assign
id|FlatPanel
suffix:semicolon
id|par-&gt;Television
op_assign
id|Television
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Forcing display type to %s as &quot;
l_string|&quot;specified&bslash;n&quot;
comma
id|par-&gt;FlatPanel
ques
c_cond
l_string|&quot;DFP&quot;
suffix:colon
l_string|&quot;CRT&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|u8
id|outputAfromCRTC
comma
id|outputBfromCRTC
suffix:semicolon
r_int
id|CRTCnumber
op_assign
op_minus
l_int|1
suffix:semicolon
id|u8
id|slaved_on_A
comma
id|slaved_on_B
suffix:semicolon
r_int
id|analog_on_A
comma
id|analog_on_B
suffix:semicolon
id|u32
id|oldhead
suffix:semicolon
id|u8
id|cr44
suffix:semicolon
r_if
c_cond
(paren
id|implementation
op_ne
l_int|0x0110
)paren
(brace
r_if
c_cond
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0000052C
)paren
op_amp
l_int|0x100
)paren
id|outputAfromCRTC
op_assign
l_int|1
suffix:semicolon
r_else
id|outputAfromCRTC
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC0
comma
l_int|0x0000252C
)paren
op_amp
l_int|0x100
)paren
id|outputBfromCRTC
op_assign
l_int|1
suffix:semicolon
r_else
id|outputBfromCRTC
op_assign
l_int|0
suffix:semicolon
id|analog_on_A
op_assign
id|NVIsConnected
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|analog_on_B
op_assign
id|NVIsConnected
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|outputAfromCRTC
op_assign
l_int|0
suffix:semicolon
id|outputBfromCRTC
op_assign
l_int|1
suffix:semicolon
id|analog_on_A
op_assign
l_int|0
suffix:semicolon
id|analog_on_B
op_assign
l_int|0
suffix:semicolon
)brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x44
)paren
suffix:semicolon
id|cr44
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
comma
l_int|3
)paren
suffix:semicolon
id|NVSelectHeadRegisters
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
id|NVLockUnlock
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x28
)paren
suffix:semicolon
id|slaved_on_B
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|slaved_on_B
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x33
)paren
suffix:semicolon
id|tvB
op_assign
op_logical_neg
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x44
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
comma
l_int|0
)paren
suffix:semicolon
id|NVSelectHeadRegisters
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|NVLockUnlock
c_func
(paren
id|par
comma
l_int|0
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x28
)paren
suffix:semicolon
id|slaved_on_A
op_assign
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|slaved_on_A
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x33
)paren
suffix:semicolon
id|tvA
op_assign
op_logical_neg
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
id|oldhead
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;PCRTC0
comma
l_int|0x00000860
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;PCRTC0
comma
l_int|0x00000860
comma
id|oldhead
op_or
l_int|0x00000010
)paren
suffix:semicolon
id|nvidia_probe_i2c_connector
c_func
(paren
id|par
comma
l_int|1
comma
op_amp
id|edidA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edidA
op_logical_and
op_logical_neg
id|fb_parse_edid
c_func
(paren
id|edidA
comma
op_amp
id|var
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: EDID found from BUS1&bslash;n&quot;
)paren
suffix:semicolon
id|monA
op_assign
op_amp
id|monitorA
suffix:semicolon
id|fb_edid_to_monspecs
c_func
(paren
id|edidA
comma
id|monA
)paren
suffix:semicolon
)brace
id|nvidia_probe_i2c_connector
c_func
(paren
id|par
comma
l_int|2
comma
op_amp
id|edidB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edidB
op_logical_and
op_logical_neg
id|fb_parse_edid
c_func
(paren
id|edidB
comma
op_amp
id|var
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: EDID found from BUS2&bslash;n&quot;
)paren
suffix:semicolon
id|monB
op_assign
op_amp
id|monitorB
suffix:semicolon
id|fb_edid_to_monspecs
c_func
(paren
id|edidB
comma
id|monB
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slaved_on_A
op_logical_and
op_logical_neg
id|tvA
)paren
(brace
id|CRTCnumber
op_assign
l_int|0
suffix:semicolon
id|FlatPanel
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC 0 is currently programmed for &quot;
l_string|&quot;DFP&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|slaved_on_B
op_logical_and
op_logical_neg
id|tvB
)paren
(brace
id|CRTCnumber
op_assign
l_int|1
suffix:semicolon
id|FlatPanel
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC 1 is currently programmed &quot;
l_string|&quot;for DFP&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|analog_on_A
)paren
(brace
id|CRTCnumber
op_assign
id|outputAfromCRTC
suffix:semicolon
id|FlatPanel
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC %i appears to have a &quot;
l_string|&quot;CRT attached&bslash;n&quot;
comma
id|CRTCnumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|analog_on_B
)paren
(brace
id|CRTCnumber
op_assign
id|outputBfromCRTC
suffix:semicolon
id|FlatPanel
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC %i&quot;
l_string|&quot;appears to have a &quot;
l_string|&quot;CRT attached&bslash;n&quot;
comma
id|CRTCnumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|slaved_on_A
)paren
(brace
id|CRTCnumber
op_assign
l_int|0
suffix:semicolon
id|FlatPanel
op_assign
l_int|1
suffix:semicolon
id|Television
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC 0 is currently programmed &quot;
l_string|&quot;for TV&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|slaved_on_B
)paren
(brace
id|CRTCnumber
op_assign
l_int|1
suffix:semicolon
id|FlatPanel
op_assign
l_int|1
suffix:semicolon
id|Television
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;nvidiafb: CRTC 1 is currently programmed for &quot;
l_string|&quot;TV&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|monA
)paren
(brace
id|FlatPanel
op_assign
(paren
id|monA-&gt;input
op_amp
id|FB_DISP_DDI
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|monB
)paren
(brace
id|FlatPanel
op_assign
(paren
id|monB-&gt;input
op_amp
id|FB_DISP_DDI
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|FlatPanel
op_ne
op_minus
l_int|1
)paren
(brace
id|par-&gt;FlatPanel
op_assign
id|FlatPanel
suffix:semicolon
id|par-&gt;Television
op_assign
id|Television
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Unable to detect display &quot;
l_string|&quot;type...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mobile
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;...On a laptop, assuming &quot;
l_string|&quot;DFP&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;FlatPanel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;...Using default of CRT&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;FlatPanel
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Forcing display type to %s as &quot;
l_string|&quot;specified&bslash;n&quot;
comma
id|par-&gt;FlatPanel
ques
c_cond
l_string|&quot;DFP&quot;
suffix:colon
l_string|&quot;CRT&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;CRTCnumber
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|CRTCnumber
op_ne
op_minus
l_int|1
)paren
id|par-&gt;CRTCnumber
op_assign
id|CRTCnumber
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Unable to detect which &quot;
l_string|&quot;CRTCNumber...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;FlatPanel
)paren
id|par-&gt;CRTCnumber
op_assign
l_int|1
suffix:semicolon
r_else
id|par-&gt;CRTCnumber
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;...Defaulting to CRTCNumber %i&bslash;n&quot;
comma
id|par-&gt;CRTCnumber
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Forcing CRTCNumber %i as &quot;
l_string|&quot;specified&bslash;n&quot;
comma
id|par-&gt;CRTCnumber
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monA
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|monA-&gt;input
op_amp
id|FB_DISP_DDI
)paren
op_logical_and
id|par-&gt;FlatPanel
)paren
op_logical_or
(paren
(paren
op_logical_neg
(paren
id|monA-&gt;input
op_amp
id|FB_DISP_DDI
)paren
)paren
op_logical_and
op_logical_neg
id|par-&gt;FlatPanel
)paren
)paren
(brace
r_if
c_cond
(paren
id|monB
)paren
(brace
id|fb_destroy_modedb
c_func
(paren
id|monB-&gt;modedb
)paren
suffix:semicolon
id|monB
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
id|fb_destroy_modedb
c_func
(paren
id|monA-&gt;modedb
)paren
suffix:semicolon
id|monA
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|monB
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|monB-&gt;input
op_amp
id|FB_DISP_DDI
)paren
op_logical_and
op_logical_neg
id|par-&gt;FlatPanel
)paren
op_logical_or
(paren
(paren
op_logical_neg
(paren
id|monB-&gt;input
op_amp
id|FB_DISP_DDI
)paren
)paren
op_logical_and
id|par-&gt;FlatPanel
)paren
)paren
(brace
id|fb_destroy_modedb
c_func
(paren
id|monB-&gt;modedb
)paren
suffix:semicolon
id|monB
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
id|monA
op_assign
id|monB
suffix:semicolon
)brace
r_if
c_cond
(paren
id|implementation
op_eq
l_int|0x0110
)paren
id|cr44
op_assign
id|par-&gt;CRTCnumber
op_star
l_int|0x3
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;PCRTC0
comma
l_int|0x00000860
comma
id|oldhead
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D4
comma
l_int|0x44
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;PCIO
comma
l_int|0x03D5
comma
id|cr44
)paren
suffix:semicolon
id|NVSelectHeadRegisters
c_func
(paren
id|par
comma
id|par-&gt;CRTCnumber
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;nvidiafb: Using %s on CRTC %i&bslash;n&quot;
comma
id|par-&gt;FlatPanel
ques
c_cond
(paren
id|par-&gt;Television
ques
c_cond
l_string|&quot;TV&quot;
suffix:colon
l_string|&quot;DFP&quot;
)paren
suffix:colon
l_string|&quot;CRT&quot;
comma
id|par-&gt;CRTCnumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_logical_and
op_logical_neg
id|par-&gt;Television
)paren
(brace
id|par-&gt;fpWidth
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC
comma
l_int|0x0820
)paren
op_plus
l_int|1
suffix:semicolon
id|par-&gt;fpHeight
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC
comma
l_int|0x0800
)paren
op_plus
l_int|1
suffix:semicolon
id|par-&gt;fpSyncs
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;PRAMDAC
comma
l_int|0x0848
)paren
op_amp
l_int|0x30000033
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Panel size is %i x %i&bslash;n&quot;
comma
id|par-&gt;fpWidth
comma
id|par-&gt;fpHeight
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|monA
)paren
id|info-&gt;monspecs
op_assign
op_star
id|monA
suffix:semicolon
id|kfree
c_func
(paren
id|edidA
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|edidB
)paren
suffix:semicolon
)brace
eof
