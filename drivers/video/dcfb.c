multiline_comment|/*&n; *&t;$Id: dcfb.c,v 1.1 2001/04/01 15:02:51 yaegashi Exp $&n; *&t;SEGA Dreamcast framebuffer&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/nubus.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
DECL|macro|BORDERRGB
mdefine_line|#define BORDERRGB&t;0xa05f8040
DECL|macro|DISPLAYMODE
mdefine_line|#define DISPLAYMODE&t;0xa05f8044
DECL|macro|ALPHAMODE
mdefine_line|#define ALPHAMODE&t;0xa05f8048
DECL|macro|DISPLAYALIGN
mdefine_line|#define DISPLAYALIGN&t;0xa05f804c
DECL|macro|BASEOFFSET1
mdefine_line|#define BASEOFFSET1&t;0xa05f8050
DECL|macro|BASEOFFSET2
mdefine_line|#define BASEOFFSET2&t;0xa05f8054
DECL|macro|DISPLAYSIZE
mdefine_line|#define DISPLAYSIZE&t;0xa05f805c
DECL|macro|SYNCMODE
mdefine_line|#define SYNCMODE&t;0xa05f80d0
DECL|macro|VERTICALRANGE
mdefine_line|#define VERTICALRANGE&t;0xa05f80dc
DECL|macro|HORIZPOSITION
mdefine_line|#define HORIZPOSITION&t;0xa05f80ec
DECL|macro|VERTPOSITION
mdefine_line|#define VERTPOSITION&t;0xa05f80f0
DECL|macro|PALETTEMODE
mdefine_line|#define PALETTEMODE&t;0xa05f8108
DECL|macro|VIDEOOUTPUT
mdefine_line|#define VIDEOOUTPUT&t;0xa0702c00
DECL|variable|dc_parm_vga_16bpp
r_static
r_int
r_int
id|dc_parm_vga_16bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x00800005
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|2
comma
id|DISPLAYSIZE
comma
(paren
l_int|1
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|480
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|2
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x100
comma
id|VERTPOSITION
comma
l_int|0x00230023
comma
id|VERTICALRANGE
comma
l_int|0x00280208
comma
id|HORIZPOSITION
comma
l_int|0x00000090
comma
id|VIDEOOUTPUT
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_vga_32bpp
r_static
r_int
r_int
id|dc_parm_vga_32bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x0080000d
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|4
comma
id|DISPLAYSIZE
comma
(paren
l_int|1
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|480
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|4
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x100
comma
id|VERTPOSITION
comma
l_int|0x00230023
comma
id|VERTICALRANGE
comma
l_int|0x00280208
comma
id|HORIZPOSITION
comma
l_int|0x00000090
comma
id|VIDEOOUTPUT
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_vga
r_static
r_int
r_int
op_star
id|dc_parm_vga
(braket
)braket
op_assign
(brace
id|dc_parm_vga_16bpp
comma
id|dc_parm_vga_32bpp
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_composite_16bpp
r_static
r_int
r_int
id|dc_parm_composite_16bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x00000005
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|2
comma
id|DISPLAYSIZE
comma
(paren
(paren
l_int|640
op_star
l_int|2
op_div
l_int|4
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|240
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|2
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x150
comma
id|VERTPOSITION
comma
l_int|0x00120012
comma
id|VERTICALRANGE
comma
l_int|0x00240204
comma
id|HORIZPOSITION
comma
l_int|0x000000a4
comma
id|VIDEOOUTPUT
comma
l_int|0x300
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_composite_32bpp
r_static
r_int
r_int
id|dc_parm_composite_32bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x0000000d
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|4
comma
id|DISPLAYSIZE
comma
(paren
(paren
l_int|640
op_star
l_int|4
op_div
l_int|4
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|240
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|4
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x150
comma
id|VERTPOSITION
comma
l_int|0x00120012
comma
id|VERTICALRANGE
comma
l_int|0x00240204
comma
id|HORIZPOSITION
comma
l_int|0x000000a4
comma
id|VIDEOOUTPUT
comma
l_int|0x300
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_composite
r_static
r_int
r_int
op_star
id|dc_parm_composite
(braket
)braket
op_assign
(brace
id|dc_parm_composite_16bpp
comma
id|dc_parm_composite_32bpp
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_interlace_16bpp
r_static
r_int
r_int
id|dc_parm_interlace_16bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x00000005
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|2
comma
id|DISPLAYSIZE
comma
(paren
(paren
l_int|640
op_star
l_int|2
op_div
l_int|4
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|240
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|2
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x150
comma
id|VERTPOSITION
comma
l_int|0x00120012
comma
id|VERTICALRANGE
comma
l_int|0x00240204
comma
id|HORIZPOSITION
comma
l_int|0x000000a4
comma
id|VIDEOOUTPUT
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_interlace_32bpp
r_static
r_int
r_int
id|dc_parm_interlace_32bpp
(braket
)braket
op_assign
(brace
id|DISPLAYMODE
comma
l_int|0x0000000d
comma
id|BASEOFFSET1
comma
l_int|0
comma
id|BASEOFFSET2
comma
l_int|640
op_star
l_int|4
comma
id|DISPLAYSIZE
comma
(paren
(paren
l_int|640
op_star
l_int|4
op_div
l_int|4
op_plus
l_int|1
)paren
op_lshift
l_int|20
)paren
op_plus
(paren
(paren
l_int|240
op_minus
l_int|1
)paren
op_lshift
l_int|10
)paren
op_plus
(paren
l_int|640
op_star
l_int|4
op_div
l_int|4
op_minus
l_int|1
)paren
comma
id|SYNCMODE
comma
l_int|0x150
comma
id|VERTPOSITION
comma
l_int|0x00120012
comma
id|VERTICALRANGE
comma
l_int|0x00240204
comma
id|HORIZPOSITION
comma
l_int|0x000000a4
comma
id|VIDEOOUTPUT
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|dc_parm_interlace
r_static
r_int
r_int
op_star
id|dc_parm_interlace
(braket
)braket
op_assign
(brace
id|dc_parm_interlace_16bpp
comma
id|dc_parm_interlace_32bpp
comma
)brace
suffix:semicolon
DECL|struct|dcfb_info
r_struct
id|dcfb_info
(brace
DECL|member|gen
r_struct
id|fb_info_gen
id|gen
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|dcfb_par
r_struct
id|dcfb_par
(brace
DECL|member|x
DECL|member|y
r_int
id|x
comma
id|y
suffix:semicolon
DECL|member|bpp
r_int
id|bpp
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|fb_info
r_static
r_struct
id|dcfb_info
id|fb_info
suffix:semicolon
DECL|variable|current_par
r_static
r_struct
id|dcfb_par
id|current_par
suffix:semicolon
DECL|variable|current_par_valid
r_static
r_int
id|current_par_valid
op_assign
l_int|0
suffix:semicolon
DECL|variable|disp
r_static
r_struct
id|display
id|disp
suffix:semicolon
r_static
r_union
(brace
macro_line|#ifdef FBCON_HAS_CFB16
DECL|member|cfb16
id|u16
id|cfb16
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|member|cfb32
id|u32
id|cfb32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
DECL|variable|fbcon_cmap
)brace
id|fbcon_cmap
suffix:semicolon
DECL|variable|dc_parms
r_static
r_int
r_int
op_star
op_star
id|dc_parms
suffix:semicolon
DECL|variable|dc_videobase
DECL|variable|dc_videosize
r_static
r_int
r_int
id|dc_videobase
comma
id|dc_videosize
suffix:semicolon
DECL|variable|default_var
r_static
r_struct
id|fb_var_screeninfo
id|default_var
suffix:semicolon
r_int
id|dcfb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|dcfb_set_par
c_func
(paren
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|dcfb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Check cable type.&n; *&t;0: VGA, 2: RGB, 3: Composite&n; */
DECL|macro|PCTRA
mdefine_line|#define&t;PCTRA&t;0xff80002c
DECL|macro|PDTRA
mdefine_line|#define PDTRA&t;0xff800030
DECL|function|dcfb_cable_check
r_static
r_int
id|dcfb_cable_check
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|temp
op_assign
id|ctrl_inl
c_func
(paren
id|PCTRA
)paren
suffix:semicolon
id|temp
op_and_assign
l_int|0xfff0ffff
suffix:semicolon
id|temp
op_or_assign
l_int|0x000a0000
suffix:semicolon
id|ctrl_outl
c_func
(paren
id|temp
comma
id|PCTRA
)paren
suffix:semicolon
r_return
(paren
id|ctrl_inw
c_func
(paren
id|PDTRA
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|3
suffix:semicolon
)brace
DECL|function|dcfb_detect
r_static
r_void
id|dcfb_detect
c_func
(paren
r_void
)paren
(brace
r_struct
id|dcfb_par
id|par
suffix:semicolon
r_int
id|cable
op_assign
id|dcfb_cable_check
c_func
(paren
)paren
suffix:semicolon
r_int
r_int
op_star
op_star
id|parm_list
(braket
l_int|4
)braket
op_assign
(brace
id|dc_parm_vga
comma
id|dc_parm_vga
comma
id|dc_parm_interlace
comma
id|dc_parm_composite
comma
)brace
suffix:semicolon
r_char
op_star
id|cable_name
(braket
)braket
op_assign
(brace
l_string|&quot;VGA&quot;
comma
l_string|&quot;VGA&quot;
comma
l_string|&quot;Interlace&quot;
comma
l_string|&quot;Composite&quot;
comma
)brace
suffix:semicolon
id|dc_videobase
op_assign
l_int|0xa5000000
suffix:semicolon
id|dc_videosize
op_assign
l_int|0x00200000
suffix:semicolon
id|par.x
op_assign
l_int|640
suffix:semicolon
id|par.y
op_assign
l_int|480
suffix:semicolon
id|par.bpp
op_assign
l_int|32
suffix:semicolon
id|dc_parms
op_assign
id|parm_list
(braket
id|cable
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Dreamcast video cable detected: %s.&bslash;n&quot;
comma
id|cable_name
(braket
id|cable
)braket
)paren
suffix:semicolon
id|dcfb_set_par
c_func
(paren
op_amp
id|par
comma
l_int|NULL
)paren
suffix:semicolon
id|dcfb_encode_var
c_func
(paren
op_amp
id|default_var
comma
op_amp
id|par
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|dcfb_encode_fix
r_static
r_int
id|dcfb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;SEGA Dreamcast&quot;
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|dc_videobase
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|dc_videosize
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;bpp
)paren
(brace
r_default
suffix:colon
r_case
l_int|16
suffix:colon
id|fix-&gt;line_length
op_assign
id|par-&gt;x
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|fix-&gt;line_length
op_assign
id|par-&gt;x
op_star
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_decode_var
r_static
r_int
id|dcfb_decode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|par-&gt;x
op_assign
id|var-&gt;xres
suffix:semicolon
id|par-&gt;y
op_assign
id|var-&gt;yres
suffix:semicolon
id|par-&gt;bpp
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_encode_var
r_static
r_void
id|dcfb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|memset
c_func
(paren
id|var
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|var
)paren
)paren
suffix:semicolon
id|var-&gt;xres
op_assign
id|par-&gt;x
suffix:semicolon
id|var-&gt;yres
op_assign
id|par-&gt;y
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|par-&gt;bpp
suffix:semicolon
id|var-&gt;grayscale
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;nonstd
op_assign
l_int|0
suffix:semicolon
id|var-&gt;activate
op_assign
l_int|0
suffix:semicolon
id|var-&gt;height
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;vmode
op_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
id|var-&gt;pixclock
op_assign
l_int|0
suffix:semicolon
id|var-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|var-&gt;left_margin
op_assign
l_int|0
suffix:semicolon
id|var-&gt;right_margin
op_assign
l_int|0
suffix:semicolon
id|var-&gt;upper_margin
op_assign
l_int|0
suffix:semicolon
id|var-&gt;lower_margin
op_assign
l_int|0
suffix:semicolon
id|var-&gt;hsync_len
op_assign
l_int|0
suffix:semicolon
id|var-&gt;vsync_len
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
multiline_comment|/* RGB 565 */
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_get_par
r_static
r_void
id|dcfb_get_par
c_func
(paren
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
op_star
id|par
op_assign
id|current_par
suffix:semicolon
)brace
DECL|function|dcfb_set_par
r_static
r_void
id|dcfb_set_par
c_func
(paren
r_struct
id|dcfb_par
op_star
id|par
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|a
comma
id|d
comma
op_star
id|p
suffix:semicolon
id|current_par
op_assign
op_star
id|par
suffix:semicolon
id|current_par_valid
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|par-&gt;bpp
)paren
(brace
r_default
suffix:colon
r_case
l_int|16
suffix:colon
id|p
op_assign
id|dc_parms
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|p
op_assign
id|dc_parms
(braket
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ctrl_outl
c_func
(paren
l_int|0
comma
l_int|0xa05f8008
)paren
suffix:semicolon
multiline_comment|/* reset? */
id|ctrl_outl
c_func
(paren
l_int|0
comma
id|BORDERRGB
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|a
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|d
op_assign
op_star
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
r_break
suffix:semicolon
id|ctrl_outl
c_func
(paren
id|d
comma
id|a
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
(brace
DECL|member|red
DECL|member|green
DECL|member|blue
id|u_int
id|red
comma
id|green
comma
id|blue
suffix:semicolon
DECL|variable|palette
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|function|dcfb_getcolreg
r_static
r_int
id|dcfb_getcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
op_star
id|red
comma
id|u_int
op_star
id|green
comma
id|u_int
op_star
id|blue
comma
id|u_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_setcolreg
r_static
r_int
id|dcfb_setcolreg
c_func
(paren
id|u_int
id|regno
comma
id|u_int
id|red
comma
id|u_int
id|green
comma
id|u_int
id|blue
comma
id|u_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|current_par.bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|fbcon_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|fbcon_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_blank
r_static
r_int
id|dcfb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_const
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_set_disp
r_static
r_void
id|dcfb_set_disp
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
id|disp-&gt;screen_base
op_assign
(paren
r_void
op_star
)paren
id|dc_videobase
suffix:semicolon
id|disp-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
r_switch
c_cond
(paren
(paren
(paren
r_struct
id|dcfb_par
op_star
)paren
id|par
)paren
op_member_access_from_pointer
id|bpp
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|fbcon_cmap.cfb32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
)brace
)brace
DECL|variable|dcfb_switch
r_struct
id|fbgen_hwswitch
id|dcfb_switch
op_assign
(brace
id|dcfb_detect
comma
id|dcfb_encode_fix
comma
id|dcfb_decode_var
comma
id|dcfb_encode_var
comma
id|dcfb_get_par
comma
id|dcfb_set_par
comma
id|dcfb_getcolreg
comma
id|dcfb_setcolreg
comma
l_int|NULL
comma
id|dcfb_blank
comma
id|dcfb_set_disp
)brace
suffix:semicolon
DECL|variable|dcfb_ops
r_static
r_struct
id|fb_ops
id|dcfb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|fbgen_get_fix
comma
id|fb_get_var
suffix:colon
id|fbgen_get_var
comma
id|fb_set_var
suffix:colon
id|fbgen_set_var
comma
id|fb_get_cmap
suffix:colon
id|fbgen_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|fbgen_set_cmap
comma
)brace
suffix:semicolon
DECL|function|dcfb_init
r_int
id|__init
id|dcfb_init
c_func
(paren
r_void
)paren
(brace
id|strcpy
c_func
(paren
id|fb_info.gen.info.modename
comma
l_string|&quot;SEGA Dreamcast&quot;
)paren
suffix:semicolon
id|fb_info.gen.info.node
op_assign
op_minus
l_int|1
suffix:semicolon
id|fb_info.gen.info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|fb_info.gen.info.fbops
op_assign
op_amp
id|dcfb_ops
suffix:semicolon
id|fb_info.gen.info.disp
op_assign
op_amp
id|disp
suffix:semicolon
id|fb_info.gen.info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|fb_info.gen.info.switch_con
op_assign
op_amp
id|fbgen_switch
suffix:semicolon
id|fb_info.gen.info.updatevar
op_assign
op_amp
id|fbgen_update_var
suffix:semicolon
id|fb_info.gen.info.blank
op_assign
op_amp
id|fbgen_blank
suffix:semicolon
id|fb_info.gen.parsize
op_assign
r_sizeof
(paren
r_struct
id|dcfb_par
)paren
suffix:semicolon
id|fb_info.gen.fbhw
op_assign
op_amp
id|dcfb_switch
suffix:semicolon
id|fb_info.gen.fbhw
op_member_access_from_pointer
id|detect
c_func
(paren
)paren
suffix:semicolon
id|fbgen_get_var
c_func
(paren
op_amp
id|disp.var
comma
op_minus
l_int|1
comma
op_amp
id|fb_info.gen.info
)paren
suffix:semicolon
id|disp.var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
id|fbgen_do_set_var
c_func
(paren
op_amp
id|disp.var
comma
l_int|1
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
id|fbgen_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
id|fbgen_install_cmap
c_func
(paren
l_int|0
comma
op_amp
id|fb_info.gen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|fb_info.gen.info
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fb%d: %s frame buffer device&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|fb_info.gen.info.node
)paren
comma
id|fb_info.gen.info.modename
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dcfb_cleanup
r_void
id|dcfb_cleanup
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|unregister_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|dcfb_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|dcfb_cleanup
c_func
(paren
r_void
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
