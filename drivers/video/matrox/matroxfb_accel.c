multiline_comment|/*&n; *&n; * Hardware accelerated Matrox Millennium I, II, Mystique, G100, G200 and G400&n; *&n; * (c) 1998-2002 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&n; *&n; * Version: 1.65 2002/08/14&n; *&n; * MTRR stuff: 1998 Tom Rini &lt;trini@kernel.crashing.org&gt;&n; *&n; * Contributors: &quot;menion?&quot; &lt;menion@mindless.com&gt;&n; *                     Betatesting, fixes, ideas&n; *&n; *               &quot;Kurt Garloff&quot; &lt;garloff@suse.de&gt;&n; *                     Betatesting, fixes, ideas, videomodes, videomodes timmings&n; *&n; *               &quot;Tom Rini&quot; &lt;trini@kernel.crashing.org&gt;&n; *                     MTRR stuff, PPC cleanups, betatesting, fixes, ideas&n; *&n; *               &quot;Bibek Sahu&quot; &lt;scorpio@dodds.net&gt;&n; *                     Access device through readb|w|l and write b|w|l&n; *                     Extensive debugging stuff&n; *&n; *               &quot;Daniel Haun&quot; &lt;haund@usa.net&gt;&n; *                     Testing, hardware cursor fixes&n; *&n; *               &quot;Scott Wood&quot; &lt;sawst46+@pitt.edu&gt;&n; *                     Fixes&n; *&n; *               &quot;Gerd Knorr&quot; &lt;kraxel@goldbach.isdn.cs.tu-berlin.de&gt;&n; *                     Betatesting&n; *&n; *               &quot;Kelly French&quot; &lt;targon@hazmat.com&gt;&n; *               &quot;Fernando Herrera&quot; &lt;fherrera@eurielec.etsit.upm.es&gt;&n; *                     Betatesting, bug reporting&n; *&n; *               &quot;Pablo Bianucci&quot; &lt;pbian@pccp.com.ar&gt;&n; *                     Fixes, ideas, betatesting&n; *&n; *               &quot;Inaky Perez Gonzalez&quot; &lt;inaky@peloncho.fis.ucm.es&gt;&n; *                     Fixes, enhandcements, ideas, betatesting&n; *&n; *               &quot;Ryuichi Oikawa&quot; &lt;roikawa@rr.iiij4u.or.jp&gt;&n; *                     PPC betatesting, PPC support, backward compatibility&n; *&n; *               &quot;Paul Womar&quot; &lt;Paul@pwomar.demon.co.uk&gt;&n; *               &quot;Owen Waller&quot; &lt;O.Waller@ee.qub.ac.uk&gt;&n; *                     PPC betatesting&n; *&n; *               &quot;Thomas Pornin&quot; &lt;pornin@bolet.ens.fr&gt;&n; *                     Alpha betatesting&n; *&n; *               &quot;Pieter van Leuven&quot; &lt;pvl@iae.nl&gt;&n; *               &quot;Ulf Jaenicke-Roessler&quot; &lt;ujr@physik.phy.tu-dresden.de&gt;&n; *                     G100 testing&n; *&n; *               &quot;H. Peter Arvin&quot; &lt;hpa@transmeta.com&gt;&n; *                     Ideas&n; *&n; *               &quot;Cort Dougan&quot; &lt;cort@cs.nmt.edu&gt;&n; *                     CHRP fixes and PReP cleanup&n; *&n; *               &quot;Mark Vojkovich&quot; &lt;mvojkovi@ucsd.edu&gt;&n; *                     G400 support&n; *&n; * (following author is not in any relation with this code, but his code&n; *  is included in this driver)&n; *&n; * Based on framebuffer driver for VBE 2.0 compliant graphic boards&n; *     (c) 1998 Gerd Knorr &lt;kraxel@cs.tu-berlin.de&gt;&n; *&n; * (following author is not in any relation with this code, but his ideas&n; *  were used when writting this driver)&n; *&n; *&t;&t; FreeVBE/AF (Matrox), &quot;Shawn Hargreaves&quot; &lt;shawn@talula.demon.co.uk&gt;&n; *&n; */
macro_line|#include &quot;matroxfb_accel.h&quot;
macro_line|#include &quot;matroxfb_DAC1064.h&quot;
macro_line|#include &quot;matroxfb_Ti3026.h&quot;
macro_line|#include &quot;matroxfb_misc.h&quot;
DECL|macro|curr_ydstorg
mdefine_line|#define curr_ydstorg(x)&t;ACCESS_FBINFO2(x, curr.ydstorg.pixels)
DECL|macro|mga_ydstlen
mdefine_line|#define mga_ydstlen(y,l) mga_outl(M_YDSTLEN | M_EXEC, ((y) &lt;&lt; 16) | (l))
DECL|function|matrox_cfb4_pal
r_static
r_inline
r_void
id|matrox_cfb4_pal
c_func
(paren
id|u_int32_t
op_star
id|pal
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pal
(braket
id|i
)braket
op_assign
id|i
op_star
l_int|0x11111111U
suffix:semicolon
)brace
id|pal
(braket
id|i
)braket
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
)brace
DECL|function|matrox_cfb8_pal
r_static
r_inline
r_void
id|matrox_cfb8_pal
c_func
(paren
id|u_int32_t
op_star
id|pal
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pal
(braket
id|i
)braket
op_assign
id|i
op_star
l_int|0x01010101U
suffix:semicolon
)brace
id|pal
(braket
id|i
)braket
op_assign
l_int|0x0F0F0F0F
suffix:semicolon
)brace
r_static
r_void
id|matroxfb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
suffix:semicolon
r_static
r_void
id|matroxfb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
suffix:semicolon
r_static
r_void
id|matroxfb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
suffix:semicolon
r_static
r_void
id|matroxfb_cfb4_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
suffix:semicolon
r_static
r_void
id|matroxfb_cfb4_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
suffix:semicolon
DECL|function|matrox_cfbX_init
r_void
id|matrox_cfbX_init
c_func
(paren
id|WPMINFO2
)paren
(brace
id|u_int32_t
id|maccess
suffix:semicolon
id|u_int32_t
id|mpitch
suffix:semicolon
id|u_int32_t
id|mopmode
suffix:semicolon
r_int
id|accel
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|mpitch
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.xres_virtual
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|cfb_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|cfb_fillrect
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_imageblit
op_assign
id|cfb_imageblit
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_cursor
op_assign
id|soft_cursor
suffix:semicolon
id|accel
op_assign
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
op_eq
id|FB_ACCELF_TEXT
suffix:semicolon
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.bits_per_pixel
)paren
(brace
r_case
l_int|4
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
multiline_comment|/* accelerate as 8bpp video */
id|mpitch
op_assign
(paren
id|mpitch
op_rshift
l_int|1
)paren
op_or
l_int|0x8000
suffix:semicolon
multiline_comment|/* disable linearization */
id|mopmode
op_assign
id|M_OPMODE_4BPP
suffix:semicolon
id|matrox_cfb4_pal
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|cmap
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accel
op_logical_and
op_logical_neg
(paren
id|mpitch
op_amp
l_int|1
)paren
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|matroxfb_cfb4_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|matroxfb_cfb4_fillrect
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_8BPP
suffix:semicolon
id|matrox_cfb8_pal
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|cmap
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|matroxfb_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|matroxfb_fillrect
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_imageblit
op_assign
id|matroxfb_imageblit
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.green.length
op_eq
l_int|5
)paren
(brace
id|maccess
op_assign
l_int|0xC0000001
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cmap
(braket
l_int|16
)braket
)paren
op_assign
l_int|0x7FFF7FFF
suffix:semicolon
)brace
r_else
(brace
id|maccess
op_assign
l_int|0x40000001
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cmap
(braket
l_int|16
)braket
)paren
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
)brace
id|mopmode
op_assign
id|M_OPMODE_16BPP
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|matroxfb_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|matroxfb_fillrect
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_imageblit
op_assign
id|matroxfb_imageblit
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|maccess
op_assign
l_int|0x00000003
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_24BPP
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cmap
(braket
l_int|16
)braket
)paren
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|matroxfb_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|matroxfb_fillrect
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_imageblit
op_assign
id|matroxfb_imageblit
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|maccess
op_assign
l_int|0x00000002
suffix:semicolon
id|mopmode
op_assign
id|M_OPMODE_32BPP
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|cmap
(braket
l_int|16
)braket
)paren
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_copyarea
op_assign
id|matroxfb_copyarea
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_fillrect
op_assign
id|matroxfb_fillrect
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|fbops
)paren
dot
id|fb_imageblit
op_assign
id|matroxfb_imageblit
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|maccess
op_assign
l_int|0x00000000
suffix:semicolon
id|mopmode
op_assign
l_int|0x00000000
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* turn off acceleration!!! */
)brace
id|mga_fifo
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_PITCH
comma
id|mpitch
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDSTORG
comma
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|capable.plnwt
)paren
)paren
id|mga_outl
c_func
(paren
id|M_PLNWT
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|capable.srcorg
)paren
)paren
(brace
id|mga_outl
c_func
(paren
id|M_SRCORG
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DSTORG
comma
l_int|0
)paren
suffix:semicolon
)brace
id|mga_outl
c_func
(paren
id|M_OPMODE
comma
id|mopmode
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CXBNDRY
comma
l_int|0xFFFF0000
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YTOP
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YBOT
comma
l_int|0x01FFFFFF
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
id|maccess
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_assign
id|M_DWG_TRAP
op_or
id|M_DWG_SOLID
op_or
id|M_DWG_ARZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
suffix:semicolon
r_if
c_cond
(paren
id|isMilleniumII
c_func
(paren
id|MINFO
)paren
)paren
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or_assign
id|M_DWG_TRANSC
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_opmode
)paren
op_assign
id|mopmode
suffix:semicolon
)brace
DECL|variable|matrox_cfbX_init
id|EXPORT_SYMBOL
c_func
(paren
id|matrox_cfbX_init
)paren
suffix:semicolon
DECL|function|matrox_accel_bmove
r_static
r_void
id|matrox_accel_bmove
c_func
(paren
id|WPMINFO
r_int
id|vxres
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|start
comma
id|end
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
r_if
c_cond
(paren
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
(paren
id|dy
op_eq
id|sy
)paren
op_logical_and
(paren
id|dx
op_le
id|sx
)paren
)paren
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
id|vxres
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|start
op_assign
id|sy
op_star
id|vxres
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|width
suffix:semicolon
)brace
r_else
(brace
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_SGN
comma
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
op_minus
id|vxres
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|end
op_assign
(paren
id|sy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|vxres
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|start
op_assign
id|end
op_plus
id|width
suffix:semicolon
id|dy
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
id|mga_fifo
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|end
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|start
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|dx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|dx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|dy
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matrox_accel_bmove_lin
r_static
r_void
id|matrox_accel_bmove_lin
c_func
(paren
id|WPMINFO
r_int
id|vxres
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|start
comma
id|end
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
r_if
c_cond
(paren
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
(paren
id|dy
op_eq
id|sy
)paren
op_logical_and
(paren
id|dx
op_le
id|sx
)paren
)paren
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
id|vxres
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|start
op_assign
id|sy
op_star
id|vxres
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|width
suffix:semicolon
)brace
r_else
(brace
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_BITBLT
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BFCOL
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_SGN
comma
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR5
comma
op_minus
id|vxres
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|end
op_assign
(paren
id|sy
op_plus
id|height
op_minus
l_int|1
)paren
op_star
id|vxres
op_plus
id|sx
op_plus
id|curr_ydstorg
c_func
(paren
id|MINFO
)paren
suffix:semicolon
id|start
op_assign
id|end
op_plus
id|width
suffix:semicolon
id|dy
op_add_assign
id|height
op_minus
l_int|1
suffix:semicolon
)brace
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR0
comma
id|end
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_AR3
comma
id|start
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|dx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|dx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDST
comma
id|dy
op_star
id|vxres
op_rshift
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_LEN
op_or
id|M_EXEC
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matroxfb_cfb4_copyarea
r_static
r_void
id|matroxfb_cfb4_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
(brace
id|MINFO_FROM_INFO
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|area-&gt;sx
op_or
id|area-&gt;dx
op_or
id|area-&gt;width
)paren
op_amp
l_int|1
)paren
id|cfb_copyarea
c_func
(paren
id|info
comma
id|area
)paren
suffix:semicolon
r_else
id|matrox_accel_bmove_lin
c_func
(paren
id|PMINFO
id|ACCESS_FBINFO
c_func
(paren
id|fbcon.var.xres_virtual
)paren
op_rshift
l_int|1
comma
id|area-&gt;sy
comma
id|area-&gt;sx
op_rshift
l_int|1
comma
id|area-&gt;dy
comma
id|area-&gt;dx
op_rshift
l_int|1
comma
id|area-&gt;height
comma
id|area-&gt;width
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|matroxfb_copyarea
r_static
r_void
id|matroxfb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
(brace
id|MINFO_FROM_INFO
c_func
(paren
id|info
)paren
suffix:semicolon
id|matrox_accel_bmove
c_func
(paren
id|PMINFO
id|ACCESS_FBINFO
c_func
(paren
id|fbcon.var.xres_virtual
)paren
comma
id|area-&gt;sy
comma
id|area-&gt;sx
comma
id|area-&gt;dy
comma
id|area-&gt;dx
comma
id|area-&gt;height
comma
id|area-&gt;width
)paren
suffix:semicolon
)brace
DECL|function|matroxfb_accel_clear
r_static
r_void
id|matroxfb_accel_clear
c_func
(paren
id|WPMINFO
id|u_int32_t
id|color
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|color
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|sx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|sx
)paren
suffix:semicolon
id|mga_ydstlen
c_func
(paren
id|sy
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matroxfb_fillrect
r_static
r_void
id|matroxfb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
id|MINFO_FROM_INFO
c_func
(paren
id|info
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rect-&gt;rop
)paren
(brace
r_case
id|ROP_COPY
suffix:colon
id|matroxfb_accel_clear
c_func
(paren
id|PMINFO
(paren
(paren
id|u_int32_t
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|rect-&gt;color
)braket
comma
id|rect-&gt;dy
comma
id|rect-&gt;dx
comma
id|rect-&gt;height
comma
id|rect-&gt;width
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|matroxfb_cfb4_clear
r_static
r_void
id|matroxfb_cfb4_clear
c_func
(paren
id|WPMINFO
id|u_int32_t
id|bgx
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|whattodo
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
id|whattodo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|sx
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|width
)paren
r_return
suffix:semicolon
id|width
op_decrement
suffix:semicolon
id|whattodo
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|whattodo
op_or_assign
l_int|2
suffix:semicolon
)brace
id|width
op_rshift_assign
l_int|1
suffix:semicolon
id|sx
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|width
)paren
(brace
id|mga_fifo
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|ACCESS_FBINFO
c_func
(paren
id|accel.m_dwg_rect
)paren
op_or
id|M_DWG_REPLACE2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|bgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FXBNDRY
comma
(paren
(paren
id|sx
op_plus
id|width
)paren
op_lshift
l_int|16
)paren
op_or
id|sx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_YDST
comma
id|sy
op_star
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.xres_virtual
op_rshift
l_int|6
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_LEN
op_or
id|M_EXEC
comma
id|height
)paren
suffix:semicolon
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|whattodo
)paren
(brace
id|u_int32_t
id|step
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.xres_virtual
op_rshift
l_int|1
suffix:semicolon
id|vaddr_t
id|vbase
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|whattodo
op_amp
l_int|1
)paren
(brace
r_int
r_int
id|uaddr
op_assign
id|sy
op_star
id|step
op_plus
id|sx
op_minus
l_int|1
suffix:semicolon
id|u_int32_t
id|loop
suffix:semicolon
id|u_int8_t
id|bgx2
op_assign
id|bgx
op_amp
l_int|0xF0
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
id|height
suffix:semicolon
id|loop
OG
l_int|0
suffix:semicolon
id|loop
op_decrement
)paren
(brace
id|mga_writeb
c_func
(paren
id|vbase
comma
id|uaddr
comma
(paren
id|mga_readb
c_func
(paren
id|vbase
comma
id|uaddr
)paren
op_amp
l_int|0x0F
)paren
op_or
id|bgx2
)paren
suffix:semicolon
id|uaddr
op_add_assign
id|step
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|whattodo
op_amp
l_int|2
)paren
(brace
r_int
r_int
id|uaddr
op_assign
id|sy
op_star
id|step
op_plus
id|sx
op_plus
id|width
suffix:semicolon
id|u_int32_t
id|loop
suffix:semicolon
id|u_int8_t
id|bgx2
op_assign
id|bgx
op_amp
l_int|0x0F
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
id|height
suffix:semicolon
id|loop
OG
l_int|0
suffix:semicolon
id|loop
op_decrement
)paren
(brace
id|mga_writeb
c_func
(paren
id|vbase
comma
id|uaddr
comma
(paren
id|mga_readb
c_func
(paren
id|vbase
comma
id|uaddr
)paren
op_amp
l_int|0xF0
)paren
op_or
id|bgx2
)paren
suffix:semicolon
id|uaddr
op_add_assign
id|step
suffix:semicolon
)brace
)brace
)brace
id|CRITEND
)brace
DECL|function|matroxfb_cfb4_fillrect
r_static
r_void
id|matroxfb_cfb4_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
id|MINFO_FROM_INFO
c_func
(paren
id|info
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rect-&gt;rop
)paren
(brace
r_case
id|ROP_COPY
suffix:colon
id|matroxfb_cfb4_clear
c_func
(paren
id|PMINFO
(paren
(paren
id|u_int32_t
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|rect-&gt;color
)braket
comma
id|rect-&gt;dy
comma
id|rect-&gt;dx
comma
id|rect-&gt;height
comma
id|rect-&gt;width
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|matroxfb_1bpp_imageblit
r_static
r_void
id|matroxfb_1bpp_imageblit
c_func
(paren
id|WPMINFO
id|u_int32_t
id|fgx
comma
id|u_int32_t
id|bgx
comma
r_const
id|u_int8_t
op_star
id|chardata
comma
r_int
id|width
comma
r_int
id|height
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
id|u_int32_t
id|step
suffix:semicolon
id|u_int32_t
id|ydstlen
suffix:semicolon
id|u_int32_t
id|xlen
suffix:semicolon
id|u_int32_t
id|ar0
suffix:semicolon
id|u_int32_t
id|charcell
suffix:semicolon
id|u_int32_t
id|fxbndry
suffix:semicolon
id|vaddr_t
id|mmio
suffix:semicolon
r_int
id|easy
suffix:semicolon
id|CRITFLAGS
id|DBG_HEAVY
c_func
(paren
id|__FUNCTION__
)paren
suffix:semicolon
id|step
op_assign
(paren
id|width
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
id|charcell
op_assign
id|height
op_star
id|step
suffix:semicolon
id|xlen
op_assign
(paren
id|charcell
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|ydstlen
op_assign
(paren
id|yy
op_lshift
l_int|16
)paren
op_or
id|height
suffix:semicolon
r_if
c_cond
(paren
id|width
op_eq
id|step
op_lshift
l_int|3
)paren
(brace
id|ar0
op_assign
id|height
op_star
id|width
op_minus
l_int|1
suffix:semicolon
id|easy
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|ar0
op_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|easy
op_assign
l_int|0
suffix:semicolon
)brace
id|CRITBEGIN
id|mga_fifo
c_func
(paren
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|easy
)paren
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_LINEAR
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
r_else
id|mga_outl
c_func
(paren
id|M_DWGCTL
comma
id|M_DWG_ILOAD
op_or
id|M_DWG_SGNZERO
op_or
id|M_DWG_SHIFTZERO
op_or
id|M_DWG_BMONOWF
op_or
id|M_DWG_REPLACE
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_FCOL
comma
id|fgx
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_BCOL
comma
id|bgx
)paren
suffix:semicolon
id|fxbndry
op_assign
(paren
(paren
id|xx
op_plus
id|width
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
id|xx
suffix:semicolon
id|mmio
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|mmio.vbase
)paren
suffix:semicolon
id|mga_fifo
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_FXBNDRY
comma
id|fxbndry
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR0
comma
id|ar0
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR3
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|easy
)paren
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_YDSTLEN
op_or
id|M_EXEC
comma
id|ydstlen
)paren
suffix:semicolon
id|mga_memcpy_toio
c_func
(paren
id|mmio
comma
id|chardata
comma
id|xlen
)paren
suffix:semicolon
)brace
r_else
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_AR5
comma
l_int|0
)paren
suffix:semicolon
id|mga_writel
c_func
(paren
id|mmio
comma
id|M_YDSTLEN
op_or
id|M_EXEC
comma
id|ydstlen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|step
op_amp
l_int|3
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Great. Source has 32bit aligned lines, so we can feed them&n;&t;&t;&t;   directly to the accelerator. */
id|mga_memcpy_toio
c_func
(paren
id|mmio
comma
id|chardata
comma
id|charcell
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|step
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Special case for 1..8bit widths */
r_while
c_loop
(paren
id|height
op_decrement
)paren
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
op_star
id|chardata
)paren
suffix:semicolon
id|chardata
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|step
op_eq
l_int|2
)paren
(brace
multiline_comment|/* Special case for 9..15bit widths */
r_while
c_loop
(paren
id|height
op_decrement
)paren
(brace
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
op_star
(paren
id|u_int16_t
op_star
)paren
id|chardata
)paren
suffix:semicolon
id|chardata
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Tell... well, why bother... */
r_while
c_loop
(paren
id|height
op_decrement
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|step
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
multiline_comment|/* Hope that there are at least three readable bytes beyond the end of bitmap */
id|mga_writel
c_func
(paren
id|mmio
comma
l_int|0
comma
id|get_unaligned
c_func
(paren
(paren
id|u_int32_t
op_star
)paren
(paren
id|chardata
op_plus
id|i
)paren
)paren
)paren
suffix:semicolon
)brace
id|chardata
op_add_assign
id|step
suffix:semicolon
)brace
)brace
)brace
id|WaitTillIdle
c_func
(paren
)paren
suffix:semicolon
id|CRITEND
)brace
DECL|function|matroxfb_imageblit
r_static
r_void
id|matroxfb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
(brace
id|MINFO_FROM_INFO
c_func
(paren
id|info
)paren
suffix:semicolon
id|DBG_HEAVY
c_func
(paren
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|image-&gt;depth
op_eq
l_int|0
)paren
(brace
id|u_int32_t
id|fgx
comma
id|bgx
suffix:semicolon
id|fgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;fg_color
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u_int32_t
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;bg_color
)braket
suffix:semicolon
id|matroxfb_1bpp_imageblit
c_func
(paren
id|PMINFO
id|fgx
comma
id|bgx
comma
id|image-&gt;data
comma
id|image-&gt;width
comma
id|image-&gt;height
comma
id|image-&gt;dy
comma
id|image-&gt;dx
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Danger! image-&gt;depth is useless: logo painting code always&n;&t;&t;   passes framebuffer color depth here, although logo data are&n;&t;&t;   always 8bpp and info-&gt;pseudo_palette is changed to contain&n;&t;&t;   logo palette to be used (but only for true/direct-color... sic...).&n;&t;&t;   So do it completely in software... */
id|cfb_imageblit
c_func
(paren
id|info
comma
id|image
)paren
suffix:semicolon
)brace
)brace
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
