multiline_comment|/*&n; *&n; * Hardware accelerated Matrox Millennium I, II, Mystique, G100, G200, G400 and G450.&n; *&n; * (c) 1998-2002 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&n; *&n; * Portions Copyright (c) 2001 Matrox Graphics Inc.&n; *&n; * Version: 1.65 2002/08/14&n; *&n; * See matroxfb_base.c for contributors.&n; *&n; */
multiline_comment|/* make checkconfig does not walk through include tree :-( */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;matroxfb_DAC1064.h&quot;
macro_line|#include &quot;matroxfb_misc.h&quot;
macro_line|#include &quot;matroxfb_accel.h&quot;
macro_line|#include &quot;g450_pll.h&quot;
macro_line|#include &lt;linux/matroxfb.h&gt;
macro_line|#ifdef NEED_DAC1064
DECL|macro|outDAC1064
mdefine_line|#define outDAC1064 matroxfb_DAC_out
DECL|macro|inDAC1064
mdefine_line|#define inDAC1064 matroxfb_DAC_in
DECL|macro|DAC1064_OPT_SCLK_PCI
mdefine_line|#define DAC1064_OPT_SCLK_PCI&t;0x00
DECL|macro|DAC1064_OPT_SCLK_PLL
mdefine_line|#define DAC1064_OPT_SCLK_PLL&t;0x01
DECL|macro|DAC1064_OPT_SCLK_EXT
mdefine_line|#define DAC1064_OPT_SCLK_EXT&t;0x02
DECL|macro|DAC1064_OPT_SCLK_MASK
mdefine_line|#define DAC1064_OPT_SCLK_MASK&t;0x03
DECL|macro|DAC1064_OPT_GDIV1
mdefine_line|#define DAC1064_OPT_GDIV1&t;0x04&t;/* maybe it is GDIV2 on G100 ?! */
DECL|macro|DAC1064_OPT_GDIV3
mdefine_line|#define DAC1064_OPT_GDIV3&t;0x00
DECL|macro|DAC1064_OPT_MDIV1
mdefine_line|#define DAC1064_OPT_MDIV1&t;0x08
DECL|macro|DAC1064_OPT_MDIV2
mdefine_line|#define DAC1064_OPT_MDIV2&t;0x00
DECL|macro|DAC1064_OPT_RESERVED
mdefine_line|#define DAC1064_OPT_RESERVED&t;0x10
DECL|function|DAC1064_calcclock
r_static
r_void
id|DAC1064_calcclock
c_func
(paren
id|CPMINFO
r_int
r_int
id|freq
comma
r_int
r_int
id|fmax
comma
r_int
r_int
op_star
id|in
comma
r_int
r_int
op_star
id|feed
comma
r_int
r_int
op_star
id|post
)paren
(brace
r_int
r_int
id|fvco
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
multiline_comment|/* only for devices older than G450 */
id|fvco
op_assign
id|PLL_calcclock
c_func
(paren
id|PMINFO
id|freq
comma
id|fmax
comma
id|in
comma
id|feed
comma
op_amp
id|p
)paren
suffix:semicolon
id|p
op_assign
(paren
l_int|1
op_lshift
id|p
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fvco
op_le
l_int|100000
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fvco
op_le
l_int|140000
)paren
id|p
op_or_assign
l_int|0x08
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fvco
op_le
l_int|180000
)paren
id|p
op_or_assign
l_int|0x10
suffix:semicolon
r_else
id|p
op_or_assign
l_int|0x18
suffix:semicolon
op_star
id|post
op_assign
id|p
suffix:semicolon
)brace
multiline_comment|/* they must be in POS order */
DECL|variable|MGA1064_DAC_regs
r_static
r_const
r_int
r_char
id|MGA1064_DAC_regs
(braket
)braket
op_assign
(brace
id|M1064_XCURADDL
comma
id|M1064_XCURADDH
comma
id|M1064_XCURCTRL
comma
id|M1064_XCURCOL0RED
comma
id|M1064_XCURCOL0GREEN
comma
id|M1064_XCURCOL0BLUE
comma
id|M1064_XCURCOL1RED
comma
id|M1064_XCURCOL1GREEN
comma
id|M1064_XCURCOL1BLUE
comma
id|M1064_XCURCOL2RED
comma
id|M1064_XCURCOL2GREEN
comma
id|M1064_XCURCOL2BLUE
comma
id|DAC1064_XVREFCTRL
comma
id|M1064_XMULCTRL
comma
id|M1064_XPIXCLKCTRL
comma
id|M1064_XGENCTRL
comma
id|M1064_XMISCCTRL
comma
id|M1064_XGENIOCTRL
comma
id|M1064_XGENIODATA
comma
id|M1064_XZOOMCTRL
comma
id|M1064_XSENSETEST
comma
id|M1064_XCRCBITSEL
comma
id|M1064_XCOLKEYMASKL
comma
id|M1064_XCOLKEYMASKH
comma
id|M1064_XCOLKEYL
comma
id|M1064_XCOLKEYH
)brace
suffix:semicolon
DECL|variable|MGA1064_DAC
r_static
r_const
r_int
r_char
id|MGA1064_DAC
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
id|M1064_XCURCTRL_DIS
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* black */
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
comma
multiline_comment|/* white */
l_int|0xFF
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* red */
l_int|0x00
comma
l_int|0
comma
id|M1064_XPIXCLKCTRL_PLL_UP
op_or
id|M1064_XPIXCLKCTRL_EN
op_or
id|M1064_XPIXCLKCTRL_SRC_PLL
comma
id|M1064_XGENCTRL_VS_0
op_or
id|M1064_XGENCTRL_ALPHA_DIS
op_or
id|M1064_XGENCTRL_BLACK_0IRE
op_or
id|M1064_XGENCTRL_NO_SYNC_ON_GREEN
comma
id|M1064_XMISCCTRL_DAC_8BIT
comma
l_int|0x00
comma
l_int|0x00
comma
id|M1064_XZOOMCTRL_1
comma
id|M1064_XSENSETEST_BCOMP
op_or
id|M1064_XSENSETEST_GCOMP
op_or
id|M1064_XSENSETEST_RCOMP
op_or
id|M1064_XSENSETEST_PDOWN
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
DECL|function|DAC1064_setpclk
r_static
r_void
id|DAC1064_setpclk
c_func
(paren
id|WPMINFO
r_int
r_int
id|fout
)paren
(brace
r_int
r_int
id|m
comma
id|n
comma
id|p
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|DAC1064_calcclock
c_func
(paren
id|PMINFO
id|fout
comma
id|ACCESS_FBINFO
c_func
(paren
id|max_pixel_clock
)paren
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACclk
(braket
l_int|0
)braket
op_assign
id|m
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACclk
(braket
l_int|1
)braket
op_assign
id|n
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACclk
(braket
l_int|2
)braket
op_assign
id|p
suffix:semicolon
)brace
DECL|function|DAC1064_setmclk
r_static
r_void
id|DAC1064_setmclk
c_func
(paren
id|WPMINFO
r_int
id|oscinfo
comma
r_int
r_int
id|fmem
)paren
(brace
id|u_int32_t
id|mx
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.noinit
)paren
)paren
(brace
multiline_comment|/* read MCLK and give up... */
id|hw-&gt;DACclk
(braket
l_int|3
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
)paren
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|4
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
)paren
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|5
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mx
op_assign
id|hw-&gt;MXoptionReg
op_or
l_int|0x00000004
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|mx
)paren
suffix:semicolon
id|mx
op_and_assign
op_complement
l_int|0x000000BB
suffix:semicolon
r_if
c_cond
(paren
id|oscinfo
op_amp
id|DAC1064_OPT_GDIV1
)paren
id|mx
op_or_assign
l_int|0x00000008
suffix:semicolon
r_if
c_cond
(paren
id|oscinfo
op_amp
id|DAC1064_OPT_MDIV1
)paren
id|mx
op_or_assign
l_int|0x00000010
suffix:semicolon
r_if
c_cond
(paren
id|oscinfo
op_amp
id|DAC1064_OPT_RESERVED
)paren
id|mx
op_or_assign
l_int|0x00000080
suffix:semicolon
r_if
c_cond
(paren
(paren
id|oscinfo
op_amp
id|DAC1064_OPT_SCLK_MASK
)paren
op_eq
id|DAC1064_OPT_SCLK_PLL
)paren
(brace
multiline_comment|/* select PCI clock until we have setup oscilator... */
r_int
id|clk
suffix:semicolon
r_int
r_int
id|m
comma
id|n
comma
id|p
suffix:semicolon
multiline_comment|/* powerup system PLL, select PCI clock */
id|mx
op_or_assign
l_int|0x00000020
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|mx
)paren
suffix:semicolon
id|mx
op_and_assign
op_complement
l_int|0x00000004
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|mx
)paren
suffix:semicolon
multiline_comment|/* !!! you must not access device if MCLK is not running !!!&n;&t;&t;   Doing so cause immediate PCI lockup :-( Maybe they should&n;&t;&t;   generate ABORT or I/O (parity...) error and Linux should&n;&t;&t;   recover from this... (kill driver/process). But world is not&n;&t;&t;   perfect... */
multiline_comment|/* (bit 2 of PCI_OPTION_REG must be 0... and bits 0,1 must not&n;&t;&t;   select PLL... because of PLL can be stopped at this time) */
id|DAC1064_calcclock
c_func
(paren
id|PMINFO
id|fmem
comma
id|ACCESS_FBINFO
c_func
(paren
id|max_pixel_clock
)paren
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
comma
id|hw-&gt;DACclk
(braket
l_int|3
)braket
op_assign
id|m
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
comma
id|hw-&gt;DACclk
(braket
l_int|4
)braket
op_assign
id|n
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
comma
id|hw-&gt;DACclk
(braket
l_int|5
)braket
op_assign
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|clk
op_assign
l_int|65536
suffix:semicolon
id|clk
suffix:semicolon
op_decrement
id|clk
)paren
(brace
r_if
c_cond
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLSTAT
)paren
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|clk
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;matroxfb: aiee, SYSPLL not locked&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* select PLL */
id|mx
op_or_assign
l_int|0x00000005
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* select specified system clock source */
id|mx
op_or_assign
id|oscinfo
op_amp
id|DAC1064_OPT_SCLK_MASK
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|mx
)paren
suffix:semicolon
id|mx
op_and_assign
op_complement
l_int|0x00000004
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|mx
)paren
suffix:semicolon
id|hw-&gt;MXoptionReg
op_assign
id|mx
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|function|g450_set_plls
r_static
r_void
id|g450_set_plls
c_func
(paren
id|WPMINFO2
)paren
(brace
id|u_int32_t
id|c2_ctl
suffix:semicolon
r_int
r_int
id|pxc
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
r_int
id|pixelmnp
suffix:semicolon
r_int
id|videomnp
suffix:semicolon
id|c2_ctl
op_assign
id|hw-&gt;crtc2.ctl
op_amp
op_complement
l_int|0x4007
suffix:semicolon
multiline_comment|/* Clear PLL + enable for CRTC2 */
id|c2_ctl
op_or_assign
l_int|0x0001
suffix:semicolon
multiline_comment|/* Enable CRTC2 */
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
multiline_comment|/* Stop VIDEO PLL */
id|pixelmnp
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|crtc1
)paren
dot
id|mnp
suffix:semicolon
id|videomnp
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|crtc2
)paren
dot
id|mnp
suffix:semicolon
r_if
c_cond
(paren
id|videomnp
OL
l_int|0
)paren
(brace
id|c2_ctl
op_and_assign
op_complement
l_int|0x0001
suffix:semicolon
multiline_comment|/* Disable CRTC2 */
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_and_assign
op_complement
l_int|0x10
suffix:semicolon
multiline_comment|/* Powerdown CRTC2 */
)brace
r_else
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|crtc2
)paren
dot
id|pixclock
op_eq
id|ACCESS_FBINFO
c_func
(paren
id|features
)paren
dot
id|pll.ref_freq
)paren
(brace
id|c2_ctl
op_or_assign
l_int|0x4002
suffix:semicolon
multiline_comment|/* Use reference directly */
)brace
r_else
r_if
c_cond
(paren
id|videomnp
op_eq
id|pixelmnp
)paren
(brace
id|c2_ctl
op_or_assign
l_int|0x0004
suffix:semicolon
multiline_comment|/* Use pixel PLL */
)brace
r_else
(brace
r_if
c_cond
(paren
l_int|0
op_eq
(paren
(paren
id|videomnp
op_xor
id|pixelmnp
)paren
op_amp
l_int|0xFFFFFF00
)paren
)paren
(brace
multiline_comment|/* PIXEL and VIDEO PLL must not use same frequency. We modify N&n;&t;&t;&t;   of PIXEL PLL in such case because of VIDEO PLL may be source&n;&t;&t;&t;   of TVO clocks, and chroma subcarrier is derived from its&n;&t;&t;&t;   pixel clocks */
id|pixelmnp
op_add_assign
l_int|0x000100
suffix:semicolon
)brace
id|c2_ctl
op_or_assign
l_int|0x0006
suffix:semicolon
multiline_comment|/* Use video PLL */
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_or_assign
l_int|0x02
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
)paren
suffix:semicolon
id|matroxfb_g450_setpll_cond
c_func
(paren
id|PMINFO
id|videomnp
comma
id|M_VIDEO_PLL
)paren
suffix:semicolon
)brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
op_and_assign
op_complement
id|M1064_XPIXCLKCTRL_PLL_UP
suffix:semicolon
r_if
c_cond
(paren
id|pixelmnp
op_ge
l_int|0
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
op_or_assign
id|M1064_XPIXCLKCTRL_PLL_UP
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
)paren
suffix:semicolon
id|matroxfb_g450_setpll_cond
c_func
(paren
id|PMINFO
id|pixelmnp
comma
id|M_PIXEL_PLL_C
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c2_ctl
op_ne
id|hw-&gt;crtc2.ctl
)paren
(brace
id|hw-&gt;crtc2.ctl
op_assign
id|c2_ctl
suffix:semicolon
id|mga_outl
c_func
(paren
l_int|0x3C10
comma
id|c2_ctl
)paren
suffix:semicolon
)brace
id|pxc
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|crtc1
)paren
dot
id|pixclock
suffix:semicolon
r_if
c_cond
(paren
id|pxc
op_eq
l_int|0
op_logical_or
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|2
)braket
)paren
dot
id|src
op_eq
id|MATROXFB_SRC_CRTC2
)paren
(brace
id|pxc
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|crtc2
)paren
dot
id|pixclock
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|chip
)paren
op_eq
id|MGA_G550
)paren
(brace
r_if
c_cond
(paren
id|pxc
OL
l_int|45000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* 0-50 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|55000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* 34-62 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|70000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* 42-78 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|85000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x18
suffix:semicolon
multiline_comment|/* 62-92 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|100000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* 74-108 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|115000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x28
suffix:semicolon
multiline_comment|/* 94-122 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|125000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x30
suffix:semicolon
multiline_comment|/* 108-132 */
)brace
r_else
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x38
suffix:semicolon
multiline_comment|/* 120-168 */
)brace
)brace
r_else
(brace
multiline_comment|/* G450 */
r_if
c_cond
(paren
id|pxc
OL
l_int|45000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* 0-54 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|65000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* 38-70 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|85000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* 56-96 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|105000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x18
suffix:semicolon
multiline_comment|/* 80-114 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|135000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* 102-144 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|160000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x28
suffix:semicolon
multiline_comment|/* 132-166 */
)brace
r_else
r_if
c_cond
(paren
id|pxc
OL
l_int|175000
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x30
suffix:semicolon
multiline_comment|/* 154-182 */
)brace
r_else
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
op_assign
l_int|0x38
suffix:semicolon
multiline_comment|/* 170-204 */
)brace
)brace
)brace
macro_line|#endif
DECL|function|DAC1064_global_init
r_void
id|DAC1064_global_init
c_func
(paren
id|WPMINFO2
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_and_assign
id|M1064_XMISCCTRL_DAC_WIDTHMASK
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|M1064_XMISCCTRL_LUT_EN
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
op_assign
id|M1064_XPIXCLKCTRL_PLL_UP
op_or
id|M1064_XPIXCLKCTRL_EN
op_or
id|M1064_XPIXCLKCTRL_SRC_PLL
suffix:semicolon
macro_line|#ifdef CONFIG_FB_MATROX_G
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_assign
l_int|0x1F
suffix:semicolon
multiline_comment|/* powerup everything */
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* disable outputs */
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|M1064_XMISCCTRL_DAC_EN
suffix:semicolon
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|src
)paren
(brace
r_case
id|MATROXFB_SRC_CRTC1
suffix:colon
r_case
id|MATROXFB_SRC_CRTC2
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* enable output; CRTC1/2 selection is in CRTC2 ctl */
r_break
suffix:semicolon
r_case
id|MATROXFB_SRC_NONE
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_and_assign
op_complement
id|M1064_XMISCCTRL_DAC_EN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|1
)braket
)paren
dot
id|src
)paren
(brace
r_case
id|MATROXFB_SRC_CRTC1
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MATROXFB_SRC_CRTC2
suffix:colon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|1
)braket
)paren
dot
id|mode
op_eq
id|MATROXFB_OUTPUT_MODE_MONITOR
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x0C
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MATROXFB_SRC_NONE
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
multiline_comment|/* Poweroff DAC2 */
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|2
)braket
)paren
dot
id|src
)paren
(brace
r_case
id|MATROXFB_SRC_CRTC1
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x20
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MATROXFB_SRC_CRTC2
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
op_or_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MATROXFB_SRC_NONE
suffix:colon
macro_line|#if 0
multiline_comment|/* HELP! If we boot without DFP connected to DVI, we can&n;&t;&t;&t;&t;   poweroff TMDS. But if we boot with DFP connected,&n;&t;&t;&t;&t;   TMDS generated clocks are used instead of ALL pixclocks&n;&t;&t;&t;&t;   available... If someone knows which register&n;&t;&t;&t;&t;   handles it, please reveal this secret to me... */
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
op_and_assign
op_complement
l_int|0x04
suffix:semicolon
multiline_comment|/* Poweroff TMDS */
macro_line|#endif&t;&t;&t;&t;
r_break
suffix:semicolon
)brace
multiline_comment|/* Now set timming related variables... */
id|g450_set_plls
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|1
)braket
)paren
dot
id|src
op_eq
id|MATROXFB_SRC_CRTC1
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
op_assign
id|M1064_XPIXCLKCTRL_PLL_UP
op_or
id|M1064_XPIXCLKCTRL_EN
op_or
id|M1064_XPIXCLKCTRL_SRC_EXT
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|GX00_XMISCCTRL_MFC_MAFC
op_or
id|G400_XMISCCTRL_VDO_MAFC12
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|1
)braket
)paren
dot
id|src
op_eq
id|MATROXFB_SRC_CRTC2
)paren
(brace
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|GX00_XMISCCTRL_MFC_MAFC
op_or
id|G400_XMISCCTRL_VDO_C2_MAFC12
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|2
)braket
)paren
dot
id|src
op_eq
id|MATROXFB_SRC_CRTC1
)paren
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|GX00_XMISCCTRL_MFC_PANELLINK
op_or
id|G400_XMISCCTRL_VDO_MAFC12
suffix:semicolon
r_else
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|GX00_XMISCCTRL_MFC_DIS
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|src
op_ne
id|MATROXFB_SRC_NONE
)paren
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
op_or_assign
id|M1064_XMISCCTRL_DAC_EN
suffix:semicolon
)brace
)brace
DECL|function|DAC1064_global_restore
r_void
id|DAC1064_global_restore
c_func
(paren
id|WPMINFO2
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XPIXCLKCTRL
)braket
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XMISCCTRL
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XMISCCTRL
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.accelerator
)paren
op_eq
id|FB_ACCEL_MATROX_MGAG400
)paren
(brace
id|outDAC1064
c_func
(paren
id|PMINFO
l_int|0x20
comma
l_int|0x04
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
l_int|0x1F
comma
id|ACCESS_FBINFO
c_func
(paren
id|devflags.dfp_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XSYNCCTRL
comma
l_int|0xCC
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XPWRCTRL
)braket
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPANMODE
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XPANMODE
)braket
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XOUTPUTCONN
comma
id|hw-&gt;DACreg
(braket
id|POS1064_XOUTPUTCONN
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|DAC1064_init_1
r_static
r_int
id|DAC1064_init_1
c_func
(paren
id|WPMINFO
r_struct
id|my_timming
op_star
id|m
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|memcpy
c_func
(paren
id|hw-&gt;DACreg
comma
id|MGA1064_DAC
comma
r_sizeof
(paren
id|MGA1064_DAC_regs
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.bits_per_pixel
)paren
(brace
multiline_comment|/* case 4: not supported by MGA1064 DAC */
r_case
l_int|8
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XMULCTRL
)braket
op_assign
id|M1064_XMULCTRL_DEPTH_8BPP
op_or
id|M1064_XMULCTRL_GRAPHICS_PALETIZED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.green.length
op_eq
l_int|5
)paren
id|hw-&gt;DACreg
(braket
id|POS1064_XMULCTRL
)braket
op_assign
id|M1064_XMULCTRL_DEPTH_15BPP_1BPP
op_or
id|M1064_XMULCTRL_GRAPHICS_PALETIZED
suffix:semicolon
r_else
id|hw-&gt;DACreg
(braket
id|POS1064_XMULCTRL
)braket
op_assign
id|M1064_XMULCTRL_DEPTH_16BPP
op_or
id|M1064_XMULCTRL_GRAPHICS_PALETIZED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XMULCTRL
)braket
op_assign
id|M1064_XMULCTRL_DEPTH_24BPP
op_or
id|M1064_XMULCTRL_GRAPHICS_PALETIZED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|hw-&gt;DACreg
(braket
id|POS1064_XMULCTRL
)braket
op_assign
id|M1064_XMULCTRL_DEPTH_32BPP
op_or
id|M1064_XMULCTRL_GRAPHICS_PALETIZED
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* unsupported depth */
)brace
id|hw-&gt;DACreg
(braket
id|POS1064_XVREFCTRL
)braket
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|features.DAC1064.xvrefctrl
)paren
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XGENCTRL
)braket
op_and_assign
op_complement
id|M1064_XGENCTRL_SYNC_ON_GREEN_MASK
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XGENCTRL
)braket
op_or_assign
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_ON_GREEN
)paren
ques
c_cond
id|M1064_XGENCTRL_SYNC_ON_GREEN
suffix:colon
id|M1064_XGENCTRL_NO_SYNC_ON_GREEN
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XCURADDL
)braket
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;DACreg
(braket
id|POS1064_XCURADDH
)braket
op_assign
l_int|0
suffix:semicolon
id|DAC1064_global_init
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DAC1064_init_2
r_static
r_int
id|DAC1064_init_2
c_func
(paren
id|WPMINFO
r_struct
id|my_timming
op_star
id|m
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.bits_per_pixel
OG
l_int|16
)paren
(brace
multiline_comment|/* 256 entries */
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|0
)braket
op_assign
id|i
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|1
)braket
op_assign
id|i
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
id|i
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.bits_per_pixel
OG
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|fbcon
)paren
dot
id|var.green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* 0..31, 128..159 */
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* with p15 == 0 */
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|0
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|1
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
multiline_comment|/* with p15 == 1 */
id|hw-&gt;DACpal
(braket
(paren
id|i
op_plus
l_int|128
)paren
op_star
l_int|3
op_plus
l_int|0
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
id|hw-&gt;DACpal
(braket
(paren
id|i
op_plus
l_int|128
)paren
op_star
l_int|3
op_plus
l_int|1
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
id|hw-&gt;DACpal
(braket
(paren
id|i
op_plus
l_int|128
)paren
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* 0..63 */
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|0
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|1
)braket
op_assign
id|i
op_lshift
l_int|2
suffix:semicolon
id|hw-&gt;DACpal
(braket
id|i
op_star
l_int|3
op_plus
l_int|2
)braket
op_assign
id|i
op_lshift
l_int|3
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|memset
c_func
(paren
id|hw-&gt;DACpal
comma
l_int|0
comma
l_int|768
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DAC1064_restore_1
r_static
r_void
id|DAC1064_restore_1
c_func
(paren
id|WPMINFO2
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
r_if
c_cond
(paren
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
)paren
op_ne
id|hw-&gt;DACclk
(braket
l_int|3
)braket
)paren
op_logical_or
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
)paren
op_ne
id|hw-&gt;DACclk
(braket
l_int|4
)braket
)paren
op_logical_or
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
)paren
op_ne
id|hw-&gt;DACclk
(braket
l_int|5
)braket
)paren
)paren
(brace
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
comma
id|hw-&gt;DACclk
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
comma
id|hw-&gt;DACclk
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
comma
id|hw-&gt;DACclk
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|MGA1064_DAC_regs
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_ne
id|POS1064_XPIXCLKCTRL
)paren
op_logical_and
(paren
id|i
op_ne
id|POS1064_XMISCCTRL
)paren
)paren
id|outDAC1064
c_func
(paren
id|PMINFO
id|MGA1064_DAC_regs
(braket
id|i
)braket
comma
id|hw-&gt;DACreg
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|DAC1064_global_restore
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
id|CRITEND
)brace
suffix:semicolon
DECL|function|DAC1064_restore_2
r_static
r_void
id|DAC1064_restore_2
c_func
(paren
id|WPMINFO2
)paren
(brace
macro_line|#ifdef DEBUG
r_int
r_int
id|i
suffix:semicolon
macro_line|#endif
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
macro_line|#ifdef DEBUG
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DAC1064regs &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|MGA1064_DAC_regs
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;R%02X=%02X &quot;
comma
id|MGA1064_DAC_regs
(braket
id|i
)braket
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACreg
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0x7
)paren
op_eq
l_int|0x7
)paren
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;continuing... &quot;
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;DAC1064clk &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;C%02X=%02X &quot;
comma
id|i
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACclk
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|m1064_compute
r_static
r_int
id|m1064_compute
c_func
(paren
r_void
op_star
id|out
comma
r_struct
id|my_timming
op_star
id|m
)paren
(brace
DECL|macro|minfo
mdefine_line|#define minfo ((struct matrox_fb_info*)out)
(brace
r_int
id|i
suffix:semicolon
r_int
id|tmout
suffix:semicolon
id|CRITFLAGS
id|DAC1064_setpclk
c_func
(paren
id|PMINFO
id|m-&gt;pixclock
)paren
suffix:semicolon
id|CRITBEGIN
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCM
op_plus
id|i
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|DACclk
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmout
op_assign
l_int|500000
suffix:semicolon
id|tmout
suffix:semicolon
id|tmout
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLSTAT
)paren
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
suffix:semicolon
id|CRITEND
r_if
c_cond
(paren
op_logical_neg
id|tmout
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;matroxfb: Pixel PLL not locked after 5 secs&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|macro|minfo
macro_line|#undef minfo
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|m1064
r_static
r_struct
id|matrox_altout
id|m1064
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Primary output&quot;
comma
dot
id|compute
op_assign
id|m1064_compute
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|function|g450_compute
r_static
r_int
id|g450_compute
c_func
(paren
r_void
op_star
id|out
comma
r_struct
id|my_timming
op_star
id|m
)paren
(brace
DECL|macro|minfo
mdefine_line|#define minfo ((struct matrox_fb_info*)out)
r_if
c_cond
(paren
id|m-&gt;mnp
OL
l_int|0
)paren
(brace
id|m-&gt;mnp
op_assign
id|matroxfb_g450_setclk
c_func
(paren
id|PMINFO
id|m-&gt;pixclock
comma
(paren
id|m-&gt;crtc
op_eq
id|MATROXFB_SRC_CRTC1
)paren
ques
c_cond
id|M_PIXEL_PLL_C
suffix:colon
id|M_VIDEO_PLL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;mnp
op_ge
l_int|0
)paren
(brace
id|m-&gt;pixclock
op_assign
id|g450_mnp2f
c_func
(paren
id|PMINFO
id|m-&gt;mnp
)paren
suffix:semicolon
)brace
)brace
DECL|macro|minfo
macro_line|#undef minfo
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|g450out
r_static
r_struct
id|matrox_altout
id|g450out
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Primary output&quot;
comma
dot
id|compute
op_assign
id|g450_compute
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#endif /* NEED_DAC1064 */
macro_line|#ifdef CONFIG_FB_MATROX_MYSTIQUE
DECL|function|MGA1064_init
r_static
r_int
id|MGA1064_init
c_func
(paren
id|WPMINFO
r_struct
id|my_timming
op_star
id|m
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
r_if
c_cond
(paren
id|DAC1064_init_1
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|matroxfb_vgaHWinit
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hw-&gt;MiscOutReg
op_assign
l_int|0xCB
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|hw-&gt;MiscOutReg
op_and_assign
op_complement
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|hw-&gt;MiscOutReg
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
)paren
multiline_comment|/* should be only FB_SYNC_COMP */
id|hw-&gt;CRTCEXT
(braket
l_int|3
)braket
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|DAC1064_init_2
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|function|MGAG100_init
r_static
r_int
id|MGAG100_init
c_func
(paren
id|WPMINFO
r_struct
id|my_timming
op_star
id|m
)paren
(brace
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
r_if
c_cond
(paren
id|DAC1064_init_1
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x2000
suffix:semicolon
r_if
c_cond
(paren
id|matroxfb_vgaHWinit
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hw-&gt;MiscOutReg
op_assign
l_int|0xEF
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|hw-&gt;MiscOutReg
op_and_assign
op_complement
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|hw-&gt;MiscOutReg
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;sync
op_amp
id|FB_SYNC_COMP_HIGH_ACT
)paren
multiline_comment|/* should be only FB_SYNC_COMP */
id|hw-&gt;CRTCEXT
(braket
l_int|3
)braket
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|DAC1064_init_2
c_func
(paren
id|PMINFO
id|m
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;/* G */
macro_line|#ifdef CONFIG_FB_MATROX_MYSTIQUE
DECL|function|MGA1064_ramdac_init
r_static
r_void
id|MGA1064_ramdac_init
c_func
(paren
id|WPMINFO2
)paren
(brace
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
multiline_comment|/* ACCESS_FBINFO(features.DAC1064.vco_freq_min) = 120000; */
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.vco_freq_min
)paren
op_assign
l_int|62000
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.ref_freq
)paren
op_assign
l_int|14318
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.feed_div_min
)paren
op_assign
l_int|100
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.feed_div_max
)paren
op_assign
l_int|127
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.in_div_min
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.in_div_max
)paren
op_assign
l_int|31
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.post_shift_max
)paren
op_assign
l_int|3
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.DAC1064.xvrefctrl
)paren
op_assign
id|DAC1064_XVREFCTRL_EXTERNAL
suffix:semicolon
multiline_comment|/* maybe cmdline MCLK= ?, doc says gclk=44MHz, mclk=66MHz... it was 55/83 with old values */
id|DAC1064_setmclk
c_func
(paren
id|PMINFO
id|DAC1064_OPT_MDIV2
op_or
id|DAC1064_OPT_GDIV3
op_or
id|DAC1064_OPT_SCLK_PLL
comma
l_int|133333
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_G
multiline_comment|/* BIOS environ */
DECL|variable|x7AF4
r_static
r_int
id|x7AF4
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* flags, maybe 0x10 = SDRAM, 0x00 = SGRAM??? */
multiline_comment|/* G100 wants 0x10, G200 SGRAM does not care... */
macro_line|#if 0
r_static
r_int
id|def50
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reg50, &amp; 0x0F, &amp; 0x3000 (only 0x0000, 0x1000, 0x2000 (0x3000 disallowed and treated as 0) */
macro_line|#endif
DECL|function|MGAG100_progPixClock
r_static
r_void
id|MGAG100_progPixClock
c_func
(paren
id|CPMINFO
r_int
id|flags
comma
r_int
id|m
comma
r_int
id|n
comma
r_int
id|p
)paren
(brace
r_int
id|reg
suffix:semicolon
r_int
id|selClk
suffix:semicolon
r_int
id|clk
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
)paren
op_or
id|M1064_XPIXCLKCTRL_DIS
op_or
id|M1064_XPIXCLKCTRL_PLL_UP
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|reg
op_assign
id|M1064_XPIXPLLAM
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|reg
op_assign
id|M1064_XPIXPLLBM
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|reg
op_assign
id|M1064_XPIXPLLCM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outDAC1064
c_func
(paren
id|PMINFO
id|reg
op_increment
comma
id|m
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|reg
op_increment
comma
id|n
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|reg
comma
id|p
)paren
suffix:semicolon
id|selClk
op_assign
id|mga_inb
c_func
(paren
id|M_MISC_REG_READ
)paren
op_amp
op_complement
l_int|0xC
suffix:semicolon
multiline_comment|/* there should be flags &amp; 0x03 &amp; case 0/1/else */
multiline_comment|/* and we should first select source and after that we should wait for PLL */
multiline_comment|/* and we are waiting for PLL with oscilator disabled... Is it right? */
r_switch
c_cond
(paren
id|flags
op_amp
l_int|0x03
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|selClk
op_or_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|selClk
op_or_assign
l_int|0x0C
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mga_outb
c_func
(paren
id|M_MISC_REG
comma
id|selClk
)paren
suffix:semicolon
r_for
c_loop
(paren
id|clk
op_assign
l_int|500000
suffix:semicolon
id|clk
suffix:semicolon
id|clk
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLSTAT
)paren
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clk
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;matroxfb: Pixel PLL%c not locked after usual time&bslash;n&quot;
comma
(paren
id|reg
op_minus
id|M1064_XPIXPLLAM
op_minus
l_int|2
)paren
op_div
l_int|4
op_plus
l_char|&squot;A&squot;
)paren
suffix:semicolon
id|selClk
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
)paren
op_amp
op_complement
id|M1064_XPIXCLKCTRL_SRC_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
l_int|0x0C
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|selClk
op_or_assign
id|M1064_XPIXCLKCTRL_SRC_PCI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|selClk
op_or_assign
id|M1064_XPIXCLKCTRL_SRC_PLL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|selClk
op_or_assign
id|M1064_XPIXCLKCTRL_SRC_EXT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|selClk
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
)paren
op_amp
op_complement
id|M1064_XPIXCLKCTRL_DIS
)paren
suffix:semicolon
)brace
DECL|function|MGAG100_setPixClock
r_static
r_void
id|MGAG100_setPixClock
c_func
(paren
id|CPMINFO
r_int
id|flags
comma
r_int
id|freq
)paren
(brace
r_int
r_int
id|m
comma
id|n
comma
id|p
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|DAC1064_calcclock
c_func
(paren
id|PMINFO
id|freq
comma
id|ACCESS_FBINFO
c_func
(paren
id|max_pixel_clock
)paren
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|MGAG100_progPixClock
c_func
(paren
id|PMINFO
id|flags
comma
id|m
comma
id|n
comma
id|p
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_MYSTIQUE
DECL|function|MGA1064_preinit
r_static
r_int
id|MGA1064_preinit
c_func
(paren
id|WPMINFO2
)paren
(brace
r_static
r_const
r_int
id|vxres_mystique
(braket
)braket
op_assign
(brace
l_int|512
comma
l_int|640
comma
l_int|768
comma
l_int|800
comma
l_int|832
comma
l_int|960
comma
l_int|1024
comma
l_int|1152
comma
l_int|1280
comma
l_int|1600
comma
l_int|1664
comma
l_int|1920
comma
l_int|2048
comma
l_int|0
)brace
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
multiline_comment|/* ACCESS_FBINFO(capable.cfb4) = 0; ... preinitialized by 0 */
id|ACCESS_FBINFO
c_func
(paren
id|capable.text
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|capable.vxres
)paren
op_assign
id|vxres_mystique
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.accel.has_cacheflush
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|output
op_assign
op_amp
id|m1064
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|src
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|default_src
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|data
op_assign
id|MINFO
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|mode
op_assign
id|MATROXFB_OUTPUT_MODE_MONITOR
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.noinit
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* do not modify settings */
id|hw-&gt;MXoptionReg
op_and_assign
l_int|0xC0000100
suffix:semicolon
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x00094E20
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.novga
)paren
)paren
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x00000100
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nobios
)paren
)paren
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x40000000
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nopciretry
)paren
)paren
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x20000000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|0x01
comma
l_int|0x20
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
l_int|0x00000000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x00008000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x0000C000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|MGA1064_reset
r_static
r_void
id|MGA1064_reset
c_func
(paren
id|WPMINFO2
)paren
(brace
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
suffix:semicolon
id|MGA1064_ramdac_init
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|function|g450_mclk_init
r_static
r_void
id|g450_mclk_init
c_func
(paren
id|WPMINFO2
)paren
(brace
multiline_comment|/* switch all clocks to PCI source */
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or
l_int|4
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION3_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt3
op_amp
op_complement
l_int|0x00300C03
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt3
op_amp
l_int|0x000003
)paren
op_eq
l_int|0x000003
)paren
op_logical_or
(paren
(paren
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt3
op_amp
l_int|0x000C00
)paren
op_eq
l_int|0x000C00
)paren
op_logical_or
(paren
(paren
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt3
op_amp
l_int|0x300000
)paren
op_eq
l_int|0x300000
)paren
)paren
(brace
id|matroxfb_g450_setclk
c_func
(paren
id|PMINFO
id|ACCESS_FBINFO
c_func
(paren
id|values.pll.video
)paren
comma
id|M_VIDEO_PLL
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|pwr
suffix:semicolon
id|matroxfb_DAC_lock_irqsave
c_func
(paren
id|flags
)paren
suffix:semicolon
id|pwr
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
)paren
op_amp
op_complement
l_int|0x02
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
comma
id|pwr
)paren
suffix:semicolon
id|matroxfb_DAC_unlock_irqrestore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|matroxfb_g450_setclk
c_func
(paren
id|PMINFO
id|ACCESS_FBINFO
c_func
(paren
id|values.pll.system
)paren
comma
id|M_SYSTEM_PLL
)paren
suffix:semicolon
multiline_comment|/* switch clocks to their real PLL source(s) */
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or
l_int|4
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION3_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt3
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
)brace
DECL|function|g450_memory_init
r_static
r_void
id|g450_memory_init
c_func
(paren
id|WPMINFO2
)paren
(brace
multiline_comment|/* disable memory refresh */
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_and_assign
op_complement
l_int|0x001F8000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
multiline_comment|/* set memory interface parameters */
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_and_assign
op_complement
l_int|0x00207E00
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or_assign
l_int|0x00207E00
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt2
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst
)paren
suffix:semicolon
multiline_comment|/* first set up memory interface with disabled memory interface clocks */
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_MEMMISC_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memmisc
op_amp
op_complement
l_int|0x80000000U
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.maccess
)paren
suffix:semicolon
multiline_comment|/* start memory clocks */
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_MEMMISC_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memmisc
op_or
l_int|0x80000000U
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|memory.ddr
op_logical_and
(paren
op_logical_neg
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|memory.emrswen
op_logical_or
op_logical_neg
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|memory.dll
)paren
)paren
(brace
id|mga_outl
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
op_amp
op_complement
l_int|0x1000
)paren
suffix:semicolon
)brace
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.maccess
op_or
l_int|0x8000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or_assign
l_int|0x001F8000
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
multiline_comment|/* value is written to memory chips only if old != new */
id|mga_outl
c_func
(paren
id|M_PLNWT
comma
l_int|0
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_PLNWT
comma
op_complement
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst
op_ne
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst_core
)paren
(brace
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst_core
)paren
suffix:semicolon
)brace
)brace
DECL|function|g450_preinit
r_static
r_void
id|g450_preinit
c_func
(paren
id|WPMINFO2
)paren
(brace
id|u_int32_t
id|c2ctl
suffix:semicolon
id|u_int8_t
id|curctl
suffix:semicolon
id|u_int8_t
id|c1ctl
suffix:semicolon
multiline_comment|/* ACCESS_FBINFO(hw).MXoptionReg = minfo-&gt;values.reg.opt; */
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_and_assign
l_int|0xC0000100
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or_assign
l_int|0x00000020
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.novga
)paren
)paren
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_and_assign
op_complement
l_int|0x00000100
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nobios
)paren
)paren
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_and_assign
op_complement
l_int|0x40000000
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nopciretry
)paren
)paren
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or_assign
l_int|0x20000000
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
op_or_assign
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt
op_amp
l_int|0x03400040
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
dot
id|MXoptionReg
)paren
suffix:semicolon
multiline_comment|/* Init system clocks */
multiline_comment|/* stop crtc2 */
id|c2ctl
op_assign
id|mga_inl
c_func
(paren
id|M_C2CTL
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_C2CTL
comma
id|c2ctl
op_amp
op_complement
l_int|1
)paren
suffix:semicolon
multiline_comment|/* stop cursor */
id|curctl
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XCURCTRL
)paren
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XCURCTRL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* stop crtc1 */
id|c1ctl
op_assign
id|mga_readr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|1
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|1
comma
id|c1ctl
op_or
l_int|0x20
)paren
suffix:semicolon
id|g450_mclk_init
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
id|g450_memory_init
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
multiline_comment|/* set legacy VGA clock sources for DOSEmu or VMware... */
id|matroxfb_g450_setclk
c_func
(paren
id|PMINFO
l_int|25175
comma
id|M_PIXEL_PLL_A
)paren
suffix:semicolon
id|matroxfb_g450_setclk
c_func
(paren
id|PMINFO
l_int|28322
comma
id|M_PIXEL_PLL_B
)paren
suffix:semicolon
multiline_comment|/* restore crtc1 */
id|mga_setr
c_func
(paren
id|M_SEQ_INDEX
comma
l_int|1
comma
id|c1ctl
)paren
suffix:semicolon
multiline_comment|/* restore cursor */
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XCURCTRL
comma
id|curctl
)paren
suffix:semicolon
multiline_comment|/* restore crtc2 */
id|mga_outl
c_func
(paren
id|M_C2CTL
comma
id|c2ctl
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|MGAG100_preinit
r_static
r_int
id|MGAG100_preinit
c_func
(paren
id|WPMINFO2
)paren
(brace
r_static
r_const
r_int
id|vxres_g100
(braket
)braket
op_assign
(brace
l_int|512
comma
l_int|640
comma
l_int|768
comma
l_int|800
comma
l_int|832
comma
l_int|960
comma
l_int|1024
comma
l_int|1152
comma
l_int|1280
comma
l_int|1600
comma
l_int|1664
comma
l_int|1920
comma
l_int|2048
comma
l_int|0
)brace
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|u_int32_t
id|reg50
suffix:semicolon
macro_line|#if 0
id|u_int32_t
id|q
suffix:semicolon
macro_line|#endif
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
multiline_comment|/* there are some instabilities if in_div &gt; 19 &amp;&amp; vco &lt; 61000 */
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.vco_freq_min
)paren
op_assign
l_int|130000
suffix:semicolon
multiline_comment|/* my sample: &gt;118 */
)brace
r_else
(brace
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.vco_freq_min
)paren
op_assign
l_int|62000
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.ref_freq
)paren
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.ref_freq
)paren
op_assign
l_int|27000
suffix:semicolon
)brace
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.feed_div_min
)paren
op_assign
l_int|7
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.feed_div_max
)paren
op_assign
l_int|127
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.in_div_min
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.in_div_max
)paren
op_assign
l_int|31
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.pll.post_shift_max
)paren
op_assign
l_int|3
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.DAC1064.xvrefctrl
)paren
op_assign
id|DAC1064_XVREFCTRL_G100_DEFAULT
suffix:semicolon
multiline_comment|/* ACCESS_FBINFO(capable.cfb4) = 0; ... preinitialized by 0 */
id|ACCESS_FBINFO
c_func
(paren
id|capable.text
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|capable.vxres
)paren
op_assign
id|vxres_g100
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|features.accel.has_cacheflush
)paren
op_assign
l_int|1
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|capable.plnwt
)paren
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|devflags.accelerator
)paren
op_eq
id|FB_ACCEL_MATROX_MGAG100
ques
c_cond
id|ACCESS_FBINFO
c_func
(paren
id|devflags.sgram
)paren
suffix:colon
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_FB_MATROX_G
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|output
op_assign
op_amp
id|g450out
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|output
op_assign
op_amp
id|m1064
suffix:semicolon
)brace
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|src
op_assign
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|default_src
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|data
op_assign
id|MINFO
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|outputs
(braket
l_int|0
)braket
)paren
dot
id|mode
op_assign
id|MATROXFB_OUTPUT_MODE_MONITOR
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
multiline_comment|/* we must do this always, BIOS does not do it for us&n;&t;&t;   and accelerator dies without it */
id|mga_outl
c_func
(paren
l_int|0x1C0C
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.noinit
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
id|g450_preinit
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|hw-&gt;MXoptionReg
op_and_assign
l_int|0xC0000100
suffix:semicolon
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x00000020
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.novga
)paren
)paren
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x00000100
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nobios
)paren
)paren
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x40000000
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.nopciretry
)paren
)paren
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x20000000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
id|DAC1064_setmclk
c_func
(paren
id|PMINFO
id|DAC1064_OPT_MDIV2
op_or
id|DAC1064_OPT_GDIV3
op_or
id|DAC1064_OPT_SCLK_PCI
comma
l_int|133333
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.accelerator
)paren
op_eq
id|FB_ACCEL_MATROX_MGAG100
)paren
(brace
id|pci_read_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
op_amp
id|reg50
)paren
suffix:semicolon
id|reg50
op_and_assign
op_complement
l_int|0x3000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
id|reg50
)paren
suffix:semicolon
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x1080
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
l_int|0x1C05
comma
l_int|0x00
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
l_int|0x1C05
comma
l_int|0x80
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
l_int|0x1C05
comma
l_int|0x40
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
l_int|0x1C05
comma
l_int|0xC0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|reg50
op_and_assign
op_complement
l_int|0xFF
suffix:semicolon
id|reg50
op_or_assign
l_int|0x07
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
id|reg50
)paren
suffix:semicolon
multiline_comment|/* it should help with G100 */
id|mga_outb
c_func
(paren
id|M_GRAPHICS_INDEX
comma
l_int|6
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_GRAPHICS_DATA
comma
(paren
id|mga_inb
c_func
(paren
id|M_GRAPHICS_DATA
)paren
op_amp
l_int|3
)paren
op_or
l_int|4
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
l_int|0x03
comma
l_int|0x81
)paren
suffix:semicolon
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
l_int|0x04
comma
l_int|0x00
)paren
suffix:semicolon
id|mga_writeb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
l_int|0x0000
comma
l_int|0xAA
)paren
suffix:semicolon
id|mga_writeb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
l_int|0x0800
comma
l_int|0x55
)paren
suffix:semicolon
id|mga_writeb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
l_int|0x4000
comma
l_int|0x55
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|mga_readb
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|video.vbase
)paren
comma
l_int|0x0000
)paren
op_ne
l_int|0xAA
)paren
(brace
id|hw-&gt;MXoptionReg
op_and_assign
op_complement
l_int|0x1000
suffix:semicolon
)brace
macro_line|#endif
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x00078020
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.accelerator
)paren
op_eq
id|FB_ACCEL_MATROX_MGAG200
)paren
(brace
id|pci_read_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
op_amp
id|reg50
)paren
suffix:semicolon
id|reg50
op_and_assign
op_complement
l_int|0x3000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
id|reg50
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.memtype
)paren
op_eq
op_minus
l_int|1
)paren
id|hw-&gt;MXoptionReg
op_or_assign
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt
op_amp
l_int|0x1C00
suffix:semicolon
r_else
id|hw-&gt;MXoptionReg
op_or_assign
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.memtype
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.sgram
)paren
)paren
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x4000
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x00000000
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x00008000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|mga_outw
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
)paren
suffix:semicolon
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x00078020
suffix:semicolon
)brace
r_else
(brace
id|pci_read_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
op_amp
id|reg50
)paren
suffix:semicolon
id|reg50
op_and_assign
op_complement
l_int|0x00000100
suffix:semicolon
id|reg50
op_or_assign
l_int|0x00000000
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION2_REG
comma
id|reg50
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.memtype
)paren
op_eq
op_minus
l_int|1
)paren
id|hw-&gt;MXoptionReg
op_or_assign
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.opt
op_amp
l_int|0x1C00
suffix:semicolon
r_else
id|hw-&gt;MXoptionReg
op_or_assign
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.memtype
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.sgram
)paren
)paren
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x4000
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_CTLWTST
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.mctlwtst
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x00000000
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MACCESS
comma
l_int|0x00008000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|mga_outl
c_func
(paren
id|M_MEMRDBK
comma
id|ACCESS_FBINFO
c_func
(paren
id|values
)paren
dot
id|reg.memrdbk
)paren
suffix:semicolon
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x00040020
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|MGAG100_reset
r_static
r_void
id|MGAG100_reset
c_func
(paren
id|WPMINFO2
)paren
(brace
id|u_int8_t
id|b
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
(brace
macro_line|#ifdef G100_BROKEN_IBM_82351
id|u_int32_t
id|d
suffix:semicolon
id|find
l_int|1014
op_div
l_int|22
(paren
id|IBM
op_div
l_int|82351
)paren
suffix:semicolon
multiline_comment|/* if found and bridging Matrox, do some strange stuff */
id|pci_read_config_byte
c_func
(paren
id|ibm
comma
id|PCI_SECONDARY_BUS
comma
op_amp
id|b
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
op_eq
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
op_member_access_from_pointer
id|bus-&gt;number
)paren
(brace
id|pci_write_config_byte
c_func
(paren
id|ibm
comma
id|PCI_COMMAND
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable back-to-back &amp; SERR */
id|pci_write_config_byte
c_func
(paren
id|ibm
comma
l_int|0x41
comma
l_int|0xF4
)paren
suffix:semicolon
multiline_comment|/* ??? */
id|pci_write_config_byte
c_func
(paren
id|ibm
comma
id|PCI_IO_BASE
comma
l_int|0xF0
)paren
suffix:semicolon
multiline_comment|/* ??? */
id|pci_write_config_byte
c_func
(paren
id|ibm
comma
id|PCI_IO_LIMIT
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* ??? */
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|ACCESS_FBINFO
c_func
(paren
id|devflags.noinit
)paren
)paren
(brace
r_if
c_cond
(paren
id|x7AF4
op_amp
l_int|8
)paren
(brace
id|hw-&gt;MXoptionReg
op_or_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* FIXME... */
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
)brace
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
l_int|0x06
comma
l_int|0x50
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
multiline_comment|/* either leave MCLK as is... or they were set in preinit */
id|hw-&gt;DACclk
(braket
l_int|3
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
)paren
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|4
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
)paren
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|5
)braket
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC1064_setmclk
c_func
(paren
id|PMINFO
id|DAC1064_OPT_RESERVED
op_or
id|DAC1064_OPT_MDIV2
op_or
id|DAC1064_OPT_GDIV1
op_or
id|DAC1064_OPT_SCLK_PLL
comma
l_int|133333
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.accelerator
)paren
op_eq
id|FB_ACCEL_MATROX_MGAG400
)paren
(brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.dfp_type
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|ACCESS_FBINFO
c_func
(paren
id|devflags.dfp_type
)paren
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
l_int|0x1F
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.noinit
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.g450dac
)paren
)paren
(brace
)brace
r_else
(brace
id|MGAG100_setPixClock
c_func
(paren
id|PMINFO
l_int|4
comma
l_int|25175
)paren
suffix:semicolon
id|MGAG100_setPixClock
c_func
(paren
id|PMINFO
l_int|5
comma
l_int|28322
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x7AF4
op_amp
l_int|0x10
)paren
(brace
id|b
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XGENIODATA
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XGENIODATA
comma
id|b
)paren
suffix:semicolon
id|b
op_assign
id|inDAC1064
c_func
(paren
id|PMINFO
id|M1064_XGENIOCTRL
)paren
op_or
l_int|1
suffix:semicolon
id|outDAC1064
c_func
(paren
id|PMINFO
id|M1064_XGENIOCTRL
comma
id|b
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_MYSTIQUE
DECL|function|MGA1064_restore
r_static
r_void
id|MGA1064_restore
c_func
(paren
id|WPMINFO2
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_IEN
comma
l_int|0x00
)paren
suffix:semicolon
id|mga_outb
c_func
(paren
id|M_CACHEFLUSH
comma
l_int|0x00
)paren
suffix:semicolon
id|CRITEND
id|DAC1064_restore_1
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
id|matroxfb_vgaHWrestore
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
id|ACCESS_FBINFO
c_func
(paren
id|crtc1.panpos
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
id|i
comma
id|hw-&gt;CRTCEXT
(braket
id|i
)braket
)paren
suffix:semicolon
id|DAC1064_restore_2
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|function|MGAG100_restore
r_static
r_void
id|MGAG100_restore
c_func
(paren
id|WPMINFO2
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|matrox_hw_state
op_star
id|hw
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
suffix:semicolon
id|CRITFLAGS
id|DBG
c_func
(paren
id|__FUNCTION__
)paren
id|CRITBEGIN
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|hw-&gt;MXoptionReg
)paren
suffix:semicolon
id|CRITEND
id|DAC1064_restore_1
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
id|matroxfb_vgaHWrestore
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FB_MATROX_32MB
r_if
c_cond
(paren
id|ACCESS_FBINFO
c_func
(paren
id|devflags.support32MB
)paren
)paren
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
l_int|8
comma
id|hw-&gt;CRTCEXT
(braket
l_int|8
)braket
)paren
suffix:semicolon
macro_line|#endif
id|ACCESS_FBINFO
c_func
(paren
id|crtc1.panpos
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|mga_setr
c_func
(paren
id|M_EXTVGA_INDEX
comma
id|i
comma
id|hw-&gt;CRTCEXT
(braket
id|i
)braket
)paren
suffix:semicolon
id|DAC1064_restore_2
c_func
(paren
id|PMINFO2
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_MYSTIQUE
DECL|variable|matrox_mystique
r_struct
id|matrox_switch
id|matrox_mystique
op_assign
(brace
id|MGA1064_preinit
comma
id|MGA1064_reset
comma
id|MGA1064_init
comma
id|MGA1064_restore
comma
)brace
suffix:semicolon
DECL|variable|matrox_mystique
id|EXPORT_SYMBOL
c_func
(paren
id|matrox_mystique
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FB_MATROX_G
DECL|variable|matrox_G100
r_struct
id|matrox_switch
id|matrox_G100
op_assign
(brace
id|MGAG100_preinit
comma
id|MGAG100_reset
comma
id|MGAG100_init
comma
id|MGAG100_restore
comma
)brace
suffix:semicolon
DECL|variable|matrox_G100
id|EXPORT_SYMBOL
c_func
(paren
id|matrox_G100
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef NEED_DAC1064
DECL|variable|DAC1064_global_init
id|EXPORT_SYMBOL
c_func
(paren
id|DAC1064_global_init
)paren
suffix:semicolon
DECL|variable|DAC1064_global_restore
id|EXPORT_SYMBOL
c_func
(paren
id|DAC1064_global_restore
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
