multiline_comment|/*&n; *&n; * Hardware accelerated Matrox PCI cards - G450/G550 PLL control.&n; *&n; * (c) 2001 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&n; *&n; * Portions Copyright (c) 2001 Matrox Graphics Inc.&n; *&n; * Version: 1.62 2001/11/29&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License. See the file COPYING in the main directory of this archive for&n; * more details.&n; *&n; */
macro_line|#include &quot;g450_pll.h&quot;
macro_line|#include &quot;matroxfb_DAC1064.h&quot;
DECL|function|g450_vco2f
r_static
r_inline
r_int
r_int
id|g450_vco2f
c_func
(paren
r_int
r_char
id|p
comma
r_int
r_int
id|fvco
)paren
(brace
r_return
(paren
id|p
op_amp
l_int|0x40
)paren
ques
c_cond
id|fvco
suffix:colon
id|fvco
op_rshift
(paren
(paren
id|p
op_amp
l_int|3
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|g450_f2vco
r_static
r_inline
r_int
r_int
id|g450_f2vco
c_func
(paren
r_int
r_char
id|p
comma
r_int
r_int
id|fin
)paren
(brace
r_return
(paren
id|p
op_amp
l_int|0x40
)paren
ques
c_cond
id|fin
suffix:colon
id|fin
op_lshift
(paren
(paren
id|p
op_amp
l_int|3
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|g450_mnp2vco
r_static
r_int
r_int
id|g450_mnp2vco
c_func
(paren
id|CPMINFO
r_int
r_int
id|mnp
)paren
(brace
r_int
r_int
id|m
comma
id|n
suffix:semicolon
id|m
op_assign
(paren
(paren
id|mnp
op_rshift
l_int|16
)paren
op_amp
l_int|0x0FF
)paren
op_plus
l_int|1
suffix:semicolon
id|n
op_assign
(paren
(paren
id|mnp
op_rshift
l_int|7
)paren
op_amp
l_int|0x1FE
)paren
op_plus
l_int|4
suffix:semicolon
r_return
(paren
id|ACCESS_FBINFO
c_func
(paren
id|features
)paren
dot
id|pll.ref_freq
op_star
id|n
op_plus
(paren
id|m
op_rshift
l_int|1
)paren
)paren
op_div
id|m
suffix:semicolon
)brace
DECL|function|pll_freq_delta
r_static
r_inline
r_int
r_int
id|pll_freq_delta
c_func
(paren
r_int
r_int
id|f1
comma
r_int
r_int
id|f2
)paren
(brace
r_if
c_cond
(paren
id|f2
OL
id|f1
)paren
(brace
id|f2
op_assign
id|f1
op_minus
id|f2
suffix:semicolon
)brace
r_else
(brace
id|f2
op_assign
id|f2
op_minus
id|f1
suffix:semicolon
)brace
r_return
id|f2
suffix:semicolon
)brace
DECL|macro|NO_MORE_MNP
mdefine_line|#define NO_MORE_MNP&t;0x01FFFFFF
DECL|macro|G450_MNP_FREQBITS
mdefine_line|#define G450_MNP_FREQBITS&t;(0xFFFFFF43)&t;/* do not mask high byte so we&squot;ll catch NO_MORE_MNP */
DECL|function|g450_nextpll
r_static
r_int
r_int
id|g450_nextpll
c_func
(paren
id|CPMINFO
r_const
r_struct
id|matrox_pll_limits
op_star
id|pi
comma
r_int
r_int
op_star
id|fvco
comma
r_int
r_int
id|mnp
)paren
(brace
r_int
r_int
id|m
comma
id|n
comma
id|p
suffix:semicolon
r_int
r_int
id|tvco
op_assign
op_star
id|fvco
suffix:semicolon
id|m
op_assign
(paren
id|mnp
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|p
op_assign
id|mnp
op_amp
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
id|m
op_eq
l_int|0
op_logical_or
id|m
op_eq
l_int|0xFF
)paren
(brace
r_if
c_cond
(paren
id|m
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|p
op_amp
l_int|0x40
)paren
(brace
r_return
id|NO_MORE_MNP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_amp
l_int|3
)paren
(brace
id|p
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
l_int|0x40
suffix:semicolon
)brace
id|tvco
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tvco
OL
id|pi-&gt;vcomin
)paren
(brace
r_return
id|NO_MORE_MNP
suffix:semicolon
)brace
op_star
id|fvco
op_assign
id|tvco
suffix:semicolon
)brace
id|p
op_and_assign
l_int|0x43
suffix:semicolon
r_if
c_cond
(paren
id|tvco
OL
l_int|550000
)paren
(brace
multiline_comment|/*&t;&t;&t;p |= 0x00; */
)brace
r_else
r_if
c_cond
(paren
id|tvco
OL
l_int|700000
)paren
(brace
id|p
op_or_assign
l_int|0x08
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tvco
OL
l_int|1000000
)paren
(brace
id|p
op_or_assign
l_int|0x10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tvco
OL
l_int|1150000
)paren
(brace
id|p
op_or_assign
l_int|0x18
suffix:semicolon
)brace
r_else
(brace
id|p
op_or_assign
l_int|0x20
suffix:semicolon
)brace
id|m
op_assign
l_int|9
suffix:semicolon
)brace
r_else
(brace
id|m
op_decrement
suffix:semicolon
)brace
id|n
op_assign
(paren
(paren
id|tvco
op_star
(paren
id|m
op_plus
l_int|1
)paren
op_plus
id|ACCESS_FBINFO
c_func
(paren
id|features
)paren
dot
id|pll.ref_freq
)paren
op_div
(paren
id|ACCESS_FBINFO
c_func
(paren
id|features
)paren
dot
id|pll.ref_freq
op_star
l_int|2
)paren
)paren
op_minus
l_int|2
suffix:semicolon
r_return
(paren
id|m
op_lshift
l_int|16
)paren
op_or
(paren
id|n
op_lshift
l_int|8
)paren
op_or
id|p
suffix:semicolon
)brace
DECL|function|g450_firstpll
r_static
r_int
r_int
id|g450_firstpll
c_func
(paren
id|CPMINFO
r_const
r_struct
id|matrox_pll_limits
op_star
id|pi
comma
r_int
r_int
op_star
id|vco
comma
r_int
r_int
id|fout
)paren
(brace
r_int
r_int
id|p
suffix:semicolon
r_int
r_int
id|vcomax
suffix:semicolon
id|vcomax
op_assign
id|pi-&gt;vcomax
suffix:semicolon
r_if
c_cond
(paren
id|fout
OG
(paren
id|vcomax
op_div
l_int|2
)paren
)paren
(brace
r_if
c_cond
(paren
id|fout
OG
id|vcomax
)paren
(brace
op_star
id|vco
op_assign
id|vcomax
suffix:semicolon
)brace
r_else
(brace
op_star
id|vco
op_assign
id|fout
suffix:semicolon
)brace
id|p
op_assign
l_int|0x40
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|tvco
suffix:semicolon
id|p
op_assign
l_int|3
suffix:semicolon
id|tvco
op_assign
id|g450_f2vco
c_func
(paren
id|p
comma
id|fout
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
op_logical_and
(paren
id|tvco
OG
id|vcomax
)paren
)paren
(brace
id|p
op_decrement
suffix:semicolon
id|tvco
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tvco
OL
id|pi-&gt;vcomin
)paren
(brace
id|tvco
op_assign
id|pi-&gt;vcomin
suffix:semicolon
)brace
op_star
id|vco
op_assign
id|tvco
suffix:semicolon
)brace
r_return
id|g450_nextpll
c_func
(paren
id|PMINFO
id|pi
comma
id|vco
comma
l_int|0xFF0000
op_or
id|p
)paren
suffix:semicolon
)brace
DECL|function|g450_setpll
r_static
r_inline
r_int
r_int
id|g450_setpll
c_func
(paren
id|CPMINFO
r_int
r_int
id|mnp
comma
r_int
r_int
id|pll
)paren
(brace
r_switch
c_cond
(paren
id|pll
)paren
(brace
r_case
id|M_PIXEL_PLL_A
suffix:colon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAM
comma
id|mnp
op_rshift
l_int|16
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAN
comma
id|mnp
op_rshift
l_int|8
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAP
comma
id|mnp
)paren
suffix:semicolon
r_return
id|M1064_XPIXPLLSTAT
suffix:semicolon
r_case
id|M_PIXEL_PLL_B
suffix:colon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBM
comma
id|mnp
op_rshift
l_int|16
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBN
comma
id|mnp
op_rshift
l_int|8
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBP
comma
id|mnp
)paren
suffix:semicolon
r_return
id|M1064_XPIXPLLSTAT
suffix:semicolon
r_case
id|M_PIXEL_PLL_C
suffix:colon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCM
comma
id|mnp
op_rshift
l_int|16
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCN
comma
id|mnp
op_rshift
l_int|8
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCP
comma
id|mnp
)paren
suffix:semicolon
r_return
id|M1064_XPIXPLLSTAT
suffix:semicolon
r_case
id|M_SYSTEM_PLL
suffix:colon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
comma
id|mnp
op_rshift
l_int|16
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
comma
id|mnp
op_rshift
l_int|8
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
comma
id|mnp
)paren
suffix:semicolon
r_return
id|DAC1064_XSYSPLLSTAT
suffix:semicolon
r_case
id|M_VIDEO_PLL
suffix:colon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLM
comma
id|mnp
op_rshift
l_int|16
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLN
comma
id|mnp
op_rshift
l_int|8
)paren
suffix:semicolon
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLP
comma
id|mnp
)paren
suffix:semicolon
r_return
id|M1064_XVIDPLLSTAT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|g450_cmppll
r_static
r_inline
r_int
r_int
id|g450_cmppll
c_func
(paren
id|CPMINFO
r_int
r_int
id|mnp
comma
r_int
r_int
id|pll
)paren
(brace
r_int
r_char
id|m
op_assign
id|mnp
op_rshift
l_int|16
suffix:semicolon
r_int
r_char
id|n
op_assign
id|mnp
op_rshift
l_int|8
suffix:semicolon
r_int
r_char
id|p
op_assign
id|mnp
suffix:semicolon
r_switch
c_cond
(paren
id|pll
)paren
(brace
r_case
id|M_PIXEL_PLL_A
suffix:colon
r_return
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAM
)paren
op_ne
id|m
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAN
)paren
op_ne
id|n
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLAP
)paren
op_ne
id|p
)paren
suffix:semicolon
r_case
id|M_PIXEL_PLL_B
suffix:colon
r_return
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBM
)paren
op_ne
id|m
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBN
)paren
op_ne
id|n
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLBP
)paren
op_ne
id|p
)paren
suffix:semicolon
r_case
id|M_PIXEL_PLL_C
suffix:colon
r_return
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCM
)paren
op_ne
id|m
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCN
)paren
op_ne
id|n
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCP
)paren
op_ne
id|p
)paren
suffix:semicolon
r_case
id|M_SYSTEM_PLL
suffix:colon
r_return
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLM
)paren
op_ne
id|m
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLN
)paren
op_ne
id|n
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|DAC1064_XSYSPLLP
)paren
op_ne
id|p
)paren
suffix:semicolon
r_case
id|M_VIDEO_PLL
suffix:colon
r_return
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLM
)paren
op_ne
id|m
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLN
)paren
op_ne
id|n
op_logical_or
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XVIDPLLP
)paren
op_ne
id|p
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|g450_isplllocked
r_static
r_inline
r_int
id|g450_isplllocked
c_func
(paren
id|CPMINFO
r_int
r_int
id|regidx
)paren
(brace
r_int
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|1000
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|regidx
)paren
op_amp
l_int|0x40
)paren
(brace
r_int
r_int
id|r
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|r
op_add_assign
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|regidx
)paren
op_amp
l_int|0x40
suffix:semicolon
)brace
r_return
id|r
op_ge
(paren
l_int|90
op_star
l_int|0x40
)paren
suffix:semicolon
)brace
multiline_comment|/* udelay(1)... but DAC_in is much slower... */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|g450_testpll
r_static
r_int
id|g450_testpll
c_func
(paren
id|CPMINFO
r_int
r_int
id|mnp
comma
r_int
r_int
id|pll
)paren
(brace
r_return
id|g450_isplllocked
c_func
(paren
id|PMINFO
id|g450_setpll
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
)paren
suffix:semicolon
)brace
DECL|function|updatehwstate_clk
r_static
r_void
id|updatehwstate_clk
c_func
(paren
r_struct
id|matrox_hw_state
op_star
id|hw
comma
r_int
r_int
id|mnp
comma
r_int
r_int
id|pll
)paren
(brace
r_switch
c_cond
(paren
id|pll
)paren
(brace
r_case
id|M_SYSTEM_PLL
suffix:colon
id|hw-&gt;DACclk
(braket
l_int|3
)braket
op_assign
id|mnp
op_rshift
l_int|16
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|4
)braket
op_assign
id|mnp
op_rshift
l_int|8
suffix:semicolon
id|hw-&gt;DACclk
(braket
l_int|5
)braket
op_assign
id|mnp
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|g450_setpll_cond
r_static
r_inline
r_void
id|g450_setpll_cond
c_func
(paren
id|WPMINFO
r_int
r_int
id|mnp
comma
r_int
r_int
id|pll
)paren
(brace
r_if
c_cond
(paren
id|g450_cmppll
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
)paren
(brace
id|g450_setpll
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
suffix:semicolon
)brace
)brace
DECL|function|g450_findworkingpll
r_static
r_inline
r_int
r_int
id|g450_findworkingpll
c_func
(paren
id|WPMINFO
r_int
r_int
id|pll
comma
r_int
r_int
op_star
id|mnparray
comma
r_int
r_int
id|mnpcount
)paren
(brace
r_int
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
r_int
id|mnpfound
op_assign
id|mnparray
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|mnpcount
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_int
r_int
id|sarray
(braket
l_int|3
)braket
suffix:semicolon
r_int
r_int
op_star
id|sptr
suffix:semicolon
(brace
r_int
r_int
id|mnp
suffix:semicolon
id|sptr
op_assign
id|sarray
suffix:semicolon
id|mnp
op_assign
id|mnparray
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|mnp
op_amp
l_int|0x38
)paren
(brace
op_star
id|sptr
op_increment
op_assign
id|mnp
op_minus
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mnp
op_amp
l_int|0x38
)paren
op_ne
l_int|0x38
)paren
(brace
op_star
id|sptr
op_increment
op_assign
id|mnp
op_plus
l_int|8
suffix:semicolon
)brace
op_star
id|sptr
op_assign
id|mnp
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sptr
op_ge
id|sarray
)paren
(brace
r_int
r_int
id|mnp
op_assign
op_star
id|sptr
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_minus
l_int|0x0300
comma
id|pll
)paren
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_plus
l_int|0x0300
comma
id|pll
)paren
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_minus
l_int|0x0200
comma
id|pll
)paren
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_plus
l_int|0x0200
comma
id|pll
)paren
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_minus
l_int|0x0100
comma
id|pll
)paren
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
op_plus
l_int|0x0100
comma
id|pll
)paren
)paren
(brace
r_if
c_cond
(paren
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
)paren
(brace
r_return
id|mnp
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|found
op_logical_and
id|g450_testpll
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
)paren
(brace
id|mnpfound
op_assign
id|mnp
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
id|g450_setpll
c_func
(paren
id|PMINFO
id|mnpfound
comma
id|pll
)paren
suffix:semicolon
r_return
id|mnpfound
suffix:semicolon
)brace
DECL|function|g450_addcache
r_static
r_void
id|g450_addcache
c_func
(paren
r_struct
id|matrox_pll_cache
op_star
id|ci
comma
r_int
r_int
id|mnp_key
comma
r_int
r_int
id|mnp_value
)paren
(brace
r_if
c_cond
(paren
op_increment
id|ci-&gt;valid
OG
id|ARRAY_SIZE
c_func
(paren
id|ci-&gt;data
)paren
)paren
(brace
id|ci-&gt;valid
op_assign
id|ARRAY_SIZE
c_func
(paren
id|ci-&gt;data
)paren
suffix:semicolon
)brace
id|memmove
c_func
(paren
id|ci-&gt;data
op_plus
l_int|1
comma
id|ci-&gt;data
comma
(paren
id|ci-&gt;valid
op_minus
l_int|1
)paren
op_star
r_sizeof
(paren
op_star
id|ci-&gt;data
)paren
)paren
suffix:semicolon
id|ci-&gt;data
(braket
l_int|0
)braket
dot
id|mnp_key
op_assign
id|mnp_key
op_amp
id|G450_MNP_FREQBITS
suffix:semicolon
id|ci-&gt;data
(braket
l_int|0
)braket
dot
id|mnp_value
op_assign
id|mnp_value
suffix:semicolon
)brace
DECL|function|g450_checkcache
r_static
r_int
id|g450_checkcache
c_func
(paren
id|WPMINFO
r_struct
id|matrox_pll_cache
op_star
id|ci
comma
r_int
r_int
id|mnp_key
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|mnp_key
op_and_assign
id|G450_MNP_FREQBITS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ci-&gt;valid
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ci-&gt;data
(braket
id|i
)braket
dot
id|mnp_key
op_eq
id|mnp_key
)paren
(brace
r_int
r_int
id|mnp
suffix:semicolon
id|mnp
op_assign
id|ci-&gt;data
(braket
id|i
)braket
dot
id|mnp_value
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|memmove
c_func
(paren
id|ci-&gt;data
op_plus
l_int|1
comma
id|ci-&gt;data
comma
id|i
op_star
r_sizeof
(paren
op_star
id|ci-&gt;data
)paren
)paren
suffix:semicolon
id|ci-&gt;data
(braket
l_int|0
)braket
dot
id|mnp_key
op_assign
id|mnp_key
suffix:semicolon
id|ci-&gt;data
(braket
l_int|0
)braket
dot
id|mnp_value
op_assign
id|mnp
suffix:semicolon
)brace
r_return
id|mnp
suffix:semicolon
)brace
)brace
r_return
id|NO_MORE_MNP
suffix:semicolon
)brace
DECL|function|__g450_setclk
r_static
r_int
id|__g450_setclk
c_func
(paren
id|WPMINFO
r_int
r_int
id|fout
comma
r_int
r_int
id|pll
comma
r_int
r_int
op_star
id|mnparray
comma
r_int
r_int
op_star
id|deltaarray
)paren
(brace
r_int
r_int
id|mnpcount
suffix:semicolon
r_int
r_int
id|pixel_vco
suffix:semicolon
r_const
r_struct
id|matrox_pll_limits
op_star
id|pi
suffix:semicolon
r_struct
id|matrox_pll_cache
op_star
id|ci
suffix:semicolon
id|pixel_vco
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|pll
)paren
(brace
r_case
id|M_PIXEL_PLL_A
suffix:colon
r_case
id|M_PIXEL_PLL_B
suffix:colon
r_case
id|M_PIXEL_PLL_C
suffix:colon
(brace
id|u_int8_t
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|matroxfb_DAC_lock_irqsave
c_func
(paren
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|M1064_XPIXCLKCTRL_PLL_UP
)paren
)paren
(brace
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPIXCLKCTRL
comma
id|tmp
op_or
id|M1064_XPIXCLKCTRL_PLL_UP
)paren
suffix:semicolon
)brace
id|matroxfb_DAC_unlock_irqrestore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
(brace
id|u_int8_t
id|misc
suffix:semicolon
id|misc
op_assign
id|mga_inb
c_func
(paren
id|M_MISC_REG_READ
)paren
op_amp
op_complement
l_int|0x0C
suffix:semicolon
r_switch
c_cond
(paren
id|pll
)paren
(brace
r_case
id|M_PIXEL_PLL_A
suffix:colon
r_break
suffix:semicolon
r_case
id|M_PIXEL_PLL_B
suffix:colon
id|misc
op_or_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|misc
op_or_assign
l_int|0x0C
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mga_outb
c_func
(paren
id|M_MISC_REG
comma
id|misc
)paren
suffix:semicolon
)brace
id|pi
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|limits.pixel
)paren
suffix:semicolon
id|ci
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cache.pixel
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|M_SYSTEM_PLL
suffix:colon
(brace
id|u_int32_t
id|opt
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
op_amp
id|opt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|opt
op_amp
l_int|0x20
)paren
)paren
(brace
id|pci_write_config_dword
c_func
(paren
id|ACCESS_FBINFO
c_func
(paren
id|pcidev
)paren
comma
id|PCI_OPTION_REG
comma
id|opt
op_or
l_int|0x20
)paren
suffix:semicolon
)brace
)brace
id|pi
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|limits.system
)paren
suffix:semicolon
id|ci
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cache.system
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|M_VIDEO_PLL
suffix:colon
(brace
id|u_int8_t
id|tmp
suffix:semicolon
r_int
r_int
id|mnp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|matroxfb_DAC_lock_irqsave
c_func
(paren
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|2
)paren
)paren
(brace
id|matroxfb_DAC_out
c_func
(paren
id|PMINFO
id|M1064_XPWRCTRL
comma
id|tmp
op_or
l_int|2
)paren
suffix:semicolon
)brace
id|mnp
op_assign
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCM
)paren
op_lshift
l_int|16
suffix:semicolon
id|mnp
op_or_assign
id|matroxfb_DAC_in
c_func
(paren
id|PMINFO
id|M1064_XPIXPLLCN
)paren
op_lshift
l_int|8
suffix:semicolon
id|pixel_vco
op_assign
id|g450_mnp2vco
c_func
(paren
id|PMINFO
id|mnp
)paren
suffix:semicolon
id|matroxfb_DAC_unlock_irqrestore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|pi
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|limits.video
)paren
suffix:semicolon
id|ci
op_assign
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|cache.video
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mnpcount
op_assign
l_int|0
suffix:semicolon
(brace
r_int
r_int
id|mnp
suffix:semicolon
r_int
r_int
id|xvco
suffix:semicolon
r_for
c_loop
(paren
id|mnp
op_assign
id|g450_firstpll
c_func
(paren
id|PMINFO
id|pi
comma
op_amp
id|xvco
comma
id|fout
)paren
suffix:semicolon
id|mnp
op_ne
id|NO_MORE_MNP
suffix:semicolon
id|mnp
op_assign
id|g450_nextpll
c_func
(paren
id|PMINFO
id|pi
comma
op_amp
id|xvco
comma
id|mnp
)paren
)paren
(brace
r_int
r_int
id|idx
suffix:semicolon
r_int
r_int
id|vco
suffix:semicolon
r_int
r_int
id|delta
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mnp
op_amp
l_int|0xFF00
)paren
template_param
l_int|0x7A00
)paren
(brace
r_continue
suffix:semicolon
)brace
id|vco
op_assign
id|g450_mnp2vco
c_func
(paren
id|PMINFO
id|mnp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pll
op_eq
id|M_VIDEO_PLL
)paren
(brace
r_int
r_int
id|big
comma
id|small
suffix:semicolon
r_if
c_cond
(paren
id|vco
OL
id|pixel_vco
)paren
(brace
id|small
op_assign
id|vco
suffix:semicolon
id|big
op_assign
id|pixel_vco
suffix:semicolon
)brace
r_else
(brace
id|small
op_assign
id|pixel_vco
suffix:semicolon
id|big
op_assign
id|vco
suffix:semicolon
)brace
r_while
c_loop
(paren
id|big
OG
id|small
)paren
(brace
id|big
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|big
op_eq
id|small
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
id|delta
op_assign
id|pll_freq_delta
c_func
(paren
id|fout
comma
id|g450_vco2f
c_func
(paren
id|mnp
comma
id|vco
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
id|mnpcount
suffix:semicolon
id|idx
OG
l_int|0
suffix:semicolon
id|idx
op_decrement
)paren
(brace
multiline_comment|/* == is important; due to nextpll algorithm we get&n;&t;&t;&t;&t;   sorted equally good frequencies from lower VCO &n;&t;&t;&t;&t;   frequency to higher - with &lt;= lowest wins, while&n;&t;&t;&t;&t;   with &lt; highest one wins */
r_if
c_cond
(paren
id|delta
op_le
id|deltaarray
(braket
id|idx
op_minus
l_int|1
)braket
)paren
(brace
id|mnparray
(braket
id|idx
)braket
op_assign
id|mnparray
(braket
id|idx
op_minus
l_int|1
)braket
suffix:semicolon
id|deltaarray
(braket
id|idx
)braket
op_assign
id|deltaarray
(braket
id|idx
op_minus
l_int|1
)braket
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
id|mnparray
(braket
id|idx
)braket
op_assign
id|mnp
suffix:semicolon
id|deltaarray
(braket
id|idx
)braket
op_assign
id|delta
suffix:semicolon
id|mnpcount
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* VideoPLL and PixelPLL matched: do nothing... In all other cases we should get at least one frequency */
r_if
c_cond
(paren
op_logical_neg
id|mnpcount
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mnp
suffix:semicolon
id|matroxfb_DAC_lock_irqsave
c_func
(paren
id|flags
)paren
suffix:semicolon
id|mnp
op_assign
id|g450_checkcache
c_func
(paren
id|PMINFO
id|ci
comma
id|mnparray
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mnp
op_ne
id|NO_MORE_MNP
)paren
(brace
id|g450_setpll_cond
c_func
(paren
id|PMINFO
id|mnp
comma
id|pll
)paren
suffix:semicolon
)brace
r_else
(brace
id|mnp
op_assign
id|g450_findworkingpll
c_func
(paren
id|PMINFO
id|pll
comma
id|mnparray
comma
id|mnpcount
)paren
suffix:semicolon
id|g450_addcache
c_func
(paren
id|ci
comma
id|mnparray
(braket
l_int|0
)braket
comma
id|mnp
)paren
suffix:semicolon
)brace
id|updatehwstate_clk
c_func
(paren
op_amp
id|ACCESS_FBINFO
c_func
(paren
id|hw
)paren
comma
id|mnp
comma
id|pll
)paren
suffix:semicolon
id|matroxfb_DAC_unlock_irqrestore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* It must be greater than number of possible PLL values.&n; * Currently there is 5(p) * 10(m) = 50 possible values. */
DECL|macro|MNP_TABLE_SIZE
mdefine_line|#define MNP_TABLE_SIZE  64
DECL|function|matroxfb_g450_setclk
r_int
id|matroxfb_g450_setclk
c_func
(paren
id|WPMINFO
r_int
r_int
id|fout
comma
r_int
r_int
id|pll
)paren
(brace
r_int
r_int
op_star
id|arr
suffix:semicolon
id|arr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|arr
)paren
op_star
id|MNP_TABLE_SIZE
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arr
)paren
(brace
r_int
id|r
suffix:semicolon
id|r
op_assign
id|__g450_setclk
c_func
(paren
id|PMINFO
id|fout
comma
id|pll
comma
id|arr
comma
id|arr
op_plus
id|MNP_TABLE_SIZE
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|arr
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|variable|matroxfb_g450_setclk
id|EXPORT_SYMBOL
c_func
(paren
id|matroxfb_g450_setclk
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;(c) 2001 Petr Vandrovec &lt;vandrove@vc.cvut.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Matrox G450/G550 PLL driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
