multiline_comment|/*&n; *  linux/drivers/video/pm3fb.c -- 3DLabs Permedia3 frame buffer device&n; *  &n; *  Copyright (C) 2001 Romain Dolbeau &lt;dolbeau@irisa.fr&gt;&n; *  Based on code written by:&n; *           Sven Luther, &lt;luther@dpt-info.u-strasbg.fr&gt;&n; *           Alan Hourihane, &lt;alanh@fairlite.demon.co.uk&gt;&n; *           Russel King, &lt;rmk@arm.linux.org.uk&gt;&n; *  Based on linux/drivers/video/skeletonfb.c:&n; *&t;Copyright (C) 1997 Geert Uytterhoeven&n; *  Based on linux/driver/video/pm2fb.c:&n; *      Copyright (C) 1998-1999 Ilario Nardinocchi (nardinoc@CS.UniBO.IT)&n; *      Copyright (C) 1999 Jakub Jelinek (jakub@redhat.com)&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License. See the file COPYING in the main directory of this archive for&n; *  more details.&n; *&n; *  $Header: /cvsroot/linux/drivers/video/pm3fb.c,v 1.1 2002/02/25 19:11:06 marcelo Exp $&n; *&n; *  CHANGELOG:&n; *  Mon Feb 11 10:35:48 MET 2002, v 1.4.11B: Cosmetic update.&n; *  Wed Jan 23 14:16:59 MET 2002, v 1.4.11: Preliminary 2.5.x support, patch for 2.5.2.&n; *  Wed Nov 28 11:08:29 MET 2001, v 1.4.10: potential bug fix for SDRAM-based board, patch for 2.4.16.&n; *  Thu Sep 20 10:24:42 MET DST 2001, v 1.4.9: sync bug fix, preliminary flatpanel support, better timings.&n; *  Tue Aug 28 10:13:01 MET DST 2001, v 1.4.8: memory timings check, minor bug fixes.&n; *  Wed Jul 18 19:06:14 CEST 2001, v 1.4.7: Mode fix (800x600-100, 1024x768-100 changed), using HW panning + accel bug fix.&n; *  Mon Jun 25 10:33:56 MET DST 2001, v 1.4.6: Depth 12 fix, chip reset ioctl, moved memory erase ioctl to DEBUG.&n; *  Wed Jun 20 11:13:08 MET DST 2001, v 1.4.5: Fixed missing blinking cursor in 8bpp, code cleaning, memory erase IOCTL.&n; *  Mon Jun 18 16:00:27 CEST 2001, v 1.4.4: Depth 12 (RGBA 4444) support, code cleaning.&n; *  Fri Jun 15 13:53:01 CEST 2001, v 1.4.3: Removed warnings, depth 15 support, add &squot;depth&squot; option.&n; *  Thu Jun 14 10:13:52 MET DST 2001, v 1.4.2: Fixed depth switching bug, preliminary 15bpp (RGB5551) support.&n; *  Thu Apr 12 11:16:45 MET DST 2001, v 1.4.1B: Doc updates.&n; *  Fri Apr  6 11:12:53 MET DST 2001, v 1.4.1: Configure.help, minor cleanup&n; *  Thu Mar 29 10:56:50 MET DST 2001, v 1.4.0: Module &amp; module options support (note: linux patch changed, 2.2.19 added).&n; *  Thu Mar 15 15:30:31 MET 2001, v 1.3.2: Fixed mirroring bug on little-endian.&n; *  Wed Mar 14 21:25:54 CET 2001, v 1.3.1: Fixed bug in BlockMove (_bmov).&n; *  Tue Mar 13 10:53:19 MET 2001, v 1.3.0: Character drawing hardware support (in all width between 1 and 16), fixes.&n; *  Thu Mar  8 10:20:16 MET 2001, v 1.2.2: Better J2000 support, &quot;font:&quot; option.&n; *  Tue Mar  6 21:25:04 CET 2001, v 1.2.1: Better acceleration support.&n; *  Mon Mar  5 21:54:17 CET 2001, v 1.2.0: Partial acceleration support (clear &amp; bmove)&n; *  Mon Mar  5 12:52:15 CET 2001, v 1.1.3: Big pan_display fix.&n; *  Sun Mar  4 22:21:50 CET 2001, v 1.1.2: (numerous) bug fixes.&n; *  Fri Mar  2 15:54:07 CET 2001, v 1.1.1: Might have Appian J2000 support, resource mangement in 2.4&n; *  Wed Feb 28 18:21:35 CET 2001, v 1.1.0: Might have multiple boards support (added, but not yest tested)&n; *  Tue Feb 27 17:31:12 CET 2001, v 1.0.6: fixes boot-time mode select, add more default mode&n; *  Tue Feb 27 14:01:36 CET 2001, v 1.0.5: fixes (1.0.4 was broken for 2.2), cleaning up&n; *  Mon Feb 26 23:17:36 CET 2001, v 1.0.4: preliminary 2.4.x support, dropped (useless on pm3) partial product, more OF fix&n; *  Mon Feb 26 20:59:05 CET 2001, v 1.0.3: No more shadow register (and wasted memory), endianess fix, use OF-preset resolution by default&n; *  Wed Feb 21 22:09:30 CET 2001, v 1.0.2: Code cleaning for future multiboard support, better OF support, bugs fix&n; *  Wed Feb 21 19:58:56 CET 2001, v 1.0.1: OpenFirmware support, fixed memory detection, better debug support, code cleaning&n; *  Wed Feb 21 14:47:06 CET 2001, v 1.0.0: First working version&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;video/fbcon.h&gt;
macro_line|#include &lt;video/fbcon-mfb.h&gt;
macro_line|#include &lt;video/fbcon-cfb2.h&gt;
macro_line|#include &lt;video/fbcon-cfb4.h&gt;
macro_line|#include &lt;video/fbcon-cfb8.h&gt;
macro_line|#include &lt;video/fbcon-cfb16.h&gt;
macro_line|#include &lt;video/fbcon-cfb24.h&gt;
macro_line|#include &lt;video/fbcon-cfb32.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_FB_OF
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#endif
macro_line|#include &quot;pm3fb.h&quot;
multiline_comment|/* ************************************* */
multiline_comment|/* ***** The various &quot;global&quot; data ***** */
multiline_comment|/* ************************************* */
multiline_comment|/* those will need a rework for multiple board support */
multiline_comment|/* Driver name */
DECL|variable|permedia3_name
r_static
r_const
r_char
id|permedia3_name
(braket
l_int|16
)braket
op_assign
l_string|&quot;Permedia3&quot;
suffix:semicolon
multiline_comment|/* the fb_par struct, mandatory */
DECL|struct|pm3fb_par
r_struct
id|pm3fb_par
(brace
DECL|member|pixclock
id|u32
id|pixclock
suffix:semicolon
multiline_comment|/* pixclock in KHz */
DECL|member|width
id|u32
id|width
suffix:semicolon
multiline_comment|/* width of virtual screen */
DECL|member|height
id|u32
id|height
suffix:semicolon
multiline_comment|/* height of virtual screen */
DECL|member|hsstart
id|u32
id|hsstart
suffix:semicolon
multiline_comment|/* horiz. sync start */
DECL|member|hsend
id|u32
id|hsend
suffix:semicolon
multiline_comment|/* horiz. sync end */
DECL|member|hbend
id|u32
id|hbend
suffix:semicolon
multiline_comment|/* horiz. blank end (also gate end) */
DECL|member|htotal
id|u32
id|htotal
suffix:semicolon
multiline_comment|/* total width (w/ sync &amp; blank) */
DECL|member|vsstart
id|u32
id|vsstart
suffix:semicolon
multiline_comment|/* vert. sync start */
DECL|member|vsend
id|u32
id|vsend
suffix:semicolon
multiline_comment|/* vert. sync end */
DECL|member|vbend
id|u32
id|vbend
suffix:semicolon
multiline_comment|/* vert. blank end */
DECL|member|vtotal
id|u32
id|vtotal
suffix:semicolon
multiline_comment|/* total height (w/ sync &amp; blank) */
DECL|member|stride
id|u32
id|stride
suffix:semicolon
multiline_comment|/* screen stride */
DECL|member|base
id|u32
id|base
suffix:semicolon
multiline_comment|/* screen base (xoffset+yoffset) in 128 bits unit */
multiline_comment|/* NOTE : unlike other pm3 stuff above, stored *after* shiftbpp. don&squot;t ask */
DECL|member|depth
id|u32
id|depth
suffix:semicolon
multiline_comment|/* screen depth (8, 12, 15, 16 or 32) */
DECL|member|video
id|u32
id|video
suffix:semicolon
multiline_comment|/* video control (hsync,vsync) */
)brace
suffix:semicolon
multiline_comment|/* memory timings */
DECL|struct|pm3fb_timings
r_struct
id|pm3fb_timings
(brace
DECL|member|caps
r_int
r_int
id|caps
suffix:semicolon
DECL|member|timings
r_int
r_int
id|timings
suffix:semicolon
DECL|member|control
r_int
r_int
id|control
suffix:semicolon
DECL|member|refresh
r_int
r_int
id|refresh
suffix:semicolon
DECL|member|powerdown
r_int
r_int
id|powerdown
suffix:semicolon
)brace
suffix:semicolon
DECL|typedef|pm3fb_timing_result
DECL|enumerator|pm3fb_timing_ok
DECL|enumerator|pm3fb_timing_problem
DECL|enumerator|pm3fb_timing_retry
DECL|typedef|pm3fb_timing_result
r_typedef
r_enum
id|pm3fb_timing_result
(brace
id|pm3fb_timing_ok
comma
id|pm3fb_timing_problem
comma
id|pm3fb_timing_retry
)brace
id|pm3fb_timing_result
suffix:semicolon
DECL|macro|PM3FB_UNKNOWN_TIMING_VALUE
mdefine_line|#define PM3FB_UNKNOWN_TIMING_VALUE ((unsigned long)-1)
DECL|macro|PM3FB_UNKNOWN_TIMINGS
mdefine_line|#define PM3FB_UNKNOWN_TIMINGS { PM3FB_UNKNOWN_TIMING_VALUE, PM3FB_UNKNOWN_TIMING_VALUE, PM3FB_UNKNOWN_TIMING_VALUE, PM3FB_UNKNOWN_TIMING_VALUE, PM3FB_UNKNOWN_TIMING_VALUE }
multiline_comment|/* the fb_info struct, mandatory */
DECL|struct|pm3fb_info
r_struct
id|pm3fb_info
(brace
DECL|member|gen
r_struct
id|fb_info_gen
id|gen
suffix:semicolon
DECL|member|board_num
r_int
r_int
id|board_num
suffix:semicolon
multiline_comment|/* internal board number */
DECL|member|use_current
r_int
r_int
id|use_current
suffix:semicolon
DECL|member|current_par
r_struct
id|pm3fb_par
op_star
id|current_par
suffix:semicolon
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
multiline_comment|/* PCI device */
macro_line|#ifdef SUPPORT_FB_OF
DECL|member|dn
r_struct
id|device_node
op_star
id|dn
suffix:semicolon
multiline_comment|/* OF node for the PCI device */
macro_line|#endif /* SUPPORT_FB_OF */
DECL|member|board_type
r_int
r_int
id|board_type
suffix:semicolon
multiline_comment|/* index in the cardbase */
DECL|member|fb_base
r_int
r_char
op_star
id|fb_base
suffix:semicolon
multiline_comment|/* framebuffer memory base */
DECL|member|fb_size
id|u32
id|fb_size
suffix:semicolon
multiline_comment|/* framebuffer memory size */
DECL|member|p_fb
r_int
r_char
op_star
id|p_fb
suffix:semicolon
multiline_comment|/* physical address of frame buffer */
DECL|member|v_fb
r_int
r_char
op_star
id|v_fb
suffix:semicolon
multiline_comment|/* virtual address of frame buffer */
DECL|member|pIOBase
r_int
r_char
op_star
id|pIOBase
suffix:semicolon
multiline_comment|/* physical address of registers region, must be rg_base or rg_base+PM2_REGS_SIZE depending on the host endianness */
DECL|member|vIOBase
r_int
r_char
op_star
id|vIOBase
suffix:semicolon
multiline_comment|/* address of registers after ioremap() */
r_struct
(brace
DECL|member|transp
id|u8
id|transp
suffix:semicolon
DECL|member|red
id|u8
id|red
suffix:semicolon
DECL|member|green
id|u8
id|green
suffix:semicolon
DECL|member|blue
id|u8
id|blue
suffix:semicolon
DECL|member|palette
)brace
id|palette
(braket
l_int|256
)braket
suffix:semicolon
r_union
(brace
macro_line|#ifdef FBCON_HAS_CFB16
DECL|member|cmap12
id|u16
id|cmap12
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* RGBA 4444 */
DECL|member|cmap15
id|u16
id|cmap15
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* RGBA 5551 */
DECL|member|cmap16
id|u16
id|cmap16
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* RGBA 5650 */
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
DECL|member|cmap32
id|u32
id|cmap32
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
DECL|member|cmap
)brace
id|cmap
suffix:semicolon
DECL|member|memt
r_struct
id|pm3fb_timings
id|memt
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* regular resolution database*/
r_static
r_struct
(brace
DECL|member|name
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|user_mode
r_struct
id|pm3fb_par
id|user_mode
suffix:semicolon
DECL|variable|__initdata
)brace
id|mode_base
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_string|&quot;default-800x600&quot;
comma
(brace
l_int|49500
comma
l_int|800
comma
l_int|600
comma
l_int|16
comma
l_int|96
comma
l_int|256
comma
l_int|1056
comma
l_int|1
comma
l_int|4
comma
l_int|25
comma
l_int|625
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
(brace
l_string|&quot;1024x768-74&quot;
comma
(brace
l_int|78752
comma
l_int|1024
comma
l_int|768
comma
l_int|32
comma
l_int|128
comma
l_int|304
comma
l_int|1328
comma
l_int|1
comma
l_int|4
comma
l_int|38
comma
l_int|806
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
(brace
l_string|&quot;1024x768-74-32&quot;
comma
(brace
l_int|78752
comma
l_int|1024
comma
l_int|768
comma
l_int|32
comma
l_int|128
comma
l_int|304
comma
l_int|1328
comma
l_int|1
comma
l_int|4
comma
l_int|38
comma
l_int|806
comma
l_int|1024
comma
l_int|0
comma
l_int|32
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_32BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1600x1024&quot;, for the SGI 1600SW flat panel*/
(brace
l_string|&quot;SGI1600SW&quot;
comma
(brace
l_int|108000
comma
l_int|1600
comma
l_int|1024
comma
l_int|16
comma
l_int|56
comma
l_int|104
comma
l_int|1704
comma
l_int|3
comma
l_int|6
comma
l_int|32
comma
l_int|1056
comma
l_int|1600
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_32BIT
)brace
)brace
comma
multiline_comment|/* ##### auto-generated mode, by fbtimings2pm3 */
multiline_comment|/* Generated mode : &quot;640x480-60&quot; */
(brace
l_string|&quot;640x480-60&quot;
comma
(brace
l_int|25174
comma
l_int|640
comma
l_int|480
comma
l_int|16
comma
l_int|112
comma
l_int|160
comma
l_int|800
comma
l_int|10
comma
l_int|12
comma
l_int|45
comma
l_int|525
comma
l_int|640
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;640x480-72&quot; */
(brace
l_string|&quot;640x480-72&quot;
comma
(brace
l_int|31199
comma
l_int|640
comma
l_int|480
comma
l_int|24
comma
l_int|64
comma
l_int|192
comma
l_int|832
comma
l_int|9
comma
l_int|12
comma
l_int|40
comma
l_int|520
comma
l_int|640
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;640x480-75&quot; */
(brace
l_string|&quot;640x480-75&quot;
comma
(brace
l_int|31499
comma
l_int|640
comma
l_int|480
comma
l_int|16
comma
l_int|80
comma
l_int|200
comma
l_int|840
comma
l_int|1
comma
l_int|4
comma
l_int|20
comma
l_int|500
comma
l_int|640
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;640x480-90&quot; */
(brace
l_string|&quot;640x480-90&quot;
comma
(brace
l_int|39909
comma
l_int|640
comma
l_int|480
comma
l_int|32
comma
l_int|72
comma
l_int|192
comma
l_int|832
comma
l_int|25
comma
l_int|39
comma
l_int|53
comma
l_int|533
comma
l_int|640
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;640x480-100&quot; */
(brace
l_string|&quot;640x480-100&quot;
comma
(brace
l_int|44899
comma
l_int|640
comma
l_int|480
comma
l_int|32
comma
l_int|160
comma
l_int|208
comma
l_int|848
comma
l_int|22
comma
l_int|34
comma
l_int|51
comma
l_int|531
comma
l_int|640
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-48-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;800x600-48-lace&quot;, {35999, 800, 600, 80, 208, 264, 1064, 11, 23, 102, 702, 800, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;800x600-56&quot; */
(brace
l_string|&quot;800x600-56&quot;
comma
(brace
l_int|35999
comma
l_int|800
comma
l_int|600
comma
l_int|24
comma
l_int|96
comma
l_int|224
comma
l_int|1024
comma
l_int|1
comma
l_int|3
comma
l_int|25
comma
l_int|625
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-60&quot; */
(brace
l_string|&quot;800x600-60&quot;
comma
(brace
l_int|40000
comma
l_int|800
comma
l_int|600
comma
l_int|40
comma
l_int|168
comma
l_int|256
comma
l_int|1056
comma
l_int|1
comma
l_int|5
comma
l_int|28
comma
l_int|628
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-70&quot; */
(brace
l_string|&quot;800x600-70&quot;
comma
(brace
l_int|44899
comma
l_int|800
comma
l_int|600
comma
l_int|24
comma
l_int|168
comma
l_int|208
comma
l_int|1008
comma
l_int|9
comma
l_int|21
comma
l_int|36
comma
l_int|636
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-72&quot; */
(brace
l_string|&quot;800x600-72&quot;
comma
(brace
l_int|50000
comma
l_int|800
comma
l_int|600
comma
l_int|56
comma
l_int|176
comma
l_int|240
comma
l_int|1040
comma
l_int|37
comma
l_int|43
comma
l_int|66
comma
l_int|666
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-75&quot; */
(brace
l_string|&quot;800x600-75&quot;
comma
(brace
l_int|49497
comma
l_int|800
comma
l_int|600
comma
l_int|16
comma
l_int|96
comma
l_int|256
comma
l_int|1056
comma
l_int|1
comma
l_int|4
comma
l_int|25
comma
l_int|625
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-90&quot; */
(brace
l_string|&quot;800x600-90&quot;
comma
(brace
l_int|56637
comma
l_int|800
comma
l_int|600
comma
l_int|8
comma
l_int|72
comma
l_int|192
comma
l_int|992
comma
l_int|8
comma
l_int|19
comma
l_int|35
comma
l_int|635
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;800x600-100&quot;, from /etc/fb.modes */
multiline_comment|/* DISABLED, hsstart == 0&n;&t;{&n;&t;&t;&quot;800x600-100&quot;, {&n;&t;67499, 800, 600, 0, 64, 280, 1080, 7, 11, 25, 625,&n;&t;&t;&t;    800, 0, 8,&n;&t;&t;&t;    PM3VideoControl_ENABLE |&n;&t;&t;&t;    PM3VideoControl_HSYNC_ACTIVE_HIGH&n;&t;&t;&t;    |&n;&t;&t;&t;    PM3VideoControl_VSYNC_ACTIVE_HIGH&n;&t;&t;&t;    | PM3VideoControl_PIXELSIZE_8BIT}},&n;*/
multiline_comment|/* Generated mode : &quot;800x600-100&quot;, from ??? */
(brace
l_string|&quot;800x600-100&quot;
comma
(brace
l_int|69650
comma
l_int|800
comma
l_int|600
comma
l_int|64
comma
l_int|128
comma
l_int|288
comma
l_int|1088
comma
l_int|4
comma
l_int|10
comma
l_int|40
comma
l_int|640
comma
l_int|800
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-43-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;1024x768-43-lace&quot;, {44899, 1024, 768, 8, 184, 240, 1264, 1, 9, 49, 817, 1024, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;1024x768-60&quot; */
(brace
l_string|&quot;1024x768-60&quot;
comma
(brace
l_int|64998
comma
l_int|1024
comma
l_int|768
comma
l_int|24
comma
l_int|160
comma
l_int|320
comma
l_int|1344
comma
l_int|3
comma
l_int|9
comma
l_int|38
comma
l_int|806
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-70&quot; */
(brace
l_string|&quot;1024x768-70&quot;
comma
(brace
l_int|74996
comma
l_int|1024
comma
l_int|768
comma
l_int|24
comma
l_int|160
comma
l_int|304
comma
l_int|1328
comma
l_int|3
comma
l_int|9
comma
l_int|38
comma
l_int|806
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-72&quot; */
(brace
l_string|&quot;1024x768-72&quot;
comma
(brace
l_int|74996
comma
l_int|10224
comma
l_int|768
comma
l_int|24
comma
l_int|160
comma
l_int|264
comma
l_int|10488
comma
l_int|3
comma
l_int|9
comma
l_int|38
comma
l_int|806
comma
l_int|10224
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-75&quot; */
(brace
l_string|&quot;1024x768-75&quot;
comma
(brace
l_int|78746
comma
l_int|1024
comma
l_int|768
comma
l_int|16
comma
l_int|112
comma
l_int|288
comma
l_int|1312
comma
l_int|1
comma
l_int|4
comma
l_int|32
comma
l_int|800
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-90&quot; */
(brace
l_string|&quot;1024x768-90&quot;
comma
(brace
l_int|100000
comma
l_int|1024
comma
l_int|768
comma
l_int|0
comma
l_int|96
comma
l_int|288
comma
l_int|1312
comma
l_int|21
comma
l_int|36
comma
l_int|77
comma
l_int|845
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1024x768-100&quot;, from /etc/fb.modes */
multiline_comment|/* DISABLED, vsstart == 0&n;&t;{&n;&t;&t;&quot;1024x768-100&quot;, {&n;&t;109998, 1024, 768, 0, 88, 368, 1392, 0, 8, 24, 792,&n;&t;&t;&t;    1024, 0, 8,&n;&t;&t;&t;    PM3VideoControl_ENABLE |&n;&t;&t;&t;    PM3VideoControl_HSYNC_ACTIVE_LOW&n;&t;&t;&t;    |&n;&t;&t;&t;    PM3VideoControl_VSYNC_ACTIVE_LOW&n;&t;&t;&t;    | PM3VideoControl_PIXELSIZE_8BIT}},&n;*/
multiline_comment|/* Generated mode : &quot;1024x768-100&quot;, from ??? */
(brace
l_string|&quot;1024x768-100&quot;
comma
(brace
l_int|115500
comma
l_int|1024
comma
l_int|768
comma
l_int|32
comma
l_int|224
comma
l_int|416
comma
l_int|1440
comma
l_int|3
comma
l_int|13
comma
l_int|34
comma
l_int|802
comma
l_int|1024
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1152x864-43-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;1152x864-43-lace&quot;, {64998, 1152, 864, 72, 200, 264, 1416, 78, 87, 191, 1055, 1152, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;1152x864-47-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;1152x864-47-lace&quot;, {64998, 1152, 864, 88, 216, 296, 1448, 30, 39, 83, 947, 1152, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;1152x864-60&quot; */
(brace
l_string|&quot;1152x864-60&quot;
comma
(brace
l_int|80000
comma
l_int|1152
comma
l_int|864
comma
l_int|64
comma
l_int|176
comma
l_int|304
comma
l_int|1456
comma
l_int|6
comma
l_int|11
comma
l_int|52
comma
l_int|916
comma
l_int|1152
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1152x864-70&quot; */
(brace
l_string|&quot;1152x864-70&quot;
comma
(brace
l_int|100000
comma
l_int|1152
comma
l_int|864
comma
l_int|40
comma
l_int|192
comma
l_int|360
comma
l_int|1512
comma
l_int|13
comma
l_int|24
comma
l_int|81
comma
l_int|945
comma
l_int|1152
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1152x864-75&quot; */
(brace
l_string|&quot;1152x864-75&quot;
comma
(brace
l_int|109998
comma
l_int|1152
comma
l_int|864
comma
l_int|24
comma
l_int|168
comma
l_int|312
comma
l_int|1464
comma
l_int|45
comma
l_int|53
comma
l_int|138
comma
l_int|1002
comma
l_int|1152
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1152x864-80&quot; */
(brace
l_string|&quot;1152x864-80&quot;
comma
(brace
l_int|109998
comma
l_int|1152
comma
l_int|864
comma
l_int|16
comma
l_int|128
comma
l_int|288
comma
l_int|1440
comma
l_int|30
comma
l_int|37
comma
l_int|94
comma
l_int|958
comma
l_int|1152
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1280x1024-43-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;1280x1024-43-lace&quot;, {80000, 1024, 1024, 80, 160, 320, 1344, 50, 60, 125, 1149, 1024, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;1280x1024-47-lace&quot; */
multiline_comment|/* INTERLACED NOT SUPPORTED&n;  {&quot;1280x1024-47-lace&quot;, {80000, 1280, 1024, 80, 160, 320, 1600, 1, 11, 29, 1053, 1280, 0, 8, PM3VideoControl_ENABLE|PM3VideoControl_HSYNC_ACTIVE_HIGH|PM3VideoControl_VSYNC_ACTIVE_HIGH|PM3VideoControl_PIXELSIZE_8BIT}}, &n;   INTERLACED NOT SUPPORTED */
multiline_comment|/* Generated mode : &quot;1280x1024-60&quot; */
(brace
l_string|&quot;1280x1024-60&quot;
comma
(brace
l_int|107991
comma
l_int|1280
comma
l_int|1024
comma
l_int|48
comma
l_int|160
comma
l_int|408
comma
l_int|1688
comma
l_int|1
comma
l_int|4
comma
l_int|42
comma
l_int|1066
comma
l_int|1280
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1280x1024-70&quot; */
(brace
l_string|&quot;1280x1024-70&quot;
comma
(brace
l_int|125992
comma
l_int|1280
comma
l_int|1024
comma
l_int|80
comma
l_int|192
comma
l_int|408
comma
l_int|1688
comma
l_int|1
comma
l_int|6
comma
l_int|42
comma
l_int|1066
comma
l_int|1280
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1280x1024-74&quot; */
(brace
l_string|&quot;1280x1024-74&quot;
comma
(brace
l_int|134989
comma
l_int|1280
comma
l_int|1024
comma
l_int|32
comma
l_int|176
comma
l_int|432
comma
l_int|1712
comma
l_int|0
comma
l_int|30
comma
l_int|40
comma
l_int|1064
comma
l_int|1280
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1280x1024-75&quot; */
(brace
l_string|&quot;1280x1024-75&quot;
comma
(brace
l_int|134989
comma
l_int|1280
comma
l_int|1024
comma
l_int|16
comma
l_int|160
comma
l_int|408
comma
l_int|1688
comma
l_int|1
comma
l_int|4
comma
l_int|42
comma
l_int|1066
comma
l_int|1280
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1600x1200-60&quot; */
(brace
l_string|&quot;1600x1200-60&quot;
comma
(brace
l_int|155981
comma
l_int|1600
comma
l_int|1200
comma
l_int|32
comma
l_int|192
comma
l_int|448
comma
l_int|2048
comma
l_int|10
comma
l_int|18
comma
l_int|70
comma
l_int|1270
comma
l_int|1600
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1600x1200-66&quot; */
(brace
l_string|&quot;1600x1200-66&quot;
comma
(brace
l_int|171998
comma
l_int|1600
comma
l_int|1200
comma
l_int|40
comma
l_int|176
comma
l_int|480
comma
l_int|2080
comma
l_int|3
comma
l_int|6
comma
l_int|53
comma
l_int|1253
comma
l_int|1600
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* Generated mode : &quot;1600x1200-76&quot; */
(brace
l_string|&quot;1600x1200-76&quot;
comma
(brace
l_int|197980
comma
l_int|1600
comma
l_int|1200
comma
l_int|40
comma
l_int|176
comma
l_int|480
comma
l_int|2080
comma
l_int|3
comma
l_int|8
comma
l_int|50
comma
l_int|1250
comma
l_int|1600
comma
l_int|0
comma
l_int|8
comma
id|PM3VideoControl_ENABLE
op_or
id|PM3VideoControl_HSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_VSYNC_ACTIVE_LOW
op_or
id|PM3VideoControl_PIXELSIZE_8BIT
)brace
)brace
comma
multiline_comment|/* ##### end of auto-generated mode */
(brace
l_string|&quot;&bslash;0&quot;
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* more mandatory stuff (see skeletonfb.c + framebuffer driver HOWTO */
DECL|variable|fb_info
r_static
r_struct
id|pm3fb_info
id|fb_info
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|current_par
r_static
r_struct
id|pm3fb_par
id|current_par
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|current_par_valid
r_static
r_int
id|current_par_valid
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
multiline_comment|/* to allow explicit filtering of board */
DECL|variable|bus
r_int
id|bus
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|slot
r_int
id|slot
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|func
r_int
id|func
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|disable
r_int
id|disable
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|noaccel
r_int
id|noaccel
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|fontn
r_char
id|fontn
(braket
id|PM3_MAX_BOARD
)braket
(braket
id|PM3_FONTNAME_SIZE
)braket
suffix:semicolon
DECL|variable|depth
r_int
id|depth
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|flatpanel
r_int
id|flatpanel
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|disp
r_static
r_struct
id|display
id|disp
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|g_options
(braket
id|PM3_OPTIONS_SIZE
)braket
id|__initdata
op_assign
l_string|&quot;pm3fb,dummy&quot;
suffix:semicolon
DECL|variable|printtimings
r_int
id|printtimings
op_assign
l_int|0
suffix:semicolon
DECL|variable|forcesize
r_int
id|forcesize
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
multiline_comment|/* ********************* */
multiline_comment|/* ***** prototype ***** */
multiline_comment|/* ********************* */
multiline_comment|/* card-specific */
r_static
r_void
id|pm3fb_j2000_setup
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* permedia3-specific */
r_static
id|pm3fb_timing_result
id|pm3fb_preserve_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
id|pm3fb_timing_result
id|pm3fb_try_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_write_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_int
r_int
id|pm3fb_read_dac_reg
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|r
)paren
suffix:semicolon
r_static
r_int
r_int
id|pm3fb_CalculateClock
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|reqclock
comma
multiline_comment|/* In kHz units */
r_int
r_int
id|refclock
comma
multiline_comment|/* In kHz units */
r_int
r_char
op_star
id|prescale
comma
multiline_comment|/* ClkPreScale */
r_int
r_char
op_star
id|feedback
comma
multiline_comment|/* ClkFeedBackScale */
r_int
r_char
op_star
id|postscale
multiline_comment|/* ClkPostScale */
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_clear_memory
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
id|u32
id|cc
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_clear_colormap
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_char
id|r
comma
r_int
r_char
id|g
comma
r_int
r_char
id|b
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_common_init
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_Shiftbpp
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|depth
comma
r_int
id|v
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_Unshiftbpp
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|depth
comma
r_int
id|v
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_mapIO
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_unmapIO
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
macro_line|#if defined(PM3FB_MASTER_DEBUG) &amp;&amp; (PM3FB_MASTER_DEBUG &gt;= 2)
r_static
r_void
id|pm3fb_show_cur_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|pm3fb_show_cur_timing
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_write_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_read_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_struct
id|pm3fb_par
op_star
id|curpar
)paren
suffix:semicolon
r_static
r_int
r_int
id|pm3fb_size_memory
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* accelerated permedia3-specific */
macro_line|#ifdef PM3FB_USE_ACCEL
r_static
r_void
id|pm3fb_wait_pm3
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_init_engine
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
macro_line|#ifdef FBCON_HAS_CFB32
r_static
r_void
id|pm3fb_cfb32_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfb32_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB32 */
macro_line|#ifdef FBCON_HAS_CFB16
r_static
r_void
id|pm3fb_cfb16_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfb16_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB16 */
macro_line|#ifdef FBCON_HAS_CFB8
r_static
r_void
id|pm3fb_cfb8_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfb8_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB8 */
macro_line|#if defined(FBCON_HAS_CFB8) || defined(FBCON_HAS_CFB16) || defined(FBCON_HAS_CFB32)
r_static
r_void
id|pm3fb_cfbX_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfbX_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfbX_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_cfbX_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB8 || FBCON_HAS_CFB16 || FBCON_HAS_CFB32 */
macro_line|#endif /* PM3FB_USE_ACCEL */
multiline_comment|/* pre-init */
r_static
r_void
id|pm3fb_mode_setup
c_func
(paren
r_char
op_star
id|mode
comma
r_int
r_int
id|board_num
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_pciid_setup
c_func
(paren
r_char
op_star
id|pciid
comma
r_int
r_int
id|board_num
)paren
suffix:semicolon
r_static
r_char
op_star
id|pm3fb_boardnum_setup
c_func
(paren
r_char
op_star
id|options
comma
r_int
r_int
op_star
id|bn
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_real_setup
c_func
(paren
r_char
op_star
id|options
)paren
suffix:semicolon
multiline_comment|/* fbdev */
r_static
r_int
id|pm3fb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_encode_depth
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|d
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_get_par
c_func
(paren
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_set_par
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_set_color
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_char
id|regno
comma
r_int
r_char
id|r
comma
r_int
r_char
id|g
comma
r_int
r_char
id|b
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_set_disp
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_void
id|pm3fb_detect
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_pan_display
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
suffix:semicolon
r_static
r_int
id|pm3fb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/* the struct that hold them together */
macro_line|#ifdef KERNEL_2_2
DECL|variable|pm3fb_switch
r_struct
id|fbgen_hwswitch
id|pm3fb_switch
op_assign
(brace
id|pm3fb_detect
comma
id|pm3fb_encode_fix
comma
id|pm3fb_decode_var
comma
id|pm3fb_encode_var
comma
id|pm3fb_get_par
comma
id|pm3fb_set_par
comma
id|pm3fb_getcolreg
comma
id|pm3fb_setcolreg
comma
id|pm3fb_pan_display
comma
id|pm3fb_blank
comma
id|pm3fb_set_disp
)brace
suffix:semicolon
DECL|variable|pm3fb_ops
r_static
r_struct
id|fb_ops
id|pm3fb_ops
op_assign
(brace
id|fbgen_get_fix
comma
id|fbgen_get_var
comma
id|fbgen_set_var
comma
id|fbgen_get_cmap
comma
id|fbgen_set_cmap
comma
id|fbgen_pan_display
comma
id|pm3fb_ioctl
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
macro_line|#endif /* KERNEL_2_2 */
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
DECL|variable|pm3fb_switch
r_struct
id|fbgen_hwswitch
id|pm3fb_switch
op_assign
(brace
id|pm3fb_detect
comma
id|pm3fb_encode_fix
comma
id|pm3fb_decode_var
comma
id|pm3fb_encode_var
comma
id|pm3fb_get_par
comma
id|pm3fb_set_par
comma
id|pm3fb_getcolreg
comma
id|pm3fb_pan_display
comma
id|pm3fb_blank
comma
id|pm3fb_set_disp
)brace
suffix:semicolon
DECL|variable|pm3fb_ops
r_static
r_struct
id|fb_ops
id|pm3fb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|fbgen_get_fix
comma
id|fb_get_var
suffix:colon
id|fbgen_get_var
comma
id|fb_set_var
suffix:colon
id|fbgen_set_var
comma
id|fb_get_cmap
suffix:colon
id|fbgen_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|fbgen_set_cmap
comma
id|fb_setcolreg
suffix:colon
id|pm3fb_setcolreg
comma
id|fb_pan_display
suffix:colon
id|fbgen_pan_display
comma
id|fb_blank
suffix:colon
id|fbgen_blank
comma
id|fb_ioctl
suffix:colon
id|pm3fb_ioctl
comma
)brace
suffix:semicolon
macro_line|#endif /* KERNEL_2_4 or KERNEL_2_5 */
macro_line|#ifdef PM3FB_USE_ACCEL
macro_line|#ifdef FBCON_HAS_CFB32
DECL|variable|pm3fb_cfb32
r_static
r_struct
id|display_switch
id|pm3fb_cfb32
op_assign
(brace
id|fbcon_cfb32_setup
comma
id|pm3fb_cfbX_bmove
comma
id|pm3fb_cfb32_clear
comma
id|pm3fb_cfbX_putc
comma
id|pm3fb_cfbX_putcs
comma
id|pm3fb_cfbX_revc
comma
l_int|NULL
multiline_comment|/* cursor() */
comma
l_int|NULL
multiline_comment|/* set_font() */
comma
id|pm3fb_cfb32_clear_margins
comma
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
multiline_comment|/* true only if accelerated... */
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB32 */
macro_line|#ifdef FBCON_HAS_CFB16
DECL|variable|pm3fb_cfb16
r_static
r_struct
id|display_switch
id|pm3fb_cfb16
op_assign
(brace
id|fbcon_cfb16_setup
comma
id|pm3fb_cfbX_bmove
comma
id|pm3fb_cfb16_clear
comma
id|pm3fb_cfbX_putc
comma
id|pm3fb_cfbX_putcs
comma
id|pm3fb_cfbX_revc
comma
l_int|NULL
multiline_comment|/* cursor() */
comma
l_int|NULL
multiline_comment|/* set_font() */
comma
id|pm3fb_cfb16_clear_margins
comma
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
multiline_comment|/* true only if accelerated... */
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB16 */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|variable|pm3fb_cfb8
r_static
r_struct
id|display_switch
id|pm3fb_cfb8
op_assign
(brace
id|fbcon_cfb8_setup
comma
id|pm3fb_cfbX_bmove
comma
id|pm3fb_cfb8_clear
comma
id|pm3fb_cfbX_putc
comma
id|pm3fb_cfbX_putcs
comma
id|pm3fb_cfbX_revc
comma
l_int|NULL
multiline_comment|/* cursor() */
comma
l_int|NULL
multiline_comment|/* set_font() */
comma
id|pm3fb_cfb8_clear_margins
comma
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
multiline_comment|/* true only if accelerated... */
)brace
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB8 */
macro_line|#endif /* PM3FB_USE_ACCEL */
multiline_comment|/* ****************************** */
multiline_comment|/* ***** card-specific data ***** */
multiline_comment|/* ****************************** */
DECL|struct|pm3fb_card_timings
r_struct
id|pm3fb_card_timings
(brace
DECL|member|memsize
r_int
r_int
id|memsize
suffix:semicolon
multiline_comment|/* 0 for last value (i.e. default) */
DECL|member|memt
r_struct
id|pm3fb_timings
id|memt
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|t_FormacProFormance3
r_static
r_struct
id|pm3fb_card_timings
id|t_FormacProFormance3
(braket
)braket
op_assign
(brace
(brace
l_int|16
comma
(brace
l_int|0x02e311b8
comma
l_int|0x06100205
comma
l_int|0x08000002
comma
l_int|0x00000079
comma
l_int|0x00000000
)brace
)brace
comma
(brace
l_int|0
comma
(brace
l_int|0x02e311b8
comma
l_int|0x06100205
comma
l_int|0x08000002
comma
l_int|0x00000079
comma
l_int|0x00000000
)brace
)brace
multiline_comment|/* from 16 MB PF3 */
)brace
suffix:semicolon
DECL|variable|t_AppianJeronimo2000
r_static
r_struct
id|pm3fb_card_timings
id|t_AppianJeronimo2000
(braket
)braket
op_assign
(brace
(brace
l_int|32
comma
(brace
l_int|0x02e311B8
comma
l_int|0x07424905
comma
l_int|0x0c000003
comma
l_int|0x00000061
comma
l_int|0x00000000
)brace
)brace
comma
(brace
l_int|0
comma
(brace
l_int|0x02e311B8
comma
l_int|0x07424905
comma
l_int|0x0c000003
comma
l_int|0x00000061
comma
l_int|0x00000000
)brace
)brace
multiline_comment|/* from 32MB J2000 */
)brace
suffix:semicolon
DECL|variable|t_3DLabsOxygenVX1
r_static
r_struct
id|pm3fb_card_timings
id|t_3DLabsOxygenVX1
(braket
)braket
op_assign
(brace
(brace
l_int|32
comma
(brace
l_int|0x30e311b8
comma
l_int|0x08501204
comma
l_int|0x08000002
comma
l_int|0x0000006b
comma
l_int|0x00000000
)brace
)brace
comma
(brace
l_int|0
comma
(brace
l_int|0x30e311b8
comma
l_int|0x08501204
comma
l_int|0x08000002
comma
l_int|0x0000006b
comma
l_int|0x00000000
)brace
)brace
multiline_comment|/* from 32MB VX1 */
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|cardname
r_char
id|cardname
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* recognized card name */
DECL|member|subvendor
id|u16
id|subvendor
suffix:semicolon
multiline_comment|/* subvendor of the card */
DECL|member|subdevice
id|u16
id|subdevice
suffix:semicolon
multiline_comment|/* subdevice of the card */
DECL|member|func
id|u8
id|func
suffix:semicolon
multiline_comment|/* function of the card to which the extra init apply */
DECL|member|specific_setup
r_void
(paren
op_star
id|specific_setup
)paren
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* card/func specific setup, done before _any_ FB access */
DECL|member|c_memt
r_struct
id|pm3fb_card_timings
op_star
id|c_memt
suffix:semicolon
multiline_comment|/* defauls timings for the boards */
DECL|variable|cardbase
)brace
id|cardbase
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Unknown Permedia3 board&quot;
comma
l_int|0xFFFF
comma
l_int|0xFFFF
comma
l_int|0xFF
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;Appian Jeronimo 2000 head 1&quot;
comma
l_int|0x1097
comma
l_int|0x3d32
comma
l_int|1
comma
l_int|NULL
comma
id|t_AppianJeronimo2000
)brace
comma
(brace
l_string|&quot;Appian Jeronimo 2000 head 2&quot;
comma
l_int|0x1097
comma
l_int|0x3d32
comma
l_int|2
comma
id|pm3fb_j2000_setup
comma
id|t_AppianJeronimo2000
)brace
comma
(brace
l_string|&quot;Formac ProFormance 3&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x000a
comma
l_int|0
comma
l_int|NULL
comma
multiline_comment|/* Formac use 3DLabs ID ?!? */
id|t_FormacProFormance3
)brace
comma
(brace
l_string|&quot;3DLabs Permedia3 Create!&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x0127
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;3DLabs Oxygen VX1 PCI&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x0121
comma
l_int|0
comma
l_int|NULL
comma
id|t_3DLabsOxygenVX1
)brace
comma
(brace
l_string|&quot;3DLabs Oxygen VX1 AGP&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x0125
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;3DLabs Oxygen VX1-16 AGP&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x0140
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;3DLabs Oxygen VX1-1600SW PCI&quot;
comma
id|PCI_VENDOR_ID_3DLABS
comma
l_int|0x0800
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;&bslash;0&quot;
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* ********************************** */
multiline_comment|/* ***** card-specific function ***** */
multiline_comment|/* ********************************** */
DECL|function|pm3fb_j2000_setup
r_static
r_void
id|pm3fb_j2000_setup
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
multiline_comment|/* the appian j2000 require more initialization of the second head */
multiline_comment|/* l_fb_info must point to the _second_ head of the J2000 */
id|DTRACE
suffix:semicolon
id|l_fb_info-&gt;memt
op_assign
id|t_AppianJeronimo2000
(braket
l_int|0
)braket
dot
id|memt
suffix:semicolon
multiline_comment|/* 32 MB, first and only j2000 ? */
id|pm3fb_write_memory_timings
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
multiline_comment|/* *************************************** */
multiline_comment|/* ***** permedia3-specific function ***** */
multiline_comment|/* *************************************** */
DECL|function|pm3fb_preserve_memory_timings
r_static
id|pm3fb_timing_result
id|pm3fb_preserve_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|l_fb_info-&gt;memt.caps
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemCaps
)paren
suffix:semicolon
id|l_fb_info-&gt;memt.timings
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemTimings
)paren
suffix:semicolon
id|l_fb_info-&gt;memt.control
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemControl
)paren
suffix:semicolon
id|l_fb_info-&gt;memt.refresh
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemRefresh
)paren
suffix:semicolon
id|l_fb_info-&gt;memt.powerdown
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemPowerDown
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;memt.caps
op_eq
id|PM3FB_UNKNOWN_TIMING_VALUE
)paren
op_logical_or
(paren
id|l_fb_info-&gt;memt.timings
op_eq
id|PM3FB_UNKNOWN_TIMING_VALUE
)paren
op_logical_or
(paren
id|l_fb_info-&gt;memt.control
op_eq
id|PM3FB_UNKNOWN_TIMING_VALUE
)paren
op_logical_or
(paren
id|l_fb_info-&gt;memt.refresh
op_eq
id|PM3FB_UNKNOWN_TIMING_VALUE
)paren
op_logical_or
(paren
id|l_fb_info-&gt;memt.powerdown
op_eq
id|PM3FB_UNKNOWN_TIMING_VALUE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pm3fb: invalid memory timings in permedia3 board #%ld&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
)paren
suffix:semicolon
r_return
id|pm3fb_try_memory_timings
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
r_return
id|pm3fb_timing_ok
suffix:semicolon
)brace
DECL|function|pm3fb_try_memory_timings
r_static
id|pm3fb_timing_result
id|pm3fb_try_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
r_if
c_cond
(paren
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|c_memt
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|done
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|done
)paren
(brace
r_if
c_cond
(paren
(paren
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|c_memt
(braket
id|i
)braket
dot
id|memsize
op_eq
id|l_fb_info-&gt;fb_size
)paren
op_logical_or
op_logical_neg
(paren
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|c_memt
(braket
id|i
)braket
dot
id|memsize
)paren
)paren
(brace
multiline_comment|/* will use the 0-sized timings by default */
id|done
op_assign
l_int|1
suffix:semicolon
id|l_fb_info-&gt;memt
op_assign
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|c_memt
(braket
id|i
)braket
dot
id|memt
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: trying to use predefined memory timings for permedia3 board #%ld (%s, %ld MB)&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
comma
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|cardname
comma
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|c_memt
(braket
id|i
)braket
dot
id|memsize
)paren
suffix:semicolon
id|pm3fb_write_memory_timings
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
r_return
id|pm3fb_timing_retry
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
)brace
r_else
r_return
id|pm3fb_timing_problem
suffix:semicolon
r_return
id|pm3fb_timing_ok
suffix:semicolon
)brace
DECL|function|pm3fb_write_memory_timings
r_static
r_void
id|pm3fb_write_memory_timings
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
r_int
r_char
id|m
comma
id|n
comma
id|p
suffix:semicolon
r_int
r_int
id|clockused
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LocalMemCaps
comma
id|l_fb_info-&gt;memt.caps
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LocalMemTimings
comma
id|l_fb_info-&gt;memt.timings
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LocalMemControl
comma
id|l_fb_info-&gt;memt.control
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LocalMemRefresh
comma
id|l_fb_info-&gt;memt.refresh
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LocalMemPowerDown
comma
id|l_fb_info-&gt;memt.powerdown
)paren
suffix:semicolon
id|clockused
op_assign
id|pm3fb_CalculateClock
c_func
(paren
id|l_fb_info
comma
l_int|2
op_star
l_int|105000
comma
id|PM3_REF_CLOCK
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_KClkPreScale
comma
id|m
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_KClkFeedbackScale
comma
id|n
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_KClkPostScale
comma
id|p
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_KClkControl
comma
id|PM3RD_KClkControl_STATE_RUN
op_or
id|PM3RD_KClkControl_SOURCE_PLL
op_or
id|PM3RD_KClkControl_ENABLE
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_MClkControl
comma
id|PM3RD_MClkControl_STATE_RUN
op_or
id|PM3RD_MClkControl_SOURCE_KCLK
op_or
id|PM3RD_MClkControl_ENABLE
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_SClkControl
comma
id|PM3RD_SClkControl_STATE_RUN
op_or
id|PM3RD_SClkControl_SOURCE_PCLK
op_or
id|PM3RD_SClkControl_ENABLE
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_read_dac_reg
r_static
r_int
r_int
id|pm3fb_read_dac_reg
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|r
)paren
(brace
id|DASSERT
c_func
(paren
(paren
id|l_fb_info-&gt;vIOBase
op_ne
(paren
r_int
r_char
op_star
)paren
(paren
op_minus
l_int|1
)paren
)paren
comma
l_string|&quot;l_fb_info-&gt;vIOBase mapped in read dac reg&bslash;n&quot;
)paren
suffix:semicolon
id|PM3_SET_INDEX
c_func
(paren
id|r
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3RD_IndexedData
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Calculating various clock parameter */
DECL|function|pm3fb_CalculateClock
r_static
r_int
r_int
id|pm3fb_CalculateClock
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|reqclock
comma
multiline_comment|/* In kHz units */
r_int
r_int
id|refclock
comma
multiline_comment|/* In kHz units */
r_int
r_char
op_star
id|prescale
comma
multiline_comment|/* ClkPreScale */
r_int
r_char
op_star
id|feedback
comma
multiline_comment|/* ClkFeedBackScale */
r_int
r_char
op_star
id|postscale
multiline_comment|/* ClkPostScale */
)paren
(brace
r_int
id|f
comma
id|pre
comma
id|post
suffix:semicolon
r_int
r_int
id|freq
suffix:semicolon
r_int
id|freqerr
op_assign
l_int|1000
suffix:semicolon
r_int
r_int
id|actualclock
op_assign
l_int|0
suffix:semicolon
id|DTRACE
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
l_int|1
suffix:semicolon
id|f
OL
l_int|256
suffix:semicolon
id|f
op_increment
)paren
(brace
r_for
c_loop
(paren
id|pre
op_assign
l_int|1
suffix:semicolon
id|pre
OL
l_int|256
suffix:semicolon
id|pre
op_increment
)paren
(brace
r_for
c_loop
(paren
id|post
op_assign
l_int|0
suffix:semicolon
id|post
OL
l_int|5
suffix:semicolon
id|post
op_increment
)paren
(brace
id|freq
op_assign
(paren
(paren
l_int|2
op_star
id|refclock
op_star
id|f
)paren
op_div
(paren
id|pre
op_star
(paren
l_int|1
op_lshift
id|post
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reqclock
OG
id|freq
op_minus
id|freqerr
)paren
op_logical_and
(paren
id|reqclock
OL
id|freq
op_plus
id|freqerr
)paren
)paren
(brace
id|freqerr
op_assign
(paren
id|reqclock
OG
id|freq
)paren
ques
c_cond
id|reqclock
op_minus
id|freq
suffix:colon
id|freq
op_minus
id|reqclock
suffix:semicolon
op_star
id|feedback
op_assign
id|f
suffix:semicolon
op_star
id|prescale
op_assign
id|pre
suffix:semicolon
op_star
id|postscale
op_assign
id|post
suffix:semicolon
id|actualclock
op_assign
id|freq
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
(paren
id|actualclock
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_Shiftbpp
r_static
r_int
id|pm3fb_Shiftbpp
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|depth
comma
r_int
id|v
)paren
(brace
id|DTRACE
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
(paren
id|v
op_rshift
l_int|4
)paren
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
r_return
(paren
id|v
op_rshift
l_int|3
)paren
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
(paren
id|v
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %ld&bslash;n&quot;
comma
id|depth
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_Unshiftbpp
r_static
r_int
id|pm3fb_Unshiftbpp
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_int
id|depth
comma
r_int
id|v
)paren
(brace
id|DTRACE
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|8
suffix:colon
r_return
(paren
id|v
op_lshift
l_int|4
)paren
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
r_return
(paren
id|v
op_lshift
l_int|3
)paren
suffix:semicolon
r_case
l_int|32
suffix:colon
r_return
(paren
id|v
op_lshift
l_int|2
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %ld&bslash;n&quot;
comma
id|depth
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_mapIO
r_static
r_void
id|pm3fb_mapIO
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|DTRACE
suffix:semicolon
id|l_fb_info-&gt;vIOBase
op_assign
id|ioremap
c_func
(paren
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;pIOBase
comma
id|PM3_REGS_SIZE
)paren
suffix:semicolon
id|l_fb_info-&gt;v_fb
op_assign
id|ioremap
c_func
(paren
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;p_fb
comma
id|l_fb_info-&gt;fb_size
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;IO mapping : IOBase %lx / %lx, fb %lx / %lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;pIOBase
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;vIOBase
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;p_fb
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;v_fb
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_unmapIO
r_static
r_void
id|pm3fb_unmapIO
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|DTRACE
suffix:semicolon
id|iounmap
c_func
(paren
id|l_fb_info-&gt;vIOBase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|l_fb_info-&gt;v_fb
)paren
suffix:semicolon
id|l_fb_info-&gt;vIOBase
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|l_fb_info-&gt;v_fb
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#if defined(PM3FB_MASTER_DEBUG) &amp;&amp; (PM3FB_MASTER_DEBUG &gt;= 2)
DECL|function|pm3fb_show_cur_mode
r_static
r_void
id|pm3fb_show_cur_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3Aperture0: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3Aperture0
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3Aperture1: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3Aperture1
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3ByAperture1Mode: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ByAperture1Mode
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3ByAperture2Mode: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ByAperture2Mode
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3ChipConfig: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ChipConfig
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3FIFODis: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3FIFODis
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3HTotal: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HTotal
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3HbEnd: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HbEnd
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3HgEnd: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HgEnd
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3HsEnd: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HsEnd
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3HsStart: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HsStart
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3MemBypassWriteMask: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3MemBypassWriteMask
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_IndexControl: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3RD_IndexControl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3ScreenBase: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ScreenBase
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3ScreenStride: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ScreenStride
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VClkCtl: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VClkCtl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VTotal: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VTotal
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VbEnd: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VbEnd
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VideoControl: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VideoControl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VsEnd: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VsEnd
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3VsStart: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3VsStart
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_ColorFormat: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_DACControl: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DACControl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_DClk0FeedbackScale: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0FeedbackScale
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_DClk0PostScale: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0PostScale
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_DClk0PreScale: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0PreScale
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;[not set] PM3RD_IndexControl: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_IndexControl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_MiscControl: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_MiscControl
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_PixelSize: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_SyncControl: %ld&bslash;n&quot;
comma
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_SyncControl
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* defined(PM3FB_MASTER_DEBUG) &amp;&amp; (PM3FB_MASTER_DEBUG &gt;= 2) */
DECL|function|pm3fb_show_cur_timing
r_static
r_void
id|pm3fb_show_cur_timing
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|u16
id|subvendor
comma
id|subdevice
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|pci_read_config_word
(paren
id|l_fb_info-&gt;dev
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|subvendor
)paren
)paren
op_logical_and
(paren
op_logical_neg
id|pci_read_config_word
(paren
id|l_fb_info-&gt;dev
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|subdevice
)paren
)paren
)paren
(brace
multiline_comment|/* well, nothing... */
)brace
r_else
(brace
id|subvendor
op_assign
id|subdevice
op_assign
(paren
id|u16
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;pm3fb: memory timings for board #%ld (subvendor: 0x%hx, subdevice: 0x%hx)&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
comma
id|subvendor
comma
id|subdevice
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot; PM3LocalMemCaps: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemCaps
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot; PM3LocalMemTimings: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemTimings
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot; PM3LocalMemControl: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemControl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot; PM3LocalMemRefresh: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemRefresh
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot; PM3LocalMemPowerDown: 0x%08x&bslash;n&quot;
comma
id|PM3_READ_REG
c_func
(paren
id|PM3LocalMemPowerDown
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* write the mode to registers */
DECL|function|pm3fb_write_mode
r_static
r_void
id|pm3fb_write_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
r_char
id|tempsync
op_assign
l_int|0x00
comma
id|tempmisc
op_assign
l_int|0x00
suffix:semicolon
id|DTRACE
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3MemBypassWriteMask
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Aperture0
comma
l_int|0x00000000
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Aperture1
comma
l_int|0x00000000
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FIFODis
comma
l_int|0x00000007
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3HTotal
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par-&gt;htotal
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3HsEnd
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par-&gt;hsend
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3HsStart
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par
op_member_access_from_pointer
id|hsstart
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3HbEnd
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par-&gt;hbend
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3HgEnd
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par-&gt;hbend
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ScreenStride
comma
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
id|l_fb_info-&gt;current_par-&gt;stride
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VTotal
comma
id|l_fb_info-&gt;current_par-&gt;vtotal
op_minus
l_int|1
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VsEnd
comma
id|l_fb_info-&gt;current_par-&gt;vsend
op_minus
l_int|1
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VsStart
comma
id|l_fb_info-&gt;current_par-&gt;vsstart
op_minus
l_int|1
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VbEnd
comma
id|l_fb_info-&gt;current_par-&gt;vbend
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture1Mode
comma
id|PM3ByApertureMode_PIXELSIZE_8BIT
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture2Mode
comma
id|PM3ByApertureMode_PIXELSIZE_8BIT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
macro_line|#ifndef __BIG_ENDIAN
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture1Mode
comma
id|PM3ByApertureMode_PIXELSIZE_16BIT
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture2Mode
comma
id|PM3ByApertureMode_PIXELSIZE_16BIT
)paren
suffix:semicolon
macro_line|#else
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture1Mode
comma
id|PM3ByApertureMode_PIXELSIZE_16BIT
op_or
id|PM3ByApertureMode_BYTESWAP_BADC
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture2Mode
comma
id|PM3ByApertureMode_PIXELSIZE_16BIT
op_or
id|PM3ByApertureMode_BYTESWAP_BADC
)paren
suffix:semicolon
macro_line|#endif /* ! __BIG_ENDIAN */
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
macro_line|#ifndef __BIG_ENDIAN
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture1Mode
comma
id|PM3ByApertureMode_PIXELSIZE_32BIT
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture2Mode
comma
id|PM3ByApertureMode_PIXELSIZE_32BIT
)paren
suffix:semicolon
macro_line|#else
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture1Mode
comma
id|PM3ByApertureMode_PIXELSIZE_32BIT
op_or
id|PM3ByApertureMode_BYTESWAP_DCBA
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ByAperture2Mode
comma
id|PM3ByApertureMode_PIXELSIZE_32BIT
op_or
id|PM3ByApertureMode_BYTESWAP_DCBA
)paren
suffix:semicolon
macro_line|#endif /* ! __BIG_ENDIAN */
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %d&bslash;n&quot;
comma
id|l_fb_info-&gt;current_par-&gt;depth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Oxygen VX1 - it appears that setting PM3VideoControl and&n;&t; * then PM3RD_SyncControl to the same SYNC settings undoes&n;&t; * any net change - they seem to xor together.  Only set the&n;&t; * sync options in PM3RD_SyncControl.  --rmk&n;&t; */
(brace
r_int
r_int
id|video
op_assign
id|l_fb_info-&gt;current_par-&gt;video
suffix:semicolon
id|video
op_and_assign
op_complement
(paren
id|PM3VideoControl_HSYNC_MASK
op_or
id|PM3VideoControl_VSYNC_MASK
)paren
suffix:semicolon
id|video
op_or_assign
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VideoControl
comma
id|video
)paren
suffix:semicolon
)brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VClkCtl
comma
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3VClkCtl
)paren
op_amp
l_int|0xFFFFFFFC
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ScreenBase
comma
id|l_fb_info-&gt;current_par-&gt;base
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ChipConfig
comma
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3ChipConfig
)paren
op_amp
l_int|0xFFFFFFFD
)paren
)paren
suffix:semicolon
(brace
r_int
r_char
id|m
suffix:semicolon
multiline_comment|/* ClkPreScale */
r_int
r_char
id|n
suffix:semicolon
multiline_comment|/* ClkFeedBackScale */
r_int
r_char
id|p
suffix:semicolon
multiline_comment|/* ClkPostScale */
(paren
r_void
)paren
id|pm3fb_CalculateClock
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;pixclock
comma
id|PM3_REF_CLOCK
comma
op_amp
id|m
comma
op_amp
id|n
comma
op_amp
id|p
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Pixclock: %d, Pre: %d, Feedback: %d, Post: %d&bslash;n&quot;
comma
id|l_fb_info-&gt;current_par-&gt;pixclock
comma
(paren
r_int
)paren
id|m
comma
(paren
r_int
)paren
id|n
comma
(paren
r_int
)paren
id|p
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_DClk0PreScale
comma
id|m
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_DClk0FeedbackScale
comma
id|n
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_DClk0PostScale
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;   PM3_WRITE_DAC_REG(PM3RD_IndexControl, 0x00);&n;&t; */
multiline_comment|/*&n;&t;   PM3_SLOW_WRITE_REG(PM3RD_IndexControl, 0x00);&n;&t; */
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;current_par-&gt;video
op_amp
id|PM3VideoControl_HSYNC_MASK
)paren
op_eq
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
)paren
id|tempsync
op_or_assign
id|PM3RD_SyncControl_HSYNC_ACTIVE_HIGH
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;current_par-&gt;video
op_amp
id|PM3VideoControl_VSYNC_MASK
)paren
op_eq
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
)paren
id|tempsync
op_or_assign
id|PM3RD_SyncControl_VSYNC_ACTIVE_HIGH
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_SyncControl
comma
id|tempsync
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3RD_SyncControl: %d&bslash;n&quot;
comma
id|tempsync
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flatpanel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
(brace
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_DACControl
comma
id|PM3RD_DACControl_BLANK_PEDESTAL_ENABLE
)paren
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3VSConfiguration
comma
l_int|0x06
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
l_int|0x5a00
comma
l_int|1
op_lshift
l_int|14
)paren
suffix:semicolon
multiline_comment|/* black magic... */
id|tempmisc
op_assign
id|PM3RD_MiscControl_VSB_OUTPUT_ENABLE
suffix:semicolon
)brace
r_else
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_DACControl
comma
l_int|0x00
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
comma
id|PM3RD_PixelSize_8_BIT_PIXELS
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
comma
id|PM3RD_ColorFormat_CI8_COLOR
op_or
id|PM3RD_ColorFormat_COLOR_ORDER_BLUE_LOW
)paren
suffix:semicolon
id|tempmisc
op_or_assign
id|PM3RD_MiscControl_HIGHCOLOR_RES_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
comma
id|PM3RD_PixelSize_16_BIT_PIXELS
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
comma
id|PM3RD_ColorFormat_4444_COLOR
op_or
id|PM3RD_ColorFormat_COLOR_ORDER_BLUE_LOW
op_or
id|PM3RD_ColorFormat_LINEAR_COLOR_EXT_ENABLE
)paren
suffix:semicolon
id|tempmisc
op_or_assign
id|PM3RD_MiscControl_DIRECTCOLOR_ENABLE
op_or
id|PM3RD_MiscControl_HIGHCOLOR_RES_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
comma
id|PM3RD_PixelSize_16_BIT_PIXELS
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
comma
id|PM3RD_ColorFormat_5551_FRONT_COLOR
op_or
id|PM3RD_ColorFormat_COLOR_ORDER_BLUE_LOW
op_or
id|PM3RD_ColorFormat_LINEAR_COLOR_EXT_ENABLE
)paren
suffix:semicolon
id|tempmisc
op_or_assign
id|PM3RD_MiscControl_DIRECTCOLOR_ENABLE
op_or
id|PM3RD_MiscControl_HIGHCOLOR_RES_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
comma
id|PM3RD_PixelSize_16_BIT_PIXELS
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
comma
id|PM3RD_ColorFormat_565_FRONT_COLOR
op_or
id|PM3RD_ColorFormat_COLOR_ORDER_BLUE_LOW
op_or
id|PM3RD_ColorFormat_LINEAR_COLOR_EXT_ENABLE
)paren
suffix:semicolon
id|tempmisc
op_or_assign
id|PM3RD_MiscControl_DIRECTCOLOR_ENABLE
op_or
id|PM3RD_MiscControl_HIGHCOLOR_RES_ENABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_PixelSize
comma
id|PM3RD_PixelSize_32_BIT_PIXELS
)paren
suffix:semicolon
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_ColorFormat
comma
id|PM3RD_ColorFormat_8888_COLOR
op_or
id|PM3RD_ColorFormat_COLOR_ORDER_BLUE_LOW
)paren
suffix:semicolon
id|tempmisc
op_or_assign
id|PM3RD_MiscControl_DIRECTCOLOR_ENABLE
op_or
id|PM3RD_MiscControl_HIGHCOLOR_RES_ENABLE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_MiscControl
comma
id|tempmisc
)paren
suffix:semicolon
id|PM3_SHOW_CUR_MODE
suffix:semicolon
)brace
DECL|function|pm3fb_read_mode
r_static
r_void
id|pm3fb_read_mode
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_struct
id|pm3fb_par
op_star
id|curpar
)paren
(brace
r_int
r_int
id|pixsize1
comma
id|pixsize2
comma
id|clockused
suffix:semicolon
r_int
r_int
id|pre
comma
id|feedback
comma
id|post
suffix:semicolon
id|DTRACE
suffix:semicolon
id|clockused
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3VClkCtl
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|clockused
)paren
(brace
r_case
l_int|3
suffix:colon
id|pre
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk3PreScale
)paren
suffix:semicolon
id|feedback
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk3FeedbackScale
)paren
suffix:semicolon
id|post
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk3PostScale
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;DClk3 parameter: Pre: %ld, Feedback: %ld, Post: %ld ; giving pixclock: %ld&bslash;n&quot;
comma
id|pre
comma
id|feedback
comma
id|post
comma
id|PM3_SCALE_TO_CLOCK
c_func
(paren
id|pre
comma
id|feedback
comma
id|post
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|pre
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk2PreScale
)paren
suffix:semicolon
id|feedback
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk2FeedbackScale
)paren
suffix:semicolon
id|post
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk2PostScale
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;DClk2 parameter: Pre: %ld, Feedback: %ld, Post: %ld ; giving pixclock: %ld&bslash;n&quot;
comma
id|pre
comma
id|feedback
comma
id|post
comma
id|PM3_SCALE_TO_CLOCK
c_func
(paren
id|pre
comma
id|feedback
comma
id|post
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|pre
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk1PreScale
)paren
suffix:semicolon
id|feedback
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk1FeedbackScale
)paren
suffix:semicolon
id|post
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk1PostScale
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;DClk1 parameter: Pre: %ld, Feedback: %ld, Post: %ld ; giving pixclock: %ld&bslash;n&quot;
comma
id|pre
comma
id|feedback
comma
id|post
comma
id|PM3_SCALE_TO_CLOCK
c_func
(paren
id|pre
comma
id|feedback
comma
id|post
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|pre
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0PreScale
)paren
suffix:semicolon
id|feedback
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0FeedbackScale
)paren
suffix:semicolon
id|post
op_assign
id|PM3_READ_DAC_REG
c_func
(paren
id|PM3RD_DClk0PostScale
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;DClk0 parameter: Pre: %ld, Feedback: %ld, Post: %ld ; giving pixclock: %ld&bslash;n&quot;
comma
id|pre
comma
id|feedback
comma
id|post
comma
id|PM3_SCALE_TO_CLOCK
c_func
(paren
id|pre
comma
id|feedback
comma
id|post
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|pre
op_assign
id|feedback
op_assign
id|post
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unknowk D clock used : %ld&bslash;n&quot;
comma
id|clockused
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|curpar-&gt;pixclock
op_assign
id|PM3_SCALE_TO_CLOCK
c_func
(paren
id|pre
comma
id|feedback
comma
id|post
)paren
suffix:semicolon
id|pixsize1
op_assign
id|PM3ByApertureMode_PIXELSIZE_MASK
op_amp
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3ByAperture1Mode
)paren
)paren
suffix:semicolon
id|pixsize2
op_assign
id|PM3ByApertureMode_PIXELSIZE_MASK
op_amp
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3ByAperture2Mode
)paren
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|pixsize1
op_eq
id|pixsize2
)paren
comma
l_string|&quot;pixsize the same in both aperture&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pixsize1
op_amp
id|PM3ByApertureMode_PIXELSIZE_32BIT
)paren
id|curpar-&gt;depth
op_assign
l_int|32
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pixsize1
op_amp
id|PM3ByApertureMode_PIXELSIZE_16BIT
)paren
(brace
id|curpar-&gt;depth
op_assign
l_int|16
suffix:semicolon
)brace
r_else
id|curpar-&gt;depth
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* not sure if I need to add one on the next ; it give better result with */
id|curpar-&gt;htotal
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|curpar-&gt;depth
comma
l_int|1
op_plus
id|PM3_READ_REG
c_func
(paren
id|PM3HTotal
)paren
)paren
suffix:semicolon
id|curpar-&gt;hsend
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|curpar-&gt;depth
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HsEnd
)paren
)paren
suffix:semicolon
id|curpar-&gt;hsstart
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|curpar-&gt;depth
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HsStart
)paren
)paren
suffix:semicolon
id|curpar-&gt;hbend
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|curpar-&gt;depth
comma
id|PM3_READ_REG
c_func
(paren
id|PM3HbEnd
)paren
)paren
suffix:semicolon
id|curpar-&gt;stride
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|curpar-&gt;depth
comma
id|PM3_READ_REG
c_func
(paren
id|PM3ScreenStride
)paren
)paren
suffix:semicolon
id|curpar-&gt;vtotal
op_assign
l_int|1
op_plus
id|PM3_READ_REG
c_func
(paren
id|PM3VTotal
)paren
suffix:semicolon
id|curpar-&gt;vsend
op_assign
l_int|1
op_plus
id|PM3_READ_REG
c_func
(paren
id|PM3VsEnd
)paren
suffix:semicolon
id|curpar-&gt;vsstart
op_assign
l_int|1
op_plus
id|PM3_READ_REG
c_func
(paren
id|PM3VsStart
)paren
suffix:semicolon
id|curpar-&gt;vbend
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3VbEnd
)paren
suffix:semicolon
id|curpar-&gt;video
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3VideoControl
)paren
suffix:semicolon
id|curpar-&gt;base
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3ScreenBase
)paren
suffix:semicolon
id|curpar-&gt;width
op_assign
id|curpar-&gt;htotal
op_minus
id|curpar-&gt;hbend
suffix:semicolon
multiline_comment|/* make virtual == displayed resolution */
id|curpar-&gt;height
op_assign
id|curpar-&gt;vtotal
op_minus
id|curpar-&gt;vbend
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Found : %d * %d, %d Khz, stride is %08x&bslash;n&quot;
comma
id|curpar-&gt;width
comma
id|curpar-&gt;height
comma
id|curpar-&gt;pixclock
comma
id|curpar-&gt;stride
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_size_memory
r_static
r_int
r_int
id|pm3fb_size_memory
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
r_int
r_int
id|memsize
op_assign
l_int|0
comma
id|tempBypass
comma
id|i
comma
id|temp1
comma
id|temp2
suffix:semicolon
id|u16
id|subvendor
comma
id|subdevice
suffix:semicolon
id|pm3fb_timing_result
id|ptr
suffix:semicolon
id|DTRACE
suffix:semicolon
id|l_fb_info-&gt;fb_size
op_assign
l_int|64
op_star
l_int|1024
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* pm3 aperture always 64 MB */
id|pm3fb_mapIO
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* temporary map IO */
id|DASSERT
c_func
(paren
(paren
id|l_fb_info-&gt;vIOBase
op_ne
l_int|NULL
)paren
comma
l_string|&quot;IO successfully mapped before mem detect&bslash;n&quot;
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_ne
l_int|NULL
)paren
comma
l_string|&quot;FB successfully mapped before mem detect&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* card-specific stuff, *before* accessing *any* FB memory */
r_if
c_cond
(paren
(paren
op_logical_neg
id|pci_read_config_word
(paren
id|l_fb_info-&gt;dev
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|subvendor
)paren
)paren
op_logical_and
(paren
op_logical_neg
id|pci_read_config_word
(paren
id|l_fb_info-&gt;dev
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|subdevice
)paren
)paren
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
id|l_fb_info-&gt;board_type
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cardbase
(braket
id|i
)braket
dot
id|cardname
(braket
l_int|0
)braket
)paren
op_logical_and
op_logical_neg
(paren
id|l_fb_info-&gt;board_type
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|cardbase
(braket
id|i
)braket
dot
id|subvendor
op_eq
id|subvendor
)paren
op_logical_and
(paren
id|cardbase
(braket
id|i
)braket
dot
id|subdevice
op_eq
id|subdevice
)paren
op_logical_and
(paren
id|cardbase
(braket
id|i
)braket
dot
id|func
op_eq
id|PCI_FUNC
c_func
(paren
id|l_fb_info-&gt;dev-&gt;devfn
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Card #%ld is an %s&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
comma
id|cardbase
(braket
id|i
)braket
dot
id|cardname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cardbase
(braket
id|i
)braket
dot
id|specific_setup
)paren
id|cardbase
(braket
id|i
)braket
dot
id|specific_setup
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
id|l_fb_info-&gt;board_type
op_assign
id|i
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|l_fb_info-&gt;board_type
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Card #%ld is an unknown 0x%04x / 0x%04x&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
comma
id|subvendor
comma
id|subdevice
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pm3fb: Error: pci_read_config_word failed, board #%ld&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|printtimings
)paren
id|pm3fb_show_cur_timing
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* card-specific setup is done, we preserve the final&n;           memory timing for future reference */
r_if
c_cond
(paren
(paren
id|ptr
op_assign
id|pm3fb_preserve_memory_timings
c_func
(paren
id|l_fb_info
)paren
)paren
op_eq
id|pm3fb_timing_problem
)paren
(brace
multiline_comment|/* memory timings were wrong ! oops.... */
r_return
l_int|0
suffix:semicolon
)brace
id|tempBypass
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3MemBypassWriteMask
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3MemBypassWriteMask was: 0x%08lx&bslash;n&quot;
comma
id|tempBypass
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3MemBypassWriteMask
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
multiline_comment|/* pm3 split up memory, replicates, and do a lot of nasty stuff IMHO ;-) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef KERNEL_2_2
macro_line|#ifdef MUST_BYTESWAP
id|writel
c_func
(paren
id|__swab32
c_func
(paren
id|i
op_star
l_int|0x00345678
)paren
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|writel
c_func
(paren
id|i
op_star
l_int|0x00345678
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|mb
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MUST_BYTESWAP
id|temp1
op_assign
id|__swab32
c_func
(paren
id|readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|temp1
op_assign
id|readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif&t;/* KERNEL_2_2 */
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
id|fb_writel
c_func
(paren
id|i
op_star
l_int|0x00345678
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|temp1
op_assign
id|fb_readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif /* KERNEL_2_4 or KERNEL_2_5 */
multiline_comment|/* Let&squot;s check for wrapover, write will fail at 16MB boundary */
r_if
c_cond
(paren
id|temp1
op_eq
(paren
id|i
op_star
l_int|0x00345678
)paren
)paren
id|memsize
op_assign
id|i
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;First detect pass already got %ld MB&bslash;n&quot;
comma
id|memsize
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memsize
op_eq
id|i
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Clear first 32MB ; 0 is 0, no need to byteswap */
id|writel
c_func
(paren
l_int|0x0000000
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|32
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef KERNEL_2_2
macro_line|#ifdef MUST_BYTESWAP
id|writel
c_func
(paren
id|__swab32
c_func
(paren
id|i
op_star
l_int|0x00345678
)paren
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|writel
c_func
(paren
id|i
op_star
l_int|0x00345678
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|mb
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MUST_BYTESWAP
id|temp1
op_assign
id|__swab32
c_func
(paren
id|readl
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
)paren
suffix:semicolon
id|temp2
op_assign
id|__swab32
c_func
(paren
id|readl
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
(paren
id|i
op_minus
l_int|32
)paren
op_star
l_int|1048576
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|temp1
op_assign
id|readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
id|temp2
op_assign
id|readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
(paren
id|i
op_minus
l_int|32
)paren
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* KERNEL_2_2 */
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
id|fb_writel
c_func
(paren
id|i
op_star
l_int|0x00345678
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|temp1
op_assign
id|fb_readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
id|temp2
op_assign
id|fb_readl
c_func
(paren
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
(paren
id|i
op_minus
l_int|32
)paren
op_star
l_int|1048576
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif /* KERNEL_2_4 or KERNEL_2_5 */
r_if
c_cond
(paren
(paren
id|temp1
op_eq
(paren
id|i
op_star
l_int|0x00345678
)paren
)paren
op_logical_and
(paren
id|temp2
op_eq
l_int|0
)paren
)paren
multiline_comment|/* different value, different RAM... */
id|memsize
op_assign
id|i
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
)brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Second detect pass got %ld MB&bslash;n&quot;
comma
id|memsize
op_plus
l_int|1
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3MemBypassWriteMask
comma
id|tempBypass
)paren
suffix:semicolon
id|pm3fb_unmapIO
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
id|memsize
op_assign
l_int|1048576
op_star
(paren
id|memsize
op_plus
l_int|1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Returning 0x%08lx bytes&bslash;n&quot;
comma
id|memsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
op_logical_and
(paren
(paren
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
op_star
l_int|1048576
)paren
op_ne
id|memsize
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: mismatch between probed (%ld MB) and specified (%hd MB) memory size, using SPECIFIED !&bslash;n&quot;
comma
id|memsize
comma
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
suffix:semicolon
id|memsize
op_assign
l_int|1048576
op_star
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
suffix:semicolon
)brace
id|l_fb_info-&gt;fb_size
op_assign
id|memsize
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_eq
id|pm3fb_timing_retry
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: retrying memory timings check&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm3fb_try_memory_timings
c_func
(paren
id|l_fb_info
)paren
op_eq
id|pm3fb_timing_problem
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
(paren
id|memsize
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_clear_memory
r_static
r_void
id|pm3fb_clear_memory
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
id|u32
id|cc
)paren
(brace
r_int
id|i
suffix:semicolon
id|DTRACE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|l_fb_info-&gt;fb_size
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* clear entire FB memory to black */
(brace
macro_line|#ifdef KERNEL_2_2
macro_line|#ifdef MUST_BYTESWAP
id|writel
c_func
(paren
id|__swab32
c_func
(paren
id|cc
)paren
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|writel
c_func
(paren
id|cc
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
id|fb_writel
c_func
(paren
id|cc
comma
(paren
id|l_fb_info-&gt;v_fb
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|pm3fb_clear_colormap
r_static
r_void
id|pm3fb_clear_colormap
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_char
id|r
comma
r_int
r_char
id|g
comma
r_int
r_char
id|b
)paren
(brace
r_int
id|i
suffix:semicolon
id|DTRACE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* fill color map with white */
id|pm3fb_set_color
c_func
(paren
id|l_fb_info
comma
id|i
comma
id|r
comma
id|g
comma
id|b
)paren
suffix:semicolon
)brace
multiline_comment|/* common initialisation */
DECL|function|pm3fb_common_init
r_static
r_void
id|pm3fb_common_init
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|DTRACE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Initializing board #%ld @ %lx&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
comma
(paren
r_int
r_int
)paren
id|l_fb_info
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|l_fb_info-&gt;gen.info.modename
comma
id|permedia3_name
)paren
suffix:semicolon
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
dot
id|scrollmode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* SCROLL_YNOMOVE; */
multiline_comment|/* 0 means &quot;let fbcon choose&quot; */
id|l_fb_info-&gt;gen.parsize
op_assign
r_sizeof
(paren
r_struct
id|pm3fb_par
)paren
suffix:semicolon
id|l_fb_info-&gt;gen.info.changevar
op_assign
l_int|NULL
suffix:semicolon
id|l_fb_info-&gt;gen.info.node
op_assign
id|B_FREE
suffix:semicolon
id|l_fb_info-&gt;gen.info.fbops
op_assign
op_amp
id|pm3fb_ops
suffix:semicolon
id|l_fb_info-&gt;gen.info.disp
op_assign
op_amp
(paren
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontn
(braket
id|l_fb_info-&gt;board_num
)braket
(braket
l_int|0
)braket
)paren
id|strcpy
c_func
(paren
id|l_fb_info-&gt;gen.info.fontname
comma
id|fontn
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
suffix:semicolon
id|l_fb_info-&gt;gen.info.switch_con
op_assign
op_amp
id|fbgen_switch
suffix:semicolon
id|l_fb_info-&gt;gen.info.updatevar
op_assign
op_amp
id|fbgen_update_var
suffix:semicolon
multiline_comment|/* */
id|l_fb_info-&gt;gen.info.flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|pm3fb_mapIO
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
id|pm3fb_clear_memory
c_func
(paren
id|l_fb_info
comma
l_int|0
)paren
suffix:semicolon
id|pm3fb_clear_colormap
c_func
(paren
id|l_fb_info
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
(paren
r_void
)paren
id|fbgen_get_var
c_func
(paren
op_amp
(paren
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
dot
id|var
comma
op_minus
l_int|1
comma
op_amp
id|l_fb_info-&gt;gen.info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|depth
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
multiline_comment|/* override mode-defined depth */
(brace
id|pm3fb_encode_depth
c_func
(paren
op_amp
(paren
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
dot
id|var
comma
id|depth
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
suffix:semicolon
(paren
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
dot
id|var.bits_per_pixel
op_assign
id|depth2bpp
c_func
(paren
id|depth
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
suffix:semicolon
)brace
(paren
r_void
)paren
id|fbgen_do_set_var
c_func
(paren
op_amp
(paren
id|disp
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
dot
id|var
comma
l_int|1
comma
op_amp
id|l_fb_info-&gt;gen
)paren
suffix:semicolon
id|fbgen_set_disp
c_func
(paren
op_minus
l_int|1
comma
op_amp
id|l_fb_info-&gt;gen
)paren
suffix:semicolon
id|do_install_cmap
c_func
(paren
l_int|0
comma
op_amp
id|l_fb_info-&gt;gen.info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|l_fb_info-&gt;gen.info
)paren
OL
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t register framebuffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|PM3_WRITE_DAC_REG
c_func
(paren
id|PM3RD_CursorMode
comma
id|PM3RD_CursorMode_CURSOR_DISABLE
)paren
suffix:semicolon
id|PM3_SHOW_CUR_MODE
suffix:semicolon
id|pm3fb_write_mode
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;fb%d: %s, using %uK of video memory (%s)&bslash;n&quot;
comma
id|GET_FB_IDX
c_func
(paren
id|l_fb_info-&gt;gen.info.node
)paren
comma
id|permedia3_name
comma
(paren
id|u32
)paren
(paren
id|l_fb_info-&gt;fb_size
op_rshift
l_int|10
)paren
comma
id|cardbase
(braket
id|l_fb_info-&gt;board_type
)braket
dot
id|cardname
)paren
suffix:semicolon
)brace
multiline_comment|/* **************************************************** */
multiline_comment|/* ***** accelerated permedia3-specific functions ***** */
multiline_comment|/* **************************************************** */
macro_line|#ifdef PM3FB_USE_ACCEL
DECL|function|pm3fb_wait_pm3
r_static
r_void
id|pm3fb_wait_pm3
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|DTRACE
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FilterMode
comma
id|PM3FilterModeSync
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Sync
comma
l_int|0
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
r_while
c_loop
(paren
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3OutFIFOWords
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|PM3_READ_REG
c_func
(paren
id|PM3OutputFifo
)paren
)paren
op_ne
id|PM3Sync_Tag
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_init_engine
r_static
r_void
id|pm3fb_init_engine
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
)paren
(brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FilterMode
comma
id|PM3FilterModeSync
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StatisticMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DeltaMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RasterizerMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ScissorMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LineStippleMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3AreaStippleMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3GIDMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DepthMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StencilMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StencilData
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ColorDDAMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCoordMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureIndexMode0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureIndexMode1
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureReadMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LUTMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureFilterMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCompositeMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureApplicationMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCompositeColorMode1
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCompositeAlphaMode1
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCompositeColorMode0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3TextureCompositeAlphaMode0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FogMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ChromaTestMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3AlphaTestMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3AntialiasMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3YUVMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3AlphaBlendColorMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3AlphaBlendAlphaMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DitherMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LogicalOpMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RouterMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Window
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3SpanColorMask
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3XBias
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3YBias
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DeltaControl
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3BitMaskPattern
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBDestReadEnables
comma
id|PM3FBDestReadEnables_E
c_func
(paren
l_int|0xff
)paren
op_or
id|PM3FBDestReadEnables_R
c_func
(paren
l_int|0xff
)paren
op_or
id|PM3FBDestReadEnables_ReferenceAlpha
c_func
(paren
l_int|0xff
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBDestReadBufferAddr0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBDestReadBufferOffset0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBDestReadBufferWidth0
comma
id|PM3FBDestReadBufferWidth_Width
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|current_par
op_member_access_from_pointer
id|width
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBDestReadMode
comma
id|PM3FBDestReadMode_ReadEnable
op_or
id|PM3FBDestReadMode_Enable0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSourceReadBufferAddr
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSourceReadBufferOffset
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSourceReadBufferWidth
comma
id|PM3FBSourceReadBufferWidth_Width
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|current_par
op_member_access_from_pointer
id|width
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSourceReadMode
comma
id|PM3FBSourceReadMode_Blocking
op_or
id|PM3FBSourceReadMode_ReadEnable
)paren
suffix:semicolon
(brace
r_int
r_int
id|rm
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3PixelSize
comma
id|PM3PixelSize_GLOBAL_8BIT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3PixelSize
comma
id|PM3PixelSize_GLOBAL_16BIT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3PixelSize
comma
id|PM3PixelSize_GLOBAL_32BIT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %d&bslash;n&quot;
comma
id|l_fb_info-&gt;current_par-&gt;depth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RasterizerMode
comma
id|rm
)paren
suffix:semicolon
)brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSoftwareWriteMask
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBHardwareWriteMask
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBWriteMode
comma
id|PM3FBWriteMode_WriteEnable
op_or
id|PM3FBWriteMode_OpaqueSpan
op_or
id|PM3FBWriteMode_Enable0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBWriteBufferAddr0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBWriteBufferOffset0
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBWriteBufferWidth0
comma
id|PM3FBWriteBufferWidth_Width
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|current_par
op_member_access_from_pointer
id|width
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3SizeOfFramebuffer
comma
l_int|0x0
)paren
suffix:semicolon
(brace
r_int
r_int
id|sofb
op_assign
(paren
l_int|8UL
op_star
id|l_fb_info-&gt;fb_size
)paren
op_div
(paren
(paren
id|depth2bpp
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
)paren
op_star
id|l_fb_info-&gt;current_par-&gt;width
)paren
suffix:semicolon
multiline_comment|/* size in lines of FB */
r_if
c_cond
(paren
id|sofb
OG
l_int|4095
)paren
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3SizeOfFramebuffer
comma
l_int|4095
)paren
suffix:semicolon
r_else
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3SizeOfFramebuffer
comma
id|sofb
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DitherMode
comma
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|2
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DitherMode
comma
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3DitherMode
comma
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|0
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %d&bslash;n&quot;
comma
id|l_fb_info-&gt;current_par-&gt;depth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3dXDom
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3dXSub
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3dY
comma
(paren
l_int|1
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StartXDom
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StartXSub
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3StartY
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3Count
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* Disable LocalBuffer. better safe than sorry */
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LBDestReadMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LBDestReadEnables
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LBSourceReadMode
comma
l_int|0x0
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3LBWriteMode
comma
l_int|0x0
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
macro_line|#ifdef FBCON_HAS_CFB32
DECL|function|pm3fb_cfb32_clear
r_static
r_void
id|pm3fb_cfb32_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
multiline_comment|/* block fills in 32bpp are hard, but in low res (width &lt;= 1600 :-)&n;&t;   we can use 16bpp operations, but not if NoWriteMask is on (SDRAM)  */
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;current_par-&gt;width
OG
l_int|1600
)paren
op_logical_or
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
)paren
(brace
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|PM3_WAIT
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBBlockColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3PixelSize
comma
id|PM3PixelSize_GLOBAL_16BIT
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBWriteBufferWidth0
comma
id|PM3FBWriteBufferWidth_Width
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|current_par
op_member_access_from_pointer
id|width
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
op_lshift
l_int|1
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
op_lshift
l_int|1
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBWriteBufferWidth0
comma
id|PM3FBWriteBufferWidth_Width
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|current_par
op_member_access_from_pointer
id|width
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3PixelSize
comma
id|PM3PixelSize_GLOBAL_32BIT
)paren
suffix:semicolon
)brace
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfb32_clear_margins
r_static
r_void
id|pm3fb_cfb32_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_int
id|sx
comma
id|sy
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* right margin */
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* bottom margin */
id|c
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
(brace
multiline_comment|/* right margin top-&gt;bottom */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
(paren
id|p-&gt;var.xoffset
op_plus
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p
op_member_access_from_pointer
id|var
dot
id|yoffset
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* bottom margin left -&gt; right */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|p-&gt;var.xoffset
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p-&gt;var.yoffset
op_plus
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
op_minus
id|sy
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
macro_line|#endif /* FBCON_HAS_CFB32 */
macro_line|#ifdef FBCON_HAS_CFB16
DECL|function|pm3fb_cfb16_clear
r_static
r_void
id|pm3fb_cfb16_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|c
op_assign
id|c
op_or
(paren
id|c
op_lshift
l_int|16
)paren
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBBlockColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfb16_clear_margins
r_static
r_void
id|pm3fb_cfb16_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_int
id|sx
comma
id|sy
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* right margin */
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* bottom margin */
id|c
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)braket
suffix:semicolon
id|c
op_assign
id|c
op_or
(paren
id|c
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
(brace
multiline_comment|/* right margin top-&gt;bottom */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBBlockColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
(paren
id|p-&gt;var.xoffset
op_plus
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p
op_member_access_from_pointer
id|var
dot
id|yoffset
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
)paren
)paren
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* bottom margin left -&gt; right */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBBlockColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|p-&gt;var.xoffset
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p-&gt;var.yoffset
op_plus
id|sy
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
op_minus
id|sy
)paren
)paren
)paren
suffix:semicolon
r_else
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
op_minus
id|sy
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
macro_line|#endif /* FBCON_HAS_CFB16 */
macro_line|#ifdef FBCON_HAS_CFB8
DECL|function|pm3fb_cfb8_clear
r_static
r_void
id|pm3fb_cfb8_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|8
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfb8_clear_margins
r_static
r_void
id|pm3fb_cfb8_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_int
id|sx
comma
id|sy
suffix:semicolon
id|u32
id|c
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|conp-&gt;vc_cols
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* right margin */
id|sy
op_assign
id|conp-&gt;vc_rows
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* bottom margin */
id|c
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|8
suffix:semicolon
id|c
op_or_assign
id|c
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bottom_only
)paren
(brace
multiline_comment|/* right margin top-&gt;bottom */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
(paren
id|p-&gt;var.xoffset
op_plus
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p
op_member_access_from_pointer
id|var
dot
id|yoffset
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
op_minus
id|sx
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* bottom margin left -&gt; right */
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|c
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|p-&gt;var.xoffset
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|p-&gt;var.yoffset
op_plus
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|p-&gt;var.xres
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|p-&gt;var.yres
op_minus
id|sy
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
macro_line|#endif /* FBCON_HAS_CFB8 */
macro_line|#if defined(FBCON_HAS_CFB8) || defined(FBCON_HAS_CFB16) || defined(FBCON_HAS_CFB32)
DECL|function|pm3fb_cfbX_bmove
r_static
r_void
id|pm3fb_cfbX_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
r_int
id|x_align
comma
id|o_x
comma
id|o_y
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|dx
op_assign
id|dx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|dy
op_assign
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|o_x
op_assign
id|sx
op_minus
id|dx
suffix:semicolon
multiline_comment|/*(sx &gt; dx ) ? (sx - dx) : (dx - sx); */
id|o_y
op_assign
id|sy
op_minus
id|dy
suffix:semicolon
multiline_comment|/*(sy &gt; dy ) ? (sy - dy) : (dy - sy); */
id|x_align
op_assign
(paren
id|sx
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UserScissorEnable
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
id|PM3Config2D_Blocking
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ScissorMinXY
comma
(paren
(paren
id|dy
op_amp
l_int|0x0fff
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|dx
op_amp
l_int|0x0fff
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ScissorMaxXY
comma
(paren
(paren
(paren
id|dy
op_plus
id|height
)paren
op_amp
l_int|0x0fff
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|dx
op_plus
id|width
)paren
op_amp
l_int|0x0fff
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FBSourceReadBufferOffset
comma
id|PM3FBSourceReadBufferOffset_XOffset
c_func
(paren
id|o_x
)paren
op_or
id|PM3FBSourceReadBufferOffset_YOffset
c_func
(paren
id|o_y
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|dx
op_minus
id|x_align
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|dy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
(paren
(paren
id|sx
OG
id|dx
)paren
ques
c_cond
id|PM3Render2D_XPositive
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|sy
OG
id|dy
)paren
ques
c_cond
id|PM3Render2D_YPositive
suffix:colon
l_int|0
)paren
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
id|PM3Render2D_FBSourceReadEnable
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|width
op_plus
id|x_align
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|height
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfbX_putc
r_static
r_void
id|pm3fb_cfbX_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u8
op_star
id|cdat
comma
id|asx
op_assign
l_int|0
comma
id|asy
op_assign
l_int|0
comma
id|o_x
op_assign
l_int|0
comma
id|o_y
op_assign
l_int|0
suffix:semicolon
id|u32
id|fgx
comma
id|bgx
comma
id|ldat
suffix:semicolon
r_int
id|sx
comma
id|sy
comma
id|i
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|depth2bpp
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
op_eq
l_int|16
)paren
id|fgx
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
r_else
id|fgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|PM3_COLOR
c_func
(paren
id|fgx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|depth2bpp
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
op_eq
l_int|16
)paren
id|bgx
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
r_else
id|bgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
)braket
suffix:semicolon
id|PM3_COLOR
c_func
(paren
id|bgx
)paren
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
op_or
id|PM3Config2D_OpaqueSpan
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|fgx
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FillBackgroundColor
comma
id|bgx
)paren
suffix:semicolon
multiline_comment|/* WARNING : adress select X need to specify 8 bits for fontwidth &lt;= 8 */
multiline_comment|/* and 16 bits for fontwidth &lt;= 16 */
multiline_comment|/* same in _putcs, same for Y and fontheight */
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|asx
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|asx
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* look OK */
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|asy
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|asy
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* look OK */
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|32
)paren
id|asy
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* look OK */
id|sx
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|sy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|o_x
op_assign
(paren
l_int|8
op_minus
(paren
id|sx
op_amp
l_int|0x7
)paren
)paren
op_amp
l_int|0x7
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|o_x
op_assign
(paren
l_int|16
op_minus
(paren
id|sx
op_amp
l_int|0xF
)paren
)paren
op_amp
l_int|0xF
suffix:semicolon
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|o_y
op_assign
(paren
l_int|8
op_minus
(paren
id|sy
op_amp
l_int|0x7
)paren
)paren
op_amp
l_int|0x7
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|o_y
op_assign
(paren
l_int|16
op_minus
(paren
id|sy
op_amp
l_int|0xF
)paren
)paren
op_amp
l_int|0xF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|32
)paren
id|o_y
op_assign
(paren
l_int|32
op_minus
(paren
id|sy
op_amp
l_int|0x1F
)paren
)paren
op_amp
l_int|0x1F
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3AreaStippleMode
comma
(paren
id|o_x
op_lshift
l_int|7
)paren
op_or
(paren
id|o_y
op_lshift
l_int|12
)paren
op_or
multiline_comment|/* x_offset, y_offset in pattern */
(paren
l_int|1
op_lshift
l_int|18
)paren
op_or
multiline_comment|/* BE */
l_int|1
op_or
(paren
id|asx
op_lshift
l_int|1
)paren
op_or
(paren
id|asy
op_lshift
l_int|4
)paren
op_or
multiline_comment|/* address select x/y */
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
multiline_comment|/* OpaqueSpan */
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
(brace
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|c
op_amp
id|p-&gt;charmask
)paren
op_star
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|PM3_WAIT
c_func
(paren
l_int|2
op_plus
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* assume fontheight &lt;= 32 */
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|ldat
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* assume fontwidth &lt;= 16 ATM */
id|ldat
op_assign
(paren
(paren
op_star
id|cdat
op_increment
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|ldat
op_or_assign
op_star
id|cdat
op_increment
suffix:semicolon
)brace
id|PM3_WRITE_REG
c_func
(paren
id|AreaStipplePattern_indexed
c_func
(paren
id|i
)paren
comma
id|ldat
)paren
suffix:semicolon
)brace
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_AreaStippleEnable
op_or
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|fontheight
c_func
(paren
id|p
)paren
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfbX_putcs
r_static
r_void
id|pm3fb_cfbX_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|u8
op_star
id|cdat
comma
id|asx
op_assign
l_int|0
comma
id|asy
op_assign
l_int|0
comma
id|o_x
op_assign
l_int|0
comma
id|o_y
op_assign
l_int|0
suffix:semicolon
id|u32
id|fgx
comma
id|bgx
comma
id|ldat
suffix:semicolon
r_int
id|sx
comma
id|sy
comma
id|i
comma
id|j
suffix:semicolon
id|u16
id|sc
suffix:semicolon
id|DTRACE
suffix:semicolon
id|sc
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|sc
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|depth2bpp
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
op_eq
l_int|16
)paren
id|fgx
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|sc
)paren
)braket
suffix:semicolon
r_else
id|fgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_fgcol
c_func
(paren
id|p
comma
id|sc
)paren
)braket
suffix:semicolon
id|PM3_COLOR
c_func
(paren
id|fgx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|sc
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|depth2bpp
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
op_eq
l_int|16
)paren
id|bgx
op_assign
(paren
(paren
id|u16
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|sc
)paren
)braket
suffix:semicolon
r_else
id|bgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|p-&gt;dispsw_data
)paren
(braket
id|attr_bgcol
c_func
(paren
id|p
comma
id|sc
)paren
)braket
suffix:semicolon
id|PM3_COLOR
c_func
(paren
id|bgx
)paren
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0x3
)paren
)paren
op_or
multiline_comment|/* Ox3 is GXcopy */
id|PM3Config2D_FBWriteEnable
op_or
id|PM3Config2D_OpaqueSpan
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3ForegroundColor
comma
id|fgx
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3FillBackgroundColor
comma
id|bgx
)paren
suffix:semicolon
multiline_comment|/* WARNING : adress select X need to specify 8 bits for fontwidth &lt;= 8 */
multiline_comment|/* and 16 bits for fontwidth &lt;= 16 */
multiline_comment|/* same in _putc, same for Y and fontheight */
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|asx
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|asx
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* look OK */
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|asy
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|asy
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* look OK */
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|32
)paren
id|asy
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* look OK */
id|sy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|o_y
op_assign
(paren
l_int|8
op_minus
(paren
id|sy
op_amp
l_int|0x7
)paren
)paren
op_amp
l_int|0x7
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|o_y
op_assign
(paren
l_int|16
op_minus
(paren
id|sy
op_amp
l_int|0xF
)paren
)paren
op_amp
l_int|0xF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontheight
c_func
(paren
id|p
)paren
op_le
l_int|32
)paren
id|o_y
op_assign
(paren
l_int|32
op_minus
(paren
id|sy
op_amp
l_int|0x1F
)paren
)paren
op_amp
l_int|0x1F
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|count
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sc
op_assign
id|scr_readw
c_func
(paren
id|s
op_plus
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|sc
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
(paren
id|sc
op_amp
id|p-&gt;charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|sx
op_assign
(paren
id|xx
op_plus
id|j
)paren
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
id|o_x
op_assign
(paren
l_int|8
op_minus
(paren
id|sx
op_amp
l_int|0x7
)paren
)paren
op_amp
l_int|0x7
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|16
)paren
id|o_x
op_assign
(paren
l_int|16
op_minus
(paren
id|sx
op_amp
l_int|0xF
)paren
)paren
op_amp
l_int|0xF
suffix:semicolon
id|PM3_WAIT
c_func
(paren
l_int|3
op_plus
id|fontheight
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3AreaStippleMode
comma
(paren
id|o_x
op_lshift
l_int|7
)paren
op_or
(paren
id|o_y
op_lshift
l_int|12
)paren
op_or
multiline_comment|/* x_offset, y_offset in pattern */
(paren
l_int|1
op_lshift
l_int|18
)paren
op_or
multiline_comment|/* BE */
l_int|1
op_or
(paren
id|asx
op_lshift
l_int|1
)paren
op_or
(paren
id|asy
op_lshift
l_int|4
)paren
op_or
multiline_comment|/* address select x/y */
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
suffix:semicolon
multiline_comment|/* OpaqueSpan */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* assume fontheight &lt;= 32 */
r_if
c_cond
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_le
l_int|8
)paren
(brace
id|ldat
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* assume fontwidth &lt;= 16 ATM */
id|ldat
op_assign
(paren
(paren
op_star
id|cdat
op_increment
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|ldat
op_or_assign
op_star
id|cdat
op_increment
suffix:semicolon
)brace
id|PM3_WRITE_REG
c_func
(paren
id|AreaStipplePattern_indexed
c_func
(paren
id|i
)paren
comma
id|ldat
)paren
suffix:semicolon
)brace
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|sx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|sy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_AreaStippleEnable
op_or
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|fontheight
c_func
(paren
id|p
)paren
)paren
)paren
)paren
suffix:semicolon
)brace
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_cfbX_revc
r_static
r_void
id|pm3fb_cfbX_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|p-&gt;fb_info
suffix:semicolon
id|xx
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|yy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSoftwareWriteMask
comma
l_int|0x0F0F0F0F
)paren
suffix:semicolon
r_else
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBHardwareWriteMask
comma
l_int|0x0F0F0F0F
)paren
suffix:semicolon
)brace
id|PM3_WAIT
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Config2D
comma
id|PM3Config2D_UseConstantSource
op_or
id|PM3Config2D_ForegroundROPEnable
op_or
(paren
id|PM3Config2D_ForegroundROP
c_func
(paren
l_int|0xa
)paren
)paren
op_or
multiline_comment|/* Oxa is GXinvert */
id|PM3Config2D_FBDestReadEnable
op_or
id|PM3Config2D_FBWriteEnable
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3RectanglePosition
comma
(paren
id|PM3RectanglePosition_XOffset
c_func
(paren
id|xx
)paren
)paren
op_or
(paren
id|PM3RectanglePosition_YOffset
c_func
(paren
id|yy
)paren
)paren
)paren
suffix:semicolon
id|PM3_WRITE_REG
c_func
(paren
id|PM3Render2D
comma
id|PM3Render2D_XPositive
op_or
id|PM3Render2D_YPositive
op_or
id|PM3Render2D_Operation_Normal
op_or
id|PM3Render2D_SpanOperation
op_or
(paren
id|PM3Render2D_Width
c_func
(paren
id|fontwidth
c_func
(paren
id|p
)paren
)paren
)paren
op_or
(paren
id|PM3Render2D_Height
c_func
(paren
id|fontheight
c_func
(paren
id|p
)paren
)paren
)paren
)paren
suffix:semicolon
id|pm3fb_wait_pm3
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|l_fb_info-&gt;memt.caps
op_amp
id|PM3LocalMemCaps_NoWriteMask
)paren
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBSoftwareWriteMask
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
r_else
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3FBHardwareWriteMask
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* FBCON_HAS_CFB8 || FBCON_HAS_CFB16 || FBCON_HAS_CFB32 */
macro_line|#endif /* PM3FB_USE_ACCEL */
multiline_comment|/* *********************************** */
multiline_comment|/* ***** pre-init board(s) setup ***** */
multiline_comment|/* *********************************** */
DECL|function|pm3fb_mode_setup
r_static
r_void
id|pm3fb_mode_setup
c_func
(paren
r_char
op_star
id|mode
comma
r_int
r_int
id|board_num
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
id|board_num
)braket
)paren
suffix:semicolon
r_struct
id|pm3fb_par
op_star
id|l_fb_par
op_assign
op_amp
(paren
id|current_par
(braket
id|board_num
)braket
)paren
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|current_par_valid
(braket
id|board_num
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mode
comma
l_string|&quot;current&quot;
comma
l_int|7
)paren
)paren
(brace
id|l_fb_info-&gt;use_current
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* default w/ OpenFirmware */
)brace
r_else
(brace
r_while
c_loop
(paren
(paren
id|mode_base
(braket
id|i
)braket
dot
id|name
(braket
l_int|0
)braket
)paren
op_logical_and
(paren
op_logical_neg
id|current_par_valid
(braket
id|board_num
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|strncmp
(paren
id|mode
comma
id|mode_base
(braket
id|i
)braket
dot
id|name
comma
id|strlen
c_func
(paren
id|mode_base
(braket
id|i
)braket
dot
id|name
)paren
)paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|l_fb_par
comma
op_amp
(paren
id|mode_base
(braket
id|i
)braket
dot
id|user_mode
)paren
comma
r_sizeof
(paren
r_struct
id|pm3fb_par
)paren
)paren
suffix:semicolon
id|current_par_valid
(braket
id|board_num
)braket
op_assign
l_int|1
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Mode set to %s&bslash;n&quot;
comma
id|mode_base
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
id|DASSERT
c_func
(paren
id|current_par_valid
(braket
id|board_num
)braket
comma
l_string|&quot;Valid mode on command line&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|pm3fb_pciid_setup
r_static
r_void
id|pm3fb_pciid_setup
c_func
(paren
r_char
op_star
id|pciid
comma
r_int
r_int
id|board_num
)paren
(brace
r_int
id|l_bus
op_assign
op_minus
l_int|1
comma
id|l_slot
op_assign
op_minus
l_int|1
comma
id|l_func
op_assign
op_minus
l_int|1
suffix:semicolon
r_char
op_star
id|next
suffix:semicolon
r_if
c_cond
(paren
id|pciid
)paren
(brace
id|l_bus
op_assign
id|simple_strtoul
c_func
(paren
id|pciid
comma
op_amp
id|next
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_logical_and
(paren
id|next
(braket
l_int|0
)braket
op_eq
l_char|&squot;:&squot;
)paren
)paren
(brace
id|pciid
op_assign
id|next
op_plus
l_int|1
suffix:semicolon
id|l_slot
op_assign
id|simple_strtoul
c_func
(paren
id|pciid
comma
op_amp
id|next
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_logical_and
(paren
id|next
(braket
l_int|0
)braket
op_eq
l_char|&squot;:&squot;
)paren
)paren
(brace
id|pciid
op_assign
id|next
op_plus
l_int|1
suffix:semicolon
id|l_func
op_assign
id|simple_strtoul
c_func
(paren
id|pciid
comma
(paren
r_char
op_star
op_star
)paren
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l_bus
op_ge
l_int|0
)paren
op_logical_and
(paren
id|l_slot
op_ge
l_int|0
)paren
op_logical_and
(paren
id|l_func
op_ge
l_int|0
)paren
)paren
(brace
id|bus
(braket
id|board_num
)braket
op_assign
id|l_bus
suffix:semicolon
id|slot
(braket
id|board_num
)braket
op_assign
id|l_slot
suffix:semicolon
id|func
(braket
id|board_num
)braket
op_assign
id|l_func
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Board #%ld will be PciId: %hd:%hd:%hd&bslash;n&quot;
comma
id|board_num
comma
id|l_bus
comma
id|l_slot
comma
id|l_func
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Invalid PciId: %hd:%hd:%hd for board #%ld&bslash;n&quot;
comma
id|l_bus
comma
id|l_slot
comma
id|l_func
comma
id|board_num
)paren
suffix:semicolon
)brace
)brace
DECL|function|pm3fb_font_setup
r_static
r_void
id|pm3fb_font_setup
c_func
(paren
r_char
op_star
id|lf
comma
r_int
r_int
id|board_num
)paren
(brace
r_int
r_int
id|lfs
op_assign
id|strlen
c_func
(paren
id|lf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lfs
OG
(paren
id|PM3_FONTNAME_SIZE
op_minus
l_int|1
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Fontname %s too long&bslash;n&quot;
comma
id|lf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|fontn
(braket
id|board_num
)braket
comma
id|lf
comma
id|lfs
)paren
suffix:semicolon
id|fontn
(braket
id|board_num
)braket
(braket
id|lfs
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
DECL|function|pm3fb_bootdepth_setup
r_static
r_void
id|pm3fb_bootdepth_setup
c_func
(paren
r_char
op_star
id|bds
comma
r_int
r_int
id|board_num
)paren
(brace
r_int
r_int
id|bd
op_assign
id|simple_strtoul
c_func
(paren
id|bds
comma
(paren
r_char
op_star
op_star
)paren
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|depth_supported
c_func
(paren
id|bd
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: ignoring invalid depth %s for board #%ld&bslash;n&quot;
comma
id|bds
comma
id|board_num
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|depth
(braket
id|board_num
)braket
op_assign
id|bd
suffix:semicolon
)brace
DECL|function|pm3fb_forcesize_setup
r_static
r_void
id|pm3fb_forcesize_setup
c_func
(paren
r_char
op_star
id|bds
comma
r_int
r_int
id|board_num
)paren
(brace
r_int
r_int
id|bd
op_assign
id|simple_strtoul
c_func
(paren
id|bds
comma
(paren
r_char
op_star
op_star
)paren
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bd
OG
l_int|64
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: ignoring invalid memory size %s for board #%ld&bslash;n&quot;
comma
id|bds
comma
id|board_num
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|forcesize
(braket
id|board_num
)braket
op_assign
id|bd
suffix:semicolon
)brace
DECL|function|pm3fb_boardnum_setup
r_static
r_char
op_star
id|pm3fb_boardnum_setup
c_func
(paren
r_char
op_star
id|options
comma
r_int
r_int
op_star
id|bn
)paren
(brace
r_char
op_star
id|next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|CHAR_IS_NUM
c_func
(paren
id|options
(braket
l_int|0
)braket
)paren
)paren
)paren
(brace
(paren
op_star
id|bn
)paren
op_assign
l_int|0
suffix:semicolon
r_return
(paren
id|options
)paren
suffix:semicolon
)brace
(paren
op_star
id|bn
)paren
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|next
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_logical_and
(paren
id|next
(braket
l_int|0
)braket
op_eq
l_char|&squot;:&squot;
)paren
op_logical_and
(paren
(paren
op_star
id|bn
)paren
op_ge
l_int|0
)paren
op_logical_and
(paren
(paren
op_star
id|bn
)paren
op_le
id|PM3_MAX_BOARD
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Board_num seen as %ld&bslash;n&quot;
comma
(paren
op_star
id|bn
)paren
)paren
suffix:semicolon
r_return
(paren
id|next
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
(paren
op_star
id|bn
)paren
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Board_num default to %ld&bslash;n&quot;
comma
(paren
op_star
id|bn
)paren
)paren
suffix:semicolon
r_return
(paren
id|options
)paren
suffix:semicolon
)brace
)brace
DECL|function|pm3fb_real_setup
r_static
r_void
id|pm3fb_real_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|next
suffix:semicolon
r_int
r_int
id|i
comma
id|bn
suffix:semicolon
r_struct
id|pm3fb_info
op_star
id|l_fb_info
suffix:semicolon
id|DTRACE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Options : %s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
id|i
)braket
)paren
suffix:semicolon
id|memset
c_func
(paren
id|l_fb_info
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pm3fb_info
)paren
)paren
suffix:semicolon
id|l_fb_info-&gt;gen.fbhw
op_assign
op_amp
id|pm3fb_switch
suffix:semicolon
id|l_fb_info-&gt;board_num
op_assign
id|i
suffix:semicolon
id|current_par_valid
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|slot
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|func
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|bus
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|disable
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|noaccel
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|fontn
(braket
id|i
)braket
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|depth
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|l_fb_info-&gt;current_par
op_assign
op_amp
(paren
id|current_par
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* eat up prefix pm3fb and whatever is used as separator i.e. :,= */
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;pm3fb&quot;
comma
l_int|5
)paren
)paren
(brace
id|options
op_add_assign
l_int|5
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
op_star
id|options
)paren
op_eq
l_char|&squot;,&squot;
)paren
op_logical_or
(paren
(paren
op_star
id|options
)paren
op_eq
l_char|&squot;:&squot;
)paren
op_logical_or
(paren
(paren
op_star
id|options
)paren
op_eq
l_char|&squot;=&squot;
)paren
)paren
id|options
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|options
)paren
(brace
id|bn
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|next
op_assign
id|strchr
c_func
(paren
id|options
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
(brace
(paren
op_star
id|next
)paren
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|next
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;mode:&quot;
comma
l_int|5
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|5
comma
op_amp
id|bn
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Setting mode for board #%ld&bslash;n&quot;
comma
id|bn
)paren
suffix:semicolon
id|pm3fb_mode_setup
c_func
(paren
id|options
comma
id|bn
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;off:&quot;
comma
l_int|4
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|4
comma
op_amp
id|bn
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Disabling board #%ld&bslash;n&quot;
comma
id|bn
)paren
suffix:semicolon
id|disable
(braket
id|bn
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
multiline_comment|/* disable everything */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
id|disable
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;disable:&quot;
comma
l_int|8
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|8
comma
op_amp
id|bn
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Disabling board #%ld&bslash;n&quot;
comma
id|bn
)paren
suffix:semicolon
id|disable
(braket
id|bn
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;pciid:&quot;
comma
l_int|6
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|6
comma
op_amp
id|bn
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Setting PciID for board #%ld&bslash;n&quot;
comma
id|bn
)paren
suffix:semicolon
id|pm3fb_pciid_setup
c_func
(paren
id|options
comma
id|bn
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;noaccel:&quot;
comma
l_int|8
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|8
comma
op_amp
id|bn
)paren
suffix:semicolon
id|noaccel
(braket
id|bn
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|5
comma
op_amp
id|bn
)paren
suffix:semicolon
id|pm3fb_font_setup
c_func
(paren
id|options
comma
id|bn
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;depth:&quot;
comma
l_int|6
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|6
comma
op_amp
id|bn
)paren
suffix:semicolon
id|pm3fb_bootdepth_setup
c_func
(paren
id|options
comma
id|bn
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;printtimings&quot;
comma
l_int|12
)paren
)paren
(brace
id|printtimings
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;flatpanel:&quot;
comma
l_int|10
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|10
comma
op_amp
id|bn
)paren
suffix:semicolon
id|flatpanel
(braket
id|bn
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;forcesize:&quot;
comma
l_int|10
)paren
)paren
(brace
id|options
op_assign
id|pm3fb_boardnum_setup
c_func
(paren
id|options
op_plus
l_int|10
comma
op_amp
id|bn
)paren
suffix:semicolon
id|pm3fb_forcesize_setup
c_func
(paren
id|options
comma
id|bn
)paren
suffix:semicolon
)brace
id|options
op_assign
id|next
suffix:semicolon
)brace
)brace
multiline_comment|/* ********************************************** */
multiline_comment|/* ***** framebuffer API standard functions ***** */
multiline_comment|/* ********************************************** */
DECL|function|pm3fb_encode_fix
r_static
r_int
id|pm3fb_encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm3fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
suffix:semicolon
id|DTRACE
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|permedia3_name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;p_fb
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|l_fb_info-&gt;fb_size
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;pIOBase
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|PM3_REGS_SIZE
suffix:semicolon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|fix-&gt;accel
op_assign
id|FB_ACCEL_3DLABS_PERMEDIA3
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NONE
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;visual
op_assign
(paren
id|p-&gt;depth
op_eq
l_int|8
)paren
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
r_if
c_cond
(paren
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
id|fix-&gt;line_length
op_assign
id|l_fb_info-&gt;current_par-&gt;width
op_star
id|depth2ByPP
c_func
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
suffix:semicolon
r_else
id|fix-&gt;line_length
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|64
op_div
id|depth2bpp
c_func
(paren
id|p-&gt;depth
)paren
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_decode_var
r_static
r_int
id|pm3fb_decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm3fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
suffix:semicolon
r_struct
id|pm3fb_par
id|temp_p
suffix:semicolon
id|u32
id|xres
suffix:semicolon
id|DTRACE
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|var
op_ne
l_int|NULL
)paren
comma
l_string|&quot;fb_var_screeninfo* not NULL&quot;
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|p
op_ne
l_int|NULL
)paren
comma
l_string|&quot;pm3fb_par* not NULL&quot;
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|l_fb_info
op_ne
l_int|NULL
)paren
comma
l_string|&quot;pm3fb_info* not NULL&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|temp_p
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pm3fb_par
)paren
)paren
suffix:semicolon
id|temp_p.width
op_assign
(paren
id|var-&gt;xres_virtual
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|temp_p.height
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|depth_supported
c_func
(paren
id|var-&gt;bits_per_pixel
)paren
)paren
)paren
multiline_comment|/* round unsupported up to a multiple of 8 */
id|temp_p.depth
op_assign
id|depth2bpp
c_func
(paren
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_else
id|temp_p.depth
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|temp_p.depth
op_assign
(paren
id|temp_p.depth
OG
l_int|32
)paren
ques
c_cond
l_int|32
suffix:colon
id|temp_p.depth
suffix:semicolon
multiline_comment|/* max 32 */
id|temp_p.depth
op_assign
(paren
id|temp_p.depth
op_eq
l_int|24
)paren
ques
c_cond
l_int|32
suffix:colon
id|temp_p.depth
suffix:semicolon
multiline_comment|/* 24 unsupported, round-up to 32 */
r_if
c_cond
(paren
(paren
id|temp_p.depth
op_eq
l_int|16
)paren
op_logical_and
(paren
id|var-&gt;red.length
op_eq
l_int|5
)paren
op_logical_and
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
op_logical_and
(paren
id|var-&gt;blue.length
op_eq
l_int|5
)paren
)paren
id|temp_p.depth
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* RGBA 5551 is stored as depth 15 */
r_if
c_cond
(paren
(paren
id|temp_p.depth
op_eq
l_int|16
)paren
op_logical_and
(paren
id|var-&gt;red.length
op_eq
l_int|4
)paren
op_logical_and
(paren
id|var-&gt;green.length
op_eq
l_int|4
)paren
op_logical_and
(paren
id|var-&gt;blue.length
op_eq
l_int|4
)paren
)paren
id|temp_p.depth
op_assign
l_int|12
suffix:semicolon
multiline_comment|/* RGBA 4444  is stored as depth 12 */
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;xres: %d, yres: %d, vxres: %d, vyres: %d ; xoffset:%d, yoffset: %d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;yres_virtual
comma
id|var-&gt;xoffset
comma
id|var-&gt;yoffset
)paren
suffix:semicolon
id|xres
op_assign
(paren
id|var-&gt;xres
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
suffix:semicolon
r_if
c_cond
(paren
id|temp_p.width
OL
id|xres
op_plus
id|var-&gt;xoffset
)paren
id|temp_p.width
op_assign
id|xres
op_plus
id|var-&gt;xoffset
suffix:semicolon
r_if
c_cond
(paren
id|temp_p.height
OL
id|var-&gt;yres
op_plus
id|var-&gt;yoffset
)paren
id|temp_p.height
op_assign
id|var-&gt;yres
op_plus
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|temp_p.width
OG
l_int|2048
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;virtual width not supported: %u&bslash;n&quot;
comma
id|temp_p.width
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres
OL
l_int|200
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;height not supported: %u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|var-&gt;yres
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp_p.height
template_param
l_int|4095
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;virtual height not supported: %u&bslash;n&quot;
comma
id|temp_p.height
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|depth_supported
c_func
(paren
id|temp_p.depth
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;depth not supported: %u&bslash;n&quot;
comma
id|temp_p.depth
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|temp_p.width
op_star
id|temp_p.height
op_star
id|depth2ByPP
c_func
(paren
id|temp_p.depth
)paren
)paren
OG
id|l_fb_info-&gt;fb_size
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;no memory for screen (%ux%ux%u)&bslash;n&quot;
comma
id|temp_p.width
comma
id|temp_p.height
comma
id|temp_p.depth
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|var-&gt;pixclock
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;right_margin
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;hsync_len
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;left_margin
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;lower_margin
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;vsync_len
)paren
op_logical_or
(paren
op_logical_neg
id|var-&gt;upper_margin
)paren
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|0
comma
id|done
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: refusing to use a likely wrong timing&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|mode_base
(braket
id|i
)braket
dot
id|user_mode.width
)paren
op_logical_and
op_logical_neg
id|done
)paren
(brace
r_if
c_cond
(paren
(paren
id|mode_base
(braket
id|i
)braket
dot
id|user_mode.width
op_eq
id|temp_p.width
)paren
op_logical_and
(paren
id|mode_base
(braket
id|i
)braket
dot
id|user_mode.height
op_eq
id|temp_p.height
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;pm3fb: using close match %s&bslash;n&quot;
comma
id|mode_base
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
id|temp_p
op_assign
id|mode_base
(braket
id|i
)braket
dot
id|user_mode
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|done
)paren
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp_p.pixclock
op_assign
id|PICOS2KHZ
c_func
(paren
id|var-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp_p.pixclock
OG
id|PM3_MAX_PIXCLOCK
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;pixclock too high (%uKHz)&bslash;n&quot;
comma
id|temp_p.pixclock
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
id|temp_p.hsstart
op_assign
id|var-&gt;right_margin
suffix:semicolon
id|temp_p.hsend
op_assign
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
suffix:semicolon
id|temp_p.hbend
op_assign
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|temp_p.htotal
op_assign
id|xres
op_plus
id|temp_p.hbend
suffix:semicolon
id|temp_p.vsstart
op_assign
id|var-&gt;lower_margin
suffix:semicolon
id|temp_p.vsend
op_assign
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
suffix:semicolon
id|temp_p.vbend
op_assign
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
suffix:semicolon
id|temp_p.vtotal
op_assign
id|var-&gt;yres
op_plus
id|temp_p.vbend
suffix:semicolon
id|temp_p.stride
op_assign
id|temp_p.width
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;Using %d * %d, %d Khz, stride is %08x&bslash;n&quot;
comma
id|temp_p.width
comma
id|temp_p.height
comma
id|temp_p.pixclock
comma
id|temp_p.stride
)paren
suffix:semicolon
id|temp_p.base
op_assign
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|temp_p.depth
comma
(paren
id|var-&gt;yoffset
op_star
id|xres
)paren
op_plus
id|var-&gt;xoffset
)paren
suffix:semicolon
id|temp_p.video
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|temp_p.video
op_or_assign
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
suffix:semicolon
r_else
id|temp_p.video
op_or_assign
id|PM3VideoControl_HSYNC_ACTIVE_LOW
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|temp_p.video
op_or_assign
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
suffix:semicolon
r_else
id|temp_p.video
op_or_assign
id|PM3VideoControl_VSYNC_ACTIVE_LOW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Interlaced mode not supported&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_DOUBLE
)paren
id|temp_p.video
op_or_assign
id|PM3VideoControl_LINE_DOUBLE_ON
suffix:semicolon
r_else
id|temp_p.video
op_or_assign
id|PM3VideoControl_LINE_DOUBLE_OFF
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;activate
op_eq
id|FB_ACTIVATE_NOW
)paren
id|temp_p.video
op_or_assign
id|PM3VideoControl_ENABLE
suffix:semicolon
r_else
(brace
id|temp_p.video
op_or_assign
id|PM3VideoControl_DISABLE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;PM3Video disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|temp_p.depth
)paren
(brace
r_case
l_int|8
suffix:colon
id|temp_p.video
op_or_assign
id|PM3VideoControl_PIXELSIZE_8BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
r_case
l_int|15
suffix:colon
r_case
l_int|16
suffix:colon
id|temp_p.video
op_or_assign
id|PM3VideoControl_PIXELSIZE_16BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|temp_p.video
op_or_assign
id|PM3VideoControl_PIXELSIZE_32BIT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
(paren
op_star
id|p
)paren
op_assign
id|temp_p
suffix:semicolon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
id|var-&gt;accel_flags
op_amp
id|FB_ACCELF_TEXT
)paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
op_assign
l_int|0
suffix:semicolon
r_else
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
op_assign
l_int|1
suffix:semicolon
macro_line|#endif /* PM3FB_USE_ACCEL */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_encode_depth
r_static
r_void
id|pm3fb_encode_depth
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|d
)paren
(brace
r_switch
c_cond
(paren
id|d
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|4
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|4
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|12
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|15
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported depth %ld&bslash;n&quot;
comma
id|d
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|pm3fb_encode_var
r_static
r_int
id|pm3fb_encode_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
suffix:semicolon
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|base
suffix:semicolon
id|DTRACE
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|var
op_ne
l_int|NULL
)paren
comma
l_string|&quot;fb_var_screeninfo* not NULL&quot;
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|p
op_ne
l_int|NULL
)paren
comma
l_string|&quot;pm3fb_par* not NULL&quot;
)paren
suffix:semicolon
id|DASSERT
c_func
(paren
(paren
id|info
op_ne
l_int|NULL
)paren
comma
l_string|&quot;fb_info_gen* not NULL&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|var
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|var-&gt;accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
macro_line|#endif /* PM3FB_USE_ACCEL */
id|var-&gt;xres_virtual
op_assign
id|p-&gt;width
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|p-&gt;height
suffix:semicolon
id|var-&gt;xres
op_assign
id|p-&gt;htotal
op_minus
id|p-&gt;hbend
suffix:semicolon
id|var-&gt;yres
op_assign
id|p-&gt;vtotal
op_minus
id|p-&gt;vbend
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;xres = %d, yres : %d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
)paren
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|p-&gt;hsstart
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|p-&gt;hsend
op_minus
id|p-&gt;hsstart
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|p-&gt;hbend
op_minus
id|p-&gt;hsend
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|p-&gt;vsstart
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|p-&gt;vsend
op_minus
id|p-&gt;vsstart
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|p-&gt;vbend
op_minus
id|p-&gt;vsend
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|depth2bpp
c_func
(paren
id|p-&gt;depth
)paren
suffix:semicolon
id|pm3fb_encode_depth
c_func
(paren
id|var
comma
id|p-&gt;depth
)paren
suffix:semicolon
id|base
op_assign
id|pm3fb_Unshiftbpp
c_func
(paren
id|l_fb_info
comma
id|p-&gt;depth
comma
id|p-&gt;base
)paren
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|base
op_mod
id|var-&gt;xres
suffix:semicolon
id|var-&gt;yoffset
op_assign
id|base
op_div
id|var-&gt;xres
suffix:semicolon
id|var-&gt;height
op_assign
id|var-&gt;width
op_assign
op_minus
l_int|1
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|KHZ2PICOS
c_func
(paren
id|p-&gt;pixclock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM3VideoControl_HSYNC_MASK
)paren
op_eq
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;video
op_amp
id|PM3VideoControl_VSYNC_MASK
)paren
op_eq
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;video
op_amp
id|PM3VideoControl_LINE_DOUBLE_ON
)paren
id|var-&gt;vmode
op_assign
id|FB_VMODE_DOUBLE
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_get_par
r_static
r_void
id|pm3fb_get_par
c_func
(paren
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
(brace
r_if
c_cond
(paren
id|l_fb_info-&gt;use_current
)paren
id|pm3fb_read_mode
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|l_fb_info-&gt;current_par
comma
op_amp
(paren
id|mode_base
(braket
l_int|0
)braket
dot
id|user_mode
)paren
comma
r_sizeof
(paren
r_struct
id|pm3fb_par
)paren
)paren
suffix:semicolon
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
op_assign
l_int|1
suffix:semicolon
)brace
op_star
(paren
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
)paren
op_assign
op_star
(paren
id|l_fb_info-&gt;current_par
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_set_par
r_static
r_void
id|pm3fb_set_par
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|DTRACE
suffix:semicolon
op_star
(paren
id|l_fb_info-&gt;current_par
)paren
op_assign
op_star
(paren
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
)paren
suffix:semicolon
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
op_assign
l_int|1
suffix:semicolon
id|pm3fb_write_mode
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
macro_line|#ifdef PM3FB_USE_ACCEL
id|pm3fb_init_engine
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
macro_line|#endif /* PM3FB_USE_ACCEL */
)brace
DECL|function|pm3fb_set_color
r_static
r_void
id|pm3fb_set_color
c_func
(paren
r_struct
id|pm3fb_info
op_star
id|l_fb_info
comma
r_int
r_char
id|regno
comma
r_int
r_char
id|r
comma
r_int
r_char
id|g
comma
r_int
r_char
id|b
)paren
(brace
id|DTRACE
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RD_PaletteWriteAddress
comma
id|regno
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RD_PaletteData
comma
id|r
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RD_PaletteData
comma
id|g
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3RD_PaletteData
comma
id|b
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_getcolreg
r_static
r_int
id|pm3fb_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
op_star
id|red
op_assign
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_lshift
l_int|8
op_or
id|l_fb_info
op_member_access_from_pointer
id|palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_lshift
l_int|8
op_or
id|l_fb_info
op_member_access_from_pointer
id|palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_lshift
l_int|8
op_or
id|l_fb_info
op_member_access_from_pointer
id|palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|transp
op_lshift
l_int|8
op_or
id|l_fb_info
op_member_access_from_pointer
id|palette
(braket
id|regno
)braket
dot
id|transp
suffix:semicolon
)brace
r_return
(paren
id|regno
OG
l_int|255
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_setcolreg
r_static
r_int
id|pm3fb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|12
suffix:colon
id|l_fb_info-&gt;cmap.cmap12
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xf000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xf000
)paren
op_rshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xf000
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|l_fb_info-&gt;cmap.cmap15
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|l_fb_info-&gt;cmap.cmap16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xf800
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xfc00
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|l_fb_info-&gt;cmap.cmap32
(braket
id|regno
)braket
op_assign
(paren
(paren
(paren
id|u32
)paren
id|transp
op_amp
l_int|0xff00
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;bad depth %u&bslash;n&quot;
comma
id|l_fb_info-&gt;current_par-&gt;depth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|regno
OL
l_int|256
)paren
(brace
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
op_rshift
l_int|8
suffix:semicolon
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
op_rshift
l_int|8
suffix:semicolon
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
op_rshift
l_int|8
suffix:semicolon
id|l_fb_info-&gt;palette
(braket
id|regno
)braket
dot
id|transp
op_assign
id|transp
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;current_par-&gt;depth
op_eq
l_int|8
)paren
id|pm3fb_set_color
c_func
(paren
id|l_fb_info
comma
id|regno
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
(paren
id|regno
OG
l_int|255
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_blank
r_static
r_int
id|pm3fb_blank
c_func
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|video
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
r_return
(paren
l_int|1
)paren
suffix:semicolon
id|video
op_assign
id|l_fb_info-&gt;current_par-&gt;video
suffix:semicolon
multiline_comment|/*&n;&t; * Oxygen VX1 - it appears that setting PM3VideoControl and&n;&t; * then PM3RD_SyncControl to the same SYNC settings undoes&n;&t; * any net change - they seem to xor together.  Only set the&n;&t; * sync options in PM3RD_SyncControl.  --rmk&n;&t; */
id|video
op_and_assign
op_complement
(paren
id|PM3VideoControl_HSYNC_MASK
op_or
id|PM3VideoControl_VSYNC_MASK
)paren
suffix:semicolon
id|video
op_or_assign
id|PM3VideoControl_HSYNC_ACTIVE_HIGH
op_or
id|PM3VideoControl_VSYNC_ACTIVE_HIGH
suffix:semicolon
r_if
c_cond
(paren
id|blank_mode
OG
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|blank_mode
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
multiline_comment|/* FIXME */
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM3VideoControl_ENABLE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM3VideoControl_HSYNC_MASK
op_or
id|PM3VideoControl_BLANK_ACTIVE_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM3VideoControl_VSYNC_MASK
op_or
id|PM3VideoControl_BLANK_ACTIVE_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|video
op_assign
id|video
op_amp
op_complement
(paren
id|PM3VideoControl_HSYNC_MASK
op_or
id|PM3VideoControl_VSYNC_MASK
op_or
id|PM3VideoControl_BLANK_ACTIVE_LOW
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Unsupported blanking %d&bslash;n&quot;
comma
id|blank_mode
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3VideoControl
comma
id|video
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pm3fb_set_disp
r_static
r_void
id|pm3fb_set_disp
c_func
(paren
r_const
r_void
op_star
id|par
comma
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|pm3fb_par
op_star
id|p
op_assign
(paren
r_struct
id|pm3fb_par
op_star
)paren
id|par
suffix:semicolon
id|u32
id|flags
suffix:semicolon
id|DTRACE
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|info-&gt;info.screen_base
op_assign
id|l_fb_info-&gt;v_fb
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;depth
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|disp-&gt;dispsw
op_assign
op_amp
id|pm3fb_cfb8
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|12
suffix:colon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|disp-&gt;dispsw
op_assign
op_amp
id|pm3fb_cfb16
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|l_fb_info-&gt;cmap.cmap12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|disp-&gt;dispsw
op_assign
op_amp
id|pm3fb_cfb16
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|l_fb_info-&gt;cmap.cmap15
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|disp-&gt;dispsw
op_assign
op_amp
id|pm3fb_cfb16
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|l_fb_info-&gt;cmap.cmap16
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
macro_line|#ifdef PM3FB_USE_ACCEL
r_if
c_cond
(paren
op_logical_neg
(paren
id|noaccel
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
id|disp-&gt;dispsw
op_assign
op_amp
id|pm3fb_cfb32
suffix:semicolon
r_else
macro_line|#endif /* PM3FB_USE_ACCEL */
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|l_fb_info-&gt;cmap.cmap32
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB32 */
r_default
suffix:colon
id|disp-&gt;dispsw
op_assign
op_amp
id|fbcon_dummy
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Invalid depth, using fbcon_dummy&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* */
DECL|function|pm3fb_detect
r_static
r_void
id|pm3fb_detect
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev_array
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_int
r_int
id|i
comma
id|j
comma
id|done
suffix:semicolon
id|DTRACE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_array
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|fb_info
(braket
id|i
)braket
dot
id|dev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_3DLABS
comma
id|PCI_DEVICE_ID_3DLABS_PERMEDIA3
comma
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|i
OL
id|PM3_MAX_BOARD
)paren
op_logical_and
id|dev
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_array
(braket
id|i
)braket
op_assign
id|dev
suffix:semicolon
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_3DLABS
comma
id|PCI_DEVICE_ID_3DLABS_PERMEDIA3
comma
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
)paren
(brace
multiline_comment|/* more than PM3_MAX_BOARD */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pm3fb: Warning: more than %d boards found&bslash;n&quot;
comma
id|PM3_MAX_BOARD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev_array
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* not a single board, abort */
r_return
suffix:semicolon
)brace
multiline_comment|/* allocate user-defined boards */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|bus
(braket
id|i
)braket
op_ge
l_int|0
)paren
op_logical_and
(paren
id|slot
(braket
id|i
)braket
op_ge
l_int|0
)paren
op_logical_and
(paren
id|func
(braket
id|i
)braket
op_ge
l_int|0
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev_array
(braket
id|j
)braket
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|dev_array
(braket
id|j
)braket
op_member_access_from_pointer
id|bus-&gt;number
op_eq
id|bus
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|PCI_SLOT
c_func
(paren
id|dev_array
(braket
id|j
)braket
op_member_access_from_pointer
id|devfn
)paren
op_eq
id|slot
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|PCI_FUNC
c_func
(paren
id|dev_array
(braket
id|j
)braket
op_member_access_from_pointer
id|devfn
)paren
op_eq
id|func
(braket
id|i
)braket
)paren
)paren
(brace
id|fb_info
(braket
id|i
)braket
dot
id|dev
op_assign
id|dev_array
(braket
id|j
)braket
suffix:semicolon
id|dev_array
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* allocate remaining boards */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fb_info
(braket
id|i
)braket
dot
id|dev
op_eq
l_int|NULL
)paren
(brace
id|done
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|j
OL
id|PM3_MAX_BOARD
)paren
op_logical_and
(paren
op_logical_neg
id|done
)paren
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev_array
(braket
id|j
)braket
op_ne
l_int|NULL
)paren
(brace
id|fb_info
(braket
id|i
)braket
dot
id|dev
op_assign
id|dev_array
(braket
id|j
)braket
suffix:semicolon
id|dev_array
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* at that point, all PCI Permedia3 are detected and allocated */
multiline_comment|/* now, initialize... or not */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;dev
)paren
op_logical_and
(paren
op_logical_neg
id|disable
(braket
id|i
)braket
)paren
)paren
(brace
multiline_comment|/* PCI device was found and not disabled by user */
macro_line|#ifdef SUPPORT_FB_OF
r_struct
id|device_node
op_star
id|dp
op_assign
id|find_pci_device_OFnode
c_func
(paren
id|l_fb_info-&gt;dev-&gt;bus
op_member_access_from_pointer
id|number
comma
id|l_fb_info-&gt;dev-&gt;devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dp
)paren
op_logical_and
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|dp-&gt;name
comma
l_string|&quot;formacGA12&quot;
comma
l_int|10
)paren
)paren
)paren
(brace
multiline_comment|/* do nothing, init of board is done in pm3fb_of_init */
)brace
r_else
(brace
macro_line|#endif
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;found @%lx Vendor %lx Device %lx ; base @ : %lx - %lx - %lx - %lx - %lx - %lx, irq %ld&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;dev
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;dev
op_member_access_from_pointer
id|vendor
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;dev
op_member_access_from_pointer
id|device
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|0
)paren
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|1
)paren
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|2
)paren
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|3
)paren
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|4
)paren
comma
(paren
r_int
r_int
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|5
)paren
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;dev
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|l_fb_info-&gt;pIOBase
op_assign
(paren
r_int
r_char
op_star
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
id|l_fb_info-&gt;pIOBase
op_add_assign
id|PM3_REGS_SIZE
suffix:semicolon
macro_line|#endif
id|l_fb_info-&gt;vIOBase
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|l_fb_info-&gt;p_fb
op_assign
(paren
r_int
r_char
op_star
)paren
id|pci_resource_start
c_func
(paren
id|l_fb_info-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
id|l_fb_info-&gt;v_fb
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5) &t;/* full resource management, new in linux-2.4.x */
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;p_fb
comma
l_int|64
op_star
l_int|1024
op_star
l_int|1024
comma
multiline_comment|/* request full aperture size */
l_string|&quot;pm3fb&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;pm3fb: Error: couldn&squot;t request framebuffer memory, board #%ld&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;pIOBase
comma
id|PM3_REGS_SIZE
comma
l_string|&quot;pm3fb I/O regs&quot;
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;pm3fb: Error: couldn&squot;t request IObase memory, board #%ld&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif /* KERNEL_2_4 or KERNEL_2_5 */
r_if
c_cond
(paren
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
id|l_fb_info-&gt;fb_size
op_assign
id|forcesize
(braket
id|l_fb_info-&gt;board_num
)braket
suffix:semicolon
id|l_fb_info-&gt;fb_size
op_assign
id|pm3fb_size_memory
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_fb_info-&gt;fb_size
)paren
(brace
(paren
r_void
)paren
id|pci_enable_device
c_func
(paren
id|l_fb_info-&gt;dev
)paren
suffix:semicolon
id|pm3fb_common_init
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pm3fb: memory problem, not enabling board #%ld&bslash;n&quot;
comma
id|l_fb_info-&gt;board_num
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_FB_OF
)brace
macro_line|#endif /* SUPPORT_FB_OF */
)brace
)brace
)brace
DECL|function|pm3fb_pan_display
r_static
r_int
id|pm3fb_pan_display
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info_gen
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|DTRACE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|current_par_valid
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|l_fb_info-&gt;current_par-&gt;base
op_assign
multiline_comment|/* in 128 bits chunk - i.e. AFTER Shiftbpp */
id|pm3fb_Shiftbpp
c_func
(paren
id|l_fb_info
comma
id|l_fb_info-&gt;current_par-&gt;depth
comma
(paren
id|var-&gt;yoffset
op_star
id|l_fb_info-&gt;current_par-&gt;width
)paren
op_plus
id|var-&gt;xoffset
)paren
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ScreenBase
comma
id|l_fb_info-&gt;current_par-&gt;base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pm3fb_ioctl
r_static
r_int
id|pm3fb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
(paren
r_struct
id|pm3fb_info
op_star
)paren
id|info
suffix:semicolon
id|u32
id|cm
comma
id|i
suffix:semicolon
macro_line|#ifdef PM3FB_MASTER_DEBUG
r_char
id|cc
(braket
l_int|3
)braket
suffix:semicolon
macro_line|#endif /* PM3FB_MASTER_DEBUG */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
macro_line|#ifdef PM3FB_MASTER_DEBUG
r_case
id|PM3FBIO_CLEARMEMORY
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cm
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|u32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|pm3fb_clear_memory
c_func
(paren
id|l_fb_info
comma
id|cm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM3FBIO_CLEARCMAP
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|cc
comma
(paren
r_void
op_star
)paren
id|arg
comma
l_int|3
op_star
r_sizeof
(paren
r_char
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|pm3fb_clear_colormap
c_func
(paren
id|l_fb_info
comma
id|cc
(braket
l_int|0
)braket
comma
id|cc
(braket
l_int|1
)braket
comma
id|cc
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* PM3FB_MASTER_DEBUG */
r_case
id|PM3FBIO_RESETCHIP
suffix:colon
id|cm
op_assign
l_int|1
suffix:semicolon
id|PM3_SLOW_WRITE_REG
c_func
(paren
id|PM3ResetStatus
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
l_int|10000
)paren
op_logical_and
id|cm
suffix:semicolon
id|i
op_increment
)paren
(brace
id|PM3_DELAY
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cm
op_assign
id|PM3_READ_REG
c_func
(paren
id|PM3ResetStatus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cm
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pm3fb: chip reset failed with status 0x%x&bslash;n&quot;
comma
id|cm
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* first thing first, reload memory timings */
id|pm3fb_write_memory_timings
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
macro_line|#ifdef PM3FB_USE_ACCEL
id|pm3fb_init_engine
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
macro_line|#endif /* PM3FB_USE_ACCEL */
id|pm3fb_write_mode
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;unknown ioctl: %d (%x)&bslash;n&quot;
comma
id|cmd
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/* ****************************************** */
multiline_comment|/* ***** standard FB API init functions ***** */
multiline_comment|/* ****************************************** */
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
r_int
id|__init
id|pm3fb_setup
c_func
(paren
r_char
op_star
id|options
)paren
macro_line|#endif
macro_line|#ifdef KERNEL_2_2
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pm3fb_setup
c_func
(paren
r_char
op_star
id|options
comma
r_int
op_star
id|ints
)paren
)paren
macro_line|#endif
(brace
r_int
id|opsi
op_assign
id|strlen
c_func
(paren
id|options
)paren
suffix:semicolon
id|DTRACE
suffix:semicolon
id|memcpy
c_func
(paren
id|g_options
comma
id|options
comma
(paren
(paren
id|opsi
op_plus
l_int|1
)paren
OG
id|PM3_OPTIONS_SIZE
)paren
ques
c_cond
id|PM3_OPTIONS_SIZE
suffix:colon
(paren
id|opsi
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|g_options
(braket
id|PM3_OPTIONS_SIZE
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
r_int
id|__init
id|pm3fb_init
c_func
(paren
r_void
)paren
macro_line|#endif
macro_line|#ifdef KERNEL_2_2
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pm3fb_init
c_func
(paren
r_void
)paren
)paren
macro_line|#endif
(brace
id|DTRACE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;This is pm3fb.c, CVS version: $Header: /cvsroot/linux/drivers/video/pm3fb.c,v 1.1 2002/02/25 19:11:06 marcelo Exp $&quot;
)paren
suffix:semicolon
id|pm3fb_real_setup
c_func
(paren
id|g_options
)paren
suffix:semicolon
id|pm3fb_detect
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info
(braket
l_int|0
)braket
dot
id|dev
)paren
(brace
multiline_comment|/* not even one board ??? */
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;No PCI Permedia3 board detected&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef SUPPORT_FB_OF&t;&t;/* linux-2.2.x only */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pm3fb_of_init
c_func
(paren
r_struct
id|device_node
op_star
id|dp
)paren
)paren
(brace
r_struct
id|pm3fb_info
op_star
id|l_fb_info
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|bn
op_assign
op_minus
l_int|1
suffix:semicolon
r_struct
id|device_node
op_star
id|dn
suffix:semicolon
id|DTRACE
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;OpenFirmware board : %s&bslash;n&quot;
comma
id|dp-&gt;full_name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dp-&gt;n_addrs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;MemRange : 0x%08x - 0x%x&bslash;n&quot;
comma
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|address
comma
id|dp-&gt;addrs
(braket
id|i
)braket
dot
id|size
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* find which PCI board is the OF device */
r_if
c_cond
(paren
id|fb_info
(braket
id|i
)braket
dot
id|dev
)paren
(brace
id|dn
op_assign
id|find_pci_device_OFnode
c_func
(paren
id|fb_info
(braket
id|i
)braket
dot
id|dev-&gt;bus
op_member_access_from_pointer
id|number
comma
id|fb_info
(braket
id|i
)braket
dot
id|dev-&gt;devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn
op_eq
id|dp
)paren
(brace
r_if
c_cond
(paren
id|bn
op_eq
op_minus
l_int|1
)paren
id|bn
op_assign
id|i
suffix:semicolon
r_else
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Error: Multiple PCI device for a single OpenFirmware node&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|bn
op_eq
op_minus
l_int|1
)paren
(brace
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;Warning: non-PCI Permedia3 found&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fb_info
(braket
id|i
)braket
dot
id|dev
op_logical_and
(paren
id|i
OL
id|PM3_MAX_BOARD
)paren
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PM3_MAX_BOARD
)paren
id|bn
op_assign
id|i
suffix:semicolon
r_else
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;pm3fb: Error: Couldn&squot;t find room for OpenFirmware device&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
id|bn
)braket
)paren
suffix:semicolon
id|l_fb_info-&gt;dn
op_assign
id|dp
suffix:semicolon
id|l_fb_info-&gt;pIOBase
op_assign
(paren
r_int
r_char
op_star
)paren
id|dp-&gt;addrs
(braket
l_int|3
)braket
dot
id|address
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
id|l_fb_info-&gt;pIOBase
op_add_assign
id|PM3_REGS_SIZE
suffix:semicolon
macro_line|#endif
id|l_fb_info-&gt;vIOBase
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|l_fb_info-&gt;p_fb
op_assign
(paren
r_int
r_char
op_star
)paren
id|dp-&gt;addrs
(braket
l_int|1
)braket
dot
id|address
suffix:semicolon
id|l_fb_info-&gt;v_fb
op_assign
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|l_fb_info-&gt;fb_size
op_assign
id|pm3fb_size_memory
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
multiline_comment|/* (unsigned long)dp-&gt;addrs[1].size; */
multiline_comment|/* OF is a liar ! it claims 256 Mb */
id|DPRINTK
c_func
(paren
l_int|2
comma
l_string|&quot;OpenFirmware board (#%ld) : IOBase 0x%08lx, p_fb 0x%08lx, fb_size %d KB&bslash;n&quot;
comma
id|bn
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;pIOBase
comma
(paren
r_int
r_int
)paren
id|l_fb_info-&gt;p_fb
comma
id|l_fb_info-&gt;fb_size
op_rshift
l_int|10
)paren
suffix:semicolon
id|l_fb_info-&gt;use_current
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* will use current mode by default */
id|pm3fb_common_init
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
)brace
macro_line|#endif /* SUPPORT_FB_OF */
multiline_comment|/* ************************* */
multiline_comment|/* **** Module support ***** */
multiline_comment|/* ************************* */
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Romain Dolbeau&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Permedia3 framebuffer device driver&quot;
)paren
suffix:semicolon
DECL|variable|mode
r_static
r_char
op_star
id|mode
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_STRING
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;video mode&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|disable
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_SHORT
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|disable
comma
l_string|&quot;disable board&quot;
)paren
suffix:semicolon
DECL|variable|off
r_static
r_int
id|off
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|off
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_SHORT
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|off
comma
l_string|&quot;disable board&quot;
)paren
suffix:semicolon
DECL|variable|pciid
r_static
r_char
op_star
id|pciid
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pciid
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_STRING
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pciid
comma
l_string|&quot;board PCI Id&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noaccel
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_SHORT
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;disable accel&quot;
)paren
suffix:semicolon
DECL|variable|font
r_static
r_char
op_star
id|font
(braket
id|PM3_MAX_BOARD
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|font
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_STRING
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|font
comma
l_string|&quot;choose font&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|depth
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_SHORT
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|depth
comma
l_string|&quot;boot-time depth&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|printtimings
comma
l_string|&quot;h&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|printtimings
comma
l_string|&quot;print the memory timings of the card(s)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|forcesize
comma
id|PM3_MAX_BOARD_MODULE_ARRAY_SHORT
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forcesize
comma
l_string|&quot;force specified memory size&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;MODULE_SUPPORTED_DEVICE(&quot;Permedia3 PCI boards&quot;)&n;MODULE_GENERIC_TABLE(gtype,name)&n;MODULE_DEVICE_TABLE(type,name)&n;*/
DECL|function|pm3fb_build_options
r_void
id|pm3fb_build_options
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|ts
(braket
l_int|128
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|g_options
comma
l_string|&quot;pm3fb&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mode
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,mode:%d:%s&quot;
comma
id|i
comma
id|mode
(braket
id|i
)braket
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|disable
(braket
id|i
)braket
op_logical_or
id|off
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,disable:%d:&quot;
comma
id|i
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pciid
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,pciid:%d:%s&quot;
comma
id|i
comma
id|pciid
(braket
id|i
)braket
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|noaccel
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,noaccel:%d:&quot;
comma
id|i
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|font
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,font:%d:%s&quot;
comma
id|i
comma
id|font
(braket
id|i
)braket
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|depth
(braket
id|i
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|ts
comma
l_string|&quot;,depth:%d:%d&quot;
comma
id|i
comma
id|depth
(braket
id|i
)braket
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|g_options
comma
id|ts
comma
id|PM3_OPTIONS_SIZE
op_minus
id|strlen
c_func
(paren
id|g_options
)paren
)paren
suffix:semicolon
)brace
)brace
id|g_options
(braket
id|PM3_OPTIONS_SIZE
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|DPRINTK
c_func
(paren
l_int|1
comma
l_string|&quot;pm3fb use options: %s&bslash;n&quot;
comma
id|g_options
)paren
suffix:semicolon
)brace
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|DTRACE
suffix:semicolon
id|pm3fb_build_options
c_func
(paren
)paren
suffix:semicolon
id|pm3fb_init
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|DTRACE
suffix:semicolon
(brace
r_int
r_int
id|i
suffix:semicolon
r_struct
id|pm3fb_info
op_star
id|l_fb_info
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PM3_MAX_BOARD
suffix:semicolon
id|i
op_increment
)paren
(brace
id|l_fb_info
op_assign
op_amp
(paren
id|fb_info
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l_fb_info-&gt;dev
op_ne
l_int|NULL
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|disable
(braket
id|l_fb_info-&gt;board_num
)braket
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|l_fb_info-&gt;vIOBase
op_ne
(paren
r_int
r_char
op_star
)paren
op_minus
l_int|1
)paren
(brace
id|pm3fb_unmapIO
c_func
(paren
id|l_fb_info
)paren
suffix:semicolon
macro_line|#if (defined KERNEL_2_4) || (defined KERNEL_2_5)
id|release_mem_region
c_func
(paren
id|l_fb_info-&gt;p_fb
comma
id|l_fb_info
op_member_access_from_pointer
id|fb_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|l_fb_info
op_member_access_from_pointer
id|pIOBase
comma
id|PM3_REGS_SIZE
)paren
suffix:semicolon
macro_line|#endif /* KERNEL_2_4 or KERNEL_2_5 */
)brace
id|unregister_framebuffer
c_func
(paren
op_amp
id|l_fb_info-&gt;gen
dot
id|info
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
