multiline_comment|/* ffb.c: Creator/Elite3D frame buffer driver&n; *&n; * Copyright (C) 2003 David S. Miller (davem@redhat.com)&n; * Copyright (C) 1997,1998,1999 Jakub Jelinek (jj@ultra.linux.cz)&n; *&n; * Driver layout based loosely on tgafb.c, see that file for credits.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/upa.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/fbio.h&gt;
macro_line|#include &quot;sbuslib.h&quot;
multiline_comment|/*&n; * Local functions.&n; */
r_static
r_int
id|ffb_setcolreg
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|ffb_blank
c_func
(paren
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|ffb_init_fix
c_func
(paren
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|ffb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_const
r_struct
id|fb_image
op_star
)paren
suffix:semicolon
r_static
r_void
id|ffb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_const
r_struct
id|fb_fillrect
op_star
)paren
suffix:semicolon
r_static
r_void
id|ffb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_const
r_struct
id|fb_copyarea
op_star
)paren
suffix:semicolon
r_static
r_int
id|ffb_sync
c_func
(paren
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|ffb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
comma
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|ffb_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|ffb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
comma
r_struct
id|fb_info
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *  Frame buffer operations&n; */
DECL|variable|ffb_ops
r_static
r_struct
id|fb_ops
id|ffb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_setcolreg
op_assign
id|ffb_setcolreg
comma
dot
id|fb_blank
op_assign
id|ffb_blank
comma
dot
id|fb_pan_display
op_assign
id|ffb_pan_display
comma
dot
id|fb_fillrect
op_assign
id|ffb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|ffb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|ffb_imageblit
comma
dot
id|fb_sync
op_assign
id|ffb_sync
comma
dot
id|fb_mmap
op_assign
id|ffb_mmap
comma
dot
id|fb_ioctl
op_assign
id|ffb_ioctl
comma
multiline_comment|/* XXX Use FFB hw cursor once fb cursor API is better understood... */
dot
id|fb_cursor
op_assign
id|soft_cursor
comma
)brace
suffix:semicolon
multiline_comment|/* Register layout and definitions */
DECL|macro|FFB_SFB8R_VOFF
mdefine_line|#define&t;FFB_SFB8R_VOFF&t;&t;0x00000000
DECL|macro|FFB_SFB8G_VOFF
mdefine_line|#define&t;FFB_SFB8G_VOFF&t;&t;0x00400000
DECL|macro|FFB_SFB8B_VOFF
mdefine_line|#define&t;FFB_SFB8B_VOFF&t;&t;0x00800000
DECL|macro|FFB_SFB8X_VOFF
mdefine_line|#define&t;FFB_SFB8X_VOFF&t;&t;0x00c00000
DECL|macro|FFB_SFB32_VOFF
mdefine_line|#define&t;FFB_SFB32_VOFF&t;&t;0x01000000
DECL|macro|FFB_SFB64_VOFF
mdefine_line|#define&t;FFB_SFB64_VOFF&t;&t;0x02000000
DECL|macro|FFB_FBC_REGS_VOFF
mdefine_line|#define&t;FFB_FBC_REGS_VOFF&t;0x04000000
DECL|macro|FFB_BM_FBC_REGS_VOFF
mdefine_line|#define&t;FFB_BM_FBC_REGS_VOFF&t;0x04002000
DECL|macro|FFB_DFB8R_VOFF
mdefine_line|#define&t;FFB_DFB8R_VOFF&t;&t;0x04004000
DECL|macro|FFB_DFB8G_VOFF
mdefine_line|#define&t;FFB_DFB8G_VOFF&t;&t;0x04404000
DECL|macro|FFB_DFB8B_VOFF
mdefine_line|#define&t;FFB_DFB8B_VOFF&t;&t;0x04804000
DECL|macro|FFB_DFB8X_VOFF
mdefine_line|#define&t;FFB_DFB8X_VOFF&t;&t;0x04c04000
DECL|macro|FFB_DFB24_VOFF
mdefine_line|#define&t;FFB_DFB24_VOFF&t;&t;0x05004000
DECL|macro|FFB_DFB32_VOFF
mdefine_line|#define&t;FFB_DFB32_VOFF&t;&t;0x06004000
DECL|macro|FFB_DFB422A_VOFF
mdefine_line|#define&t;FFB_DFB422A_VOFF&t;0x07004000&t;/* DFB 422 mode write to A */
DECL|macro|FFB_DFB422AD_VOFF
mdefine_line|#define&t;FFB_DFB422AD_VOFF&t;0x07804000&t;/* DFB 422 mode with line doubling */
DECL|macro|FFB_DFB24B_VOFF
mdefine_line|#define&t;FFB_DFB24B_VOFF&t;&t;0x08004000&t;/* DFB 24bit mode write to B */
DECL|macro|FFB_DFB422B_VOFF
mdefine_line|#define&t;FFB_DFB422B_VOFF&t;0x09004000&t;/* DFB 422 mode write to B */
DECL|macro|FFB_DFB422BD_VOFF
mdefine_line|#define&t;FFB_DFB422BD_VOFF&t;0x09804000&t;/* DFB 422 mode with line doubling */
DECL|macro|FFB_SFB16Z_VOFF
mdefine_line|#define&t;FFB_SFB16Z_VOFF&t;&t;0x0a004000&t;/* 16bit mode Z planes */
DECL|macro|FFB_SFB8Z_VOFF
mdefine_line|#define&t;FFB_SFB8Z_VOFF&t;&t;0x0a404000&t;/* 8bit mode Z planes */
DECL|macro|FFB_SFB422_VOFF
mdefine_line|#define&t;FFB_SFB422_VOFF&t;&t;0x0ac04000&t;/* SFB 422 mode write to A/B */
DECL|macro|FFB_SFB422D_VOFF
mdefine_line|#define&t;FFB_SFB422D_VOFF&t;0x0b404000&t;/* SFB 422 mode with line doubling */
DECL|macro|FFB_FBC_KREGS_VOFF
mdefine_line|#define&t;FFB_FBC_KREGS_VOFF&t;0x0bc04000
DECL|macro|FFB_DAC_VOFF
mdefine_line|#define&t;FFB_DAC_VOFF&t;&t;0x0bc06000
DECL|macro|FFB_PROM_VOFF
mdefine_line|#define&t;FFB_PROM_VOFF&t;&t;0x0bc08000
DECL|macro|FFB_EXP_VOFF
mdefine_line|#define&t;FFB_EXP_VOFF&t;&t;0x0bc18000
DECL|macro|FFB_SFB8R_POFF
mdefine_line|#define&t;FFB_SFB8R_POFF&t;&t;0x04000000UL
DECL|macro|FFB_SFB8G_POFF
mdefine_line|#define&t;FFB_SFB8G_POFF&t;&t;0x04400000UL
DECL|macro|FFB_SFB8B_POFF
mdefine_line|#define&t;FFB_SFB8B_POFF&t;&t;0x04800000UL
DECL|macro|FFB_SFB8X_POFF
mdefine_line|#define&t;FFB_SFB8X_POFF&t;&t;0x04c00000UL
DECL|macro|FFB_SFB32_POFF
mdefine_line|#define&t;FFB_SFB32_POFF&t;&t;0x05000000UL
DECL|macro|FFB_SFB64_POFF
mdefine_line|#define&t;FFB_SFB64_POFF&t;&t;0x06000000UL
DECL|macro|FFB_FBC_REGS_POFF
mdefine_line|#define&t;FFB_FBC_REGS_POFF&t;0x00600000UL
DECL|macro|FFB_BM_FBC_REGS_POFF
mdefine_line|#define&t;FFB_BM_FBC_REGS_POFF&t;0x00600000UL
DECL|macro|FFB_DFB8R_POFF
mdefine_line|#define&t;FFB_DFB8R_POFF&t;&t;0x01000000UL
DECL|macro|FFB_DFB8G_POFF
mdefine_line|#define&t;FFB_DFB8G_POFF&t;&t;0x01400000UL
DECL|macro|FFB_DFB8B_POFF
mdefine_line|#define&t;FFB_DFB8B_POFF&t;&t;0x01800000UL
DECL|macro|FFB_DFB8X_POFF
mdefine_line|#define&t;FFB_DFB8X_POFF&t;&t;0x01c00000UL
DECL|macro|FFB_DFB24_POFF
mdefine_line|#define&t;FFB_DFB24_POFF&t;&t;0x02000000UL
DECL|macro|FFB_DFB32_POFF
mdefine_line|#define&t;FFB_DFB32_POFF&t;&t;0x03000000UL
DECL|macro|FFB_FBC_KREGS_POFF
mdefine_line|#define&t;FFB_FBC_KREGS_POFF&t;0x00610000UL
DECL|macro|FFB_DAC_POFF
mdefine_line|#define&t;FFB_DAC_POFF&t;&t;0x00400000UL
DECL|macro|FFB_PROM_POFF
mdefine_line|#define&t;FFB_PROM_POFF&t;&t;0x00000000UL
DECL|macro|FFB_EXP_POFF
mdefine_line|#define&t;FFB_EXP_POFF&t;&t;0x00200000UL
DECL|macro|FFB_DFB422A_POFF
mdefine_line|#define FFB_DFB422A_POFF&t;0x09000000UL
DECL|macro|FFB_DFB422AD_POFF
mdefine_line|#define FFB_DFB422AD_POFF&t;0x09800000UL
DECL|macro|FFB_DFB24B_POFF
mdefine_line|#define FFB_DFB24B_POFF&t;&t;0x0a000000UL
DECL|macro|FFB_DFB422B_POFF
mdefine_line|#define FFB_DFB422B_POFF&t;0x0b000000UL
DECL|macro|FFB_DFB422BD_POFF
mdefine_line|#define FFB_DFB422BD_POFF&t;0x0b800000UL
DECL|macro|FFB_SFB16Z_POFF
mdefine_line|#define FFB_SFB16Z_POFF&t;&t;0x0c800000UL
DECL|macro|FFB_SFB8Z_POFF
mdefine_line|#define FFB_SFB8Z_POFF&t;&t;0x0c000000UL
DECL|macro|FFB_SFB422_POFF
mdefine_line|#define FFB_SFB422_POFF&t;&t;0x0d000000UL
DECL|macro|FFB_SFB422D_POFF
mdefine_line|#define FFB_SFB422D_POFF&t;0x0d800000UL
multiline_comment|/* Draw operations */
DECL|macro|FFB_DRAWOP_DOT
mdefine_line|#define FFB_DRAWOP_DOT&t;&t;0x00
DECL|macro|FFB_DRAWOP_AADOT
mdefine_line|#define FFB_DRAWOP_AADOT&t;0x01
DECL|macro|FFB_DRAWOP_BRLINECAP
mdefine_line|#define FFB_DRAWOP_BRLINECAP&t;0x02
DECL|macro|FFB_DRAWOP_BRLINEOPEN
mdefine_line|#define FFB_DRAWOP_BRLINEOPEN&t;0x03
DECL|macro|FFB_DRAWOP_DDLINE
mdefine_line|#define FFB_DRAWOP_DDLINE&t;0x04
DECL|macro|FFB_DRAWOP_AALINE
mdefine_line|#define FFB_DRAWOP_AALINE&t;0x05
DECL|macro|FFB_DRAWOP_TRIANGLE
mdefine_line|#define FFB_DRAWOP_TRIANGLE&t;0x06
DECL|macro|FFB_DRAWOP_POLYGON
mdefine_line|#define FFB_DRAWOP_POLYGON&t;0x07
DECL|macro|FFB_DRAWOP_RECTANGLE
mdefine_line|#define FFB_DRAWOP_RECTANGLE&t;0x08
DECL|macro|FFB_DRAWOP_FASTFILL
mdefine_line|#define FFB_DRAWOP_FASTFILL&t;0x09
DECL|macro|FFB_DRAWOP_BCOPY
mdefine_line|#define FFB_DRAWOP_BCOPY&t;0x0a
DECL|macro|FFB_DRAWOP_VSCROLL
mdefine_line|#define FFB_DRAWOP_VSCROLL&t;0x0b
multiline_comment|/* Pixel processor control */
multiline_comment|/* Force WID */
DECL|macro|FFB_PPC_FW_DISABLE
mdefine_line|#define FFB_PPC_FW_DISABLE&t;0x800000
DECL|macro|FFB_PPC_FW_ENABLE
mdefine_line|#define FFB_PPC_FW_ENABLE&t;0xc00000
multiline_comment|/* Auxiliary clip */
DECL|macro|FFB_PPC_ACE_DISABLE
mdefine_line|#define FFB_PPC_ACE_DISABLE&t;0x040000
DECL|macro|FFB_PPC_ACE_AUX_SUB
mdefine_line|#define FFB_PPC_ACE_AUX_SUB&t;0x080000
DECL|macro|FFB_PPC_ACE_AUX_ADD
mdefine_line|#define FFB_PPC_ACE_AUX_ADD&t;0x0c0000
multiline_comment|/* Depth cue */
DECL|macro|FFB_PPC_DCE_DISABLE
mdefine_line|#define FFB_PPC_DCE_DISABLE&t;0x020000
DECL|macro|FFB_PPC_DCE_ENABLE
mdefine_line|#define FFB_PPC_DCE_ENABLE&t;0x030000
multiline_comment|/* Alpha blend */
DECL|macro|FFB_PPC_ABE_DISABLE
mdefine_line|#define FFB_PPC_ABE_DISABLE&t;0x008000
DECL|macro|FFB_PPC_ABE_ENABLE
mdefine_line|#define FFB_PPC_ABE_ENABLE&t;0x00c000
multiline_comment|/* View clip */
DECL|macro|FFB_PPC_VCE_DISABLE
mdefine_line|#define FFB_PPC_VCE_DISABLE&t;0x001000
DECL|macro|FFB_PPC_VCE_2D
mdefine_line|#define FFB_PPC_VCE_2D&t;&t;0x002000
DECL|macro|FFB_PPC_VCE_3D
mdefine_line|#define FFB_PPC_VCE_3D&t;&t;0x003000
multiline_comment|/* Area pattern */
DECL|macro|FFB_PPC_APE_DISABLE
mdefine_line|#define FFB_PPC_APE_DISABLE&t;0x000800
DECL|macro|FFB_PPC_APE_ENABLE
mdefine_line|#define FFB_PPC_APE_ENABLE&t;0x000c00
multiline_comment|/* Transparent background */
DECL|macro|FFB_PPC_TBE_OPAQUE
mdefine_line|#define FFB_PPC_TBE_OPAQUE&t;0x000200
DECL|macro|FFB_PPC_TBE_TRANSPARENT
mdefine_line|#define FFB_PPC_TBE_TRANSPARENT&t;0x000300
multiline_comment|/* Z source */
DECL|macro|FFB_PPC_ZS_VAR
mdefine_line|#define FFB_PPC_ZS_VAR&t;&t;0x000080
DECL|macro|FFB_PPC_ZS_CONST
mdefine_line|#define FFB_PPC_ZS_CONST&t;0x0000c0
multiline_comment|/* Y source */
DECL|macro|FFB_PPC_YS_VAR
mdefine_line|#define FFB_PPC_YS_VAR&t;&t;0x000020
DECL|macro|FFB_PPC_YS_CONST
mdefine_line|#define FFB_PPC_YS_CONST&t;0x000030
multiline_comment|/* X source */
DECL|macro|FFB_PPC_XS_WID
mdefine_line|#define FFB_PPC_XS_WID&t;&t;0x000004
DECL|macro|FFB_PPC_XS_VAR
mdefine_line|#define FFB_PPC_XS_VAR&t;&t;0x000008
DECL|macro|FFB_PPC_XS_CONST
mdefine_line|#define FFB_PPC_XS_CONST&t;0x00000c
multiline_comment|/* Color (BGR) source */
DECL|macro|FFB_PPC_CS_VAR
mdefine_line|#define FFB_PPC_CS_VAR&t;&t;0x000002
DECL|macro|FFB_PPC_CS_CONST
mdefine_line|#define FFB_PPC_CS_CONST&t;0x000003
DECL|macro|FFB_ROP_NEW
mdefine_line|#define FFB_ROP_NEW                  0x83
DECL|macro|FFB_ROP_OLD
mdefine_line|#define FFB_ROP_OLD                  0x85
DECL|macro|FFB_ROP_NEW_XOR_OLD
mdefine_line|#define FFB_ROP_NEW_XOR_OLD          0x86
DECL|macro|FFB_UCSR_FIFO_MASK
mdefine_line|#define FFB_UCSR_FIFO_MASK     0x00000fff
DECL|macro|FFB_UCSR_FB_BUSY
mdefine_line|#define FFB_UCSR_FB_BUSY       0x01000000
DECL|macro|FFB_UCSR_RP_BUSY
mdefine_line|#define FFB_UCSR_RP_BUSY       0x02000000
DECL|macro|FFB_UCSR_ALL_BUSY
mdefine_line|#define FFB_UCSR_ALL_BUSY      (FFB_UCSR_RP_BUSY|FFB_UCSR_FB_BUSY)
DECL|macro|FFB_UCSR_READ_ERR
mdefine_line|#define FFB_UCSR_READ_ERR      0x40000000
DECL|macro|FFB_UCSR_FIFO_OVFL
mdefine_line|#define FFB_UCSR_FIFO_OVFL     0x80000000
DECL|macro|FFB_UCSR_ALL_ERRORS
mdefine_line|#define FFB_UCSR_ALL_ERRORS    (FFB_UCSR_READ_ERR|FFB_UCSR_FIFO_OVFL)
DECL|struct|ffb_fbc
r_struct
id|ffb_fbc
(brace
multiline_comment|/* Next vertex registers */
DECL|member|xxx1
id|u32
id|xxx1
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|alpha
r_volatile
id|u32
id|alpha
suffix:semicolon
DECL|member|red
r_volatile
id|u32
id|red
suffix:semicolon
DECL|member|green
r_volatile
id|u32
id|green
suffix:semicolon
DECL|member|blue
r_volatile
id|u32
id|blue
suffix:semicolon
DECL|member|depth
r_volatile
id|u32
id|depth
suffix:semicolon
DECL|member|y
r_volatile
id|u32
id|y
suffix:semicolon
DECL|member|x
r_volatile
id|u32
id|x
suffix:semicolon
DECL|member|xxx2
id|u32
id|xxx2
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ryf
r_volatile
id|u32
id|ryf
suffix:semicolon
DECL|member|rxf
r_volatile
id|u32
id|rxf
suffix:semicolon
DECL|member|xxx3
id|u32
id|xxx3
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dmyf
r_volatile
id|u32
id|dmyf
suffix:semicolon
DECL|member|dmxf
r_volatile
id|u32
id|dmxf
suffix:semicolon
DECL|member|xxx4
id|u32
id|xxx4
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ebyi
r_volatile
id|u32
id|ebyi
suffix:semicolon
DECL|member|ebxi
r_volatile
id|u32
id|ebxi
suffix:semicolon
DECL|member|xxx5
id|u32
id|xxx5
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|by
r_volatile
id|u32
id|by
suffix:semicolon
DECL|member|bx
r_volatile
id|u32
id|bx
suffix:semicolon
DECL|member|dy
id|u32
id|dy
suffix:semicolon
DECL|member|dx
id|u32
id|dx
suffix:semicolon
DECL|member|bh
r_volatile
id|u32
id|bh
suffix:semicolon
DECL|member|bw
r_volatile
id|u32
id|bw
suffix:semicolon
DECL|member|xxx6
id|u32
id|xxx6
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|xxx7
id|u32
id|xxx7
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* Setup unit vertex state register */
DECL|member|suvtx
r_volatile
id|u32
id|suvtx
suffix:semicolon
DECL|member|xxx8
id|u32
id|xxx8
(braket
l_int|63
)braket
suffix:semicolon
multiline_comment|/* Control registers */
DECL|member|ppc
r_volatile
id|u32
id|ppc
suffix:semicolon
DECL|member|wid
r_volatile
id|u32
id|wid
suffix:semicolon
DECL|member|fg
r_volatile
id|u32
id|fg
suffix:semicolon
DECL|member|bg
r_volatile
id|u32
id|bg
suffix:semicolon
DECL|member|consty
r_volatile
id|u32
id|consty
suffix:semicolon
DECL|member|constz
r_volatile
id|u32
id|constz
suffix:semicolon
DECL|member|xclip
r_volatile
id|u32
id|xclip
suffix:semicolon
DECL|member|dcss
r_volatile
id|u32
id|dcss
suffix:semicolon
DECL|member|vclipmin
r_volatile
id|u32
id|vclipmin
suffix:semicolon
DECL|member|vclipmax
r_volatile
id|u32
id|vclipmax
suffix:semicolon
DECL|member|vclipzmin
r_volatile
id|u32
id|vclipzmin
suffix:semicolon
DECL|member|vclipzmax
r_volatile
id|u32
id|vclipzmax
suffix:semicolon
DECL|member|dcsf
r_volatile
id|u32
id|dcsf
suffix:semicolon
DECL|member|dcsb
r_volatile
id|u32
id|dcsb
suffix:semicolon
DECL|member|dczf
r_volatile
id|u32
id|dczf
suffix:semicolon
DECL|member|dczb
r_volatile
id|u32
id|dczb
suffix:semicolon
DECL|member|xxx9
id|u32
id|xxx9
suffix:semicolon
DECL|member|blendc
r_volatile
id|u32
id|blendc
suffix:semicolon
DECL|member|blendc1
r_volatile
id|u32
id|blendc1
suffix:semicolon
DECL|member|blendc2
r_volatile
id|u32
id|blendc2
suffix:semicolon
DECL|member|fbramitc
r_volatile
id|u32
id|fbramitc
suffix:semicolon
DECL|member|fbc
r_volatile
id|u32
id|fbc
suffix:semicolon
DECL|member|rop
r_volatile
id|u32
id|rop
suffix:semicolon
DECL|member|cmp
r_volatile
id|u32
id|cmp
suffix:semicolon
DECL|member|matchab
r_volatile
id|u32
id|matchab
suffix:semicolon
DECL|member|matchc
r_volatile
id|u32
id|matchc
suffix:semicolon
DECL|member|magnab
r_volatile
id|u32
id|magnab
suffix:semicolon
DECL|member|magnc
r_volatile
id|u32
id|magnc
suffix:semicolon
DECL|member|fbcfg0
r_volatile
id|u32
id|fbcfg0
suffix:semicolon
DECL|member|fbcfg1
r_volatile
id|u32
id|fbcfg1
suffix:semicolon
DECL|member|fbcfg2
r_volatile
id|u32
id|fbcfg2
suffix:semicolon
DECL|member|fbcfg3
r_volatile
id|u32
id|fbcfg3
suffix:semicolon
DECL|member|ppcfg
id|u32
id|ppcfg
suffix:semicolon
DECL|member|pick
r_volatile
id|u32
id|pick
suffix:semicolon
DECL|member|fillmode
r_volatile
id|u32
id|fillmode
suffix:semicolon
DECL|member|fbramwac
r_volatile
id|u32
id|fbramwac
suffix:semicolon
DECL|member|pmask
r_volatile
id|u32
id|pmask
suffix:semicolon
DECL|member|xpmask
r_volatile
id|u32
id|xpmask
suffix:semicolon
DECL|member|ypmask
r_volatile
id|u32
id|ypmask
suffix:semicolon
DECL|member|zpmask
r_volatile
id|u32
id|zpmask
suffix:semicolon
DECL|member|clip0min
r_volatile
id|u32
id|clip0min
suffix:semicolon
DECL|member|clip0max
r_volatile
id|u32
id|clip0max
suffix:semicolon
DECL|member|clip1min
r_volatile
id|u32
id|clip1min
suffix:semicolon
DECL|member|clip1max
r_volatile
id|u32
id|clip1max
suffix:semicolon
DECL|member|clip2min
r_volatile
id|u32
id|clip2min
suffix:semicolon
DECL|member|clip2max
r_volatile
id|u32
id|clip2max
suffix:semicolon
DECL|member|clip3min
r_volatile
id|u32
id|clip3min
suffix:semicolon
DECL|member|clip3max
r_volatile
id|u32
id|clip3max
suffix:semicolon
multiline_comment|/* New 3dRAM III support regs */
DECL|member|rawblend2
r_volatile
id|u32
id|rawblend2
suffix:semicolon
DECL|member|rawpreblend
r_volatile
id|u32
id|rawpreblend
suffix:semicolon
DECL|member|rawstencil
r_volatile
id|u32
id|rawstencil
suffix:semicolon
DECL|member|rawstencilctl
r_volatile
id|u32
id|rawstencilctl
suffix:semicolon
DECL|member|threedram1
r_volatile
id|u32
id|threedram1
suffix:semicolon
DECL|member|threedram2
r_volatile
id|u32
id|threedram2
suffix:semicolon
DECL|member|passin
r_volatile
id|u32
id|passin
suffix:semicolon
DECL|member|rawclrdepth
r_volatile
id|u32
id|rawclrdepth
suffix:semicolon
DECL|member|rawpmask
r_volatile
id|u32
id|rawpmask
suffix:semicolon
DECL|member|rawcsrc
r_volatile
id|u32
id|rawcsrc
suffix:semicolon
DECL|member|rawmatch
r_volatile
id|u32
id|rawmatch
suffix:semicolon
DECL|member|rawmagn
r_volatile
id|u32
id|rawmagn
suffix:semicolon
DECL|member|rawropblend
r_volatile
id|u32
id|rawropblend
suffix:semicolon
DECL|member|rawcmp
r_volatile
id|u32
id|rawcmp
suffix:semicolon
DECL|member|rawwac
r_volatile
id|u32
id|rawwac
suffix:semicolon
DECL|member|fbramid
r_volatile
id|u32
id|fbramid
suffix:semicolon
DECL|member|drawop
r_volatile
id|u32
id|drawop
suffix:semicolon
DECL|member|xxx10
id|u32
id|xxx10
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|fontlpat
r_volatile
id|u32
id|fontlpat
suffix:semicolon
DECL|member|xxx11
id|u32
id|xxx11
suffix:semicolon
DECL|member|fontxy
r_volatile
id|u32
id|fontxy
suffix:semicolon
DECL|member|fontw
r_volatile
id|u32
id|fontw
suffix:semicolon
DECL|member|fontinc
r_volatile
id|u32
id|fontinc
suffix:semicolon
DECL|member|font
r_volatile
id|u32
id|font
suffix:semicolon
DECL|member|xxx12
id|u32
id|xxx12
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|blend2
r_volatile
id|u32
id|blend2
suffix:semicolon
DECL|member|preblend
r_volatile
id|u32
id|preblend
suffix:semicolon
DECL|member|stencil
r_volatile
id|u32
id|stencil
suffix:semicolon
DECL|member|stencilctl
r_volatile
id|u32
id|stencilctl
suffix:semicolon
DECL|member|xxx13
id|u32
id|xxx13
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|dcss1
r_volatile
id|u32
id|dcss1
suffix:semicolon
DECL|member|dcss2
r_volatile
id|u32
id|dcss2
suffix:semicolon
DECL|member|dcss3
r_volatile
id|u32
id|dcss3
suffix:semicolon
DECL|member|widpmask
r_volatile
id|u32
id|widpmask
suffix:semicolon
DECL|member|dcs2
r_volatile
id|u32
id|dcs2
suffix:semicolon
DECL|member|dcs3
r_volatile
id|u32
id|dcs3
suffix:semicolon
DECL|member|dcs4
r_volatile
id|u32
id|dcs4
suffix:semicolon
DECL|member|xxx14
id|u32
id|xxx14
suffix:semicolon
DECL|member|dcd2
r_volatile
id|u32
id|dcd2
suffix:semicolon
DECL|member|dcd3
r_volatile
id|u32
id|dcd3
suffix:semicolon
DECL|member|dcd4
r_volatile
id|u32
id|dcd4
suffix:semicolon
DECL|member|xxx15
id|u32
id|xxx15
suffix:semicolon
DECL|member|pattern
r_volatile
id|u32
id|pattern
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|xxx16
id|u32
id|xxx16
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|devid
r_volatile
id|u32
id|devid
suffix:semicolon
DECL|member|xxx17
id|u32
id|xxx17
(braket
l_int|63
)braket
suffix:semicolon
DECL|member|ucsr
r_volatile
id|u32
id|ucsr
suffix:semicolon
DECL|member|xxx18
id|u32
id|xxx18
(braket
l_int|31
)braket
suffix:semicolon
DECL|member|mer
r_volatile
id|u32
id|mer
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ffb_dac
r_struct
id|ffb_dac
(brace
DECL|member|type
r_volatile
id|u32
id|type
suffix:semicolon
DECL|member|value
r_volatile
id|u32
id|value
suffix:semicolon
DECL|member|type2
r_volatile
id|u32
id|type2
suffix:semicolon
DECL|member|value2
r_volatile
id|u32
id|value2
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ffb_par
r_struct
id|ffb_par
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|fbc
r_struct
id|ffb_fbc
op_star
id|fbc
suffix:semicolon
DECL|member|dac
r_struct
id|ffb_dac
op_star
id|dac
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|FFB_FLAG_AFB
mdefine_line|#define FFB_FLAG_AFB&t;&t;0x00000001
DECL|macro|FFB_FLAG_BLANKED
mdefine_line|#define FFB_FLAG_BLANKED&t;0x00000002
DECL|member|fg_cache
id|u32
id|fg_cache
id|__attribute__
c_func
(paren
(paren
id|aligned
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
DECL|member|bg_cache
id|u32
id|bg_cache
suffix:semicolon
DECL|member|rop_cache
id|u32
id|rop_cache
suffix:semicolon
DECL|member|fifo_cache
r_int
id|fifo_cache
suffix:semicolon
DECL|member|physbase
r_int
r_int
id|physbase
suffix:semicolon
DECL|member|fbsize
r_int
r_int
id|fbsize
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|prom_node
r_int
id|prom_node
suffix:semicolon
DECL|member|prom_parent_node
r_int
id|prom_parent_node
suffix:semicolon
DECL|member|dac_rev
r_int
id|dac_rev
suffix:semicolon
DECL|member|board_type
r_int
id|board_type
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|FFB_DO_DEBUG_LOG
macro_line|#undef FFB_DO_DEBUG_LOG
macro_line|#ifdef FFB_DO_DEBUG_LOG
DECL|macro|FFB_DEBUG_LOG_ENTS
mdefine_line|#define FFB_DEBUG_LOG_ENTS&t;32
DECL|struct|ffb_log
r_static
r_struct
id|ffb_log
(brace
DECL|member|op
r_int
id|op
suffix:semicolon
DECL|macro|OP_FILLRECT
mdefine_line|#define OP_FILLRECT&t;1
DECL|macro|OP_IMAGEBLIT
mdefine_line|#define OP_IMAGEBLIT&t;2
DECL|member|depth
DECL|member|x
DECL|member|y
DECL|member|w
DECL|member|h
r_int
id|depth
comma
id|x
comma
id|y
comma
id|w
comma
id|h
suffix:semicolon
DECL|variable|ffb_debug_log
)brace
id|ffb_debug_log
(braket
id|FFB_DEBUG_LOG_ENTS
)braket
suffix:semicolon
DECL|variable|ffb_debug_log_ent
r_static
r_int
id|ffb_debug_log_ent
suffix:semicolon
DECL|function|ffb_do_log
r_static
r_void
id|ffb_do_log
c_func
(paren
r_int
r_int
id|unused
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FFB_DEBUG_LOG_ENTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|ffb_log
op_star
id|p
op_assign
op_amp
id|ffb_debug_log
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FFB_LOG: OP[%s] depth(%d) x(%d) y(%d) w(%d) h(%d)&bslash;n&quot;
comma
(paren
id|p-&gt;op
op_eq
id|OP_FILLRECT
ques
c_cond
l_string|&quot;FILLRECT&quot;
suffix:colon
l_string|&quot;IMAGEBLIT&quot;
)paren
comma
id|p-&gt;depth
comma
id|p-&gt;x
comma
id|p-&gt;y
comma
id|p-&gt;w
comma
id|p-&gt;h
)paren
suffix:semicolon
)brace
)brace
DECL|variable|ffb_log_timer
r_static
r_struct
id|timer_list
id|ffb_log_timer
op_assign
id|TIMER_INITIALIZER
c_func
(paren
id|ffb_do_log
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
DECL|function|ffb_log
r_static
r_void
id|ffb_log
c_func
(paren
r_int
id|op
comma
r_int
id|depth
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|w
comma
r_int
id|h
)paren
(brace
r_if
c_cond
(paren
id|ffb_debug_log_ent
OL
id|FFB_DEBUG_LOG_ENTS
)paren
(brace
r_struct
id|ffb_log
op_star
id|p
op_assign
op_amp
id|ffb_debug_log
(braket
id|ffb_debug_log_ent
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ffb_debug_log_ent
op_ne
l_int|0
op_logical_and
id|p
(braket
op_minus
l_int|1
)braket
dot
id|op
op_eq
id|op
op_logical_and
id|p
(braket
op_minus
l_int|1
)braket
dot
id|depth
op_eq
id|depth
)paren
r_return
suffix:semicolon
id|p-&gt;op
op_assign
id|op
suffix:semicolon
id|p-&gt;depth
op_assign
id|depth
suffix:semicolon
id|p-&gt;x
op_assign
id|x
suffix:semicolon
id|p-&gt;y
op_assign
id|y
suffix:semicolon
id|p-&gt;w
op_assign
id|w
suffix:semicolon
id|p-&gt;h
op_assign
id|h
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|ffb_debug_log_ent
op_eq
id|FFB_DEBUG_LOG_ENTS
)paren
(brace
id|ffb_log_timer.expires
op_assign
id|jiffies
op_plus
l_int|2
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ffb_log_timer
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
DECL|macro|ffb_log
mdefine_line|#define ffb_log(a,b,c,d,e,f)&t;do { } while(0)
macro_line|#endif
DECL|macro|FORCE_WAIT_EVERY_ROP
macro_line|#undef FORCE_WAIT_EVERY_ROP
DECL|function|FFBFifo
r_static
r_void
id|FFBFifo
c_func
(paren
r_struct
id|ffb_par
op_star
id|par
comma
r_int
id|n
)paren
(brace
r_struct
id|ffb_fbc
op_star
id|fbc
suffix:semicolon
r_int
id|cache
op_assign
id|par-&gt;fifo_cache
suffix:semicolon
r_if
c_cond
(paren
id|cache
op_minus
id|n
OL
l_int|0
)paren
(brace
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_do
(brace
id|cache
op_assign
(paren
id|upa_readl
c_func
(paren
op_amp
id|fbc-&gt;ucsr
)paren
op_amp
id|FFB_UCSR_FIFO_MASK
)paren
op_minus
l_int|8
suffix:semicolon
)brace
r_while
c_loop
(paren
id|cache
op_minus
id|n
OL
l_int|0
)paren
suffix:semicolon
)brace
id|par-&gt;fifo_cache
op_assign
id|cache
op_minus
id|n
suffix:semicolon
)brace
DECL|function|FFBWait
r_static
r_void
id|FFBWait
c_func
(paren
r_struct
id|ffb_par
op_star
id|par
)paren
(brace
r_struct
id|ffb_fbc
op_star
id|fbc
suffix:semicolon
r_int
id|limit
op_assign
l_int|10000
suffix:semicolon
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|upa_readl
c_func
(paren
op_amp
id|fbc-&gt;ucsr
)paren
op_amp
id|FFB_UCSR_ALL_BUSY
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|upa_readl
c_func
(paren
op_amp
id|fbc-&gt;ucsr
)paren
op_amp
id|FFB_UCSR_ALL_ERRORS
)paren
op_ne
l_int|0
)paren
(brace
id|upa_writel
c_func
(paren
id|FFB_UCSR_ALL_ERRORS
comma
op_amp
id|fbc-&gt;ucsr
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|limit
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|ffb_sync
r_static
r_int
id|ffb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|p
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|p-&gt;par
suffix:semicolon
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ffb_rop
r_static
id|__inline__
r_void
id|ffb_rop
c_func
(paren
r_struct
id|ffb_par
op_star
id|par
comma
id|u32
id|rop
)paren
(brace
r_if
c_cond
(paren
id|par-&gt;rop_cache
op_ne
id|rop
)paren
(brace
id|FFBFifo
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|rop
comma
op_amp
id|par-&gt;fbc-&gt;rop
)paren
suffix:semicolon
id|par-&gt;rop_cache
op_assign
id|rop
suffix:semicolon
)brace
)brace
DECL|function|ffb_switch_from_graph
r_static
r_void
id|ffb_switch_from_graph
c_func
(paren
r_struct
id|ffb_par
op_star
id|par
)paren
(brace
r_struct
id|ffb_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|par-&gt;dac
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
id|par-&gt;fifo_cache
op_assign
l_int|0
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|7
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|FFB_PPC_VCE_DISABLE
op_or
id|FFB_PPC_TBE_OPAQUE
op_or
id|FFB_PPC_APE_DISABLE
op_or
id|FFB_PPC_CS_CONST
comma
op_amp
id|fbc-&gt;ppc
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|0x2000707f
comma
op_amp
id|fbc-&gt;fbc
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|par-&gt;rop_cache
comma
op_amp
id|fbc-&gt;rop
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|fbc-&gt;pmask
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
(paren
l_int|0
op_lshift
l_int|16
)paren
op_or
(paren
l_int|32
op_lshift
l_int|0
)paren
comma
op_amp
id|fbc-&gt;fontinc
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|par-&gt;fg_cache
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|par-&gt;bg_cache
comma
op_amp
id|fbc-&gt;bg
)paren
suffix:semicolon
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
multiline_comment|/* Disable cursor.  */
id|upa_writel
c_func
(paren
l_int|0x100
comma
op_amp
id|dac-&gt;type2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;dac_rev
op_le
l_int|2
)paren
id|upa_writel
c_func
(paren
l_int|0
comma
op_amp
id|dac-&gt;value2
)paren
suffix:semicolon
r_else
id|upa_writel
c_func
(paren
l_int|3
comma
op_amp
id|dac-&gt;value2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|ffb_pan_display
r_static
r_int
id|ffb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
multiline_comment|/* We just use this to catch switches out of&n;&t; * graphics mode.&n;&t; */
id|ffb_switch_from_graph
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
op_logical_or
id|var-&gt;yoffset
op_logical_or
id|var-&gt;vmode
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      ffb_fillrect - REQUIRED function. Can use generic routines if &n; *                     non acclerated hardware and packed pixel based.&n; *                     Draws a rectangle on the screen.               &n; *&n; *      @info: frame buffer structure that represents a single frame buffer&n; *      @rect: structure defining the rectagle and operation.&n; */
DECL|function|ffb_fillrect
r_static
r_void
id|ffb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|ffb_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|fg
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;rop
op_ne
id|ROP_COPY
op_logical_and
id|rect-&gt;rop
op_ne
id|ROP_XOR
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|ffb_log
c_func
(paren
id|OP_FILLRECT
comma
l_int|0
comma
id|rect-&gt;dx
comma
id|rect-&gt;dy
comma
id|rect-&gt;width
comma
id|rect-&gt;height
)paren
suffix:semicolon
id|fg
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|rect-&gt;color
)braket
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fg
op_ne
id|par-&gt;fg_cache
)paren
(brace
id|FFBFifo
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|fg
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
id|par-&gt;fg_cache
op_assign
id|fg
suffix:semicolon
)brace
id|ffb_rop
c_func
(paren
id|par
comma
(paren
id|rect-&gt;rop
op_eq
id|ROP_COPY
ques
c_cond
id|FFB_ROP_NEW
suffix:colon
id|FFB_ROP_NEW_XOR_OLD
)paren
)paren
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|5
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|FFB_DRAWOP_RECTANGLE
comma
op_amp
id|fbc-&gt;drawop
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|rect-&gt;dy
comma
op_amp
id|fbc-&gt;by
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|rect-&gt;dx
comma
op_amp
id|fbc-&gt;bx
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|rect-&gt;height
comma
op_amp
id|fbc-&gt;bh
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|rect-&gt;width
comma
op_amp
id|fbc-&gt;bw
)paren
suffix:semicolon
macro_line|#ifdef FORCE_WAIT_EVERY_ROP
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
macro_line|#endif
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *      ffb_copyarea - REQUIRED function. Can use generic routines if&n; *                     non acclerated hardware and packed pixel based.&n; *                     Copies on area of the screen to another area.&n; *&n; *      @info: frame buffer structure that represents a single frame buffer&n; *      @area: structure defining the source and destination.&n; */
r_static
r_void
DECL|function|ffb_copyarea
id|ffb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|area
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|ffb_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|area-&gt;dx
op_ne
id|area-&gt;sx
op_logical_or
id|area-&gt;dy
op_eq
id|area-&gt;dy
)paren
(brace
id|cfb_copyarea
c_func
(paren
id|info
comma
id|area
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ffb_rop
c_func
(paren
id|par
comma
id|FFB_ROP_OLD
)paren
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|7
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|FFB_DRAWOP_VSCROLL
comma
op_amp
id|fbc-&gt;drawop
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;sy
comma
op_amp
id|fbc-&gt;by
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;sx
comma
op_amp
id|fbc-&gt;bx
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;dy
comma
op_amp
id|fbc-&gt;dy
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;dx
comma
op_amp
id|fbc-&gt;dx
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;height
comma
op_amp
id|fbc-&gt;bh
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|area-&gt;width
comma
op_amp
id|fbc-&gt;bw
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *      ffb_imageblit - REQUIRED function. Can use generic routines if&n; *                      non acclerated hardware and packed pixel based.&n; *                      Copies a image from system memory to the screen. &n; *&n; *      @info: frame buffer structure that represents a single frame buffer&n; *      @image: structure defining the image.&n; */
DECL|function|ffb_imageblit
r_static
r_void
id|ffb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|ffb_fbc
op_star
id|fbc
op_assign
id|par-&gt;fbc
suffix:semicolon
r_const
id|u8
op_star
id|data
op_assign
id|image-&gt;data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|fg
comma
id|bg
comma
id|xy
suffix:semicolon
id|u64
id|fgbg
suffix:semicolon
r_int
id|i
comma
id|width
suffix:semicolon
id|ffb_log
c_func
(paren
id|OP_IMAGEBLIT
comma
id|image-&gt;depth
comma
id|image-&gt;dx
comma
id|image-&gt;dy
comma
id|image-&gt;width
comma
id|image-&gt;height
)paren
suffix:semicolon
r_if
c_cond
(paren
id|image-&gt;depth
OG
l_int|1
)paren
(brace
id|cfb_imageblit
c_func
(paren
id|info
comma
id|image
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fg
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;fg_color
)braket
suffix:semicolon
id|bg
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;bg_color
)braket
suffix:semicolon
id|fgbg
op_assign
(paren
(paren
id|u64
)paren
id|fg
op_lshift
l_int|32
)paren
op_or
(paren
id|u64
)paren
id|bg
suffix:semicolon
id|xy
op_assign
(paren
id|image-&gt;dy
op_lshift
l_int|16
)paren
op_or
id|image-&gt;dx
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fgbg
op_ne
op_star
(paren
id|u64
op_star
)paren
op_amp
id|par-&gt;fg_cache
)paren
(brace
id|FFBFifo
c_func
(paren
id|par
comma
l_int|2
)paren
suffix:semicolon
id|upa_writeq
c_func
(paren
id|fgbg
comma
op_amp
id|fbc-&gt;fg
)paren
suffix:semicolon
op_star
(paren
id|u64
op_star
)paren
op_amp
id|par-&gt;fg_cache
op_assign
id|fgbg
suffix:semicolon
)brace
id|ffb_rop
c_func
(paren
id|par
comma
id|FFB_ROP_NEW
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|image-&gt;height
suffix:semicolon
id|i
op_increment
)paren
(brace
id|width
op_assign
id|image-&gt;width
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|1
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|xy
comma
op_amp
id|fbc-&gt;fontxy
)paren
suffix:semicolon
id|xy
op_add_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
suffix:semicolon
r_while
c_loop
(paren
id|width
op_ge
l_int|32
)paren
(brace
id|u32
id|val
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|2
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|32
comma
op_amp
id|fbc-&gt;fontw
)paren
suffix:semicolon
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|3
)braket
op_lshift
l_int|0
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
id|width
op_sub_assign
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
)paren
(brace
id|u32
id|val
suffix:semicolon
id|FFBFifo
c_func
(paren
id|par
comma
l_int|2
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|width
comma
op_amp
id|fbc-&gt;fontw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
op_le
l_int|8
)paren
(brace
id|val
op_assign
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
suffix:semicolon
id|data
op_add_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|width
op_le
l_int|16
)paren
(brace
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
id|data
op_add_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|data
op_add_assign
l_int|3
suffix:semicolon
)brace
id|upa_writel
c_func
(paren
id|val
comma
op_amp
id|fbc-&gt;font
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef FORCE_WAIT_EVERY_ROP
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
macro_line|#endif
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|ffb_fixup_var_rgb
r_static
r_void
id|ffb_fixup_var_rgb
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      ffb_setcolreg - Optional function. Sets a color register.&n; *      @regno: boolean, 0 copy local, 1 get_user() function&n; *      @red: frame buffer colormap structure&n; *      @green: The green value which can be up to 16 bits wide&n; *      @blue:  The blue value which can be up to 16 bits wide.&n; *      @transp: If supported the alpha value which can be up to 16 bits wide.&n; *      @info: frame buffer info structure&n; */
DECL|function|ffb_setcolreg
r_static
r_int
id|ffb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
id|value
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
l_int|256
)paren
r_return
l_int|1
suffix:semicolon
id|red
op_rshift_assign
l_int|8
suffix:semicolon
id|green
op_rshift_assign
l_int|8
suffix:semicolon
id|blue
op_rshift_assign
l_int|8
suffix:semicolon
id|value
op_assign
(paren
id|blue
op_lshift
l_int|16
)paren
op_or
(paren
id|green
op_lshift
l_int|8
)paren
op_or
id|red
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *      ffb_blank - Optional function.  Blanks the display.&n; *      @blank_mode: the blank mode we want.&n; *      @info: frame buffer structure that represents a single frame buffer&n; */
r_static
r_int
DECL|function|ffb_blank
id|ffb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|ffb_dac
op_star
id|dac
op_assign
id|par-&gt;dac
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|FFBWait
c_func
(paren
id|par
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Unblanking */
id|upa_writel
c_func
(paren
l_int|0x6000
comma
op_amp
id|dac-&gt;type
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|upa_readl
c_func
(paren
op_amp
id|dac-&gt;value
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|0x6000
comma
op_amp
id|dac-&gt;type
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|tmp
comma
op_amp
id|dac-&gt;value
)paren
suffix:semicolon
id|par-&gt;flags
op_and_assign
op_complement
id|FFB_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Normal blanking */
r_case
l_int|2
suffix:colon
multiline_comment|/* VESA blank (vsync off) */
r_case
l_int|3
suffix:colon
multiline_comment|/* VESA blank (hsync off) */
r_case
l_int|4
suffix:colon
multiline_comment|/* Poweroff */
id|upa_writel
c_func
(paren
l_int|0x6000
comma
op_amp
id|dac-&gt;type
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|upa_readl
c_func
(paren
op_amp
id|dac-&gt;value
)paren
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|0x6000
comma
op_amp
id|dac-&gt;type
)paren
suffix:semicolon
id|upa_writel
c_func
(paren
id|tmp
comma
op_amp
id|dac-&gt;value
)paren
suffix:semicolon
id|par-&gt;flags
op_or_assign
id|FFB_FLAG_BLANKED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|par-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ffb_mmap_map
r_static
r_struct
id|sbus_mmap_map
id|ffb_mmap_map
(braket
)braket
op_assign
(brace
(brace
dot
id|voff
op_assign
id|FFB_SFB8R_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB8R_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB8G_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB8G_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB8B_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB8B_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB8X_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB8X_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB32_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB32_POFF
comma
dot
id|size
op_assign
l_int|0x1000000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB64_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB64_POFF
comma
dot
id|size
op_assign
l_int|0x2000000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_FBC_REGS_VOFF
comma
dot
id|poff
op_assign
id|FFB_FBC_REGS_POFF
comma
dot
id|size
op_assign
l_int|0x0002000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_BM_FBC_REGS_VOFF
comma
dot
id|poff
op_assign
id|FFB_BM_FBC_REGS_POFF
comma
dot
id|size
op_assign
l_int|0x0002000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB8R_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB8R_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB8G_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB8G_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB8B_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB8B_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB8X_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB8X_POFF
comma
dot
id|size
op_assign
l_int|0x0400000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB24_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB24_POFF
comma
dot
id|size
op_assign
l_int|0x1000000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB32_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB32_POFF
comma
dot
id|size
op_assign
l_int|0x1000000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_FBC_KREGS_VOFF
comma
dot
id|poff
op_assign
id|FFB_FBC_KREGS_POFF
comma
dot
id|size
op_assign
l_int|0x0002000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DAC_VOFF
comma
dot
id|poff
op_assign
id|FFB_DAC_POFF
comma
dot
id|size
op_assign
l_int|0x0002000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_PROM_VOFF
comma
dot
id|poff
op_assign
id|FFB_PROM_POFF
comma
dot
id|size
op_assign
l_int|0x0010000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_EXP_VOFF
comma
dot
id|poff
op_assign
id|FFB_EXP_POFF
comma
dot
id|size
op_assign
l_int|0x0002000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB422A_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB422A_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB422AD_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB422AD_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB24B_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB24B_POFF
comma
dot
id|size
op_assign
l_int|0x1000000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB422B_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB422B_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_DFB422BD_VOFF
comma
dot
id|poff
op_assign
id|FFB_DFB422BD_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB16Z_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB16Z_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB8Z_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB8Z_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB422_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB422_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|voff
op_assign
id|FFB_SFB422D_VOFF
comma
dot
id|poff
op_assign
id|FFB_SFB422D_POFF
comma
dot
id|size
op_assign
l_int|0x0800000
)brace
comma
(brace
dot
id|size
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|ffb_mmap
r_static
r_int
id|ffb_mmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_mmap_helper
c_func
(paren
id|ffb_mmap_map
comma
id|par-&gt;physbase
comma
id|par-&gt;fbsize
comma
l_int|0
comma
id|vma
)paren
suffix:semicolon
)brace
DECL|function|ffb_ioctl
r_static
r_int
id|ffb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_return
id|sbusfb_ioctl_helper
c_func
(paren
id|cmd
comma
id|arg
comma
id|info
comma
id|FBTYPE_CREATOR
comma
l_int|24
comma
id|par-&gt;fbsize
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Initialisation&n; */
r_static
r_void
DECL|function|ffb_init_fix
id|ffb_init_fix
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|ffb_par
op_star
id|par
op_assign
(paren
r_struct
id|ffb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_const
r_char
op_star
id|ffb_type_name
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;flags
op_amp
id|FFB_FLAG_AFB
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|par-&gt;board_type
op_amp
l_int|0x7
)paren
op_eq
l_int|0x3
)paren
id|ffb_type_name
op_assign
l_string|&quot;Creator 3D&quot;
suffix:semicolon
r_else
id|ffb_type_name
op_assign
l_string|&quot;Creator&quot;
suffix:semicolon
)brace
r_else
id|ffb_type_name
op_assign
l_string|&quot;Elite 3D&quot;
suffix:semicolon
id|strlcpy
c_func
(paren
id|info-&gt;fix.id
comma
id|ffb_type_name
comma
r_sizeof
(paren
id|info-&gt;fix.id
)paren
)paren
suffix:semicolon
id|info-&gt;fix.type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|info-&gt;fix.visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
multiline_comment|/* Framebuffer length is the same regardless of resolution. */
id|info-&gt;fix.line_length
op_assign
l_int|8192
suffix:semicolon
id|info-&gt;fix.accel
op_assign
id|FB_ACCEL_SUN_CREATOR
suffix:semicolon
)brace
DECL|function|ffb_apply_upa_parent_ranges
r_static
r_int
id|ffb_apply_upa_parent_ranges
c_func
(paren
r_int
id|parent
comma
r_struct
id|linux_prom64_registers
op_star
id|regs
)paren
(brace
r_struct
id|linux_prom64_ranges
id|ranges
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
r_char
id|name
(braket
l_int|128
)braket
suffix:semicolon
r_int
id|len
comma
id|i
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|parent
comma
l_string|&quot;name&quot;
comma
id|name
comma
r_sizeof
(paren
id|name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;upa&quot;
)paren
op_ne
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|parent
comma
l_string|&quot;ranges&quot;
comma
(paren
r_void
op_star
)paren
id|ranges
comma
r_sizeof
(paren
id|ranges
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
r_struct
id|linux_prom64_ranges
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|linux_prom64_ranges
op_star
id|rng
op_assign
op_amp
id|ranges
(braket
id|i
)braket
suffix:semicolon
id|u64
id|phys_addr
op_assign
id|regs-&gt;phys_addr
suffix:semicolon
r_if
c_cond
(paren
id|phys_addr
op_ge
id|rng-&gt;ot_child_base
op_logical_and
id|phys_addr
OL
(paren
id|rng-&gt;ot_child_base
op_plus
id|rng-&gt;or_size
)paren
)paren
(brace
id|regs-&gt;phys_addr
op_sub_assign
id|rng-&gt;ot_child_base
suffix:semicolon
id|regs-&gt;phys_addr
op_add_assign
id|rng-&gt;ot_parent_base
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|struct|all_info
r_struct
id|all_info
(brace
DECL|member|info
r_struct
id|fb_info
id|info
suffix:semicolon
DECL|member|par
r_struct
id|ffb_par
id|par
suffix:semicolon
DECL|member|pseudo_palette
id|u32
id|pseudo_palette
(braket
l_int|256
)braket
suffix:semicolon
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|ffb_list
)paren
suffix:semicolon
DECL|function|ffb_init_one
r_static
r_void
id|ffb_init_one
c_func
(paren
r_int
id|node
comma
r_int
id|parent
)paren
(brace
r_struct
id|linux_prom64_registers
id|regs
(braket
l_int|2
op_star
id|PROMREG_MAX
)braket
suffix:semicolon
r_struct
id|ffb_fbc
op_star
id|fbc
suffix:semicolon
r_struct
id|ffb_dac
op_star
id|dac
suffix:semicolon
r_struct
id|all_info
op_star
id|all
suffix:semicolon
r_if
c_cond
(paren
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ffb: Cannot get reg device node property.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ffb_apply_upa_parent_ranges
c_func
(paren
id|parent
comma
op_amp
id|regs
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ffb: Cannot apply parent ranges to regs.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|all
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|all
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|all
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ffb: Cannot allocate memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|all
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|all
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|all-&gt;list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|all-&gt;par.lock
)paren
suffix:semicolon
id|all-&gt;par.fbc
op_assign
(paren
r_struct
id|ffb_fbc
op_star
)paren
(paren
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
op_plus
id|FFB_FBC_REGS_POFF
)paren
suffix:semicolon
id|all-&gt;par.dac
op_assign
(paren
r_struct
id|ffb_dac
op_star
)paren
(paren
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
op_plus
id|FFB_DAC_POFF
)paren
suffix:semicolon
id|all-&gt;par.rop_cache
op_assign
id|FFB_ROP_NEW
suffix:semicolon
id|all-&gt;par.physbase
op_assign
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
suffix:semicolon
id|all-&gt;par.prom_node
op_assign
id|node
suffix:semicolon
id|all-&gt;par.prom_parent_node
op_assign
id|parent
suffix:semicolon
id|all-&gt;info.flags
op_assign
id|FBINFO_DEFAULT
suffix:semicolon
id|all-&gt;info.fbops
op_assign
op_amp
id|ffb_ops
suffix:semicolon
id|all-&gt;info.screen_base
op_assign
(paren
r_char
op_star
)paren
id|all-&gt;par.physbase
op_plus
id|FFB_DFB24_POFF
suffix:semicolon
id|all-&gt;info.currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|all-&gt;info.par
op_assign
op_amp
id|all-&gt;par
suffix:semicolon
id|all-&gt;info.pseudo_palette
op_assign
id|all-&gt;pseudo_palette
suffix:semicolon
id|sbusfb_fill_var
c_func
(paren
op_amp
id|all-&gt;info.var
comma
id|all-&gt;par.prom_node
comma
l_int|32
)paren
suffix:semicolon
id|all-&gt;par.fbsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|all-&gt;info.var.xres
op_star
id|all-&gt;info.var.yres
op_star
l_int|4
)paren
suffix:semicolon
id|ffb_fixup_var_rgb
c_func
(paren
op_amp
id|all-&gt;info.var
)paren
suffix:semicolon
id|all-&gt;info.var.accel_flags
op_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|prom_getstring
c_func
(paren
id|node
comma
l_string|&quot;name&quot;
comma
id|all-&gt;par.name
comma
r_sizeof
(paren
id|all-&gt;par.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|all-&gt;par.name
comma
l_string|&quot;SUNW,afb&quot;
)paren
)paren
id|all-&gt;par.flags
op_or_assign
id|FFB_FLAG_AFB
suffix:semicolon
id|all-&gt;par.board_type
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;board_type&quot;
comma
l_int|0
)paren
suffix:semicolon
id|fbc
op_assign
id|all-&gt;par.fbc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|upa_readl
c_func
(paren
op_amp
id|fbc-&gt;ucsr
)paren
op_amp
id|FFB_UCSR_ALL_ERRORS
)paren
op_ne
l_int|0
)paren
(brace
id|upa_writel
c_func
(paren
id|FFB_UCSR_ALL_ERRORS
comma
op_amp
id|fbc-&gt;ucsr
)paren
suffix:semicolon
)brace
id|ffb_switch_from_graph
c_func
(paren
op_amp
id|all-&gt;par
)paren
suffix:semicolon
id|dac
op_assign
id|all-&gt;par.dac
suffix:semicolon
id|upa_writel
c_func
(paren
l_int|0x8000
comma
op_amp
id|dac-&gt;type
)paren
suffix:semicolon
id|all-&gt;par.dac_rev
op_assign
id|upa_readl
c_func
(paren
op_amp
id|dac-&gt;value
)paren
op_rshift
l_int|0x1c
suffix:semicolon
multiline_comment|/* Elite3D has different DAC revision numbering, and no DAC revisions&n;&t; * have the reversed meaning of cursor enable.&n;&t; */
r_if
c_cond
(paren
id|all-&gt;par.flags
op_amp
id|FFB_FLAG_AFB
)paren
id|all-&gt;par.dac_rev
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Unblank it just to be sure.  When there are multiple&n;&t; * FFB/AFB cards in the system, or it is not the OBP&n;&t; * chosen console, it will have video outputs off in&n;&t; * the DAC.&n;&t; */
id|ffb_blank
c_func
(paren
l_int|0
comma
op_amp
id|all-&gt;info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_alloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
comma
l_int|256
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ffb: Could not allocate color map.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ffb_init_fix
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ffb: Could not register framebuffer.&bslash;n&quot;
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|all-&gt;list
comma
op_amp
id|ffb_list
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ffb: %s at %016lx type %d DAC %d&bslash;n&quot;
comma
(paren
(paren
id|all-&gt;par.flags
op_amp
id|FFB_FLAG_AFB
)paren
ques
c_cond
l_string|&quot;AFB&quot;
suffix:colon
l_string|&quot;FFB&quot;
)paren
comma
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
id|all-&gt;par.board_type
comma
id|all-&gt;par.dac_rev
)paren
suffix:semicolon
)brace
DECL|function|ffb_scan_siblings
r_static
r_void
id|ffb_scan_siblings
c_func
(paren
r_int
id|root
)paren
(brace
r_int
id|node
comma
id|child
suffix:semicolon
id|child
op_assign
id|prom_getchild
c_func
(paren
id|root
)paren
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|child
comma
l_string|&quot;SUNW,ffb&quot;
)paren
suffix:semicolon
id|node
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|prom_getsibling
c_func
(paren
id|node
)paren
comma
l_string|&quot;SUNW,ffb&quot;
)paren
)paren
id|ffb_init_one
c_func
(paren
id|node
comma
id|root
)paren
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|child
comma
l_string|&quot;SUNW,afb&quot;
)paren
suffix:semicolon
id|node
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|prom_getsibling
c_func
(paren
id|node
)paren
comma
l_string|&quot;SUNW,afb&quot;
)paren
)paren
id|ffb_init_one
c_func
(paren
id|node
comma
id|root
)paren
suffix:semicolon
)brace
DECL|function|ffb_init
r_int
id|__init
id|ffb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|root
suffix:semicolon
id|ffb_scan_siblings
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|root
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
r_for
c_loop
(paren
id|root
op_assign
id|prom_searchsiblings
c_func
(paren
id|root
comma
l_string|&quot;upa&quot;
)paren
suffix:semicolon
id|root
suffix:semicolon
id|root
op_assign
id|prom_searchsiblings
c_func
(paren
id|prom_getsibling
c_func
(paren
id|root
)paren
comma
l_string|&quot;upa&quot;
)paren
)paren
id|ffb_scan_siblings
c_func
(paren
id|root
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ffb_exit
r_void
id|__exit
id|ffb_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|tmp
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|pos
comma
id|tmp
comma
op_amp
id|ffb_list
)paren
(brace
r_struct
id|all_info
op_star
id|all
op_assign
id|list_entry
c_func
(paren
id|pos
comma
id|typeof
c_func
(paren
op_star
id|all
)paren
comma
id|list
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
op_amp
id|all-&gt;info
)paren
suffix:semicolon
id|fb_dealloc_cmap
c_func
(paren
op_amp
id|all-&gt;info.cmap
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|all
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|ffb_setup
id|ffb_setup
c_func
(paren
r_char
op_star
id|arg
)paren
(brace
multiline_comment|/* No cmdline options yet... */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|ffb_init
id|module_init
c_func
(paren
id|ffb_init
)paren
suffix:semicolon
DECL|variable|ffb_exit
id|module_exit
c_func
(paren
id|ffb_exit
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;framebuffer driver for Creator/Elite3D chipsets&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller &lt;davem@redhat.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
