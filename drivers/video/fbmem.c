multiline_comment|/*&n; *  linux/drivers/video/fbmem.c&n; *&n; *  Copyright (C) 1994 Martin Schaller&n; *&n; *&t;2001 - Documented with DocBook&n; *&t;- Brad Douglas &lt;brad@neruo.com&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/linux_logo.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#ifdef CONFIG_KMOD
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#if defined(__mc68000__) || defined(CONFIG_APUS)
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
multiline_comment|/*&n;     *  Frame buffer device initialization and setup routines&n;     */
DECL|macro|FBPIXMAPSIZE
mdefine_line|#define FBPIXMAPSIZE&t;(1024 * 8)
DECL|variable|fb_notifier_list
r_static
r_struct
id|notifier_block
op_star
id|fb_notifier_list
suffix:semicolon
DECL|variable|registered_fb
r_struct
id|fb_info
op_star
id|registered_fb
(braket
id|FB_MAX
)braket
suffix:semicolon
DECL|variable|num_registered_fb
r_int
id|num_registered_fb
suffix:semicolon
multiline_comment|/*&n; * Helpers&n; */
DECL|function|fb_get_color_depth
r_int
id|fb_get_color_depth
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|info-&gt;var
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
id|var-&gt;blue.length
op_logical_and
id|var-&gt;green.length
op_eq
id|var-&gt;red.length
op_logical_and
op_logical_neg
id|var-&gt;green.offset
op_logical_and
op_logical_neg
id|var-&gt;blue.offset
op_logical_and
op_logical_neg
id|var-&gt;red.offset
)paren
r_return
id|var-&gt;green.length
suffix:semicolon
r_else
r_return
(paren
id|var-&gt;green.length
op_plus
id|var-&gt;red.length
op_plus
id|var-&gt;blue.length
)paren
suffix:semicolon
)brace
DECL|variable|fb_get_color_depth
id|EXPORT_SYMBOL
c_func
(paren
id|fb_get_color_depth
)paren
suffix:semicolon
multiline_comment|/*&n; * Drawing helpers.&n; */
DECL|function|fb_iomove_buf_aligned
r_void
id|fb_iomove_buf_aligned
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_pixmap
op_star
id|buf
comma
id|u8
op_star
id|dst
comma
id|u32
id|d_pitch
comma
id|u8
op_star
id|src
comma
id|u32
id|s_pitch
comma
id|u32
id|height
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|buf
op_member_access_from_pointer
id|outbuf
c_func
(paren
id|info
comma
id|dst
comma
id|src
comma
id|s_pitch
)paren
suffix:semicolon
id|src
op_add_assign
id|s_pitch
suffix:semicolon
id|dst
op_add_assign
id|d_pitch
suffix:semicolon
)brace
)brace
DECL|function|fb_sysmove_buf_aligned
r_void
id|fb_sysmove_buf_aligned
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_pixmap
op_star
id|buf
comma
id|u8
op_star
id|dst
comma
id|u32
id|d_pitch
comma
id|u8
op_star
id|src
comma
id|u32
id|s_pitch
comma
id|u32
id|height
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|s_pitch
suffix:semicolon
id|j
op_increment
)paren
id|dst
(braket
id|j
)braket
op_assign
id|src
(braket
id|j
)braket
suffix:semicolon
id|src
op_add_assign
id|s_pitch
suffix:semicolon
id|dst
op_add_assign
id|d_pitch
suffix:semicolon
)brace
)brace
DECL|function|fb_iomove_buf_unaligned
r_void
id|fb_iomove_buf_unaligned
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_pixmap
op_star
id|buf
comma
id|u8
op_star
id|dst
comma
id|u32
id|d_pitch
comma
id|u8
op_star
id|src
comma
id|u32
id|idx
comma
id|u32
id|height
comma
id|u32
id|shift_high
comma
id|u32
id|shift_low
comma
id|u32
id|mod
)paren
(brace
id|u8
id|mask
op_assign
(paren
id|u8
)paren
(paren
l_int|0xfff
op_lshift
id|shift_high
)paren
comma
id|tmp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|idx
suffix:semicolon
id|j
op_increment
)paren
(brace
id|tmp
op_assign
id|buf
op_member_access_from_pointer
id|inbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|j
)paren
suffix:semicolon
id|tmp
op_and_assign
id|mask
suffix:semicolon
id|tmp
op_or_assign
op_star
id|src
op_rshift
id|shift_low
suffix:semicolon
id|buf
op_member_access_from_pointer
id|outbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|j
comma
op_amp
id|tmp
comma
l_int|1
)paren
suffix:semicolon
id|tmp
op_assign
op_star
id|src
op_lshift
id|shift_high
suffix:semicolon
id|buf
op_member_access_from_pointer
id|outbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|j
op_plus
l_int|1
comma
op_amp
id|tmp
comma
l_int|1
)paren
suffix:semicolon
id|src
op_increment
suffix:semicolon
)brace
id|tmp
op_assign
id|buf
op_member_access_from_pointer
id|inbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|idx
)paren
suffix:semicolon
id|tmp
op_and_assign
id|mask
suffix:semicolon
id|tmp
op_or_assign
op_star
id|src
op_rshift
id|shift_low
suffix:semicolon
id|buf
op_member_access_from_pointer
id|outbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|idx
comma
op_amp
id|tmp
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shift_high
OL
id|mod
)paren
(brace
id|tmp
op_assign
op_star
id|src
op_lshift
id|shift_high
suffix:semicolon
id|buf
op_member_access_from_pointer
id|outbuf
c_func
(paren
id|info
comma
id|dst
op_plus
id|idx
op_plus
l_int|1
comma
op_amp
id|tmp
comma
l_int|1
)paren
suffix:semicolon
)brace
id|src
op_increment
suffix:semicolon
id|dst
op_add_assign
id|d_pitch
suffix:semicolon
)brace
)brace
DECL|function|fb_sysmove_buf_unaligned
r_void
id|fb_sysmove_buf_unaligned
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_pixmap
op_star
id|buf
comma
id|u8
op_star
id|dst
comma
id|u32
id|d_pitch
comma
id|u8
op_star
id|src
comma
id|u32
id|idx
comma
id|u32
id|height
comma
id|u32
id|shift_high
comma
id|u32
id|shift_low
comma
id|u32
id|mod
)paren
(brace
id|u8
id|mask
op_assign
(paren
id|u8
)paren
(paren
l_int|0xfff
op_lshift
id|shift_high
)paren
comma
id|tmp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|idx
suffix:semicolon
id|j
op_increment
)paren
(brace
id|tmp
op_assign
id|dst
(braket
id|j
)braket
suffix:semicolon
id|tmp
op_and_assign
id|mask
suffix:semicolon
id|tmp
op_or_assign
op_star
id|src
op_rshift
id|shift_low
suffix:semicolon
id|dst
(braket
id|j
)braket
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
op_star
id|src
op_lshift
id|shift_high
suffix:semicolon
id|dst
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
id|src
op_increment
suffix:semicolon
)brace
id|tmp
op_assign
id|dst
(braket
id|idx
)braket
suffix:semicolon
id|tmp
op_and_assign
id|mask
suffix:semicolon
id|tmp
op_or_assign
op_star
id|src
op_rshift
id|shift_low
suffix:semicolon
id|dst
(braket
id|idx
)braket
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|shift_high
OL
id|mod
)paren
(brace
id|tmp
op_assign
op_star
id|src
op_lshift
id|shift_high
suffix:semicolon
id|dst
(braket
id|idx
op_plus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
)brace
id|src
op_increment
suffix:semicolon
id|dst
op_add_assign
id|d_pitch
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * we need to lock this section since fb_cursor&n; * may use fb_imageblit()&n; */
DECL|function|fb_get_buffer_offset
r_char
op_star
id|fb_get_buffer_offset
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_pixmap
op_star
id|buf
comma
id|u32
id|size
)paren
(brace
id|u32
id|align
op_assign
id|buf-&gt;buf_align
op_minus
l_int|1
comma
id|offset
suffix:semicolon
r_char
op_star
id|addr
op_assign
id|buf-&gt;addr
suffix:semicolon
multiline_comment|/* If IO mapped, we need to sync before access, no sharing of&n;&t; * the pixmap is done&n;&t; */
r_if
c_cond
(paren
id|buf-&gt;flags
op_amp
id|FB_PIXMAP_IO
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_sync
op_logical_and
(paren
id|buf-&gt;flags
op_amp
id|FB_PIXMAP_SYNC
)paren
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_sync
c_func
(paren
id|info
)paren
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
multiline_comment|/* See if we fit in the remaining pixmap space */
id|offset
op_assign
id|buf-&gt;offset
op_plus
id|align
suffix:semicolon
id|offset
op_and_assign
op_complement
id|align
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
id|size
OG
id|buf-&gt;size
)paren
(brace
multiline_comment|/* We do not fit. In order to be able to re-use the buffer,&n;&t;&t; * we must ensure no asynchronous DMA&squot;ing or whatever operation&n;&t;&t; * is in progress, we sync for that.&n;&t;&t; */
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_sync
op_logical_and
(paren
id|buf-&gt;flags
op_amp
id|FB_PIXMAP_SYNC
)paren
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_sync
c_func
(paren
id|info
)paren
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
)brace
id|buf-&gt;offset
op_assign
id|offset
op_plus
id|size
suffix:semicolon
id|addr
op_add_assign
id|offset
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_LOGO
macro_line|#include &lt;linux/linux_logo.h&gt;
DECL|function|safe_shift
r_static
r_inline
r_int
id|safe_shift
c_func
(paren
r_int
id|d
comma
r_int
id|n
)paren
(brace
r_return
id|n
OL
l_int|0
ques
c_cond
id|d
op_rshift
op_minus
id|n
suffix:colon
id|d
op_lshift
id|n
suffix:semicolon
)brace
DECL|function|fb_set_logocmap
r_static
r_void
id|fb_set_logocmap
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|linux_logo
op_star
id|logo
)paren
(brace
r_struct
id|fb_cmap
id|palette_cmap
suffix:semicolon
id|u16
id|palette_green
(braket
l_int|16
)braket
suffix:semicolon
id|u16
id|palette_blue
(braket
l_int|16
)braket
suffix:semicolon
id|u16
id|palette_red
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
r_const
r_int
r_char
op_star
id|clut
op_assign
id|logo-&gt;clut
suffix:semicolon
id|palette_cmap.start
op_assign
l_int|0
suffix:semicolon
id|palette_cmap.len
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.red
op_assign
id|palette_red
suffix:semicolon
id|palette_cmap.green
op_assign
id|palette_green
suffix:semicolon
id|palette_cmap.blue
op_assign
id|palette_blue
suffix:semicolon
id|palette_cmap.transp
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo-&gt;clutsize
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|n
op_assign
id|logo-&gt;clutsize
op_minus
id|i
suffix:semicolon
multiline_comment|/* palette_cmap provides space for only 16 colors at once */
r_if
c_cond
(paren
id|n
OG
l_int|16
)paren
id|n
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.start
op_assign
l_int|32
op_plus
id|i
suffix:semicolon
id|palette_cmap.len
op_assign
id|n
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
op_increment
id|j
)paren
(brace
id|palette_cmap.red
(braket
id|j
)braket
op_assign
id|clut
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|clut
(braket
l_int|0
)braket
suffix:semicolon
id|palette_cmap.green
(braket
id|j
)braket
op_assign
id|clut
(braket
l_int|1
)braket
op_lshift
l_int|8
op_or
id|clut
(braket
l_int|1
)braket
suffix:semicolon
id|palette_cmap.blue
(braket
id|j
)braket
op_assign
id|clut
(braket
l_int|2
)braket
op_lshift
l_int|8
op_or
id|clut
(braket
l_int|2
)braket
suffix:semicolon
id|clut
op_add_assign
l_int|3
suffix:semicolon
)brace
id|fb_set_cmap
c_func
(paren
op_amp
id|palette_cmap
comma
id|info
)paren
suffix:semicolon
)brace
)brace
DECL|function|fb_set_logo_truepalette
r_static
r_void
id|fb_set_logo_truepalette
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|linux_logo
op_star
id|logo
comma
id|u32
op_star
id|palette
)paren
(brace
r_int
r_char
id|mask
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
l_int|0x80
comma
l_int|0xc0
comma
l_int|0xe0
comma
l_int|0xf0
comma
l_int|0xf8
comma
l_int|0xfc
comma
l_int|0xfe
comma
l_int|0xff
)brace
suffix:semicolon
r_int
r_char
id|redmask
comma
id|greenmask
comma
id|bluemask
suffix:semicolon
r_int
id|redshift
comma
id|greenshift
comma
id|blueshift
suffix:semicolon
r_int
id|i
suffix:semicolon
r_const
r_int
r_char
op_star
id|clut
op_assign
id|logo-&gt;clut
suffix:semicolon
multiline_comment|/*&n;&t; * We have to create a temporary palette since console palette is only&n;&t; * 16 colors long.&n;&t; */
multiline_comment|/* Bug: Doesn&squot;t obey msb_right ... (who needs that?) */
id|redmask
op_assign
id|mask
(braket
id|info-&gt;var.red.length
OL
l_int|8
ques
c_cond
id|info-&gt;var.red.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|greenmask
op_assign
id|mask
(braket
id|info-&gt;var.green.length
OL
l_int|8
ques
c_cond
id|info-&gt;var.green.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|bluemask
op_assign
id|mask
(braket
id|info-&gt;var.blue.length
OL
l_int|8
ques
c_cond
id|info-&gt;var.blue.length
suffix:colon
l_int|8
)braket
suffix:semicolon
id|redshift
op_assign
id|info-&gt;var.red.offset
op_minus
(paren
l_int|8
op_minus
id|info-&gt;var.red.length
)paren
suffix:semicolon
id|greenshift
op_assign
id|info-&gt;var.green.offset
op_minus
(paren
l_int|8
op_minus
id|info-&gt;var.green.length
)paren
suffix:semicolon
id|blueshift
op_assign
id|info-&gt;var.blue.offset
op_minus
(paren
l_int|8
op_minus
id|info-&gt;var.blue.length
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo-&gt;clutsize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|palette
(braket
id|i
op_plus
l_int|32
)braket
op_assign
(paren
id|safe_shift
c_func
(paren
(paren
id|clut
(braket
l_int|0
)braket
op_amp
id|redmask
)paren
comma
id|redshift
)paren
op_or
id|safe_shift
c_func
(paren
(paren
id|clut
(braket
l_int|1
)braket
op_amp
id|greenmask
)paren
comma
id|greenshift
)paren
op_or
id|safe_shift
c_func
(paren
(paren
id|clut
(braket
l_int|2
)braket
op_amp
id|bluemask
)paren
comma
id|blueshift
)paren
)paren
suffix:semicolon
id|clut
op_add_assign
l_int|3
suffix:semicolon
)brace
)brace
DECL|function|fb_set_logo_directpalette
r_static
r_void
id|fb_set_logo_directpalette
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|linux_logo
op_star
id|logo
comma
id|u32
op_star
id|palette
)paren
(brace
r_int
id|redshift
comma
id|greenshift
comma
id|blueshift
suffix:semicolon
r_int
id|i
suffix:semicolon
id|redshift
op_assign
id|info-&gt;var.red.offset
suffix:semicolon
id|greenshift
op_assign
id|info-&gt;var.green.offset
suffix:semicolon
id|blueshift
op_assign
id|info-&gt;var.blue.offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|32
suffix:semicolon
id|i
OL
id|logo-&gt;clutsize
suffix:semicolon
id|i
op_increment
)paren
id|palette
(braket
id|i
)braket
op_assign
id|i
op_lshift
id|redshift
op_or
id|i
op_lshift
id|greenshift
op_or
id|i
op_lshift
id|blueshift
suffix:semicolon
)brace
DECL|function|fb_set_logo
r_static
r_void
id|fb_set_logo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|linux_logo
op_star
id|logo
comma
id|u8
op_star
id|dst
comma
r_int
id|depth
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
comma
id|fg
op_assign
l_int|1
suffix:semicolon
r_const
id|u8
op_star
id|src
op_assign
id|logo-&gt;data
suffix:semicolon
id|u8
id|d
comma
op_xor
op_assign
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_MONO01
)paren
ques
c_cond
l_int|0xff
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_color_depth
c_func
(paren
id|info
)paren
op_eq
l_int|3
)paren
id|fg
op_assign
l_int|7
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|4
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo-&gt;height
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|logo-&gt;width
suffix:semicolon
id|src
op_increment
)paren
(brace
op_star
id|dst
op_increment
op_assign
op_star
id|src
op_rshift
l_int|4
suffix:semicolon
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|j
OL
id|logo-&gt;width
)paren
(brace
op_star
id|dst
op_increment
op_assign
op_star
id|src
op_amp
l_int|0x0f
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo-&gt;height
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|logo-&gt;width
suffix:semicolon
id|src
op_increment
)paren
(brace
id|d
op_assign
op_star
id|src
op_xor
op_xor
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|7
suffix:semicolon
id|k
op_ge
l_int|0
suffix:semicolon
id|k
op_decrement
)paren
(brace
op_star
id|dst
op_increment
op_assign
(paren
(paren
id|d
op_rshift
id|k
)paren
op_amp
l_int|1
)paren
ques
c_cond
id|fg
suffix:colon
l_int|0
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Three (3) kinds of logo maps exist.  linux_logo_clut224 (&gt;16 colors),&n; * linux_logo_vga16 (16 colors) and linux_logo_mono (2 colors).  Depending on&n; * the visual format and color depth of the framebuffer, the DAC, the&n; * pseudo_palette, and the logo data will be adjusted accordingly.&n; *&n; * Case 1 - linux_logo_clut224:&n; * Color exceeds the number of console colors (16), thus we set the hardware DAC&n; * using fb_set_cmap() appropriately.  The &quot;needs_cmapreset&quot;  flag will be set.&n; *&n; * For visuals that require color info from the pseudo_palette, we also construct&n; * one for temporary use. The &quot;needs_directpalette&quot; or &quot;needs_truepalette&quot; flags&n; * will be set.&n; *&n; * Case 2 - linux_logo_vga16:&n; * The number of colors just matches the console colors, thus there is no need&n; * to set the DAC or the pseudo_palette.  However, the bitmap is packed, ie,&n; * each byte contains color information for two pixels (upper and lower nibble).&n; * To be consistent with fb_imageblit() usage, we therefore separate the two&n; * nibbles into separate bytes. The &quot;depth&quot; flag will be set to 4.&n; *&n; * Case 3 - linux_logo_mono:&n; * This is similar with Case 2.  Each byte contains information for 8 pixels.&n; * We isolate each bit and expand each into a byte. The &quot;depth&quot; flag will&n; * be set to 1.&n; */
DECL|struct|logo_data
r_static
r_struct
id|logo_data
(brace
DECL|member|depth
r_int
id|depth
suffix:semicolon
DECL|member|needs_directpalette
r_int
id|needs_directpalette
suffix:semicolon
DECL|member|needs_truepalette
r_int
id|needs_truepalette
suffix:semicolon
DECL|member|needs_cmapreset
r_int
id|needs_cmapreset
suffix:semicolon
DECL|member|logo
r_const
r_struct
id|linux_logo
op_star
id|logo
suffix:semicolon
DECL|variable|fb_logo
)brace
id|fb_logo
suffix:semicolon
DECL|function|fb_prepare_logo
r_int
id|fb_prepare_logo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|depth
op_assign
id|fb_get_color_depth
c_func
(paren
id|info
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fb_logo
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|logo_data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_MISC_TILEBLITTING
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
id|depth
op_assign
id|info-&gt;var.blue.length
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.red.length
OL
id|depth
)paren
id|depth
op_assign
id|info-&gt;var.red.length
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.green.length
OL
id|depth
)paren
id|depth
op_assign
id|info-&gt;var.green.length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|depth
op_ge
l_int|8
)paren
(brace
r_switch
c_cond
(paren
id|info-&gt;fix.visual
)paren
(brace
r_case
id|FB_VISUAL_TRUECOLOR
suffix:colon
id|fb_logo.needs_truepalette
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_VISUAL_DIRECTCOLOR
suffix:colon
id|fb_logo.needs_directpalette
op_assign
l_int|1
suffix:semicolon
id|fb_logo.needs_cmapreset
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|fb_logo.needs_cmapreset
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Return if no suitable logo was found */
id|fb_logo.logo
op_assign
id|fb_find_logo
c_func
(paren
id|depth
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_logo.logo
op_logical_or
id|fb_logo.logo-&gt;height
OG
id|info-&gt;var.yres
)paren
(brace
id|fb_logo.logo
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* What depth we asked for might be different from what we get */
r_if
c_cond
(paren
id|fb_logo.logo-&gt;type
op_eq
id|LINUX_LOGO_CLUT224
)paren
id|fb_logo.depth
op_assign
l_int|8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fb_logo.logo-&gt;type
op_eq
id|LINUX_LOGO_VGA16
)paren
id|fb_logo.depth
op_assign
l_int|4
suffix:semicolon
r_else
id|fb_logo.depth
op_assign
l_int|1
suffix:semicolon
r_return
id|fb_logo.logo-&gt;height
suffix:semicolon
)brace
DECL|function|fb_show_logo
r_int
id|fb_show_logo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
op_star
id|palette
op_assign
l_int|NULL
comma
op_star
id|saved_pseudo_palette
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|logo_new
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fb_image
id|image
suffix:semicolon
r_int
id|x
suffix:semicolon
multiline_comment|/* Return if the frame buffer is not mapped or suspended */
r_if
c_cond
(paren
id|fb_logo.logo
op_eq
l_int|NULL
op_logical_or
id|info-&gt;state
op_ne
id|FBINFO_STATE_RUNNING
)paren
r_return
l_int|0
suffix:semicolon
id|image.depth
op_assign
l_int|8
suffix:semicolon
id|image.data
op_assign
id|fb_logo.logo-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|fb_logo.needs_cmapreset
)paren
id|fb_set_logocmap
c_func
(paren
id|info
comma
id|fb_logo.logo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_logo.needs_truepalette
op_logical_or
id|fb_logo.needs_directpalette
)paren
(brace
id|palette
op_assign
id|kmalloc
c_func
(paren
l_int|256
op_star
l_int|4
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|palette
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fb_logo.needs_truepalette
)paren
id|fb_set_logo_truepalette
c_func
(paren
id|info
comma
id|fb_logo.logo
comma
id|palette
)paren
suffix:semicolon
r_else
id|fb_set_logo_directpalette
c_func
(paren
id|info
comma
id|fb_logo.logo
comma
id|palette
)paren
suffix:semicolon
id|saved_pseudo_palette
op_assign
id|info-&gt;pseudo_palette
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|palette
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb_logo.depth
op_le
l_int|4
)paren
(brace
id|logo_new
op_assign
id|kmalloc
c_func
(paren
id|fb_logo.logo-&gt;width
op_star
id|fb_logo.logo-&gt;height
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo_new
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|palette
)paren
id|kfree
c_func
(paren
id|palette
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved_pseudo_palette
)paren
id|info-&gt;pseudo_palette
op_assign
id|saved_pseudo_palette
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|image.data
op_assign
id|logo_new
suffix:semicolon
id|fb_set_logo
c_func
(paren
id|info
comma
id|fb_logo.logo
comma
id|logo_new
comma
id|fb_logo.depth
)paren
suffix:semicolon
)brace
id|image.width
op_assign
id|fb_logo.logo-&gt;width
suffix:semicolon
id|image.height
op_assign
id|fb_logo.logo-&gt;height
suffix:semicolon
id|image.dy
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|num_online_cpus
c_func
(paren
)paren
op_star
(paren
id|fb_logo.logo-&gt;width
op_plus
l_int|8
)paren
op_logical_and
id|x
op_le
id|info-&gt;var.xres
op_minus
id|fb_logo.logo-&gt;width
suffix:semicolon
id|x
op_add_assign
(paren
id|fb_logo.logo-&gt;width
op_plus
l_int|8
)paren
)paren
(brace
id|image.dx
op_assign
id|x
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_imageblit
c_func
(paren
id|info
comma
op_amp
id|image
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|palette
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|palette
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved_pseudo_palette
op_ne
l_int|NULL
)paren
id|info-&gt;pseudo_palette
op_assign
id|saved_pseudo_palette
suffix:semicolon
r_if
c_cond
(paren
id|logo_new
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|logo_new
)paren
suffix:semicolon
r_return
id|fb_logo.logo-&gt;height
suffix:semicolon
)brace
macro_line|#else
DECL|function|fb_prepare_logo
r_int
id|fb_prepare_logo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fb_show_logo
r_int
id|fb_show_logo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_LOGO */
DECL|function|fbmem_read_proc
r_static
r_int
id|fbmem_read_proc
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
r_private
)paren
(brace
r_struct
id|fb_info
op_star
op_star
id|fi
suffix:semicolon
r_int
id|clen
suffix:semicolon
id|clen
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|fi
op_assign
id|registered_fb
suffix:semicolon
id|fi
OL
op_amp
id|registered_fb
(braket
id|FB_MAX
)braket
op_logical_and
id|len
OL
l_int|4000
suffix:semicolon
id|fi
op_increment
)paren
r_if
c_cond
(paren
op_star
id|fi
)paren
id|clen
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|clen
comma
l_string|&quot;%d %s&bslash;n&quot;
comma
(paren
op_star
id|fi
)paren
op_member_access_from_pointer
id|node
comma
(paren
op_star
id|fi
)paren
op_member_access_from_pointer
id|fix.id
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buf
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|clen
OG
id|offset
)paren
id|clen
op_sub_assign
id|offset
suffix:semicolon
r_else
id|clen
op_assign
l_int|0
suffix:semicolon
r_return
id|clen
OL
id|len
ques
c_cond
id|clen
suffix:colon
id|len
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|fb_read
id|fb_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
r_int
id|p
op_assign
op_star
id|ppos
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
id|u32
op_star
id|buffer
comma
op_star
id|dst
suffix:semicolon
id|u32
id|__iomem
op_star
id|src
suffix:semicolon
r_int
id|c
comma
id|i
comma
id|cnt
op_assign
l_int|0
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|total_size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|info-&gt;screen_base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;state
op_ne
id|FBINFO_STATE_RUNNING
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_read
)paren
r_return
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_read
c_func
(paren
id|file
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
id|total_size
op_assign
id|info-&gt;screen_size
suffix:semicolon
r_if
c_cond
(paren
id|total_size
op_eq
l_int|0
)paren
id|total_size
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|total_size
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|total_size
)paren
id|count
op_assign
id|total_size
suffix:semicolon
r_if
c_cond
(paren
id|count
op_plus
id|p
OG
id|total_size
)paren
id|count
op_assign
id|total_size
op_minus
id|p
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
(paren
id|count
OG
id|PAGE_SIZE
)paren
ques
c_cond
id|PAGE_SIZE
suffix:colon
id|count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|src
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
(paren
id|info-&gt;screen_base
op_plus
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_sync
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_sync
c_func
(paren
id|info
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|c
op_assign
(paren
id|count
OG
id|PAGE_SIZE
)paren
ques
c_cond
id|PAGE_SIZE
suffix:colon
id|count
suffix:semicolon
id|dst
op_assign
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|c
op_rshift
l_int|2
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
op_star
id|dst
op_increment
op_assign
id|fb_readl
c_func
(paren
id|src
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_amp
l_int|3
)paren
(brace
id|u8
op_star
id|dst8
op_assign
(paren
id|u8
op_star
)paren
id|dst
suffix:semicolon
id|u8
id|__iomem
op_star
id|src8
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|src
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|c
op_amp
l_int|3
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
op_star
id|dst8
op_increment
op_assign
id|fb_readb
c_func
(paren
id|src8
op_increment
)paren
suffix:semicolon
id|src
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
id|src8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|buffer
comma
id|c
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
op_star
id|ppos
op_add_assign
id|c
suffix:semicolon
id|buf
op_add_assign
id|c
suffix:semicolon
id|cnt
op_add_assign
id|c
suffix:semicolon
id|count
op_sub_assign
id|c
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
ques
c_cond
id|err
suffix:colon
id|cnt
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|fb_write
id|fb_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
r_int
id|p
op_assign
op_star
id|ppos
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
id|u32
op_star
id|buffer
comma
op_star
id|src
suffix:semicolon
id|u32
id|__iomem
op_star
id|dst
suffix:semicolon
r_int
id|c
comma
id|i
comma
id|cnt
op_assign
l_int|0
comma
id|err
suffix:semicolon
r_int
r_int
id|total_size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|info-&gt;screen_base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;state
op_ne
id|FBINFO_STATE_RUNNING
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_write
)paren
r_return
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_write
c_func
(paren
id|file
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
id|total_size
op_assign
id|info-&gt;screen_size
suffix:semicolon
r_if
c_cond
(paren
id|total_size
op_eq
l_int|0
)paren
id|total_size
op_assign
id|info-&gt;fix.smem_len
suffix:semicolon
r_if
c_cond
(paren
id|p
OG
id|total_size
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|total_size
)paren
id|count
op_assign
id|total_size
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_plus
id|p
OG
id|total_size
)paren
(brace
id|count
op_assign
id|total_size
op_minus
id|p
suffix:semicolon
id|err
op_assign
op_minus
id|ENOSPC
suffix:semicolon
)brace
id|cnt
op_assign
l_int|0
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
(paren
id|count
OG
id|PAGE_SIZE
)paren
ques
c_cond
id|PAGE_SIZE
suffix:colon
id|count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dst
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
(paren
id|info-&gt;screen_base
op_plus
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_sync
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_sync
c_func
(paren
id|info
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|c
op_assign
(paren
id|count
OG
id|PAGE_SIZE
)paren
ques
c_cond
id|PAGE_SIZE
suffix:colon
id|count
suffix:semicolon
id|src
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|src
comma
id|buf
comma
id|c
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|c
op_rshift
l_int|2
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
id|fb_writel
c_func
(paren
op_star
id|src
op_increment
comma
id|dst
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_amp
l_int|3
)paren
(brace
id|u8
op_star
id|src8
op_assign
(paren
id|u8
op_star
)paren
id|src
suffix:semicolon
id|u8
id|__iomem
op_star
id|dst8
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|dst
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|c
op_amp
l_int|3
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
id|fb_writeb
c_func
(paren
op_star
id|src8
op_increment
comma
id|dst8
op_increment
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
id|dst8
suffix:semicolon
)brace
op_star
id|ppos
op_add_assign
id|c
suffix:semicolon
id|buf
op_add_assign
id|c
suffix:semicolon
id|cnt
op_add_assign
id|c
suffix:semicolon
id|count
op_sub_assign
id|c
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
ques
c_cond
id|err
suffix:colon
id|cnt
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_KMOD
DECL|function|try_to_load
r_static
r_void
id|try_to_load
c_func
(paren
r_int
id|fb
)paren
(brace
id|request_module
c_func
(paren
l_string|&quot;fb%d&quot;
comma
id|fb
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_KMOD */
r_int
DECL|function|fb_pan_display
id|fb_pan_display
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
r_int
id|yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|xoffset
template_param
id|info-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_pan_display
c_func
(paren
id|var
comma
id|info
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|fb_set_var
id|fb_set_var
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_INV_MODE
)paren
(brace
r_struct
id|fb_videomode
id|mode1
comma
id|mode2
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|fb_var_to_videomode
c_func
(paren
op_amp
id|mode1
comma
id|var
)paren
suffix:semicolon
id|fb_var_to_videomode
c_func
(paren
op_amp
id|mode2
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
multiline_comment|/* make sure we don&squot;t delete the videomode of current var */
id|ret
op_assign
id|fb_mode_is_equal
c_func
(paren
op_amp
id|mode1
comma
op_amp
id|mode2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_struct
id|fb_event
id|event
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
id|event.data
op_assign
op_amp
id|mode1
suffix:semicolon
id|ret
op_assign
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_MODE_DELETE
comma
op_amp
id|event
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|fb_delete_videomode
c_func
(paren
op_amp
id|mode1
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_FORCE
)paren
op_logical_or
id|memcmp
c_func
(paren
op_amp
id|info-&gt;var
comma
id|var
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;fbops-&gt;fb_check_var
)paren
(brace
op_star
id|var
op_assign
id|info-&gt;var
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_check_var
c_func
(paren
id|var
comma
id|info
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var-&gt;activate
op_amp
id|FB_ACTIVATE_MASK
)paren
op_eq
id|FB_ACTIVATE_NOW
)paren
(brace
r_struct
id|fb_videomode
id|mode
suffix:semicolon
id|info-&gt;var
op_assign
op_star
id|var
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_set_par
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
id|fb_pan_display
c_func
(paren
id|info
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
id|fb_set_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
id|info
)paren
suffix:semicolon
id|fb_var_to_videomode
c_func
(paren
op_amp
id|mode
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;modelist.prev
op_logical_and
id|info-&gt;modelist.next
op_logical_and
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|info-&gt;modelist
)paren
)paren
id|fb_add_videomode
c_func
(paren
op_amp
id|mode
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_MISC_USEREVENT
)paren
(brace
r_struct
id|fb_event
id|event
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_USEREVENT
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_MODE_CHANGE
comma
op_amp
id|event
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|fb_blank
id|fb_blank
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|blank
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|blank
OG
id|FB_BLANK_POWERDOWN
)paren
id|blank
op_assign
id|FB_BLANK_POWERDOWN
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_blank
)paren
id|ret
op_assign
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_blank
c_func
(paren
id|blank
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_struct
id|fb_event
id|event
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
id|event.data
op_assign
op_amp
id|blank
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_BLANK
comma
op_amp
id|event
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|fb_ioctl
id|fb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
r_struct
id|fb_ops
op_star
id|fb
op_assign
id|info-&gt;fbops
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_struct
id|fb_fix_screeninfo
id|fix
suffix:semicolon
r_struct
id|fb_con2fbmap
id|con2fb
suffix:semicolon
r_struct
id|fb_cmap_user
id|cmap
suffix:semicolon
r_struct
id|fb_event
id|event
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FBIOGET_VSCREENINFO
suffix:colon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|info-&gt;var
comma
r_sizeof
(paren
id|var
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|FBIOPUT_VSCREENINFO
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|var
comma
id|argp
comma
r_sizeof
(paren
id|var
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|info-&gt;flags
op_or_assign
id|FBINFO_MISC_USEREVENT
suffix:semicolon
id|i
op_assign
id|fb_set_var
c_func
(paren
id|info
comma
op_amp
id|var
)paren
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_USEREVENT
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|var
comma
r_sizeof
(paren
id|var
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FBIOGET_FSCREENINFO
suffix:colon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|info-&gt;fix
comma
r_sizeof
(paren
id|fix
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|FBIOPUTCMAP
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmap
comma
id|argp
comma
r_sizeof
(paren
id|cmap
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
(paren
id|fb_set_user_cmap
c_func
(paren
op_amp
id|cmap
comma
id|info
)paren
)paren
suffix:semicolon
r_case
id|FBIOGETCMAP
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmap
comma
id|argp
comma
r_sizeof
(paren
id|cmap
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|fb_cmap_to_user
c_func
(paren
op_amp
id|info-&gt;cmap
comma
op_amp
id|cmap
)paren
suffix:semicolon
r_case
id|FBIOPAN_DISPLAY
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|var
comma
id|argp
comma
r_sizeof
(paren
id|var
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|i
op_assign
id|fb_pan_display
c_func
(paren
id|info
comma
op_amp
id|var
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|var
comma
r_sizeof
(paren
id|var
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FBIO_CURSOR
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|FBIOGET_CON2FBMAP
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|con2fb
comma
id|argp
comma
r_sizeof
(paren
id|con2fb
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|con2fb.console
template_param
id|MAX_NR_CONSOLES
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|con2fb.framebuffer
op_assign
op_minus
l_int|1
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
id|event.data
op_assign
op_amp
id|con2fb
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_GET_CONSOLE_MAP
comma
op_amp
id|event
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|con2fb
comma
r_sizeof
(paren
id|con2fb
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|FBIOPUT_CON2FBMAP
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|con2fb
comma
id|argp
comma
r_sizeof
(paren
id|con2fb
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|con2fb.console
template_param
id|MAX_NR_CONSOLES
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|con2fb.framebuffer
OL
l_int|0
op_logical_or
id|con2fb.framebuffer
op_ge
id|FB_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
op_logical_neg
id|registered_fb
(braket
id|con2fb.framebuffer
)braket
)paren
id|try_to_load
c_func
(paren
id|con2fb.framebuffer
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_KMOD */
r_if
c_cond
(paren
op_logical_neg
id|registered_fb
(braket
id|con2fb.framebuffer
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
id|event.data
op_assign
op_amp
id|con2fb
suffix:semicolon
r_return
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_SET_CONSOLE_MAP
comma
op_amp
id|event
)paren
suffix:semicolon
r_case
id|FBIOBLANK
suffix:colon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|info-&gt;flags
op_or_assign
id|FBINFO_MISC_USEREVENT
suffix:semicolon
id|i
op_assign
id|fb_blank
c_func
(paren
id|info
comma
id|arg
)paren
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_USEREVENT
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|fb-&gt;fb_ioctl
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|fb
op_member_access_from_pointer
id|fb_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|info
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|fb_mmap
id|fb_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
r_struct
id|fb_ops
op_star
id|fb
op_assign
id|info-&gt;fbops
suffix:semicolon
r_int
r_int
id|off
suffix:semicolon
macro_line|#if !defined(__sparc__) || defined(__sparc_v9__)
r_int
r_int
id|start
suffix:semicolon
id|u32
id|len
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
OG
(paren
op_complement
l_int|0UL
op_rshift
id|PAGE_SHIFT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_assign
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|fb-&gt;fb_mmap
)paren
(brace
r_int
id|res
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|res
op_assign
id|fb
op_member_access_from_pointer
id|fb_mmap
c_func
(paren
id|info
comma
id|file
comma
id|vma
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
macro_line|#if defined(__sparc__) &amp;&amp; !defined(__sparc_v9__)
multiline_comment|/* Should never get here, all fb drivers should have their own&n;&t;   mmap routines */
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#else
multiline_comment|/* !sparc32... */
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* frame buffer memory */
id|start
op_assign
id|info-&gt;fix.smem_start
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|info-&gt;fix.smem_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
multiline_comment|/* memory mapped io */
id|off
op_sub_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.accel_flags
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|start
op_assign
id|info-&gt;fix.mmio_start
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|info-&gt;fix.mmio_len
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
op_plus
id|off
)paren
OG
id|len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|off
op_add_assign
id|start
suffix:semicolon
id|vma-&gt;vm_pgoff
op_assign
id|off
op_rshift
id|PAGE_SHIFT
suffix:semicolon
multiline_comment|/* This is an IO map - tell maydump to skip this VMA */
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
op_or
id|VM_RESERVED
suffix:semicolon
macro_line|#if defined(__sparc_v9__)
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
macro_line|#else
macro_line|#if defined(__mc68000__)
macro_line|#if defined(CONFIG_SUN3)
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|SUN3_PAGE_NOCACHE
suffix:semicolon
macro_line|#elif defined(CONFIG_MMU)
r_if
c_cond
(paren
id|CPU_IS_020_OR_030
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_NOCACHE030
suffix:semicolon
r_if
c_cond
(paren
id|CPU_IS_040_OR_060
)paren
(brace
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_and_assign
id|_CACHEMASK040
suffix:semicolon
multiline_comment|/* Use no-cache mode, serialized */
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_NOCACHE_S
suffix:semicolon
)brace
macro_line|#endif
macro_line|#elif defined(__powerpc__)
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_NO_CACHE
op_or
id|_PAGE_GUARDED
suffix:semicolon
macro_line|#elif defined(__alpha__)
multiline_comment|/* Caching is off in the I/O space quadrant by design.  */
macro_line|#elif defined(__i386__) || defined(__x86_64__)
r_if
c_cond
(paren
id|boot_cpu_data.x86
OG
l_int|3
)paren
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_PCD
suffix:semicolon
macro_line|#elif defined(__mips__)
id|vma-&gt;vm_page_prot
op_assign
id|pgprot_noncached
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
suffix:semicolon
macro_line|#elif defined(__hppa__)
id|pgprot_val
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
op_or_assign
id|_PAGE_NO_CACHE
suffix:semicolon
macro_line|#elif defined(__ia64__) || defined(__arm__) || defined(__sh__) || &bslash;&n;      defined(__m32r__)
id|vma-&gt;vm_page_prot
op_assign
id|pgprot_writecombine
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
suffix:semicolon
macro_line|#else
macro_line|#warning What do we have to do here??
macro_line|#endif
r_if
c_cond
(paren
id|io_remap_page_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|off
comma
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
macro_line|#endif /* !__sparc_v9__ */
r_return
l_int|0
suffix:semicolon
macro_line|#endif /* !sparc32 */
)brace
r_static
r_int
DECL|function|fb_open
id|fb_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fbidx
op_ge
id|FB_MAX
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
op_logical_neg
(paren
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
)paren
)paren
id|try_to_load
c_func
(paren
id|fbidx
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_KMOD */
r_if
c_cond
(paren
op_logical_neg
(paren
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|info-&gt;fbops-&gt;owner
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_open
)paren
(brace
id|res
op_assign
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_open
c_func
(paren
id|info
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
id|module_put
c_func
(paren
id|info-&gt;fbops-&gt;owner
)paren
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|fb_release
id|fb_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|fbidx
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|info
op_assign
id|registered_fb
(braket
id|fbidx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_release
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_release
c_func
(paren
id|info
comma
l_int|1
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|info-&gt;fbops-&gt;owner
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fb_fops
r_static
r_struct
id|file_operations
id|fb_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|read
op_assign
id|fb_read
comma
dot
id|write
op_assign
id|fb_write
comma
dot
id|ioctl
op_assign
id|fb_ioctl
comma
dot
id|mmap
op_assign
id|fb_mmap
comma
dot
id|open
op_assign
id|fb_open
comma
dot
id|release
op_assign
id|fb_release
comma
macro_line|#ifdef HAVE_ARCH_FB_UNMAPPED_AREA
dot
id|get_unmapped_area
op_assign
id|get_fb_unmapped_area
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|fb_class
r_static
r_struct
id|class_simple
op_star
id|fb_class
suffix:semicolon
multiline_comment|/**&n; *&t;register_framebuffer - registers a frame buffer device&n; *&t;@fb_info: frame buffer info structure&n; *&n; *&t;Registers a frame buffer device @fb_info.&n; *&n; *&t;Returns negative errno on error, or zero for success.&n; *&n; */
r_int
DECL|function|register_framebuffer
id|register_framebuffer
c_func
(paren
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|class_device
op_star
id|c
suffix:semicolon
r_struct
id|fb_event
id|event
suffix:semicolon
r_if
c_cond
(paren
id|num_registered_fb
op_eq
id|FB_MAX
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|num_registered_fb
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|registered_fb
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
id|fb_info-&gt;node
op_assign
id|i
suffix:semicolon
id|c
op_assign
id|class_simple_device_add
c_func
(paren
id|fb_class
comma
id|MKDEV
c_func
(paren
id|FB_MAJOR
comma
id|i
)paren
comma
id|fb_info-&gt;device
comma
l_string|&quot;fb%d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|c
)paren
)paren
(brace
multiline_comment|/* Not fatal */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unable to create class_device for framebuffer %d; errno = %ld&bslash;n&quot;
comma
id|i
comma
id|PTR_ERR
c_func
(paren
id|c
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fb_info-&gt;pixmap.addr
op_eq
l_int|NULL
)paren
(brace
id|fb_info-&gt;pixmap.addr
op_assign
id|kmalloc
c_func
(paren
id|FBPIXMAPSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_info-&gt;pixmap.addr
)paren
(brace
id|fb_info-&gt;pixmap.size
op_assign
id|FBPIXMAPSIZE
suffix:semicolon
id|fb_info-&gt;pixmap.buf_align
op_assign
l_int|1
suffix:semicolon
id|fb_info-&gt;pixmap.scan_align
op_assign
l_int|1
suffix:semicolon
id|fb_info-&gt;pixmap.access_align
op_assign
l_int|4
suffix:semicolon
id|fb_info-&gt;pixmap.flags
op_assign
id|FB_PIXMAP_DEFAULT
suffix:semicolon
)brace
)brace
id|fb_info-&gt;pixmap.offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb_info-&gt;modelist.prev
op_logical_or
op_logical_neg
id|fb_info-&gt;modelist.next
op_logical_or
id|list_empty
c_func
(paren
op_amp
id|fb_info-&gt;modelist
)paren
)paren
(brace
r_struct
id|fb_videomode
id|mode
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|fb_info-&gt;modelist
)paren
suffix:semicolon
id|fb_var_to_videomode
c_func
(paren
op_amp
id|mode
comma
op_amp
id|fb_info-&gt;var
)paren
suffix:semicolon
id|fb_add_videomode
c_func
(paren
op_amp
id|mode
comma
op_amp
id|fb_info-&gt;modelist
)paren
suffix:semicolon
)brace
id|registered_fb
(braket
id|i
)braket
op_assign
id|fb_info
suffix:semicolon
id|devfs_mk_cdev
c_func
(paren
id|MKDEV
c_func
(paren
id|FB_MAJOR
comma
id|i
)paren
comma
id|S_IFCHR
op_or
id|S_IRUGO
op_or
id|S_IWUGO
comma
l_string|&quot;fb/%d&quot;
comma
id|i
)paren
suffix:semicolon
id|event.info
op_assign
id|fb_info
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_FB_REGISTERED
comma
op_amp
id|event
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;unregister_framebuffer - releases a frame buffer device&n; *&t;@fb_info: frame buffer info structure&n; *&n; *&t;Unregisters a frame buffer device @fb_info.&n; *&n; *&t;Returns negative errno on error, or zero for success.&n; *&n; */
r_int
DECL|function|unregister_framebuffer
id|unregister_framebuffer
c_func
(paren
r_struct
id|fb_info
op_star
id|fb_info
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|fb_info-&gt;node
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|registered_fb
(braket
id|i
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|devfs_remove
c_func
(paren
l_string|&quot;fb/%d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_info-&gt;pixmap.addr
op_logical_and
(paren
id|fb_info-&gt;pixmap.flags
op_amp
id|FB_PIXMAP_DEFAULT
)paren
)paren
id|kfree
c_func
(paren
id|fb_info-&gt;pixmap.addr
)paren
suffix:semicolon
id|fb_destroy_modelist
c_func
(paren
op_amp
id|fb_info-&gt;modelist
)paren
suffix:semicolon
id|registered_fb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|num_registered_fb
op_decrement
suffix:semicolon
id|class_simple_device_remove
c_func
(paren
id|MKDEV
c_func
(paren
id|FB_MAJOR
comma
id|i
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;fb_register_client - register a client notifier&n; *&t;@nb: notifier block to callback on events&n; */
DECL|function|fb_register_client
r_int
id|fb_register_client
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_register
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|nb
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;fb_unregister_client - unregister a client notifier&n; *&t;@nb: notifier block to callback on events&n; */
DECL|function|fb_unregister_client
r_int
id|fb_unregister_client
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_unregister
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|nb
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;fb_set_suspend - low level driver signals suspend&n; *&t;@info: framebuffer affected&n; *&t;@state: 0 = resuming, !=0 = suspending&n; *&n; *&t;This is meant to be used by low level drivers to&n; * &t;signal suspend/resume to the core &amp; clients.&n; *&t;It must be called with the console semaphore held&n; */
DECL|function|fb_set_suspend
r_void
id|fb_set_suspend
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|state
)paren
(brace
r_struct
id|fb_event
id|event
suffix:semicolon
id|event.info
op_assign
id|info
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
(brace
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_SUSPEND
comma
op_amp
id|event
)paren
suffix:semicolon
id|info-&gt;state
op_assign
id|FBINFO_STATE_SUSPENDED
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;state
op_assign
id|FBINFO_STATE_RUNNING
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|fb_notifier_list
comma
id|FB_EVENT_RESUME
comma
op_amp
id|event
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; *&t;fbmem_init - init frame buffer subsystem&n; *&n; *&t;Initialize the frame buffer subsystem.&n; *&n; *&t;NOTE: This function is _only_ to be called by drivers/char/mem.c.&n; *&n; */
r_int
id|__init
DECL|function|fbmem_init
id|fbmem_init
c_func
(paren
r_void
)paren
(brace
id|create_proc_read_entry
c_func
(paren
l_string|&quot;fb&quot;
comma
l_int|0
comma
l_int|NULL
comma
id|fbmem_read_proc
comma
l_int|NULL
)paren
suffix:semicolon
id|devfs_mk_dir
c_func
(paren
l_string|&quot;fb&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_chrdev
c_func
(paren
id|FB_MAJOR
comma
l_string|&quot;fb&quot;
comma
op_amp
id|fb_fops
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;unable to get major %d for fb devs&bslash;n&quot;
comma
id|FB_MAJOR
)paren
suffix:semicolon
id|fb_class
op_assign
id|class_simple_create
c_func
(paren
id|THIS_MODULE
comma
l_string|&quot;graphics&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|fb_class
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unable to create fb class; errno = %ld&bslash;n&quot;
comma
id|PTR_ERR
c_func
(paren
id|fb_class
)paren
)paren
suffix:semicolon
id|fb_class
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fbmem_init
id|subsys_initcall
c_func
(paren
id|fbmem_init
)paren
suffix:semicolon
DECL|variable|video_options
r_static
r_char
op_star
id|video_options
(braket
id|FB_MAX
)braket
suffix:semicolon
DECL|variable|ofonly
r_static
r_int
id|ofonly
suffix:semicolon
multiline_comment|/**&n; * fb_get_options - get kernel boot parameters&n; * @name - framebuffer name as it would appear in&n; *         the boot parameter line&n; *         (video=&lt;name&gt;:&lt;options&gt;)&n; *&n; * NOTE: Needed to maintain backwards compatibility&n; */
DECL|function|fb_get_options
r_int
id|fb_get_options
c_func
(paren
r_char
op_star
id|name
comma
r_char
op_star
op_star
id|option
)paren
(brace
r_char
op_star
id|opt
comma
op_star
id|options
op_assign
l_int|NULL
suffix:semicolon
r_int
id|opt_len
comma
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|name_len
op_assign
id|strlen
c_func
(paren
id|name
)paren
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|name_len
op_logical_and
id|ofonly
op_logical_and
id|strncmp
c_func
(paren
id|name
comma
l_string|&quot;offb&quot;
comma
l_int|4
)paren
)paren
id|retval
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|name_len
op_logical_and
op_logical_neg
id|retval
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|video_options
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|opt_len
op_assign
id|strlen
c_func
(paren
id|video_options
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_len
)paren
r_continue
suffix:semicolon
id|opt
op_assign
id|video_options
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|name
comma
id|opt
comma
id|name_len
)paren
op_logical_and
id|opt
(braket
id|name_len
)braket
op_eq
l_char|&squot;:&squot;
)paren
id|options
op_assign
id|opt
op_plus
id|name_len
op_plus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|options
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
id|retval
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|option
)paren
op_star
id|option
op_assign
id|options
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;video_setup - process command line options&n; *&t;@options: string of options&n; *&n; *&t;Process command line options for frame buffer subsystem.&n; *&n; *&t;NOTE: This function is a __setup and __init function.&n; *            It only stores the options.  Drivers have to call&n; *            fb_get_options() as necessary.&n; *&n; *&t;Returns zero.&n; *&n; */
r_extern
r_const
r_char
op_star
id|global_mode_option
suffix:semicolon
DECL|function|video_setup
r_int
id|__init
id|video_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_int
id|i
comma
id|global
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
id|global
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|global
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;ofonly&quot;
comma
l_int|6
)paren
)paren
(brace
id|ofonly
op_assign
l_int|1
suffix:semicolon
id|global
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|global
op_logical_and
op_logical_neg
id|strstr
c_func
(paren
id|options
comma
l_string|&quot;fb:&quot;
)paren
)paren
(brace
id|global_mode_option
op_assign
id|options
suffix:semicolon
id|global
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|global
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|video_options
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
id|video_options
(braket
id|i
)braket
op_assign
id|options
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;video=&quot;
comma
id|video_setup
)paren
suffix:semicolon
multiline_comment|/*&n;     *  Visible symbols for modules&n;     */
DECL|variable|register_framebuffer
id|EXPORT_SYMBOL
c_func
(paren
id|register_framebuffer
)paren
suffix:semicolon
DECL|variable|unregister_framebuffer
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_framebuffer
)paren
suffix:semicolon
DECL|variable|num_registered_fb
id|EXPORT_SYMBOL
c_func
(paren
id|num_registered_fb
)paren
suffix:semicolon
DECL|variable|registered_fb
id|EXPORT_SYMBOL
c_func
(paren
id|registered_fb
)paren
suffix:semicolon
DECL|variable|fb_prepare_logo
id|EXPORT_SYMBOL
c_func
(paren
id|fb_prepare_logo
)paren
suffix:semicolon
DECL|variable|fb_show_logo
id|EXPORT_SYMBOL
c_func
(paren
id|fb_show_logo
)paren
suffix:semicolon
DECL|variable|fb_set_var
id|EXPORT_SYMBOL
c_func
(paren
id|fb_set_var
)paren
suffix:semicolon
DECL|variable|fb_blank
id|EXPORT_SYMBOL
c_func
(paren
id|fb_blank
)paren
suffix:semicolon
DECL|variable|fb_pan_display
id|EXPORT_SYMBOL
c_func
(paren
id|fb_pan_display
)paren
suffix:semicolon
DECL|variable|fb_get_buffer_offset
id|EXPORT_SYMBOL
c_func
(paren
id|fb_get_buffer_offset
)paren
suffix:semicolon
DECL|variable|fb_iomove_buf_unaligned
id|EXPORT_SYMBOL
c_func
(paren
id|fb_iomove_buf_unaligned
)paren
suffix:semicolon
DECL|variable|fb_iomove_buf_aligned
id|EXPORT_SYMBOL
c_func
(paren
id|fb_iomove_buf_aligned
)paren
suffix:semicolon
DECL|variable|fb_sysmove_buf_unaligned
id|EXPORT_SYMBOL
c_func
(paren
id|fb_sysmove_buf_unaligned
)paren
suffix:semicolon
DECL|variable|fb_sysmove_buf_aligned
id|EXPORT_SYMBOL
c_func
(paren
id|fb_sysmove_buf_aligned
)paren
suffix:semicolon
DECL|variable|fb_set_suspend
id|EXPORT_SYMBOL
c_func
(paren
id|fb_set_suspend
)paren
suffix:semicolon
DECL|variable|fb_register_client
id|EXPORT_SYMBOL
c_func
(paren
id|fb_register_client
)paren
suffix:semicolon
DECL|variable|fb_unregister_client
id|EXPORT_SYMBOL
c_func
(paren
id|fb_unregister_client
)paren
suffix:semicolon
DECL|variable|fb_get_options
id|EXPORT_SYMBOL
c_func
(paren
id|fb_get_options
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
