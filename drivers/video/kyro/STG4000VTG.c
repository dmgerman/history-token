multiline_comment|/*&n; *  linux/drivers/video/kyro/STG4000VTG.c&n; *&n; *  Copyright (C) 2002 STMicroelectronics&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;video/kyro.h&gt;
macro_line|#include &quot;STG4000Reg.h&quot;
macro_line|#include &quot;STG4000Interface.h&quot;
DECL|function|DisableVGA
r_void
id|DisableVGA
c_func
(paren
r_volatile
id|STG4000REG
op_star
id|pSTGReg
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_volatile
id|u32
id|count
comma
id|i
suffix:semicolon
multiline_comment|/* Reset the VGA registers */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|SoftwareReset
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|SoftwareReset
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Just for Delay */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|count
op_increment
suffix:semicolon
)brace
multiline_comment|/* Pull-out the VGA registers from reset */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|SoftwareReset
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SET_BIT
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|SoftwareReset
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|StopVTG
r_void
id|StopVTG
c_func
(paren
r_volatile
id|STG4000REG
op_star
id|pSTGReg
)paren
(brace
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Stop Ver and Hor Sync Generator */
id|tmp
op_assign
(paren
id|STG_READ_REG
c_func
(paren
id|DACSyncCtrl
)paren
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|0
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|31
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACSyncCtrl
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|StartVTG
r_void
id|StartVTG
c_func
(paren
r_volatile
id|STG4000REG
op_star
id|pSTGReg
)paren
(brace
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Start Ver and Hor Sync Generator */
id|tmp
op_assign
(paren
(paren
id|STG_READ_REG
c_func
(paren
id|DACSyncCtrl
)paren
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|31
)paren
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACSyncCtrl
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|SetupVTG
r_void
id|SetupVTG
c_func
(paren
r_volatile
id|STG4000REG
op_star
id|pSTGReg
comma
r_const
r_struct
id|kyrofb_info
op_star
id|pTiming
)paren
(brace
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
id|u32
id|margins
op_assign
l_int|0
suffix:semicolon
id|u32
id|ulBorder
suffix:semicolon
id|u32
id|xRes
op_assign
id|pTiming-&gt;XRES
suffix:semicolon
id|u32
id|yRes
op_assign
id|pTiming-&gt;YRES
suffix:semicolon
multiline_comment|/* Horizontal */
id|u32
id|HAddrTime
comma
id|HRightBorder
comma
id|HLeftBorder
suffix:semicolon
id|u32
id|HBackPorcStrt
comma
id|HFrontPorchStrt
comma
id|HTotal
comma
id|HLeftBorderStrt
comma
id|HRightBorderStrt
comma
id|HDisplayStrt
suffix:semicolon
multiline_comment|/* Vertical */
id|u32
id|VDisplayStrt
comma
id|VBottomBorder
comma
id|VTopBorder
suffix:semicolon
id|u32
id|VBackPorchStrt
comma
id|VTotal
comma
id|VTopBorderStrt
comma
id|VFrontPorchStrt
comma
id|VBottomBorderStrt
comma
id|VAddrTime
suffix:semicolon
multiline_comment|/* Need to calculate the right border */
r_if
c_cond
(paren
(paren
id|xRes
op_eq
l_int|640
)paren
op_logical_and
(paren
id|yRes
op_eq
l_int|480
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|pTiming-&gt;VFREQ
op_eq
l_int|60
)paren
op_logical_or
(paren
id|pTiming-&gt;VFREQ
op_eq
l_int|72
)paren
)paren
(brace
id|margins
op_assign
l_int|8
suffix:semicolon
)brace
)brace
multiline_comment|/* Work out the Border */
id|ulBorder
op_assign
(paren
id|pTiming-&gt;HTot
op_minus
(paren
id|pTiming-&gt;HST
op_plus
(paren
id|pTiming-&gt;HBP
op_minus
id|margins
)paren
op_plus
id|xRes
op_plus
(paren
id|pTiming-&gt;HFP
op_minus
id|margins
)paren
)paren
)paren
op_rshift
l_int|1
suffix:semicolon
multiline_comment|/* Border the same for Vertical and Horizontal */
id|VBottomBorder
op_assign
id|HLeftBorder
op_assign
id|VTopBorder
op_assign
id|HRightBorder
op_assign
id|ulBorder
suffix:semicolon
multiline_comment|/************ Get Timing values for Horizontal ******************/
id|HAddrTime
op_assign
id|xRes
suffix:semicolon
id|HBackPorcStrt
op_assign
id|pTiming-&gt;HST
suffix:semicolon
id|HTotal
op_assign
id|pTiming-&gt;HTot
suffix:semicolon
id|HDisplayStrt
op_assign
id|pTiming-&gt;HST
op_plus
(paren
id|pTiming-&gt;HBP
op_minus
id|margins
)paren
op_plus
id|HLeftBorder
suffix:semicolon
id|HLeftBorderStrt
op_assign
id|HDisplayStrt
op_minus
id|HLeftBorder
suffix:semicolon
id|HFrontPorchStrt
op_assign
id|pTiming-&gt;HST
op_plus
(paren
id|pTiming-&gt;HBP
op_minus
id|margins
)paren
op_plus
id|HLeftBorder
op_plus
id|HAddrTime
op_plus
id|HRightBorder
suffix:semicolon
id|HRightBorderStrt
op_assign
id|HFrontPorchStrt
op_minus
id|HRightBorder
suffix:semicolon
multiline_comment|/************ Get Timing values for Vertical ******************/
id|VAddrTime
op_assign
id|yRes
suffix:semicolon
id|VBackPorchStrt
op_assign
id|pTiming-&gt;VST
suffix:semicolon
id|VTotal
op_assign
id|pTiming-&gt;VTot
suffix:semicolon
id|VDisplayStrt
op_assign
id|pTiming-&gt;VST
op_plus
(paren
id|pTiming-&gt;VBP
op_minus
id|margins
)paren
op_plus
id|VTopBorder
suffix:semicolon
id|VTopBorderStrt
op_assign
id|VDisplayStrt
op_minus
id|VTopBorder
suffix:semicolon
id|VFrontPorchStrt
op_assign
id|pTiming-&gt;VST
op_plus
(paren
id|pTiming-&gt;VBP
op_minus
id|margins
)paren
op_plus
id|VTopBorder
op_plus
id|VAddrTime
op_plus
id|VBottomBorder
suffix:semicolon
id|VBottomBorderStrt
op_assign
id|VFrontPorchStrt
op_minus
id|VBottomBorder
suffix:semicolon
multiline_comment|/* Set Hor Timing 1, 2, 3 */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACHorTim1
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|HTotal
)paren
op_or
(paren
id|HBackPorcStrt
op_lshift
l_int|16
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACHorTim1
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACHorTim2
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|HDisplayStrt
op_lshift
l_int|16
)paren
op_or
id|HLeftBorderStrt
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACHorTim2
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACHorTim3
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|HFrontPorchStrt
op_lshift
l_int|16
)paren
op_or
id|HRightBorderStrt
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACHorTim3
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Ver Timing 1, 2, 3 */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACVerTim1
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|VBackPorchStrt
op_lshift
l_int|16
)paren
op_or
(paren
id|VTotal
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACVerTim1
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACVerTim2
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|VDisplayStrt
op_lshift
l_int|16
)paren
op_or
id|VTopBorderStrt
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACVerTim2
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACVerTim3
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|11
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|VFrontPorchStrt
op_lshift
l_int|16
)paren
op_or
id|VBottomBorderStrt
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACVerTim3
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Verical and Horizontal Polarity */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACSyncCtrl
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|3
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pTiming-&gt;HSP
OG
l_int|0
)paren
op_logical_and
(paren
id|pTiming-&gt;VSP
OL
l_int|0
)paren
)paren
(brace
multiline_comment|/* +hsync -vsync */
id|tmp
op_and_assign
op_complement
l_int|0x8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pTiming-&gt;HSP
OL
l_int|0
)paren
op_logical_and
(paren
id|pTiming-&gt;VSP
OG
l_int|0
)paren
)paren
(brace
multiline_comment|/* -hsync +vsync */
id|tmp
op_and_assign
op_complement
l_int|0x2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pTiming-&gt;HSP
OL
l_int|0
)paren
op_logical_and
(paren
id|pTiming-&gt;VSP
OL
l_int|0
)paren
)paren
(brace
multiline_comment|/* -hsync -vsync */
id|tmp
op_and_assign
op_complement
l_int|0xA
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pTiming-&gt;HSP
OG
l_int|0
)paren
op_logical_and
(paren
id|pTiming-&gt;VSP
OG
l_int|0
)paren
)paren
(brace
multiline_comment|/* +hsync -vsync */
id|tmp
op_and_assign
op_complement
l_int|0x0
suffix:semicolon
)brace
id|STG_WRITE_REG
c_func
(paren
id|DACSyncCtrl
comma
id|tmp
)paren
suffix:semicolon
)brace
eof
