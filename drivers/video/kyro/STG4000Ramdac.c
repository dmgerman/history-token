multiline_comment|/*&n; *  linux/drivers/video/kyro/STG4000Ramdac.c&n; *&n; *  Copyright (C) 2002 STMicroelectronics&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;video/kyro.h&gt;
macro_line|#include &quot;STG4000Reg.h&quot;
macro_line|#include &quot;STG4000Interface.h&quot;
DECL|variable|STG_PIXEL_BUS_WIDTH
r_static
id|u32
id|STG_PIXEL_BUS_WIDTH
op_assign
l_int|128
suffix:semicolon
multiline_comment|/* 128 bit bus width      */
DECL|variable|REF_CLOCK
r_static
id|u32
id|REF_CLOCK
op_assign
l_int|14318
suffix:semicolon
DECL|variable|pSTGReg
id|STG4000REG
id|__iomem
op_star
id|pSTGReg
suffix:semicolon
DECL|function|InitialiseRamdac
r_int
id|InitialiseRamdac
c_func
(paren
r_volatile
id|STG4000REG
id|__iomem
op_star
id|pSTGReg
comma
id|u32
id|displayDepth
comma
id|u32
id|displayWidth
comma
id|u32
id|displayHeight
comma
id|s32
id|HSyncPolarity
comma
id|s32
id|VSyncPolarity
comma
id|u32
op_star
id|pixelClock
)paren
(brace
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
id|u32
id|F
op_assign
l_int|0
comma
id|R
op_assign
l_int|0
comma
id|P
op_assign
l_int|0
suffix:semicolon
id|u32
id|stride
op_assign
l_int|0
suffix:semicolon
id|u32
id|ulPdiv
op_assign
l_int|0
suffix:semicolon
id|u32
id|physicalPixelDepth
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Make sure DAC is in Reset */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|SoftwareReset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
l_int|0x1
)paren
(brace
id|CLEAR_BIT
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|SoftwareReset
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* Set Pixel Format */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACPixelFormat
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Set LUT not used from 16bpp to 32 bpp ??? */
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|8
comma
l_int|9
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|displayDepth
)paren
(brace
r_case
l_int|16
suffix:colon
(brace
id|physicalPixelDepth
op_assign
l_int|16
suffix:semicolon
id|tmp
op_or_assign
id|_16BPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|32
suffix:colon
(brace
multiline_comment|/* Set for 32 bits per pixel */
id|physicalPixelDepth
op_assign
l_int|32
suffix:semicolon
id|tmp
op_or_assign
id|_32BPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|STG_WRITE_REG
c_func
(paren
id|DACPixelFormat
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Workout Bus transfer bandwidth according to pixel format */
id|ulPdiv
op_assign
id|STG_PIXEL_BUS_WIDTH
op_div
id|physicalPixelDepth
suffix:semicolon
multiline_comment|/* Get Screen Stride in pixels */
id|stride
op_assign
id|displayWidth
suffix:semicolon
multiline_comment|/* Set Primary size info */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACPrimSize
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|10
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|12
comma
l_int|31
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
(paren
(paren
id|displayHeight
op_minus
l_int|1
)paren
op_lshift
l_int|12
)paren
op_or
(paren
(paren
(paren
id|displayWidth
op_div
id|ulPdiv
)paren
op_minus
l_int|1
)paren
op_lshift
l_int|23
)paren
)paren
op_or
(paren
id|stride
op_div
id|ulPdiv
)paren
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACPrimSize
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Pixel Clock */
op_star
id|pixelClock
op_assign
id|ProgramClock
c_func
(paren
id|REF_CLOCK
comma
op_star
id|pixelClock
comma
op_amp
id|F
comma
op_amp
id|R
comma
op_amp
id|P
)paren
suffix:semicolon
multiline_comment|/* Set DAC PLL Mode */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACPLLMode
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|15
)paren
suffix:semicolon
multiline_comment|/* tmp |= ((P-1) | ((F-2) &lt;&lt; 2) | ((R-2) &lt;&lt; 11)); */
id|tmp
op_or_assign
(paren
(paren
id|P
)paren
op_or
(paren
(paren
id|F
op_minus
l_int|2
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|R
op_minus
l_int|2
)paren
op_lshift
l_int|11
)paren
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACPLLMode
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Prim Address */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACPrimAddress
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|20
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|20
comma
l_int|31
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACPrimAddress
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Cursor details with HW Cursor disabled */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACCursorCtrl
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SET_BIT
c_func
(paren
l_int|31
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACCursorCtrl
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACCursorAddr
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|20
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACCursorAddr
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Video Window */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACVidWinStart
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|10
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|26
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACVidWinStart
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACVidWinEnd
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|10
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|26
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACVidWinEnd
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set DAC Border Color to default */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACBorderColor
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|0
comma
l_int|23
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACBorderColor
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Graphics and Overlay Burst Control */
id|STG_WRITE_REG
c_func
(paren
id|DACBurstCtrl
comma
l_int|0x0404
)paren
suffix:semicolon
multiline_comment|/* Set CRC Trigger to default */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DACCrcTrigger
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACCrcTrigger
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* Set Video Port Control to default */
id|tmp
op_assign
id|STG_READ_REG
c_func
(paren
id|DigVidPortCtrl
)paren
suffix:semicolon
id|CLEAR_BIT
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|16
comma
l_int|27
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|1
comma
l_int|3
)paren
suffix:semicolon
id|CLEAR_BITS_FRM_TO
c_func
(paren
l_int|10
comma
l_int|11
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DigVidPortCtrl
comma
id|tmp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Ramdac control, turning output to the screen on and off */
DECL|function|DisableRamdacOutput
r_void
id|DisableRamdacOutput
c_func
(paren
r_volatile
id|STG4000REG
id|__iomem
op_star
id|pSTGReg
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Disable DAC for Graphics Stream Control */
id|tmp
op_assign
(paren
id|STG_READ_REG
c_func
(paren
id|DACStreamCtrl
)paren
)paren
op_amp
op_complement
id|SET_BIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACStreamCtrl
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|EnableRamdacOutput
r_void
id|EnableRamdacOutput
c_func
(paren
r_volatile
id|STG4000REG
id|__iomem
op_star
id|pSTGReg
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Enable DAC for Graphics Stream Control */
id|tmp
op_assign
(paren
id|STG_READ_REG
c_func
(paren
id|DACStreamCtrl
)paren
)paren
op_or
id|SET_BIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|STG_WRITE_REG
c_func
(paren
id|DACStreamCtrl
comma
id|tmp
)paren
suffix:semicolon
)brace
eof
