multiline_comment|/*-*- linux-c -*-&n; *  linux/drivers/video/i810_main.c -- Intel 810 frame buffer device&n; *&n; *      Copyright (C) 2001 Antonino Daplas&lt;adaplas@pol.net&gt;&n; *      All Rights Reserved      &n; *&n; *      Contributors:&n; *         Michael Vogt &lt;mvogt@acm.org&gt; - added support for Intel 815 chipsets&n; *                                        and enabling the power-on state of &n; *                                        external VGA connectors for &n; *                                        secondary displays&n; *&n; *         Fredrik Andersson &lt;krueger@shell.linux.se&gt; - alpha testing of&n; *                                        the VESA GTF&n; *&n; *         Brad Corrion &lt;bcorrion@web-co.com&gt; - alpha testing of customized&n; *                                        timings support&n; *&n; *&t;The code framework is a modification of vfb.c by Geert Uytterhoeven.&n; *      DotClock and PLL calculations are partly based on i810_driver.c &n; *              in xfree86 v4.0.3 by Precision Insight.&n; *      Watermark calculation and tables are based on i810_wmark.c &n; *              in xfre86 v4.0.3 by Precision Insight.  Slight modifications &n; *              only to allow for integer operations instead of floating point.&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License. See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/pci_ids.h&gt;
macro_line|#include &lt;linux/resource.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/div64.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif 
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &quot;i810_regs.h&quot;
macro_line|#include &quot;i810.h&quot;
macro_line|#include &quot;i810_main.h&quot;
multiline_comment|/*------------------------------------------------------------*/
multiline_comment|/**************************************************************&n; *                Hardware Low Level Routines                 *&n; **************************************************************/
multiline_comment|/**&n; * i810_screen_off - turns off/on display&n; * @mmio: address of register space&n; * @mode: on or off&n; *&n; * DESCRIPTION:&n; * Blanks/unblanks the display&n; */
DECL|function|i810_screen_off
r_static
r_void
id|i810_screen_off
c_func
(paren
id|u8
op_star
id|mmio
comma
id|u8
id|mode
)paren
(brace
id|u32
id|count
op_assign
id|WAIT_COUNT
suffix:semicolon
id|u8
id|val
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|val
op_assign
id|i810_readb
c_func
(paren
id|SR_DATA
comma
id|mmio
)paren
suffix:semicolon
id|val
op_assign
(paren
id|mode
op_eq
id|OFF
)paren
ques
c_cond
id|val
op_or
id|SCR_OFF
suffix:colon
id|val
op_amp
op_complement
id|SCR_OFF
suffix:semicolon
r_while
c_loop
(paren
(paren
id|i810_readw
c_func
(paren
id|DISP_SL
comma
id|mmio
)paren
op_amp
l_int|0xFFF
)paren
op_logical_and
id|count
op_decrement
)paren
(brace
suffix:semicolon
)brace
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_DATA
comma
id|mmio
comma
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_dram_off - turns off/on dram refresh&n; * @mmio: address of register space&n; * @mode: on or off&n; *&n; * DESCRIPTION:&n; * Turns off DRAM refresh.  Must be off for only 2 vsyncs&n; * before data becomes corrupt&n; */
DECL|function|i810_dram_off
r_static
r_void
id|i810_dram_off
c_func
(paren
id|u8
op_star
id|mmio
comma
id|u8
id|mode
)paren
(brace
id|u8
id|val
suffix:semicolon
id|val
op_assign
id|i810_readb
c_func
(paren
id|DRAMCH
comma
id|mmio
)paren
suffix:semicolon
id|val
op_and_assign
id|DRAM_OFF
suffix:semicolon
id|val
op_assign
(paren
id|mode
op_eq
id|OFF
)paren
ques
c_cond
id|val
suffix:colon
id|val
op_or
id|DRAM_ON
suffix:semicolon
id|i810_writeb
c_func
(paren
id|DRAMCH
comma
id|mmio
comma
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_protect_regs - allows rw/ro mode of certain VGA registers&n; * @mmio: address of register space&n; * @mode: protect/unprotect&n; *&n; * DESCRIPTION:&n; * The IBM VGA standard allows protection of certain VGA registers.  &n; * This will  protect or unprotect them. &n; */
DECL|function|i810_protect_regs
r_static
r_void
id|i810_protect_regs
c_func
(paren
id|u8
op_star
id|mmio
comma
r_int
id|mode
)paren
(brace
id|u8
id|reg
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR11
)paren
suffix:semicolon
id|reg
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|mode
op_eq
id|OFF
)paren
ques
c_cond
id|reg
op_amp
op_complement
l_int|0x80
suffix:colon
id|reg
op_or
l_int|0x80
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR11
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_pll - loads values for the hardware PLL clock&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Loads the P, M, and N registers.  &n; */
DECL|function|i810_load_pll
r_static
r_void
id|i810_load_pll
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp1
comma
id|tmp2
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|tmp1
op_assign
id|par-&gt;regs.M
op_or
id|par-&gt;regs.N
op_lshift
l_int|16
suffix:semicolon
id|tmp2
op_assign
id|i810_readl
c_func
(paren
id|DCLK_2D
comma
id|mmio
)paren
suffix:semicolon
id|tmp2
op_and_assign
op_complement
id|MN_MASK
suffix:semicolon
id|i810_writel
c_func
(paren
id|DCLK_2D
comma
id|mmio
comma
id|tmp1
op_or
id|tmp2
)paren
suffix:semicolon
id|tmp1
op_assign
id|par-&gt;regs.P
suffix:semicolon
id|tmp2
op_assign
id|i810_readl
c_func
(paren
id|DCLK_0DS
comma
id|mmio
)paren
suffix:semicolon
id|tmp2
op_and_assign
op_complement
(paren
id|P_OR
op_lshift
l_int|16
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|DCLK_0DS
comma
id|mmio
comma
(paren
id|tmp1
op_lshift
l_int|16
)paren
op_or
id|tmp2
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|MSR_WRITE
comma
id|mmio
comma
id|par-&gt;regs.msr
op_or
l_int|0xC8
op_or
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_vga - load standard VGA registers&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Load values to VGA registers&n; */
DECL|function|i810_load_vga
r_static
r_void
id|i810_load_vga
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
multiline_comment|/* interlace */
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR70
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;interlace
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR00
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr00
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR01
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr01
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR02
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr02
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR03
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr03
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR04
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr04
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR05
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr05
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR06
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr06
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR09
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr09
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR10
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr10
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR11
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr11
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR12
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr12
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR15
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr15
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR16
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr16
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_vgax - load extended VGA registers&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Load values to extended VGA registers&n; */
DECL|function|i810_load_vgax
r_static
r_void
id|i810_load_vgax
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR30
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr30
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR31
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr31
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR32
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr32
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR33
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr33
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR35
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr35
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR39
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;regs.cr39
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_2d - load grahics registers&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Load values to graphics registers&n; */
DECL|function|i810_load_2d
r_static
r_void
id|i810_load_2d
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|u8
id|tmp8
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
suffix:semicolon
id|i810_writel
c_func
(paren
id|FW_BLC
comma
id|mmio
comma
id|par-&gt;watermark
)paren
suffix:semicolon
id|tmp
op_assign
id|i810_readl
c_func
(paren
id|PIXCONF
comma
id|mmio
)paren
suffix:semicolon
id|tmp
op_or_assign
l_int|1
op_or
l_int|1
op_lshift
l_int|20
suffix:semicolon
id|i810_writel
c_func
(paren
id|PIXCONF
comma
id|mmio
comma
id|tmp
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|OVRACT
comma
id|mmio
comma
id|par-&gt;ovract
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_INDEX
comma
id|mmio
comma
id|GR10
)paren
suffix:semicolon
id|tmp8
op_assign
id|i810_readb
c_func
(paren
id|GR_DATA
comma
id|mmio
)paren
suffix:semicolon
id|tmp8
op_or_assign
l_int|2
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_INDEX
comma
id|mmio
comma
id|GR10
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_DATA
comma
id|mmio
comma
id|tmp8
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_hires - enables high resolution mode&n; * @mmio: address of register space&n; */
DECL|function|i810_hires
r_static
r_void
id|i810_hires
c_func
(paren
id|u8
op_star
id|mmio
)paren
(brace
id|u8
id|val
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR80
)paren
suffix:semicolon
id|val
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR80
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|val
op_or
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_pitch - loads the characters per line of the display&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Loads the characters per line&n; */
DECL|function|i810_load_pitch
r_static
r_void
id|i810_load_pitch
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp
comma
id|pitch
suffix:semicolon
id|u8
id|val
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|pitch
op_assign
id|par-&gt;pitch
op_rshift
l_int|3
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|val
op_assign
id|i810_readb
c_func
(paren
id|SR_DATA
comma
id|mmio
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0xE0
suffix:semicolon
id|val
op_or_assign
l_int|1
op_or
l_int|1
op_lshift
l_int|2
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_DATA
comma
id|mmio
comma
id|val
)paren
suffix:semicolon
id|tmp
op_assign
id|pitch
op_amp
l_int|0xFF
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR13
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
(paren
id|u8
)paren
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
id|pitch
op_rshift
l_int|8
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR41
)paren
suffix:semicolon
id|val
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
op_amp
op_complement
l_int|0x0F
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR41
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
(paren
id|u8
)paren
id|tmp
op_or
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_color - loads the color depth of the display&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Loads the color depth of the display and the graphics engine&n; */
DECL|function|i810_load_color
r_static
r_void
id|i810_load_color
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|u32
id|reg1
suffix:semicolon
id|u16
id|reg2
suffix:semicolon
id|reg1
op_assign
id|i810_readl
c_func
(paren
id|PIXCONF
comma
id|mmio
)paren
op_amp
op_complement
(paren
l_int|0xF0000
op_or
l_int|1
op_lshift
l_int|27
)paren
suffix:semicolon
id|reg2
op_assign
id|i810_readw
c_func
(paren
id|BLTCNTL
comma
id|mmio
)paren
op_amp
op_complement
l_int|0x30
suffix:semicolon
id|reg1
op_or_assign
l_int|0x8000
op_or
id|par-&gt;pixconf
suffix:semicolon
id|reg2
op_or_assign
id|par-&gt;bltcntl
suffix:semicolon
id|i810_writel
c_func
(paren
id|PIXCONF
comma
id|mmio
comma
id|reg1
)paren
suffix:semicolon
id|i810_writew
c_func
(paren
id|BLTCNTL
comma
id|mmio
comma
id|reg2
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_load_regs - loads all registers for the mode&n; * @par: pointer to i810fb_par structure&n; * &n; * DESCRIPTION:&n; * Loads registers&n; */
DECL|function|i810_load_regs
r_static
r_void
id|i810_load_regs
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|i810_screen_off
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_protect_regs
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_load_pll
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_load_vga
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_load_vgax
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|i810_load_2d
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_hires
c_func
(paren
id|mmio
)paren
suffix:semicolon
id|i810_screen_off
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|i810_protect_regs
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|i810_load_color
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_load_pitch
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
DECL|function|i810_write_dac
r_static
r_void
id|i810_write_dac
c_func
(paren
id|u8
id|regno
comma
id|u8
id|red
comma
id|u8
id|green
comma
id|u8
id|blue
comma
id|u8
op_star
id|mmio
)paren
(brace
id|i810_writeb
c_func
(paren
id|CLUT_INDEX_WRITE
comma
id|mmio
comma
id|regno
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
comma
id|red
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
comma
id|green
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
comma
id|blue
)paren
suffix:semicolon
)brace
DECL|function|i810_read_dac
r_static
r_void
id|i810_read_dac
c_func
(paren
id|u8
id|regno
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
comma
id|u8
op_star
id|mmio
)paren
(brace
id|i810_writeb
c_func
(paren
id|CLUT_INDEX_READ
comma
id|mmio
comma
id|regno
)paren
suffix:semicolon
op_star
id|red
op_assign
id|i810_readb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
)paren
suffix:semicolon
op_star
id|green
op_assign
id|i810_readb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
)paren
suffix:semicolon
op_star
id|blue
op_assign
id|i810_readb
c_func
(paren
id|CLUT_DATA
comma
id|mmio
)paren
suffix:semicolon
)brace
multiline_comment|/************************************************************&n; *                   VGA State Restore                      * &n; ************************************************************/
DECL|function|i810_restore_pll
r_static
r_void
id|i810_restore_pll
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp1
comma
id|tmp2
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|tmp1
op_assign
id|par-&gt;hw_state.dclk_2d
suffix:semicolon
id|tmp2
op_assign
id|i810_readl
c_func
(paren
id|DCLK_2D
comma
id|mmio
)paren
suffix:semicolon
id|tmp1
op_and_assign
op_complement
id|MN_MASK
suffix:semicolon
id|tmp2
op_and_assign
id|MN_MASK
suffix:semicolon
id|i810_writel
c_func
(paren
id|DCLK_2D
comma
id|mmio
comma
id|tmp1
op_or
id|tmp2
)paren
suffix:semicolon
id|tmp1
op_assign
id|par-&gt;hw_state.dclk_1d
suffix:semicolon
id|tmp2
op_assign
id|i810_readl
c_func
(paren
id|DCLK_1D
comma
id|mmio
)paren
suffix:semicolon
id|tmp1
op_and_assign
op_complement
id|MN_MASK
suffix:semicolon
id|tmp2
op_and_assign
id|MN_MASK
suffix:semicolon
id|i810_writel
c_func
(paren
id|DCLK_1D
comma
id|mmio
comma
id|tmp1
op_or
id|tmp2
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|DCLK_0DS
comma
id|mmio
comma
id|par-&gt;hw_state.dclk_0ds
)paren
suffix:semicolon
)brace
DECL|function|i810_restore_dac
r_static
r_void
id|i810_restore_dac
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp1
comma
id|tmp2
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|tmp1
op_assign
id|par-&gt;hw_state.pixconf
suffix:semicolon
id|tmp2
op_assign
id|i810_readl
c_func
(paren
id|PIXCONF
comma
id|mmio
)paren
suffix:semicolon
id|tmp1
op_and_assign
id|DAC_BIT
suffix:semicolon
id|tmp2
op_and_assign
op_complement
id|DAC_BIT
suffix:semicolon
id|i810_writel
c_func
(paren
id|PIXCONF
comma
id|mmio
comma
id|tmp1
op_or
id|tmp2
)paren
suffix:semicolon
)brace
DECL|function|i810_restore_vgax
r_static
r_void
id|i810_restore_vgax
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|i
comma
id|j
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR30
op_plus
id|i
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
op_star
(paren
op_amp
(paren
id|par-&gt;hw_state.cr30
)paren
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR35
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;hw_state.cr35
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR39
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;hw_state.cr39
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR41
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;hw_state.cr39
)paren
suffix:semicolon
multiline_comment|/*restore interlace*/
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR70
)paren
suffix:semicolon
id|i
op_assign
id|par-&gt;hw_state.cr70
suffix:semicolon
id|i
op_and_assign
id|INTERLACE_BIT
suffix:semicolon
id|j
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR70
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|j
op_or
id|i
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR80
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
id|par-&gt;hw_state.cr80
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|MSR_WRITE
comma
id|mmio
comma
id|par-&gt;hw_state.msr
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|i
op_assign
(paren
id|par-&gt;hw_state.sr01
)paren
op_amp
op_complement
l_int|0xE0
suffix:semicolon
id|j
op_assign
id|i810_readb
c_func
(paren
id|SR_DATA
comma
id|mmio
)paren
op_amp
l_int|0xE0
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_DATA
comma
id|mmio
comma
id|i
op_or
id|j
)paren
suffix:semicolon
)brace
DECL|function|i810_restore_vga
r_static
r_void
id|i810_restore_vga
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|i
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR00
op_plus
id|i
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
op_star
(paren
(paren
op_amp
id|par-&gt;hw_state.cr00
)paren
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR10
op_plus
id|i
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
comma
op_star
(paren
(paren
op_amp
id|par-&gt;hw_state.cr10
)paren
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|i810_restore_addr_map
r_static
r_void
id|i810_restore_addr_map
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|tmp
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_INDEX
comma
id|mmio
comma
id|GR10
)paren
suffix:semicolon
id|tmp
op_assign
id|i810_readb
c_func
(paren
id|GR_DATA
comma
id|mmio
)paren
suffix:semicolon
id|tmp
op_and_assign
id|ADDR_MAP_MASK
suffix:semicolon
id|tmp
op_or_assign
id|par-&gt;hw_state.gr10
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_INDEX
comma
id|mmio
comma
id|GR10
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|GR_DATA
comma
id|mmio
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|i810_restore_2d
r_static
r_void
id|i810_restore_2d
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u32
id|tmp_long
suffix:semicolon
id|u16
id|tmp_word
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|tmp_word
op_assign
id|i810_readw
c_func
(paren
id|BLTCNTL
comma
id|mmio
)paren
suffix:semicolon
id|tmp_word
op_and_assign
op_complement
(paren
l_int|3
op_lshift
l_int|4
)paren
suffix:semicolon
id|tmp_word
op_or_assign
id|par-&gt;hw_state.bltcntl
suffix:semicolon
id|i810_writew
c_func
(paren
id|BLTCNTL
comma
id|mmio
comma
id|tmp_word
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|PIXCONF
comma
id|mmio
comma
id|par-&gt;hw_state.pixconf
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|tmp_word
op_assign
id|i810_readw
c_func
(paren
id|HWSTAM
comma
id|mmio
)paren
suffix:semicolon
id|tmp_word
op_and_assign
l_int|3
op_lshift
l_int|13
suffix:semicolon
id|tmp_word
op_or_assign
id|par-&gt;hw_state.hwstam
suffix:semicolon
id|i810_writew
c_func
(paren
id|HWSTAM
comma
id|mmio
comma
id|tmp_word
)paren
suffix:semicolon
id|tmp_long
op_assign
id|i810_readl
c_func
(paren
id|FW_BLC
comma
id|mmio
)paren
suffix:semicolon
id|tmp_long
op_and_assign
id|FW_BLC_MASK
suffix:semicolon
id|tmp_long
op_or_assign
id|par-&gt;hw_state.fw_blc
suffix:semicolon
id|i810_writel
c_func
(paren
id|FW_BLC
comma
id|mmio
comma
id|tmp_long
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|HWS_PGA
comma
id|mmio
comma
id|par-&gt;hw_state.hws_pga
)paren
suffix:semicolon
id|i810_writew
c_func
(paren
id|IER
comma
id|mmio
comma
id|par-&gt;hw_state.ier
)paren
suffix:semicolon
id|i810_writew
c_func
(paren
id|IMR
comma
id|mmio
comma
id|par-&gt;hw_state.imr
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|DPLYSTAS
comma
id|mmio
comma
id|par-&gt;hw_state.dplystas
)paren
suffix:semicolon
)brace
DECL|function|i810_restore_vga_state
r_static
r_void
id|i810_restore_vga_state
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|i810_screen_off
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_protect_regs
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_restore_pll
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_restore_dac
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_restore_vga
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_restore_vgax
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_restore_addr_map
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_dram_off
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|i810_restore_2d
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_screen_off
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
id|i810_protect_regs
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; *                         VGA State Save                              *&n; ***********************************************************************/
DECL|function|i810_save_vgax
r_static
r_void
id|i810_save_vgax
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|i
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR30
op_plus
id|i
)paren
suffix:semicolon
op_star
(paren
op_amp
(paren
id|par-&gt;hw_state.cr30
)paren
op_plus
id|i
)paren
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
)brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR35
)paren
suffix:semicolon
id|par-&gt;hw_state.cr35
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR39
)paren
suffix:semicolon
id|par-&gt;hw_state.cr39
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR41
)paren
suffix:semicolon
id|par-&gt;hw_state.cr41
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR70
)paren
suffix:semicolon
id|par-&gt;hw_state.cr70
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.msr
op_assign
id|i810_readb
c_func
(paren
id|MSR_READ
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR80
)paren
suffix:semicolon
id|par-&gt;hw_state.cr80
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|SR_INDEX
comma
id|mmio
comma
id|SR01
)paren
suffix:semicolon
id|par-&gt;hw_state.sr01
op_assign
id|i810_readb
c_func
(paren
id|SR_DATA
comma
id|mmio
)paren
suffix:semicolon
)brace
DECL|function|i810_save_vga
r_static
r_void
id|i810_save_vga
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|i
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR00
op_plus
id|i
)paren
suffix:semicolon
op_star
(paren
(paren
op_amp
id|par-&gt;hw_state.cr00
)paren
op_plus
id|i
)paren
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|CR_INDEX_CGA
comma
id|mmio
comma
id|CR10
op_plus
id|i
)paren
suffix:semicolon
op_star
(paren
(paren
op_amp
id|par-&gt;hw_state.cr10
)paren
op_plus
id|i
)paren
op_assign
id|i810_readb
c_func
(paren
id|CR_DATA_CGA
comma
id|mmio
)paren
suffix:semicolon
)brace
)brace
DECL|function|i810_save_2d
r_static
r_void
id|i810_save_2d
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|par-&gt;hw_state.dclk_2d
op_assign
id|i810_readl
c_func
(paren
id|DCLK_2D
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.dclk_1d
op_assign
id|i810_readl
c_func
(paren
id|DCLK_1D
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.dclk_0ds
op_assign
id|i810_readl
c_func
(paren
id|DCLK_0DS
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.pixconf
op_assign
id|i810_readl
c_func
(paren
id|PIXCONF
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.fw_blc
op_assign
id|i810_readl
c_func
(paren
id|FW_BLC
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.bltcntl
op_assign
id|i810_readw
c_func
(paren
id|BLTCNTL
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.hwstam
op_assign
id|i810_readw
c_func
(paren
id|HWSTAM
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.hws_pga
op_assign
id|i810_readl
c_func
(paren
id|HWS_PGA
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.ier
op_assign
id|i810_readw
c_func
(paren
id|IER
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.imr
op_assign
id|i810_readw
c_func
(paren
id|IMR
comma
id|mmio
)paren
suffix:semicolon
id|par-&gt;hw_state.dplystas
op_assign
id|i810_readl
c_func
(paren
id|DPLYSTAS
comma
id|mmio
)paren
suffix:semicolon
)brace
DECL|function|i810_save_vga_state
r_static
r_void
id|i810_save_vga_state
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|i810_save_vga
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_save_vgax
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_save_2d
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
multiline_comment|/************************************************************&n; *                    Helpers                               * &n; ************************************************************/
multiline_comment|/**&n; * get_line_length - calculates buffer pitch in bytes&n; * @par: pointer to i810fb_par structure&n; * @xres_virtual: virtual resolution of the frame&n; * @bpp: bits per pixel&n; *&n; * DESCRIPTION:&n; * Calculates buffer pitch in bytes.  &n; */
DECL|function|get_line_length
id|u32
id|get_line_length
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
comma
r_int
id|xres_virtual
comma
r_int
id|bpp
)paren
(brace
id|u32
id|length
suffix:semicolon
id|length
op_assign
id|xres_virtual
op_star
id|bpp
suffix:semicolon
id|length
op_assign
(paren
id|length
op_plus
l_int|31
)paren
op_amp
op_minus
l_int|32
suffix:semicolon
id|length
op_rshift_assign
l_int|3
suffix:semicolon
r_return
id|length
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_calc_dclk - calculates the P, M, and N values of a pixelclock value&n; * @freq: target pixelclock in picoseconds&n; * @m: where to write M register&n; * @n: where to write N register&n; * @p: where to write P register&n; *&n; * DESCRIPTION:&n; * Based on the formula Freq_actual = (4*M*Freq_ref)/(N^P)&n; * Repeatedly computes the Freq until the actual Freq is equal to&n; * the target Freq or until the loop count is zero.  In the latter&n; * case, the actual frequency nearest the target will be used.&n; */
DECL|function|i810_calc_dclk
r_static
r_void
id|i810_calc_dclk
c_func
(paren
id|u32
id|freq
comma
id|u32
op_star
id|m
comma
id|u32
op_star
id|n
comma
id|u32
op_star
id|p
)paren
(brace
id|u32
id|m_reg
comma
id|n_reg
comma
id|p_divisor
comma
id|n_target_max
suffix:semicolon
id|u32
id|m_target
comma
id|n_target
comma
id|p_target
comma
id|n_best
comma
id|m_best
comma
id|mod
suffix:semicolon
id|u32
id|f_out
comma
id|target_freq
comma
id|diff
op_assign
l_int|0
comma
id|mod_min
comma
id|diff_min
suffix:semicolon
id|diff_min
op_assign
id|mod_min
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|n_best
op_assign
id|m_best
op_assign
id|m_target
op_assign
id|f_out
op_assign
l_int|0
suffix:semicolon
id|target_freq
op_assign
id|freq
suffix:semicolon
id|n_target_max
op_assign
l_int|30
suffix:semicolon
multiline_comment|/*&n;&t; * find P such that target freq is 16x reference freq (Hz). &n;&t; */
id|p_divisor
op_assign
l_int|1
suffix:semicolon
id|p_target
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
l_int|1000000
op_star
id|p_divisor
)paren
op_div
(paren
l_int|16
op_star
l_int|24
op_star
id|target_freq
)paren
)paren
op_logical_and
id|p_divisor
op_le
l_int|32
)paren
(brace
id|p_divisor
op_lshift_assign
l_int|1
suffix:semicolon
id|p_target
op_increment
suffix:semicolon
)brace
id|n_reg
op_assign
id|m_reg
op_assign
id|n_target
op_assign
l_int|3
suffix:semicolon
r_while
c_loop
(paren
(paren
id|diff_min
op_logical_or
id|mod_min
)paren
op_logical_and
(paren
id|n_target
OL
id|n_target_max
)paren
)paren
(brace
id|f_out
op_assign
(paren
id|p_divisor
op_star
id|n_reg
op_star
l_int|1000000
)paren
op_div
(paren
l_int|4
op_star
l_int|24
op_star
id|m_reg
)paren
suffix:semicolon
id|mod
op_assign
(paren
id|p_divisor
op_star
id|n_reg
op_star
l_int|1000000
)paren
op_mod
(paren
l_int|4
op_star
l_int|24
op_star
id|m_reg
)paren
suffix:semicolon
id|m_target
op_assign
id|m_reg
suffix:semicolon
id|n_target
op_assign
id|n_reg
suffix:semicolon
r_if
c_cond
(paren
id|f_out
op_le
id|target_freq
)paren
(brace
id|n_reg
op_increment
suffix:semicolon
id|diff
op_assign
id|target_freq
op_minus
id|f_out
suffix:semicolon
)brace
r_else
(brace
id|m_reg
op_increment
suffix:semicolon
id|diff
op_assign
id|f_out
op_minus
id|target_freq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|diff_min
OG
id|diff
)paren
(brace
id|diff_min
op_assign
id|diff
suffix:semicolon
id|n_best
op_assign
id|n_target
suffix:semicolon
id|m_best
op_assign
id|m_target
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|diff
op_logical_and
id|mod_min
OG
id|mod
)paren
(brace
id|mod_min
op_assign
id|mod
suffix:semicolon
id|n_best
op_assign
id|n_target
suffix:semicolon
id|m_best
op_assign
id|m_target
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|m
)paren
op_star
id|m
op_assign
(paren
id|m_best
op_minus
l_int|2
)paren
op_amp
l_int|0x3FF
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
op_star
id|n
op_assign
(paren
id|n_best
op_minus
l_int|2
)paren
op_amp
l_int|0x3FF
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
op_star
id|p
op_assign
(paren
id|p_target
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_get_vblank - get vertical blank time&n; * @hfreq: horizontal freq&n; *&n; * DESCRIPTION:&n; * vblank = right_margin + vsync_len + left_margin &n; *    given: right_margin = 1 (V_FRONTPORCH)&n; *           vsync_len    = 3&n; *           flyback      = 550&n; *&n; *                          flyback * hfreq&n; *           left_margin  = --------------- - vsync_len&n; *                           1000000&n; *           and flyback is set to 550&n; */
DECL|function|i810_get_vblank
r_static
id|u32
id|i810_get_vblank
c_func
(paren
id|u32
id|hfreq
)paren
(brace
id|u32
id|vblank
suffix:semicolon
id|vblank
op_assign
(paren
id|hfreq
op_star
id|FLYBACK
)paren
op_div
l_int|1000
suffix:semicolon
id|vblank
op_assign
(paren
id|vblank
op_plus
l_int|500
)paren
op_div
l_int|1000
suffix:semicolon
r_return
(paren
id|vblank
op_plus
id|V_FRONTPORCH
)paren
suffix:semicolon
)brace
multiline_comment|/** &n; * i810_get_hblank - get horizontal blank time&n; * @hfreq: horizontal freq&n; * @xres: horizontal resolution in pixels&n; *&n; * DESCRIPTION:&n; * duty cycle is the percent of htotal assigned to inactive display&n; * duty cycle = C - (M/Hfreq)&n; * where: C = ((offset - scale factor) * blank_scale)&n; *            -------------------------------------- + scale factor&n; *                        256 &n; *        M = blank_scale * gradient&n; *&n; *           xres * duty_cycle&n; * hblank = ------------------&n; *           100 - duty_cycle&n; */
DECL|function|i810_get_hblank
r_static
id|u32
id|i810_get_hblank
c_func
(paren
id|u32
id|hfreq
comma
id|u32
id|xres
)paren
(brace
id|u32
id|c_val
comma
id|m_val
comma
id|duty_cycle
comma
id|hblank
suffix:semicolon
id|c_val
op_assign
(paren
(paren
(paren
id|H_OFFSET
op_minus
id|H_SCALEFACTOR
)paren
op_star
id|H_BLANKSCALE
)paren
op_div
l_int|256
op_plus
id|H_SCALEFACTOR
)paren
op_star
l_int|1000
suffix:semicolon
id|m_val
op_assign
(paren
id|H_BLANKSCALE
op_star
id|H_GRADIENT
)paren
op_div
l_int|256
suffix:semicolon
id|m_val
op_assign
(paren
id|m_val
op_star
l_int|1000000
)paren
op_div
id|hfreq
suffix:semicolon
id|duty_cycle
op_assign
id|c_val
op_minus
id|m_val
suffix:semicolon
id|hblank
op_assign
(paren
id|xres
op_star
id|duty_cycle
)paren
op_div
(paren
l_int|100000
op_minus
id|duty_cycle
)paren
suffix:semicolon
id|hblank
op_assign
(paren
id|hblank
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
r_return
(paren
id|hblank
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_estimate_hfreq - estimate hsync&n; * @vfreq: vertical refresh rate&n; * @yres: vertical resolution&n; *&n; * DESCRIPTION:&n; * Based on:&n; *&n; *          (yres + front_port) * vfreq * 1000000&n; * hfreq = -------------------------------------&n; *          (1000000 - (vfreq * FLYBACK)&n; * &n; */
DECL|function|i810_estimate_hfreq
r_static
id|u32
id|i810_estimate_hfreq
c_func
(paren
id|u32
id|vfreq
comma
id|u32
id|yres
)paren
(brace
id|u64
id|hfreq
suffix:semicolon
id|u32
id|divisor
suffix:semicolon
id|divisor
op_assign
l_int|1000000
op_minus
(paren
id|vfreq
op_star
id|FLYBACK
)paren
suffix:semicolon
id|hfreq
op_assign
(paren
id|u64
)paren
(paren
id|yres
op_plus
id|V_FRONTPORCH
)paren
op_star
(paren
id|u64
)paren
(paren
id|vfreq
)paren
op_star
l_int|1000000
suffix:semicolon
id|do_div
c_func
(paren
id|hfreq
comma
id|divisor
)paren
suffix:semicolon
r_return
(paren
(paren
id|u32
)paren
id|hfreq
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_calculate_timings - calculate video timings &n; * @info: pointer to fb_info structure&n; * @var: pointer to current var&n; * &n; * DESCRIPTION:&n; * htotal: calculated using GTF&n; * vtotal: calculated using GTF&n; * hsync pulse:  8% of htotal&n; * vsync pulse:  3 &n; * left margin : (htotal - xres)/2 - hsync&n; * right margin: sync + left margin&n; * upper margin: 1&n; * lower margin: vtotal - (yres + vsync + upper margin)&n; *&n; * Calculates necessary timing information based on &n; * monitor specifications.  This will use the &n; * VESA generalized timing formula. New values are&n; * written to @var.&n; */
DECL|function|i810_calculate_timings
r_static
r_int
id|i810_calculate_timings
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
id|u32
id|xres
comma
id|u32
id|yres
)paren
(brace
id|u64
id|num
op_assign
l_int|1000000000000
suffix:semicolon
id|u32
id|htotal
op_assign
l_int|0
comma
id|vtotal
comma
id|hfreq
comma
id|vfreq
comma
id|hblank
comma
id|vblank
suffix:semicolon
id|u32
id|dclk
comma
id|interlace
op_assign
l_int|0
comma
id|dscan
op_assign
l_int|0
suffix:semicolon
id|u32
id|max_pixclock
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|max_pixclock
op_assign
l_int|234000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|max_pixclock
op_assign
l_int|229000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|max_pixclock
op_assign
l_int|204000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|max_pixclock
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
id|yres
op_rshift_assign
l_int|1
suffix:semicolon
id|interlace
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|yres
op_lshift_assign
l_int|1
suffix:semicolon
id|dscan
op_assign
l_int|1
suffix:semicolon
)brace
id|hfreq
op_assign
id|info-&gt;monspecs.hfmax
suffix:semicolon
id|vblank
op_assign
id|i810_get_vblank
c_func
(paren
id|hfreq
)paren
suffix:semicolon
id|vtotal
op_assign
id|yres
op_plus
id|vblank
suffix:semicolon
id|vfreq
op_assign
id|hfreq
op_div
id|vtotal
suffix:semicolon
r_if
c_cond
(paren
id|vfreq
OG
id|info-&gt;monspecs.vfmax
)paren
(brace
id|vfreq
op_assign
id|info-&gt;monspecs.vfmax
suffix:semicolon
id|hfreq
op_assign
id|i810_estimate_hfreq
c_func
(paren
id|vfreq
comma
id|yres
)paren
suffix:semicolon
id|vblank
op_assign
id|i810_get_vblank
c_func
(paren
id|hfreq
)paren
suffix:semicolon
id|vtotal
op_assign
id|yres
op_plus
id|vblank
suffix:semicolon
)brace
id|hblank
op_assign
id|i810_get_hblank
c_func
(paren
id|hfreq
comma
id|xres
)paren
suffix:semicolon
id|htotal
op_assign
id|xres
op_plus
id|hblank
suffix:semicolon
id|dclk
op_assign
id|htotal
op_star
id|hfreq
suffix:semicolon
r_while
c_loop
(paren
id|dclk
OG
id|max_pixclock
op_logical_and
id|hfreq
OG
id|info-&gt;monspecs.hfmin
op_logical_and
id|vfreq
OG
id|info-&gt;monspecs.vfmin
)paren
(brace
id|hfreq
op_sub_assign
l_int|1000
suffix:semicolon
id|vblank
op_assign
id|i810_get_vblank
c_func
(paren
id|hfreq
)paren
suffix:semicolon
id|vtotal
op_assign
id|yres
op_plus
id|vblank
suffix:semicolon
id|vfreq
op_assign
id|hfreq
op_div
id|vtotal
suffix:semicolon
id|hblank
op_assign
id|i810_get_hblank
c_func
(paren
id|hfreq
comma
id|xres
)paren
suffix:semicolon
id|htotal
op_assign
id|xres
op_plus
id|hblank
suffix:semicolon
id|dclk
op_assign
id|hfreq
op_star
id|htotal
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vfreq
OL
id|info-&gt;monspecs.vfmin
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb: required vertical refresh, %dHz, &quot;
l_string|&quot;for %dx%d is out of range&bslash;n&quot;
comma
id|vfreq
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hfreq
OL
id|info-&gt;monspecs.hfmin
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb: required horizontal sync frequency, %dKHz, &quot;
l_string|&quot;for %dx%d is out of range&bslash;n&quot;
comma
id|hfreq
op_div
l_int|1000
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dclk
OL
id|MIN_PIXELCLOCK
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb: required pixelclock, %dMHz, for %dx%d&quot;
l_string|&quot; is out of range&bslash;n&quot;
comma
id|dclk
op_div
l_int|1000000
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|do_div
c_func
(paren
id|num
comma
id|dclk
)paren
suffix:semicolon
id|var-&gt;pixclock
op_assign
(paren
id|u32
)paren
id|num
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
(paren
id|htotal
op_star
l_int|8
)paren
op_div
l_int|100
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
(paren
id|hblank
op_rshift
l_int|1
)paren
op_minus
id|var-&gt;hsync_len
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|var-&gt;left_margin
op_assign
(paren
id|hblank
op_minus
id|var-&gt;right_margin
op_minus
id|var-&gt;hsync_len
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|var-&gt;vsync_len
op_assign
(paren
l_int|3
op_lshift
id|interlace
)paren
op_rshift
id|dscan
suffix:semicolon
id|var-&gt;lower_margin
op_assign
(paren
l_int|1
op_lshift
id|interlace
)paren
op_rshift
id|dscan
suffix:semicolon
id|var-&gt;upper_margin
op_assign
(paren
(paren
id|vblank
op_lshift
id|interlace
)paren
op_rshift
id|dscan
)paren
op_minus
(paren
id|var-&gt;vsync_len
op_plus
id|var-&gt;lower_margin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|yres
OG
l_int|480
op_logical_or
(paren
id|yres
op_eq
l_int|200
op_logical_and
id|vfreq
op_eq
l_int|60
op_logical_and
id|hfreq
op_div
l_int|100
op_eq
l_int|157
)paren
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
op_or
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|yres
op_eq
l_int|400
op_logical_and
id|vfreq
op_eq
l_int|70
op_logical_and
id|hfreq
op_div
l_int|100
op_eq
l_int|315
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_VERT_HIGH_ACT
suffix:semicolon
r_if
c_cond
(paren
id|yres
op_eq
l_int|350
op_logical_and
id|vfreq
op_eq
l_int|60
op_logical_and
id|hfreq
op_div
l_int|100
op_eq
l_int|218
)paren
id|var-&gt;sync
op_or_assign
id|FB_SYNC_HOR_HIGH_ACT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_check_custom_timings - validates user entered timings&n; * @info: pointer to fb_info&n; * @var: pointer to current fb_var_screeninfo&n; *&n; * DESCRIPTION:&n; * Validates user entered timings in @var.&n; */
DECL|function|i810_check_custom_timings
r_static
r_int
id|i810_check_custom_timings
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
id|u32
id|xres
comma
id|u32
id|yres
)paren
(brace
id|u64
id|num
op_assign
l_int|1000000000000
suffix:semicolon
id|u32
id|hfreq
comma
id|vfreq
comma
id|htotal
comma
id|vtotal
comma
id|pixclock
suffix:semicolon
id|u32
id|max_pixclock
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|var-&gt;pixclock
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|do_div
c_func
(paren
id|num
comma
id|var-&gt;pixclock
)paren
suffix:semicolon
id|pixclock
op_assign
(paren
id|u32
)paren
id|num
suffix:semicolon
id|htotal
op_assign
id|xres
op_plus
id|var-&gt;right_margin
op_plus
id|var-&gt;hsync_len
op_plus
id|var-&gt;left_margin
suffix:semicolon
id|vtotal
op_assign
id|yres
op_plus
id|var-&gt;lower_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;upper_margin
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
id|vtotal
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
id|vtotal
op_lshift_assign
l_int|1
suffix:semicolon
id|hfreq
op_assign
id|pixclock
op_div
id|htotal
suffix:semicolon
id|vfreq
op_assign
id|hfreq
op_div
id|vtotal
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|max_pixclock
op_assign
l_int|234000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|max_pixclock
op_assign
l_int|229000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
id|max_pixclock
op_assign
l_int|204000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|max_pixclock
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pixclock
template_param
id|max_pixclock
op_logical_or
id|hfreq
template_param
id|info-&gt;monspecs.hfmax
op_logical_or
id|vfreq
template_param
id|info-&gt;monspecs.vfmax
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*************************************************************&n; *                Hardware Cursor Routines                   *&n; *************************************************************/
multiline_comment|/**&n; * i810_enable_cursor - show or hide the hardware cursor&n; * @mmio: address of register space&n; * @mode: show (1) or hide (0)&n; *&n; * Description:&n; * Shows or hides the hardware cursor&n; */
DECL|function|i810_enable_cursor
r_void
id|i810_enable_cursor
c_func
(paren
id|u8
op_star
id|mmio
comma
r_int
id|mode
)paren
(brace
id|u32
id|temp
suffix:semicolon
id|temp
op_assign
id|i810_readl
c_func
(paren
id|PIXCONF
comma
id|mmio
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|mode
op_eq
id|ON
)paren
ques
c_cond
id|temp
op_or
id|CURSOR_ENABLE_MASK
suffix:colon
id|temp
op_amp
op_complement
id|CURSOR_ENABLE_MASK
suffix:semicolon
id|i810_writel
c_func
(paren
id|PIXCONF
comma
id|mmio
comma
id|temp
)paren
suffix:semicolon
)brace
DECL|function|i810_reset_cursor_image
r_static
r_void
id|i810_reset_cursor_image
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|addr
op_assign
id|par-&gt;cursor_heap
dot
r_virtual
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|64
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|j
comma
id|addr
comma
l_int|0xff
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|j
op_plus
l_int|8
comma
id|addr
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
DECL|function|i810_load_cursor_image
r_static
r_void
id|i810_load_cursor_image
c_func
(paren
r_int
id|width
comma
r_int
id|height
comma
id|u8
op_star
id|data
comma
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|addr
op_assign
id|par-&gt;cursor_heap
dot
r_virtual
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|w
op_assign
(paren
id|width
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|w
suffix:semicolon
id|j
op_increment
)paren
(brace
id|i810_writeb
c_func
(paren
id|j
op_plus
l_int|0
comma
id|addr
comma
l_int|0x00
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|j
op_plus
l_int|8
comma
id|addr
comma
op_star
id|data
op_increment
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
DECL|function|i810_load_cursor_colors
r_static
r_void
id|i810_load_cursor_colors
c_func
(paren
r_int
id|fg
comma
r_int
id|bg
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
comma
id|temp
suffix:semicolon
id|u8
id|red
comma
id|green
comma
id|blue
comma
id|trans
suffix:semicolon
id|i810fb_getcolreg
c_func
(paren
id|bg
comma
op_amp
id|red
comma
op_amp
id|green
comma
op_amp
id|blue
comma
op_amp
id|trans
comma
id|info
)paren
suffix:semicolon
id|temp
op_assign
id|i810_readb
c_func
(paren
id|PIXCONF1
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
op_or
id|EXTENDED_PALETTE
)paren
suffix:semicolon
id|i810_write_dac
c_func
(paren
l_int|4
comma
id|red
comma
id|green
comma
id|blue
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
)paren
suffix:semicolon
id|i810fb_getcolreg
c_func
(paren
id|fg
comma
op_amp
id|red
comma
op_amp
id|green
comma
op_amp
id|blue
comma
op_amp
id|trans
comma
id|info
)paren
suffix:semicolon
id|temp
op_assign
id|i810_readb
c_func
(paren
id|PIXCONF1
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
op_or
id|EXTENDED_PALETTE
)paren
suffix:semicolon
id|i810_write_dac
c_func
(paren
l_int|5
comma
id|red
comma
id|green
comma
id|blue
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_init_cursor - initializes the cursor&n; * @par: pointer to i810fb_par structure&n; *&n; * DESCRIPTION:&n; * Initializes the cursor registers&n; */
DECL|function|i810_init_cursor
r_static
r_void
id|i810_init_cursor
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|i810_enable_cursor
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|CURBASE
comma
id|mmio
comma
id|par-&gt;cursor_heap.physical
)paren
suffix:semicolon
id|i810_writew
c_func
(paren
id|CURCNTR
comma
id|mmio
comma
id|COORD_ACTIVE
op_or
id|CURSOR_MODE_64_XOR
)paren
suffix:semicolon
)brace
multiline_comment|/*********************************************************************&n; *                    Framebuffer hook helpers                       *&n; *********************************************************************/
multiline_comment|/**&n; * i810_round_off -  Round off values to capability of hardware&n; * @var: pointer to fb_var_screeninfo structure&n; *&n; * DESCRIPTION:&n; * @var contains user-defined information for the mode to be set.&n; * This will try modify those values to ones nearest the&n; * capability of the hardware&n; */
DECL|function|i810_round_off
r_static
r_void
id|i810_round_off
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
id|u32
id|xres
comma
id|yres
comma
id|vxres
comma
id|vyres
suffix:semicolon
multiline_comment|/*&n;&t; *  Presently supports only these configurations &n;&t; */
id|xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|yres
op_assign
id|var-&gt;yres
suffix:semicolon
id|vxres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|vyres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
id|var-&gt;bits_per_pixel
op_add_assign
l_int|7
suffix:semicolon
id|var-&gt;bits_per_pixel
op_and_assign
op_complement
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
OL
l_int|8
)paren
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
OG
l_int|32
)paren
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
id|round_off_xres
c_func
(paren
op_amp
id|xres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xres
OL
l_int|40
)paren
id|xres
op_assign
l_int|40
suffix:semicolon
r_if
c_cond
(paren
id|xres
OG
l_int|2048
)paren
id|xres
op_assign
l_int|2048
suffix:semicolon
id|xres
op_assign
(paren
id|xres
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|vxres
OL
id|xres
)paren
id|vxres
op_assign
id|xres
suffix:semicolon
id|round_off_yres
c_func
(paren
op_amp
id|xres
comma
op_amp
id|yres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|yres
OL
l_int|1
)paren
id|yres
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|yres
op_ge
l_int|2048
)paren
id|yres
op_assign
l_int|2048
suffix:semicolon
r_if
c_cond
(paren
id|vyres
OL
id|yres
)paren
id|vyres
op_assign
id|yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|32
)paren
id|var-&gt;accel_flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* round of horizontal timings to nearest 8 pixels */
id|var-&gt;left_margin
op_assign
(paren
id|var-&gt;left_margin
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|var-&gt;right_margin
op_assign
(paren
id|var-&gt;right_margin
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
id|var-&gt;hsync_len
op_assign
(paren
id|var-&gt;hsync_len
op_plus
l_int|4
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_INTERLACED
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|yres
op_plus
id|var-&gt;upper_margin
op_plus
id|var-&gt;vsync_len
op_plus
id|var-&gt;lower_margin
)paren
op_amp
l_int|1
)paren
)paren
id|var-&gt;upper_margin
op_increment
suffix:semicolon
)brace
id|var-&gt;xres
op_assign
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|vyres
suffix:semicolon
)brace
multiline_comment|/**&n; * set_color_bitfields - sets rgba fields&n; * @var: pointer to fb_var_screeninfo&n; *&n; * DESCRIPTION:&n; * The length, offset and ordering  for each color field &n; * (red, green, blue)  will be set as specified &n; * by the hardware&n; */
DECL|function|set_color_bitfields
r_static
r_void
id|set_color_bitfields
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* RGB 555 */
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|15
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* RGB 565 */
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
multiline_comment|/* RGB 888   */
r_case
l_int|32
suffix:colon
multiline_comment|/* RGBA 8888 */
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;bits_per_pixel
op_eq
l_int|24
)paren
(brace
id|var-&gt;transp.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;transp.offset
op_assign
l_int|24
suffix:semicolon
id|var-&gt;transp.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|var-&gt;red.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;green.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;blue.msb_right
op_assign
l_int|0
suffix:semicolon
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_check_params - check if contents in var are valid&n; * @var: pointer to fb_var_screeninfo&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * This will check if the framebuffer size is sufficient &n; * for the current mode and if the user&squot;s monitor has the &n; * required specifications to display the current mode.&n; */
DECL|function|i810_check_params
r_static
r_int
id|i810_check_params
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|line_length
comma
id|vidmem
suffix:semicolon
id|u32
id|xres
comma
id|yres
comma
id|vxres
comma
id|vyres
suffix:semicolon
id|xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|yres
op_assign
id|var-&gt;yres
suffix:semicolon
id|vxres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|vyres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
multiline_comment|/*&n;&t; *  Memory limit&n;&t; */
id|line_length
op_assign
id|get_line_length
c_func
(paren
id|par
comma
id|vxres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|vidmem
op_assign
id|line_length
op_star
id|vyres
suffix:semicolon
r_if
c_cond
(paren
id|vidmem
OG
id|par-&gt;fb.size
)paren
(brace
id|vyres
op_assign
id|par-&gt;fb.size
op_div
id|line_length
suffix:semicolon
r_if
c_cond
(paren
id|vyres
OL
id|yres
)paren
(brace
id|vyres
op_assign
id|yres
suffix:semicolon
id|vxres
op_assign
id|par-&gt;fb.size
op_div
id|vyres
suffix:semicolon
id|vxres
op_div_assign
id|var-&gt;bits_per_pixel
op_rshift
l_int|3
suffix:semicolon
id|line_length
op_assign
id|get_line_length
c_func
(paren
id|par
comma
id|vxres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|vidmem
op_assign
id|line_length
op_star
id|yres
suffix:semicolon
r_if
c_cond
(paren
id|vxres
OL
id|xres
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb: required video memory, &quot;
l_string|&quot;%d bytes, for %dx%d-%d (virtual) &quot;
l_string|&quot;is out of range&bslash;n&quot;
comma
id|vidmem
comma
id|vxres
comma
id|vyres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; * Monitor limit&n;&t; */
r_if
c_cond
(paren
id|i810_check_custom_timings
c_func
(paren
id|info
comma
id|var
comma
id|xres
comma
id|yres
)paren
)paren
(brace
r_if
c_cond
(paren
id|i810_calculate_timings
c_func
(paren
id|info
comma
id|var
comma
id|xres
comma
id|yres
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|var-&gt;xres
op_assign
id|xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|yres
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|vxres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|vyres
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * encode_fix - fill up fb_fix_screeninfo structure&n; * @fix: pointer to fb_fix_screeninfo&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * This will set up parameters that are unmodifiable by the user.&n; */
DECL|function|encode_fix
r_static
r_int
id|encode_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fix-&gt;id
comma
id|i810fb_name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|par-&gt;fb.physical
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|par-&gt;fb.size
suffix:semicolon
id|fix-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|fix-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|8
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|fix-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_case
l_int|24
suffix:colon
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|info-&gt;var.nonstd
)paren
id|fix-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
r_else
id|fix-&gt;visual
op_assign
id|FB_VISUAL_TRUECOLOR
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|fix-&gt;line_length
op_assign
id|get_line_length
c_func
(paren
id|par
comma
id|info-&gt;var.xres_virtual
comma
id|info-&gt;var.bits_per_pixel
)paren
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|par-&gt;mmio_start_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|MMIO_SIZE
suffix:semicolon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_I810
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * decode_var - modify par according to contents of var&n; * @var: pointer to fb_var_screeninfo&n; * @par: pointer to i810fb_par&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * Based on the contents of @var, @par will be dynamically filled up.&n; * @par contains all information necessary to modify the hardware. &n;*/
DECL|function|decode_var
r_static
r_void
id|decode_var
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|i810fb_par
op_star
id|par
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|u32
id|xres
comma
id|yres
comma
id|vxres
comma
id|vyres
suffix:semicolon
id|xres
op_assign
id|var-&gt;xres
suffix:semicolon
id|yres
op_assign
id|var-&gt;yres
suffix:semicolon
id|vxres
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|vyres
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|par-&gt;pixconf
op_assign
id|PIXCONF8
suffix:semicolon
id|par-&gt;bltcntl
op_assign
l_int|0
suffix:semicolon
id|par-&gt;depth
op_assign
l_int|1
suffix:semicolon
id|par-&gt;blit_bpp
op_assign
id|BPP8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
id|par-&gt;pixconf
op_assign
id|PIXCONF15
suffix:semicolon
r_else
id|par-&gt;pixconf
op_assign
id|PIXCONF16
suffix:semicolon
id|par-&gt;bltcntl
op_assign
l_int|16
suffix:semicolon
id|par-&gt;depth
op_assign
l_int|2
suffix:semicolon
id|par-&gt;blit_bpp
op_assign
id|BPP16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
id|par-&gt;pixconf
op_assign
id|PIXCONF24
suffix:semicolon
id|par-&gt;bltcntl
op_assign
l_int|32
suffix:semicolon
id|par-&gt;depth
op_assign
l_int|3
suffix:semicolon
id|par-&gt;blit_bpp
op_assign
id|BPP24
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|par-&gt;pixconf
op_assign
id|PIXCONF32
suffix:semicolon
id|par-&gt;bltcntl
op_assign
l_int|0
suffix:semicolon
id|par-&gt;depth
op_assign
l_int|4
suffix:semicolon
id|par-&gt;blit_bpp
op_assign
l_int|3
op_lshift
l_int|24
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;nonstd
op_logical_and
id|var-&gt;bits_per_pixel
op_ne
l_int|8
)paren
id|par-&gt;pixconf
op_or_assign
l_int|1
op_lshift
l_int|27
suffix:semicolon
id|i810_calc_dclk
c_func
(paren
id|var-&gt;pixclock
comma
op_amp
id|par-&gt;regs.M
comma
op_amp
id|par-&gt;regs.N
comma
op_amp
id|par-&gt;regs.P
)paren
suffix:semicolon
id|i810fb_encode_registers
c_func
(paren
id|var
comma
id|par
comma
id|xres
comma
id|yres
)paren
suffix:semicolon
id|par-&gt;watermark
op_assign
id|i810_get_watermark
c_func
(paren
id|var
comma
id|par
)paren
suffix:semicolon
id|par-&gt;pitch
op_assign
id|get_line_length
c_func
(paren
id|par
comma
id|vxres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810fb_getcolreg - gets red, green and blue values of the hardware DAC&n; * @regno: DAC index&n; * @red: red&n; * @green: green&n; * @blue: blue&n; * @transp: transparency (alpha)&n; * @info: pointer to fb_info&n; *&n; * DESCRIPTION:&n; * Gets the red, green and blue values of the hardware DAC as pointed by @regno&n; * and writes them to @red, @green and @blue respectively&n; */
DECL|function|i810fb_getcolreg
r_static
r_int
id|i810fb_getcolreg
c_func
(paren
id|u8
id|regno
comma
id|u8
op_star
id|red
comma
id|u8
op_star
id|green
comma
id|u8
op_star
id|blue
comma
id|u8
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
comma
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
r_if
c_cond
(paren
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
op_logical_and
id|regno
OG
l_int|31
)paren
op_logical_or
(paren
id|info-&gt;var.green.length
op_eq
l_int|6
op_logical_and
id|regno
OG
l_int|63
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|temp
op_assign
id|i810_readb
c_func
(paren
id|PIXCONF1
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
op_amp
op_complement
id|EXTENDED_PALETTE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
op_logical_and
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
id|i810_read_dac
c_func
(paren
id|regno
op_star
l_int|8
comma
id|red
comma
id|green
comma
id|blue
comma
id|mmio
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
op_logical_and
id|info-&gt;var.green.length
op_eq
l_int|6
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|i810_read_dac
c_func
(paren
id|regno
op_star
l_int|8
comma
id|red
comma
op_amp
id|tmp
comma
id|blue
comma
id|mmio
)paren
suffix:semicolon
id|i810_read_dac
c_func
(paren
id|regno
op_star
l_int|4
comma
op_amp
id|tmp
comma
id|green
comma
op_amp
id|tmp
comma
id|mmio
)paren
suffix:semicolon
)brace
r_else
id|i810_read_dac
c_func
(paren
id|regno
comma
id|red
comma
id|green
comma
id|blue
comma
id|mmio
)paren
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************** &n; *           Framebuffer device-specific hooks                    *&n; ******************************************************************/
DECL|function|i810fb_open
r_static
r_int
id|i810fb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|count
op_assign
id|atomic_read
c_func
(paren
op_amp
id|par-&gt;use_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
(brace
id|memset
c_func
(paren
op_amp
id|par-&gt;state
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|vgastate
)paren
)paren
suffix:semicolon
id|par-&gt;state.flags
op_assign
id|VGA_SAVE_CMAP
suffix:semicolon
id|par-&gt;state.vgabase
op_assign
(paren
id|caddr_t
)paren
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|save_vga
c_func
(paren
op_amp
id|par-&gt;state
)paren
suffix:semicolon
id|i810_save_vga_state
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|par-&gt;use_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_release
r_static
r_int
id|i810fb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|count
suffix:semicolon
id|count
op_assign
id|atomic_read
c_func
(paren
op_amp
id|par-&gt;use_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|1
)paren
(brace
id|i810_restore_vga_state
c_func
(paren
id|par
)paren
suffix:semicolon
id|restore_vga
c_func
(paren
op_amp
id|par-&gt;state
)paren
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|par-&gt;use_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_setcolreg
r_static
r_int
id|i810fb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
comma
id|temp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|regno
OG
l_int|255
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
r_if
c_cond
(paren
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
op_logical_and
id|regno
OG
l_int|31
)paren
op_logical_or
(paren
id|info-&gt;var.green.length
op_eq
l_int|6
op_logical_and
id|regno
OG
l_int|63
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;var.grayscale
)paren
id|red
op_assign
id|green
op_assign
id|blue
op_assign
(paren
l_int|19595
op_star
id|red
op_plus
l_int|38470
op_star
id|green
op_plus
l_int|7471
op_star
id|blue
)paren
op_rshift
l_int|16
suffix:semicolon
id|temp
op_assign
id|i810_readb
c_func
(paren
id|PIXCONF1
comma
id|mmio
)paren
suffix:semicolon
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
op_amp
op_complement
id|EXTENDED_PALETTE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
op_logical_and
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|i810_write_dac
c_func
(paren
(paren
id|u8
)paren
(paren
id|regno
op_star
l_int|8
)paren
op_plus
id|i
comma
(paren
id|u8
)paren
id|red
comma
(paren
id|u8
)paren
id|green
comma
(paren
id|u8
)paren
id|blue
comma
id|mmio
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
op_logical_and
id|info-&gt;var.green.length
op_eq
l_int|6
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|regno
)paren
(brace
id|memset
c_func
(paren
id|par-&gt;red
comma
l_int|0
comma
l_int|64
)paren
suffix:semicolon
id|memset
c_func
(paren
id|par-&gt;green
comma
l_int|0
comma
l_int|64
)paren
suffix:semicolon
id|memset
c_func
(paren
id|par-&gt;blue
comma
l_int|0
comma
l_int|64
)paren
suffix:semicolon
)brace
id|par-&gt;red
(braket
id|regno
)braket
op_assign
(paren
id|u8
)paren
id|red
suffix:semicolon
id|par-&gt;green
(braket
id|regno
)braket
op_assign
(paren
id|u8
)paren
id|green
suffix:semicolon
id|par-&gt;blue
(braket
id|regno
)braket
op_assign
(paren
id|u8
)paren
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|32
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|i810_write_dac
c_func
(paren
(paren
id|u8
)paren
(paren
id|regno
op_star
l_int|8
)paren
op_plus
id|i
comma
(paren
id|u8
)paren
id|red
comma
id|par-&gt;green
(braket
id|regno
op_star
l_int|2
)braket
comma
(paren
id|u8
)paren
id|blue
comma
id|mmio
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|i810_write_dac
c_func
(paren
(paren
id|u8
)paren
(paren
id|regno
op_star
l_int|4
)paren
op_plus
id|i
comma
id|par-&gt;red
(braket
id|regno
op_div
l_int|2
)braket
comma
(paren
id|u8
)paren
id|green
comma
id|par-&gt;blue
(braket
id|regno
op_div
l_int|2
)braket
comma
id|mmio
)paren
suffix:semicolon
)brace
r_else
(brace
id|i810_write_dac
c_func
(paren
(paren
id|u8
)paren
id|regno
comma
(paren
id|u8
)paren
id|red
comma
(paren
id|u8
)paren
id|green
comma
(paren
id|u8
)paren
id|blue
comma
id|mmio
)paren
suffix:semicolon
)brace
id|i810_writeb
c_func
(paren
id|PIXCONF1
comma
id|mmio
comma
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|16
)paren
(brace
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|10
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
r_else
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|11
)paren
op_or
(paren
id|regno
op_lshift
l_int|5
)paren
op_or
id|regno
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* RGB 555 */
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* RGB 565 */
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
id|red
op_amp
l_int|0xf800
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|24
suffix:colon
multiline_comment|/* RGB 888 */
r_case
l_int|32
suffix:colon
multiline_comment|/* RGBA 8888 */
r_if
c_cond
(paren
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
l_int|16
)paren
op_or
(paren
id|regno
op_lshift
l_int|8
)paren
op_or
id|regno
suffix:semicolon
r_else
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|green
op_amp
l_int|0xff00
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_pan_display
r_static
r_int
id|i810fb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|total
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_int
id|xoffset
op_assign
id|var-&gt;xoffset
comma
id|yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|xoffset
template_param
id|var-&gt;xres_virtual
op_logical_or
id|yoffset
template_param
id|var-&gt;yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|total
op_assign
id|xoffset
op_star
id|par-&gt;depth
op_plus
id|yoffset
op_star
id|info-&gt;fix.line_length
suffix:semicolon
id|i810_writel
c_func
(paren
id|DPLYBASE
comma
id|mmio
comma
id|par-&gt;fb.physical
op_plus
id|total
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_blank
r_static
r_int
id|i810fb_blank
(paren
r_int
id|blank_mode
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_int
id|mode
op_assign
l_int|0
comma
id|pwr
comma
id|scr_off
op_assign
l_int|0
suffix:semicolon
id|pwr
op_assign
id|i810_readl
c_func
(paren
id|PWR_CLKC
comma
id|mmio
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|blank_mode
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
id|mode
op_assign
id|POWERON
suffix:semicolon
id|pwr
op_or_assign
l_int|1
suffix:semicolon
id|scr_off
op_assign
id|ON
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|mode
op_assign
id|STANDBY
suffix:semicolon
id|pwr
op_or_assign
l_int|1
suffix:semicolon
id|scr_off
op_assign
id|OFF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|mode
op_assign
id|SUSPEND
suffix:semicolon
id|pwr
op_or_assign
l_int|1
suffix:semicolon
id|scr_off
op_assign
id|OFF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|mode
op_assign
id|POWERDOWN
suffix:semicolon
id|pwr
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|scr_off
op_assign
id|OFF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|i810_screen_off
c_func
(paren
id|mmio
comma
id|scr_off
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|HVSYNC
comma
id|mmio
comma
id|mode
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|PWR_CLKC
comma
id|mmio
comma
id|pwr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_set_par
r_static
r_int
id|i810fb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|i810_load_regs
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_init_cursor
c_func
(paren
id|par
)paren
suffix:semicolon
id|par-&gt;cursor_reset
op_assign
l_int|1
suffix:semicolon
id|encode_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_check_var
r_static
r_int
id|i810fb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|IS_DVT
)paren
(brace
id|var-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_MASK
suffix:semicolon
id|var-&gt;vmode
op_or_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_DOUBLE
)paren
(brace
id|var-&gt;vmode
op_and_assign
op_complement
id|FB_VMODE_MASK
suffix:semicolon
id|var-&gt;vmode
op_or_assign
id|FB_VMODE_NONINTERLACED
suffix:semicolon
)brace
id|i810_round_off
c_func
(paren
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i810_check_params
c_func
(paren
id|var
comma
id|info
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|i810fb_fill_var_timings
c_func
(paren
id|var
)paren
suffix:semicolon
id|set_color_bitfields
c_func
(paren
id|var
)paren
suffix:semicolon
id|decode_var
c_func
(paren
op_amp
id|info-&gt;var
comma
id|par
comma
id|info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_cursor
r_static
r_int
id|i810fb_cursor
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_cursor
op_star
id|cursor
)paren
(brace
r_static
id|u8
id|data
(braket
l_int|64
op_star
l_int|8
)braket
suffix:semicolon
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
id|u16
id|flags
op_assign
id|cursor-&gt;set
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;var.accel_flags
op_logical_or
id|par-&gt;dev_flags
op_amp
id|LOCKUP
)paren
(brace
r_return
id|soft_cursor
c_func
(paren
id|info
comma
id|cursor
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cursor-&gt;image.width
OG
l_int|64
op_logical_or
id|cursor-&gt;image.height
OG
l_int|64
op_logical_or
(paren
id|cursor-&gt;dest
op_eq
l_int|NULL
op_logical_and
id|cursor-&gt;rop
op_eq
id|ROP_XOR
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i810_readl
c_func
(paren
id|CURBASE
comma
id|mmio
)paren
op_amp
l_int|0xf
)paren
op_ne
id|par-&gt;cursor_heap.physical
)paren
(brace
id|i810_init_cursor
c_func
(paren
id|par
)paren
suffix:semicolon
id|par-&gt;cursor_reset
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;cursor_reset
)paren
(brace
id|flags
op_assign
id|FB_CUR_SETALL
suffix:semicolon
id|par-&gt;cursor_reset
op_assign
l_int|0
suffix:semicolon
)brace
id|i810_enable_cursor
c_func
(paren
id|mmio
comma
id|OFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|FB_CUR_SETPOS
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|cursor-&gt;image.dx
op_minus
id|info-&gt;var.xoffset
suffix:semicolon
id|tmp
op_or_assign
(paren
id|cursor-&gt;image.dy
op_minus
id|info-&gt;var.yoffset
)paren
op_lshift
l_int|16
suffix:semicolon
id|i810_writel
c_func
(paren
id|CURPOS
comma
id|mmio
comma
id|tmp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|FB_CUR_SETSIZE
)paren
(brace
id|i810_reset_cursor_image
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|FB_CUR_SETCMAP
)paren
(brace
id|i810_load_cursor_colors
c_func
(paren
id|cursor-&gt;image.fg_color
comma
id|cursor-&gt;image.bg_color
comma
id|info
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|FB_CUR_SETDEST
op_or
id|FB_CUR_SETSHAPE
)paren
)paren
(brace
r_int
id|size
op_assign
(paren
(paren
id|cursor-&gt;image.width
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
op_star
id|cursor-&gt;image.height
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cursor-&gt;rop
)paren
(brace
r_case
id|ROP_XOR
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
(braket
id|i
)braket
op_assign
(paren
id|cursor-&gt;image.data
(braket
id|i
)braket
op_amp
id|cursor-&gt;mask
(braket
id|i
)braket
)paren
op_xor
id|cursor-&gt;dest
(braket
id|i
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ROP_COPY
suffix:colon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
(braket
id|i
)braket
op_assign
id|cursor-&gt;image.data
(braket
id|i
)braket
op_amp
id|cursor-&gt;mask
(braket
id|i
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|i810_load_cursor_image
c_func
(paren
id|cursor-&gt;image.width
comma
id|cursor-&gt;image.height
comma
id|data
comma
id|par
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cursor-&gt;enable
)paren
id|i810_enable_cursor
c_func
(paren
id|mmio
comma
id|ON
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|fb_ops
id|i810fb_ops
id|__initdata
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|i810fb_open
comma
dot
id|fb_release
op_assign
id|i810fb_release
comma
dot
id|fb_check_var
op_assign
id|i810fb_check_var
comma
dot
id|fb_set_par
op_assign
id|i810fb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|i810fb_setcolreg
comma
dot
id|fb_blank
op_assign
id|i810fb_blank
comma
dot
id|fb_pan_display
op_assign
id|i810fb_pan_display
comma
dot
id|fb_fillrect
op_assign
id|i810fb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|i810fb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|i810fb_imageblit
comma
dot
id|fb_cursor
op_assign
id|i810fb_cursor
comma
)brace
suffix:semicolon
multiline_comment|/***********************************************************************&n; *                  AGP resource allocation                            *&n; ***********************************************************************/
DECL|function|i810_fix_pointers
r_static
r_void
id|__devinit
id|i810_fix_pointers
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|par-&gt;fb.physical
op_assign
id|par-&gt;aperture.physical
op_plus
(paren
id|par-&gt;fb.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;fb
dot
r_virtual
op_assign
id|par-&gt;aperture
dot
r_virtual
op_plus
(paren
id|par-&gt;fb.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;iring.physical
op_assign
id|par-&gt;aperture.physical
op_plus
(paren
id|par-&gt;iring.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;iring
dot
r_virtual
op_assign
id|par-&gt;aperture
dot
r_virtual
op_plus
(paren
id|par-&gt;iring.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;cursor_heap
dot
r_virtual
op_assign
id|par-&gt;aperture
dot
r_virtual
op_plus
(paren
id|par-&gt;cursor_heap.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;pixmap
dot
r_virtual
op_assign
id|par-&gt;aperture
dot
r_virtual
op_plus
(paren
id|par-&gt;pixmap.offset
op_lshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;pixmap.physical
op_assign
id|par-&gt;aperture.physical
op_plus
(paren
id|par-&gt;pixmap.offset
op_lshift
l_int|12
)paren
suffix:semicolon
)brace
DECL|function|i810_fix_offsets
r_static
r_void
id|__devinit
id|i810_fix_offsets
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
r_if
c_cond
(paren
id|vram
op_plus
l_int|1
OG
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
id|vram
op_assign
(paren
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v_offset_default
OG
(paren
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
)paren
id|v_offset_default
op_assign
(paren
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vram
op_plus
id|v_offset_default
op_plus
l_int|1
OG
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
id|v_offset_default
op_assign
(paren
id|par-&gt;aperture.size
op_rshift
l_int|20
)paren
op_minus
(paren
id|vram
op_plus
l_int|1
)paren
suffix:semicolon
id|par-&gt;fb.size
op_assign
id|vram
op_lshift
l_int|20
suffix:semicolon
id|par-&gt;fb.offset
op_assign
id|v_offset_default
op_lshift
l_int|20
suffix:semicolon
id|par-&gt;fb.offset
op_rshift_assign
l_int|12
suffix:semicolon
id|par-&gt;iring.offset
op_assign
id|par-&gt;fb.offset
op_plus
(paren
id|par-&gt;fb.size
op_rshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;iring.size
op_assign
id|RINGBUFFER_SIZE
suffix:semicolon
id|par-&gt;pixmap.offset
op_assign
id|par-&gt;iring.offset
op_plus
(paren
id|RINGBUFFER_SIZE
op_rshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;pixmap.size
op_assign
id|PIXMAP_SIZE
suffix:semicolon
id|par-&gt;cursor_heap.offset
op_assign
id|par-&gt;pixmap.offset
op_plus
(paren
id|PIXMAP_SIZE
op_rshift
l_int|12
)paren
suffix:semicolon
id|par-&gt;cursor_heap.size
op_assign
l_int|4096
suffix:semicolon
)brace
DECL|function|i810_alloc_agp_mem
r_static
r_int
id|__devinit
id|i810_alloc_agp_mem
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|size
suffix:semicolon
id|i810_fix_offsets
c_func
(paren
id|par
)paren
suffix:semicolon
id|size
op_assign
id|par-&gt;fb.size
op_plus
id|par-&gt;iring.size
op_plus
id|par-&gt;pixmap.size
suffix:semicolon
id|par-&gt;drm_agp
op_assign
(paren
id|drm_agp_t
op_star
)paren
id|inter_module_get
c_func
(paren
l_string|&quot;drm_agp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;drm_agp
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb: cannot acquire agp&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|par-&gt;drm_agp
op_member_access_from_pointer
id|acquire
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;i810_gtt.i810_fb_memory
op_assign
id|par-&gt;drm_agp
op_member_access_from_pointer
id|allocate_memory
c_func
(paren
id|size
op_rshift
l_int|12
comma
id|AGP_NORMAL_MEMORY
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_alloc_fbmem: can&squot;t allocate framebuffer &quot;
l_string|&quot;memory&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_member_access_from_pointer
id|release
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;drm_agp
op_member_access_from_pointer
id|bind_memory
c_func
(paren
id|par-&gt;i810_gtt.i810_fb_memory
comma
id|par-&gt;fb.offset
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_alloc_fbmem: can&squot;t bind framebuffer memory&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_member_access_from_pointer
id|release
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|par-&gt;i810_gtt.i810_cursor_memory
op_assign
id|par-&gt;drm_agp
op_member_access_from_pointer
id|allocate_memory
c_func
(paren
id|par-&gt;cursor_heap.size
op_rshift
l_int|12
comma
id|AGP_PHYSICAL_MEMORY
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_alloc_cursormem:  can&squot;t allocate&quot;
l_string|&quot;cursor memory&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_member_access_from_pointer
id|release
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;drm_agp
op_member_access_from_pointer
id|bind_memory
c_func
(paren
id|par-&gt;i810_gtt.i810_cursor_memory
comma
id|par-&gt;cursor_heap.offset
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_alloc_cursormem: cannot bind cursor memory&bslash;n&quot;
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_member_access_from_pointer
id|release
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|par-&gt;cursor_heap.physical
op_assign
id|par-&gt;i810_gtt.i810_cursor_memory-&gt;physical
suffix:semicolon
id|i810_fix_pointers
c_func
(paren
id|par
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_member_access_from_pointer
id|release
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*************************************************************** &n; *                    Initialization                           * &n; ***************************************************************/
multiline_comment|/**&n; * i810_init_monspecs&n; * @info: pointer to device specific info structure&n; *&n; * DESCRIPTION:&n; * Sets the the user monitor&squot;s horizontal and vertical&n; * frequency limits&n; */
DECL|function|i810_init_monspecs
r_static
r_void
id|__devinit
id|i810_init_monspecs
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|hsync1
)paren
id|hsync1
op_assign
id|HFMIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hsync2
)paren
id|hsync2
op_assign
id|HFMAX
suffix:semicolon
id|info-&gt;monspecs.hfmax
op_assign
id|hsync2
suffix:semicolon
id|info-&gt;monspecs.hfmin
op_assign
id|hsync1
suffix:semicolon
r_if
c_cond
(paren
id|hsync2
OL
id|hsync1
)paren
id|info-&gt;monspecs.hfmin
op_assign
id|hsync2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vsync1
)paren
id|vsync1
op_assign
id|VFMIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vsync2
)paren
id|vsync2
op_assign
id|VFMAX
suffix:semicolon
r_if
c_cond
(paren
id|IS_DVT
op_logical_and
id|vsync1
OL
l_int|60
)paren
id|vsync1
op_assign
l_int|60
suffix:semicolon
id|info-&gt;monspecs.vfmax
op_assign
id|vsync2
suffix:semicolon
id|info-&gt;monspecs.vfmin
op_assign
id|vsync1
suffix:semicolon
r_if
c_cond
(paren
id|vsync2
OL
id|vsync1
)paren
id|info-&gt;monspecs.vfmin
op_assign
id|vsync2
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_init_defaults - initializes default values to use&n; * @par: pointer to i810fb_par structure&n; * @info: pointer to current fb_info structure&n; */
DECL|function|i810_init_defaults
r_static
r_void
id|__devinit
id|i810_init_defaults
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|voffset
)paren
(brace
id|v_offset_default
op_assign
id|voffset
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|par-&gt;aperture.size
OG
l_int|32
op_star
l_int|1024
op_star
l_int|1024
)paren
id|v_offset_default
op_assign
l_int|16
suffix:semicolon
r_else
id|v_offset_default
op_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vram
)paren
id|vram
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
id|par-&gt;dev_flags
op_or_assign
id|HAS_ACCELERATION
suffix:semicolon
r_if
c_cond
(paren
id|sync
)paren
id|par-&gt;dev_flags
op_or_assign
id|ALWAYS_SYNC
suffix:semicolon
r_if
c_cond
(paren
id|bpp
OL
l_int|8
)paren
id|bpp
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vyres
)paren
id|vyres
op_assign
(paren
id|vram
op_lshift
l_int|20
)paren
op_div
(paren
id|xres
op_star
id|bpp
op_rshift
l_int|3
)paren
suffix:semicolon
id|par-&gt;i810fb_ops
op_assign
id|i810fb_ops
suffix:semicolon
id|i810fb_default.xres
op_assign
id|xres
suffix:semicolon
id|i810fb_default.yres
op_assign
id|yres
suffix:semicolon
id|i810fb_default.yres_virtual
op_assign
id|vyres
suffix:semicolon
id|i810fb_default.bits_per_pixel
op_assign
id|bpp
suffix:semicolon
r_if
c_cond
(paren
id|dcolor
)paren
id|i810fb_default.nonstd
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;dev_flags
op_amp
id|HAS_ACCELERATION
)paren
id|i810fb_default.accel_flags
op_assign
l_int|1
suffix:semicolon
id|i810_init_monspecs
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * i810_init_device - initialize device&n; * @par: pointer to i810fb_par structure&n; */
DECL|function|i810_init_device
r_static
r_void
id|__devinit
id|i810_init_device
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
id|u8
id|reg
comma
op_star
id|mmio
op_assign
id|par-&gt;mmio_start_virtual
suffix:semicolon
r_if
c_cond
(paren
id|mtrr
)paren
id|set_mtrr
c_func
(paren
id|par
)paren
suffix:semicolon
id|i810_init_cursor
c_func
(paren
id|par
)paren
suffix:semicolon
multiline_comment|/* mvo: enable external vga-connector (for laptops) */
r_if
c_cond
(paren
id|ext_vga
)paren
(brace
id|i810_writel
c_func
(paren
id|HVSYNC
comma
id|mmio
comma
l_int|0
)paren
suffix:semicolon
id|i810_writel
c_func
(paren
id|PWR_CLKC
comma
id|mmio
comma
l_int|3
)paren
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|par-&gt;dev
comma
l_int|0x50
comma
op_amp
id|reg
)paren
suffix:semicolon
id|reg
op_and_assign
id|FREQ_MASK
suffix:semicolon
id|par-&gt;mem_freq
op_assign
(paren
id|reg
)paren
ques
c_cond
l_int|133
suffix:colon
l_int|100
suffix:semicolon
id|i810fb_init_ringbuffer
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|i810_allocate_pci_resource
id|i810_allocate_pci_resource
c_func
(paren
r_struct
id|i810fb_par
op_star
id|par
comma
r_const
r_struct
id|pci_device_id
op_star
id|entry
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|par-&gt;dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot enable device&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|par-&gt;res_flags
op_or_assign
id|PCI_DEVICE_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|pci_resource_len
c_func
(paren
id|par-&gt;dev
comma
l_int|0
)paren
OG
l_int|512
op_star
l_int|1024
)paren
(brace
id|par-&gt;aperture.physical
op_assign
id|pci_resource_start
c_func
(paren
id|par-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;aperture.size
op_assign
id|pci_resource_len
c_func
(paren
id|par-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;mmio_start_phys
op_assign
id|pci_resource_start
c_func
(paren
id|par-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|par-&gt;aperture.physical
op_assign
id|pci_resource_start
c_func
(paren
id|par-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
id|par-&gt;aperture.size
op_assign
id|pci_resource_len
c_func
(paren
id|par-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
id|par-&gt;mmio_start_phys
op_assign
id|pci_resource_start
c_func
(paren
id|par-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;aperture.size
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: device is disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|par-&gt;aperture.physical
comma
id|par-&gt;aperture.size
comma
id|i810_pci_list
(braket
id|entry-&gt;driver_data
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot request framebuffer region&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|par-&gt;res_flags
op_or_assign
id|FRAMEBUFFER_REQ
suffix:semicolon
id|par-&gt;aperture
dot
r_virtual
op_assign
id|ioremap
c_func
(paren
id|par-&gt;aperture.physical
comma
id|par-&gt;aperture.size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;aperture
dot
r_virtual
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot remap framebuffer region&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|par-&gt;mmio_start_phys
comma
id|MMIO_SIZE
comma
id|i810_pci_list
(braket
id|entry-&gt;driver_data
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot request mmio region&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|par-&gt;res_flags
op_or_assign
id|MMIO_REQ
suffix:semicolon
id|par-&gt;mmio_start_virtual
op_assign
id|ioremap_nocache
c_func
(paren
id|par-&gt;mmio_start_phys
comma
id|MMIO_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par-&gt;mmio_start_virtual
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot remap mmio region&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_setup
r_int
id|__init
id|i810fb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
comma
op_star
id|suffix
op_assign
l_int|NULL
suffix:semicolon
id|i810_init
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;mtrr&quot;
comma
l_int|4
)paren
)paren
id|mtrr
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;accel&quot;
comma
l_int|5
)paren
)paren
id|accel
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;ext_vga&quot;
comma
l_int|7
)paren
)paren
id|ext_vga
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;sync&quot;
comma
l_int|4
)paren
)paren
id|sync
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vram:&quot;
comma
l_int|5
)paren
)paren
id|vram
op_assign
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;voffset:&quot;
comma
l_int|8
)paren
)paren
id|voffset
op_assign
(paren
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|8
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;xres:&quot;
comma
l_int|5
)paren
)paren
id|xres
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;yres:&quot;
comma
l_int|5
)paren
)paren
id|yres
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vyres:&quot;
comma
l_int|6
)paren
)paren
id|vyres
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|6
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;bpp:&quot;
comma
l_int|4
)paren
)paren
id|bpp
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|4
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;hsync1:&quot;
comma
l_int|7
)paren
)paren
(brace
id|hsync1
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
op_amp
id|suffix
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|suffix
comma
l_string|&quot;H&quot;
comma
l_int|1
)paren
)paren
id|hsync1
op_mul_assign
l_int|1000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;hsync2:&quot;
comma
l_int|7
)paren
)paren
(brace
id|hsync2
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
op_amp
id|suffix
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|suffix
comma
l_string|&quot;H&quot;
comma
l_int|1
)paren
)paren
id|hsync2
op_mul_assign
l_int|1000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vsync1:&quot;
comma
l_int|7
)paren
)paren
id|vsync1
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;vsync2:&quot;
comma
l_int|7
)paren
)paren
id|vsync2
op_assign
id|simple_strtoul
c_func
(paren
id|this_opt
op_plus
l_int|7
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;dcolor&quot;
comma
l_int|6
)paren
)paren
id|dcolor
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i810fb_init_pci
r_static
r_int
id|__devinit
id|i810fb_init_pci
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|entry
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|i810fb_par
op_star
id|par
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
comma
id|vfreq
comma
id|hfreq
comma
id|pixclock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i810_init
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fb_info
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|info
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|par
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i810fb_par
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|par
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|i810fb_par
)paren
)paren
suffix:semicolon
id|par-&gt;dev
op_assign
id|dev
suffix:semicolon
id|info-&gt;par
op_assign
id|par
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i810_allocate_pci_resource
c_func
(paren
id|par
comma
id|entry
)paren
)paren
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|i810_init_defaults
c_func
(paren
id|par
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i810_alloc_agp_mem
c_func
(paren
id|info
)paren
)paren
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|i810_init_device
c_func
(paren
id|par
)paren
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|par-&gt;fb
dot
r_virtual
suffix:semicolon
id|info-&gt;node
op_assign
id|NODEV
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|par-&gt;i810fb_ops
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|par-&gt;pseudo_palette
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
l_int|256
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;var
op_assign
id|i810fb_default
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_check_var
c_func
(paren
op_amp
id|info-&gt;var
comma
id|info
)paren
)paren
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|encode_fix
c_func
(paren
op_amp
id|info-&gt;fix
comma
id|info
)paren
suffix:semicolon
id|err
op_assign
id|register_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot register framebuffer device&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|dev
comma
id|info
)paren
suffix:semicolon
id|pixclock
op_assign
l_int|1000000000
op_div
(paren
id|info-&gt;var.pixclock
)paren
suffix:semicolon
id|pixclock
op_mul_assign
l_int|1000
suffix:semicolon
id|hfreq
op_assign
id|pixclock
op_div
(paren
id|info-&gt;var.xres
op_plus
id|info-&gt;var.left_margin
op_plus
id|info-&gt;var.hsync_len
op_plus
id|info-&gt;var.right_margin
)paren
suffix:semicolon
id|vfreq
op_assign
id|hfreq
op_div
(paren
id|info-&gt;var.yres
op_plus
id|info-&gt;var.upper_margin
op_plus
id|info-&gt;var.vsync_len
op_plus
id|info-&gt;var.lower_margin
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;fb: %s v%d.%d.%d%s, Tony Daplas&bslash;n&quot;
l_string|&quot;     Video RAM      : %dK&bslash;n&quot;
l_string|&quot;     Mode           : %dx%d-%dbpp@%dHz&bslash;n&quot;
l_string|&quot;     Acceleration   : %sabled&bslash;n&quot;
l_string|&quot;     MTRR           : %sabled&bslash;n&quot;
l_string|&quot;     External VGA   : %sabled&bslash;n&quot;
l_string|&quot;     Video Timings  : %s&bslash;n&quot;
comma
id|i810_pci_list
(braket
id|entry-&gt;driver_data
)braket
comma
id|VERSION_MAJOR
comma
id|VERSION_MINOR
comma
id|VERSION_TEENIE
comma
id|BRANCH_VERSION
comma
(paren
r_int
)paren
id|par-&gt;fb.size
op_rshift
l_int|10
comma
id|info-&gt;var.xres
comma
id|info-&gt;var.yres
comma
id|info-&gt;var.bits_per_pixel
comma
id|vfreq
comma
(paren
id|par-&gt;dev_flags
op_amp
id|HAS_ACCELERATION
)paren
ques
c_cond
l_string|&quot;en&quot;
suffix:colon
l_string|&quot;dis&quot;
comma
(paren
id|par-&gt;dev_flags
op_amp
id|HAS_MTRR
)paren
ques
c_cond
l_string|&quot;en&quot;
suffix:colon
l_string|&quot;dis&quot;
comma
(paren
id|ext_vga
)paren
ques
c_cond
l_string|&quot;en&quot;
suffix:colon
l_string|&quot;dis&quot;
comma
(paren
id|IS_DVT
)paren
ques
c_cond
l_string|&quot;Intel(R) DVT&quot;
suffix:colon
l_string|&quot;VESA GTF (US)&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/***************************************************************&n; *                     Deinitialization                        *&n; ***************************************************************/
DECL|function|i810fb_release_resource
r_static
r_void
id|i810fb_release_resource
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|i810fb_par
op_star
id|par
)paren
(brace
r_if
c_cond
(paren
id|par
)paren
(brace
id|unset_mtrr
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;drm_agp
)paren
(brace
id|drm_agp_t
op_star
id|agp
op_assign
id|par-&gt;drm_agp
suffix:semicolon
r_struct
id|gtt_data
op_star
id|gtt
op_assign
op_amp
id|par-&gt;i810_gtt
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;i810_gtt.i810_cursor_memory
)paren
id|agp
op_member_access_from_pointer
id|free_memory
c_func
(paren
id|gtt-&gt;i810_cursor_memory
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;i810_gtt.i810_fb_memory
)paren
id|agp
op_member_access_from_pointer
id|free_memory
c_func
(paren
id|gtt-&gt;i810_fb_memory
)paren
suffix:semicolon
id|inter_module_put
c_func
(paren
l_string|&quot;drm_agp&quot;
)paren
suffix:semicolon
id|par-&gt;drm_agp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;mmio_start_virtual
)paren
id|iounmap
c_func
(paren
id|par-&gt;mmio_start_virtual
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;aperture
dot
r_virtual
)paren
id|iounmap
c_func
(paren
id|par-&gt;aperture
dot
r_virtual
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;res_flags
op_amp
id|FRAMEBUFFER_REQ
)paren
id|release_mem_region
c_func
(paren
id|par-&gt;aperture.physical
comma
id|par-&gt;aperture.size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;res_flags
op_amp
id|MMIO_REQ
)paren
id|release_mem_region
c_func
(paren
id|par-&gt;mmio_start_phys
comma
id|MMIO_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;res_flags
op_amp
id|PCI_DEVICE_ENABLED
)paren
id|pci_disable_device
c_func
(paren
id|par-&gt;dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info
)paren
id|kfree
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
DECL|function|i810fb_remove_pci
r_static
r_void
id|__devexit
id|i810fb_remove_pci
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|i810fb_par
op_star
id|par
op_assign
(paren
r_struct
id|i810fb_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
id|i810fb_release_resource
c_func
(paren
id|info
comma
id|par
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;cleanup_module:  unloaded i810 framebuffer device&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifndef MODULE
DECL|function|i810fb_init
r_int
id|__init
id|i810fb_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|agp_init
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot initialize agpgart&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|agp_intel_init
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i810fb_init: cannot initialize intel agpgart&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
(paren
id|pci_module_init
c_func
(paren
op_amp
id|i810fb_driver
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif 
multiline_comment|/*********************************************************************&n; *                          Modularization                           *&n; *********************************************************************/
macro_line|#ifdef MODULE
DECL|function|i810fb_init
r_int
id|__init
id|i810fb_init
c_func
(paren
r_void
)paren
(brace
id|i810_init
op_assign
l_int|1
suffix:semicolon
id|hsync1
op_mul_assign
l_int|1000
suffix:semicolon
id|hsync2
op_mul_assign
l_int|1000
suffix:semicolon
r_return
(paren
id|pci_module_init
c_func
(paren
op_amp
id|i810fb_driver
)paren
)paren
suffix:semicolon
)brace
id|MODULE_PARM
c_func
(paren
id|vram
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vram
comma
l_string|&quot;System RAM to allocate to framebuffer in MiB&quot;
l_string|&quot; (default=4)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|voffset
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|voffset
comma
l_string|&quot;at what offset to place start of framebuffer &quot;
l_string|&quot;memory (0 to maximum aperture size), in MiB (default = 48)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bpp
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bpp
comma
l_string|&quot;Color depth for display in bits per pixel&quot;
l_string|&quot; (default = 8)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|xres
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|xres
comma
l_string|&quot;Hozizontal resolution in pixels (default = 640)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|yres
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|yres
comma
l_string|&quot;Vertical resolution in scanlines (default = 480)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vyres
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vyres
comma
l_string|&quot;Virtual vertical resolution in scanlines&quot;
l_string|&quot; (default = 480)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hsync1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|hsync1
comma
l_string|&quot;Mimimum horizontal frequency of monitor in KHz&quot;
l_string|&quot; (default = 31)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hsync2
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|hsync2
comma
l_string|&quot;Maximum horizontal frequency of monitor in KHz&quot;
l_string|&quot; (default = 31)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vsync1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vsync1
comma
l_string|&quot;Minimum vertical frequency of monitor in Hz&quot;
l_string|&quot; (default = 50)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vsync2
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vsync2
comma
l_string|&quot;Maximum vertical frequency of monitor in Hz&quot;
l_string|&quot; (default = 60)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|accel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|accel
comma
l_string|&quot;Use Acceleration (BLIT) engine (default = 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mtrr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mtrr
comma
l_string|&quot;Use MTRR (default = 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ext_vga
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ext_vga
comma
l_string|&quot;Enable external VGA connector (default = 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|sync
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|sync
comma
l_string|&quot;wait for accel engine to finish drawing&quot;
l_string|&quot; (default = 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dcolor
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dcolor
comma
l_string|&quot;use DirectColor visuals&quot;
l_string|&quot; (default = 0 = TrueColor)&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Tony A. Daplas&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Framebuffer device for the Intel 810/815 and&quot;
l_string|&quot; compatible cards&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|i810fb_exit
r_static
r_void
id|__exit
id|i810fb_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|i810fb_driver
)paren
suffix:semicolon
)brace
DECL|variable|i810fb_init
id|module_init
c_func
(paren
id|i810fb_init
)paren
suffix:semicolon
DECL|variable|i810fb_exit
id|module_exit
c_func
(paren
id|i810fb_exit
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
eof
