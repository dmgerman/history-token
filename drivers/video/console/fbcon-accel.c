multiline_comment|/*&n; *  linux/drivers/video/fbcon-accel.c -- Framebuffer accel console wrapper&n; *&n; *      Created 20 Feb 2001 by James Simmons &lt;jsimmons@users.sf.net&gt;&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &quot;fbcon.h&quot;
macro_line|#include &quot;fbcon-accel.h&quot;
DECL|function|fbcon_accel_setup
r_void
id|fbcon_accel_setup
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
)brace
DECL|function|fbcon_accel_bmove
r_void
id|fbcon_accel_bmove
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_struct
id|fb_copyarea
id|area
suffix:semicolon
id|area.sx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|area.sy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|area.dx
op_assign
id|dx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|area.dy
op_assign
id|dy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|area.height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|area.width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_copyarea
c_func
(paren
id|info
comma
op_amp
id|area
)paren
suffix:semicolon
)brace
DECL|function|fbcon_accel_clear
r_void
id|fbcon_accel_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_struct
id|fb_fillrect
id|region
suffix:semicolon
id|region.color
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|vc
)paren
suffix:semicolon
id|region.dx
op_assign
id|sx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.dy
op_assign
id|sy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.width
op_assign
id|width
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.height
op_assign
id|height
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.rop
op_assign
id|ROP_COPY
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_fillrect
c_func
(paren
id|info
comma
op_amp
id|region
)paren
suffix:semicolon
)brace
DECL|function|fbcon_accel_putc
r_void
id|fbcon_accel_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_int
r_int
id|charmask
op_assign
id|p-&gt;charmask
suffix:semicolon
r_int
r_int
id|width
op_assign
(paren
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
r_struct
id|fb_image
id|image
suffix:semicolon
id|image.fg_color
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|image.bg_color
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|image.dx
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.dy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.height
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.depth
op_assign
l_int|1
suffix:semicolon
id|image.data
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_amp
id|charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_imageblit
c_func
(paren
id|info
comma
op_amp
id|image
)paren
suffix:semicolon
)brace
DECL|function|fbcon_accel_putcs
r_void
id|fbcon_accel_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|yy
comma
r_int
id|xx
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_int
r_int
id|charmask
op_assign
id|p-&gt;charmask
suffix:semicolon
r_int
r_int
id|width
op_assign
(paren
(paren
id|fontwidth
c_func
(paren
id|p
)paren
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
r_struct
id|fb_image
id|image
suffix:semicolon
id|u16
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
id|image.fg_color
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|image.bg_color
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|image.dx
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.dy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.height
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|image.depth
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|image.data
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
op_amp
id|charmask
)paren
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_star
id|width
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_imageblit
c_func
(paren
id|info
comma
op_amp
id|image
)paren
suffix:semicolon
id|image.dx
op_add_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
DECL|function|fbcon_accel_revc
r_void
id|fbcon_accel_revc
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_struct
id|fb_fillrect
id|region
suffix:semicolon
id|region.color
op_assign
id|attr_fgcol_ec
c_func
(paren
id|p
comma
id|p-&gt;conp
)paren
suffix:semicolon
id|region.dx
op_assign
id|xx
op_star
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.dy
op_assign
id|yy
op_star
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.height
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|region.rop
op_assign
id|ROP_XOR
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_fillrect
c_func
(paren
id|info
comma
op_amp
id|region
)paren
suffix:semicolon
)brace
DECL|function|fbcon_accel_clear_margins
r_void
id|fbcon_accel_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_int
r_int
id|cw
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
r_int
r_int
id|ch
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
r_int
r_int
id|rw
op_assign
id|info-&gt;var.xres
op_mod
id|cw
suffix:semicolon
r_int
r_int
id|bh
op_assign
id|info-&gt;var.yres
op_mod
id|ch
suffix:semicolon
r_int
r_int
id|rs
op_assign
id|info-&gt;var.xres
op_minus
id|rw
suffix:semicolon
r_int
r_int
id|bs
op_assign
id|info-&gt;var.yres
op_minus
id|bh
suffix:semicolon
r_struct
id|fb_fillrect
id|region
suffix:semicolon
id|region.color
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|vc
)paren
suffix:semicolon
id|region.rop
op_assign
id|ROP_COPY
suffix:semicolon
r_if
c_cond
(paren
id|rw
op_logical_and
op_logical_neg
id|bottom_only
)paren
(brace
id|region.dx
op_assign
id|info-&gt;var.xoffset
op_plus
id|rs
suffix:semicolon
id|region.dy
op_assign
l_int|0
suffix:semicolon
id|region.width
op_assign
id|rw
suffix:semicolon
id|region.height
op_assign
id|info-&gt;var.yres_virtual
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_fillrect
c_func
(paren
id|info
comma
op_amp
id|region
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bh
)paren
(brace
id|region.dx
op_assign
id|info-&gt;var.xoffset
suffix:semicolon
id|region.dy
op_assign
id|info-&gt;var.yoffset
op_plus
id|bs
suffix:semicolon
id|region.width
op_assign
id|rs
suffix:semicolon
id|region.height
op_assign
id|bh
suffix:semicolon
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_fillrect
c_func
(paren
id|info
comma
op_amp
id|region
)paren
suffix:semicolon
)brace
)brace
DECL|function|fbcon_accel_cursor
r_void
id|fbcon_accel_cursor
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|flags
comma
r_int
id|xx
comma
r_int
id|yy
)paren
(brace
r_static
r_char
id|mask
(braket
l_int|64
)braket
comma
id|image
(braket
l_int|64
)braket
comma
op_star
id|dest
suffix:semicolon
r_struct
id|vc_data
op_star
id|vc
op_assign
id|p-&gt;conp
suffix:semicolon
r_static
r_int
id|fgcolor
comma
id|bgcolor
comma
id|shape
comma
id|width
comma
id|height
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|p-&gt;fb_info
suffix:semicolon
r_struct
id|fb_cursor
id|cursor
suffix:semicolon
r_int
id|c
suffix:semicolon
r_char
op_star
id|font
suffix:semicolon
id|cursor.set
op_assign
id|FB_CUR_SETPOS
suffix:semicolon
r_if
c_cond
(paren
id|width
op_ne
id|fontwidth
c_func
(paren
id|p
)paren
op_logical_or
id|height
op_ne
id|fontheight
c_func
(paren
id|p
)paren
)paren
(brace
id|width
op_assign
id|fontwidth
c_func
(paren
id|p
)paren
suffix:semicolon
id|height
op_assign
id|fontheight
c_func
(paren
id|p
)paren
suffix:semicolon
id|cursor.set
op_or_assign
id|FB_CUR_SETSIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|vc-&gt;vc_cursor_type
op_amp
l_int|0x0f
)paren
op_ne
id|shape
)paren
(brace
id|shape
op_assign
id|vc-&gt;vc_cursor_type
op_amp
l_int|0x0f
suffix:semicolon
id|cursor.set
op_or_assign
id|FB_CUR_SETSHAPE
suffix:semicolon
)brace
id|c
op_assign
id|scr_readw
c_func
(paren
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fgcolor
op_ne
(paren
r_int
)paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
op_logical_or
id|bgcolor
op_ne
(paren
r_int
)paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
)paren
(brace
id|fgcolor
op_assign
(paren
r_int
)paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|bgcolor
op_assign
(paren
r_int
)paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|c
)paren
suffix:semicolon
id|cursor.set
op_or_assign
id|FB_CUR_SETCMAP
suffix:semicolon
id|cursor.image.bg_color
op_assign
id|bgcolor
suffix:semicolon
id|cursor.image.fg_color
op_assign
id|fgcolor
suffix:semicolon
)brace
id|c
op_and_assign
id|p-&gt;charmask
suffix:semicolon
id|font
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
(paren
(paren
id|width
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
op_star
id|height
)paren
suffix:semicolon
r_if
c_cond
(paren
id|font
op_ne
id|dest
)paren
(brace
id|dest
op_assign
id|font
suffix:semicolon
id|cursor.set
op_or_assign
id|FB_CUR_SETDEST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|FB_CUR_SETCUR
)paren
id|cursor.enable
op_assign
l_int|1
suffix:semicolon
r_else
id|cursor.enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cursor.set
op_amp
id|FB_CUR_SETSIZE
)paren
(brace
id|memset
c_func
(paren
id|image
comma
l_int|0xff
comma
l_int|64
)paren
suffix:semicolon
id|cursor.set
op_or_assign
id|FB_CUR_SETSHAPE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cursor.set
op_amp
id|FB_CUR_SETSHAPE
)paren
(brace
r_int
id|w
comma
id|cur_height
comma
id|size
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|w
op_assign
(paren
id|width
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|shape
)paren
(brace
r_case
id|CUR_NONE
suffix:colon
id|cur_height
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_UNDERLINE
suffix:colon
id|cur_height
op_assign
(paren
id|height
OL
l_int|10
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_LOWER_THIRD
suffix:colon
id|cur_height
op_assign
id|height
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_LOWER_HALF
suffix:colon
id|cur_height
op_assign
id|height
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_TWO_THIRDS
suffix:colon
id|cur_height
op_assign
(paren
id|height
op_star
l_int|2
)paren
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CUR_BLOCK
suffix:colon
r_default
suffix:colon
id|cur_height
op_assign
id|height
suffix:semicolon
r_break
suffix:semicolon
)brace
id|size
op_assign
(paren
id|height
op_minus
id|cur_height
)paren
op_star
id|w
suffix:semicolon
r_while
c_loop
(paren
id|size
op_decrement
)paren
id|mask
(braket
id|i
op_increment
)braket
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|cur_height
op_star
id|w
suffix:semicolon
r_while
c_loop
(paren
id|size
op_decrement
)paren
id|mask
(braket
id|i
op_increment
)braket
op_assign
l_int|0xff
suffix:semicolon
)brace
id|cursor.image.width
op_assign
id|width
suffix:semicolon
id|cursor.image.height
op_assign
id|height
suffix:semicolon
id|cursor.image.dx
op_assign
id|xx
op_star
id|width
suffix:semicolon
id|cursor.image.dy
op_assign
id|yy
op_star
id|height
suffix:semicolon
id|cursor.image.depth
op_assign
l_int|1
suffix:semicolon
id|cursor.image.data
op_assign
id|image
suffix:semicolon
id|cursor.mask
op_assign
id|mask
suffix:semicolon
id|cursor.dest
op_assign
id|dest
suffix:semicolon
id|cursor.rop
op_assign
id|ROP_XOR
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_cursor
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_cursor
c_func
(paren
id|info
comma
op_amp
id|cursor
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  `switch&squot; for the low level operations&n;&t; */
DECL|variable|fbcon_accel
r_struct
id|display_switch
id|fbcon_accel
op_assign
(brace
dot
id|setup
op_assign
id|fbcon_accel_setup
comma
dot
id|bmove
op_assign
id|fbcon_accel_bmove
comma
dot
id|clear
op_assign
id|fbcon_accel_clear
comma
dot
id|putc
op_assign
id|fbcon_accel_putc
comma
dot
id|putcs
op_assign
id|fbcon_accel_putcs
comma
dot
id|revc
op_assign
id|fbcon_accel_revc
comma
dot
id|clear_margins
op_assign
id|fbcon_accel_clear_margins
comma
dot
id|cursor
op_assign
id|fbcon_accel_cursor
comma
dot
id|fontwidthmask
op_assign
id|FONTWIDTHRANGE
c_func
(paren
l_int|1
comma
l_int|16
)paren
)brace
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#endif&t;&t;&t;&t;/* MODULE */
multiline_comment|/*&n;&t; *  Visible symbols for modules&n;&t; */
DECL|variable|fbcon_accel
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel
)paren
suffix:semicolon
DECL|variable|fbcon_accel_setup
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_setup
)paren
suffix:semicolon
DECL|variable|fbcon_accel_bmove
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_bmove
)paren
suffix:semicolon
DECL|variable|fbcon_accel_clear
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_clear
)paren
suffix:semicolon
DECL|variable|fbcon_accel_putc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_putc
)paren
suffix:semicolon
DECL|variable|fbcon_accel_putcs
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_putcs
)paren
suffix:semicolon
DECL|variable|fbcon_accel_revc
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_revc
)paren
suffix:semicolon
DECL|variable|fbcon_accel_clear_margins
id|EXPORT_SYMBOL
c_func
(paren
id|fbcon_accel_clear_margins
)paren
suffix:semicolon
eof
