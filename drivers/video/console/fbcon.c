multiline_comment|/*&n; *  linux/drivers/video/fbcon.c -- Low level frame buffer based console driver&n; *&n; *&t;Copyright (C) 1995 Geert Uytterhoeven&n; *&n; *&n; *  This file is based on the original Amiga console driver (amicon.c):&n; *&n; *&t;Copyright (C) 1993 Hamish Macdonald&n; *&t;&t;&t;   Greg Harp&n; *&t;Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *&t;      with work by William Rucklidge (wjr@cs.cornell.edu)&n; *&t;&t;&t;   Geert Uytterhoeven&n; *&t;&t;&t;   Jes Sorensen (jds@kom.auc.dk)&n; *&t;&t;&t;   Martin Apel&n; *&n; *  and on the original Atari console driver (atacon.c):&n; *&n; *&t;Copyright (C) 1993 Bjoern Brauel&n; *&t;&t;&t;   Roman Hodek&n; *&n; *&t;      with work by Guenther Kelleter&n; *&t;&t;&t;   Martin Schaller&n; *&t;&t;&t;   Andreas Schwab&n; *&n; *  Hardware cursor support added by Emmanuel Marty (core@ggi-project.org)&n; *  Smart redraw scrolling, arbitrary font width support, 512char font support&n; *  and software scrollback added by &n; *                         Jakub Jelinek (jj@ultra.linux.cz)&n; *&n; *  Random hacking by Martin Mares &lt;mj@ucw.cz&gt;&n; *&n; *&t;2001 - Documented with DocBook&n; *&t;- Brad Douglas &lt;brad@neruo.com&gt;&n; *&n; *  The low level operations for the various display memory organizations are&n; *  now in separate source files.&n; *&n; *  Currently the following organizations are supported:&n; *&n; *    o afb&t;&t;&t;Amiga bitplanes&n; *    o cfb{2,4,8,16,24,32}&t;Packed pixels&n; *    o ilbm&t;&t;&t;Amiga interleaved bitplanes&n; *    o iplan2p[248]&t;&t;Atari interleaved bitplanes&n; *    o mfb&t;&t;&t;Monochrome&n; *    o vga&t;&t;&t;VGA characters/attributes&n; *&n; *  To do:&n; *&n; *    - Implement 16 plane mode (iplan2p16)&n; *&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; */
DECL|macro|FBCONDEBUG
macro_line|#undef FBCONDEBUG
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/delay.h&gt;&t;/* MSch: for IRQ probe */
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/font.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/crc32.h&gt; /* For counting font checksums */
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_ATARI
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_MAC
macro_line|#include &lt;asm/macints.h&gt;
macro_line|#endif
macro_line|#if defined(__mc68000__) || defined(CONFIG_APUS)
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#endif
macro_line|#include &quot;fbcon.h&quot;
macro_line|#ifdef FBCONDEBUG
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...)
macro_line|#endif
r_enum
(brace
DECL|enumerator|FBCON_LOGO_CANSHOW
id|FBCON_LOGO_CANSHOW
op_assign
op_minus
l_int|1
comma
multiline_comment|/* the logo can be shown */
DECL|enumerator|FBCON_LOGO_DRAW
id|FBCON_LOGO_DRAW
op_assign
op_minus
l_int|2
comma
multiline_comment|/* draw the logo to a console */
DECL|enumerator|FBCON_LOGO_DONTSHOW
id|FBCON_LOGO_DONTSHOW
op_assign
op_minus
l_int|3
multiline_comment|/* do not show the logo */
)brace
suffix:semicolon
DECL|variable|fb_display
r_struct
id|display
id|fb_display
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|con2fb_map
r_int
r_char
id|con2fb_map
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|con2fb_map_boot
r_int
r_char
id|con2fb_map_boot
(braket
id|MAX_NR_CONSOLES
)braket
suffix:semicolon
DECL|variable|logo_height
r_static
r_int
id|logo_height
suffix:semicolon
DECL|variable|logo_lines
r_static
r_int
id|logo_lines
suffix:semicolon
multiline_comment|/* logo_shown is an index to vc_cons when &gt;= 0; otherwise follows FBCON_LOGO&n;   enums.  */
DECL|variable|logo_shown
r_static
r_int
id|logo_shown
op_assign
id|FBCON_LOGO_CANSHOW
suffix:semicolon
multiline_comment|/* Software scrollback */
DECL|variable|fbcon_softback_size
r_int
id|fbcon_softback_size
op_assign
l_int|32768
suffix:semicolon
DECL|variable|softback_buf
DECL|variable|softback_curr
r_static
r_int
r_int
id|softback_buf
comma
id|softback_curr
suffix:semicolon
DECL|variable|softback_in
r_static
r_int
r_int
id|softback_in
suffix:semicolon
DECL|variable|softback_top
DECL|variable|softback_end
r_static
r_int
r_int
id|softback_top
comma
id|softback_end
suffix:semicolon
DECL|variable|softback_lines
r_static
r_int
id|softback_lines
suffix:semicolon
multiline_comment|/* console mappings */
DECL|variable|first_fb_vc
r_static
r_int
id|first_fb_vc
suffix:semicolon
DECL|variable|last_fb_vc
r_static
r_int
id|last_fb_vc
op_assign
id|MAX_NR_CONSOLES
op_minus
l_int|1
suffix:semicolon
DECL|variable|fbcon_is_default
r_static
r_int
id|fbcon_is_default
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* font data */
DECL|variable|fontname
r_static
r_char
id|fontname
(braket
l_int|40
)braket
suffix:semicolon
multiline_comment|/* current fb_info */
DECL|variable|info_idx
r_static
r_int
id|info_idx
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|macro|CM_SOFTBACK
mdefine_line|#define CM_SOFTBACK&t;(8)
DECL|macro|advance_row
mdefine_line|#define advance_row(p, delta) (unsigned short *)((unsigned long)(p) + (delta) * vc-&gt;vc_size_row)
r_static
r_void
id|fbcon_free_font
c_func
(paren
r_struct
id|display
op_star
)paren
suffix:semicolon
r_static
r_int
id|fbcon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
)paren
suffix:semicolon
DECL|macro|CURSOR_DRAW_DELAY
mdefine_line|#define CURSOR_DRAW_DELAY&t;&t;(1)
multiline_comment|/* # VBL ints between cursor state changes */
DECL|macro|ARM_CURSOR_BLINK_RATE
mdefine_line|#define ARM_CURSOR_BLINK_RATE&t;&t;(10)
DECL|macro|ATARI_CURSOR_BLINK_RATE
mdefine_line|#define ATARI_CURSOR_BLINK_RATE&t;&t;(42)
DECL|macro|MAC_CURSOR_BLINK_RATE
mdefine_line|#define MAC_CURSOR_BLINK_RATE&t;&t;(32)
DECL|macro|DEFAULT_CURSOR_BLINK_RATE
mdefine_line|#define DEFAULT_CURSOR_BLINK_RATE&t;(20)
DECL|variable|vbl_cursor_cnt
r_static
r_int
id|vbl_cursor_cnt
suffix:semicolon
DECL|macro|divides
mdefine_line|#define divides(a, b)&t;((!(a) || (b)%(a)) ? 0 : 1)
multiline_comment|/*&n; *  Interface used by the world&n; */
r_static
r_const
r_char
op_star
id|fbcon_startup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|init
)paren
suffix:semicolon
r_static
r_void
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
suffix:semicolon
r_static
r_void
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
suffix:semicolon
r_static
r_void
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
suffix:semicolon
r_static
r_void
id|fbcon_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|bottom_only
)paren
suffix:semicolon
r_static
r_void
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
suffix:semicolon
r_static
r_int
id|fbcon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|blank
comma
r_int
id|mode_switch
)paren
suffix:semicolon
r_static
r_int
id|fbcon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
r_char
op_star
id|table
)paren
suffix:semicolon
r_static
r_int
id|fbcon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|lines
)paren
suffix:semicolon
multiline_comment|/*&n; *  Internal routines&n; */
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|ypos
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ywrap_up
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ywrap_down
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ypan_up
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|ypan_down
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
suffix:semicolon
r_static
r_void
id|fbcon_set_disp
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|vc_data
op_star
id|vc
)paren
suffix:semicolon
r_static
r_void
id|fbcon_preset_disp
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|unit
)paren
suffix:semicolon
r_static
r_void
id|fbcon_redraw_move
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|line
comma
r_int
id|count
comma
r_int
id|dy
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MAC
multiline_comment|/*&n; * On the Macintoy, there may or may not be a working VBL int. We need to probe&n; */
DECL|variable|vbl_detected
r_static
r_int
id|vbl_detected
suffix:semicolon
DECL|function|fb_vbl_detect
r_static
id|irqreturn_t
id|fb_vbl_detect
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|vbl_detected
op_increment
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
macro_line|#endif
DECL|function|fbcon_is_inactive
r_static
r_inline
r_int
id|fbcon_is_inactive
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_return
(paren
id|info-&gt;state
op_ne
id|FBINFO_STATE_RUNNING
op_logical_or
id|vt_cons
(braket
id|vc-&gt;vc_num
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
suffix:semicolon
)brace
DECL|function|get_color
r_static
r_inline
r_int
id|get_color
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
id|u16
id|c
comma
r_int
id|is_fg
)paren
(brace
r_int
id|depth
op_assign
id|fb_get_color_depth
c_func
(paren
id|info
)paren
suffix:semicolon
r_int
id|color
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
r_int
r_int
id|charmask
op_assign
id|vc-&gt;vc_hi_font_mask
ques
c_cond
l_int|0x1ff
suffix:colon
l_int|0xff
suffix:semicolon
id|c
op_assign
id|vc-&gt;vc_video_erase_char
op_amp
id|charmask
suffix:semicolon
)brace
r_if
c_cond
(paren
id|depth
op_ne
l_int|1
)paren
id|color
op_assign
(paren
id|is_fg
)paren
ques
c_cond
id|attr_fgcol
c_func
(paren
(paren
id|vc-&gt;vc_hi_font_mask
)paren
ques
c_cond
l_int|9
suffix:colon
l_int|8
comma
id|c
)paren
suffix:colon
id|attr_bgcol
c_func
(paren
(paren
id|vc-&gt;vc_hi_font_mask
)paren
ques
c_cond
l_int|13
suffix:colon
l_int|12
comma
id|c
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|depth
)paren
(brace
r_case
l_int|1
suffix:colon
(brace
multiline_comment|/* 0 or 1 */
r_int
id|fg
op_assign
(paren
id|info-&gt;fix.visual
op_ne
id|FB_VISUAL_MONO01
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_int
id|bg
op_assign
(paren
id|info-&gt;fix.visual
op_ne
id|FB_VISUAL_MONO01
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
id|fg
op_assign
id|bg
suffix:semicolon
id|color
op_assign
(paren
id|is_fg
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/*&n;&t;&t; * Scale down 16-colors to 4 colors. Default 4-color palette&n;&t;&t; * is grayscale.&n;&t;&t; */
id|color
op_div_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/*&n;&t;&t; * Last 8 entries of default 16-color palette is a more intense&n;&t;&t; * version of the first 8 (i.e., same chrominance, different&n;&t;&t; * luminance).&n;&t;&t; */
id|color
op_and_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|color
suffix:semicolon
)brace
DECL|function|fb_flashcursor
r_static
r_void
id|fb_flashcursor
c_func
(paren
r_void
op_star
r_private
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
r_private
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
r_struct
id|vc_data
op_star
id|vc
op_assign
l_int|NULL
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;currcon
op_ne
op_minus
l_int|1
)paren
id|vc
op_assign
id|vc_cons
(braket
id|ops-&gt;currcon
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
op_logical_or
op_logical_neg
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_or
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
op_logical_or
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
op_ne
id|info
)paren
r_return
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
id|c
op_assign
id|scr_readw
c_func
(paren
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_pos
)paren
suffix:semicolon
id|mode
op_assign
(paren
op_logical_neg
id|ops-&gt;cursor_flash
op_logical_or
id|ops-&gt;cursor_state.enable
)paren
ques
c_cond
id|CM_ERASE
suffix:colon
id|CM_DRAW
suffix:semicolon
id|ops
op_member_access_from_pointer
id|cursor
c_func
(paren
id|vc
comma
id|info
comma
id|p
comma
id|mode
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|c
comma
l_int|1
)paren
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|c
comma
l_int|0
)paren
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if (defined(__arm__) &amp;&amp; defined(IRQ_VSYNCPULSE)) || defined(CONFIG_ATARI) || defined(CONFIG_MAC)
DECL|variable|cursor_blink_rate
r_static
r_int
id|cursor_blink_rate
suffix:semicolon
DECL|function|fb_vbl_handler
r_static
id|irqreturn_t
id|fb_vbl_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
id|vbl_cursor_cnt
op_logical_and
op_decrement
id|vbl_cursor_cnt
op_eq
l_int|0
)paren
(brace
id|schedule_work
c_func
(paren
op_amp
id|info-&gt;queue
)paren
suffix:semicolon
id|vbl_cursor_cnt
op_assign
id|cursor_blink_rate
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cursor_timer_handler
r_static
r_void
id|cursor_timer_handler
c_func
(paren
r_int
r_int
id|dev_addr
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
(paren
r_struct
id|fb_info
op_star
)paren
id|dev_addr
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|info-&gt;queue
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
comma
id|jiffies
op_plus
id|HZ
op_div
l_int|5
)paren
suffix:semicolon
)brace
DECL|function|fb_console_setup
r_int
id|__init
id|fb_console_setup
c_func
(paren
r_char
op_star
id|this_opt
)paren
(brace
r_char
op_star
id|options
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|this_opt
op_logical_or
op_logical_neg
op_star
id|this_opt
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|options
op_assign
id|strsep
c_func
(paren
op_amp
id|this_opt
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
id|strcpy
c_func
(paren
id|fontname
comma
id|options
op_plus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;scrollback:&quot;
comma
l_int|11
)paren
)paren
(brace
id|options
op_add_assign
l_int|11
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
)paren
(brace
id|fbcon_softback_size
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|options
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
op_eq
l_char|&squot;k&squot;
op_logical_or
op_star
id|options
op_eq
l_char|&squot;K&squot;
)paren
(brace
id|fbcon_softback_size
op_mul_assign
l_int|1024
suffix:semicolon
id|options
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|options
op_ne
l_char|&squot;,&squot;
)paren
r_return
l_int|0
suffix:semicolon
id|options
op_increment
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;map:&quot;
comma
l_int|4
)paren
)paren
(brace
id|options
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|options
(braket
id|j
)braket
)paren
id|j
op_assign
l_int|0
suffix:semicolon
id|con2fb_map_boot
(braket
id|i
)braket
op_assign
(paren
id|options
(braket
id|j
op_increment
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_mod
id|FB_MAX
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;vc:&quot;
comma
l_int|3
)paren
)paren
(brace
id|options
op_add_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
)paren
id|first_fb_vc
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|options
comma
l_int|10
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|first_fb_vc
OL
l_int|0
)paren
id|first_fb_vc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
op_increment
op_eq
l_char|&squot;-&squot;
)paren
id|last_fb_vc
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|options
comma
l_int|10
)paren
op_minus
l_int|1
suffix:semicolon
id|fbcon_is_default
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;fbcon=&quot;
comma
id|fb_console_setup
)paren
suffix:semicolon
DECL|function|search_fb_in_map
r_static
r_int
id|search_fb_in_map
c_func
(paren
r_int
id|idx
)paren
(brace
r_int
id|i
comma
id|retval
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|con2fb_map
(braket
id|i
)braket
op_eq
id|idx
)paren
id|retval
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|search_for_mapped_con
r_static
r_int
id|search_for_mapped_con
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|retval
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|con2fb_map
(braket
id|i
)braket
op_ne
op_minus
l_int|1
)paren
id|retval
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|fbcon_takeover
r_static
r_int
id|fbcon_takeover
c_func
(paren
r_int
id|show_logo
)paren
(brace
r_int
id|err
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|num_registered_fb
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|show_logo
)paren
id|logo_shown
op_assign
id|FBCON_LOGO_DONTSHOW
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|first_fb_vc
suffix:semicolon
id|i
op_le
id|last_fb_vc
suffix:semicolon
id|i
op_increment
)paren
id|con2fb_map
(braket
id|i
)braket
op_assign
id|info_idx
suffix:semicolon
id|err
op_assign
id|take_over_console
c_func
(paren
op_amp
id|fb_con
comma
id|first_fb_vc
comma
id|last_fb_vc
comma
id|fbcon_is_default
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|first_fb_vc
suffix:semicolon
id|i
op_le
id|last_fb_vc
suffix:semicolon
id|i
op_increment
)paren
(brace
id|con2fb_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|info_idx
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|fbcon_prepare_logo
r_static
r_void
id|fbcon_prepare_logo
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|cols
comma
r_int
id|rows
comma
r_int
id|new_cols
comma
r_int
id|new_rows
)paren
(brace
multiline_comment|/* Need to make room for the logo */
r_int
id|cnt
comma
id|erase
op_assign
id|vc-&gt;vc_video_erase_char
comma
id|step
suffix:semicolon
r_int
r_int
op_star
id|save
op_assign
l_int|NULL
comma
op_star
id|r
comma
op_star
id|q
suffix:semicolon
multiline_comment|/*&n;&t; * remove underline attribute from erase character&n;&t; * if black and white framebuffer.&n;&t; */
r_if
c_cond
(paren
id|fb_get_color_depth
c_func
(paren
id|info
)paren
op_eq
l_int|1
)paren
id|erase
op_and_assign
op_complement
l_int|0x400
suffix:semicolon
id|logo_height
op_assign
id|fb_prepare_logo
c_func
(paren
id|info
)paren
suffix:semicolon
id|logo_lines
op_assign
(paren
id|logo_height
op_plus
id|vc-&gt;vc_font.height
op_minus
l_int|1
)paren
op_div
id|vc-&gt;vc_font.height
suffix:semicolon
id|q
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|rows
)paren
suffix:semicolon
id|step
op_assign
id|logo_lines
op_star
id|cols
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
id|q
op_minus
id|logo_lines
op_star
id|cols
suffix:semicolon
id|r
OL
id|q
suffix:semicolon
id|r
op_increment
)paren
r_if
c_cond
(paren
id|scr_readw
c_func
(paren
id|r
)paren
op_ne
id|vc-&gt;vc_video_erase_char
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ne
id|q
op_logical_and
id|new_rows
op_ge
id|rows
op_plus
id|logo_lines
)paren
(brace
id|save
op_assign
id|kmalloc
c_func
(paren
id|logo_lines
op_star
id|new_cols
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|save
)paren
(brace
r_int
id|i
op_assign
id|cols
OL
id|new_cols
ques
c_cond
id|cols
suffix:colon
id|new_cols
suffix:semicolon
id|scr_memsetw
c_func
(paren
id|save
comma
id|erase
comma
id|logo_lines
op_star
id|new_cols
op_star
l_int|2
)paren
suffix:semicolon
id|r
op_assign
id|q
op_minus
id|step
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|logo_lines
suffix:semicolon
id|cnt
op_increment
comma
id|r
op_add_assign
id|i
)paren
id|scr_memcpyw
c_func
(paren
id|save
op_plus
id|cnt
op_star
id|new_cols
comma
id|r
comma
l_int|2
op_star
id|i
)paren
suffix:semicolon
id|r
op_assign
id|q
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|r
op_eq
id|q
)paren
(brace
multiline_comment|/* We can scroll screen down */
id|r
op_assign
id|q
op_minus
id|step
op_minus
id|cols
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
id|rows
op_minus
id|logo_lines
suffix:semicolon
id|cnt
OG
l_int|0
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
id|scr_memcpyw
c_func
(paren
id|r
op_plus
id|step
comma
id|r
comma
id|vc-&gt;vc_size_row
)paren
suffix:semicolon
id|r
op_sub_assign
id|cols
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|save
)paren
(brace
id|vc-&gt;vc_y
op_add_assign
id|logo_lines
suffix:semicolon
id|vc-&gt;vc_pos
op_add_assign
id|logo_lines
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
)brace
)brace
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|vc-&gt;vc_origin
comma
id|erase
comma
id|vc-&gt;vc_size_row
op_star
id|logo_lines
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_and
id|vt_cons
(braket
id|vc-&gt;vc_num
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|0
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|save
)paren
(brace
id|q
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|rows
)paren
suffix:semicolon
id|scr_memcpyw
c_func
(paren
id|q
comma
id|save
comma
id|logo_lines
op_star
id|new_cols
op_star
l_int|2
)paren
suffix:semicolon
id|vc-&gt;vc_y
op_add_assign
id|logo_lines
suffix:semicolon
id|vc-&gt;vc_pos
op_add_assign
id|logo_lines
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
id|kfree
c_func
(paren
id|save
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|logo_lines
OG
id|vc-&gt;vc_bottom
)paren
(brace
id|logo_shown
op_assign
id|FBCON_LOGO_CANSHOW
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;fbcon_init: disable boot-logo (boot-logo bigger than screen).&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|logo_shown
op_ne
id|FBCON_LOGO_DONTSHOW
)paren
(brace
id|logo_shown
op_assign
id|FBCON_LOGO_DRAW
suffix:semicolon
id|vc-&gt;vc_top
op_assign
id|logo_lines
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_FB_TILEBLITTING
DECL|function|set_blitting_type
r_static
r_void
id|set_blitting_type
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|display
op_star
id|p
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;flags
op_amp
id|FBINFO_MISC_TILEBLITTING
)paren
)paren
id|fbcon_set_tileops
c_func
(paren
id|vc
comma
id|info
comma
id|p
comma
id|ops
)paren
suffix:semicolon
r_else
id|fbcon_set_bitops
c_func
(paren
id|ops
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|set_blitting_type
r_static
r_void
id|set_blitting_type
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|display
op_star
id|p
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_TILEBLITTING
suffix:semicolon
id|fbcon_set_bitops
c_func
(paren
id|ops
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MISC_TILEBLITTING */
DECL|function|con2fb_acquire_newinfo
r_static
r_int
id|con2fb_acquire_newinfo
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|unit
comma
r_int
id|oldidx
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|info-&gt;fbops-&gt;owner
)paren
)paren
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|info-&gt;fbops-&gt;fb_open
op_logical_and
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_open
c_func
(paren
id|info
comma
l_int|0
)paren
)paren
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|ops
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fbcon_ops
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|memset
c_func
(paren
id|ops
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fbcon_ops
)paren
)paren
suffix:semicolon
id|info-&gt;fbcon_par
op_assign
id|ops
suffix:semicolon
id|set_blitting_type
c_func
(paren
id|vc
comma
id|info
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|con2fb_map
(braket
id|unit
)braket
op_assign
id|oldidx
suffix:semicolon
id|module_put
c_func
(paren
id|info-&gt;fbops-&gt;owner
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|con2fb_release_oldinfo
r_static
r_int
id|con2fb_release_oldinfo
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|oldinfo
comma
r_struct
id|fb_info
op_star
id|newinfo
comma
r_int
id|unit
comma
r_int
id|oldidx
comma
r_int
id|found
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|oldinfo-&gt;fbcon_par
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|oldinfo-&gt;fbops-&gt;fb_release
op_logical_and
id|oldinfo-&gt;fbops
op_member_access_from_pointer
id|fb_release
c_func
(paren
id|oldinfo
comma
l_int|0
)paren
)paren
(brace
id|con2fb_map
(braket
id|unit
)braket
op_assign
id|oldidx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
op_logical_and
id|newinfo-&gt;fbops-&gt;fb_release
)paren
id|newinfo-&gt;fbops
op_member_access_from_pointer
id|fb_release
c_func
(paren
id|newinfo
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
id|module_put
c_func
(paren
id|newinfo-&gt;fbops-&gt;owner
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_if
c_cond
(paren
id|oldinfo-&gt;queue.func
op_eq
id|fb_flashcursor
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops-&gt;cursor_state.mask
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops-&gt;cursor_data
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|oldinfo-&gt;fbcon_par
)paren
suffix:semicolon
id|oldinfo-&gt;fbcon_par
op_assign
l_int|NULL
suffix:semicolon
id|module_put
c_func
(paren
id|oldinfo-&gt;fbops-&gt;owner
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|con2fb_init_newinfo
r_static
r_void
id|con2fb_init_newinfo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;queue.func
op_logical_or
id|info-&gt;queue.func
op_eq
id|fb_flashcursor
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;queue.func
)paren
id|INIT_WORK
c_func
(paren
op_amp
id|info-&gt;queue
comma
id|fb_flashcursor
comma
id|info
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
)paren
suffix:semicolon
id|ops-&gt;cursor_timer.function
op_assign
id|cursor_timer_handler
suffix:semicolon
id|ops-&gt;cursor_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|5
suffix:semicolon
id|ops-&gt;cursor_timer.data
op_assign
(paren
r_int
r_int
)paren
id|info
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
)paren
suffix:semicolon
)brace
)brace
DECL|function|con2fb_init_display
r_static
r_void
id|con2fb_init_display
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|unit
comma
r_int
id|show_logo
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|ops-&gt;currcon
op_assign
id|fg_console
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_set_par
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc
)paren
id|fbcon_set_disp
c_func
(paren
id|info
comma
id|vc
)paren
suffix:semicolon
r_else
id|fbcon_preset_disp
c_func
(paren
id|info
comma
id|unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|show_logo
)paren
(brace
r_struct
id|vc_data
op_star
id|fg_vc
op_assign
id|vc_cons
(braket
id|fg_console
)braket
dot
id|d
suffix:semicolon
r_struct
id|fb_info
op_star
id|fg_info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|fg_console
)braket
)braket
suffix:semicolon
id|fbcon_prepare_logo
c_func
(paren
id|fg_vc
comma
id|fg_info
comma
id|fg_vc-&gt;vc_cols
comma
id|fg_vc-&gt;vc_rows
comma
id|fg_vc-&gt;vc_cols
comma
id|fg_vc-&gt;vc_rows
)paren
suffix:semicolon
)brace
id|switch_screen
c_func
(paren
id|fg_console
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;set_con2fb_map - map console to frame buffer device&n; *&t;@unit: virtual console number to map&n; *&t;@newidx: frame buffer index to map virtual console to&n; *      @user: user request&n; *&n; *&t;Maps a virtual console @unit to a frame buffer device&n; *&t;@newidx.&n; */
DECL|function|set_con2fb_map
r_static
r_int
id|set_con2fb_map
c_func
(paren
r_int
id|unit
comma
r_int
id|newidx
comma
r_int
id|user
)paren
(brace
r_struct
id|vc_data
op_star
id|vc
op_assign
id|vc_cons
(braket
id|unit
)braket
dot
id|d
suffix:semicolon
r_int
id|oldidx
op_assign
id|con2fb_map
(braket
id|unit
)braket
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|newidx
)braket
suffix:semicolon
r_struct
id|fb_info
op_star
id|oldinfo
op_assign
l_int|NULL
suffix:semicolon
r_int
id|found
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|oldidx
op_eq
id|newidx
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
op_logical_neg
id|search_for_mapped_con
c_func
(paren
)paren
)paren
(brace
id|info_idx
op_assign
id|newidx
suffix:semicolon
r_return
id|fbcon_takeover
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oldidx
op_ne
op_minus
l_int|1
)paren
id|oldinfo
op_assign
id|registered_fb
(braket
id|oldidx
)braket
suffix:semicolon
id|found
op_assign
id|search_fb_in_map
c_func
(paren
id|newidx
)paren
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|con2fb_map
(braket
id|unit
)braket
op_assign
id|newidx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
op_logical_neg
id|found
)paren
id|err
op_assign
id|con2fb_acquire_newinfo
c_func
(paren
id|vc
comma
id|info
comma
id|unit
comma
id|oldidx
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If old fb is not mapped to any of the consoles,&n;&t; * fbcon should release it.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|oldinfo
op_logical_and
op_logical_neg
id|search_fb_in_map
c_func
(paren
id|oldidx
)paren
)paren
id|err
op_assign
id|con2fb_release_oldinfo
c_func
(paren
id|vc
comma
id|oldinfo
comma
id|info
comma
id|unit
comma
id|oldidx
comma
id|found
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_int
id|show_logo
op_assign
(paren
id|fg_console
op_eq
l_int|0
op_logical_and
op_logical_neg
id|user
op_logical_and
id|logo_shown
op_ne
id|FBCON_LOGO_DONTSHOW
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
id|con2fb_init_newinfo
c_func
(paren
id|info
)paren
suffix:semicolon
id|con2fb_map_boot
(braket
id|unit
)braket
op_assign
id|newidx
suffix:semicolon
id|con2fb_init_display
c_func
(paren
id|vc
comma
id|info
comma
id|unit
comma
id|show_logo
)paren
suffix:semicolon
)brace
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *  Low Level Operations&n; */
multiline_comment|/* NOTE: fbcon cannot be __init: it may be called from take_over_console later */
DECL|function|var_to_display
r_static
r_int
id|var_to_display
c_func
(paren
r_struct
id|display
op_star
id|disp
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
id|disp-&gt;xres_virtual
op_assign
id|var-&gt;xres_virtual
suffix:semicolon
id|disp-&gt;yres_virtual
op_assign
id|var-&gt;yres_virtual
suffix:semicolon
id|disp-&gt;bits_per_pixel
op_assign
id|var-&gt;bits_per_pixel
suffix:semicolon
id|disp-&gt;grayscale
op_assign
id|var-&gt;grayscale
suffix:semicolon
id|disp-&gt;nonstd
op_assign
id|var-&gt;nonstd
suffix:semicolon
id|disp-&gt;accel_flags
op_assign
id|var-&gt;accel_flags
suffix:semicolon
id|disp-&gt;height
op_assign
id|var-&gt;height
suffix:semicolon
id|disp-&gt;width
op_assign
id|var-&gt;width
suffix:semicolon
id|disp-&gt;red
op_assign
id|var-&gt;red
suffix:semicolon
id|disp-&gt;green
op_assign
id|var-&gt;green
suffix:semicolon
id|disp-&gt;blue
op_assign
id|var-&gt;blue
suffix:semicolon
id|disp-&gt;transp
op_assign
id|var-&gt;transp
suffix:semicolon
id|disp-&gt;mode
op_assign
id|fb_match_mode
c_func
(paren
id|var
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disp-&gt;mode
op_eq
l_int|NULL
)paren
multiline_comment|/* This should not happen */
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|display_to_var
r_static
r_void
id|display_to_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|display
op_star
id|disp
)paren
(brace
id|fb_videomode_to_var
c_func
(paren
id|var
comma
id|disp-&gt;mode
)paren
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
id|disp-&gt;xres_virtual
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|disp-&gt;yres_virtual
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
id|disp-&gt;bits_per_pixel
suffix:semicolon
id|var-&gt;grayscale
op_assign
id|disp-&gt;grayscale
suffix:semicolon
id|var-&gt;nonstd
op_assign
id|disp-&gt;nonstd
suffix:semicolon
id|var-&gt;accel_flags
op_assign
id|disp-&gt;accel_flags
suffix:semicolon
id|var-&gt;height
op_assign
id|disp-&gt;height
suffix:semicolon
id|var-&gt;width
op_assign
id|disp-&gt;width
suffix:semicolon
id|var-&gt;red
op_assign
id|disp-&gt;red
suffix:semicolon
id|var-&gt;green
op_assign
id|disp-&gt;green
suffix:semicolon
id|var-&gt;blue
op_assign
id|disp-&gt;blue
suffix:semicolon
id|var-&gt;transp
op_assign
id|disp-&gt;transp
suffix:semicolon
)brace
DECL|function|fbcon_startup
r_static
r_const
r_char
op_star
id|fbcon_startup
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|display_desc
op_assign
l_string|&quot;frame buffer device&quot;
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|fg_console
)braket
suffix:semicolon
r_struct
id|vc_data
op_star
id|vc
op_assign
id|vc_cons
(braket
id|fg_console
)braket
dot
id|d
suffix:semicolon
r_struct
id|font_desc
op_star
id|font
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|module
op_star
id|owner
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
suffix:semicolon
r_int
id|rows
comma
id|cols
suffix:semicolon
r_int
id|irqres
suffix:semicolon
id|irqres
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; *  If num_registered_fb is zero, this is a call for the dummy part.&n;&t; *  The frame buffer devices weren&squot;t initialized yet.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|num_registered_fb
op_logical_or
id|info_idx
op_eq
op_minus
l_int|1
)paren
r_return
id|display_desc
suffix:semicolon
multiline_comment|/*&n;&t; * Instead of blindly using registered_fb[0], we use info_idx, set by&n;&t; * fb_console_init();&n;&t; */
id|info
op_assign
id|registered_fb
(braket
id|info_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|NULL
suffix:semicolon
id|owner
op_assign
id|info-&gt;fbops-&gt;owner
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|owner
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_open
op_logical_and
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_open
c_func
(paren
id|info
comma
l_int|0
)paren
)paren
(brace
id|module_put
c_func
(paren
id|owner
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ops
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fbcon_ops
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
)paren
(brace
id|module_put
c_func
(paren
id|owner
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ops
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fbcon_ops
)paren
)paren
suffix:semicolon
id|ops-&gt;currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|info-&gt;fbcon_par
op_assign
id|ops
suffix:semicolon
id|set_blitting_type
c_func
(paren
id|vc
comma
id|info
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;fix.type
op_ne
id|FB_TYPE_TEXT
)paren
(brace
r_if
c_cond
(paren
id|fbcon_softback_size
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|softback_buf
)paren
(brace
id|softback_buf
op_assign
(paren
r_int
r_int
)paren
id|kmalloc
c_func
(paren
id|fbcon_softback_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|softback_buf
)paren
(brace
id|fbcon_softback_size
op_assign
l_int|0
suffix:semicolon
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|softback_buf
)paren
(brace
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|softback_buf
)paren
suffix:semicolon
id|softback_buf
op_assign
l_int|0
suffix:semicolon
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|softback_buf
)paren
id|softback_in
op_assign
id|softback_top
op_assign
id|softback_curr
op_assign
id|softback_buf
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Setup default font */
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;fontdata
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fontname
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
(paren
id|font
op_assign
id|find_font
c_func
(paren
id|fontname
)paren
)paren
)paren
id|font
op_assign
id|get_default_font
c_func
(paren
id|info-&gt;var.xres
comma
id|info-&gt;var.yres
)paren
suffix:semicolon
id|vc-&gt;vc_font.width
op_assign
id|font-&gt;width
suffix:semicolon
id|vc-&gt;vc_font.height
op_assign
id|font-&gt;height
suffix:semicolon
id|vc-&gt;vc_font.data
op_assign
id|p-&gt;fontdata
op_assign
id|font-&gt;data
suffix:semicolon
id|vc-&gt;vc_font.charcount
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* FIXME  Need to support more fonts */
)brace
id|cols
op_assign
id|info-&gt;var.xres
op_div
id|vc-&gt;vc_font.width
suffix:semicolon
id|rows
op_assign
id|info-&gt;var.yres
op_div
id|vc-&gt;vc_font.height
suffix:semicolon
id|vc_resize
c_func
(paren
id|vc-&gt;vc_num
comma
id|cols
comma
id|rows
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;mode:   %s&bslash;n&quot;
comma
id|info-&gt;fix.id
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;visual: %d&bslash;n&quot;
comma
id|info-&gt;fix.visual
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;res:    %dx%d-%d&bslash;n&quot;
comma
id|info-&gt;var.xres
comma
id|info-&gt;var.yres
comma
id|info-&gt;var.bits_per_pixel
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_if
c_cond
(paren
id|MACH_IS_ATARI
)paren
(brace
id|cursor_blink_rate
op_assign
id|ATARI_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_AUTO_4
comma
id|fb_vbl_handler
comma
id|IRQ_TYPE_PRIO
comma
l_string|&quot;framebuffer vbl&quot;
comma
id|info
)paren
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* CONFIG_ATARI */
macro_line|#ifdef CONFIG_MAC
multiline_comment|/*&n;&t; * On a Macintoy, the VBL interrupt may or may not be active. &n;&t; * As interrupt based cursor is more reliable and race free, we &n;&t; * probe for VBL interrupts.&n;&t; */
r_if
c_cond
(paren
id|MACH_IS_MAC
)paren
(brace
r_int
id|ct
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Probe for VBL: set temp. handler ...&n;&t;&t; */
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fb_vbl_detect
comma
l_int|0
comma
l_string|&quot;framebuffer vbl&quot;
comma
id|info
)paren
suffix:semicolon
id|vbl_detected
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * ... and spin for 20 ms ...&n;&t;&t; */
r_while
c_loop
(paren
op_logical_neg
id|vbl_detected
op_logical_and
op_increment
id|ct
OL
l_int|1000
)paren
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ct
op_eq
l_int|1000
)paren
id|printk
(paren
l_string|&quot;fbcon_startup: No VBL detected, using timer based cursor.&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fb_vbl_detect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vbl_detected
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * interrupt based cursor ok&n;&t;&t;&t; */
id|cursor_blink_rate
op_assign
id|MAC_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_MAC_VBL
comma
id|fb_vbl_handler
comma
l_int|0
comma
l_string|&quot;framebuffer vbl&quot;
comma
id|info
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * VBL not detected: fall through, use timer based cursor&n;&t;&t;&t; */
id|irqres
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif&t;&t;&t;&t;/* CONFIG_MAC */
macro_line|#if defined(__arm__) &amp;&amp; defined(IRQ_VSYNCPULSE)
id|cursor_blink_rate
op_assign
id|ARM_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_VSYNCPULSE
comma
id|fb_vbl_handler
comma
id|SA_SHIRQ
comma
l_string|&quot;framebuffer vbl&quot;
comma
id|info
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Initialize the work queue. If the driver provides its&n;&t; * own work queue this means it will use something besides &n;&t; * default timer to flash the cursor. */
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;queue.func
)paren
(brace
id|INIT_WORK
c_func
(paren
op_amp
id|info-&gt;queue
comma
id|fb_flashcursor
comma
id|info
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
)paren
suffix:semicolon
id|ops-&gt;cursor_timer.function
op_assign
id|cursor_timer_handler
suffix:semicolon
id|ops-&gt;cursor_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|5
suffix:semicolon
id|ops-&gt;cursor_timer.data
op_assign
(paren
r_int
r_int
)paren
id|info
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ops-&gt;cursor_timer
)paren
suffix:semicolon
)brace
r_return
id|display_desc
suffix:semicolon
)brace
DECL|function|fbcon_init
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|init
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|vc_data
op_star
op_star
id|default_mode
op_assign
id|vc-&gt;vc_display_fg
suffix:semicolon
r_struct
id|vc_data
op_star
id|svc
op_assign
op_star
id|default_mode
suffix:semicolon
r_struct
id|display
op_star
id|t
comma
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_int
id|display_fg
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_num
suffix:semicolon
r_int
id|logo
op_assign
l_int|1
comma
id|new_rows
comma
id|new_cols
comma
id|rows
comma
id|cols
comma
id|charcnt
op_assign
l_int|256
suffix:semicolon
r_int
id|cap
op_assign
id|info-&gt;flags
suffix:semicolon
r_if
c_cond
(paren
id|info_idx
op_eq
op_minus
l_int|1
op_logical_or
id|info
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_ne
id|display_fg
op_logical_or
id|logo_shown
op_eq
id|FBCON_LOGO_DONTSHOW
op_logical_or
(paren
id|info-&gt;fix.type
op_eq
id|FB_TYPE_TEXT
)paren
)paren
id|logo
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset wrap/pan */
r_if
c_cond
(paren
id|var_to_display
c_func
(paren
id|p
comma
op_amp
id|info-&gt;var
comma
id|info
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* If we are not the first console on this&n;&t;   fb, copy the font from that console */
id|t
op_assign
op_amp
id|fb_display
(braket
id|display_fg
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;vc_font.data
)paren
(brace
id|vc-&gt;vc_font.data
op_assign
id|p-&gt;fontdata
op_assign
id|t-&gt;fontdata
suffix:semicolon
id|vc-&gt;vc_font.width
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_font.width
suffix:semicolon
id|vc-&gt;vc_font.height
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_font.height
suffix:semicolon
id|p-&gt;userfont
op_assign
id|t-&gt;userfont
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|charcnt
op_assign
id|FNTCHARCNT
c_func
(paren
id|p-&gt;fontdata
)paren
suffix:semicolon
id|vc-&gt;vc_can_do_color
op_assign
(paren
id|fb_get_color_depth
c_func
(paren
id|info
)paren
op_ne
l_int|1
)paren
suffix:semicolon
id|vc-&gt;vc_complement_mask
op_assign
id|vc-&gt;vc_can_do_color
ques
c_cond
l_int|0x7700
suffix:colon
l_int|0x0800
suffix:semicolon
r_if
c_cond
(paren
id|charcnt
op_eq
l_int|256
)paren
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
id|vc-&gt;vc_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|svc-&gt;vc_uni_pagedir_loc
)paren
id|con_set_default_unimap
c_func
(paren
id|display_fg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|vc-&gt;vc_uni_pagedir_loc
)paren
id|con_copy_unimap
c_func
(paren
id|vc-&gt;vc_num
comma
id|display_fg
)paren
suffix:semicolon
id|cols
op_assign
id|vc-&gt;vc_cols
suffix:semicolon
id|rows
op_assign
id|vc-&gt;vc_rows
suffix:semicolon
id|new_cols
op_assign
id|info-&gt;var.xres
op_div
id|vc-&gt;vc_font.width
suffix:semicolon
id|new_rows
op_assign
id|info-&gt;var.yres
op_div
id|vc-&gt;vc_font.height
suffix:semicolon
id|vc_resize
c_func
(paren
id|vc-&gt;vc_num
comma
id|new_cols
comma
id|new_rows
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We must always set the mode. The mode of the previous console&n;&t; * driver could be in the same resolution but we are using different&n;&t; * hardware so we have to initialize the hardware.&n;&t; *&n;&t; * We need to do it in fbcon_init() to prevent screen corruption.&n;&t; */
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_and
id|info-&gt;fbops-&gt;fb_set_par
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_COPYAREA
)paren
op_logical_and
op_logical_neg
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_MOVE
suffix:semicolon
r_else
multiline_comment|/* default to something safe */
id|p-&gt;scrollmode
op_assign
id|SCROLL_REDRAW
suffix:semicolon
multiline_comment|/*&n;&t; *  ++guenther: console.c:vc_allocate() relies on initializing&n;&t; *  vc_{cols,rows}, but we must not set those if we are only&n;&t; *  resizing the console.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
(brace
id|vc-&gt;vc_cols
op_assign
id|new_cols
suffix:semicolon
id|vc-&gt;vc_rows
op_assign
id|new_rows
suffix:semicolon
)brace
r_if
c_cond
(paren
id|logo
)paren
id|fbcon_prepare_logo
c_func
(paren
id|vc
comma
id|info
comma
id|cols
comma
id|rows
comma
id|new_cols
comma
id|new_rows
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_eq
id|display_fg
op_logical_and
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;&t;&t;&t;   the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_deinit
r_static
r_void
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info_idx
op_ne
op_minus
l_int|1
)paren
r_return
suffix:semicolon
id|fbcon_free_font
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/*  fbcon_XXX routines - interface used by the world&n; *&n; *  This system is now divided into two levels because of complications&n; *  caused by hardware scrolling. Top level functions:&n; *&n; *&t;fbcon_bmove(), fbcon_clear(), fbcon_putc(), fbcon_clear_margins()&n; *&n; *  handles y values in range [0, scr_height-1] that correspond to real&n; *  screen positions. y_wrap shift means that first line of bitmap may be&n; *  anywhere on this display. These functions convert lineoffsets to&n; *  bitmap offsets and deal with the wrap-around case by splitting blits.&n; *&n; *&t;fbcon_bmove_physical_8()    -- These functions fast implementations&n; *&t;fbcon_clear_physical_8()    -- of original fbcon_XXX fns.&n; *&t;fbcon_putc_physical_8()&t;    -- (font width != 8) may be added later&n; *&n; *  WARNING:&n; *&n; *  At the moment fbcon_putc() cannot blit across vertical wrap boundary&n; *  Implies should only really hardware scroll in rows. Only reason for&n; *  restriction is simplicity &amp; efficiency at the moment.&n; */
DECL|function|real_y
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|ypos
)paren
(brace
r_int
id|rows
op_assign
id|p-&gt;vrows
suffix:semicolon
id|ypos
op_add_assign
id|p-&gt;yscroll
suffix:semicolon
r_return
id|ypos
OL
id|rows
ques
c_cond
id|ypos
suffix:colon
id|ypos
op_minus
id|rows
suffix:semicolon
)brace
DECL|function|fbcon_clear
r_static
r_void
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
id|u_int
id|y_break
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|height
op_logical_or
op_logical_neg
id|width
)paren
r_return
suffix:semicolon
multiline_comment|/* Split blits that cross physical y_wrap boundary */
id|y_break
op_assign
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
suffix:semicolon
r_if
c_cond
(paren
id|sy
OL
id|y_break
op_logical_and
id|sy
op_plus
id|height
op_minus
l_int|1
op_ge
id|y_break
)paren
(brace
id|u_int
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
id|ops
op_member_access_from_pointer
id|clear
c_func
(paren
id|vc
comma
id|info
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|b
comma
id|width
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|clear
c_func
(paren
id|vc
comma
id|info
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
)paren
comma
id|sx
comma
id|height
op_minus
id|b
comma
id|width
)paren
suffix:semicolon
)brace
r_else
id|ops
op_member_access_from_pointer
id|clear
c_func
(paren
id|vc
comma
id|info
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|fbcon_putcs
r_static
r_void
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
id|ops
op_member_access_from_pointer
id|putcs
c_func
(paren
id|vc
comma
id|info
comma
id|s
comma
id|count
comma
id|real_y
c_func
(paren
id|p
comma
id|ypos
)paren
comma
id|xpos
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|scr_readw
c_func
(paren
id|s
)paren
comma
l_int|1
)paren
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|scr_readw
c_func
(paren
id|s
)paren
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|fbcon_putc
r_static
r_void
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
r_int
id|chr
suffix:semicolon
id|scr_writew
c_func
(paren
id|c
comma
op_amp
id|chr
)paren
suffix:semicolon
id|fbcon_putcs
c_func
(paren
id|vc
comma
op_amp
id|chr
comma
l_int|1
comma
id|ypos
comma
id|xpos
)paren
suffix:semicolon
)brace
DECL|function|fbcon_clear_margins
r_static
r_void
id|fbcon_clear_margins
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|bottom_only
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
id|ops
op_member_access_from_pointer
id|clear_margins
c_func
(paren
id|vc
comma
id|info
comma
id|bottom_only
)paren
suffix:semicolon
)brace
DECL|function|fbcon_cursor
r_static
r_void
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|mode
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_int
id|y
op_assign
id|real_y
c_func
(paren
id|p
comma
id|vc-&gt;vc_y
)paren
suffix:semicolon
r_int
id|c
op_assign
id|scr_readw
c_func
(paren
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
suffix:semicolon
id|ops-&gt;cursor_flash
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|CM_SOFTBACK
)paren
(brace
id|mode
op_and_assign
op_complement
id|CM_SOFTBACK
suffix:semicolon
r_if
c_cond
(paren
id|softback_lines
)paren
(brace
r_if
c_cond
(paren
id|y
op_plus
id|softback_lines
op_ge
id|vc-&gt;vc_rows
)paren
(brace
id|mode
op_assign
id|CM_ERASE
suffix:semicolon
id|ops-&gt;cursor_flash
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|y
op_add_assign
id|softback_lines
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|vc
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|cursor
c_func
(paren
id|vc
comma
id|info
comma
id|p
comma
id|mode
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|c
comma
l_int|1
)paren
comma
id|get_color
c_func
(paren
id|vc
comma
id|info
comma
id|c
comma
l_int|0
)paren
)paren
suffix:semicolon
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|variable|scrollback_phys_max
r_static
r_int
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
DECL|variable|scrollback_max
r_static
r_int
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
DECL|variable|scrollback_current
r_static
r_int
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
DECL|function|update_var
r_int
id|update_var
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|con
op_eq
(paren
(paren
r_struct
id|fbcon_ops
op_star
)paren
id|info-&gt;fbcon_par
)paren
op_member_access_from_pointer
id|currcon
)paren
r_return
id|fb_pan_display
c_func
(paren
id|info
comma
op_amp
id|info-&gt;var
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * If no vc is existent yet, just set struct display&n; */
DECL|function|fbcon_preset_disp
r_static
r_void
id|fbcon_preset_disp
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|unit
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|unit
)braket
suffix:semicolon
r_struct
id|display
op_star
id|t
op_assign
op_amp
id|fb_display
(braket
id|fg_console
)braket
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var_to_display
c_func
(paren
id|p
comma
op_amp
id|info-&gt;var
comma
id|info
)paren
)paren
r_return
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|t-&gt;fontdata
suffix:semicolon
id|p-&gt;userfont
op_assign
id|t-&gt;userfont
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_increment
suffix:semicolon
)brace
DECL|function|fbcon_set_disp
r_static
r_void
id|fbcon_set_disp
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
comma
op_star
id|t
suffix:semicolon
r_struct
id|vc_data
op_star
op_star
id|default_mode
op_assign
id|vc-&gt;vc_display_fg
suffix:semicolon
r_struct
id|vc_data
op_star
id|svc
op_assign
op_star
id|default_mode
suffix:semicolon
r_int
id|display_fg
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_num
suffix:semicolon
r_int
id|rows
comma
id|cols
comma
id|charcnt
op_assign
l_int|256
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var_to_display
c_func
(paren
id|p
comma
op_amp
id|info-&gt;var
comma
id|info
)paren
)paren
r_return
suffix:semicolon
id|t
op_assign
op_amp
id|fb_display
(braket
id|display_fg
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;vc_font.data
)paren
(brace
id|vc-&gt;vc_font.data
op_assign
id|p-&gt;fontdata
op_assign
id|t-&gt;fontdata
suffix:semicolon
id|vc-&gt;vc_font.width
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_font.width
suffix:semicolon
id|vc-&gt;vc_font.height
op_assign
(paren
op_star
id|default_mode
)paren
op_member_access_from_pointer
id|vc_font.height
suffix:semicolon
id|p-&gt;userfont
op_assign
id|t-&gt;userfont
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|charcnt
op_assign
id|FNTCHARCNT
c_func
(paren
id|p-&gt;fontdata
)paren
suffix:semicolon
id|vc-&gt;vc_can_do_color
op_assign
(paren
id|fb_get_color_depth
c_func
(paren
id|info
)paren
op_ne
l_int|1
)paren
suffix:semicolon
id|vc-&gt;vc_complement_mask
op_assign
id|vc-&gt;vc_can_do_color
ques
c_cond
l_int|0x7700
suffix:colon
l_int|0x0800
suffix:semicolon
r_if
c_cond
(paren
id|charcnt
op_eq
l_int|256
)paren
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
id|vc-&gt;vc_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|svc-&gt;vc_uni_pagedir_loc
)paren
id|con_set_default_unimap
c_func
(paren
id|display_fg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|vc-&gt;vc_uni_pagedir_loc
)paren
id|con_copy_unimap
c_func
(paren
id|vc-&gt;vc_num
comma
id|display_fg
)paren
suffix:semicolon
id|cols
op_assign
id|info-&gt;var.xres
op_div
id|vc-&gt;vc_font.width
suffix:semicolon
id|rows
op_assign
id|info-&gt;var.yres
op_div
id|vc-&gt;vc_font.height
suffix:semicolon
id|vc_resize
c_func
(paren
id|vc-&gt;vc_num
comma
id|cols
comma
id|rows
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
)paren
(brace
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0&n;&t;&t;&t;&t;   would screw the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|ywrap_up
r_static
id|__inline__
r_void
id|ywrap_up
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
op_ge
id|p-&gt;vrows
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|scrollback_max
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OG
id|scrollback_phys_max
)paren
id|scrollback_max
op_assign
id|scrollback_phys_max
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ywrap_down
r_static
id|__inline__
r_void
id|ywrap_down
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|scrollback_max
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OL
l_int|0
)paren
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_up
r_static
id|__inline__
r_void
id|ypan_up
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OG
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
(brace
id|ops
op_member_access_from_pointer
id|bmove
c_func
(paren
id|vc
comma
id|info
comma
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|vc-&gt;vc_rows
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OG
id|scrollback_phys_max
)paren
id|scrollback_max
op_assign
id|scrollback_phys_max
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_up_redraw
r_static
id|__inline__
r_void
id|ypan_up_redraw
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_int
id|redraw
op_assign
l_int|0
suffix:semicolon
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OG
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
(brace
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
suffix:semicolon
id|redraw
op_assign
l_int|1
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_if
c_cond
(paren
id|redraw
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|t
op_plus
id|count
comma
id|vc-&gt;vc_rows
op_minus
id|count
comma
id|t
)paren
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OG
id|scrollback_phys_max
)paren
id|scrollback_max
op_assign
id|scrollback_phys_max
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_down
r_static
id|__inline__
r_void
id|ypan_down
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
(brace
id|ops
op_member_access_from_pointer
id|bmove
c_func
(paren
id|vc
comma
id|info
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
comma
l_int|0
comma
id|vc-&gt;vc_rows
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OL
l_int|0
)paren
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ypan_down_redraw
r_static
id|__inline__
r_void
id|ypan_down_redraw
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_int
id|redraw
op_assign
l_int|0
suffix:semicolon
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
(brace
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
suffix:semicolon
id|redraw
op_assign
l_int|1
suffix:semicolon
)brace
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_if
c_cond
(paren
id|redraw
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|t
comma
id|vc-&gt;vc_rows
op_minus
id|count
comma
id|t
op_plus
id|count
)paren
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|1
)paren
suffix:semicolon
id|scrollback_max
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_max
OL
l_int|0
)paren
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_redraw_softback
r_static
r_void
id|fbcon_redraw_softback
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|delta
)paren
(brace
r_int
id|count
op_assign
id|vc-&gt;vc_rows
suffix:semicolon
r_int
r_int
op_star
id|d
comma
op_star
id|s
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
r_int
id|line
op_assign
l_int|0
suffix:semicolon
id|d
op_assign
(paren
id|u16
op_star
)paren
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
id|n
op_assign
id|softback_curr
op_plus
id|delta
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
id|softback_lines
op_sub_assign
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|softback_curr
OL
id|softback_top
op_logical_and
id|n
OL
id|softback_buf
)paren
(brace
id|n
op_add_assign
id|softback_end
op_minus
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
id|softback_top
)paren
(brace
id|softback_lines
op_sub_assign
(paren
id|softback_top
op_minus
id|n
)paren
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
id|n
op_assign
id|softback_top
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_curr
op_ge
id|softback_top
op_logical_and
id|n
OL
id|softback_top
)paren
(brace
id|softback_lines
op_sub_assign
(paren
id|softback_top
op_minus
id|n
)paren
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
id|n
op_assign
id|softback_top
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|softback_curr
OG
id|softback_in
op_logical_and
id|n
op_ge
id|softback_end
)paren
(brace
id|n
op_add_assign
id|softback_buf
op_minus
id|softback_end
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|softback_in
)paren
(brace
id|n
op_assign
id|softback_in
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|softback_curr
op_le
id|softback_in
op_logical_and
id|n
OG
id|softback_in
)paren
(brace
id|n
op_assign
id|softback_in
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|n
op_eq
id|softback_curr
)paren
r_return
suffix:semicolon
id|softback_curr
op_assign
id|n
suffix:semicolon
id|s
op_assign
(paren
id|u16
op_star
)paren
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_int
r_int
op_star
id|start
suffix:semicolon
r_int
r_int
op_star
id|le
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
id|le
op_assign
id|advance_row
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|c
op_eq
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
id|s
op_increment
suffix:semicolon
id|d
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|line
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|d
op_assign
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|s
op_assign
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
)brace
)brace
DECL|function|fbcon_redraw_move
r_static
r_void
id|fbcon_redraw_move
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|line
comma
r_int
id|count
comma
r_int
id|dy
)paren
(brace
r_int
r_int
op_star
id|s
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|line
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_int
r_int
op_star
id|start
op_assign
id|s
suffix:semicolon
r_int
r_int
op_star
id|le
op_assign
id|advance_row
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|dy
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
)brace
)brace
id|console_conditional_schedule
c_func
(paren
)paren
suffix:semicolon
id|s
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|dy
comma
id|x
)paren
suffix:semicolon
id|console_conditional_schedule
c_func
(paren
)paren
suffix:semicolon
id|dy
op_increment
suffix:semicolon
)brace
)brace
DECL|function|fbcon_redraw
r_static
r_void
id|fbcon_redraw
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|line
comma
r_int
id|count
comma
r_int
id|offset
)paren
(brace
r_int
r_int
op_star
id|d
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|line
)paren
suffix:semicolon
r_int
r_int
op_star
id|s
op_assign
id|d
op_plus
id|offset
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_int
r_int
op_star
id|start
op_assign
id|s
suffix:semicolon
r_int
r_int
op_star
id|le
op_assign
id|advance_row
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|attr
op_assign
l_int|1
suffix:semicolon
r_do
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attr
op_ne
(paren
id|c
op_amp
l_int|0xff00
)paren
)paren
(brace
id|attr
op_assign
id|c
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
suffix:semicolon
id|start
op_assign
id|s
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|c
op_eq
id|scr_readw
c_func
(paren
id|d
)paren
)paren
(brace
r_if
c_cond
(paren
id|s
OG
id|start
)paren
(brace
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|x
op_add_assign
id|s
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|start
op_assign
id|s
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|x
op_increment
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
id|scr_writew
c_func
(paren
id|c
comma
id|d
)paren
suffix:semicolon
id|console_conditional_schedule
c_func
(paren
)paren
suffix:semicolon
id|s
op_increment
suffix:semicolon
id|d
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
OL
id|le
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
OG
id|start
)paren
id|fbcon_putcs
c_func
(paren
id|vc
comma
id|start
comma
id|s
op_minus
id|start
comma
id|line
comma
id|x
)paren
suffix:semicolon
id|console_conditional_schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
l_int|0
)paren
id|line
op_increment
suffix:semicolon
r_else
(brace
id|line
op_decrement
suffix:semicolon
multiline_comment|/* NOTE: We subtract two lines from these pointers */
id|s
op_sub_assign
id|vc-&gt;vc_size_row
suffix:semicolon
id|d
op_sub_assign
id|vc-&gt;vc_size_row
suffix:semicolon
)brace
)brace
)brace
DECL|function|fbcon_softback_note
r_static
r_inline
r_void
id|fbcon_softback_note
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_ne
id|fg_console
)paren
r_return
suffix:semicolon
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|t
op_star
id|vc-&gt;vc_size_row
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|scr_memcpyw
c_func
(paren
(paren
id|u16
op_star
)paren
id|softback_in
comma
id|p
comma
id|vc-&gt;vc_size_row
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|p
op_assign
id|advance_row
c_func
(paren
id|p
comma
l_int|1
)paren
suffix:semicolon
id|softback_in
op_add_assign
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_in
op_eq
id|softback_end
)paren
id|softback_in
op_assign
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|softback_in
op_eq
id|softback_top
)paren
(brace
id|softback_top
op_add_assign
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
op_eq
id|softback_end
)paren
id|softback_top
op_assign
id|softback_buf
suffix:semicolon
)brace
)brace
id|softback_curr
op_assign
id|softback_in
suffix:semicolon
)brace
DECL|function|fbcon_scroll
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_int
id|scroll_partial
op_assign
id|info-&gt;flags
op_amp
id|FBINFO_PARTIAL_PAN_OK
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_ERASE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ++Geert: Only use ywrap/ypan if the console is in text mode&n;&t; * ++Andrew: Only use ypan on hardware text mode when scrolling the&n;&t; *           whole screen (prevents flicker).&n;&t; */
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|SM_UP
suffix:colon
r_if
c_cond
(paren
id|count
OG
id|vc-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|vc-&gt;vc_rows
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
id|fbcon_softback_note
c_func
(paren
id|vc
comma
id|t
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
r_goto
id|redraw_up
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_MOVE
suffix:colon
id|ops
op_member_access_from_pointer
id|bmove
c_func
(paren
id|vc
comma
id|info
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|clear
c_func
(paren
id|vc
comma
id|info
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_WRAP_MOVE
suffix:colon
r_if
c_cond
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
l_int|0
comma
l_int|0
comma
id|count
comma
l_int|0
comma
id|t
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ywrap_up
c_func
(paren
id|vc
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|b
comma
l_int|0
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_READS_FAST
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_else
r_goto
id|redraw_up
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_REDRAW
suffix:colon
r_if
c_cond
(paren
(paren
id|p-&gt;yscroll
op_plus
id|count
op_le
l_int|2
op_star
(paren
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|vc-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
l_int|0
comma
id|t
comma
id|count
)paren
suffix:semicolon
id|ypan_up_redraw
c_func
(paren
id|vc
comma
id|t
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|b
op_minus
id|count
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|b
)paren
suffix:semicolon
)brace
r_else
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|t
op_plus
id|count
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|t
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_MOVE
suffix:colon
r_if
c_cond
(paren
(paren
id|p-&gt;yscroll
op_plus
id|count
op_le
l_int|2
op_star
(paren
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|vc-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
l_int|0
comma
l_int|0
comma
id|count
comma
l_int|0
comma
id|t
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ypan_up
c_func
(paren
id|vc
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|b
comma
l_int|0
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_READS_FAST
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_else
r_goto
id|redraw_up
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_REDRAW
suffix:colon
id|redraw_up
suffix:colon
id|fbcon_redraw
c_func
(paren
id|vc
comma
id|p
comma
id|t
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|count
op_star
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
(paren
id|b
op_minus
id|count
)paren
)paren
comma
id|vc-&gt;vc_video_erase_char
comma
id|vc-&gt;vc_size_row
op_star
id|count
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SM_DOWN
suffix:colon
r_if
c_cond
(paren
id|count
OG
id|vc-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|vc-&gt;vc_rows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_MOVE
suffix:colon
id|ops
op_member_access_from_pointer
id|bmove
c_func
(paren
id|vc
comma
id|info
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|clear
c_func
(paren
id|vc
comma
id|info
comma
id|t
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_WRAP_MOVE
suffix:colon
r_if
c_cond
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|b
comma
l_int|0
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ywrap_down
c_func
(paren
id|vc
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|count
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|t
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_READS_FAST
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_else
r_goto
id|redraw_down
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_MOVE
suffix:colon
r_if
c_cond
(paren
(paren
id|count
op_minus
id|p-&gt;yscroll
op_le
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|vc-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|b
comma
l_int|0
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|ypan_down
c_func
(paren
id|vc
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|count
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|t
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_READS_FAST
)paren
id|fbcon_bmove
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_else
r_goto
id|redraw_down
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_REDRAW
suffix:colon
r_if
c_cond
(paren
(paren
id|count
op_minus
id|p-&gt;yscroll
op_le
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_eq
id|vc-&gt;vc_rows
)paren
)paren
op_logical_or
(paren
id|scroll_partial
op_logical_and
(paren
id|b
op_minus
id|t
op_minus
id|count
OG
l_int|3
op_star
id|vc-&gt;vc_rows
op_rshift
l_int|2
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|vc-&gt;vc_rows
op_minus
id|b
OG
l_int|0
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|b
comma
id|vc-&gt;vc_rows
op_minus
id|b
comma
id|b
op_minus
id|count
)paren
suffix:semicolon
id|ypan_down_redraw
c_func
(paren
id|vc
comma
id|t
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
OG
l_int|0
)paren
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|count
comma
id|t
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|fbcon_redraw_move
c_func
(paren
id|vc
comma
id|p
comma
id|t
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|t
op_plus
id|count
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_REDRAW
suffix:colon
id|redraw_down
suffix:colon
id|fbcon_redraw
c_func
(paren
id|vc
comma
id|p
comma
id|b
op_minus
l_int|1
comma
id|b
op_minus
id|t
op_minus
id|count
comma
op_minus
id|count
op_star
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
id|t
comma
l_int|0
comma
id|count
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|scr_memsetw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|t
)paren
comma
id|vc-&gt;vc_video_erase_char
comma
id|vc-&gt;vc_size_row
op_star
id|count
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_bmove
r_static
r_void
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|width
op_logical_or
op_logical_neg
id|height
)paren
r_return
suffix:semicolon
multiline_comment|/*  Split blits that cross physical y_wrap case.&n;&t; *  Pathological case involves 4 blits, better to use recursive&n;&t; *  code rather than unrolled case&n;&t; *&n;&t; *  Recursive invocations don&squot;t need to erase the cursor over and&n;&t; *  over again, so we use fbcon_bmove_rec()&n;&t; */
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
comma
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
)paren
suffix:semicolon
)brace
DECL|function|fbcon_bmove_rec
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
id|u_int
id|b
suffix:semicolon
r_if
c_cond
(paren
id|sy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|dy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|vc
comma
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|ops
op_member_access_from_pointer
id|bmove
c_func
(paren
id|vc
comma
id|info
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|real_y
c_func
(paren
id|p
comma
id|dy
)paren
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|updatescrollmode
r_static
id|__inline__
r_void
id|updatescrollmode
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_int
id|fh
op_assign
id|vc-&gt;vc_font.height
suffix:semicolon
r_int
id|cap
op_assign
id|info-&gt;flags
suffix:semicolon
r_int
id|good_pan
op_assign
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_YPAN
)paren
op_logical_and
id|divides
c_func
(paren
id|info-&gt;fix.ypanstep
comma
id|vc-&gt;vc_font.height
)paren
op_logical_and
id|info-&gt;var.yres_virtual
OG
id|info-&gt;var.yres
suffix:semicolon
r_int
id|good_wrap
op_assign
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_YWRAP
)paren
op_logical_and
id|divides
c_func
(paren
id|info-&gt;fix.ywrapstep
comma
id|vc-&gt;vc_font.height
)paren
op_logical_and
id|divides
c_func
(paren
id|vc-&gt;vc_font.height
comma
id|info-&gt;var.yres_virtual
)paren
suffix:semicolon
r_int
id|reading_fast
op_assign
id|cap
op_amp
id|FBINFO_READS_FAST
suffix:semicolon
r_int
id|fast_copyarea
op_assign
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_COPYAREA
)paren
op_logical_and
op_logical_neg
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
suffix:semicolon
r_int
id|fast_imageblit
op_assign
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_IMAGEBLIT
)paren
op_logical_and
op_logical_neg
(paren
id|cap
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
suffix:semicolon
id|p-&gt;vrows
op_assign
id|info-&gt;var.yres_virtual
op_div
id|fh
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.yres
OG
(paren
id|fh
op_star
(paren
id|vc-&gt;vc_rows
op_plus
l_int|1
)paren
)paren
)paren
id|p-&gt;vrows
op_sub_assign
(paren
id|info-&gt;var.yres
op_minus
(paren
id|fh
op_star
id|vc-&gt;vc_rows
)paren
)paren
op_div
id|fh
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;var.yres
op_mod
id|fh
)paren
op_logical_and
(paren
id|info-&gt;var.yres_virtual
op_mod
id|fh
OL
id|info-&gt;var.yres
op_mod
id|fh
)paren
)paren
id|p-&gt;vrows
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|good_wrap
op_logical_or
id|good_pan
)paren
(brace
r_if
c_cond
(paren
id|reading_fast
op_logical_or
id|fast_copyarea
)paren
id|p-&gt;scrollmode
op_assign
id|good_wrap
ques
c_cond
id|SCROLL_WRAP_MOVE
suffix:colon
id|SCROLL_PAN_MOVE
suffix:semicolon
r_else
id|p-&gt;scrollmode
op_assign
id|good_wrap
ques
c_cond
id|SCROLL_REDRAW
suffix:colon
id|SCROLL_PAN_REDRAW
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reading_fast
op_logical_or
(paren
id|fast_copyarea
op_logical_and
op_logical_neg
id|fast_imageblit
)paren
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_MOVE
suffix:semicolon
r_else
id|p-&gt;scrollmode
op_assign
id|SCROLL_REDRAW
suffix:semicolon
)brace
)brace
DECL|function|fbcon_resize
r_static
r_int
id|fbcon_resize
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
r_int
id|width
comma
r_int
r_int
id|height
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
op_assign
id|info-&gt;var
suffix:semicolon
r_int
id|x_diff
comma
id|y_diff
suffix:semicolon
r_int
id|fw
op_assign
id|vc-&gt;vc_font.width
suffix:semicolon
r_int
id|fh
op_assign
id|vc-&gt;vc_font.height
suffix:semicolon
id|var.xres
op_assign
id|width
op_star
id|fw
suffix:semicolon
id|var.yres
op_assign
id|height
op_star
id|fh
suffix:semicolon
id|x_diff
op_assign
id|info-&gt;var.xres
op_minus
id|var.xres
suffix:semicolon
id|y_diff
op_assign
id|info-&gt;var.yres
op_minus
id|var.yres
suffix:semicolon
r_if
c_cond
(paren
id|x_diff
template_param
id|fw
op_logical_or
(paren
id|y_diff
template_param
id|fh
)paren
)paren
(brace
r_struct
id|fb_videomode
op_star
id|mode
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;attempting resize %ix%i&bslash;n&quot;
comma
id|var.xres
comma
id|var.yres
)paren
suffix:semicolon
id|mode
op_assign
id|fb_find_best_mode
c_func
(paren
op_amp
id|var
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fb_videomode_to_var
c_func
(paren
op_amp
id|var
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
id|var.xres
op_div
id|fw
op_logical_or
id|height
OG
id|var.yres
op_div
id|fh
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The following can probably have any value... Do we need to&n;&t;&t; * set all of them?&n;&t;&t; */
id|var.bits_per_pixel
op_assign
id|p-&gt;bits_per_pixel
suffix:semicolon
id|var.xres_virtual
op_assign
id|p-&gt;xres_virtual
suffix:semicolon
id|var.yres_virtual
op_assign
id|p-&gt;yres_virtual
suffix:semicolon
id|var.accel_flags
op_assign
id|p-&gt;accel_flags
suffix:semicolon
id|var.width
op_assign
id|p-&gt;width
suffix:semicolon
id|var.height
op_assign
id|p-&gt;height
suffix:semicolon
id|var.red
op_assign
id|p-&gt;red
suffix:semicolon
id|var.green
op_assign
id|p-&gt;green
suffix:semicolon
id|var.blue
op_assign
id|p-&gt;blue
suffix:semicolon
id|var.transp
op_assign
id|p-&gt;transp
suffix:semicolon
id|var.nonstd
op_assign
id|p-&gt;nonstd
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;resize now %ix%i&bslash;n&quot;
comma
id|var.xres
comma
id|var.yres
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
)paren
(brace
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
op_or
id|FB_ACTIVATE_FORCE
suffix:semicolon
id|fb_set_var
c_func
(paren
id|info
comma
op_amp
id|var
)paren
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_MODESWITCH
suffix:semicolon
)brace
id|var_to_display
c_func
(paren
id|p
comma
op_amp
id|info-&gt;var
comma
id|info
)paren
suffix:semicolon
)brace
id|updatescrollmode
c_func
(paren
id|p
comma
id|info
comma
id|vc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_switch
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|var
suffix:semicolon
r_int
id|i
comma
id|prev_console
comma
id|do_set_par
op_assign
l_int|0
suffix:semicolon
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|vc
)paren
suffix:semicolon
id|softback_top
op_assign
id|softback_curr
op_assign
id|softback_in
op_assign
id|softback_buf
suffix:semicolon
id|softback_lines
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;&t;&t;&t;   the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
(brace
r_struct
id|vc_data
op_star
id|conp2
op_assign
id|vc_cons
(braket
id|logo_shown
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|conp2-&gt;vc_top
op_eq
id|logo_lines
op_logical_and
id|conp2-&gt;vc_bottom
op_eq
id|conp2-&gt;vc_rows
)paren
id|conp2-&gt;vc_top
op_assign
l_int|0
suffix:semicolon
id|logo_shown
op_assign
id|FBCON_LOGO_CANSHOW
suffix:semicolon
)brace
id|prev_console
op_assign
(paren
(paren
r_struct
id|fbcon_ops
op_star
)paren
id|info-&gt;fbcon_par
)paren
op_member_access_from_pointer
id|currcon
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME: If we have multiple fbdev&squot;s loaded, we need to&n;&t; * update all info-&gt;currcon.  Perhaps, we can place this&n;&t; * in a centralized structure, but this might break some&n;&t; * drivers.&n;&t; *&n;&t; * info-&gt;currcon = vc-&gt;vc_num;&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|registered_fb
(braket
id|i
)braket
op_ne
l_int|NULL
op_logical_and
id|registered_fb
(braket
id|i
)braket
op_member_access_from_pointer
id|fbcon_par
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|registered_fb
(braket
id|i
)braket
op_member_access_from_pointer
id|fbcon_par
suffix:semicolon
id|ops-&gt;currcon
op_assign
id|vc-&gt;vc_num
suffix:semicolon
)brace
)brace
id|memset
c_func
(paren
op_amp
id|var
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_var_screeninfo
)paren
)paren
suffix:semicolon
id|display_to_var
c_func
(paren
op_amp
id|var
comma
id|p
)paren
suffix:semicolon
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
suffix:semicolon
multiline_comment|/*&n;&t; * make sure we don&squot;t unnecessarily trip the memcmp()&n;&t; * in fb_set_var()&n;&t; */
id|info-&gt;var.activate
op_assign
id|var.activate
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|info-&gt;var.xoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
id|fb_set_var
c_func
(paren
id|info
comma
op_amp
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_console
op_ne
op_minus
l_int|1
op_logical_and
id|registered_fb
(braket
id|con2fb_map
(braket
id|prev_console
)braket
)braket
op_ne
id|info
)paren
id|do_set_par
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|do_set_par
op_logical_or
id|info-&gt;flags
op_amp
id|FBINFO_MISC_MODESWITCH
)paren
(brace
r_if
c_cond
(paren
id|info-&gt;fbops-&gt;fb_set_par
)paren
id|info-&gt;fbops
op_member_access_from_pointer
id|fb_set_par
c_func
(paren
id|info
)paren
suffix:semicolon
id|info-&gt;flags
op_and_assign
op_complement
id|FBINFO_MISC_MODESWITCH
suffix:semicolon
)brace
id|set_blitting_type
c_func
(paren
id|vc
comma
id|info
comma
id|p
)paren
suffix:semicolon
(paren
(paren
r_struct
id|fbcon_ops
op_star
)paren
id|info-&gt;fbcon_par
)paren
op_member_access_from_pointer
id|cursor_reset
op_assign
l_int|1
suffix:semicolon
id|vc-&gt;vc_can_do_color
op_assign
(paren
id|fb_get_color_depth
c_func
(paren
id|info
)paren
op_ne
l_int|1
)paren
suffix:semicolon
id|vc-&gt;vc_complement_mask
op_assign
id|vc-&gt;vc_can_do_color
ques
c_cond
l_int|0x7700
suffix:colon
l_int|0x0800
suffix:semicolon
id|updatescrollmode
c_func
(paren
id|p
comma
id|info
comma
id|vc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_WRAP_MOVE
suffix:colon
id|scrollback_phys_max
op_assign
id|p-&gt;vrows
op_minus
id|vc-&gt;vc_rows
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_MOVE
suffix:colon
r_case
id|SCROLL_PAN_REDRAW
suffix:colon
id|scrollback_phys_max
op_assign
id|p-&gt;vrows
op_minus
l_int|2
op_star
id|vc-&gt;vc_rows
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_phys_max
OL
l_int|0
)paren
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|scrollback_phys_max
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_set_palette
c_func
(paren
id|vc
comma
id|color_table
)paren
suffix:semicolon
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_eq
id|FBCON_LOGO_DRAW
)paren
(brace
id|logo_shown
op_assign
id|fg_console
suffix:semicolon
multiline_comment|/* This is protected above by initmem_freed */
id|fb_show_logo
c_func
(paren
id|info
)paren
suffix:semicolon
id|update_region
c_func
(paren
id|fg_console
comma
id|vc-&gt;vc_origin
op_plus
id|vc-&gt;vc_size_row
op_star
id|vc-&gt;vc_top
comma
id|vc-&gt;vc_size_row
op_star
(paren
id|vc-&gt;vc_bottom
op_minus
id|vc-&gt;vc_top
)paren
op_div
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|fbcon_generic_blank
r_static
r_void
id|fbcon_generic_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|blank
)paren
(brace
r_if
c_cond
(paren
id|blank
)paren
(brace
r_int
r_int
id|charmask
op_assign
id|vc-&gt;vc_hi_font_mask
ques
c_cond
l_int|0x1ff
suffix:colon
l_int|0xff
suffix:semicolon
r_int
r_int
id|oldc
suffix:semicolon
id|oldc
op_assign
id|vc-&gt;vc_video_erase_char
suffix:semicolon
id|vc-&gt;vc_video_erase_char
op_and_assign
id|charmask
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|vc
comma
l_int|0
comma
l_int|0
comma
id|vc-&gt;vc_rows
comma
id|vc-&gt;vc_cols
)paren
suffix:semicolon
id|vc-&gt;vc_video_erase_char
op_assign
id|oldc
suffix:semicolon
)brace
)brace
DECL|function|fbcon_blank
r_static
r_int
id|fbcon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|blank
comma
r_int
id|mode_switch
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_int
id|active
op_assign
op_logical_neg
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode_switch
)paren
(brace
r_struct
id|fb_var_screeninfo
id|var
op_assign
id|info-&gt;var
suffix:semicolon
multiline_comment|/*&n; * HACK ALERT: Some hardware will require reinitializion at this stage,&n; *             others will require it to be done as late as possible.&n; *             For now, we differentiate this with the&n; *             FBINFO_MISC_MODESWITCHLATE bitflag.  Worst case will be&n; *             hardware that requires it here and another one later.&n; *             A definitive solution may require fixing X or the VT&n; *             system.&n; */
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_MISC_MODESWITCHLATE
)paren
id|info-&gt;flags
op_or_assign
id|FBINFO_MISC_MODESWITCH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|blank
op_logical_and
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_MISC_MODESWITCHLATE
)paren
)paren
(brace
id|var.activate
op_assign
id|FB_ACTIVATE_NOW
op_or
id|FB_ACTIVATE_FORCE
suffix:semicolon
id|fb_set_var
c_func
(paren
id|info
comma
op_amp
id|var
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|active
)paren
(brace
r_if
c_cond
(paren
id|ops-&gt;blank_state
op_ne
id|blank
)paren
(brace
id|ops-&gt;blank_state
op_assign
id|blank
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|blank
ques
c_cond
id|CM_ERASE
suffix:colon
id|CM_DRAW
)paren
suffix:semicolon
id|ops-&gt;cursor_flash
op_assign
(paren
op_logical_neg
id|blank
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb_blank
c_func
(paren
id|info
comma
id|blank
)paren
)paren
id|fbcon_generic_blank
c_func
(paren
id|vc
comma
id|info
comma
id|blank
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|blank
)paren
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_free_font
r_static
r_void
id|fbcon_free_font
c_func
(paren
r_struct
id|display
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;userfont
op_logical_and
id|p-&gt;fontdata
op_logical_and
(paren
op_decrement
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_eq
l_int|0
)paren
)paren
id|kfree
c_func
(paren
id|p-&gt;fontdata
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p-&gt;fontdata
op_assign
l_int|NULL
suffix:semicolon
id|p-&gt;userfont
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_get_font
r_static
r_int
id|fbcon_get_font
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|console_font
op_star
id|font
)paren
(brace
id|u8
op_star
id|fontdata
op_assign
id|vc-&gt;vc_font.data
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|font-&gt;data
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|font-&gt;width
op_assign
id|vc-&gt;vc_font.width
suffix:semicolon
id|font-&gt;height
op_assign
id|vc-&gt;vc_font.height
suffix:semicolon
id|font-&gt;charcount
op_assign
id|vc-&gt;vc_hi_font_mask
ques
c_cond
l_int|512
suffix:colon
l_int|256
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|font-&gt;data
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|font-&gt;width
op_le
l_int|8
)paren
(brace
id|j
op_assign
id|vc-&gt;vc_font.height
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|font-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|32
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|32
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|font-&gt;width
op_le
l_int|16
)paren
(brace
id|j
op_assign
id|vc-&gt;vc_font.height
op_star
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|font-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|64
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|64
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|font-&gt;width
op_le
l_int|24
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|font-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|vc-&gt;vc_font.height
suffix:semicolon
id|j
op_increment
)paren
(brace
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|data
op_increment
op_assign
id|fontdata
(braket
l_int|2
)braket
suffix:semicolon
id|fontdata
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
l_int|3
op_star
(paren
l_int|32
op_minus
id|j
)paren
)paren
suffix:semicolon
id|data
op_add_assign
l_int|3
op_star
(paren
l_int|32
op_minus
id|j
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|j
op_assign
id|vc-&gt;vc_font.height
op_star
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|font-&gt;charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|fontdata
comma
id|j
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
op_plus
id|j
comma
l_int|0
comma
l_int|128
op_minus
id|j
)paren
suffix:semicolon
id|data
op_add_assign
l_int|128
suffix:semicolon
id|fontdata
op_add_assign
id|j
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_do_set_font
r_static
r_int
id|fbcon_do_set_font
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|w
comma
r_int
id|h
comma
id|u8
op_star
id|data
comma
r_int
id|userfont
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
r_int
id|resize
suffix:semicolon
r_int
id|cnt
suffix:semicolon
r_char
op_star
id|old_data
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_and
id|softback_lines
)paren
id|fbcon_set_origin
c_func
(paren
id|vc
)paren
suffix:semicolon
id|resize
op_assign
(paren
id|w
op_ne
id|vc-&gt;vc_font.width
)paren
op_logical_or
(paren
id|h
op_ne
id|vc-&gt;vc_font.height
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|old_data
op_assign
id|vc-&gt;vc_font.data
suffix:semicolon
r_if
c_cond
(paren
id|userfont
)paren
id|cnt
op_assign
id|FNTCHARCNT
c_func
(paren
id|data
)paren
suffix:semicolon
r_else
id|cnt
op_assign
l_int|256
suffix:semicolon
id|vc-&gt;vc_font.data
op_assign
id|p-&gt;fontdata
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;userfont
op_assign
id|userfont
)paren
)paren
id|REFCOUNT
c_func
(paren
id|data
)paren
op_increment
suffix:semicolon
id|vc-&gt;vc_font.width
op_assign
id|w
suffix:semicolon
id|vc-&gt;vc_font.height
op_assign
id|h
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_hi_font_mask
op_logical_and
id|cnt
op_eq
l_int|256
)paren
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
(brace
id|vc-&gt;vc_complement_mask
op_rshift_assign
l_int|1
suffix:semicolon
id|vc-&gt;vc_s_complement_mask
op_rshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* ++Edmund: reorder the attribute bits */
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
(brace
r_int
r_int
op_star
id|cp
op_assign
(paren
r_int
r_int
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
r_int
id|count
op_assign
id|vc-&gt;vc_screenbuf_size
op_div
l_int|2
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|cp
op_increment
)paren
(brace
id|c
op_assign
id|scr_readw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|scr_writew
c_func
(paren
(paren
(paren
id|c
op_amp
l_int|0xfe00
)paren
op_rshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
comma
id|cp
)paren
suffix:semicolon
)brace
id|c
op_assign
id|vc-&gt;vc_video_erase_char
suffix:semicolon
id|vc-&gt;vc_video_erase_char
op_assign
(paren
(paren
id|c
op_amp
l_int|0xfe00
)paren
op_rshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vc-&gt;vc_attr
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;vc_hi_font_mask
op_logical_and
id|cnt
op_eq
l_int|512
)paren
(brace
id|vc-&gt;vc_hi_font_mask
op_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
(brace
id|vc-&gt;vc_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
id|vc-&gt;vc_s_complement_mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* ++Edmund: reorder the attribute bits */
(brace
r_int
r_int
op_star
id|cp
op_assign
(paren
r_int
r_int
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
r_int
id|count
op_assign
id|vc-&gt;vc_screenbuf_size
op_div
l_int|2
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
OG
l_int|0
suffix:semicolon
id|count
op_decrement
comma
id|cp
op_increment
)paren
(brace
r_int
r_int
id|newc
suffix:semicolon
id|c
op_assign
id|scr_readw
c_func
(paren
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
id|newc
op_assign
(paren
(paren
id|c
op_amp
l_int|0xff00
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
r_else
id|newc
op_assign
id|c
op_amp
op_complement
l_int|0x100
suffix:semicolon
id|scr_writew
c_func
(paren
id|newc
comma
id|cp
)paren
suffix:semicolon
)brace
id|c
op_assign
id|vc-&gt;vc_video_erase_char
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_can_do_color
)paren
(brace
id|vc-&gt;vc_video_erase_char
op_assign
(paren
(paren
id|c
op_amp
l_int|0xff00
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|c
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vc-&gt;vc_attr
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_else
id|vc-&gt;vc_video_erase_char
op_assign
id|c
op_amp
op_complement
l_int|0x100
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|resize
)paren
(brace
multiline_comment|/* reset wrap/pan */
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
id|vc_resize
c_func
(paren
id|vc-&gt;vc_num
comma
id|info-&gt;var.xres
op_div
id|w
comma
id|info-&gt;var.yres
op_div
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_and
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0 would screw&n;&t;&t;&t;&t;   the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
op_logical_and
id|vt_cons
(braket
id|vc-&gt;vc_num
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
id|fbcon_clear_margins
c_func
(paren
id|vc
comma
l_int|0
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|old_data
op_logical_and
(paren
op_decrement
id|REFCOUNT
c_func
(paren
id|old_data
)paren
op_eq
l_int|0
)paren
)paren
id|kfree
c_func
(paren
id|old_data
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_copy_font
r_static
r_int
id|fbcon_copy_font
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|con
)paren
(brace
r_struct
id|display
op_star
id|od
op_assign
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_struct
id|console_font
op_star
id|f
op_assign
op_amp
id|vc-&gt;vc_font
suffix:semicolon
r_if
c_cond
(paren
id|od-&gt;fontdata
op_eq
id|f-&gt;data
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already the same font... */
r_return
id|fbcon_do_set_font
c_func
(paren
id|vc
comma
id|f-&gt;width
comma
id|f-&gt;height
comma
id|od-&gt;fontdata
comma
id|od-&gt;userfont
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  User asked to set font; we are guaranteed that&n; *&t;a) width and height are in range 1..32&n; *&t;b) charcount does not exceed 512&n; *  but lets not assume that, since someone might someday want to use larger&n; *  fonts. And charcount of 512 is small for unicode support.&n; *&n; *  However, user space gives the font in 32 rows , regardless of&n; *  actual font height. So a new API is needed if support for larger fonts&n; *  is ever implemented.&n; */
DECL|function|fbcon_set_font
r_static
r_int
id|fbcon_set_font
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|console_font
op_star
id|font
comma
r_int
id|flags
)paren
(brace
r_int
id|charcount
op_assign
id|font-&gt;charcount
suffix:semicolon
r_int
id|w
op_assign
id|font-&gt;width
suffix:semicolon
r_int
id|h
op_assign
id|font-&gt;height
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|i
comma
id|csum
suffix:semicolon
id|u8
op_star
id|new_data
comma
op_star
id|data
op_assign
id|font-&gt;data
suffix:semicolon
r_int
id|pitch
op_assign
(paren
id|font-&gt;width
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
multiline_comment|/* Is there a reason why fbconsole couldn&squot;t handle any charcount &gt;256?&n;&t; * If not this check should be changed to charcount &lt; 256 */
r_if
c_cond
(paren
id|charcount
op_ne
l_int|256
op_logical_and
id|charcount
op_ne
l_int|512
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|size
op_assign
id|h
op_star
id|pitch
op_star
id|charcount
suffix:semicolon
id|new_data
op_assign
id|kmalloc
c_func
(paren
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
op_plus
id|size
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_data
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|new_data
op_add_assign
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|FNTSIZE
c_func
(paren
id|new_data
)paren
op_assign
id|size
suffix:semicolon
id|FNTCHARCNT
c_func
(paren
id|new_data
)paren
op_assign
id|charcount
suffix:semicolon
id|REFCOUNT
c_func
(paren
id|new_data
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* usage counter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|charcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|new_data
op_plus
id|i
op_star
id|h
op_star
id|pitch
comma
id|data
op_plus
id|i
op_star
l_int|32
op_star
id|pitch
comma
id|h
op_star
id|pitch
)paren
suffix:semicolon
)brace
multiline_comment|/* Since linux has a nice crc32 function use it for counting font&n;&t; * checksums. */
id|csum
op_assign
id|crc32
c_func
(paren
l_int|0
comma
id|new_data
comma
id|size
)paren
suffix:semicolon
id|FNTSUM
c_func
(paren
id|new_data
)paren
op_assign
id|csum
suffix:semicolon
multiline_comment|/* Check if the same font is on some other console already */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|vc_data
op_star
id|tmp
op_assign
id|vc_cons
(braket
id|i
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|fb_display
(braket
id|i
)braket
dot
id|userfont
op_logical_and
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
op_logical_and
id|FNTSUM
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
)paren
op_eq
id|csum
op_logical_and
id|FNTSIZE
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
)paren
op_eq
id|size
op_logical_and
id|tmp-&gt;vc_font.width
op_eq
id|w
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
comma
id|new_data
comma
id|size
)paren
)paren
(brace
id|kfree
c_func
(paren
id|new_data
op_minus
id|FONT_EXTRA_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|new_data
op_assign
id|fb_display
(braket
id|i
)braket
dot
id|fontdata
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|fbcon_do_set_font
c_func
(paren
id|vc
comma
id|font-&gt;width
comma
id|font-&gt;height
comma
id|new_data
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|fbcon_set_def_font
r_static
r_int
id|fbcon_set_def_font
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_struct
id|console_font
op_star
id|font
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_struct
id|font_desc
op_star
id|f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
id|f
op_assign
id|get_default_font
c_func
(paren
id|info-&gt;var.xres
comma
id|info-&gt;var.yres
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|f
op_assign
id|find_font
c_func
(paren
id|name
)paren
)paren
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|font-&gt;width
op_assign
id|f-&gt;width
suffix:semicolon
id|font-&gt;height
op_assign
id|f-&gt;height
suffix:semicolon
r_return
id|fbcon_do_set_font
c_func
(paren
id|vc
comma
id|f-&gt;width
comma
id|f-&gt;height
comma
id|f-&gt;data
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|palette_red
r_static
id|u16
id|palette_red
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_green
r_static
id|u16
id|palette_green
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_blue
r_static
id|u16
id|palette_blue
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|palette_cmap
r_static
r_struct
id|fb_cmap
id|palette_cmap
op_assign
(brace
l_int|0
comma
l_int|16
comma
id|palette_red
comma
id|palette_green
comma
id|palette_blue
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|fbcon_set_palette
r_static
r_int
id|fbcon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
r_char
op_star
id|table
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|vc-&gt;vc_num
)braket
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
comma
id|depth
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|depth
op_assign
id|fb_get_color_depth
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|depth
OG
l_int|3
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|k
op_assign
id|table
(braket
id|i
)braket
suffix:semicolon
id|val
op_assign
id|vc-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_red
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
id|val
op_assign
id|vc-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_green
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
id|val
op_assign
id|vc-&gt;vc_palette
(braket
id|j
op_increment
)braket
suffix:semicolon
id|palette_blue
(braket
id|k
)braket
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_or
id|val
suffix:semicolon
)brace
id|palette_cmap.len
op_assign
l_int|16
suffix:semicolon
id|palette_cmap.start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * If framebuffer is capable of less than 16 colors,&n;&t; * use default palette of fbcon.&n;&t; */
)brace
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
c_func
(paren
l_int|1
op_lshift
id|depth
)paren
comma
op_amp
id|palette_cmap
)paren
suffix:semicolon
r_return
id|fb_set_cmap
c_func
(paren
op_amp
id|palette_cmap
comma
id|info
)paren
suffix:semicolon
)brace
DECL|function|fbcon_screen_pos
r_static
id|u16
op_star
id|fbcon_screen_pos
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|offset
)paren
(brace
r_int
r_int
id|p
suffix:semicolon
r_int
id|line
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_ne
id|fg_console
op_logical_or
op_logical_neg
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|offset
)paren
suffix:semicolon
id|line
op_assign
id|offset
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|line
op_ge
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|vc-&gt;vc_origin
op_plus
id|offset
op_minus
id|softback_lines
op_star
id|vc-&gt;vc_size_row
)paren
suffix:semicolon
id|p
op_assign
id|softback_curr
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|softback_end
)paren
id|p
op_add_assign
id|softback_buf
op_minus
id|softback_end
suffix:semicolon
r_return
(paren
id|u16
op_star
)paren
id|p
suffix:semicolon
)brace
DECL|function|fbcon_getxy
r_static
r_int
r_int
id|fbcon_getxy
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
r_int
id|pos
comma
r_int
op_star
id|px
comma
r_int
op_star
id|py
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
r_int
id|x
comma
id|y
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|vc-&gt;vc_origin
op_logical_and
id|pos
OL
id|vc-&gt;vc_scr_end
)paren
(brace
r_int
r_int
id|offset
op_assign
(paren
id|pos
op_minus
id|vc-&gt;vc_origin
)paren
op_div
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|vc-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|vc-&gt;vc_cols
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_eq
id|fg_console
)paren
id|y
op_add_assign
id|softback_lines
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|vc-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_eq
id|fg_console
op_logical_and
id|softback_lines
)paren
(brace
r_int
r_int
id|offset
op_assign
id|pos
op_minus
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|softback_curr
)paren
id|offset
op_add_assign
id|softback_end
op_minus
id|softback_buf
suffix:semicolon
id|offset
op_div_assign
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|vc-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|vc-&gt;vc_cols
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|vc-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_end
)paren
id|ret
op_assign
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_in
)paren
id|ret
op_assign
id|vc-&gt;vc_origin
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Should not happen */
id|x
op_assign
id|y
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|vc-&gt;vc_origin
suffix:semicolon
)brace
r_if
c_cond
(paren
id|px
)paren
op_star
id|px
op_assign
id|x
suffix:semicolon
r_if
c_cond
(paren
id|py
)paren
op_star
id|py
op_assign
id|y
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* As we might be inside of softback, we may work with non-contiguous buffer,&n;   that&squot;s why we have to use a separate routine. */
DECL|function|fbcon_invert_region
r_static
r_void
id|fbcon_invert_region
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
id|u16
op_star
id|p
comma
r_int
id|cnt
)paren
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
)paren
(brace
id|u16
id|a
op_assign
id|scr_readw
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;vc_can_do_color
)paren
id|a
op_xor_assign
l_int|0x0800
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vc-&gt;vc_hi_font_mask
op_eq
l_int|0x100
)paren
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x11ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0xe000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0e00
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
r_else
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x7000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0700
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|scr_writew
c_func
(paren
id|a
comma
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
(paren
id|u16
op_star
)paren
id|softback_end
)paren
id|p
op_assign
(paren
id|u16
op_star
)paren
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
(paren
id|u16
op_star
)paren
id|softback_in
)paren
id|p
op_assign
(paren
id|u16
op_star
)paren
id|vc-&gt;vc_origin
suffix:semicolon
)brace
)brace
DECL|function|fbcon_scrolldelta
r_static
r_int
id|fbcon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
comma
r_int
id|lines
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|registered_fb
(braket
id|con2fb_map
(braket
id|fg_console
)braket
)braket
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|fb_display
(braket
id|fg_console
)braket
suffix:semicolon
r_int
id|offset
comma
id|limit
comma
id|scrollback_old
suffix:semicolon
r_if
c_cond
(paren
id|softback_top
)paren
(brace
r_if
c_cond
(paren
id|vc-&gt;vc_num
op_ne
id|fg_console
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|vc-&gt;vc_num
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
op_logical_or
op_logical_neg
id|lines
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_ge
l_int|0
)paren
(brace
r_struct
id|vc_data
op_star
id|conp2
op_assign
id|vc_cons
(braket
id|logo_shown
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|conp2-&gt;vc_top
op_eq
id|logo_lines
op_logical_and
id|conp2-&gt;vc_bottom
op_eq
id|conp2-&gt;vc_rows
)paren
id|conp2-&gt;vc_top
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|logo_shown
op_eq
id|vc-&gt;vc_num
)paren
(brace
r_int
r_int
id|p
comma
id|q
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
id|softback_in
suffix:semicolon
id|q
op_assign
id|vc-&gt;vc_origin
op_plus
id|logo_lines
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|logo_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p
op_eq
id|softback_top
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
id|softback_buf
)paren
id|p
op_assign
id|softback_end
suffix:semicolon
id|p
op_sub_assign
id|vc-&gt;vc_size_row
suffix:semicolon
id|q
op_sub_assign
id|vc-&gt;vc_size_row
suffix:semicolon
id|scr_memcpyw
c_func
(paren
(paren
id|u16
op_star
)paren
id|q
comma
(paren
id|u16
op_star
)paren
id|p
comma
id|vc-&gt;vc_size_row
)paren
suffix:semicolon
)brace
id|softback_in
op_assign
id|p
suffix:semicolon
id|update_region
c_func
(paren
id|vc-&gt;vc_num
comma
id|vc-&gt;vc_origin
comma
id|logo_lines
op_star
id|vc-&gt;vc_cols
)paren
suffix:semicolon
)brace
id|logo_shown
op_assign
id|FBCON_LOGO_CANSHOW
suffix:semicolon
)brace
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_ERASE
op_or
id|CM_SOFTBACK
)paren
suffix:semicolon
id|fbcon_redraw_softback
c_func
(paren
id|vc
comma
id|p
comma
id|lines
)paren
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_DRAW
op_or
id|CM_SOFTBACK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|scrollback_phys_max
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|scrollback_old
op_assign
id|scrollback_current
suffix:semicolon
id|scrollback_current
op_sub_assign
id|lines
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_current
OL
l_int|0
)paren
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scrollback_current
OG
id|scrollback_max
)paren
id|scrollback_current
op_assign
id|scrollback_max
suffix:semicolon
r_if
c_cond
(paren
id|scrollback_current
op_eq
id|scrollback_old
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fbcon_is_inactive
c_func
(paren
id|vc
comma
id|info
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_ERASE
)paren
suffix:semicolon
id|offset
op_assign
id|p-&gt;yscroll
op_minus
id|scrollback_current
suffix:semicolon
id|limit
op_assign
id|p-&gt;vrows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_WRAP_MOVE
suffix:colon
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_PAN_MOVE
suffix:colon
r_case
id|SCROLL_PAN_REDRAW
suffix:colon
id|limit
op_sub_assign
id|vc-&gt;vc_rows
suffix:semicolon
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
OL
l_int|0
)paren
id|offset
op_add_assign
id|limit
suffix:semicolon
r_else
r_if
c_cond
(paren
id|offset
op_ge
id|limit
)paren
id|offset
op_sub_assign
id|limit
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|offset
op_star
id|vc-&gt;vc_font.height
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scrollback_current
)paren
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_DRAW
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_set_origin
r_static
r_int
id|fbcon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
id|vc
)paren
(brace
r_if
c_cond
(paren
id|softback_lines
)paren
id|fbcon_scrolldelta
c_func
(paren
id|vc
comma
id|softback_lines
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_suspended
r_static
r_void
id|fbcon_suspended
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|vc_data
op_star
id|vc
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
op_logical_or
id|ops-&gt;currcon
OL
l_int|0
)paren
r_return
suffix:semicolon
id|vc
op_assign
id|vc_cons
(braket
id|ops-&gt;currcon
)braket
dot
id|d
suffix:semicolon
multiline_comment|/* Clear cursor, restore saved data */
id|fbcon_cursor
c_func
(paren
id|vc
comma
id|CM_ERASE
)paren
suffix:semicolon
)brace
DECL|function|fbcon_resumed
r_static
r_void
id|fbcon_resumed
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|vc_data
op_star
id|vc
suffix:semicolon
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
op_logical_or
id|ops-&gt;currcon
OL
l_int|0
)paren
r_return
suffix:semicolon
id|vc
op_assign
id|vc_cons
(braket
id|ops-&gt;currcon
)braket
dot
id|d
suffix:semicolon
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
)brace
DECL|function|fbcon_modechanged
r_static
r_void
id|fbcon_modechanged
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_struct
id|vc_data
op_star
id|vc
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
r_int
id|rows
comma
id|cols
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
op_logical_or
id|ops-&gt;currcon
OL
l_int|0
op_logical_or
id|vt_cons
(braket
id|ops-&gt;currcon
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
op_logical_or
id|registered_fb
(braket
id|con2fb_map
(braket
id|ops-&gt;currcon
)braket
)braket
op_ne
id|info
)paren
r_return
suffix:semicolon
id|vc
op_assign
id|vc_cons
(braket
id|ops-&gt;currcon
)braket
dot
id|d
suffix:semicolon
id|p
op_assign
op_amp
id|fb_display
(braket
id|vc-&gt;vc_num
)braket
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|info-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
)paren
(brace
id|var_to_display
c_func
(paren
id|p
comma
op_amp
id|info-&gt;var
comma
id|info
)paren
suffix:semicolon
id|cols
op_assign
id|info-&gt;var.xres
op_div
id|vc-&gt;vc_font.width
suffix:semicolon
id|rows
op_assign
id|info-&gt;var.yres
op_div
id|vc-&gt;vc_font.height
suffix:semicolon
id|vc_resize
c_func
(paren
id|vc-&gt;vc_num
comma
id|cols
comma
id|rows
)paren
suffix:semicolon
id|updatescrollmode
c_func
(paren
id|p
comma
id|info
comma
id|vc
)paren
suffix:semicolon
id|scrollback_max
op_assign
l_int|0
suffix:semicolon
id|scrollback_current
op_assign
l_int|0
suffix:semicolon
id|update_var
c_func
(paren
id|vc-&gt;vc_num
comma
id|info
)paren
suffix:semicolon
id|fbcon_set_palette
c_func
(paren
id|vc
comma
id|color_table
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|vc-&gt;vc_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|softback_buf
)paren
(brace
r_int
id|l
op_assign
id|fbcon_softback_size
op_div
id|vc-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|5
)paren
id|softback_end
op_assign
id|softback_buf
op_plus
id|l
op_star
id|vc-&gt;vc_size_row
suffix:semicolon
r_else
(brace
multiline_comment|/* Smaller scrollback makes no sense, and 0&n;&t;&t;&t;&t;   would screw the operation totally */
id|softback_top
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|fbcon_mode_deleted
r_static
r_int
id|fbcon_mode_deleted
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_videomode
op_star
id|mode
)paren
(brace
r_struct
id|fb_info
op_star
id|fb_info
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|found
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* before deletion, ensure that mode is not in use */
r_for
c_loop
(paren
id|i
op_assign
id|first_fb_vc
suffix:semicolon
id|i
op_le
id|last_fb_vc
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
id|con2fb_map
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
op_minus
l_int|1
)paren
r_continue
suffix:semicolon
id|fb_info
op_assign
id|registered_fb
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fb_info
op_ne
id|info
)paren
r_continue
suffix:semicolon
id|p
op_assign
op_amp
id|fb_display
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
id|p-&gt;mode
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fb_mode_is_equal
c_func
(paren
id|p-&gt;mode
comma
id|mode
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|fbcon_fb_registered
r_static
r_int
id|fbcon_fb_registered
c_func
(paren
r_int
id|idx
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|info_idx
op_eq
op_minus
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|con2fb_map_boot
(braket
id|i
)braket
op_eq
id|idx
)paren
(brace
id|info_idx
op_assign
id|idx
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|info_idx
op_ne
op_minus
l_int|1
)paren
id|ret
op_assign
id|fbcon_takeover
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|con2fb_map_boot
(braket
id|i
)braket
op_eq
id|idx
)paren
id|set_con2fb_map
c_func
(paren
id|i
comma
id|idx
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|fbcon_fb_blanked
r_static
r_void
id|fbcon_fb_blanked
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|blank
)paren
(brace
r_struct
id|fbcon_ops
op_star
id|ops
op_assign
id|info-&gt;fbcon_par
suffix:semicolon
r_int
id|valid
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
op_logical_or
id|ops-&gt;currcon
OL
l_int|0
op_logical_or
id|vt_cons
(braket
id|ops-&gt;currcon
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
op_logical_or
id|registered_fb
(braket
id|con2fb_map
(braket
id|ops-&gt;currcon
)braket
)braket
op_ne
id|info
)paren
id|valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|valid
)paren
(brace
r_struct
id|vc_data
op_star
id|vc
suffix:semicolon
id|vc
op_assign
id|vc_cons
(braket
id|ops-&gt;currcon
)braket
dot
id|d
suffix:semicolon
r_if
c_cond
(paren
id|CON_IS_VISIBLE
c_func
(paren
id|vc
)paren
)paren
(brace
r_if
c_cond
(paren
id|blank
)paren
id|do_blank_screen
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|do_unblank_screen
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|ops-&gt;blank_state
op_assign
id|blank
suffix:semicolon
)brace
)brace
DECL|function|fbcon_event_notify
r_static
r_int
id|fbcon_event_notify
c_func
(paren
r_struct
id|notifier_block
op_star
id|self
comma
r_int
r_int
id|action
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|fb_event
op_star
id|event
op_assign
id|data
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
op_assign
id|event-&gt;info
suffix:semicolon
r_struct
id|fb_videomode
op_star
id|mode
suffix:semicolon
r_struct
id|fb_con2fbmap
op_star
id|con2fb
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|action
)paren
(brace
r_case
id|FB_EVENT_SUSPEND
suffix:colon
id|fbcon_suspended
c_func
(paren
id|info
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_RESUME
suffix:colon
id|fbcon_resumed
c_func
(paren
id|info
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_MODE_CHANGE
suffix:colon
id|fbcon_modechanged
c_func
(paren
id|info
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_MODE_DELETE
suffix:colon
id|mode
op_assign
id|event-&gt;data
suffix:semicolon
id|ret
op_assign
id|fbcon_mode_deleted
c_func
(paren
id|info
comma
id|mode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_FB_REGISTERED
suffix:colon
id|ret
op_assign
id|fbcon_fb_registered
c_func
(paren
id|info-&gt;node
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_SET_CONSOLE_MAP
suffix:colon
id|con2fb
op_assign
id|event-&gt;data
suffix:semicolon
id|ret
op_assign
id|set_con2fb_map
c_func
(paren
id|con2fb-&gt;console
op_minus
l_int|1
comma
id|con2fb-&gt;framebuffer
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_GET_CONSOLE_MAP
suffix:colon
id|con2fb
op_assign
id|event-&gt;data
suffix:semicolon
id|con2fb-&gt;framebuffer
op_assign
id|con2fb_map
(braket
id|con2fb-&gt;console
op_minus
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FB_EVENT_BLANK
suffix:colon
id|fbcon_fb_blanked
c_func
(paren
id|info
comma
op_star
(paren
r_int
op_star
)paren
id|event-&gt;data
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; *  The console `switch&squot; structure for the frame buffer based console&n; */
DECL|variable|fb_con
r_const
r_struct
id|consw
id|fb_con
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|con_startup
op_assign
id|fbcon_startup
comma
dot
id|con_init
op_assign
id|fbcon_init
comma
dot
id|con_deinit
op_assign
id|fbcon_deinit
comma
dot
id|con_clear
op_assign
id|fbcon_clear
comma
dot
id|con_putc
op_assign
id|fbcon_putc
comma
dot
id|con_putcs
op_assign
id|fbcon_putcs
comma
dot
id|con_cursor
op_assign
id|fbcon_cursor
comma
dot
id|con_scroll
op_assign
id|fbcon_scroll
comma
dot
id|con_bmove
op_assign
id|fbcon_bmove
comma
dot
id|con_switch
op_assign
id|fbcon_switch
comma
dot
id|con_blank
op_assign
id|fbcon_blank
comma
dot
id|con_font_set
op_assign
id|fbcon_set_font
comma
dot
id|con_font_get
op_assign
id|fbcon_get_font
comma
dot
id|con_font_default
op_assign
id|fbcon_set_def_font
comma
dot
id|con_font_copy
op_assign
id|fbcon_copy_font
comma
dot
id|con_set_palette
op_assign
id|fbcon_set_palette
comma
dot
id|con_scrolldelta
op_assign
id|fbcon_scrolldelta
comma
dot
id|con_set_origin
op_assign
id|fbcon_set_origin
comma
dot
id|con_invert_region
op_assign
id|fbcon_invert_region
comma
dot
id|con_screen_pos
op_assign
id|fbcon_screen_pos
comma
dot
id|con_getxy
op_assign
id|fbcon_getxy
comma
dot
id|con_resize
op_assign
id|fbcon_resize
comma
)brace
suffix:semicolon
DECL|variable|fbcon_event_notifier
r_static
r_struct
id|notifier_block
id|fbcon_event_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|fbcon_event_notify
comma
)brace
suffix:semicolon
DECL|function|fb_console_init
r_int
id|__init
id|fb_console_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|fb_register_client
c_func
(paren
op_amp
id|fbcon_event_notifier
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_CONSOLES
suffix:semicolon
id|i
op_increment
)paren
id|con2fb_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|num_registered_fb
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FB_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|registered_fb
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|info_idx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|fbcon_takeover
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fb_console_init
id|module_init
c_func
(paren
id|fb_console_init
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|function|fb_console_exit
r_void
id|__exit
id|fb_console_exit
c_func
(paren
r_void
)paren
(brace
id|acquire_console_sem
c_func
(paren
)paren
suffix:semicolon
id|fb_unregister_client
c_func
(paren
op_amp
id|fbcon_event_notifier
)paren
suffix:semicolon
id|release_console_sem
c_func
(paren
)paren
suffix:semicolon
id|give_up_console
c_func
(paren
op_amp
id|fb_con
)paren
suffix:semicolon
)brace
DECL|variable|fb_console_exit
id|module_exit
c_func
(paren
id|fb_console_exit
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *  Visible symbols for modules&n; */
DECL|variable|fb_con
id|EXPORT_SYMBOL
c_func
(paren
id|fb_con
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
