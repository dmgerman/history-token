multiline_comment|/*&n; *  linux/drivers/video/console/sticon.c - console driver using HP&squot;s STI firmware&n; *&n; *&t;Copyright (C) 2000 Philipp Rumpf &lt;prumpf@tux.org&gt;&n; *&t;Copyright (C) 2002 Helge Deller &lt;deller@gmx.de&gt;&n; *&n; *  Based on linux/drivers/video/vgacon.c and linux/drivers/video/fbcon.c,&n; *  which were&n; *&n; *&t;Created 28 Sep 1997 by Geert Uytterhoeven&n; *&t;Rewritten by Martin Mares &lt;mj@ucw.cz&gt;, July 1998&n; *&t;Copyright (C) 1991, 1992  Linus Torvalds&n; *&t;&t;&t;    1995  Jay Estabrook&n; *&t;Copyright (C) 1995 Geert Uytterhoeven&n; *&t;Copyright (C) 1993 Bjoern Brauel&n; *&t;&t;&t;   Roman Hodek&n; *&t;Copyright (C) 1993 Hamish Macdonald&n; *&t;&t;&t;   Greg Harp&n; *&t;Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *&t;      with work by William Rucklidge (wjr@cs.cornell.edu)&n; *&t;&t;&t;   Geert Uytterhoeven&n; *&t;&t;&t;   Jes Sorensen (jds@kom.auc.dk)&n; *&t;&t;&t;   Martin Apel&n; *&t;      with work by Guenther Kelleter&n; *&t;&t;&t;   Martin Schaller&n; *&t;&t;&t;   Andreas Schwab&n; *&t;&t;&t;   Emmanuel Marty (core@ggi-project.org)&n; *&t;&t;&t;   Jakub Jelinek (jj@ultra.linux.cz)&n; *&t;&t;&t;   Martin Mares &lt;mj@ucw.cz&gt;&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;../sticore.h&quot;
multiline_comment|/* switching to graphics mode */
DECL|macro|BLANK
mdefine_line|#define BLANK 0
DECL|variable|vga_is_gfx
r_static
r_int
id|vga_is_gfx
suffix:semicolon
multiline_comment|/* Software scrollback */
DECL|variable|softback_buf
DECL|variable|softback_curr
r_static
r_int
r_int
id|softback_buf
comma
id|softback_curr
suffix:semicolon
DECL|variable|softback_in
r_static
r_int
r_int
id|softback_in
suffix:semicolon
DECL|variable|softback_end
r_static
r_int
r_int
multiline_comment|/* softback_top, */
id|softback_end
suffix:semicolon
DECL|variable|softback_lines
r_static
r_int
id|softback_lines
suffix:semicolon
multiline_comment|/* software cursor */
DECL|variable|cursor_drawn
r_static
r_int
id|cursor_drawn
suffix:semicolon
DECL|macro|CURSOR_DRAW_DELAY
mdefine_line|#define CURSOR_DRAW_DELAY&t;&t;(1)
DECL|macro|DEFAULT_CURSOR_BLINK_RATE
mdefine_line|#define DEFAULT_CURSOR_BLINK_RATE&t;(20)
DECL|variable|vbl_cursor_cnt
r_static
r_int
id|vbl_cursor_cnt
suffix:semicolon
DECL|function|cursor_undrawn
r_static
r_inline
r_void
id|cursor_undrawn
c_func
(paren
r_void
)paren
(brace
id|vbl_cursor_cnt
op_assign
l_int|0
suffix:semicolon
id|cursor_drawn
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_startup
r_static
r_const
r_char
op_star
id|__init
id|sticon_startup
c_func
(paren
r_void
)paren
(brace
r_return
l_string|&quot;STI console&quot;
suffix:semicolon
)brace
DECL|function|sticon_set_palette
r_static
r_int
id|sticon_set_palette
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
r_char
op_star
id|table
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|sticon_font_op
r_static
r_int
id|sticon_font_op
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_struct
id|console_font_op
op_star
id|op
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sticon_putc
r_static
r_void
id|sticon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_int
id|redraw_cursor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vga_is_gfx
op_logical_or
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_return
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_x
op_eq
id|xpos
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
op_eq
id|ypos
)paren
)paren
(brace
id|cursor_undrawn
c_func
(paren
)paren
suffix:semicolon
id|redraw_cursor
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|sti_putc
c_func
(paren
id|default_sti
comma
id|c
comma
id|ypos
comma
id|xpos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|redraw_cursor
)paren
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|function|sticon_putcs
r_static
r_void
id|sticon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_int
r_int
op_star
id|s
comma
r_int
id|count
comma
r_int
id|ypos
comma
r_int
id|xpos
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_int
id|redraw_cursor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vga_is_gfx
op_logical_or
id|console_blanked
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_ne
id|KD_TEXT
)paren
r_return
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_y
op_eq
id|ypos
)paren
op_logical_and
(paren
id|xpos
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
(paren
id|xpos
op_plus
id|count
)paren
)paren
)paren
(brace
id|cursor_undrawn
c_func
(paren
)paren
suffix:semicolon
id|redraw_cursor
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|sti_putc
c_func
(paren
id|default_sti
comma
id|scr_readw
c_func
(paren
id|s
op_increment
)paren
comma
id|ypos
comma
id|xpos
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|redraw_cursor
)paren
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
)brace
DECL|function|sticon_cursor
r_static
r_void
id|sticon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
(brace
r_int
r_int
id|car1
suffix:semicolon
id|car1
op_assign
id|conp-&gt;vc_screenbuf
(braket
id|conp-&gt;vc_x
op_plus
id|conp-&gt;vc_y
op_star
id|conp-&gt;vc_cols
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|sti_putc
c_func
(paren
id|default_sti
comma
id|car1
comma
id|conp-&gt;vc_y
comma
id|conp-&gt;vc_x
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_MOVE
suffix:colon
r_case
id|CM_DRAW
suffix:colon
r_switch
c_cond
(paren
id|conp-&gt;vc_cursor_type
op_amp
l_int|0x0f
)paren
(brace
r_case
id|CUR_UNDERLINE
suffix:colon
r_case
id|CUR_LOWER_THIRD
suffix:colon
r_case
id|CUR_LOWER_HALF
suffix:colon
r_case
id|CUR_TWO_THIRDS
suffix:colon
r_case
id|CUR_BLOCK
suffix:colon
id|sti_putc
c_func
(paren
id|default_sti
comma
(paren
id|car1
op_amp
l_int|255
)paren
op_plus
(paren
l_int|0
op_lshift
l_int|8
)paren
op_plus
(paren
l_int|7
op_lshift
l_int|11
)paren
comma
id|conp-&gt;vc_y
comma
id|conp-&gt;vc_x
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sticon_scroll
id|sticon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
op_assign
id|default_sti
suffix:semicolon
r_if
c_cond
(paren
id|vga_is_gfx
)paren
r_return
l_int|0
suffix:semicolon
id|sticon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|SM_UP
suffix:colon
id|sti_bmove
c_func
(paren
id|sti
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|sti_clear
c_func
(paren
id|sti
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
comma
id|conp-&gt;vc_video_erase_char
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SM_DOWN
suffix:colon
id|sti_bmove
c_func
(paren
id|sti
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|sti_clear
c_func
(paren
id|sti
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
comma
id|conp-&gt;vc_video_erase_char
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sticon_bmove
id|sticon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|width
op_logical_or
op_logical_neg
id|height
)paren
r_return
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
(paren
id|sy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|sy
op_plus
id|height
)paren
op_logical_and
(paren
id|sx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|sx
op_plus
id|width
)paren
)paren
op_logical_or
(paren
(paren
id|dy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|dy
op_plus
id|height
)paren
op_logical_and
(paren
id|dx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|dx
op_plus
id|width
)paren
)paren
)paren
id|sticon_cursor
c_func
(paren
id|p
comma
id|CM_ERASE
multiline_comment|/*|CM_SOFTBACK*/
)paren
suffix:semicolon
macro_line|#endif
id|sti_bmove
c_func
(paren
id|default_sti
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|sticon_init
r_static
r_void
id|sticon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
id|init
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
op_assign
id|default_sti
suffix:semicolon
r_int
id|vc_cols
comma
id|vc_rows
suffix:semicolon
id|sti_set
c_func
(paren
id|sti
comma
l_int|0
comma
l_int|0
comma
id|sti_onscreen_y
c_func
(paren
id|sti
)paren
comma
id|sti_onscreen_x
c_func
(paren
id|sti
)paren
comma
l_int|0
)paren
suffix:semicolon
id|vc_cols
op_assign
id|sti_onscreen_x
c_func
(paren
id|sti
)paren
op_div
id|sti-&gt;font_width
suffix:semicolon
id|vc_rows
op_assign
id|sti_onscreen_y
c_func
(paren
id|sti
)paren
op_div
id|sti-&gt;font_height
suffix:semicolon
id|c-&gt;vc_can_do_color
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|init
)paren
(brace
id|c-&gt;vc_cols
op_assign
id|vc_cols
suffix:semicolon
id|c-&gt;vc_rows
op_assign
id|vc_rows
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* vc_rows = (c-&gt;vc_rows &gt; vc_rows) ? vc_rows : c-&gt;vc_rows; */
multiline_comment|/* vc_cols = (c-&gt;vc_cols &gt; vc_cols) ? vc_cols : c-&gt;vc_cols; */
id|vc_resize
c_func
(paren
id|c-&gt;vc_num
comma
id|vc_cols
comma
id|vc_rows
)paren
suffix:semicolon
multiline_comment|/*&t;vc_resize_con(vc_rows, vc_cols, c-&gt;vc_num); */
)brace
)brace
DECL|function|sticon_deinit
r_static
r_void
id|sticon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|c
)paren
(brace
)brace
DECL|function|sticon_clear
r_static
r_void
id|sticon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|height
op_logical_or
op_logical_neg
id|width
)paren
r_return
suffix:semicolon
id|sti_clear
c_func
(paren
id|default_sti
comma
id|sy
comma
id|sx
comma
id|height
comma
id|width
comma
id|conp-&gt;vc_video_erase_char
)paren
suffix:semicolon
)brace
DECL|function|sticon_switch
r_static
r_int
id|sticon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_return
l_int|1
suffix:semicolon
multiline_comment|/* needs refreshing */
)brace
DECL|function|sticon_set_origin
r_static
r_int
id|sticon_set_origin
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_blank
r_static
r_int
id|sticon_blank
c_func
(paren
r_struct
id|vc_data
op_star
id|c
comma
r_int
id|blank
)paren
(brace
r_switch
c_cond
(paren
id|blank
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* unblank */
id|vga_is_gfx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Tell console.c that it has to restore the screen itself */
r_return
l_int|1
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* normal blanking */
r_default
suffix:colon
(brace
)brace
multiline_comment|/* VESA blanking */
r_if
c_cond
(paren
id|vga_is_gfx
)paren
r_return
l_int|0
suffix:semicolon
id|sticon_set_origin
c_func
(paren
id|c
)paren
suffix:semicolon
id|sti_clear
c_func
(paren
id|default_sti
comma
l_int|0
comma
l_int|0
comma
id|c-&gt;vc_rows
comma
id|c-&gt;vc_cols
comma
id|BLANK
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
op_minus
l_int|1
suffix:colon
multiline_comment|/* Entering graphic mode */
id|sti_clear
c_func
(paren
id|default_sti
comma
l_int|0
comma
l_int|0
comma
id|c-&gt;vc_rows
comma
id|c-&gt;vc_cols
comma
id|BLANK
)paren
suffix:semicolon
id|vga_is_gfx
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
multiline_comment|/* console needs to restore screen itself */
)brace
DECL|function|sticon_scrolldelta
r_static
r_int
id|sticon_scrolldelta
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|lines
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticon_screen_pos
r_static
id|u16
op_star
id|sticon_screen_pos
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|offset
)paren
(brace
r_int
id|line
suffix:semicolon
r_int
r_int
id|p
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_ne
id|fg_console
op_logical_or
op_logical_neg
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|offset
)paren
suffix:semicolon
id|line
op_assign
id|offset
op_div
id|conp-&gt;vc_size_row
suffix:semicolon
r_if
c_cond
(paren
id|line
op_ge
id|softback_lines
)paren
r_return
(paren
id|u16
op_star
)paren
(paren
id|conp-&gt;vc_origin
op_plus
id|offset
op_minus
id|softback_lines
op_star
id|conp-&gt;vc_size_row
)paren
suffix:semicolon
id|p
op_assign
id|softback_curr
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|softback_end
)paren
id|p
op_add_assign
id|softback_buf
op_minus
id|softback_end
suffix:semicolon
r_return
(paren
id|u16
op_star
)paren
id|p
suffix:semicolon
)brace
DECL|function|sticon_getxy
r_static
r_int
r_int
id|sticon_getxy
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
r_int
id|pos
comma
r_int
op_star
id|px
comma
r_int
op_star
id|py
)paren
(brace
r_int
id|x
comma
id|y
suffix:semicolon
r_int
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|conp-&gt;vc_origin
op_logical_and
id|pos
OL
id|conp-&gt;vc_scr_end
)paren
(brace
r_int
r_int
id|offset
op_assign
(paren
id|pos
op_minus
id|conp-&gt;vc_origin
)paren
op_div
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|conp-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|conp-&gt;vc_cols
suffix:semicolon
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_eq
id|fg_console
)paren
id|y
op_add_assign
id|softback_lines
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|conp-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|conp-&gt;vc_num
op_eq
id|fg_console
op_logical_and
id|softback_lines
)paren
(brace
r_int
r_int
id|offset
op_assign
id|pos
op_minus
id|softback_curr
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|softback_curr
)paren
id|offset
op_add_assign
id|softback_end
op_minus
id|softback_buf
suffix:semicolon
id|offset
op_div_assign
l_int|2
suffix:semicolon
id|x
op_assign
id|offset
op_mod
id|conp-&gt;vc_cols
suffix:semicolon
id|y
op_assign
id|offset
op_div
id|conp-&gt;vc_cols
suffix:semicolon
id|ret
op_assign
id|pos
op_plus
(paren
id|conp-&gt;vc_cols
op_minus
id|x
)paren
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_end
)paren
id|ret
op_assign
id|softback_buf
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|softback_in
)paren
id|ret
op_assign
id|conp-&gt;vc_origin
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Should not happen */
id|x
op_assign
id|y
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|conp-&gt;vc_origin
suffix:semicolon
)brace
r_if
c_cond
(paren
id|px
)paren
op_star
id|px
op_assign
id|x
suffix:semicolon
r_if
c_cond
(paren
id|py
)paren
op_star
id|py
op_assign
id|y
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sticon_build_attr
r_static
id|u8
id|sticon_build_attr
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
id|u8
id|color
comma
id|u8
id|intens
comma
id|u8
id|blink
comma
id|u8
id|underline
comma
id|u8
id|reverse
)paren
(brace
id|u8
id|attr
op_assign
(paren
(paren
id|color
op_amp
l_int|0x70
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|color
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
(brace
id|color
op_assign
(paren
(paren
id|color
op_rshift
l_int|3
)paren
op_amp
l_int|0x7
)paren
op_or
(paren
(paren
id|color
op_amp
l_int|0x7
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
r_return
id|attr
suffix:semicolon
)brace
DECL|function|sticon_invert_region
r_void
id|sticon_invert_region
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
id|u16
op_star
id|p
comma
r_int
id|count
)paren
(brace
r_int
id|col
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* vga_can_do_color; */
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|u16
id|a
op_assign
id|scr_readw
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|col
)paren
id|a
op_assign
(paren
(paren
id|a
)paren
op_amp
l_int|0x88ff
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x7000
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
(paren
id|a
)paren
op_amp
l_int|0x0700
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
r_else
id|a
op_assign
(paren
(paren
id|a
op_amp
l_int|0x0700
)paren
op_eq
l_int|0x0100
)paren
ques
c_cond
l_int|0x7000
suffix:colon
l_int|0x7700
suffix:semicolon
id|scr_writew
c_func
(paren
id|a
comma
id|p
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|sticon_save_screen
r_void
id|sticon_save_screen
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
)brace
DECL|variable|sti_con
r_struct
id|consw
id|sti_con
op_assign
(brace
id|con_startup
suffix:colon
id|sticon_startup
comma
id|con_init
suffix:colon
id|sticon_init
comma
id|con_deinit
suffix:colon
id|sticon_deinit
comma
id|con_clear
suffix:colon
id|sticon_clear
comma
id|con_putc
suffix:colon
id|sticon_putc
comma
id|con_putcs
suffix:colon
id|sticon_putcs
comma
id|con_cursor
suffix:colon
id|sticon_cursor
comma
id|con_scroll
suffix:colon
id|sticon_scroll
comma
id|con_bmove
suffix:colon
id|sticon_bmove
comma
id|con_switch
suffix:colon
id|sticon_switch
comma
id|con_blank
suffix:colon
id|sticon_blank
comma
id|con_font_op
suffix:colon
id|sticon_font_op
comma
id|con_set_palette
suffix:colon
id|sticon_set_palette
comma
id|con_scrolldelta
suffix:colon
id|sticon_scrolldelta
comma
id|con_set_origin
suffix:colon
id|sticon_set_origin
comma
id|con_save_screen
suffix:colon
id|sticon_save_screen
comma
id|con_build_attr
suffix:colon
id|sticon_build_attr
comma
id|con_invert_region
suffix:colon
id|sticon_invert_region
comma
id|con_screen_pos
suffix:colon
id|sticon_screen_pos
comma
id|con_getxy
suffix:colon
id|sticon_getxy
comma
)brace
suffix:semicolon
DECL|function|sticonsole_init
r_int
id|__init
id|sticonsole_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|sti_init_roms
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|conswitchp
op_eq
op_amp
id|dummy_con
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sticon: Initializing STI text console.&bslash;n&quot;
)paren
suffix:semicolon
id|take_over_console
c_func
(paren
op_amp
id|sti_con
comma
l_int|0
comma
id|MAX_NR_CONSOLES
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|sticonsole_init
id|module_init
c_func
(paren
id|sticonsole_init
)paren
suffix:semicolon
eof
