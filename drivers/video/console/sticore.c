multiline_comment|/*&n; *  linux/drivers/video/console/sticore.c -&n; *&t;core code for console driver using HP&squot;s STI firmware&n; *&n; *&t;Copyright (C) 2000 Philipp Rumpf &lt;prumpf@tux.org&gt;&n; *&t;Copyright (C) 2001-2003 Helge Deller &lt;deller@gmx.de&gt;&n; *&t;Copyright (C) 2001-2002 Thomas Bogendoerfer &lt;tsbogend@alpha.franken.de&gt;&n; * &n; * TODO:&n; * - call STI in virtual mode rather than in real mode&n; * - screen blanking with state_mgmt() in text mode STI ? &n; * - try to make it work on m68k hp workstations ;)&n; * &n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/font.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/parisc-device.h&gt;
macro_line|#include &lt;asm/cacheflush.h&gt;
macro_line|#include &quot;../sticore.h&quot;
DECL|macro|STI_DRIVERVERSION
mdefine_line|#define STI_DRIVERVERSION &quot;Version 0.9a&quot;
DECL|variable|default_sti
r_struct
id|sti_struct
op_star
id|default_sti
suffix:semicolon
DECL|variable|num_sti_roms
r_static
r_int
id|num_sti_roms
suffix:semicolon
multiline_comment|/* # of STI ROMS found */
DECL|variable|sti_roms
r_static
r_struct
id|sti_struct
op_star
id|sti_roms
(braket
id|MAX_STI_ROMS
)braket
suffix:semicolon
multiline_comment|/* ptr to each sti_struct */
multiline_comment|/* The colour indices used by STI are&n; *   0 - Black&n; *   1 - White&n; *   2 - Red&n; *   3 - Yellow/Brown&n; *   4 - Green&n; *   5 - Cyan&n; *   6 - Blue&n; *   7 - Magenta&n; *&n; * So we have the same colours as VGA (basically one bit each for R, G, B),&n; * but have to translate them, anyway. */
DECL|variable|col_trans
r_static
r_const
id|u8
id|col_trans
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|6
comma
l_int|4
comma
l_int|5
comma
l_int|2
comma
l_int|7
comma
l_int|3
comma
l_int|1
)brace
suffix:semicolon
DECL|macro|c_fg
mdefine_line|#define c_fg(sti, c) col_trans[((c&gt;&gt; 8) &amp; 7)]
DECL|macro|c_bg
mdefine_line|#define c_bg(sti, c) col_trans[((c&gt;&gt;11) &amp; 7)]
DECL|macro|c_index
mdefine_line|#define c_index(sti, c) ((c) &amp; 0xff)
DECL|variable|default_init_flags
r_static
r_const
r_struct
id|sti_init_flags
id|default_init_flags
op_assign
(brace
dot
id|wait
op_assign
id|STI_WAIT
comma
dot
id|reset
op_assign
l_int|1
comma
dot
id|text
op_assign
l_int|1
comma
dot
id|nontext
op_assign
l_int|1
comma
dot
id|no_chg_bet
op_assign
l_int|1
comma
dot
id|no_chg_bei
op_assign
l_int|1
comma
dot
id|init_cmap_tx
op_assign
l_int|1
comma
)brace
suffix:semicolon
r_int
DECL|function|sti_init_graph
id|sti_init_graph
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
(brace
r_struct
id|sti_init_inptr_ext
id|inptr_ext
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|sti_init_inptr
id|inptr
op_assign
(brace
dot
id|text_planes
op_assign
l_int|3
comma
multiline_comment|/* # of text planes (max 3 for STI) */
dot
id|ext_ptr
op_assign
id|STI_PTR
c_func
(paren
op_amp
id|inptr_ext
)paren
)brace
suffix:semicolon
r_struct
id|sti_init_outptr
id|outptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;init_graph
comma
op_amp
id|default_init_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;STI init_graph failed (ret %d, errno %d)&bslash;n&quot;
comma
id|ret
comma
id|outptr.errno
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|sti-&gt;text_planes
op_assign
id|outptr.text_planes
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|default_conf_flags
r_static
r_const
r_struct
id|sti_conf_flags
id|default_conf_flags
op_assign
(brace
dot
id|wait
op_assign
id|STI_WAIT
comma
)brace
suffix:semicolon
r_void
DECL|function|sti_inq_conf
id|sti_inq_conf
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
(brace
r_struct
id|sti_conf_inptr
id|inptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|s32
id|ret
suffix:semicolon
id|sti-&gt;outptr.ext_ptr
op_assign
id|STI_PTR
c_func
(paren
op_amp
id|sti-&gt;outptr_ext
)paren
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;inq_conf
comma
op_amp
id|default_conf_flags
comma
op_amp
id|inptr
comma
op_amp
id|sti-&gt;outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|default_font_flags
r_static
r_const
r_struct
id|sti_font_flags
id|default_font_flags
op_assign
(brace
dot
id|wait
op_assign
id|STI_WAIT
comma
dot
id|non_text
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_void
DECL|function|sti_putc
id|sti_putc
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
r_struct
id|sti_font_inptr
id|inptr
op_assign
(brace
dot
id|font_start_addr
op_assign
id|STI_PTR
c_func
(paren
id|sti-&gt;font-&gt;raw
)paren
comma
dot
id|index
op_assign
id|c_index
c_func
(paren
id|sti
comma
id|c
)paren
comma
dot
id|fg_color
op_assign
id|c_fg
c_func
(paren
id|sti
comma
id|c
)paren
comma
dot
id|bg_color
op_assign
id|c_bg
c_func
(paren
id|sti
comma
id|c
)paren
comma
dot
id|dest_x
op_assign
id|x
op_star
id|sti-&gt;font_width
comma
dot
id|dest_y
op_assign
id|y
op_star
id|sti-&gt;font_height
comma
)brace
suffix:semicolon
r_struct
id|sti_font_outptr
id|outptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;font_unpmv
comma
op_amp
id|default_font_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|clear_blkmv_flags
r_static
r_const
r_struct
id|sti_blkmv_flags
id|clear_blkmv_flags
op_assign
(brace
dot
id|wait
op_assign
id|STI_WAIT
comma
dot
id|color
op_assign
l_int|1
comma
dot
id|clear
op_assign
l_int|1
comma
)brace
suffix:semicolon
r_void
DECL|function|sti_set
id|sti_set
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
comma
id|u8
id|color
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
dot
id|fg_color
op_assign
id|color
comma
dot
id|bg_color
op_assign
id|color
comma
dot
id|src_x
op_assign
id|src_x
comma
dot
id|src_y
op_assign
id|src_y
comma
dot
id|dest_x
op_assign
id|src_x
comma
dot
id|dest_y
op_assign
id|src_y
comma
dot
id|width
op_assign
id|width
comma
dot
id|height
op_assign
id|height
comma
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|clear_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
)brace
r_void
DECL|function|sti_clear
id|sti_clear
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|height
comma
r_int
id|width
comma
r_int
id|c
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
dot
id|fg_color
op_assign
id|c_fg
c_func
(paren
id|sti
comma
id|c
)paren
comma
dot
id|bg_color
op_assign
id|c_bg
c_func
(paren
id|sti
comma
id|c
)paren
comma
dot
id|src_x
op_assign
id|src_x
op_star
id|sti-&gt;font_width
comma
dot
id|src_y
op_assign
id|src_y
op_star
id|sti-&gt;font_height
comma
dot
id|dest_x
op_assign
id|src_x
op_star
id|sti-&gt;font_width
comma
dot
id|dest_y
op_assign
id|src_y
op_star
id|sti-&gt;font_height
comma
dot
id|width
op_assign
id|width
op_star
id|sti-&gt;font_width
comma
dot
id|height
op_assign
id|height
op_star
id|sti-&gt;font_height
comma
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|clear_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|default_blkmv_flags
r_static
r_const
r_struct
id|sti_blkmv_flags
id|default_blkmv_flags
op_assign
(brace
dot
id|wait
op_assign
id|STI_WAIT
comma
)brace
suffix:semicolon
r_void
DECL|function|sti_bmove
id|sti_bmove
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
id|src_y
comma
r_int
id|src_x
comma
r_int
id|dst_y
comma
r_int
id|dst_x
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|sti_blkmv_inptr
id|inptr
op_assign
(brace
dot
id|src_x
op_assign
id|src_x
op_star
id|sti-&gt;font_width
comma
dot
id|src_y
op_assign
id|src_y
op_star
id|sti-&gt;font_height
comma
dot
id|dest_x
op_assign
id|dst_x
op_star
id|sti-&gt;font_width
comma
dot
id|dest_y
op_assign
id|dst_y
op_star
id|sti-&gt;font_height
comma
dot
id|width
op_assign
id|width
op_star
id|sti-&gt;font_width
comma
dot
id|height
op_assign
id|height
op_star
id|sti-&gt;font_height
comma
)brace
suffix:semicolon
r_struct
id|sti_blkmv_outptr
id|outptr
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|s32
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_do
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|STI_CALL
c_func
(paren
id|sti-&gt;block_move
comma
op_amp
id|default_blkmv_flags
comma
op_amp
id|inptr
comma
op_amp
id|outptr
comma
id|sti-&gt;glob_cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sti-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: Do we have another solution for this ? */
DECL|function|sti_flush
r_static
r_void
id|sti_flush
c_func
(paren
r_int
r_int
id|from
comma
r_int
r_int
id|len
)paren
(brace
id|flush_data_cache
c_func
(paren
)paren
suffix:semicolon
id|flush_kernel_dcache_range
c_func
(paren
id|from
comma
id|len
)paren
suffix:semicolon
id|flush_icache_range
c_func
(paren
id|from
comma
id|from
op_plus
id|len
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|sti_rom_copy
id|sti_rom_copy
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|count
comma
r_void
op_star
id|dest
)paren
(brace
r_int
r_int
id|dest_len
op_assign
id|count
suffix:semicolon
r_int
r_int
id|dest_start
op_assign
(paren
r_int
r_int
)paren
id|dest
suffix:semicolon
multiline_comment|/* this still needs to be revisited (see arch/parisc/mm/init.c:246) ! */
r_while
c_loop
(paren
id|count
op_ge
l_int|4
)paren
(brace
id|count
op_sub_assign
l_int|4
suffix:semicolon
op_star
(paren
id|u32
op_star
)paren
id|dest
op_assign
id|__raw_readl
c_func
(paren
id|base
)paren
suffix:semicolon
id|base
op_add_assign
l_int|4
suffix:semicolon
id|dest
op_add_assign
l_int|4
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
op_star
(paren
id|u8
op_star
)paren
id|dest
op_assign
id|__raw_readb
c_func
(paren
id|base
)paren
suffix:semicolon
id|base
op_increment
suffix:semicolon
id|dest
op_increment
suffix:semicolon
)brace
id|sti_flush
c_func
(paren
id|dest_start
comma
id|dest_len
)paren
suffix:semicolon
)brace
DECL|variable|default_sti_path
r_static
r_char
id|default_sti_path
(braket
l_int|21
)braket
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|sti_setup
r_static
r_int
id|__init
id|sti_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
id|str
)paren
id|strlcpy
(paren
id|default_sti_path
comma
id|str
comma
r_sizeof
(paren
id|default_sti_path
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&t;Assuming the machine has multiple STI consoles (=graphic cards) which&n; *&t;all get detected by sticon, the user may define with the linux kernel&n; *&t;parameter sti=&lt;x&gt; which of them will be the initial boot-console.&n; *&t;&lt;x&gt; is a number between 0 and MAX_STI_ROMS, with 0 as the default &n; *&t;STI screen.&n; */
id|__setup
c_func
(paren
l_string|&quot;sti=&quot;
comma
id|sti_setup
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|font_name
r_static
r_char
id|__initdata
op_star
id|font_name
(braket
id|MAX_STI_ROMS
)braket
op_assign
(brace
l_string|&quot;VGA8x16&quot;
comma
)brace
suffix:semicolon
DECL|variable|font_index
r_static
r_int
id|__initdata
id|font_index
(braket
id|MAX_STI_ROMS
)braket
comma
DECL|variable|font_height
id|font_height
(braket
id|MAX_STI_ROMS
)braket
comma
DECL|variable|font_width
id|font_width
(braket
id|MAX_STI_ROMS
)braket
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|sti_font_setup
r_static
r_int
id|__init
id|sti_font_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|x
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* we accept sti_font=VGA8x16, sti_font=10x20, sti_font=10*20 &n;&t; * or sti_font=7 style command lines. */
r_while
c_loop
(paren
id|i
OL
id|MAX_STI_ROMS
op_logical_and
id|str
op_logical_and
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|str
op_le
l_char|&squot;9&squot;
)paren
(brace
r_if
c_cond
(paren
(paren
id|x
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;x&squot;
)paren
)paren
op_logical_or
(paren
id|x
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;*&squot;
)paren
)paren
)paren
(brace
id|font_height
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|font_width
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|x
op_plus
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|font_index
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|font_name
(braket
id|i
)braket
op_assign
id|str
suffix:semicolon
multiline_comment|/* fb font name */
)brace
r_if
c_cond
(paren
(paren
id|x
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|x
op_increment
op_assign
l_int|0
suffix:semicolon
id|str
op_assign
id|x
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&t;The optional linux kernel parameter &quot;sti_font&quot; defines which font&n; *&t;should be used by the sticon driver to draw characters to the screen.&n; *&t;Possible values are:&n; *&t;- sti_font=&lt;fb_fontname&gt;:&n; *&t;&t;&lt;fb_fontname&gt; is the name of one of the linux-kernel built-in &n; *&t;&t;framebuffer font names (e.g. VGA8x16, SUN22x18). &n; *&t;&t;This is only available if the fonts have been statically compiled &n; *&t;&t;in with e.g. the CONFIG_FONT_8x16 or CONFIG_FONT_SUN12x22 options.&n; *&t;- sti_font=&lt;number&gt;&n; *&t;&t;most STI ROMs have built-in HP specific fonts, which can be selected&n; *&t;&t;by giving the desired number to the sticon driver. &n; *&t;&t;NOTE: This number is machine and STI ROM dependend.&n; *&t;- sti_font=&lt;height&gt;x&lt;width&gt;  (e.g. sti_font=16x8)&n; *&t;&t;&lt;height&gt; and &lt;width&gt; gives hints to the height and width of the&n; *&t;&t;font which the user wants. The sticon driver will try to use&n; *&t;&t;a font with this height and width, but if no suitable font is&n; *&t;&t;found, sticon will use the default 8x8 font.&n; */
id|__setup
c_func
(paren
l_string|&quot;sti_font=&quot;
comma
id|sti_font_setup
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|__init
DECL|function|sti_dump_globcfg
id|sti_dump_globcfg
c_func
(paren
r_struct
id|sti_glob_cfg
op_star
id|glob_cfg
comma
r_int
r_int
id|sti_mem_request
)paren
(brace
r_struct
id|sti_glob_cfg_ext
op_star
id|cfg
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_INFO
l_string|&quot;%d text planes&bslash;n&quot;
l_string|&quot;%4d x %4d screen resolution&bslash;n&quot;
l_string|&quot;%4d x %4d offscreen&bslash;n&quot;
l_string|&quot;%4d x %4d layout&bslash;n&quot;
l_string|&quot;regions at %08x %08x %08x %08x&bslash;n&quot;
l_string|&quot;regions at %08x %08x %08x %08x&bslash;n&quot;
l_string|&quot;reent_lvl %d&bslash;n&quot;
l_string|&quot;save_addr %08x&bslash;n&quot;
comma
id|glob_cfg-&gt;text_planes
comma
id|glob_cfg-&gt;onscreen_x
comma
id|glob_cfg-&gt;onscreen_y
comma
id|glob_cfg-&gt;offscreen_x
comma
id|glob_cfg-&gt;offscreen_y
comma
id|glob_cfg-&gt;total_x
comma
id|glob_cfg-&gt;total_y
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|0
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|1
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|2
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|3
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|4
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|5
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|6
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
l_int|7
)braket
comma
id|glob_cfg-&gt;reent_lvl
comma
id|glob_cfg-&gt;save_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* dump extended cfg */
id|cfg
op_assign
id|PTR_STI
c_func
(paren
id|glob_cfg-&gt;ext_ptr
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_INFO
l_string|&quot;monitor %d&bslash;n&quot;
l_string|&quot;in friendly mode: %d&bslash;n&quot;
l_string|&quot;power consumption %d watts&bslash;n&quot;
l_string|&quot;freq ref %d&bslash;n&quot;
l_string|&quot;sti_mem_addr %08x (size=%d bytes)&bslash;n&quot;
comma
id|cfg-&gt;curr_mon
comma
id|cfg-&gt;friendly_boot
comma
id|cfg-&gt;power
comma
id|cfg-&gt;freq_ref
comma
id|cfg-&gt;sti_mem_addr
comma
id|sti_mem_request
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|sti_dump_outptr
id|sti_dump_outptr
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
)paren
(brace
id|DPRINTK
c_func
(paren
(paren
id|KERN_INFO
l_string|&quot;%d bits per pixel&bslash;n&quot;
l_string|&quot;%d used bits&bslash;n&quot;
l_string|&quot;%d planes&bslash;n&quot;
l_string|&quot;attributes %08x&bslash;n&quot;
comma
id|sti-&gt;outptr.bits_per_pixel
comma
id|sti-&gt;outptr.bits_used
comma
id|sti-&gt;outptr.planes
comma
id|sti-&gt;outptr.attributes
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|sti_init_glob_cfg
id|sti_init_glob_cfg
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
r_int
id|rom_address
comma
r_int
r_int
id|hpa
)paren
(brace
r_struct
id|sti_glob_cfg
op_star
id|glob_cfg
suffix:semicolon
r_struct
id|sti_glob_cfg_ext
op_star
id|glob_cfg_ext
suffix:semicolon
r_void
op_star
id|save_addr
suffix:semicolon
r_void
op_star
id|sti_mem_addr
suffix:semicolon
r_const
r_int
id|save_addr_size
op_assign
l_int|1024
suffix:semicolon
multiline_comment|/* XXX */
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sti-&gt;sti_mem_request
)paren
id|sti-&gt;sti_mem_request
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* STI default */
id|glob_cfg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sti-&gt;glob_cfg
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|glob_cfg_ext
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|glob_cfg_ext
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|save_addr
op_assign
id|kmalloc
c_func
(paren
id|save_addr_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|sti_mem_addr
op_assign
id|kmalloc
c_func
(paren
id|sti-&gt;sti_mem_request
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|glob_cfg
op_logical_and
id|glob_cfg_ext
op_logical_and
id|save_addr
op_logical_and
id|sti_mem_addr
)paren
)paren
(brace
id|kfree
c_func
(paren
id|glob_cfg
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|glob_cfg_ext
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|save_addr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sti_mem_addr
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|glob_cfg
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|glob_cfg
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|glob_cfg_ext
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|glob_cfg_ext
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|save_addr
comma
l_int|0
comma
id|save_addr_size
)paren
suffix:semicolon
id|memset
c_func
(paren
id|sti_mem_addr
comma
l_int|0
comma
id|sti-&gt;sti_mem_request
)paren
suffix:semicolon
id|glob_cfg-&gt;ext_ptr
op_assign
id|STI_PTR
c_func
(paren
id|glob_cfg_ext
)paren
suffix:semicolon
id|glob_cfg-&gt;save_addr
op_assign
id|STI_PTR
c_func
(paren
id|save_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|newhpa
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
id|sti-&gt;pd
)paren
(brace
r_int
r_char
id|offs
op_assign
id|sti-&gt;rm_entry
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|offs
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|offs
op_ne
id|PCI_ROM_ADDRESS
op_logical_and
(paren
id|offs
template_param
id|PCI_BASE_ADDRESS_5
)paren
)paren
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;STI pci region maping for region %d (%02x) can&squot;t be mapped&bslash;n&quot;
comma
id|i
comma
id|sti-&gt;rm_entry
(braket
id|i
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|newhpa
op_assign
id|pci_resource_start
(paren
id|sti-&gt;pd
comma
(paren
id|offs
op_minus
id|PCI_BASE_ADDRESS_0
)paren
op_div
l_int|4
)paren
suffix:semicolon
)brace
r_else
id|newhpa
op_assign
(paren
id|i
op_eq
l_int|0
)paren
ques
c_cond
id|rom_address
suffix:colon
id|hpa
suffix:semicolon
id|sti-&gt;regions_phys
(braket
id|i
)braket
op_assign
id|REGION_OFFSET_TO_PHYS
c_func
(paren
id|sti-&gt;regions
(braket
id|i
)braket
comma
id|newhpa
)paren
suffix:semicolon
multiline_comment|/* remap virtually */
multiline_comment|/* FIXME: add BTLB support if btlb==1 */
id|len
op_assign
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.length
op_star
l_int|4096
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
id|glob_cfg-&gt;region_ptrs
(braket
id|i
)braket
op_assign
(paren
r_int
r_int
)paren
(paren
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.cache
ques
c_cond
id|ioremap
c_func
(paren
id|sti-&gt;regions_phys
(braket
id|i
)braket
comma
id|len
)paren
suffix:colon
id|ioremap_nocache
c_func
(paren
id|sti-&gt;regions_phys
(braket
id|i
)braket
comma
id|len
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;region #%d: phys %08lx, virt %08x, len=%lukB, &quot;
l_string|&quot;btlb=%d, sysonly=%d, cache=%d, last=%d&bslash;n&quot;
comma
id|i
comma
id|sti-&gt;regions_phys
(braket
id|i
)braket
comma
id|glob_cfg-&gt;region_ptrs
(braket
id|i
)braket
comma
id|len
op_div
l_int|1024
comma
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.btlb
comma
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.sys_only
comma
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.cache
comma
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.last
)paren
)paren
suffix:semicolon
multiline_comment|/* last entry reached ? */
r_if
c_cond
(paren
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region_desc.last
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|i
OL
l_int|8
op_logical_and
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: *future ptr (0x%8x) not yet supported !&bslash;n&quot;
comma
id|__FILE__
comma
id|sti-&gt;regions
(braket
id|i
)braket
dot
id|region
)paren
suffix:semicolon
id|glob_cfg_ext-&gt;sti_mem_addr
op_assign
id|STI_PTR
c_func
(paren
id|sti_mem_addr
)paren
suffix:semicolon
id|sti-&gt;glob_cfg
op_assign
id|glob_cfg
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FB
r_struct
id|sti_cooked_font
op_star
id|__init
DECL|function|sti_select_fbfont
id|sti_select_fbfont
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|cooked_rom
comma
r_char
op_star
id|fbfont_name
)paren
(brace
r_struct
id|font_desc
op_star
id|fbfont
suffix:semicolon
r_int
r_int
id|size
comma
id|bpc
suffix:semicolon
r_void
op_star
id|dest
suffix:semicolon
r_struct
id|sti_rom_font
op_star
id|nf
suffix:semicolon
r_struct
id|sti_cooked_font
op_star
id|cooked_font
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbfont_name
op_logical_or
op_logical_neg
id|strlen
c_func
(paren
id|fbfont_name
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|fbfont
op_assign
id|find_font
c_func
(paren
id|fbfont_name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbfont
)paren
id|fbfont
op_assign
id|get_default_font
c_func
(paren
l_int|1024
comma
l_int|768
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fbfont
)paren
r_return
l_int|NULL
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;selected %dx%d fb-font %s&bslash;n&quot;
comma
id|fbfont-&gt;width
comma
id|fbfont-&gt;height
comma
id|fbfont-&gt;name
)paren
)paren
suffix:semicolon
id|bpc
op_assign
(paren
(paren
id|fbfont-&gt;width
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
op_star
id|fbfont-&gt;height
suffix:semicolon
id|size
op_assign
id|bpc
op_star
l_int|256
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sti_rom_font
)paren
suffix:semicolon
id|nf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nf
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|nf
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|nf-&gt;first_char
op_assign
l_int|0
suffix:semicolon
id|nf-&gt;last_char
op_assign
l_int|255
suffix:semicolon
id|nf-&gt;width
op_assign
id|fbfont-&gt;width
suffix:semicolon
id|nf-&gt;height
op_assign
id|fbfont-&gt;height
suffix:semicolon
id|nf-&gt;font_type
op_assign
id|STI_FONT_HPROMAN8
suffix:semicolon
id|nf-&gt;bytes_per_char
op_assign
id|bpc
suffix:semicolon
id|nf-&gt;next_font
op_assign
l_int|0
suffix:semicolon
id|nf-&gt;underline_height
op_assign
l_int|1
suffix:semicolon
id|nf-&gt;underline_pos
op_assign
id|fbfont-&gt;height
op_minus
id|nf-&gt;underline_height
suffix:semicolon
id|dest
op_assign
id|nf
suffix:semicolon
id|dest
op_add_assign
r_sizeof
(paren
r_struct
id|sti_rom_font
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dest
comma
id|fbfont-&gt;data
comma
id|bpc
op_star
l_int|256
)paren
suffix:semicolon
id|cooked_font
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cooked_font
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked_font
)paren
(brace
id|kfree
c_func
(paren
id|nf
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|cooked_font-&gt;raw
op_assign
id|nf
suffix:semicolon
id|cooked_font-&gt;next_font
op_assign
l_int|NULL
suffix:semicolon
id|cooked_rom-&gt;font_start
op_assign
id|cooked_font
suffix:semicolon
r_return
id|cooked_font
suffix:semicolon
)brace
macro_line|#else
r_struct
id|sti_cooked_font
op_star
id|__init
DECL|function|sti_select_fbfont
id|sti_select_fbfont
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|cooked_rom
comma
r_char
op_star
id|fbfont_name
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
r_struct
id|sti_cooked_font
op_star
id|__init
DECL|function|sti_select_font
id|sti_select_font
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|rom
comma
r_int
(paren
op_star
id|search_font_fnc
)paren
(paren
r_struct
id|sti_cooked_rom
op_star
comma
r_int
comma
r_int
)paren
)paren
(brace
r_struct
id|sti_cooked_font
op_star
id|font
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|index
op_assign
id|num_sti_roms
suffix:semicolon
multiline_comment|/* check for framebuffer-font first */
r_if
c_cond
(paren
(paren
id|font
op_assign
id|sti_select_fbfont
c_func
(paren
id|rom
comma
id|font_name
(braket
id|index
)braket
)paren
)paren
)paren
r_return
id|font
suffix:semicolon
r_if
c_cond
(paren
id|font_width
(braket
id|index
)braket
op_logical_and
id|font_height
(braket
id|index
)braket
)paren
id|font_index
(braket
id|index
)braket
op_assign
id|search_font_fnc
c_func
(paren
id|rom
comma
id|font_height
(braket
id|index
)braket
comma
id|font_width
(braket
id|index
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|font
op_assign
id|rom-&gt;font_start
comma
id|i
op_assign
id|font_index
(braket
id|index
)braket
suffix:semicolon
id|font
op_logical_and
(paren
id|i
OG
l_int|0
)paren
suffix:semicolon
id|font
op_assign
id|font-&gt;next_font
comma
id|i
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|font
)paren
r_return
id|font
suffix:semicolon
r_else
r_return
id|rom-&gt;font_start
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|sti_dump_rom
id|sti_dump_rom
c_func
(paren
r_struct
id|sti_rom
op_star
id|rom
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    id %04x-%04x, conforms to spec rev. %d.%02x&bslash;n&quot;
comma
id|rom-&gt;graphics_id
(braket
l_int|0
)braket
comma
id|rom-&gt;graphics_id
(braket
l_int|1
)braket
comma
id|rom-&gt;revno
(braket
l_int|0
)braket
op_rshift
l_int|4
comma
id|rom-&gt;revno
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      supports %d monitors&bslash;n&quot;
comma
id|rom-&gt;num_mons
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      font start %08x&bslash;n&quot;
comma
id|rom-&gt;font_start
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      region list %08x&bslash;n&quot;
comma
id|rom-&gt;region_list
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      init_graph %08x&bslash;n&quot;
comma
id|rom-&gt;init_graph
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      bus support %02x&bslash;n&quot;
comma
id|rom-&gt;bus_support
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      ext bus support %02x&bslash;n&quot;
comma
id|rom-&gt;ext_bus_support
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;      alternate code type %d&bslash;n&quot;
comma
id|rom-&gt;alt_code_type
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|sti_cook_fonts
id|sti_cook_fonts
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|cooked_rom
comma
r_struct
id|sti_rom
op_star
id|raw_rom
)paren
(brace
r_struct
id|sti_rom_font
op_star
id|raw_font
comma
op_star
id|font_start
suffix:semicolon
r_struct
id|sti_cooked_font
op_star
id|cooked_font
suffix:semicolon
id|cooked_font
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cooked_font
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked_font
)paren
r_return
l_int|0
suffix:semicolon
id|cooked_rom-&gt;font_start
op_assign
id|cooked_font
suffix:semicolon
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|raw_rom
)paren
op_plus
(paren
id|raw_rom-&gt;font_start
)paren
suffix:semicolon
id|font_start
op_assign
id|raw_font
suffix:semicolon
id|cooked_font-&gt;raw
op_assign
id|raw_font
suffix:semicolon
r_while
c_loop
(paren
id|raw_font-&gt;next_font
)paren
(brace
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|font_start
)paren
op_plus
(paren
id|raw_font-&gt;next_font
)paren
suffix:semicolon
id|cooked_font-&gt;next_font
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cooked_font
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked_font-&gt;next_font
)paren
r_return
l_int|1
suffix:semicolon
id|cooked_font
op_assign
id|cooked_font-&gt;next_font
suffix:semicolon
id|cooked_font-&gt;raw
op_assign
id|raw_font
suffix:semicolon
)brace
id|cooked_font-&gt;next_font
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|sti_search_font
id|sti_search_font
c_func
(paren
r_struct
id|sti_cooked_rom
op_star
id|rom
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_struct
id|sti_cooked_font
op_star
id|font
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|font
op_assign
id|rom-&gt;font_start
suffix:semicolon
id|font
suffix:semicolon
id|font
op_assign
id|font-&gt;next_font
comma
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|font-&gt;raw-&gt;width
op_eq
id|width
)paren
op_logical_and
(paren
id|font-&gt;raw-&gt;height
op_eq
id|height
)paren
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|BMODE_RELOCATE
mdefine_line|#define BMODE_RELOCATE(offset)        offset = (offset) / 4;
DECL|macro|BMODE_LAST_ADDR_OFFS
mdefine_line|#define BMODE_LAST_ADDR_OFFS          0x50
r_static
r_void
op_star
id|__init
DECL|function|sti_bmode_font_raw
id|sti_bmode_font_raw
c_func
(paren
r_struct
id|sti_cooked_font
op_star
id|f
)paren
(brace
r_int
r_char
op_star
id|n
comma
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|size
op_assign
id|f-&gt;raw-&gt;bytes_per_char
op_star
l_int|256
op_plus
r_sizeof
(paren
r_struct
id|sti_rom_font
)paren
suffix:semicolon
id|n
op_assign
id|kmalloc
(paren
l_int|4
op_star
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
(paren
id|n
comma
l_int|0
comma
l_int|4
op_star
id|size
)paren
suffix:semicolon
id|p
op_assign
id|n
op_plus
l_int|3
suffix:semicolon
id|q
op_assign
(paren
r_int
r_char
op_star
)paren
id|f-&gt;raw
suffix:semicolon
r_while
c_loop
(paren
id|size
op_decrement
)paren
(brace
op_star
id|p
op_assign
op_star
id|q
op_increment
suffix:semicolon
id|p
op_add_assign
l_int|4
suffix:semicolon
)brace
r_return
id|n
op_plus
l_int|3
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|sti_bmode_rom_copy
id|sti_bmode_rom_copy
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|count
comma
r_void
op_star
id|dest
)paren
(brace
r_int
r_int
id|dest_len
op_assign
id|count
suffix:semicolon
r_int
r_int
id|dest_start
op_assign
(paren
r_int
r_int
)paren
id|dest
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
op_star
(paren
id|u8
op_star
)paren
id|dest
op_assign
id|__raw_readl
c_func
(paren
id|base
)paren
suffix:semicolon
id|base
op_add_assign
l_int|4
suffix:semicolon
id|dest
op_increment
suffix:semicolon
)brace
id|sti_flush
c_func
(paren
id|dest_start
comma
id|dest_len
)paren
suffix:semicolon
)brace
r_static
r_struct
id|sti_rom
op_star
id|__init
DECL|function|sti_get_bmode_rom
id|sti_get_bmode_rom
(paren
r_int
r_int
id|address
)paren
(brace
r_struct
id|sti_rom
op_star
id|raw
suffix:semicolon
id|u32
id|size
suffix:semicolon
r_struct
id|sti_rom_font
op_star
id|raw_font
comma
op_star
id|font_start
suffix:semicolon
id|sti_bmode_rom_copy
c_func
(paren
id|address
op_plus
id|BMODE_LAST_ADDR_OFFS
comma
r_sizeof
(paren
id|size
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
id|size
op_assign
(paren
id|size
op_plus
l_int|3
)paren
op_div
l_int|4
suffix:semicolon
id|raw
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|raw
)paren
(brace
id|sti_bmode_rom_copy
c_func
(paren
id|address
comma
id|size
comma
id|raw
)paren
suffix:semicolon
id|memmove
(paren
op_amp
id|raw-&gt;res004
comma
op_amp
id|raw-&gt;type
(braket
l_int|0
)braket
comma
l_int|0x3c
)paren
suffix:semicolon
id|raw-&gt;type
(braket
l_int|3
)braket
op_assign
id|raw-&gt;res004
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;region_list
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;font_start
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;init_graph
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;state_mgmt
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;font_unpmv
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;block_move
)paren
suffix:semicolon
id|BMODE_RELOCATE
(paren
id|raw-&gt;inq_conf
)paren
suffix:semicolon
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|raw
)paren
op_plus
id|raw-&gt;font_start
suffix:semicolon
id|font_start
op_assign
id|raw_font
suffix:semicolon
r_while
c_loop
(paren
id|raw_font-&gt;next_font
)paren
(brace
id|BMODE_RELOCATE
(paren
id|raw_font-&gt;next_font
)paren
suffix:semicolon
id|raw_font
op_assign
(paren
(paren
r_void
op_star
)paren
id|font_start
)paren
op_plus
id|raw_font-&gt;next_font
suffix:semicolon
)brace
)brace
r_return
id|raw
suffix:semicolon
)brace
r_struct
id|sti_rom
op_star
id|__init
DECL|function|sti_get_wmode_rom
id|sti_get_wmode_rom
(paren
r_int
r_int
id|address
)paren
(brace
r_struct
id|sti_rom
op_star
id|raw
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
multiline_comment|/* read the ROM size directly from the struct in ROM */
id|size
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
m_offsetof
(paren
r_struct
id|sti_rom
comma
id|last_addr
)paren
)paren
suffix:semicolon
id|raw
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|raw
)paren
(brace
id|sti_rom_copy
c_func
(paren
id|address
comma
id|size
comma
id|raw
)paren
suffix:semicolon
)brace
r_return
id|raw
suffix:semicolon
)brace
r_int
id|__init
DECL|function|sti_read_rom
id|sti_read_rom
c_func
(paren
r_int
id|wordmode
comma
r_struct
id|sti_struct
op_star
id|sti
comma
r_int
r_int
id|address
)paren
(brace
r_struct
id|sti_cooked_rom
op_star
id|cooked
suffix:semicolon
r_struct
id|sti_rom
op_star
id|raw
op_assign
l_int|NULL
suffix:semicolon
id|cooked
op_assign
id|kmalloc
c_func
(paren
r_sizeof
op_star
id|cooked
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cooked
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
id|wordmode
)paren
id|raw
op_assign
id|sti_get_wmode_rom
(paren
id|address
)paren
suffix:semicolon
r_else
id|raw
op_assign
id|sti_get_bmode_rom
(paren
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|raw
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sti_cook_fonts
c_func
(paren
id|cooked
comma
id|raw
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;No font found for STI at %08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
r_goto
id|out_err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|raw-&gt;region_list
)paren
id|memcpy
c_func
(paren
id|sti-&gt;regions
comma
(paren
(paren
r_void
op_star
)paren
id|raw
)paren
op_plus
id|raw-&gt;region_list
comma
r_sizeof
(paren
id|sti-&gt;regions
)paren
)paren
suffix:semicolon
id|address
op_assign
(paren
r_int
r_int
)paren
id|STI_PTR
c_func
(paren
id|raw
)paren
suffix:semicolon
id|sti-&gt;font_unpmv
op_assign
id|address
op_plus
(paren
id|raw-&gt;font_unpmv
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|sti-&gt;block_move
op_assign
id|address
op_plus
(paren
id|raw-&gt;block_move
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|sti-&gt;init_graph
op_assign
id|address
op_plus
(paren
id|raw-&gt;init_graph
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|sti-&gt;inq_conf
op_assign
id|address
op_plus
(paren
id|raw-&gt;inq_conf
op_amp
l_int|0x03ffffff
)paren
suffix:semicolon
id|sti-&gt;rom
op_assign
id|cooked
suffix:semicolon
id|sti-&gt;rom-&gt;raw
op_assign
id|raw
suffix:semicolon
id|sti-&gt;font
op_assign
id|sti_select_font
c_func
(paren
id|sti-&gt;rom
comma
id|sti_search_font
)paren
suffix:semicolon
id|sti-&gt;font_width
op_assign
id|sti-&gt;font-&gt;raw-&gt;width
suffix:semicolon
id|sti-&gt;font_height
op_assign
id|sti-&gt;font-&gt;raw-&gt;height
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wordmode
)paren
id|sti-&gt;font-&gt;raw
op_assign
id|sti_bmode_font_raw
c_func
(paren
id|sti-&gt;font
)paren
suffix:semicolon
id|sti-&gt;sti_mem_request
op_assign
id|raw-&gt;sti_mem_req
suffix:semicolon
id|sti-&gt;graphics_id
(braket
l_int|0
)braket
op_assign
id|raw-&gt;graphics_id
(braket
l_int|0
)braket
suffix:semicolon
id|sti-&gt;graphics_id
(braket
l_int|1
)braket
op_assign
id|raw-&gt;graphics_id
(braket
l_int|1
)braket
suffix:semicolon
id|sti_dump_rom
c_func
(paren
id|raw
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|out_err
suffix:colon
r_if
c_cond
(paren
id|raw
)paren
(brace
id|kfree
c_func
(paren
id|raw
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cooked
)paren
(brace
id|kfree
c_func
(paren
id|cooked
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|sti_struct
op_star
id|__init
DECL|function|sti_try_rom_generic
id|sti_try_rom_generic
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|hpa
comma
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
r_struct
id|sti_struct
op_star
id|sti
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|u32
id|sig
suffix:semicolon
r_if
c_cond
(paren
id|num_sti_roms
op_ge
id|MAX_STI_ROMS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;maximum number of STI ROMS reached !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|sti
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sti
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Not enough memory !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sti
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sti
)paren
)paren
suffix:semicolon
id|sti-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|test_rom
suffix:colon
multiline_comment|/* if we can&squot;t read the ROM, bail out early.  Not being able&n;&t; * to read the hpa is okay, for romless sti */
r_if
c_cond
(paren
id|pdc_add_valid
c_func
(paren
id|address
)paren
)paren
r_goto
id|out_err
suffix:semicolon
id|sig
op_assign
id|__raw_readl
c_func
(paren
id|address
)paren
suffix:semicolon
multiline_comment|/* check for a PCI ROM structure */
r_if
c_cond
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|sig
)paren
op_eq
l_int|0xaa55
)paren
)paren
(brace
r_int
r_int
id|i
comma
id|rm_offset
suffix:semicolon
id|u32
op_star
id|rm
suffix:semicolon
id|i
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
l_int|0x04
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
l_int|1
)paren
(brace
multiline_comment|/* The ROM could have multiple architecture &n;&t;&t;&t; * dependent images (e.g. i386, parisc,...) */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI ROM is not a STI ROM type image (0x%8x)&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_goto
id|out_err
suffix:semicolon
)brace
id|sti-&gt;pd
op_assign
id|pd
suffix:semicolon
id|i
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
l_int|0x0c
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;PCI ROM size (from header) = %d kB&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|i
op_rshift
l_int|16
)paren
op_star
l_int|512
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|rm_offset
op_assign
id|le16_to_cpu
c_func
(paren
id|i
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm_offset
)paren
(brace
multiline_comment|/* read 16 bytes from the pci region mapper array */
id|rm
op_assign
(paren
id|u32
op_star
)paren
op_amp
id|sti-&gt;rm_entry
suffix:semicolon
op_star
id|rm
op_increment
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
id|rm_offset
op_plus
l_int|0x00
)paren
suffix:semicolon
op_star
id|rm
op_increment
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
id|rm_offset
op_plus
l_int|0x04
)paren
suffix:semicolon
op_star
id|rm
op_increment
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
id|rm_offset
op_plus
l_int|0x08
)paren
suffix:semicolon
op_star
id|rm
op_increment
op_assign
id|__raw_readl
c_func
(paren
id|address
op_plus
id|rm_offset
op_plus
l_int|0x0c
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;PCI region Mapper offset = %08x: &quot;
comma
id|rm_offset
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;%02x &quot;
comma
id|sti-&gt;rm_entry
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|address
op_add_assign
id|le32_to_cpu
c_func
(paren
id|__raw_readl
c_func
(paren
id|address
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;sig %04x, PCI STI ROM at %08lx&bslash;n&quot;
comma
id|sig
comma
id|address
)paren
)paren
suffix:semicolon
r_goto
id|test_rom
suffix:semicolon
)brace
id|ok
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sig
op_amp
l_int|0xff
)paren
op_eq
l_int|0x01
)paren
(brace
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;    byte mode ROM at %08lx, hpa at %08lx&bslash;n&quot;
comma
id|address
comma
id|hpa
)paren
)paren
suffix:semicolon
id|ok
op_assign
id|sti_read_rom
c_func
(paren
l_int|0
comma
id|sti
comma
id|address
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sig
op_amp
l_int|0xffff
)paren
op_eq
l_int|0x0303
)paren
(brace
id|DPRINTK
c_func
(paren
(paren
l_string|&quot;    word mode ROM at %08lx, hpa at %08lx&bslash;n&quot;
comma
id|address
comma
id|hpa
)paren
)paren
suffix:semicolon
id|ok
op_assign
id|sti_read_rom
c_func
(paren
l_int|1
comma
id|sti
comma
id|address
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
id|sti_init_glob_cfg
c_func
(paren
id|sti
comma
id|address
comma
id|hpa
)paren
)paren
r_goto
id|out_err
suffix:semicolon
multiline_comment|/* not enough memory */
multiline_comment|/* disable STI PCI ROM. ROM and card RAM overlap and&n;&t; * leaving it enabled would force HPMCs&n;&t; */
r_if
c_cond
(paren
id|sti-&gt;pd
)paren
(brace
r_int
r_int
id|rom_base
suffix:semicolon
id|rom_base
op_assign
id|pci_resource_start
c_func
(paren
id|sti-&gt;pd
comma
id|PCI_ROM_RESOURCE
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|sti-&gt;pd
comma
id|PCI_ROM_ADDRESS
comma
id|rom_base
op_amp
op_complement
id|PCI_ROM_ADDRESS_ENABLE
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;STI PCI ROM disabled&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sti_init_graph
c_func
(paren
id|sti
)paren
)paren
r_goto
id|out_err
suffix:semicolon
id|sti_inq_conf
c_func
(paren
id|sti
)paren
suffix:semicolon
id|sti_dump_globcfg
c_func
(paren
id|sti-&gt;glob_cfg
comma
id|sti-&gt;sti_mem_request
)paren
suffix:semicolon
id|sti_dump_outptr
c_func
(paren
id|sti
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    graphics card name: %s&bslash;n&quot;
comma
id|sti-&gt;outptr.dev_name
)paren
suffix:semicolon
id|sti_roms
(braket
id|num_sti_roms
)braket
op_assign
id|sti
suffix:semicolon
id|num_sti_roms
op_increment
suffix:semicolon
r_return
id|sti
suffix:semicolon
id|out_err
suffix:colon
id|kfree
c_func
(paren
id|sti
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sticore_check_for_default_sti
r_static
r_void
id|__init
id|sticore_check_for_default_sti
c_func
(paren
r_struct
id|sti_struct
op_star
id|sti
comma
r_char
op_star
id|path
)paren
(brace
r_if
c_cond
(paren
id|strcmp
(paren
id|path
comma
id|default_sti_path
)paren
op_eq
l_int|0
)paren
id|default_sti
op_assign
id|sti
suffix:semicolon
)brace
multiline_comment|/*&n; * on newer systems PDC gives the address of the ROM &n; * in the additional address field addr[1] while on&n; * older Systems the PDC stores it in page0-&gt;proc_sti &n; */
DECL|function|sticore_pa_init
r_static
r_int
id|__init
id|sticore_pa_init
c_func
(paren
r_struct
id|parisc_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|rom
op_assign
l_int|0
suffix:semicolon
r_char
id|pa_path
(braket
l_int|21
)braket
suffix:semicolon
r_struct
id|sti_struct
op_star
id|sti
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;num_addrs
)paren
(brace
id|rom
op_assign
id|dev-&gt;addr
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rom
)paren
(brace
id|rom
op_assign
id|dev-&gt;hpa
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;Trying STI ROM at %08lx, hpa at %08lx&bslash;n&quot;
comma
id|rom
comma
id|dev-&gt;hpa
)paren
)paren
suffix:semicolon
id|sti
op_assign
id|sti_try_rom_generic
c_func
(paren
id|rom
comma
id|dev-&gt;hpa
comma
l_int|NULL
)paren
suffix:semicolon
id|rom
op_assign
id|PAGE0-&gt;proc_sti
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
(brace
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;Trying STI ROM at %08lx, hpa at %08lx&bslash;n&quot;
comma
id|rom
comma
id|dev-&gt;hpa
)paren
)paren
suffix:semicolon
id|sti
op_assign
id|sti_try_rom_generic
c_func
(paren
id|rom
comma
id|dev-&gt;hpa
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
r_return
l_int|1
suffix:semicolon
id|print_pa_hwpath
c_func
(paren
id|dev
comma
id|pa_path
)paren
suffix:semicolon
id|sticore_check_for_default_sti
(paren
id|sti
comma
id|pa_path
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticore_pci_init
r_static
r_int
id|__devinit
id|sticore_pci_init
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_int
r_int
id|fb_base
comma
id|rom_base
suffix:semicolon
r_int
r_int
id|fb_len
comma
id|rom_len
suffix:semicolon
r_struct
id|sti_struct
op_star
id|sti
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|pd
)paren
suffix:semicolon
id|fb_base
op_assign
id|pci_resource_start
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
id|fb_len
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
id|rom_base
op_assign
id|pci_resource_start
c_func
(paren
id|pd
comma
id|PCI_ROM_RESOURCE
)paren
suffix:semicolon
id|rom_len
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
id|PCI_ROM_RESOURCE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rom_base
)paren
(brace
id|pci_write_config_dword
c_func
(paren
id|pd
comma
id|PCI_ROM_ADDRESS
comma
id|rom_base
op_or
id|PCI_ROM_ADDRESS_ENABLE
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;STI PCI ROM enabled at 0x%08lx&bslash;n&quot;
comma
id|rom_base
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;STI PCI graphic ROM found at %08lx (%u kB), fb at %08lx (%u MB)&bslash;n&quot;
comma
id|rom_base
comma
id|rom_len
op_div
l_int|1024
comma
id|fb_base
comma
id|fb_len
op_div
l_int|1024
op_div
l_int|1024
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
(paren
id|KERN_DEBUG
l_string|&quot;Trying PCI STI ROM at %08lx, PCI hpa at %08lx&bslash;n&quot;
comma
id|rom_base
comma
id|fb_base
)paren
)paren
suffix:semicolon
id|sti
op_assign
id|sti_try_rom_generic
c_func
(paren
id|rom_base
comma
id|fb_base
comma
id|pd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sti
)paren
(brace
r_char
id|pa_path
(braket
l_int|30
)braket
suffix:semicolon
id|print_pci_hwpath
c_func
(paren
id|pd
comma
id|pa_path
)paren
suffix:semicolon
id|sticore_check_for_default_sti
c_func
(paren
id|sti
comma
id|pa_path
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sti
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unable to handle STI device &squot;%s&squot;&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pd
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sticore_pci_remove
r_static
r_void
id|__devexit
id|sticore_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|sti_pci_tbl
r_static
r_struct
id|pci_device_id
id|sti_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_VISUALIZE_EG
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_VISUALIZE_FX6
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_VISUALIZE_FX4
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_VISUALIZE_FX2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_VISUALIZE_FXE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|sti_pci_tbl
)paren
suffix:semicolon
DECL|variable|pci_sti_driver
r_static
r_struct
id|pci_driver
id|pci_sti_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sti (pci)&quot;
comma
dot
id|id_table
op_assign
id|sti_pci_tbl
comma
dot
id|probe
op_assign
id|sticore_pci_init
comma
dot
id|remove
op_assign
id|sticore_pci_remove
comma
)brace
suffix:semicolon
DECL|variable|sti_pa_tbl
r_static
r_struct
id|parisc_device_id
id|sti_pa_tbl
(braket
)braket
op_assign
(brace
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x00077
)brace
comma
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x00085
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|pa_sti_driver
r_static
r_struct
id|parisc_driver
id|pa_sti_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sti (native)&quot;
comma
dot
id|id_table
op_assign
id|sti_pa_tbl
comma
dot
id|probe
op_assign
id|sticore_pa_init
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * sti_init_roms() - detects all STI ROMs and stores them in sti_roms[]&n; */
DECL|variable|sticore_initialized
r_static
r_int
id|sticore_initialized
suffix:semicolon
DECL|function|sti_init_roms
r_static
r_void
id|__init
id|sti_init_roms
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|sticore_initialized
)paren
r_return
suffix:semicolon
id|sticore_initialized
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;STI GSC/PCI core graphics driver &quot;
id|STI_DRIVERVERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Register drivers for native &amp; PCI cards */
id|register_parisc_driver
c_func
(paren
op_amp
id|pa_sti_driver
)paren
suffix:semicolon
id|pci_module_init
c_func
(paren
op_amp
id|pci_sti_driver
)paren
suffix:semicolon
multiline_comment|/* if we didn&squot;t find the given default sti, take the first one */
r_if
c_cond
(paren
op_logical_neg
id|default_sti
)paren
id|default_sti
op_assign
id|sti_roms
(braket
l_int|0
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * index = 0 gives default sti&n; * index &gt; 0 gives other stis in detection order&n; */
DECL|function|sti_get_rom
r_struct
id|sti_struct
op_star
id|sti_get_rom
c_func
(paren
r_int
r_int
id|index
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sticore_initialized
)paren
id|sti_init_roms
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
l_int|0
)paren
r_return
id|default_sti
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
id|num_sti_roms
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|sti_roms
(braket
id|index
op_minus
l_int|1
)braket
suffix:semicolon
)brace
DECL|variable|sti_get_rom
id|EXPORT_SYMBOL
c_func
(paren
id|sti_get_rom
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Philipp Rumpf, Helge Deller, Thomas Bogendoerfer&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Core STI driver for HP&squot;s NGLE series graphics cards in HP PARISC machines&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL v2&quot;
)paren
suffix:semicolon
eof
