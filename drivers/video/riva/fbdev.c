multiline_comment|/*&n; * linux/drivers/video/riva/fbdev.c - nVidia RIVA 128/TNT/TNT2 fb driver&n; *&n; * Maintained by Ani Joshi &lt;ajoshi@shell.unixbox.com&gt;&n; *&n; * Copyright 1999-2000 Jeff Garzik&n; *&n; * Contributors:&n; *&n; *&t;Ani Joshi:  Lots of debugging and cleanup work, really helped&n; *&t;get the driver going&n; *&n; *&t;Ferenc Bakonyi:  Bug fixes, cleanup, modularization&n; *&n; *&t;Jindrich Makovicka:  Accel code help, hw cursor, mtrr&n; *&n; * Initial template from skeletonfb.c, created 28 Dec 1997 by Geert Uytterhoeven&n; * Includes riva_hw.c from nVidia, see copyright below.&n; * KGI code provided the basis for state storage, init, and mode switching.&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; *&n; * Known bugs and issues:&n; *&t;restoring text mode fails&n; *&t;doublescan modes are broken&n; *&t;option &squot;noaccel&squot; has no effect&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/selection.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#include &quot;rivafb.h&quot;
macro_line|#include &quot;nvreg.h&quot;
macro_line|#ifndef CONFIG_PCI&t;&t;/* sanity check */
macro_line|#error This driver requires PCI support.
macro_line|#endif
multiline_comment|/* version number of this driver */
DECL|macro|RIVAFB_VERSION
mdefine_line|#define RIVAFB_VERSION &quot;0.9.2a&quot;
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * various helpful macros and constants&n; *&n; * ------------------------------------------------------------------------- */
DECL|macro|RIVAFBDEBUG
macro_line|#undef RIVAFBDEBUG
macro_line|#ifdef RIVAFBDEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
macro_line|#ifndef RIVA_NDEBUG
DECL|macro|assert
mdefine_line|#define assert(expr) &bslash;&n;&t;if(!(expr)) { &bslash;&n;&t;printk( &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&bslash;&n;&t;#expr,__FILE__,__FUNCTION__,__LINE__); &bslash;&n;&t;BUG(); &bslash;&n;&t;}
macro_line|#else
DECL|macro|assert
mdefine_line|#define assert(expr)
macro_line|#endif
DECL|macro|PFX
mdefine_line|#define PFX &quot;rivafb: &quot;
multiline_comment|/* macro that allows you to set overflow bits */
DECL|macro|SetBitField
mdefine_line|#define SetBitField(value,from,to) SetBF(to,GetBF(value,from))
DECL|macro|SetBit
mdefine_line|#define SetBit(n)&t;&t;(1&lt;&lt;(n))
DECL|macro|Set8Bits
mdefine_line|#define Set8Bits(value)&t;&t;((value)&amp;0xff)
multiline_comment|/* HW cursor parameters */
DECL|macro|DEFAULT_CURSOR_BLINK_RATE
mdefine_line|#define DEFAULT_CURSOR_BLINK_RATE&t;(40)
DECL|macro|CURSOR_HIDE_DELAY
mdefine_line|#define CURSOR_HIDE_DELAY&t;&t;(20)
DECL|macro|CURSOR_SHOW_DELAY
mdefine_line|#define CURSOR_SHOW_DELAY&t;&t;(3)
DECL|macro|CURSOR_COLOR
mdefine_line|#define CURSOR_COLOR&t;&t;0x7fff
DECL|macro|TRANSPARENT_COLOR
mdefine_line|#define TRANSPARENT_COLOR&t;0x0000
DECL|macro|MAX_CURS
mdefine_line|#define MAX_CURS&t;&t;32
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * prototypes&n; *&n; * ------------------------------------------------------------------------- */
r_static
r_int
id|rivafb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
r_extern
r_void
id|riva_setup_accel
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
suffix:semicolon
r_extern
r_inline
r_void
id|wait_for_idle
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * card identification&n; *&n; * ------------------------------------------------------------------------- */
DECL|enum|riva_chips
r_enum
id|riva_chips
(brace
DECL|enumerator|CH_RIVA_128
id|CH_RIVA_128
op_assign
l_int|0
comma
DECL|enumerator|CH_RIVA_TNT
id|CH_RIVA_TNT
comma
DECL|enumerator|CH_RIVA_TNT2
id|CH_RIVA_TNT2
comma
DECL|enumerator|CH_RIVA_UTNT2
id|CH_RIVA_UTNT2
comma
multiline_comment|/* UTNT2 */
DECL|enumerator|CH_RIVA_VTNT2
id|CH_RIVA_VTNT2
comma
multiline_comment|/* VTNT2 */
DECL|enumerator|CH_RIVA_UVTNT2
id|CH_RIVA_UVTNT2
comma
multiline_comment|/* VTNT2 */
DECL|enumerator|CH_RIVA_ITNT2
id|CH_RIVA_ITNT2
comma
multiline_comment|/* ITNT2 */
DECL|enumerator|CH_GEFORCE_SDR
id|CH_GEFORCE_SDR
comma
DECL|enumerator|CH_GEFORCE_DDR
id|CH_GEFORCE_DDR
comma
DECL|enumerator|CH_QUADRO
id|CH_QUADRO
comma
DECL|enumerator|CH_GEFORCE2_MX
id|CH_GEFORCE2_MX
comma
DECL|enumerator|CH_QUADRO2_MXR
id|CH_QUADRO2_MXR
comma
DECL|enumerator|CH_GEFORCE2_GTS
id|CH_GEFORCE2_GTS
comma
DECL|enumerator|CH_GEFORCE2_ULTRA
id|CH_GEFORCE2_ULTRA
comma
DECL|enumerator|CH_QUADRO2_PRO
id|CH_QUADRO2_PRO
comma
)brace
suffix:semicolon
multiline_comment|/* directly indexed by riva_chips enum, above */
DECL|struct|riva_chip_info
r_static
r_struct
id|riva_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|arch_rev
r_int
id|arch_rev
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|riva_chip_info
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;RIVA-128&quot;
comma
id|NV_ARCH_03
)brace
comma
(brace
l_string|&quot;RIVA-TNT&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;RIVA-TNT2&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;RIVA-UTNT2&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;RIVA-VTNT2&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;RIVA-UVTNT2&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;RIVA-ITNT2&quot;
comma
id|NV_ARCH_04
)brace
comma
(brace
l_string|&quot;GeForce-SDR&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;GeForce-DDR&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;Quadro&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;GeForce2-MX&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;Quadro2-MXR&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;GeForce2-GTS&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;GeForce2-ULTRA&quot;
comma
id|NV_ARCH_10
)brace
comma
(brace
l_string|&quot;Quadro2-PRO&quot;
comma
id|NV_ARCH_10
)brace
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|rivafb_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_NVIDIA_SGS
comma
id|PCI_DEVICE_ID_NVIDIA_SGS_RIVA128
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_128
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_TNT
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_TNT
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_TNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_TNT2
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_UTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_UTNT2
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_VTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_VTNT2
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_UVTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_VTNT2
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_ITNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_RIVA_ITNT2
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE_SDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE_SDR
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE_DDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE_DDR
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_QUADRO
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_MX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE2_MX
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_MX2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE2_MX
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO2_MXR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_QUADRO2_MXR
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_GTS
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE2_GTS
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_GTS2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE2_GTS
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_ULTRA
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_GEFORCE2_ULTRA
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO2_PRO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_QUADRO2_PRO
)brace
comma
(brace
l_int|0
comma
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|rivafb_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * framebuffer related structures&n; *&n; * ------------------------------------------------------------------------- */
macro_line|#ifdef FBCON_HAS_CFB8
r_extern
r_struct
id|display_switch
id|fbcon_riva8
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_extern
r_struct
id|display_switch
id|fbcon_riva16
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_extern
r_struct
id|display_switch
id|fbcon_riva32
suffix:semicolon
macro_line|#endif
macro_line|#if 0
multiline_comment|/* describes the state of a Riva board */
r_struct
id|rivafb_par
(brace
r_struct
id|riva_regs
id|state
suffix:semicolon
multiline_comment|/* state of hw board */
id|__u32
id|visual
suffix:semicolon
multiline_comment|/* FB_VISUAL_xxx */
r_int
id|depth
suffix:semicolon
multiline_comment|/* bpp of current mode */
)brace
suffix:semicolon
macro_line|#endif
DECL|struct|riva_cursor
r_struct
id|riva_cursor
(brace
DECL|member|enable
r_int
id|enable
suffix:semicolon
DECL|member|on
r_int
id|on
suffix:semicolon
DECL|member|vbl_cnt
r_int
id|vbl_cnt
suffix:semicolon
DECL|member|last_move_delay
r_int
id|last_move_delay
suffix:semicolon
DECL|member|blink_rate
r_int
id|blink_rate
suffix:semicolon
r_struct
(brace
DECL|member|x
DECL|member|y
id|u16
id|x
comma
id|y
suffix:semicolon
DECL|member|pos
DECL|member|size
)brace
id|pos
comma
id|size
suffix:semicolon
DECL|member|image
r_int
r_int
id|image
(braket
id|MAX_CURS
op_star
id|MAX_CURS
)braket
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
op_star
id|timer
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * global variables&n; *&n; * ------------------------------------------------------------------------- */
DECL|variable|riva_boards
r_struct
id|rivafb_info
op_star
id|riva_boards
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* command line data, set in rivafb_setup() */
DECL|variable|__initdata
r_static
r_char
id|fontname
(braket
l_int|40
)braket
id|__initdata
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|noaccel
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|nomove
r_static
r_char
id|nomove
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|nohwcursor
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|noblink
r_static
r_char
id|noblink
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
DECL|variable|__initdata
r_static
r_char
id|nomtrr
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifndef MODULE
DECL|variable|__initdata
r_static
r_char
op_star
id|mode_option
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
macro_line|#else
DECL|variable|font
r_static
r_char
op_star
id|font
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
DECL|variable|rivafb_default_var
r_static
r_struct
id|fb_var_screeninfo
id|rivafb_default_var
op_assign
(brace
id|xres
suffix:colon
l_int|640
comma
id|yres
suffix:colon
l_int|480
comma
id|xres_virtual
suffix:colon
l_int|640
comma
id|yres_virtual
suffix:colon
l_int|480
comma
id|xoffset
suffix:colon
l_int|0
comma
id|yoffset
suffix:colon
l_int|0
comma
id|bits_per_pixel
suffix:colon
l_int|8
comma
id|grayscale
suffix:colon
l_int|0
comma
id|red
suffix:colon
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
id|green
suffix:colon
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
id|blue
suffix:colon
(brace
l_int|0
comma
l_int|6
comma
l_int|0
)brace
comma
id|transp
suffix:colon
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
id|nonstd
suffix:colon
l_int|0
comma
id|activate
suffix:colon
l_int|0
comma
id|height
suffix:colon
op_minus
l_int|1
comma
id|width
suffix:colon
op_minus
l_int|1
comma
id|accel_flags
suffix:colon
l_int|0
comma
id|pixclock
suffix:colon
l_int|39721
comma
id|left_margin
suffix:colon
l_int|40
comma
id|right_margin
suffix:colon
l_int|24
comma
id|upper_margin
suffix:colon
l_int|32
comma
id|lower_margin
suffix:colon
l_int|11
comma
id|hsync_len
suffix:colon
l_int|96
comma
id|vsync_len
suffix:colon
l_int|2
comma
id|sync
suffix:colon
l_int|0
comma
id|vmode
suffix:colon
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
multiline_comment|/* from GGI */
DECL|variable|reg_template
r_static
r_const
r_struct
id|riva_regs
id|reg_template
op_assign
(brace
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
multiline_comment|/* ATTR */
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x0C
comma
l_int|0x0D
comma
l_int|0x0E
comma
l_int|0x0F
comma
l_int|0x41
comma
l_int|0x01
comma
l_int|0x0F
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* CRT  */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x20
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xE3
comma
multiline_comment|/* 0x10 */
l_int|0xFF
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x20 */
l_int|0x40
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x30 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x40 */
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x05
comma
l_int|0x0F
comma
multiline_comment|/* GRA  */
l_int|0xFF
)brace
comma
(brace
l_int|0x03
comma
l_int|0x01
comma
l_int|0x0F
comma
l_int|0x00
comma
l_int|0x0E
)brace
comma
multiline_comment|/* SEQ  */
l_int|0xEB
multiline_comment|/* MISC */
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * MMIO access macros&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|CRTCout
r_static
r_inline
r_void
id|CRTCout
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3d4
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3d5
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|CRTCin
r_static
r_inline
r_int
r_char
id|CRTCin
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3d4
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3d5
)paren
)paren
suffix:semicolon
)brace
DECL|function|GRAout
r_static
r_inline
r_void
id|GRAout
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3ce
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3cf
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|GRAin
r_static
r_inline
r_int
r_char
id|GRAin
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3ce
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3cf
)paren
)paren
suffix:semicolon
)brace
DECL|function|SEQout
r_static
r_inline
r_void
id|SEQout
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3c4
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3c5
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|SEQin
r_static
r_inline
r_int
r_char
id|SEQin
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3c4
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3c5
)paren
)paren
suffix:semicolon
)brace
DECL|function|ATTRout
r_static
r_inline
r_void
id|ATTRout
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|ATTRin
r_static
r_inline
r_int
r_char
id|ATTRin
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|rinfo-&gt;riva.PCIO
comma
l_int|0x3c1
)paren
)paren
suffix:semicolon
)brace
DECL|function|MISCout
r_static
r_inline
r_void
id|MISCout
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3c2
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|MISCin
r_static
r_inline
r_int
r_char
id|MISCin
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_return
(paren
id|VGA_RD08
c_func
(paren
id|rinfo-&gt;riva.PVIO
comma
l_int|0x3cc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * cursor stuff&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/**&n; * riva_cursor_timer_handler - blink timer&n; * @dev_addr: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Cursor blink timer.&n; */
DECL|function|riva_cursor_timer_handler
r_static
r_void
id|riva_cursor_timer_handler
c_func
(paren
r_int
r_int
id|dev_addr
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|dev_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;cursor
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;cursor-&gt;enable
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;cursor-&gt;last_move_delay
OL
l_int|1000
)paren
id|rinfo-&gt;cursor-&gt;last_move_delay
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;cursor-&gt;vbl_cnt
op_logical_and
op_decrement
id|rinfo-&gt;cursor-&gt;vbl_cnt
op_eq
l_int|0
)paren
(brace
id|rinfo-&gt;cursor-&gt;on
op_xor_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;cursor-&gt;on
)paren
op_star
(paren
id|rinfo-&gt;riva.CURSORPOS
)paren
op_assign
(paren
id|rinfo-&gt;cursor-&gt;pos.x
op_amp
l_int|0xFFFF
)paren
op_or
(paren
id|rinfo-&gt;cursor-&gt;pos.y
op_lshift
l_int|16
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
id|rinfo-&gt;cursor-&gt;on
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|noblink
)paren
id|rinfo-&gt;cursor-&gt;vbl_cnt
op_assign
id|rinfo-&gt;cursor-&gt;blink_rate
suffix:semicolon
)brace
id|out
suffix:colon
id|rinfo-&gt;cursor-&gt;timer-&gt;expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
id|add_timer
c_func
(paren
id|rinfo-&gt;cursor-&gt;timer
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_init_cursor - allocates cursor structure and starts blink timer&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Allocates cursor structure and starts blink timer.&n; *&n; * RETURNS:&n; * Pointer to allocated cursor structure.&n; *&n; * CALLED FROM:&n; * rivafb_init_one()&n; */
DECL|function|rivafb_init_cursor
r_static
r_struct
id|riva_cursor
op_star
id|__init
id|rivafb_init_cursor
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|riva_cursor
op_star
id|cursor
suffix:semicolon
id|cursor
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|riva_cursor
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|cursor
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cursor
)paren
)paren
suffix:semicolon
id|cursor-&gt;timer
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cursor-&gt;timer
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor-&gt;timer
)paren
(brace
id|kfree
c_func
(paren
id|cursor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cursor-&gt;timer
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cursor-&gt;timer
)paren
)paren
suffix:semicolon
id|cursor-&gt;blink_rate
op_assign
id|DEFAULT_CURSOR_BLINK_RATE
suffix:semicolon
id|init_timer
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
id|cursor-&gt;timer-&gt;expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
id|cursor-&gt;timer-&gt;data
op_assign
(paren
r_int
r_int
)paren
id|rinfo
suffix:semicolon
id|cursor-&gt;timer-&gt;function
op_assign
id|riva_cursor_timer_handler
suffix:semicolon
id|add_timer
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
r_return
id|cursor
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_exit_cursor - stops blink timer and releases cursor structure&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Stops blink timer and releases cursor structure.&n; *&n; * CALLED FROM:&n; * rivafb_init_one()&n; * rivafb_remove_one()&n; */
DECL|function|rivafb_exit_cursor
r_static
r_void
id|rivafb_exit_cursor
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|riva_cursor
op_star
id|cursor
op_assign
id|rinfo-&gt;cursor
suffix:semicolon
r_if
c_cond
(paren
id|cursor
)paren
(brace
r_if
c_cond
(paren
id|cursor-&gt;timer
)paren
(brace
id|del_timer_sync
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cursor-&gt;timer
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|cursor
)paren
suffix:semicolon
id|rinfo-&gt;cursor
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * rivafb_download_cursor - writes cursor shape into card registers&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Writes cursor shape into card registers.&n; *&n; * CALLED FROM:&n; * riva_load_video_mode()&n; */
DECL|function|rivafb_download_cursor
r_static
r_void
id|rivafb_download_cursor
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_int
id|i
comma
id|save
suffix:semicolon
r_int
op_star
id|image
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;cursor
)paren
r_return
suffix:semicolon
id|image
op_assign
(paren
r_int
op_star
)paren
id|rinfo-&gt;cursor-&gt;image
suffix:semicolon
id|save
op_assign
id|rinfo-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|MAX_CURS
op_star
id|MAX_CURS
op_star
l_int|2
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
id|writel
c_func
(paren
id|image
(braket
id|i
)braket
comma
id|rinfo-&gt;riva.CURSOR
op_plus
id|i
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
id|save
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_create_cursor - sets rectangular cursor&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; * @width: cursor width in pixels&n; * @height: cursor height in pixels&n; *&n; * DESCRIPTION:&n; * Sets rectangular cursor.&n; *&n; * CALLED FROM:&n; * rivafb_set_font()&n; * rivafb_set_var()&n; */
DECL|function|rivafb_create_cursor
r_static
r_void
id|rivafb_create_cursor
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
r_struct
id|riva_cursor
op_star
id|c
op_assign
id|rinfo-&gt;cursor
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|c
)paren
(brace
r_if
c_cond
(paren
id|width
op_le
l_int|0
op_logical_or
id|height
op_le
l_int|0
)paren
(brace
id|width
op_assign
l_int|8
suffix:semicolon
id|height
op_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
OG
id|MAX_CURS
)paren
id|width
op_assign
id|MAX_CURS
suffix:semicolon
r_if
c_cond
(paren
id|height
OG
id|MAX_CURS
)paren
id|height
op_assign
id|MAX_CURS
suffix:semicolon
id|c-&gt;size.x
op_assign
id|width
suffix:semicolon
id|c-&gt;size.y
op_assign
id|height
suffix:semicolon
id|idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|height
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|width
suffix:semicolon
id|j
op_increment
comma
id|idx
op_increment
)paren
id|c-&gt;image
(braket
id|idx
)braket
op_assign
id|CURSOR_COLOR
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|width
suffix:semicolon
id|j
OL
id|MAX_CURS
suffix:semicolon
id|j
op_increment
comma
id|idx
op_increment
)paren
id|c-&gt;image
(braket
id|idx
)braket
op_assign
id|TRANSPARENT_COLOR
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|height
suffix:semicolon
id|i
OL
id|MAX_CURS
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAX_CURS
suffix:semicolon
id|j
op_increment
comma
id|idx
op_increment
)paren
id|c-&gt;image
(braket
id|idx
)braket
op_assign
id|TRANSPARENT_COLOR
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * rivafb_set_font - change font size&n; * @p: pointer to display object&n; * @width: font width in pixels&n; * @height: font height in pixels&n; *&n; * DESCRIPTION:&n; * Callback function called if font settings changed.&n; *&n; * RETURNS:&n; * 1 (Always succeeds.)&n; */
DECL|function|rivafb_set_font
r_static
r_int
id|rivafb_set_font
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
r_struct
id|rivafb_info
op_star
id|fb
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
(paren
id|p-&gt;fb_info
)paren
suffix:semicolon
id|rivafb_create_cursor
c_func
(paren
id|fb
comma
id|width
comma
id|height
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_cursor - cursor handler&n; * @p: pointer to display object&n; * @mode: cursor mode (see CM_*)&n; * @x: cursor x coordinate in characters&n; * @y: cursor y coordinate in characters&n; *&n; * DESCRIPTION:&n; * Cursor handler.&n; */
DECL|function|rivafb_cursor
r_static
r_void
id|rivafb_cursor
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|mode
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
(paren
id|p-&gt;fb_info
)paren
suffix:semicolon
r_struct
id|riva_cursor
op_star
id|c
op_assign
id|rinfo-&gt;cursor
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_return
suffix:semicolon
id|x
op_assign
id|x
op_star
id|fontwidth
c_func
(paren
id|p
)paren
op_minus
id|p-&gt;var.xoffset
suffix:semicolon
id|y
op_assign
id|y
op_star
id|fontheight
c_func
(paren
id|p
)paren
op_minus
id|p-&gt;var.yoffset
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;pos.x
op_eq
id|x
op_logical_and
id|c-&gt;pos.y
op_eq
id|y
op_logical_and
(paren
id|mode
op_eq
id|CM_ERASE
)paren
op_eq
op_logical_neg
id|c-&gt;enable
)paren
r_return
suffix:semicolon
id|c-&gt;enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;on
)paren
id|rinfo-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|c-&gt;pos.x
op_assign
id|x
suffix:semicolon
id|c-&gt;pos.y
op_assign
id|y
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|c-&gt;on
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_DRAW
suffix:colon
r_case
id|CM_MOVE
suffix:colon
r_if
c_cond
(paren
id|c-&gt;last_move_delay
op_le
l_int|1
)paren
(brace
multiline_comment|/* rapid cursor movement */
id|c-&gt;vbl_cnt
op_assign
id|CURSOR_SHOW_DELAY
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|rinfo-&gt;riva.CURSORPOS
)paren
op_assign
(paren
id|x
op_amp
l_int|0xFFFF
)paren
op_or
(paren
id|y
op_lshift
l_int|16
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|noblink
)paren
id|c-&gt;vbl_cnt
op_assign
id|CURSOR_HIDE_DELAY
suffix:semicolon
id|c-&gt;on
op_assign
l_int|1
suffix:semicolon
)brace
id|c-&gt;last_move_delay
op_assign
l_int|0
suffix:semicolon
id|c-&gt;enable
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * general utility functions&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/**&n; * riva_set_dispsw - sets dispsw&n; * @rinfo: pointer to internal driver struct for a given Riva card&n; * @disp: pointer to display object&n; *&n; * DESCRIPTION:&n; * Sets up console low level operations depending on the current? color depth&n; * of the display.&n; *&n; * CALLED FROM:&n; * rivafb_set_var()&n; * rivafb_switch()&n; * riva_init_disp()&n; */
DECL|function|riva_set_dispsw
r_static
r_void
id|riva_set_dispsw
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_struct
id|display
op_star
id|disp
)paren
(brace
r_int
id|accel
op_assign
id|disp-&gt;var.accel_flags
op_amp
id|FB_ACCELF_TEXT
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rinfo
op_ne
l_int|NULL
)paren
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
l_int|NULL
suffix:semicolon
id|disp-&gt;type
op_assign
id|FB_TYPE_PACKED_PIXELS
suffix:semicolon
id|disp-&gt;type_aux
op_assign
l_int|0
suffix:semicolon
id|disp-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
id|disp-&gt;can_soft_blank
op_assign
l_int|1
suffix:semicolon
id|disp-&gt;inverse
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|disp-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|rinfo-&gt;dispsw
op_assign
id|accel
ques
c_cond
id|fbcon_riva8
suffix:colon
id|fbcon_cfb8
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|rinfo-&gt;dispsw
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_PSEUDOCOLOR
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
id|rinfo-&gt;dispsw
op_assign
id|accel
ques
c_cond
id|fbcon_riva16
suffix:colon
id|fbcon_cfb16
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
op_amp
id|rinfo-&gt;con_cmap.cfb16
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|rinfo-&gt;dispsw
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
op_star
l_int|2
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|rinfo-&gt;dispsw
op_assign
id|accel
ques
c_cond
id|fbcon_riva32
suffix:colon
id|fbcon_cfb32
suffix:semicolon
id|disp-&gt;dispsw_data
op_assign
id|rinfo-&gt;con_cmap.cfb32
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|rinfo-&gt;dispsw
suffix:semicolon
id|disp-&gt;line_length
op_assign
id|disp-&gt;var.xres_virtual
op_star
l_int|4
suffix:semicolon
id|disp-&gt;visual
op_assign
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;Setting fbcon_dummy renderer&bslash;n&quot;
)paren
suffix:semicolon
id|rinfo-&gt;dispsw
op_assign
id|fbcon_dummy
suffix:semicolon
id|disp-&gt;dispsw
op_assign
op_amp
id|rinfo-&gt;dispsw
suffix:semicolon
)brace
multiline_comment|/* FIXME: verify that the above code sets dsp-&gt;* fields correctly */
r_if
c_cond
(paren
id|rinfo-&gt;cursor
)paren
(brace
id|rinfo-&gt;dispsw.cursor
op_assign
id|rivafb_cursor
suffix:semicolon
id|rinfo-&gt;dispsw.set_font
op_assign
id|rivafb_set_font
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_wclut - set CLUT entry&n; * @chip: pointer to RIVA_HW_INST object&n; * @regnum: register number&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; *&n; * DESCRIPTION:&n; * Sets color register @regnum.&n; *&n; * CALLED FROM:&n; * rivafb_setcolreg()&n; */
DECL|function|riva_wclut
r_static
r_void
id|riva_wclut
c_func
(paren
id|RIVA_HW_INST
op_star
id|chip
comma
r_int
r_char
id|regnum
comma
r_int
r_char
id|red
comma
r_int
r_char
id|green
comma
r_int
r_char
id|blue
)paren
(brace
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c8
comma
id|regnum
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|red
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|green
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|blue
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_save_state - saves current chip state&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; * @regs: pointer to riva_regs object&n; *&n; * DESCRIPTION:&n; * Saves current chip state to @regs.&n; *&n; * CALLED FROM:&n; * rivafb_init_one()&n; */
multiline_comment|/* from GGI */
DECL|function|riva_save_state
r_static
r_void
id|riva_save_state
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_struct
id|riva_regs
op_star
id|regs
)paren
(brace
r_int
id|i
suffix:semicolon
id|rinfo-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|UnloadStateExt
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
op_amp
id|regs-&gt;ext
)paren
suffix:semicolon
id|regs-&gt;misc_output
op_assign
id|MISCin
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CRT_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regs-&gt;crtc
(braket
id|i
)braket
op_assign
id|CRTCin
c_func
(paren
id|rinfo
comma
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATC_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regs-&gt;attr
(braket
id|i
)braket
op_assign
id|ATTRin
c_func
(paren
id|rinfo
comma
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_GRC_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regs-&gt;gra
(braket
id|i
)braket
op_assign
id|GRAin
c_func
(paren
id|rinfo
comma
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_SEQ_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regs-&gt;seq
(braket
id|i
)braket
op_assign
id|SEQin
c_func
(paren
id|rinfo
comma
id|i
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * riva_load_state - loads current chip state&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; * @regs: pointer to riva_regs object&n; *&n; * DESCRIPTION:&n; * Loads chip state from @regs.&n; *&n; * CALLED FROM:&n; * riva_load_video_mode()&n; * rivafb_init_one()&n; * rivafb_remove_one()&n; */
multiline_comment|/* from GGI */
DECL|function|riva_load_state
r_static
r_void
id|riva_load_state
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_struct
id|riva_regs
op_star
id|regs
)paren
(brace
r_int
id|i
suffix:semicolon
id|RIVA_HW_STATE
op_star
id|state
op_assign
op_amp
id|regs-&gt;ext
suffix:semicolon
id|CRTCout
c_func
(paren
id|rinfo
comma
l_int|0x11
comma
l_int|0x00
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|LoadStateExt
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
id|state
)paren
suffix:semicolon
id|MISCout
c_func
(paren
id|rinfo
comma
id|regs-&gt;misc_output
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CRT_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0x19
suffix:colon
r_case
l_int|0x20
dot
dot
dot
l_int|0x40
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|CRTCout
c_func
(paren
id|rinfo
comma
id|i
comma
id|regs-&gt;crtc
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATC_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ATTRout
c_func
(paren
id|rinfo
comma
id|i
comma
id|regs-&gt;attr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_GRC_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|GRAout
c_func
(paren
id|rinfo
comma
id|i
comma
id|regs-&gt;gra
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_SEQ_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SEQout
c_func
(paren
id|rinfo
comma
id|i
comma
id|regs-&gt;seq
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * riva_load_video_mode - calculate timings&n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; * @video_mode: video mode to set&n; *&n; * DESCRIPTION:&n; * Calculate some timings and then send em off to riva_load_state().&n; *&n; * CALLED FROM:&n; * rivafb_set_var()&n; */
DECL|function|riva_load_video_mode
r_static
r_void
id|riva_load_video_mode
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|video_mode
)paren
(brace
r_struct
id|riva_regs
id|newmode
suffix:semicolon
r_int
id|bpp
comma
id|width
comma
id|hDisplaySize
comma
id|hDisplay
comma
id|hStart
comma
id|hEnd
comma
id|hTotal
comma
id|height
comma
id|vDisplay
comma
id|vStart
comma
id|vEnd
comma
id|vTotal
comma
id|dotClock
suffix:semicolon
multiline_comment|/* time to calculate */
id|rivafb_blank
c_func
(paren
l_int|1
comma
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
suffix:semicolon
id|bpp
op_assign
id|video_mode-&gt;bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|bpp
op_eq
l_int|16
op_logical_and
id|video_mode-&gt;green.length
op_eq
l_int|5
)paren
id|bpp
op_assign
l_int|15
suffix:semicolon
id|width
op_assign
id|video_mode-&gt;xres_virtual
suffix:semicolon
id|hDisplaySize
op_assign
id|video_mode-&gt;xres
suffix:semicolon
id|hDisplay
op_assign
(paren
id|hDisplaySize
op_div
l_int|8
)paren
op_minus
l_int|1
suffix:semicolon
id|hStart
op_assign
(paren
id|hDisplaySize
op_plus
id|video_mode-&gt;right_margin
)paren
op_div
l_int|8
op_plus
l_int|2
suffix:semicolon
id|hEnd
op_assign
(paren
id|hDisplaySize
op_plus
id|video_mode-&gt;right_margin
op_plus
id|video_mode-&gt;hsync_len
)paren
op_div
l_int|8
op_minus
l_int|1
suffix:semicolon
id|hTotal
op_assign
(paren
id|hDisplaySize
op_plus
id|video_mode-&gt;right_margin
op_plus
id|video_mode-&gt;hsync_len
op_plus
id|video_mode-&gt;left_margin
)paren
op_div
l_int|8
op_minus
l_int|1
suffix:semicolon
id|height
op_assign
id|video_mode-&gt;yres_virtual
suffix:semicolon
id|vDisplay
op_assign
id|video_mode-&gt;yres
op_minus
l_int|1
suffix:semicolon
id|vStart
op_assign
id|video_mode-&gt;yres
op_plus
id|video_mode-&gt;lower_margin
op_minus
l_int|1
suffix:semicolon
id|vEnd
op_assign
id|video_mode-&gt;yres
op_plus
id|video_mode-&gt;lower_margin
op_plus
id|video_mode-&gt;vsync_len
op_minus
l_int|1
suffix:semicolon
id|vTotal
op_assign
id|video_mode-&gt;yres
op_plus
id|video_mode-&gt;lower_margin
op_plus
id|video_mode-&gt;vsync_len
op_plus
id|video_mode-&gt;upper_margin
op_plus
l_int|2
suffix:semicolon
id|dotClock
op_assign
l_int|1000000000
op_div
id|video_mode-&gt;pixclock
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|newmode
comma
op_amp
id|reg_template
comma
r_sizeof
(paren
r_struct
id|riva_regs
)paren
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x0
)braket
op_assign
id|Set8Bits
(paren
id|hTotal
op_minus
l_int|4
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x1
)braket
op_assign
id|Set8Bits
(paren
id|hDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x2
)braket
op_assign
id|Set8Bits
(paren
id|hDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x3
)braket
op_assign
id|SetBitField
(paren
id|hTotal
comma
l_int|4
suffix:colon
l_int|0
comma
l_int|4
suffix:colon
l_int|0
)paren
op_or
id|SetBit
(paren
l_int|7
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x4
)braket
op_assign
id|Set8Bits
(paren
id|hStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x5
)braket
op_assign
id|SetBitField
(paren
id|hTotal
comma
l_int|5
suffix:colon
l_int|5
comma
l_int|7
suffix:colon
l_int|7
)paren
op_or
id|SetBitField
(paren
id|hEnd
comma
l_int|4
suffix:colon
l_int|0
comma
l_int|4
suffix:colon
l_int|0
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x6
)braket
op_assign
id|SetBitField
(paren
id|vTotal
comma
l_int|7
suffix:colon
l_int|0
comma
l_int|7
suffix:colon
l_int|0
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x7
)braket
op_assign
id|SetBitField
(paren
id|vTotal
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|0
suffix:colon
l_int|0
)paren
op_or
id|SetBitField
(paren
id|vDisplay
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|1
suffix:colon
l_int|1
)paren
op_or
id|SetBitField
(paren
id|vStart
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|2
suffix:colon
l_int|2
)paren
op_or
id|SetBitField
(paren
id|vDisplay
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|3
suffix:colon
l_int|3
)paren
op_or
id|SetBit
(paren
l_int|4
)paren
op_or
id|SetBitField
(paren
id|vTotal
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|5
suffix:colon
l_int|5
)paren
op_or
id|SetBitField
(paren
id|vDisplay
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|6
suffix:colon
l_int|6
)paren
op_or
id|SetBitField
(paren
id|vStart
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|7
suffix:colon
l_int|7
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x9
)braket
op_assign
id|SetBitField
(paren
id|vDisplay
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|5
suffix:colon
l_int|5
)paren
op_or
id|SetBit
(paren
l_int|6
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x10
)braket
op_assign
id|Set8Bits
(paren
id|vStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x11
)braket
op_assign
id|SetBitField
(paren
id|vEnd
comma
l_int|3
suffix:colon
l_int|0
comma
l_int|3
suffix:colon
l_int|0
)paren
op_or
id|SetBit
(paren
l_int|5
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x12
)braket
op_assign
id|Set8Bits
(paren
id|vDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x13
)braket
op_assign
(paren
(paren
id|width
op_div
l_int|8
)paren
op_star
(paren
(paren
id|bpp
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x15
)braket
op_assign
id|Set8Bits
(paren
id|vDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x16
)braket
op_assign
id|Set8Bits
(paren
id|vTotal
op_plus
l_int|1
)paren
suffix:semicolon
id|newmode.ext.bpp
op_assign
id|bpp
suffix:semicolon
id|newmode.ext.width
op_assign
id|width
suffix:semicolon
id|newmode.ext.height
op_assign
id|height
suffix:semicolon
id|rinfo-&gt;riva
dot
id|CalcStateExt
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
op_amp
id|newmode.ext
comma
id|bpp
comma
id|width
comma
id|hDisplaySize
comma
id|hDisplay
comma
id|hStart
comma
id|hEnd
comma
id|hTotal
comma
id|height
comma
id|vDisplay
comma
id|vStart
comma
id|vEnd
comma
id|vTotal
comma
id|dotClock
)paren
suffix:semicolon
id|rinfo-&gt;current_state
op_assign
id|newmode
suffix:semicolon
id|riva_load_state
c_func
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;current_state
)paren
suffix:semicolon
id|rinfo-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* important for HW cursor */
id|rivafb_download_cursor
c_func
(paren
id|rinfo
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_board_list_add - maintains board list&n; * @board_list: root node of list of boards&n; * @new_node: new node to be added&n; *&n; * DESCRIPTION:&n; * Adds @new_node to the list referenced by @board_list.&n; *&n; * RETURNS:&n; * New root node&n; *&n; * CALLED FROM:&n; * rivafb_init_one()&n; */
DECL|function|riva_board_list_add
r_static
r_struct
id|rivafb_info
op_star
id|riva_board_list_add
c_func
(paren
r_struct
id|rivafb_info
op_star
id|board_list
comma
r_struct
id|rivafb_info
op_star
id|new_node
)paren
(brace
r_struct
id|rivafb_info
op_star
id|i_p
op_assign
id|board_list
suffix:semicolon
id|new_node-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|board_list
op_eq
l_int|NULL
)paren
r_return
id|new_node
suffix:semicolon
r_while
c_loop
(paren
id|i_p-&gt;next
op_ne
l_int|NULL
)paren
id|i_p
op_assign
id|i_p-&gt;next
suffix:semicolon
id|i_p-&gt;next
op_assign
id|new_node
suffix:semicolon
r_return
id|board_list
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_board_list_del - maintains board list&n; * @board_list: root node of list of boards&n; * @del_node: node to be removed&n; *&n; * DESCRIPTION:&n; * Removes @del_node from the list referenced by @board_list.&n; *&n; * RETURNS:&n; * New root node&n; *&n; * CALLED FROM:&n; * rivafb_remove_one()&n; */
DECL|function|riva_board_list_del
r_static
r_struct
id|rivafb_info
op_star
id|riva_board_list_del
c_func
(paren
r_struct
id|rivafb_info
op_star
id|board_list
comma
r_struct
id|rivafb_info
op_star
id|del_node
)paren
(brace
r_struct
id|rivafb_info
op_star
id|i_p
op_assign
id|board_list
suffix:semicolon
r_if
c_cond
(paren
id|board_list
op_eq
id|del_node
)paren
r_return
id|del_node-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|i_p-&gt;next
op_ne
id|del_node
)paren
id|i_p
op_assign
id|i_p-&gt;next
suffix:semicolon
id|i_p-&gt;next
op_assign
id|del_node-&gt;next
suffix:semicolon
r_return
id|board_list
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_do_maximize - &n; * @rinfo: pointer to rivafb_info object containing info for current riva board&n; * @var:&n; * @v:&n; * @nom:&n; * @den:&n; *&n; * DESCRIPTION:&n; * .&n; *&n; * RETURNS:&n; * -EINVAL on failure, 0 on success&n; * &n; *&n; * CALLED FROM:&n; * rivafb_set_var()&n; */
DECL|function|rivafb_do_maximize
r_static
r_int
id|rivafb_do_maximize
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_var_screeninfo
op_star
id|v
comma
r_int
id|nom
comma
r_int
id|den
)paren
(brace
r_static
r_struct
(brace
r_int
id|xres
comma
id|yres
suffix:semicolon
)brace
id|modes
(braket
)braket
op_assign
(brace
(brace
l_int|1600
comma
l_int|1280
)brace
comma
(brace
l_int|1280
comma
l_int|1024
)brace
comma
(brace
l_int|1024
comma
l_int|768
)brace
comma
(brace
l_int|800
comma
l_int|600
)brace
comma
(brace
l_int|640
comma
l_int|480
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* use highest possible virtual resolution */
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_eq
op_minus
l_int|1
op_logical_and
id|v-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;using maximum available virtual resolution&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|modes
(braket
id|i
)braket
dot
id|xres
op_ne
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_star
id|nom
op_div
id|den
op_star
id|modes
(braket
id|i
)braket
dot
id|yres
OL
id|rinfo-&gt;ram_amount
op_div
l_int|2
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;could not find a virtual resolution that fits into video memory!!&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - EINVAL error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|v-&gt;xres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|xres
suffix:semicolon
id|v-&gt;yres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|yres
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;virtual resolution set to maximum of %dx%d&bslash;n&quot;
comma
id|v-&gt;xres_virtual
comma
id|v-&gt;yres_virtual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|v-&gt;xres_virtual
op_assign
(paren
id|rinfo-&gt;ram_amount
op_star
id|den
op_div
(paren
id|nom
op_star
id|v-&gt;yres_virtual
op_star
l_int|2
)paren
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;setting virtual X resolution to %d&bslash;n&quot;
comma
id|v-&gt;xres_virtual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|v-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|v-&gt;xres_virtual
op_assign
(paren
id|v-&gt;xres_virtual
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|v-&gt;yres_virtual
op_assign
id|rinfo-&gt;ram_amount
op_star
id|den
op_div
(paren
id|nom
op_star
id|v-&gt;xres_virtual
op_star
l_int|2
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;setting virtual Y resolution to %d&bslash;n&quot;
comma
id|v-&gt;yres_virtual
)paren
suffix:semicolon
)brace
r_else
(brace
id|v-&gt;xres_virtual
op_assign
(paren
id|v-&gt;xres_virtual
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_star
id|v-&gt;yres_virtual
OG
id|rinfo-&gt;ram_amount
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;mode %dx%dx%d rejected...resolution too high to fit into video memory!&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - EINVAL error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|v-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_ge
l_int|8192
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;virtual X resolution (%d) is too high, lowering to %d&bslash;n&quot;
comma
id|v-&gt;xres_virtual
comma
l_int|8192
op_star
id|den
op_div
id|nom
op_minus
l_int|16
)paren
suffix:semicolon
id|v-&gt;xres_virtual
op_assign
l_int|8192
op_star
id|den
op_div
id|nom
op_minus
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v-&gt;xres_virtual
OL
id|v-&gt;xres
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;virtual X resolution (%d) is smaller than real&bslash;n&quot;
comma
id|v-&gt;xres_virtual
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v-&gt;yres_virtual
OL
id|v-&gt;yres
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;virtual Y resolution (%d) is smaller than real&bslash;n&quot;
comma
id|v-&gt;yres_virtual
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * internal fb_ops helper functions&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/**&n; * riva_get_cmap_len - query current color map length&n; * @var: standard kernel fb changeable data&n; *&n; * DESCRIPTION:&n; * Get current color map length.&n; *&n; * RETURNS:&n; * Length of color map&n; *&n; * CALLED FROM:&n; * riva_getcolreg()&n; * rivafb_setcolreg()&n; * rivafb_get_cmap()&n; * rivafb_set_cmap()&n; */
DECL|function|riva_get_cmap_len
r_static
r_int
id|riva_get_cmap_len
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|rc
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* reasonable default */
m_assert
(paren
id|var
op_ne
l_int|NULL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
id|rc
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* pseudocolor... 256 entries HW palette */
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|15
suffix:colon
id|rc
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* fix for 15 bpp depths on Riva 128 based cards */
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|rc
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* directcolor... 16 entries SW palette */
r_break
suffix:semicolon
multiline_comment|/* Mystique: truecolor, 16 entries SW palette, HW palette hardwired into 1:1 mapping */
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
id|rc
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* directcolor... 16 entries SW palette */
r_break
suffix:semicolon
multiline_comment|/* Mystique: truecolor, 16 entries SW palette, HW palette hardwired into 1:1 mapping */
macro_line|#endif
r_default
suffix:colon
multiline_comment|/* should not occur */
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_getcolreg&n; * @regno: register index&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; * @transp: transparency&n; * @info: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Read a single color register and split it into colors/transparent.&n; * The return values must have a 16 bit magnitude.&n; *&n; * RETURNS:&n; * Return != 0 for invalid regno.&n; *&n; * CALLED FROM:&n; * rivafb_get_cmap()&n; * rivafb_switch()&n; * fbcmap.c:fb_get_cmap()&n; *&t;fbgen.c:fbgen_get_cmap()&n; *&t;fbgen.c:fbgen_switch()&n; */
DECL|function|riva_getcolreg
r_static
r_int
id|riva_getcolreg
c_func
(paren
r_int
id|regno
comma
r_int
op_star
id|red
comma
r_int
op_star
id|green
comma
r_int
op_star
id|blue
comma
r_int
op_star
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|riva_get_cmap_len
c_func
(paren
op_amp
id|rivainfo-&gt;currcon_display-&gt;var
)paren
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|red
op_assign
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
suffix:semicolon
op_star
id|green
op_assign
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
suffix:semicolon
op_star
id|blue
op_assign
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
suffix:semicolon
op_star
id|transp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_setcolreg&n; * @regno: register index&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; * @transp: transparency&n; * @info: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Set a single color register. The values supplied have a 16 bit&n; * magnitude.&n; *&n; * RETURNS:&n; * Return != 0 for invalid regno.&n; *&n; * CALLED FROM:&n; * rivafb_set_cmap()&n; * fbcmap.c:fb_set_cmap()&n; *&t;fbgen.c:fbgen_get_cmap()&n; *&t;fbgen.c:fbgen_install_cmap()&n; *&t;&t;fbgen.c:fbgen_set_var()&n; *&t;&t;fbgen.c:fbgen_switch()&n; *&t;&t;fbgen.c:fbgen_blank()&n; *&t;fbgen.c:fbgen_blank()&n; */
DECL|function|rivafb_setcolreg
r_static
r_int
id|rivafb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|RIVA_HW_INST
op_star
id|chip
op_assign
op_amp
id|rivainfo-&gt;riva
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo-&gt;currcon_display
op_ne
l_int|NULL
)paren
suffix:semicolon
id|p
op_assign
id|rivainfo-&gt;currcon_display
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|riva_get_cmap_len
c_func
(paren
op_amp
id|p-&gt;var
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|red
op_assign
id|red
suffix:semicolon
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|green
op_assign
id|green
suffix:semicolon
id|rivainfo-&gt;palette
(braket
id|regno
)braket
dot
id|blue
op_assign
id|blue
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;var.grayscale
)paren
(brace
multiline_comment|/* gray = 0.30*R + 0.59*G + 0.11*B */
id|red
op_assign
id|green
op_assign
id|blue
op_assign
(paren
id|red
op_star
l_int|77
op_plus
id|green
op_star
l_int|151
op_plus
id|blue
op_star
l_int|28
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|p-&gt;var.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|8
suffix:colon
multiline_comment|/* &quot;transparent&quot; stuff is completely ignored. */
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB8 */
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|16
suffix:colon
m_assert
(paren
id|regno
OL
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;var.green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* 0rrrrrgg gggbbbbb */
id|rivainfo-&gt;con_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* rrrrrggg gggbbbbb */
id|rivainfo-&gt;con_cmap.cfb16
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|0
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|5
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB16 */
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|32
suffix:colon
m_assert
(paren
id|regno
OL
l_int|16
)paren
suffix:semicolon
id|rivainfo-&gt;con_cmap.cfb32
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* FBCON_HAS_CFB32 */
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * framebuffer operations&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|rivafb_get_fix
r_static
r_int
id|rivafb_get_fix
c_func
(paren
r_struct
id|fb_fix_screeninfo
op_star
id|fix
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|p
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|fix
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|info
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo-&gt;drvr_name
op_logical_and
id|rivainfo-&gt;drvr_name
(braket
l_int|0
)braket
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo-&gt;fb_base_phys
OG
l_int|0
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo-&gt;ram_amount
OG
l_int|0
)paren
suffix:semicolon
id|p
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
id|memset
c_func
(paren
id|fix
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fb_fix_screeninfo
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|fix-&gt;id
comma
l_string|&quot;nVidia %s&quot;
comma
id|rivainfo-&gt;drvr_name
)paren
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|rivainfo-&gt;fb_base_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|rivainfo-&gt;ram_amount
suffix:semicolon
id|fix-&gt;type
op_assign
id|p-&gt;type
suffix:semicolon
id|fix-&gt;type_aux
op_assign
id|p-&gt;type_aux
suffix:semicolon
id|fix-&gt;visual
op_assign
id|p-&gt;visual
suffix:semicolon
id|fix-&gt;xpanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ypanstep
op_assign
l_int|1
suffix:semicolon
id|fix-&gt;ywrapstep
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: no ywrap for now */
id|fix-&gt;line_length
op_assign
id|p-&gt;line_length
suffix:semicolon
id|fix-&gt;mmio_start
op_assign
id|rivainfo-&gt;ctrl_base_phys
suffix:semicolon
id|fix-&gt;mmio_len
op_assign
id|rivainfo-&gt;base0_region_size
suffix:semicolon
id|fix-&gt;smem_start
op_assign
id|rivainfo-&gt;fb_base_phys
suffix:semicolon
id|fix-&gt;smem_len
op_assign
id|rivainfo-&gt;base1_region_size
suffix:semicolon
r_switch
c_cond
(paren
id|rivainfo-&gt;riva.Architecture
)paren
(brace
r_case
id|NV_ARCH_03
suffix:colon
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NV3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NV_ARCH_04
suffix:colon
multiline_comment|/* riva_hw.c now doesn&squot;t distinguish between TNT &amp; TNT2 */
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NV4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NV_ARCH_10
suffix:colon
multiline_comment|/* FIXME: ID for GeForce */
id|fix-&gt;accel
op_assign
id|FB_ACCEL_NV4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_get_var
r_static
r_int
id|rivafb_get_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|info
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|var
op_ne
l_int|NULL
)paren
suffix:semicolon
op_star
id|var
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;disp.var
suffix:colon
id|fb_display
(braket
id|con
)braket
dot
id|var
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_set_var
r_static
r_int
id|rivafb_set_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|dsp
suffix:semicolon
r_struct
id|fb_var_screeninfo
id|v
suffix:semicolon
r_int
id|nom
comma
id|den
suffix:semicolon
multiline_comment|/* translating from pixels-&gt;bytes */
r_int
id|accel
suffix:semicolon
r_int
id|chgvar
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|info
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|var
op_ne
l_int|NULL
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Requested: %dx%dx%d&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  virtual: %dx%d&bslash;n&quot;
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;yres_virtual
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;   offset: (%d,%d)&bslash;n&quot;
comma
id|var-&gt;xoffset
comma
id|var-&gt;yoffset
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;grayscale: %d&bslash;n&quot;
comma
id|var-&gt;grayscale
)paren
suffix:semicolon
id|dsp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
m_assert
(paren
id|dsp
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* if var has changed, we should call changevar() later */
r_if
c_cond
(paren
id|con
op_ge
l_int|0
)paren
(brace
id|chgvar
op_assign
(paren
(paren
id|dsp-&gt;var.xres
op_ne
id|var-&gt;xres
)paren
op_logical_or
(paren
id|dsp-&gt;var.yres
op_ne
id|var-&gt;yres
)paren
op_logical_or
(paren
id|dsp-&gt;var.xres_virtual
op_ne
id|var-&gt;xres_virtual
)paren
op_logical_or
(paren
id|dsp-&gt;var.yres_virtual
op_ne
id|var-&gt;yres_virtual
)paren
op_logical_or
(paren
id|dsp-&gt;var.accel_flags
op_ne
id|var-&gt;accel_flags
)paren
op_logical_or
(paren
id|dsp-&gt;var.bits_per_pixel
op_ne
id|var-&gt;bits_per_pixel
)paren
op_logical_or
id|memcmp
c_func
(paren
op_amp
id|dsp-&gt;var.red
comma
op_amp
id|var-&gt;red
comma
r_sizeof
(paren
id|var-&gt;red
)paren
)paren
op_logical_or
id|memcmp
c_func
(paren
op_amp
id|dsp-&gt;var.green
comma
op_amp
id|var-&gt;green
comma
r_sizeof
(paren
id|var-&gt;green
)paren
)paren
op_logical_or
id|memcmp
c_func
(paren
op_amp
id|dsp-&gt;var.blue
comma
op_amp
id|var-&gt;blue
comma
r_sizeof
(paren
id|var-&gt;blue
)paren
)paren
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|v
comma
id|var
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
id|accel
op_assign
id|v.accel_flags
op_amp
id|FB_ACCELF_TEXT
suffix:semicolon
r_switch
c_cond
(paren
id|v.bits_per_pixel
)paren
(brace
macro_line|#ifdef FBCON_HAS_CFB8
r_case
l_int|1
dot
dot
dot
l_int|8
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|nom
op_assign
l_int|1
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|8
suffix:semicolon
id|v.green.offset
op_assign
l_int|0
suffix:semicolon
id|v.green.length
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB16
r_case
l_int|9
dot
dot
dot
l_int|15
suffix:colon
id|v.green.length
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|16
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|16
suffix:semicolon
id|nom
op_assign
l_int|2
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v.green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* 0rrrrrgg gggbbbbb */
id|v.red.offset
op_assign
l_int|10
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|5
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* rrrrrggg gggbbbbb */
id|v.red.offset
op_assign
l_int|11
suffix:semicolon
id|v.green.offset
op_assign
l_int|5
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|5
suffix:semicolon
id|v.green.length
op_assign
l_int|6
suffix:semicolon
id|v.blue.length
op_assign
l_int|5
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FBCON_HAS_CFB32
r_case
l_int|17
dot
dot
dot
l_int|32
suffix:colon
id|v.bits_per_pixel
op_assign
l_int|32
suffix:semicolon
id|nom
op_assign
l_int|4
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
id|v.red.offset
op_assign
l_int|16
suffix:semicolon
id|v.green.offset
op_assign
l_int|8
suffix:semicolon
id|v.blue.offset
op_assign
l_int|0
suffix:semicolon
id|v.red.length
op_assign
l_int|8
suffix:semicolon
id|v.green.length
op_assign
l_int|8
suffix:semicolon
id|v.blue.length
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;mode %dx%dx%d rejected...color depth not supported.&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning -EINVAL&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rivafb_do_maximize
c_func
(paren
id|rivainfo
comma
id|var
comma
op_amp
id|v
comma
id|nom
comma
id|den
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|v.xoffset
OL
l_int|0
)paren
id|v.xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OL
l_int|0
)paren
id|v.yoffset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* truncate xoffset and yoffset to maximum if too high */
r_if
c_cond
(paren
id|v.xoffset
OG
id|v.xres_virtual
op_minus
id|v.xres
)paren
id|v.xoffset
op_assign
id|v.xres_virtual
op_minus
id|v.xres
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|v.yoffset
OG
id|v.yres_virtual
op_minus
id|v.yres
)paren
id|v.yoffset
op_assign
id|v.yres_virtual
op_minus
id|v.yres
op_minus
l_int|1
suffix:semicolon
id|v.red.msb_right
op_assign
id|v.green.msb_right
op_assign
id|v.blue.msb_right
op_assign
id|v.transp.offset
op_assign
id|v.transp.length
op_assign
id|v.transp.msb_right
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|v.activate
op_amp
id|FB_ACTIVATE_MASK
)paren
(brace
r_case
id|FB_ACTIVATE_TEST
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - FB_ACTIVATE_TEST&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FB_ACTIVATE_NXTOPEN
suffix:colon
multiline_comment|/* ?? */
r_case
id|FB_ACTIVATE_NOW
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* continue */
r_default
suffix:colon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - unknown activation type&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* unknown */
)brace
id|memcpy
c_func
(paren
op_amp
id|dsp-&gt;var
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chgvar
)paren
(brace
id|riva_set_dispsw
c_func
(paren
id|rivainfo
comma
id|dsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
(brace
r_if
c_cond
(paren
id|nomove
)paren
id|dsp-&gt;scrollmode
op_assign
id|SCROLL_YNOMOVE
suffix:semicolon
r_else
id|dsp-&gt;scrollmode
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|dsp-&gt;scrollmode
op_assign
id|SCROLL_YREDRAW
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
id|info-&gt;changevar
)paren
id|info
op_member_access_from_pointer
id|changevar
c_func
(paren
id|con
)paren
suffix:semicolon
)brace
id|rivafb_create_cursor
c_func
(paren
id|rivainfo
comma
id|fontwidth
c_func
(paren
id|dsp
)paren
comma
id|fontheight
c_func
(paren
id|dsp
)paren
)paren
suffix:semicolon
id|riva_load_video_mode
c_func
(paren
id|rivainfo
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accel
)paren
id|riva_setup_accel
c_func
(paren
id|rivainfo
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_get_cmap
r_static
r_int
id|rivafb_get_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|dsp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|cmap
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dsp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
(brace
multiline_comment|/* current console? */
r_int
id|rc
op_assign
id|fb_get_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|riva_getcolreg
comma
id|info
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - returning %d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dsp-&gt;cmap.len
)paren
multiline_comment|/* non default colormap? */
id|fb_copy_cmap
c_func
(paren
op_amp
id|dsp-&gt;cmap
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
r_else
id|fb_copy_cmap
c_func
(paren
id|fb_default_cmap
(paren
id|riva_get_cmap_len
c_func
(paren
op_amp
id|dsp-&gt;var
)paren
)paren
comma
id|cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|2
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_set_cmap
r_static
r_int
id|rivafb_set_cmap
c_func
(paren
r_struct
id|fb_cmap
op_star
id|cmap
comma
r_int
id|kspc
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|display
op_star
id|dsp
suffix:semicolon
r_int
r_int
id|cmap_len
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|cmap
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dsp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
id|cmap_len
op_assign
id|riva_get_cmap_len
c_func
(paren
op_amp
id|dsp-&gt;var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dsp-&gt;cmap.len
op_ne
id|cmap_len
)paren
(brace
r_int
id|err
op_assign
id|fb_alloc_cmap
c_func
(paren
op_amp
id|dsp-&gt;cmap
comma
id|cmap_len
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - returning %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
(brace
multiline_comment|/* current console? */
r_int
id|rc
op_assign
id|fb_set_cmap
c_func
(paren
id|cmap
comma
id|kspc
comma
id|info
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT - returning %d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
id|fb_copy_cmap
c_func
(paren
id|cmap
comma
op_amp
id|dsp-&gt;cmap
comma
id|kspc
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_pan_display&n; * @var: standard kernel fb changeable data&n; * @con: TODO&n; * @info: pointer to rivafb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Pan (or wrap, depending on the `vmode&squot; field) the display using the&n; * `xoffset&squot; and `yoffset&squot; fields of the `var&squot; structure.&n; * If the values don&squot;t fit, return -EINVAL.&n; *&n; * This call looks only at xoffset, yoffset and the FB_VMODE_YWRAP flag&n; */
DECL|function|rivafb_pan_display
r_static
r_int
id|rivafb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|base
suffix:semicolon
r_struct
id|display
op_star
id|dsp
suffix:semicolon
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dsp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|dsp-&gt;var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|dsp-&gt;var.xres
OG
id|dsp-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|dsp-&gt;var.yres
OG
id|dsp-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
id|var-&gt;yoffset
op_star
id|dsp-&gt;line_length
op_plus
id|var-&gt;xoffset
suffix:semicolon
r_if
c_cond
(paren
id|con
op_eq
id|info-&gt;currcon
)paren
(brace
id|rivainfo-&gt;riva
dot
id|SetStartAddress
c_func
(paren
op_amp
id|rivainfo-&gt;riva
comma
id|base
)paren
suffix:semicolon
)brace
id|dsp-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|dsp-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|dsp-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|dsp-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_ioctl
r_static
r_int
id|rivafb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* no rivafb-specific ioctls */
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning -EINVAL&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|rivafb_rasterimg
r_static
r_int
id|rivafb_rasterimg
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|start
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|wait_for_idle
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_switch
r_static
r_int
id|rivafb_switch
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rivainfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
r_struct
id|fb_cmap
op_star
id|cmap
suffix:semicolon
r_struct
id|display
op_star
id|dsp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rivainfo
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dsp
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
id|rivainfo-&gt;info.disp
suffix:colon
op_amp
id|fb_display
(braket
id|con
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;currcon
op_ge
l_int|0
)paren
(brace
multiline_comment|/* Do we have to save the colormap? */
id|cmap
op_assign
op_amp
(paren
id|rivainfo-&gt;currcon_display-&gt;cmap
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;switch1: con = %d, cmap.len = %d&bslash;n&quot;
comma
id|info-&gt;currcon
comma
id|cmap-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmap-&gt;len
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;switch1a: %p %p %p %p&bslash;n&quot;
comma
id|cmap-&gt;red
comma
id|cmap-&gt;green
comma
id|cmap-&gt;blue
comma
id|cmap-&gt;transp
)paren
suffix:semicolon
id|fb_get_cmap
c_func
(paren
id|cmap
comma
l_int|1
comma
id|riva_getcolreg
comma
id|info
)paren
suffix:semicolon
)brace
)brace
id|info-&gt;currcon
op_assign
id|con
suffix:semicolon
id|rivainfo-&gt;currcon_display
op_assign
id|dsp
suffix:semicolon
id|rivafb_set_var
c_func
(paren
op_amp
id|dsp-&gt;var
comma
id|con
comma
id|info
)paren
suffix:semicolon
id|riva_set_dispsw
c_func
(paren
id|rivainfo
comma
id|dsp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_updatevar
r_static
r_int
id|rivafb_updatevar
c_func
(paren
r_int
id|con
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|rc
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
(paren
id|con
OL
l_int|0
)paren
ques
c_cond
op_minus
id|EINVAL
suffix:colon
id|rivafb_pan_display
c_func
(paren
op_amp
id|fb_display
(braket
id|con
)braket
dot
id|var
comma
id|con
comma
id|info
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning %d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|rivafb_blank
r_static
r_int
id|rivafb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_char
id|tmp
comma
id|vesa
suffix:semicolon
r_struct
id|rivafb_info
op_star
id|rinfo
op_assign
(paren
r_struct
id|rivafb_info
op_star
)paren
id|info
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rinfo
op_ne
l_int|NULL
)paren
suffix:semicolon
id|tmp
op_assign
id|SEQin
c_func
(paren
id|rinfo
comma
l_int|0x01
)paren
op_amp
op_complement
l_int|0x20
suffix:semicolon
multiline_comment|/* screen on/off */
id|vesa
op_assign
id|CRTCin
c_func
(paren
id|rinfo
comma
l_int|0x1a
)paren
op_amp
op_complement
l_int|0xc0
suffix:semicolon
multiline_comment|/* sync on/off */
r_if
c_cond
(paren
id|blank
)paren
(brace
id|tmp
op_or_assign
l_int|0x20
suffix:semicolon
r_switch
c_cond
(paren
id|blank
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|vesa
op_or_assign
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|vesa
op_or_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|vesa
op_or_assign
l_int|0xc0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|SEQout
c_func
(paren
id|rinfo
comma
l_int|0x01
comma
id|tmp
)paren
suffix:semicolon
id|CRTCout
c_func
(paren
id|rinfo
comma
l_int|0x1a
comma
id|vesa
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * initialization helper functions&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/* kernel interface */
DECL|variable|riva_fb_ops
r_static
r_struct
id|fb_ops
id|riva_fb_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|fb_get_fix
suffix:colon
id|rivafb_get_fix
comma
id|fb_get_var
suffix:colon
id|rivafb_get_var
comma
id|fb_set_var
suffix:colon
id|rivafb_set_var
comma
id|fb_get_cmap
suffix:colon
id|rivafb_get_cmap
comma
id|fb_set_cmap
suffix:colon
id|rivafb_set_cmap
comma
id|fb_setcolreg
suffix:colon
id|rivafb_setcolreg
comma
id|fb_pan_display
suffix:colon
id|rivafb_pan_display
comma
id|fb_blank
suffix:colon
id|rivafb_blank
comma
id|fb_ioctl
suffix:colon
id|rivafb_ioctl
comma
id|fb_rasterimg
suffix:colon
id|rivafb_rasterimg
comma
)brace
suffix:semicolon
DECL|function|riva_init_disp_var
r_static
r_int
id|__devinit
id|riva_init_disp_var
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|mode_option
)paren
id|fb_find_mode
c_func
(paren
op_amp
id|rinfo-&gt;disp.var
comma
op_amp
id|rinfo-&gt;info
comma
id|mode_option
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|8
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|riva_init_disp
r_static
r_int
id|__devinit
id|riva_init_disp
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
r_struct
id|display
op_star
id|disp
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|rinfo
op_ne
l_int|NULL
)paren
suffix:semicolon
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
id|disp
op_assign
op_amp
id|rinfo-&gt;disp
suffix:semicolon
id|disp-&gt;var
op_assign
id|rivafb_default_var
suffix:semicolon
r_if
c_cond
(paren
id|noaccel
)paren
id|disp-&gt;var.accel_flags
op_and_assign
op_complement
id|FB_ACCELF_TEXT
suffix:semicolon
r_else
id|disp-&gt;var.accel_flags
op_or_assign
id|FB_ACCELF_TEXT
suffix:semicolon
id|info-&gt;disp
op_assign
id|disp
suffix:semicolon
multiline_comment|/* FIXME: assure that disp-&gt;cmap is completely filled out */
id|rinfo-&gt;currcon_display
op_assign
id|disp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|riva_init_disp_var
c_func
(paren
id|rinfo
)paren
)paren
OL
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|riva_set_dispsw
c_func
(paren
id|rinfo
comma
id|disp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|riva_set_fbinfo
r_static
r_int
id|__devinit
id|riva_set_fbinfo
c_func
(paren
r_struct
id|rivafb_info
op_star
id|rinfo
)paren
(brace
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
m_assert
(paren
id|rinfo
op_ne
l_int|NULL
)paren
suffix:semicolon
id|info
op_assign
op_amp
id|rinfo-&gt;info
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;modename
comma
id|rinfo-&gt;drvr_name
)paren
suffix:semicolon
id|info-&gt;node
op_assign
id|NODEV
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_FLAG_DEFAULT
suffix:semicolon
id|info-&gt;fbops
op_assign
op_amp
id|riva_fb_ops
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|rinfo-&gt;fb_base
suffix:semicolon
multiline_comment|/* FIXME: set monspecs to what??? */
id|info-&gt;display_fg
op_assign
l_int|NULL
suffix:semicolon
id|info-&gt;currcon
op_assign
op_minus
l_int|1
suffix:semicolon
id|strncpy
c_func
(paren
id|info-&gt;fontname
comma
id|fontname
comma
r_sizeof
(paren
id|info-&gt;fontname
)paren
)paren
suffix:semicolon
id|info-&gt;fontname
(braket
r_sizeof
(paren
id|info-&gt;fontname
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|info-&gt;changevar
op_assign
l_int|NULL
suffix:semicolon
id|info-&gt;switch_con
op_assign
id|rivafb_switch
suffix:semicolon
id|info-&gt;updatevar
op_assign
id|rivafb_updatevar
suffix:semicolon
r_if
c_cond
(paren
id|riva_init_disp
c_func
(paren
id|rinfo
)paren
OL
l_int|0
)paren
multiline_comment|/* must be done last */
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * PCI bus&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|rivafb_init_one
r_static
r_int
id|__devinit
id|rivafb_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|rivafb_info
op_star
id|rinfo
suffix:semicolon
r_struct
id|riva_chip_info
op_star
id|rci
op_assign
op_amp
id|riva_chip_info
(braket
id|ent-&gt;driver_data
)braket
suffix:semicolon
m_assert
(paren
id|pd
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|rci
op_ne
l_int|NULL
)paren
suffix:semicolon
id|rinfo
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rivafb_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo
)paren
r_goto
id|err_out
suffix:semicolon
id|memset
c_func
(paren
id|rinfo
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rivafb_info
)paren
)paren
suffix:semicolon
id|rinfo-&gt;drvr_name
op_assign
id|rci-&gt;name
suffix:semicolon
id|rinfo-&gt;riva.Architecture
op_assign
id|rci-&gt;arch_rev
suffix:semicolon
id|rinfo-&gt;pd
op_assign
id|pd
suffix:semicolon
id|rinfo-&gt;base0_region_size
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;base1_region_size
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
l_int|1
)paren
suffix:semicolon
m_assert
(paren
id|rinfo-&gt;base0_region_size
op_ge
l_int|0x00800000
)paren
suffix:semicolon
multiline_comment|/* from GGI */
m_assert
(paren
id|rinfo-&gt;base1_region_size
op_ge
l_int|0x01000000
)paren
suffix:semicolon
multiline_comment|/* from GGI */
id|rinfo-&gt;ctrl_base_phys
op_assign
id|pci_resource_start
c_func
(paren
id|rinfo-&gt;pd
comma
l_int|0
)paren
suffix:semicolon
id|rinfo-&gt;fb_base_phys
op_assign
id|pci_resource_start
c_func
(paren
id|rinfo-&gt;pd
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|rinfo-&gt;ctrl_base_phys
comma
id|rinfo-&gt;base0_region_size
comma
l_string|&quot;rivafb&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot reserve MMIO region&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_kfree
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;base1_region_size
comma
l_string|&quot;rivafb&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot reserve FB region&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_base0
suffix:semicolon
)brace
id|rinfo-&gt;ctrl_base
op_assign
id|ioremap
c_func
(paren
id|rinfo-&gt;ctrl_base_phys
comma
id|rinfo-&gt;base0_region_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;ctrl_base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot ioremap MMIO base&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_base1
suffix:semicolon
)brace
id|rinfo-&gt;fb_base
op_assign
id|ioremap
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;base1_region_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rinfo-&gt;fb_base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot ioremap FB base&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap_ctrl
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
op_logical_neg
id|nomtrr
)paren
(brace
id|rinfo-&gt;mtrr.vram
op_assign
id|mtrr_add
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;base1_region_size
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rinfo-&gt;mtrr.vram
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to setup MTRR&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|rinfo-&gt;mtrr.vram_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* let there be speed */
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;RIVA MTRR set to ON&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_MTRR */
id|rinfo-&gt;riva.EnableIRQ
op_assign
l_int|0
suffix:semicolon
id|rinfo-&gt;riva.PRAMDAC
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00680000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PFB
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00100000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PFIFO
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00002000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PGRAPH
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00400000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PEXTDEV
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00101000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PTIMER
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00009000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PMC
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00000000
)paren
suffix:semicolon
id|rinfo-&gt;riva.FIFO
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00800000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PCIO
op_assign
(paren
id|U008
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00601000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PDIO
op_assign
(paren
id|U008
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00681000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PVIO
op_assign
(paren
id|U008
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x000C0000
)paren
suffix:semicolon
id|rinfo-&gt;riva.IO
op_assign
(paren
id|MISCin
c_func
(paren
id|rinfo
)paren
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|0x3D0
suffix:colon
l_int|0x3B0
suffix:semicolon
r_switch
c_cond
(paren
id|rinfo-&gt;riva.Architecture
)paren
(brace
r_case
id|NV_ARCH_03
suffix:colon
id|rinfo-&gt;riva.PRAMIN
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;fb_base
op_plus
l_int|0x00C00000
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NV_ARCH_04
suffix:colon
r_case
id|NV_ARCH_10
suffix:colon
id|rinfo-&gt;riva.PCRTC
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00600000
)paren
suffix:semicolon
id|rinfo-&gt;riva.PRAMIN
op_assign
(paren
r_int
op_star
)paren
(paren
id|rinfo-&gt;ctrl_base
op_plus
l_int|0x00710000
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|RivaGetConfig
c_func
(paren
op_amp
id|rinfo-&gt;riva
)paren
suffix:semicolon
multiline_comment|/* back to normal */
m_assert
(paren
id|rinfo-&gt;pd
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* unlock io */
id|CRTCout
c_func
(paren
id|rinfo
comma
l_int|0x11
comma
l_int|0xFF
)paren
suffix:semicolon
multiline_comment|/* vgaHWunlock() + riva unlock (0x7F) */
id|rinfo-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|rinfo-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|riva_save_state
c_func
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;initial_state
)paren
suffix:semicolon
id|rinfo-&gt;ram_amount
op_assign
id|rinfo-&gt;riva.RamAmountKBytes
op_star
l_int|1024
suffix:semicolon
id|rinfo-&gt;dclk_max
op_assign
id|rinfo-&gt;riva.MaxVClockFreqKHz
op_star
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nohwcursor
)paren
id|rinfo-&gt;cursor
op_assign
id|rivafb_init_cursor
c_func
(paren
id|rinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|riva_set_fbinfo
c_func
(paren
id|rinfo
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;error setting initial video mode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_cursor
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|rinfo
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;error registering riva framebuffer&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_load_state
suffix:semicolon
)brace
id|riva_boards
op_assign
id|riva_board_list_add
c_func
(paren
id|riva_boards
comma
id|rinfo
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pd
comma
id|rinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;PCI nVidia NV%d framebuffer ver %s (%s, %dMB @ 0x%lX)&bslash;n&quot;
comma
id|rinfo-&gt;riva.Architecture
comma
id|RIVAFB_VERSION
comma
id|rinfo-&gt;drvr_name
comma
id|rinfo-&gt;ram_amount
op_div
(paren
l_int|1024
op_star
l_int|1024
)paren
comma
id|rinfo-&gt;fb_base_phys
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_load_state
suffix:colon
id|riva_load_state
c_func
(paren
id|rinfo
comma
op_amp
id|rinfo-&gt;initial_state
)paren
suffix:semicolon
id|err_out_cursor
suffix:colon
id|rivafb_exit_cursor
c_func
(paren
id|rinfo
)paren
suffix:semicolon
multiline_comment|/* err_out_iounmap_fb: */
id|iounmap
c_func
(paren
id|rinfo-&gt;fb_base
)paren
suffix:semicolon
id|err_out_iounmap_ctrl
suffix:colon
id|iounmap
c_func
(paren
id|rinfo-&gt;ctrl_base
)paren
suffix:semicolon
id|err_out_free_base1
suffix:colon
id|release_mem_region
c_func
(paren
id|rinfo-&gt;fb_base_phys
comma
id|rinfo-&gt;base1_region_size
)paren
suffix:semicolon
id|err_out_free_base0
suffix:colon
id|release_mem_region
c_func
(paren
id|rinfo-&gt;ctrl_base_phys
comma
id|rinfo-&gt;base0_region_size
)paren
suffix:semicolon
id|err_out_kfree
suffix:colon
id|kfree
c_func
(paren
id|rinfo
)paren
suffix:semicolon
id|err_out
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|rivafb_remove_one
r_static
r_void
id|__devexit
id|rivafb_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
r_struct
id|rivafb_info
op_star
id|board
op_assign
id|pci_get_drvdata
c_func
(paren
id|pd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|board
)paren
r_return
suffix:semicolon
id|riva_boards
op_assign
id|riva_board_list_del
c_func
(paren
id|riva_boards
comma
id|board
)paren
suffix:semicolon
id|riva_load_state
c_func
(paren
id|board
comma
op_amp
id|board-&gt;initial_state
)paren
suffix:semicolon
id|unregister_framebuffer
c_func
(paren
(paren
r_struct
id|fb_info
op_star
)paren
id|board
)paren
suffix:semicolon
id|rivafb_exit_cursor
c_func
(paren
id|board
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
id|board-&gt;mtrr.vram_valid
)paren
id|mtrr_del
c_func
(paren
id|board-&gt;mtrr.vram
comma
id|board-&gt;fb_base_phys
comma
id|board-&gt;base1_region_size
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MTRR */
id|iounmap
c_func
(paren
id|board-&gt;ctrl_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|board-&gt;fb_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|board-&gt;ctrl_base_phys
comma
id|board-&gt;base0_region_size
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|board-&gt;fb_base_phys
comma
id|board-&gt;base1_region_size
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|board
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pd
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * initialization&n; *&n; * ------------------------------------------------------------------------- */
macro_line|#ifndef MODULE
DECL|function|rivafb_setup
r_int
id|__init
id|rivafb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_opt
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;font:&quot;
comma
l_int|5
)paren
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
id|this_opt
op_plus
l_int|5
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|fontname
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
op_logical_or
op_star
id|p
op_eq
l_char|&squot; &squot;
op_logical_or
op_star
id|p
op_eq
l_char|&squot;,&squot;
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
id|fontname
comma
id|this_opt
op_plus
l_int|5
comma
id|i
)paren
suffix:semicolon
id|fontname
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noblink&quot;
comma
l_int|7
)paren
)paren
(brace
id|noblink
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomove&quot;
comma
l_int|6
)paren
)paren
(brace
id|nomove
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomtrr&quot;
comma
l_int|6
)paren
)paren
(brace
id|nomtrr
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nohwcursor&quot;
comma
l_int|10
)paren
)paren
(brace
id|nohwcursor
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* !MODULE */
DECL|variable|rivafb_driver
r_static
r_struct
id|pci_driver
id|rivafb_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;rivafb&quot;
comma
id|id_table
suffix:colon
id|rivafb_pci_tbl
comma
id|probe
suffix:colon
id|rivafb_init_one
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|rivafb_remove_one
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * modularization&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|rivafb_init
r_int
id|__init
id|rivafb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
macro_line|#ifdef MODULE
r_if
c_cond
(paren
id|font
)paren
id|strncpy
c_func
(paren
id|fontname
comma
id|font
comma
r_sizeof
(paren
id|fontname
)paren
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|rivafb_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|rivafb_exit
r_static
r_void
id|__exit
id|rivafb_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|rivafb_driver
)paren
suffix:semicolon
)brace
DECL|variable|rivafb_init
id|module_init
c_func
(paren
id|rivafb_init
)paren
suffix:semicolon
DECL|variable|rivafb_exit
id|module_exit
c_func
(paren
id|rivafb_exit
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|font
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|font
comma
l_string|&quot;Specifies one of the compiled-in fonts (default=none)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noaccel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;Disables hardware acceleration (0 or 1=disabled) (default=0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nomove
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomove
comma
l_string|&quot;Enables YSCROLL_NOMOVE (0 or 1=enabled) (default=0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|nohwcursor
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nohwcursor
comma
l_string|&quot;Disables hardware cursor (0 or 1=disabled) (default=0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|noblink
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noblink
comma
l_string|&quot;Disables hardware cursor blinking (0 or 1=disabled) (default=0)&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|MODULE_PARM
c_func
(paren
id|nomtrr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomtrr
comma
l_string|&quot;Disables MTRR support (0 or 1=disabled) (default=0)&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* MODULE */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ani Joshi, maintainer&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Framebuffer driver for nVidia Riva 128, TNT, TNT2&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
