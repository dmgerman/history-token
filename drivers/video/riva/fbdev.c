multiline_comment|/*&n; * linux/drivers/video/riva/fbdev.c - nVidia RIVA 128/TNT/TNT2 fb driver&n; *&n; * Maintained by Ani Joshi &lt;ajoshi@shell.unixbox.com&gt;&n; *&n; * Copyright 1999-2000 Jeff Garzik&n; *&n; * Contributors:&n; *&n; *&t;Ani Joshi:  Lots of debugging and cleanup work, really helped&n; *&t;get the driver going&n; *&n; *&t;Ferenc Bakonyi:  Bug fixes, cleanup, modularization&n; *&n; *&t;Jindrich Makovicka:  Accel code help, hw cursor, mtrr&n; *&n; *&t;Paul Richards:  Bug fixes, updates&n; *&n; * Initial template from skeletonfb.c, created 28 Dec 1997 by Geert Uytterhoeven&n; * Includes riva_hw.c from nVidia, see copyright below.&n; * KGI code provided the basis for state storage, init, and mode switching.&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; *&n; * Known bugs and issues:&n; *&t;restoring text mode fails&n; *&t;doublescan modes are broken&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#ifdef CONFIG_MTRR
macro_line|#include &lt;asm/mtrr.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PPC_OF
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
macro_line|#include &lt;asm/backlight.h&gt;
macro_line|#endif
macro_line|#include &quot;rivafb.h&quot;
macro_line|#include &quot;nvreg.h&quot;
macro_line|#ifndef CONFIG_PCI&t;&t;/* sanity check */
macro_line|#error This driver requires PCI support.
macro_line|#endif
multiline_comment|/* version number of this driver */
DECL|macro|RIVAFB_VERSION
mdefine_line|#define RIVAFB_VERSION &quot;0.9.5b&quot;
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * various helpful macros and constants&n; *&n; * ------------------------------------------------------------------------- */
macro_line|#ifdef CONFIG_FB_RIVA_DEBUG
DECL|macro|NVTRACE
mdefine_line|#define NVTRACE          printk
macro_line|#else
DECL|macro|NVTRACE
mdefine_line|#define NVTRACE          if(0) printk
macro_line|#endif
DECL|macro|NVTRACE_ENTER
mdefine_line|#define NVTRACE_ENTER(...)  NVTRACE(&quot;%s START&bslash;n&quot;, __FUNCTION__)
DECL|macro|NVTRACE_LEAVE
mdefine_line|#define NVTRACE_LEAVE(...)  NVTRACE(&quot;%s END&bslash;n&quot;, __FUNCTION__)
macro_line|#ifdef CONFIG_FB_RIVA_DEBUG
DECL|macro|assert
mdefine_line|#define assert(expr) &bslash;&n;&t;if(!(expr)) { &bslash;&n;&t;printk( &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&bslash;&n;&t;#expr,__FILE__,__FUNCTION__,__LINE__); &bslash;&n;&t;BUG(); &bslash;&n;&t;}
macro_line|#else
DECL|macro|assert
mdefine_line|#define assert(expr)
macro_line|#endif
DECL|macro|PFX
mdefine_line|#define PFX &quot;rivafb: &quot;
multiline_comment|/* macro that allows you to set overflow bits */
DECL|macro|SetBitField
mdefine_line|#define SetBitField(value,from,to) SetBF(to,GetBF(value,from))
DECL|macro|SetBit
mdefine_line|#define SetBit(n)&t;&t;(1&lt;&lt;(n))
DECL|macro|Set8Bits
mdefine_line|#define Set8Bits(value)&t;&t;((value)&amp;0xff)
multiline_comment|/* HW cursor parameters */
DECL|macro|MAX_CURS
mdefine_line|#define MAX_CURS&t;&t;32
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * prototypes&n; *&n; * ------------------------------------------------------------------------- */
r_static
r_int
id|rivafb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * card identification&n; *&n; * ------------------------------------------------------------------------- */
DECL|variable|rivafb_pci_tbl
r_static
r_struct
id|pci_device_id
id|rivafb_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_NVIDIA_SGS
comma
id|PCI_DEVICE_ID_NVIDIA_SGS_RIVA128
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_TNT
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_TNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_UTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_VTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_UVTNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_ITNT2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE_SDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE_DDR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_MX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_MX2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_GO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO2_MXR
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_GTS
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_GTS2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE2_ULTRA
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO2_PRO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_MX_460
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_MX_440
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_MX_420
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_440_GO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_420_GO
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_420_GO_M32
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_500XGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_440_GO_M64
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_200
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_550XGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_500_GOGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_IGEFORCE2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE3
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE3_1
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE3_2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO_DDC
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_TI_4600
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_TI_4400
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_GEFORCE4_TI_4200
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_900XGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_750XGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_QUADRO4_700XGL
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|rivafb_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * global variables&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/* command line data, set in rivafb_setup() */
DECL|variable|__initdata
r_static
r_int
id|flatpanel
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Autodetect later */
DECL|variable|__initdata
r_static
r_int
id|forceCRTC
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|noaccel
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
DECL|variable|__initdata
r_static
r_int
id|nomtrr
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_char
op_star
id|mode_option
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|strictmode
r_static
r_int
id|strictmode
op_assign
l_int|0
suffix:semicolon
DECL|variable|rivafb_fix
r_static
r_struct
id|fb_fix_screeninfo
id|__initdata
id|rivafb_fix
op_assign
(brace
dot
id|type
op_assign
id|FB_TYPE_PACKED_PIXELS
comma
dot
id|xpanstep
op_assign
l_int|1
comma
dot
id|ypanstep
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|rivafb_default_var
r_static
r_struct
id|fb_var_screeninfo
id|__initdata
id|rivafb_default_var
op_assign
(brace
dot
id|xres
op_assign
l_int|640
comma
dot
id|yres
op_assign
l_int|480
comma
dot
id|xres_virtual
op_assign
l_int|640
comma
dot
id|yres_virtual
op_assign
l_int|480
comma
dot
id|bits_per_pixel
op_assign
l_int|8
comma
dot
id|red
op_assign
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
dot
id|green
op_assign
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
dot
id|blue
op_assign
(brace
l_int|0
comma
l_int|8
comma
l_int|0
)brace
comma
dot
id|transp
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|activate
op_assign
id|FB_ACTIVATE_NOW
comma
dot
id|height
op_assign
op_minus
l_int|1
comma
dot
id|width
op_assign
op_minus
l_int|1
comma
dot
id|pixclock
op_assign
l_int|39721
comma
dot
id|left_margin
op_assign
l_int|40
comma
dot
id|right_margin
op_assign
l_int|24
comma
dot
id|upper_margin
op_assign
l_int|32
comma
dot
id|lower_margin
op_assign
l_int|11
comma
dot
id|hsync_len
op_assign
l_int|96
comma
dot
id|vsync_len
op_assign
l_int|2
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
)brace
suffix:semicolon
multiline_comment|/* from GGI */
DECL|variable|reg_template
r_static
r_const
r_struct
id|riva_regs
id|reg_template
op_assign
(brace
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
multiline_comment|/* ATTR */
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x0C
comma
l_int|0x0D
comma
l_int|0x0E
comma
l_int|0x0F
comma
l_int|0x41
comma
l_int|0x01
comma
l_int|0x0F
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* CRT  */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x20
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xE3
comma
multiline_comment|/* 0x10 */
l_int|0xFF
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x20 */
l_int|0x40
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x30 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0x40 */
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x05
comma
l_int|0x0F
comma
multiline_comment|/* GRA  */
l_int|0xFF
)brace
comma
(brace
l_int|0x03
comma
l_int|0x01
comma
l_int|0x0F
comma
l_int|0x00
comma
l_int|0x0E
)brace
comma
multiline_comment|/* SEQ  */
l_int|0xEB
multiline_comment|/* MISC */
)brace
suffix:semicolon
multiline_comment|/*&n; * Backlight control&n; */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
DECL|variable|riva_backlight_levels
r_static
r_int
id|riva_backlight_levels
(braket
)braket
op_assign
(brace
l_int|0x158
comma
l_int|0x192
comma
l_int|0x1c6
comma
l_int|0x200
comma
l_int|0x234
comma
l_int|0x268
comma
l_int|0x2a2
comma
l_int|0x2d6
comma
l_int|0x310
comma
l_int|0x344
comma
l_int|0x378
comma
l_int|0x3b2
comma
l_int|0x3e6
comma
l_int|0x41a
comma
l_int|0x454
comma
l_int|0x534
comma
)brace
suffix:semicolon
r_static
r_int
id|riva_set_backlight_enable
c_func
(paren
r_int
id|on
comma
r_int
id|level
comma
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|riva_set_backlight_level
c_func
(paren
r_int
id|level
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|variable|riva_backlight_controller
r_static
r_struct
id|backlight_controller
id|riva_backlight_controller
op_assign
(brace
id|riva_set_backlight_enable
comma
id|riva_set_backlight_level
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * MMIO access macros&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|CRTCout
r_static
r_inline
r_void
id|CRTCout
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3d4
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3d5
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|CRTCin
r_static
r_inline
r_int
r_char
id|CRTCin
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3d4
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3d5
)paren
)paren
suffix:semicolon
)brace
DECL|function|GRAout
r_static
r_inline
r_void
id|GRAout
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3ce
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3cf
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|GRAin
r_static
r_inline
r_int
r_char
id|GRAin
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3ce
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3cf
)paren
)paren
suffix:semicolon
)brace
DECL|function|SEQout
r_static
r_inline
r_void
id|SEQout
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3c4
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3c5
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|SEQin
r_static
r_inline
r_int
r_char
id|SEQin
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3c4
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3c5
)paren
)paren
suffix:semicolon
)brace
DECL|function|ATTRout
r_static
r_inline
r_void
id|ATTRout
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|index
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|ATTRin
r_static
r_inline
r_int
r_char
id|ATTRin
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|index
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3c0
comma
id|index
)paren
suffix:semicolon
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;riva.PCIO
comma
l_int|0x3c1
)paren
)paren
suffix:semicolon
)brace
DECL|function|MISCout
r_static
r_inline
r_void
id|MISCout
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
r_char
id|val
)paren
(brace
id|VGA_WR08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3c2
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|MISCin
r_static
r_inline
r_int
r_char
id|MISCin
c_func
(paren
r_struct
id|riva_par
op_star
id|par
)paren
(brace
r_return
(paren
id|VGA_RD08
c_func
(paren
id|par-&gt;riva.PVIO
comma
l_int|0x3cc
)paren
)paren
suffix:semicolon
)brace
DECL|variable|byte_rev
r_static
id|u8
id|byte_rev
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x80
comma
l_int|0x40
comma
l_int|0xc0
comma
l_int|0x20
comma
l_int|0xa0
comma
l_int|0x60
comma
l_int|0xe0
comma
l_int|0x10
comma
l_int|0x90
comma
l_int|0x50
comma
l_int|0xd0
comma
l_int|0x30
comma
l_int|0xb0
comma
l_int|0x70
comma
l_int|0xf0
comma
l_int|0x08
comma
l_int|0x88
comma
l_int|0x48
comma
l_int|0xc8
comma
l_int|0x28
comma
l_int|0xa8
comma
l_int|0x68
comma
l_int|0xe8
comma
l_int|0x18
comma
l_int|0x98
comma
l_int|0x58
comma
l_int|0xd8
comma
l_int|0x38
comma
l_int|0xb8
comma
l_int|0x78
comma
l_int|0xf8
comma
l_int|0x04
comma
l_int|0x84
comma
l_int|0x44
comma
l_int|0xc4
comma
l_int|0x24
comma
l_int|0xa4
comma
l_int|0x64
comma
l_int|0xe4
comma
l_int|0x14
comma
l_int|0x94
comma
l_int|0x54
comma
l_int|0xd4
comma
l_int|0x34
comma
l_int|0xb4
comma
l_int|0x74
comma
l_int|0xf4
comma
l_int|0x0c
comma
l_int|0x8c
comma
l_int|0x4c
comma
l_int|0xcc
comma
l_int|0x2c
comma
l_int|0xac
comma
l_int|0x6c
comma
l_int|0xec
comma
l_int|0x1c
comma
l_int|0x9c
comma
l_int|0x5c
comma
l_int|0xdc
comma
l_int|0x3c
comma
l_int|0xbc
comma
l_int|0x7c
comma
l_int|0xfc
comma
l_int|0x02
comma
l_int|0x82
comma
l_int|0x42
comma
l_int|0xc2
comma
l_int|0x22
comma
l_int|0xa2
comma
l_int|0x62
comma
l_int|0xe2
comma
l_int|0x12
comma
l_int|0x92
comma
l_int|0x52
comma
l_int|0xd2
comma
l_int|0x32
comma
l_int|0xb2
comma
l_int|0x72
comma
l_int|0xf2
comma
l_int|0x0a
comma
l_int|0x8a
comma
l_int|0x4a
comma
l_int|0xca
comma
l_int|0x2a
comma
l_int|0xaa
comma
l_int|0x6a
comma
l_int|0xea
comma
l_int|0x1a
comma
l_int|0x9a
comma
l_int|0x5a
comma
l_int|0xda
comma
l_int|0x3a
comma
l_int|0xba
comma
l_int|0x7a
comma
l_int|0xfa
comma
l_int|0x06
comma
l_int|0x86
comma
l_int|0x46
comma
l_int|0xc6
comma
l_int|0x26
comma
l_int|0xa6
comma
l_int|0x66
comma
l_int|0xe6
comma
l_int|0x16
comma
l_int|0x96
comma
l_int|0x56
comma
l_int|0xd6
comma
l_int|0x36
comma
l_int|0xb6
comma
l_int|0x76
comma
l_int|0xf6
comma
l_int|0x0e
comma
l_int|0x8e
comma
l_int|0x4e
comma
l_int|0xce
comma
l_int|0x2e
comma
l_int|0xae
comma
l_int|0x6e
comma
l_int|0xee
comma
l_int|0x1e
comma
l_int|0x9e
comma
l_int|0x5e
comma
l_int|0xde
comma
l_int|0x3e
comma
l_int|0xbe
comma
l_int|0x7e
comma
l_int|0xfe
comma
l_int|0x01
comma
l_int|0x81
comma
l_int|0x41
comma
l_int|0xc1
comma
l_int|0x21
comma
l_int|0xa1
comma
l_int|0x61
comma
l_int|0xe1
comma
l_int|0x11
comma
l_int|0x91
comma
l_int|0x51
comma
l_int|0xd1
comma
l_int|0x31
comma
l_int|0xb1
comma
l_int|0x71
comma
l_int|0xf1
comma
l_int|0x09
comma
l_int|0x89
comma
l_int|0x49
comma
l_int|0xc9
comma
l_int|0x29
comma
l_int|0xa9
comma
l_int|0x69
comma
l_int|0xe9
comma
l_int|0x19
comma
l_int|0x99
comma
l_int|0x59
comma
l_int|0xd9
comma
l_int|0x39
comma
l_int|0xb9
comma
l_int|0x79
comma
l_int|0xf9
comma
l_int|0x05
comma
l_int|0x85
comma
l_int|0x45
comma
l_int|0xc5
comma
l_int|0x25
comma
l_int|0xa5
comma
l_int|0x65
comma
l_int|0xe5
comma
l_int|0x15
comma
l_int|0x95
comma
l_int|0x55
comma
l_int|0xd5
comma
l_int|0x35
comma
l_int|0xb5
comma
l_int|0x75
comma
l_int|0xf5
comma
l_int|0x0d
comma
l_int|0x8d
comma
l_int|0x4d
comma
l_int|0xcd
comma
l_int|0x2d
comma
l_int|0xad
comma
l_int|0x6d
comma
l_int|0xed
comma
l_int|0x1d
comma
l_int|0x9d
comma
l_int|0x5d
comma
l_int|0xdd
comma
l_int|0x3d
comma
l_int|0xbd
comma
l_int|0x7d
comma
l_int|0xfd
comma
l_int|0x03
comma
l_int|0x83
comma
l_int|0x43
comma
l_int|0xc3
comma
l_int|0x23
comma
l_int|0xa3
comma
l_int|0x63
comma
l_int|0xe3
comma
l_int|0x13
comma
l_int|0x93
comma
l_int|0x53
comma
l_int|0xd3
comma
l_int|0x33
comma
l_int|0xb3
comma
l_int|0x73
comma
l_int|0xf3
comma
l_int|0x0b
comma
l_int|0x8b
comma
l_int|0x4b
comma
l_int|0xcb
comma
l_int|0x2b
comma
l_int|0xab
comma
l_int|0x6b
comma
l_int|0xeb
comma
l_int|0x1b
comma
l_int|0x9b
comma
l_int|0x5b
comma
l_int|0xdb
comma
l_int|0x3b
comma
l_int|0xbb
comma
l_int|0x7b
comma
l_int|0xfb
comma
l_int|0x07
comma
l_int|0x87
comma
l_int|0x47
comma
l_int|0xc7
comma
l_int|0x27
comma
l_int|0xa7
comma
l_int|0x67
comma
l_int|0xe7
comma
l_int|0x17
comma
l_int|0x97
comma
l_int|0x57
comma
l_int|0xd7
comma
l_int|0x37
comma
l_int|0xb7
comma
l_int|0x77
comma
l_int|0xf7
comma
l_int|0x0f
comma
l_int|0x8f
comma
l_int|0x4f
comma
l_int|0xcf
comma
l_int|0x2f
comma
l_int|0xaf
comma
l_int|0x6f
comma
l_int|0xef
comma
l_int|0x1f
comma
l_int|0x9f
comma
l_int|0x5f
comma
l_int|0xdf
comma
l_int|0x3f
comma
l_int|0xbf
comma
l_int|0x7f
comma
l_int|0xff
comma
)brace
suffix:semicolon
DECL|function|reverse_order
r_static
r_inline
r_void
id|reverse_order
c_func
(paren
id|u32
op_star
id|l
)paren
(brace
id|u8
op_star
id|a
op_assign
(paren
id|u8
op_star
)paren
id|l
suffix:semicolon
op_star
id|a
op_assign
id|byte_rev
(braket
op_star
id|a
)braket
comma
id|a
op_increment
suffix:semicolon
op_star
id|a
op_assign
id|byte_rev
(braket
op_star
id|a
)braket
comma
id|a
op_increment
suffix:semicolon
op_star
id|a
op_assign
id|byte_rev
(braket
op_star
id|a
)braket
comma
id|a
op_increment
suffix:semicolon
op_star
id|a
op_assign
id|byte_rev
(braket
op_star
id|a
)braket
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * cursor stuff&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/**&n; * rivafb_load_cursor_image - load cursor image to hardware&n; * @data: address to monochrome bitmap (1 = foreground color, 0 = background)&n; * @par:  pointer to private data&n; * @w:    width of cursor image in pixels&n; * @h:    height of cursor image in scanlines&n; * @bg:   background color (ARGB1555) - alpha bit determines opacity&n; * @fg:   foreground color (ARGB1555)&n; *&n; * DESCRIPTiON:&n; * Loads cursor image based on a monochrome source and mask bitmap.  The&n; * image bits determines the color of the pixel, 0 for background, 1 for&n; * foreground.  Only the affected region (as determined by @w and @h &n; * parameters) will be updated.&n; *&n; * CALLED FROM:&n; * rivafb_cursor()&n; */
DECL|function|rivafb_load_cursor_image
r_static
r_void
id|rivafb_load_cursor_image
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
id|u8
op_star
id|data8
comma
id|u16
id|bg
comma
id|u16
id|fg
comma
id|u32
id|w
comma
id|u32
id|h
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
op_assign
l_int|0
suffix:semicolon
id|u32
id|b
comma
id|tmp
suffix:semicolon
id|u32
op_star
id|data
op_assign
(paren
id|u32
op_star
)paren
id|data8
suffix:semicolon
id|bg
op_assign
id|le16_to_cpu
c_func
(paren
id|bg
)paren
suffix:semicolon
id|fg
op_assign
id|le16_to_cpu
c_func
(paren
id|fg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|h
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b
op_assign
op_star
id|data
op_increment
suffix:semicolon
id|reverse_order
c_func
(paren
op_amp
id|b
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|w
op_div
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|tmp
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined (__BIG_ENDIAN)
id|tmp
op_assign
(paren
id|b
op_amp
(paren
l_int|1
op_lshift
l_int|31
)paren
)paren
ques
c_cond
id|fg
op_lshift
l_int|16
suffix:colon
id|bg
op_lshift
l_int|16
suffix:semicolon
id|b
op_lshift_assign
l_int|1
suffix:semicolon
id|tmp
op_or_assign
(paren
id|b
op_amp
(paren
l_int|1
op_lshift
l_int|31
)paren
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
suffix:semicolon
id|b
op_lshift_assign
l_int|1
suffix:semicolon
macro_line|#else
id|tmp
op_assign
(paren
id|b
op_amp
l_int|1
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
suffix:semicolon
id|b
op_rshift_assign
l_int|1
suffix:semicolon
id|tmp
op_or_assign
(paren
id|b
op_amp
l_int|1
)paren
ques
c_cond
id|fg
op_lshift
l_int|16
suffix:colon
id|bg
op_lshift
l_int|16
suffix:semicolon
id|b
op_rshift_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|tmp
comma
op_amp
id|par-&gt;riva.CURSOR
(braket
id|k
op_increment
)braket
)paren
suffix:semicolon
)brace
id|k
op_add_assign
(paren
id|MAX_CURS
op_minus
id|w
)paren
op_div
l_int|2
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * general utility functions&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/**&n; * riva_wclut - set CLUT entry&n; * @chip: pointer to RIVA_HW_INST object&n; * @regnum: register number&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; *&n; * DESCRIPTION:&n; * Sets color register @regnum.&n; *&n; * CALLED FROM:&n; * rivafb_setcolreg()&n; */
DECL|function|riva_wclut
r_static
r_void
id|riva_wclut
c_func
(paren
id|RIVA_HW_INST
op_star
id|chip
comma
r_int
r_char
id|regnum
comma
r_int
r_char
id|red
comma
r_int
r_char
id|green
comma
r_int
r_char
id|blue
)paren
(brace
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c8
comma
id|regnum
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|red
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|green
)paren
suffix:semicolon
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
comma
id|blue
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_rclut - read fromCLUT register&n; * @chip: pointer to RIVA_HW_INST object&n; * @regnum: register number&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; *&n; * DESCRIPTION:&n; * Reads red, green, and blue from color register @regnum.&n; *&n; * CALLED FROM:&n; * rivafb_setcolreg()&n; */
DECL|function|riva_rclut
r_static
r_void
id|riva_rclut
c_func
(paren
id|RIVA_HW_INST
op_star
id|chip
comma
r_int
r_char
id|regnum
comma
r_int
r_char
op_star
id|red
comma
r_int
r_char
op_star
id|green
comma
r_int
r_char
op_star
id|blue
)paren
(brace
id|VGA_WR08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c7
comma
id|regnum
)paren
suffix:semicolon
op_star
id|red
op_assign
id|VGA_RD08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
)paren
suffix:semicolon
op_star
id|green
op_assign
id|VGA_RD08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
)paren
suffix:semicolon
op_star
id|blue
op_assign
id|VGA_RD08
c_func
(paren
id|chip-&gt;PDIO
comma
l_int|0x3c9
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_save_state - saves current chip state&n; * @par: pointer to riva_par object containing info for current riva board&n; * @regs: pointer to riva_regs object&n; *&n; * DESCRIPTION:&n; * Saves current chip state to @regs.&n; *&n; * CALLED FROM:&n; * rivafb_probe()&n; */
multiline_comment|/* from GGI */
DECL|function|riva_save_state
r_static
r_void
id|riva_save_state
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_struct
id|riva_regs
op_star
id|regs
)paren
(brace
r_int
id|i
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|UnloadStateExt
c_func
(paren
op_amp
id|par-&gt;riva
comma
op_amp
id|regs-&gt;ext
)paren
suffix:semicolon
id|regs-&gt;misc_output
op_assign
id|MISCin
c_func
(paren
id|par
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CRT_REGS
suffix:semicolon
id|i
op_increment
)paren
id|regs-&gt;crtc
(braket
id|i
)braket
op_assign
id|CRTCin
c_func
(paren
id|par
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATC_REGS
suffix:semicolon
id|i
op_increment
)paren
id|regs-&gt;attr
(braket
id|i
)braket
op_assign
id|ATTRin
c_func
(paren
id|par
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_GRC_REGS
suffix:semicolon
id|i
op_increment
)paren
id|regs-&gt;gra
(braket
id|i
)braket
op_assign
id|GRAin
c_func
(paren
id|par
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_SEQ_REGS
suffix:semicolon
id|i
op_increment
)paren
id|regs-&gt;seq
(braket
id|i
)braket
op_assign
id|SEQin
c_func
(paren
id|par
comma
id|i
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_load_state - loads current chip state&n; * @par: pointer to riva_par object containing info for current riva board&n; * @regs: pointer to riva_regs object&n; *&n; * DESCRIPTION:&n; * Loads chip state from @regs.&n; *&n; * CALLED FROM:&n; * riva_load_video_mode()&n; * rivafb_probe()&n; * rivafb_remove()&n; */
multiline_comment|/* from GGI */
DECL|function|riva_load_state
r_static
r_void
id|riva_load_state
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_struct
id|riva_regs
op_star
id|regs
)paren
(brace
id|RIVA_HW_STATE
op_star
id|state
op_assign
op_amp
id|regs-&gt;ext
suffix:semicolon
r_int
id|i
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|CRTCout
c_func
(paren
id|par
comma
l_int|0x11
comma
l_int|0x00
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LoadStateExt
c_func
(paren
op_amp
id|par-&gt;riva
comma
id|state
)paren
suffix:semicolon
id|MISCout
c_func
(paren
id|par
comma
id|regs-&gt;misc_output
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CRT_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0x19
suffix:colon
r_case
l_int|0x20
dot
dot
dot
l_int|0x40
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|CRTCout
c_func
(paren
id|par
comma
id|i
comma
id|regs-&gt;crtc
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATC_REGS
suffix:semicolon
id|i
op_increment
)paren
id|ATTRout
c_func
(paren
id|par
comma
id|i
comma
id|regs-&gt;attr
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_GRC_REGS
suffix:semicolon
id|i
op_increment
)paren
id|GRAout
c_func
(paren
id|par
comma
id|i
comma
id|regs-&gt;gra
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_SEQ_REGS
suffix:semicolon
id|i
op_increment
)paren
id|SEQout
c_func
(paren
id|par
comma
id|i
comma
id|regs-&gt;seq
(braket
id|i
)braket
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_load_video_mode - calculate timings&n; * @info: pointer to fb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Calculate some timings and then send em off to riva_load_state().&n; *&n; * CALLED FROM:&n; * rivafb_set_par()&n; */
DECL|function|riva_load_video_mode
r_static
r_void
id|riva_load_video_mode
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
id|bpp
comma
id|width
comma
id|hDisplaySize
comma
id|hDisplay
comma
id|hStart
comma
id|hEnd
comma
id|hTotal
comma
id|height
comma
id|vDisplay
comma
id|vStart
comma
id|vEnd
comma
id|vTotal
comma
id|dotClock
suffix:semicolon
r_int
id|hBlankStart
comma
id|hBlankEnd
comma
id|vBlankStart
comma
id|vBlankEnd
suffix:semicolon
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|riva_regs
id|newmode
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* time to calculate */
id|rivafb_blank
c_func
(paren
l_int|1
comma
id|info
)paren
suffix:semicolon
id|bpp
op_assign
id|info-&gt;var.bits_per_pixel
suffix:semicolon
r_if
c_cond
(paren
id|bpp
op_eq
l_int|16
op_logical_and
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
id|bpp
op_assign
l_int|15
suffix:semicolon
id|width
op_assign
id|info-&gt;var.xres_virtual
suffix:semicolon
id|hDisplaySize
op_assign
id|info-&gt;var.xres
suffix:semicolon
id|hDisplay
op_assign
(paren
id|hDisplaySize
op_div
l_int|8
)paren
op_minus
l_int|1
suffix:semicolon
id|hStart
op_assign
(paren
id|hDisplaySize
op_plus
id|info-&gt;var.right_margin
)paren
op_div
l_int|8
op_minus
l_int|1
suffix:semicolon
id|hEnd
op_assign
(paren
id|hDisplaySize
op_plus
id|info-&gt;var.right_margin
op_plus
id|info-&gt;var.hsync_len
)paren
op_div
l_int|8
op_minus
l_int|1
suffix:semicolon
id|hTotal
op_assign
(paren
id|hDisplaySize
op_plus
id|info-&gt;var.right_margin
op_plus
id|info-&gt;var.hsync_len
op_plus
id|info-&gt;var.left_margin
)paren
op_div
l_int|8
op_minus
l_int|5
suffix:semicolon
id|hBlankStart
op_assign
id|hDisplay
suffix:semicolon
id|hBlankEnd
op_assign
id|hTotal
op_plus
l_int|4
suffix:semicolon
id|height
op_assign
id|info-&gt;var.yres_virtual
suffix:semicolon
id|vDisplay
op_assign
id|info-&gt;var.yres
op_minus
l_int|1
suffix:semicolon
id|vStart
op_assign
id|info-&gt;var.yres
op_plus
id|info-&gt;var.lower_margin
op_minus
l_int|1
suffix:semicolon
id|vEnd
op_assign
id|info-&gt;var.yres
op_plus
id|info-&gt;var.lower_margin
op_plus
id|info-&gt;var.vsync_len
op_minus
l_int|1
suffix:semicolon
id|vTotal
op_assign
id|info-&gt;var.yres
op_plus
id|info-&gt;var.lower_margin
op_plus
id|info-&gt;var.vsync_len
op_plus
id|info-&gt;var.upper_margin
op_plus
l_int|2
suffix:semicolon
id|vBlankStart
op_assign
id|vDisplay
suffix:semicolon
id|vBlankEnd
op_assign
id|vTotal
op_plus
l_int|1
suffix:semicolon
id|dotClock
op_assign
l_int|1000000000
op_div
id|info-&gt;var.pixclock
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|newmode
comma
op_amp
id|reg_template
comma
r_sizeof
(paren
r_struct
id|riva_regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
id|vTotal
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;FlatPanel
)paren
(brace
id|vStart
op_assign
id|vTotal
op_minus
l_int|3
suffix:semicolon
id|vEnd
op_assign
id|vTotal
op_minus
l_int|2
suffix:semicolon
id|vBlankStart
op_assign
id|vStart
suffix:semicolon
id|hStart
op_assign
id|hTotal
op_minus
l_int|3
suffix:semicolon
id|hEnd
op_assign
id|hTotal
op_minus
l_int|2
suffix:semicolon
id|hBlankEnd
op_assign
id|hTotal
op_plus
l_int|4
suffix:semicolon
)brace
id|newmode.crtc
(braket
l_int|0x0
)braket
op_assign
id|Set8Bits
(paren
id|hTotal
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x1
)braket
op_assign
id|Set8Bits
(paren
id|hDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x2
)braket
op_assign
id|Set8Bits
(paren
id|hBlankStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x3
)braket
op_assign
id|SetBitField
(paren
id|hBlankEnd
comma
l_int|4
suffix:colon
l_int|0
comma
l_int|4
suffix:colon
l_int|0
)paren
op_or
id|SetBit
(paren
l_int|7
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x4
)braket
op_assign
id|Set8Bits
(paren
id|hStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x5
)braket
op_assign
id|SetBitField
(paren
id|hBlankEnd
comma
l_int|5
suffix:colon
l_int|5
comma
l_int|7
suffix:colon
l_int|7
)paren
op_or
id|SetBitField
(paren
id|hEnd
comma
l_int|4
suffix:colon
l_int|0
comma
l_int|4
suffix:colon
l_int|0
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x6
)braket
op_assign
id|SetBitField
(paren
id|vTotal
comma
l_int|7
suffix:colon
l_int|0
comma
l_int|7
suffix:colon
l_int|0
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x7
)braket
op_assign
id|SetBitField
(paren
id|vTotal
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|0
suffix:colon
l_int|0
)paren
op_or
id|SetBitField
(paren
id|vDisplay
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|1
suffix:colon
l_int|1
)paren
op_or
id|SetBitField
(paren
id|vStart
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|2
suffix:colon
l_int|2
)paren
op_or
id|SetBitField
(paren
id|vBlankStart
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|3
suffix:colon
l_int|3
)paren
op_or
id|SetBit
(paren
l_int|4
)paren
op_or
id|SetBitField
(paren
id|vTotal
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|5
suffix:colon
l_int|5
)paren
op_or
id|SetBitField
(paren
id|vDisplay
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|6
suffix:colon
l_int|6
)paren
op_or
id|SetBitField
(paren
id|vStart
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|7
suffix:colon
l_int|7
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x9
)braket
op_assign
id|SetBitField
(paren
id|vBlankStart
comma
l_int|9
suffix:colon
l_int|9
comma
l_int|5
suffix:colon
l_int|5
)paren
op_or
id|SetBit
(paren
l_int|6
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x10
)braket
op_assign
id|Set8Bits
(paren
id|vStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x11
)braket
op_assign
id|SetBitField
(paren
id|vEnd
comma
l_int|3
suffix:colon
l_int|0
comma
l_int|3
suffix:colon
l_int|0
)paren
op_or
id|SetBit
(paren
l_int|5
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x12
)braket
op_assign
id|Set8Bits
(paren
id|vDisplay
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x13
)braket
op_assign
(paren
id|width
op_div
l_int|8
)paren
op_star
(paren
(paren
id|bpp
op_plus
l_int|1
)paren
op_div
l_int|8
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x15
)braket
op_assign
id|Set8Bits
(paren
id|vBlankStart
)paren
suffix:semicolon
id|newmode.crtc
(braket
l_int|0x16
)braket
op_assign
id|Set8Bits
(paren
id|vBlankEnd
)paren
suffix:semicolon
id|newmode.ext.screen
op_assign
id|SetBitField
c_func
(paren
id|hBlankEnd
comma
l_int|6
suffix:colon
l_int|6
comma
l_int|4
suffix:colon
l_int|4
)paren
op_or
id|SetBitField
c_func
(paren
id|vBlankStart
comma
l_int|10
suffix:colon
l_int|10
comma
l_int|3
suffix:colon
l_int|3
)paren
op_or
id|SetBitField
c_func
(paren
id|vStart
comma
l_int|10
suffix:colon
l_int|10
comma
l_int|2
suffix:colon
l_int|2
)paren
op_or
id|SetBitField
c_func
(paren
id|vDisplay
comma
l_int|10
suffix:colon
l_int|10
comma
l_int|1
suffix:colon
l_int|1
)paren
op_or
id|SetBitField
c_func
(paren
id|vTotal
comma
l_int|10
suffix:colon
l_int|10
comma
l_int|0
suffix:colon
l_int|0
)paren
suffix:semicolon
id|newmode.ext.horiz
op_assign
id|SetBitField
c_func
(paren
id|hTotal
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|0
suffix:colon
l_int|0
)paren
op_or
id|SetBitField
c_func
(paren
id|hDisplay
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|1
suffix:colon
l_int|1
)paren
op_or
id|SetBitField
c_func
(paren
id|hBlankStart
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|2
suffix:colon
l_int|2
)paren
op_or
id|SetBitField
c_func
(paren
id|hStart
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|3
suffix:colon
l_int|3
)paren
suffix:semicolon
id|newmode.ext.extra
op_assign
id|SetBitField
c_func
(paren
id|vTotal
comma
l_int|11
suffix:colon
l_int|11
comma
l_int|0
suffix:colon
l_int|0
)paren
op_or
id|SetBitField
c_func
(paren
id|vDisplay
comma
l_int|11
suffix:colon
l_int|11
comma
l_int|2
suffix:colon
l_int|2
)paren
op_or
id|SetBitField
c_func
(paren
id|vStart
comma
l_int|11
suffix:colon
l_int|11
comma
l_int|4
suffix:colon
l_int|4
)paren
op_or
id|SetBitField
c_func
(paren
id|vBlankStart
comma
l_int|11
suffix:colon
l_int|11
comma
l_int|6
suffix:colon
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;var.vmode
op_amp
id|FB_VMODE_MASK
)paren
op_eq
id|FB_VMODE_INTERLACED
)paren
(brace
r_int
id|tmp
op_assign
(paren
id|hTotal
op_rshift
l_int|1
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|newmode.ext.interlace
op_assign
id|Set8Bits
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|newmode.ext.horiz
op_or_assign
id|SetBitField
c_func
(paren
id|tmp
comma
l_int|8
suffix:colon
l_int|8
comma
l_int|4
suffix:colon
l_int|4
)paren
suffix:semicolon
)brace
r_else
id|newmode.ext.interlace
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* interlace off */
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_ge
id|NV_ARCH_10
)paren
id|par-&gt;riva.CURSOR
op_assign
(paren
id|U032
id|__iomem
op_star
)paren
(paren
id|info-&gt;screen_base
op_plus
id|par-&gt;riva.CursorStart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.sync
op_amp
id|FB_SYNC_HOR_HIGH_ACT
)paren
id|newmode.misc_output
op_and_assign
op_complement
l_int|0x40
suffix:semicolon
r_else
id|newmode.misc_output
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.sync
op_amp
id|FB_SYNC_VERT_HIGH_ACT
)paren
id|newmode.misc_output
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_else
id|newmode.misc_output
op_or_assign
l_int|0x80
suffix:semicolon
id|par-&gt;riva
dot
id|CalcStateExt
c_func
(paren
op_amp
id|par-&gt;riva
comma
op_amp
id|newmode.ext
comma
id|bpp
comma
id|width
comma
id|hDisplaySize
comma
id|height
comma
id|dotClock
)paren
suffix:semicolon
id|newmode.ext.scale
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PRAMDAC
comma
l_int|0x00000848
)paren
op_amp
l_int|0xfff000ff
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_eq
l_int|1
)paren
(brace
id|newmode.ext.pixel
op_or_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
suffix:semicolon
id|newmode.ext.scale
op_or_assign
(paren
l_int|1
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;SecondCRTC
)paren
(brace
id|newmode.ext.head
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PCRTC0
comma
l_int|0x00000860
)paren
op_amp
op_complement
l_int|0x00001000
suffix:semicolon
id|newmode.ext.head2
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PCRTC0
comma
l_int|0x00002860
)paren
op_or
l_int|0x00001000
suffix:semicolon
id|newmode.ext.crtcOwner
op_assign
l_int|3
suffix:semicolon
id|newmode.ext.pllsel
op_or_assign
l_int|0x20000800
suffix:semicolon
id|newmode.ext.vpll2
op_assign
id|newmode.ext.vpll
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|par-&gt;riva.twoHeads
)paren
(brace
id|newmode.ext.head
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PCRTC0
comma
l_int|0x00000860
)paren
op_or
l_int|0x00001000
suffix:semicolon
id|newmode.ext.head2
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PCRTC0
comma
l_int|0x00002860
)paren
op_amp
op_complement
l_int|0x00001000
suffix:semicolon
id|newmode.ext.crtcOwner
op_assign
l_int|0
suffix:semicolon
id|newmode.ext.vpll2
op_assign
id|NV_RD32
c_func
(paren
id|par-&gt;riva.PRAMDAC0
comma
l_int|0x00000520
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_eq
l_int|1
)paren
(brace
id|newmode.ext.pixel
op_or_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
suffix:semicolon
id|newmode.ext.scale
op_or_assign
(paren
l_int|1
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
id|newmode.ext.cursorConfig
op_assign
l_int|0x02000100
suffix:semicolon
id|par-&gt;current_state
op_assign
id|newmode
suffix:semicolon
id|riva_load_state
c_func
(paren
id|par
comma
op_amp
id|par-&gt;current_state
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* important for HW cursor */
id|rivafb_blank
c_func
(paren
l_int|0
comma
id|info
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|riva_update_var
r_static
r_void
id|riva_update_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_videomode
op_star
id|modedb
)paren
(brace
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|var-&gt;xres
op_assign
id|var-&gt;xres_virtual
op_assign
id|modedb-&gt;xres
suffix:semicolon
id|var-&gt;yres
op_assign
id|modedb-&gt;yres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
)paren
id|var-&gt;yres_virtual
op_assign
id|var-&gt;yres
suffix:semicolon
id|var-&gt;xoffset
op_assign
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;pixclock
op_assign
id|modedb-&gt;pixclock
suffix:semicolon
id|var-&gt;left_margin
op_assign
id|modedb-&gt;left_margin
suffix:semicolon
id|var-&gt;right_margin
op_assign
id|modedb-&gt;right_margin
suffix:semicolon
id|var-&gt;upper_margin
op_assign
id|modedb-&gt;upper_margin
suffix:semicolon
id|var-&gt;lower_margin
op_assign
id|modedb-&gt;lower_margin
suffix:semicolon
id|var-&gt;hsync_len
op_assign
id|modedb-&gt;hsync_len
suffix:semicolon
id|var-&gt;vsync_len
op_assign
id|modedb-&gt;vsync_len
suffix:semicolon
id|var-&gt;sync
op_assign
id|modedb-&gt;sync
suffix:semicolon
id|var-&gt;vmode
op_assign
id|modedb-&gt;vmode
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_do_maximize - &n; * @info: pointer to fb_info object containing info for current riva board&n; * @var:&n; * @nom:&n; * @den:&n; *&n; * DESCRIPTION:&n; * .&n; *&n; * RETURNS:&n; * -EINVAL on failure, 0 on success&n; * &n; *&n; * CALLED FROM:&n; * rivafb_check_var()&n; */
DECL|function|rivafb_do_maximize
r_static
r_int
id|rivafb_do_maximize
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_int
id|nom
comma
r_int
id|den
)paren
(brace
r_static
r_struct
(brace
r_int
id|xres
comma
id|yres
suffix:semicolon
)brace
id|modes
(braket
)braket
op_assign
(brace
(brace
l_int|1600
comma
l_int|1280
)brace
comma
(brace
l_int|1280
comma
l_int|1024
)brace
comma
(brace
l_int|1024
comma
l_int|768
)brace
comma
(brace
l_int|800
comma
l_int|600
)brace
comma
(brace
l_int|640
comma
l_int|480
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* use highest possible virtual resolution */
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
op_minus
l_int|1
op_logical_and
id|var-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;using maximum available virtual resolution&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|modes
(braket
id|i
)braket
dot
id|xres
op_ne
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_star
id|nom
op_div
id|den
op_star
id|modes
(braket
id|i
)braket
dot
id|yres
OL
id|info-&gt;fix.smem_len
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|modes
(braket
id|i
)braket
dot
id|xres
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;could not find a virtual resolution that fits into video memory!!&bslash;n&quot;
)paren
suffix:semicolon
id|NVTRACE
c_func
(paren
l_string|&quot;EXIT - EINVAL error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|var-&gt;xres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|xres
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|modes
(braket
id|i
)braket
dot
id|yres
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;virtual resolution set to maximum of %dx%d&bslash;n&quot;
comma
id|var-&gt;xres_virtual
comma
id|var-&gt;yres_virtual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|var-&gt;xres_virtual
op_assign
(paren
id|info-&gt;fix.smem_len
op_star
id|den
op_div
(paren
id|nom
op_star
id|var-&gt;yres_virtual
)paren
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;setting virtual X resolution to %d&bslash;n&quot;
comma
id|var-&gt;xres_virtual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_eq
op_minus
l_int|1
)paren
(brace
id|var-&gt;xres_virtual
op_assign
(paren
id|var-&gt;xres_virtual
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|var-&gt;yres_virtual
op_assign
id|info-&gt;fix.smem_len
op_star
id|den
op_div
(paren
id|nom
op_star
id|var-&gt;xres_virtual
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;setting virtual Y resolution to %d&bslash;n&quot;
comma
id|var-&gt;yres_virtual
)paren
suffix:semicolon
)brace
r_else
(brace
id|var-&gt;xres_virtual
op_assign
(paren
id|var-&gt;xres_virtual
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_star
id|var-&gt;yres_virtual
OG
id|info-&gt;fix.smem_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;mode %dx%dx%d rejected...resolution too high to fit into video memory!&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|NVTRACE
c_func
(paren
l_string|&quot;EXIT - EINVAL error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|var-&gt;xres_virtual
op_star
id|nom
op_div
id|den
op_ge
l_int|8192
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;virtual X resolution (%d) is too high, lowering to %d&bslash;n&quot;
comma
id|var-&gt;xres_virtual
comma
l_int|8192
op_star
id|den
op_div
id|nom
op_minus
l_int|16
)paren
suffix:semicolon
id|var-&gt;xres_virtual
op_assign
l_int|8192
op_star
id|den
op_div
id|nom
op_minus
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;virtual X resolution (%d) is smaller than real&bslash;n&quot;
comma
id|var-&gt;xres_virtual
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OL
id|var-&gt;yres
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;virtual Y resolution (%d) is smaller than real&bslash;n&quot;
comma
id|var-&gt;yres_virtual
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|var-&gt;yres_virtual
OG
l_int|0x7fff
op_div
id|nom
)paren
id|var-&gt;yres_virtual
op_assign
l_int|0x7fff
op_div
id|nom
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OG
l_int|0x7fff
op_div
id|nom
)paren
id|var-&gt;xres_virtual
op_assign
l_int|0x7fff
op_div
id|nom
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|riva_set_pattern
id|riva_set_pattern
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
id|clr0
comma
r_int
id|clr1
comma
r_int
id|pat0
comma
r_int
id|pat1
)paren
(brace
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Patt
comma
l_int|4
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Patt-&gt;Color0
comma
l_int|0
comma
id|clr0
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Patt-&gt;Color1
comma
l_int|0
comma
id|clr1
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;riva.Patt-&gt;Monochrome
comma
l_int|0
comma
id|pat0
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;riva.Patt-&gt;Monochrome
comma
l_int|4
comma
id|pat1
)paren
suffix:semicolon
)brace
multiline_comment|/* acceleration routines */
DECL|function|wait_for_idle
r_inline
r_void
id|wait_for_idle
c_func
(paren
r_struct
id|riva_par
op_star
id|par
)paren
(brace
r_while
c_loop
(paren
id|par-&gt;riva
dot
id|Busy
c_func
(paren
op_amp
id|par-&gt;riva
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set ROP.  Translate X rop into ROP3.  Internal routine.&n; */
r_static
r_void
DECL|function|riva_set_rop_solid
id|riva_set_rop_solid
c_func
(paren
r_struct
id|riva_par
op_star
id|par
comma
r_int
id|rop
)paren
(brace
id|riva_set_pattern
c_func
(paren
id|par
comma
l_int|0xFFFFFFFF
comma
l_int|0xFFFFFFFF
comma
l_int|0xFFFFFFFF
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Rop
comma
l_int|1
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Rop-&gt;Rop3
comma
l_int|0
comma
id|rop
)paren
suffix:semicolon
)brace
DECL|function|riva_setup_accel
r_void
id|riva_setup_accel
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Clip
comma
l_int|2
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Clip-&gt;TopLeft
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Clip-&gt;WidthHeight
comma
l_int|0
comma
(paren
id|info-&gt;var.xres_virtual
op_amp
l_int|0xffff
)paren
op_or
(paren
id|info-&gt;var.yres_virtual
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|riva_set_rop_solid
c_func
(paren
id|par
comma
l_int|0xcc
)paren
suffix:semicolon
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * riva_get_cmap_len - query current color map length&n; * @var: standard kernel fb changeable data&n; *&n; * DESCRIPTION:&n; * Get current color map length.&n; *&n; * RETURNS:&n; * Length of color map&n; *&n; * CALLED FROM:&n; * rivafb_setcolreg()&n; */
DECL|function|riva_get_cmap_len
r_static
r_int
id|riva_get_cmap_len
c_func
(paren
r_const
r_struct
id|fb_var_screeninfo
op_star
id|var
)paren
(brace
r_int
id|rc
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* reasonable default */
r_switch
c_cond
(paren
id|var-&gt;green.length
)paren
(brace
r_case
l_int|8
suffix:colon
id|rc
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* 256 entries (2^8), 8 bpp and RGB8888 */
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|rc
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* 32 entries (2^5), 16 bpp, RGB555 */
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|rc
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* 64 entries (2^6), 16 bpp, RGB565 */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* should not occur */
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * Backlight operations&n; *&n; * ------------------------------------------------------------------------- */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
DECL|function|riva_set_backlight_enable
r_static
r_int
id|riva_set_backlight_enable
c_func
(paren
r_int
id|on
comma
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|data
suffix:semicolon
id|U032
id|tmp_pcrt
comma
id|tmp_pmc
suffix:semicolon
id|tmp_pmc
op_assign
id|par-&gt;riva.PMC
(braket
l_int|0x10F0
op_div
l_int|4
)braket
op_amp
l_int|0x0000FFFF
suffix:semicolon
id|tmp_pcrt
op_assign
id|par-&gt;riva.PCRTC0
(braket
l_int|0x081C
op_div
l_int|4
)braket
op_amp
l_int|0xFFFFFFFC
suffix:semicolon
r_if
c_cond
(paren
id|on
op_logical_and
(paren
id|level
OG
id|BACKLIGHT_OFF
)paren
)paren
(brace
id|tmp_pcrt
op_or_assign
l_int|0x1
suffix:semicolon
id|tmp_pmc
op_or_assign
(paren
l_int|1
op_lshift
l_int|31
)paren
suffix:semicolon
singleline_comment|// backlight bit
id|tmp_pmc
op_or_assign
id|riva_backlight_levels
(braket
id|level
op_minus
l_int|1
)braket
op_lshift
l_int|16
suffix:semicolon
singleline_comment|// level
)brace
id|par-&gt;riva.PCRTC0
(braket
l_int|0x081C
op_div
l_int|4
)braket
op_assign
id|tmp_pcrt
suffix:semicolon
id|par-&gt;riva.PMC
(braket
l_int|0x10F0
op_div
l_int|4
)braket
op_assign
id|tmp_pmc
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|riva_set_backlight_level
r_static
r_int
id|riva_set_backlight_level
c_func
(paren
r_int
id|level
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|riva_set_backlight_enable
c_func
(paren
l_int|1
comma
id|level
comma
id|data
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * framebuffer operations&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|rivafb_open
r_static
r_int
id|rivafb_open
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|cnt
op_assign
id|atomic_read
c_func
(paren
op_amp
id|par-&gt;ref_count
)paren
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
(brace
macro_line|#ifdef CONFIG_X86
id|memset
c_func
(paren
op_amp
id|par-&gt;state
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|vgastate
)paren
)paren
suffix:semicolon
id|par-&gt;state.flags
op_assign
id|VGA_SAVE_MODE
op_or
id|VGA_SAVE_FONTS
suffix:semicolon
multiline_comment|/* save the DAC for Riva128 */
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
id|par-&gt;state.flags
op_or_assign
id|VGA_SAVE_CMAP
suffix:semicolon
id|save_vga
c_func
(paren
op_amp
id|par-&gt;state
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* vgaHWunlock() + riva unlock (0x7F) */
id|CRTCout
c_func
(paren
id|par
comma
l_int|0x11
comma
l_int|0xFF
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|riva_save_state
c_func
(paren
id|par
comma
op_amp
id|par-&gt;initial_state
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|par-&gt;ref_count
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_release
r_static
r_int
id|rivafb_release
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_int
id|user
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|cnt
op_assign
id|atomic_read
c_func
(paren
op_amp
id|par-&gt;ref_count
)paren
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_eq
l_int|1
)paren
(brace
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LoadStateExt
c_func
(paren
op_amp
id|par-&gt;riva
comma
op_amp
id|par-&gt;initial_state.ext
)paren
suffix:semicolon
id|riva_load_state
c_func
(paren
id|par
comma
op_amp
id|par-&gt;initial_state
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_X86
id|restore_vga
c_func
(paren
op_amp
id|par-&gt;state
)paren
suffix:semicolon
macro_line|#endif
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|1
)paren
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|par-&gt;ref_count
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_check_var
r_static
r_int
id|rivafb_check_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_videomode
op_star
id|mode
suffix:semicolon
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|nom
comma
id|den
suffix:semicolon
multiline_comment|/* translating from pixels-&gt;bytes */
r_int
id|mode_valid
op_assign
l_int|0
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|var-&gt;bits_per_pixel
)paren
(brace
r_case
l_int|1
dot
dot
dot
l_int|8
suffix:colon
id|var-&gt;red.offset
op_assign
id|var-&gt;green.offset
op_assign
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|nom
op_assign
id|den
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
dot
dot
dot
l_int|15
suffix:colon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|16
suffix:colon
id|var-&gt;bits_per_pixel
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* The Riva128 supports RGB555 only */
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;green.length
op_eq
l_int|5
)paren
(brace
multiline_comment|/* 0rrrrrgg gggbbbbb */
id|var-&gt;red.offset
op_assign
l_int|10
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* rrrrrggg gggbbbbb */
id|var-&gt;red.offset
op_assign
l_int|11
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|5
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|var-&gt;red.length
op_assign
l_int|5
suffix:semicolon
id|var-&gt;green.length
op_assign
l_int|6
suffix:semicolon
id|var-&gt;blue.length
op_assign
l_int|5
suffix:semicolon
)brace
id|nom
op_assign
l_int|2
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|17
dot
dot
dot
l_int|32
suffix:colon
id|var-&gt;red.length
op_assign
id|var-&gt;green.length
op_assign
id|var-&gt;blue.length
op_assign
l_int|8
suffix:semicolon
id|var-&gt;bits_per_pixel
op_assign
l_int|32
suffix:semicolon
id|var-&gt;red.offset
op_assign
l_int|16
suffix:semicolon
id|var-&gt;green.offset
op_assign
l_int|8
suffix:semicolon
id|var-&gt;blue.offset
op_assign
l_int|0
suffix:semicolon
id|nom
op_assign
l_int|4
suffix:semicolon
id|den
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;mode %dx%dx%d rejected...color depth not supported.&bslash;n&quot;
comma
id|var-&gt;xres
comma
id|var-&gt;yres
comma
id|var-&gt;bits_per_pixel
)paren
suffix:semicolon
id|NVTRACE
c_func
(paren
l_string|&quot;EXIT, returning -EINVAL&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strictmode
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fb_validate_mode
c_func
(paren
id|var
comma
id|info
)paren
)paren
id|mode_valid
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* calculate modeline if supported by monitor */
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
op_logical_and
id|info-&gt;monspecs.gtf
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fb_get_mode
c_func
(paren
id|FB_MAXTIMINGS
comma
l_int|0
comma
id|var
comma
id|info
)paren
)paren
id|mode_valid
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
)paren
(brace
id|mode
op_assign
id|fb_find_best_mode
c_func
(paren
id|var
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
(brace
id|riva_update_var
c_func
(paren
id|var
comma
id|mode
)paren
suffix:semicolon
id|mode_valid
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode_valid
op_logical_and
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|info-&gt;modelist
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xres_virtual
OL
id|var-&gt;xres
)paren
id|var-&gt;xres_virtual
op_assign
id|var-&gt;xres
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yres_virtual
op_le
id|var-&gt;yres
)paren
id|var-&gt;yres_virtual
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rivafb_do_maximize
c_func
(paren
id|info
comma
id|var
comma
id|nom
comma
id|den
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OL
l_int|0
)paren
id|var-&gt;xoffset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
)paren
id|var-&gt;yoffset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* truncate xoffset and yoffset to maximum if too high */
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
id|var-&gt;xoffset
op_assign
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
id|var-&gt;yoffset
op_assign
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
op_minus
l_int|1
suffix:semicolon
id|var-&gt;red.msb_right
op_assign
id|var-&gt;green.msb_right
op_assign
id|var-&gt;blue.msb_right
op_assign
id|var-&gt;transp.offset
op_assign
id|var-&gt;transp.length
op_assign
id|var-&gt;transp.msb_right
op_assign
l_int|0
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_set_par
r_static
r_int
id|rivafb_set_par
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* vgaHWunlock() + riva unlock (0x7F) */
id|CRTCout
c_func
(paren
id|par
comma
l_int|0x11
comma
l_int|0xFF
)paren
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|riva_load_video_mode
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
id|riva_setup_accel
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
id|par-&gt;cursor_reset
op_assign
l_int|1
suffix:semicolon
id|info-&gt;fix.line_length
op_assign
(paren
id|info-&gt;var.xres_virtual
op_star
(paren
id|info-&gt;var.bits_per_pixel
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
id|info-&gt;fix.visual
op_assign
(paren
id|info-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
id|info-&gt;pixmap.scan_align
op_assign
l_int|1
suffix:semicolon
r_else
id|info-&gt;pixmap.scan_align
op_assign
l_int|4
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_pan_display&n; * @var: standard kernel fb changeable data&n; * @con: TODO&n; * @info: pointer to fb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Pan (or wrap, depending on the `vmode&squot; field) the display using the&n; * `xoffset&squot; and `yoffset&squot; fields of the `var&squot; structure.&n; * If the values don&squot;t fit, return -EINVAL.&n; *&n; * This call looks only at xoffset, yoffset and the FB_VMODE_YWRAP flag&n; */
DECL|function|rivafb_pan_display
r_static
r_int
id|rivafb_pan_display
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;xoffset
OG
(paren
id|var-&gt;xres_virtual
op_minus
id|var-&gt;xres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;yoffset
OG
(paren
id|var-&gt;yres_virtual
op_minus
id|var-&gt;yres
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
(brace
r_if
c_cond
(paren
id|var-&gt;yoffset
OL
l_int|0
op_logical_or
id|var-&gt;yoffset
op_ge
id|info-&gt;var.yres_virtual
op_logical_or
id|var-&gt;xoffset
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|var-&gt;xoffset
op_plus
id|info-&gt;var.xres
OG
id|info-&gt;var.xres_virtual
op_logical_or
id|var-&gt;yoffset
op_plus
id|info-&gt;var.yres
OG
id|info-&gt;var.yres_virtual
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|base
op_assign
id|var-&gt;yoffset
op_star
id|info-&gt;fix.line_length
op_plus
id|var-&gt;xoffset
suffix:semicolon
id|par-&gt;riva
dot
id|SetStartAddress
c_func
(paren
op_amp
id|par-&gt;riva
comma
id|base
)paren
suffix:semicolon
id|info-&gt;var.xoffset
op_assign
id|var-&gt;xoffset
suffix:semicolon
id|info-&gt;var.yoffset
op_assign
id|var-&gt;yoffset
suffix:semicolon
r_if
c_cond
(paren
id|var-&gt;vmode
op_amp
id|FB_VMODE_YWRAP
)paren
id|info-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
r_else
id|info-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_blank
r_static
r_int
id|rivafb_blank
c_func
(paren
r_int
id|blank
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
r_char
id|tmp
comma
id|vesa
suffix:semicolon
id|tmp
op_assign
id|SEQin
c_func
(paren
id|par
comma
l_int|0x01
)paren
op_amp
op_complement
l_int|0x20
suffix:semicolon
multiline_comment|/* screen on/off */
id|vesa
op_assign
id|CRTCin
c_func
(paren
id|par
comma
l_int|0x1a
)paren
op_amp
op_complement
l_int|0xc0
suffix:semicolon
multiline_comment|/* sync on/off */
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blank
)paren
(brace
id|tmp
op_or_assign
l_int|0x20
suffix:semicolon
r_switch
c_cond
(paren
id|blank
op_minus
l_int|1
)paren
(brace
r_case
id|VESA_NO_BLANKING
suffix:colon
r_break
suffix:semicolon
r_case
id|VESA_VSYNC_SUSPEND
suffix:colon
id|vesa
op_or_assign
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_HSYNC_SUSPEND
suffix:colon
id|vesa
op_or_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VESA_POWERDOWN
suffix:colon
id|vesa
op_or_assign
l_int|0xc0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|SEQout
c_func
(paren
id|par
comma
l_int|0x01
comma
id|tmp
)paren
suffix:semicolon
id|CRTCout
c_func
(paren
id|par
comma
l_int|0x1a
comma
id|vesa
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
id|par-&gt;FlatPanel
op_logical_and
id|_machine
op_eq
id|_MACH_Pmac
)paren
(brace
id|set_backlight_enable
c_func
(paren
op_logical_neg
id|blank
)paren
suffix:semicolon
)brace
macro_line|#endif
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_setcolreg&n; * @regno: register index&n; * @red: red component&n; * @green: green component&n; * @blue: blue component&n; * @transp: transparency&n; * @info: pointer to fb_info object containing info for current riva board&n; *&n; * DESCRIPTION:&n; * Set a single color register. The values supplied have a 16 bit&n; * magnitude.&n; *&n; * RETURNS:&n; * Return != 0 for invalid regno.&n; *&n; * CALLED FROM:&n; * fbcmap.c:fb_set_cmap()&n; */
DECL|function|rivafb_setcolreg
r_static
r_int
id|rivafb_setcolreg
c_func
(paren
r_int
id|regno
comma
r_int
id|red
comma
r_int
id|green
comma
r_int
id|blue
comma
r_int
id|transp
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|RIVA_HW_INST
op_star
id|chip
op_assign
op_amp
id|par-&gt;riva
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|regno
op_ge
id|riva_get_cmap_len
c_func
(paren
op_amp
id|info-&gt;var
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;var.grayscale
)paren
(brace
multiline_comment|/* gray = 0.30*R + 0.59*G + 0.11*B */
id|red
op_assign
id|green
op_assign
id|blue
op_assign
(paren
id|red
op_star
l_int|77
op_plus
id|green
op_star
l_int|151
op_plus
id|blue
op_star
l_int|28
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regno
OL
l_int|16
op_logical_and
id|info-&gt;fix.visual
op_eq
id|FB_VISUAL_DIRECTCOLOR
)paren
(brace
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|regno
)braket
op_assign
(paren
id|regno
op_lshift
id|info-&gt;var.red.offset
)paren
op_or
(paren
id|regno
op_lshift
id|info-&gt;var.green.offset
)paren
op_or
(paren
id|regno
op_lshift
id|info-&gt;var.blue.offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The Riva128 2D engine requires color information in&n;&t;&t; * TrueColor format even if framebuffer is in DirectColor&n;&t;&t; */
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
(brace
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|16
suffix:colon
id|par-&gt;palette
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xf800
)paren
op_rshift
l_int|1
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xf800
)paren
op_rshift
l_int|6
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xf800
)paren
op_rshift
l_int|11
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|par-&gt;palette
(braket
id|regno
)braket
op_assign
(paren
(paren
id|red
op_amp
l_int|0xff00
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|green
op_amp
l_int|0xff00
)paren
)paren
op_or
(paren
(paren
id|blue
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
multiline_comment|/* &quot;transparent&quot; stuff is completely ignored. */
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_if
c_cond
(paren
id|info-&gt;var.green.length
op_eq
l_int|5
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
op_star
l_int|8
op_plus
id|i
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|u8
id|r
comma
id|g
comma
id|b
suffix:semicolon
r_if
c_cond
(paren
id|regno
OL
l_int|32
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
op_star
l_int|8
op_plus
id|i
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
id|riva_rclut
c_func
(paren
id|chip
comma
id|regno
op_star
l_int|4
comma
op_amp
id|r
comma
op_amp
id|g
comma
op_amp
id|b
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
op_star
l_int|4
op_plus
id|i
comma
id|r
comma
id|green
op_rshift
l_int|8
comma
id|b
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|riva_wclut
c_func
(paren
id|chip
comma
id|regno
comma
id|red
op_rshift
l_int|8
comma
id|green
op_rshift
l_int|8
comma
id|blue
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_fillrect - hardware accelerated color fill function&n; * @info: pointer to fb_info structure&n; * @rect: pointer to fb_fillrect structure&n; *&n; * DESCRIPTION:&n; * This function fills up a region of framebuffer memory with a solid&n; * color with a choice of two different ROP&squot;s, copy or invert.&n; *&n; * CALLED FROM:&n; * framebuffer hook&n; */
DECL|function|rivafb_fillrect
r_static
r_void
id|rivafb_fillrect
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_fillrect
op_star
id|rect
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u_int
id|color
comma
id|rop
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
id|cfb_fillrect
c_func
(paren
id|info
comma
id|rect
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
id|color
op_assign
id|rect-&gt;color
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_ne
id|NV_ARCH_03
)paren
id|color
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|rect-&gt;color
)braket
suffix:semicolon
r_else
id|color
op_assign
id|par-&gt;palette
(braket
id|rect-&gt;color
)braket
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rect-&gt;rop
)paren
(brace
r_case
id|ROP_XOR
suffix:colon
id|rop
op_assign
l_int|0x66
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ROP_COPY
suffix:colon
r_default
suffix:colon
id|rop
op_assign
l_int|0xCC
suffix:semicolon
r_break
suffix:semicolon
)brace
id|riva_set_rop_solid
c_func
(paren
id|par
comma
id|rop
)paren
suffix:semicolon
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Bitmap
comma
l_int|1
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;Color1A
comma
l_int|0
comma
id|color
)paren
suffix:semicolon
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Bitmap
comma
l_int|2
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;UnclippedRectangle
(braket
l_int|0
)braket
dot
id|TopLeft
comma
l_int|0
comma
(paren
id|rect-&gt;dx
op_lshift
l_int|16
)paren
op_or
id|rect-&gt;dy
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;UnclippedRectangle
(braket
l_int|0
)braket
dot
id|WidthHeight
comma
l_int|0
comma
(paren
id|rect-&gt;width
op_lshift
l_int|16
)paren
op_or
id|rect-&gt;height
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|riva_set_rop_solid
c_func
(paren
id|par
comma
l_int|0xcc
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_copyarea - hardware accelerated blit function&n; * @info: pointer to fb_info structure&n; * @region: pointer to fb_copyarea structure&n; *&n; * DESCRIPTION:&n; * This copies an area of pixels from one location to another&n; *&n; * CALLED FROM:&n; * framebuffer hook&n; */
DECL|function|rivafb_copyarea
r_static
r_void
id|rivafb_copyarea
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_copyarea
op_star
id|region
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
)paren
(brace
id|cfb_copyarea
c_func
(paren
id|info
comma
id|region
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Blt
comma
l_int|3
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Blt-&gt;TopLeftSrc
comma
l_int|0
comma
(paren
id|region-&gt;sy
op_lshift
l_int|16
)paren
op_or
id|region-&gt;sx
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Blt-&gt;TopLeftDst
comma
l_int|0
comma
(paren
id|region-&gt;dy
op_lshift
l_int|16
)paren
op_or
id|region-&gt;dx
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Blt-&gt;WidthHeight
comma
l_int|0
comma
(paren
id|region-&gt;height
op_lshift
l_int|16
)paren
op_or
id|region-&gt;width
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|convert_bgcolor_16
r_static
r_inline
r_void
id|convert_bgcolor_16
c_func
(paren
id|u32
op_star
id|col
)paren
(brace
op_star
id|col
op_assign
(paren
(paren
op_star
id|col
op_amp
l_int|0x0000F800
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
op_star
id|col
op_amp
l_int|0x00007E0
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
op_star
id|col
op_amp
l_int|0x0000001F
)paren
op_lshift
l_int|3
)paren
op_or
l_int|0xFF000000
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * rivafb_imageblit: hardware accelerated color expand function&n; * @info: pointer to fb_info structure&n; * @image: pointer to fb_image structure&n; *&n; * DESCRIPTION:&n; * If the source is a monochrome bitmap, the function fills up a a region&n; * of framebuffer memory with pixels whose color is determined by the bit&n; * setting of the bitmap, 1 - foreground, 0 - background.&n; *&n; * If the source is not a monochrome bitmap, color expansion is not done.&n; * In this case, it is channeled to a software function.&n; *&n; * CALLED FROM:&n; * framebuffer hook&n; */
DECL|function|rivafb_imageblit
r_static
r_void
id|rivafb_imageblit
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_const
r_struct
id|fb_image
op_star
id|image
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u32
id|fgx
op_assign
l_int|0
comma
id|bgx
op_assign
l_int|0
comma
id|width
comma
id|tmp
suffix:semicolon
id|u8
op_star
id|cdat
op_assign
(paren
id|u8
op_star
)paren
id|image-&gt;data
suffix:semicolon
r_volatile
id|u32
id|__iomem
op_star
id|d
suffix:semicolon
r_int
id|i
comma
id|size
suffix:semicolon
r_if
c_cond
(paren
(paren
id|info-&gt;flags
op_amp
id|FBINFO_HWACCEL_DISABLED
)paren
op_logical_or
id|image-&gt;depth
op_ne
l_int|1
)paren
(brace
id|cfb_imageblit
c_func
(paren
id|info
comma
id|image
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|info-&gt;var.bits_per_pixel
)paren
(brace
r_case
l_int|8
suffix:colon
id|fgx
op_assign
id|image-&gt;fg_color
suffix:semicolon
id|bgx
op_assign
id|image-&gt;bg_color
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
r_case
l_int|32
suffix:colon
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_ne
id|NV_ARCH_03
)paren
(brace
id|fgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;fg_color
)braket
suffix:semicolon
id|bgx
op_assign
(paren
(paren
id|u32
op_star
)paren
id|info-&gt;pseudo_palette
)paren
(braket
id|image-&gt;bg_color
)braket
suffix:semicolon
)brace
r_else
(brace
id|fgx
op_assign
id|par-&gt;palette
(braket
id|image-&gt;fg_color
)braket
suffix:semicolon
id|bgx
op_assign
id|par-&gt;palette
(braket
id|image-&gt;bg_color
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;var.green.length
op_eq
l_int|6
)paren
id|convert_bgcolor_16
c_func
(paren
op_amp
id|bgx
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Bitmap
comma
l_int|7
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;ClipE.TopLeft
comma
l_int|0
comma
(paren
id|image-&gt;dy
op_lshift
l_int|16
)paren
op_or
(paren
id|image-&gt;dx
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;ClipE.BottomRight
comma
l_int|0
comma
(paren
(paren
(paren
id|image-&gt;dy
op_plus
id|image-&gt;height
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|image-&gt;dx
op_plus
id|image-&gt;width
)paren
op_amp
l_int|0xffff
)paren
)paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;Color0E
comma
l_int|0
comma
id|bgx
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;Color1E
comma
l_int|0
comma
id|fgx
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;WidthHeightInE
comma
l_int|0
comma
(paren
id|image-&gt;height
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|image-&gt;width
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
)paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;WidthHeightOutE
comma
l_int|0
comma
(paren
id|image-&gt;height
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|image-&gt;width
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
)paren
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
op_amp
id|par-&gt;riva.Bitmap-&gt;PointE
comma
l_int|0
comma
(paren
id|image-&gt;dy
op_lshift
l_int|16
)paren
op_or
(paren
id|image-&gt;dx
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|d
op_assign
op_amp
id|par-&gt;riva.Bitmap-&gt;MonochromeData01E
suffix:semicolon
id|width
op_assign
(paren
id|image-&gt;width
op_plus
l_int|31
)paren
op_div
l_int|32
suffix:semicolon
id|size
op_assign
id|width
op_star
id|image-&gt;height
suffix:semicolon
r_while
c_loop
(paren
id|size
op_ge
l_int|16
)paren
(brace
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Bitmap
comma
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
op_star
(paren
(paren
id|u32
op_star
)paren
id|cdat
)paren
suffix:semicolon
id|cdat
op_assign
(paren
id|u8
op_star
)paren
(paren
(paren
id|u32
op_star
)paren
id|cdat
op_plus
l_int|1
)paren
suffix:semicolon
id|reverse_order
c_func
(paren
op_amp
id|tmp
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|d
comma
id|i
op_star
l_int|4
comma
id|tmp
)paren
suffix:semicolon
)brace
id|size
op_sub_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
)paren
(brace
id|RIVA_FIFO_FREE
c_func
(paren
id|par-&gt;riva
comma
id|Bitmap
comma
id|size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
op_star
(paren
(paren
id|u32
op_star
)paren
id|cdat
)paren
suffix:semicolon
id|cdat
op_assign
(paren
id|u8
op_star
)paren
(paren
(paren
id|u32
op_star
)paren
id|cdat
op_plus
l_int|1
)paren
suffix:semicolon
id|reverse_order
c_func
(paren
op_amp
id|tmp
)paren
suffix:semicolon
id|NV_WR32
c_func
(paren
id|d
comma
id|i
op_star
l_int|4
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/**&n; * rivafb_cursor - hardware cursor function&n; * @info: pointer to info structure&n; * @cursor: pointer to fbcursor structure&n; *&n; * DESCRIPTION:&n; * A cursor function that supports displaying a cursor image via hardware.&n; * Within the kernel, copy and invert rops are supported.  If exported&n; * to user space, only the copy rop will be supported.&n; *&n; * CALLED FROM&n; * framebuffer hook&n; */
DECL|function|rivafb_cursor
r_static
r_int
id|rivafb_cursor
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|fb_cursor
op_star
id|cursor
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|u8
id|data
(braket
id|MAX_CURS
op_star
id|MAX_CURS
op_div
l_int|8
)braket
suffix:semicolon
id|u16
id|fg
comma
id|bg
suffix:semicolon
r_int
id|i
comma
id|set
op_assign
id|cursor-&gt;set
suffix:semicolon
id|par-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;cursor_reset
)paren
(brace
id|set
op_assign
id|FB_CUR_SETALL
suffix:semicolon
id|par-&gt;cursor_reset
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_amp
id|FB_CUR_SETSIZE
)paren
id|memset_io
c_func
(paren
id|par-&gt;riva.CURSOR
comma
l_int|0
comma
id|MAX_CURS
op_star
id|MAX_CURS
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set
op_amp
id|FB_CUR_SETPOS
)paren
(brace
id|u32
id|xx
comma
id|yy
comma
id|temp
suffix:semicolon
id|yy
op_assign
id|cursor-&gt;image.dy
op_minus
id|info-&gt;var.yoffset
suffix:semicolon
id|xx
op_assign
id|cursor-&gt;image.dx
op_minus
id|info-&gt;var.xoffset
suffix:semicolon
id|temp
op_assign
id|xx
op_amp
l_int|0xFFFF
suffix:semicolon
id|temp
op_or_assign
id|yy
op_lshift
l_int|16
suffix:semicolon
id|NV_WR32
c_func
(paren
id|par-&gt;riva.PRAMDAC
comma
l_int|0x0000300
comma
id|temp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set
op_amp
(paren
id|FB_CUR_SETSHAPE
op_or
id|FB_CUR_SETCMAP
op_or
id|FB_CUR_SETIMAGE
)paren
)paren
(brace
id|u32
id|bg_idx
op_assign
id|cursor-&gt;image.bg_color
suffix:semicolon
id|u32
id|fg_idx
op_assign
id|cursor-&gt;image.fg_color
suffix:semicolon
id|u32
id|s_pitch
op_assign
(paren
id|cursor-&gt;image.width
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
id|u32
id|d_pitch
op_assign
id|MAX_CURS
op_div
l_int|8
suffix:semicolon
id|u8
op_star
id|dat
op_assign
(paren
id|u8
op_star
)paren
id|cursor-&gt;image.data
suffix:semicolon
id|u8
op_star
id|msk
op_assign
(paren
id|u8
op_star
)paren
id|cursor-&gt;mask
suffix:semicolon
id|u8
id|src
(braket
l_int|64
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|cursor-&gt;rop
)paren
(brace
r_case
id|ROP_XOR
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|s_pitch
op_star
id|cursor-&gt;image.height
suffix:semicolon
id|i
op_increment
)paren
id|src
(braket
id|i
)braket
op_assign
id|dat
(braket
id|i
)braket
op_xor
id|msk
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ROP_COPY
suffix:colon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|s_pitch
op_star
id|cursor-&gt;image.height
suffix:semicolon
id|i
op_increment
)paren
id|src
(braket
id|i
)braket
op_assign
id|dat
(braket
id|i
)braket
op_amp
id|msk
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
id|fb_sysmove_buf_aligned
c_func
(paren
id|info
comma
op_amp
id|info-&gt;pixmap
comma
id|data
comma
id|d_pitch
comma
id|src
comma
id|s_pitch
comma
id|cursor-&gt;image.height
)paren
suffix:semicolon
id|bg
op_assign
(paren
(paren
id|info-&gt;cmap.red
(braket
id|bg_idx
)braket
op_amp
l_int|0xf8
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|info-&gt;cmap.green
(braket
id|bg_idx
)braket
op_amp
l_int|0xf8
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|info-&gt;cmap.blue
(braket
id|bg_idx
)braket
op_amp
l_int|0xf8
)paren
op_rshift
l_int|3
)paren
op_or
l_int|1
op_lshift
l_int|15
suffix:semicolon
id|fg
op_assign
(paren
(paren
id|info-&gt;cmap.red
(braket
id|fg_idx
)braket
op_amp
l_int|0xf8
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|info-&gt;cmap.green
(braket
id|fg_idx
)braket
op_amp
l_int|0xf8
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|info-&gt;cmap.blue
(braket
id|fg_idx
)braket
op_amp
l_int|0xf8
)paren
op_rshift
l_int|3
)paren
op_or
l_int|1
op_lshift
l_int|15
suffix:semicolon
id|par-&gt;riva
dot
id|LockUnlock
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|0
)paren
suffix:semicolon
id|rivafb_load_cursor_image
c_func
(paren
id|par
comma
id|data
comma
id|bg
comma
id|fg
comma
id|cursor-&gt;image.width
comma
id|cursor-&gt;image.height
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cursor-&gt;enable
)paren
id|par-&gt;riva
dot
id|ShowHideCursor
c_func
(paren
op_amp
id|par-&gt;riva
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rivafb_sync
r_static
r_int
id|rivafb_sync
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|wait_for_idle
c_func
(paren
id|par
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * initialization helper functions&n; *&n; * ------------------------------------------------------------------------- */
multiline_comment|/* kernel interface */
DECL|variable|riva_fb_ops
r_static
r_struct
id|fb_ops
id|riva_fb_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|fb_open
op_assign
id|rivafb_open
comma
dot
id|fb_release
op_assign
id|rivafb_release
comma
dot
id|fb_check_var
op_assign
id|rivafb_check_var
comma
dot
id|fb_set_par
op_assign
id|rivafb_set_par
comma
dot
id|fb_setcolreg
op_assign
id|rivafb_setcolreg
comma
dot
id|fb_pan_display
op_assign
id|rivafb_pan_display
comma
dot
id|fb_blank
op_assign
id|rivafb_blank
comma
dot
id|fb_fillrect
op_assign
id|rivafb_fillrect
comma
dot
id|fb_copyarea
op_assign
id|rivafb_copyarea
comma
dot
id|fb_imageblit
op_assign
id|rivafb_imageblit
comma
dot
id|fb_cursor
op_assign
id|rivafb_cursor
comma
dot
id|fb_sync
op_assign
id|rivafb_sync
comma
)brace
suffix:semicolon
DECL|function|riva_set_fbinfo
r_static
r_int
id|__devinit
id|riva_set_fbinfo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_int
r_int
id|cmap_len
suffix:semicolon
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|info-&gt;flags
op_assign
id|FBINFO_DEFAULT
op_or
id|FBINFO_HWACCEL_XPAN
op_or
id|FBINFO_HWACCEL_YPAN
op_or
id|FBINFO_HWACCEL_COPYAREA
op_or
id|FBINFO_HWACCEL_FILLRECT
op_or
id|FBINFO_HWACCEL_IMAGEBLIT
op_or
id|FBINFO_MISC_MODESWITCHLATE
suffix:semicolon
multiline_comment|/* Accel seems to not work properly on NV30 yet...*/
r_if
c_cond
(paren
(paren
id|par-&gt;riva.Architecture
op_eq
id|NV_ARCH_30
)paren
op_logical_or
id|noaccel
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;disabling acceleration&bslash;n&quot;
)paren
suffix:semicolon
id|info-&gt;flags
op_or_assign
id|FBINFO_HWACCEL_DISABLED
suffix:semicolon
)brace
id|info-&gt;var
op_assign
id|rivafb_default_var
suffix:semicolon
id|info-&gt;fix.visual
op_assign
(paren
id|info-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
ques
c_cond
id|FB_VISUAL_PSEUDOCOLOR
suffix:colon
id|FB_VISUAL_DIRECTCOLOR
suffix:semicolon
id|info-&gt;pseudo_palette
op_assign
id|par-&gt;pseudo_palette
suffix:semicolon
id|cmap_len
op_assign
id|riva_get_cmap_len
c_func
(paren
op_amp
id|info-&gt;var
)paren
suffix:semicolon
id|fb_alloc_cmap
c_func
(paren
op_amp
id|info-&gt;cmap
comma
id|cmap_len
comma
l_int|0
)paren
suffix:semicolon
id|info-&gt;pixmap.size
op_assign
l_int|8
op_star
l_int|1024
suffix:semicolon
id|info-&gt;pixmap.buf_align
op_assign
l_int|4
suffix:semicolon
id|info-&gt;pixmap.flags
op_assign
id|FB_PIXMAP_SYSTEM
suffix:semicolon
id|info-&gt;var.yres_virtual
op_assign
op_minus
l_int|1
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|rivafb_check_var
c_func
(paren
op_amp
id|info-&gt;var
comma
id|info
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PPC_OF
DECL|function|riva_get_EDID_OF
r_static
r_int
id|__devinit
id|riva_get_EDID_OF
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_struct
id|device_node
op_star
id|dp
suffix:semicolon
r_int
r_char
op_star
id|pedid
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|disptype
op_assign
l_int|NULL
suffix:semicolon
r_static
r_char
op_star
id|propnames
(braket
)braket
op_assign
(brace
l_string|&quot;DFP,EDID&quot;
comma
l_string|&quot;LCD,EDID&quot;
comma
l_string|&quot;EDID&quot;
comma
l_string|&quot;EDID1&quot;
comma
l_string|&quot;EDID,B&quot;
comma
l_string|&quot;EDID,A&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|dp
op_assign
id|pci_device_to_OF_node
c_func
(paren
id|pd
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dp
op_ne
l_int|NULL
suffix:semicolon
id|dp
op_assign
id|dp-&gt;child
)paren
(brace
id|disptype
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_property
c_func
(paren
id|dp
comma
l_string|&quot;display-type&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disptype
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|disptype
comma
l_string|&quot;LCD&quot;
comma
l_int|3
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|propnames
(braket
id|i
)braket
op_ne
l_int|NULL
suffix:semicolon
op_increment
id|i
)paren
(brace
id|pedid
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_property
c_func
(paren
id|dp
comma
id|propnames
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pedid
op_ne
l_int|NULL
)paren
(brace
id|par-&gt;EDID
op_assign
id|pedid
suffix:semicolon
id|NVTRACE
c_func
(paren
l_string|&quot;LCD found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PPC_OF */
macro_line|#if defined(CONFIG_FB_RIVA_I2C) &amp;&amp; !defined(CONFIG_PPC_OF)
DECL|function|riva_get_EDID_i2c
r_static
r_int
id|__devinit
id|riva_get_EDID_i2c
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
r_int
id|i
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
id|riva_create_i2c_busses
c_func
(paren
id|par
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|par-&gt;bus
suffix:semicolon
id|i
op_ge
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|riva_probe_i2c_connector
c_func
(paren
id|par
comma
id|i
comma
op_amp
id|par-&gt;EDID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;EDID
)paren
(brace
id|printk
c_func
(paren
id|PFX
l_string|&quot;Found EDID Block from BUS %i&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|par-&gt;EDID
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FB_RIVA_I2C */
DECL|function|riva_update_default_var
r_static
r_void
id|__devinit
id|riva_update_default_var
c_func
(paren
r_struct
id|fb_var_screeninfo
op_star
id|var
comma
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_monspecs
op_star
id|specs
op_assign
op_amp
id|info-&gt;monspecs
suffix:semicolon
r_struct
id|fb_videomode
id|modedb
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* respect mode options */
r_if
c_cond
(paren
id|mode_option
)paren
(brace
id|fb_find_mode
c_func
(paren
id|var
comma
id|info
comma
id|mode_option
comma
id|specs-&gt;modedb
comma
id|specs-&gt;modedb_len
comma
l_int|NULL
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|specs-&gt;modedb
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* get preferred timing */
r_if
c_cond
(paren
id|info-&gt;monspecs.misc
op_amp
id|FB_MISC_1ST_DETAIL
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|specs-&gt;modedb_len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|specs-&gt;modedb
(braket
id|i
)braket
dot
id|flag
op_amp
id|FB_MODE_IS_FIRST
)paren
(brace
id|modedb
op_assign
id|specs-&gt;modedb
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* otherwise, get first mode in database */
id|modedb
op_assign
id|specs-&gt;modedb
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|var-&gt;bits_per_pixel
op_assign
l_int|8
suffix:semicolon
id|riva_update_var
c_func
(paren
id|var
comma
op_amp
id|modedb
)paren
suffix:semicolon
)brace
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|riva_get_EDID
r_static
r_void
id|__devinit
id|riva_get_EDID
c_func
(paren
r_struct
id|fb_info
op_star
id|info
comma
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_OF
r_if
c_cond
(paren
op_logical_neg
id|riva_get_EDID_OF
c_func
(paren
id|info
comma
id|pdev
)paren
)paren
id|printk
c_func
(paren
id|PFX
l_string|&quot;could not retrieve EDID from OF&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#elif CONFIG_FB_RIVA_I2C
r_if
c_cond
(paren
op_logical_neg
id|riva_get_EDID_i2c
c_func
(paren
id|info
)paren
)paren
id|printk
c_func
(paren
id|PFX
l_string|&quot;could not retrieve EDID from DDC/I2C&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|riva_get_edidinfo
r_static
r_void
id|__devinit
id|riva_get_edidinfo
c_func
(paren
r_struct
id|fb_info
op_star
id|info
)paren
(brace
r_struct
id|fb_var_screeninfo
op_star
id|var
op_assign
op_amp
id|rivafb_default_var
suffix:semicolon
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|fb_edid_to_monspecs
c_func
(paren
id|par-&gt;EDID
comma
op_amp
id|info-&gt;monspecs
)paren
suffix:semicolon
id|fb_videomode_to_modelist
c_func
(paren
id|info-&gt;monspecs.modedb
comma
id|info-&gt;monspecs.modedb_len
comma
op_amp
id|info-&gt;modelist
)paren
suffix:semicolon
id|riva_update_default_var
c_func
(paren
id|var
comma
id|info
)paren
suffix:semicolon
multiline_comment|/* if user specified flatpanel, we respect that */
r_if
c_cond
(paren
id|info-&gt;monspecs.input
op_amp
id|FB_DISP_DDI
)paren
id|par-&gt;FlatPanel
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * PCI bus&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|riva_get_arch
r_static
id|u32
id|__devinit
id|riva_get_arch
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
id|u32
id|arch
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|pd-&gt;device
op_amp
l_int|0x0ff0
)paren
(brace
r_case
l_int|0x0100
suffix:colon
multiline_comment|/* GeForce 256 */
r_case
l_int|0x0110
suffix:colon
multiline_comment|/* GeForce2 MX */
r_case
l_int|0x0150
suffix:colon
multiline_comment|/* GeForce2 */
r_case
l_int|0x0170
suffix:colon
multiline_comment|/* GeForce4 MX */
r_case
l_int|0x0180
suffix:colon
multiline_comment|/* GeForce4 MX (8x AGP) */
r_case
l_int|0x01A0
suffix:colon
multiline_comment|/* nForce */
r_case
l_int|0x01F0
suffix:colon
multiline_comment|/* nForce2 */
id|arch
op_assign
id|NV_ARCH_10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0200
suffix:colon
multiline_comment|/* GeForce3 */
r_case
l_int|0x0250
suffix:colon
multiline_comment|/* GeForce4 Ti */
r_case
l_int|0x0280
suffix:colon
multiline_comment|/* GeForce4 Ti (8x AGP) */
id|arch
op_assign
id|NV_ARCH_20
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0300
suffix:colon
multiline_comment|/* GeForceFX 5800 */
r_case
l_int|0x0310
suffix:colon
multiline_comment|/* GeForceFX 5600 */
r_case
l_int|0x0320
suffix:colon
multiline_comment|/* GeForceFX 5200 */
r_case
l_int|0x0330
suffix:colon
multiline_comment|/* GeForceFX 5900 */
r_case
l_int|0x0340
suffix:colon
multiline_comment|/* GeForceFX 5700 */
id|arch
op_assign
id|NV_ARCH_30
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0020
suffix:colon
multiline_comment|/* TNT, TNT2 */
id|arch
op_assign
id|NV_ARCH_04
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0010
suffix:colon
multiline_comment|/* Riva128 */
id|arch
op_assign
id|NV_ARCH_03
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* unknown architecture */
r_break
suffix:semicolon
)brace
r_return
id|arch
suffix:semicolon
)brace
DECL|function|rivafb_probe
r_static
r_int
id|__devinit
id|rivafb_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|riva_par
op_star
id|default_par
suffix:semicolon
r_struct
id|fb_info
op_star
id|info
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
m_assert
(paren
id|pd
op_ne
l_int|NULL
)paren
suffix:semicolon
id|info
op_assign
id|framebuffer_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|riva_par
)paren
comma
op_amp
id|pd-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_goto
id|err_out
suffix:semicolon
id|default_par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|default_par-&gt;pdev
op_assign
id|pd
suffix:semicolon
id|info-&gt;pixmap.addr
op_assign
id|kmalloc
c_func
(paren
l_int|8
op_star
l_int|1024
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;pixmap.addr
op_eq
l_int|NULL
)paren
r_goto
id|err_out_kfree
suffix:semicolon
id|memset
c_func
(paren
id|info-&gt;pixmap.addr
comma
l_int|0
comma
l_int|8
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pd
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot enable PCI device&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_enable
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_request_regions
c_func
(paren
id|pd
comma
l_string|&quot;rivafb&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot request PCI regions&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_request
suffix:semicolon
)brace
id|default_par-&gt;riva.Architecture
op_assign
id|riva_get_arch
c_func
(paren
id|pd
)paren
suffix:semicolon
id|default_par-&gt;Chipset
op_assign
(paren
id|pd-&gt;vendor
op_lshift
l_int|16
)paren
op_or
id|pd-&gt;device
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;nVidia device/chipset %X&bslash;n&quot;
comma
id|default_par-&gt;Chipset
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI_NAMES
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;%s&bslash;n&quot;
comma
id|pd-&gt;pretty_name
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|default_par-&gt;riva.Architecture
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unknown NV_ARCH&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_base0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|default_par-&gt;riva.Architecture
op_eq
id|NV_ARCH_10
op_logical_or
id|default_par-&gt;riva.Architecture
op_eq
id|NV_ARCH_20
op_logical_or
id|default_par-&gt;riva.Architecture
op_eq
id|NV_ARCH_30
)paren
(brace
id|sprintf
c_func
(paren
id|rivafb_fix.id
comma
l_string|&quot;NV%x&quot;
comma
(paren
id|pd-&gt;device
op_amp
l_int|0x0ff0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|rivafb_fix.id
comma
l_string|&quot;NV%x&quot;
comma
id|default_par-&gt;riva.Architecture
)paren
suffix:semicolon
)brace
id|default_par-&gt;FlatPanel
op_assign
id|flatpanel
suffix:semicolon
r_if
c_cond
(paren
id|flatpanel
op_eq
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;flatpanel support enabled&bslash;n&quot;
)paren
suffix:semicolon
id|default_par-&gt;forceCRTC
op_assign
id|forceCRTC
suffix:semicolon
id|rivafb_fix.mmio_len
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
id|rivafb_fix.smem_len
op_assign
id|pci_resource_len
c_func
(paren
id|pd
comma
l_int|1
)paren
suffix:semicolon
(brace
multiline_comment|/* enable IO and mem if not already done */
r_int
r_int
id|cmd
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pd
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd
op_or_assign
(paren
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MEMORY
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pd
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
)brace
id|rivafb_fix.mmio_start
op_assign
id|pci_resource_start
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
id|rivafb_fix.smem_start
op_assign
id|pci_resource_start
c_func
(paren
id|pd
comma
l_int|1
)paren
suffix:semicolon
id|default_par-&gt;ctrl_base
op_assign
id|ioremap
c_func
(paren
id|rivafb_fix.mmio_start
comma
id|rivafb_fix.mmio_len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|default_par-&gt;ctrl_base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot ioremap MMIO base&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_base0
suffix:semicolon
)brace
id|info-&gt;par
op_assign
id|default_par
suffix:semicolon
r_switch
c_cond
(paren
id|default_par-&gt;riva.Architecture
)paren
(brace
r_case
id|NV_ARCH_03
suffix:colon
multiline_comment|/* Riva128&squot;s PRAMIN is in the &quot;framebuffer&quot; space&n;&t;&t; * Since these cards were never made with more than 8 megabytes&n;&t;&t; * we can safely allocate this separately.&n;&t;&t; */
id|default_par-&gt;riva.PRAMIN
op_assign
id|ioremap
c_func
(paren
id|rivafb_fix.smem_start
op_plus
l_int|0x00C00000
comma
l_int|0x00008000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|default_par-&gt;riva.PRAMIN
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot ioremap PRAMIN region&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_nv3_pramin
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|NV_ARCH_04
suffix:colon
r_case
id|NV_ARCH_10
suffix:colon
r_case
id|NV_ARCH_20
suffix:colon
r_case
id|NV_ARCH_30
suffix:colon
id|default_par-&gt;riva.PCRTC0
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
(paren
id|default_par-&gt;ctrl_base
op_plus
l_int|0x00600000
)paren
suffix:semicolon
id|default_par-&gt;riva.PRAMIN
op_assign
(paren
id|u32
id|__iomem
op_star
)paren
(paren
id|default_par-&gt;ctrl_base
op_plus
l_int|0x00710000
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|riva_common_setup
c_func
(paren
id|default_par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
(brace
id|default_par-&gt;riva.PCRTC
op_assign
id|default_par-&gt;riva.PCRTC0
op_assign
id|default_par-&gt;riva.PGRAPH
suffix:semicolon
)brace
id|rivafb_fix.smem_len
op_assign
id|riva_get_memlen
c_func
(paren
id|default_par
)paren
op_star
l_int|1024
suffix:semicolon
id|default_par-&gt;dclk_max
op_assign
id|riva_get_maxdclk
c_func
(paren
id|default_par
)paren
op_star
l_int|1000
suffix:semicolon
id|info-&gt;screen_base
op_assign
id|ioremap
c_func
(paren
id|rivafb_fix.smem_start
comma
id|rivafb_fix.smem_len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;screen_base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot ioremap FB base&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_base1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
op_logical_neg
id|nomtrr
)paren
(brace
id|default_par-&gt;mtrr.vram
op_assign
id|mtrr_add
c_func
(paren
id|rivafb_fix.smem_start
comma
id|rivafb_fix.smem_len
comma
id|MTRR_TYPE_WRCOMB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_par-&gt;mtrr.vram
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to setup MTRR&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|default_par-&gt;mtrr.vram_valid
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* let there be speed */
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;RIVA MTRR set to ON&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_MTRR */
id|info-&gt;fbops
op_assign
op_amp
id|riva_fb_ops
suffix:semicolon
id|info-&gt;fix
op_assign
id|rivafb_fix
suffix:semicolon
id|riva_get_EDID
c_func
(paren
id|info
comma
id|pd
)paren
suffix:semicolon
id|riva_get_edidinfo
c_func
(paren
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|riva_set_fbinfo
c_func
(paren
id|info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;error setting initial video mode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap_fb
suffix:semicolon
)brace
id|fb_destroy_modedb
c_func
(paren
id|info-&gt;monspecs.modedb
)paren
suffix:semicolon
id|info-&gt;monspecs.modedb_len
op_assign
l_int|0
suffix:semicolon
id|info-&gt;monspecs.modedb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|register_framebuffer
c_func
(paren
id|info
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;error registering riva framebuffer&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap_fb
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pd
comma
id|info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;PCI nVidia %s framebuffer ver %s (%dMB @ 0x%lX)&bslash;n&quot;
comma
id|info-&gt;fix.id
comma
id|RIVAFB_VERSION
comma
id|info-&gt;fix.smem_len
op_div
(paren
l_int|1024
op_star
l_int|1024
)paren
comma
id|info-&gt;fix.smem_start
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
id|default_par-&gt;FlatPanel
op_logical_and
id|_machine
op_eq
id|_MACH_Pmac
)paren
id|register_backlight_controller
c_func
(paren
op_amp
id|riva_backlight_controller
comma
id|default_par
comma
l_string|&quot;mnca&quot;
)paren
suffix:semicolon
macro_line|#endif
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_iounmap_fb
suffix:colon
macro_line|#ifdef CONFIG_FB_RIVA_I2C
id|riva_delete_i2c_busses
c_func
(paren
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
)paren
suffix:semicolon
macro_line|#endif
id|iounmap
c_func
(paren
id|info-&gt;screen_base
)paren
suffix:semicolon
id|err_out_free_base1
suffix:colon
r_if
c_cond
(paren
id|default_par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
id|iounmap
c_func
(paren
id|default_par-&gt;riva.PRAMIN
)paren
suffix:semicolon
id|err_out_free_nv3_pramin
suffix:colon
id|iounmap
c_func
(paren
id|default_par-&gt;ctrl_base
)paren
suffix:semicolon
id|err_out_free_base0
suffix:colon
id|pci_release_regions
c_func
(paren
id|pd
)paren
suffix:semicolon
id|err_out_request
suffix:colon
id|pci_disable_device
c_func
(paren
id|pd
)paren
suffix:semicolon
id|err_out_enable
suffix:colon
id|kfree
c_func
(paren
id|info-&gt;pixmap.addr
)paren
suffix:semicolon
id|err_out_kfree
suffix:colon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
id|err_out
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|rivafb_remove
r_static
r_void
id|__exit
id|rivafb_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pd
)paren
(brace
r_struct
id|fb_info
op_star
id|info
op_assign
id|pci_get_drvdata
c_func
(paren
id|pd
)paren
suffix:semicolon
r_struct
id|riva_par
op_star
id|par
op_assign
(paren
r_struct
id|riva_par
op_star
)paren
id|info-&gt;par
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_FB_RIVA_I2C
id|riva_delete_i2c_busses
c_func
(paren
id|par
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;EDID
)paren
id|kfree
c_func
(paren
id|par-&gt;EDID
)paren
suffix:semicolon
macro_line|#endif
id|unregister_framebuffer
c_func
(paren
id|info
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
r_if
c_cond
(paren
id|par-&gt;mtrr.vram_valid
)paren
id|mtrr_del
c_func
(paren
id|par-&gt;mtrr.vram
comma
id|info-&gt;fix.smem_start
comma
id|info-&gt;fix.smem_len
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MTRR */
id|iounmap
c_func
(paren
id|par-&gt;ctrl_base
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|info-&gt;screen_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|par-&gt;riva.Architecture
op_eq
id|NV_ARCH_03
)paren
id|iounmap
c_func
(paren
id|par-&gt;riva.PRAMIN
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pd
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pd
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|info-&gt;pixmap.addr
)paren
suffix:semicolon
id|framebuffer_release
c_func
(paren
id|info
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pd
comma
l_int|NULL
)paren
suffix:semicolon
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * initialization&n; *&n; * ------------------------------------------------------------------------- */
macro_line|#ifndef MODULE
DECL|function|rivafb_setup
r_int
id|__init
id|rivafb_setup
c_func
(paren
r_char
op_star
id|options
)paren
(brace
r_char
op_star
id|this_opt
suffix:semicolon
id|NVTRACE_ENTER
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
op_logical_neg
op_star
id|options
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|strsep
c_func
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;forceCRTC&quot;
comma
l_int|9
)paren
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|this_opt
op_plus
l_int|9
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
op_logical_or
op_logical_neg
op_star
(paren
op_increment
id|p
)paren
)paren
r_continue
suffix:semicolon
id|forceCRTC
op_assign
op_star
id|p
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|forceCRTC
template_param
l_int|1
)paren
id|forceCRTC
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;flatpanel&quot;
comma
l_int|9
)paren
)paren
(brace
id|flatpanel
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;nomtrr&quot;
comma
l_int|6
)paren
)paren
(brace
id|nomtrr
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;strictmode&quot;
comma
l_int|10
)paren
)paren
(brace
id|strictmode
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|this_opt
comma
l_string|&quot;noaccel&quot;
comma
l_int|7
)paren
)paren
(brace
id|noaccel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|mode_option
op_assign
id|this_opt
suffix:semicolon
)brace
id|NVTRACE_LEAVE
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* !MODULE */
DECL|variable|rivafb_driver
r_static
r_struct
id|pci_driver
id|rivafb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;rivafb&quot;
comma
dot
id|id_table
op_assign
id|rivafb_pci_tbl
comma
dot
id|probe
op_assign
id|rivafb_probe
comma
dot
id|remove
op_assign
id|__exit_p
c_func
(paren
id|rivafb_remove
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------------- *&n; *&n; * modularization&n; *&n; * ------------------------------------------------------------------------- */
DECL|function|rivafb_init
r_int
id|__devinit
id|rivafb_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef MODULE
r_char
op_star
id|option
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fb_get_options
c_func
(paren
l_string|&quot;rivafb&quot;
comma
op_amp
id|option
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|rivafb_setup
c_func
(paren
id|option
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_register_driver
c_func
(paren
op_amp
id|rivafb_driver
)paren
suffix:semicolon
)brace
DECL|variable|rivafb_init
id|module_init
c_func
(paren
id|rivafb_init
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|function|rivafb_exit
r_static
r_void
id|__exit
id|rivafb_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|rivafb_driver
)paren
suffix:semicolon
)brace
DECL|variable|rivafb_exit
id|module_exit
c_func
(paren
id|rivafb_exit
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
id|module_param
c_func
(paren
id|noaccel
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|noaccel
comma
l_string|&quot;bool: disable acceleration&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|flatpanel
comma
r_int
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|flatpanel
comma
l_string|&quot;Enables experimental flat panel support for some chipsets. (0 or 1=enabled) (default=0)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|forceCRTC
comma
r_int
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|forceCRTC
comma
l_string|&quot;Forces usage of a particular CRTC in case autodetection fails. (0 or 1) (default=autodetect)&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MTRR
id|module_param
c_func
(paren
id|nomtrr
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nomtrr
comma
l_string|&quot;Disables MTRR support (0 or 1=disabled) (default=0)&quot;
)paren
suffix:semicolon
macro_line|#endif
id|module_param
c_func
(paren
id|strictmode
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|strictmode
comma
l_string|&quot;Only use video modes from EDID&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ani Joshi, maintainer&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Framebuffer driver for nVidia Riva 128, TNT, TNT2, and the GeForce series&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
