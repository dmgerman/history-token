multiline_comment|/*&n; * &t;w1_io.c&n; *&n; * Copyright (c) 2004 Evgeniy Polyakov &lt;johnpol@2ka.mipt.ru&gt;&n; * &n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; */
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &quot;w1.h&quot;
macro_line|#include &quot;w1_log.h&quot;
macro_line|#include &quot;w1_io.h&quot;
DECL|variable|w1_delay_parm
r_int
id|w1_delay_parm
op_assign
l_int|1
suffix:semicolon
id|module_param_named
c_func
(paren
id|delay_coef
comma
id|w1_delay_parm
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|w1_crc8_table
r_static
id|u8
id|w1_crc8_table
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|94
comma
l_int|188
comma
l_int|226
comma
l_int|97
comma
l_int|63
comma
l_int|221
comma
l_int|131
comma
l_int|194
comma
l_int|156
comma
l_int|126
comma
l_int|32
comma
l_int|163
comma
l_int|253
comma
l_int|31
comma
l_int|65
comma
l_int|157
comma
l_int|195
comma
l_int|33
comma
l_int|127
comma
l_int|252
comma
l_int|162
comma
l_int|64
comma
l_int|30
comma
l_int|95
comma
l_int|1
comma
l_int|227
comma
l_int|189
comma
l_int|62
comma
l_int|96
comma
l_int|130
comma
l_int|220
comma
l_int|35
comma
l_int|125
comma
l_int|159
comma
l_int|193
comma
l_int|66
comma
l_int|28
comma
l_int|254
comma
l_int|160
comma
l_int|225
comma
l_int|191
comma
l_int|93
comma
l_int|3
comma
l_int|128
comma
l_int|222
comma
l_int|60
comma
l_int|98
comma
l_int|190
comma
l_int|224
comma
l_int|2
comma
l_int|92
comma
l_int|223
comma
l_int|129
comma
l_int|99
comma
l_int|61
comma
l_int|124
comma
l_int|34
comma
l_int|192
comma
l_int|158
comma
l_int|29
comma
l_int|67
comma
l_int|161
comma
l_int|255
comma
l_int|70
comma
l_int|24
comma
l_int|250
comma
l_int|164
comma
l_int|39
comma
l_int|121
comma
l_int|155
comma
l_int|197
comma
l_int|132
comma
l_int|218
comma
l_int|56
comma
l_int|102
comma
l_int|229
comma
l_int|187
comma
l_int|89
comma
l_int|7
comma
l_int|219
comma
l_int|133
comma
l_int|103
comma
l_int|57
comma
l_int|186
comma
l_int|228
comma
l_int|6
comma
l_int|88
comma
l_int|25
comma
l_int|71
comma
l_int|165
comma
l_int|251
comma
l_int|120
comma
l_int|38
comma
l_int|196
comma
l_int|154
comma
l_int|101
comma
l_int|59
comma
l_int|217
comma
l_int|135
comma
l_int|4
comma
l_int|90
comma
l_int|184
comma
l_int|230
comma
l_int|167
comma
l_int|249
comma
l_int|27
comma
l_int|69
comma
l_int|198
comma
l_int|152
comma
l_int|122
comma
l_int|36
comma
l_int|248
comma
l_int|166
comma
l_int|68
comma
l_int|26
comma
l_int|153
comma
l_int|199
comma
l_int|37
comma
l_int|123
comma
l_int|58
comma
l_int|100
comma
l_int|134
comma
l_int|216
comma
l_int|91
comma
l_int|5
comma
l_int|231
comma
l_int|185
comma
l_int|140
comma
l_int|210
comma
l_int|48
comma
l_int|110
comma
l_int|237
comma
l_int|179
comma
l_int|81
comma
l_int|15
comma
l_int|78
comma
l_int|16
comma
l_int|242
comma
l_int|172
comma
l_int|47
comma
l_int|113
comma
l_int|147
comma
l_int|205
comma
l_int|17
comma
l_int|79
comma
l_int|173
comma
l_int|243
comma
l_int|112
comma
l_int|46
comma
l_int|204
comma
l_int|146
comma
l_int|211
comma
l_int|141
comma
l_int|111
comma
l_int|49
comma
l_int|178
comma
l_int|236
comma
l_int|14
comma
l_int|80
comma
l_int|175
comma
l_int|241
comma
l_int|19
comma
l_int|77
comma
l_int|206
comma
l_int|144
comma
l_int|114
comma
l_int|44
comma
l_int|109
comma
l_int|51
comma
l_int|209
comma
l_int|143
comma
l_int|12
comma
l_int|82
comma
l_int|176
comma
l_int|238
comma
l_int|50
comma
l_int|108
comma
l_int|142
comma
l_int|208
comma
l_int|83
comma
l_int|13
comma
l_int|239
comma
l_int|177
comma
l_int|240
comma
l_int|174
comma
l_int|76
comma
l_int|18
comma
l_int|145
comma
l_int|207
comma
l_int|45
comma
l_int|115
comma
l_int|202
comma
l_int|148
comma
l_int|118
comma
l_int|40
comma
l_int|171
comma
l_int|245
comma
l_int|23
comma
l_int|73
comma
l_int|8
comma
l_int|86
comma
l_int|180
comma
l_int|234
comma
l_int|105
comma
l_int|55
comma
l_int|213
comma
l_int|139
comma
l_int|87
comma
l_int|9
comma
l_int|235
comma
l_int|181
comma
l_int|54
comma
l_int|104
comma
l_int|138
comma
l_int|212
comma
l_int|149
comma
l_int|203
comma
l_int|41
comma
l_int|119
comma
l_int|244
comma
l_int|170
comma
l_int|72
comma
l_int|22
comma
l_int|233
comma
l_int|183
comma
l_int|85
comma
l_int|11
comma
l_int|136
comma
l_int|214
comma
l_int|52
comma
l_int|106
comma
l_int|43
comma
l_int|117
comma
l_int|151
comma
l_int|201
comma
l_int|74
comma
l_int|20
comma
l_int|246
comma
l_int|168
comma
l_int|116
comma
l_int|42
comma
l_int|200
comma
l_int|150
comma
l_int|21
comma
l_int|75
comma
l_int|169
comma
l_int|247
comma
l_int|182
comma
l_int|232
comma
l_int|10
comma
l_int|84
comma
l_int|215
comma
l_int|137
comma
l_int|107
comma
l_int|53
)brace
suffix:semicolon
DECL|function|w1_delay
r_void
id|w1_delay
c_func
(paren
r_int
r_int
id|tm
)paren
(brace
id|udelay
c_func
(paren
id|tm
op_star
id|w1_delay_parm
)paren
suffix:semicolon
)brace
DECL|function|w1_touch_bit
id|u8
id|w1_touch_bit
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
r_int
id|bit
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;touch_bit
)paren
r_return
id|dev-&gt;bus_master
op_member_access_from_pointer
id|touch_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
id|bit
)paren
suffix:semicolon
r_else
r_return
id|w1_read_bit
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|w1_write_bit
r_void
id|w1_write_bit
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
r_int
id|bit
)paren
(brace
r_if
c_cond
(paren
id|bit
)paren
(brace
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|0
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|1
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|64
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|0
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|60
)paren
suffix:semicolon
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|1
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
DECL|function|w1_write_8
r_void
id|w1_write_8
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
id|u8
id|byte
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;write_byte
)paren
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_byte
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
id|byte
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
op_increment
id|i
)paren
id|w1_write_bit
c_func
(paren
id|dev
comma
(paren
id|byte
op_rshift
id|i
)paren
op_amp
l_int|0x1
)paren
suffix:semicolon
)brace
DECL|function|w1_read_bit
id|u8
id|w1_read_bit
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
)paren
(brace
r_int
id|result
suffix:semicolon
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|0
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|1
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|result
op_assign
id|dev-&gt;bus_master
op_member_access_from_pointer
id|read_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|55
)paren
suffix:semicolon
r_return
id|result
op_amp
l_int|0x1
suffix:semicolon
)brace
DECL|function|w1_read_8
id|u8
id|w1_read_8
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;read_byte
)paren
id|res
op_assign
id|dev-&gt;bus_master
op_member_access_from_pointer
id|read_byte
c_func
(paren
id|dev-&gt;bus_master-&gt;data
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
op_increment
id|i
)paren
id|res
op_or_assign
(paren
id|w1_read_bit
c_func
(paren
id|dev
)paren
op_lshift
id|i
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|w1_write_block
r_void
id|w1_write_block
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
id|u8
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;write_block
)paren
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_block
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
id|w1_write_8
c_func
(paren
id|dev
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
DECL|function|w1_read_block
id|u8
id|w1_read_block
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
id|u8
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;read_block
)paren
id|ret
op_assign
id|dev-&gt;bus_master
op_member_access_from_pointer
id|read_block
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
id|buf
(braket
id|i
)braket
op_assign
id|w1_read_8
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ret
op_assign
id|len
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|w1_reset_bus
r_int
id|w1_reset_bus
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;reset_bus
)paren
id|result
op_assign
id|dev-&gt;bus_master
op_member_access_from_pointer
id|reset_bus
c_func
(paren
id|dev-&gt;bus_master-&gt;data
)paren
op_amp
l_int|0x1
suffix:semicolon
r_else
(brace
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|0
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|480
)paren
suffix:semicolon
id|dev-&gt;bus_master
op_member_access_from_pointer
id|write_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
l_int|1
)paren
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|70
)paren
suffix:semicolon
id|result
op_assign
id|dev-&gt;bus_master
op_member_access_from_pointer
id|read_bit
c_func
(paren
id|dev-&gt;bus_master-&gt;data
)paren
op_amp
l_int|0x1
suffix:semicolon
id|w1_delay
c_func
(paren
l_int|410
)paren
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|w1_calc_crc8
id|u8
id|w1_calc_crc8
c_func
(paren
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
id|u8
id|crc
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
id|crc
op_assign
id|w1_crc8_table
(braket
id|crc
op_xor
op_star
id|data
op_increment
)braket
suffix:semicolon
r_return
id|crc
suffix:semicolon
)brace
DECL|function|w1_search_devices
r_void
id|w1_search_devices
c_func
(paren
r_struct
id|w1_master
op_star
id|dev
comma
id|w1_slave_found_callback
id|cb
)paren
(brace
id|dev-&gt;attempts
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus_master-&gt;search
)paren
id|dev-&gt;bus_master
op_member_access_from_pointer
id|search
c_func
(paren
id|dev-&gt;bus_master-&gt;data
comma
id|cb
)paren
suffix:semicolon
r_else
id|w1_search
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|w1_write_bit
id|EXPORT_SYMBOL
c_func
(paren
id|w1_write_bit
)paren
suffix:semicolon
DECL|variable|w1_write_8
id|EXPORT_SYMBOL
c_func
(paren
id|w1_write_8
)paren
suffix:semicolon
DECL|variable|w1_read_bit
id|EXPORT_SYMBOL
c_func
(paren
id|w1_read_bit
)paren
suffix:semicolon
DECL|variable|w1_read_8
id|EXPORT_SYMBOL
c_func
(paren
id|w1_read_8
)paren
suffix:semicolon
DECL|variable|w1_reset_bus
id|EXPORT_SYMBOL
c_func
(paren
id|w1_reset_bus
)paren
suffix:semicolon
DECL|variable|w1_calc_crc8
id|EXPORT_SYMBOL
c_func
(paren
id|w1_calc_crc8
)paren
suffix:semicolon
DECL|variable|w1_delay
id|EXPORT_SYMBOL
c_func
(paren
id|w1_delay
)paren
suffix:semicolon
DECL|variable|w1_read_block
id|EXPORT_SYMBOL
c_func
(paren
id|w1_read_block
)paren
suffix:semicolon
DECL|variable|w1_write_block
id|EXPORT_SYMBOL
c_func
(paren
id|w1_write_block
)paren
suffix:semicolon
DECL|variable|w1_search_devices
id|EXPORT_SYMBOL
c_func
(paren
id|w1_search_devices
)paren
suffix:semicolon
eof
