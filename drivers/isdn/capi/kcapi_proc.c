multiline_comment|/*&n; * Kernel CAPI 2.0 Module - /proc/capi handling&n; * &n; * Copyright 1999 by Carsten Paeth &lt;calle@calle.de&gt;&n; * Copyright 2002 by Kai Germaschewski &lt;kai@germaschewski.name&gt;&n; * &n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
macro_line|#include &quot;kcapi.h&quot;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
r_static
r_char
op_star
DECL|function|cardstate2str
id|cardstate2str
c_func
(paren
r_int
r_int
id|cardstate
)paren
(brace
r_switch
c_cond
(paren
id|cardstate
)paren
(brace
r_case
id|CARD_DETECTED
suffix:colon
r_return
l_string|&quot;detected&quot;
suffix:semicolon
r_case
id|CARD_LOADING
suffix:colon
r_return
l_string|&quot;loading&quot;
suffix:semicolon
r_case
id|CARD_RUNNING
suffix:colon
r_return
l_string|&quot;running&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;???&quot;
suffix:semicolon
)brace
)brace
singleline_comment|// /proc/capi
singleline_comment|// ===========================================================================
singleline_comment|// /proc/capi/controller: 
singleline_comment|//      cnr driver cardstate name driverinfo
singleline_comment|// /proc/capi/contrstats:
singleline_comment|//      cnr nrecvctlpkt nrecvdatapkt nsentctlpkt nsentdatapkt
singleline_comment|// ---------------------------------------------------------------------------
DECL|function|controller_start
r_static
r_void
op_star
id|controller_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_if
c_cond
(paren
op_star
id|pos
OL
id|CAPI_MAXCONTR
)paren
r_return
op_amp
id|capi_cards
(braket
op_star
id|pos
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|controller_next
r_static
r_void
op_star
id|controller_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
op_increment
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pos
OL
id|CAPI_MAXCONTR
)paren
r_return
op_amp
id|capi_cards
(braket
op_star
id|pos
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|controller_stop
r_static
r_void
id|controller_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
)brace
DECL|function|controller_show
r_static
r_int
id|controller_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|capi_ctr
op_star
id|ctr
op_assign
op_star
(paren
r_struct
id|capi_ctr
op_star
op_star
)paren
id|v
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ctr
)paren
r_return
l_int|0
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%d %-10s %-8s %-16s %s&bslash;n&quot;
comma
id|ctr-&gt;cnr
comma
id|ctr-&gt;driver_name
comma
id|cardstate2str
c_func
(paren
id|ctr-&gt;cardstate
)paren
comma
id|ctr-&gt;name
comma
id|ctr-&gt;procinfo
ques
c_cond
id|ctr
op_member_access_from_pointer
id|procinfo
c_func
(paren
id|ctr
)paren
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|contrstats_show
r_static
r_int
id|contrstats_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|capi_ctr
op_star
id|ctr
op_assign
op_star
(paren
r_struct
id|capi_ctr
op_star
op_star
)paren
id|v
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ctr
)paren
r_return
l_int|0
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%d %lu %lu %lu %lu&bslash;n&quot;
comma
id|ctr-&gt;cnr
comma
id|ctr-&gt;nrecvctlpkt
comma
id|ctr-&gt;nrecvdatapkt
comma
id|ctr-&gt;nsentctlpkt
comma
id|ctr-&gt;nsentdatapkt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|seq_controller_ops
r_struct
id|seq_operations
id|seq_controller_ops
op_assign
(brace
id|start
suffix:colon
id|controller_start
comma
id|next
suffix:colon
id|controller_next
comma
id|stop
suffix:colon
id|controller_stop
comma
id|show
suffix:colon
id|controller_show
comma
)brace
suffix:semicolon
DECL|variable|seq_contrstats_ops
r_struct
id|seq_operations
id|seq_contrstats_ops
op_assign
(brace
id|start
suffix:colon
id|controller_start
comma
id|next
suffix:colon
id|controller_next
comma
id|stop
suffix:colon
id|controller_stop
comma
id|show
suffix:colon
id|contrstats_show
comma
)brace
suffix:semicolon
DECL|function|seq_controller_open
r_static
r_int
id|seq_controller_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|seq_controller_ops
)paren
suffix:semicolon
)brace
DECL|function|seq_contrstats_open
r_static
r_int
id|seq_contrstats_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|seq_contrstats_ops
)paren
suffix:semicolon
)brace
DECL|variable|proc_controller_ops
r_static
r_struct
id|file_operations
id|proc_controller_ops
op_assign
(brace
id|open
suffix:colon
id|seq_controller_open
comma
id|read
suffix:colon
id|seq_read
comma
id|llseek
suffix:colon
id|seq_lseek
comma
id|release
suffix:colon
id|seq_release
comma
)brace
suffix:semicolon
DECL|variable|proc_contrstats_ops
r_static
r_struct
id|file_operations
id|proc_contrstats_ops
op_assign
(brace
id|open
suffix:colon
id|seq_contrstats_open
comma
id|read
suffix:colon
id|seq_read
comma
id|llseek
suffix:colon
id|seq_lseek
comma
id|release
suffix:colon
id|seq_release
comma
)brace
suffix:semicolon
singleline_comment|// /proc/capi/applications: 
singleline_comment|//      applid l3cnt dblkcnt dblklen #ncci recvqueuelen
singleline_comment|// /proc/capi/applstats: 
singleline_comment|//      applid nrecvctlpkt nrecvdatapkt nsentctlpkt nsentdatapkt
singleline_comment|// ---------------------------------------------------------------------------
r_static
r_void
op_star
DECL|function|applications_start
id|applications_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_if
c_cond
(paren
op_star
id|pos
OL
id|CAPI_MAXAPPL
)paren
r_return
op_amp
id|capi_applications
(braket
op_star
id|pos
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_void
op_star
DECL|function|applications_next
id|applications_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
op_increment
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pos
OL
id|CAPI_MAXAPPL
)paren
r_return
op_amp
id|capi_applications
(braket
op_star
id|pos
)braket
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_void
DECL|function|applications_stop
id|applications_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
)brace
r_static
r_int
DECL|function|applications_show
id|applications_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|capi20_appl
op_star
id|ap
op_assign
op_star
(paren
r_struct
id|capi20_appl
op_star
op_star
)paren
id|v
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ap
)paren
r_return
l_int|0
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%u %d %d %d&bslash;n&quot;
comma
id|ap-&gt;applid
comma
id|ap-&gt;rparam.level3cnt
comma
id|ap-&gt;rparam.datablkcnt
comma
id|ap-&gt;rparam.datablklen
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|applstats_show
id|applstats_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|capi20_appl
op_star
id|ap
op_assign
op_star
(paren
r_struct
id|capi20_appl
op_star
op_star
)paren
id|v
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ap
)paren
r_return
l_int|0
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%u %lu %lu %lu %lu&bslash;n&quot;
comma
id|ap-&gt;applid
comma
id|ap-&gt;nrecvctlpkt
comma
id|ap-&gt;nrecvdatapkt
comma
id|ap-&gt;nsentctlpkt
comma
id|ap-&gt;nsentdatapkt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|seq_applications_ops
r_struct
id|seq_operations
id|seq_applications_ops
op_assign
(brace
id|start
suffix:colon
id|applications_start
comma
id|next
suffix:colon
id|applications_next
comma
id|stop
suffix:colon
id|applications_stop
comma
id|show
suffix:colon
id|applications_show
comma
)brace
suffix:semicolon
DECL|variable|seq_applstats_ops
r_struct
id|seq_operations
id|seq_applstats_ops
op_assign
(brace
id|start
suffix:colon
id|applications_start
comma
id|next
suffix:colon
id|applications_next
comma
id|stop
suffix:colon
id|applications_stop
comma
id|show
suffix:colon
id|applstats_show
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|seq_applications_open
id|seq_applications_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|seq_applications_ops
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|seq_applstats_open
id|seq_applstats_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|seq_applstats_ops
)paren
suffix:semicolon
)brace
DECL|variable|proc_applications_ops
r_static
r_struct
id|file_operations
id|proc_applications_ops
op_assign
(brace
id|open
suffix:colon
id|seq_applications_open
comma
id|read
suffix:colon
id|seq_read
comma
id|llseek
suffix:colon
id|seq_lseek
comma
id|release
suffix:colon
id|seq_release
comma
)brace
suffix:semicolon
DECL|variable|proc_applstats_ops
r_static
r_struct
id|file_operations
id|proc_applstats_ops
op_assign
(brace
id|open
suffix:colon
id|seq_applstats_open
comma
id|read
suffix:colon
id|seq_read
comma
id|llseek
suffix:colon
id|seq_lseek
comma
id|release
suffix:colon
id|seq_release
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|create_seq_entry
id|create_seq_entry
c_func
(paren
r_char
op_star
id|name
comma
id|mode_t
id|mode
comma
r_struct
id|file_operations
op_star
id|f
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
id|entry
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
id|mode
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
id|entry-&gt;proc_fops
op_assign
id|f
suffix:semicolon
)brace
singleline_comment|// ---------------------------------------------------------------------------
r_void
id|__init
DECL|function|kcapi_proc_init
id|kcapi_proc_init
c_func
(paren
r_void
)paren
(brace
id|proc_mkdir
c_func
(paren
l_string|&quot;capi&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|proc_mkdir
c_func
(paren
l_string|&quot;capi/controllers&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|proc_mkdir
c_func
(paren
l_string|&quot;capi/drivers&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|create_seq_entry
c_func
(paren
l_string|&quot;capi/controller&quot;
comma
l_int|0
comma
op_amp
id|proc_controller_ops
)paren
suffix:semicolon
id|create_seq_entry
c_func
(paren
l_string|&quot;capi/contrstats&quot;
comma
l_int|0
comma
op_amp
id|proc_contrstats_ops
)paren
suffix:semicolon
id|create_seq_entry
c_func
(paren
l_string|&quot;capi/applications&quot;
comma
l_int|0
comma
op_amp
id|proc_applications_ops
)paren
suffix:semicolon
id|create_seq_entry
c_func
(paren
l_string|&quot;capi/applstats&quot;
comma
l_int|0
comma
op_amp
id|proc_applstats_ops
)paren
suffix:semicolon
)brace
r_void
id|__exit
DECL|function|kcapi_proc_exit
id|kcapi_proc_exit
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/driver&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/controller&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/contrstats&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/applications&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/applstats&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/drivers&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi/controllers&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;capi&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
eof
