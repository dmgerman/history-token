multiline_comment|/*&n; * Driver for HFC PCI based cards&n; *&n; * Author       Kai Germaschewski&n; * Copyright    2002 by Kai Germaschewski  &lt;kai.germaschewski@gmx.de&gt;&n; *              2000 by Karsten Keil       &lt;keil@isdn4linux.de&gt;&n; *              2000 by Werner Cornelius   &lt;werner@isdn4linux.de&gt;&n; * &n; * based upon Werner Cornelius&squot;s original hfc_pci.c driver&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
singleline_comment|// XXX timer3
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &quot;hisax_hfcpci.h&quot;
singleline_comment|// debugging cruft
DECL|macro|__debug_variable
mdefine_line|#define __debug_variable debug
macro_line|#include &quot;hisax_debug.h&quot;
macro_line|#ifdef CONFIG_HISAX_DEBUG
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Kai Germaschewski &lt;kai.germaschewski@gmx.de&gt;/Werner Cornelius &lt;werner@isdn4linux.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;HFC PCI ISDN driver&quot;
)paren
suffix:semicolon
DECL|macro|ID
mdefine_line|#define ID(ven, dev, name)                     &bslash;&n;        { .vendor      = PCI_VENDOR_ID_##ven,    &bslash;&n;&t;  .device      = PCI_DEVICE_ID_##dev,    &bslash;&n;&t;  .subvendor   = PCI_ANY_ID,             &bslash;&n;&t;  .subdevice   = PCI_ANY_ID,             &bslash;&n;&t;  .class       = 0,                      &bslash;&n;          .class_mask  = 0,                      &bslash;&n;&t;  .driver_data = (unsigned long) name }
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|hfcpci_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
id|ID
c_func
(paren
id|CCD
comma
id|CCD_2BD0
comma
l_string|&quot;CCD/Billion/Asuscom 2BD0&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B000
comma
l_string|&quot;Billion B000&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B006
comma
l_string|&quot;Billion B006&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B007
comma
l_string|&quot;Billion B007&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B008
comma
l_string|&quot;Billion B008&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B009
comma
l_string|&quot;Billion B009&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B00A
comma
l_string|&quot;Billion B00A&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B00B
comma
l_string|&quot;Billion B00B&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B00C
comma
l_string|&quot;Billion B00C&quot;
)paren
comma
id|ID
c_func
(paren
id|CCD
comma
id|CCD_B100
comma
l_string|&quot;Seyeon&quot;
)paren
comma
id|ID
c_func
(paren
id|ABOCOM
comma
id|ABOCOM_2BD1
comma
l_string|&quot;Abocom/Magitek&quot;
)paren
comma
id|ID
c_func
(paren
id|ASUSTEK
comma
id|ASUSTEK_0675
comma
l_string|&quot;Asuscom/Askey&quot;
)paren
comma
id|ID
c_func
(paren
id|BERKOM
comma
id|BERKOM_T_CONCEPT
comma
l_string|&quot;German Telekom T-Concept&quot;
)paren
comma
id|ID
c_func
(paren
id|BERKOM
comma
id|BERKOM_A1T
comma
l_string|&quot;German Telekom A1T&quot;
)paren
comma
id|ID
c_func
(paren
id|ANIGMA
comma
id|ANIGMA_MC145575
comma
l_string|&quot;Motorola MC145575&quot;
)paren
comma
id|ID
c_func
(paren
id|ZOLTRIX
comma
id|ZOLTRIX_2BD0
comma
l_string|&quot;Zoltrix 2BD0&quot;
)paren
comma
id|ID
c_func
(paren
id|DIGI
comma
id|DIGI_DF_M_IOM2_E
comma
l_string|&quot;Digi DataFire Micro V IOM2 (Europe)&quot;
)paren
comma
id|ID
c_func
(paren
id|DIGI
comma
id|DIGI_DF_M_E
comma
l_string|&quot;Digi DataFire Micro V (Europe)&quot;
)paren
comma
id|ID
c_func
(paren
id|DIGI
comma
id|DIGI_DF_M_IOM2_A
comma
l_string|&quot;Digi DataFire Micro V IOM2 (America)&quot;
)paren
comma
id|ID
c_func
(paren
id|DIGI
comma
id|DIGI_DF_M_A
comma
l_string|&quot;Digi DataFire Micro V (America)&quot;
)paren
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|hfcpci_ids
)paren
suffix:semicolon
DECL|macro|ID
macro_line|#undef ID
DECL|variable|protocol
r_static
r_int
id|protocol
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* EURO-ISDN Default */
id|MODULE_PARM
c_func
(paren
id|protocol
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|//
DECL|macro|DBG_WARN
mdefine_line|#define DBG_WARN      0x0001
DECL|macro|DBG_INFO
mdefine_line|#define DBG_INFO      0x0002
DECL|macro|DBG_IRQ
mdefine_line|#define DBG_IRQ       0x0010
DECL|macro|DBG_L1M
mdefine_line|#define DBG_L1M       0x0020
DECL|macro|DBG_PR
mdefine_line|#define DBG_PR        0x0040
DECL|macro|DBG_D_XMIT
mdefine_line|#define DBG_D_XMIT    0x0100
DECL|macro|DBG_D_RECV
mdefine_line|#define DBG_D_RECV    0x0200
DECL|macro|DBG_B_XMIT
mdefine_line|#define DBG_B_XMIT    0x1000
DECL|macro|DBG_B_RECV
mdefine_line|#define DBG_B_RECV    0x2000
multiline_comment|/* memory window base address offset (in config space) */
DECL|macro|HFCPCI_MWBA
mdefine_line|#define HFCPCI_MWBA      0x80
multiline_comment|/* GCI/IOM bus monitor registers */
DECL|macro|HCFPCI_C_I
mdefine_line|#define HCFPCI_C_I       0x08
DECL|macro|HFCPCI_TRxR
mdefine_line|#define HFCPCI_TRxR      0x0C
DECL|macro|HFCPCI_MON1_D
mdefine_line|#define HFCPCI_MON1_D    0x28
DECL|macro|HFCPCI_MON2_D
mdefine_line|#define HFCPCI_MON2_D    0x2C
multiline_comment|/* GCI/IOM bus timeslot registers */
DECL|macro|HFCPCI_B1_SSL
mdefine_line|#define HFCPCI_B1_SSL    0x80
DECL|macro|HFCPCI_B2_SSL
mdefine_line|#define HFCPCI_B2_SSL    0x84
DECL|macro|HFCPCI_AUX1_SSL
mdefine_line|#define HFCPCI_AUX1_SSL  0x88
DECL|macro|HFCPCI_AUX2_SSL
mdefine_line|#define HFCPCI_AUX2_SSL  0x8C
DECL|macro|HFCPCI_B1_RSL
mdefine_line|#define HFCPCI_B1_RSL    0x90
DECL|macro|HFCPCI_B2_RSL
mdefine_line|#define HFCPCI_B2_RSL    0x94
DECL|macro|HFCPCI_AUX1_RSL
mdefine_line|#define HFCPCI_AUX1_RSL  0x98
DECL|macro|HFCPCI_AUX2_RSL
mdefine_line|#define HFCPCI_AUX2_RSL  0x9C
multiline_comment|/* GCI/IOM bus data registers */
DECL|macro|HFCPCI_B1_D
mdefine_line|#define HFCPCI_B1_D      0xA0
DECL|macro|HFCPCI_B2_D
mdefine_line|#define HFCPCI_B2_D      0xA4
DECL|macro|HFCPCI_AUX1_D
mdefine_line|#define HFCPCI_AUX1_D    0xA8
DECL|macro|HFCPCI_AUX2_D
mdefine_line|#define HFCPCI_AUX2_D    0xAC
multiline_comment|/* GCI/IOM bus configuration registers */
DECL|macro|HFCPCI_MST_EMOD
mdefine_line|#define HFCPCI_MST_EMOD  0xB4
DECL|macro|HFCPCI_MST_MODE
mdefine_line|#define HFCPCI_MST_MODE&t; 0xB8
DECL|macro|HFCPCI_CONNECT
mdefine_line|#define HFCPCI_CONNECT &t; 0xBC
multiline_comment|/* Interrupt and status registers */
DECL|macro|HFCPCI_FIFO_EN
mdefine_line|#define HFCPCI_FIFO_EN   0x44
DECL|macro|HFCPCI_TRM
mdefine_line|#define HFCPCI_TRM       0x48
DECL|macro|HFCPCI_B_MODE
mdefine_line|#define HFCPCI_B_MODE    0x4C
DECL|macro|HFCPCI_CHIP_ID
mdefine_line|#define HFCPCI_CHIP_ID   0x58
DECL|macro|HFCPCI_CIRM
mdefine_line|#define HFCPCI_CIRM  &t; 0x60
DECL|macro|HFCPCI_CTMT
mdefine_line|#define HFCPCI_CTMT&t; 0x64
DECL|macro|HFCPCI_INT_M1
mdefine_line|#define HFCPCI_INT_M1  &t; 0x68
DECL|macro|HFCPCI_INT_M2
mdefine_line|#define HFCPCI_INT_M2  &t; 0x6C
DECL|macro|HFCPCI_INT_S1
mdefine_line|#define HFCPCI_INT_S1  &t; 0x78
DECL|macro|HFCPCI_INT_S2
mdefine_line|#define HFCPCI_INT_S2  &t; 0x7C
DECL|macro|HFCPCI_STATUS
mdefine_line|#define HFCPCI_STATUS  &t; 0x70
multiline_comment|/* S/T section registers */
DECL|macro|HFCPCI_STATES
mdefine_line|#define HFCPCI_STATES  &t; 0xC0
DECL|macro|HFCPCI_SCTRL
mdefine_line|#define HFCPCI_SCTRL  &t; 0xC4
DECL|macro|HFCPCI_SCTRL_E
mdefine_line|#define HFCPCI_SCTRL_E   0xC8
DECL|macro|HFCPCI_SCTRL_R
mdefine_line|#define HFCPCI_SCTRL_R   0xCC
DECL|macro|HFCPCI_SQ
mdefine_line|#define HFCPCI_SQ  &t; 0xD0
DECL|macro|HFCPCI_CLKDEL
mdefine_line|#define HFCPCI_CLKDEL  &t; 0xDC
DECL|macro|HFCPCI_B1_REC
mdefine_line|#define HFCPCI_B1_REC    0xF0
DECL|macro|HFCPCI_B1_SEND
mdefine_line|#define HFCPCI_B1_SEND   0xF0
DECL|macro|HFCPCI_B2_REC
mdefine_line|#define HFCPCI_B2_REC    0xF4
DECL|macro|HFCPCI_B2_SEND
mdefine_line|#define HFCPCI_B2_SEND   0xF4
DECL|macro|HFCPCI_D_REC
mdefine_line|#define HFCPCI_D_REC     0xF8
DECL|macro|HFCPCI_D_SEND
mdefine_line|#define HFCPCI_D_SEND    0xF8
DECL|macro|HFCPCI_E_REC
mdefine_line|#define HFCPCI_E_REC     0xFC
multiline_comment|/* bits in status register (READ) */
DECL|macro|HFCPCI_PCI_PROC
mdefine_line|#define HFCPCI_PCI_PROC   0x02
DECL|macro|HFCPCI_NBUSY
mdefine_line|#define HFCPCI_NBUSY&t;  0x04 
DECL|macro|HFCPCI_TIMER_ELAP
mdefine_line|#define HFCPCI_TIMER_ELAP 0x10
DECL|macro|HFCPCI_STATINT
mdefine_line|#define HFCPCI_STATINT&t;  0x20
DECL|macro|HFCPCI_FRAMEINT
mdefine_line|#define HFCPCI_FRAMEINT&t;  0x40
DECL|macro|HFCPCI_ANYINT
mdefine_line|#define HFCPCI_ANYINT&t;  0x80
multiline_comment|/* bits in CTMT (Write) */
DECL|macro|HFCPCI_CLTIMER
mdefine_line|#define HFCPCI_CLTIMER    0x80
DECL|macro|HFCPCI_TIM3_125
mdefine_line|#define HFCPCI_TIM3_125   0x04
DECL|macro|HFCPCI_TIM25
mdefine_line|#define HFCPCI_TIM25      0x10
DECL|macro|HFCPCI_TIM50
mdefine_line|#define HFCPCI_TIM50      0x14
DECL|macro|HFCPCI_TIM400
mdefine_line|#define HFCPCI_TIM400     0x18
DECL|macro|HFCPCI_TIM800
mdefine_line|#define HFCPCI_TIM800     0x1C
DECL|macro|HFCPCI_AUTO_TIMER
mdefine_line|#define HFCPCI_AUTO_TIMER 0x20
DECL|macro|HFCPCI_TRANSB2
mdefine_line|#define HFCPCI_TRANSB2    0x02
DECL|macro|HFCPCI_TRANSB1
mdefine_line|#define HFCPCI_TRANSB1    0x01
multiline_comment|/* bits in CIRM (Write) */
DECL|macro|HFCPCI_AUX_MSK
mdefine_line|#define HFCPCI_AUX_MSK    0x07
DECL|macro|HFCPCI_RESET
mdefine_line|#define HFCPCI_RESET  &t;  0x08
DECL|macro|HFCPCI_B1_REV
mdefine_line|#define HFCPCI_B1_REV     0x40
DECL|macro|HFCPCI_B2_REV
mdefine_line|#define HFCPCI_B2_REV     0x80
multiline_comment|/* bits in INT_M1 and INT_S1 */
DECL|macro|HFCPCI_INTS_B1TRANS
mdefine_line|#define HFCPCI_INTS_B1TRANS  0x01
DECL|macro|HFCPCI_INTS_B2TRANS
mdefine_line|#define HFCPCI_INTS_B2TRANS  0x02
DECL|macro|HFCPCI_INTS_DTRANS
mdefine_line|#define HFCPCI_INTS_DTRANS   0x04
DECL|macro|HFCPCI_INTS_B1REC
mdefine_line|#define HFCPCI_INTS_B1REC    0x08
DECL|macro|HFCPCI_INTS_B2REC
mdefine_line|#define HFCPCI_INTS_B2REC    0x10
DECL|macro|HFCPCI_INTS_DREC
mdefine_line|#define HFCPCI_INTS_DREC     0x20
DECL|macro|HFCPCI_INTS_L1STATE
mdefine_line|#define HFCPCI_INTS_L1STATE  0x40
DECL|macro|HFCPCI_INTS_TIMER
mdefine_line|#define HFCPCI_INTS_TIMER    0x80
multiline_comment|/* bits in INT_M2 */
DECL|macro|HFCPCI_PROC_TRANS
mdefine_line|#define HFCPCI_PROC_TRANS    0x01
DECL|macro|HFCPCI_GCI_I_CHG
mdefine_line|#define HFCPCI_GCI_I_CHG     0x02
DECL|macro|HFCPCI_GCI_MON_REC
mdefine_line|#define HFCPCI_GCI_MON_REC   0x04
DECL|macro|HFCPCI_IRQ_ENABLE
mdefine_line|#define HFCPCI_IRQ_ENABLE    0x08
DECL|macro|HFCPCI_PMESEL
mdefine_line|#define HFCPCI_PMESEL        0x80
multiline_comment|/* bits in STATES */
DECL|macro|HFCPCI_STATE_MSK
mdefine_line|#define HFCPCI_STATE_MSK     0x0F
DECL|macro|HFCPCI_LOAD_STATE
mdefine_line|#define HFCPCI_LOAD_STATE    0x10
DECL|macro|HFCPCI_ACTIVATE
mdefine_line|#define HFCPCI_ACTIVATE&t;     0x20
DECL|macro|HFCPCI_DO_ACTION
mdefine_line|#define HFCPCI_DO_ACTION     0x40
DECL|macro|HFCPCI_NT_G2_G3
mdefine_line|#define HFCPCI_NT_G2_G3      0x80
multiline_comment|/* bits in HFCD_MST_MODE */
DECL|macro|HFCPCI_MASTER
mdefine_line|#define HFCPCI_MASTER&t;     0x01
DECL|macro|HFCPCI_SLAVE
mdefine_line|#define HFCPCI_SLAVE         0x00
multiline_comment|/* remaining bits are for codecs control */
multiline_comment|/* bits in HFCD_SCTRL */
DECL|macro|SCTRL_B1_ENA
mdefine_line|#define SCTRL_B1_ENA&t;     0x01
DECL|macro|SCTRL_B2_ENA
mdefine_line|#define SCTRL_B2_ENA&t;     0x02
DECL|macro|SCTRL_MODE_TE
mdefine_line|#define SCTRL_MODE_TE        0x00
DECL|macro|SCTRL_MODE_NT
mdefine_line|#define SCTRL_MODE_NT        0x04
DECL|macro|SCTRL_LOW_PRIO
mdefine_line|#define SCTRL_LOW_PRIO&t;     0x08
DECL|macro|SCTRL_SQ_ENA
mdefine_line|#define SCTRL_SQ_ENA&t;     0x10
DECL|macro|SCTRL_TEST
mdefine_line|#define SCTRL_TEST&t;     0x20
DECL|macro|SCTRL_NONE_CAP
mdefine_line|#define SCTRL_NONE_CAP&t;     0x40
DECL|macro|SCTRL_PWR_DOWN
mdefine_line|#define SCTRL_PWR_DOWN&t;     0x80
multiline_comment|/* bits in SCTRL_E  */
DECL|macro|HFCPCI_AUTO_AWAKE
mdefine_line|#define HFCPCI_AUTO_AWAKE    0x01
DECL|macro|HFCPCI_DBIT_1
mdefine_line|#define HFCPCI_DBIT_1        0x04
DECL|macro|HFCPCI_IGNORE_COL
mdefine_line|#define HFCPCI_IGNORE_COL    0x08
DECL|macro|HFCPCI_CHG_B1_B2
mdefine_line|#define HFCPCI_CHG_B1_B2     0x80
multiline_comment|/* bits in FIFO_EN register */
DECL|macro|HFCPCI_FIFOEN_B1
mdefine_line|#define HFCPCI_FIFOEN_B1     0x03
DECL|macro|HFCPCI_FIFOEN_B2
mdefine_line|#define HFCPCI_FIFOEN_B2     0x0C
DECL|macro|HFCPCI_FIFOEN_DTX
mdefine_line|#define HFCPCI_FIFOEN_DTX    0x10
DECL|macro|HFCPCI_FIFOEN_DRX
mdefine_line|#define HFCPCI_FIFOEN_DRX    0x20
DECL|macro|HFCPCI_FIFOEN_B1TX
mdefine_line|#define HFCPCI_FIFOEN_B1TX   0x01
DECL|macro|HFCPCI_FIFOEN_B1RX
mdefine_line|#define HFCPCI_FIFOEN_B1RX   0x02
DECL|macro|HFCPCI_FIFOEN_B2TX
mdefine_line|#define HFCPCI_FIFOEN_B2TX   0x04
DECL|macro|HFCPCI_FIFOEN_B2RX
mdefine_line|#define HFCPCI_FIFOEN_B2RX   0x08
multiline_comment|/*&n; * thresholds for transparent B-channel mode&n; * change mask and threshold simultaneously&n; */
DECL|macro|HFCPCI_BTRANS_THRESHOLD
mdefine_line|#define HFCPCI_BTRANS_THRESHOLD 128
DECL|macro|HFCPCI_BTRANS_THRESMASK
mdefine_line|#define HFCPCI_BTRANS_THRESMASK 0x00
DECL|macro|CLKDEL_TE
mdefine_line|#define CLKDEL_TE&t;0x0e&t;/* CLKDEL in TE mode */
DECL|macro|CLKDEL_NT
mdefine_line|#define CLKDEL_NT&t;0x6c&t;/* CLKDEL in NT mode */
DECL|macro|MAX_D_FRAMES
mdefine_line|#define MAX_D_FRAMES 0x10
DECL|macro|MAX_B_FRAMES
mdefine_line|#define MAX_B_FRAMES 0x20
DECL|macro|B_FIFO_START
mdefine_line|#define B_FIFO_START 0x0200
DECL|macro|B_FIFO_END
mdefine_line|#define B_FIFO_END   0x2000
DECL|macro|B_FIFO_SIZE
mdefine_line|#define B_FIFO_SIZE  (B_FIFO_END - B_FIFO_START)
DECL|macro|D_FIFO_START
mdefine_line|#define D_FIFO_START 0x0000
DECL|macro|D_FIFO_END
mdefine_line|#define D_FIFO_END   0x0200
DECL|macro|D_FIFO_SIZE
mdefine_line|#define D_FIFO_SIZE  (D_FIFO_END - D_FIFO_START)
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// push messages to the upper layers
DECL|function|D_L1L2
r_static
r_inline
r_void
id|D_L1L2
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hisax_if
op_star
id|ifc
op_assign
(paren
r_struct
id|hisax_if
op_star
)paren
op_amp
id|adapter-&gt;d_if
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;pr %#x&quot;
comma
id|pr
)paren
suffix:semicolon
id|ifc
op_member_access_from_pointer
id|l1l2
c_func
(paren
id|ifc
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|B_L1L2
r_static
r_inline
r_void
id|B_L1L2
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hisax_if
op_star
id|ifc
op_assign
(paren
r_struct
id|hisax_if
op_star
)paren
op_amp
id|bcs-&gt;b_if
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;pr %#x&quot;
comma
id|pr
)paren
suffix:semicolon
id|ifc
op_member_access_from_pointer
id|l1l2
c_func
(paren
id|ifc
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// MMIO
r_static
r_inline
r_void
DECL|function|hfcpci_writeb
id|hfcpci_writeb
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
id|u8
id|b
comma
r_int
r_char
id|offset
)paren
(brace
id|writeb
c_func
(paren
id|b
comma
id|adapter-&gt;mmio
op_plus
id|offset
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u8
DECL|function|hfcpci_readb
id|hfcpci_readb
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
r_char
id|offset
)paren
(brace
r_return
id|readb
c_func
(paren
id|adapter-&gt;mmio
op_plus
id|offset
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// magic to define the various F/Z counter accesses
DECL|macro|DECL_B_F
mdefine_line|#define DECL_B_F(r, f)                                                      &bslash;&n;static inline u8                                                            &bslash;&n;get_b_##r##_##f (struct hfcpci_bcs *bcs)                                    &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = bcs-&gt;channel ? OFF_B2_##r##_##f : OFF_B1_##r##_##f;       &bslash;&n;                                                                            &bslash;&n;&t;return *(bcs-&gt;adapter-&gt;fifo + off);                                 &bslash;&n;}                                                                           &bslash;&n;                                                                            &bslash;&n;static inline void                                                          &bslash;&n;set_b_##r##_##f (struct hfcpci_bcs *bcs, u8 f)                              &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = bcs-&gt;channel ? OFF_B2_##r##_##f : OFF_B1_##r##_##f;       &bslash;&n;                                                                            &bslash;&n;&t;*(bcs-&gt;adapter-&gt;fifo + off) = f;                                    &bslash;&n;}
DECL|macro|OFF_B1_rx_f1
mdefine_line|#define OFF_B1_rx_f1 0x6080
DECL|macro|OFF_B2_rx_f1
mdefine_line|#define OFF_B2_rx_f1 0x6180
DECL|macro|OFF_B1_rx_f2
mdefine_line|#define OFF_B1_rx_f2 0x6081
DECL|macro|OFF_B2_rx_f2
mdefine_line|#define OFF_B2_rx_f2 0x6181
DECL|macro|OFF_B1_tx_f1
mdefine_line|#define OFF_B1_tx_f1 0x2080
DECL|macro|OFF_B2_tx_f1
mdefine_line|#define OFF_B2_tx_f1 0x2180
DECL|macro|OFF_B1_tx_f2
mdefine_line|#define OFF_B1_tx_f2 0x2081
DECL|macro|OFF_B2_tx_f2
mdefine_line|#define OFF_B2_tx_f2 0x2181
id|DECL_B_F
c_func
(paren
id|rx
comma
id|f1
)paren
id|DECL_B_F
c_func
(paren
id|rx
comma
id|f2
)paren
id|DECL_B_F
c_func
(paren
id|tx
comma
id|f1
)paren
id|DECL_B_F
c_func
(paren
id|tx
comma
id|f2
)paren
DECL|macro|DECL_B_F
macro_line|#undef DECL_B_F
DECL|macro|DECL_B_Z
mdefine_line|#define DECL_B_Z(r, z)                                                      &bslash;&n;static inline u16                                                           &bslash;&n;get_b_##r##_##z (struct hfcpci_bcs *bcs, u8 f)                              &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = bcs-&gt;channel ? OFF_B2_##r##_##z : OFF_B1_##r##_##z;       &bslash;&n;                                                                            &bslash;&n;&t;return le16_to_cpu(*((u16 *) (bcs-&gt;adapter-&gt;fifo + off + f * 4)));  &bslash;&n;}                                                                           &bslash;&n;                                                                            &bslash;&n;static inline void                                                          &bslash;&n;set_b_##r##_##z(struct hfcpci_bcs *bcs, u8 f, u16 z)                        &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = bcs-&gt;channel ? OFF_B2_##r##_##z : OFF_B1_##r##_##z;       &bslash;&n;                                                                            &bslash;&n;&t;*((u16 *) (bcs-&gt;adapter-&gt;fifo + off + f * 4)) = cpu_to_le16(z);     &bslash;&n;}
DECL|macro|OFF_B1_rx_z1
mdefine_line|#define OFF_B1_rx_z1 0x6000
DECL|macro|OFF_B2_rx_z1
mdefine_line|#define OFF_B2_rx_z1 0x6100
DECL|macro|OFF_B1_rx_z2
mdefine_line|#define OFF_B1_rx_z2 0x6002
DECL|macro|OFF_B2_rx_z2
mdefine_line|#define OFF_B2_rx_z2 0x6102
DECL|macro|OFF_B1_tx_z1
mdefine_line|#define OFF_B1_tx_z1 0x2000
DECL|macro|OFF_B2_tx_z1
mdefine_line|#define OFF_B2_tx_z1 0x2100
DECL|macro|OFF_B1_tx_z2
mdefine_line|#define OFF_B1_tx_z2 0x2002
DECL|macro|OFF_B2_tx_z2
mdefine_line|#define OFF_B2_tx_z2 0x2102
id|DECL_B_Z
c_func
(paren
id|rx
comma
id|z1
)paren
id|DECL_B_Z
c_func
(paren
id|rx
comma
id|z2
)paren
id|DECL_B_Z
c_func
(paren
id|tx
comma
id|z1
)paren
id|DECL_B_Z
c_func
(paren
id|tx
comma
id|z2
)paren
DECL|macro|DECL_B_Z
macro_line|#undef DECL_B_Z
DECL|macro|DECL_D_F
mdefine_line|#define DECL_D_F(r, f)                                                      &bslash;&n;static inline u8                                                            &bslash;&n;get_d_##r##_##f (struct hfcpci_adapter *adapter)                            &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = OFF_D_##r##_##f;                                          &bslash;&n;                                                                            &bslash;&n;&t;return *(adapter-&gt;fifo + off) &amp; 0xf;                                &bslash;&n;}                                                                           &bslash;&n;                                                                            &bslash;&n;static inline void                                                          &bslash;&n;set_d_##r##_##f (struct hfcpci_adapter *adapter, u8 f)                      &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = OFF_D_##r##_##f;                                          &bslash;&n;                                                                            &bslash;&n;&t;*(adapter-&gt;fifo + off) = f | 0x10;                                  &bslash;&n;}
DECL|macro|OFF_D_rx_f1
mdefine_line|#define OFF_D_rx_f1 0x60a0
DECL|macro|OFF_D_rx_f2
mdefine_line|#define OFF_D_rx_f2 0x60a1
DECL|macro|OFF_D_tx_f1
mdefine_line|#define OFF_D_tx_f1 0x20a0
DECL|macro|OFF_D_tx_f2
mdefine_line|#define OFF_D_tx_f2 0x20a1
id|DECL_D_F
c_func
(paren
id|rx
comma
id|f1
)paren
id|DECL_D_F
c_func
(paren
id|rx
comma
id|f2
)paren
id|DECL_D_F
c_func
(paren
id|tx
comma
id|f1
)paren
id|DECL_D_F
c_func
(paren
id|tx
comma
id|f2
)paren
DECL|macro|DECL_D_F
macro_line|#undef DECL_D_F
DECL|macro|DECL_D_Z
mdefine_line|#define DECL_D_Z(r, z)                                                      &bslash;&n;static inline u16                                                           &bslash;&n;get_d_##r##_##z (struct hfcpci_adapter *adapter, u8 f)                      &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = OFF_D_##r##_##z;                                          &bslash;&n;                                                                            &bslash;&n;&t;return le16_to_cpu(*((u16 *) (adapter-&gt;fifo + off + (f | 0x10) * 4)));&bslash;&n;}                                                                           &bslash;&n;                                                                            &bslash;&n;static inline void                                                          &bslash;&n;set_d_##r##_##z(struct hfcpci_adapter *adapter, u8 f, u16 z)                &bslash;&n;{                                                                           &bslash;&n;&t;u16 off = OFF_D_##r##_##z;                                          &bslash;&n;                                                                            &bslash;&n;&t;*((u16 *) (adapter-&gt;fifo + off + (f | 0x10) * 4)) = cpu_to_le16(z); &bslash;&n;}
DECL|macro|OFF_D_rx_z1
mdefine_line|#define OFF_D_rx_z1 0x6080
DECL|macro|OFF_D_rx_z2
mdefine_line|#define OFF_D_rx_z2 0x6082
DECL|macro|OFF_D_tx_z1
mdefine_line|#define OFF_D_tx_z1 0x2080
DECL|macro|OFF_D_tx_z2
mdefine_line|#define OFF_D_tx_z2 0x2082
id|DECL_D_Z
c_func
(paren
id|rx
comma
id|z1
)paren
id|DECL_D_Z
c_func
(paren
id|rx
comma
id|z2
)paren
id|DECL_D_Z
c_func
(paren
id|tx
comma
id|z1
)paren
id|DECL_D_Z
c_func
(paren
id|tx
comma
id|z2
)paren
DECL|macro|DECL_B_Z
macro_line|#undef DECL_B_Z
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// fill b / d fifos
r_static
r_inline
r_void
DECL|function|hfcpci_fill_d_fifo
id|hfcpci_fill_d_fifo
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
r_int
id|cnt
comma
id|fcnt
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|adapter-&gt;fifo
suffix:semicolon
r_struct
id|sk_buff
op_star
id|tx_skb
op_assign
id|adapter-&gt;tx_skb
suffix:semicolon
id|f1
op_assign
id|get_d_tx_f1
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|f2
op_assign
id|get_d_tx_f2
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_D_XMIT
comma
l_string|&quot;f1 %#x f2 %#x&quot;
comma
id|f1
comma
id|f2
)paren
suffix:semicolon
id|fcnt
op_assign
id|f1
op_minus
id|f2
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
l_int|0
)paren
id|fcnt
op_add_assign
id|MAX_D_FRAMES
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BUG&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|z1
op_assign
id|get_d_tx_z1
c_func
(paren
id|adapter
comma
id|f1
)paren
suffix:semicolon
id|z2
op_assign
id|get_d_tx_z2
c_func
(paren
id|adapter
comma
id|f1
)paren
suffix:semicolon
singleline_comment|//XXX
id|DBG
c_func
(paren
id|DBG_D_XMIT
comma
l_string|&quot;z1 %#x z2 %#x&quot;
comma
id|z1
comma
id|z2
)paren
suffix:semicolon
id|cnt
op_assign
id|z2
op_minus
id|z1
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|cnt
op_add_assign
id|D_FIFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|tx_skb-&gt;len
OG
id|cnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BUG&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cnt
op_assign
id|tx_skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_plus
id|cnt
op_le
id|D_FIFO_END
)paren
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|D_FIFO_END
op_minus
id|z1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|D_FIFO_START
comma
id|tx_skb-&gt;data
op_plus
(paren
id|D_FIFO_END
op_minus
id|z1
)paren
comma
id|cnt
op_minus
(paren
id|D_FIFO_END
op_minus
id|z1
)paren
)paren
suffix:semicolon
)brace
id|z1
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_ge
id|D_FIFO_END
)paren
id|z1
op_sub_assign
id|D_FIFO_SIZE
suffix:semicolon
id|f1
op_assign
(paren
id|f1
op_plus
l_int|1
)paren
op_amp
(paren
id|MAX_D_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_d_tx_z1
c_func
(paren
id|adapter
comma
id|f1
comma
id|z1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_d_tx_f1
c_func
(paren
id|adapter
comma
id|f1
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_fill_b_fifo_hdlc
id|hfcpci_fill_b_fifo_hdlc
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
(brace
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
r_int
id|cnt
comma
id|fcnt
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|bcs-&gt;adapter-&gt;fifo
op_plus
(paren
id|bcs-&gt;channel
ques
c_cond
l_int|0x2000
suffix:colon
l_int|0x0000
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|tx_skb
op_assign
id|bcs-&gt;tx_skb
suffix:semicolon
id|f1
op_assign
id|get_b_tx_f1
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|f2
op_assign
id|get_b_tx_f2
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_XMIT
comma
l_string|&quot;f1 %#x f2 %#x&quot;
comma
id|f1
comma
id|f2
)paren
suffix:semicolon
id|fcnt
op_assign
id|f1
op_minus
id|f2
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
l_int|0
)paren
id|fcnt
op_add_assign
id|MAX_B_FRAMES
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BUG&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|z1
op_assign
id|get_b_tx_z1
c_func
(paren
id|bcs
comma
id|f1
)paren
suffix:semicolon
id|z2
op_assign
id|get_b_tx_z2
c_func
(paren
id|bcs
comma
id|f1
)paren
suffix:semicolon
singleline_comment|//XXX
id|DBG
c_func
(paren
id|DBG_B_XMIT
comma
l_string|&quot;z1 %#x z2 %#x&quot;
comma
id|z1
comma
id|z2
)paren
suffix:semicolon
id|cnt
op_assign
id|z2
op_minus
id|z1
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|cnt
op_add_assign
id|B_FIFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|tx_skb-&gt;len
OG
id|cnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BUG&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cnt
op_assign
id|tx_skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_plus
id|cnt
op_le
id|B_FIFO_END
)paren
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|B_FIFO_END
op_minus
id|z1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|B_FIFO_START
comma
id|tx_skb-&gt;data
op_plus
(paren
id|B_FIFO_END
op_minus
id|z1
)paren
comma
id|cnt
op_minus
(paren
id|B_FIFO_END
op_minus
id|z1
)paren
)paren
suffix:semicolon
)brace
id|z1
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_ge
id|B_FIFO_END
)paren
id|z1
op_sub_assign
id|B_FIFO_SIZE
suffix:semicolon
id|f1
op_assign
(paren
id|f1
op_plus
l_int|1
)paren
op_amp
(paren
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_tx_z1
c_func
(paren
id|bcs
comma
id|f1
comma
id|z1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_tx_f1
c_func
(paren
id|bcs
comma
id|f1
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_fill_b_fifo_trans
id|hfcpci_fill_b_fifo_trans
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
(brace
r_int
id|cnt
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|bcs-&gt;adapter-&gt;fifo
op_plus
(paren
id|bcs-&gt;channel
ques
c_cond
l_int|0x2000
suffix:colon
l_int|0x0000
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|tx_skb
op_assign
id|bcs-&gt;tx_skb
suffix:semicolon
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
id|f1
op_assign
id|get_b_tx_f1
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|f2
op_assign
id|get_b_tx_f2
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f1
op_ne
id|f2
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|z1
op_assign
id|get_b_tx_z1
c_func
(paren
id|bcs
comma
id|f1
)paren
suffix:semicolon
id|z2
op_assign
id|get_b_tx_z2
c_func
(paren
id|bcs
comma
id|f1
)paren
suffix:semicolon
id|cnt
op_assign
id|z2
op_minus
id|z1
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|cnt
op_add_assign
id|B_FIFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|tx_skb-&gt;len
OG
id|cnt
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_plus
id|cnt
op_le
id|B_FIFO_END
)paren
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|z1
comma
id|tx_skb-&gt;data
comma
id|B_FIFO_END
op_minus
id|z1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fifo_adr
op_plus
id|B_FIFO_START
comma
id|tx_skb-&gt;data
op_plus
(paren
id|B_FIFO_END
op_minus
id|z1
)paren
comma
id|cnt
op_minus
(paren
id|B_FIFO_END
op_minus
id|z1
)paren
)paren
suffix:semicolon
)brace
id|z1
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|z1
op_ge
id|B_FIFO_END
)paren
id|z1
op_sub_assign
id|B_FIFO_SIZE
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_tx_z1
c_func
(paren
id|bcs
comma
id|f1
comma
id|z1
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_fill_b_fifo
id|hfcpci_fill_b_fifo
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bcs-&gt;tx_skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bcs-&gt;mode
)paren
(brace
r_case
id|L1_MODE_TRANS
suffix:colon
id|hfcpci_fill_b_fifo_trans
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_HDLC
suffix:colon
id|hfcpci_fill_b_fifo_hdlc
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;?&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
id|hfcpci_clear_b_rx_fifo
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
suffix:semicolon
r_static
r_void
id|hfcpci_clear_b_tx_fifo
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
suffix:semicolon
r_static
r_void
DECL|function|hfcpci_b_mode
id|hfcpci_b_mode
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
comma
r_int
id|mode
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|bcs-&gt;adapter
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_XMIT
comma
l_string|&quot;B%d mode %d --&gt; %d&quot;
comma
id|bcs-&gt;channel
op_plus
l_int|1
comma
id|bcs-&gt;mode
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|mode
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;channel
op_eq
l_int|0
)paren
(brace
id|adapter-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_B1_ENA
suffix:semicolon
id|adapter-&gt;sctrl_r
op_and_assign
op_complement
id|SCTRL_B1_ENA
suffix:semicolon
id|adapter-&gt;fifo_en
op_and_assign
op_complement
id|HFCPCI_FIFOEN_B1
suffix:semicolon
id|adapter-&gt;int_m1
op_and_assign
op_complement
(paren
id|HFCPCI_INTS_B1TRANS
op_plus
id|HFCPCI_INTS_B1REC
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_B2_ENA
suffix:semicolon
id|adapter-&gt;sctrl_r
op_and_assign
op_complement
id|SCTRL_B2_ENA
suffix:semicolon
id|adapter-&gt;fifo_en
op_and_assign
op_complement
id|HFCPCI_FIFOEN_B2
suffix:semicolon
id|adapter-&gt;int_m1
op_and_assign
op_complement
(paren
id|HFCPCI_INTS_B2TRANS
op_plus
id|HFCPCI_INTS_B2REC
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
r_case
id|L1_MODE_HDLC
suffix:colon
id|hfcpci_clear_b_rx_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|hfcpci_clear_b_tx_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;channel
op_eq
l_int|0
)paren
(brace
id|adapter-&gt;sctrl
op_or_assign
id|SCTRL_B1_ENA
suffix:semicolon
id|adapter-&gt;sctrl_r
op_or_assign
id|SCTRL_B1_ENA
suffix:semicolon
id|adapter-&gt;fifo_en
op_or_assign
id|HFCPCI_FIFOEN_B1
suffix:semicolon
id|adapter-&gt;int_m1
op_or_assign
(paren
id|HFCPCI_INTS_B1TRANS
op_plus
id|HFCPCI_INTS_B1REC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|L1_MODE_TRANS
)paren
id|adapter-&gt;ctmt
op_or_assign
l_int|1
suffix:semicolon
r_else
id|adapter-&gt;ctmt
op_and_assign
op_complement
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;sctrl
op_or_assign
id|SCTRL_B2_ENA
suffix:semicolon
id|adapter-&gt;sctrl_r
op_or_assign
id|SCTRL_B2_ENA
suffix:semicolon
id|adapter-&gt;fifo_en
op_or_assign
id|HFCPCI_FIFOEN_B2
suffix:semicolon
id|adapter-&gt;int_m1
op_or_assign
(paren
id|HFCPCI_INTS_B2TRANS
op_plus
id|HFCPCI_INTS_B2REC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|L1_MODE_TRANS
)paren
id|adapter-&gt;ctmt
op_or_assign
l_int|2
suffix:semicolon
r_else
id|adapter-&gt;ctmt
op_and_assign
op_complement
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;int_m1
comma
id|HFCPCI_INT_M1
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;sctrl
comma
id|HFCPCI_SCTRL
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;sctrl_r
comma
id|HFCPCI_SCTRL_R
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;ctmt
comma
id|HFCPCI_CTMT
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;conn
comma
id|HFCPCI_CONNECT
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// Layer 1 state machine
DECL|variable|l1fsm
r_static
r_struct
id|Fsm
id|l1fsm
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_L1_F0
id|ST_L1_F0
comma
DECL|enumerator|ST_L1_F2
id|ST_L1_F2
comma
DECL|enumerator|ST_L1_F3
id|ST_L1_F3
comma
DECL|enumerator|ST_L1_F4
id|ST_L1_F4
comma
DECL|enumerator|ST_L1_F5
id|ST_L1_F5
comma
DECL|enumerator|ST_L1_F6
id|ST_L1_F6
comma
DECL|enumerator|ST_L1_F7
id|ST_L1_F7
comma
DECL|enumerator|ST_L1_F8
id|ST_L1_F8
comma
)brace
suffix:semicolon
DECL|macro|L1_STATE_COUNT
mdefine_line|#define L1_STATE_COUNT (ST_L1_F8+1)
DECL|variable|strL1State
r_static
r_char
op_star
id|strL1State
(braket
)braket
op_assign
(brace
l_string|&quot;ST_L1_F0&quot;
comma
l_string|&quot;ST_L1_F2&quot;
comma
l_string|&quot;ST_L1_F3&quot;
comma
l_string|&quot;ST_L1_F4&quot;
comma
l_string|&quot;ST_L1_F5&quot;
comma
l_string|&quot;ST_L1_F6&quot;
comma
l_string|&quot;ST_L1_F7&quot;
comma
l_string|&quot;ST_L1_F8&quot;
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|EV_PH_F0
id|EV_PH_F0
comma
DECL|enumerator|EV_PH_1
id|EV_PH_1
comma
DECL|enumerator|EV_PH_F2
id|EV_PH_F2
comma
DECL|enumerator|EV_PH_F3
id|EV_PH_F3
comma
DECL|enumerator|EV_PH_F4
id|EV_PH_F4
comma
DECL|enumerator|EV_PH_F5
id|EV_PH_F5
comma
DECL|enumerator|EV_PH_F6
id|EV_PH_F6
comma
DECL|enumerator|EV_PH_F7
id|EV_PH_F7
comma
DECL|enumerator|EV_PH_F8
id|EV_PH_F8
comma
DECL|enumerator|EV_PH_ACTIVATE_REQ
id|EV_PH_ACTIVATE_REQ
comma
DECL|enumerator|EV_PH_DEACTIVATE_REQ
id|EV_PH_DEACTIVATE_REQ
comma
DECL|enumerator|EV_TIMER3
id|EV_TIMER3
comma
)brace
suffix:semicolon
DECL|macro|L1_EVENT_COUNT
mdefine_line|#define L1_EVENT_COUNT (EV_TIMER3 + 1)
DECL|variable|strL1Event
r_static
r_char
op_star
id|strL1Event
(braket
)braket
op_assign
(brace
l_string|&quot;EV_PH_F0&quot;
comma
l_string|&quot;EV_PH_1&quot;
comma
l_string|&quot;EV_PH_F2&quot;
comma
l_string|&quot;EV_PH_F3&quot;
comma
l_string|&quot;EV_PH_F4&quot;
comma
l_string|&quot;EV_PH_F5&quot;
comma
l_string|&quot;EV_PH_F6&quot;
comma
l_string|&quot;EV_PH_F7&quot;
comma
l_string|&quot;EV_PH_F8&quot;
comma
l_string|&quot;EV_PH_ACTIVATE_REQ&quot;
comma
l_string|&quot;EV_PH_DEACTIVATE_REQ&quot;
comma
l_string|&quot;EV_TIMER3&quot;
comma
)brace
suffix:semicolon
DECL|function|l1_ignore
r_static
r_void
id|l1_ignore
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
)brace
DECL|function|l1_go_f3
r_static
r_void
id|l1_go_f3
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f3_deact_ind
r_static
r_void
id|l1_go_f3_deact_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f4
r_static
r_void
id|l1_go_f4
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f5
r_static
r_void
id|l1_go_f5
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F3
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f6
r_static
r_void
id|l1_go_f6
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F6
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f6_deact_ind
r_static
r_void
id|l1_go_f6_deact_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F6
)paren
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f7
r_static
r_void
id|l1_go_f7
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F7
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f7_act_ind
r_static
r_void
id|l1_go_f7_act_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F7
)paren
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_ACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f8
r_static
r_void
id|l1_go_f8
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F8
)paren
suffix:semicolon
)brace
DECL|function|l1_go_f8_deact_ind
r_static
r_void
id|l1_go_f8_deact_ind
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|FsmChangeState
c_func
(paren
id|fi
comma
id|ST_L1_F8
)paren
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|l1_act_req
r_static
r_void
id|l1_act_req
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|HFCPCI_ACTIVATE
op_or
id|HFCPCI_DO_ACTION
comma
id|HFCPCI_STATES
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|FsmNode
id|L1FnList
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ST_L1_F2
comma
id|EV_PH_F3
comma
id|l1_go_f3
)brace
comma
(brace
id|ST_L1_F2
comma
id|EV_PH_F6
comma
id|l1_go_f6
)brace
comma
(brace
id|ST_L1_F2
comma
id|EV_PH_F7
comma
id|l1_go_f7_act_ind
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_F3
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_F4
comma
id|l1_go_f4
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_F5
comma
id|l1_go_f5
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_F6
comma
id|l1_go_f6
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_F7
comma
id|l1_go_f7_act_ind
)brace
comma
(brace
id|ST_L1_F3
comma
id|EV_PH_ACTIVATE_REQ
comma
id|l1_act_req
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_PH_F7
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_PH_F3
comma
id|l1_go_f3
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_PH_F5
comma
id|l1_go_f5
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_PH_F6
comma
id|l1_go_f6
)brace
comma
(brace
id|ST_L1_F4
comma
id|EV_PH_F7
comma
id|l1_go_f7
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_PH_F7
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_PH_F3
comma
id|l1_go_f3
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_PH_F6
comma
id|l1_go_f6
)brace
comma
(brace
id|ST_L1_F5
comma
id|EV_PH_F7
comma
id|l1_go_f7
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_PH_F7
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_PH_F3
comma
id|l1_go_f3
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_PH_F7
comma
id|l1_go_f7_act_ind
)brace
comma
(brace
id|ST_L1_F6
comma
id|EV_PH_F8
comma
id|l1_go_f8
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_PH_F7
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_PH_F3
comma
id|l1_go_f3_deact_ind
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_PH_F6
comma
id|l1_go_f6_deact_ind
)brace
comma
(brace
id|ST_L1_F7
comma
id|EV_PH_F8
comma
id|l1_go_f8_deact_ind
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_PH_F7
comma
id|l1_ignore
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_PH_F3
comma
id|l1_go_f3
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_PH_F6
comma
id|l1_go_f6
)brace
comma
(brace
id|ST_L1_F8
comma
id|EV_PH_F7
comma
id|l1_go_f7_act_ind
)brace
comma
)brace
suffix:semicolon
DECL|function|l1m_debug
r_static
r_void
id|l1m_debug
c_func
(paren
r_struct
id|FsmInst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_L1M
comma
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// clear FIFOs
r_static
r_void
DECL|function|hfcpci_clear_d_rx_fifo
id|hfcpci_clear_d_rx_fifo
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|u8
id|fifo_state
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_D_RECV
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|fifo_state
op_assign
id|adapter-&gt;fifo_en
op_amp
id|HFCPCI_FIFOEN_DRX
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
singleline_comment|// enabled
singleline_comment|// XXX locking
id|adapter-&gt;fifo_en
op_and_assign
op_complement
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
id|adapter-&gt;last_fcnt
op_assign
l_int|0
suffix:semicolon
id|set_d_rx_z1
c_func
(paren
id|adapter
comma
id|MAX_D_FRAMES
op_minus
l_int|1
comma
id|D_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|set_d_rx_z2
c_func
(paren
id|adapter
comma
id|MAX_D_FRAMES
op_minus
l_int|1
comma
id|D_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_d_rx_f1
c_func
(paren
id|adapter
comma
id|MAX_D_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|set_d_rx_f2
c_func
(paren
id|adapter
comma
id|MAX_D_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
id|adapter-&gt;fifo_en
op_or_assign
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|hfcpci_clear_b_rx_fifo
id|hfcpci_clear_b_rx_fifo
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|bcs-&gt;adapter
suffix:semicolon
r_int
id|nr
op_assign
id|bcs-&gt;channel
suffix:semicolon
id|u8
id|fifo_state
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_RECV
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|fifo_state
op_assign
id|adapter-&gt;fifo_en
op_amp
(paren
id|nr
ques
c_cond
id|HFCPCI_FIFOEN_B2RX
suffix:colon
id|HFCPCI_FIFOEN_B1RX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
singleline_comment|// enabled
id|adapter-&gt;fifo_en
op_and_assign
op_complement
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
id|bcs-&gt;last_fcnt
op_assign
l_int|0
suffix:semicolon
id|set_b_rx_z1
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
comma
id|B_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|set_b_rx_z2
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
comma
id|B_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_rx_f1
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|set_b_rx_f2
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
id|adapter-&gt;fifo_en
op_or_assign
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// XXX clear d_tx_fifo?
r_static
r_void
DECL|function|hfcpci_clear_b_tx_fifo
id|hfcpci_clear_b_tx_fifo
c_func
(paren
r_struct
id|hfcpci_bcs
op_star
id|bcs
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|bcs-&gt;adapter
suffix:semicolon
r_int
id|nr
op_assign
id|bcs-&gt;channel
suffix:semicolon
id|u8
id|fifo_state
suffix:semicolon
id|fifo_state
op_assign
id|adapter-&gt;fifo_en
op_amp
(paren
id|nr
ques
c_cond
id|HFCPCI_FIFOEN_B2TX
suffix:colon
id|HFCPCI_FIFOEN_B1TX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
singleline_comment|// enabled
id|adapter-&gt;fifo_en
op_and_assign
op_complement
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
id|bcs-&gt;last_fcnt
op_assign
l_int|0
suffix:semicolon
id|set_b_rx_z1
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
comma
id|B_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|set_b_rx_z2
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
comma
id|B_FIFO_END
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_rx_f1
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|set_b_rx_f2
c_func
(paren
id|bcs
comma
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fifo_state
)paren
(brace
id|adapter-&gt;fifo_en
op_or_assign
id|fifo_state
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// receive messages from upper layers
r_static
r_void
DECL|function|hfcpci_d_l2l1
id|hfcpci_d_l2l1
c_func
(paren
r_struct
id|hisax_if
op_star
id|ifc
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|ifc-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;pr %#x&quot;
comma
id|pr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|PH_ACTIVATE
op_or
id|REQUEST
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|adapter-&gt;l1m
comma
id|EV_PH_ACTIVATE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PH_DEACTIVATE
op_or
id|REQUEST
suffix:colon
id|FsmEvent
c_func
(paren
op_amp
id|adapter-&gt;l1m
comma
id|EV_PH_DEACTIVATE_REQ
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PH_DATA
op_or
id|REQUEST
suffix:colon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;PH_DATA REQUEST len %d&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|DBG_SKB
c_func
(paren
id|DBG_D_XMIT
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;l1m.state
op_ne
id|ST_L1_F7
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;L1 wrong state %d&quot;
comma
id|adapter-&gt;l1m.state
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;tx_skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|adapter-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|hfcpci_fill_d_fifo
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|hfcpci_b_l2l1
id|hfcpci_b_l2l1
c_func
(paren
r_struct
id|hisax_if
op_star
id|ifc
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|hfcpci_bcs
op_star
id|bcs
op_assign
id|ifc-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|mode
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;pr %#x&quot;
comma
id|pr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|PH_DATA
op_or
id|REQUEST
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;tx_skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|bcs-&gt;tx_skb
op_assign
id|skb
suffix:semicolon
id|DBG_SKB
c_func
(paren
id|DBG_B_XMIT
comma
id|skb
)paren
suffix:semicolon
id|hfcpci_fill_b_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PH_ACTIVATE
op_or
id|REQUEST
suffix:colon
id|mode
op_assign
(paren
r_int
)paren
id|arg
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;B%d,PH_ACTIVATE_REQUEST %d&quot;
comma
id|bcs-&gt;channel
op_plus
l_int|1
comma
id|mode
)paren
suffix:semicolon
id|hfcpci_b_mode
c_func
(paren
id|bcs
comma
id|mode
)paren
suffix:semicolon
id|B_L1L2
c_func
(paren
id|bcs
comma
id|PH_ACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PH_DEACTIVATE
op_or
id|REQUEST
suffix:colon
id|DBG
c_func
(paren
id|DBG_PR
comma
l_string|&quot;B%d,PH_DEACTIVATE_REQUEST&quot;
comma
id|bcs-&gt;channel
op_plus
l_int|1
)paren
suffix:semicolon
id|hfcpci_b_mode
c_func
(paren
id|bcs
comma
id|L1_MODE_NULL
)paren
suffix:semicolon
id|B_L1L2
c_func
(paren
id|bcs
comma
id|PH_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// receive IRQ
r_static
r_inline
r_void
DECL|function|hfcpci_d_recv_irq
id|hfcpci_d_recv_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|adapter-&gt;fifo
op_plus
l_int|0x4000
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|cnt
comma
id|fcnt
suffix:semicolon
r_int
id|loop
op_assign
l_int|5
suffix:semicolon
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
r_while
c_loop
(paren
id|loop
op_decrement
OG
l_int|0
)paren
(brace
id|f1
op_assign
id|get_d_rx_f1
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|f2
op_assign
id|get_d_rx_f2
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_D_RECV
comma
l_string|&quot;f1 %#x f2 %#x&quot;
comma
id|f1
comma
id|f2
)paren
suffix:semicolon
id|fcnt
op_assign
id|f1
op_minus
id|f2
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
l_int|0
)paren
id|fcnt
op_add_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fcnt
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
id|adapter-&gt;last_fcnt
)paren
multiline_comment|/* overrun */
id|hfcpci_clear_d_rx_fifo
c_func
(paren
id|adapter
)paren
suffix:semicolon
singleline_comment|// XXX init last_fcnt
id|z1
op_assign
id|get_d_rx_z1
c_func
(paren
id|adapter
comma
id|f2
)paren
suffix:semicolon
id|z2
op_assign
id|get_d_rx_z2
c_func
(paren
id|adapter
comma
id|f2
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_D_RECV
comma
l_string|&quot;z1 %#x z2 %#x&quot;
comma
id|z1
comma
id|z2
)paren
suffix:semicolon
id|cnt
op_assign
id|z1
op_minus
id|z2
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|0
)paren
id|cnt
op_add_assign
id|D_FIFO_SIZE
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|4
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;frame too short&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fifo_adr
(braket
id|z1
)braket
op_ne
l_int|0
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;CRC error&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|cnt
op_sub_assign
l_int|3
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;no mem&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z2
op_plus
id|cnt
op_le
id|D_FIFO_END
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
id|D_FIFO_END
op_minus
id|z2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
op_plus
(paren
id|D_FIFO_END
op_minus
id|z2
)paren
comma
id|fifo_adr
op_plus
id|D_FIFO_START
comma
id|cnt
op_minus
(paren
id|D_FIFO_END
op_minus
id|z2
)paren
)paren
suffix:semicolon
)brace
id|DBG_SKB
c_func
(paren
id|DBG_D_RECV
comma
id|skb
)paren
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|skb
)paren
suffix:semicolon
id|next
suffix:colon
r_if
c_cond
(paren
op_increment
id|z1
op_ge
id|D_FIFO_END
)paren
id|z1
op_sub_assign
id|D_FIFO_START
suffix:semicolon
id|f2
op_assign
(paren
id|f2
op_plus
l_int|1
)paren
op_amp
(paren
id|MAX_D_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_d_rx_z2
c_func
(paren
id|adapter
comma
id|f2
comma
id|z1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_d_rx_f2
c_func
(paren
id|adapter
comma
id|f2
)paren
suffix:semicolon
id|adapter-&gt;last_fcnt
op_assign
id|fcnt
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_b_recv_hdlc_irq
id|hfcpci_b_recv_hdlc_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
id|nr
)paren
(brace
r_struct
id|hfcpci_bcs
op_star
id|bcs
op_assign
op_amp
id|adapter-&gt;bcs
(braket
id|nr
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|adapter-&gt;fifo
op_plus
(paren
id|nr
ques
c_cond
l_int|0x6000
suffix:colon
l_int|0x4000
)paren
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|cnt
comma
id|fcnt
suffix:semicolon
r_int
id|loop
op_assign
l_int|5
suffix:semicolon
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
r_while
c_loop
(paren
id|loop
op_decrement
OG
l_int|0
)paren
(brace
id|f1
op_assign
id|get_b_rx_f1
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|f2
op_assign
id|get_b_rx_f2
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_RECV
comma
l_string|&quot;f1 %d f2 %d&quot;
comma
id|f1
comma
id|f2
)paren
suffix:semicolon
id|fcnt
op_assign
id|f1
op_minus
id|f2
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
l_int|0
)paren
id|fcnt
op_add_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fcnt
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fcnt
OL
id|bcs-&gt;last_fcnt
)paren
multiline_comment|/* overrun */
id|hfcpci_clear_b_rx_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
singleline_comment|// XXX init last_fcnt
id|z1
op_assign
id|get_b_rx_z1
c_func
(paren
id|bcs
comma
id|f2
)paren
suffix:semicolon
id|z2
op_assign
id|get_b_rx_z2
c_func
(paren
id|bcs
comma
id|f2
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_RECV
comma
l_string|&quot;z1 %d z2 %d&quot;
comma
id|z1
comma
id|z2
)paren
suffix:semicolon
id|cnt
op_assign
id|z1
op_minus
id|z2
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|0
)paren
id|cnt
op_add_assign
id|B_FIFO_SIZE
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|4
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;frame too short&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fifo_adr
(braket
id|z1
)braket
op_ne
l_int|0
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;CRC error&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|cnt
op_sub_assign
l_int|3
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;no mem&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z2
op_plus
id|cnt
op_le
id|B_FIFO_END
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
id|B_FIFO_END
op_minus
id|z2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
op_plus
(paren
id|B_FIFO_END
op_minus
id|z2
)paren
comma
id|fifo_adr
op_plus
id|B_FIFO_START
comma
id|cnt
op_minus
(paren
id|B_FIFO_END
op_minus
id|z2
)paren
)paren
suffix:semicolon
)brace
id|DBG_SKB
c_func
(paren
id|DBG_B_RECV
comma
id|skb
)paren
suffix:semicolon
id|B_L1L2
c_func
(paren
id|bcs
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|skb
)paren
suffix:semicolon
id|next
suffix:colon
r_if
c_cond
(paren
op_increment
id|z1
op_ge
id|B_FIFO_END
)paren
id|z1
op_sub_assign
id|B_FIFO_SIZE
suffix:semicolon
id|f2
op_assign
(paren
id|f2
op_plus
l_int|1
)paren
op_amp
(paren
id|MAX_B_FRAMES
op_minus
l_int|1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_rx_z2
c_func
(paren
id|bcs
comma
id|f2
comma
id|z1
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_rx_f2
c_func
(paren
id|bcs
comma
id|f2
)paren
suffix:semicolon
id|bcs-&gt;last_fcnt
op_assign
id|fcnt
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_b_recv_trans_irq
id|hfcpci_b_recv_trans_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
id|nr
)paren
(brace
r_struct
id|hfcpci_bcs
op_star
id|bcs
op_assign
op_amp
id|adapter-&gt;bcs
(braket
id|nr
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_char
op_star
id|fifo_adr
op_assign
id|adapter-&gt;fifo
op_plus
(paren
id|nr
ques
c_cond
l_int|0x6000
suffix:colon
l_int|0x4000
)paren
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|cnt
suffix:semicolon
r_int
id|loop
op_assign
l_int|5
suffix:semicolon
id|u8
id|f1
comma
id|f2
suffix:semicolon
id|u16
id|z1
comma
id|z2
suffix:semicolon
id|f1
op_assign
id|get_b_rx_f1
c_func
(paren
id|bcs
)paren
suffix:semicolon
id|f2
op_assign
id|get_b_rx_f2
c_func
(paren
id|bcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f1
op_ne
id|f2
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|loop
op_decrement
OG
l_int|0
)paren
(brace
id|z1
op_assign
id|get_b_rx_z1
c_func
(paren
id|bcs
comma
id|f2
)paren
suffix:semicolon
id|z2
op_assign
id|get_b_rx_z2
c_func
(paren
id|bcs
comma
id|f2
)paren
suffix:semicolon
id|cnt
op_assign
id|z1
op_minus
id|z2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cnt
)paren
multiline_comment|/* no data available */
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|0
)paren
id|cnt
op_add_assign
id|B_FIFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|HFCPCI_BTRANS_THRESHOLD
)paren
id|cnt
op_assign
id|HFCPCI_BTRANS_THRESHOLD
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;no mem&quot;
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z2
op_plus
id|cnt
op_le
l_int|0x2000
)paren
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
id|z2
comma
l_int|0x2000
op_minus
id|z2
)paren
suffix:semicolon
id|p
op_add_assign
l_int|0x2000
op_minus
id|z2
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|fifo_adr
op_plus
l_int|0x200
comma
id|cnt
op_minus
(paren
l_int|0x2000
op_minus
id|z2
)paren
)paren
suffix:semicolon
)brace
id|DBG_SKB
c_func
(paren
id|DBG_B_RECV
comma
id|skb
)paren
suffix:semicolon
id|B_L1L2
c_func
(paren
id|bcs
comma
id|PH_DATA
op_or
id|INDICATION
comma
id|skb
)paren
suffix:semicolon
id|next
suffix:colon
id|z2
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|z2
op_ge
l_int|0x2000
)paren
id|z2
op_sub_assign
id|B_FIFO_SIZE
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|set_b_rx_z2
c_func
(paren
id|bcs
comma
id|f2
comma
id|z2
)paren
suffix:semicolon
singleline_comment|// XXX always receive buffers of a given size
)brace
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_b_recv_irq
id|hfcpci_b_recv_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
id|nr
)paren
(brace
id|DBG
c_func
(paren
id|DBG_B_RECV
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|adapter-&gt;bcs
(braket
id|nr
)braket
dot
id|mode
)paren
(brace
r_case
id|L1_MODE_NULL
suffix:colon
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_HDLC
suffix:colon
id|hfcpci_b_recv_hdlc_irq
c_func
(paren
id|adapter
comma
id|nr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_MODE_TRANS
suffix:colon
id|hfcpci_b_recv_trans_irq
c_func
(paren
id|adapter
comma
id|nr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// transmit IRQ
singleline_comment|// XXX make xmit FIFO deeper than 1 
r_static
r_inline
r_void
DECL|function|hfcpci_d_xmit_irq
id|hfcpci_d_xmit_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_D_XMIT
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|skb
op_assign
id|adapter-&gt;tx_skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|adapter-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|D_L1L2
c_func
(paren
id|adapter
comma
id|PH_DATA
op_or
id|CONFIRM
comma
(paren
r_void
op_star
)paren
id|skb-&gt;truesize
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|hfcpci_b_xmit_irq
id|hfcpci_b_xmit_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
comma
r_int
id|nr
)paren
(brace
r_struct
id|hfcpci_bcs
op_star
id|bcs
op_assign
op_amp
id|adapter-&gt;bcs
(braket
id|nr
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_B_XMIT
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|skb
op_assign
id|bcs-&gt;tx_skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DBG
c_func
(paren
id|DBG_WARN
comma
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|bcs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|B_L1L2
c_func
(paren
id|bcs
comma
id|PH_DATA
op_or
id|CONFIRM
comma
id|skb
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// Layer 1 state change IRQ
r_static
r_inline
r_void
DECL|function|hfcpci_state_irq
id|hfcpci_state_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|u8
id|val
suffix:semicolon
id|val
op_assign
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_STATES
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_L1M
comma
l_string|&quot;STATES %#x&quot;
comma
id|val
)paren
suffix:semicolon
id|FsmEvent
c_func
(paren
op_amp
id|adapter-&gt;l1m
comma
id|val
op_amp
l_int|0xf
comma
l_int|NULL
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// Timer IRQ
r_static
r_inline
r_void
DECL|function|hfcpci_timer_irq
id|hfcpci_timer_irq
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;ctmt
op_or
id|HFCPCI_CLTIMER
comma
id|HFCPCI_CTMT
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// IRQ handler
r_static
r_void
DECL|function|hfcpci_irq
id|hfcpci_irq
c_func
(paren
r_int
id|intno
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|dev
suffix:semicolon
r_int
id|loop
op_assign
l_int|15
suffix:semicolon
id|u8
id|val
comma
id|stat
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter-&gt;int_m2
op_amp
l_int|0x08
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* not initialised */
singleline_comment|// XX
id|stat
op_assign
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|stat
op_amp
id|HFCPCI_ANYINT
)paren
)paren
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|adapter-&gt;hw_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|loop
op_decrement
OG
l_int|0
)paren
(brace
id|val
op_assign
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_INT_S1
)paren
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_IRQ
comma
l_string|&quot;stat %02x s1 %02x&quot;
comma
id|stat
comma
id|val
)paren
suffix:semicolon
id|val
op_and_assign
id|adapter-&gt;int_m1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x08
)paren
id|hfcpci_b_recv_irq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x10
)paren
id|hfcpci_b_recv_irq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x01
)paren
id|hfcpci_b_xmit_irq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x02
)paren
id|hfcpci_b_xmit_irq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x20
)paren
id|hfcpci_d_recv_irq
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x04
)paren
id|hfcpci_d_xmit_irq
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x40
)paren
id|hfcpci_state_irq
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x80
)paren
id|hfcpci_timer_irq
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|adapter-&gt;hw_lock
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// reset hardware
r_static
r_void
DECL|function|hfcpci_reset
id|hfcpci_reset
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
multiline_comment|/* disable all interrupts */
id|adapter-&gt;int_m1
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;int_m2
op_assign
l_int|0
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;int_m1
comma
id|HFCPCI_INT_M1
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;int_m2
comma
id|HFCPCI_INT_M2
)paren
suffix:semicolon
multiline_comment|/* reset */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|HFCPCI_RESET
comma
id|HFCPCI_CIRM
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|30
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|0
comma
id|HFCPCI_CIRM
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|20
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_STATUS
)paren
op_amp
l_int|2
)paren
singleline_comment|// XX
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HFC-PCI init bit busy&bslash;n&quot;
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// init hardware
r_static
r_void
DECL|function|hfcpci_hw_init
id|hfcpci_hw_init
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|adapter-&gt;fifo_en
op_assign
l_int|0x30
suffix:semicolon
multiline_comment|/* only D fifos enabled */
singleline_comment|// XX
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;fifo_en
comma
id|HFCPCI_FIFO_EN
)paren
suffix:semicolon
multiline_comment|/* no echo connect , threshold */
id|adapter-&gt;trm
op_assign
id|HFCPCI_BTRANS_THRESMASK
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;trm
comma
id|HFCPCI_TRM
)paren
suffix:semicolon
multiline_comment|/* ST-Bit delay for TE-Mode */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|CLKDEL_TE
comma
id|HFCPCI_CLKDEL
)paren
suffix:semicolon
multiline_comment|/* S/T Auto awake */
id|adapter-&gt;sctrl_e
op_assign
id|HFCPCI_AUTO_AWAKE
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;sctrl_e
comma
id|HFCPCI_SCTRL_E
)paren
suffix:semicolon
multiline_comment|/* no exchange */
id|adapter-&gt;bswapped
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* we are in TE mode */
id|adapter-&gt;nt_mode
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;ctmt
op_assign
id|HFCPCI_TIM3_125
op_or
id|HFCPCI_AUTO_TIMER
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;ctmt
comma
id|HFCPCI_CTMT
)paren
suffix:semicolon
id|adapter-&gt;int_m1
op_assign
id|HFCPCI_INTS_DTRANS
op_or
id|HFCPCI_INTS_DREC
op_or
id|HFCPCI_INTS_L1STATE
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;int_m1
comma
id|HFCPCI_INT_M1
)paren
suffix:semicolon
multiline_comment|/* clear already pending ints */
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_INT_S1
)paren
suffix:semicolon
id|adapter-&gt;l1m.state
op_assign
l_int|2
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|HFCPCI_LOAD_STATE
op_or
l_int|2
comma
id|HFCPCI_STATES
)paren
suffix:semicolon
singleline_comment|// XX /* HFC ST 2 */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|2
comma
id|HFCPCI_STATES
)paren
suffix:semicolon
multiline_comment|/* HFC ST 2 */
multiline_comment|/* HFC Master Mode */
id|adapter-&gt;mst_m
op_assign
id|HFCPCI_MASTER
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;mst_m
comma
id|HFCPCI_MST_MODE
)paren
suffix:semicolon
multiline_comment|/* set tx_lo mode, error in datasheet ! */
id|adapter-&gt;sctrl
op_assign
l_int|0x40
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;sctrl
comma
id|HFCPCI_SCTRL
)paren
suffix:semicolon
id|adapter-&gt;sctrl_r
op_assign
l_int|0
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;sctrl_r
comma
id|HFCPCI_SCTRL_R
)paren
suffix:semicolon
singleline_comment|// XXX
multiline_comment|/* Init GCI/IOM2 in master mode */
multiline_comment|/* Slots 0 and 1 are set for B-chan 1 and 2 */
multiline_comment|/* D- and monitor/CI channel are not enabled */
multiline_comment|/* STIO1 is used as output for data, B1+B2 from ST-&gt;IOM+HFC */
multiline_comment|/* STIO2 is used as data input, B1+B2 from IOM-&gt;ST */
multiline_comment|/* ST B-channel send disabled -&gt; continous 1s */
multiline_comment|/* The IOM slots are always enabled */
id|adapter-&gt;conn
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set data flow directions */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;conn
comma
id|HFCPCI_CONNECT
)paren
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|0x80
comma
id|HFCPCI_B1_SSL
)paren
suffix:semicolon
multiline_comment|/* B1-Slot 0 STIO1 out enabled */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|0x81
comma
id|HFCPCI_B2_SSL
)paren
suffix:semicolon
multiline_comment|/* B2-Slot 1 STIO1 out enabled */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|0x80
comma
id|HFCPCI_B1_RSL
)paren
suffix:semicolon
multiline_comment|/* B1-Slot 0 STIO2 in enabled */
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
l_int|0x81
comma
id|HFCPCI_B2_RSL
)paren
suffix:semicolon
multiline_comment|/* B2-Slot 1 STIO2 in enabled */
multiline_comment|/* Finally enable IRQ output */
id|adapter-&gt;int_m2
op_assign
id|HFCPCI_IRQ_ENABLE
suffix:semicolon
id|hfcpci_writeb
c_func
(paren
id|adapter
comma
id|adapter-&gt;int_m2
comma
id|HFCPCI_INT_M2
)paren
suffix:semicolon
id|hfcpci_readb
c_func
(paren
id|adapter
comma
id|HFCPCI_INT_S2
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------
singleline_comment|// probe / remove
r_static
r_struct
id|hfcpci_adapter
op_star
id|__devinit
DECL|function|new_adapter
id|new_adapter
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|hisax_b_if
op_star
id|b_if
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|adapter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hfcpci_adapter
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|adapter
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hfcpci_adapter
)paren
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
op_amp
id|adapter-&gt;d_if
)paren
suffix:semicolon
id|adapter-&gt;d_if.ifc.priv
op_assign
id|adapter
suffix:semicolon
id|adapter-&gt;d_if.ifc.l2l1
op_assign
id|hfcpci_d_l2l1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|adapter-&gt;bcs
(braket
id|i
)braket
dot
id|adapter
op_assign
id|adapter
suffix:semicolon
id|adapter-&gt;bcs
(braket
id|i
)braket
dot
id|channel
op_assign
id|i
suffix:semicolon
id|adapter-&gt;bcs
(braket
id|i
)braket
dot
id|b_if.ifc.priv
op_assign
op_amp
id|adapter-&gt;bcs
(braket
id|i
)braket
suffix:semicolon
id|adapter-&gt;bcs
(braket
id|i
)braket
dot
id|b_if.ifc.l2l1
op_assign
id|hfcpci_b_l2l1
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|adapter
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|b_if
(braket
id|i
)braket
op_assign
op_amp
id|adapter-&gt;bcs
(braket
id|i
)braket
dot
id|b_if
suffix:semicolon
id|hisax_register
c_func
(paren
op_amp
id|adapter-&gt;d_if
comma
id|b_if
comma
l_string|&quot;hfcpci&quot;
comma
id|protocol
)paren
suffix:semicolon
r_return
id|adapter
suffix:semicolon
)brace
DECL|function|delete_adapter
r_static
r_void
id|delete_adapter
c_func
(paren
r_struct
id|hfcpci_adapter
op_star
id|adapter
)paren
(brace
id|hisax_unregister
c_func
(paren
op_amp
id|adapter-&gt;d_if
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
DECL|function|hfcpci_probe
r_static
r_int
id|__devinit
id|hfcpci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|DBG
c_func
(paren
id|DBG_INFO
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|adapter
op_assign
id|new_adapter
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter
)paren
r_goto
id|err
suffix:semicolon
id|retval
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err_free
suffix:semicolon
id|adapter-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|retval
op_assign
id|request_irq
c_func
(paren
id|adapter-&gt;irq
comma
id|hfcpci_irq
comma
id|SA_SHIRQ
comma
l_string|&quot;hfcpci&quot;
comma
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err_free
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
l_int|256
comma
l_string|&quot;hfcpci&quot;
)paren
)paren
r_goto
id|err_free_irq
suffix:semicolon
id|adapter-&gt;mmio
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
l_int|256
)paren
suffix:semicolon
singleline_comment|// XX pci_io
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;mmio
)paren
r_goto
id|err_release_region
suffix:semicolon
multiline_comment|/* Allocate 32K for FIFOs */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
l_int|0xffffffff
)paren
)paren
r_goto
id|err_unmap
suffix:semicolon
id|adapter-&gt;fifo
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
l_int|32768
comma
op_amp
id|adapter-&gt;fifo_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;fifo
)paren
r_goto
id|err_unmap
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|HFCPCI_MWBA
comma
(paren
id|u32
)paren
id|adapter-&gt;fifo_dma
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|adapter-&gt;l1m.fsm
op_assign
op_amp
id|l1fsm
suffix:semicolon
id|adapter-&gt;l1m.state
op_assign
id|ST_L1_F0
suffix:semicolon
macro_line|#ifdef CONFIG_HISAX_DEBUG
id|adapter-&gt;l1m.debug
op_assign
l_int|1
suffix:semicolon
macro_line|#else
id|adapter-&gt;l1m.debug
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|adapter-&gt;l1m.userdata
op_assign
id|adapter
suffix:semicolon
id|adapter-&gt;l1m.printdebug
op_assign
id|l1m_debug
suffix:semicolon
id|FsmInitTimer
c_func
(paren
op_amp
id|adapter-&gt;l1m
comma
op_amp
id|adapter-&gt;timer
)paren
suffix:semicolon
id|hfcpci_reset
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|hfcpci_hw_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hisax_hfcpci: found adapter %s at %s&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|ent-&gt;driver_data
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_unmap
suffix:colon
id|iounmap
c_func
(paren
id|adapter-&gt;mmio
)paren
suffix:semicolon
id|err_release_region
suffix:colon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
l_int|256
)paren
suffix:semicolon
id|err_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|adapter-&gt;irq
comma
id|adapter
)paren
suffix:semicolon
id|err_free
suffix:colon
id|delete_adapter
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|err
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|hfcpci_remove
r_static
r_void
id|__devexit
id|hfcpci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|hfcpci_adapter
op_star
id|adapter
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|hfcpci_reset
c_func
(paren
id|adapter
)paren
suffix:semicolon
singleline_comment|//&t;del_timer(&amp;cs-&gt;hw.hfcpci.timer); XX
multiline_comment|/* disable DMA */
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|HFCPCI_MWBA
comma
l_int|0
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
l_int|32768
comma
id|adapter-&gt;fifo
comma
id|adapter-&gt;fifo_dma
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|adapter-&gt;mmio
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
l_int|256
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|adapter-&gt;irq
comma
id|adapter
)paren
suffix:semicolon
id|delete_adapter
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
DECL|variable|hfcpci_driver
r_static
r_struct
id|pci_driver
id|hfcpci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;hfcpci&quot;
comma
dot
id|probe
op_assign
id|hfcpci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|hfcpci_remove
)paren
comma
dot
id|id_table
op_assign
id|hfcpci_ids
comma
)brace
suffix:semicolon
DECL|function|hisax_hfcpci_init
r_static
r_int
id|__init
id|hisax_hfcpci_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hisax_hfcpcipnp: HFC PCI ISDN driver v0.0.1&bslash;n&quot;
)paren
suffix:semicolon
id|l1fsm.state_count
op_assign
id|L1_STATE_COUNT
suffix:semicolon
id|l1fsm.event_count
op_assign
id|L1_EVENT_COUNT
suffix:semicolon
id|l1fsm.strState
op_assign
id|strL1State
suffix:semicolon
id|l1fsm.strEvent
op_assign
id|strL1Event
suffix:semicolon
id|retval
op_assign
id|FsmNew
c_func
(paren
op_amp
id|l1fsm
comma
id|L1FnList
comma
id|ARRAY_SIZE
c_func
(paren
id|L1FnList
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err
suffix:semicolon
id|retval
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|hfcpci_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err_fsm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_fsm
suffix:colon
id|FsmFree
c_func
(paren
op_amp
id|l1fsm
)paren
suffix:semicolon
id|err
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|hisax_hfcpci_exit
r_static
r_void
id|__exit
id|hisax_hfcpci_exit
c_func
(paren
r_void
)paren
(brace
id|FsmFree
c_func
(paren
op_amp
id|l1fsm
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|hfcpci_driver
)paren
suffix:semicolon
)brace
DECL|variable|hisax_hfcpci_init
id|module_init
c_func
(paren
id|hisax_hfcpci_init
)paren
suffix:semicolon
DECL|variable|hisax_hfcpci_exit
id|module_exit
c_func
(paren
id|hisax_hfcpci_exit
)paren
suffix:semicolon
eof
