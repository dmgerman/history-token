multiline_comment|/* $Id: w6692.c,v 1.12.6.6 2001/09/23 22:24:52 kai Exp $&n; *&n; * Winbond W6692 specific routines&n; *&n; * Author       Petr Novak&n; * Copyright    by Petr Novak        &lt;petr.novak@i.cz&gt;&n; * &n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;w6692.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
multiline_comment|/* table entry in the PCI devices list */
r_typedef
r_struct
(brace
DECL|member|vendor_id
r_int
id|vendor_id
suffix:semicolon
DECL|member|device_id
r_int
id|device_id
suffix:semicolon
DECL|member|vendor_name
r_char
op_star
id|vendor_name
suffix:semicolon
DECL|member|card_name
r_char
op_star
id|card_name
suffix:semicolon
DECL|typedef|PCI_ENTRY
)brace
id|PCI_ENTRY
suffix:semicolon
DECL|variable|id_list
r_static
r_const
id|PCI_ENTRY
id|id_list
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_WINBOND2
comma
id|PCI_DEVICE_ID_WINBOND2_6692
comma
l_string|&quot;Winbond&quot;
comma
l_string|&quot;W6692&quot;
)brace
comma
(brace
id|PCI_VENDOR_ID_DYNALINK
comma
id|PCI_DEVICE_ID_DYNALINK_IS64PH
comma
l_string|&quot;Dynalink/AsusCom&quot;
comma
l_string|&quot;IS64PH&quot;
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_string|&quot;U.S.Robotics&quot;
comma
l_string|&quot;ISDN PCI Card TA&quot;
)brace
)brace
suffix:semicolon
DECL|macro|W6692_SV_USR
mdefine_line|#define W6692_SV_USR   0x16ec
DECL|macro|W6692_SD_USR
mdefine_line|#define W6692_SD_USR   0x3409
DECL|macro|W6692_WINBOND
mdefine_line|#define W6692_WINBOND  0
DECL|macro|W6692_DYNALINK
mdefine_line|#define W6692_DYNALINK 1
DECL|macro|W6692_USR
mdefine_line|#define W6692_USR      2
r_extern
r_const
r_char
op_star
id|CardType
(braket
)braket
suffix:semicolon
DECL|variable|w6692_revision
r_const
r_char
op_star
id|w6692_revision
op_assign
l_string|&quot;$Revision: 1.12.6.6 $&quot;
suffix:semicolon
DECL|macro|DBUSY_TIMER_VALUE
mdefine_line|#define DBUSY_TIMER_VALUE 80
r_static
r_inline
id|u8
DECL|function|w6692_read_reg
id|w6692_read_reg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
id|offset
)paren
(brace
r_return
(paren
id|inb
c_func
(paren
id|cs-&gt;hw.w6692.iobase
op_plus
id|offset
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|w6692_write_reg
id|w6692_write_reg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
id|offset
comma
id|u8
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.w6692.iobase
op_plus
id|offset
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|w6692_read_fifo
id|w6692_read_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|insb
c_func
(paren
id|cs-&gt;hw.w6692.iobase
op_plus
id|W_D_RFIFO
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|w6692_write_fifo
id|w6692_write_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|outsb
c_func
(paren
id|cs-&gt;hw.w6692.iobase
op_plus
id|W_D_XFIFO
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
DECL|variable|w6692_dc_hw_ops
r_static
r_struct
id|dc_hw_ops
id|w6692_dc_hw_ops
op_assign
(brace
dot
id|read_fifo
op_assign
id|w6692_read_fifo
comma
)brace
suffix:semicolon
r_static
r_inline
id|u8
DECL|function|w6692_bc_read_reg
id|w6692_bc_read_reg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|bchan
comma
id|u8
id|offset
)paren
(brace
r_return
(paren
id|inb
c_func
(paren
id|cs-&gt;hw.w6692.iobase
op_plus
(paren
id|bchan
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
op_plus
id|offset
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|w6692_bc_write_reg
id|w6692_bc_write_reg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|bchan
comma
id|u8
id|offset
comma
id|u8
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.w6692.iobase
op_plus
(paren
id|bchan
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
op_plus
id|offset
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|w6692_bc_read_fifo
id|w6692_bc_read_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|bchan
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
id|insb
c_func
(paren
id|cs-&gt;hw.w6692.iobase
op_plus
id|W_B_RFIFO
op_plus
(paren
id|bchan
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
comma
id|data
comma
id|len
)paren
suffix:semicolon
)brace
DECL|variable|w6692_bc_hw_ops
r_static
r_struct
id|bc_hw_ops
id|w6692_bc_hw_ops
op_assign
(brace
dot
id|read_fifo
op_assign
id|w6692_bc_read_fifo
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
op_star
id|W6692Ver
(braket
)braket
id|__initdata
op_assign
(brace
l_string|&quot;W6692 V00&quot;
comma
l_string|&quot;W6692 V01&quot;
comma
l_string|&quot;W6692 V10&quot;
comma
l_string|&quot;W6692 V11&quot;
)brace
suffix:semicolon
r_static
r_void
DECL|function|W6692Version
id|W6692Version
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_char
op_star
id|s
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_RBCH
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Winbond W6692 version (%x): %s&bslash;n&quot;
comma
id|s
comma
id|val
comma
id|W6692Ver
(braket
(paren
id|val
op_rshift
l_int|6
)paren
op_amp
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ph_command
id|ph_command
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
r_int
id|command
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ph_command %x&quot;
comma
id|command
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_CIX
comma
id|command
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692_new_ph
id|W6692_new_ph
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_switch
c_cond
(paren
id|cs-&gt;dc.w6692.ph_state
)paren
(brace
r_case
(paren
id|W_L1CMD_RST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_DRC
)paren
suffix:semicolon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_RESET
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* fallthru */
r_case
(paren
id|W_L1IND_CD
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_DRD
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_DEACTIVATE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_CE
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_POWERUP
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_LD
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_RSYNC
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_ARD
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_INFO2
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_AI8
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_INFO4_P8
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|W_L1IND_AI10
)paren
suffix:colon
id|l1_msg
c_func
(paren
id|cs
comma
id|HW_INFO4_P10
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|W6692_bh
id|W6692_bh
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|data
suffix:semicolon
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_CLEARBUSY
comma
op_amp
id|cs-&gt;event
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy cleared&quot;
)paren
suffix:semicolon
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
id|L1L2
c_func
(paren
id|stptr
comma
id|PH_PAUSE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_L1STATECHANGE
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|W6692_new_ph
c_func
(paren
id|cs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_RCVBUFREADY
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|DChannel_proc_rcv
c_func
(paren
id|cs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|D_XMTBUFREADY
comma
op_amp
id|cs-&gt;event
)paren
)paren
id|DChannel_proc_xmt
c_func
(paren
id|cs
)paren
suffix:semicolon
multiline_comment|/*&n;   if (test_and_clear_bit(D_RX_MON1, &amp;cs-&gt;event))&n;   arcofi_fsm(cs, ARCOFI_RX_END, NULL);&n;   if (test_and_clear_bit(D_TX_MON1, &amp;cs-&gt;event))&n;   arcofi_fsm(cs, ARCOFI_TX_END, NULL);&n; */
)brace
r_static
r_void
DECL|function|W6692_empty_fifo
id|W6692_empty_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|count
)paren
(brace
id|recv_empty_fifo_d
c_func
(paren
id|cs
comma
id|count
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|W_D_CMDR_RACK
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692_fill_fifo
id|W6692_fill_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_int
id|count
comma
id|more
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xmit_fill_fifo_d
c_func
(paren
id|cs
comma
id|W_D_FIFO_THRESH
comma
op_amp
id|count
comma
op_amp
id|more
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
id|w6692_write_fifo
c_func
(paren
id|cs
comma
id|p
comma
id|count
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|more
ques
c_cond
id|W_D_CMDR_XMS
suffix:colon
(paren
id|W_D_CMDR_XMS
op_or
id|W_D_CMDR_XME
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692_fill_fifo dbusytimer running&quot;
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
id|cs-&gt;dbusytimer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
id|DBUSY_TIMER_VALUE
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692B_empty_fifo
id|W6692B_empty_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|count
)paren
(brace
id|recv_empty_fifo_b
c_func
(paren
id|bcs
comma
id|count
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|W_B_CMDR
comma
id|W_B_CMDR_RACK
op_or
id|W_B_CMDR_RACT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692B_fill_fifo
id|W6692B_fill_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|more
comma
id|count
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xmit_fill_fifo_b
c_func
(paren
id|bcs
comma
id|W_B_FIFO_THRESH
comma
op_amp
id|count
comma
op_amp
id|more
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
id|WRITEW6692BFIFO
c_func
(paren
id|cs
comma
id|bcs-&gt;channel
comma
id|p
comma
id|count
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bcs-&gt;channel
comma
id|W_B_CMDR
comma
id|W_B_CMDR_RACT
op_or
id|W_B_CMDR_XMS
op_or
(paren
id|more
ques
c_cond
l_int|0
suffix:colon
id|W_B_CMDR_XME
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|reset_xmit
id|reset_xmit
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|w6692_bc_write_reg
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|W_B_CMDR
comma
id|W_B_CMDR_XRST
op_or
id|W_B_CMDR_RACT
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692B_interrupt
id|W6692B_interrupt
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
id|bchan
)paren
(brace
id|u8
id|val
suffix:semicolon
id|u8
id|r
suffix:semicolon
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
r_int
id|count
suffix:semicolon
id|bcs
op_assign
(paren
id|cs-&gt;bcs-&gt;channel
op_eq
id|bchan
)paren
ques
c_cond
id|cs-&gt;bcs
suffix:colon
(paren
id|cs-&gt;bcs
op_plus
l_int|1
)paren
suffix:semicolon
id|val
op_assign
id|w6692_bc_read_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_EXIR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692B chan %d B_EXIR 0x%02X&quot;
comma
id|bchan
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|BC_FLG_INIT
comma
op_amp
id|bcs-&gt;Flag
)paren
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692B not INIT yet&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_B_EXI_RME
)paren
(brace
multiline_comment|/* RME */
id|r
op_assign
id|w6692_bc_read_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_STAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
(paren
id|W_B_STAR_RDOV
op_or
id|W_B_STAR_CRCE
op_or
id|W_B_STAR_RMB
op_or
id|W_B_STAR_XDOW
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|r
op_amp
id|W_B_STAR_RDOV
)paren
op_logical_and
id|bcs-&gt;mode
)paren
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 B RDOV mode=%d&quot;
comma
id|bcs-&gt;mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
id|W_B_STAR_CRCE
)paren
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 B CRC error&quot;
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_CMDR
comma
id|W_B_CMDR_RACK
op_or
id|W_B_CMDR_RRST
op_or
id|W_B_CMDR_RACT
)paren
suffix:semicolon
id|bcs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|w6692_bc_read_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_RBCL
)paren
op_amp
(paren
id|W_B_FIFO_THRESH
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|count
op_assign
id|W_B_FIFO_THRESH
suffix:semicolon
id|W6692B_empty_fifo
c_func
(paren
id|bcs
comma
id|count
)paren
suffix:semicolon
id|recv_rme_b
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_B_EXI_RMR
)paren
(brace
multiline_comment|/* RMR */
id|W6692B_empty_fifo
c_func
(paren
id|bcs
comma
id|W_B_FIFO_THRESH
)paren
suffix:semicolon
id|recv_rpf_b
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_B_EXI_XFR
)paren
(brace
multiline_comment|/* XFR */
id|xmit_xpr_b
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_B_EXI_XDUN
)paren
(brace
multiline_comment|/* XDUN */
id|xmit_xdu_b
c_func
(paren
id|bcs
comma
id|reset_xmit
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|w6692_interrupt
id|w6692_interrupt
c_func
(paren
r_int
id|intno
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|dev_id
suffix:semicolon
id|u8
id|val
comma
id|exval
comma
id|v1
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_int
id|icnt
op_assign
l_int|5
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cs-&gt;lock
)paren
suffix:semicolon
id|val
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_ISTA
)paren
suffix:semicolon
id|StartW6692
suffix:colon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 ISTA %x&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_D_RME
)paren
(brace
multiline_comment|/* RME */
id|exval
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_RSTA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
(paren
id|W_D_RSTA_RDOV
op_or
id|W_D_RSTA_CRCE
op_or
id|W_D_RSTA_RMB
)paren
)paren
(brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_RSTA_RDOV
)paren
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 RDOV&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_RSTA_CRCE
)paren
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 D-channel CRC error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_RSTA_RMB
)paren
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 D-channel ABORT&quot;
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|W_D_CMDR_RACK
op_or
id|W_D_CMDR_RRST
)paren
suffix:semicolon
id|cs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_RBCL
)paren
op_amp
(paren
id|W_D_FIFO_THRESH
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|count
op_assign
id|W_D_FIFO_THRESH
suffix:semicolon
id|W6692_empty_fifo
c_func
(paren
id|cs
comma
id|count
)paren
suffix:semicolon
id|recv_rme_d
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_D_RMR
)paren
(brace
multiline_comment|/* RMR */
id|W6692_empty_fifo
c_func
(paren
id|cs
comma
id|W_D_FIFO_THRESH
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_D_XFR
)paren
(brace
multiline_comment|/* XFR */
id|xmit_xpr_d
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
(paren
id|W_INT_XINT0
op_or
id|W_INT_XINT1
)paren
)paren
(brace
multiline_comment|/* XINT0/1 - never */
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 spurious XINT!&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_D_EXI
)paren
(brace
multiline_comment|/* EXI */
id|exval
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_EXIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 D_EXIR %02x&quot;
comma
id|exval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exval
op_amp
(paren
id|W_D_EXI_XDUN
op_or
id|W_D_EXI_XCOL
)paren
)paren
(brace
multiline_comment|/* Transmit underrun/collision */
id|xmit_xdu_d
c_func
(paren
id|cs
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_RDOV
)paren
(brace
multiline_comment|/* RDOV */
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 D-channel RDOV&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: W6692 D-RDOV&bslash;n&quot;
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|W_D_CMDR_RRST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_TIN2
)paren
(brace
multiline_comment|/* TIN2 - never */
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 spurious TIN2 interrupt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_MOC
)paren
(brace
multiline_comment|/* MOC - not supported */
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 spurious MOC interrupt&quot;
)paren
suffix:semicolon
id|v1
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_MOSR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 MOSR %02x&quot;
comma
id|v1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_ISC
)paren
(brace
multiline_comment|/* ISC - Level1 change */
id|v1
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_CIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 ISC CIR=0x%02X&quot;
comma
id|v1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v1
op_amp
id|W_CIR_ICC
)paren
(brace
id|cs-&gt;dc.w6692.ph_state
op_assign
id|v1
op_amp
id|W_CIR_COD_MASK
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_ISAC
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;ph_state_change %x&quot;
comma
id|cs-&gt;dc.w6692.ph_state
)paren
suffix:semicolon
id|sched_d_event
c_func
(paren
id|cs
comma
id|D_L1STATECHANGE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v1
op_amp
id|W_CIR_SCC
)paren
(brace
id|v1
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_SQR
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 SCC SQR=0x%02X&quot;
comma
id|v1
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_WEXP
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 spurious WEXP interrupt!&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|exval
op_amp
id|W_D_EXI_TEXP
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 spurious TEXP interrupt!&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_B1_EXI
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 B channel 1 interrupt&quot;
)paren
suffix:semicolon
id|W6692B_interrupt
c_func
(paren
id|cs
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
id|W_INT_B2_EXI
)paren
(brace
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692 B channel 2 interrupt&quot;
)paren
suffix:semicolon
id|W6692B_interrupt
c_func
(paren
id|cs
comma
l_int|1
)paren
suffix:semicolon
)brace
id|val
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_ISTA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_logical_and
id|icnt
)paren
(brace
id|icnt
op_decrement
suffix:semicolon
r_goto
id|StartW6692
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|icnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;W6692 IRQ LOOP&bslash;n&quot;
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_IMASK
comma
l_int|0xff
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cs-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692_l1hw
id|W6692_l1hw
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
(paren
r_struct
id|IsdnCardState
op_star
)paren
id|st-&gt;l1.hardware
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_int
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_data_req_d
c_func
(paren
id|cs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
id|xmit_pull_ind_d
c_func
(paren
id|cs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_pull_req_d
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_RESET
op_or
id|REQUEST
)paren
suffix:colon
r_if
c_cond
(paren
(paren
id|cs-&gt;dc.w6692.ph_state
op_eq
id|W_L1IND_DRD
)paren
)paren
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_ECK
)paren
suffix:semicolon
r_else
(brace
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_RST
)paren
suffix:semicolon
id|cs-&gt;dc.w6692.ph_state
op_assign
id|W_L1CMD_RST
suffix:semicolon
id|W6692_new_ph
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|HW_ENABLE
op_or
id|REQUEST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_ECK
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_INFO3
op_or
id|REQUEST
)paren
suffix:colon
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_AR8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|HW_TESTLOOP
op_or
id|REQUEST
)paren
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_amp
(paren
r_int
)paren
id|arg
)paren
id|val
op_or_assign
l_int|0x0c
suffix:semicolon
r_if
c_cond
(paren
l_int|2
op_amp
(paren
r_int
)paren
id|arg
)paren
id|val
op_or_assign
l_int|0x3
suffix:semicolon
multiline_comment|/* !!! not implemented yet */
r_break
suffix:semicolon
r_case
(paren
id|HW_DEACTIVATE
op_or
id|RESPONSE
)paren
suffix:colon
id|skb_queue_purge
c_func
(paren
op_amp
id|cs-&gt;rq
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|cs-&gt;sq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|cs-&gt;tx_skb
)paren
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|cs-&gt;dbusytimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
id|sched_d_event
c_func
(paren
id|cs
comma
id|D_CLEARBUSY
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_WARN
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;W6692_l1hw unknown %04x&quot;
comma
id|pr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|setstack_W6692
id|setstack_W6692
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|st-&gt;l1.l1hw
op_assign
id|W6692_l1hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|dbusy_timer_handler
id|dbusy_timer_handler
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
r_struct
id|PStack
op_star
id|stptr
suffix:semicolon
r_int
id|rbch
comma
id|star
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
)paren
(brace
id|rbch
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_RBCH
)paren
suffix:semicolon
id|star
op_assign
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_STAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy D_RBCH %02x D_STAR %02x&quot;
comma
id|rbch
comma
id|star
)paren
suffix:semicolon
r_if
c_cond
(paren
id|star
op_amp
id|W_D_STAR_XBZ
)paren
(brace
multiline_comment|/* D-Channel Busy */
id|test_and_set_bit
c_func
(paren
id|FLG_L1_DBUSY
comma
op_amp
id|cs-&gt;HW_Flags
)paren
suffix:semicolon
id|stptr
op_assign
id|cs-&gt;stlist
suffix:semicolon
r_while
c_loop
(paren
id|stptr
op_ne
l_int|NULL
)paren
(brace
id|L1L2
c_func
(paren
id|stptr
comma
id|PH_PAUSE
op_or
id|INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
id|stptr
op_assign
id|stptr-&gt;next
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* discard frame; reset transceiver */
id|test_and_clear_bit
c_func
(paren
id|FLG_DBUSY_TIMER
comma
op_amp
id|cs-&gt;HW_Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;tx_skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|cs-&gt;tx_skb
)paren
suffix:semicolon
id|cs-&gt;tx_cnt
op_assign
l_int|0
suffix:semicolon
id|cs-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: W6692 D-Channel Busy no skb&bslash;n&quot;
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;D-Channel Busy no skb&quot;
)paren
suffix:semicolon
)brace
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|W_D_CMDR_XRST
)paren
suffix:semicolon
multiline_comment|/* Transmitter reset */
id|cs-&gt;card_ops
op_member_access_from_pointer
id|irq_func
c_func
(paren
id|cs-&gt;irq
comma
id|cs
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* FIXME? */
)brace
)brace
)brace
r_static
r_void
DECL|function|W6692Bmode
id|W6692Bmode
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bchan
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;w6692 %c mode %d ichan %d&quot;
comma
l_char|&squot;1&squot;
op_plus
id|bchan
comma
id|mode
comma
id|bchan
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bchan
suffix:semicolon
id|bcs-&gt;hw.w6692.bchan
op_assign
id|bchan
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
(paren
id|L1_MODE_NULL
)paren
suffix:colon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_MODE
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_TRANS
)paren
suffix:colon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_MODE
comma
id|W_B_MODE_MMS
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_HDLC
)paren
suffix:colon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_MODE
comma
id|W_B_MODE_ITF
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_ADM1
comma
l_int|0xff
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_ADM2
comma
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
)paren
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_CMDR
comma
id|W_B_CMDR_RRST
op_or
id|W_B_CMDR_RACT
op_or
id|W_B_CMDR_XRST
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
id|bchan
comma
id|W_B_EXIM
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|W6692_l2l1
id|W6692_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_data_req_b
c_func
(paren
id|st-&gt;l1.bcs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
id|xmit_pull_ind_b
c_func
(paren
id|st-&gt;l1.bcs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_pull_req_b
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|W6692Bmode
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|W6692Bmode
c_func
(paren
id|st-&gt;l1.bcs
comma
l_int|0
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|L1L2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|close_w6692state
id|close_w6692state
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|W6692Bmode
c_func
(paren
id|bcs
comma
l_int|0
comma
id|bcs-&gt;channel
)paren
suffix:semicolon
id|bc_close
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|open_w6692state
id|open_w6692state
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_return
id|bc_open
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|setstack_w6692
id|setstack_w6692
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
r_if
c_cond
(paren
id|open_w6692state
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l1.l2l1
op_assign
id|W6692_l2l1
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|w6692_reset
id|w6692_reset
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CTL
comma
id|W_D_CTL_SRST
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CTL
comma
l_int|0x00
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_IMASK
comma
l_int|0xff
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_SAM
comma
l_int|0xff
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_TAM
comma
l_int|0xff
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_EXIM
comma
l_int|0x00
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_MODE
comma
id|W_D_MODE_RACT
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_IMASK
comma
l_int|0x18
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|W6692_USR
)paren
(brace
multiline_comment|/* seems that USR implemented some power control features&n;&t;&t; * Pin 79 is connected to the oscilator circuit so we&n;&t;&t; * have to handle it here&n;&t;&t; */
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_PCTL
comma
l_int|0x80
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_XDATA
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|w6692_init
id|w6692_init
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|w6692_reset
c_func
(paren
id|cs
)paren
suffix:semicolon
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_RST
)paren
suffix:semicolon
id|cs-&gt;dc.w6692.ph_state
op_assign
id|W_L1CMD_RST
suffix:semicolon
id|W6692_new_ph
c_func
(paren
id|cs
)paren
suffix:semicolon
id|ph_command
c_func
(paren
id|cs
comma
id|W_L1CMD_ECK
)paren
suffix:semicolon
id|W6692Bmode
c_func
(paren
id|cs-&gt;bcs
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|W6692Bmode
c_func
(paren
id|cs-&gt;bcs
op_plus
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Reenable all IRQ */
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_IMASK
comma
l_int|0x18
)paren
suffix:semicolon
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_EXIM
comma
l_int|0x00
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
l_int|0
comma
id|W_B_EXIM
comma
l_int|0x00
)paren
suffix:semicolon
id|w6692_bc_write_reg
c_func
(paren
id|cs
comma
l_int|1
comma
id|W_B_EXIM
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Reset D-chan receiver and transmitter */
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_D_CMDR
comma
id|W_D_CMDR_RRST
op_or
id|W_D_CMDR_XRST
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|w6692_release
id|w6692_release
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_IMASK
comma
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|W6692_USR
)paren
id|w6692_write_reg
c_func
(paren
id|cs
comma
id|W_XDATA
comma
l_int|0x04
)paren
suffix:semicolon
id|hisax_release_resources
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|w6692_card_msg
id|w6692_card_msg
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|mt
comma
r_void
op_star
id|arg
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|w6692_ops
r_static
r_struct
id|card_ops
id|w6692_ops
op_assign
(brace
dot
id|init
op_assign
id|w6692_init
comma
dot
id|reset
op_assign
id|w6692_reset
comma
dot
id|release
op_assign
id|w6692_release
comma
dot
id|irq_func
op_assign
id|w6692_interrupt
comma
)brace
suffix:semicolon
DECL|variable|w6692_dc_l1_ops
r_static
r_struct
id|dc_l1_ops
id|w6692_dc_l1_ops
op_assign
(brace
dot
id|fill_fifo
op_assign
id|W6692_fill_fifo
comma
dot
id|open
op_assign
id|setstack_W6692
comma
dot
id|bh_func
op_assign
id|W6692_bh
comma
dot
id|dbusy_func
op_assign
id|dbusy_timer_handler
comma
)brace
suffix:semicolon
DECL|variable|w6692_bc_l1_ops
r_static
r_struct
id|bc_l1_ops
id|w6692_bc_l1_ops
op_assign
(brace
dot
id|fill_fifo
op_assign
id|W6692B_fill_fifo
comma
dot
id|open
op_assign
id|setstack_w6692
comma
dot
id|close
op_assign
id|close_w6692state
comma
)brace
suffix:semicolon
DECL|variable|id_idx
r_static
r_int
id|id_idx
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pci_dev
op_star
id|dev_w6692
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
r_int
id|__init
DECL|function|setup_w6692
id|setup_w6692
c_func
(paren
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|card-&gt;cs
suffix:semicolon
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
id|u8
id|found
op_assign
l_int|0
suffix:semicolon
id|u8
id|pci_irq
op_assign
l_int|0
suffix:semicolon
id|u_int
id|pci_ioaddr
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
macro_line|#error &quot;not running on big endian machines now&quot;
macro_line|#endif
id|strcpy
c_func
(paren
id|tmp
comma
id|w6692_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: W6692 driver Rev. %s&bslash;n&quot;
comma
id|HiSax_getrev
c_func
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;typ
op_ne
id|ISDN_CTYPE_W6692
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#if CONFIG_PCI
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;W6692: no PCI bus present&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|id_list
(braket
id|id_idx
)braket
dot
id|vendor_id
)paren
(brace
id|dev_w6692
op_assign
id|pci_find_device
c_func
(paren
id|id_list
(braket
id|id_idx
)braket
dot
id|vendor_id
comma
id|id_list
(braket
id|id_idx
)braket
dot
id|device_id
comma
id|dev_w6692
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_w6692
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev_w6692
)paren
)paren
r_continue
suffix:semicolon
id|cs-&gt;subtyp
op_assign
id|id_idx
suffix:semicolon
r_break
suffix:semicolon
)brace
id|id_idx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_w6692
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|pci_irq
op_assign
id|dev_w6692-&gt;irq
suffix:semicolon
multiline_comment|/* I think address 0 is allways the configuration area */
multiline_comment|/* and address 1 is the real IO space KKe 03.09.99 */
id|pci_ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|dev_w6692
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* USR ISDN PCI card TA need some special handling */
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|W6692_WINBOND
)paren
(brace
r_if
c_cond
(paren
(paren
id|W6692_SV_USR
op_eq
id|dev_w6692-&gt;subsystem_vendor
)paren
op_logical_and
(paren
id|W6692_SD_USR
op_eq
id|dev_w6692-&gt;subsystem_device
)paren
)paren
(brace
id|cs-&gt;subtyp
op_assign
id|W6692_USR
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;W6692: No PCI card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|cs-&gt;irq
op_assign
id|pci_irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cs-&gt;irq
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;W6692: No IRQ for PCI card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pci_ioaddr
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;W6692: NO I/O Base Address found&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|cs-&gt;hw.w6692.iobase
op_assign
id|pci_ioaddr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Found: %s %s, I/O base: 0x%x, irq: %d&bslash;n&quot;
comma
id|id_list
(braket
id|cs-&gt;subtyp
)braket
dot
id|vendor_name
comma
id|id_list
(braket
id|cs-&gt;subtyp
)braket
dot
id|card_name
comma
id|pci_ioaddr
comma
id|pci_irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_io
c_func
(paren
op_amp
id|cs-&gt;rs
comma
id|cs-&gt;hw.w6692.iobase
comma
l_int|0x100
comma
id|id_list
(braket
id|cs-&gt;subtyp
)braket
dot
id|card_name
)paren
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: W6692 and NO_PCI_BIOS&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;HiSax: W6692 unable to config&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_PCI */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: %s config irq:%d I/O:%x&bslash;n&quot;
comma
id|id_list
(braket
id|cs-&gt;subtyp
)braket
dot
id|card_name
comma
id|cs-&gt;irq
comma
id|cs-&gt;hw.w6692.iobase
)paren
suffix:semicolon
id|cs-&gt;dc_hw_ops
op_assign
op_amp
id|w6692_dc_hw_ops
suffix:semicolon
id|cs-&gt;bc_hw_ops
op_assign
op_amp
id|w6692_bc_hw_ops
suffix:semicolon
id|dc_l1_init
c_func
(paren
id|cs
comma
op_amp
id|w6692_dc_l1_ops
)paren
suffix:semicolon
id|cs-&gt;bc_l1_ops
op_assign
op_amp
id|w6692_bc_l1_ops
suffix:semicolon
id|cs-&gt;cardmsg
op_assign
op_amp
id|w6692_card_msg
suffix:semicolon
id|cs-&gt;irq_flags
op_or_assign
id|SA_SHIRQ
suffix:semicolon
id|cs-&gt;card_ops
op_assign
op_amp
id|w6692_ops
suffix:semicolon
id|W6692Version
c_func
(paren
id|cs
comma
l_string|&quot;W6692:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;W6692 ISTA=0x%X&bslash;n&quot;
comma
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_ISTA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;W6692 IMASK=0x%X&bslash;n&quot;
comma
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_IMASK
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;W6692 D_EXIR=0x%X&bslash;n&quot;
comma
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_EXIR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;W6692 D_EXIM=0x%X&bslash;n&quot;
comma
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_EXIM
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;W6692 D_RSTA=0x%X&bslash;n&quot;
comma
id|w6692_read_reg
c_func
(paren
id|cs
comma
id|W_D_RSTA
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
eof
