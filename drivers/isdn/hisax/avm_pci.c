multiline_comment|/* $Id: avm_pci.c,v 1.22.6.6 2001/09/23 22:24:46 kai Exp $&n; *&n; * low level stuff for AVM Fritz!PCI and ISA PnP isdn cards&n; *&n; * Author       Karsten Keil&n; * Copyright    by Karsten Keil      &lt;keil@isdn4linux.de&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; * Thanks to AVM, Berlin for information&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hisax.h&quot;
macro_line|#include &quot;isac.h&quot;
macro_line|#include &quot;isdnl1.h&quot;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
r_extern
r_const
r_char
op_star
id|CardType
(braket
)braket
suffix:semicolon
DECL|variable|avm_pci_rev
r_static
r_const
r_char
op_star
id|avm_pci_rev
op_assign
l_string|&quot;$Revision: 1.22.6.6 $&quot;
suffix:semicolon
DECL|variable|avm_pci_lock
r_static
id|spinlock_t
id|avm_pci_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|AVM_FRITZ_PCI
mdefine_line|#define  AVM_FRITZ_PCI&t;&t;1
DECL|macro|AVM_FRITZ_PNP
mdefine_line|#define  AVM_FRITZ_PNP&t;&t;2
DECL|macro|HDLC_FIFO
mdefine_line|#define  HDLC_FIFO&t;&t;0x0
DECL|macro|HDLC_STATUS
mdefine_line|#define  HDLC_STATUS&t;&t;0x4
DECL|macro|AVM_HDLC_1
mdefine_line|#define&t; AVM_HDLC_1&t;&t;0x00
DECL|macro|AVM_HDLC_2
mdefine_line|#define&t; AVM_HDLC_2&t;&t;0x01
DECL|macro|AVM_ISAC_FIFO
mdefine_line|#define&t; AVM_ISAC_FIFO&t;&t;0x02
DECL|macro|AVM_ISAC_REG_LOW
mdefine_line|#define&t; AVM_ISAC_REG_LOW&t;0x04
DECL|macro|AVM_ISAC_REG_HIGH
mdefine_line|#define&t; AVM_ISAC_REG_HIGH&t;0x06
DECL|macro|AVM_STATUS0_IRQ_ISAC
mdefine_line|#define  AVM_STATUS0_IRQ_ISAC&t;0x01
DECL|macro|AVM_STATUS0_IRQ_HDLC
mdefine_line|#define  AVM_STATUS0_IRQ_HDLC&t;0x02
DECL|macro|AVM_STATUS0_IRQ_TIMER
mdefine_line|#define  AVM_STATUS0_IRQ_TIMER&t;0x04
DECL|macro|AVM_STATUS0_IRQ_MASK
mdefine_line|#define  AVM_STATUS0_IRQ_MASK&t;0x07
DECL|macro|AVM_STATUS0_RESET
mdefine_line|#define  AVM_STATUS0_RESET&t;0x01
DECL|macro|AVM_STATUS0_DIS_TIMER
mdefine_line|#define  AVM_STATUS0_DIS_TIMER&t;0x02
DECL|macro|AVM_STATUS0_RES_TIMER
mdefine_line|#define  AVM_STATUS0_RES_TIMER&t;0x04
DECL|macro|AVM_STATUS0_ENA_IRQ
mdefine_line|#define  AVM_STATUS0_ENA_IRQ&t;0x08
DECL|macro|AVM_STATUS0_TESTBIT
mdefine_line|#define  AVM_STATUS0_TESTBIT&t;0x10
DECL|macro|AVM_STATUS1_INT_SEL
mdefine_line|#define  AVM_STATUS1_INT_SEL&t;0x0f
DECL|macro|AVM_STATUS1_ENA_IOM
mdefine_line|#define  AVM_STATUS1_ENA_IOM&t;0x80
DECL|macro|HDLC_MODE_ITF_FLG
mdefine_line|#define  HDLC_MODE_ITF_FLG&t;0x01
DECL|macro|HDLC_MODE_TRANS
mdefine_line|#define  HDLC_MODE_TRANS&t;0x02
DECL|macro|HDLC_MODE_CCR_7
mdefine_line|#define  HDLC_MODE_CCR_7&t;0x04
DECL|macro|HDLC_MODE_CCR_16
mdefine_line|#define  HDLC_MODE_CCR_16&t;0x08
DECL|macro|HDLC_MODE_TESTLOOP
mdefine_line|#define  HDLC_MODE_TESTLOOP&t;0x80
DECL|macro|HDLC_INT_XPR
mdefine_line|#define  HDLC_INT_XPR&t;&t;0x80
DECL|macro|HDLC_INT_XDU
mdefine_line|#define  HDLC_INT_XDU&t;&t;0x40
DECL|macro|HDLC_INT_RPR
mdefine_line|#define  HDLC_INT_RPR&t;&t;0x20
DECL|macro|HDLC_INT_MASK
mdefine_line|#define  HDLC_INT_MASK&t;&t;0xE0
DECL|macro|HDLC_STAT_RME
mdefine_line|#define  HDLC_STAT_RME&t;&t;0x01
DECL|macro|HDLC_STAT_RDO
mdefine_line|#define  HDLC_STAT_RDO&t;&t;0x10
DECL|macro|HDLC_STAT_CRCVFRRAB
mdefine_line|#define  HDLC_STAT_CRCVFRRAB&t;0x0E
DECL|macro|HDLC_STAT_CRCVFR
mdefine_line|#define  HDLC_STAT_CRCVFR&t;0x06
DECL|macro|HDLC_STAT_RML_MASK
mdefine_line|#define  HDLC_STAT_RML_MASK&t;0x3f00
DECL|macro|HDLC_CMD_XRS
mdefine_line|#define  HDLC_CMD_XRS&t;&t;0x80
DECL|macro|HDLC_CMD_XME
mdefine_line|#define  HDLC_CMD_XME&t;&t;0x01
DECL|macro|HDLC_CMD_RRS
mdefine_line|#define  HDLC_CMD_RRS&t;&t;0x20
DECL|macro|HDLC_CMD_XML_MASK
mdefine_line|#define  HDLC_CMD_XML_MASK&t;0x3f00
multiline_comment|/* Interface functions */
r_static
id|u8
DECL|function|ReadISAC
id|ReadISAC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
id|offset
)paren
(brace
id|u8
id|idx
op_assign
(paren
id|offset
OG
l_int|0x2f
)paren
ques
c_cond
id|AVM_ISAC_REG_HIGH
suffix:colon
id|AVM_ISAC_REG_LOW
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
(paren
id|offset
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WriteISAC
id|WriteISAC
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
id|offset
comma
id|u8
id|value
)paren
(brace
id|u8
id|idx
op_assign
(paren
id|offset
OG
l_int|0x2f
)paren
ques
c_cond
id|AVM_ISAC_REG_HIGH
suffix:colon
id|AVM_ISAC_REG_LOW
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
(paren
id|offset
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ReadISACfifo
id|ReadISACfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|outb
c_func
(paren
id|AVM_ISAC_FIFO
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|insb
c_func
(paren
id|cs-&gt;hw.avm.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|WriteISACfifo
id|WriteISACfifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
id|u8
op_star
id|data
comma
r_int
id|size
)paren
(brace
id|outb
c_func
(paren
id|AVM_ISAC_FIFO
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outsb
c_func
(paren
id|cs-&gt;hw.avm.isac
comma
id|data
comma
id|size
)paren
suffix:semicolon
)brace
DECL|variable|isac_ops
r_static
r_struct
id|dc_hw_ops
id|isac_ops
op_assign
(brace
dot
id|read_reg
op_assign
id|ReadISAC
comma
dot
id|write_reg
op_assign
id|WriteISAC
comma
dot
id|read_fifo
op_assign
id|ReadISACfifo
comma
dot
id|write_fifo
op_assign
id|WriteISACfifo
comma
)brace
suffix:semicolon
r_static
r_inline
id|u_int
DECL|function|ReadHDLCPCI
id|ReadHDLCPCI
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u8
id|offset
)paren
(brace
id|u_int
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
id|u_int
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|WriteHDLCPCI
id|WriteHDLCPCI
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u8
id|offset
comma
id|u_int
id|value
)paren
(brace
id|u_int
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outl
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u8
DECL|function|ReadHDLCPnP
id|ReadHDLCPnP
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u8
id|offset
)paren
(brace
id|u8
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|WriteHDLCPnP
id|WriteHDLCPnP
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|chan
comma
id|u8
id|offset
comma
id|u8
id|value
)paren
(brace
id|u8
id|idx
op_assign
id|chan
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|cs-&gt;hw.avm.isac
op_plus
id|offset
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|avm_pci_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hdlc_read_fifo
id|hdlc_read_fifo
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|hscx
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
id|u8
id|idx
op_assign
id|hscx
ques
c_cond
id|AVM_HDLC_2
suffix:colon
id|AVM_HDLC_1
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|u32
op_star
id|ptr
op_assign
(paren
id|u32
op_star
)paren
id|data
suffix:semicolon
id|outl
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
macro_line|#ifdef __powerpc__
macro_line|#ifdef CONFIG_APUS
op_star
id|ptr
op_increment
op_assign
id|in_le32
c_func
(paren
(paren
id|u32
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
macro_line|#else
op_star
id|ptr
op_increment
op_assign
id|in_be32
c_func
(paren
(paren
id|u32
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_APUS */
macro_line|#else
op_star
id|ptr
op_increment
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
macro_line|#endif /* __powerpc__ */
)brace
)brace
r_else
(brace
id|outb
c_func
(paren
id|idx
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|data
op_increment
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|variable|hdlc_hw_ops
r_static
r_struct
id|bc_hw_ops
id|hdlc_hw_ops
op_assign
(brace
dot
id|read_fifo
op_assign
id|hdlc_read_fifo
comma
)brace
suffix:semicolon
r_static
r_inline
DECL|function|Sel_BCS
r_struct
id|BCState
op_star
id|Sel_BCS
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|mode
op_logical_and
(paren
id|cs-&gt;bcs
(braket
l_int|0
)braket
dot
id|channel
op_eq
id|channel
)paren
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|0
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|mode
op_logical_and
(paren
id|cs-&gt;bcs
(braket
l_int|1
)braket
dot
id|channel
op_eq
id|channel
)paren
)paren
r_return
op_amp
id|cs-&gt;bcs
(braket
l_int|1
)braket
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
r_void
DECL|function|write_ctrl
id|write_ctrl
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|which
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;hdlc %c wr%x ctrl %x&quot;
comma
l_char|&squot;A&squot;
op_plus
id|bcs-&gt;channel
comma
id|which
comma
id|bcs-&gt;hw.hdlc.ctrl.ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|WriteHDLCPCI
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
comma
id|bcs-&gt;hw.hdlc.ctrl.ctrl
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|which
op_amp
l_int|4
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
op_plus
l_int|2
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
l_int|2
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
op_plus
l_int|1
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
l_int|1
)paren
id|WriteHDLCPnP
c_func
(paren
id|bcs-&gt;cs
comma
id|bcs-&gt;channel
comma
id|HDLC_STATUS
comma
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|modehdlc
id|modehdlc
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|mode
comma
r_int
id|bc
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|hdlc
op_assign
id|bcs-&gt;channel
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc %c mode %d --&gt; %d ichan %d --&gt; %d&quot;
comma
l_char|&squot;A&squot;
op_plus
id|hdlc
comma
id|bcs-&gt;mode
comma
id|mode
comma
id|hdlc
comma
id|bc
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.ctrl
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
(paren
op_minus
l_int|1
)paren
suffix:colon
multiline_comment|/* used for init */
id|bcs-&gt;mode
op_assign
l_int|1
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bc
op_assign
l_int|0
suffix:semicolon
r_case
(paren
id|L1_MODE_NULL
)paren
suffix:colon
r_if
c_cond
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_NULL
)paren
r_return
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_TRANS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;mode
op_assign
id|L1_MODE_NULL
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_TRANS
)paren
suffix:colon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_TRANS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
l_int|0
suffix:semicolon
id|sched_b_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|L1_MODE_HDLC
)paren
suffix:colon
id|bcs-&gt;mode
op_assign
id|mode
suffix:semicolon
id|bcs-&gt;channel
op_assign
id|bc
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
op_or
id|HDLC_CMD_RRS
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.mode
op_assign
id|HDLC_MODE_ITF_FLG
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|5
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_assign
l_int|0
suffix:semicolon
id|sched_b_event
c_func
(paren
id|bcs
comma
id|B_XMTBUFREADY
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|hdlc_empty_fifo
id|hdlc_empty_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
r_int
id|count
)paren
(brace
id|recv_empty_fifo_b
c_func
(paren
id|bcs
comma
id|count
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hdlc_fill_fifo
id|hdlc_fill_fifo
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|bcs-&gt;cs
suffix:semicolon
r_int
id|count
comma
id|more
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
r_int
id|fifo_size
op_assign
l_int|32
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|p
op_assign
id|xmit_fill_fifo_b
c_func
(paren
id|bcs
comma
id|fifo_size
comma
op_amp
id|count
comma
op_amp
id|more
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|more
)paren
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_XME
suffix:semicolon
r_else
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_XME
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
(paren
(paren
id|count
op_eq
id|fifo_size
)paren
ques
c_cond
l_int|0
suffix:colon
id|count
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* sets the correct index too */
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
id|p
suffix:semicolon
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
macro_line|#ifdef __powerpc__
macro_line|#ifdef CONFIG_APUS
id|out_le32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
comma
op_star
id|ptr
op_increment
)paren
suffix:semicolon
macro_line|#else
id|out_be32
c_func
(paren
(paren
r_int
op_star
)paren
(paren
id|cs-&gt;hw.avm.isac
op_plus
id|_IO_BASE
)paren
comma
op_star
id|ptr
op_increment
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_APUS */
macro_line|#else
id|outl
c_func
(paren
op_star
id|ptr
op_increment
comma
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
macro_line|#endif /* __powerpc__ */
id|cnt
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|cnt
OL
id|count
)paren
(brace
id|outb
c_func
(paren
op_star
id|p
op_increment
comma
id|cs-&gt;hw.avm.isac
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|reset_xmit
id|reset_xmit
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_XRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|hdlc_fill_fifo
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|HDLC_irq
id|HDLC_irq
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
comma
id|u_int
id|stat
)paren
(brace
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d stat %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
(brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_STAT_RDO
)paren
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;RDO&quot;
)paren
suffix:semicolon
r_else
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d stat %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.xml
op_assign
l_int|0
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_or_assign
id|HDLC_CMD_RRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;hw.hdlc.ctrl.sr.cmd
op_and_assign
op_complement
id|HDLC_CMD_RRS
suffix:semicolon
id|write_ctrl
c_func
(paren
id|bcs
comma
l_int|1
)paren
suffix:semicolon
id|bcs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|len
op_assign
(paren
id|stat
op_amp
id|HDLC_STAT_RML_MASK
)paren
op_rshift
l_int|8
)paren
)paren
id|len
op_assign
l_int|32
suffix:semicolon
id|hdlc_empty_fifo
c_func
(paren
id|bcs
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|HDLC_STAT_RME
)paren
op_logical_or
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_TRANS
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|stat
op_amp
id|HDLC_STAT_CRCVFRRAB
)paren
op_eq
id|HDLC_STAT_CRCVFR
)paren
op_logical_or
(paren
id|bcs-&gt;mode
op_eq
id|L1_MODE_TRANS
)paren
)paren
(brace
id|recv_rme_b
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bcs-&gt;cs-&gt;debug
op_amp
id|L1_DEB_HSCX
)paren
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;invalid frame&quot;
)paren
suffix:semicolon
r_else
id|debugl1
c_func
(paren
id|bcs-&gt;cs
comma
l_string|&quot;ch%d invalid frame %#x&quot;
comma
id|bcs-&gt;channel
comma
id|stat
)paren
suffix:semicolon
id|bcs-&gt;rcvidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_XDU
)paren
(brace
id|xmit_xdu_b
c_func
(paren
id|bcs
comma
id|reset_xmit
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_XPR
)paren
(brace
id|xmit_xpr_b
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
)brace
r_inline
r_void
DECL|function|HDLC_irq_main
id|HDLC_irq_main
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
id|stat
suffix:semicolon
r_struct
id|BCState
op_star
id|bcs
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cs-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|stat
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
)brace
r_else
(brace
id|stat
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
id|stat
op_or_assign
(paren
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_MASK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs
op_assign
id|Sel_BCS
c_func
(paren
id|cs
comma
l_int|0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc spurious channel 0 IRQ&quot;
)paren
suffix:semicolon
)brace
r_else
id|HDLC_irq
c_func
(paren
id|bcs
comma
id|stat
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|stat
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
)brace
r_else
(brace
id|stat
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_RPR
)paren
id|stat
op_or_assign
(paren
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|HDLC_INT_MASK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bcs
op_assign
id|Sel_BCS
c_func
(paren
id|cs
comma
l_int|1
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs-&gt;debug
)paren
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;hdlc spurious channel 1 IRQ&quot;
)paren
suffix:semicolon
)brace
r_else
id|HDLC_irq
c_func
(paren
id|bcs
comma
id|stat
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cs-&gt;lock
)paren
suffix:semicolon
)brace
r_void
DECL|function|hdlc_l2l1
id|hdlc_l2l1
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
(paren
id|PH_DATA
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_data_req_b
c_func
(paren
id|st-&gt;l1.bcs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|INDICATION
)paren
suffix:colon
id|xmit_pull_ind_b
c_func
(paren
id|st-&gt;l1.bcs
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_PULL
op_or
id|REQUEST
)paren
suffix:colon
id|xmit_pull_req_b
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_ACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|test_and_set_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|st-&gt;l1.bcs
comma
id|st-&gt;l1.mode
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|REQUEST
)paren
suffix:colon
id|l1_msg_b
c_func
(paren
id|st
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|PH_DEACTIVATE
op_or
id|CONFIRM
)paren
suffix:colon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_ACTIV
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|test_and_clear_bit
c_func
(paren
id|BC_FLG_BUSY
comma
op_amp
id|st-&gt;l1.bcs-&gt;Flag
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|st-&gt;l1.bcs
comma
l_int|0
comma
id|st-&gt;l1.bc
)paren
suffix:semicolon
id|L1L2
c_func
(paren
id|st
comma
id|PH_DEACTIVATE
op_or
id|CONFIRM
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|close_hdlcstate
id|close_hdlcstate
c_func
(paren
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|modehdlc
c_func
(paren
id|bcs
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bc_close
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_int
DECL|function|open_hdlcstate
id|open_hdlcstate
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
r_return
id|bc_open
c_func
(paren
id|bcs
)paren
suffix:semicolon
)brace
r_int
DECL|function|setstack_hdlc
id|setstack_hdlc
c_func
(paren
r_struct
id|PStack
op_star
id|st
comma
r_struct
id|BCState
op_star
id|bcs
)paren
(brace
id|bcs-&gt;channel
op_assign
id|st-&gt;l1.bc
suffix:semicolon
id|bcs-&gt;unit
op_assign
id|bcs-&gt;channel
suffix:semicolon
r_if
c_cond
(paren
id|open_hdlcstate
c_func
(paren
id|st-&gt;l1.hardware
comma
id|bcs
)paren
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|st-&gt;l1.bcs
op_assign
id|bcs
suffix:semicolon
id|st-&gt;l1.l2l1
op_assign
id|hdlc_l2l1
suffix:semicolon
id|setstack_manager
c_func
(paren
id|st
)paren
suffix:semicolon
id|bcs-&gt;st
op_assign
id|st
suffix:semicolon
id|setstack_l1_B
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|hdlc_l1_ops
r_static
r_struct
id|bc_l1_ops
id|hdlc_l1_ops
op_assign
(brace
dot
id|fill_fifo
op_assign
id|hdlc_fill_fifo
comma
dot
id|open
op_assign
id|setstack_hdlc
comma
dot
id|close
op_assign
id|close_hdlcstate
comma
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|inithdlc
id|inithdlc
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|u_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|cs-&gt;subtyp
op_eq
id|AVM_FRITZ_PCI
)paren
(brace
id|val
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPCI
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 RML %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|2
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 MODE %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|0
comma
id|HDLC_STATUS
op_plus
l_int|3
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 1 VIN %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 STA %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|1
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 RML %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|2
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 MODE %x&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|ReadHDLCPnP
c_func
(paren
id|cs
comma
l_int|1
comma
id|HDLC_STATUS
op_plus
l_int|3
)paren
suffix:semicolon
id|debugl1
c_func
(paren
id|cs
comma
l_string|&quot;HDLC 2 VIN %x&quot;
comma
id|val
)paren
suffix:semicolon
)brace
id|modehdlc
c_func
(paren
id|cs-&gt;bcs
comma
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|modehdlc
c_func
(paren
id|cs-&gt;bcs
op_plus
l_int|1
comma
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
id|irqreturn_t
DECL|function|avm_pcipnp_interrupt
id|avm_pcipnp_interrupt
c_func
(paren
r_int
id|intno
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|IsdnCardState
op_star
id|cs
op_assign
id|dev_id
suffix:semicolon
id|u8
id|val
suffix:semicolon
id|u8
id|sval
suffix:semicolon
id|sval
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_MASK
)paren
op_eq
id|AVM_STATUS0_IRQ_MASK
)paren
multiline_comment|/* possible a shared  IRQ reqest */
r_return
id|IRQ_NONE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_ISAC
)paren
)paren
(brace
id|val
op_assign
id|ReadISAC
c_func
(paren
id|cs
comma
id|ISAC_ISTA
)paren
suffix:semicolon
id|isac_interrupt
c_func
(paren
id|cs
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sval
op_amp
id|AVM_STATUS0_IRQ_HDLC
)paren
)paren
(brace
id|HDLC_irq_main
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_MASK
comma
l_int|0xFF
)paren
suffix:semicolon
id|WriteISAC
c_func
(paren
id|cs
comma
id|ISAC_MASK
comma
l_int|0x0
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_static
r_int
DECL|function|avm_pcipnp_reset
id|avm_pcipnp_reset
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI/PnP: reset&bslash;n&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_RESET
op_or
id|AVM_STATUS0_DIS_TIMER
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Timeout 10ms */
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
op_or
id|AVM_STATUS0_ENA_IRQ
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS1_ENA_IOM
op_or
id|cs-&gt;irq
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|3
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
l_int|10
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Timeout 10ms */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI/PnP: S1 %x&bslash;n&quot;
comma
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|3
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|avm_pcipnp_init
id|avm_pcipnp_init
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|initisac
c_func
(paren
id|cs
)paren
suffix:semicolon
id|inithdlc
c_func
(paren
id|cs
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|AVM_STATUS0_DIS_TIMER
op_or
id|AVM_STATUS0_RES_TIMER
op_or
id|AVM_STATUS0_ENA_IRQ
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|avm_pcipnp_release
id|avm_pcipnp_release
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|2
)paren
suffix:semicolon
id|hisax_release_resources
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
DECL|variable|avm_pci_ops
r_static
r_struct
id|card_ops
id|avm_pci_ops
op_assign
(brace
dot
id|init
op_assign
id|avm_pcipnp_init
comma
dot
id|reset
op_assign
id|avm_pcipnp_reset
comma
dot
id|release
op_assign
id|avm_pcipnp_release
comma
dot
id|irq_func
op_assign
id|avm_pcipnp_interrupt
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|avm_pcipnp_hw_init
id|avm_pcipnp_hw_init
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
)paren
(brace
id|cs-&gt;bc_hw_ops
op_assign
op_amp
id|hdlc_hw_ops
suffix:semicolon
id|cs-&gt;bc_l1_ops
op_assign
op_amp
id|hdlc_l1_ops
suffix:semicolon
id|cs-&gt;card_ops
op_assign
op_amp
id|avm_pci_ops
suffix:semicolon
id|avm_pcipnp_reset
c_func
(paren
id|cs
)paren
suffix:semicolon
r_return
id|isac_setup
c_func
(paren
id|cs
comma
op_amp
id|isac_ops
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|avm_pci_probe
id|avm_pci_probe
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_int
id|rc
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI: defined at %#lx IRQ %u&bslash;n&quot;
comma
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pdev-&gt;irq
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_goto
id|err
suffix:semicolon
id|cs-&gt;subtyp
op_assign
id|AVM_FRITZ_PCI
suffix:semicolon
id|cs-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|cs-&gt;irq_flags
op_or_assign
id|SA_SHIRQ
suffix:semicolon
id|cs-&gt;hw.avm.cfg_reg
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|cs-&gt;hw.avm.isac
op_assign
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_io
c_func
(paren
op_amp
id|cs-&gt;rs
comma
id|cs-&gt;hw.avm.cfg_reg
comma
l_int|32
comma
l_string|&quot;avm PCI&quot;
)paren
)paren
r_goto
id|err
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI: stat %#x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PCI: Class %X Rev %d&bslash;n&quot;
comma
id|val
op_amp
l_int|0xff
comma
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|avm_pcipnp_hw_init
c_func
(paren
id|cs
)paren
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|hisax_release_resources
c_func
(paren
id|cs
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|avm_pnp_probe
id|avm_pnp_probe
c_func
(paren
r_struct
id|IsdnCardState
op_star
id|cs
comma
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|u8
id|val
comma
id|ver
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PnP: defined at %#lx IRQ %lu&bslash;n&quot;
comma
id|card-&gt;para
(braket
l_int|1
)braket
comma
id|card-&gt;para
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|cs-&gt;subtyp
op_assign
id|AVM_FRITZ_PNP
suffix:semicolon
id|cs-&gt;irq
op_assign
id|card-&gt;para
(braket
l_int|0
)braket
suffix:semicolon
id|cs-&gt;hw.avm.cfg_reg
op_assign
id|card-&gt;para
(braket
l_int|1
)braket
suffix:semicolon
id|cs-&gt;hw.avm.isac
op_assign
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|0x10
suffix:semicolon
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_io
c_func
(paren
op_amp
id|cs-&gt;rs
comma
id|cs-&gt;hw.avm.cfg_reg
comma
l_int|32
comma
l_string|&quot;avm PnP&quot;
)paren
)paren
r_goto
id|err
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
)paren
suffix:semicolon
id|ver
op_assign
id|inb
c_func
(paren
id|cs-&gt;hw.avm.cfg_reg
op_plus
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;AVM PnP: Class %X Rev %d&bslash;n&quot;
comma
id|val
comma
id|ver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|avm_pcipnp_hw_init
c_func
(paren
id|cs
)paren
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|hisax_release_resources
c_func
(paren
id|cs
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|pci_dev
op_star
id|dev_avm
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef __ISAPNP__
DECL|variable|__initdata
r_static
r_struct
id|pnp_card
op_star
id|card_avm
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pnp_dev
op_star
id|pnp_avm
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_int
id|__init
DECL|function|setup_avm_pcipnp
id|setup_avm_pcipnp
c_func
(paren
r_struct
id|IsdnCard
op_star
id|card
)paren
(brace
r_char
id|tmp
(braket
l_int|64
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|tmp
comma
id|avm_pci_rev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;HiSax: AVM PCI driver Rev. %s&bslash;n&quot;
comma
id|HiSax_getrev
c_func
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;para
(braket
l_int|1
)braket
)paren
(brace
multiline_comment|/* old manual method */
r_if
c_cond
(paren
id|avm_pnp_probe
c_func
(paren
id|card-&gt;cs
comma
id|card
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef __ISAPNP__
r_if
c_cond
(paren
id|isapnp_present
c_func
(paren
)paren
)paren
(brace
r_struct
id|pnp_card
op_star
id|ba
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ba
op_assign
id|pnp_find_card
c_func
(paren
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_char|&squot;V&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0900
)paren
comma
id|card_avm
)paren
)paren
)paren
(brace
id|card_avm
op_assign
id|ba
suffix:semicolon
id|pnp_avm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pnp_avm
op_assign
id|pnp_find_dev
c_func
(paren
id|card_avm
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_char|&squot;V&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0900
)paren
comma
id|pnp_avm
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pnp_device_attach
c_func
(paren
id|pnp_avm
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPnP: attach failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pnp_activate_dev
c_func
(paren
id|pnp_avm
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPnP: activate failed&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|pnp_avm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pnp_irq_valid
c_func
(paren
id|pnp_avm
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPnP:No IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|pnp_avm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pnp_port_valid
c_func
(paren
id|pnp_avm
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FritzPnP:No IO address&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|pnp_avm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|card-&gt;para
(braket
l_int|1
)braket
op_assign
id|pnp_port_start
c_func
(paren
id|pnp_avm
comma
l_int|0
)paren
suffix:semicolon
id|card-&gt;para
(braket
l_int|0
)braket
op_assign
id|pnp_irq
c_func
(paren
id|pnp_avm
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|avm_pnp_probe
c_func
(paren
id|card-&gt;cs
comma
id|card
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
(paren
id|dev_avm
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_AVM
comma
id|PCI_DEVICE_ID_AVM_A1
comma
id|dev_avm
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|avm_pci_probe
c_func
(paren
id|card-&gt;cs
comma
id|dev_avm
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;FritzPCI: No card found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
