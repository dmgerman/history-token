multiline_comment|/* $Id: capifunc.c,v 1.61.4.7 2005/02/11 19:40:25 armin Exp $&n; *&n; * ISDN interface module for Eicon active cards DIVA.&n; * CAPI Interface common functions&n; * &n; * Copyright 2000-2003 by Armin Schindler (mac@melware.de) &n; * Copyright 2000-2003 Cytronics &amp; Melware (info@melware.de)&n; * &n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
macro_line|#include &quot;platform.h&quot;
macro_line|#include &quot;os_capi.h&quot;
macro_line|#include &quot;di_defs.h&quot;
macro_line|#include &quot;capi20.h&quot;
macro_line|#include &quot;divacapi.h&quot;
macro_line|#include &quot;divasync.h&quot;
macro_line|#include &quot;capifunc.h&quot;
DECL|macro|DBG_MINIMUM
mdefine_line|#define DBG_MINIMUM  (DL_LOG + DL_FTL + DL_ERR)
DECL|macro|DBG_DEFAULT
mdefine_line|#define DBG_DEFAULT  (DBG_MINIMUM + DL_XLOG + DL_REG)
DECL|variable|adapter
id|DIVA_CAPI_ADAPTER
op_star
id|adapter
op_assign
(paren
id|DIVA_CAPI_ADAPTER
op_star
)paren
l_int|NULL
suffix:semicolon
DECL|variable|application
id|APPL
op_star
id|application
op_assign
(paren
id|APPL
op_star
)paren
l_int|NULL
suffix:semicolon
DECL|variable|max_appl
id|byte
id|max_appl
op_assign
id|MAX_APPL
suffix:semicolon
DECL|variable|max_adapter
id|byte
id|max_adapter
op_assign
l_int|0
suffix:semicolon
DECL|variable|mapped_msg
r_static
id|CAPI_MSG
op_star
id|mapped_msg
op_assign
(paren
id|CAPI_MSG
op_star
)paren
l_int|NULL
suffix:semicolon
id|byte
id|UnMapController
c_func
(paren
id|byte
)paren
suffix:semicolon
DECL|variable|DRIVERRELEASE_CAPI
r_char
id|DRIVERRELEASE_CAPI
(braket
l_int|32
)braket
suffix:semicolon
r_extern
r_void
id|AutomaticLaw
c_func
(paren
id|DIVA_CAPI_ADAPTER
op_star
)paren
suffix:semicolon
r_extern
r_void
id|callback
c_func
(paren
id|ENTITY
op_star
)paren
suffix:semicolon
r_extern
id|word
id|api_remove_start
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
id|word
id|CapiRelease
c_func
(paren
id|word
)paren
suffix:semicolon
r_extern
id|word
id|CapiRegister
c_func
(paren
id|word
)paren
suffix:semicolon
r_extern
id|word
id|api_put
c_func
(paren
id|APPL
op_star
comma
id|CAPI_MSG
op_star
)paren
suffix:semicolon
DECL|variable|api_lock
r_static
id|diva_os_spin_lock_t
id|api_lock
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|cards
)paren
suffix:semicolon
DECL|variable|notify_handle
r_static
id|dword
id|notify_handle
suffix:semicolon
r_static
r_void
id|DIRequest
c_func
(paren
id|ENTITY
op_star
id|e
)paren
suffix:semicolon
DECL|variable|MAdapter
r_static
id|DESCRIPTOR
id|MAdapter
suffix:semicolon
DECL|variable|DAdapter
r_static
id|DESCRIPTOR
id|DAdapter
suffix:semicolon
DECL|variable|ControllerMap
r_static
id|byte
id|ControllerMap
(braket
id|MAX_DESCRIPTORS
op_plus
l_int|1
)braket
suffix:semicolon
r_static
r_void
id|diva_register_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
comma
id|__u16
comma
id|capi_register_params
op_star
)paren
suffix:semicolon
r_static
r_void
id|diva_release_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
comma
id|__u16
)paren
suffix:semicolon
r_static
r_char
op_star
id|diva_procinfo
c_func
(paren
r_struct
id|capi_ctr
op_star
)paren
suffix:semicolon
r_static
id|u16
id|diva_send_message
c_func
(paren
r_struct
id|capi_ctr
op_star
comma
id|diva_os_message_buffer_s
op_star
)paren
suffix:semicolon
r_extern
r_void
id|diva_os_set_controller_struct
c_func
(paren
r_struct
id|capi_ctr
op_star
)paren
suffix:semicolon
r_extern
r_void
id|DIVA_DIDD_Read
c_func
(paren
id|DESCRIPTOR
op_star
comma
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * debug&n; */
r_static
r_void
id|no_printf
c_func
(paren
r_int
r_char
op_star
comma
dot
dot
dot
)paren
suffix:semicolon
macro_line|#include &quot;debuglib.c&quot;
DECL|function|xlog
r_static
r_void
id|xlog
c_func
(paren
r_char
op_star
id|x
comma
dot
dot
dot
)paren
(brace
macro_line|#ifndef DIVA_NO_DEBUGLIB
id|va_list
id|ap
suffix:semicolon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_XLOG
)paren
(brace
id|va_start
c_func
(paren
id|ap
comma
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_irq
)paren
(brace
id|myDriverDebugHandle
dot
id|dbg_irq
c_func
(paren
id|myDriverDebugHandle.id
comma
id|DLI_XLOG
comma
id|x
comma
id|ap
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_old
)paren
(brace
id|myDriverDebugHandle
dot
id|dbg_old
c_func
(paren
id|myDriverDebugHandle.id
comma
id|x
comma
id|ap
)paren
suffix:semicolon
)brace
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * info for proc&n; */
DECL|function|diva_procinfo
r_static
r_char
op_star
id|diva_procinfo
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
r_return
(paren
id|ctrl-&gt;serial
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * stop debugging&n; */
DECL|function|stop_dbg
r_static
r_void
id|stop_dbg
c_func
(paren
r_void
)paren
(brace
id|DbgDeregister
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|MAdapter
comma
l_int|0
comma
r_sizeof
(paren
id|MAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
id|no_printf
suffix:semicolon
)brace
multiline_comment|/*&n; * dummy debug function&n; */
DECL|function|no_printf
r_static
r_void
id|no_printf
c_func
(paren
r_int
r_char
op_star
id|x
comma
dot
dot
dot
)paren
(brace
)brace
multiline_comment|/*&n; * Controller mapping&n; */
DECL|function|MapController
id|byte
id|MapController
c_func
(paren
id|byte
id|Controller
)paren
(brace
id|byte
id|i
suffix:semicolon
id|byte
id|MappedController
op_assign
l_int|0
suffix:semicolon
id|byte
id|ctrl
op_assign
id|Controller
op_amp
l_int|0x7f
suffix:semicolon
multiline_comment|/* mask external controller bit off */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|max_adapter
op_plus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ctrl
op_eq
id|ControllerMap
(braket
id|i
)braket
)paren
(brace
id|MappedController
op_assign
(paren
id|byte
)paren
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
OG
id|max_adapter
)paren
(brace
id|ControllerMap
(braket
l_int|0
)braket
op_assign
id|ctrl
suffix:semicolon
id|MappedController
op_assign
l_int|0
suffix:semicolon
)brace
r_return
(paren
id|MappedController
op_or
(paren
id|Controller
op_amp
l_int|0x80
)paren
)paren
suffix:semicolon
multiline_comment|/* put back external controller bit */
)brace
multiline_comment|/*&n; * Controller unmapping&n; */
DECL|function|UnMapController
id|byte
id|UnMapController
c_func
(paren
id|byte
id|MappedController
)paren
(brace
id|byte
id|Controller
suffix:semicolon
id|byte
id|ctrl
op_assign
id|MappedController
op_amp
l_int|0x7f
suffix:semicolon
multiline_comment|/* mask external controller bit off */
r_if
c_cond
(paren
id|ctrl
op_le
id|max_adapter
)paren
(brace
id|Controller
op_assign
id|ControllerMap
(braket
id|ctrl
)braket
suffix:semicolon
)brace
r_else
(brace
id|Controller
op_assign
l_int|0
suffix:semicolon
)brace
r_return
(paren
id|Controller
op_or
(paren
id|MappedController
op_amp
l_int|0x80
)paren
)paren
suffix:semicolon
multiline_comment|/* put back external controller bit */
)brace
multiline_comment|/*&n; * find a new free id&n; */
DECL|function|find_free_id
r_static
r_int
id|find_free_id
c_func
(paren
r_void
)paren
(brace
r_int
id|num
op_assign
l_int|0
suffix:semicolon
id|DIVA_CAPI_ADAPTER
op_star
id|a
suffix:semicolon
r_while
c_loop
(paren
id|num
OL
id|MAX_DESCRIPTORS
)paren
(brace
id|a
op_assign
op_amp
id|adapter
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a-&gt;Id
)paren
r_break
suffix:semicolon
id|num
op_increment
suffix:semicolon
)brace
r_return
id|num
op_plus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * find a card structure by controller number&n; */
DECL|function|find_card_by_ctrl
r_static
id|diva_card
op_star
id|find_card_by_ctrl
c_func
(paren
id|word
id|controller
)paren
(brace
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
id|diva_card
op_star
id|card
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|cards
)paren
(brace
id|card
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
id|diva_card
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ControllerMap
(braket
id|card-&gt;Id
)braket
op_eq
id|controller
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;remove_in_progress
)paren
id|card
op_assign
l_int|NULL
suffix:semicolon
r_return
id|card
suffix:semicolon
)brace
)brace
r_return
(paren
id|diva_card
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Buffer RX/TX &n; */
DECL|function|TransmitBufferSet
r_void
op_star
id|TransmitBufferSet
c_func
(paren
id|APPL
op_star
id|appl
comma
id|dword
id|ref
)paren
(brace
id|appl-&gt;xbuffer_used
(braket
id|ref
)braket
op_assign
id|TRUE
suffix:semicolon
id|DBG_PRV1
c_func
(paren
(paren
l_string|&quot;%d:xbuf_used(%d)&quot;
comma
id|appl-&gt;Id
comma
id|ref
op_plus
l_int|1
)paren
)paren
r_return
(paren
r_void
op_star
)paren
id|ref
suffix:semicolon
)brace
DECL|function|TransmitBufferGet
r_void
op_star
id|TransmitBufferGet
c_func
(paren
id|APPL
op_star
id|appl
comma
r_void
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|appl-&gt;xbuffer_internal
(braket
(paren
id|dword
)paren
id|p
)braket
)paren
r_return
id|appl-&gt;xbuffer_internal
(braket
(paren
id|dword
)paren
id|p
)braket
suffix:semicolon
r_return
id|appl-&gt;xbuffer_ptr
(braket
(paren
id|dword
)paren
id|p
)braket
suffix:semicolon
)brace
DECL|function|TransmitBufferFree
r_void
id|TransmitBufferFree
c_func
(paren
id|APPL
op_star
id|appl
comma
r_void
op_star
id|p
)paren
(brace
id|appl-&gt;xbuffer_used
(braket
(paren
id|dword
)paren
id|p
)braket
op_assign
id|FALSE
suffix:semicolon
id|DBG_PRV1
c_func
(paren
(paren
l_string|&quot;%d:xbuf_free(%d)&quot;
comma
id|appl-&gt;Id
comma
(paren
(paren
id|dword
)paren
id|p
)paren
op_plus
l_int|1
)paren
)paren
)brace
DECL|function|ReceiveBufferGet
r_void
op_star
id|ReceiveBufferGet
c_func
(paren
id|APPL
op_star
id|appl
comma
r_int
id|Num
)paren
(brace
r_return
op_amp
id|appl-&gt;ReceiveBuffer
(braket
id|Num
op_star
id|appl-&gt;MaxDataLength
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * api_remove_start/complete for cleanup&n; */
DECL|function|api_remove_complete
r_void
id|api_remove_complete
c_func
(paren
r_void
)paren
(brace
id|DBG_PRV1
c_func
(paren
(paren
l_string|&quot;api_remove_complete&quot;
)paren
)paren
)brace
multiline_comment|/*&n; * main function called by message.c&n; */
DECL|function|sendf
r_void
id|sendf
c_func
(paren
id|APPL
op_star
id|appl
comma
id|word
id|command
comma
id|dword
id|Id
comma
id|word
id|Number
comma
id|byte
op_star
id|format
comma
dot
dot
dot
)paren
(brace
id|word
id|i
comma
id|j
suffix:semicolon
id|word
id|length
op_assign
l_int|12
comma
id|dlength
op_assign
l_int|0
suffix:semicolon
id|byte
op_star
id|write
suffix:semicolon
id|CAPI_MSG
id|msg
suffix:semicolon
id|byte
op_star
id|string
op_assign
l_int|NULL
suffix:semicolon
id|va_list
id|ap
suffix:semicolon
id|diva_os_message_buffer_s
op_star
id|dmb
suffix:semicolon
id|diva_card
op_star
id|card
op_assign
l_int|NULL
suffix:semicolon
id|dword
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|appl
)paren
r_return
suffix:semicolon
id|DBG_PRV1
c_func
(paren
(paren
l_string|&quot;sendf(a=%d,cmd=%x,format=%s)&quot;
comma
id|appl-&gt;Id
comma
id|command
comma
(paren
id|byte
op_star
)paren
id|format
)paren
)paren
id|PUT_WORD
c_func
(paren
op_amp
id|msg.header.appl_id
comma
id|appl-&gt;Id
)paren
suffix:semicolon
id|PUT_WORD
c_func
(paren
op_amp
id|msg.header.command
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|byte
)paren
(paren
id|command
op_rshift
l_int|8
)paren
op_eq
l_int|0x82
)paren
id|Number
op_assign
id|appl-&gt;Number
op_increment
suffix:semicolon
id|PUT_WORD
c_func
(paren
op_amp
id|msg.header.number
comma
id|Number
)paren
suffix:semicolon
id|PUT_DWORD
c_func
(paren
op_amp
id|msg.header.controller
comma
id|Id
)paren
suffix:semicolon
id|write
op_assign
(paren
id|byte
op_star
)paren
op_amp
id|msg
suffix:semicolon
id|write
op_add_assign
l_int|12
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|format
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|format
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|format
(braket
id|i
)braket
)paren
(brace
r_case
l_char|&squot;b&squot;
suffix:colon
id|tmp
op_assign
id|va_arg
c_func
(paren
id|ap
comma
id|dword
)paren
suffix:semicolon
op_star
(paren
id|byte
op_star
)paren
id|write
op_assign
(paren
id|byte
)paren
(paren
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|write
op_add_assign
l_int|1
suffix:semicolon
id|length
op_add_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;w&squot;
suffix:colon
id|tmp
op_assign
id|va_arg
c_func
(paren
id|ap
comma
id|dword
)paren
suffix:semicolon
id|PUT_WORD
c_func
(paren
id|write
comma
(paren
id|tmp
op_amp
l_int|0xffff
)paren
)paren
suffix:semicolon
id|write
op_add_assign
l_int|2
suffix:semicolon
id|length
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
id|tmp
op_assign
id|va_arg
c_func
(paren
id|ap
comma
id|dword
)paren
suffix:semicolon
id|PUT_DWORD
c_func
(paren
id|write
comma
id|tmp
)paren
suffix:semicolon
id|write
op_add_assign
l_int|4
suffix:semicolon
id|length
op_add_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
r_case
l_char|&squot;S&squot;
suffix:colon
id|string
op_assign
id|va_arg
c_func
(paren
id|ap
comma
id|byte
op_star
)paren
suffix:semicolon
id|length
op_add_assign
id|string
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
op_le
id|string
(braket
l_int|0
)braket
suffix:semicolon
id|j
op_increment
)paren
op_star
id|write
op_increment
op_assign
id|string
(braket
id|j
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
id|PUT_WORD
c_func
(paren
op_amp
id|msg.header.length
comma
id|length
)paren
suffix:semicolon
id|msg.header.controller
op_assign
id|UnMapController
c_func
(paren
id|msg.header.controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|command
op_eq
id|_DATA_B3_I
)paren
id|dlength
op_assign
id|GET_WORD
c_func
(paren
(paren
(paren
id|byte
op_star
)paren
op_amp
id|msg.info.data_b3_ind.Data_Length
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dmb
op_assign
id|diva_os_alloc_message_buffer
c_func
(paren
id|length
op_plus
id|dlength
comma
(paren
r_void
op_star
op_star
)paren
op_amp
id|write
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;sendf: alloc_message_buffer failed, incoming msg dropped.&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* copy msg header to sk_buff */
id|memcpy
c_func
(paren
id|write
comma
(paren
id|byte
op_star
)paren
op_amp
id|msg
comma
id|length
)paren
suffix:semicolon
multiline_comment|/* if DATA_B3_IND, copy data too */
r_if
c_cond
(paren
id|command
op_eq
id|_DATA_B3_I
)paren
(brace
id|dword
id|data
op_assign
id|GET_DWORD
c_func
(paren
op_amp
id|msg.info.data_b3_ind.Data
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|write
op_plus
id|length
comma
(paren
r_void
op_star
)paren
id|data
comma
id|dlength
)paren
suffix:semicolon
)brace
macro_line|#ifndef DIVA_NO_DEBUGLIB
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_XLOG
)paren
(brace
r_switch
c_cond
(paren
id|command
)paren
(brace
r_default
suffix:colon
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
op_amp
id|msg
comma
l_int|0x81
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_DATA_B3_R
op_or
id|CONFIRM
suffix:colon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_BLK
)paren
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
op_amp
id|msg
comma
l_int|0x81
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_DATA_B3_I
suffix:colon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_BLK
)paren
(brace
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
op_amp
id|msg
comma
l_int|0x81
comma
id|length
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dlength
suffix:semicolon
id|i
op_add_assign
l_int|256
)paren
(brace
id|DBG_BLK
c_func
(paren
(paren
(paren
(paren
r_char
op_star
)paren
id|GET_DWORD
c_func
(paren
op_amp
id|msg.info.data_b3_ind.Data
)paren
)paren
op_plus
id|i
comma
(paren
(paren
id|dlength
op_minus
id|i
)paren
OL
l_int|256
)paren
ques
c_cond
(paren
id|dlength
op_minus
id|i
)paren
suffix:colon
l_int|256
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_PRV0
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* not more if not explicitely requested */
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* find the card structure for this controller */
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
id|find_card_by_ctrl
c_func
(paren
id|write
(braket
l_int|8
)braket
op_amp
l_int|0x7f
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;sendf - controller %d not found, incoming msg dropped&quot;
comma
id|write
(braket
l_int|8
)braket
op_amp
l_int|0x7f
)paren
)paren
id|diva_os_free_message_buffer
c_func
(paren
id|dmb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* send capi msg to capi layer */
id|capi_ctr_handle_message
c_func
(paren
op_amp
id|card-&gt;capi_ctrl
comma
id|appl-&gt;Id
comma
id|dmb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * cleanup adapter&n; */
DECL|function|clean_adapter
r_static
r_void
id|clean_adapter
c_func
(paren
r_int
id|id
comma
r_struct
id|list_head
op_star
id|free_mem_q
)paren
(brace
id|DIVA_CAPI_ADAPTER
op_star
id|a
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
id|a
op_assign
op_amp
id|adapter
(braket
id|id
)braket
suffix:semicolon
id|k
op_assign
id|li_total_channels
op_minus
id|a-&gt;li_channels
suffix:semicolon
r_if
c_cond
(paren
id|k
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|li_config_table
)paren
(brace
id|list_add
c_func
(paren
(paren
r_struct
id|list_head
op_star
)paren
id|li_config_table
comma
id|free_mem_q
)paren
suffix:semicolon
id|li_config_table
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|a-&gt;li_base
OL
id|k
)paren
(brace
id|memmove
c_func
(paren
op_amp
id|li_config_table
(braket
id|a-&gt;li_base
)braket
comma
op_amp
id|li_config_table
(braket
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)braket
comma
(paren
id|k
op_minus
id|a-&gt;li_base
)paren
op_star
r_sizeof
(paren
id|LI_CONFIG
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|k
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memmove
c_func
(paren
op_amp
id|li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
id|a-&gt;li_base
)braket
comma
op_amp
id|li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)braket
comma
id|k
op_minus
id|a-&gt;li_base
)paren
suffix:semicolon
id|memmove
c_func
(paren
op_amp
id|li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
id|a-&gt;li_base
)braket
comma
op_amp
id|li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)braket
comma
id|k
op_minus
id|a-&gt;li_base
)paren
suffix:semicolon
)brace
)brace
)brace
id|li_total_channels
op_assign
id|k
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|id
suffix:semicolon
id|i
OL
id|max_adapter
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter
(braket
id|i
)braket
dot
id|request
)paren
id|adapter
(braket
id|i
)braket
dot
id|li_base
op_sub_assign
id|a-&gt;li_channels
suffix:semicolon
)brace
r_if
c_cond
(paren
id|a-&gt;plci
)paren
id|list_add
c_func
(paren
(paren
r_struct
id|list_head
op_star
)paren
id|a-&gt;plci
comma
id|free_mem_q
)paren
suffix:semicolon
id|memset
c_func
(paren
id|a
comma
l_int|0x00
comma
r_sizeof
(paren
id|DIVA_CAPI_ADAPTER
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|max_adapter
op_ne
l_int|0
)paren
op_logical_and
op_logical_neg
id|adapter
(braket
id|max_adapter
op_minus
l_int|1
)braket
dot
id|request
)paren
id|max_adapter
op_decrement
suffix:semicolon
)brace
multiline_comment|/*&n; * remove a card, but ensures consistent state of LI tables&n; * in the time adapter is removed&n; */
DECL|function|divacapi_remove_card
r_static
r_void
id|divacapi_remove_card
c_func
(paren
id|DESCRIPTOR
op_star
id|d
)paren
(brace
id|diva_card
op_star
id|card
op_assign
l_int|NULL
suffix:semicolon
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|free_mem_q
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|link
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
multiline_comment|/*&n;&t; * Set &quot;remove in progress flag&quot;.&n;&t; * Ensures that there is no call from sendf to CAPI in&n;&t; * the time CAPI controller is about to be removed.&n;&t; */
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove card&quot;
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|cards
)paren
(brace
id|card
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
id|diva_card
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d.request
op_eq
id|d-&gt;request
)paren
(brace
id|card-&gt;remove_in_progress
op_assign
l_int|1
suffix:semicolon
id|list_del
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove card&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
multiline_comment|/*&n;&t;&t; * Detach CAPI. Sendf cannot call to CAPI any more.&n;&t;&t; * After detach no call to send_message() is done too.&n;&t;&t; */
id|detach_capi_ctr
c_func
(paren
op_amp
id|card-&gt;capi_ctrl
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Now get API lock (to ensure stable state of LI tables)&n;&t;&t; * and update the adapter map/LI table.&n;&t;&t; */
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove card&quot;
)paren
suffix:semicolon
id|clean_adapter
c_func
(paren
id|card-&gt;Id
op_minus
l_int|1
comma
op_amp
id|free_mem_q
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;DelAdapterMap (%d) -&gt; (%d)&quot;
comma
id|ControllerMap
(braket
id|card-&gt;Id
)braket
comma
id|card-&gt;Id
)paren
)paren
id|ControllerMap
(braket
id|card-&gt;Id
)braket
op_assign
l_int|0
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;adapter remove, max_adapter=%d&quot;
comma
id|max_adapter
)paren
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove card&quot;
)paren
suffix:semicolon
multiline_comment|/* After releasing the lock, we can free the memory */
id|diva_os_free
(paren
l_int|0
comma
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* free queued memory areas */
id|list_for_each_safe
c_func
(paren
id|link
comma
id|tmp
comma
op_amp
id|free_mem_q
)paren
(brace
id|list_del
c_func
(paren
id|link
)paren
suffix:semicolon
id|diva_os_free
c_func
(paren
l_int|0
comma
id|link
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * remove cards&n; */
DECL|function|divacapi_remove_cards
r_static
r_void
id|divacapi_remove_cards
c_func
(paren
r_void
)paren
(brace
id|DESCRIPTOR
id|d
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
id|diva_card
op_star
id|card
suffix:semicolon
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|rescan
suffix:colon
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove cards&quot;
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|cards
)paren
(brace
id|card
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
id|diva_card
comma
id|list
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove cards&quot;
)paren
suffix:semicolon
id|d.request
op_assign
id|card-&gt;d.request
suffix:semicolon
id|divacapi_remove_card
c_func
(paren
op_amp
id|d
)paren
suffix:semicolon
r_goto
id|rescan
suffix:semicolon
)brace
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;remove cards&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * sync_callback&n; */
DECL|function|sync_callback
r_static
r_void
id|sync_callback
c_func
(paren
id|ENTITY
op_star
id|e
)paren
(brace
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;cb:Id=%x,Rc=%x,Ind=%x&quot;
comma
id|e-&gt;Id
comma
id|e-&gt;Rc
comma
id|e-&gt;Ind
)paren
)paren
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;sync_callback&quot;
)paren
suffix:semicolon
id|callback
c_func
(paren
id|e
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;sync_callback&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * add a new card&n; */
DECL|function|diva_add_card
r_static
r_int
id|diva_add_card
c_func
(paren
id|DESCRIPTOR
op_star
id|d
)paren
(brace
r_int
id|k
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|diva_card
op_star
id|card
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|capi_ctr
op_star
id|ctrl
op_assign
l_int|NULL
suffix:semicolon
id|DIVA_CAPI_ADAPTER
op_star
id|a
op_assign
l_int|NULL
suffix:semicolon
id|IDI_SYNC_REQ
id|sync_req
suffix:semicolon
r_char
id|serial
(braket
l_int|16
)braket
suffix:semicolon
r_void
op_star
id|mem_to_free
suffix:semicolon
id|LI_CONFIG
op_star
id|new_li_config_table
suffix:semicolon
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
(paren
id|diva_card
op_star
)paren
id|diva_os_malloc
c_func
(paren
l_int|0
comma
r_sizeof
(paren
id|diva_card
)paren
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;diva_add_card: failed to allocate card struct.&quot;
)paren
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|card
comma
l_int|0x00
comma
r_sizeof
(paren
id|diva_card
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;d
comma
id|d
comma
r_sizeof
(paren
id|DESCRIPTOR
)paren
)paren
suffix:semicolon
id|sync_req.GetName.Req
op_assign
l_int|0
suffix:semicolon
id|sync_req.GetName.Rc
op_assign
id|IDI_SYNC_REQ_GET_NAME
suffix:semicolon
id|card-&gt;d
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|sync_req
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|card-&gt;name
comma
id|sync_req.GetName.name
comma
r_sizeof
(paren
id|card-&gt;name
)paren
)paren
suffix:semicolon
id|ctrl
op_assign
op_amp
id|card-&gt;capi_ctrl
suffix:semicolon
id|strcpy
c_func
(paren
id|ctrl-&gt;name
comma
id|card-&gt;name
)paren
suffix:semicolon
id|ctrl-&gt;register_appl
op_assign
id|diva_register_appl
suffix:semicolon
id|ctrl-&gt;release_appl
op_assign
id|diva_release_appl
suffix:semicolon
id|ctrl-&gt;send_message
op_assign
id|diva_send_message
suffix:semicolon
id|ctrl-&gt;procinfo
op_assign
id|diva_procinfo
suffix:semicolon
id|ctrl-&gt;driverdata
op_assign
id|card
suffix:semicolon
id|diva_os_set_controller_struct
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attach_capi_ctr
c_func
(paren
id|ctrl
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;diva_add_card: failed to attach controller.&quot;
)paren
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|card
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;find id&quot;
)paren
suffix:semicolon
id|card-&gt;Id
op_assign
id|find_free_id
c_func
(paren
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;find id&quot;
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|ctrl-&gt;manu
comma
id|M_COMPANY
comma
r_sizeof
(paren
id|ctrl-&gt;manu
)paren
)paren
suffix:semicolon
id|ctrl-&gt;version.majorversion
op_assign
l_int|2
suffix:semicolon
id|ctrl-&gt;version.minorversion
op_assign
l_int|0
suffix:semicolon
id|ctrl-&gt;version.majormanuversion
op_assign
id|DRRELMAJOR
suffix:semicolon
id|ctrl-&gt;version.minormanuversion
op_assign
id|DRRELMINOR
suffix:semicolon
id|sync_req.GetSerial.Req
op_assign
l_int|0
suffix:semicolon
id|sync_req.GetSerial.Rc
op_assign
id|IDI_SYNC_REQ_GET_SERIAL
suffix:semicolon
id|sync_req.GetSerial.serial
op_assign
l_int|0
suffix:semicolon
id|card-&gt;d
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|sync_req
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
(paren
(paren
id|sync_req.GetSerial.serial
op_amp
l_int|0xff000000
)paren
op_rshift
l_int|24
)paren
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|serial
comma
l_string|&quot;%ld-%d&quot;
comma
id|sync_req.GetSerial.serial
op_amp
l_int|0x00ffffff
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|serial
comma
l_string|&quot;%ld&quot;
comma
id|sync_req.GetSerial.serial
)paren
suffix:semicolon
)brace
id|serial
(braket
id|CAPI_SERIAL_LEN
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|strlcpy
c_func
(paren
id|ctrl-&gt;serial
comma
id|serial
comma
r_sizeof
(paren
id|ctrl-&gt;serial
)paren
)paren
suffix:semicolon
id|a
op_assign
op_amp
id|adapter
(braket
id|card-&gt;Id
op_minus
l_int|1
)braket
suffix:semicolon
id|card-&gt;adapter
op_assign
id|a
suffix:semicolon
id|a-&gt;os_card
op_assign
id|card
suffix:semicolon
id|ControllerMap
(braket
id|card-&gt;Id
)braket
op_assign
(paren
id|byte
)paren
(paren
id|ctrl-&gt;cnr
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;AddAdapterMap (%d) -&gt; (%d)&quot;
comma
id|ctrl-&gt;cnr
comma
id|card-&gt;Id
)paren
)paren
id|sync_req.xdi_capi_prms.Req
op_assign
l_int|0
suffix:semicolon
id|sync_req.xdi_capi_prms.Rc
op_assign
id|IDI_SYNC_REQ_XDI_GET_CAPI_PARAMS
suffix:semicolon
id|sync_req.xdi_capi_prms.info.structure_length
op_assign
r_sizeof
(paren
id|diva_xdi_get_capi_parameters_t
)paren
suffix:semicolon
id|card-&gt;d
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|sync_req
)paren
suffix:semicolon
id|a-&gt;flag_dynamic_l1_down
op_assign
id|sync_req.xdi_capi_prms.info.flag_dynamic_l1_down
suffix:semicolon
id|a-&gt;group_optimization_enabled
op_assign
id|sync_req.xdi_capi_prms.info.group_optimization_enabled
suffix:semicolon
id|a-&gt;request
op_assign
id|DIRequest
suffix:semicolon
multiline_comment|/* card-&gt;d.request; */
id|a-&gt;max_plci
op_assign
id|card-&gt;d.channels
op_plus
l_int|30
suffix:semicolon
id|a-&gt;max_listen
op_assign
(paren
id|card-&gt;d.channels
OG
l_int|2
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|a-&gt;plci
op_assign
(paren
id|PLCI
op_star
)paren
id|diva_os_malloc
c_func
(paren
l_int|0
comma
r_sizeof
(paren
id|PLCI
)paren
op_star
id|a-&gt;max_plci
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;diva_add_card: failed alloc plci struct.&quot;
)paren
)paren
id|memset
c_func
(paren
id|a
comma
l_int|0
comma
r_sizeof
(paren
id|DIVA_CAPI_ADAPTER
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|a-&gt;plci
comma
l_int|0
comma
r_sizeof
(paren
id|PLCI
)paren
op_star
id|a-&gt;max_plci
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|a-&gt;max_plci
suffix:semicolon
id|k
op_increment
)paren
(brace
id|a-&gt;Id
op_assign
(paren
id|byte
)paren
id|card-&gt;Id
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|Sig.callback
op_assign
id|sync_callback
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|Sig.XNum
op_assign
l_int|1
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|Sig.X
op_assign
id|a-&gt;plci
(braket
id|k
)braket
dot
id|XData
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|Sig.user
(braket
l_int|0
)braket
op_assign
(paren
id|word
)paren
(paren
id|card-&gt;Id
op_minus
l_int|1
)paren
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|Sig.user
(braket
l_int|1
)braket
op_assign
(paren
id|word
)paren
id|k
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|NL.callback
op_assign
id|sync_callback
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|NL.XNum
op_assign
l_int|1
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|NL.X
op_assign
id|a-&gt;plci
(braket
id|k
)braket
dot
id|XData
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|NL.user
(braket
l_int|0
)braket
op_assign
(paren
id|word
)paren
(paren
(paren
id|card-&gt;Id
op_minus
l_int|1
)paren
op_or
l_int|0x8000
)paren
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|NL.user
(braket
l_int|1
)braket
op_assign
(paren
id|word
)paren
id|k
suffix:semicolon
id|a-&gt;plci
(braket
id|k
)braket
dot
id|adapter
op_assign
id|a
suffix:semicolon
)brace
id|a-&gt;profile.Number
op_assign
id|card-&gt;Id
suffix:semicolon
id|a-&gt;profile.Channels
op_assign
id|card-&gt;d.channels
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d.features
op_amp
id|DI_FAX3
)paren
(brace
id|a-&gt;profile.Global_Options
op_assign
l_int|0x71
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d.features
op_amp
id|DI_CODEC
)paren
id|a-&gt;profile.Global_Options
op_or_assign
l_int|0x6
suffix:semicolon
macro_line|#if IMPLEMENT_DTMF
id|a-&gt;profile.Global_Options
op_or_assign
l_int|0x8
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* IMPLEMENT_DTMF */
id|a-&gt;profile.Global_Options
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Line Interconnect */
macro_line|#if IMPLEMENT_ECHO_CANCELLER
id|a-&gt;profile.Global_Options
op_or_assign
l_int|0x100
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* IMPLEMENT_ECHO_CANCELLER */
id|a-&gt;profile.B1_Protocols
op_assign
l_int|0xdf
suffix:semicolon
id|a-&gt;profile.B2_Protocols
op_assign
l_int|0x1fdb
suffix:semicolon
id|a-&gt;profile.B3_Protocols
op_assign
l_int|0xb7
suffix:semicolon
id|a-&gt;manufacturer_features
op_assign
id|MANUFACTURER_FEATURE_HARDDTMF
suffix:semicolon
)brace
r_else
(brace
id|a-&gt;profile.Global_Options
op_assign
l_int|0x71
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;d.features
op_amp
id|DI_CODEC
)paren
id|a-&gt;profile.Global_Options
op_or_assign
l_int|0x2
suffix:semicolon
id|a-&gt;profile.B1_Protocols
op_assign
l_int|0x43
suffix:semicolon
id|a-&gt;profile.B2_Protocols
op_assign
l_int|0x1f0f
suffix:semicolon
id|a-&gt;profile.B3_Protocols
op_assign
l_int|0x07
suffix:semicolon
id|a-&gt;manufacturer_features
op_assign
l_int|0
suffix:semicolon
)brace
id|a-&gt;li_pri
op_assign
(paren
id|a-&gt;profile.Channels
OG
l_int|2
)paren
suffix:semicolon
id|a-&gt;li_channels
op_assign
id|a-&gt;li_pri
ques
c_cond
id|MIXER_CHANNELS_PRI
suffix:colon
id|MIXER_CHANNELS_BRI
suffix:semicolon
id|a-&gt;li_base
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_amp
id|adapter
(braket
id|i
)braket
op_ne
id|a
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter
(braket
id|i
)braket
dot
id|request
)paren
id|a-&gt;li_base
op_assign
id|adapter
(braket
id|i
)braket
dot
id|li_base
op_plus
id|adapter
(braket
id|i
)braket
dot
id|li_channels
suffix:semicolon
)brace
id|k
op_assign
id|li_total_channels
op_plus
id|a-&gt;li_channels
suffix:semicolon
id|new_li_config_table
op_assign
(paren
id|LI_CONFIG
op_star
)paren
id|diva_os_malloc
c_func
(paren
l_int|0
comma
(paren
(paren
id|k
op_star
r_sizeof
(paren
id|LI_CONFIG
)paren
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
op_plus
(paren
l_int|2
op_star
id|k
)paren
op_star
(paren
(paren
id|k
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_li_config_table
op_eq
l_int|NULL
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;diva_add_card: failed alloc li_config table.&quot;
)paren
)paren
id|memset
c_func
(paren
id|a
comma
l_int|0
comma
r_sizeof
(paren
id|DIVA_CAPI_ADAPTER
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Prevent access to line interconnect table in process update */
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;add card&quot;
)paren
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|k
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_ge
id|a-&gt;li_base
)paren
op_logical_and
(paren
id|i
OL
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)paren
)paren
id|memset
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|LI_CONFIG
)paren
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
comma
op_amp
id|li_config_table
(braket
id|j
)braket
comma
r_sizeof
(paren
id|LI_CONFIG
)paren
)paren
suffix:semicolon
id|new_li_config_table
(braket
id|i
)braket
dot
id|flag_table
op_assign
(paren
(paren
id|byte
op_star
)paren
id|new_li_config_table
)paren
op_plus
(paren
(paren
(paren
id|k
op_star
r_sizeof
(paren
id|LI_CONFIG
)paren
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
op_plus
(paren
l_int|2
op_star
id|i
)paren
op_star
(paren
(paren
id|k
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
)paren
suffix:semicolon
id|new_li_config_table
(braket
id|i
)braket
dot
id|coef_table
op_assign
(paren
(paren
id|byte
op_star
)paren
id|new_li_config_table
)paren
op_plus
(paren
(paren
(paren
id|k
op_star
r_sizeof
(paren
id|LI_CONFIG
)paren
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
op_plus
(paren
l_int|2
op_star
id|i
op_plus
l_int|1
)paren
op_star
(paren
(paren
id|k
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ge
id|a-&gt;li_base
)paren
op_logical_and
(paren
id|i
OL
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)paren
)paren
(brace
id|new_li_config_table
(braket
id|i
)braket
dot
id|adapter
op_assign
id|a
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
l_int|0
)braket
comma
l_int|0
comma
id|k
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
l_int|0
)braket
comma
l_int|0
comma
id|k
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|a-&gt;li_base
op_ne
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
l_int|0
)braket
comma
op_amp
id|li_config_table
(braket
id|j
)braket
dot
id|flag_table
(braket
l_int|0
)braket
comma
id|a-&gt;li_base
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
l_int|0
)braket
comma
op_amp
id|li_config_table
(braket
id|j
)braket
dot
id|coef_table
(braket
l_int|0
)braket
comma
id|a-&gt;li_base
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
id|a-&gt;li_base
)braket
comma
l_int|0
comma
id|a-&gt;li_channels
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
id|a-&gt;li_base
)braket
comma
l_int|0
comma
id|a-&gt;li_channels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
OL
id|k
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|flag_table
(braket
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)braket
comma
op_amp
id|li_config_table
(braket
id|j
)braket
dot
id|flag_table
(braket
id|a-&gt;li_base
)braket
comma
id|k
op_minus
(paren
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|new_li_config_table
(braket
id|i
)braket
dot
id|coef_table
(braket
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)braket
comma
op_amp
id|li_config_table
(braket
id|j
)braket
dot
id|coef_table
(braket
id|a-&gt;li_base
)braket
comma
id|k
op_minus
(paren
id|a-&gt;li_base
op_plus
id|a-&gt;li_channels
)paren
)paren
suffix:semicolon
)brace
id|j
op_increment
suffix:semicolon
)brace
)brace
id|li_total_channels
op_assign
id|k
suffix:semicolon
id|mem_to_free
op_assign
id|li_config_table
suffix:semicolon
id|li_config_table
op_assign
id|new_li_config_table
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|card-&gt;Id
suffix:semicolon
id|i
OL
id|max_adapter
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter
(braket
id|i
)braket
dot
id|request
)paren
id|adapter
(braket
id|i
)braket
dot
id|li_base
op_add_assign
id|a-&gt;li_channels
suffix:semicolon
)brace
r_if
c_cond
(paren
id|a
op_eq
op_amp
id|adapter
(braket
id|max_adapter
)braket
)paren
id|max_adapter
op_increment
suffix:semicolon
id|list_add
c_func
(paren
op_amp
(paren
id|card-&gt;list
)paren
comma
op_amp
id|cards
)paren
suffix:semicolon
id|AutomaticLaw
c_func
(paren
id|a
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;add card&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem_to_free
)paren
(brace
id|diva_os_free
(paren
l_int|0
comma
id|mem_to_free
)paren
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
l_int|30
)paren
(brace
r_if
c_cond
(paren
id|a-&gt;automatic_law
OG
l_int|3
)paren
r_break
suffix:semicolon
id|diva_os_sleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
multiline_comment|/* profile information */
id|PUT_WORD
c_func
(paren
op_amp
id|ctrl-&gt;profile.nbchannel
comma
id|card-&gt;d.channels
)paren
suffix:semicolon
id|ctrl-&gt;profile.goptions
op_assign
id|a-&gt;profile.Global_Options
suffix:semicolon
id|ctrl-&gt;profile.support1
op_assign
id|a-&gt;profile.B1_Protocols
suffix:semicolon
id|ctrl-&gt;profile.support2
op_assign
id|a-&gt;profile.B2_Protocols
suffix:semicolon
id|ctrl-&gt;profile.support3
op_assign
id|a-&gt;profile.B3_Protocols
suffix:semicolon
multiline_comment|/* manufacturer profile information */
id|ctrl-&gt;profile.manu
(braket
l_int|0
)braket
op_assign
id|a-&gt;man_profile.private_options
suffix:semicolon
id|ctrl-&gt;profile.manu
(braket
l_int|1
)braket
op_assign
id|a-&gt;man_profile.rtp_primary_payloads
suffix:semicolon
id|ctrl-&gt;profile.manu
(braket
l_int|2
)braket
op_assign
id|a-&gt;man_profile.rtp_additional_payloads
suffix:semicolon
id|ctrl-&gt;profile.manu
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|ctrl-&gt;profile.manu
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|capi_ctr_ready
c_func
(paren
id|ctrl
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;adapter added, max_adapter=%d&quot;
comma
id|max_adapter
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  register appl&n; */
DECL|function|diva_register_appl
r_static
r_void
id|diva_register_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
comma
id|capi_register_params
op_star
id|rp
)paren
(brace
id|APPL
op_star
id|this
suffix:semicolon
id|word
id|bnum
comma
id|xnum
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_void
op_star
id|DataNCCI
comma
op_star
id|DataFlags
comma
op_star
id|ReceiveBuffer
comma
op_star
id|xbuffer_used
suffix:semicolon
r_void
op_star
op_star
id|xbuffer_ptr
comma
op_star
op_star
id|xbuffer_internal
suffix:semicolon
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
r_int
r_int
id|mem_len
suffix:semicolon
r_int
id|nconn
op_assign
id|rp-&gt;level3cnt
suffix:semicolon
r_if
c_cond
(paren
id|diva_os_in_irq
c_func
(paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - in irq context !&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;application register Id=%d&quot;
comma
id|appl
)paren
)paren
r_if
c_cond
(paren
id|appl
OG
id|MAX_APPL
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - appl.Id exceeds MAX_APPL&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nconn
op_le
l_int|0
)paren
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
op_star
op_minus
id|nconn
suffix:semicolon
r_if
c_cond
(paren
id|nconn
op_eq
l_int|0
)paren
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
suffix:semicolon
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - Id = %d&quot;
comma
id|appl
)paren
)paren
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;  MaxLogicalConnections = %d(%d)&quot;
comma
id|nconn
comma
id|rp-&gt;level3cnt
)paren
)paren
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;  MaxBDataBuffers       = %d&quot;
comma
id|rp-&gt;datablkcnt
)paren
)paren
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;  MaxBDataLength        = %d&quot;
comma
id|rp-&gt;datablklen
)paren
)paren
r_if
c_cond
(paren
id|nconn
template_param
l_int|255
op_logical_or
id|rp-&gt;datablklen
template_param
l_int|2150
op_logical_or
id|rp-&gt;datablkcnt
OG
l_int|255
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - invalid parameters&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|application
(braket
id|appl
op_minus
l_int|1
)braket
dot
id|Id
op_eq
id|appl
)paren
(brace
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - appl already registered&quot;
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* appl already registered */
)brace
multiline_comment|/* alloc memory */
id|bnum
op_assign
id|nconn
op_star
id|rp-&gt;datablkcnt
suffix:semicolon
id|xnum
op_assign
id|nconn
op_star
id|MAX_DATA_B3
suffix:semicolon
id|mem_len
op_assign
id|bnum
op_star
r_sizeof
(paren
id|word
)paren
suffix:semicolon
multiline_comment|/* DataNCCI */
id|mem_len
op_add_assign
id|bnum
op_star
r_sizeof
(paren
id|word
)paren
suffix:semicolon
multiline_comment|/* DataFlags */
id|mem_len
op_add_assign
id|bnum
op_star
id|rp-&gt;datablklen
suffix:semicolon
multiline_comment|/* ReceiveBuffer */
id|mem_len
op_add_assign
id|xnum
suffix:semicolon
multiline_comment|/* xbuffer_used */
id|mem_len
op_add_assign
id|xnum
op_star
r_sizeof
(paren
r_void
op_star
)paren
suffix:semicolon
multiline_comment|/* xbuffer_ptr */
id|mem_len
op_add_assign
id|xnum
op_star
r_sizeof
(paren
r_void
op_star
)paren
suffix:semicolon
multiline_comment|/* xbuffer_internal */
id|mem_len
op_add_assign
id|xnum
op_star
id|rp-&gt;datablklen
suffix:semicolon
multiline_comment|/* xbuffer_ptr[xnum] */
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;  Allocated Memory      = %d&quot;
comma
id|mem_len
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|diva_os_malloc
c_func
(paren
l_int|0
comma
id|mem_len
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_REGISTER - memory allocation failed&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
id|mem_len
)paren
suffix:semicolon
id|DataNCCI
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|bnum
op_star
r_sizeof
(paren
id|word
)paren
suffix:semicolon
id|DataFlags
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|bnum
op_star
r_sizeof
(paren
id|word
)paren
suffix:semicolon
id|ReceiveBuffer
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|bnum
op_star
id|rp-&gt;datablklen
suffix:semicolon
id|xbuffer_used
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|xnum
suffix:semicolon
id|xbuffer_ptr
op_assign
(paren
r_void
op_star
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|xnum
op_star
r_sizeof
(paren
r_void
op_star
)paren
suffix:semicolon
id|xbuffer_internal
op_assign
(paren
r_void
op_star
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|xnum
op_star
r_sizeof
(paren
r_void
op_star
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|xnum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|xbuffer_ptr
(braket
id|i
)braket
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|rp-&gt;datablklen
suffix:semicolon
)brace
multiline_comment|/* initialize application data */
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;register_appl&quot;
)paren
suffix:semicolon
id|this
op_assign
op_amp
id|application
(braket
id|appl
op_minus
l_int|1
)braket
suffix:semicolon
id|memset
c_func
(paren
id|this
comma
l_int|0
comma
r_sizeof
(paren
id|APPL
)paren
)paren
suffix:semicolon
id|this-&gt;Id
op_assign
id|appl
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_adapter
suffix:semicolon
id|i
op_increment
)paren
(brace
id|adapter
(braket
id|i
)braket
dot
id|CIP_Mask
(braket
id|appl
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|this-&gt;queue_size
op_assign
l_int|1000
suffix:semicolon
id|this-&gt;MaxNCCI
op_assign
(paren
id|byte
)paren
id|nconn
suffix:semicolon
id|this-&gt;MaxNCCIData
op_assign
(paren
id|byte
)paren
id|rp-&gt;datablkcnt
suffix:semicolon
id|this-&gt;MaxBuffer
op_assign
id|bnum
suffix:semicolon
id|this-&gt;MaxDataLength
op_assign
id|rp-&gt;datablklen
suffix:semicolon
id|this-&gt;DataNCCI
op_assign
id|DataNCCI
suffix:semicolon
id|this-&gt;DataFlags
op_assign
id|DataFlags
suffix:semicolon
id|this-&gt;ReceiveBuffer
op_assign
id|ReceiveBuffer
suffix:semicolon
id|this-&gt;xbuffer_used
op_assign
id|xbuffer_used
suffix:semicolon
id|this-&gt;xbuffer_ptr
op_assign
id|xbuffer_ptr
suffix:semicolon
id|this-&gt;xbuffer_internal
op_assign
id|xbuffer_internal
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|xnum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|this-&gt;xbuffer_ptr
(braket
id|i
)braket
op_assign
id|xbuffer_ptr
(braket
id|i
)braket
suffix:semicolon
)brace
id|CapiRegister
c_func
(paren
id|this-&gt;Id
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;register_appl&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  release appl&n; */
DECL|function|diva_release_appl
r_static
r_void
id|diva_release_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|__u16
id|appl
)paren
(brace
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|APPL
op_star
id|this
op_assign
op_amp
id|application
(braket
id|appl
op_minus
l_int|1
)braket
suffix:semicolon
r_void
op_star
id|mem_to_free
op_assign
l_int|NULL
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;application %d(%d) cleanup&quot;
comma
id|this-&gt;Id
comma
id|appl
)paren
)paren
r_if
c_cond
(paren
id|diva_os_in_irq
c_func
(paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_RELEASE - in irq context !&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;release_appl&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;Id
)paren
(brace
id|CapiRelease
c_func
(paren
id|this-&gt;Id
)paren
suffix:semicolon
id|mem_to_free
op_assign
id|this-&gt;DataNCCI
suffix:semicolon
id|this-&gt;DataNCCI
op_assign
l_int|NULL
suffix:semicolon
id|this-&gt;Id
op_assign
l_int|0
suffix:semicolon
)brace
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;release_appl&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem_to_free
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|mem_to_free
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  send message&n; */
DECL|function|diva_send_message
r_static
id|u16
id|diva_send_message
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|diva_os_message_buffer_s
op_star
id|dmb
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|word
id|ret
op_assign
l_int|0
suffix:semicolon
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
id|CAPI_MSG
op_star
id|msg
op_assign
(paren
id|CAPI_MSG
op_star
)paren
id|DIVA_MESSAGE_BUFFER_DATA
c_func
(paren
id|dmb
)paren
suffix:semicolon
id|APPL
op_star
id|this
op_assign
op_amp
id|application
(braket
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;header.appl_id
)paren
op_minus
l_int|1
)braket
suffix:semicolon
id|diva_card
op_star
id|card
op_assign
id|ctrl-&gt;driverdata
suffix:semicolon
id|__u32
id|length
op_assign
id|DIVA_MESSAGE_BUFFER_LEN
c_func
(paren
id|dmb
)paren
suffix:semicolon
id|word
id|clength
op_assign
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;header.length
)paren
suffix:semicolon
id|word
id|command
op_assign
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;header.command
)paren
suffix:semicolon
id|u16
id|retval
op_assign
id|CAPI_NOERROR
suffix:semicolon
r_if
c_cond
(paren
id|diva_os_in_irq
c_func
(paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_SEND_MSG - in irq context !&quot;
)paren
)paren
r_return
id|CAPI_REGOSRESOURCEERR
suffix:semicolon
)brace
id|DBG_PRV1
c_func
(paren
(paren
l_string|&quot;Write - appl = %d, cmd = 0x%x&quot;
comma
id|this-&gt;Id
comma
id|command
)paren
)paren
r_if
c_cond
(paren
id|card-&gt;remove_in_progress
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;CAPI_SEND_MSG - remove in progress!&quot;
)paren
)paren
r_return
id|CAPI_REGOSRESOURCEERR
suffix:semicolon
)brace
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;send message&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|this-&gt;Id
)paren
(brace
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;send message&quot;
)paren
suffix:semicolon
r_return
id|CAPI_ILLAPPNR
suffix:semicolon
)brace
multiline_comment|/* patch controller number */
id|msg-&gt;header.controller
op_assign
id|ControllerMap
(braket
id|card-&gt;Id
)braket
op_or
(paren
id|msg-&gt;header.controller
op_amp
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* preserve external controller bit */
r_switch
c_cond
(paren
id|command
)paren
(brace
r_default
suffix:colon
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
id|msg
comma
l_int|0x80
comma
id|clength
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_DATA_B3_I
op_or
id|RESPONSE
suffix:colon
macro_line|#ifndef DIVA_NO_DEBUGLIB
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_BLK
)paren
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
id|msg
comma
l_int|0x80
comma
id|clength
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|_DATA_B3_R
suffix:colon
macro_line|#ifndef DIVA_NO_DEBUGLIB
r_if
c_cond
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_BLK
)paren
id|xlog
c_func
(paren
l_string|&quot;&bslash;x00&bslash;x02&quot;
comma
id|msg
comma
l_int|0x80
comma
id|clength
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|clength
op_eq
l_int|24
)paren
id|clength
op_assign
l_int|22
suffix:semicolon
multiline_comment|/* workaround for PPcom bug */
multiline_comment|/* header is always 22      */
r_if
c_cond
(paren
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
OG
id|this-&gt;MaxDataLength
op_logical_or
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
OG
(paren
id|length
op_minus
id|clength
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Write - invalid message size&quot;
)paren
)paren
id|retval
op_assign
id|CAPI_ILLCMDORSUBCMDORMSGTOSMALL
suffix:semicolon
r_goto
id|write_end
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|MAX_DATA_B3
op_star
id|this-&gt;MaxNCCI
)paren
op_logical_and
id|this-&gt;xbuffer_used
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
(paren
id|MAX_DATA_B3
op_star
id|this-&gt;MaxNCCI
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Write - too many data pending&quot;
)paren
)paren
id|retval
op_assign
id|CAPI_SENDQUEUEFULL
suffix:semicolon
r_goto
id|write_end
suffix:semicolon
)brace
id|msg-&gt;info.data_b3_req.Data
op_assign
id|i
suffix:semicolon
id|this-&gt;xbuffer_internal
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|memcpy
c_func
(paren
id|this-&gt;xbuffer_ptr
(braket
id|i
)braket
comma
op_amp
(paren
(paren
id|__u8
op_star
)paren
id|msg
)paren
(braket
id|clength
)braket
comma
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
)paren
suffix:semicolon
macro_line|#ifndef DIVA_NO_DEBUGLIB
r_if
c_cond
(paren
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_BLK
)paren
op_logical_and
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_XLOG
)paren
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
suffix:semicolon
id|j
op_add_assign
l_int|256
)paren
(brace
id|DBG_BLK
c_func
(paren
(paren
(paren
(paren
r_char
op_star
)paren
id|this-&gt;xbuffer_ptr
(braket
id|i
)braket
)paren
op_plus
id|j
comma
(paren
(paren
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
op_minus
id|j
)paren
OL
l_int|256
)paren
ques
c_cond
(paren
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;info.data_b3_req.Data_Length
)paren
op_minus
id|j
)paren
suffix:colon
l_int|256
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_PRV0
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* not more if not explicitely requested */
)brace
)brace
macro_line|#endif
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|mapped_msg
comma
id|msg
comma
(paren
id|__u32
)paren
id|clength
)paren
suffix:semicolon
id|mapped_msg-&gt;header.controller
op_assign
id|MapController
c_func
(paren
id|mapped_msg-&gt;header.controller
)paren
suffix:semicolon
id|mapped_msg-&gt;header.length
op_assign
id|clength
suffix:semicolon
id|mapped_msg-&gt;header.command
op_assign
id|command
suffix:semicolon
id|mapped_msg-&gt;header.number
op_assign
id|GET_WORD
c_func
(paren
op_amp
id|msg-&gt;header.number
)paren
suffix:semicolon
id|ret
op_assign
id|api_put
c_func
(paren
id|this
comma
id|mapped_msg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
id|_BAD_MSG
suffix:colon
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Write - bad message&quot;
)paren
)paren
id|retval
op_assign
id|CAPI_ILLCMDORSUBCMDORMSGTOSMALL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_QUEUE_FULL
suffix:colon
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Write - queue full&quot;
)paren
)paren
id|retval
op_assign
id|CAPI_SENDQUEUEFULL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Write - api_put returned unknown error&quot;
)paren
)paren
id|retval
op_assign
id|CAPI_UNKNOWNNOTPAR
suffix:semicolon
r_break
suffix:semicolon
)brace
id|write_end
suffix:colon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;send message&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
id|CAPI_NOERROR
)paren
id|diva_os_free_message_buffer
c_func
(paren
id|dmb
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * cards request function&n; */
DECL|function|DIRequest
r_static
r_void
id|DIRequest
c_func
(paren
id|ENTITY
op_star
id|e
)paren
(brace
id|DIVA_CAPI_ADAPTER
op_star
id|a
op_assign
op_amp
(paren
id|adapter
(braket
(paren
id|byte
)paren
id|e-&gt;user
(braket
l_int|0
)braket
)braket
)paren
suffix:semicolon
id|diva_card
op_star
id|os_card
op_assign
(paren
id|diva_card
op_star
)paren
id|a-&gt;os_card
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;Req
op_logical_and
(paren
id|a-&gt;FlowControlIdTable
(braket
id|e-&gt;ReqCh
)braket
op_eq
id|e-&gt;Id
)paren
)paren
(brace
id|a-&gt;FlowControlSkipTable
(braket
id|e-&gt;ReqCh
)braket
op_assign
l_int|1
suffix:semicolon
)brace
(paren
op_star
(paren
id|os_card-&gt;d.request
)paren
)paren
(paren
id|e
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * callback function from didd&n; */
DECL|function|didd_callback
r_static
r_void
id|didd_callback
c_func
(paren
r_void
op_star
id|context
comma
id|DESCRIPTOR
op_star
id|adapter
comma
r_int
id|removal
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;type
op_eq
id|IDI_DADAPTER
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Notification about IDI_DADAPTER change ! Oops.&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adapter-&gt;type
op_eq
id|IDI_DIMAINT
)paren
(brace
r_if
c_cond
(paren
id|removal
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|MAdapter
comma
id|adapter
comma
r_sizeof
(paren
id|MAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
(paren
id|DIVA_DI_PRINTF
)paren
id|MAdapter.request
suffix:semicolon
id|DbgRegister
c_func
(paren
l_string|&quot;CAPI20&quot;
comma
id|DRIVERRELEASE_CAPI
comma
id|DBG_DEFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|adapter-&gt;type
OG
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;type
OL
l_int|16
)paren
)paren
(brace
multiline_comment|/* IDI Adapter */
r_if
c_cond
(paren
id|removal
)paren
(brace
id|divacapi_remove_card
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
r_else
(brace
id|diva_add_card
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * connect to didd&n; */
DECL|function|divacapi_connect_didd
r_static
r_int
id|divacapi_connect_didd
c_func
(paren
r_void
)paren
(brace
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
id|dadapter
op_assign
l_int|0
suffix:semicolon
id|IDI_SYNC_REQ
id|req
suffix:semicolon
id|DESCRIPTOR
id|DIDD_Table
(braket
id|MAX_DESCRIPTORS
)braket
suffix:semicolon
id|DIVA_DIDD_Read
c_func
(paren
id|DIDD_Table
comma
r_sizeof
(paren
id|DIDD_Table
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|MAX_DESCRIPTORS
suffix:semicolon
id|x
op_increment
)paren
(brace
r_if
c_cond
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
op_eq
id|IDI_DIMAINT
)paren
(brace
multiline_comment|/* MAINT found */
id|memcpy
c_func
(paren
op_amp
id|MAdapter
comma
op_amp
id|DIDD_Table
(braket
id|x
)braket
comma
r_sizeof
(paren
id|DAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
(paren
id|DIVA_DI_PRINTF
)paren
id|MAdapter.request
suffix:semicolon
id|DbgRegister
c_func
(paren
l_string|&quot;CAPI20&quot;
comma
id|DRIVERRELEASE_CAPI
comma
id|DBG_DEFAULT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|MAX_DESCRIPTORS
suffix:semicolon
id|x
op_increment
)paren
(brace
r_if
c_cond
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
op_eq
id|IDI_DADAPTER
)paren
(brace
multiline_comment|/* DADAPTER found */
id|dadapter
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|DAdapter
comma
op_amp
id|DIDD_Table
(braket
id|x
)braket
comma
r_sizeof
(paren
id|DAdapter
)paren
)paren
suffix:semicolon
id|req.didd_notify.e.Req
op_assign
l_int|0
suffix:semicolon
id|req.didd_notify.e.Rc
op_assign
id|IDI_SYNC_REQ_DIDD_REGISTER_ADAPTER_NOTIFY
suffix:semicolon
id|req.didd_notify.info.callback
op_assign
(paren
r_void
op_star
)paren
id|didd_callback
suffix:semicolon
id|req.didd_notify.info.context
op_assign
l_int|NULL
suffix:semicolon
id|DAdapter
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req.didd_notify.e.Rc
op_ne
l_int|0xff
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|notify_handle
op_assign
id|req.didd_notify.info.handle
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
OG
l_int|0
)paren
op_logical_and
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
OL
l_int|16
)paren
)paren
(brace
multiline_comment|/* IDI Adapter found */
id|diva_add_card
c_func
(paren
op_amp
id|DIDD_Table
(braket
id|x
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dadapter
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
(paren
id|dadapter
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * diconnect from didd&n; */
DECL|function|divacapi_disconnect_didd
r_static
r_void
id|divacapi_disconnect_didd
c_func
(paren
r_void
)paren
(brace
id|IDI_SYNC_REQ
id|req
suffix:semicolon
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
id|req.didd_notify.e.Req
op_assign
l_int|0
suffix:semicolon
id|req.didd_notify.e.Rc
op_assign
id|IDI_SYNC_REQ_DIDD_REMOVE_ADAPTER_NOTIFY
suffix:semicolon
id|req.didd_notify.info.handle
op_assign
id|notify_handle
suffix:semicolon
id|DAdapter
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|req
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * we do not provide date/time here,&n; * the application should do this. &n; */
DECL|function|fax_head_line_time
r_int
id|fax_head_line_time
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * init (alloc) main structures&n; */
DECL|function|init_main_structs
r_static
r_int
id|DIVA_INIT_FUNCTION
id|init_main_structs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mapped_msg
op_assign
(paren
id|CAPI_MSG
op_star
)paren
id|diva_os_malloc
c_func
(paren
l_int|0
comma
id|MAX_MSG_SIZE
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;init: failed alloc mapped_msg.&quot;
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_assign
id|diva_os_malloc
c_func
(paren
l_int|0
comma
r_sizeof
(paren
id|DIVA_CAPI_ADAPTER
)paren
op_star
id|MAX_DESCRIPTORS
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;init: failed alloc adapter struct.&quot;
)paren
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|mapped_msg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|adapter
comma
l_int|0
comma
r_sizeof
(paren
id|DIVA_CAPI_ADAPTER
)paren
op_star
id|MAX_DESCRIPTORS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|application
op_assign
id|diva_os_malloc
c_func
(paren
l_int|0
comma
r_sizeof
(paren
id|APPL
)paren
op_star
id|MAX_APPL
)paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;init: failed alloc application struct.&quot;
)paren
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|mapped_msg
)paren
suffix:semicolon
id|diva_os_free
c_func
(paren
l_int|0
comma
id|adapter
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|application
comma
l_int|0
comma
r_sizeof
(paren
id|APPL
)paren
op_star
id|MAX_APPL
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * remove (free) main structures&n; */
DECL|function|remove_main_structs
r_static
r_void
id|remove_main_structs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|application
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|application
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mapped_msg
)paren
id|diva_os_free
c_func
(paren
l_int|0
comma
id|mapped_msg
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * api_remove_start&n; */
DECL|function|do_api_remove_start
r_static
r_void
id|do_api_remove_start
c_func
(paren
r_void
)paren
(brace
id|diva_os_spin_lock_magic_t
id|old_irql
suffix:semicolon
r_int
id|ret
op_assign
l_int|1
comma
id|count
op_assign
l_int|100
suffix:semicolon
r_do
(brace
id|diva_os_enter_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;api remove start&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|api_remove_start
c_func
(paren
)paren
suffix:semicolon
id|diva_os_leave_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
op_amp
id|old_irql
comma
l_string|&quot;api remove start&quot;
)paren
suffix:semicolon
id|diva_os_sleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ret
op_logical_and
id|count
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;could not remove signaling ID&squot;s&quot;
)paren
)paren
)brace
multiline_comment|/*&n; * init&n; */
DECL|function|init_capifunc
r_int
id|DIVA_INIT_FUNCTION
id|init_capifunc
c_func
(paren
r_void
)paren
(brace
id|diva_os_initialize_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
l_string|&quot;capifunc&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ControllerMap
comma
l_int|0
comma
id|MAX_DESCRIPTORS
op_plus
l_int|1
)paren
suffix:semicolon
id|max_adapter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_main_structs
c_func
(paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;init: failed to init main structs.&quot;
)paren
)paren
id|diva_os_destroy_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
l_string|&quot;capifunc&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|divacapi_connect_didd
c_func
(paren
)paren
)paren
(brace
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;init: failed to connect to DIDD.&quot;
)paren
)paren
id|do_api_remove_start
c_func
(paren
)paren
suffix:semicolon
id|divacapi_remove_cards
c_func
(paren
)paren
suffix:semicolon
id|remove_main_structs
c_func
(paren
)paren
suffix:semicolon
id|diva_os_destroy_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
l_string|&quot;capifunc&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * finit&n; */
DECL|function|finit_capifunc
r_void
id|DIVA_EXIT_FUNCTION
id|finit_capifunc
c_func
(paren
r_void
)paren
(brace
id|do_api_remove_start
c_func
(paren
)paren
suffix:semicolon
id|divacapi_disconnect_didd
c_func
(paren
)paren
suffix:semicolon
id|divacapi_remove_cards
c_func
(paren
)paren
suffix:semicolon
id|remove_main_structs
c_func
(paren
)paren
suffix:semicolon
id|diva_os_destroy_spin_lock
c_func
(paren
op_amp
id|api_lock
comma
l_string|&quot;capifunc&quot;
)paren
suffix:semicolon
)brace
eof
