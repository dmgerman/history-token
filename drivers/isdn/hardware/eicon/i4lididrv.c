multiline_comment|/* $Id: i4lididrv.c,v 1.1.2.2 2002/10/02 14:38:37 armin Exp $&n; *&n; * ISDN interface module for Eicon active cards.&n; * I4L - IDI Interface&n; * &n; * Copyright 1998-2000 by Armin Schindler (mac@melware.de) &n; * Copyright 1999-2002 Cytronics &amp; Melware (info@melware.de)&n; * &n; * Thanks to&t;Deutsche Mailbox Saar-Lor-Lux GmbH&n; *&t;&t;for sponsoring and testing fax&n; *&t;&t;capabilities with Diva Server cards.&n; *&t;&t;(dor@deutschemailbox.de)&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &quot;i4lididrv.h&quot;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &quot;divasync.h&quot;
macro_line|#include &quot;../avmb1/capicmd.h&quot;  /* this should be moved in a common place */
DECL|macro|INCLUDE_INLINE_FUNCS
mdefine_line|#define INCLUDE_INLINE_FUNCS
DECL|variable|cards
r_static
id|eicon_card
op_star
id|cards
op_assign
(paren
id|eicon_card
op_star
)paren
l_int|NULL
suffix:semicolon
multiline_comment|/* glob. var , contains&n;                                                     start of card-list   */
DECL|variable|DRIVERNAME
r_static
r_char
op_star
id|DRIVERNAME
op_assign
l_string|&quot;Eicon Diva - native I4L Interface driver (http://www.melware.net)&quot;
suffix:semicolon
DECL|variable|DRIVERLNAME
r_static
r_char
op_star
id|DRIVERLNAME
op_assign
l_string|&quot;diva2i4l&quot;
suffix:semicolon
DECL|variable|DRIVERRELEASE
r_static
r_char
op_star
id|DRIVERRELEASE
op_assign
l_string|&quot;2.0&quot;
suffix:semicolon
DECL|variable|eicon_revision
r_static
r_char
op_star
id|eicon_revision
op_assign
l_string|&quot;$Revision: 1.1.2.2 $&quot;
suffix:semicolon
r_extern
r_char
op_star
id|eicon_idi_revision
suffix:semicolon
DECL|macro|EICON_CTRL_VERSION
mdefine_line|#define EICON_CTRL_VERSION 2
DECL|variable|DebugVar
id|ulong
id|DebugVar
suffix:semicolon
DECL|variable|status_lock
r_static
id|spinlock_t
id|status_lock
suffix:semicolon
DECL|variable|ll_lock
r_static
id|spinlock_t
id|ll_lock
suffix:semicolon
DECL|macro|MAX_DESCRIPTORS
mdefine_line|#define MAX_DESCRIPTORS  32
r_extern
r_void
id|DIVA_DIDD_Read
c_func
(paren
id|DESCRIPTOR
op_star
comma
r_int
)paren
suffix:semicolon
DECL|variable|notify_handle
r_static
id|dword
id|notify_handle
suffix:semicolon
DECL|variable|DAdapter
r_static
id|DESCRIPTOR
id|DAdapter
suffix:semicolon
DECL|variable|MAdapter
r_static
id|DESCRIPTOR
id|MAdapter
suffix:semicolon
multiline_comment|/* Parameter to be set by insmod */
DECL|variable|id
r_static
r_char
op_star
id|id
op_assign
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ISDN4Linux Interface for Eicon active card driver&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Armin Schindler&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;ISDN subsystem and Eicon active card driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID-String for ISDN4Linux&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Initial debug value&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|no_printf
r_void
id|no_printf
(paren
r_int
r_char
op_star
id|x
comma
dot
dot
dot
)paren
(brace
multiline_comment|/* dummy debug function */
)brace
DECL|variable|dprintf
id|DIVA_DI_PRINTF
id|dprintf
op_assign
id|no_printf
suffix:semicolon
DECL|macro|DBG_MINIMUM
mdefine_line|#define DBG_MINIMUM  (DL_LOG + DL_FTL + DL_ERR)
DECL|macro|DBG_DEFAULT
mdefine_line|#define DBG_DEFAULT  (DBG_MINIMUM + DL_XLOG + DL_REG)
macro_line|#include &quot;debuglib.c&quot;
r_static
r_char
op_star
DECL|function|eicon_getrev
id|eicon_getrev
c_func
(paren
r_const
r_char
op_star
id|revision
)paren
(brace
r_char
op_star
id|rev
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
id|rev
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
op_star
op_decrement
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|rev
op_assign
l_string|&quot;1.0&quot;
suffix:semicolon
r_return
id|rev
suffix:semicolon
)brace
r_static
r_void
DECL|function|stop_dbg
id|stop_dbg
c_func
(paren
r_void
)paren
(brace
id|DbgDeregister
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|MAdapter
comma
l_int|0
comma
r_sizeof
(paren
id|MAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
id|no_printf
suffix:semicolon
)brace
r_static
id|eicon_chan
op_star
DECL|function|find_channel
id|find_channel
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
(paren
id|channel
op_ge
l_int|0
)paren
op_logical_and
(paren
id|channel
OL
id|card-&gt;nchannels
)paren
)paren
r_return
op_amp
(paren
id|card-&gt;bch
(braket
id|channel
)braket
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: Invalid channel %d&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|channel
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_void
DECL|function|eicon_rx_request
id|eicon_rx_request
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|skb2
comma
op_star
id|skb_new
suffix:semicolon
id|eicon_IND
op_star
id|ind
comma
op_star
id|ind2
comma
op_star
id|ind_new
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: NULL card in rcv_dispatch !&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
)paren
)paren
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan
op_assign
id|card-&gt;IdTable
(braket
id|ind-&gt;IndId
)braket
)paren
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|ind-&gt;Ind
)paren
(brace
r_case
id|N_DISC_ACK
suffix:colon
multiline_comment|/* doesn&squot;t matter if this happens */
r_break
suffix:semicolon
r_default
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi: Indication for unknown channel Ind=%d Id=%x&bslash;n&quot;
comma
id|ind-&gt;Ind
comma
id|ind-&gt;IndId
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;idi_hdl: Ch??: Ind=%d Id=%x Ch=%d MInd=%d MLen=%d Len=%d&bslash;n&quot;
comma
id|ind-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|ind-&gt;IndCh
comma
id|ind-&gt;MInd
comma
id|ind-&gt;MLength
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
)brace
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan-&gt;e.complete
)paren
(brace
multiline_comment|/* check for rec-buffer chaining */
r_if
c_cond
(paren
id|ind-&gt;MLength
op_eq
id|ind-&gt;RBuffer.length
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|1
suffix:semicolon
id|idi_handle_ind
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;e.complete
op_assign
l_int|0
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|ind-&gt;MInd
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.R
comma
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.R
)paren
)paren
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|1
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: buffer incomplete, but 0 in queue&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ind2
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb2-&gt;data
suffix:semicolon
id|skb_new
op_assign
id|alloc_skb
c_func
(paren
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_minus
l_int|1
)paren
op_plus
id|ind-&gt;RBuffer.length
op_plus
id|ind2-&gt;RBuffer.length
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_new
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: skb_alloc failed in rcv_dispatch()&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ind_new
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb_new
comma
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_minus
l_int|1
)paren
op_plus
id|ind-&gt;RBuffer.length
op_plus
id|ind2-&gt;RBuffer.length
)paren
)paren
suffix:semicolon
id|ind_new-&gt;Ind
op_assign
id|ind2-&gt;Ind
suffix:semicolon
id|ind_new-&gt;IndId
op_assign
id|ind2-&gt;IndId
suffix:semicolon
id|ind_new-&gt;IndCh
op_assign
id|ind2-&gt;IndCh
suffix:semicolon
id|ind_new-&gt;MInd
op_assign
id|ind2-&gt;MInd
suffix:semicolon
id|ind_new-&gt;MLength
op_assign
id|ind2-&gt;MLength
suffix:semicolon
id|ind_new-&gt;RBuffer.length
op_assign
id|ind2-&gt;RBuffer.length
op_plus
id|ind-&gt;RBuffer.length
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ind_new-&gt;RBuffer.P
comma
op_amp
id|ind2-&gt;RBuffer.P
comma
id|ind2-&gt;RBuffer.length
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_amp
id|ind_new-&gt;RBuffer.P
)paren
op_plus
id|ind2-&gt;RBuffer.length
comma
op_amp
id|ind-&gt;RBuffer.P
comma
id|ind-&gt;RBuffer.length
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ind-&gt;MLength
op_eq
id|ind-&gt;RBuffer.length
)paren
(brace
id|chan-&gt;e.complete
op_assign
l_int|2
suffix:semicolon
id|idi_handle_ind
c_func
(paren
id|card
comma
id|skb_new
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;e.complete
op_assign
l_int|0
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|chan-&gt;e.R
comma
id|skb_new
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_void
DECL|function|eicon_ack_request
id|eicon_ack_request
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: NULL card in ack_dispatch!&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
)paren
)paren
(brace
id|idi_handle_ack
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  IDI-Callback function&n; */
r_static
r_void
DECL|function|eicon_idi_callback
id|eicon_idi_callback
c_func
(paren
id|ENTITY
op_star
id|de
)paren
(brace
id|eicon_card
op_star
id|ccard
op_assign
(paren
id|eicon_card
op_star
)paren
id|de-&gt;R
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|eicon_RC
op_star
id|ack
suffix:semicolon
id|eicon_IND
op_star
id|ind
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;complete
op_eq
l_int|255
)paren
(brace
multiline_comment|/* Return Code */
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
id|eicon_RC
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;%s: skb_alloc failed in _idi_callback()&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
)brace
r_else
(brace
id|ack
op_assign
(paren
id|eicon_RC
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|eicon_RC
)paren
)paren
suffix:semicolon
id|ack-&gt;Rc
op_assign
id|de-&gt;Rc
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;Rc
op_eq
id|ASSIGN_OK
)paren
(brace
id|ack-&gt;RcId
op_assign
id|de-&gt;Id
suffix:semicolon
id|de-&gt;user
(braket
l_int|1
)braket
op_assign
id|de-&gt;Id
suffix:semicolon
)brace
r_else
(brace
id|ack-&gt;RcId
op_assign
id|de-&gt;user
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|ack-&gt;RcCh
op_assign
id|de-&gt;RcCh
suffix:semicolon
id|ack-&gt;Reference
op_assign
id|de-&gt;user
(braket
l_int|0
)braket
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rackq
comma
id|skb
)paren
suffix:semicolon
id|eicon_ack_request
c_func
(paren
id|ccard
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_cbk: Ch%d: Rc=%x Id=%x RLen=%x compl=%x&bslash;n&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;idi_cbk: Ch%d: Rc=%x Id=%x RLen=%x compl=%x&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Rc
comma
id|ack-&gt;RcId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
)paren
id|de-&gt;Rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Indication */
r_if
c_cond
(paren
id|de-&gt;complete
)paren
(brace
id|len
op_assign
id|de-&gt;RLength
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
l_int|270
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;RLength
op_le
l_int|270
)paren
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;idi_cbk: ind not complete but &lt;= 270&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|1
comma
l_string|&quot;%s: skb_alloc failed in _idi_callback()&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
)brace
r_else
(brace
id|ind
op_assign
(paren
id|eicon_IND
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
(paren
r_sizeof
(paren
id|eicon_IND
)paren
op_plus
id|len
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ind-&gt;Ind
op_assign
id|de-&gt;Ind
suffix:semicolon
id|ind-&gt;IndId
op_assign
id|de-&gt;user
(braket
l_int|1
)braket
suffix:semicolon
id|ind-&gt;IndCh
op_assign
id|de-&gt;IndCh
suffix:semicolon
id|ind-&gt;MInd
op_assign
id|de-&gt;Ind
suffix:semicolon
id|ind-&gt;RBuffer.length
op_assign
id|len
suffix:semicolon
id|ind-&gt;MLength
op_assign
id|de-&gt;RLength
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ind-&gt;RBuffer.P
comma
op_amp
id|de-&gt;RBuffer-&gt;P
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ccard-&gt;rcvq
comma
id|skb
)paren
suffix:semicolon
id|eicon_rx_request
c_func
(paren
id|ccard
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|ccard
comma
l_int|128
comma
l_string|&quot;idi_cbk: Ch%d: Ind=%x Id=%x RLen=%x compl=%x&bslash;n&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;idi_cbk: Ch%d: Ind=%x Id=%x RLen=%x compl=%x&quot;
comma
id|de-&gt;user
(braket
l_int|0
)braket
comma
id|de-&gt;Ind
comma
id|ind-&gt;IndId
comma
id|de-&gt;RLength
comma
id|de-&gt;complete
)paren
)paren
id|de-&gt;Ind
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|de-&gt;RNum
op_assign
l_int|0
suffix:semicolon
id|de-&gt;RNR
op_assign
l_int|0
suffix:semicolon
id|eicon_tx_request
c_func
(paren
id|ccard
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;**  Kernel thread to prevent in_interrupt&n;*/
r_static
id|DECLARE_TASK_QUEUE
c_func
(paren
id|tq_divad
)paren
suffix:semicolon
DECL|variable|diva_thread_sem
r_static
r_struct
id|semaphore
id|diva_thread_sem
suffix:semicolon
DECL|variable|diva_thread_end
r_static
r_struct
id|semaphore
id|diva_thread_end
suffix:semicolon
DECL|variable|divad_pid
r_static
r_int
id|divad_pid
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_int
id|divad_thread
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|diva_tx
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|variable|thread_running
r_static
id|atomic_t
id|thread_running
suffix:semicolon
r_static
r_void
id|__init
DECL|function|diva_init_thread
id|diva_init_thread
c_func
(paren
r_void
)paren
(brace
r_int
id|pid
op_assign
l_int|0
suffix:semicolon
id|pid
op_assign
id|kernel_thread
c_func
(paren
id|divad_thread
comma
l_int|NULL
comma
id|CLONE_FS
op_or
id|CLONE_FILES
op_or
id|CLONE_SIGHAND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_ge
l_int|0
)paren
(brace
id|divad_pid
op_assign
id|pid
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|divad_thread
id|divad_thread
c_func
(paren
r_void
op_star
id|data
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|thread_running
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|thread_running
)paren
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: thread already running&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: thread started with pid %d&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|current-&gt;pid
)paren
suffix:semicolon
id|exit_mm
c_func
(paren
id|current
)paren
suffix:semicolon
id|exit_files
c_func
(paren
id|current
)paren
suffix:semicolon
id|exit_fs
c_func
(paren
id|current
)paren
suffix:semicolon
multiline_comment|/* Set to RealTime */
id|current-&gt;policy
op_assign
id|SCHED_FIFO
suffix:semicolon
id|current-&gt;rt_priority
op_assign
l_int|33
suffix:semicolon
id|strcpy
c_func
(paren
id|current-&gt;comm
comma
l_string|&quot;kdiva2i4ld&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|down_interruptible
c_func
(paren
op_amp
id|diva_thread_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|atomic_read
c_func
(paren
op_amp
id|thread_running
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|flush_signals
c_func
(paren
id|current
)paren
suffix:semicolon
)brace
r_else
(brace
id|run_task_queue
c_func
(paren
op_amp
id|tq_divad
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|diva_thread_end
)paren
suffix:semicolon
id|divad_pid
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|stop_diva_thread
id|stop_diva_thread
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|divad_pid
op_ge
l_int|0
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|thread_running
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|diva_thread_sem
)paren
suffix:semicolon
id|down_interruptible
c_func
(paren
op_amp
id|diva_thread_end
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|eicon_tx_request
id|eicon_tx_request
c_func
(paren
r_struct
id|eicon_card
op_star
id|card
)paren
(brace
id|card-&gt;tq.routine
op_assign
id|diva_tx
suffix:semicolon
id|card-&gt;tq.data
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|card-&gt;tq
comma
op_amp
id|tq_divad
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|diva_thread_sem
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|diva_tx
id|diva_tx
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|eicon_card
op_star
id|card
op_assign
(paren
id|eicon_card
op_star
)paren
id|data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|eicon_chan_ptr
op_star
id|chan2
suffix:semicolon
id|eicon_REQ
op_star
id|reqbuf
op_assign
l_int|0
suffix:semicolon
r_int
id|ReqCount
op_assign
l_int|0
suffix:semicolon
r_int
id|tmpid
op_assign
l_int|0
suffix:semicolon
r_int
id|quloop
op_assign
l_int|1
suffix:semicolon
r_int
id|dlev
op_assign
l_int|0
suffix:semicolon
id|ENTITY
op_star
id|ep
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: NULL card in transmit !&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ReqCount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
)paren
)paren
id|quloop
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|quloop
)paren
(brace
id|chan2
op_assign
(paren
id|eicon_chan_ptr
op_star
)paren
id|skb2-&gt;data
suffix:semicolon
id|chan
op_assign
id|chan2-&gt;ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.busy
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|chan-&gt;e.X
)paren
)paren
)paren
(brace
id|reqbuf
op_assign
(paren
id|eicon_REQ
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reqbuf-&gt;Reference
)paren
op_logical_and
(paren
id|chan-&gt;e.B2Id
op_eq
l_int|0
)paren
op_logical_and
(paren
id|reqbuf-&gt;ReqId
op_amp
l_int|0x1f
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|16
comma
l_string|&quot;%s: transmit: error Id=0 on %d (Net)&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
r_else
(brace
id|dlev
op_assign
l_int|160
suffix:semicolon
r_if
c_cond
(paren
id|reqbuf-&gt;ReqId
op_amp
l_int|0x1f
)paren
(brace
multiline_comment|/* if this is no ASSIGN */
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
(brace
multiline_comment|/* Signal Layer */
id|ep
op_assign
op_amp
id|chan-&gt;de
suffix:semicolon
id|tmpid
op_assign
id|chan-&gt;e.D3Id
suffix:semicolon
id|chan-&gt;e.ReqCh
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Net Layer */
id|ep
op_assign
op_amp
id|chan-&gt;be
suffix:semicolon
id|tmpid
op_assign
id|chan-&gt;e.B2Id
suffix:semicolon
id|chan-&gt;e.ReqCh
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|reqbuf-&gt;Req
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x08
)paren
op_logical_or
(paren
(paren
id|reqbuf-&gt;Req
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x01
)paren
)paren
(brace
multiline_comment|/* Send Data */
id|chan-&gt;waitq
op_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|chan-&gt;waitpq
op_add_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|dlev
op_assign
l_int|128
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* It is an ASSIGN */
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
id|ep
op_assign
op_amp
id|chan-&gt;de
suffix:semicolon
r_else
id|ep
op_assign
op_amp
id|chan-&gt;be
suffix:semicolon
id|ep-&gt;Id
op_assign
id|reqbuf-&gt;ReqId
suffix:semicolon
id|tmpid
op_assign
id|reqbuf-&gt;ReqId
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|reqbuf-&gt;Reference
)paren
id|chan-&gt;e.ReqCh
op_assign
l_int|0
suffix:semicolon
r_else
id|chan-&gt;e.ReqCh
op_assign
l_int|1
suffix:semicolon
)brace
id|chan-&gt;e.ref
op_assign
id|chan-&gt;No
suffix:semicolon
id|chan-&gt;e.Req
op_assign
id|reqbuf-&gt;Req
suffix:semicolon
id|ReqCount
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ep
)paren
(brace
id|ep-&gt;callback
op_assign
id|eicon_idi_callback
suffix:semicolon
id|ep-&gt;R
op_assign
(paren
id|BUFFERS
op_star
)paren
id|card
suffix:semicolon
id|ep-&gt;user
(braket
l_int|0
)braket
op_assign
(paren
id|word
)paren
id|chan-&gt;No
suffix:semicolon
id|ep-&gt;user
(braket
l_int|1
)braket
op_assign
(paren
id|word
)paren
id|tmpid
suffix:semicolon
id|ep-&gt;XNum
op_assign
l_int|1
suffix:semicolon
id|ep-&gt;RNum
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;RNR
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;Rc
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;Ind
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;X-&gt;PLength
op_assign
id|reqbuf-&gt;XBuffer.length
suffix:semicolon
id|memcpy
c_func
(paren
id|ep-&gt;X-&gt;P
comma
op_amp
id|reqbuf-&gt;XBuffer.P
comma
id|reqbuf-&gt;XBuffer.length
)paren
suffix:semicolon
id|ep-&gt;ReqCh
op_assign
id|reqbuf-&gt;ReqCh
suffix:semicolon
id|ep-&gt;Req
op_assign
id|reqbuf-&gt;Req
suffix:semicolon
)brace
id|chan-&gt;e.busy
op_assign
l_int|1
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
id|dlev
comma
l_string|&quot;idi: Req=%d Id=%x Ch=%d Len=%d Ref=%d&bslash;n&quot;
comma
id|reqbuf-&gt;Req
comma
id|tmpid
comma
id|reqbuf-&gt;ReqCh
comma
id|reqbuf-&gt;XBuffer.length
comma
id|chan-&gt;e.ref
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep
)paren
(brace
id|card-&gt;d
dot
id|request
c_func
(paren
id|ep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;Rc
)paren
id|eicon_idi_callback
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sackq
comma
id|skb2
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;%s: transmit: busy chan %d&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
)paren
)paren
id|quloop
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
)paren
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;sndq
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|eicon_command
id|eicon_command
c_func
(paren
id|eicon_card
op_star
id|card
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|ulong
id|a
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|16
comma
l_string|&quot;%s_cmd 0x%x with arg 0x%lx (0x%lx)&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|c-&gt;command
comma
id|c-&gt;arg
comma
(paren
id|ulong
)paren
op_star
id|c-&gt;parm.num
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_CMD_IOCTL
suffix:colon
id|memcpy
c_func
(paren
op_amp
id|a
comma
id|c-&gt;parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;arg
)paren
(brace
r_case
id|EICON_IOCTL_GETVER
suffix:colon
r_return
id|EICON_CTRL_VERSION
suffix:semicolon
r_case
id|EICON_IOCTL_MANIF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;d.features
op_amp
id|DI_MANAGE
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|ret
op_assign
id|eicon_idi_manage
c_func
(paren
id|card
comma
(paren
id|eicon_manifbuf
op_star
)paren
id|a
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|EICON_IOCTL_GETXLOG
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|EICON_IOCTL_DEBUGVAR
suffix:colon
id|DebugVar
op_assign
id|a
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: Debug Value set to %ld&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|DebugVar
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EICON_IOCTL_LOADPCI
suffix:colon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: Wrong version of load-utility,&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: re-compile eiconctrl !&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: Maybe update of utility is necessary !&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_NULL
)paren
op_logical_and
(paren
id|chan-&gt;fsm_state
op_ne
id|EICON_STATE_LISTEN
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: Dial on channel %d with state %d&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|chan-&gt;No
comma
id|chan-&gt;fsm_state
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chan-&gt;fsm_state
op_assign
id|EICON_STATE_OCALL
suffix:semicolon
id|ret
op_assign
id|idi_connect_req
c_func
(paren
id|card
comma
id|chan
comma
id|c-&gt;parm.setup.phone
comma
id|c-&gt;parm.setup.eazmsn
comma
id|c-&gt;parm.setup.si1
comma
id|c-&gt;parm.setup.si2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_DHUP
suffix:semicolon
id|cmd.arg
op_and_assign
l_int|0x1f
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ICALL
)paren
(brace
id|idi_connect_res
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|idi_hangup
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0x3ff
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;eazmask
op_assign
l_int|0
suffix:semicolon
id|eicon_idi_listen_req
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETL2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l2prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|chan-&gt;a_para
comma
id|c-&gt;parm.aux.para
comma
r_sizeof
(paren
id|chan-&gt;a_para
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|chan-&gt;l3prot
op_assign
(paren
id|c-&gt;arg
op_rshift
l_int|8
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l3prot
op_eq
id|ISDN_PROTO_L3_FCLASS2
)paren
(brace
id|chan-&gt;fax
op_assign
id|c-&gt;parm.fax
suffix:semicolon
id|eicon_log
c_func
(paren
id|card
comma
l_int|128
comma
l_string|&quot;idi_cmd: Ch%d: SETL3 struct fax=0x%x&bslash;n&quot;
comma
id|chan-&gt;No
comma
id|chan-&gt;fax
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_case
id|ISDN_CMD_FAXCMD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;fax
)paren
r_break
suffix:semicolon
id|idi_fax_cmd
c_func
(paren
id|card
comma
id|chan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_case
id|ISDN_CMD_AUDIO
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
id|idi_audio_cmd
c_func
(paren
id|card
comma
id|chan
comma
id|c-&gt;arg
op_rshift
l_int|8
comma
id|c-&gt;parm.num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|CAPI_PUT_MESSAGE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|c-&gt;arg
op_amp
l_int|0x1f
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;parm.cmsg.Length
OL
l_int|8
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;parm.cmsg.Command
)paren
(brace
r_case
id|CAPI_FACILITY
suffix:colon
r_if
c_cond
(paren
id|c-&gt;parm.cmsg.Subcommand
op_eq
id|CAPI_REQ
)paren
r_return
id|capipmsg
c_func
(paren
id|card
comma
id|chan
comma
op_amp
id|c-&gt;parm.cmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPI_MANUFACTURER
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|find_free_number
id|find_free_number
c_func
(paren
r_void
)paren
(brace
r_int
id|num
op_assign
l_int|0
suffix:semicolon
r_char
id|cid
(braket
l_int|40
)braket
suffix:semicolon
id|eicon_card
op_star
id|p
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|num
OL
l_int|100
)paren
(brace
id|sprintf
c_func
(paren
id|cid
comma
l_string|&quot;%s%d&quot;
comma
id|id
comma
id|num
)paren
suffix:semicolon
id|num
op_increment
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;regname
comma
id|cid
)paren
)paren
r_break
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|num
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|999
suffix:semicolon
)brace
multiline_comment|/*&n; * Find card with given driverId&n; */
r_static
r_inline
id|eicon_card
op_star
DECL|function|eicon_findcard
id|eicon_findcard
c_func
(paren
r_int
id|driverid
)paren
(brace
id|eicon_card
op_star
id|p
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;myid
op_eq
id|driverid
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|eicon_card
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Wrapper functions for interface to linklevel&n; */
r_static
r_int
DECL|function|if_command
id|if_command
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|c-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
r_return
(paren
id|eicon_command
c_func
(paren
id|card
comma
id|c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: if_command %d called with invalid driverId %d!&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|c-&gt;command
comma
id|c-&gt;driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_writecmd
id|if_writecmd
c_func
(paren
r_const
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
multiline_comment|/* Not used */
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_readstatus
id|if_readstatus
c_func
(paren
id|u_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|user
comma
r_int
id|id
comma
r_int
id|channel
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
id|u_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;statq
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb-&gt;len
op_plus
id|count
)paren
OG
id|len
)paren
id|cnt
op_assign
id|len
op_minus
id|count
suffix:semicolon
r_else
id|cnt
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
id|copy_to_user
c_func
(paren
id|p
comma
id|skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|p
comma
id|skb-&gt;data
comma
id|cnt
)paren
suffix:semicolon
id|count
op_add_assign
id|cnt
suffix:semicolon
id|p
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_eq
id|skb-&gt;len
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;statq_entries
OG
l_int|0
)paren
id|card-&gt;statq_entries
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|skb_pull
c_func
(paren
id|skb
comma
id|cnt
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|card-&gt;statq
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
)brace
id|card-&gt;statq_entries
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: if_readstatus called with invalid driverId!&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|if_sendbuf
id|if_sendbuf
c_func
(paren
r_int
id|id
comma
r_int
id|channel
comma
r_int
id|ack
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|eicon_card
op_star
id|card
op_assign
id|eicon_findcard
c_func
(paren
id|id
)paren
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;flags
op_amp
id|EICON_FLAGS_RUNNING
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan
op_assign
id|find_channel
c_func
(paren
id|card
comma
id|channel
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;fsm_state
op_eq
id|EICON_STATE_ACTIVE
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_TTY_FAX
r_if
c_cond
(paren
id|chan-&gt;l2prot
op_eq
id|ISDN_PROTO_L2_FAX
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|idi_faxdata_send
c_func
(paren
id|card
comma
id|chan
comma
id|skb
)paren
)paren
OG
l_int|0
)paren
id|ret
op_assign
id|len
suffix:semicolon
)brace
r_else
macro_line|#endif
id|ret
op_assign
id|idi_send_data
c_func
(paren
id|card
comma
id|chan
comma
id|ack
comma
id|skb
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: if_sendbuf called with invalid driverId!&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* jiftime() copied from HiSax */
DECL|function|jiftime
r_static
r_inline
r_int
id|jiftime
c_func
(paren
r_char
op_star
id|s
comma
r_int
id|mark
)paren
(brace
id|s
op_add_assign
l_int|8
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;.&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|6
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|6
suffix:semicolon
op_star
id|s
op_decrement
op_assign
l_char|&squot;:&squot;
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
id|mark
op_div_assign
l_int|10
suffix:semicolon
op_star
id|s
op_decrement
op_assign
id|mark
op_mod
l_int|10
op_plus
l_char|&squot;0&squot;
suffix:semicolon
r_return
l_int|8
suffix:semicolon
)brace
r_void
DECL|function|eicon_putstatus
id|eicon_putstatus
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|count
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
id|cards
)paren
)paren
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|count
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: could not alloc skb in putstatus&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|card-&gt;statq
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;statq_entries
op_ge
id|MAX_STATUS_BUFFER
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|card-&gt;statq
)paren
)paren
)paren
(brace
id|count
op_sub_assign
id|skb-&gt;len
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|card-&gt;statq_entries
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|status_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
id|cmd.command
op_assign
id|ISDN_STAT_STAVAIL
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
id|count
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Debug and Log &n; */
r_void
DECL|function|eicon_log
id|eicon_log
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|level
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_char
id|Line
(braket
l_int|160
)braket
suffix:semicolon
id|u_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|DebugVar
op_amp
id|level
)paren
op_logical_or
(paren
id|DebugVar
op_amp
l_int|256
)paren
)paren
(brace
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DebugVar
op_amp
id|level
)paren
(brace
r_if
c_cond
(paren
id|DebugVar
op_amp
l_int|256
)paren
(brace
multiline_comment|/* log-buffer */
id|p
op_assign
id|Line
suffix:semicolon
id|p
op_add_assign
id|jiftime
c_func
(paren
id|p
comma
id|jiffies
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|32
suffix:semicolon
id|p
op_add_assign
id|vsprintf
c_func
(paren
id|p
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|eicon_putstatus
c_func
(paren
id|card
comma
id|Line
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* printk, syslogd */
id|vsprintf
c_func
(paren
id|Line
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&quot;
comma
id|Line
)paren
suffix:semicolon
)brace
)brace
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Allocate a new card-struct, initialize it&n; * link it into cards-list.&n; */
r_static
r_void
DECL|function|eicon_alloccard
id|eicon_alloccard
c_func
(paren
id|DESCRIPTOR
op_star
id|d
)paren
(brace
r_int
id|j
suffix:semicolon
r_char
id|cid
(braket
l_int|40
)braket
suffix:semicolon
id|eicon_card
op_star
id|card
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|sprintf
c_func
(paren
id|cid
comma
l_string|&quot;%s%d&quot;
comma
id|id
comma
id|find_free_number
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card
op_assign
(paren
id|eicon_card
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_card
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: (%s) Could not allocate card-struct.&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_card
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;statq
)paren
suffix:semicolon
id|card-&gt;statq_entries
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface.owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|card-&gt;interface.maxbufsize
op_assign
l_int|4000
suffix:semicolon
id|card-&gt;interface.command
op_assign
id|if_command
suffix:semicolon
id|card-&gt;interface.writebuf_skb
op_assign
id|if_sendbuf
suffix:semicolon
id|card-&gt;interface.writecmd
op_assign
id|if_writecmd
suffix:semicolon
id|card-&gt;interface.readstat
op_assign
id|if_readstatus
suffix:semicolon
id|card-&gt;interface.features
op_assign
id|ISDN_FEATURE_L2_X75I
op_or
id|ISDN_FEATURE_L2_HDLC
op_or
id|ISDN_FEATURE_L2_TRANS
op_or
id|ISDN_FEATURE_L3_TRANS
op_or
id|ISDN_FEATURE_L3_TRANSDSP
op_or
id|ISDN_FEATURE_P_UNKNOWN
suffix:semicolon
id|card-&gt;interface.hl_hdrlen
op_assign
l_int|20
suffix:semicolon
id|card-&gt;ptype
op_assign
id|ISDN_PTYPE_UNKNOWN
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;interface.id
comma
id|cid
)paren
suffix:semicolon
id|card-&gt;myid
op_assign
op_minus
l_int|1
suffix:semicolon
id|card-&gt;type
op_assign
id|d-&gt;type
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;features
op_amp
(paren
id|DI_FAX3
op_or
id|DI_EXTD_FAX
)paren
)paren
id|card-&gt;interface.features
op_or_assign
(paren
id|ISDN_FEATURE_L2_FAX
op_or
id|ISDN_FEATURE_L3_FCLASS2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;features
op_amp
id|DI_MODEM
)paren
id|card-&gt;interface.features
op_or_assign
id|ISDN_FEATURE_L2_MODEM
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;features
op_amp
id|DI_V110
)paren
id|card-&gt;interface.features
op_or_assign
(paren
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
)paren
suffix:semicolon
id|card-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|card-&gt;nchannels
op_assign
id|d-&gt;channels
suffix:semicolon
id|card-&gt;interface.channels
op_assign
id|d-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;bch
op_assign
(paren
id|eicon_chan
op_star
)paren
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|eicon_chan
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: (%s) Could not allocate bch-struct.&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|eicon_chan
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|statectrl
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l2prot
op_assign
id|ISDN_PROTO_L2_X75I
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|l3prot
op_assign
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.D3Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.B2Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.Req
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|No
op_assign
id|j
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|tskb1
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|tskb2
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.X
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.R
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;dbuf
op_assign
(paren
id|DBUFFER
op_star
)paren
id|kmalloc
c_func
(paren
(paren
r_sizeof
(paren
id|DBUFFER
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: (%s) Could not allocate DBUFFER-struct.&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;sbuf
op_assign
(paren
id|BUFFERS
op_star
)paren
id|kmalloc
c_func
(paren
(paren
r_sizeof
(paren
id|BUFFERS
)paren
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: (%s) Could not allocate BUFFERS-struct.&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;sbufp
op_assign
(paren
r_char
op_star
)paren
id|kmalloc
c_func
(paren
(paren
l_int|270
op_star
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|eicon_log
c_func
(paren
id|card
comma
l_int|1
comma
l_string|&quot;%s: (%s) Could not allocate BUFFERSP-struct.&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;sbuf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|DBUFFER
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.RBuffer
op_assign
(paren
id|DBUFFER
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.RBuffer
op_assign
(paren
id|DBUFFER
op_star
)paren
op_amp
id|card-&gt;dbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.X
op_assign
(paren
id|BUFFERS
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|BUFFERS
)paren
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.X
op_assign
(paren
id|BUFFERS
op_star
)paren
op_amp
id|card-&gt;sbuf
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
)braket
comma
l_int|0
comma
l_int|270
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|de.X-&gt;P
op_assign
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
op_star
l_int|270
)braket
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)braket
comma
l_int|0
comma
l_int|270
)paren
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|be.X-&gt;P
op_assign
(paren
r_char
op_star
)paren
op_amp
id|card-&gt;sbufp
(braket
(paren
id|j
op_plus
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
)paren
op_star
l_int|270
)braket
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|card-&gt;d
comma
id|d
comma
r_sizeof
(paren
op_star
id|d
)paren
)paren
suffix:semicolon
multiline_comment|/* DESCRIPTOR entries */
multiline_comment|/* initializing some variables */
id|card-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|card-&gt;ReadyInt
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|256
suffix:semicolon
id|j
op_increment
)paren
(brace
id|card-&gt;IdTable
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|card-&gt;d.channels
op_plus
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.busy
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.D3Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.B2Id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.ref
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.Req
op_assign
l_int|0
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|e.complete
op_assign
l_int|1
suffix:semicolon
id|card-&gt;bch
(braket
id|j
)braket
dot
id|fsm_state
op_assign
id|EICON_STATE_NULL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: registered card &squot;%s&squot; with %d channels&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|cid
comma
id|d-&gt;channels
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;next
op_assign
id|cards
suffix:semicolon
id|cards
op_assign
id|card
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * register card at linklevel&n; */
r_static
r_int
DECL|function|eicon_registercard
id|eicon_registercard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|register_isdn
c_func
(paren
op_amp
id|card-&gt;interface
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to register %s&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;myid
op_assign
id|card-&gt;interface.channels
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;regname
comma
l_string|&quot;%s&quot;
comma
id|card-&gt;interface.id
)paren
suffix:semicolon
multiline_comment|/* after register we start it */
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_LOADED
suffix:semicolon
id|card-&gt;flags
op_or_assign
id|EICON_FLAGS_RUNNING
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_STAT_RUN
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|cmd.arg
op_assign
l_int|0
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|unregister_card
id|unregister_card
c_func
(paren
id|eicon_card
op_star
id|card
comma
r_int
id|rme
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
id|channel
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|eicon_chan
op_star
id|chan
suffix:semicolon
r_if
c_cond
(paren
id|rme
)paren
(brace
multiline_comment|/* before unload we need to remove the signal entity */
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|card-&gt;nchannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
id|chan
op_assign
op_amp
(paren
id|card-&gt;bch
(braket
id|channel
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;e.D3Id
)paren
(brace
id|idi_do_req
c_func
(paren
id|card
comma
id|chan
comma
id|REMOVE
comma
l_int|0
)paren
suffix:semicolon
id|count
op_assign
l_int|100
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chan-&gt;e.D3Id
)paren
r_break
suffix:semicolon
id|SLEEP
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ch:%d unlink to diva module not successful !&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|chan-&gt;No
)paren
suffix:semicolon
)brace
)brace
)brace
id|cmd.command
op_assign
id|ISDN_STAT_UNLOAD
suffix:semicolon
id|cmd.driver
op_assign
id|card-&gt;myid
suffix:semicolon
id|card-&gt;interface
dot
id|statcallb
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;channel entities freed&quot;
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|eicon_freecard
id|eicon_freecard
c_func
(paren
id|eicon_card
op_star
id|card
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|card-&gt;nchannels
op_plus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|i
)braket
dot
id|e.X
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;bch
(braket
id|i
)braket
dot
id|e.R
)paren
suffix:semicolon
)brace
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;sndq
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;rcvq
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;rackq
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;sackq
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|card-&gt;statq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;sbufp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;sbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;dbuf
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|card-&gt;bch
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;card structures freed&quot;
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|eicon_addcard
id|eicon_addcard
c_func
(paren
id|DESCRIPTOR
op_star
id|d
)paren
(brace
id|eicon_card
op_star
id|p
suffix:semicolon
id|eicon_card
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_int
id|registered
suffix:semicolon
r_int
id|added
op_assign
l_int|0
suffix:semicolon
r_int
id|failed
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|eicon_alloccard
c_func
(paren
id|d
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
id|registered
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;interface.statcallb
)paren
(brace
multiline_comment|/* Not yet registered.&n;&t;&t;&t; * Try to register and activate it.&n;&t;&t;&t; */
id|added
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eicon_registercard
c_func
(paren
id|p
)paren
)paren
id|registered
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Card already registered */
id|registered
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|registered
)paren
(brace
multiline_comment|/* Init OK, next card ... */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* registering failed, remove card from list, free memory */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Initialization of %s failed&bslash;n&quot;
comma
id|DRIVERLNAME
comma
id|p-&gt;interface.id
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
)paren
(brace
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|q-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|cards
op_assign
id|p-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|cards
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|failed
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
id|added
op_minus
id|failed
)paren
suffix:semicolon
)brace
r_static
r_void
op_star
DECL|function|didd_callback
id|didd_callback
c_func
(paren
r_void
op_star
id|context
comma
id|DESCRIPTOR
op_star
id|adapter
comma
r_int
id|removal
)paren
(brace
id|eicon_card
op_star
id|cp
op_assign
l_int|NULL
comma
op_star
id|lastcp
op_assign
l_int|NULL
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;type
op_eq
id|IDI_DADAPTER
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Change in DAdapter ? Oops ?.&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|DBG_ERR
c_func
(paren
(paren
l_string|&quot;Notification about IDI_DADAPTER change ! Oops.&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adapter-&gt;type
op_eq
id|IDI_DIMAINT
)paren
(brace
r_if
c_cond
(paren
id|removal
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|MAdapter
comma
id|adapter
comma
r_sizeof
(paren
id|MAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
(paren
id|DIVA_DI_PRINTF
)paren
id|MAdapter.request
suffix:semicolon
id|DbgRegister
c_func
(paren
l_string|&quot;I4L&quot;
comma
id|DRIVERRELEASE
comma
id|DBG_DEFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|adapter-&gt;type
OG
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;type
OL
l_int|16
)paren
)paren
(brace
multiline_comment|/* IDI Adapter */
r_if
c_cond
(paren
id|removal
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|lastcp
op_assign
id|cp
op_assign
id|cards
suffix:semicolon
r_while
c_loop
(paren
id|cp
)paren
(brace
r_if
c_cond
(paren
id|cp-&gt;d.request
op_eq
id|adapter-&gt;request
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;remove adapter from list&quot;
)paren
)paren
suffix:semicolon
id|unregister_card
c_func
(paren
id|cp
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp
op_eq
id|lastcp
)paren
id|cards
op_assign
id|cp-&gt;next
suffix:semicolon
r_else
id|lastcp-&gt;next
op_assign
id|cp-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lastcp
op_assign
id|cp
suffix:semicolon
id|cp
op_assign
id|cp-&gt;next
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|adapter-&gt;channels
)paren
(brace
id|DBG_LOG
c_func
(paren
(paren
l_string|&quot;add adapter to list&quot;
)paren
)paren
suffix:semicolon
id|eicon_addcard
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|connect_didd
id|connect_didd
c_func
(paren
r_void
)paren
(brace
r_int
id|x
op_assign
l_int|0
suffix:semicolon
r_int
id|dadapter
op_assign
l_int|0
suffix:semicolon
id|IDI_SYNC_REQ
id|req
suffix:semicolon
id|DESCRIPTOR
id|DIDD_Table
(braket
id|MAX_DESCRIPTORS
)braket
suffix:semicolon
id|DIVA_DIDD_Read
c_func
(paren
id|DIDD_Table
comma
r_sizeof
(paren
id|DIDD_Table
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|MAX_DESCRIPTORS
suffix:semicolon
id|x
op_increment
)paren
(brace
r_if
c_cond
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
op_eq
id|IDI_DADAPTER
)paren
(brace
multiline_comment|/* DADAPTER found */
id|dadapter
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|DAdapter
comma
op_amp
id|DIDD_Table
(braket
id|x
)braket
comma
r_sizeof
(paren
id|DAdapter
)paren
)paren
suffix:semicolon
id|req.didd_notify.e.Req
op_assign
l_int|0
suffix:semicolon
id|req.didd_notify.e.Rc
op_assign
id|IDI_SYNC_REQ_DIDD_REGISTER_ADAPTER_NOTIFY
suffix:semicolon
id|req.didd_notify.info.callback
op_assign
id|didd_callback
suffix:semicolon
id|req.didd_notify.info.context
op_assign
l_int|0
suffix:semicolon
id|DAdapter
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req.didd_notify.e.Rc
op_ne
l_int|0xff
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|notify_handle
op_assign
id|req.didd_notify.info.handle
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
op_eq
id|IDI_DIMAINT
)paren
(brace
multiline_comment|/* MAINT found */
id|memcpy
c_func
(paren
op_amp
id|MAdapter
comma
op_amp
id|DIDD_Table
(braket
id|x
)braket
comma
r_sizeof
(paren
id|DAdapter
)paren
)paren
suffix:semicolon
id|dprintf
op_assign
(paren
id|DIVA_DI_PRINTF
)paren
id|MAdapter.request
suffix:semicolon
id|DbgRegister
c_func
(paren
l_string|&quot;I4L&quot;
comma
id|DRIVERRELEASE
comma
id|DBG_DEFAULT
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
OG
l_int|0
)paren
op_logical_and
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|type
OL
l_int|16
)paren
)paren
(brace
multiline_comment|/* IDI Adapter found */
r_if
c_cond
(paren
id|DIDD_Table
(braket
id|x
)braket
dot
id|channels
)paren
(brace
id|eicon_addcard
c_func
(paren
op_amp
id|DIDD_Table
(braket
id|x
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dadapter
)paren
(brace
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|dadapter
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|disconnect_didd
id|disconnect_didd
c_func
(paren
r_void
)paren
(brace
id|IDI_SYNC_REQ
id|req
suffix:semicolon
id|stop_dbg
c_func
(paren
)paren
suffix:semicolon
id|req.didd_notify.e.Req
op_assign
l_int|0
suffix:semicolon
id|req.didd_notify.e.Rc
op_assign
id|IDI_SYNC_REQ_DIDD_REMOVE_ADAPTER_NOTIFY
suffix:semicolon
id|req.didd_notify.info.handle
op_assign
id|notify_handle
suffix:semicolon
id|DAdapter
dot
id|request
c_func
(paren
(paren
id|ENTITY
op_star
)paren
op_amp
id|req
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** proc entry&n;*/
r_extern
r_struct
id|proc_dir_entry
op_star
id|proc_net_isdn_eicon
suffix:semicolon
DECL|variable|i4lidi_proc_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|i4lidi_proc_entry
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
DECL|function|i4lidi_proc_read
id|i4lidi_proc_read
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
id|tmprev
(braket
l_int|32
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;name     : %s&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;release  : %s&bslash;n&quot;
comma
id|DRIVERRELEASE
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_revision
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;revision : %s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_idi_revision
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|create_proc
id|create_proc
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|i4lidi_proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|DRIVERLNAME
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|proc_net_isdn_eicon
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to create proc entry.&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|i4lidi_proc_entry-&gt;read_proc
op_assign
id|i4lidi_proc_read
suffix:semicolon
id|i4lidi_proc_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|remove_proc
id|remove_proc
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|i4lidi_proc_entry
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|DRIVERLNAME
comma
id|proc_net_isdn_eicon
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;** load / unload&n;*/
r_static
r_int
id|__init
DECL|function|i4l_idi_init
id|i4l_idi_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_char
id|tmprev
(braket
l_int|50
)braket
suffix:semicolon
id|status_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ll_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|id
)paren
OL
l_int|1
)paren
id|strcpy
c_func
(paren
id|id
comma
l_string|&quot;diva&quot;
)paren
suffix:semicolon
id|DebugVar
op_assign
id|debug
suffix:semicolon
id|init_MUTEX_LOCKED
c_func
(paren
op_amp
id|diva_thread_sem
)paren
suffix:semicolon
id|init_MUTEX_LOCKED
c_func
(paren
op_amp
id|diva_thread_end
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|DRIVERNAME
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Rel:%s  Rev:&quot;
comma
id|DRIVERLNAME
comma
id|DRIVERRELEASE
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s/&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|tmprev
comma
id|eicon_idi_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|eicon_getrev
c_func
(paren
id|tmprev
)paren
)paren
suffix:semicolon
id|diva_init_thread
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|connect_didd
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to connect to DIDD.&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
id|stop_diva_thread
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|create_proc
c_func
(paren
)paren
suffix:semicolon
id|out
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|i4l_idi_exit
id|i4l_idi_exit
c_func
(paren
r_void
)paren
(brace
id|eicon_card
op_star
id|card
comma
op_star
id|last
comma
op_star
id|cc
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|cc
op_assign
id|cards
suffix:semicolon
id|card
op_assign
id|cc
suffix:semicolon
id|cards
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ll_lock
comma
id|flags
)paren
suffix:semicolon
id|remove_proc
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|unregister_card
c_func
(paren
id|card
comma
l_int|1
)paren
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
)brace
id|stop_diva_thread
c_func
(paren
)paren
suffix:semicolon
id|disconnect_didd
c_func
(paren
)paren
suffix:semicolon
id|card
op_assign
id|cc
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|last
op_assign
id|card
suffix:semicolon
id|card
op_assign
id|card-&gt;next
suffix:semicolon
id|eicon_freecard
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: module unloaded.&bslash;n&quot;
comma
id|DRIVERLNAME
)paren
suffix:semicolon
)brace
DECL|variable|i4l_idi_init
id|module_init
c_func
(paren
id|i4l_idi_init
)paren
suffix:semicolon
DECL|variable|i4l_idi_exit
id|module_exit
c_func
(paren
id|i4l_idi_exit
)paren
suffix:semicolon
eof
