multiline_comment|/*&n; *&n;  Copyright (c) Eicon Networks, 2002.&n; *&n;  This source file is supplied for the use with&n;  Eicon Networks range of DIVA Server Adapters.&n; *&n;  Eicon File Revision :    2.1&n; *&n;  This program is free software; you can redistribute it and/or modify&n;  it under the terms of the GNU General Public License as published by&n;  the Free Software Foundation; either version 2, or (at your option)&n;  any later version.&n; *&n;  This program is distributed in the hope that it will be useful,&n;  but WITHOUT ANY WARRANTY OF ANY KIND WHATSOEVER INCLUDING ANY&n;  implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n;  See the GNU General Public License for more details.&n; *&n;  You should have received a copy of the GNU General Public License&n;  along with this program; if not, write to the Free Software&n;  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; */
macro_line|#include &quot;debuglib.h&quot;
macro_line|#ifdef DIVA_NO_DEBUGLIB
DECL|variable|dprintf
r_static
id|DIVA_DI_PRINTF
id|dprintf
suffix:semicolon
macro_line|#else /* DIVA_NO_DEBUGLIB */
DECL|variable|myDriverDebugHandle
id|_DbgHandle_
id|myDriverDebugHandle
op_assign
(brace
l_int|0
multiline_comment|/*!Registered*/
comma
id|DBG_HANDLE_VERSION
)brace
suffix:semicolon
DECL|variable|dprintf
id|DIVA_DI_PRINTF
id|dprintf
op_assign
id|no_printf
suffix:semicolon
multiline_comment|/*****************************************************************************/
DECL|macro|DBG_FUNC
mdefine_line|#define DBG_FUNC(name) &bslash;&n;void  &bslash;&n;myDbgPrint_##name (char *format, ...) &bslash;&n;{ va_list ap ; &bslash;&n; if ( myDriverDebugHandle.dbg_prt ) &bslash;&n; { va_start (ap, format) ; &bslash;&n;  (myDriverDebugHandle.dbg_prt) &bslash;&n;   (myDriverDebugHandle.id, DLI_##name, format, ap) ; &bslash;&n;  va_end (ap) ; &bslash;&n;} }
DECL|function|DBG_FUNC
id|DBG_FUNC
c_func
(paren
id|LOG
)paren
id|DBG_FUNC
c_func
(paren
id|FTL
)paren
id|DBG_FUNC
c_func
(paren
id|ERR
)paren
id|DBG_FUNC
c_func
(paren
id|TRC
)paren
id|DBG_FUNC
c_func
(paren
id|MXLOG
)paren
id|DBG_FUNC
c_func
(paren
id|FTL_MXLOG
)paren
r_void
id|myDbgPrint_EVL
(paren
r_int
id|msgID
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_ev
)paren
(brace
id|va_start
(paren
id|ap
comma
id|msgID
)paren
suffix:semicolon
(paren
id|myDriverDebugHandle.dbg_ev
)paren
(paren
id|myDriverDebugHandle.id
comma
(paren
r_int
r_int
)paren
id|msgID
comma
id|ap
)paren
suffix:semicolon
id|va_end
(paren
id|ap
)paren
suffix:semicolon
)brace
)brace
DECL|function|DBG_FUNC
id|DBG_FUNC
c_func
(paren
id|REG
)paren
id|DBG_FUNC
c_func
(paren
id|MEM
)paren
id|DBG_FUNC
c_func
(paren
id|SPL
)paren
id|DBG_FUNC
c_func
(paren
id|IRP
)paren
id|DBG_FUNC
c_func
(paren
id|TIM
)paren
id|DBG_FUNC
c_func
(paren
id|BLK
)paren
id|DBG_FUNC
c_func
(paren
id|TAPI
)paren
id|DBG_FUNC
c_func
(paren
id|NDIS
)paren
id|DBG_FUNC
c_func
(paren
id|CONN
)paren
id|DBG_FUNC
c_func
(paren
id|STAT
)paren
id|DBG_FUNC
c_func
(paren
id|SEND
)paren
id|DBG_FUNC
c_func
(paren
id|RECV
)paren
id|DBG_FUNC
c_func
(paren
id|PRV0
)paren
id|DBG_FUNC
c_func
(paren
id|PRV1
)paren
id|DBG_FUNC
c_func
(paren
id|PRV2
)paren
id|DBG_FUNC
c_func
(paren
id|PRV3
)paren
multiline_comment|/*****************************************************************************/
r_int
id|DbgRegister
(paren
r_char
op_star
id|drvName
comma
r_char
op_star
id|drvTag
comma
r_int
r_int
id|dbgMask
)paren
(brace
r_int
id|len
suffix:semicolon
multiline_comment|/*&n; * deregister (if already registered) and zero out myDriverDebugHandle&n; */
id|DbgDeregister
(paren
)paren
suffix:semicolon
multiline_comment|/*&n; * initialize the debug handle&n; */
id|myDriverDebugHandle.Version
op_assign
id|DBG_HANDLE_VERSION
suffix:semicolon
id|myDriverDebugHandle.id
op_assign
op_minus
l_int|1
suffix:semicolon
id|myDriverDebugHandle.dbgMask
op_assign
id|dbgMask
op_or
(paren
id|DL_EVL
op_or
id|DL_FTL
op_or
id|DL_LOG
)paren
suffix:semicolon
id|len
op_assign
id|strlen
(paren
id|drvName
)paren
suffix:semicolon
id|memcpy
(paren
id|myDriverDebugHandle.drvName
comma
id|drvName
comma
(paren
id|len
OL
r_sizeof
(paren
id|myDriverDebugHandle.drvName
)paren
)paren
ques
c_cond
id|len
suffix:colon
r_sizeof
(paren
id|myDriverDebugHandle.drvName
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|len
op_assign
id|strlen
(paren
id|drvTag
)paren
suffix:semicolon
id|memcpy
(paren
id|myDriverDebugHandle.drvTag
comma
id|drvTag
comma
(paren
id|len
OL
r_sizeof
(paren
id|myDriverDebugHandle.drvTag
)paren
)paren
ques
c_cond
id|len
suffix:colon
r_sizeof
(paren
id|myDriverDebugHandle.drvTag
)paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n; * Try to register debugging via old (and only) interface&n; */
id|dprintf
c_func
(paren
l_string|&quot;&bslash;000&bslash;377&quot;
comma
op_amp
id|myDriverDebugHandle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_prt
)paren
(brace
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Check if we registered whith an old maint driver (see debuglib.h)&n; */
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_end
op_ne
l_int|NULL
multiline_comment|/* location of &squot;dbg_prt&squot; in _OldDbgHandle_ struct */
op_logical_and
(paren
id|myDriverDebugHandle.regTime.LowPart
op_logical_or
id|myDriverDebugHandle.regTime.HighPart
)paren
)paren
multiline_comment|/* same location as in _OldDbgHandle_ struct */
(brace
id|dprintf
c_func
(paren
l_string|&quot;%s: Cannot log to old maint driver !&quot;
comma
id|drvName
)paren
suffix:semicolon
id|myDriverDebugHandle.dbg_end
op_assign
(paren
(paren
id|_OldDbgHandle_
op_star
)paren
op_amp
id|myDriverDebugHandle
)paren
op_member_access_from_pointer
id|dbg_end
suffix:semicolon
id|DbgDeregister
(paren
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
r_void
DECL|function|DbgSetLevel
id|DbgSetLevel
(paren
r_int
r_int
id|dbgMask
)paren
(brace
id|myDriverDebugHandle.dbgMask
op_assign
id|dbgMask
op_or
(paren
id|DL_EVL
op_or
id|DL_FTL
op_or
id|DL_LOG
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
r_void
DECL|function|DbgDeregister
id|DbgDeregister
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_end
)paren
(brace
(paren
id|myDriverDebugHandle.dbg_end
)paren
(paren
op_amp
id|myDriverDebugHandle
)paren
suffix:semicolon
)brace
id|memset
(paren
op_amp
id|myDriverDebugHandle
comma
l_int|0
comma
r_sizeof
(paren
id|myDriverDebugHandle
)paren
)paren
suffix:semicolon
)brace
DECL|function|xdi_dbg_xlog
r_void
id|xdi_dbg_xlog
(paren
r_char
op_star
id|x
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
id|va_start
(paren
id|ap
comma
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_end
op_logical_and
(paren
id|myDriverDebugHandle.dbg_irq
op_logical_or
id|myDriverDebugHandle.dbg_old
)paren
op_logical_and
(paren
id|myDriverDebugHandle.dbgMask
op_amp
id|DL_STAT
)paren
)paren
(brace
r_if
c_cond
(paren
id|myDriverDebugHandle.dbg_irq
)paren
(brace
(paren
op_star
(paren
id|myDriverDebugHandle.dbg_irq
)paren
)paren
(paren
id|myDriverDebugHandle.id
comma
(paren
id|x
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
ques
c_cond
id|DLI_TRC
suffix:colon
id|DLI_XLOG
comma
id|x
comma
id|ap
)paren
suffix:semicolon
)brace
r_else
(brace
(paren
op_star
(paren
id|myDriverDebugHandle.dbg_old
)paren
)paren
(paren
id|myDriverDebugHandle.id
comma
id|x
comma
id|ap
)paren
suffix:semicolon
)brace
)brace
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
macro_line|#endif /* DIVA_NO_DEBUGLIB */
eof
