multiline_comment|/* $Id: divasproc.c,v 1.19.4.3 2005/01/31 12:22:20 armin Exp $&n; *&n; * Low level driver for Eicon DIVA Server ISDN cards.&n; * /proc functions&n; *&n; * Copyright 2000-2003 by Armin Schindler (mac@melware.de)&n; * Copyright 2000-2003 Cytronics &amp; Melware (info@melware.de)&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;platform.h&quot;
macro_line|#include &quot;debuglib.h&quot;
DECL|macro|ID_MASK
macro_line|#undef ID_MASK
DECL|macro|N_DATA
macro_line|#undef N_DATA
macro_line|#include &quot;pc.h&quot;
macro_line|#include &quot;di_defs.h&quot;
macro_line|#include &quot;divasync.h&quot;
macro_line|#include &quot;di.h&quot;
macro_line|#include &quot;io.h&quot;
macro_line|#include &quot;xdi_msg.h&quot;
macro_line|#include &quot;xdi_adapter.h&quot;
macro_line|#include &quot;diva.h&quot;
macro_line|#include &quot;diva_pci.h&quot;
r_extern
id|PISDN_ADAPTER
id|IoAdapters
(braket
id|MAX_ADAPTER
)braket
suffix:semicolon
r_extern
r_void
id|divas_get_version
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|diva_get_vserial_number
c_func
(paren
id|PISDN_ADAPTER
id|IoAdapter
comma
r_char
op_star
id|buf
)paren
suffix:semicolon
multiline_comment|/*********************************************************&n; ** Functions for /proc interface / File operations&n; *********************************************************/
DECL|variable|divas_proc_name
r_static
r_char
op_star
id|divas_proc_name
op_assign
l_string|&quot;divas&quot;
suffix:semicolon
DECL|variable|adapter_dir_name
r_static
r_char
op_star
id|adapter_dir_name
op_assign
l_string|&quot;adapter&quot;
suffix:semicolon
DECL|variable|info_proc_name
r_static
r_char
op_star
id|info_proc_name
op_assign
l_string|&quot;info&quot;
suffix:semicolon
DECL|variable|grp_opt_proc_name
r_static
r_char
op_star
id|grp_opt_proc_name
op_assign
l_string|&quot;group_optimization&quot;
suffix:semicolon
DECL|variable|d_l1_down_proc_name
r_static
r_char
op_star
id|d_l1_down_proc_name
op_assign
l_string|&quot;dynamic_l1_down&quot;
suffix:semicolon
multiline_comment|/*&n;** &quot;divas&quot; entry&n;*/
r_extern
r_struct
id|proc_dir_entry
op_star
id|proc_net_eicon
suffix:semicolon
DECL|variable|divas_proc_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|divas_proc_entry
op_assign
l_int|NULL
suffix:semicolon
r_static
id|ssize_t
DECL|function|divas_read
id|divas_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|cadapter
suffix:semicolon
r_char
id|tmpbuf
(braket
l_int|80
)braket
suffix:semicolon
r_char
id|tmpser
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
op_star
id|off
)paren
r_return
l_int|0
suffix:semicolon
id|divas_get_version
c_func
(paren
id|tmpbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
op_plus
id|len
comma
op_amp
id|tmpbuf
comma
id|strlen
c_func
(paren
id|tmpbuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|len
op_add_assign
id|strlen
c_func
(paren
id|tmpbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cadapter
op_assign
l_int|0
suffix:semicolon
id|cadapter
OL
id|MAX_ADAPTER
suffix:semicolon
id|cadapter
op_increment
)paren
(brace
r_if
c_cond
(paren
id|IoAdapters
(braket
id|cadapter
)braket
)paren
(brace
id|diva_get_vserial_number
c_func
(paren
id|IoAdapters
(braket
id|cadapter
)braket
comma
id|tmpser
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmpbuf
comma
l_string|&quot;%2d: %-30s Serial:%-10s IRQ:%2d&bslash;n&quot;
comma
id|cadapter
op_plus
l_int|1
comma
id|IoAdapters
(braket
id|cadapter
)braket
op_member_access_from_pointer
id|Properties.Name
comma
id|tmpser
comma
id|IoAdapters
(braket
id|cadapter
)braket
op_member_access_from_pointer
id|irq_info.irq_nr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|strlen
c_func
(paren
id|tmpbuf
)paren
op_plus
id|len
)paren
OG
id|count
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|buf
op_plus
id|len
comma
op_amp
id|tmpbuf
comma
id|strlen
c_func
(paren
id|tmpbuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|len
op_add_assign
id|strlen
c_func
(paren
id|tmpbuf
)paren
suffix:semicolon
)brace
)brace
op_star
id|off
op_add_assign
id|len
suffix:semicolon
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|divas_write
id|divas_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
DECL|function|divas_poll
r_static
r_int
r_int
id|divas_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_return
(paren
id|POLLERR
)paren
suffix:semicolon
)brace
DECL|function|divas_open
r_static
r_int
id|divas_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|nonseekable_open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|function|divas_close
r_static
r_int
id|divas_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|divas_fops
r_static
r_struct
id|file_operations
id|divas_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|divas_read
comma
dot
id|write
op_assign
id|divas_write
comma
dot
id|poll
op_assign
id|divas_poll
comma
dot
id|open
op_assign
id|divas_open
comma
dot
id|release
op_assign
id|divas_close
)brace
suffix:semicolon
DECL|function|create_divas_proc
r_int
id|create_divas_proc
c_func
(paren
r_void
)paren
(brace
id|divas_proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|divas_proc_name
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_net_eicon
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|divas_proc_entry
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
id|divas_proc_entry-&gt;proc_fops
op_assign
op_amp
id|divas_fops
suffix:semicolon
id|divas_proc_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|remove_divas_proc
r_void
id|remove_divas_proc
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|divas_proc_entry
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|divas_proc_name
comma
id|proc_net_eicon
)paren
suffix:semicolon
id|divas_proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;** write group_optimization &n;*/
r_static
r_int
DECL|function|write_grp_opt
id|write_grp_opt
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_eq
l_int|1
)paren
op_logical_or
(paren
id|count
op_eq
l_int|2
)paren
)paren
(brace
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|buffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;0&squot;
suffix:colon
id|IoAdapter-&gt;capi_cfg.cfg_1
op_and_assign
op_complement
id|DIVA_XDI_CAPI_CFG_1_GROUP_POPTIMIZATION_ON
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;1&squot;
suffix:colon
id|IoAdapter-&gt;capi_cfg.cfg_1
op_or_assign
id|DIVA_XDI_CAPI_CFG_1_GROUP_POPTIMIZATION_ON
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** write dynamic_l1_down&n;*/
r_static
r_int
DECL|function|write_d_l1_down
id|write_d_l1_down
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_eq
l_int|1
)paren
op_logical_or
(paren
id|count
op_eq
l_int|2
)paren
)paren
(brace
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|buffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;0&squot;
suffix:colon
id|IoAdapter-&gt;capi_cfg.cfg_1
op_and_assign
op_complement
id|DIVA_XDI_CAPI_CFG_1_DYNAMIC_L1_ON
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;1&squot;
suffix:colon
id|IoAdapter-&gt;capi_cfg.cfg_1
op_or_assign
id|DIVA_XDI_CAPI_CFG_1_DYNAMIC_L1_ON
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** read dynamic_l1_down &n;*/
r_static
r_int
DECL|function|read_d_l1_down
id|read_d_l1_down
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|IoAdapter-&gt;capi_cfg
dot
id|cfg_1
op_amp
id|DIVA_XDI_CAPI_CFG_1_DYNAMIC_L1_ON
)paren
ques
c_cond
l_string|&quot;1&quot;
suffix:colon
l_string|&quot;0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** read group_optimization&n;*/
r_static
r_int
DECL|function|read_grp_opt
id|read_grp_opt
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|IoAdapter-&gt;capi_cfg
dot
id|cfg_1
op_amp
id|DIVA_XDI_CAPI_CFG_1_GROUP_POPTIMIZATION_ON
)paren
ques
c_cond
l_string|&quot;1&quot;
suffix:colon
l_string|&quot;0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** info write&n;*/
r_static
r_int
DECL|function|info_write
id|info_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
r_char
id|c
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|c
comma
id|buffer
comma
l_int|4
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* this is for test purposes only */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|c
comma
l_string|&quot;trap&quot;
comma
l_int|4
)paren
)paren
(brace
(paren
op_star
(paren
id|IoAdapter-&gt;os_trap_nfy_Fnc
)paren
)paren
(paren
id|IoAdapter
comma
id|IoAdapter-&gt;ANum
)paren
suffix:semicolon
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** info read&n;*/
r_static
r_int
DECL|function|info_read
id|info_read
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
id|tmpser
(braket
l_int|16
)braket
suffix:semicolon
id|diva_os_xdi_adapter_t
op_star
id|a
op_assign
(paren
id|diva_os_xdi_adapter_t
op_star
)paren
id|data
suffix:semicolon
id|PISDN_ADAPTER
id|IoAdapter
op_assign
id|IoAdapters
(braket
id|a-&gt;controller
op_minus
l_int|1
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Name        : %s&bslash;n&quot;
comma
id|IoAdapter-&gt;Properties.Name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;DSP state   : %08x&bslash;n&quot;
comma
id|a-&gt;dsp_mask
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Channels    : %02d&bslash;n&quot;
comma
id|IoAdapter-&gt;Properties.Channels
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;E. max/used : %03d/%03d&bslash;n&quot;
comma
id|IoAdapter-&gt;e_max
comma
id|IoAdapter-&gt;e_count
)paren
suffix:semicolon
id|diva_get_vserial_number
c_func
(paren
id|IoAdapter
comma
id|tmpser
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Serial      : %s&bslash;n&quot;
comma
id|tmpser
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;IRQ         : %d&bslash;n&quot;
comma
id|IoAdapter-&gt;irq_info.irq_nr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;CardIndex   : %d&bslash;n&quot;
comma
id|a-&gt;CardIndex
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;CardOrdinal : %d&bslash;n&quot;
comma
id|a-&gt;CardOrdinal
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Controller  : %d&bslash;n&quot;
comma
id|a-&gt;controller
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Bus-Type    : %s&bslash;n&quot;
comma
(paren
id|a-&gt;Bus
op_eq
id|DIVAS_XDI_ADAPTER_BUS_ISA
)paren
ques
c_cond
l_string|&quot;ISA&quot;
suffix:colon
l_string|&quot;PCI&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Port-Name   : %s&bslash;n&quot;
comma
id|a-&gt;port_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;Bus
op_eq
id|DIVAS_XDI_ADAPTER_BUS_PCI
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;PCI-bus     : %d&bslash;n&quot;
comma
id|a-&gt;resources.pci.bus
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;PCI-func    : %d&bslash;n&quot;
comma
id|a-&gt;resources.pci.func
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|a-&gt;resources.pci.bar
(braket
id|i
)braket
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Mem / I/O %d : 0x%x / mapped : 0x%lx&quot;
comma
id|i
comma
id|a-&gt;resources.pci.bar
(braket
id|i
)braket
comma
(paren
r_int
r_int
)paren
id|a-&gt;resources
dot
id|pci.addr
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;resources.pci.length
(braket
id|i
)braket
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot; / length : %d&quot;
comma
id|a-&gt;resources.pci
dot
id|length
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|a-&gt;xdi_adapter.port
)paren
op_logical_and
(paren
(paren
op_logical_neg
id|a-&gt;xdi_adapter.ram
)paren
op_logical_or
(paren
op_logical_neg
id|a-&gt;xdi_adapter.reset
)paren
op_logical_or
(paren
op_logical_neg
id|a-&gt;xdi_adapter.cfg
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IoAdapter-&gt;irq_info.irq_nr
)paren
(brace
id|p
op_assign
l_string|&quot;slave&quot;
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
l_string|&quot;out of service&quot;
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|a-&gt;xdi_adapter.trapped
)paren
(brace
id|p
op_assign
l_string|&quot;trapped&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|a-&gt;xdi_adapter.Initialized
)paren
(brace
id|p
op_assign
l_string|&quot;active&quot;
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
l_string|&quot;ready&quot;
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;State       : %s&bslash;n&quot;
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;** adapter proc init/de-init&n;*/
multiline_comment|/* --------------------------------------------------------------------------&n;    Create adapter directory and files in proc file system&n;   -------------------------------------------------------------------------- */
DECL|function|create_adapter_proc
r_int
id|create_adapter_proc
c_func
(paren
id|diva_os_xdi_adapter_t
op_star
id|a
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|de
comma
op_star
id|pe
suffix:semicolon
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s%d&quot;
comma
id|adapter_dir_name
comma
id|a-&gt;controller
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de
op_assign
id|create_proc_entry
c_func
(paren
id|tmp
comma
id|S_IFDIR
comma
id|proc_net_eicon
)paren
)paren
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
id|a-&gt;proc_adapter_dir
op_assign
(paren
r_void
op_star
)paren
id|de
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pe
op_assign
id|create_proc_entry
c_func
(paren
id|info_proc_name
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|de
)paren
)paren
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
id|a-&gt;proc_info
op_assign
(paren
r_void
op_star
)paren
id|pe
suffix:semicolon
id|pe-&gt;write_proc
op_assign
id|info_write
suffix:semicolon
id|pe-&gt;read_proc
op_assign
id|info_read
suffix:semicolon
id|pe-&gt;data
op_assign
id|a
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pe
op_assign
id|create_proc_entry
c_func
(paren
id|grp_opt_proc_name
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|de
)paren
)paren
)paren
(brace
id|a-&gt;proc_grp_opt
op_assign
(paren
r_void
op_star
)paren
id|pe
suffix:semicolon
id|pe-&gt;write_proc
op_assign
id|write_grp_opt
suffix:semicolon
id|pe-&gt;read_proc
op_assign
id|read_grp_opt
suffix:semicolon
id|pe-&gt;data
op_assign
id|a
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pe
op_assign
id|create_proc_entry
c_func
(paren
id|d_l1_down_proc_name
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|de
)paren
)paren
)paren
(brace
id|a-&gt;proc_d_l1_down
op_assign
(paren
r_void
op_star
)paren
id|pe
suffix:semicolon
id|pe-&gt;write_proc
op_assign
id|write_d_l1_down
suffix:semicolon
id|pe-&gt;read_proc
op_assign
id|read_d_l1_down
suffix:semicolon
id|pe-&gt;data
op_assign
id|a
suffix:semicolon
)brace
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;proc entry %s created&quot;
comma
id|tmp
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------------&n;    Remove adapter directory and files in proc file system&n;   -------------------------------------------------------------------------- */
DECL|function|remove_adapter_proc
r_void
id|remove_adapter_proc
c_func
(paren
id|diva_os_xdi_adapter_t
op_star
id|a
)paren
(brace
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;proc_adapter_dir
)paren
(brace
r_if
c_cond
(paren
id|a-&gt;proc_d_l1_down
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|d_l1_down_proc_name
comma
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|a-&gt;proc_adapter_dir
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|a-&gt;proc_grp_opt
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|grp_opt_proc_name
comma
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|a-&gt;proc_adapter_dir
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|a-&gt;proc_info
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|info_proc_name
comma
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|a-&gt;proc_adapter_dir
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;%s%d&quot;
comma
id|adapter_dir_name
comma
id|a-&gt;controller
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|tmp
comma
id|proc_net_eicon
)paren
suffix:semicolon
id|DBG_TRC
c_func
(paren
(paren
l_string|&quot;proc entry %s%d removed&quot;
comma
id|adapter_dir_name
comma
id|a-&gt;controller
)paren
)paren
suffix:semicolon
)brace
)brace
eof
