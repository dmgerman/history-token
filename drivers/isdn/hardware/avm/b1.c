multiline_comment|/* $Id: b1.c,v 1.1.2.2 2004/01/16 21:09:27 keil Exp $&n; * &n; * Common module for AVM B1 cards.&n; * &n; * Copyright 1999 by Carsten Paeth &lt;calle@calle.de&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/capi.h&gt;
macro_line|#include &lt;linux/kernelcapi.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/isdn/capilli.h&gt;
macro_line|#include &quot;avmcard.h&quot;
macro_line|#include &lt;linux/isdn/capicmd.h&gt;
macro_line|#include &lt;linux/isdn/capiutil.h&gt;
DECL|variable|revision
r_static
r_char
op_star
id|revision
op_assign
l_string|&quot;$Revision: 1.1.2.2 $&quot;
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;CAPI4Linux: Common support for active AVM cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Carsten Paeth&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
DECL|variable|b1_irq_table
r_int
id|b1_irq_table
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|192
comma
multiline_comment|/* irq 3 */
l_int|32
comma
multiline_comment|/* irq 4 */
l_int|160
comma
multiline_comment|/* irq 5 */
l_int|96
comma
multiline_comment|/* irq 6 */
l_int|224
comma
multiline_comment|/* irq 7 */
l_int|0
comma
l_int|64
comma
multiline_comment|/* irq 9 */
l_int|80
comma
multiline_comment|/* irq 10 */
l_int|208
comma
multiline_comment|/* irq 11 */
l_int|48
comma
multiline_comment|/* irq 12 */
l_int|0
comma
l_int|0
comma
l_int|112
comma
multiline_comment|/* irq 15 */
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_alloc_card
id|avmcard
op_star
id|b1_alloc_card
c_func
(paren
r_int
id|nr_controllers
)paren
(brace
id|avmcard
op_star
id|card
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
suffix:semicolon
r_int
id|i
suffix:semicolon
id|card
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|card
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|card
)paren
)paren
suffix:semicolon
id|cinfo
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cinfo
)paren
op_star
id|nr_controllers
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cinfo
)paren
(brace
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cinfo
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cinfo
)paren
op_star
id|nr_controllers
)paren
suffix:semicolon
id|card-&gt;ctrlinfo
op_assign
id|cinfo
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_controllers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|cinfo
(braket
id|i
)braket
dot
id|ncci_head
)paren
suffix:semicolon
id|cinfo
(braket
id|i
)braket
dot
id|card
op_assign
id|card
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;lock
)paren
suffix:semicolon
id|card-&gt;nr_controllers
op_assign
id|nr_controllers
suffix:semicolon
r_return
id|card
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_free_card
r_void
id|b1_free_card
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|kfree
c_func
(paren
id|card-&gt;ctrlinfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_detect
r_int
id|b1_detect
c_func
(paren
r_int
r_int
id|base
comma
r_enum
id|avmcardtype
id|cardtype
)paren
(brace
r_int
id|onoff
comma
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 00xx &n;&t; */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfc
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfc
)paren
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 001x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x2
)paren
suffix:semicolon
multiline_comment|/* enable irq */
multiline_comment|/* b1outp(base, B1_OUTSTAT, 0x2); */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_ne
l_int|0x2
multiline_comment|/* || (inb(base + B1_OUTSTAT) &amp; 0xfe) != 0x2 */
)paren
r_return
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t; * Statusregister 0000 000x &n;&t; */
id|b1outp
c_func
(paren
id|base
comma
id|B1_INSTAT
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* disable irq */
id|b1outp
c_func
(paren
id|base
comma
id|B1_OUTSTAT
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_INSTAT
)paren
op_amp
l_int|0xfe
)paren
op_logical_or
(paren
id|inb
c_func
(paren
id|base
op_plus
id|B1_OUTSTAT
)paren
op_amp
l_int|0xfe
)paren
)paren
r_return
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|onoff
op_assign
op_logical_neg
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b1_set_test_bit
c_func
(paren
id|base
comma
id|cardtype
comma
id|onoff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b1_get_test_bit
c_func
(paren
id|base
comma
id|cardtype
)paren
op_ne
id|onoff
)paren
r_return
l_int|4
suffix:semicolon
id|onoff
op_assign
op_logical_neg
id|onoff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cardtype
op_eq
id|avm_m1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b1_rd_reg
c_func
(paren
id|base
comma
id|B1_STAT1
c_func
(paren
id|cardtype
)paren
)paren
op_amp
l_int|0x0f
)paren
op_ne
l_int|0x01
)paren
r_return
l_int|5
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1_getrevision
r_void
id|b1_getrevision
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
id|card
op_member_access_from_pointer
r_class
op_assign
id|inb
c_func
(paren
id|card-&gt;port
op_plus
id|B1_ANALYSE
)paren
suffix:semicolon
id|card-&gt;revision
op_assign
id|inb
c_func
(paren
id|card-&gt;port
op_plus
id|B1_REVISION
)paren
suffix:semicolon
)brace
DECL|macro|FWBUF_SIZE
mdefine_line|#define FWBUF_SIZE&t;256
DECL|function|b1_load_t4file
r_int
id|b1_load_t4file
c_func
(paren
id|avmcard
op_star
id|card
comma
id|capiloaddatapart
op_star
id|t4file
)paren
(brace
r_int
r_char
id|buf
(braket
id|FWBUF_SIZE
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
id|i
comma
id|left
suffix:semicolon
r_int
r_int
id|base
op_assign
id|card-&gt;port
suffix:semicolon
id|dp
op_assign
id|t4file-&gt;data
suffix:semicolon
id|left
op_assign
id|t4file-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|left
OG
id|FWBUF_SIZE
)paren
(brace
r_if
c_cond
(paren
id|t4file-&gt;user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|FWBUF_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dp
comma
id|FWBUF_SIZE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FWBUF_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|b1_save_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: corrupted firmware file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|left
op_sub_assign
id|FWBUF_SIZE
suffix:semicolon
id|dp
op_add_assign
id|FWBUF_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
r_if
c_cond
(paren
id|t4file-&gt;user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|b1_save_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
)braket
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: corrupted firmware file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1_load_config
r_int
id|b1_load_config
c_func
(paren
id|avmcard
op_star
id|card
comma
id|capiloaddatapart
op_star
id|config
)paren
(brace
r_int
r_char
id|buf
(braket
id|FWBUF_SIZE
)braket
suffix:semicolon
r_int
r_char
op_star
id|dp
suffix:semicolon
r_int
r_int
id|base
op_assign
id|card-&gt;port
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|left
suffix:semicolon
id|dp
op_assign
id|config-&gt;data
suffix:semicolon
id|left
op_assign
id|config-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|left
)paren
(brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|base
comma
l_int|1
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|base
comma
id|left
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|left
OG
id|FWBUF_SIZE
)paren
(brace
r_if
c_cond
(paren
id|config-&gt;user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|FWBUF_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dp
comma
id|FWBUF_SIZE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FWBUF_SIZE
suffix:semicolon
)paren
(brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
)brace
)brace
id|left
op_sub_assign
id|FWBUF_SIZE
suffix:semicolon
id|dp
op_add_assign
id|FWBUF_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left
)paren
(brace
r_if
c_cond
(paren
id|config-&gt;user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dp
comma
id|left
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
suffix:semicolon
)paren
(brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|left
)paren
id|b1_put_byte
c_func
(paren
id|base
comma
id|buf
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
r_else
id|b1_put_byte
c_func
(paren
id|base
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1_loaded
r_int
id|b1_loaded
c_func
(paren
id|avmcard
op_star
id|card
)paren
(brace
r_int
r_int
id|base
op_assign
id|card-&gt;port
suffix:semicolon
r_int
r_int
id|stop
suffix:semicolon
r_int
r_char
id|ans
suffix:semicolon
r_int
r_int
id|tout
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|stop
op_assign
id|jiffies
op_plus
id|tout
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|b1_tx_empty
c_func
(paren
id|base
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|b1_tx_empty
c_func
(paren
id|base
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1_loaded: tx err, corrupted t4 file ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|b1_put_byte
c_func
(paren
id|base
comma
id|SEND_POLL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|stop
op_assign
id|jiffies
op_plus
id|tout
op_star
id|HZ
suffix:semicolon
id|time_before
c_func
(paren
id|jiffies
comma
id|stop
)paren
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|b1_rx_full
c_func
(paren
id|base
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ans
op_assign
id|b1_get_byte
c_func
(paren
id|base
)paren
)paren
op_eq
id|RECEIVE_POLL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1_loaded: got 0x%x, firmware not running&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ans
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1_loaded: firmware not running&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_load_firmware
r_int
id|b1_load_firmware
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|capiloaddata
op_star
id|data
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|port
op_assign
id|card-&gt;port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|b1_reset
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|b1_load_t4file
c_func
(paren
id|card
comma
op_amp
id|data-&gt;firmware
)paren
)paren
)paren
(brace
id|b1_reset
c_func
(paren
id|port
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load t4file!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|b1_disable_irq
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;configuration.len
OG
l_int|0
op_logical_and
id|data-&gt;configuration.data
)paren
(brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|b1_load_config
c_func
(paren
id|card
comma
op_amp
id|data-&gt;configuration
)paren
)paren
)paren
(brace
id|b1_reset
c_func
(paren
id|port
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load config!!&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|b1_loaded
c_func
(paren
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to load t4file.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_setinterrupt
c_func
(paren
id|port
comma
id|card-&gt;irq
comma
id|card-&gt;cardtype
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|port
comma
id|SEND_INIT
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|CAPI_MAXAPPL
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|AVM_NCCI_PER_CHANNEL
op_star
l_int|2
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|ctrl-&gt;cnr
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1_reset_ctr
r_void
id|b1_reset_ctr
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|port
op_assign
id|card-&gt;port
suffix:semicolon
id|b1_reset
c_func
(paren
id|port
)paren
suffix:semicolon
id|b1_reset
c_func
(paren
id|port
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cinfo-&gt;version
comma
l_int|0
comma
r_sizeof
(paren
id|cinfo-&gt;version
)paren
)paren
suffix:semicolon
id|capilib_release
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
)paren
suffix:semicolon
id|capi_ctr_reseted
c_func
(paren
id|ctrl
)paren
suffix:semicolon
)brace
DECL|function|b1_register_appl
r_void
id|b1_register_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|u16
id|appl
comma
id|capi_register_params
op_star
id|rp
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|port
op_assign
id|card-&gt;port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|nconn
comma
id|want
op_assign
id|rp-&gt;level3cnt
suffix:semicolon
r_if
c_cond
(paren
id|want
OG
l_int|0
)paren
id|nconn
op_assign
id|want
suffix:semicolon
r_else
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
op_star
op_minus
id|want
suffix:semicolon
r_if
c_cond
(paren
id|nconn
op_eq
l_int|0
)paren
id|nconn
op_assign
id|ctrl-&gt;profile.nbchannel
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|port
comma
id|SEND_REGISTER
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|appl
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
l_int|1024
op_star
(paren
id|nconn
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|nconn
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|rp-&gt;datablkcnt
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|rp-&gt;datablklen
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|b1_release_appl
r_void
id|b1_release_appl
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
id|u16
id|appl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|port
op_assign
id|card-&gt;port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|capilib_release_appl
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
comma
id|appl
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|port
comma
id|SEND_RELEASE
)paren
suffix:semicolon
id|b1_put_word
c_func
(paren
id|port
comma
id|appl
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|b1_send_message
id|u16
id|b1_send_message
c_func
(paren
r_struct
id|capi_ctr
op_star
id|ctrl
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
r_int
r_int
id|port
op_assign
id|card-&gt;port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u16
id|len
op_assign
id|CAPIMSG_LEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|u8
id|cmd
op_assign
id|CAPIMSG_COMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|u8
id|subcmd
op_assign
id|CAPIMSG_SUBCOMMAND
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|u16
id|dlen
comma
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|CAPICMD
c_func
(paren
id|cmd
comma
id|subcmd
)paren
op_eq
id|CAPI_DATA_B3_REQ
)paren
(brace
id|retval
op_assign
id|capilib_data_b3_req
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
comma
id|CAPIMSG_APPID
c_func
(paren
id|skb-&gt;data
)paren
comma
id|CAPIMSG_NCCI
c_func
(paren
id|skb-&gt;data
)paren
comma
id|CAPIMSG_MSGID
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
id|CAPI_NOERROR
)paren
r_goto
id|out
suffix:semicolon
id|dlen
op_assign
id|CAPIMSG_DATALEN
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|port
comma
id|SEND_DATA_B3_REQ
)paren
suffix:semicolon
id|b1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|b1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
op_plus
id|len
comma
id|dlen
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|retval
op_assign
id|CAPI_NOERROR
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_put_byte
c_func
(paren
id|port
comma
id|SEND_MESSAGE
)paren
suffix:semicolon
id|b1_put_slice
c_func
(paren
id|port
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_parse_version
r_void
id|b1_parse_version
c_func
(paren
id|avmctrl_info
op_star
id|cinfo
)paren
(brace
r_struct
id|capi_ctr
op_star
id|ctrl
op_assign
op_amp
id|cinfo-&gt;capi_ctrl
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|capi_profile
op_star
id|profp
suffix:semicolon
id|u8
op_star
id|dversion
suffix:semicolon
id|u8
id|flag
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
suffix:semicolon
id|j
op_increment
)paren
id|cinfo-&gt;version
(braket
id|j
)braket
op_assign
l_string|&quot;&bslash;0&bslash;0&quot;
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|AVM_MAXVERSION
op_logical_and
id|i
OL
id|cinfo-&gt;versionlen
suffix:semicolon
id|j
op_increment
comma
id|i
op_add_assign
id|cinfo-&gt;versionbuf
(braket
id|i
)braket
op_plus
l_int|1
)paren
id|cinfo-&gt;version
(braket
id|j
)braket
op_assign
op_amp
id|cinfo-&gt;versionbuf
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|strlcpy
c_func
(paren
id|ctrl-&gt;serial
comma
id|cinfo-&gt;version
(braket
id|VER_SERIAL
)braket
comma
r_sizeof
(paren
id|ctrl-&gt;serial
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ctrl-&gt;profile
comma
id|cinfo-&gt;version
(braket
id|VER_PROFILE
)braket
comma
r_sizeof
(paren
id|capi_profile
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|ctrl-&gt;manu
comma
l_string|&quot;AVM GmbH&quot;
comma
r_sizeof
(paren
id|ctrl-&gt;manu
)paren
)paren
suffix:semicolon
id|dversion
op_assign
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
suffix:semicolon
id|ctrl-&gt;version.majorversion
op_assign
l_int|2
suffix:semicolon
id|ctrl-&gt;version.minorversion
op_assign
l_int|0
suffix:semicolon
id|ctrl-&gt;version.majormanuversion
op_assign
(paren
(paren
(paren
id|dversion
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|ctrl-&gt;version.majormanuversion
op_or_assign
(paren
(paren
id|dversion
(braket
l_int|2
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|ctrl-&gt;version.minormanuversion
op_assign
(paren
id|dversion
(braket
l_int|3
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
l_int|4
suffix:semicolon
id|ctrl-&gt;version.minormanuversion
op_or_assign
(paren
id|dversion
(braket
l_int|5
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_star
l_int|10
op_plus
(paren
(paren
id|dversion
(braket
l_int|6
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|profp
op_assign
op_amp
id|ctrl-&gt;profile
suffix:semicolon
id|flag
op_assign
(paren
(paren
id|u8
op_star
)paren
(paren
id|profp-&gt;manu
)paren
)paren
(braket
l_int|1
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|flag
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
)paren
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;B1&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;PCMCIA B&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;PCMCIA M1&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;PCMCIA M2&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;B1 V3.0&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|strcpy
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;B1 PCI&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sprintf
c_func
(paren
id|cinfo-&gt;cardname
comma
l_string|&quot;AVM?%u&quot;
comma
(paren
r_int
r_int
)paren
id|flag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: card %d &bslash;&quot;%s&bslash;&quot; ready.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ctrl-&gt;cnr
comma
id|cinfo-&gt;cardname
)paren
suffix:semicolon
id|flag
op_assign
(paren
(paren
id|u8
op_star
)paren
(paren
id|profp-&gt;manu
)paren
)paren
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: card %d Protocol:%s%s%s%s%s%s%s&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ctrl-&gt;cnr
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; DSS1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; CT1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; VN3&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; NI1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; AUSTEL&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; ESS&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; 1TR6&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|flag
op_assign
(paren
(paren
id|u8
op_star
)paren
(paren
id|profp-&gt;manu
)paren
)paren
(braket
l_int|5
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: card %d Linetype:%s%s%s%s&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ctrl-&gt;cnr
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; point to point&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; point to multipoint&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; leased line without D-channel&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; leased line with D-channel&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1_interrupt
id|irqreturn_t
id|b1_interrupt
c_func
(paren
r_int
id|interrupt
comma
r_void
op_star
id|devptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|avmcard
op_star
id|card
op_assign
id|devptr
suffix:semicolon
id|avmctrl_info
op_star
id|cinfo
op_assign
op_amp
id|card-&gt;ctrlinfo
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|capi_ctr
op_star
id|ctrl
op_assign
op_amp
id|cinfo-&gt;capi_ctrl
suffix:semicolon
r_int
r_char
id|b1cmd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ApplId
suffix:semicolon
r_int
id|MsgLen
suffix:semicolon
r_int
id|DataB3Len
suffix:semicolon
r_int
id|NCCI
suffix:semicolon
r_int
id|WindowSize
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b1_rx_full
c_func
(paren
id|card-&gt;port
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
id|b1cmd
op_assign
id|b1_get_byte
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|b1cmd
)paren
(brace
r_case
id|RECEIVE_DATA_B3_IND
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|DataB3Len
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;databuf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MsgLen
OL
l_int|30
)paren
(brace
multiline_comment|/* not CAPI 64Bit */
id|memset
c_func
(paren
id|card-&gt;msgbuf
op_plus
id|MsgLen
comma
l_int|0
comma
l_int|30
op_minus
id|MsgLen
)paren
suffix:semicolon
id|MsgLen
op_assign
l_int|30
suffix:semicolon
id|CAPIMSG_SETLEN
c_func
(paren
id|card-&gt;msgbuf
comma
l_int|30
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|DataB3Len
op_plus
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|DataB3Len
)paren
comma
id|card-&gt;databuf
comma
id|DataB3Len
)paren
suffix:semicolon
id|capi_ctr_handle_message
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_MESSAGE
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|MsgLen
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incoming packet dropped&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|MsgLen
)paren
comma
id|card-&gt;msgbuf
comma
id|MsgLen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CAPIMSG_CMD
c_func
(paren
id|skb-&gt;data
)paren
op_eq
id|CAPI_DATA_B3_CONF
)paren
id|capilib_data_b3_conf
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
comma
id|ApplId
comma
id|CAPIMSG_NCCI
c_func
(paren
id|skb-&gt;data
)paren
comma
id|CAPIMSG_MSGID
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|capi_ctr_handle_message
c_func
(paren
id|ctrl
comma
id|ApplId
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RECEIVE_NEW_NCCI
suffix:colon
id|ApplId
op_assign
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|WindowSize
op_assign
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|capilib_new_ncci
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
comma
id|ApplId
comma
id|NCCI
comma
id|WindowSize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_FREE_NCCI
suffix:colon
id|ApplId
op_assign
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|NCCI
op_assign
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NCCI
op_ne
l_int|0xffffffff
)paren
id|capilib_free_ncci
c_func
(paren
op_amp
id|cinfo-&gt;ncci_head
comma
id|ApplId
comma
id|NCCI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_START
suffix:colon
multiline_comment|/* b1_put_byte(card-&gt;port, SEND_POLLACK); */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|capi_ctr_resume_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_STOP
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|capi_ctr_suspend_output
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_INIT
suffix:colon
id|cinfo-&gt;versionlen
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|cinfo-&gt;versionbuf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|b1_parse_version
c_func
(paren
id|cinfo
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s-card (%s) now active&bslash;n&quot;
comma
id|card-&gt;name
comma
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
comma
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
suffix:semicolon
id|capi_ctr_ready
c_func
(paren
id|ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_TASK_READY
suffix:colon
id|ApplId
op_assign
(paren
r_int
)paren
id|b1_get_word
c_func
(paren
id|card-&gt;port
)paren
suffix:semicolon
id|MsgLen
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: task %d &bslash;&quot;%s&bslash;&quot; ready.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|ApplId
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_DEBUGMSG
suffix:colon
id|MsgLen
op_assign
id|b1_get_slice
c_func
(paren
id|card-&gt;port
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;msgbuf
(braket
id|MsgLen
)braket
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|MsgLen
OG
l_int|0
op_logical_and
(paren
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
(brace
id|card-&gt;msgbuf
(braket
id|MsgLen
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|MsgLen
op_decrement
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: DEBUG: %s&bslash;n&quot;
comma
id|card-&gt;name
comma
id|card-&gt;msgbuf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xff
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: card removed ?&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
r_default
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: b1_interrupt: 0x%x ???&bslash;n&quot;
comma
id|card-&gt;name
comma
id|b1cmd
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
DECL|function|b1ctl_read_proc
r_int
id|b1ctl_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_struct
id|capi_ctr
op_star
id|ctrl
)paren
(brace
id|avmctrl_info
op_star
id|cinfo
op_assign
(paren
id|avmctrl_info
op_star
)paren
(paren
id|ctrl-&gt;driverdata
)paren
suffix:semicolon
id|avmcard
op_star
id|card
op_assign
id|cinfo-&gt;card
suffix:semicolon
id|u8
id|flag
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;name&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s 0x%x&bslash;n&quot;
comma
l_string|&quot;io&quot;
comma
id|card-&gt;port
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %d&bslash;n&quot;
comma
l_string|&quot;irq&quot;
comma
id|card-&gt;irq
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;cardtype
)paren
(brace
r_case
id|avm_b1isa
suffix:colon
id|s
op_assign
l_string|&quot;B1 ISA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pci
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_b1pcmcia
suffix:colon
id|s
op_assign
l_string|&quot;B1 PCMCIA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m1
suffix:colon
id|s
op_assign
l_string|&quot;M1&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_m2
suffix:colon
id|s
op_assign
l_string|&quot;M2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1isa
suffix:colon
id|s
op_assign
l_string|&quot;T1 ISA (HEMA)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_t1pci
suffix:colon
id|s
op_assign
l_string|&quot;T1 PCI&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_c4
suffix:colon
id|s
op_assign
l_string|&quot;C4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|avm_c2
suffix:colon
id|s
op_assign
l_string|&quot;C2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;???&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;type&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_eq
id|avm_t1isa
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %d&bslash;n&quot;
comma
l_string|&quot;cardnr&quot;
comma
id|card-&gt;cardnr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_DRIVER
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_driver&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_CARDTYPE
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_cardtype&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|cinfo-&gt;version
(braket
id|VER_SERIAL
)braket
)paren
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;ver_serial&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;protocol&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; DSS1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; CT1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; VN3&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; NI1&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x10
)paren
ques
c_cond
l_string|&quot; AUSTEL&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x20
)paren
ques
c_cond
l_string|&quot; ESS&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x40
)paren
ques
c_cond
l_string|&quot; 1TR6&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;cardtype
op_ne
id|avm_m1
)paren
(brace
id|flag
op_assign
(paren
(paren
id|u8
op_star
)paren
(paren
id|ctrl-&gt;profile.manu
)paren
)paren
(braket
l_int|5
)braket
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s%s%s%s%s&bslash;n&quot;
comma
l_string|&quot;linetype&quot;
comma
(paren
id|flag
op_amp
l_int|0x01
)paren
ques
c_cond
l_string|&quot; point to point&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x02
)paren
ques
c_cond
l_string|&quot; point to multipoint&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x08
)paren
ques
c_cond
l_string|&quot; leased line without D-channel&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flag
op_amp
l_int|0x04
)paren
ques
c_cond
l_string|&quot; leased line with D-channel&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%-16s %s&bslash;n&quot;
comma
l_string|&quot;cardname&quot;
comma
id|cinfo-&gt;cardname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|count
op_ge
id|len
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|off
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
(paren
(paren
id|count
OL
id|len
op_minus
id|off
)paren
ques
c_cond
id|count
suffix:colon
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------- */
macro_line|#ifdef CONFIG_PCI
id|avmcard_dmainfo
op_star
DECL|function|avmcard_dma_alloc
id|avmcard_dma_alloc
c_func
(paren
r_char
op_star
id|name
comma
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|rsize
comma
r_int
id|ssize
)paren
(brace
id|avmcard_dmainfo
op_star
id|p
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|avmcard_dmainfo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no memory.&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
r_sizeof
(paren
id|avmcard_dmainfo
)paren
)paren
suffix:semicolon
id|p-&gt;recvbuf.size
op_assign
id|rsize
suffix:semicolon
id|buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|rsize
comma
op_amp
id|p-&gt;recvbuf.dmaaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: allocation of receive dma buffer failed.&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_goto
id|err_kfree
suffix:semicolon
)brace
id|p-&gt;recvbuf.dmabuf
op_assign
id|buf
suffix:semicolon
id|p-&gt;sendbuf.size
op_assign
id|ssize
suffix:semicolon
id|buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|ssize
comma
op_amp
id|p-&gt;sendbuf.dmaaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: allocation of send dma buffer failed.&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_goto
id|err_free_consistent
suffix:semicolon
)brace
id|p-&gt;sendbuf.dmabuf
op_assign
id|buf
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|p-&gt;send_queue
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
id|err_free_consistent
suffix:colon
id|pci_free_consistent
c_func
(paren
id|p-&gt;pcidev
comma
id|p-&gt;recvbuf.size
comma
id|p-&gt;recvbuf.dmabuf
comma
id|p-&gt;recvbuf.dmaaddr
)paren
suffix:semicolon
id|err_kfree
suffix:colon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
id|err
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|avmcard_dma_free
r_void
id|avmcard_dma_free
c_func
(paren
id|avmcard_dmainfo
op_star
id|p
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|p-&gt;pcidev
comma
id|p-&gt;recvbuf.size
comma
id|p-&gt;recvbuf.dmabuf
comma
id|p-&gt;recvbuf.dmaaddr
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|p-&gt;pcidev
comma
id|p-&gt;sendbuf.size
comma
id|p-&gt;sendbuf.dmabuf
comma
id|p-&gt;sendbuf.dmaaddr
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|p-&gt;send_queue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
DECL|variable|avmcard_dma_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|avmcard_dma_alloc
)paren
suffix:semicolon
DECL|variable|avmcard_dma_free
id|EXPORT_SYMBOL
c_func
(paren
id|avmcard_dma_free
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|b1_irq_table
id|EXPORT_SYMBOL
c_func
(paren
id|b1_irq_table
)paren
suffix:semicolon
DECL|variable|b1_alloc_card
id|EXPORT_SYMBOL
c_func
(paren
id|b1_alloc_card
)paren
suffix:semicolon
DECL|variable|b1_free_card
id|EXPORT_SYMBOL
c_func
(paren
id|b1_free_card
)paren
suffix:semicolon
DECL|variable|b1_detect
id|EXPORT_SYMBOL
c_func
(paren
id|b1_detect
)paren
suffix:semicolon
DECL|variable|b1_getrevision
id|EXPORT_SYMBOL
c_func
(paren
id|b1_getrevision
)paren
suffix:semicolon
DECL|variable|b1_load_t4file
id|EXPORT_SYMBOL
c_func
(paren
id|b1_load_t4file
)paren
suffix:semicolon
DECL|variable|b1_load_config
id|EXPORT_SYMBOL
c_func
(paren
id|b1_load_config
)paren
suffix:semicolon
DECL|variable|b1_loaded
id|EXPORT_SYMBOL
c_func
(paren
id|b1_loaded
)paren
suffix:semicolon
DECL|variable|b1_load_firmware
id|EXPORT_SYMBOL
c_func
(paren
id|b1_load_firmware
)paren
suffix:semicolon
DECL|variable|b1_reset_ctr
id|EXPORT_SYMBOL
c_func
(paren
id|b1_reset_ctr
)paren
suffix:semicolon
DECL|variable|b1_register_appl
id|EXPORT_SYMBOL
c_func
(paren
id|b1_register_appl
)paren
suffix:semicolon
DECL|variable|b1_release_appl
id|EXPORT_SYMBOL
c_func
(paren
id|b1_release_appl
)paren
suffix:semicolon
DECL|variable|b1_send_message
id|EXPORT_SYMBOL
c_func
(paren
id|b1_send_message
)paren
suffix:semicolon
DECL|variable|b1_parse_version
id|EXPORT_SYMBOL
c_func
(paren
id|b1_parse_version
)paren
suffix:semicolon
DECL|variable|b1_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|b1_interrupt
)paren
suffix:semicolon
DECL|variable|b1ctl_read_proc
id|EXPORT_SYMBOL
c_func
(paren
id|b1ctl_read_proc
)paren
suffix:semicolon
DECL|function|b1_init
r_static
r_int
id|__init
id|b1_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_char
id|rev
(braket
l_int|32
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|revision
comma
l_char|&squot;:&squot;
)paren
)paren
op_ne
l_int|0
op_logical_and
id|p
(braket
l_int|1
)braket
)paren
(brace
id|strlcpy
c_func
(paren
id|rev
comma
id|p
op_plus
l_int|2
comma
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|rev
comma
l_char|&squot;$&squot;
)paren
)paren
op_ne
l_int|0
op_logical_and
id|p
OG
id|rev
)paren
op_star
(paren
id|p
op_minus
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|strcpy
c_func
(paren
id|rev
comma
l_string|&quot;1.0&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;b1: revision %s&bslash;n&quot;
comma
id|rev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b1_exit
r_static
r_void
id|__exit
id|b1_exit
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|b1_init
id|module_init
c_func
(paren
id|b1_init
)paren
suffix:semicolon
DECL|variable|b1_exit
id|module_exit
c_func
(paren
id|b1_exit
)paren
suffix:semicolon
eof
