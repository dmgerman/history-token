multiline_comment|/* $Id: isdn_net.c,v 1.140.6.11 2001/11/06 20:58:28 kai Exp $&n; *&n; * Linux ISDN subsystem, network interfaces and related functions (linklevel).&n; *&n; * Copyright 1994-1998  by Fritz Elfert (fritz@isdn4linux.de)&n; *           1995,96    by Thinking Objects Software GmbH Wuerzburg&n; *           1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *           1999-2002  by Kai Germaschewski &lt;kai@germaschewski.name&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; * Data Over Voice (DOV) support added - Guy Ellis 23-Mar-02 &n; *                                       guy@traverse.com.au&n; * Outgoing calls - looks for a &squot;V&squot; in first char of dialed number&n; * Incoming calls - checks first character of eaz as follows:&n; *   Numeric - accept DATA only - original functionality&n; *   &squot;V&squot;     - accept VOICE (DOV) only&n; *   &squot;B&squot;     - accept BOTH DATA and DOV types&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/pkt_sched.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#include &lt;linux/concap.h&gt;
macro_line|#include &quot;isdn_concap.h&quot;
macro_line|#include &quot;isdn_ciscohdlck.h&quot;
multiline_comment|/*&n; * Outline of new tbusy handling: &n; *&n; * Old method, roughly spoken, consisted of setting tbusy when entering&n; * isdn_net_start_xmit() and at several other locations and clearing&n; * it from isdn_net_start_xmit() thread when sending was successful.&n; *&n; * With 2.3.x multithreaded network core, to prevent problems, tbusy should&n; * only be set by the isdn_net_start_xmit() thread and only when a tx-busy&n; * condition is detected. Other threads (in particular isdn_net_stat_callb())&n; * are only allowed to clear tbusy.&n; *&n; * -HE&n; */
multiline_comment|/*&n; * About SOFTNET:&n; * Most of the changes were pretty obvious and basically done by HE already.&n; *&n; * One problem of the isdn net device code is that is uses struct net_device&n; * for masters and slaves. However, only master interface are registered to &n; * the network layer, and therefore, it only makes sense to call netif_* &n; * functions on them.&n; *&n; * --KG&n; */
multiline_comment|/* &n; * Find out if the netdevice has been ifup-ed yet.&n; */
r_static
r_inline
r_int
DECL|function|isdn_net_device_started
id|isdn_net_device_started
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_return
id|netif_running
c_func
(paren
op_amp
id|idev-&gt;mlp-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * stop the network -&gt; net_device queue.&n; */
r_static
r_inline
r_void
DECL|function|isdn_net_dev_stop_queue
id|isdn_net_dev_stop_queue
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|netif_stop_queue
c_func
(paren
op_amp
id|idev-&gt;mlp-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * find out if the net_device which this lp belongs to (lp can be&n; * master or slave) is busy. It&squot;s busy iff all (master and slave) &n; * queues are busy&n; */
r_static
r_inline
r_int
DECL|function|isdn_net_device_busy
id|isdn_net_device_busy
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_dev_busy
c_func
(paren
id|idev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|mlp-&gt;online_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|idev
comma
op_amp
id|mlp-&gt;online
comma
id|online
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_dev_busy
c_func
(paren
id|idev
)paren
)paren
(brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mlp-&gt;online_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_inline
DECL|function|isdn_net_inc_frame_cnt
r_void
id|isdn_net_inc_frame_cnt
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|idev-&gt;frame_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_device_busy
c_func
(paren
id|idev
)paren
)paren
id|isdn_net_dev_stop_queue
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|isdn_net_dec_frame_cnt
id|isdn_net_dec_frame_cnt
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|idev-&gt;frame_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_device_busy
c_func
(paren
id|idev
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|idev-&gt;super_tx_queue
)paren
)paren
id|tasklet_schedule
c_func
(paren
op_amp
id|idev-&gt;tlet
)paren
suffix:semicolon
r_else
id|isdn_net_dev_wake_queue
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
DECL|function|isdn_net_zero_frame_cnt
r_void
id|isdn_net_zero_frame_cnt
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|idev-&gt;frame_cnt
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Prototypes */
r_int
id|isdn_net_handle_event
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
DECL|variable|isdn_net_revision
r_char
op_star
id|isdn_net_revision
op_assign
l_string|&quot;$Revision: 1.140.6.11 $&quot;
suffix:semicolon
multiline_comment|/* A packet has successfully been sent out. */
r_int
DECL|function|isdn_net_bsent
id|isdn_net_bsent
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|isdn_net_dec_frame_cnt
c_func
(paren
id|idev
)paren
suffix:semicolon
id|mlp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|mlp-&gt;stats.tx_bytes
op_add_assign
id|c-&gt;parm.length
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_net_unreachable
id|isdn_net_unreachable
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|reason
)paren
(brace
id|u_short
id|proto
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_net: %s: %s, signalling dst_link_failure %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|reason
op_ne
l_int|NULL
)paren
ques
c_cond
id|reason
suffix:colon
l_string|&quot;unknown&quot;
comma
(paren
id|proto
op_ne
id|ETH_P_IP
)paren
ques
c_cond
l_string|&quot;Protocol != ETH_P_IP&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Handle status-messages from ISDN-interfacecard.&n; * This function is called from within the main-status-dispatcher&n; * isdn_status_callback, which itself is called from the low-level driver.&n; * Return: 1 = Event handled, 0 = not for us or unknown Event.&n; */
r_int
DECL|function|isdn_net_stat_callback
id|isdn_net_stat_callback
c_func
(paren
r_int
id|idx
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_slot_idev
c_func
(paren
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|HERE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|isdn_net_handle_event
c_func
(paren
id|idev
comma
id|c-&gt;command
comma
id|c
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_net_log_skb
id|isdn_net_log_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
multiline_comment|/* hopefully, this was set correctly */
r_int
r_int
id|proto
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
r_int
id|data_ofs
suffix:semicolon
r_struct
id|ip_ports
(brace
r_int
r_int
id|source
suffix:semicolon
r_int
r_int
id|dest
suffix:semicolon
)brace
op_star
id|ipp
suffix:semicolon
r_char
id|addinfo
(braket
l_int|100
)braket
suffix:semicolon
id|data_ofs
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_amp
l_int|15
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
r_switch
c_cond
(paren
id|p
(braket
l_int|9
)braket
)paren
(brace
r_case
id|IPPROTO_ICMP
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot;ICMP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPPROTO_TCP
suffix:colon
r_case
id|IPPROTO_UDP
suffix:colon
id|ipp
op_assign
(paren
r_struct
id|ip_ports
op_star
)paren
(paren
op_amp
id|p
(braket
id|data_ofs
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|addinfo
comma
l_string|&quot;%s, port: %d -&gt; %d&quot;
comma
id|p
(braket
l_int|9
)braket
op_eq
id|IPPROTO_TCP
ques
c_cond
l_string|&quot;TCP&quot;
suffix:colon
l_string|&quot;UDP&quot;
comma
id|ntohs
c_func
(paren
id|ipp-&gt;source
)paren
comma
id|ntohs
c_func
(paren
id|ipp-&gt;dest
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sprintf
c_func
(paren
id|addinfo
comma
l_string|&quot;type %d&quot;
comma
id|p
(braket
l_int|9
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OPEN: %u.%u.%u.%u -&gt; %u.%u.%u.%u %s&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|p
op_plus
l_int|12
)paren
)paren
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|p
op_plus
l_int|16
)paren
)paren
comma
id|addinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_ARP
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OPEN: ARP %d.%d.%d.%d -&gt; *.*.*.* ?%d.%d.%d.%d&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|p
op_plus
l_int|14
)paren
)paren
comma
id|NIPQUAD
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|p
op_plus
l_int|24
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OPEN: unknown proto %#x&bslash;n&quot;
comma
id|proto
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * this function is used to send supervisory data, i.e. data which was&n; * not received from the network layer, but e.g. frames from ipppd, CCP&n; * reset frames etc.&n; */
r_void
DECL|function|isdn_net_write_super
id|isdn_net_write_super
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|in_irq
c_func
(paren
)paren
)paren
(brace
singleline_comment|// we can&squot;t grab the lock from irq context, 
singleline_comment|// so we just queue the packet
id|skb_queue_tail
c_func
(paren
op_amp
id|idev-&gt;super_tx_queue
comma
id|skb
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|idev-&gt;tlet
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_dev_busy
c_func
(paren
id|idev
)paren
)paren
(brace
id|isdn_net_writebuf_skb
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|idev-&gt;super_tx_queue
comma
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * all frames sent from the (net) LL to a HL driver should go via this function&n; * it&squot;s serialized by the caller holding the idev-&gt;xmit_lock spinlock&n; */
DECL|function|isdn_net_writebuf_skb
r_void
id|isdn_net_writebuf_skb
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* save len */
multiline_comment|/* before obtaining the lock the caller should have checked that&n;&t;   the lp isn&squot;t busy */
r_if
c_cond
(paren
id|isdn_net_dev_busy
c_func
(paren
id|idev
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_online
c_func
(paren
id|idev
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_slot_write
c_func
(paren
id|idev-&gt;isdn_slot
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|len
)paren
(brace
multiline_comment|/* we should never get here */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: HL driver queue full&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|idev-&gt;transcount
op_add_assign
id|len
suffix:semicolon
id|isdn_net_inc_frame_cnt
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
id|error
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|mlp-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_net_dial_slave
id|isdn_net_dial_slave
c_func
(paren
id|isdn_net_local
op_star
id|mlp
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|idev
comma
op_amp
id|mlp-&gt;slaves
comma
id|slaves
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|idev
)paren
)paren
(brace
id|isdn_net_dial
c_func
(paren
id|idev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *  Based on cps-calculation, check if device is overloaded.&n; *  If so, and if a slave exists, trigger dialing for it.&n; *  If any slave is online, deliver packets using a simple round robin&n; *  scheme.&n; *&n; *  Return: 0 on success, !0 on failure.&n; */
r_int
DECL|function|isdn_net_start_xmit
id|isdn_net_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
op_assign
id|ndev-&gt;priv
suffix:semicolon
id|ndev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|mlp-&gt;online
)paren
)paren
r_return
id|isdn_net_autodial
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
id|idev
op_assign
id|isdn_net_get_locked_dev
c_func
(paren
id|mlp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: all channels busy - requeuing!&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* we have our idev locked from now on */
id|isdn_net_writebuf_skb
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
multiline_comment|/* the following stuff is here for backwards compatibility.&n;&t; * in future, start-up and hangup of slaves (based on current load)&n;&t; * should move to userspace and get based on an overall cps&n;&t; * calculation&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_ne
id|idev-&gt;last_jiffies
)paren
(brace
id|idev-&gt;cps
op_assign
id|idev-&gt;transcount
op_star
id|HZ
op_div
(paren
id|jiffies
op_minus
id|idev-&gt;last_jiffies
)paren
suffix:semicolon
id|idev-&gt;last_jiffies
op_assign
id|jiffies
suffix:semicolon
id|idev-&gt;transcount
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %d bogocps&bslash;n&quot;
comma
id|idev-&gt;name
comma
id|idev-&gt;cps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;cps
OG
id|mlp-&gt;triggercps
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|idev-&gt;sqfull
)paren
(brace
multiline_comment|/* First time overload: set timestamp only */
id|idev-&gt;sqfull
op_assign
l_int|1
suffix:semicolon
id|idev-&gt;sqfull_stamp
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* subsequent overload: if slavedelay exceeded, start dialing */
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|idev-&gt;sqfull_stamp
op_plus
id|mlp-&gt;slavedelay
)paren
)paren
(brace
id|isdn_net_dial_slave
c_func
(paren
id|mlp
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|idev-&gt;sqfull
op_logical_and
id|time_after
c_func
(paren
id|jiffies
comma
id|idev-&gt;sqfull_stamp
op_plus
id|mlp-&gt;slavedelay
op_plus
l_int|10
op_star
id|HZ
)paren
)paren
(brace
id|idev-&gt;sqfull
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* this is a hack to allow auto-hangup for slaves on moderate loads */
id|list_del
c_func
(paren
op_amp
id|mlp-&gt;online
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|mlp-&gt;online
comma
op_amp
id|idev-&gt;online
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|isdn_net_autodial
id|isdn_net_autodial
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|ndev-&gt;priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
op_assign
id|list_entry
c_func
(paren
id|mlp-&gt;slaves.next
comma
id|isdn_net_dev
comma
id|slaves
)paren
suffix:semicolon
multiline_comment|/* are we dialing already? */
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|idev
)paren
)paren
r_goto
id|stop_queue
suffix:semicolon
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|mlp
)paren
op_ne
id|ISDN_NET_DM_AUTO
)paren
r_goto
id|discard
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_dial
c_func
(paren
id|idev
)paren
OL
l_int|0
)paren
r_goto
id|discard
suffix:semicolon
multiline_comment|/* Log packet, which triggered dialing */
r_if
c_cond
(paren
id|dev-&gt;net_verbose
)paren
id|isdn_net_log_skb
c_func
(paren
id|skb
comma
id|idev
)paren
suffix:semicolon
id|stop_queue
suffix:colon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|discard
suffix:colon
id|isdn_net_unreachable
c_func
(paren
id|ndev
comma
id|skb
comma
l_string|&quot;dial rejected&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Got a packet from ISDN-Channel.&n; */
r_static
r_void
DECL|function|isdn_net_receive
id|isdn_net_receive
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|idev-&gt;transcount
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|mlp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|mlp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|skb-&gt;dev
op_assign
op_amp
id|mlp-&gt;dev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|isdn_dumppkt
c_func
(paren
l_string|&quot;R:&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|40
)paren
suffix:semicolon
id|mlp-&gt;ops
op_member_access_from_pointer
id|receive
c_func
(paren
id|mlp
comma
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * A packet arrived via ISDN. Search interface-chain for a corresponding&n; * interface. If found, deliver packet to receiver-function and return 1,&n; * else return 0.&n; */
r_int
DECL|function|isdn_net_rcv_skb
id|isdn_net_rcv_skb
c_func
(paren
r_int
id|idx
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_slot_idev
c_func
(paren
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|HERE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_online
c_func
(paren
id|idev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|isdn_net_receive
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * An incoming call-request has arrived.&n; * Search the interface-chain for an appropriate interface.&n; * If found, connect the interface to the ISDN-channel and initiate&n; * D- and B-Channel-setup. If secure-flag is set, accept only&n; * configured phone-numbers. If callback-flag is set, initiate&n; * callback-dialing.&n; *&n; * Return-Value: 0 = No appropriate interface for this call.&n; *               1 = Call accepted&n; *               2 = Reject call, wait cbdelay, then call back&n; *               3 = Reject call&n; *               4 = Wait cbdelay, then call back&n; *               5 = No appropriate interface for this call,&n; *                   would eventually match if CID was longer.&n; */
r_int
DECL|function|isdn_net_find_icall
id|isdn_net_find_icall
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_int
id|idx
comma
id|setup_parm
op_star
id|setup
)paren
(brace
r_char
op_star
id|eaz
suffix:semicolon
r_int
r_char
id|si1
comma
id|si2
suffix:semicolon
r_int
id|match_more
op_assign
l_int|0
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_char
id|nr
(braket
l_int|32
)braket
suffix:semicolon
r_char
op_star
id|my_eaz
suffix:semicolon
r_int
id|slot
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|ch
)paren
suffix:semicolon
multiline_comment|/* Search name in netdev-chain */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|setup-&gt;phone
(braket
l_int|0
)braket
)paren
(brace
id|nr
(braket
l_int|0
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
id|nr
(braket
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: Incoming call without OAD, assuming &squot;0&squot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|nr
comma
id|setup-&gt;phone
)paren
suffix:semicolon
)brace
id|si1
op_assign
id|setup-&gt;si1
suffix:semicolon
id|si2
op_assign
id|setup-&gt;si2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|setup-&gt;eazmsn
(braket
l_int|0
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: Incoming call without CPN, assuming &squot;0&squot;&bslash;n&quot;
)paren
suffix:semicolon
id|eaz
op_assign
l_string|&quot;0&quot;
suffix:semicolon
)brace
r_else
(brace
id|eaz
op_assign
id|setup-&gt;eazmsn
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: call from %s,%d,%d -&gt; %s&bslash;n&quot;
comma
id|nr
comma
id|si1
comma
id|si2
comma
id|eaz
)paren
suffix:semicolon
multiline_comment|/* Accept DATA and VOICE calls at this stage&n;        local eaz is checked later for allowed call types */
r_if
c_cond
(paren
(paren
id|si1
op_ne
l_int|7
)paren
op_logical_and
(paren
id|si1
op_ne
l_int|1
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: Service-Indicator not 1 or 7, ignored&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|n
op_assign
l_int|NULL
suffix:semicolon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: di=%d ch=%d idx=%d usg=%d&bslash;n&quot;
comma
id|di
comma
id|ch
comma
id|idx
comma
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
multiline_comment|/* check acceptable call types for DOV */
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: if=&squot;%s&squot;, l.msn=%s, l.flags=%#x, l.dstate=%d&bslash;n&quot;
comma
id|idev-&gt;name
comma
id|mlp-&gt;msn
comma
id|mlp-&gt;flags
comma
id|idev-&gt;dialstate
)paren
suffix:semicolon
id|my_eaz
op_assign
id|isdn_slot_map_eaz2msn
c_func
(paren
id|slot
comma
id|mlp-&gt;msn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si1
op_eq
l_int|1
)paren
(brace
multiline_comment|/* it&squot;s a DOV call, check if we allow it */
r_if
c_cond
(paren
op_star
id|my_eaz
op_eq
l_char|&squot;v&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;V&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;b&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;B&squot;
)paren
id|my_eaz
op_increment
suffix:semicolon
multiline_comment|/* skip to allow a match */
r_else
r_continue
suffix:semicolon
multiline_comment|/* force non match */
)brace
r_else
(brace
multiline_comment|/* it&squot;s a DATA call, check if we allow it */
r_if
c_cond
(paren
op_star
id|my_eaz
op_eq
l_char|&squot;b&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;B&squot;
)paren
id|my_eaz
op_increment
suffix:semicolon
multiline_comment|/* skip to allow a match */
)brace
r_switch
c_cond
(paren
id|isdn_msncmp
c_func
(paren
id|eaz
comma
id|my_eaz
)paren
)paren
(brace
r_case
l_int|1
suffix:colon
r_continue
suffix:semicolon
r_case
l_int|2
suffix:colon
id|match_more
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|idev
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|USG_NONE
c_func
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
)paren
r_continue
suffix:semicolon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match1, pdev=%d pch=%d&bslash;n&quot;
comma
id|idev-&gt;pre_device
comma
id|idev-&gt;pre_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
op_amp
id|ISDN_USAGE_EXCLUSIVE
op_logical_and
(paren
id|idev-&gt;pre_channel
op_ne
id|ch
op_logical_or
id|idev-&gt;pre_device
op_ne
id|di
)paren
)paren
(brace
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: excl check failed&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match2&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_SECURE
)paren
(brace
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|mlp-&gt;phone
(braket
l_int|0
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_msncmp
c_func
(paren
id|nr
comma
id|n-&gt;num
)paren
)paren
(brace
r_goto
id|found
suffix:semicolon
)brace
)brace
r_continue
suffix:semicolon
)brace
id|found
suffix:colon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match3&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* matching interface found */
multiline_comment|/*&n;&t;&t; * Is the state STOPPED?&n;&t;&t; * If so, no dialin is allowed,&n;&t;&t; * so reject actively.&n;&t;&t; * */
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|mlp
)paren
op_eq
id|ISDN_NET_DM_OFF
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;incoming call, interface %s `stopped&squot; -&gt; rejected&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Is the interface up?&n;&t;&t; * If not, reject the call actively.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_device_started
c_func
(paren
id|idev
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: incoming call, interface down -&gt; rejected&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
(brace
id|retval
op_assign
id|isdn_net_do_callback
c_func
(paren
id|idev
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: call from %s -&gt; %s accepted&bslash;n&quot;
comma
id|idev-&gt;name
comma
id|nr
comma
id|eaz
)paren
suffix:semicolon
id|isdn_net_accept
c_func
(paren
id|idev
comma
id|idx
comma
id|nr
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: call from %s -&gt; %d %s ignored&bslash;n&quot;
comma
id|nr
comma
id|slot
comma
id|eaz
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|match_more
op_eq
l_int|2
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called from certain upper protocol layers (multilink ppp&n; * and x25iface encapsulation module) that want to initiate dialing&n; * themselves.&n; */
r_int
DECL|function|isdn_net_dial_req
id|isdn_net_dial_req
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
multiline_comment|/* is there a better error code? */
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|mlp
)paren
op_ne
id|ISDN_NET_DM_AUTO
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
id|isdn_net_dial
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
singleline_comment|// ISDN_NET_ENCAP_IPTYP
singleline_comment|// ethernet type field
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_iptyp_header
id|isdn_iptyp_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|plen
)paren
(brace
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
id|type
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_iptyp_receive
id|isdn_iptyp_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|get_u16
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|skb-&gt;protocol
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|iptyp_ops
r_static
r_struct
id|isdn_netif_ops
id|iptyp_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_net_start_xmit
comma
dot
id|hard_header
op_assign
id|isdn_iptyp_header
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|addr_len
op_assign
l_int|2
comma
dot
id|receive
op_assign
id|isdn_iptyp_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_UIHDLC
singleline_comment|// HDLC with UI-Frames (for ispa with -h1 option) */
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_uihdlc_header
id|isdn_uihdlc_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|plen
)paren
(brace
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
l_int|0x0103
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_uihdlc_receive
id|isdn_uihdlc_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|uihdlc_ops
r_static
r_struct
id|isdn_netif_ops
id|uihdlc_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_net_start_xmit
comma
dot
id|hard_header
op_assign
id|isdn_uihdlc_header
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_HDLC
comma
dot
id|addr_len
op_assign
l_int|2
comma
dot
id|receive
op_assign
id|isdn_uihdlc_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_RAWIP
singleline_comment|// RAW-IP without MAC-Header
singleline_comment|// ======================================================================
r_static
r_void
DECL|function|isdn_rawip_receive
id|isdn_rawip_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|rawip_ops
r_static
r_struct
id|isdn_netif_ops
id|rawip_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_net_start_xmit
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|receive
op_assign
id|isdn_rawip_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_ETHER
singleline_comment|// Ethernet over ISDN
singleline_comment|// ======================================================================
r_static
r_void
DECL|function|isdn_ether_receive
id|isdn_ether_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|skb-&gt;dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ether_open
id|isdn_ether_open
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|lp-&gt;dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Fill in the MAC-level header ... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
l_int|0xfc
suffix:semicolon
id|in_dev
op_assign
id|dev-&gt;ip_ptr
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(brace
multiline_comment|/* any address will do - we take the first */
r_struct
id|in_ifaddr
op_star
id|ifa
op_assign
id|in_dev-&gt;ifa_list
suffix:semicolon
r_if
c_cond
(paren
id|ifa
)paren
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|2
comma
op_amp
id|ifa-&gt;ifa_local
comma
l_int|4
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ether_init
id|isdn_ether_init
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|lp-&gt;dev
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|10
suffix:semicolon
id|dev-&gt;hard_header_len
op_add_assign
id|isdn_hard_header_len
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ether_ops
r_static
r_struct
id|isdn_netif_ops
id|ether_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_net_start_xmit
comma
dot
id|hard_header
op_assign
id|eth_header
comma
dot
id|receive
op_assign
id|isdn_ether_receive
comma
dot
id|init
op_assign
id|isdn_ether_init
comma
dot
id|open
op_assign
id|isdn_ether_open
comma
)brace
suffix:semicolon
singleline_comment|// ======================================================================
r_void
DECL|function|isdn_net_init
id|isdn_net_init
c_func
(paren
r_void
)paren
(brace
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_ETHER
comma
op_amp
id|ether_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_RAWIP
comma
op_amp
id|rawip_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_IPTYP
comma
op_amp
id|iptyp_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_UIHDLC
comma
op_amp
id|uihdlc_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_CISCOHDLC
comma
op_amp
id|ciscohdlck_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_CISCOHDLCK
comma
op_amp
id|ciscohdlck_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_X25
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_X25IFACE
comma
op_amp
id|isdn_x25_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_PPP
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_SYNCPPP
comma
op_amp
id|isdn_ppp_ops
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
