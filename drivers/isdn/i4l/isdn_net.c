multiline_comment|/* $Id: isdn_net.c,v 1.140.6.11 2001/11/06 20:58:28 kai Exp $&n; *&n; * Linux ISDN subsystem, network interfaces and related functions (linklevel).&n; *&n; * Copyright 1994-1998  by Fritz Elfert (fritz@isdn4linux.de)&n; *           1995,96    by Thinking Objects Software GmbH Wuerzburg&n; *           1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *           1999-2002  by Kai Germaschewski &lt;kai@germaschewski.name&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; * Data Over Voice (DOV) support added - Guy Ellis 23-Mar-02 &n; *                                       guy@traverse.com.au&n; * Outgoing calls - looks for a &squot;V&squot; in first char of dialed number&n; * Incoming calls - checks first character of eaz as follows:&n; *   Numeric - accept DATA only - original functionality&n; *   &squot;V&squot;     - accept VOICE (DOV) only&n; *   &squot;B&squot;     - accept BOTH DATA and DOV types&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/pkt_sched.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#include &lt;linux/concap.h&gt;
macro_line|#include &quot;isdn_concap.h&quot;
macro_line|#include &quot;isdn_ciscohdlck.h&quot;
r_enum
(brace
DECL|enumerator|ST_NULL
id|ST_NULL
comma
DECL|enumerator|ST_OUT_WAIT_DCONN
id|ST_OUT_WAIT_DCONN
comma
DECL|enumerator|ST_OUT_WAIT_BCONN
id|ST_OUT_WAIT_BCONN
comma
DECL|enumerator|ST_IN_WAIT_DCONN
id|ST_IN_WAIT_DCONN
comma
DECL|enumerator|ST_IN_WAIT_BCONN
id|ST_IN_WAIT_BCONN
comma
DECL|enumerator|ST_ACTIVE
id|ST_ACTIVE
comma
DECL|enumerator|ST_WAIT_BEFORE_CB
id|ST_WAIT_BEFORE_CB
comma
)brace
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_CHARGE_NULL
id|ST_CHARGE_NULL
comma
DECL|enumerator|ST_CHARGE_GOT_CINF
id|ST_CHARGE_GOT_CINF
comma
multiline_comment|/* got a first charge info */
DECL|enumerator|ST_CHARGE_HAVE_CINT
id|ST_CHARGE_HAVE_CINT
comma
multiline_comment|/* got a second chare info and thus the timing */
)brace
suffix:semicolon
multiline_comment|/* keep clear of ISDN_CMD_* and ISDN_STAT_* */
r_enum
(brace
DECL|enumerator|EV_NET_DIAL
id|EV_NET_DIAL
op_assign
l_int|0x200
comma
DECL|enumerator|EV_NET_TIMER_IN_DCONN
id|EV_NET_TIMER_IN_DCONN
op_assign
l_int|0x201
comma
DECL|enumerator|EV_NET_TIMER_IN_BCONN
id|EV_NET_TIMER_IN_BCONN
op_assign
l_int|0x202
comma
DECL|enumerator|EV_NET_TIMER_OUT_DCONN
id|EV_NET_TIMER_OUT_DCONN
op_assign
l_int|0x203
comma
DECL|enumerator|EV_NET_TIMER_OUT_BCONN
id|EV_NET_TIMER_OUT_BCONN
op_assign
l_int|0x204
comma
DECL|enumerator|EV_NET_TIMER_CB
id|EV_NET_TIMER_CB
op_assign
l_int|0x205
comma
)brace
suffix:semicolon
DECL|variable|isdn_net_devs
id|LIST_HEAD
c_func
(paren
id|isdn_net_devs
)paren
suffix:semicolon
multiline_comment|/* Linked list of isdn_net_dev&squot;s */
multiline_comment|/*&n; * Outline of new tbusy handling: &n; *&n; * Old method, roughly spoken, consisted of setting tbusy when entering&n; * isdn_net_start_xmit() and at several other locations and clearing&n; * it from isdn_net_start_xmit() thread when sending was successful.&n; *&n; * With 2.3.x multithreaded network core, to prevent problems, tbusy should&n; * only be set by the isdn_net_start_xmit() thread and only when a tx-busy&n; * condition is detected. Other threads (in particular isdn_net_stat_callb())&n; * are only allowed to clear tbusy.&n; *&n; * -HE&n; */
multiline_comment|/*&n; * About SOFTNET:&n; * Most of the changes were pretty obvious and basically done by HE already.&n; *&n; * One problem of the isdn net device code is that is uses struct net_device&n; * for masters and slaves. However, only master interface are registered to &n; * the network layer, and therefore, it only makes sense to call netif_* &n; * functions on them.&n; *&n; * --KG&n; */
multiline_comment|/* &n; * Find out if the netdevice has been ifup-ed yet.&n; * For slaves, look at the corresponding master.&n; */
DECL|function|isdn_net_device_started
r_static
id|__inline__
r_int
id|isdn_net_device_started
c_func
(paren
id|isdn_net_dev
op_star
id|n
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|n-&gt;local
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;master
)paren
id|dev
op_assign
id|lp-&gt;master
suffix:semicolon
r_else
id|dev
op_assign
op_amp
id|n-&gt;dev
suffix:semicolon
r_return
id|netif_running
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * stop the network -&gt; net_device queue.&n; * For slaves, stop the corresponding master interface.&n; */
DECL|function|isdn_net_device_stop_queue
r_static
id|__inline__
r_void
id|isdn_net_device_stop_queue
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;master
)paren
id|netif_stop_queue
c_func
(paren
id|lp-&gt;master
)paren
suffix:semicolon
r_else
id|netif_stop_queue
c_func
(paren
op_amp
id|lp-&gt;netdev-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * find out if the net_device which this lp belongs to (lp can be&n; * master or slave) is busy. It&squot;s busy iff all (master and slave) &n; * queues are busy&n; */
DECL|function|isdn_net_device_busy
r_static
id|__inline__
r_int
id|isdn_net_device_busy
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|isdn_net_local
op_star
id|nlp
suffix:semicolon
id|isdn_net_dev
op_star
id|nd
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_lp_busy
c_func
(paren
id|lp
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;master
)paren
id|nd
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;master-&gt;priv
)paren
op_member_access_from_pointer
id|netdev
suffix:semicolon
r_else
id|nd
op_assign
id|lp-&gt;netdev
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|nd-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|nlp
op_assign
id|lp-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|nlp
op_ne
id|lp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_lp_busy
c_func
(paren
id|nlp
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|nd-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nlp
op_assign
id|nlp-&gt;next
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|nd-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|isdn_net_inc_frame_cnt
r_static
id|__inline__
r_void
id|isdn_net_inc_frame_cnt
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|lp-&gt;frame_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_device_busy
c_func
(paren
id|lp
)paren
)paren
id|isdn_net_device_stop_queue
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
DECL|function|isdn_net_dec_frame_cnt
r_static
id|__inline__
r_void
id|isdn_net_dec_frame_cnt
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|lp-&gt;frame_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|isdn_net_device_busy
c_func
(paren
id|lp
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|lp-&gt;super_tx_queue
)paren
)paren
(brace
id|queue_task
c_func
(paren
op_amp
id|lp-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_else
(brace
id|isdn_net_device_wake_queue
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|isdn_net_zero_frame_cnt
r_static
id|__inline__
r_void
id|isdn_net_zero_frame_cnt
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|lp-&gt;frame_cnt
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* For 2.2.x we leave the transmitter busy timeout at 2 secs, just &n; * to be safe.&n; * For 2.3.x we push it up to 20 secs, because call establishment&n; * (in particular callback) may take such a long time, and we &n; * don&squot;t want confusing messages in the log. However, there is a slight&n; * possibility that this large timeout will break other things like MPPP,&n; * which might rely on the tx timeout. If so, we&squot;ll find out this way...&n; */
DECL|macro|ISDN_NET_TX_TIMEOUT
mdefine_line|#define ISDN_NET_TX_TIMEOUT (20*HZ) 
DECL|variable|netif_ops
r_static
r_struct
id|isdn_netif_ops
op_star
id|netif_ops
(braket
id|ISDN_NET_ENCAP_NR
)braket
suffix:semicolon
r_int
DECL|function|register_isdn_netif
id|register_isdn_netif
c_func
(paren
r_int
id|encap
comma
r_struct
id|isdn_netif_ops
op_star
id|ops
)paren
(brace
r_if
c_cond
(paren
id|encap
OL
l_int|0
op_logical_or
id|encap
op_ge
id|ISDN_NET_ENCAP_NR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|netif_ops
(braket
id|encap
)braket
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|netif_ops
(braket
id|encap
)braket
op_assign
id|ops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Prototypes */
r_static
r_int
id|isdn_net_force_dial_lp
c_func
(paren
id|isdn_net_local
op_star
)paren
suffix:semicolon
r_static
r_int
id|isdn_net_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|do_dialout
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
suffix:semicolon
r_static
r_int
id|isdn_net_set_encap
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
r_int
id|encap
)paren
suffix:semicolon
r_static
r_int
id|isdn_net_handle_event
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
DECL|variable|isdn_net_revision
r_char
op_star
id|isdn_net_revision
op_assign
l_string|&quot;$Revision: 1.140.6.11 $&quot;
suffix:semicolon
multiline_comment|/*&n;  * Code for raw-networking over ISDN&n;  */
r_static
r_void
DECL|function|isdn_net_unreachable
id|isdn_net_unreachable
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|reason
)paren
(brace
id|u_short
id|proto
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_net: %s: %s, signalling dst_link_failure %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|reason
op_ne
l_int|NULL
)paren
ques
c_cond
id|reason
suffix:colon
l_string|&quot;unknown&quot;
comma
(paren
id|proto
op_ne
id|ETH_P_IP
)paren
ques
c_cond
l_string|&quot;Protocol != ETH_P_IP&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Open/initialize the board. */
r_static
r_int
DECL|function|isdn_net_open
id|isdn_net_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;ops
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;open
)paren
id|retval
op_assign
id|lp-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|isdn_MOD_INC_USE_COUNT
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * unbind a net-interface (resets interface after an error)&n; */
r_static
r_void
DECL|function|isdn_net_unbind_channel
id|isdn_net_unbind_channel
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|ulong
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;unbind
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|unbind
c_func
(paren
id|lp
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|lp-&gt;super_tx_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;master
)paren
(brace
multiline_comment|/* reset only master device */
multiline_comment|/* Moral equivalent of dev_purge_queues():&n;&t;&t;   BEWARE! This chunk of code cannot be called from hardware&n;&t;&t;   interrupt handler. I hope it is true. --ANK&n;&t;&t; */
id|qdisc_reset
c_func
(paren
id|lp-&gt;netdev-&gt;dev.qdisc
)paren
suffix:semicolon
)brace
id|lp-&gt;dialstate
op_assign
id|ST_NULL
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;isdn_slot
op_ge
l_int|0
)paren
(brace
id|isdn_slot_set_rx_netdev
c_func
(paren
id|lp-&gt;isdn_slot
comma
l_int|NULL
)paren
suffix:semicolon
id|isdn_slot_set_st_netdev
c_func
(paren
id|lp-&gt;isdn_slot
comma
l_int|NULL
)paren
suffix:semicolon
id|isdn_slot_free
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_USAGE_NET
)paren
suffix:semicolon
)brace
id|lp-&gt;isdn_slot
op_assign
op_minus
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Assign an ISDN-channel to a net-interface&n; */
r_static
r_int
DECL|function|isdn_net_bind_channel
id|isdn_net_bind_channel
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_int
id|idx
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;isdn_slot
op_assign
id|idx
suffix:semicolon
id|isdn_slot_set_rx_netdev
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|lp-&gt;netdev
)paren
suffix:semicolon
id|isdn_slot_set_st_netdev
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|lp-&gt;netdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;bind
)paren
id|retval
op_assign
id|lp-&gt;ops
op_member_access_from_pointer
id|bind
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform auto-hangup for net-interfaces.&n; *&n; * auto-hangup:&n; * Increment idle-counter (this counter is reset on any incoming or&n; * outgoing packet), if counter exceeds configured limit either do a&n; * hangup immediately or - if configured - wait until just before the next&n; * charge-info.&n; */
DECL|function|isdn_net_hup_timer
r_static
r_void
id|isdn_net_hup_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|lp
)paren
op_logical_or
id|lp-&gt;dialstate
op_ne
id|ST_ACTIVE
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: huptimer %d, onhtime %d, chargetime %ld, chargeint %d&bslash;n&quot;
comma
id|l-&gt;name
comma
id|l-&gt;huptimer
comma
id|l-&gt;onhtime
comma
id|l-&gt;chargetime
comma
id|l-&gt;chargeint
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lp-&gt;onhtime
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;huptimer
op_increment
op_le
id|lp-&gt;onhtime
)paren
r_goto
id|mod_timer
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;hupflags
op_amp
id|ISDN_MANCHARGE
op_logical_and
id|lp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
(brace
r_while
c_loop
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;chargetime
op_plus
id|lp-&gt;chargeint
)paren
)paren
id|lp-&gt;chargetime
op_add_assign
id|lp-&gt;chargeint
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;chargetime
op_plus
id|lp-&gt;chargeint
op_minus
l_int|2
op_star
id|HZ
)paren
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;outgoing
op_logical_or
id|lp-&gt;hupflags
op_amp
id|ISDN_INHUP
)paren
(brace
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|lp-&gt;outgoing
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;charge_state
op_ne
id|ST_CHARGE_HAVE_CINT
)paren
(brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: did not get CINT&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;chargetime
op_plus
id|lp-&gt;chargeint
)paren
)paren
(brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: chtime = %lu, chint = %d&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;chargetime
comma
id|lp-&gt;chargeint
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|lp-&gt;hupflags
op_amp
id|ISDN_INHUP
)paren
(brace
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mod_timer
suffix:colon
id|mod_timer
c_func
(paren
op_amp
id|lp-&gt;hup_timer
comma
id|lp-&gt;hup_timer.expires
op_plus
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|isdn_net_lp_disconnected
r_static
r_void
id|isdn_net_lp_disconnected
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|isdn_net_rm_from_bundle
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
DECL|function|isdn_net_connected
r_static
r_void
id|isdn_net_connected
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|lp-&gt;dialstate
op_assign
id|ST_ACTIVE
suffix:semicolon
id|lp-&gt;hup_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;hup_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_ne
id|ISDN_NET_ENCAP_SYNCPPP
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;master
)paren
(brace
multiline_comment|/* is lp a slave? */
id|isdn_net_dev
op_star
id|nd
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;master-&gt;priv
)paren
op_member_access_from_pointer
id|netdev
suffix:semicolon
id|isdn_net_add_to_bundle
c_func
(paren
id|nd
comma
id|lp
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: %s connected&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
multiline_comment|/* If first Chargeinfo comes before B-Channel connect,&n;&t; * we correct the timestamp here.&n;&t; */
id|lp-&gt;chargetime
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* reset dial-timeout */
id|lp-&gt;dialstarted
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;dialwait_timer
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;transcount
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;cps
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;last_jiffies
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;connected
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|connected
c_func
(paren
id|lp
)paren
suffix:semicolon
r_else
id|isdn_net_device_wake_queue
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Handle status-messages from ISDN-interfacecard.&n; * This function is called from within the main-status-dispatcher&n; * isdn_status_callback, which itself is called from the low-level driver.&n; * Return: 1 = Event handled, 0 = not for us or unknown Event.&n; */
r_int
DECL|function|isdn_net_stat_callback
id|isdn_net_stat_callback
c_func
(paren
r_int
id|idx
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_slot_st_netdev
c_func
(paren
id|idx
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|lp
suffix:semicolon
r_int
id|cmd
op_assign
id|c-&gt;command
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|HERE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
r_return
id|isdn_net_handle_event
c_func
(paren
id|lp
comma
id|cmd
comma
id|c
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_net_dial_timer
id|isdn_net_dial_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|data
suffix:semicolon
id|isdn_net_handle_event
c_func
(paren
id|lp
comma
id|lp-&gt;dial_event
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Initiate dialout. Set phone-number-pointer to first number&n; * of interface.&n; */
r_static
r_void
DECL|function|init_dialout
id|init_dialout
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|lp-&gt;dial
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dialtimeout
OG
l_int|0
op_logical_and
(paren
id|lp-&gt;dialstarted
op_eq
l_int|0
op_logical_or
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;dialstarted
op_plus
id|lp-&gt;dialtimeout
op_plus
id|lp-&gt;dialwait
)paren
)paren
)paren
(brace
id|lp-&gt;dialstarted
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;dialwait_timer
op_assign
l_int|0
suffix:semicolon
)brace
id|lp-&gt;dialretry
op_assign
l_int|0
suffix:semicolon
id|do_dialout
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
multiline_comment|/* Setup interface, dial current phone-number, switch to next number.&n; * If list of phone-numbers is exhausted, increment&n; * retry-counter.&n; */
r_static
r_void
DECL|function|do_dialout
id|do_dialout
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|phone
suffix:semicolon
r_struct
id|dial_info
id|dial
op_assign
(brace
dot
id|l2_proto
op_assign
id|lp-&gt;l2_proto
comma
dot
id|l3_proto
op_assign
id|lp-&gt;l3_proto
comma
dot
id|si1
op_assign
l_int|7
comma
dot
id|si2
op_assign
l_int|0
comma
dot
id|msn
op_assign
id|lp-&gt;msn
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|lp
)paren
op_eq
id|ISDN_NET_DM_OFF
)paren
r_return
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;phone
(braket
l_int|1
)braket
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|phone
comma
op_amp
id|lp-&gt;phone
(braket
l_int|1
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|i
op_increment
op_eq
id|lp-&gt;dial
)paren
r_goto
id|found
suffix:semicolon
)brace
multiline_comment|/* otherwise start in front */
id|phone
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;phone
(braket
l_int|1
)braket
dot
id|next
comma
r_struct
id|isdn_net_phone
comma
id|list
)paren
suffix:semicolon
id|lp-&gt;dial
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;dialretry
op_increment
suffix:semicolon
id|found
suffix:colon
id|lp-&gt;dial
op_increment
suffix:semicolon
id|dial.phone
op_assign
id|phone-&gt;num
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dialretry
OG
id|lp-&gt;dialmax
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;dialtimeout
op_eq
l_int|0
)paren
(brace
id|lp-&gt;dialwait_timer
op_assign
id|jiffies
op_plus
id|lp-&gt;dialwait
suffix:semicolon
id|lp-&gt;dialstarted
op_assign
l_int|0
suffix:semicolon
)brace
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;dialtimeout
OG
l_int|0
op_logical_and
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;dialstarted
op_plus
id|lp-&gt;dialtimeout
)paren
)paren
(brace
id|lp-&gt;dialwait_timer
op_assign
id|jiffies
op_plus
id|lp-&gt;dialwait
suffix:semicolon
id|lp-&gt;dialstarted
op_assign
l_int|0
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Switch to next number or back to start if at end of list.&n;&t; */
id|isdn_slot_dial
c_func
(paren
id|lp-&gt;isdn_slot
comma
op_amp
id|dial
)paren
suffix:semicolon
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;outgoing
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;chargeint
)paren
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_HAVE_CINT
suffix:semicolon
r_else
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_NULL
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cbdelay
op_logical_and
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CBOUT
)paren
)paren
(brace
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
id|lp-&gt;cbdelay
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_CB
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_OUT_DCONN
suffix:semicolon
)brace
id|lp-&gt;dialstate
op_assign
id|ST_OUT_WAIT_DCONN
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
)brace
multiline_comment|/* For EV_NET_DIAL, returns 1 if timer callback is needed &n; * For ISDN_STAT_*, returns 1 if event was for us &n; */
r_static
r_int
DECL|function|isdn_net_handle_event
id|isdn_net_handle_event
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|lp-&gt;netdev
suffix:semicolon
id|isdn_ctrl
op_star
id|c
op_assign
id|arg
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: dialstate=%d pr=%#x&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;dialstate
comma
id|pr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|lp-&gt;dialstate
)paren
(brace
r_case
id|ST_ACTIVE
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|ISDN_STAT_BSENT
suffix:colon
multiline_comment|/* A packet has successfully been sent out */
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
(brace
id|isdn_net_dec_frame_cnt
c_func
(paren
id|lp
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|c-&gt;parm.length
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;disconnected
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|disconnected
c_func
(paren
id|lp
)paren
suffix:semicolon
id|isdn_net_lp_disconnected
c_func
(paren
id|lp
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote hangup&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Chargesum is %d&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;charge
)paren
suffix:semicolon
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_CINF
suffix:colon
multiline_comment|/* Charge-info from TelCo. Calculate interval between&n;&t;&t;&t; * charge-infos and set timestamp for last info for&n;&t;&t;&t; * usage by isdn_net_autohup()&n;&t;&t;&t; */
id|lp-&gt;charge
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|lp-&gt;charge_state
)paren
(brace
r_case
id|ST_CHARGE_NULL
suffix:colon
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_GOT_CINF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ST_CHARGE_GOT_CINF
suffix:colon
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_HAVE_CINT
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ST_CHARGE_HAVE_CINT
suffix:colon
id|lp-&gt;chargeint
op_assign
id|jiffies
op_minus
id|lp-&gt;chargetime
op_minus
l_int|2
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;chargetime
op_assign
id|jiffies
suffix:semicolon
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: got CINF&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ST_OUT_WAIT_DCONN
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|EV_NET_TIMER_OUT_DCONN
suffix:colon
multiline_comment|/* try again */
id|do_dialout
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|EV_NET_TIMER_CB
suffix:colon
multiline_comment|/* Remote does callback. Hangup after cbdelay, &n;&t;&t;&t; * then wait for incoming call */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: hangup waiting for callback ...&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DCONN
suffix:colon
multiline_comment|/* Got D-Channel-Connect, send B-Channel-request */
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|lp-&gt;dialstate
op_assign
id|ST_OUT_WAIT_BCONN
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_CMD_ACCEPTB
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_OUT_BCONN
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote hangup&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ST_OUT_WAIT_BCONN
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|EV_NET_TIMER_OUT_BCONN
suffix:colon
multiline_comment|/* try again */
id|do_dialout
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_set_usage
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|isdn_slot_usage
c_func
(paren
id|lp-&gt;isdn_slot
)paren
op_or
id|ISDN_USAGE_OUTGOING
)paren
suffix:semicolon
id|isdn_net_connected
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote hangup&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ST_IN_WAIT_DCONN
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|EV_NET_TIMER_IN_DCONN
suffix:colon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DCONN
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|lp-&gt;dialstate
op_assign
id|ST_IN_WAIT_BCONN
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_CMD_ACCEPTB
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_IN_BCONN
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote hangup&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ST_IN_WAIT_BCONN
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|EV_NET_TIMER_IN_BCONN
suffix:colon
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_set_rx_netdev
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|p
)paren
suffix:semicolon
id|isdn_net_connected
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote hangup&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ST_WAIT_BEFORE_CB
suffix:colon
r_switch
c_cond
(paren
id|pr
)paren
(brace
r_case
id|EV_NET_TIMER_CB
suffix:colon
multiline_comment|/* Callback Delay */
id|init_dialout
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;NOT HANDLED?&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform hangup for a net-interface.&n; */
r_void
DECL|function|isdn_net_hangup
id|isdn_net_hangup
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|lp-&gt;hup_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;slave
op_ne
l_int|NULL
)paren
(brace
id|isdn_net_local
op_star
id|slp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;slave-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|slp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: hang up slave %s before %s&bslash;n&quot;
comma
id|slp-&gt;name
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|slp
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: local hangup %s&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;disconnected
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|disconnected
c_func
(paren
id|lp
)paren
suffix:semicolon
id|isdn_net_lp_disconnected
c_func
(paren
id|lp
)paren
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_CMD_HANGUP
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Chargesum is %d&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;charge
)paren
suffix:semicolon
id|isdn_slot_all_eaz
c_func
(paren
id|lp-&gt;isdn_slot
)paren
suffix:semicolon
)brace
id|isdn_net_unbind_channel
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
r_void
DECL|function|isdn_net_hangup_all
id|isdn_net_hangup_all
c_func
(paren
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
op_amp
id|p-&gt;local
)paren
suffix:semicolon
)brace
)brace
r_typedef
r_struct
(brace
DECL|member|source
r_int
r_int
id|source
suffix:semicolon
DECL|member|dest
r_int
r_int
id|dest
suffix:semicolon
DECL|typedef|ip_ports
)brace
id|ip_ports
suffix:semicolon
r_static
r_void
DECL|function|isdn_net_log_skb
id|isdn_net_log_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|u_char
op_star
id|p
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
multiline_comment|/* hopefully, this was set correctly */
r_int
r_int
id|proto
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
r_int
id|data_ofs
suffix:semicolon
id|ip_ports
op_star
id|ipp
suffix:semicolon
r_char
id|addinfo
(braket
l_int|100
)braket
suffix:semicolon
id|addinfo
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* This check stolen from 2.1.72 dev_queue_xmit_nit() */
r_if
c_cond
(paren
id|skb-&gt;nh.raw
OL
id|skb-&gt;data
op_logical_or
id|skb-&gt;nh.raw
op_ge
id|skb-&gt;tail
)paren
(brace
multiline_comment|/* fall back to old isdn_net_log_packet method() */
r_char
op_star
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_net: protocol %04x is buggy, dev %s&bslash;n&quot;
comma
id|skb-&gt;protocol
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|p
op_assign
id|buf
suffix:semicolon
id|proto
op_assign
id|ETH_P_IP
suffix:semicolon
r_switch
c_cond
(paren
id|lp-&gt;p_encap
)paren
(brace
r_case
id|ISDN_NET_ENCAP_IPTYP
suffix:colon
id|proto
op_assign
id|ntohs
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_NET_ENCAP_ETHER
suffix:colon
id|proto
op_assign
id|ntohs
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|buf
(braket
l_int|12
)braket
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|buf
(braket
l_int|14
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_NET_ENCAP_CISCOHDLC
suffix:colon
id|proto
op_assign
id|ntohs
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|buf
(braket
l_int|4
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_NET_ENCAP_SYNCPPP
suffix:colon
id|proto
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
id|p
op_assign
op_amp
id|buf
(braket
id|IPPP_MAX_HEADER
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|data_ofs
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_amp
l_int|15
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
r_switch
c_cond
(paren
id|p
(braket
l_int|9
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; ICMP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; IGMP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; IPIP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|ipp
op_assign
(paren
id|ip_ports
op_star
)paren
(paren
op_amp
id|p
(braket
id|data_ofs
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|addinfo
comma
l_string|&quot; TCP, port: %d -&gt; %d&quot;
comma
id|ntohs
c_func
(paren
id|ipp-&gt;source
)paren
comma
id|ntohs
c_func
(paren
id|ipp-&gt;dest
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; EGP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; PUP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|17
suffix:colon
id|ipp
op_assign
(paren
id|ip_ports
op_star
)paren
(paren
op_amp
id|p
(braket
id|data_ofs
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|addinfo
comma
l_string|&quot; UDP, port: %d -&gt; %d&quot;
comma
id|ntohs
c_func
(paren
id|ipp-&gt;source
)paren
comma
id|ntohs
c_func
(paren
id|ipp-&gt;dest
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|22
suffix:colon
id|strcpy
c_func
(paren
id|addinfo
comma
l_string|&quot; IDP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OPEN: %d.%d.%d.%d -&gt; %d.%d.%d.%d%s&bslash;n&quot;
comma
id|p
(braket
l_int|12
)braket
comma
id|p
(braket
l_int|13
)braket
comma
id|p
(braket
l_int|14
)braket
comma
id|p
(braket
l_int|15
)braket
comma
id|p
(braket
l_int|16
)braket
comma
id|p
(braket
l_int|17
)braket
comma
id|p
(braket
l_int|18
)braket
comma
id|p
(braket
l_int|19
)braket
comma
id|addinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_ARP
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OPEN: ARP %d.%d.%d.%d -&gt; *.*.*.* ?%d.%d.%d.%d&bslash;n&quot;
comma
id|p
(braket
l_int|14
)braket
comma
id|p
(braket
l_int|15
)braket
comma
id|p
(braket
l_int|16
)braket
comma
id|p
(braket
l_int|17
)braket
comma
id|p
(braket
l_int|24
)braket
comma
id|p
(braket
l_int|25
)braket
comma
id|p
(braket
l_int|26
)braket
comma
id|p
(braket
l_int|27
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * this function is used to send supervisory data, i.e. data which was&n; * not received from the network layer, but e.g. frames from ipppd, CCP&n; * reset frames etc.&n; */
DECL|function|isdn_net_write_super
r_void
id|isdn_net_write_super
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|in_irq
c_func
(paren
)paren
)paren
(brace
singleline_comment|// we can&squot;t grab the lock from irq context, 
singleline_comment|// so we just queue the packet
id|skb_queue_tail
c_func
(paren
op_amp
id|lp-&gt;super_tx_queue
comma
id|skb
)paren
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|lp-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_lp_busy
c_func
(paren
id|lp
)paren
)paren
(brace
id|isdn_net_writebuf_skb
c_func
(paren
id|lp
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|lp-&gt;super_tx_queue
comma
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * called from tq_immediate&n; */
DECL|function|isdn_net_softint
r_static
r_void
id|isdn_net_softint
c_func
(paren
r_void
op_star
r_private
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
r_private
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|isdn_net_lp_busy
c_func
(paren
id|lp
)paren
)paren
(brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|lp-&gt;super_tx_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_break
suffix:semicolon
id|isdn_net_writebuf_skb
c_func
(paren
id|lp
comma
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * all frames sent from the (net) LL to a HL driver should go via this function&n; * it&squot;s serialized by the caller holding the lp-&gt;xmit_lock spinlock&n; */
DECL|function|isdn_net_writebuf_skb
r_void
id|isdn_net_writebuf_skb
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* save len */
multiline_comment|/* before obtaining the lock the caller should have checked that&n;&t;   the lp isn&squot;t busy */
r_if
c_cond
(paren
id|isdn_net_lp_busy
c_func
(paren
id|lp
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|ret
op_assign
id|isdn_slot_write
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|len
)paren
(brace
multiline_comment|/* we should never get here */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: HL driver queue full&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|lp-&gt;transcount
op_add_assign
id|len
suffix:semicolon
id|isdn_net_inc_frame_cnt
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
suffix:semicolon
id|error
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; *  Helper function for isdn_net_start_xmit.&n; *  When called, the connection is already established.&n; *  Based on cps-calculation, check if device is overloaded.&n; *  If so, and if a slave exists, trigger dialing for it.&n; *  If any slave is online, deliver packets using a simple round robin&n; *  scheme.&n; *&n; *  Return: 0 on success, !0 on failure.&n; */
r_static
r_int
DECL|function|isdn_net_xmit
id|isdn_net_xmit
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_dev
op_star
id|nd
suffix:semicolon
id|isdn_net_local
op_star
id|slp
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
id|ndev-&gt;priv
suffix:semicolon
r_int
id|retv
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;master
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* For the other encaps the header has already been built */
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_eq
id|ISDN_NET_ENCAP_SYNCPPP
)paren
(brace
r_return
id|isdn_ppp_xmit
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
)brace
id|nd
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|ndev-&gt;priv
)paren
op_member_access_from_pointer
id|netdev
suffix:semicolon
id|lp
op_assign
id|isdn_net_get_locked_lp
c_func
(paren
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: all channels busy - requeuing!&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* we have our lp locked from now on */
multiline_comment|/* Reset hangup-timeout */
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
singleline_comment|// FIXME?
id|isdn_net_writebuf_skb
c_func
(paren
id|lp
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|lp-&gt;xmit_lock
)paren
suffix:semicolon
multiline_comment|/* the following stuff is here for backwards compatibility.&n;&t; * in future, start-up and hangup of slaves (based on current load)&n;&t; * should move to userspace and get based on an overall cps&n;&t; * calculation&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_ne
id|lp-&gt;last_jiffies
)paren
(brace
id|lp-&gt;cps
op_assign
id|lp-&gt;transcount
op_star
id|HZ
op_div
(paren
id|jiffies
op_minus
id|lp-&gt;last_jiffies
)paren
suffix:semicolon
id|lp-&gt;last_jiffies
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;transcount
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %d bogocps&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;cps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cps
OG
id|lp-&gt;triggercps
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;slave
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;sqfull
)paren
(brace
multiline_comment|/* First time overload: set timestamp only */
id|lp-&gt;sqfull
op_assign
l_int|1
suffix:semicolon
id|lp-&gt;sqfull_stamp
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* subsequent overload: if slavedelay exceeded, start dialing */
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;sqfull_stamp
op_plus
id|lp-&gt;slavedelay
)paren
)paren
(brace
id|slp
op_assign
id|lp-&gt;slave-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|slp
)paren
)paren
(brace
id|isdn_net_force_dial_lp
c_func
(paren
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;slave-&gt;priv
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|lp-&gt;sqfull
op_logical_and
id|time_after
c_func
(paren
id|jiffies
comma
id|lp-&gt;sqfull_stamp
op_plus
id|lp-&gt;slavedelay
op_plus
(paren
l_int|10
op_star
id|HZ
)paren
)paren
)paren
(brace
id|lp-&gt;sqfull
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* this is a hack to allow auto-hangup for slaves on moderate loads */
id|nd-&gt;queue
op_assign
op_amp
id|nd-&gt;local
suffix:semicolon
)brace
r_return
id|retv
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_net_adjust_hdr
id|isdn_net_adjust_hdr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_eq
id|ISDN_NET_ENCAP_ETHER
)paren
(brace
r_int
id|pullsize
op_assign
(paren
id|ulong
)paren
id|skb-&gt;nh.raw
op_minus
(paren
id|ulong
)paren
id|skb-&gt;data
op_minus
id|ETH_HLEN
suffix:semicolon
r_if
c_cond
(paren
id|pullsize
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_net: Pull junk %d&bslash;n&quot;
comma
id|pullsize
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|pullsize
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|isdn_net_tx_timeout
r_void
id|isdn_net_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|ndev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_tx_timeout dev %s dialstate %d&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|lp-&gt;dialstate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dialstate
op_eq
id|ST_ACTIVE
)paren
(brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; * There is a certain probability that this currently&n;&t;&t; * works at all because if we always wake up the interface,&n;&t;&t; * then upper layer will try to send the next packet&n;&t;&t; * immediately. And then, the old clean_up logic in the&n;&t;&t; * driver will hopefully continue to work as it used to do.&n;&t;&t; *&n;&t;&t; * This is rather primitive right know, we better should&n;&t;&t; * clean internal queues here, in particular for multilink and&n;&t;&t; * ppp, and reset HL driver&squot;s channel, too.   --HE&n;&t;&t; *&n;&t;&t; * actually, this may not matter at all, because ISDN hardware&n;&t;&t; * should not see transmitter hangs at all IMO&n;&t;&t; * changed KERN_DEBUG to KERN_WARNING to find out if this is &n;&t;&t; * ever called   --KG&n;&t;&t; */
)brace
id|ndev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_net_autodial
id|isdn_net_autodial
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|ndev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|lp
)paren
op_eq
id|ISDN_NET_DM_AUTO
)paren
)paren
r_goto
id|discard
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dialwait_timer
op_le
l_int|0
)paren
r_if
c_cond
(paren
id|lp-&gt;dialstarted
OG
l_int|0
op_logical_and
id|lp-&gt;dialtimeout
OG
l_int|0
op_logical_and
id|time_before
c_func
(paren
id|jiffies
comma
id|lp-&gt;dialstarted
op_plus
id|lp-&gt;dialtimeout
op_plus
id|lp-&gt;dialwait
)paren
)paren
(brace
id|lp-&gt;dialwait_timer
op_assign
id|lp-&gt;dialstarted
op_plus
id|lp-&gt;dialtimeout
op_plus
id|lp-&gt;dialwait
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;dialwait_timer
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|lp-&gt;dialwait_timer
)paren
)paren
(brace
r_goto
id|discard
suffix:semicolon
)brace
id|lp-&gt;dialwait_timer
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_net_force_dial_lp
c_func
(paren
id|lp
)paren
OL
l_int|0
)paren
r_goto
id|discard
suffix:semicolon
multiline_comment|/* Log packet, which triggered dialing */
r_if
c_cond
(paren
id|dev-&gt;net_verbose
)paren
id|isdn_net_log_skb
c_func
(paren
id|skb
comma
id|lp
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|discard
suffix:colon
id|isdn_net_unreachable
c_func
(paren
id|ndev
comma
id|skb
comma
l_string|&quot;dial rejected&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Try sending a packet.&n; * If this interface isn&squot;t connected to a ISDN-Channel, find a free channel,&n; * and start dialing.&n; */
r_static
r_int
DECL|function|isdn_net_start_xmit
id|isdn_net_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|ndev-&gt;priv
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_eq
id|ISDN_NET_ENCAP_X25IFACE
)paren
r_return
id|isdn_x25_start_xmit
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
multiline_comment|/* auto-dialing xmit function */
id|isdn_net_adjust_hdr
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
id|isdn_dumppkt
c_func
(paren
l_string|&quot;S:&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|40
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
r_return
id|isdn_net_autodial
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
multiline_comment|/* Device is bound to an ISDN channel */
id|ndev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;dialstate
op_ne
id|ST_ACTIVE
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* ISDN connection is established, try sending */
id|retval
op_assign
id|isdn_net_xmit
c_func
(paren
id|ndev
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Shutdown a net-interface.&n; */
r_static
r_int
DECL|function|isdn_net_close
id|isdn_net_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device
op_star
id|p
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;close
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|lp
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|lp-&gt;slave
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
id|p-&gt;priv
)paren
op_member_access_from_pointer
id|slave
)paren
id|isdn_net_hangup
c_func
(paren
id|p-&gt;priv
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|isdn_MOD_DEC_USE_COUNT
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get statistics&n; */
r_static
r_struct
id|net_device_stats
op_star
DECL|function|isdn_net_get_stats
id|isdn_net_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * Got a packet from ISDN-Channel.&n; */
r_static
r_void
DECL|function|isdn_net_receive
id|isdn_net_receive
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|ndev-&gt;priv
suffix:semicolon
id|isdn_net_local
op_star
id|olp
op_assign
id|lp
suffix:semicolon
multiline_comment|/* original &squot;lp&squot; */
id|lp-&gt;transcount
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;master
)paren
(brace
multiline_comment|/* Bundling: If device is a slave-device, deliver to master, also&n;&t;&t; * handle master&squot;s statistics and hangup-timeout&n;&t;&t; */
id|ndev
op_assign
id|lp-&gt;master
suffix:semicolon
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|ndev-&gt;priv
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|ndev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|isdn_dumppkt
c_func
(paren
l_string|&quot;R:&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|40
)paren
suffix:semicolon
id|lp-&gt;ops
op_member_access_from_pointer
id|receive
c_func
(paren
id|lp-&gt;netdev
comma
id|olp
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * A packet arrived via ISDN. Search interface-chain for a corresponding&n; * interface. If found, deliver packet to receiver-function and return 1,&n; * else return 0.&n; */
r_int
DECL|function|isdn_net_rcv_skb
id|isdn_net_rcv_skb
c_func
(paren
r_int
id|idx
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_slot_rx_netdev
c_func
(paren
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|lp
)paren
op_logical_and
id|lp-&gt;dialstate
op_eq
id|ST_ACTIVE
)paren
(brace
id|isdn_net_receive
c_func
(paren
op_amp
id|p-&gt;dev
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Interface-setup. (just after registering a new interface)&n; */
r_static
r_int
DECL|function|isdn_net_init
id|isdn_net_init
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
multiline_comment|/* Setup the generic properties */
id|ndev-&gt;mtu
op_assign
l_int|1500
suffix:semicolon
id|ndev-&gt;tx_queue_len
op_assign
l_int|10
suffix:semicolon
id|ndev-&gt;open
op_assign
op_amp
id|isdn_net_open
suffix:semicolon
id|ndev-&gt;hard_start_xmit
op_assign
op_amp
id|isdn_net_start_xmit
suffix:semicolon
id|ndev-&gt;hard_header_len
op_assign
id|ETH_HLEN
op_plus
id|isdn_hard_header_len
c_func
(paren
)paren
suffix:semicolon
id|ndev-&gt;stop
op_assign
op_amp
id|isdn_net_close
suffix:semicolon
id|ndev-&gt;get_stats
op_assign
op_amp
id|isdn_net_get_stats
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_net_do_callback
id|isdn_net_do_callback
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_int
id|slot
suffix:semicolon
multiline_comment|/*&n;&t; * Is the state MANUAL?&n;&t; * If so, no callback can be made,&n;&t; * so reject actively.&n;&t; */
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|lp
)paren
op_eq
id|ISDN_NET_DM_OFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;incoming call for callback, interface %s `off&squot; -&gt; rejected&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: start callback&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Grab a free ISDN-Channel */
id|slot
op_assign
id|isdn_get_free_slot
c_func
(paren
id|ISDN_USAGE_NET
comma
id|lp-&gt;l2_proto
comma
id|lp-&gt;l3_proto
comma
id|lp-&gt;pre_device
comma
id|lp-&gt;pre_channel
comma
id|lp-&gt;msn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bind_channel
c_func
(paren
id|lp
comma
id|slot
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
multiline_comment|/* Setup dialstate. */
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
id|lp-&gt;cbdelay
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_CB
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|lp-&gt;dialstate
op_assign
id|ST_WAIT_BEFORE_CB
suffix:semicolon
multiline_comment|/* Initiate dialing by returning 2 or 4 */
r_return
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CBHUP
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|4
suffix:semicolon
id|err
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * An incoming call-request has arrived.&n; * Search the interface-chain for an appropriate interface.&n; * If found, connect the interface to the ISDN-channel and initiate&n; * D- and B-Channel-setup. If secure-flag is set, accept only&n; * configured phone-numbers. If callback-flag is set, initiate&n; * callback-dialing.&n; *&n; * Return-Value: 0 = No appropriate interface for this call.&n; *               1 = Call accepted&n; *               2 = Reject call, wait cbdelay, then call back&n; *               3 = Reject call&n; *               4 = Wait cbdelay, then call back&n; *               5 = No appropriate interface for this call,&n; *                   would eventually match if CID was longer.&n; */
r_int
DECL|function|isdn_net_find_icall
id|isdn_net_find_icall
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_int
id|idx
comma
id|setup_parm
op_star
id|setup
)paren
(brace
r_char
op_star
id|eaz
suffix:semicolon
r_int
r_char
id|si1
comma
id|si2
suffix:semicolon
r_int
id|match_more
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_char
id|nr
(braket
l_int|32
)braket
suffix:semicolon
r_char
op_star
id|my_eaz
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|slot
op_assign
id|isdn_dc2minor
c_func
(paren
id|di
comma
id|ch
)paren
suffix:semicolon
multiline_comment|/* Search name in netdev-chain */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|setup-&gt;phone
(braket
l_int|0
)braket
)paren
(brace
id|nr
(braket
l_int|0
)braket
op_assign
l_char|&squot;0&squot;
suffix:semicolon
id|nr
(braket
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: Incoming call without OAD, assuming &squot;0&squot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|nr
comma
id|setup-&gt;phone
)paren
suffix:semicolon
)brace
id|si1
op_assign
id|setup-&gt;si1
suffix:semicolon
id|si2
op_assign
id|setup-&gt;si2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|setup-&gt;eazmsn
(braket
l_int|0
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: Incoming call without CPN, assuming &squot;0&squot;&bslash;n&quot;
)paren
suffix:semicolon
id|eaz
op_assign
l_string|&quot;0&quot;
suffix:semicolon
)brace
r_else
(brace
id|eaz
op_assign
id|setup-&gt;eazmsn
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: call from %s,%d,%d -&gt; %s&bslash;n&quot;
comma
id|nr
comma
id|si1
comma
id|si2
comma
id|eaz
)paren
suffix:semicolon
multiline_comment|/* Accept DATA and VOICE calls at this stage&n;        local eaz is checked later for allowed call types */
r_if
c_cond
(paren
(paren
id|si1
op_ne
l_int|7
)paren
op_logical_and
(paren
id|si1
op_ne
l_int|1
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;net_verbose
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: Service-Indicator not 1 or 7, ignored&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|n
op_assign
l_int|NULL
suffix:semicolon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: di=%d ch=%d idx=%d usg=%d&bslash;n&quot;
comma
id|di
comma
id|ch
comma
id|idx
comma
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
multiline_comment|/* check acceptable call types for DOV */
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: if=&squot;%s&squot;, l.msn=%s, l.flags=%d, l.dstate=%d&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|lp-&gt;msn
comma
id|lp-&gt;flags
comma
id|lp-&gt;dialstate
)paren
suffix:semicolon
id|my_eaz
op_assign
id|isdn_slot_map_eaz2msn
c_func
(paren
id|slot
comma
id|lp-&gt;msn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si1
op_eq
l_int|1
)paren
(brace
multiline_comment|/* it&squot;s a DOV call, check if we allow it */
r_if
c_cond
(paren
op_star
id|my_eaz
op_eq
l_char|&squot;v&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;V&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;b&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;B&squot;
)paren
id|my_eaz
op_increment
suffix:semicolon
multiline_comment|/* skip to allow a match */
r_else
r_continue
suffix:semicolon
multiline_comment|/* force non match */
)brace
r_else
(brace
multiline_comment|/* it&squot;s a DATA call, check if we allow it */
r_if
c_cond
(paren
op_star
id|my_eaz
op_eq
l_char|&squot;b&squot;
op_logical_or
op_star
id|my_eaz
op_eq
l_char|&squot;B&squot;
)paren
id|my_eaz
op_increment
suffix:semicolon
multiline_comment|/* skip to allow a match */
)brace
r_switch
c_cond
(paren
id|isdn_msncmp
c_func
(paren
id|eaz
comma
id|my_eaz
)paren
)paren
(brace
r_case
l_int|1
suffix:colon
r_continue
suffix:semicolon
r_case
l_int|2
suffix:colon
id|match_more
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|lp
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|USG_NONE
c_func
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
)paren
r_continue
suffix:semicolon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match1, pdev=%d pch=%d&bslash;n&quot;
comma
id|lp-&gt;pre_device
comma
id|lp-&gt;pre_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
op_amp
id|ISDN_USAGE_EXCLUSIVE
op_logical_and
(paren
id|lp-&gt;pre_channel
op_ne
id|ch
op_logical_or
id|lp-&gt;pre_device
op_ne
id|di
)paren
)paren
(brace
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: excl check failed&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match2&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_SECURE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|lp-&gt;phone
(braket
l_int|0
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_msncmp
c_func
(paren
id|nr
comma
id|n-&gt;num
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|found
suffix:colon
id|dbg_net_icall
c_func
(paren
l_string|&quot;n_fi: match3&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* matching interface found */
multiline_comment|/*&n;&t;&t; * Is the state STOPPED?&n;&t;&t; * If so, no dialin is allowed,&n;&t;&t; * so reject actively.&n;&t;&t; * */
r_if
c_cond
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|lp
)paren
op_eq
id|ISDN_NET_DM_OFF
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;incoming call, interface %s `stopped&squot; -&gt; rejected&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Is the interface up?&n;&t;&t; * If not, reject the call actively.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_device_started
c_func
(paren
id|p
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: incoming call, interface down -&gt; rejected&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
multiline_comment|/* Interface is up, now see if it&squot;s a slave. If so, see if&n;&t;&t; * it&squot;s master and parent slave is online. If not, reject the call.&n;&t;&t; */
r_if
c_cond
(paren
id|lp-&gt;master
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;master-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ICALLslv: %s&bslash;n&quot;
comma
id|lp-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;master=%s&bslash;n&quot;
comma
id|mlp-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|mlp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;master online&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Master is online, find parent-slave (master if first slave) */
r_while
c_loop
(paren
id|mlp-&gt;slave
)paren
(brace
r_if
c_cond
(paren
(paren
id|isdn_net_local
op_star
)paren
id|mlp-&gt;slave-&gt;priv
op_eq
id|lp
)paren
r_break
suffix:semicolon
id|mlp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|mlp-&gt;slave-&gt;priv
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;master offline&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Found parent, if it&squot;s offline iterate next device */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;mlpf: %d&bslash;n&quot;
comma
id|isdn_net_bound
c_func
(paren
id|mlp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|mlp
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
(brace
id|retval
op_assign
id|isdn_net_do_callback
c_func
(paren
id|lp
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: call from %s -&gt; %s accepted&bslash;n&quot;
comma
id|lp-&gt;name
comma
id|nr
comma
id|eaz
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|isdn_slot_num
c_func
(paren
id|idx
)paren
comma
id|nr
)paren
suffix:semicolon
id|isdn_slot_set_usage
c_func
(paren
id|idx
comma
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
op_amp
id|ISDN_USAGE_EXCLUSIVE
)paren
op_or
id|ISDN_USAGE_NET
)paren
suffix:semicolon
id|isdn_net_bind_channel
c_func
(paren
id|lp
comma
id|idx
)paren
suffix:semicolon
id|lp-&gt;outgoing
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_NULL
suffix:semicolon
multiline_comment|/* Got incoming Call, setup L2 and L3 protocols,&n;&t;&t; * then wait for D-Channel-connect&n;&t;&t; */
id|cmd.arg
op_assign
id|lp-&gt;l2_proto
op_lshift
l_int|8
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_CMD_SETL2
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.arg
op_assign
id|lp-&gt;l3_proto
op_lshift
l_int|8
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|lp-&gt;isdn_slot
comma
id|ISDN_CMD_SETL3
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|lp-&gt;dial_timer.expires
op_assign
id|jiffies
op_plus
l_int|15
op_star
id|HZ
suffix:semicolon
id|lp-&gt;dial_event
op_assign
id|EV_NET_TIMER_IN_DCONN
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;dial_timer
)paren
suffix:semicolon
id|lp-&gt;dialstate
op_assign
id|ST_IN_WAIT_DCONN
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;net_verbose
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_net: call from %s -&gt; %d %s ignored&bslash;n&quot;
comma
id|nr
comma
id|slot
comma
id|eaz
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|match_more
op_eq
l_int|2
)paren
ques
c_cond
l_int|5
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Search list of net-interfaces for an interface with given name.&n; */
id|isdn_net_dev
op_star
DECL|function|isdn_net_findif
id|isdn_net_findif
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;local.name
comma
id|name
)paren
)paren
r_return
id|p
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Force a net-interface to dial out.&n; * This is called from the userlevel-routine below or&n; * from isdn_net_start_xmit().&n; */
r_static
r_int
DECL|function|isdn_net_force_dial_lp
id|isdn_net_force_dial_lp
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_int
id|slot
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bound
c_func
(paren
id|lp
)paren
op_logical_or
id|lp-&gt;dialstate
op_ne
id|ST_NULL
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;exclusive
op_ge
l_int|0
)paren
id|slot
op_assign
id|lp-&gt;exclusive
suffix:semicolon
r_else
id|slot
op_assign
id|isdn_get_free_slot
c_func
(paren
id|ISDN_USAGE_NET
comma
id|lp-&gt;l2_proto
comma
id|lp-&gt;l3_proto
comma
id|lp-&gt;pre_device
comma
id|lp-&gt;pre_channel
comma
id|lp-&gt;msn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_bind_channel
c_func
(paren
id|lp
comma
id|slot
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
suffix:semicolon
multiline_comment|/* Initiate dialing */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|init_dialout
c_func
(paren
id|lp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called from certain upper protocol layers (multilink ppp&n; * and x25iface encapsulation module) that want to initiate dialing&n; * themselves.&n; */
r_int
DECL|function|isdn_net_dial_req
id|isdn_net_dial_req
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
multiline_comment|/* is there a better error code? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ISDN_NET_DIALMODE
c_func
(paren
op_star
id|lp
)paren
op_eq
id|ISDN_NET_DM_AUTO
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
id|isdn_net_force_dial_lp
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Force a net-interface to dial out.&n; * This is always called from within userspace (ISDN_IOCTL_NET_DIAL).&n; */
r_int
DECL|function|isdn_net_force_dial
id|isdn_net_force_dial
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
(paren
id|isdn_net_force_dial_lp
c_func
(paren
op_amp
id|p-&gt;local
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate a new network-interface and initialize its data structures.&n; */
r_int
DECL|function|isdn_net_new
id|isdn_net_new
c_func
(paren
r_char
op_star
id|name
comma
r_struct
id|net_device
op_star
id|master
)paren
(brace
r_int
id|retval
suffix:semicolon
id|isdn_net_dev
op_star
id|netdev
suffix:semicolon
multiline_comment|/* Avoid creating an existing interface */
r_if
c_cond
(paren
id|isdn_net_findif
c_func
(paren
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: interface %s already exists&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|netdev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|isdn_net_dev
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: Could not allocate net-device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|netdev
comma
l_int|0
comma
r_sizeof
(paren
id|isdn_net_dev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|netdev-&gt;local.name
comma
id|name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|netdev-&gt;dev.name
comma
id|name
)paren
suffix:semicolon
id|netdev-&gt;dev.priv
op_assign
op_amp
id|netdev-&gt;local
suffix:semicolon
id|netdev-&gt;dev.init
op_assign
id|isdn_net_init
suffix:semicolon
r_if
c_cond
(paren
id|master
)paren
(brace
multiline_comment|/* Device shall be a slave */
r_struct
id|net_device
op_star
id|p
op_assign
(paren
(paren
(paren
id|isdn_net_local
op_star
)paren
id|master-&gt;priv
)paren
op_member_access_from_pointer
id|slave
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|q
op_assign
id|master
suffix:semicolon
id|netdev-&gt;local.master
op_assign
id|master
suffix:semicolon
multiline_comment|/* Put device at end of slave-chain */
r_while
c_loop
(paren
id|p
)paren
(brace
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
(paren
(paren
(paren
id|isdn_net_local
op_star
)paren
id|p-&gt;priv
)paren
op_member_access_from_pointer
id|slave
)paren
suffix:semicolon
)brace
(paren
(paren
id|isdn_net_local
op_star
)paren
id|q-&gt;priv
)paren
op_member_access_from_pointer
id|slave
op_assign
op_amp
(paren
id|netdev-&gt;dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Device shall be a master */
multiline_comment|/*&n;&t;&t; * Watchdog timer (currently) for master only.&n;&t;&t; */
id|netdev-&gt;dev.tx_timeout
op_assign
id|isdn_net_tx_timeout
suffix:semicolon
id|netdev-&gt;dev.watchdog_timeo
op_assign
id|ISDN_NET_TX_TIMEOUT
suffix:semicolon
id|retval
op_assign
id|register_netdev
c_func
(paren
op_amp
id|netdev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: Could not register net-device&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|netdev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
id|netdev-&gt;local.magic
op_assign
id|ISDN_NET_MAGIC
suffix:semicolon
id|netdev-&gt;queue
op_assign
op_amp
id|netdev-&gt;local
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|netdev-&gt;queue_lock
)paren
suffix:semicolon
id|netdev-&gt;local.last
op_assign
op_amp
id|netdev-&gt;local
suffix:semicolon
id|netdev-&gt;local.netdev
op_assign
id|netdev
suffix:semicolon
id|netdev-&gt;local.next
op_assign
op_amp
id|netdev-&gt;local
suffix:semicolon
id|netdev-&gt;local.tqueue.sync
op_assign
l_int|0
suffix:semicolon
id|netdev-&gt;local.tqueue.routine
op_assign
id|isdn_net_softint
suffix:semicolon
id|netdev-&gt;local.tqueue.data
op_assign
op_amp
id|netdev-&gt;local
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|netdev-&gt;local.xmit_lock
)paren
suffix:semicolon
id|netdev-&gt;local.isdn_slot
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.pre_device
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.pre_channel
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.exclusive
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.ppp_slot
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.pppbind
op_assign
op_minus
l_int|1
suffix:semicolon
id|netdev-&gt;local.p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|netdev-&gt;local.super_tx_queue
)paren
suffix:semicolon
id|netdev-&gt;local.l2_proto
op_assign
id|ISDN_PROTO_L2_X75I
suffix:semicolon
id|netdev-&gt;local.l3_proto
op_assign
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
id|netdev-&gt;local.triggercps
op_assign
l_int|6000
suffix:semicolon
id|netdev-&gt;local.slavedelay
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
id|netdev-&gt;local.hupflags
op_assign
id|ISDN_INHUP
suffix:semicolon
multiline_comment|/* Do hangup even on incoming calls */
id|netdev-&gt;local.onhtime
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Default hangup-time for saving costs&n;&t;   of those who forget configuring this */
id|netdev-&gt;local.dialmax
op_assign
l_int|1
suffix:semicolon
id|netdev-&gt;local.flags
op_assign
id|ISDN_NET_CBHUP
op_or
id|ISDN_NET_DM_MANUAL
suffix:semicolon
multiline_comment|/* Hangup before Callback, manual dial */
id|netdev-&gt;local.cbdelay
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Wait 5 secs before Callback */
id|netdev-&gt;local.dialtimeout
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Infinite Dial-Timeout */
id|netdev-&gt;local.dialwait
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Wait 5 sec. after failed dial */
id|netdev-&gt;local.dialstarted
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Jiffies of last dial-start */
id|netdev-&gt;local.dialwait_timer
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Jiffies of earliest next dial-start */
id|init_timer
c_func
(paren
op_amp
id|netdev-&gt;local.dial_timer
)paren
suffix:semicolon
id|netdev-&gt;local.dial_timer.data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|netdev-&gt;local
suffix:semicolon
id|netdev-&gt;local.dial_timer.function
op_assign
id|isdn_net_dial_timer
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|netdev-&gt;local.hup_timer
)paren
suffix:semicolon
id|netdev-&gt;local.hup_timer.data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|netdev-&gt;local
suffix:semicolon
id|netdev-&gt;local.hup_timer.function
op_assign
id|isdn_net_hup_timer
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|netdev-&gt;local.lock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|netdev-&gt;local.phone
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|netdev-&gt;local.phone
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|isdn_net_set_encap
c_func
(paren
id|netdev
comma
id|ISDN_NET_ENCAP_RAWIP
)paren
suffix:semicolon
multiline_comment|/* Put into to netdev-chain */
id|list_add
c_func
(paren
op_amp
id|netdev-&gt;global_list
comma
op_amp
id|isdn_net_devs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|isdn_net_newslave
id|isdn_net_newslave
c_func
(paren
r_char
op_star
id|parm
)paren
(brace
r_char
op_star
id|p
op_assign
id|strchr
c_func
(paren
id|parm
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
id|isdn_net_dev
op_star
id|m
suffix:semicolon
multiline_comment|/* Slave-Name MUST not be empty */
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
id|p
(braket
l_int|1
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Master must already exist */
r_if
c_cond
(paren
op_logical_neg
(paren
id|m
op_assign
id|isdn_net_findif
c_func
(paren
id|parm
)paren
)paren
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
multiline_comment|/* Master must be a real interface, not a slave */
r_if
c_cond
(paren
id|m-&gt;local.master
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/* Master must not be started yet */
r_if
c_cond
(paren
id|isdn_net_device_started
c_func
(paren
id|m
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
id|isdn_net_new
c_func
(paren
id|p
op_plus
l_int|1
comma
op_amp
id|m-&gt;dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_net_set_encap
id|isdn_net_set_encap
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
r_int
id|encap
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_eq
id|encap
)paren
(brace
multiline_comment|/* nothing to do */
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_net_device_started
c_func
(paren
id|p
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;ops
op_logical_and
id|lp-&gt;ops-&gt;cleanup
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|cleanup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|encap
OL
l_int|0
op_logical_or
id|encap
op_ge
id|ISDN_NET_ENCAP_NR
)paren
(brace
id|lp-&gt;p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|lp-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|lp-&gt;p_encap
op_assign
id|encap
suffix:semicolon
id|lp-&gt;ops
op_assign
id|netif_ops
(braket
id|encap
)braket
suffix:semicolon
id|p-&gt;dev.hard_header
op_assign
id|lp-&gt;ops-&gt;hard_header
suffix:semicolon
id|p-&gt;dev.do_ioctl
op_assign
id|lp-&gt;ops-&gt;do_ioctl
suffix:semicolon
id|p-&gt;dev.flags
op_assign
id|lp-&gt;ops-&gt;flags
suffix:semicolon
id|p-&gt;dev.type
op_assign
id|lp-&gt;ops-&gt;type
suffix:semicolon
id|p-&gt;dev.addr_len
op_assign
id|lp-&gt;ops-&gt;addr_len
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;init
)paren
id|retval
op_assign
id|lp-&gt;ops
op_member_access_from_pointer
id|init
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|lp-&gt;p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|lp-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_net_bind
id|isdn_net_bind
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
r_int
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|chidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_char
id|drvid
(braket
l_int|25
)braket
suffix:semicolon
id|strncpy
c_func
(paren
id|drvid
comma
id|cfg-&gt;drvid
comma
l_int|24
)paren
suffix:semicolon
id|drvid
(braket
l_int|24
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;exclusive
op_logical_and
op_logical_neg
id|strlen
c_func
(paren
id|drvid
)paren
)paren
(brace
multiline_comment|/* If we want to bind exclusively, need to specify drv/chan */
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|drvid
)paren
)paren
(brace
multiline_comment|/* A bind has been requested ... */
r_char
op_star
id|c
op_assign
id|strchr
c_func
(paren
id|drvid
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* The channel-number is appended to the driver-Id with a comma */
op_star
id|c
op_assign
l_int|0
suffix:semicolon
id|chidx
op_assign
id|simple_strtol
c_func
(paren
id|c
op_plus
l_int|1
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Lookup driver-Id in array */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|drvid
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
op_logical_or
id|chidx
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Either driver-Id or channel-number invalid */
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cfg-&gt;exclusive
op_eq
(paren
id|lp-&gt;exclusive
op_ge
l_int|0
)paren
op_logical_and
id|drvidx
op_eq
id|lp-&gt;pre_device
op_logical_and
id|chidx
op_eq
id|lp-&gt;pre_channel
)paren
(brace
multiline_comment|/* no change */
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;exclusive
op_ge
l_int|0
)paren
(brace
id|isdn_unexclusive_channel
c_func
(paren
id|lp-&gt;pre_device
comma
id|lp-&gt;pre_channel
)paren
suffix:semicolon
id|isdn_free_channel
c_func
(paren
id|lp-&gt;pre_device
comma
id|lp-&gt;pre_channel
comma
id|ISDN_USAGE_NET
)paren
suffix:semicolon
id|lp-&gt;exclusive
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cfg-&gt;exclusive
)paren
(brace
multiline_comment|/* If binding is exclusive, try to grab the channel */
id|lp-&gt;exclusive
op_assign
id|isdn_get_free_slot
c_func
(paren
id|ISDN_USAGE_NET
comma
id|lp-&gt;l2_proto
comma
id|lp-&gt;l3_proto
comma
id|drvidx
comma
id|chidx
comma
id|cfg-&gt;eaz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;exclusive
OL
l_int|0
)paren
(brace
multiline_comment|/* Grab failed, because desired channel is in use */
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* All went ok, so update isdninfo */
id|isdn_slot_set_usage
c_func
(paren
id|lp-&gt;exclusive
comma
id|ISDN_USAGE_EXCLUSIVE
)paren
suffix:semicolon
)brace
id|lp-&gt;pre_device
op_assign
id|drvidx
suffix:semicolon
id|lp-&gt;pre_channel
op_assign
id|chidx
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Set interface-parameters.&n; * Always set all parameters, so the user-level application is responsible&n; * for not overwriting existing setups. It has to get the current&n; * setup first, if only selected parameters are to be changed.&n; */
r_int
DECL|function|isdn_net_setcfg
id|isdn_net_setcfg
c_func
(paren
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|cfg-&gt;name
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
id|ulong
id|features
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* See if any registered driver supports the features we want */
id|features
op_assign
(paren
(paren
l_int|1
op_lshift
id|cfg-&gt;l2_proto
)paren
op_lshift
id|ISDN_FEATURE_L2_SHIFT
)paren
op_or
(paren
(paren
l_int|1
op_lshift
id|cfg-&gt;l3_proto
)paren
op_lshift
id|ISDN_FEATURE_L3_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|i
)braket
op_logical_and
(paren
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|features
)paren
op_eq
id|features
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|ISDN_MAX_DRIVERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: No driver with selected features&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_set_encap
c_func
(paren
id|p
comma
id|cfg-&gt;p_encap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|out
suffix:semicolon
id|retval
op_assign
id|isdn_net_bind
c_func
(paren
id|p
comma
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|out
suffix:semicolon
id|strncpy
c_func
(paren
id|lp-&gt;msn
comma
id|cfg-&gt;eaz
comma
id|ISDN_MSNLEN
op_minus
l_int|1
)paren
suffix:semicolon
id|lp-&gt;msn
(braket
id|ISDN_MSNLEN
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;onhtime
op_assign
id|cfg-&gt;onhtime
suffix:semicolon
id|lp-&gt;charge
op_assign
id|cfg-&gt;charge
suffix:semicolon
id|lp-&gt;l2_proto
op_assign
id|cfg-&gt;l2_proto
suffix:semicolon
id|lp-&gt;l3_proto
op_assign
id|cfg-&gt;l3_proto
suffix:semicolon
id|lp-&gt;cbdelay
op_assign
id|cfg-&gt;cbdelay
op_star
id|HZ
op_div
l_int|5
suffix:semicolon
id|lp-&gt;dialmax
op_assign
id|cfg-&gt;dialmax
suffix:semicolon
id|lp-&gt;triggercps
op_assign
id|cfg-&gt;triggercps
suffix:semicolon
id|lp-&gt;slavedelay
op_assign
id|cfg-&gt;slavedelay
op_star
id|HZ
suffix:semicolon
id|lp-&gt;pppbind
op_assign
id|cfg-&gt;pppbind
suffix:semicolon
id|lp-&gt;dialtimeout
op_assign
id|cfg-&gt;dialtimeout
op_ge
l_int|0
ques
c_cond
id|cfg-&gt;dialtimeout
op_star
id|HZ
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|lp-&gt;dialwait
op_assign
id|cfg-&gt;dialwait
op_star
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;secure
)paren
id|lp-&gt;flags
op_or_assign
id|ISDN_NET_SECURE
suffix:semicolon
r_else
id|lp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_SECURE
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;cbhup
)paren
id|lp-&gt;flags
op_or_assign
id|ISDN_NET_CBHUP
suffix:semicolon
r_else
id|lp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CBHUP
suffix:semicolon
r_switch
c_cond
(paren
id|cfg-&gt;callback
)paren
(brace
r_case
l_int|0
suffix:colon
id|lp-&gt;flags
op_and_assign
op_complement
(paren
id|ISDN_NET_CALLBACK
op_or
id|ISDN_NET_CBOUT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|lp-&gt;flags
op_or_assign
id|ISDN_NET_CALLBACK
suffix:semicolon
id|lp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CBOUT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|lp-&gt;flags
op_or_assign
id|ISDN_NET_CBOUT
suffix:semicolon
id|lp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CALLBACK
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_DIALMODE_MASK
suffix:semicolon
multiline_comment|/* first all bits off */
r_if
c_cond
(paren
id|cfg-&gt;dialmode
op_logical_and
op_logical_neg
(paren
id|cfg-&gt;dialmode
op_amp
id|ISDN_NET_DIALMODE_MASK
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|lp-&gt;flags
op_or_assign
id|cfg-&gt;dialmode
suffix:semicolon
multiline_comment|/* turn on selected bits */
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_DM_OFF
)paren
id|isdn_net_hangup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;chargehup
)paren
id|lp-&gt;hupflags
op_or_assign
id|ISDN_CHARGEHUP
suffix:semicolon
r_else
id|lp-&gt;hupflags
op_and_assign
op_complement
id|ISDN_CHARGEHUP
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;ihup
)paren
id|lp-&gt;hupflags
op_or_assign
id|ISDN_INHUP
suffix:semicolon
r_else
id|lp-&gt;hupflags
op_and_assign
op_complement
id|ISDN_INHUP
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;chargeint
OG
l_int|10
)paren
(brace
id|lp-&gt;chargeint
op_assign
id|cfg-&gt;chargeint
op_star
id|HZ
suffix:semicolon
id|lp-&gt;charge_state
op_assign
id|ST_CHARGE_HAVE_CINT
suffix:semicolon
id|lp-&gt;hupflags
op_or_assign
id|ISDN_MANCHARGE
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform get-interface-parameters.ioctl&n; */
r_int
DECL|function|isdn_net_getcfg
id|isdn_net_getcfg
c_func
(paren
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|cfg-&gt;name
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|strcpy
c_func
(paren
id|cfg-&gt;eaz
comma
id|lp-&gt;msn
)paren
suffix:semicolon
id|cfg-&gt;exclusive
op_assign
id|lp-&gt;exclusive
op_ge
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;pre_device
op_ge
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|cfg-&gt;drvid
comma
l_string|&quot;%s,%d&quot;
comma
id|dev-&gt;drvid
(braket
id|lp-&gt;pre_device
)braket
comma
id|lp-&gt;pre_channel
)paren
suffix:semicolon
)brace
r_else
id|cfg-&gt;drvid
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|cfg-&gt;onhtime
op_assign
id|lp-&gt;onhtime
suffix:semicolon
id|cfg-&gt;charge
op_assign
id|lp-&gt;charge
suffix:semicolon
id|cfg-&gt;l2_proto
op_assign
id|lp-&gt;l2_proto
suffix:semicolon
id|cfg-&gt;l3_proto
op_assign
id|lp-&gt;l3_proto
suffix:semicolon
id|cfg-&gt;p_encap
op_assign
id|lp-&gt;p_encap
suffix:semicolon
id|cfg-&gt;secure
op_assign
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_SECURE
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;callback
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
id|cfg-&gt;callback
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CBOUT
)paren
id|cfg-&gt;callback
op_assign
l_int|2
suffix:semicolon
id|cfg-&gt;cbhup
op_assign
(paren
id|lp-&gt;flags
op_amp
id|ISDN_NET_CBHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;dialmode
op_assign
id|lp-&gt;flags
op_amp
id|ISDN_NET_DIALMODE_MASK
suffix:semicolon
id|cfg-&gt;chargehup
op_assign
(paren
id|lp-&gt;hupflags
op_amp
l_int|4
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;ihup
op_assign
(paren
id|lp-&gt;hupflags
op_amp
l_int|8
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;cbdelay
op_assign
id|lp-&gt;cbdelay
op_star
l_int|5
op_div
id|HZ
suffix:semicolon
id|cfg-&gt;dialmax
op_assign
id|lp-&gt;dialmax
suffix:semicolon
id|cfg-&gt;triggercps
op_assign
id|lp-&gt;triggercps
suffix:semicolon
id|cfg-&gt;slavedelay
op_assign
id|lp-&gt;slavedelay
op_div
id|HZ
suffix:semicolon
id|cfg-&gt;chargeint
op_assign
(paren
id|lp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
ques
c_cond
(paren
id|lp-&gt;chargeint
op_div
id|HZ
)paren
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;pppbind
op_assign
id|lp-&gt;pppbind
suffix:semicolon
id|cfg-&gt;dialtimeout
op_assign
id|lp-&gt;dialtimeout
op_ge
l_int|0
ques
c_cond
id|lp-&gt;dialtimeout
op_div
id|HZ
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|cfg-&gt;dialwait
op_assign
id|lp-&gt;dialwait
op_div
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;slave
)paren
id|strcpy
c_func
(paren
id|cfg-&gt;slave
comma
(paren
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;slave-&gt;priv
)paren
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_else
id|cfg-&gt;slave
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;master
)paren
id|strcpy
c_func
(paren
id|cfg-&gt;master
comma
(paren
(paren
id|isdn_net_local
op_star
)paren
id|lp-&gt;master-&gt;priv
)paren
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_else
id|cfg-&gt;master
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a phone-number to an interface.&n; */
r_int
DECL|function|isdn_net_addphone
id|isdn_net_addphone
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|n
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|n
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strcpy
c_func
(paren
id|n-&gt;num
comma
id|phone-&gt;phone
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|n-&gt;list
comma
op_amp
id|p-&gt;local.phone
(braket
id|phone-&gt;outgoing
op_amp
l_int|1
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Copy a string of all phone-numbers of an interface to user space.&n; * This might sleep and must be called with the isdn semaphore down.&n; */
r_int
DECL|function|isdn_net_getphones
id|isdn_net_getphones
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
comma
r_char
op_star
id|phones
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|inout
op_assign
id|phone-&gt;outgoing
op_amp
l_int|1
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|buf
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|inout
op_and_assign
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|p-&gt;local.phone
(braket
id|inout
)braket
comma
id|list
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|buf
(braket
id|count
)braket
comma
id|n-&gt;num
)paren
suffix:semicolon
id|count
op_add_assign
id|strlen
c_func
(paren
id|n-&gt;num
)paren
suffix:semicolon
id|buf
(braket
id|count
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|PAGE_SIZE
op_minus
id|ISDN_MSNLEN
op_minus
l_int|1
)paren
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
id|count
op_increment
suffix:semicolon
id|buf
(braket
id|count
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|phones
comma
id|buf
comma
id|count
)paren
)paren
id|count
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * Copy a string containing the peer&squot;s phone number of a connected interface&n; * to user space.&n; */
r_int
DECL|function|isdn_net_getpeer
id|isdn_net_getpeer
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
comma
id|isdn_net_ioctl_phone
op_star
id|peer
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t; * Theoretical race: while this executes, the remote number might&n;&t; * become invalid (hang up) or change (new connection), resulting&n;         * in (partially) wrong number copied to user. This race&n;&t; * currently ignored.&n;&t; */
id|idx
op_assign
id|p-&gt;local.isdn_slot
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
multiline_comment|/* for pre-bound channels, we need this extra check */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|isdn_slot_num
c_func
(paren
id|idx
)paren
comma
l_string|&quot;???&quot;
comma
l_int|3
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|strncpy
c_func
(paren
id|phone-&gt;phone
comma
id|isdn_slot_num
c_func
(paren
id|idx
)paren
comma
id|ISDN_MSNLEN
)paren
suffix:semicolon
id|phone-&gt;outgoing
op_assign
id|USG_OUTGOING
c_func
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|peer
comma
id|phone
comma
r_sizeof
(paren
op_star
id|peer
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete a phone-number from an interface.&n; */
r_int
DECL|function|isdn_net_delphone
id|isdn_net_delphone
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
id|inout
op_assign
id|phone-&gt;outgoing
op_amp
l_int|1
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|p-&gt;local.phone
(braket
id|inout
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|n-&gt;num
comma
id|phone-&gt;phone
)paren
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|n-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|n
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete all phone-numbers of an interface.&n; */
r_static
r_int
DECL|function|isdn_net_rmallphone
id|isdn_net_rmallphone
c_func
(paren
id|isdn_net_dev
op_star
id|p
)paren
(brace
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|p-&gt;local.phone
(braket
id|i
)braket
)paren
)paren
(brace
id|n
op_assign
id|list_entry
c_func
(paren
id|p-&gt;local.phone
(braket
id|i
)braket
dot
id|next
comma
r_struct
id|isdn_net_phone
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|n-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;local.lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Force a hangup of a network-interface.&n; */
r_int
DECL|function|isdn_net_force_hangup
id|isdn_net_force_hangup
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|q
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;local.isdn_slot
OL
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|q
op_assign
id|p-&gt;local.slave
suffix:semicolon
multiline_comment|/* If this interface has slaves, do a hangup for them also. */
r_while
c_loop
(paren
id|q
)paren
(brace
id|isdn_net_hangup
c_func
(paren
op_amp
id|p-&gt;local
)paren
suffix:semicolon
id|q
op_assign
(paren
(paren
(paren
id|isdn_net_local
op_star
)paren
id|q-&gt;priv
)paren
op_member_access_from_pointer
id|slave
)paren
suffix:semicolon
)brace
id|isdn_net_hangup
c_func
(paren
op_amp
id|p-&gt;local
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * Helper-function for isdn_net_rm: Do the real work.&n; */
r_static
r_int
DECL|function|isdn_net_realrm
id|isdn_net_realrm
c_func
(paren
id|isdn_net_dev
op_star
id|p
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_net_device_started
c_func
(paren
id|p
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|isdn_net_set_encap
c_func
(paren
id|p
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Free all phone-entries */
id|isdn_net_rmallphone
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* If interface is bound exclusive, free channel-usage */
r_if
c_cond
(paren
id|p-&gt;local.exclusive
op_ge
l_int|0
)paren
id|isdn_unexclusive_channel
c_func
(paren
id|p-&gt;local.pre_device
comma
id|p-&gt;local.pre_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;local.master
)paren
(brace
multiline_comment|/* It&squot;s a slave-device, so update master&squot;s slave-pointer if necessary */
r_if
c_cond
(paren
(paren
(paren
id|isdn_net_local
op_star
)paren
(paren
id|p-&gt;local.master-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|slave
op_eq
op_amp
id|p-&gt;dev
)paren
(paren
(paren
id|isdn_net_local
op_star
)paren
(paren
id|p-&gt;local.master-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|slave
op_assign
id|p-&gt;local.slave
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Unregister only if it&squot;s a master-device */
id|unregister_netdev
c_func
(paren
op_amp
id|p-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Unlink device from chain */
id|list_del
c_func
(paren
op_amp
id|p-&gt;global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;local.slave
)paren
(brace
multiline_comment|/* If this interface has a slave, remove it also */
r_char
op_star
id|slavename
op_assign
(paren
(paren
id|isdn_net_local
op_star
)paren
(paren
id|p-&gt;local.slave-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|name
suffix:semicolon
r_struct
id|list_head
op_star
id|l
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|n
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|n-&gt;local.name
comma
id|slavename
)paren
)paren
(brace
id|isdn_net_realrm
c_func
(paren
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Remove a single network-interface.&n; */
r_int
DECL|function|isdn_net_rm
id|isdn_net_rm
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
multiline_comment|/* Search name in netdev-chain */
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;local.name
comma
id|name
)paren
)paren
r_return
id|isdn_net_realrm
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * Remove all network-interfaces&n; */
r_int
DECL|function|isdn_net_rmall
id|isdn_net_rmall
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Walk through netdev-chain */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|isdn_net_devs
)paren
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|isdn_net_devs.next
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
multiline_comment|/* Remove master-devices only, slaves get removed with their master */
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;local.master
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|isdn_net_realrm
c_func
(paren
id|p
)paren
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|// ISDN_NET_ENCAP_IPTYP
singleline_comment|// ethernet type field
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_iptyp_header
id|isdn_iptyp_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|plen
)paren
(brace
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
id|type
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_iptyp_receive
id|isdn_iptyp_receive
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
id|isdn_net_local
op_star
id|olp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
id|isdn_net_reset_huptimer
c_func
(paren
id|lp
comma
id|olp
)paren
suffix:semicolon
id|get_u16
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|skb-&gt;protocol
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|iptyp_ops
r_static
r_struct
id|isdn_netif_ops
id|iptyp_ops
op_assign
(brace
dot
id|hard_header
op_assign
id|isdn_iptyp_header
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|addr_len
op_assign
l_int|2
comma
dot
id|receive
op_assign
id|isdn_iptyp_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_UIHDLC
singleline_comment|// HDLC with UI-Frames (for ispa with -h1 option) */
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_uihdlc_header
id|isdn_uihdlc_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|plen
)paren
(brace
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
l_int|0x0103
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_uihdlc_receive
id|isdn_uihdlc_receive
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
id|isdn_net_local
op_star
id|olp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
id|isdn_net_reset_huptimer
c_func
(paren
id|lp
comma
id|olp
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|uihdlc_ops
r_static
r_struct
id|isdn_netif_ops
id|uihdlc_ops
op_assign
(brace
dot
id|hard_header
op_assign
id|isdn_uihdlc_header
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_HDLC
comma
dot
id|addr_len
op_assign
l_int|2
comma
dot
id|receive
op_assign
id|isdn_uihdlc_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_RAWIP
singleline_comment|// RAW-IP without MAC-Header
singleline_comment|// ======================================================================
r_static
r_void
DECL|function|isdn_rawip_receive
id|isdn_rawip_receive
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
id|isdn_net_local
op_star
id|olp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
id|isdn_net_reset_huptimer
c_func
(paren
id|lp
comma
id|olp
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|variable|rawip_ops
r_static
r_struct
id|isdn_netif_ops
id|rawip_ops
op_assign
(brace
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|receive
op_assign
id|isdn_rawip_receive
comma
)brace
suffix:semicolon
singleline_comment|// ISDN_NET_ENCAP_ETHER
singleline_comment|// Ethernet over ISDN
singleline_comment|// ======================================================================
multiline_comment|/*      This is simply a copy from std. eth.c EXCEPT we pull ETH_HLEN&n; *      instead of dev-&gt;hard_header_len off. This is done because the&n; *      lowlevel-driver has already pulled off its stuff when we get&n; *      here and this routine only gets called with p_encap == ETHER.&n; *      Determine the packet&squot;s protocol ID. The rule here is that we&n; *      assume 802.3 if the type field is short enough to be a length.&n; *      This is normal practice and works for any &squot;now in use&squot; protocol.&n; *      FIXME&n; */
r_static
r_int
r_int
DECL|function|isdn_eth_type_trans
id|isdn_eth_type_trans
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ethhdr
op_star
id|eth
suffix:semicolon
r_int
r_char
op_star
id|rawp
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
id|eth
op_assign
id|skb-&gt;mac.ethernet
suffix:semicolon
r_if
c_cond
(paren
op_star
id|eth-&gt;h_dest
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth-&gt;h_dest
comma
id|dev-&gt;broadcast
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
id|skb-&gt;pkt_type
op_assign
id|PACKET_BROADCAST
suffix:semicolon
r_else
id|skb-&gt;pkt_type
op_assign
id|PACKET_MULTICAST
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *      This ALLMULTI check should be redundant by 1.4&n;&t; *      so don&squot;t forget to remove it.&n;&t; */
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_PROMISC
multiline_comment|/*| IFF_ALLMULTI*/
)paren
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth-&gt;h_dest
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
)paren
id|skb-&gt;pkt_type
op_assign
id|PACKET_OTHERHOST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ntohs
c_func
(paren
id|eth-&gt;h_proto
)paren
op_ge
l_int|1536
)paren
r_return
id|eth-&gt;h_proto
suffix:semicolon
id|rawp
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; *      This is a magic hack to spot IPX packets. Older Novell breaks&n;&t; *      the protocol design and runs IPX over 802.3 without an 802.2 LLC&n;&t; *      layer. We look for FFFF which isn&squot;t a used 802.2 SSAP/DSAP. This&n;&t; *      won&squot;t work for fault tolerant netware but does for the rest.&n;&t; */
r_if
c_cond
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|rawp
op_eq
l_int|0xFFFF
)paren
r_return
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *      Real 802.2 LLC&n;&t; */
r_return
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ether_receive
id|isdn_ether_receive
c_func
(paren
id|isdn_net_dev
op_star
id|p
comma
id|isdn_net_local
op_star
id|olp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
op_amp
id|p-&gt;local
suffix:semicolon
id|isdn_net_reset_huptimer
c_func
(paren
id|lp
comma
id|olp
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|isdn_eth_type_trans
c_func
(paren
id|skb
comma
id|skb-&gt;dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ether_open
id|isdn_ether_open
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|lp-&gt;netdev-&gt;dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Fill in the MAC-level header ... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
l_int|0xfc
suffix:semicolon
id|in_dev
op_assign
id|dev-&gt;ip_ptr
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(brace
multiline_comment|/* any address will do - we take the first */
r_struct
id|in_ifaddr
op_star
id|ifa
op_assign
id|in_dev-&gt;ifa_list
suffix:semicolon
r_if
c_cond
(paren
id|ifa
)paren
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|2
comma
op_amp
id|ifa-&gt;ifa_local
comma
l_int|4
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ether_init
id|isdn_ether_init
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|lp-&gt;netdev-&gt;dev
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|10
suffix:semicolon
id|dev-&gt;hard_header_len
op_add_assign
id|isdn_hard_header_len
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ether_ops
r_static
r_struct
id|isdn_netif_ops
id|ether_ops
op_assign
(brace
dot
id|hard_header
op_assign
id|eth_header
comma
dot
id|receive
op_assign
id|isdn_ether_receive
comma
dot
id|init
op_assign
id|isdn_ether_init
comma
dot
id|open
op_assign
id|isdn_ether_open
comma
)brace
suffix:semicolon
singleline_comment|// ======================================================================
r_void
DECL|function|isdn_net_init_module
id|isdn_net_init_module
c_func
(paren
r_void
)paren
(brace
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_ETHER
comma
op_amp
id|ether_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_RAWIP
comma
op_amp
id|rawip_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_IPTYP
comma
op_amp
id|iptyp_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_UIHDLC
comma
op_amp
id|uihdlc_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_CISCOHDLC
comma
op_amp
id|ciscohdlck_ops
)paren
suffix:semicolon
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_CISCOHDLCK
comma
op_amp
id|ciscohdlck_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_X25
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_X25IFACE
comma
op_amp
id|isdn_x25_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ISDN_PPP
id|register_isdn_netif
c_func
(paren
id|ISDN_NET_ENCAP_SYNCPPP
comma
op_amp
id|isdn_ppp_ops
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
