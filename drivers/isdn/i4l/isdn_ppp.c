multiline_comment|/* $Id: isdn_ppp.c,v 1.85.6.9 2001/11/06 20:58:28 kai Exp $&n; *&n; * Linux ISDN subsystem, functions for synchronous PPP (linklevel).&n; *&n; * Copyright 1995,96 by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/ppp-comp.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#include &quot;isdn_ppp_ccp.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
DECL|struct|ipppd
r_struct
id|ipppd
(brace
DECL|member|state
r_int
id|state
suffix:semicolon
DECL|member|rq
r_struct
id|sk_buff_head
id|rq
suffix:semicolon
DECL|member|wq
id|wait_queue_head_t
id|wq
suffix:semicolon
DECL|member|idev
r_struct
id|isdn_net_dev_s
op_star
id|idev
suffix:semicolon
DECL|member|unit
r_int
id|unit
suffix:semicolon
DECL|member|minor
r_int
id|minor
suffix:semicolon
DECL|member|debug
r_int
r_int
id|debug
suffix:semicolon
DECL|member|refcnt
id|atomic_t
id|refcnt
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* We use reference counting for struct ipppd. It is alloced on&n; * open() on /dev/ipppX and saved into file-&gt;private, making for one&n; * reference. release() will release this reference, after all other&n; * references are gone, the destructor frees it.&n; *&n; * Another reference is taken by isdn_ppp_bind() and freed by&n; * isdn_ppp_unbind(). The callbacks from isdn_net_lib.c happen only&n; * between isdn_ppp_bind() and isdn_ppp_unbind(), i.e. access to &n; * idev-&gt;ipppd is safe without further locking.&n; */
multiline_comment|/* Prototypes */
r_static
r_void
id|isdn_ppp_push_higher
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|namebuf
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_set_compressor
c_func
(paren
r_struct
id|ipppd
op_star
id|is
comma
r_struct
id|isdn_ppp_comp_data
op_star
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_receive_ccp
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
suffix:semicolon
r_static
r_struct
id|sk_buff
op_star
id|isdn_ppp_dev_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_dev_push_header
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_dev_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|sk_buff
op_star
id|isdn_ppp_lp_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_lp_push_header
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_send_ccp
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
multiline_comment|/* New CCP stuff */
r_static
r_void
id|isdn_ppp_dev_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
DECL|variable|isdn_ppp_bundle_arr
r_static
id|ippp_bundle
op_star
id|isdn_ppp_bundle_arr
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|isdn_ppp_mp_bundle_array_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_mp_init
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|ippp_bundle
op_star
id|add_to
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mp_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mp_cleanup
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
suffix:semicolon
r_static
r_int
id|isdn_ppp_bundle
c_func
(paren
r_struct
id|ipppd
op_star
comma
r_int
id|unit
)paren
suffix:semicolon
macro_line|#endif&t;/* CONFIG_ISDN_MPP */
DECL|variable|isdn_ppp_revision
r_char
op_star
id|isdn_ppp_revision
op_assign
l_string|&quot;$Revision: 1.85.6.9 $&quot;
suffix:semicolon
DECL|macro|NR_IPPPDS
mdefine_line|#define NR_IPPPDS 64
DECL|variable|ipppds_lock
r_static
id|spinlock_t
id|ipppds_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|ipppds
r_static
r_struct
id|ipppd
op_star
id|ipppds
(braket
id|NR_IPPPDS
)braket
suffix:semicolon
r_static
r_void
DECL|function|ipppd_destroy
id|ipppd_destroy
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|HERE
suffix:semicolon
id|ipppd-&gt;state
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|ipppd
op_star
DECL|function|__ipppd_get
id|__ipppd_get
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|atomic_read
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
suffix:semicolon
r_return
id|ipppd
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|ipppd
op_star
DECL|function|ipppd_get
id|ipppd_get
c_func
(paren
r_int
id|slot
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
op_logical_or
id|slot
op_ge
id|NR_IPPPDS
)paren
r_return
l_int|NULL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|ipppd
op_assign
id|ipppds
(braket
id|slot
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipppd
)paren
r_goto
id|out
suffix:semicolon
id|__ipppd_get
c_func
(paren
id|ipppd
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ipppd
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|ipppd_put
id|ipppd_put
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|atomic_read
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
id|ipppd_destroy
c_func
(paren
id|ipppd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * frame log (debug)&n; */
r_void
DECL|function|isdn_ppp_frame_log
id|isdn_ppp_frame_log
c_func
(paren
r_char
op_star
id|info
comma
r_char
op_star
id|data
comma
r_int
id|len
comma
r_int
id|maxlen
comma
r_int
id|unit
comma
r_int
id|slot
)paren
(brace
r_int
id|cnt
comma
id|j
comma
id|i
suffix:semicolon
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|maxlen
)paren
id|maxlen
op_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
op_logical_and
id|cnt
OL
id|maxlen
suffix:semicolon
id|j
op_increment
comma
id|cnt
op_increment
)paren
id|sprintf
c_func
(paren
id|buf
op_plus
id|j
op_star
l_int|3
comma
l_string|&quot;%02x &quot;
comma
(paren
r_int
r_char
)paren
id|data
(braket
id|cnt
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;[%d/%d].%s[%d]: %s&bslash;n&quot;
comma
id|unit
comma
id|slot
comma
id|info
comma
id|i
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|isdn_ppp_push_header
id|isdn_ppp_push_header
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
l_int|4
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_COMP_PROT
)paren
op_logical_and
id|proto
op_le
l_int|0xff
)paren
id|put_u8
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
comma
id|proto
)paren
suffix:semicolon
r_else
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_COMP_AC
)paren
r_return
suffix:semicolon
id|p
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_ALLSTATIONS
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_UI
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * unbind isdn_net_local &lt;=&gt; ippp-device&n; * note: it can happen, that we hangup/free the master before the slaves&n; *       in this case we bind another lp to the master device&n; */
r_static
r_void
DECL|function|isdn_ppp_unbind
id|isdn_ppp_unbind
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
singleline_comment|// FIXME much of this wants to rather happen when disconnected()
macro_line|#ifdef CONFIG_ISDN_MPP
id|spin_lock
c_func
(paren
op_amp
id|idev-&gt;pb-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;netdev-&gt;pb-&gt;ref_ct
op_eq
l_int|1
)paren
multiline_comment|/* last link in queue? */
id|isdn_ppp_mp_cleanup
c_func
(paren
id|lp
)paren
suffix:semicolon
id|lp-&gt;netdev-&gt;pb-&gt;ref_ct
op_decrement
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;netdev-&gt;pb-&gt;lock
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ISDN_MPP */
id|is
op_assign
id|idev-&gt;ipppd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
(brace
id|is-&gt;state
op_assign
id|IPPP_CLOSEWAIT
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|is-&gt;state
op_amp
id|IPPP_ASSIGNED
)paren
(brace
id|is-&gt;state
op_assign
id|IPPP_OPEN
suffix:semicolon
multiline_comment|/* fallback to &squot;OPEN but not ASSIGNED&squot; state */
)brace
r_else
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_unbind %p %p&bslash;n&quot;
comma
id|idev
comma
id|is
)paren
suffix:semicolon
id|is-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* lose the reference we took on isdn_ppp_bind */
id|ipppd_put
c_func
(paren
id|is
)paren
suffix:semicolon
id|idev-&gt;ipppd
op_assign
l_int|NULL
suffix:semicolon
id|ippp_ccp_free
c_func
(paren
id|idev-&gt;ccp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * bind isdn_net_local &lt;=&gt; ippp-device&n; */
r_int
DECL|function|isdn_ppp_bind
id|isdn_ppp_bind
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|unit
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;ipppd
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;pppbind
OL
l_int|0
)paren
(brace
multiline_comment|/* device bound to ippp device ? */
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_char
id|exclusive
(braket
id|NR_IPPPDS
)braket
suffix:semicolon
multiline_comment|/* exclusive flags */
id|memset
c_func
(paren
id|exclusive
comma
l_int|0
comma
id|NR_IPPPDS
)paren
suffix:semicolon
multiline_comment|/* step through net devices to find exclusive minors */
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;pppbind
op_ge
l_int|0
op_logical_and
id|p-&gt;pppbind
OL
id|NR_IPPPDS
)paren
id|exclusive
(braket
id|p-&gt;pppbind
)braket
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * search a free device / slot&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IPPPDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipppds
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_ne
id|IPPP_OPEN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|exclusive
(braket
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|minor
)braket
)paren
r_break
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IPPPDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipppds
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_ne
id|IPPP_OPEN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|minor
op_eq
id|idev-&gt;pppbind
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_ge
id|NR_IPPPDS
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_bind: no ipppd&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ESRCH
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|unit
op_assign
id|isdn_ppp_if_get_unit
c_func
(paren
id|idev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* get unit number from interface name .. ugly! */
r_if
c_cond
(paren
id|unit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_bind: illegal interface name %s.&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|unit
op_assign
id|unit
suffix:semicolon
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|IPPP_OPEN
op_or
id|IPPP_ASSIGNED
suffix:semicolon
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|idev
op_assign
id|idev
suffix:semicolon
multiline_comment|/* we hold a reference until isdn_ppp_unbind() */
id|idev-&gt;ipppd
op_assign
id|__ipppd_get
c_func
(paren
id|ipppds
(braket
id|i
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|idev-&gt;pppcfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* config flags */
multiline_comment|/* seq no last seen, maybe set to bundle min, when joining? */
id|idev-&gt;pppseq
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;ccp
op_assign
id|ippp_ccp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev-&gt;ccp
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|idev-&gt;ccp-&gt;proto
op_assign
id|PPP_COMPFRAG
suffix:semicolon
id|idev-&gt;ccp-&gt;priv
op_assign
id|idev
suffix:semicolon
id|idev-&gt;ccp-&gt;alloc_skb
op_assign
id|isdn_ppp_dev_alloc_skb
suffix:semicolon
id|idev-&gt;ccp-&gt;push_header
op_assign
id|isdn_ppp_dev_push_header
suffix:semicolon
id|idev-&gt;ccp-&gt;xmit
op_assign
id|isdn_ppp_dev_xmit
suffix:semicolon
id|idev-&gt;ccp-&gt;kick_up
op_assign
id|isdn_ppp_dev_kick_up
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
id|retval
op_assign
id|isdn_ppp_mp_init
c_func
(paren
id|lp
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ISDN_MPP */
id|out
suffix:colon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|idev-&gt;ipppd-&gt;state
op_assign
id|IPPP_OPEN
suffix:semicolon
id|ipppd_put
c_func
(paren
id|idev-&gt;ipppd
)paren
suffix:semicolon
id|idev-&gt;ipppd
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
id|err
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * kick the ipppd on the device&n; * (wakes up daemon after B-channel connect)&n; */
r_static
r_void
DECL|function|isdn_ppp_connected
id|isdn_ppp_connected
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ipppd
op_star
id|ipppd
op_assign
id|idev-&gt;ipppd
suffix:semicolon
id|ipppd-&gt;state
op_assign
id|IPPP_OPEN
op_or
id|IPPP_CONNECT
op_or
id|IPPP_NOBLOCK
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ipppd-&gt;wq
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * isdn_ppp_get_slot&n; */
r_static
r_int
DECL|function|isdn_ppp_get_slot
id|isdn_ppp_get_slot
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IPPPDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
l_int|0
)paren
(brace
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|IPPP_OPEN
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|i
OL
id|NR_IPPPDS
)paren
ques
c_cond
id|i
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * ipppd_open&n; */
r_static
r_int
DECL|function|ipppd_open
id|ipppd_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|uint
id|minor
op_assign
id|minor
c_func
(paren
id|ino-&gt;i_rdev
)paren
op_minus
id|ISDN_MINOR_PPP
suffix:semicolon
r_int
id|slot
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|slot
op_assign
id|isdn_ppp_get_slot
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|is
op_assign
id|ipppds
(braket
id|slot
)braket
suffix:semicolon
id|file-&gt;private_data
op_assign
id|is
suffix:semicolon
id|__ipppd_get
c_func
(paren
id|is
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp, open, slot: %d, minor: %d, state: %04x&bslash;n&quot;
comma
id|slot
comma
id|minor
comma
id|is-&gt;state
)paren
suffix:semicolon
id|is-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
id|is-&gt;unit
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set, when we have our interface */
id|init_waitqueue_head
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
id|is-&gt;minor
op_assign
id|minor
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * release ippp device&n; */
r_static
r_int
DECL|function|ipppd_release
id|ipppd_release
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|uint
id|minor
op_assign
id|minor
c_func
(paren
id|ino-&gt;i_rdev
)paren
op_minus
id|ISDN_MINOR_PPP
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: release, minor: %d %p&bslash;n&quot;
comma
id|minor
comma
id|is-&gt;idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;idev
)paren
(brace
multiline_comment|/* a lp address says: this link is still up */
multiline_comment|/*&n;&t;&t; * isdn_net_hangup() calls isdn_ppp_free()&n;&t;&t; * isdn_ppp_free() sets is-&gt;lp to NULL and lp-&gt;ppp_slot to -1&n;&t;&t; * removing the IPPP_CONNECT flag omits calling of isdn_ppp_wakeup_daemon()&n;&t;&t; */
id|is-&gt;state
op_and_assign
op_complement
id|IPPP_CONNECT
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|is-&gt;idev
)paren
suffix:semicolon
)brace
id|skb_queue_purge
c_func
(paren
op_amp
id|is-&gt;rq
)paren
suffix:semicolon
id|ipppd_put
c_func
(paren
id|is
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * get_arg .. ioctl helper&n; */
r_static
r_int
DECL|function|get_arg
id|get_arg
c_func
(paren
r_void
op_star
id|b
comma
r_void
op_star
id|val
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
id|len
op_assign
r_sizeof
(paren
r_void
op_star
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
id|val
comma
id|b
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * set arg .. ioctl helper&n; */
r_static
r_int
DECL|function|set_arg
id|set_arg
c_func
(paren
r_void
op_star
id|b
comma
r_void
op_star
id|val
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|b
comma
(paren
r_void
op_star
)paren
id|val
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ippp device ioctl&n; */
r_static
r_int
DECL|function|ipppd_ioctl
id|ipppd_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|r
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_struct
id|isdn_ppp_comp_data
id|data
suffix:semicolon
r_int
r_int
id|cfg
suffix:semicolon
id|is
op_assign
(paren
r_struct
id|ipppd
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|idev
op_assign
id|is-&gt;idev
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_ioctl: minor: %d cmd: %x state: %x&bslash;n&quot;
comma
id|is-&gt;minor
comma
id|cmd
comma
id|is-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PPPIOCBUNDLE
suffix:colon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;iPPP-bundle: minor: %d, slave unit: %d, master unit: %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|is-&gt;minor
comma
(paren
r_int
)paren
id|is-&gt;unit
comma
(paren
r_int
)paren
id|val
)paren
suffix:semicolon
r_return
id|isdn_ppp_bundle
c_func
(paren
id|is
comma
id|val
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|PPPIOCGUNIT
suffix:colon
multiline_comment|/* get ppp/isdn unit number */
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|is-&gt;unit
comma
r_sizeof
(paren
id|is-&gt;unit
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGIFNAME
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|idev-&gt;name
comma
id|strlen
c_func
(paren
id|idev-&gt;name
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGMPFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|idev-&gt;mlp-&gt;mpppcfg
comma
r_sizeof
(paren
id|idev-&gt;mlp-&gt;mpppcfg
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|idev-&gt;mlp-&gt;mpppcfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|cfg
op_assign
id|idev-&gt;pppcfg
op_or
id|ippp_ccp_get_flags
c_func
(paren
id|idev-&gt;ccp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
(brace
r_return
id|r
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_amp
id|SC_ENABLE_IP
)paren
op_logical_and
op_logical_neg
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
)paren
(brace
id|idev-&gt;pppcfg
op_assign
id|val
suffix:semicolon
multiline_comment|/* OK .. we are ready to send buffers */
id|isdn_net_online
c_func
(paren
id|idev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|idev-&gt;pppcfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGIDLE
suffix:colon
multiline_comment|/* get idle time information */
r_if
c_cond
(paren
id|idev
)paren
(brace
r_struct
id|ppp_idle
id|pidle
suffix:semicolon
id|pidle.xmit_idle
op_assign
id|pidle.recv_idle
op_assign
id|idev-&gt;huptimer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|pidle
comma
r_sizeof
(paren
r_struct
id|ppp_idle
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCSMRU
suffix:colon
multiline_comment|/* set receive unit size for PPP */
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_return
id|ippp_ccp_set_mru
c_func
(paren
id|idev-&gt;ccp
comma
id|val
)paren
suffix:semicolon
r_case
id|PPPIOCSMPMRU
suffix:colon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPMTU
suffix:colon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_case
id|PPPIOCSMAXCID
suffix:colon
multiline_comment|/* set the maximum compression slot id */
(brace
r_struct
id|slcompress
op_star
id|sltmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|val
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp, ioctl: changed MAXCID to %ld&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|sltmp
op_assign
id|slhc_init
c_func
(paren
l_int|16
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sltmp
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ippp, can&squot;t realloc slhc struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idev-&gt;mlp-&gt;slcomp
)paren
id|slhc_free
c_func
(paren
id|idev-&gt;mlp-&gt;slcomp
)paren
suffix:semicolon
id|idev-&gt;mlp-&gt;slcomp
op_assign
id|sltmp
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
r_case
id|PPPIOCGDEBUG
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|is-&gt;debug
comma
r_sizeof
(paren
id|is-&gt;debug
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSDEBUG
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|is-&gt;debug
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|idev-&gt;debug
op_assign
id|val
suffix:semicolon
id|idev-&gt;mlp-&gt;debug
op_assign
id|val
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCGCOMPRESSORS
suffix:colon
(brace
r_int
r_int
id|protos
(braket
l_int|8
)braket
suffix:semicolon
id|ippp_ccp_get_compressors
c_func
(paren
id|protos
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
id|protos
comma
l_int|8
op_star
r_sizeof
(paren
r_int
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCSCOMPRESSOR
suffix:colon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|get_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|data
comma
r_sizeof
(paren
r_struct
id|isdn_ppp_comp_data
)paren
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_return
id|isdn_ppp_set_compressor
c_func
(paren
id|is
comma
op_amp
id|data
)paren
suffix:semicolon
r_case
id|PPPIOCGCALLINFO
suffix:colon
(brace
id|isdn_net_local
op_star
id|mlp
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|phone
suffix:semicolon
r_struct
id|pppcallinfo
id|pci
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pci
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pppcallinfo
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|strncpy
c_func
(paren
id|pci.local_num
comma
id|mlp-&gt;msn
comma
l_int|63
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|phone
comma
op_amp
id|mlp-&gt;phone
(braket
l_int|1
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|i
op_increment
op_eq
id|idev-&gt;dial
)paren
(brace
id|strncpy
c_func
(paren
id|pci.remote_num
comma
id|phone-&gt;num
comma
l_int|63
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|pci.charge_units
op_assign
id|idev-&gt;charge
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;outgoing
)paren
(brace
id|pci.calltype
op_assign
id|CALLTYPE_OUTGOING
suffix:semicolon
)brace
r_else
id|pci.calltype
op_assign
id|CALLTYPE_INCOMING
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
(brace
id|pci.calltype
op_or_assign
id|CALLTYPE_CALLBACK
suffix:semicolon
)brace
)brace
r_return
id|set_arg
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|pci
comma
r_sizeof
(paren
r_struct
id|pppcallinfo
)paren
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|ipppd_poll
id|ipppd_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_poll: minor: %d&bslash;n&quot;
comma
id|minor
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
multiline_comment|/* just registers wait_queue hook. This doesn&squot;t really wait. */
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|is-&gt;wq
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
(brace
r_if
c_cond
(paren
id|is-&gt;state
op_eq
id|IPPP_CLOSEWAIT
)paren
(brace
id|mask
op_assign
id|POLLHUP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: device not open&bslash;n&quot;
)paren
suffix:semicolon
id|mask
op_assign
id|POLLERR
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* we&squot;re always ready to send .. */
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
multiline_comment|/*&n;&t; * if IPPP_NOBLOCK is set we return even if we have nothing to read&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|is-&gt;rq
)paren
op_logical_or
id|is-&gt;state
op_amp
id|IPPP_NOBLOCK
)paren
(brace
id|is-&gt;state
op_and_assign
op_complement
id|IPPP_NOBLOCK
suffix:semicolon
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
singleline_comment|// FIXME
id|schedule_timeout
c_func
(paren
id|HZ
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/*&n; * Queue packets for ipppd to read().&n; */
r_static
r_int
DECL|function|ipppd_queue_read
id|ipppd_queue_read
c_func
(paren
r_struct
id|ipppd
op_star
id|is
comma
id|u16
id|proto
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: device not activated.&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|is-&gt;rq
)paren
OG
id|IPPP_MAX_RQ_LEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Queue is full&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Can&squot;t alloc buf&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_ALLSTATIONS
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_UI
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u16
c_func
(paren
id|p
comma
id|proto
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|is-&gt;rq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * read() .. non-blocking: ipppd calls it only after select()&n; *           reports, that there is data&n; */
r_static
id|ssize_t
DECL|function|ipppd_read
id|ipppd_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_OPEN
)paren
)paren
(brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|is-&gt;rq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|count
)paren
(brace
id|retval
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|retval
op_assign
id|skb-&gt;len
suffix:semicolon
id|out_free
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * ipppd wanna write a packet to the card .. non-blocking&n; */
r_static
id|ssize_t
DECL|function|ipppd_write
id|ipppd_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_int
id|proto
suffix:semicolon
r_int
r_char
id|protobuf
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;state
op_amp
id|IPPP_CONNECT
)paren
)paren
(brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* -&gt; push it directly to the lowlevel interface */
id|idev
op_assign
id|is-&gt;idev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp_write: idev == NULL&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/*&n;&t;&t; * Don&squot;t reset huptimer for&n;&t;&t; * LCP packets. (Echo requests).&n;&t;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|protobuf
comma
id|buf
comma
l_int|4
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|proto
op_assign
id|PPP_PROTOCOL
c_func
(paren
id|protobuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_ne
id|PPP_LCP
)paren
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;isdn_slot
OL
l_int|0
)paren
(brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;drv
(braket
id|isdn_slot_driver
c_func
(paren
id|idev-&gt;isdn_slot
)paren
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_RUNNING
)paren
)paren
(brace
r_int
r_int
id|hl
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * we need to reserve enought space in front of&n;&t;&t;&t; * sk_buff. old call to dev_alloc_skb only reserved&n;&t;&t;&t; * 16 bytes, now we are looking what the driver want&n;&t;&t;&t; */
id|hl
op_assign
id|isdn_slot_hdrlen
c_func
(paren
id|idev-&gt;isdn_slot
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|hl
op_plus
id|count
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_write: out of memory!&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
id|count
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|buf
comma
id|count
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ppp xmit: len %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|is-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|isdn_ppp_send_ccp
c_func
(paren
id|idev
comma
id|idev-&gt;mlp
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* keeps CCP/compression states in sync */
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
id|retval
op_assign
id|count
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|variable|isdn_ppp_fops
r_struct
id|file_operations
id|isdn_ppp_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|ipppd_read
comma
dot
id|write
op_assign
id|ipppd_write
comma
dot
id|poll
op_assign
id|ipppd_poll
comma
dot
id|ioctl
op_assign
id|ipppd_ioctl
comma
dot
id|open
op_assign
id|ipppd_open
comma
dot
id|release
op_assign
id|ipppd_release
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * init memory, structures etc.&n; */
r_int
DECL|function|isdn_ppp_init
id|isdn_ppp_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|isdn_ppp_mp_bundle_array_init
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ISDN_MPP */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IPPPDS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ipppds
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ipppd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipppds
(braket
id|i
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp_init: Could not alloc ippp_table&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_decrement
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|ipppds
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ipppds
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ipppd
)paren
)paren
suffix:semicolon
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ipppds
(braket
id|i
)braket
op_member_access_from_pointer
id|rq
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|isdn_ppp_cleanup
id|isdn_ppp_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IPPPDS
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|ipppds
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|isdn_ppp_bundle_arr
)paren
id|kfree
c_func
(paren
id|isdn_ppp_bundle_arr
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ISDN_MPP */
)brace
multiline_comment|/*&n; * check for address/control field and skip if allowed&n; * retval != 0 -&gt; discard packet silently&n; */
DECL|function|isdn_ppp_skip_ac
r_static
r_int
id|isdn_ppp_skip_ac
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|PPP_ALLSTATIONS
)paren
(brace
multiline_comment|/* if AC compression was not negotiated, but no AC present,&n;&t;&t;   discard packet */
r_if
c_cond
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_REJ_COMP_AC
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|2
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
op_plus
l_int|1
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|PPP_UI
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* skip address/control (AC) field */
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * get the PPP protocol header and pull skb&n; * retval &lt; 0 -&gt; discard packet silently&n; */
DECL|function|isdn_ppp_strip_proto
r_int
id|isdn_ppp_strip_proto
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|u16
id|proto
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x1
)paren
(brace
multiline_comment|/* protocol field is compressed */
id|proto
op_assign
id|val
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|2
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|get_u16
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|proto
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
r_return
id|proto
suffix:semicolon
)brace
multiline_comment|/*&n; * handler for incoming packets on a syncPPP interface&n; */
DECL|function|isdn_ppp_receive
r_static
r_void
id|isdn_ppp_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_int
id|proto
suffix:semicolon
id|is
op_assign
id|idev-&gt;ipppd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp_receive: is:%p lp:%p unit:%d len:%d&bslash;n&quot;
comma
id|is
comma
id|lp
comma
id|is-&gt;unit
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;receive&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|is-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_ppp_skip_ac
c_func
(paren
id|idev
comma
id|skb
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
id|proto
op_assign
id|isdn_ppp_strip_proto
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
multiline_comment|/* Don&squot;t reset huptimer on LCP packets. */
r_if
c_cond
(paren
id|proto
op_ne
id|PPP_LCP
)paren
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|is-&gt;compflags
op_amp
id|SC_LINK_DECOMP_ON
)paren
(brace
id|skb
op_assign
id|isdn_ppp_decompress
c_func
(paren
id|skb
comma
id|is
comma
l_int|NULL
comma
op_amp
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
singleline_comment|// decompression error
r_goto
id|put
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|is-&gt;mpppcfg
op_amp
id|SC_REJ_MP_PROT
)paren
)paren
(brace
singleline_comment|// we agreed to receive MPPP
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_MP
)paren
(brace
id|isdn_ppp_mp_receive
c_func
(paren
id|lp
comma
id|idev
comma
id|skb
)paren
suffix:semicolon
r_goto
id|put
suffix:semicolon
)brace
)brace
id|isdn_ppp_push_higher
c_func
(paren
id|lp
comma
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
id|put
suffix:colon
macro_line|#else
id|isdn_ppp_push_higher
c_func
(paren
id|lp
comma
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
id|err
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * we receive a reassembled frame, MPPP has been taken care of before.&n; * address/control and protocol have been stripped from the skb&n; * note: net_dev has to be master net_dev&n; */
r_static
r_void
DECL|function|isdn_ppp_push_higher
id|isdn_ppp_push_higher
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|lp-&gt;dev
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
op_assign
id|idev-&gt;ipppd
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x10
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;push, skb %d %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|proto
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;rpush&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|is-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|ippp_ccp_decompress
c_func
(paren
id|lp-&gt;ccp
comma
id|skb
comma
op_amp
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
singleline_comment|// decompression error
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_IPX
suffix:colon
multiline_comment|/* untested */
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IPX&bslash;n&quot;
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_IP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IP&bslash;n&quot;
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_COMP
suffix:colon
r_case
id|PPP_COMPFRAG
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp: unexpected compressed frame dropped&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_case
id|PPP_VJC_UNCOMP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: VJC_UNCOMP&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slhc_remember
c_func
(paren
id|lp-&gt;slcomp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_ppp: received illegal VJC_UNCOMP frame!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_VJC_COMP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: VJC_COMP&bslash;n&quot;
)paren
suffix:semicolon
(brace
r_struct
id|sk_buff
op_star
id|skb_old
op_assign
id|skb
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|skb_old-&gt;len
op_plus
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|skb
op_assign
id|skb_old
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|skb_old-&gt;len
op_plus
l_int|128
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|skb_old-&gt;data
comma
id|skb_old-&gt;len
)paren
suffix:semicolon
id|pkt_len
op_assign
id|slhc_uncompress
c_func
(paren
id|lp-&gt;slcomp
comma
id|skb-&gt;data
comma
id|skb_old-&gt;len
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb_old
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OL
l_int|0
)paren
r_goto
id|drop
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_case
id|PPP_CCP
suffix:colon
r_case
id|PPP_CCPFRAG
suffix:colon
id|isdn_ppp_receive_ccp
c_func
(paren
id|idev
comma
id|lp
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
multiline_comment|/* Dont pop up ResetReq/Ack stuff to the daemon any&n;&t;&t;&t;   longer - the job is done already */
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_eq
id|CCP_RESETREQ
op_logical_or
id|skb-&gt;data
(braket
l_int|0
)braket
op_eq
id|CCP_RESETACK
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_default
suffix:colon
singleline_comment|// FIXME use skb directly
id|ipppd_queue_read
c_func
(paren
id|is
comma
id|proto
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Reset hangup-timer */
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* net_dev-&gt;local-&gt;stats.rx_packets++; done in isdn_net.c */
id|out
suffix:colon
r_return
suffix:semicolon
id|drop
suffix:colon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * send ppp frame .. we expect a PIDCOMPressable proto --&n; *  (here: currently always PPP_IP,PPP_VJC_COMP,PPP_VJC_UNCOMP)&n; *&n; * VJ compression may change skb pointer!!! .. requeue with old&n; * skb isn&squot;t allowed!!&n; */
r_static
r_int
DECL|function|isdn_ppp_start_xmit
id|isdn_ppp_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|ndev-&gt;priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
op_assign
id|list_entry
c_func
(paren
id|mlp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
r_int
r_int
id|proto
op_assign
id|PPP_IP
suffix:semicolon
multiline_comment|/* 0x21 */
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
id|ndev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|mlp-&gt;online
)paren
)paren
r_return
id|isdn_net_autodial
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
id|proto
op_assign
id|PPP_IP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_IPX
suffix:colon
id|proto
op_assign
id|PPP_IPX
suffix:semicolon
multiline_comment|/* untested */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_ppp: skipped unsupported protocol: %#x.&bslash;n&quot;
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|idev
op_assign
id|isdn_net_get_xmit_dev
c_func
(paren
id|mlp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: IP frame delayed.&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|stop
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
)paren
(brace
multiline_comment|/* PPP connected ? */
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|stop
suffix:semicolon
)brace
id|ipppd
op_assign
id|idev-&gt;ipppd
suffix:semicolon
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * after this line .. requeueing in the device queue is no longer allowed!!!&n;&t; */
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;xmit skb, len %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x40
)paren
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit0&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|ipppd-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_IP
op_logical_and
id|idev-&gt;pppcfg
op_amp
id|SC_COMP_TCP
)paren
(brace
multiline_comment|/* ipts here? probably yes, but check this again */
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
r_int
r_int
id|hl
suffix:semicolon
multiline_comment|/*&n;&t;&t; * we need to reserve enought space in front of&n;&t;&t; * sk_buff. old call to dev_alloc_skb only reserved&n;&t;&t; * 16 bytes, now we are looking what the driver want.&n;&t;&t; */
id|hl
op_assign
id|isdn_slot_hdrlen
c_func
(paren
id|idev-&gt;isdn_slot
)paren
op_plus
id|IPPP_MAX_HEADER
suffix:semicolon
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Note: hl might still be insufficient because the method&n;&t;&t; * above does not account for a possibible MPPP slave channel&n;&t;&t; * which had larger HL header space requirements than the&n;&t;&t; * master.&n;&t;&t; */
id|new_skb
op_assign
id|alloc_skb
c_func
(paren
id|hl
op_plus
id|skb-&gt;len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_skb
)paren
(brace
id|u_char
op_star
id|buf
suffix:semicolon
r_int
id|pktlen
suffix:semicolon
id|skb_reserve
c_func
(paren
id|new_skb
comma
id|hl
)paren
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|skb_put
c_func
(paren
id|new_skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
id|pktlen
op_assign
id|slhc_compress
c_func
(paren
id|mlp-&gt;slcomp
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|new_skb-&gt;data
comma
op_amp
id|buf
comma
op_logical_neg
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_NO_TCP_CCID
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_ne
id|skb-&gt;data
)paren
(brace
r_if
c_cond
(paren
id|new_skb-&gt;data
op_ne
id|buf
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_ppp: FATAL error after slhc_compress!!&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
r_else
(brace
id|dev_kfree_skb
c_func
(paren
id|new_skb
)paren
suffix:semicolon
)brace
id|skb_trim
c_func
(paren
id|skb
comma
id|pktlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
id|SL_TYPE_COMPRESSED_TCP
)paren
(brace
multiline_comment|/* cslip? style -&gt; PPP */
id|proto
op_assign
id|PPP_VJC_COMP
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_xor_assign
id|SL_TYPE_COMPRESSED_TCP
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_ge
id|SL_TYPE_UNCOMPRESSED_TCP
)paren
id|proto
op_assign
id|PPP_VJC_UNCOMP
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)paren
op_or
l_int|0x40
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * normal (single link) or bundle compression&n;&t; */
id|skb
op_assign
id|ippp_ccp_compress
c_func
(paren
id|mlp-&gt;ccp
comma
id|skb
comma
op_amp
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x24
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;xmit2 skb, len %d, proto %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|proto
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_MPP
r_if
c_cond
(paren
id|ipt-&gt;mpppcfg
op_amp
id|SC_MP_PROT
)paren
(brace
multiline_comment|/* we get mp_seqno from static isdn_net_local */
r_int
id|mp_seqno
op_assign
id|ipts-&gt;mp_seqno
suffix:semicolon
id|ipts-&gt;mp_seqno
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ipt-&gt;mpppcfg
op_amp
id|SC_OUT_SHORT_SEQ
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|isdn_ppp_skb_push
c_func
(paren
op_amp
id|skb
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
(brace
r_goto
id|unlock
suffix:semicolon
)brace
id|mp_seqno
op_and_assign
l_int|0xfff
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
op_or
(paren
(paren
id|mp_seqno
op_rshift
l_int|8
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* (B)egin &amp; (E)ndbit .. */
id|data
(braket
l_int|1
)braket
op_assign
id|mp_seqno
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|proto
suffix:semicolon
multiline_comment|/* PID compression */
)brace
r_else
(brace
r_int
r_char
op_star
id|data
op_assign
id|isdn_ppp_skb_push
c_func
(paren
op_amp
id|skb
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
(brace
r_goto
id|unlock
suffix:semicolon
)brace
id|data
(braket
l_int|0
)braket
op_assign
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
suffix:semicolon
multiline_comment|/* (B)egin &amp; (E)ndbit .. */
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* sequence number: 24bit */
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|mp_seqno
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
id|proto
suffix:semicolon
multiline_comment|/* PID compression */
)brace
id|proto
op_assign
id|PPP_MP
suffix:semicolon
multiline_comment|/* MP Protocol, 0x003d */
)brace
macro_line|#endif
macro_line|#if 0
multiline_comment|/*&n;&t; * &squot;link in bundle&squot; compression  ...&n;&t; */
r_if
c_cond
(paren
id|ipt-&gt;compflags
op_amp
id|SC_LINK_COMP_ON
)paren
id|skb
op_assign
id|isdn_ppp_compress
c_func
(paren
id|skb
comma
op_amp
id|proto
comma
id|ipt
comma
id|ipts
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|isdn_ppp_push_header
c_func
(paren
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;skb xmit: len: %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|ipppd-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|isdn_net_writebuf_skb
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
id|stop
suffix:colon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_MPP
multiline_comment|/* this is _not_ rfc1990 header, but something we convert both short and long&n; * headers to for convinience&squot;s sake:&n; * &t;byte 0 is flags as in rfc1990&n; *&t;bytes 1...4 is 24-bit seqence number converted to host byte order &n; */
DECL|macro|MP_HEADER_LEN
mdefine_line|#define MP_HEADER_LEN&t;5
DECL|macro|MP_LONGSEQ_MASK
mdefine_line|#define MP_LONGSEQ_MASK&t;&t;0x00ffffff
DECL|macro|MP_SHORTSEQ_MASK
mdefine_line|#define MP_SHORTSEQ_MASK&t;0x00000fff
DECL|macro|MP_LONGSEQ_MAX
mdefine_line|#define MP_LONGSEQ_MAX&t;&t;MP_LONGSEQ_MASK
DECL|macro|MP_SHORTSEQ_MAX
mdefine_line|#define MP_SHORTSEQ_MAX&t;&t;MP_SHORTSEQ_MASK
DECL|macro|MP_LONGSEQ_MAXBIT
mdefine_line|#define MP_LONGSEQ_MAXBIT&t;((MP_LONGSEQ_MASK+1)&gt;&gt;1)
DECL|macro|MP_SHORTSEQ_MAXBIT
mdefine_line|#define MP_SHORTSEQ_MAXBIT&t;((MP_SHORTSEQ_MASK+1)&gt;&gt;1)
multiline_comment|/* sequence-wrap safe comparisions (for long sequence)*/
DECL|macro|MP_LT
mdefine_line|#define MP_LT(a,b)&t;((a-b)&amp;MP_LONGSEQ_MAXBIT)
DECL|macro|MP_LE
mdefine_line|#define MP_LE(a,b) &t;!((b-a)&amp;MP_LONGSEQ_MAXBIT)
DECL|macro|MP_GT
mdefine_line|#define MP_GT(a,b) &t;((b-a)&amp;MP_LONGSEQ_MAXBIT)
DECL|macro|MP_GE
mdefine_line|#define MP_GE(a,b)&t;!((a-b)&amp;MP_LONGSEQ_MAXBIT)
DECL|macro|MP_SEQ
mdefine_line|#define MP_SEQ(f)&t;((*(u32*)(f-&gt;data+1)))
DECL|macro|MP_FLAGS
mdefine_line|#define MP_FLAGS(f)&t;(f-&gt;data[0])
DECL|function|isdn_ppp_mp_bundle_array_init
r_static
r_int
id|isdn_ppp_mp_bundle_array_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|sz
op_assign
id|ISDN_MAX_CHANNELS
op_star
r_sizeof
(paren
id|ippp_bundle
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|isdn_ppp_bundle_arr
op_assign
(paren
id|ippp_bundle
op_star
)paren
id|kmalloc
c_func
(paren
id|sz
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|isdn_ppp_bundle_arr
comma
l_int|0
comma
id|sz
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|isdn_ppp_bundle_arr
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_bundle_alloc
r_static
id|ippp_bundle
op_star
id|isdn_ppp_mp_bundle_alloc
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|isdn_ppp_bundle_arr
(braket
id|i
)braket
dot
id|ref_ct
op_le
l_int|0
)paren
r_return
(paren
id|isdn_ppp_bundle_arr
op_plus
id|i
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_init
r_static
r_int
id|isdn_ppp_mp_init
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|ippp_bundle
op_star
id|add_to
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|lp-&gt;netdev
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;ppp_slot
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: &gt;ppp_slot(%d) out of range&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|idev-&gt;ppp_slot
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|is
op_assign
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
suffix:semicolon
r_if
c_cond
(paren
id|add_to
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;netdev-&gt;pb
)paren
(brace
id|lp-&gt;netdev-&gt;pb-&gt;ref_ct
op_decrement
suffix:semicolon
)brace
id|lp-&gt;netdev-&gt;pb
op_assign
id|add_to
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* first link in a bundle */
id|is-&gt;mp_seqno
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lp-&gt;netdev-&gt;pb
op_assign
id|isdn_ppp_mp_bundle_alloc
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|lp-&gt;netdev-&gt;pb-&gt;frags
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;netdev-&gt;pb-&gt;frames
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;netdev-&gt;pb-&gt;seq
op_assign
id|LONG_MAX
suffix:semicolon
)brace
id|lp-&gt;netdev-&gt;pb-&gt;ref_ct
op_increment
suffix:semicolon
id|is-&gt;pppseq
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|u32
id|isdn_ppp_mp_get_seq
c_func
(paren
r_int
id|short_seq
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|last_seq
)paren
suffix:semicolon
r_static
r_struct
id|sk_buff
op_star
id|isdn_ppp_mp_discard
c_func
(paren
id|ippp_bundle
op_star
id|mp
comma
r_struct
id|sk_buff
op_star
id|from
comma
r_struct
id|sk_buff
op_star
id|to
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mp_reassembly
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|from
comma
r_struct
id|sk_buff
op_star
id|to
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mp_free_skb
c_func
(paren
id|ippp_bundle
op_star
id|mp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_mp_print_recv_pkt
c_func
(paren
r_int
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|function|isdn_ppp_mp_receive
r_static
r_void
id|isdn_ppp_mp_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|lp-&gt;netdev
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|isdn_net_dev
op_star
id|qdev
suffix:semicolon
id|ippp_bundle
op_star
id|mp
suffix:semicolon
id|isdn_mppp_stats
op_star
id|stats
suffix:semicolon
r_struct
id|sk_buff
op_star
id|newfrag
comma
op_star
id|frag
comma
op_star
id|start
comma
op_star
id|nextf
suffix:semicolon
id|u32
id|newseq
comma
id|minseq
comma
id|thisseq
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|slot
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;netdev-&gt;pb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|mp
op_assign
id|lp-&gt;netdev-&gt;pb
suffix:semicolon
id|stats
op_assign
op_amp
id|mp-&gt;stats
suffix:semicolon
id|slot
op_assign
id|idev-&gt;ppp_slot
suffix:semicolon
r_if
c_cond
(paren
id|slot
template_param
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: ppp_slot(%d)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|slot
)paren
suffix:semicolon
id|stats-&gt;frame_drops
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|is
op_assign
id|ippp_table
(braket
id|slot
)braket
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|mp-&gt;frames
OG
id|stats-&gt;max_queue_len
)paren
(brace
id|stats-&gt;max_queue_len
op_assign
id|mp-&gt;frames
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x8
)paren
id|isdn_ppp_mp_print_recv_pkt
c_func
(paren
id|slot
comma
id|skb
)paren
suffix:semicolon
id|newseq
op_assign
id|isdn_ppp_mp_get_seq
c_func
(paren
id|is-&gt;mpppcfg
op_amp
id|SC_IN_SHORT_SEQ
comma
id|skb
comma
id|is-&gt;pppseq
)paren
suffix:semicolon
multiline_comment|/* if this packet seq # is less than last already processed one,&n;&t; * toss it right away, but check for sequence start case first &n;&t; */
r_if
c_cond
(paren
id|mp-&gt;seq
OG
id|MP_LONGSEQ_MAX
op_logical_and
(paren
id|newseq
op_amp
id|MP_LONGSEQ_MAXBIT
)paren
)paren
(brace
id|mp-&gt;seq
op_assign
id|newseq
suffix:semicolon
multiline_comment|/* the first packet: required for&n;&t;&t;&t;&t;&t; * rfc1990 non-compliant clients --&n;&t;&t;&t;&t;&t; * prevents constant packet toss */
)brace
r_else
r_if
c_cond
(paren
id|MP_LT
c_func
(paren
id|newseq
comma
id|mp-&gt;seq
)paren
)paren
(brace
id|stats-&gt;frame_drops
op_increment
suffix:semicolon
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* find the minimum received sequence number over all links */
id|is-&gt;pppseq
op_assign
id|minseq
op_assign
id|newseq
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|qdev
comma
op_amp
id|lp-&gt;online
comma
id|online
)paren
(brace
id|slot
op_assign
id|qdev-&gt;ppp_slot
suffix:semicolon
r_if
c_cond
(paren
id|slot
template_param
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: lpq-&gt;ppp_slot(%d)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|u32
id|lls
op_assign
id|ippp_table
(braket
id|slot
)braket
op_member_access_from_pointer
id|pppseq
suffix:semicolon
r_if
c_cond
(paren
id|MP_LT
c_func
(paren
id|lls
comma
id|minseq
)paren
)paren
id|minseq
op_assign
id|lls
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|MP_LT
c_func
(paren
id|minseq
comma
id|mp-&gt;seq
)paren
)paren
id|minseq
op_assign
id|mp-&gt;seq
suffix:semicolon
multiline_comment|/* can&squot;t go beyond already processed&n;&t;&t;&t;&t;&t; * packets */
id|newfrag
op_assign
id|skb
suffix:semicolon
multiline_comment|/* if this new fragment is before the first one, then enqueue it now. */
r_if
c_cond
(paren
(paren
id|frag
op_assign
id|mp-&gt;frags
)paren
op_eq
l_int|NULL
op_logical_or
id|MP_LT
c_func
(paren
id|newseq
comma
id|MP_SEQ
c_func
(paren
id|frag
)paren
)paren
)paren
(brace
id|newfrag-&gt;next
op_assign
id|frag
suffix:semicolon
id|mp-&gt;frags
op_assign
id|frag
op_assign
id|newfrag
suffix:semicolon
id|newfrag
op_assign
l_int|NULL
suffix:semicolon
)brace
id|start
op_assign
id|MP_FLAGS
c_func
(paren
id|frag
)paren
op_amp
id|MP_BEGIN_FRAG
op_logical_and
id|MP_SEQ
c_func
(paren
id|frag
)paren
op_eq
id|mp-&gt;seq
ques
c_cond
id|frag
suffix:colon
l_int|NULL
suffix:semicolon
multiline_comment|/* &n;&t; * main fragment traversing loop&n;&t; *&n;&t; * try to accomplish several tasks:&n;&t; * - insert new fragment into the proper sequence slot (once that&squot;s done&n;&t; *   newfrag will be set to NULL)&n;&t; * - reassemble any complete fragment sequence (non-null &squot;start&squot;&n;&t; *   indicates there is a continguous sequence present)&n;&t; * - discard any incomplete sequences that are below minseq -- due&n;&t; *   to the fact that sender always increment sequence number, if there&n;&t; *   is an incomplete sequence below minseq, no new fragments would&n;&t; *   come to complete such sequence and it should be discarded&n;&t; *&n;&t; * loop completes when we accomplished the following tasks:&n;&t; * - new fragment is inserted in the proper sequence (&squot;newfrag&squot; is &n;&t; *   set to NULL)&n;&t; * - we hit a gap in the sequence, so no reassembly/processing is &n;&t; *   possible (&squot;start&squot; would be set to NULL)&n;&t; *&n;&t; * algorightm for this code is derived from code in the book&n;&t; * &squot;PPP Design And Debugging&squot; by James Carlson (Addison-Wesley)&n;&t; */
r_while
c_loop
(paren
id|start
op_ne
l_int|NULL
op_logical_or
id|newfrag
op_ne
l_int|NULL
)paren
(brace
id|thisseq
op_assign
id|MP_SEQ
c_func
(paren
id|frag
)paren
suffix:semicolon
id|nextf
op_assign
id|frag-&gt;next
suffix:semicolon
multiline_comment|/* drop any duplicate fragments */
r_if
c_cond
(paren
id|newfrag
op_ne
l_int|NULL
op_logical_and
id|thisseq
op_eq
id|newseq
)paren
(brace
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|newfrag
)paren
suffix:semicolon
id|newfrag
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* insert new fragment before next element if possible. */
r_if
c_cond
(paren
id|newfrag
op_ne
l_int|NULL
op_logical_and
(paren
id|nextf
op_eq
l_int|NULL
op_logical_or
id|MP_LT
c_func
(paren
id|newseq
comma
id|MP_SEQ
c_func
(paren
id|nextf
)paren
)paren
)paren
)paren
(brace
id|newfrag-&gt;next
op_assign
id|nextf
suffix:semicolon
id|frag-&gt;next
op_assign
id|nextf
op_assign
id|newfrag
suffix:semicolon
id|newfrag
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* check for misplaced start */
r_if
c_cond
(paren
id|start
op_ne
id|frag
op_logical_and
(paren
id|MP_FLAGS
c_func
(paren
id|frag
)paren
op_amp
id|MP_BEGIN_FRAG
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_mppp(seq %d): new &quot;
l_string|&quot;BEGIN flag with no prior END&quot;
comma
id|thisseq
)paren
suffix:semicolon
id|stats-&gt;seqerrs
op_increment
suffix:semicolon
id|stats-&gt;frame_drops
op_increment
suffix:semicolon
id|start
op_assign
id|isdn_ppp_mp_discard
c_func
(paren
id|mp
comma
id|start
comma
id|frag
)paren
suffix:semicolon
id|nextf
op_assign
id|frag-&gt;next
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|MP_LE
c_func
(paren
id|thisseq
comma
id|minseq
)paren
)paren
(brace
r_if
c_cond
(paren
id|MP_FLAGS
c_func
(paren
id|frag
)paren
op_amp
id|MP_BEGIN_FRAG
)paren
id|start
op_assign
id|frag
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|MP_FLAGS
c_func
(paren
id|frag
)paren
op_amp
id|MP_END_FRAG
)paren
id|stats-&gt;frame_drops
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;frags
op_eq
id|frag
)paren
(brace
id|mp-&gt;frags
op_assign
id|nextf
suffix:semicolon
)brace
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|frag
)paren
suffix:semicolon
id|frag
op_assign
id|nextf
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
multiline_comment|/* if start is non-null and we have end fragment, then&n;&t;&t; * we have full reassembly sequence -- reassemble &n;&t;&t; * and process packet now&n;&t;&t; */
r_if
c_cond
(paren
id|start
op_ne
l_int|NULL
op_logical_and
(paren
id|MP_FLAGS
c_func
(paren
id|frag
)paren
op_amp
id|MP_END_FRAG
)paren
)paren
(brace
id|minseq
op_assign
id|mp-&gt;seq
op_assign
(paren
id|thisseq
op_plus
l_int|1
)paren
op_amp
id|MP_LONGSEQ_MASK
suffix:semicolon
multiline_comment|/* Reassemble the packet then dispatch it */
id|isdn_ppp_mp_reassembly
c_func
(paren
id|lp-&gt;netdev
comma
id|lp
comma
id|start
comma
id|nextf
)paren
suffix:semicolon
id|start
op_assign
l_int|NULL
suffix:semicolon
id|frag
op_assign
l_int|NULL
suffix:semicolon
id|mp-&gt;frags
op_assign
id|nextf
suffix:semicolon
)brace
multiline_comment|/* check if need to update start pointer: if we just&n;&t;&t; * reassembled the packet and sequence is contiguous&n;&t;&t; * then next fragment should be the start of new reassembly&n;&t;&t; * if sequence is contiguous, but we haven&squot;t reassembled yet,&n;&t;&t; * keep going.&n;&t;&t; * if sequence is not contiguous, either clear everyting&n;&t;&t; * below low watermark and set start to the next frag or&n;&t;&t; * clear start ptr.&n;&t;&t; */
r_if
c_cond
(paren
id|nextf
op_ne
l_int|NULL
op_logical_and
(paren
(paren
id|thisseq
op_plus
l_int|1
)paren
op_amp
id|MP_LONGSEQ_MASK
)paren
op_eq
id|MP_SEQ
c_func
(paren
id|nextf
)paren
)paren
(brace
multiline_comment|/* if we just reassembled and the next one is here, &n;&t;&t;&t; * then start another reassembly. */
r_if
c_cond
(paren
id|frag
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|MP_FLAGS
c_func
(paren
id|nextf
)paren
op_amp
id|MP_BEGIN_FRAG
)paren
id|start
op_assign
id|nextf
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_mppp(seq %d):&quot;
l_string|&quot; END flag with no following &quot;
l_string|&quot;BEGIN&quot;
comma
id|thisseq
)paren
suffix:semicolon
id|stats-&gt;seqerrs
op_increment
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|nextf
op_ne
l_int|NULL
op_logical_and
id|frag
op_ne
l_int|NULL
op_logical_and
id|MP_LT
c_func
(paren
id|thisseq
comma
id|minseq
)paren
)paren
(brace
multiline_comment|/* we&squot;ve got a break in the sequence&n;&t;&t;&t;&t; * and we not at the end yet&n;&t;&t;&t;&t; * and we did not just reassembled&n;&t;&t;&t;&t; *(if we did, there wouldn&squot;t be anything before)&n;&t;&t;&t;&t; * and we below the low watermark &n;&t;&t;&t; &t; * discard all the frames below low watermark &n;&t;&t;&t;&t; * and start over */
id|stats-&gt;frame_drops
op_increment
suffix:semicolon
id|mp-&gt;frags
op_assign
id|isdn_ppp_mp_discard
c_func
(paren
id|mp
comma
id|start
comma
id|nextf
)paren
suffix:semicolon
)brace
multiline_comment|/* break in the sequence, no reassembly */
id|start
op_assign
l_int|NULL
suffix:semicolon
)brace
id|frag
op_assign
id|nextf
suffix:semicolon
)brace
multiline_comment|/* while -- main loop */
r_if
c_cond
(paren
id|mp-&gt;frags
op_eq
l_int|NULL
)paren
id|mp-&gt;frags
op_assign
id|frag
suffix:semicolon
multiline_comment|/* rather straighforward way to deal with (not very) possible &n;&t; * queue overflow */
r_if
c_cond
(paren
id|mp-&gt;frames
OG
id|MP_MAX_QUEUE_LEN
)paren
(brace
id|stats-&gt;overflows
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|mp-&gt;frames
OG
id|MP_MAX_QUEUE_LEN
)paren
(brace
id|frag
op_assign
id|mp-&gt;frags-&gt;next
suffix:semicolon
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|mp-&gt;frags
)paren
suffix:semicolon
id|mp-&gt;frags
op_assign
id|frag
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_cleanup
r_static
r_void
id|isdn_ppp_mp_cleanup
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|sk_buff
op_star
id|frag
op_assign
id|lp-&gt;netdev-&gt;pb-&gt;frags
suffix:semicolon
r_struct
id|sk_buff
op_star
id|nextfrag
suffix:semicolon
r_while
c_loop
(paren
id|frag
)paren
(brace
id|nextfrag
op_assign
id|frag-&gt;next
suffix:semicolon
id|isdn_ppp_mp_free_skb
c_func
(paren
id|lp-&gt;netdev-&gt;pb
comma
id|frag
)paren
suffix:semicolon
id|frag
op_assign
id|nextfrag
suffix:semicolon
)brace
id|lp-&gt;netdev-&gt;pb-&gt;frags
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_get_seq
r_static
id|u32
id|isdn_ppp_mp_get_seq
c_func
(paren
r_int
id|short_seq
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|last_seq
)paren
(brace
id|u32
id|seq
suffix:semicolon
r_int
id|flags
op_assign
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
(paren
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|short_seq
)paren
(brace
id|seq
op_assign
id|ntohl
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|skb-&gt;data
)paren
op_amp
id|MP_LONGSEQ_MASK
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* convert 12-bit short seq number to 24-bit long one &n;&t; &t;*/
id|seq
op_assign
id|ntohs
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
id|skb-&gt;data
)paren
op_amp
id|MP_SHORTSEQ_MASK
suffix:semicolon
multiline_comment|/* check for seqence wrap */
r_if
c_cond
(paren
op_logical_neg
(paren
id|seq
op_amp
id|MP_SHORTSEQ_MAXBIT
)paren
op_logical_and
(paren
id|last_seq
op_amp
id|MP_SHORTSEQ_MAXBIT
)paren
op_logical_and
(paren
r_int
r_int
)paren
id|last_seq
op_le
id|MP_LONGSEQ_MAX
)paren
(brace
id|seq
op_or_assign
(paren
id|last_seq
op_plus
id|MP_SHORTSEQ_MAX
op_plus
l_int|1
)paren
op_amp
(paren
op_complement
id|MP_SHORTSEQ_MASK
op_amp
id|MP_LONGSEQ_MASK
)paren
suffix:semicolon
)brace
r_else
id|seq
op_or_assign
id|last_seq
op_amp
(paren
op_complement
id|MP_SHORTSEQ_MASK
op_amp
id|MP_LONGSEQ_MASK
)paren
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* put converted seqence back in skb */
)brace
op_star
(paren
id|u32
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|1
)paren
op_assign
id|seq
suffix:semicolon
multiline_comment|/* put seqence back in _host_ byte&n;&t;&t;&t;&t;&t; * order */
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
id|flags
suffix:semicolon
multiline_comment|/* restore flags */
r_return
id|seq
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_discard
r_struct
id|sk_buff
op_star
id|isdn_ppp_mp_discard
c_func
(paren
id|ippp_bundle
op_star
id|mp
comma
r_struct
id|sk_buff
op_star
id|from
comma
r_struct
id|sk_buff
op_star
id|to
)paren
(brace
r_if
c_cond
(paren
id|from
)paren
r_while
c_loop
(paren
id|from
op_ne
id|to
)paren
(brace
r_struct
id|sk_buff
op_star
id|next
op_assign
id|from-&gt;next
suffix:semicolon
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|from
)paren
suffix:semicolon
id|from
op_assign
id|next
suffix:semicolon
)brace
r_return
id|from
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_reassembly
r_void
id|isdn_ppp_mp_reassembly
c_func
(paren
id|isdn_net_dev
op_star
id|net_dev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|from
comma
r_struct
id|sk_buff
op_star
id|to
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|lp-&gt;netdev
suffix:semicolon
id|ippp_bundle
op_star
id|mp
op_assign
id|net_dev-&gt;pb
suffix:semicolon
r_int
id|proto
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|tot_len
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;ppp_slot
template_param
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: ppp_slot(%d) out of range&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|idev-&gt;ppp_slot
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|MP_FLAGS
c_func
(paren
id|from
)paren
op_eq
(paren
id|MP_BEGIN_FRAG
op_or
id|MP_END_FRAG
)paren
)paren
(brace
r_if
c_cond
(paren
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_mppp: reassembly: frame %d, &quot;
l_string|&quot;len %d&bslash;n&quot;
comma
id|MP_SEQ
c_func
(paren
id|from
)paren
comma
id|from-&gt;len
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|from
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|MP_HEADER_LEN
)paren
suffix:semicolon
id|mp-&gt;frames
op_decrement
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|frag
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|tot_len
op_assign
id|n
op_assign
l_int|0
comma
id|frag
op_assign
id|from
suffix:semicolon
id|frag
op_ne
id|to
suffix:semicolon
id|frag
op_assign
id|frag-&gt;next
comma
id|n
op_increment
)paren
(brace
id|tot_len
op_add_assign
id|frag-&gt;len
op_minus
id|MP_HEADER_LEN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|debug
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_mppp: reassembling frames %d &quot;
l_string|&quot;to %d, len %d&bslash;n&quot;
comma
id|MP_SEQ
c_func
(paren
id|from
)paren
comma
(paren
id|MP_SEQ
c_func
(paren
id|from
)paren
op_plus
id|n
op_minus
l_int|1
)paren
op_amp
id|MP_LONGSEQ_MASK
comma
id|tot_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|tot_len
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isdn_mppp: cannot allocate sk buff &quot;
l_string|&quot;of size %d&bslash;n&quot;
comma
id|tot_len
)paren
suffix:semicolon
id|isdn_ppp_mp_discard
c_func
(paren
id|mp
comma
id|from
comma
id|to
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|from
op_ne
id|to
)paren
(brace
r_int
r_int
id|len
op_assign
id|from-&gt;len
op_minus
id|MP_HEADER_LEN
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|from-&gt;data
op_plus
id|MP_HEADER_LEN
comma
id|len
)paren
suffix:semicolon
id|frag
op_assign
id|from-&gt;next
suffix:semicolon
id|isdn_ppp_mp_free_skb
c_func
(paren
id|mp
comma
id|from
)paren
suffix:semicolon
id|from
op_assign
id|frag
suffix:semicolon
)brace
)brace
id|proto
op_assign
id|isdn_ppp_strip_proto
c_func
(paren
id|skb
)paren
suffix:semicolon
id|isdn_ppp_push_higher
c_func
(paren
id|lp
comma
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_free_skb
r_static
r_void
id|isdn_ppp_mp_free_skb
c_func
(paren
id|ippp_bundle
op_star
id|mp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|mp-&gt;frames
op_decrement
suffix:semicolon
)brace
DECL|function|isdn_ppp_mp_print_recv_pkt
r_static
r_void
id|isdn_ppp_mp_print_recv_pkt
c_func
(paren
r_int
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;mp_recv: %d/%d -&gt; %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|slot
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|2
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|3
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|4
)braket
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ppp_bundle
id|isdn_ppp_bundle
c_func
(paren
r_struct
id|ipppd
op_star
id|is
comma
r_int
id|unit
)paren
(brace
r_char
id|ifn
(braket
id|IFNAMSIZ
op_plus
l_int|1
)braket
suffix:semicolon
id|isdn_net_dev
op_star
id|p
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
comma
op_star
id|nidev
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|sprintf
c_func
(paren
id|ifn
comma
l_string|&quot;ippp%d&quot;
comma
id|unit
)paren
suffix:semicolon
id|p
op_assign
id|isdn_net_findif
c_func
(paren
id|ifn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ippp_bundle: cannot find %s&bslash;n&quot;
comma
id|ifn
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;pb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|nidev
op_assign
id|is-&gt;idev
suffix:semicolon
id|idev
op_assign
id|list_entry
c_func
(paren
id|p-&gt;mlp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nidev-&gt;ppp_slot
OL
l_int|0
op_logical_or
id|nidev-&gt;ppp_slot
op_ge
id|ISDN_MAX_CHANNELS
op_logical_or
id|idev
op_member_access_from_pointer
id|ppp_slot
OL
l_int|0
op_logical_or
id|idev
op_member_access_from_pointer
id|ppp_slot
op_ge
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ippp_bundle: binding to invalid slot %d&bslash;n&quot;
comma
id|nidev-&gt;ppp_slot
OL
l_int|0
op_logical_or
id|nidev-&gt;ppp_slot
op_ge
id|ISDN_MAX_CHANNELS
ques
c_cond
id|nidev-&gt;ppp_slot
suffix:colon
id|idev-&gt;ppp_slot
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|isdn_net_add_to_bundle
c_func
(paren
id|p-&gt;mlp
comma
id|nidev
)paren
suffix:semicolon
id|ippp_table
(braket
id|nidev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|unit
op_assign
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|unit
suffix:semicolon
multiline_comment|/* maybe also SC_CCP stuff */
id|ippp_table
(braket
id|nidev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|pppcfg
op_or_assign
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|pppcfg
op_amp
(paren
id|SC_ENABLE_IP
op_or
id|SC_NO_TCP_CCID
op_or
id|SC_REJ_COMP_TCP
)paren
suffix:semicolon
id|ippp_table
(braket
id|nidev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
op_or_assign
id|ippp_table
(braket
id|idev-&gt;ppp_slot
)braket
op_member_access_from_pointer
id|mpppcfg
op_amp
(paren
id|SC_MP_PROT
op_or
id|SC_REJ_MP_PROT
op_or
id|SC_OUT_SHORT_SEQ
op_or
id|SC_IN_SHORT_SEQ
)paren
suffix:semicolon
id|rc
op_assign
id|isdn_ppp_mp_init
c_func
(paren
id|nidev-&gt;mlp
comma
id|p-&gt;pb
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;pb-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ISDN_MPP */
multiline_comment|/*&n; * network device ioctl handlers&n; */
r_static
r_int
DECL|function|isdn_ppp_dev_ioctl_stats
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
r_int
id|slot
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ppp_stats
op_star
id|res
comma
id|t
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|res
op_assign
(paren
r_struct
id|ppp_stats
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|res
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* build a temporary stat struct and copy it to user space */
id|memset
c_func
(paren
op_amp
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|t.p.ppp_ipackets
op_assign
id|lp-&gt;stats.rx_packets
suffix:semicolon
id|t.p.ppp_ibytes
op_assign
id|lp-&gt;stats.rx_bytes
suffix:semicolon
id|t.p.ppp_ierrors
op_assign
id|lp-&gt;stats.rx_errors
suffix:semicolon
id|t.p.ppp_opackets
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
id|t.p.ppp_obytes
op_assign
id|lp-&gt;stats.tx_bytes
suffix:semicolon
id|t.p.ppp_oerrors
op_assign
id|lp-&gt;stats.tx_errors
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|is
op_assign
id|ipppd_get
c_func
(paren
id|slot
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is
)paren
(brace
r_struct
id|slcompress
op_star
id|slcomp
op_assign
id|lp-&gt;slcomp
suffix:semicolon
r_if
c_cond
(paren
id|slcomp
)paren
(brace
id|t.vj.vjs_packets
op_assign
id|slcomp-&gt;sls_o_compressed
op_plus
id|slcomp-&gt;sls_o_uncompressed
suffix:semicolon
id|t.vj.vjs_compressed
op_assign
id|slcomp-&gt;sls_o_compressed
suffix:semicolon
id|t.vj.vjs_searches
op_assign
id|slcomp-&gt;sls_o_searches
suffix:semicolon
id|t.vj.vjs_misses
op_assign
id|slcomp-&gt;sls_o_misses
suffix:semicolon
id|t.vj.vjs_errorin
op_assign
id|slcomp-&gt;sls_i_error
suffix:semicolon
id|t.vj.vjs_tossed
op_assign
id|slcomp-&gt;sls_i_tossed
suffix:semicolon
id|t.vj.vjs_uncompressedin
op_assign
id|slcomp-&gt;sls_i_uncompressed
suffix:semicolon
id|t.vj.vjs_compressedin
op_assign
id|slcomp-&gt;sls_i_compressed
suffix:semicolon
)brace
id|ipppd_put
c_func
(paren
id|is
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|res
comma
op_amp
id|t
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|isdn_ppp_dev_ioctl
id|isdn_ppp_dev_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|r
suffix:semicolon
r_int
id|len
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_ne
id|ISDN_NET_ENCAP_SYNCPPP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGPPPVER
suffix:colon
id|r
op_assign
(paren
r_char
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|PPP_VERSION
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|r
comma
id|PPP_VERSION
comma
id|len
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCGPPPSTATS
suffix:colon
id|error
op_assign
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
l_int|0
comma
id|ifr
comma
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ppp_if_get_unit
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_int
id|len
comma
id|i
comma
id|unit
op_assign
l_int|0
comma
id|deci
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;ippp&quot;
comma
id|name
comma
l_int|4
)paren
op_logical_or
id|len
OG
l_int|8
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|deci
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
comma
id|deci
op_mul_assign
l_int|10
)paren
(brace
r_char
id|a
op_assign
id|name
(braket
id|len
op_minus
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ge
l_char|&squot;0&squot;
op_logical_and
id|a
op_le
l_char|&squot;9&squot;
)paren
id|unit
op_add_assign
(paren
id|a
op_minus
l_char|&squot;0&squot;
)paren
op_star
id|deci
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_or
id|len
op_minus
id|i
op_ne
l_int|4
)paren
id|unit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|unit
suffix:semicolon
)brace
r_int
DECL|function|isdn_ppp_dial_slave
id|isdn_ppp_dial_slave
c_func
(paren
r_char
op_star
id|name
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|isdn_net_dev
op_star
id|sdev
suffix:semicolon
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|idev
)paren
)paren
r_return
l_int|5
suffix:semicolon
id|sdev
op_assign
id|idev-&gt;slave
suffix:semicolon
r_while
c_loop
(paren
id|sdev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|sdev
)paren
)paren
r_break
suffix:semicolon
id|sdev
op_assign
id|sdev-&gt;slave
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sdev
)paren
r_return
l_int|2
suffix:semicolon
id|isdn_net_dial_req
c_func
(paren
id|sdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|isdn_ppp_hangup_slave
id|isdn_ppp_hangup_slave
c_func
(paren
r_char
op_star
id|name
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_MPP
id|isdn_net_dev
op_star
id|idev
comma
op_star
id|sdev
suffix:semicolon
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|idev
)paren
)paren
r_return
l_int|5
suffix:semicolon
id|sdev
op_assign
id|idev-&gt;slave
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sdev
op_logical_or
op_logical_neg
id|isdn_net_bound
c_func
(paren
id|sdev
)paren
)paren
r_return
l_int|2
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|sdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * PPP compression stuff&n; */
multiline_comment|/* Push an empty CCP Data Frame up to the daemon to wake it up and let it&n;   generate a CCP Reset-Request or tear down CCP altogether */
DECL|function|isdn_ppp_dev_kick_up
r_static
r_void
id|isdn_ppp_dev_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
id|ipppd_queue_read
c_func
(paren
id|idev-&gt;ipppd
comma
id|PPP_COMPFRAG
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|isdn_ppp_lp_kick_up
r_static
r_void
id|isdn_ppp_lp_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|ipppd_queue_read
c_func
(paren
id|idev-&gt;ipppd
comma
id|PPP_COMP
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Send a CCP Reset-Request or Reset-Ack directly from the kernel. */
r_static
r_struct
id|sk_buff
op_star
DECL|function|__isdn_ppp_alloc_skb
id|__isdn_ppp_alloc_skb
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_int
id|len
comma
r_int
r_int
id|gfp_mask
)paren
(brace
r_int
id|hl
op_assign
id|IPPP_MAX_HEADER
op_plus
id|isdn_slot_hdrlen
c_func
(paren
id|idev-&gt;isdn_slot
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|hl
op_plus
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|NULL
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|isdn_ppp_dev_alloc_skb
id|isdn_ppp_dev_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
r_return
id|__isdn_ppp_alloc_skb
c_func
(paren
id|idev
comma
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|isdn_ppp_lp_alloc_skb
id|isdn_ppp_lp_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
r_return
id|__isdn_ppp_alloc_skb
c_func
(paren
id|idev
comma
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_dev_push_header
id|isdn_ppp_dev_push_header
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
id|isdn_ppp_push_header
c_func
(paren
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_lp_push_header
id|isdn_ppp_lp_push_header
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|isdn_ppp_push_header
c_func
(paren
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_dev_xmit
id|isdn_ppp_dev_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_lp_xmit
id|isdn_ppp_lp_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * we received a CCP frame .. &n; * not a clean solution, but we MUST handle a few cases in the kernel&n; */
r_static
r_void
DECL|function|isdn_ppp_receive_ccp
id|isdn_ppp_receive_ccp
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
(brace
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_CCP
)paren
id|ippp_ccp_receive_ccp
c_func
(paren
id|lp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_else
id|ippp_ccp_receive_ccp
c_func
(paren
id|idev-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Daemon sends a CCP frame ...&n; */
DECL|function|isdn_ppp_send_ccp
r_static
r_void
id|isdn_ppp_send_ccp
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
id|isdn_net_local
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|proto
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
op_logical_or
id|skb-&gt;len
OL
l_int|3
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Daemon may send with or without address and control field comp */
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|0xff
op_logical_and
id|data
(braket
l_int|1
)braket
op_eq
l_int|0x03
)paren
(brace
id|data
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|5
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
id|proto
op_assign
(paren
(paren
r_int
)paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_plus
id|data
(braket
l_int|1
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_CCP
suffix:colon
id|ippp_ccp_send_ccp
c_func
(paren
id|lp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_CCPFRAG
suffix:colon
id|ippp_ccp_send_ccp
c_func
(paren
id|idev-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|isdn_ppp_set_compressor
id|isdn_ppp_set_compressor
c_func
(paren
r_struct
id|ipppd
op_star
id|is
comma
r_struct
id|isdn_ppp_comp_data
op_star
id|data
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|is-&gt;idev
suffix:semicolon
id|isdn_net_local
op_star
id|lp
suffix:semicolon
r_struct
id|ippp_ccp
op_star
id|ccp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|lp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;flags
op_amp
id|IPPP_COMP_FLAG_LINK
)paren
id|ccp
op_assign
id|idev-&gt;ccp
suffix:semicolon
r_else
id|ccp
op_assign
id|lp-&gt;ccp
suffix:semicolon
r_return
id|ippp_ccp_set_compressor
c_func
(paren
id|ccp
comma
id|is-&gt;unit
comma
id|data
)paren
suffix:semicolon
)brace
singleline_comment|// ISDN_NET_ENCAP_SYNCPPP
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_ppp_open
id|isdn_ppp_open
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
id|lp-&gt;mpppcfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mppp configuration */
id|lp-&gt;mp_seqno
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* MP sequence number */
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|lp-&gt;slcomp
op_assign
id|slhc_init
c_func
(paren
l_int|16
comma
l_int|16
)paren
suffix:semicolon
macro_line|#endif
id|lp-&gt;ccp
op_assign
id|ippp_ccp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;ccp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|lp-&gt;ccp-&gt;proto
op_assign
id|PPP_COMP
suffix:semicolon
id|lp-&gt;ccp-&gt;priv
op_assign
id|lp
suffix:semicolon
id|lp-&gt;ccp-&gt;alloc_skb
op_assign
id|isdn_ppp_lp_alloc_skb
suffix:semicolon
id|lp-&gt;ccp-&gt;push_header
op_assign
id|isdn_ppp_lp_push_header
suffix:semicolon
id|lp-&gt;ccp-&gt;xmit
op_assign
id|isdn_ppp_lp_xmit
suffix:semicolon
id|lp-&gt;ccp-&gt;kick_up
op_assign
id|isdn_ppp_lp_kick_up
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_close
id|isdn_ppp_close
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|slhc_free
c_func
(paren
id|lp-&gt;slcomp
)paren
suffix:semicolon
id|lp-&gt;slcomp
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|ippp_ccp_free
c_func
(paren
id|lp-&gt;ccp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_disconnected
id|isdn_ppp_disconnected
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
id|isdn_net_offline
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|variable|isdn_ppp_ops
r_struct
id|isdn_netif_ops
id|isdn_ppp_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_ppp_start_xmit
comma
dot
id|do_ioctl
op_assign
id|isdn_ppp_dev_ioctl
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|receive
op_assign
id|isdn_ppp_receive
comma
dot
id|connected
op_assign
id|isdn_ppp_connected
comma
dot
id|disconnected
op_assign
id|isdn_ppp_disconnected
comma
dot
id|bind
op_assign
id|isdn_ppp_bind
comma
dot
id|unbind
op_assign
id|isdn_ppp_unbind
comma
dot
id|open
op_assign
id|isdn_ppp_open
comma
dot
id|close
op_assign
id|isdn_ppp_close
comma
)brace
suffix:semicolon
eof
