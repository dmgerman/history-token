multiline_comment|/* Linux ISDN subsystem, functions for synchronous PPP (linklevel).&n; *&n; * Copyright 1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *           1999-2002  by Kai Germaschewski &lt;kai@germaschewski.name&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/ppp-comp.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_net_lib.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#include &quot;isdn_ppp_ccp.h&quot;
macro_line|#include &quot;isdn_ppp_vj.h&quot;
macro_line|#include &quot;isdn_ppp_mp.h&quot;
multiline_comment|/* ====================================================================== */
DECL|macro|IPPP_MAX_RQ_LEN
mdefine_line|#define IPPP_MAX_RQ_LEN 8 /* max #frames queued for ipppd to read */
r_static
r_int
id|isdn_ppp_set_compressor
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|isdn_ppp_comp_data
op_star
)paren
suffix:semicolon
multiline_comment|/* ====================================================================== */
multiline_comment|/* IPPPD handling                                                         */
multiline_comment|/* ====================================================================== */
multiline_comment|/* We use reference counting for struct ipppd. It is alloced on&n; * open() on /dev/ipppX and saved into file-&gt;private, making for one&n; * reference. release() will release this reference, after all other&n; * references are gone, the destructor frees it.&n; *&n; * Another reference is taken by isdn_ppp_bind() and freed by&n; * isdn_ppp_unbind(). The callbacks from isdn_net_lib.c happen only&n; * between isdn_ppp_bind() and isdn_ppp_unbind(), i.e. access to &n; * idev-&gt;ipppd is safe without further locking.&n; */
DECL|macro|IPPPD_DEBUG
macro_line|#undef IPPPD_DEBUG
macro_line|#ifdef IPPPD_DEBUG
DECL|macro|ipppd_debug
mdefine_line|#define ipppd_debug(i, fmt, arg...) &bslash;&n;        printk(KERN_DEBUG &quot;ipppd %p minor %d state %#x %s: &quot; fmt &quot;&bslash;n&quot;, (i), &bslash;&n;               (i)-&gt;minor, (i)-&gt;state, __FUNCTION__ , ## arg)
macro_line|#else
DECL|macro|ipppd_debug
mdefine_line|#define ipppd_debug(...) do { } while (0)
macro_line|#endif
multiline_comment|/* ipppd::flags */
r_enum
(brace
DECL|enumerator|IPPPD_FL_HUP
id|IPPPD_FL_HUP
op_assign
l_int|0x01
comma
DECL|enumerator|IPPPD_FL_WAKEUP
id|IPPPD_FL_WAKEUP
op_assign
l_int|0x02
comma
)brace
suffix:semicolon
multiline_comment|/* ipppd::state */
r_enum
(brace
DECL|enumerator|IPPPD_ST_OPEN
id|IPPPD_ST_OPEN
comma
DECL|enumerator|IPPPD_ST_ASSIGNED
id|IPPPD_ST_ASSIGNED
comma
DECL|enumerator|IPPPD_ST_CONNECTED
id|IPPPD_ST_CONNECTED
comma
)brace
suffix:semicolon
DECL|struct|ipppd
r_struct
id|ipppd
(brace
DECL|member|ipppds
r_struct
id|list_head
id|ipppds
suffix:semicolon
DECL|member|state
r_int
id|state
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|rq
r_struct
id|sk_buff_head
id|rq
suffix:semicolon
DECL|member|wq
id|wait_queue_head_t
id|wq
suffix:semicolon
DECL|member|idev
r_struct
id|isdn_net_dev_s
op_star
id|idev
suffix:semicolon
DECL|member|unit
r_int
id|unit
suffix:semicolon
DECL|member|minor
r_int
id|minor
suffix:semicolon
DECL|member|debug
r_int
r_int
id|debug
suffix:semicolon
DECL|member|refcnt
id|atomic_t
id|refcnt
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* ====================================================================== */
DECL|variable|ipppds_lock
r_static
id|spinlock_t
id|ipppds_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|ipppds
)paren
suffix:semicolon
r_static
r_void
DECL|function|ipppd_destroy
id|ipppd_destroy
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|HERE
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|ipppd-&gt;rq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ipppd
)paren
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|ipppd
op_star
DECL|function|ipppd_get
id|ipppd_get
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|atomic_read
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
suffix:semicolon
r_return
id|ipppd
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|ipppd_put
id|ipppd_put
c_func
(paren
r_struct
id|ipppd
op_star
id|ipppd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|atomic_read
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
)paren
)paren
id|ipppd_destroy
c_func
(paren
id|ipppd
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* char dev ops                                                           */
multiline_comment|/* --- open ------------------------------------------------------------- */
r_static
r_int
DECL|function|ipppd_open
id|ipppd_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|minor
op_assign
id|minor
c_func
(paren
id|ino-&gt;i_rdev
)paren
op_minus
id|ISDN_MINOR_PPP
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
id|ipppd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ipppd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipppd
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|ipppd
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ipppd
)paren
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|ipppd-&gt;refcnt
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* file-&gt;private_data holds a reference */
id|file-&gt;private_data
op_assign
id|ipppd_get
c_func
(paren
id|ipppd
)paren
suffix:semicolon
id|ipppd-&gt;unit
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set by isdn_ppp_bind */
id|ipppd-&gt;minor
op_assign
id|minor
suffix:semicolon
id|ipppd-&gt;state
op_assign
id|IPPPD_ST_OPEN
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ipppd-&gt;wq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ipppd-&gt;rq
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|ipppd-&gt;ipppds
comma
op_amp
id|ipppds
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|ipppd
comma
l_string|&quot;minor %d&quot;
comma
id|minor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --- release  --------------------------------------------------------- */
r_static
r_int
DECL|function|ipppd_release
id|ipppd_release
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
op_assign
id|file-&gt;private_data
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|ipppd
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;state
op_eq
id|IPPPD_ST_CONNECTED
)paren
id|isdn_net_hangup
c_func
(paren
id|ipppd-&gt;idev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|ipppd-&gt;ipppds
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|ipppd_put
c_func
(paren
id|ipppd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --- read ------------------------------------------------------------- */
multiline_comment|/* read() is always non blocking */
r_static
id|ssize_t
DECL|function|ipppd_read
id|ipppd_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|is-&gt;rq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|count
)paren
(brace
id|retval
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|retval
op_assign
id|skb-&gt;len
suffix:semicolon
id|out_free
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* --- write ------------------------------------------------------------ */
multiline_comment|/* write() is always non blocking */
r_static
id|ssize_t
DECL|function|ipppd_write
id|ipppd_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|u16
id|proto
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|ipppd
op_assign
id|file-&gt;private_data
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|ipppd
comma
l_string|&quot;count = %d&quot;
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;state
op_ne
id|IPPPD_ST_CONNECTED
)paren
(brace
id|retval
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|idev
op_assign
id|ipppd-&gt;idev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|inl_ppp
op_assign
id|idev-&gt;mlp-&gt;inl_priv
suffix:semicolon
multiline_comment|/* Daemon needs to send at least full header, AC + proto */
r_if
c_cond
(paren
id|count
OL
l_int|4
)paren
(brace
id|retval
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb
op_assign
id|isdn_ppp_dev_alloc_skb
c_func
(paren
id|idev
comma
id|count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|buf
comma
id|count
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Don&squot;t reset huptimer for LCP packets. (Echo requests). */
id|proto
op_assign
id|PPP_PROTOCOL
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_ne
id|PPP_LCP
)paren
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Keeps CCP/compression states in sync */
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_CCP
suffix:colon
id|ippp_ccp_send_ccp
c_func
(paren
id|inl_ppp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_CCPFRAG
suffix:colon
id|ippp_ccp_send_ccp
c_func
(paren
id|ind_ppp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* FIXME: Somewhere we need protection against the&n;&t; * queue growing too large */
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
id|retval
op_assign
id|count
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* --- poll ------------------------------------------------------------- */
r_static
r_int
r_int
DECL|function|ipppd_poll
id|ipppd_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|is
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
multiline_comment|/* just registers wait_queue hook. This doesn&squot;t really wait. */
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|is-&gt;wq
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;flags
op_amp
id|IPPPD_FL_HUP
)paren
(brace
id|mask
op_assign
id|POLLHUP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* we&squot;re always ready to send .. */
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
multiline_comment|/*&n;&t; * if IPPP_FL_WAKEUP is set we return even if we have nothing to read&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|is-&gt;rq
)paren
op_logical_or
id|is-&gt;flags
op_amp
id|IPPPD_FL_WAKEUP
)paren
(brace
id|is-&gt;flags
op_and_assign
op_complement
id|IPPPD_FL_WAKEUP
suffix:semicolon
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/* --- ioctl ------------------------------------------------------------ */
multiline_comment|/* get_arg .. ioctl helper */
r_static
r_int
DECL|function|get_arg
id|get_arg
c_func
(paren
r_int
r_int
id|arg
comma
r_void
op_star
id|val
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
id|val
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set arg .. ioctl helper */
r_static
r_int
DECL|function|set_arg
id|set_arg
c_func
(paren
r_int
r_int
id|arg
comma
r_void
op_star
id|val
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
(paren
r_void
op_star
)paren
id|val
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipppd_ioctl
id|ipppd_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|r
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
suffix:semicolon
r_struct
id|isdn_ppp_comp_data
id|data
suffix:semicolon
r_int
r_int
id|cfg
suffix:semicolon
id|is
op_assign
id|file-&gt;private_data
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|is
comma
l_string|&quot;cmd %#x&quot;
comma
id|cmd
)paren
suffix:semicolon
singleline_comment|// FIXME that needs locking?
id|idev
op_assign
id|is-&gt;idev
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|inl_ppp
op_assign
id|idev-&gt;mlp-&gt;inl_priv
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PPPIOCGUNIT
suffix:colon
multiline_comment|/* get ppp/isdn unit number */
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|is-&gt;unit
comma
r_sizeof
(paren
id|is-&gt;unit
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGDEBUG
suffix:colon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|is-&gt;debug
comma
r_sizeof
(paren
id|is-&gt;debug
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSDEBUG
suffix:colon
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|is-&gt;debug
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|ind_ppp-&gt;debug
op_assign
id|val
suffix:semicolon
id|inl_ppp-&gt;debug
op_assign
id|val
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPPIOCGCOMPRESSORS
suffix:colon
(brace
r_int
r_int
id|protos
(braket
l_int|8
)braket
suffix:semicolon
id|ippp_ccp_get_compressors
c_func
(paren
id|protos
)paren
suffix:semicolon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
id|protos
comma
r_sizeof
(paren
id|protos
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|r
op_assign
op_minus
id|ENOTTY
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r
op_ne
op_minus
id|ENOTTY
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|r
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PPPIOCBUNDLE
suffix:colon
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|r
op_assign
id|ippp_mp_bundle
c_func
(paren
id|idev
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGIFNAME
suffix:colon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
id|idev-&gt;name
comma
id|strlen
c_func
(paren
id|idev-&gt;name
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGMPFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|inl_ppp-&gt;mp_cfg
comma
r_sizeof
(paren
id|inl_ppp-&gt;mp_cfg
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|inl_ppp-&gt;mp_cfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGFLAGS
suffix:colon
multiline_comment|/* get configuration flags */
id|cfg
op_assign
id|ind_ppp-&gt;pppcfg
op_or
id|ippp_ccp_get_flags
c_func
(paren
id|ind_ppp-&gt;ccp
)paren
suffix:semicolon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSFLAGS
suffix:colon
multiline_comment|/* set configuration flags */
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|SC_ENABLE_IP
)paren
op_logical_and
op_logical_neg
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
)paren
(brace
id|ind_ppp-&gt;pppcfg
op_assign
id|val
suffix:semicolon
multiline_comment|/* OK .. we are ready to send buffers */
id|isdn_net_online
c_func
(paren
id|idev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ind_ppp-&gt;pppcfg
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGIDLE
suffix:colon
multiline_comment|/* get idle time information */
(brace
r_struct
id|ppp_idle
id|pidle
suffix:semicolon
id|pidle.xmit_idle
op_assign
id|pidle.recv_idle
op_assign
id|idev-&gt;huptimer
suffix:semicolon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|pidle
comma
r_sizeof
(paren
id|pidle
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PPPIOCSMRU
suffix:colon
multiline_comment|/* set receive unit size for PPP */
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|r
op_assign
id|ippp_ccp_set_mru
c_func
(paren
id|ind_ppp-&gt;ccp
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPMRU
suffix:colon
r_break
suffix:semicolon
r_case
id|PPPIOCSMPMTU
suffix:colon
r_break
suffix:semicolon
r_case
id|PPPIOCSMAXCID
suffix:colon
multiline_comment|/* set the maximum compression slot id */
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|r
op_assign
id|ippp_vj_set_maxcid
c_func
(paren
id|idev
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSCOMPRESSOR
suffix:colon
id|r
op_assign
id|get_arg
c_func
(paren
id|arg
comma
op_amp
id|data
comma
r_sizeof
(paren
id|data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_break
suffix:semicolon
id|r
op_assign
id|isdn_ppp_set_compressor
c_func
(paren
id|idev
comma
op_amp
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGCALLINFO
suffix:colon
(brace
id|isdn_net_local
op_star
id|mlp
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|phone
suffix:semicolon
r_struct
id|pppcallinfo
id|pci
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pci
comma
l_int|0
comma
r_sizeof
(paren
id|pci
)paren
)paren
suffix:semicolon
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|strlcpy
c_func
(paren
id|pci.local_num
comma
id|mlp-&gt;msn
comma
r_sizeof
(paren
id|pci.local_num
)paren
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|phone
comma
op_amp
id|mlp-&gt;phone
(braket
l_int|1
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|i
op_increment
op_eq
id|idev-&gt;dial
)paren
(brace
id|strlcpy
c_func
(paren
id|pci.remote_num
comma
id|phone-&gt;num
comma
r_sizeof
(paren
id|pci.remote_num
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|pci.charge_units
op_assign
id|idev-&gt;charge
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;outgoing
)paren
id|pci.calltype
op_assign
id|CALLTYPE_OUTGOING
suffix:semicolon
r_else
id|pci.calltype
op_assign
id|CALLTYPE_INCOMING
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
id|pci.calltype
op_or_assign
id|CALLTYPE_CALLBACK
suffix:semicolon
id|r
op_assign
id|set_arg
c_func
(paren
id|arg
comma
op_amp
id|pci
comma
r_sizeof
(paren
id|pci
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|r
op_assign
op_minus
id|ENOTTY
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* --- fops ------------------------------------------------------------- */
DECL|variable|isdn_ppp_fops
r_struct
id|file_operations
id|isdn_ppp_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|ipppd_read
comma
dot
id|write
op_assign
id|ipppd_write
comma
dot
id|poll
op_assign
id|ipppd_poll
comma
dot
id|ioctl
op_assign
id|ipppd_ioctl
comma
dot
id|open
op_assign
id|ipppd_open
comma
dot
id|release
op_assign
id|ipppd_release
comma
)brace
suffix:semicolon
multiline_comment|/* --- ipppd_queue_read ------------------------------------------------- */
multiline_comment|/* Queue packets for ipppd to read(). */
r_static
r_int
DECL|function|ipppd_queue_read
id|ipppd_queue_read
c_func
(paren
r_struct
id|ipppd
op_star
id|is
comma
id|u16
id|proto
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;state
op_ne
id|IPPPD_ST_CONNECTED
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp: device not connected.&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|is-&gt;rq
)paren
OG
id|IPPP_MAX_RQ_LEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Queue is full&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ippp: Can&squot;t alloc buf&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_ALLSTATIONS
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_UI
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u16
c_func
(paren
id|p
comma
id|proto
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|is-&gt;rq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|is-&gt;wq
)paren
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* interface to isdn_net_lib                                            */
multiline_comment|/* ====================================================================== */
multiline_comment|/* Prototypes */
r_static
r_int
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|namebuf
)paren
suffix:semicolon
r_static
r_void
id|isdn_ppp_dev_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
suffix:semicolon
r_static
r_struct
id|sk_buff
op_star
id|isdn_ppp_lp_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
suffix:semicolon
multiline_comment|/* New CCP stuff */
r_static
r_void
id|isdn_ppp_dev_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
suffix:semicolon
multiline_comment|/*&n; * frame log (debug)&n; */
r_void
DECL|function|isdn_ppp_frame_log
id|isdn_ppp_frame_log
c_func
(paren
r_char
op_star
id|info
comma
r_char
op_star
id|data
comma
r_int
id|len
comma
r_int
id|maxlen
comma
r_int
id|unit
comma
r_int
id|slot
)paren
(brace
r_int
id|cnt
comma
id|j
comma
id|i
suffix:semicolon
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|maxlen
)paren
id|maxlen
op_assign
id|len
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|maxlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
op_logical_and
id|cnt
OL
id|maxlen
suffix:semicolon
id|j
op_increment
comma
id|cnt
op_increment
)paren
id|sprintf
c_func
(paren
id|buf
op_plus
id|j
op_star
l_int|3
comma
l_string|&quot;%02x &quot;
comma
(paren
r_int
r_char
)paren
id|data
(braket
id|cnt
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;[%d/%d].%s[%d]: %s&bslash;n&quot;
comma
id|unit
comma
id|slot
comma
id|info
comma
id|i
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|ippp_push_proto
id|ippp_push_proto
c_func
(paren
r_struct
id|ind_ppp
op_star
id|ind_ppp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
l_int|2
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_COMP_PROT
)paren
op_logical_and
id|proto
op_le
l_int|0xff
)paren
id|put_u8
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
comma
id|proto
)paren
suffix:semicolon
r_else
id|put_u16
c_func
(paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
comma
id|proto
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ippp_push_ac
id|ippp_push_ac
c_func
(paren
r_struct
id|ind_ppp
op_star
id|ind_ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
l_int|2
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_COMP_AC
)paren
r_return
suffix:semicolon
id|p
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_ALLSTATIONS
)paren
suffix:semicolon
id|p
op_add_assign
id|put_u8
c_func
(paren
id|p
comma
id|PPP_UI
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * unbind isdn_net_local &lt;=&gt; ippp-device&n; * note: it can happen, that we hangup/free the master before the slaves&n; *       in this case we bind another lp to the master device&n; */
r_static
r_void
DECL|function|isdn_ppp_unbind
id|isdn_ppp_unbind
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ipppd_debug
c_func
(paren
id|is
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;state
op_ne
id|IPPPD_ST_ASSIGNED
)paren
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
id|is-&gt;state
op_assign
id|IPPPD_ST_OPEN
suffix:semicolon
multiline_comment|/* is-&gt;idev will be invalid shortly */
id|ippp_ccp_free
c_func
(paren
id|ind_ppp-&gt;ccp
)paren
suffix:semicolon
id|is-&gt;idev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* lose the reference we took on isdn_ppp_bind */
id|ipppd_put
c_func
(paren
id|is
)paren
suffix:semicolon
id|ind_ppp-&gt;ipppd
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|ind_ppp
)paren
suffix:semicolon
id|idev-&gt;ind_priv
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * bind isdn_net_local &lt;=&gt; ippp-device&n; */
r_int
DECL|function|isdn_ppp_bind
id|isdn_ppp_bind
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
suffix:semicolon
r_int
id|unit
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;ind_priv
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|ind_ppp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ind_ppp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ind_ppp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;pppbind
OL
l_int|0
)paren
(brace
multiline_comment|/* device not bound to ippp device ? */
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_char
id|exclusive
(braket
id|ISDN_MAX_CHANNELS
)braket
suffix:semicolon
multiline_comment|/* exclusive flags */
id|memset
c_func
(paren
id|exclusive
comma
l_int|0
comma
id|ISDN_MAX_CHANNELS
)paren
suffix:semicolon
multiline_comment|/* step through net devices to find exclusive minors */
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|isdn_net_devs
)paren
(brace
id|isdn_net_dev
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;pppbind
op_ge
l_int|0
op_logical_and
id|p-&gt;pppbind
OL
id|ISDN_MAX_CHANNELS
)paren
id|exclusive
(braket
id|p-&gt;pppbind
)braket
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * search a free device / slot&n;&t;&t; */
id|list_for_each_entry
c_func
(paren
id|ipppd
comma
op_amp
id|ipppds
comma
id|ipppds
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipppd
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;state
op_ne
id|IPPPD_ST_OPEN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|exclusive
(braket
id|ipppd-&gt;minor
)braket
)paren
r_goto
id|found
suffix:semicolon
)brace
)brace
r_else
(brace
id|list_for_each_entry
c_func
(paren
id|ipppd
comma
op_amp
id|ipppds
comma
id|ipppds
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipppd
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;state
op_ne
id|IPPPD_ST_OPEN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;minor
op_eq
id|idev-&gt;pppbind
)paren
r_goto
id|found
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_bind: no ipppd&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ESRCH
suffix:semicolon
r_goto
id|err
suffix:semicolon
id|found
suffix:colon
id|unit
op_assign
id|isdn_ppp_if_get_unit
c_func
(paren
id|idev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* get unit number from interface name .. ugly! */
r_if
c_cond
(paren
id|unit
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp_bind: illegal interface name %s.&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|ipppd-&gt;unit
op_assign
id|unit
suffix:semicolon
id|ipppd-&gt;state
op_assign
id|IPPPD_ST_ASSIGNED
suffix:semicolon
id|ipppd-&gt;idev
op_assign
id|idev
suffix:semicolon
multiline_comment|/* we hold a reference until isdn_ppp_unbind() */
id|ipppd_get
c_func
(paren
id|ipppd
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|idev-&gt;ind_priv
op_assign
id|ind_ppp
suffix:semicolon
id|ind_ppp-&gt;pppcfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* config flags */
id|ind_ppp-&gt;ipppd
op_assign
id|ipppd
suffix:semicolon
id|ind_ppp-&gt;ccp
op_assign
id|ippp_ccp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ind_ppp-&gt;ccp
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ind_ppp-&gt;ccp-&gt;proto
op_assign
id|PPP_COMPFRAG
suffix:semicolon
id|ind_ppp-&gt;ccp-&gt;priv
op_assign
id|idev
suffix:semicolon
id|ind_ppp-&gt;ccp-&gt;alloc_skb
op_assign
id|isdn_ppp_dev_alloc_skb
suffix:semicolon
id|ind_ppp-&gt;ccp-&gt;xmit
op_assign
id|isdn_ppp_dev_xmit
suffix:semicolon
id|ind_ppp-&gt;ccp-&gt;kick_up
op_assign
id|isdn_ppp_dev_kick_up
suffix:semicolon
id|retval
op_assign
id|ippp_mp_bind
c_func
(paren
id|idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|out
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|ipppd-&gt;state
op_assign
id|IPPPD_ST_OPEN
suffix:semicolon
id|ipppd_put
c_func
(paren
id|ipppd
)paren
suffix:semicolon
id|ind_ppp-&gt;ipppd
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|ind_ppp
)paren
suffix:semicolon
id|idev-&gt;ind_priv
op_assign
l_int|NULL
suffix:semicolon
r_return
id|retval
suffix:semicolon
id|err
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ipppds_lock
comma
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ind_ppp
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * kick the ipppd on the device&n; * (wakes up daemon after B-channel connect)&n; */
r_static
r_void
DECL|function|isdn_ppp_connected
id|isdn_ppp_connected
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|ipppd
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|ipppd-&gt;state
op_assign
id|IPPPD_ST_CONNECTED
suffix:semicolon
id|ipppd-&gt;flags
op_or_assign
id|IPPPD_FL_WAKEUP
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ipppd-&gt;wq
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_disconnected
id|isdn_ppp_disconnected
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
id|ipppd_debug
c_func
(paren
id|ipppd
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
id|isdn_net_offline
c_func
(paren
id|idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;state
op_ne
id|IPPPD_ST_CONNECTED
)paren
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
id|ipppd-&gt;state
op_assign
id|IPPPD_ST_ASSIGNED
suffix:semicolon
id|ipppd-&gt;flags
op_or_assign
id|IPPPD_FL_HUP
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ipppd-&gt;wq
)paren
suffix:semicolon
id|ippp_mp_disconnected
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * init memory, structures etc.&n; */
r_int
DECL|function|isdn_ppp_init
id|isdn_ppp_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|isdn_ppp_cleanup
id|isdn_ppp_cleanup
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/*&n; * check for address/control field and skip if allowed&n; * retval != 0 -&gt; discard packet silently&n; */
r_static
r_int
DECL|function|isdn_ppp_skip_ac
id|isdn_ppp_skip_ac
c_func
(paren
r_struct
id|ind_ppp
op_star
id|ind_ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|PPP_ALLSTATIONS
)paren
(brace
multiline_comment|/* if AC compression was not negotiated, but no AC present,&n;&t;&t;   discard packet */
r_if
c_cond
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_REJ_COMP_AC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
op_plus
l_int|1
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|PPP_UI
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* skip address/control (AC) field */
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * get the PPP protocol header and pull skb&n; * retval &lt; 0 -&gt; discard packet silently&n; */
r_int
DECL|function|isdn_ppp_strip_proto
id|isdn_ppp_strip_proto
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
op_star
id|proto
)paren
(brace
id|u8
id|val
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|get_u8
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|0x1
)paren
(brace
multiline_comment|/* protocol field is compressed */
op_star
id|proto
op_assign
id|val
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|get_u16
c_func
(paren
id|skb-&gt;data
comma
id|proto
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * handler for incoming packets on a syncPPP interface&n; */
r_static
r_void
DECL|function|isdn_ppp_receive
id|isdn_ppp_receive
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
id|u16
id|proto
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x4
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ippp_receive: is:%p lp:%p unit:%d len:%d&bslash;n&quot;
comma
id|is
comma
id|lp
comma
id|is-&gt;unit
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;receive&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|is-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdn_ppp_skip_ac
c_func
(paren
id|ind_ppp
comma
id|skb
)paren
OL
l_int|0
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|isdn_ppp_strip_proto
c_func
(paren
id|skb
comma
op_amp
id|proto
)paren
)paren
r_goto
id|err
suffix:semicolon
id|ippp_mp_receive
c_func
(paren
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
r_return
suffix:semicolon
id|err
suffix:colon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * address/control and protocol have been stripped from the skb&n; */
r_void
DECL|function|ippp_receive
id|ippp_receive
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
id|lp-&gt;inl_priv
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|is
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x10
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;push, skb %d %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|proto
)paren
suffix:semicolon
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;rpush&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|256
comma
id|is-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* all packets need to be passed through the compressor */
id|skb
op_assign
id|ippp_ccp_decompress
c_func
(paren
id|inl_ppp-&gt;ccp
comma
id|skb
comma
op_amp
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
multiline_comment|/* decompression error */
r_goto
id|error
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_IPX
suffix:colon
multiline_comment|/* untested */
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IPX&bslash;n&quot;
)paren
suffix:semicolon
id|isdn_netif_rx
c_func
(paren
id|idev
comma
id|skb
comma
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_IP
suffix:colon
r_if
c_cond
(paren
id|is-&gt;debug
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;isdn_ppp: IP&bslash;n&quot;
)paren
suffix:semicolon
id|isdn_netif_rx
c_func
(paren
id|idev
comma
id|skb
comma
id|htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_COMP
suffix:colon
r_case
id|PPP_COMPFRAG
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp: unexpected compressed frame dropped&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
r_case
id|PPP_VJC_UNCOMP
suffix:colon
r_case
id|PPP_VJC_COMP
suffix:colon
id|ippp_vj_decompress
c_func
(paren
id|idev
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_CCPFRAG
suffix:colon
id|ippp_ccp_receive_ccp
c_func
(paren
id|ind_ppp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
r_goto
id|ccp
suffix:semicolon
r_case
id|PPP_CCP
suffix:colon
id|ippp_ccp_receive_ccp
c_func
(paren
id|inl_ppp-&gt;ccp
comma
id|skb
)paren
suffix:semicolon
id|ccp
suffix:colon
multiline_comment|/* Dont pop up ResetReq/Ack stuff to the daemon any&n;&t;&t;&t;   longer - the job is done already */
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_eq
id|CCP_RESETREQ
op_logical_or
id|skb-&gt;data
(braket
l_int|0
)braket
op_eq
id|CCP_RESETACK
)paren
(brace
r_goto
id|free
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_default
suffix:colon
singleline_comment|// FIXME use skb directly
id|ipppd_queue_read
c_func
(paren
id|is
comma
id|proto
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_goto
id|free
suffix:semicolon
)brace
r_return
suffix:semicolon
id|drop
suffix:colon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
id|error
suffix:colon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * send ppp frame .. we expect a PIDCOMPressable proto --&n; *  (here: currently always PPP_IP,PPP_VJC_COMP,PPP_VJC_UNCOMP)&n; *&n; * VJ compression may change skb pointer!!! .. requeue with old&n; * skb isn&squot;t allowed!!&n; */
r_static
r_int
DECL|function|isdn_ppp_start_xmit
id|isdn_ppp_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|ndev-&gt;priv
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
id|mlp-&gt;inl_priv
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
op_assign
id|list_entry
c_func
(paren
id|mlp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|u16
id|proto
op_assign
id|PPP_IP
suffix:semicolon
multiline_comment|/* 0x21 */
r_struct
id|ipppd
op_star
id|ipppd
suffix:semicolon
id|ndev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|mlp-&gt;online
)paren
)paren
r_return
id|isdn_net_autodial
c_func
(paren
id|skb
comma
id|ndev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
id|proto
op_assign
id|PPP_IP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_IPX
suffix:colon
id|proto
op_assign
id|PPP_IPX
suffix:semicolon
multiline_comment|/* untested */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn_ppp: skipped unsupported protocol: %#x.&bslash;n&quot;
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|idev
op_assign
id|isdn_net_get_xmit_dev
c_func
(paren
id|mlp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: IP frame delayed.&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|stop
suffix:semicolon
)brace
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ind_ppp-&gt;pppcfg
op_amp
id|SC_ENABLE_IP
)paren
)paren
(brace
multiline_comment|/* PPP connected ? */
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|stop
suffix:semicolon
)brace
id|ipppd
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
id|idev-&gt;huptimer
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x40
)paren
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit0&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|256
comma
id|ipppd-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* after this line,requeueing is no longer allowed! */
id|skb
op_assign
id|ippp_vj_compress
c_func
(paren
id|idev
comma
id|skb
comma
op_amp
id|proto
)paren
suffix:semicolon
multiline_comment|/* normal (single link) or bundle compression */
id|skb
op_assign
id|ippp_ccp_compress
c_func
(paren
id|inl_ppp-&gt;ccp
comma
id|skb
comma
op_amp
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x40
)paren
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit1&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|ipppd-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|ippp_push_proto
c_func
(paren
id|ind_ppp
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
id|ippp_mp_xmit
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|mlp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|stop
suffix:colon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|ippp_xmit
id|ippp_xmit
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_struct
id|ipppd
op_star
id|ipppd
op_assign
id|ind_ppp-&gt;ipppd
suffix:semicolon
id|ippp_push_ac
c_func
(paren
id|ind_ppp
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipppd-&gt;debug
op_amp
l_int|0x40
)paren
(brace
id|isdn_ppp_frame_log
c_func
(paren
l_string|&quot;xmit3&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_int|32
comma
id|ipppd-&gt;unit
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|isdn_net_writebuf_skb
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * network device ioctl handlers&n; */
r_static
r_int
DECL|function|isdn_ppp_dev_ioctl_stats
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
r_struct
id|ifreq
op_star
id|ifr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ppp_stats
op_star
id|res
comma
id|t
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
id|lp-&gt;inl_priv
suffix:semicolon
r_struct
id|slcompress
op_star
id|slcomp
suffix:semicolon
r_int
id|err
suffix:semicolon
id|res
op_assign
(paren
r_struct
id|ppp_stats
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|res
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* build a temporary stat struct and copy it to user space */
id|memset
c_func
(paren
op_amp
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|t.p.ppp_ipackets
op_assign
id|lp-&gt;stats.rx_packets
suffix:semicolon
id|t.p.ppp_ibytes
op_assign
id|lp-&gt;stats.rx_bytes
suffix:semicolon
id|t.p.ppp_ierrors
op_assign
id|lp-&gt;stats.rx_errors
suffix:semicolon
id|t.p.ppp_opackets
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
id|t.p.ppp_obytes
op_assign
id|lp-&gt;stats.tx_bytes
suffix:semicolon
id|t.p.ppp_oerrors
op_assign
id|lp-&gt;stats.tx_errors
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP_VJ
id|slcomp
op_assign
id|inl_ppp-&gt;slcomp
suffix:semicolon
r_if
c_cond
(paren
id|slcomp
)paren
(brace
id|t.vj.vjs_packets
op_assign
id|slcomp-&gt;sls_o_compressed
op_plus
id|slcomp-&gt;sls_o_uncompressed
suffix:semicolon
id|t.vj.vjs_compressed
op_assign
id|slcomp-&gt;sls_o_compressed
suffix:semicolon
id|t.vj.vjs_searches
op_assign
id|slcomp-&gt;sls_o_searches
suffix:semicolon
id|t.vj.vjs_misses
op_assign
id|slcomp-&gt;sls_o_misses
suffix:semicolon
id|t.vj.vjs_errorin
op_assign
id|slcomp-&gt;sls_i_error
suffix:semicolon
id|t.vj.vjs_tossed
op_assign
id|slcomp-&gt;sls_i_tossed
suffix:semicolon
id|t.vj.vjs_uncompressedin
op_assign
id|slcomp-&gt;sls_i_uncompressed
suffix:semicolon
id|t.vj.vjs_compressedin
op_assign
id|slcomp-&gt;sls_i_compressed
suffix:semicolon
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|res
comma
op_amp
id|t
comma
r_sizeof
(paren
r_struct
id|ppp_stats
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|isdn_ppp_dev_ioctl
id|isdn_ppp_dev_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|r
suffix:semicolon
r_int
id|len
suffix:semicolon
id|isdn_net_local
op_star
id|lp
op_assign
(paren
id|isdn_net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_ne
id|ISDN_NET_ENCAP_SYNCPPP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGPPPVER
suffix:colon
id|r
op_assign
(paren
r_char
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|PPP_VERSION
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|r
comma
id|PPP_VERSION
comma
id|len
)paren
)paren
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGPPPSTATS
suffix:colon
id|error
op_assign
id|isdn_ppp_dev_ioctl_stats
c_func
(paren
id|ifr
comma
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ppp_if_get_unit
id|isdn_ppp_if_get_unit
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_int
id|len
comma
id|i
comma
id|unit
op_assign
l_int|0
comma
id|deci
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;ippp&quot;
comma
id|name
comma
l_int|4
)paren
op_logical_or
id|len
OG
l_int|8
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|deci
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
comma
id|deci
op_mul_assign
l_int|10
)paren
(brace
r_char
id|a
op_assign
id|name
(braket
id|len
op_minus
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ge
l_char|&squot;0&squot;
op_logical_and
id|a
op_le
l_char|&squot;9&squot;
)paren
id|unit
op_add_assign
(paren
id|a
op_minus
l_char|&squot;0&squot;
)paren
op_star
id|deci
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_or
id|len
op_minus
id|i
op_ne
l_int|4
)paren
id|unit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|unit
suffix:semicolon
)brace
multiline_comment|/*&n; * PPP compression stuff&n; */
multiline_comment|/* Push an empty CCP Data Frame up to the daemon to wake it up and let it&n;   generate a CCP Reset-Request or tear down CCP altogether */
DECL|function|isdn_ppp_dev_kick_up
r_static
r_void
id|isdn_ppp_dev_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|ipppd_queue_read
c_func
(paren
id|ind_ppp-&gt;ipppd
comma
id|PPP_COMPFRAG
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|isdn_ppp_lp_kick_up
r_static
r_void
id|isdn_ppp_lp_kick_up
c_func
(paren
r_void
op_star
id|priv
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|ipppd_queue_read
c_func
(paren
id|ind_ppp-&gt;ipppd
comma
id|PPP_COMP
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Send a CCP Reset-Request or Reset-Ack directly from the kernel. */
r_static
r_struct
id|sk_buff
op_star
DECL|function|__isdn_ppp_alloc_skb
id|__isdn_ppp_alloc_skb
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_int
id|len
comma
r_int
r_int
id|gfp_mask
)paren
(brace
r_int
id|hl
op_assign
id|IPPP_MAX_HEADER
op_plus
id|isdn_slot_hdrlen
c_func
(paren
id|idev-&gt;isdn_slot
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|hl
op_plus
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|NULL
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
r_struct
id|sk_buff
op_star
DECL|function|isdn_ppp_dev_alloc_skb
id|isdn_ppp_dev_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
r_return
id|__isdn_ppp_alloc_skb
c_func
(paren
id|idev
comma
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|isdn_ppp_lp_alloc_skb
id|isdn_ppp_lp_alloc_skb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
id|len
comma
r_int
id|gfp_mask
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
r_return
id|__isdn_ppp_alloc_skb
c_func
(paren
id|idev
comma
id|len
comma
id|gfp_mask
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_dev_xmit
id|isdn_ppp_dev_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|priv
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|ippp_push_proto
c_func
(paren
id|ind_ppp
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
id|ippp_push_ac
c_func
(paren
id|ind_ppp
comma
id|skb
)paren
suffix:semicolon
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_lp_xmit
id|isdn_ppp_lp_xmit
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|proto
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|priv
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|lp-&gt;online
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|lp-&gt;online.next
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
id|ippp_push_proto
c_func
(paren
id|ind_ppp
comma
id|skb
comma
id|proto
)paren
suffix:semicolon
id|ippp_push_ac
c_func
(paren
id|ind_ppp
comma
id|skb
)paren
suffix:semicolon
id|isdn_net_write_super
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ppp_set_compressor
id|isdn_ppp_set_compressor
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_struct
id|isdn_ppp_comp_data
op_star
id|data
)paren
(brace
r_struct
id|ippp_ccp
op_star
id|ccp
suffix:semicolon
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
id|idev-&gt;mlp-&gt;inl_priv
suffix:semicolon
r_struct
id|ind_ppp
op_star
id|ind_ppp
op_assign
id|idev-&gt;ind_priv
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;flags
op_amp
id|IPPP_COMP_FLAG_LINK
)paren
id|ccp
op_assign
id|ind_ppp-&gt;ccp
suffix:semicolon
r_else
id|ccp
op_assign
id|inl_ppp-&gt;ccp
suffix:semicolon
r_return
id|ippp_ccp_set_compressor
c_func
(paren
id|ccp
comma
id|ind_ppp-&gt;ipppd-&gt;unit
comma
id|data
)paren
suffix:semicolon
)brace
singleline_comment|// ISDN_NET_ENCAP_SYNCPPP
singleline_comment|// ======================================================================
r_static
r_int
DECL|function|isdn_ppp_open
id|isdn_ppp_open
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|inl_ppp
op_star
id|inl_ppp
suffix:semicolon
id|inl_ppp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|inl_ppp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inl_ppp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|lp-&gt;inl_priv
op_assign
id|inl_ppp
suffix:semicolon
id|inl_ppp-&gt;slcomp
op_assign
id|ippp_vj_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inl_ppp-&gt;slcomp
)paren
r_goto
id|err
suffix:semicolon
id|inl_ppp-&gt;ccp
op_assign
id|ippp_ccp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inl_ppp-&gt;ccp
)paren
r_goto
id|err_vj
suffix:semicolon
id|inl_ppp-&gt;ccp-&gt;proto
op_assign
id|PPP_COMP
suffix:semicolon
id|inl_ppp-&gt;ccp-&gt;priv
op_assign
id|lp
suffix:semicolon
id|inl_ppp-&gt;ccp-&gt;alloc_skb
op_assign
id|isdn_ppp_lp_alloc_skb
suffix:semicolon
id|inl_ppp-&gt;ccp-&gt;xmit
op_assign
id|isdn_ppp_lp_xmit
suffix:semicolon
id|inl_ppp-&gt;ccp-&gt;kick_up
op_assign
id|isdn_ppp_lp_kick_up
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_vj
suffix:colon
id|ippp_vj_free
c_func
(paren
id|inl_ppp-&gt;slcomp
)paren
suffix:semicolon
id|err
suffix:colon
id|kfree
c_func
(paren
id|inl_ppp
)paren
suffix:semicolon
id|lp-&gt;inl_priv
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_ppp_close
id|isdn_ppp_close
c_func
(paren
id|isdn_net_local
op_star
id|lp
)paren
(brace
r_struct
id|inl_ppp
op_star
id|inl_ppp
op_assign
id|lp-&gt;inl_priv
suffix:semicolon
id|ippp_ccp_free
c_func
(paren
id|inl_ppp-&gt;ccp
)paren
suffix:semicolon
id|ippp_vj_free
c_func
(paren
id|inl_ppp-&gt;slcomp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|inl_ppp
)paren
suffix:semicolon
id|lp-&gt;inl_priv
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|isdn_ppp_ops
r_struct
id|isdn_netif_ops
id|isdn_ppp_ops
op_assign
(brace
dot
id|hard_start_xmit
op_assign
id|isdn_ppp_start_xmit
comma
dot
id|do_ioctl
op_assign
id|isdn_ppp_dev_ioctl
comma
dot
id|flags
op_assign
id|IFF_NOARP
op_or
id|IFF_POINTOPOINT
comma
dot
id|type
op_assign
id|ARPHRD_PPP
comma
dot
id|receive
op_assign
id|isdn_ppp_receive
comma
dot
id|connected
op_assign
id|isdn_ppp_connected
comma
dot
id|disconnected
op_assign
id|isdn_ppp_disconnected
comma
dot
id|bind
op_assign
id|isdn_ppp_bind
comma
dot
id|unbind
op_assign
id|isdn_ppp_unbind
comma
dot
id|open
op_assign
id|isdn_ppp_open
comma
dot
id|close
op_assign
id|isdn_ppp_close
comma
)brace
suffix:semicolon
eof
