multiline_comment|/*&n; * Linux ISDN subsystem, Network interface configuration&n; *&n; * Copyright 1994-1998  by Fritz Elfert (fritz@isdn4linux.de)&n; *           1995,96    by Thinking Objects Software GmbH Wuerzburg&n; *           1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *           1999-2002  by Kai Germaschewski &lt;kai@germaschewski.name&gt;&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
DECL|macro|ISDN_NET_TX_TIMEOUT
mdefine_line|#define ISDN_NET_TX_TIMEOUT (20*HZ) 
multiline_comment|/* All of this configuration code is globally serialized */
r_static
id|DECLARE_MUTEX
c_func
(paren
id|sem
)paren
suffix:semicolon
DECL|variable|isdn_net_devs
id|LIST_HEAD
c_func
(paren
id|isdn_net_devs
)paren
suffix:semicolon
multiline_comment|/* Linked list of isdn_net_dev&squot;s */
singleline_comment|// FIXME static
r_int
id|isdn_net_handle_event
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
multiline_comment|/* FIXME */
r_static
r_void
id|isdn_net_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|isdn_net_dial_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|isdn_net_hup_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_int
id|isdn_init_netif
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
suffix:semicolon
multiline_comment|/* ====================================================================== */
multiline_comment|/* Registration of ISDN network interface types                           */
multiline_comment|/* ====================================================================== */
DECL|variable|isdn_netif_ops
r_static
r_struct
id|isdn_netif_ops
op_star
id|isdn_netif_ops
(braket
id|ISDN_NET_ENCAP_NR
)braket
suffix:semicolon
r_int
DECL|function|register_isdn_netif
id|register_isdn_netif
c_func
(paren
r_int
id|encap
comma
r_struct
id|isdn_netif_ops
op_star
id|ops
)paren
(brace
r_if
c_cond
(paren
id|encap
OL
l_int|0
op_logical_or
id|encap
op_ge
id|ISDN_NET_ENCAP_NR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|isdn_netif_ops
(braket
id|encap
)braket
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|isdn_netif_ops
(braket
id|encap
)braket
op_assign
id|ops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* Helpers                                                                */
multiline_comment|/* ====================================================================== */
multiline_comment|/* Search list of net-interfaces for an interface with given name. */
r_static
id|isdn_net_dev
op_star
DECL|function|isdn_net_findif
id|isdn_net_findif
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|idev
comma
op_amp
id|isdn_net_devs
comma
id|global_list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|idev-&gt;name
comma
id|name
)paren
)paren
r_return
id|idev
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Set up a certain encapsulation */
r_static
r_int
DECL|function|isdn_net_set_encap
id|isdn_net_set_encap
c_func
(paren
id|isdn_net_local
op_star
id|lp
comma
r_int
id|encap
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;p_encap
op_eq
id|encap
)paren
(brace
multiline_comment|/* nothing to do */
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|lp-&gt;dev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;ops
op_logical_and
id|lp-&gt;ops-&gt;cleanup
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|cleanup
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|encap
OL
l_int|0
op_logical_or
id|encap
op_ge
id|ISDN_NET_ENCAP_NR
)paren
(brace
id|lp-&gt;p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|lp-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|lp-&gt;p_encap
op_assign
id|encap
suffix:semicolon
id|lp-&gt;ops
op_assign
id|isdn_netif_ops
(braket
id|encap
)braket
suffix:semicolon
id|lp-&gt;dev.hard_start_xmit
op_assign
id|lp-&gt;ops-&gt;hard_start_xmit
suffix:semicolon
id|lp-&gt;dev.hard_header
op_assign
id|lp-&gt;ops-&gt;hard_header
suffix:semicolon
id|lp-&gt;dev.do_ioctl
op_assign
id|lp-&gt;ops-&gt;do_ioctl
suffix:semicolon
id|lp-&gt;dev.flags
op_assign
id|lp-&gt;ops-&gt;flags
suffix:semicolon
id|lp-&gt;dev.type
op_assign
id|lp-&gt;ops-&gt;type
suffix:semicolon
id|lp-&gt;dev.addr_len
op_assign
id|lp-&gt;ops-&gt;addr_len
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;init
)paren
id|retval
op_assign
id|lp-&gt;ops
op_member_access_from_pointer
id|init
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|lp-&gt;p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|lp-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_net_bind
id|isdn_net_bind
c_func
(paren
id|isdn_net_dev
op_star
id|idev
comma
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
r_int
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|chidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_char
id|drvid
(braket
l_int|25
)braket
suffix:semicolon
id|strncpy
c_func
(paren
id|drvid
comma
id|cfg-&gt;drvid
comma
l_int|24
)paren
suffix:semicolon
id|drvid
(braket
l_int|24
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;exclusive
op_logical_and
op_logical_neg
id|strlen
c_func
(paren
id|drvid
)paren
)paren
(brace
multiline_comment|/* If we want to bind exclusively, need to specify drv/chan */
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|drvid
)paren
)paren
(brace
multiline_comment|/* A bind has been requested ... */
r_char
op_star
id|c
op_assign
id|strchr
c_func
(paren
id|drvid
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* The channel-number is appended to the driver-Id with a comma */
op_star
id|c
op_assign
l_int|0
suffix:semicolon
id|chidx
op_assign
id|simple_strtol
c_func
(paren
id|c
op_plus
l_int|1
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Lookup driver-Id in array */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|drvid
)paren
)paren
(brace
id|drvidx
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
op_logical_or
id|chidx
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Either driver-Id or channel-number invalid */
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cfg-&gt;exclusive
op_eq
(paren
id|idev-&gt;exclusive
op_ge
l_int|0
)paren
op_logical_and
id|drvidx
op_eq
id|idev-&gt;pre_device
op_logical_and
id|chidx
op_eq
id|idev-&gt;pre_channel
)paren
(brace
multiline_comment|/* no change */
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idev-&gt;exclusive
op_ge
l_int|0
)paren
(brace
id|isdn_unexclusive_channel
c_func
(paren
id|idev-&gt;pre_device
comma
id|idev-&gt;pre_channel
)paren
suffix:semicolon
id|isdn_free_channel
c_func
(paren
id|idev-&gt;pre_device
comma
id|idev-&gt;pre_channel
comma
id|ISDN_USAGE_NET
)paren
suffix:semicolon
id|idev-&gt;exclusive
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cfg-&gt;exclusive
)paren
(brace
multiline_comment|/* If binding is exclusive, try to grab the channel */
id|idev-&gt;exclusive
op_assign
id|isdn_get_free_slot
c_func
(paren
id|ISDN_USAGE_NET
comma
id|mlp-&gt;l2_proto
comma
id|mlp-&gt;l3_proto
comma
id|drvidx
comma
id|chidx
comma
id|cfg-&gt;eaz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;exclusive
OL
l_int|0
)paren
(brace
multiline_comment|/* Grab failed, because desired channel is in use */
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* All went ok, so update isdninfo */
id|isdn_slot_set_usage
c_func
(paren
id|idev-&gt;exclusive
comma
id|ISDN_USAGE_EXCLUSIVE
)paren
suffix:semicolon
)brace
id|idev-&gt;pre_device
op_assign
id|drvidx
suffix:semicolon
id|idev-&gt;pre_channel
op_assign
id|chidx
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete all phone-numbers of an interface.&n; */
r_static
r_void
DECL|function|isdn_net_rmallphone
id|isdn_net_rmallphone
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|mlp-&gt;phone
(braket
id|i
)braket
)paren
)paren
(brace
id|n
op_assign
id|list_entry
c_func
(paren
id|mlp-&gt;phone
(braket
id|i
)braket
dot
id|next
comma
r_struct
id|isdn_net_phone
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|n-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* /dev/isdnctrl net ioctl interface                                      */
multiline_comment|/* ====================================================================== */
multiline_comment|/*&n; * Allocate a new network-interface and initialize its data structures&n; */
r_static
r_int
DECL|function|isdn_net_addif
id|isdn_net_addif
c_func
(paren
r_char
op_star
id|name
comma
id|isdn_net_local
op_star
id|mlp
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
multiline_comment|/* Avoid creating an existing interface */
r_if
c_cond
(paren
id|isdn_net_findif
c_func
(paren
id|name
)paren
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
id|idev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|idev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|idev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|idev
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|idev-&gt;name
comma
id|name
)paren
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|idev-&gt;tlet
comma
id|isdn_net_tasklet
comma
(paren
r_int
r_int
)paren
id|idev
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|idev-&gt;super_tx_queue
)paren
suffix:semicolon
id|idev-&gt;isdn_slot
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;pre_device
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;pre_channel
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;exclusive
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;ppp_slot
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;pppbind
op_assign
op_minus
l_int|1
suffix:semicolon
id|idev-&gt;dialstarted
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Jiffies of last dial-start */
id|idev-&gt;dialwait_timer
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Jiffies of earliest next dial-start */
id|init_timer
c_func
(paren
op_amp
id|idev-&gt;dial_timer
)paren
suffix:semicolon
id|idev-&gt;dial_timer.data
op_assign
(paren
r_int
r_int
)paren
id|idev
suffix:semicolon
id|idev-&gt;dial_timer.function
op_assign
id|isdn_net_dial_timer
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|idev-&gt;hup_timer
)paren
suffix:semicolon
id|idev-&gt;hup_timer.data
op_assign
(paren
r_int
r_int
)paren
id|idev
suffix:semicolon
id|idev-&gt;hup_timer.function
op_assign
id|isdn_net_hup_timer
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mlp
)paren
(brace
multiline_comment|/* Device shall be a master */
id|mlp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|mlp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mlp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|mlp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|mlp
)paren
)paren
suffix:semicolon
id|mlp-&gt;magic
op_assign
id|ISDN_NET_MAGIC
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mlp-&gt;slaves
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mlp-&gt;online
)paren
suffix:semicolon
id|mlp-&gt;p_encap
op_assign
op_minus
l_int|1
suffix:semicolon
id|isdn_net_set_encap
c_func
(paren
id|mlp
comma
id|ISDN_NET_ENCAP_RAWIP
)paren
suffix:semicolon
id|mlp-&gt;l2_proto
op_assign
id|ISDN_PROTO_L2_X75I
suffix:semicolon
id|mlp-&gt;l3_proto
op_assign
id|ISDN_PROTO_L3_TRANS
suffix:semicolon
id|mlp-&gt;triggercps
op_assign
l_int|6000
suffix:semicolon
id|mlp-&gt;slavedelay
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
id|mlp-&gt;hupflags
op_assign
id|ISDN_INHUP
suffix:semicolon
id|mlp-&gt;onhtime
op_assign
l_int|10
suffix:semicolon
id|mlp-&gt;dialmax
op_assign
l_int|1
suffix:semicolon
id|mlp-&gt;flags
op_assign
id|ISDN_NET_CBHUP
op_or
id|ISDN_NET_DM_MANUAL
suffix:semicolon
id|mlp-&gt;cbdelay
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Wait 5 secs before Callback */
id|mlp-&gt;dialtimeout
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Infinite Dial-Timeout */
id|mlp-&gt;dialwait
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* Wait 5 sec. after failed dial */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mlp-&gt;phone
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|mlp-&gt;phone
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|dev
op_assign
op_amp
id|mlp-&gt;dev
suffix:semicolon
)brace
id|idev-&gt;mlp
op_assign
id|mlp
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|idev-&gt;slaves
comma
op_amp
id|mlp-&gt;slaves
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|strcpy
c_func
(paren
id|dev-&gt;name
comma
id|name
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|mlp
suffix:semicolon
id|dev-&gt;init
op_assign
id|isdn_init_netif
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|retval
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|kfree
c_func
(paren
id|mlp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
id|list_add
c_func
(paren
op_amp
id|idev-&gt;global_list
comma
op_amp
id|isdn_net_devs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a new slave interface to an existing one&n; */
r_static
r_int
DECL|function|isdn_net_addslave
id|isdn_net_addslave
c_func
(paren
r_char
op_star
id|parm
)paren
(brace
r_char
op_star
id|p
op_assign
id|strchr
c_func
(paren
id|parm
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
suffix:semicolon
r_int
id|retval
suffix:semicolon
multiline_comment|/* get slave name */
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
id|p
(braket
l_int|1
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* find master */
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|mlp-&gt;dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|retval
op_assign
id|isdn_net_addif
c_func
(paren
id|p
comma
id|mlp
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete a single network-interface&n; */
r_static
r_int
DECL|function|isdn_net_dev_delete
id|isdn_net_dev_delete
c_func
(paren
id|isdn_net_dev
op_star
id|idev
)paren
(brace
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|mlp-&gt;dev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|unlock
suffix:semicolon
)brace
id|isdn_net_set_encap
c_func
(paren
id|mlp
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|isdn_net_rmallphone
c_func
(paren
id|idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;exclusive
op_ge
l_int|0
)paren
id|isdn_unexclusive_channel
c_func
(paren
id|idev-&gt;pre_device
comma
id|idev-&gt;pre_channel
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|idev-&gt;slaves
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|mlp-&gt;slaves
)paren
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|mlp-&gt;dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mlp
)paren
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|idev-&gt;global_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|unlock
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete a single network-interface&n; */
r_static
r_int
DECL|function|isdn_net_delif
id|isdn_net_delif
c_func
(paren
r_char
op_star
id|name
)paren
(brace
multiline_comment|/* FIXME: For compatibility, if a master isdn_net_dev is rm&squot;ed,&n;&t; * kill all slaves, too */
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|isdn_net_dev_delete
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set interface-parameters.&n; * Always set all parameters, so the user-level application is responsible&n; * for not overwriting existing setups. It has to get the current&n; * setup first, if only selected parameters are to be changed.&n; */
r_static
r_int
DECL|function|isdn_net_setcfg
id|isdn_net_setcfg
c_func
(paren
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|cfg-&gt;name
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
suffix:semicolon
id|ulong
id|features
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|mlp-&gt;dev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* See if any registered driver supports the features we want */
id|features
op_assign
(paren
(paren
l_int|1
op_lshift
id|cfg-&gt;l2_proto
)paren
op_lshift
id|ISDN_FEATURE_L2_SHIFT
)paren
op_or
(paren
(paren
l_int|1
op_lshift
id|cfg-&gt;l3_proto
)paren
op_lshift
id|ISDN_FEATURE_L3_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;drv
(braket
id|i
)braket
op_logical_and
(paren
id|dev-&gt;drv
(braket
id|i
)braket
op_member_access_from_pointer
id|interface-&gt;features
op_amp
id|features
)paren
op_eq
id|features
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|ISDN_MAX_DRIVERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_net: No driver with selected features&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_set_encap
c_func
(paren
id|mlp
comma
id|cfg-&gt;p_encap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|out
suffix:semicolon
id|retval
op_assign
id|isdn_net_bind
c_func
(paren
id|idev
comma
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|out
suffix:semicolon
id|strncpy
c_func
(paren
id|mlp-&gt;msn
comma
id|cfg-&gt;eaz
comma
id|ISDN_MSNLEN
op_minus
l_int|1
)paren
suffix:semicolon
id|mlp-&gt;msn
(braket
id|ISDN_MSNLEN
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|mlp-&gt;onhtime
op_assign
id|cfg-&gt;onhtime
suffix:semicolon
id|idev-&gt;charge
op_assign
id|cfg-&gt;charge
suffix:semicolon
id|mlp-&gt;l2_proto
op_assign
id|cfg-&gt;l2_proto
suffix:semicolon
id|mlp-&gt;l3_proto
op_assign
id|cfg-&gt;l3_proto
suffix:semicolon
id|mlp-&gt;cbdelay
op_assign
id|cfg-&gt;cbdelay
op_star
id|HZ
op_div
l_int|5
suffix:semicolon
id|mlp-&gt;dialmax
op_assign
id|cfg-&gt;dialmax
suffix:semicolon
id|mlp-&gt;triggercps
op_assign
id|cfg-&gt;triggercps
suffix:semicolon
id|mlp-&gt;slavedelay
op_assign
id|cfg-&gt;slavedelay
op_star
id|HZ
suffix:semicolon
id|idev-&gt;pppbind
op_assign
id|cfg-&gt;pppbind
suffix:semicolon
id|mlp-&gt;dialtimeout
op_assign
id|cfg-&gt;dialtimeout
op_ge
l_int|0
ques
c_cond
id|cfg-&gt;dialtimeout
op_star
id|HZ
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|mlp-&gt;dialwait
op_assign
id|cfg-&gt;dialwait
op_star
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;secure
)paren
id|mlp-&gt;flags
op_or_assign
id|ISDN_NET_SECURE
suffix:semicolon
r_else
id|mlp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_SECURE
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;cbhup
)paren
id|mlp-&gt;flags
op_or_assign
id|ISDN_NET_CBHUP
suffix:semicolon
r_else
id|mlp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CBHUP
suffix:semicolon
r_switch
c_cond
(paren
id|cfg-&gt;callback
)paren
(brace
r_case
l_int|0
suffix:colon
id|mlp-&gt;flags
op_and_assign
op_complement
(paren
id|ISDN_NET_CALLBACK
op_or
id|ISDN_NET_CBOUT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|mlp-&gt;flags
op_or_assign
id|ISDN_NET_CALLBACK
suffix:semicolon
id|mlp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CBOUT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|mlp-&gt;flags
op_or_assign
id|ISDN_NET_CBOUT
suffix:semicolon
id|mlp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_CALLBACK
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mlp-&gt;flags
op_and_assign
op_complement
id|ISDN_NET_DIALMODE_MASK
suffix:semicolon
multiline_comment|/* first all bits off */
r_if
c_cond
(paren
id|cfg-&gt;dialmode
op_logical_and
op_logical_neg
(paren
id|cfg-&gt;dialmode
op_amp
id|ISDN_NET_DIALMODE_MASK
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|mlp-&gt;flags
op_or_assign
id|cfg-&gt;dialmode
suffix:semicolon
multiline_comment|/* turn on selected bits */
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_DM_OFF
)paren
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;chargehup
)paren
id|mlp-&gt;hupflags
op_or_assign
id|ISDN_CHARGEHUP
suffix:semicolon
r_else
id|mlp-&gt;hupflags
op_and_assign
op_complement
id|ISDN_CHARGEHUP
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;ihup
)paren
id|mlp-&gt;hupflags
op_or_assign
id|ISDN_INHUP
suffix:semicolon
r_else
id|mlp-&gt;hupflags
op_and_assign
op_complement
id|ISDN_INHUP
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;chargeint
OG
l_int|10
)paren
(brace
id|idev-&gt;chargeint
op_assign
id|cfg-&gt;chargeint
op_star
id|HZ
suffix:semicolon
id|idev-&gt;charge_state
op_assign
id|ST_CHARGE_HAVE_CINT
suffix:semicolon
id|mlp-&gt;hupflags
op_or_assign
id|ISDN_MANCHARGE
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform get-interface-parameters.ioctl&n; */
r_static
r_int
DECL|function|isdn_net_getcfg
id|isdn_net_getcfg
c_func
(paren
id|isdn_net_ioctl_cfg
op_star
id|cfg
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|cfg-&gt;name
)paren
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
id|strcpy
c_func
(paren
id|cfg-&gt;eaz
comma
id|mlp-&gt;msn
)paren
suffix:semicolon
id|cfg-&gt;exclusive
op_assign
id|idev-&gt;exclusive
op_ge
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;pre_device
op_ge
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|cfg-&gt;drvid
comma
l_string|&quot;%s,%d&quot;
comma
id|dev-&gt;drvid
(braket
id|idev-&gt;pre_device
)braket
comma
id|idev-&gt;pre_channel
)paren
suffix:semicolon
)brace
r_else
(brace
id|cfg-&gt;drvid
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|cfg-&gt;onhtime
op_assign
id|mlp-&gt;onhtime
suffix:semicolon
id|cfg-&gt;charge
op_assign
id|idev-&gt;charge
suffix:semicolon
id|cfg-&gt;l2_proto
op_assign
id|mlp-&gt;l2_proto
suffix:semicolon
id|cfg-&gt;l3_proto
op_assign
id|mlp-&gt;l3_proto
suffix:semicolon
id|cfg-&gt;p_encap
op_assign
id|mlp-&gt;p_encap
suffix:semicolon
id|cfg-&gt;secure
op_assign
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_SECURE
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;callback
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CALLBACK
)paren
id|cfg-&gt;callback
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CBOUT
)paren
id|cfg-&gt;callback
op_assign
l_int|2
suffix:semicolon
id|cfg-&gt;cbhup
op_assign
(paren
id|mlp-&gt;flags
op_amp
id|ISDN_NET_CBHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;dialmode
op_assign
id|mlp-&gt;flags
op_amp
id|ISDN_NET_DIALMODE_MASK
suffix:semicolon
id|cfg-&gt;chargehup
op_assign
(paren
id|mlp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;ihup
op_assign
(paren
id|mlp-&gt;hupflags
op_amp
id|ISDN_INHUP
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;cbdelay
op_assign
id|mlp-&gt;cbdelay
op_star
l_int|5
op_div
id|HZ
suffix:semicolon
id|cfg-&gt;dialmax
op_assign
id|mlp-&gt;dialmax
suffix:semicolon
id|cfg-&gt;triggercps
op_assign
id|mlp-&gt;triggercps
suffix:semicolon
id|cfg-&gt;slavedelay
op_assign
id|mlp-&gt;slavedelay
op_div
id|HZ
suffix:semicolon
id|cfg-&gt;chargeint
op_assign
(paren
id|mlp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
ques
c_cond
(paren
id|idev-&gt;chargeint
op_div
id|HZ
)paren
suffix:colon
l_int|0
suffix:semicolon
id|cfg-&gt;pppbind
op_assign
id|idev-&gt;pppbind
suffix:semicolon
id|cfg-&gt;dialtimeout
op_assign
id|mlp-&gt;dialtimeout
op_ge
l_int|0
ques
c_cond
id|mlp-&gt;dialtimeout
op_div
id|HZ
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|cfg-&gt;dialwait
op_assign
id|mlp-&gt;dialwait
op_div
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;slaves.next
op_ne
op_amp
id|mlp-&gt;slaves
)paren
id|strcpy
c_func
(paren
id|cfg-&gt;slave
comma
id|list_entry
c_func
(paren
id|idev-&gt;slaves.next
comma
id|isdn_net_dev
comma
id|slaves
)paren
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_else
id|cfg-&gt;slave
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|mlp-&gt;dev.name
comma
id|idev-&gt;name
)paren
)paren
id|strcpy
c_func
(paren
id|cfg-&gt;master
comma
id|mlp-&gt;dev.name
)paren
suffix:semicolon
r_else
id|cfg-&gt;master
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a phone-number to an interface.&n; */
r_static
r_int
DECL|function|isdn_net_addphone
id|isdn_net_addphone
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|idev-&gt;mlp-&gt;dev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|n
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|n
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|n-&gt;num
comma
id|phone-&gt;phone
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|n-&gt;list
comma
op_amp
id|idev-&gt;mlp-&gt;phone
(braket
id|phone-&gt;outgoing
op_amp
l_int|1
)braket
)paren
suffix:semicolon
id|out
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete a phone-number from an interface.&n; */
r_static
r_int
DECL|function|isdn_net_delphone
id|isdn_net_delphone
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
op_amp
id|idev-&gt;mlp-&gt;dev
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|idev-&gt;mlp-&gt;phone
(braket
id|phone-&gt;outgoing
op_amp
l_int|1
)braket
comma
id|list
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|n-&gt;num
comma
id|phone-&gt;phone
)paren
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|n-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|n
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Copy a string of all phone-numbers of an interface to user space.&n; */
r_static
r_int
DECL|function|isdn_net_getphone
id|isdn_net_getphone
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
comma
r_char
op_star
id|phones
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|buf
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_struct
id|isdn_net_phone
op_star
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
(brace
id|count
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|free
suffix:semicolon
)brace
id|list_for_each_entry
c_func
(paren
id|n
comma
op_amp
id|idev-&gt;mlp-&gt;phone
(braket
id|phone-&gt;outgoing
op_amp
l_int|1
)braket
comma
id|list
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|buf
(braket
id|count
)braket
comma
id|n-&gt;num
)paren
suffix:semicolon
id|count
op_add_assign
id|strlen
c_func
(paren
id|n-&gt;num
)paren
suffix:semicolon
id|buf
(braket
id|count
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|PAGE_SIZE
op_minus
id|ISDN_MSNLEN
op_minus
l_int|1
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
multiline_comment|/* list was empty? */
id|count
op_increment
suffix:semicolon
id|buf
(braket
id|count
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|phones
comma
id|buf
comma
id|count
)paren
)paren
id|count
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|free
suffix:colon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * Force a net-interface to dial out.&n; */
r_static
r_int
DECL|function|isdn_net_dial
id|isdn_net_dial
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|isdn_net_dev_dial
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Force a hangup of a network-interface.&n; */
r_static
r_int
DECL|function|isdn_net_force_hangup
id|isdn_net_force_hangup
c_func
(paren
r_char
op_star
id|name
)paren
singleline_comment|// FIXME rename?
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|name
)paren
suffix:semicolon
id|isdn_net_dev
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;isdn_slot
OL
l_int|0
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|p
op_assign
id|idev-&gt;slave
suffix:semicolon
multiline_comment|/* If this interface has slaves, do a hangup for them also. */
r_while
c_loop
(paren
id|p
)paren
(brace
id|isdn_net_hangup
c_func
(paren
id|p
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;slave
suffix:semicolon
)brace
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Copy a string containing the peer&squot;s phone number of a connected interface&n; * to user space.&n; */
r_static
r_int
DECL|function|isdn_net_getpeer
id|isdn_net_getpeer
c_func
(paren
id|isdn_net_ioctl_phone
op_star
id|phone
comma
id|isdn_net_ioctl_phone
op_star
id|peer
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
id|isdn_net_findif
c_func
(paren
id|phone-&gt;name
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* FIXME&n;&t; * Theoretical race: while this executes, the remote number might&n;&t; * become invalid (hang up) or change (new connection), resulting&n;         * in (partially) wrong number copied to user. This race&n;&t; * currently ignored.&n;&t; */
id|idx
op_assign
id|idev-&gt;isdn_slot
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
multiline_comment|/* for pre-bound channels, we need this extra check */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|isdn_slot_num
c_func
(paren
id|idx
)paren
comma
l_string|&quot;???&quot;
comma
l_int|3
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|strncpy
c_func
(paren
id|phone-&gt;phone
comma
id|isdn_slot_num
c_func
(paren
id|idx
)paren
comma
id|ISDN_MSNLEN
)paren
suffix:semicolon
id|phone-&gt;outgoing
op_assign
id|USG_OUTGOING
c_func
(paren
id|isdn_slot_usage
c_func
(paren
id|idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|peer
comma
id|phone
comma
r_sizeof
(paren
op_star
id|peer
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ioctl on /dev/isdnctrl, used to configure ISDN net interfaces &n; */
r_int
DECL|function|isdn_net_ioctl
id|isdn_net_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
comma
id|uint
id|cmd
comma
id|ulong
id|arg
)paren
(brace
multiline_comment|/* Save stack space */
r_union
(brace
r_char
id|name
(braket
l_int|10
)braket
suffix:semicolon
r_char
id|bname
(braket
l_int|20
)braket
suffix:semicolon
id|isdn_net_ioctl_phone
id|phone
suffix:semicolon
id|isdn_net_ioctl_cfg
id|cfg
suffix:semicolon
)brace
id|iocpar
suffix:semicolon
r_int
id|retval
suffix:semicolon
DECL|macro|name
mdefine_line|#define name  iocpar.name
DECL|macro|bname
mdefine_line|#define bname iocpar.bname
DECL|macro|phone
mdefine_line|#define phone iocpar.phone
DECL|macro|cfg
mdefine_line|#define cfg   iocpar.cfg
id|name
(braket
r_sizeof
(paren
id|name
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|bname
(braket
r_sizeof
(paren
id|bname
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCNETAIF
suffix:colon
multiline_comment|/* add an interface */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
op_minus
l_int|1
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_addif
c_func
(paren
id|name
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETASL
suffix:colon
multiline_comment|/* add slave to an interface */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|bname
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|bname
)paren
op_minus
l_int|1
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_addslave
c_func
(paren
id|bname
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETDIF
suffix:colon
multiline_comment|/* delete an interface */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
op_minus
l_int|1
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_delif
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETSCF
suffix:colon
multiline_comment|/* set config */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_setcfg
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETGCF
suffix:colon
multiline_comment|/* get config */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_getcfg
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|cfg
comma
r_sizeof
(paren
id|cfg
)paren
)paren
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETANM
suffix:colon
multiline_comment|/* add a phone number */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_addphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETGNM
suffix:colon
multiline_comment|/* get list of phone numbers */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_getphone
c_func
(paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETDNM
suffix:colon
multiline_comment|/* delete a phone number */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_delphone
c_func
(paren
op_amp
id|phone
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETDIL
suffix:colon
multiline_comment|/* trigger dial-out */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_dial
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETHUP
suffix:colon
multiline_comment|/* hangup */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_force_hangup
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETGPN
suffix:colon
multiline_comment|/* Get peer phone number of a connected interface */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|phone
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|phone
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_net_getpeer
c_func
(paren
op_amp
id|phone
comma
(paren
id|isdn_net_ioctl_phone
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_case
id|IIOCNETALN
suffix:colon
multiline_comment|/* Add link */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_ppp_dial_slave
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETDLN
suffix:colon
multiline_comment|/* Delete link */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_ppp_hangup_slave
c_func
(paren
id|name
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|retval
op_assign
op_minus
id|ENOTTY
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
DECL|macro|name
macro_line|#undef name
DECL|macro|bname
macro_line|#undef bname
DECL|macro|iocts
macro_line|#undef iocts
DECL|macro|phone
macro_line|#undef phone
DECL|macro|cfg
macro_line|#undef cfg
)brace
multiline_comment|/*&n; * Hang up all network-interfaces&n; */
r_void
DECL|function|isdn_net_hangup_all
id|isdn_net_hangup_all
c_func
(paren
r_void
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|idev
comma
op_amp
id|isdn_net_devs
comma
id|global_list
)paren
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Remove all network-interfaces&n; */
r_void
DECL|function|isdn_net_exit
id|isdn_net_exit
c_func
(paren
r_void
)paren
(brace
id|isdn_net_dev
op_star
id|idev
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|isdn_net_devs
)paren
)paren
(brace
id|idev
op_assign
id|list_entry
c_func
(paren
id|isdn_net_devs.next
comma
id|isdn_net_dev
comma
id|global_list
)paren
suffix:semicolon
id|retval
op_assign
id|isdn_net_dev_delete
c_func
(paren
id|idev
)paren
suffix:semicolon
multiline_comment|/* can only fail if an interface is still running.&n;&t;&t; * In this case, an elevated module use count should&n;&t;&t; * have prevented this function from being called in&n;&t;&t; * the first place */
r_if
c_cond
(paren
id|retval
)paren
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* interface to network layer                                             */
multiline_comment|/* ====================================================================== */
multiline_comment|/* &n; * Open/initialize the board.&n; */
r_static
r_int
DECL|function|isdn_net_open
id|isdn_net_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;ops
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;open
)paren
id|retval
op_assign
id|lp-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Shutdown a net-interface.&n; */
singleline_comment|// FIXME share?
r_static
r_int
DECL|function|isdn_net_close
id|isdn_net_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|list_head
op_star
id|l
comma
op_star
id|n
suffix:semicolon
id|isdn_net_dev
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ops-&gt;close
)paren
id|lp-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|lp
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|l
comma
id|n
comma
op_amp
id|lp-&gt;online
)paren
(brace
id|sdev
op_assign
id|list_entry
c_func
(paren
id|l
comma
id|isdn_net_dev
comma
id|online
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get statistics&n; */
r_static
r_struct
id|net_device_stats
op_star
DECL|function|isdn_net_get_stats
id|isdn_net_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|isdn_net_local
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * Transmit timeout&n; */
r_static
r_void
DECL|function|isdn_net_tx_timeout
id|isdn_net_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn_tx_timeout dev %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Interface-setup. (just after registering a new interface)&n; */
r_static
r_int
DECL|function|isdn_init_netif
id|isdn_init_netif
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
multiline_comment|/* Setup the generic properties */
id|ndev-&gt;mtu
op_assign
l_int|1500
suffix:semicolon
id|ndev-&gt;tx_queue_len
op_assign
l_int|10
suffix:semicolon
id|ndev-&gt;open
op_assign
op_amp
id|isdn_net_open
suffix:semicolon
id|ndev-&gt;hard_header_len
op_assign
id|ETH_HLEN
op_plus
id|isdn_hard_header_len
c_func
(paren
)paren
suffix:semicolon
id|ndev-&gt;stop
op_assign
op_amp
id|isdn_net_close
suffix:semicolon
id|ndev-&gt;get_stats
op_assign
op_amp
id|isdn_net_get_stats
suffix:semicolon
id|ndev-&gt;tx_timeout
op_assign
id|isdn_net_tx_timeout
suffix:semicolon
id|ndev-&gt;watchdog_timeo
op_assign
id|ISDN_NET_TX_TIMEOUT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
r_static
r_void
DECL|function|isdn_net_tasklet
id|isdn_net_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
(paren
id|isdn_net_dev
op_star
)paren
id|data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|isdn_net_dev_busy
c_func
(paren
id|idev
)paren
)paren
(brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|idev-&gt;super_tx_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_break
suffix:semicolon
id|isdn_net_writebuf_skb
c_func
(paren
id|idev
comma
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|idev-&gt;xmit_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
r_static
r_void
DECL|function|isdn_net_dial_timer
id|isdn_net_dial_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
(paren
id|isdn_net_dev
op_star
)paren
id|data
suffix:semicolon
id|isdn_net_handle_event
c_func
(paren
id|idev
comma
id|idev-&gt;dial_event
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform auto-hangup for net-interfaces.&n; *&n; * auto-hangup:&n; * Increment idle-counter (this counter is reset on any incoming or&n; * outgoing packet), if counter exceeds configured limit either do a&n; * hangup immediately or - if configured - wait until just before the next&n; * charge-info.&n; */
r_static
r_void
DECL|function|isdn_net_hup_timer
id|isdn_net_hup_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|isdn_net_dev
op_star
id|idev
op_assign
(paren
id|isdn_net_dev
op_star
)paren
id|data
suffix:semicolon
id|isdn_net_local
op_star
id|mlp
op_assign
id|idev-&gt;mlp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdn_net_online
c_func
(paren
id|idev
)paren
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: huptimer %d, onhtime %d, chargetime %ld, chargeint %d&bslash;n&quot;
comma
id|idev-&gt;name
comma
id|idev-&gt;huptimer
comma
id|mlp-&gt;onhtime
comma
id|idev-&gt;chargetime
comma
id|idev-&gt;chargeint
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mlp-&gt;onhtime
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;huptimer
op_increment
op_le
id|mlp-&gt;onhtime
)paren
r_goto
id|mod_timer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mlp-&gt;hupflags
op_amp
(paren
id|ISDN_MANCHARGE
op_or
id|ISDN_CHARGEHUP
)paren
)paren
op_eq
(paren
id|ISDN_MANCHARGE
op_or
id|ISDN_CHARGEHUP
)paren
)paren
(brace
r_while
c_loop
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|idev-&gt;chargetime
op_plus
id|idev-&gt;chargeint
)paren
)paren
id|idev-&gt;chargetime
op_add_assign
id|idev-&gt;chargeint
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|idev-&gt;chargetime
op_plus
id|idev-&gt;chargeint
op_minus
l_int|2
op_star
id|HZ
)paren
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;outgoing
op_logical_or
id|mlp-&gt;hupflags
op_amp
id|ISDN_INHUP
)paren
(brace
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|idev-&gt;outgoing
)paren
(brace
r_if
c_cond
(paren
id|mlp-&gt;hupflags
op_amp
id|ISDN_CHARGEHUP
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;charge_state
op_ne
id|ST_CHARGE_HAVE_CINT
)paren
(brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: did not get CINT&bslash;n&quot;
comma
id|idev-&gt;name
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|idev-&gt;chargetime
op_plus
id|idev-&gt;chargeint
)paren
)paren
(brace
id|dbg_net_dial
c_func
(paren
l_string|&quot;%s: chtime = %lu, chint = %d&bslash;n&quot;
comma
id|idev-&gt;name
comma
id|idev-&gt;chargetime
comma
id|idev-&gt;chargeint
)paren
suffix:semicolon
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|mlp-&gt;hupflags
op_amp
id|ISDN_INHUP
)paren
(brace
id|isdn_net_hangup
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mod_timer
suffix:colon
id|mod_timer
c_func
(paren
op_amp
id|idev-&gt;hup_timer
comma
id|idev-&gt;hup_timer.expires
op_plus
id|HZ
)paren
suffix:semicolon
)brace
eof
