multiline_comment|/* Linux ISDN subsystem, common used functions&n; *&n; * Copyright 1994-1999  by Fritz Elfert (fritz@isdn4linux.de)&n; * Copyright 1995,96    Thinking Objects Software GmbH Wuerzburg&n; * Copyright 1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)&n; *&n; * This software may be used and distributed according to the terms&n; * of the GNU General Public License, incorporated herein by reference.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/isdn.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &quot;isdn_common.h&quot;
macro_line|#include &quot;isdn_net_lib.h&quot;
macro_line|#include &quot;isdn_net.h&quot;
macro_line|#include &quot;isdn_tty.h&quot;
macro_line|#include &quot;isdn_ppp.h&quot;
macro_line|#ifdef CONFIG_ISDN_AUDIO
macro_line|#include &quot;isdn_audio.h&quot;
macro_line|#endif
macro_line|#include &lt;linux/isdn_divertif.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ISDN4Linux: link layer&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Fritz Elfert&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|dev
id|isdn_dev
op_star
id|dev
suffix:semicolon
r_static
r_void
id|isdn_lock_driver
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_void
id|isdn_unlock_driver
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
suffix:semicolon
multiline_comment|/* ====================================================================== */
multiline_comment|/* Description of hardware-level-driver */
DECL|struct|isdn_driver
r_struct
id|isdn_driver
(brace
DECL|member|di
r_int
id|di
suffix:semicolon
DECL|member|id
r_char
id|id
(braket
l_int|20
)braket
suffix:semicolon
DECL|member|refcnt
id|atomic_t
id|refcnt
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Misc driver Flags           */
DECL|member|features
r_int
r_int
id|features
suffix:semicolon
DECL|member|channels
r_int
id|channels
suffix:semicolon
multiline_comment|/* Number of channels          */
DECL|member|st_waitq
id|wait_queue_head_t
id|st_waitq
suffix:semicolon
multiline_comment|/* Wait-Queue for status-reads */
DECL|member|maxbufsize
r_int
id|maxbufsize
suffix:semicolon
multiline_comment|/* Maximum Buffersize supported*/
DECL|member|stavail
r_int
id|stavail
suffix:semicolon
multiline_comment|/* Chars avail on Status-device*/
DECL|member|interface
id|isdn_if
op_star
id|interface
suffix:semicolon
multiline_comment|/* Interface to driver         */
DECL|member|msn2eaz
r_char
id|msn2eaz
(braket
l_int|10
)braket
(braket
id|ISDN_MSNLEN
)braket
suffix:semicolon
multiline_comment|/*  MSN-&gt;EAZ          */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|slots
r_struct
id|isdn_slot
op_star
id|slots
suffix:semicolon
DECL|member|fi
r_struct
id|fsm_inst
id|fi
suffix:semicolon
DECL|variable|driver
)brace
id|driver
suffix:semicolon
r_static
r_void
id|drv_destroy
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_inline
r_struct
id|isdn_driver
op_star
DECL|function|get_drv
id|get_drv
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;get_drv %d: %d -&gt; %d&bslash;n&quot;
comma
id|drv-&gt;di
comma
id|atomic_read
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
suffix:semicolon
r_return
id|drv
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|put_drv
id|put_drv
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;put_drv %d: %d -&gt; %d&bslash;n&quot;
comma
id|drv-&gt;di
comma
id|atomic_read
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|drv-&gt;refcnt
)paren
)paren
(brace
id|drv_destroy
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ====================================================================== */
DECL|variable|slot_fsm
r_static
r_struct
id|fsm
id|slot_fsm
suffix:semicolon
r_static
r_void
id|slot_debug
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
suffix:semicolon
DECL|variable|slot_st_str
r_static
r_char
op_star
id|slot_st_str
(braket
)braket
op_assign
(brace
l_string|&quot;ST_SLOT_NULL&quot;
comma
l_string|&quot;ST_SLOT_BOUND&quot;
comma
l_string|&quot;ST_SLOT_IN&quot;
comma
l_string|&quot;ST_SLOT_WAIT_DCONN&quot;
comma
l_string|&quot;ST_SLOT_DCONN&quot;
comma
l_string|&quot;ST_SLOT_WAIT_BCONN&quot;
comma
l_string|&quot;ST_SLOT_ACTIVE&quot;
comma
l_string|&quot;ST_SLOT_WAIT_BHUP&quot;
comma
l_string|&quot;ST_SLOT_WAIT_DHUP&quot;
comma
)brace
suffix:semicolon
DECL|variable|ev_str
r_static
r_char
op_star
id|ev_str
(braket
)braket
op_assign
(brace
l_string|&quot;EV_DRV_REGISTER&quot;
comma
l_string|&quot;EV_STAT_RUN&quot;
comma
l_string|&quot;EV_STAT_STOP&quot;
comma
l_string|&quot;EV_STAT_UNLOAD&quot;
comma
l_string|&quot;EV_STAT_STAVAIL&quot;
comma
l_string|&quot;EV_STAT_ADDCH&quot;
comma
l_string|&quot;EV_STAT_ICALL&quot;
comma
l_string|&quot;EV_STAT_DCONN&quot;
comma
l_string|&quot;EV_STAT_BCONN&quot;
comma
l_string|&quot;EV_STAT_BHUP&quot;
comma
l_string|&quot;EV_STAT_DHUP&quot;
comma
l_string|&quot;EV_STAT_BSENT&quot;
comma
l_string|&quot;EV_STAT_CINF&quot;
comma
l_string|&quot;EV_STAT_CAUSE&quot;
comma
l_string|&quot;EV_STAT_DISPLAY&quot;
comma
l_string|&quot;EV_STAT_FAXIND&quot;
comma
l_string|&quot;EV_STAT_AUDIO&quot;
comma
l_string|&quot;EV_CMD_CLREAZ&quot;
comma
l_string|&quot;EV_CMD_SETEAZ&quot;
comma
l_string|&quot;EV_CMD_SETL2&quot;
comma
l_string|&quot;EV_CMD_SETL3&quot;
comma
l_string|&quot;EV_CMD_DIAL&quot;
comma
l_string|&quot;EV_CMD_ACCEPTD&quot;
comma
l_string|&quot;EV_CMD_ACCEPTB&quot;
comma
l_string|&quot;EV_CMD_HANGUP&quot;
comma
l_string|&quot;EV_DATA_REQ&quot;
comma
l_string|&quot;EV_DATA_IND&quot;
comma
l_string|&quot;EV_SLOT_BIND&quot;
comma
l_string|&quot;EV_SLOT_UNBIND&quot;
comma
)brace
suffix:semicolon
r_static
r_int
id|__slot_command
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
id|isdn_ctrl
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|isdn_v110_setl2
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
id|isdn_ctrl
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|__isdn_v110_open
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
suffix:semicolon
r_static
r_void
id|__isdn_v110_close
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
suffix:semicolon
r_static
r_void
id|__isdn_v110_bsent
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_int
id|pr
comma
id|isdn_ctrl
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|isdn_v110_data_ind
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|isdn_v110_data_req
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_inline
r_int
DECL|function|do_event_cb
id|do_event_cb
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_if
c_cond
(paren
id|slot-&gt;event_cb
)paren
r_return
id|slot
op_member_access_from_pointer
id|event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_bind
id|slot_bind
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_lock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_BOUND
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* just pass through command */
r_static
r_int
DECL|function|slot_command
id|slot_command
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|c
op_assign
id|arg
suffix:semicolon
r_return
id|__slot_command
c_func
(paren
id|slot
comma
id|c
)paren
suffix:semicolon
)brace
multiline_comment|/* just pass through status */
r_static
r_int
DECL|function|slot_stat
id|slot_stat
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* just pass through command */
r_static
r_int
DECL|function|slot_setl2
id|slot_setl2
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|c
op_assign
id|arg
suffix:semicolon
id|isdn_v110_setl2
c_func
(paren
id|slot
comma
id|c
)paren
suffix:semicolon
r_return
id|__slot_command
c_func
(paren
id|slot
comma
id|c
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_dial
id|slot_dial
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|__slot_command
c_func
(paren
id|slot
comma
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ge
l_int|0
)paren
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_WAIT_DCONN
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_acceptd
id|slot_acceptd
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|__slot_command
c_func
(paren
id|slot
comma
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ge
l_int|0
)paren
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_WAIT_DCONN
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_acceptb
id|slot_acceptb
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|__slot_command
c_func
(paren
id|slot
comma
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ge
l_int|0
)paren
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_WAIT_BCONN
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_actv_hangup
id|slot_actv_hangup
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|__slot_command
c_func
(paren
id|slot
comma
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ge
l_int|0
)paren
(brace
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_WAIT_BHUP
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_dconn
id|slot_dconn
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_DCONN
)paren
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_bconn
id|slot_bconn
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_ACTIVE
)paren
suffix:semicolon
id|__isdn_v110_open
c_func
(paren
id|slot
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_bhup
id|slot_bhup
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|__isdn_v110_close
c_func
(paren
id|slot
)paren
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_WAIT_DHUP
)paren
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_dhup
id|slot_dhup
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_BOUND
)paren
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_data_req
id|slot_data_req
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
r_return
id|isdn_v110_data_req
c_func
(paren
id|slot
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_data_ind
id|slot_data_ind
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|arg
suffix:semicolon
multiline_comment|/* Update statistics */
id|slot-&gt;ibytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_return
id|isdn_v110_data_ind
c_func
(paren
id|slot
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_bsent
id|slot_bsent
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
id|__isdn_v110_bsent
c_func
(paren
id|slot
comma
id|pr
comma
id|ctrl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_icall
id|slot_icall
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|ctrl
op_assign
id|arg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|isdn_lock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_IN
)paren
suffix:semicolon
id|slot_debug
c_func
(paren
id|fi
comma
l_string|&quot;ICALL: %s&bslash;n&quot;
comma
id|ctrl-&gt;parm.num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|slot-&gt;num
comma
id|ctrl-&gt;parm.setup.phone
)paren
suffix:semicolon
multiline_comment|/* Try to find a network-interface which will accept incoming call */
id|retval
op_assign
id|isdn_net_find_icall
c_func
(paren
id|slot
comma
op_amp
id|ctrl-&gt;parm.setup
)paren
suffix:semicolon
multiline_comment|/* already taken by net now? */
r_if
c_cond
(paren
id|fi-&gt;state
op_ne
id|ST_SLOT_IN
)paren
r_goto
id|out
suffix:semicolon
id|retval
op_assign
id|isdn_tty_find_icall
c_func
(paren
id|slot
comma
op_amp
id|ctrl-&gt;parm.setup
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* should become broadcast later */
r_static
r_int
DECL|function|slot_in_dhup
id|slot_in_dhup
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_unlock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_NULL
)paren
suffix:semicolon
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|slot_unbind
id|slot_unbind
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
id|cmd
suffix:semicolon
id|isdn_unlock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_SLOT_NULL
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|slot-&gt;num
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
id|cmd.parm.num
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_SETEAZ
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|slot-&gt;ibytes
op_assign
l_int|0
suffix:semicolon
id|slot-&gt;obytes
op_assign
l_int|0
suffix:semicolon
id|slot-&gt;usage
op_assign
id|ISDN_USAGE_NONE
suffix:semicolon
id|put_drv
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|slot_fn_tbl
r_static
r_struct
id|fsm_node
id|slot_fn_tbl
(braket
)braket
op_assign
(brace
(brace
id|ST_SLOT_NULL
comma
id|EV_SLOT_BIND
comma
id|slot_bind
)brace
comma
(brace
id|ST_SLOT_NULL
comma
id|EV_STAT_ICALL
comma
id|slot_icall
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_CMD_CLREAZ
comma
id|slot_command
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_CMD_SETEAZ
comma
id|slot_command
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_CMD_SETL2
comma
id|slot_setl2
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_CMD_SETL3
comma
id|slot_command
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_CMD_DIAL
comma
id|slot_dial
)brace
comma
(brace
id|ST_SLOT_BOUND
comma
id|EV_SLOT_UNBIND
comma
id|slot_unbind
)brace
comma
(brace
id|ST_SLOT_IN
comma
id|EV_CMD_SETL2
comma
id|slot_setl2
)brace
comma
(brace
id|ST_SLOT_IN
comma
id|EV_CMD_SETL3
comma
id|slot_command
)brace
comma
(brace
id|ST_SLOT_IN
comma
id|EV_CMD_ACCEPTD
comma
id|slot_acceptd
)brace
comma
(brace
id|ST_SLOT_IN
comma
id|EV_STAT_DHUP
comma
id|slot_in_dhup
)brace
comma
(brace
id|ST_SLOT_WAIT_DCONN
comma
id|EV_STAT_DCONN
comma
id|slot_dconn
)brace
comma
(brace
id|ST_SLOT_WAIT_DCONN
comma
id|EV_STAT_DHUP
comma
id|slot_dhup
)brace
comma
(brace
id|ST_SLOT_DCONN
comma
id|EV_CMD_ACCEPTB
comma
id|slot_acceptb
)brace
comma
(brace
id|ST_SLOT_DCONN
comma
id|EV_STAT_BCONN
comma
id|slot_bconn
)brace
comma
(brace
id|ST_SLOT_WAIT_BCONN
comma
id|EV_STAT_BCONN
comma
id|slot_bconn
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_DATA_REQ
comma
id|slot_data_req
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_DATA_IND
comma
id|slot_data_ind
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_CMD_HANGUP
comma
id|slot_actv_hangup
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_STAT_BSENT
comma
id|slot_bsent
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_STAT_BHUP
comma
id|slot_bhup
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_STAT_FAXIND
comma
id|slot_stat
)brace
comma
(brace
id|ST_SLOT_ACTIVE
comma
id|EV_STAT_AUDIO
comma
id|slot_stat
)brace
comma
(brace
id|ST_SLOT_WAIT_BHUP
comma
id|EV_STAT_BHUP
comma
id|slot_bhup
)brace
comma
(brace
id|ST_SLOT_WAIT_DHUP
comma
id|EV_STAT_DHUP
comma
id|slot_dhup
)brace
comma
)brace
suffix:semicolon
DECL|variable|slot_fsm
r_static
r_struct
id|fsm
id|slot_fsm
op_assign
(brace
dot
id|st_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|slot_st_str
)paren
comma
dot
id|st_str
op_assign
id|slot_st_str
comma
dot
id|ev_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|ev_str
)paren
comma
dot
id|ev_str
op_assign
id|ev_str
comma
dot
id|fn_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|slot_fn_tbl
)paren
comma
dot
id|fn_tbl
op_assign
id|slot_fn_tbl
comma
)brace
suffix:semicolon
DECL|function|slot_debug
r_static
r_void
id|slot_debug
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_char
id|buf
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;slot (%d:%d): &quot;
comma
id|slot-&gt;di
comma
id|slot-&gt;ch
)paren
suffix:semicolon
id|p
op_add_assign
id|vsprintf
c_func
(paren
id|p
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
DECL|variable|stat_lock
r_static
id|spinlock_t
id|stat_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|drv_fsm
r_static
r_struct
id|fsm
id|drv_fsm
suffix:semicolon
r_enum
(brace
DECL|enumerator|ST_DRV_NULL
id|ST_DRV_NULL
comma
DECL|enumerator|ST_DRV_LOADED
id|ST_DRV_LOADED
comma
DECL|enumerator|ST_DRV_RUNNING
id|ST_DRV_RUNNING
comma
)brace
suffix:semicolon
DECL|variable|drv_st_str
r_static
r_char
op_star
id|drv_st_str
(braket
)braket
op_assign
(brace
l_string|&quot;ST_DRV_NULL&quot;
comma
l_string|&quot;ST_DRV_LOADED&quot;
comma
l_string|&quot;ST_DRV_RUNNING&quot;
comma
)brace
suffix:semicolon
DECL|macro|DRV_FLAG_REJBUS
mdefine_line|#define DRV_FLAG_REJBUS  1
r_static
r_int
id|__drv_command
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
comma
id|isdn_ctrl
op_star
id|cmd
)paren
suffix:semicolon
DECL|variable|drivers_lock
r_static
id|spinlock_t
id|drivers_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|drivers
r_static
r_struct
id|isdn_driver
op_star
id|drivers
(braket
id|ISDN_MAX_DRIVERS
)braket
suffix:semicolon
r_static
r_int
DECL|function|isdn_writebuf_skb
id|isdn_writebuf_skb
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|slot-&gt;drv
suffix:semicolon
r_int
id|hl
op_assign
id|drv-&gt;interface-&gt;hl_hdrlen
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
op_ge
id|hl
)paren
(brace
id|retval
op_assign
id|drv-&gt;interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|slot-&gt;di
comma
id|slot-&gt;ch
comma
l_int|1
comma
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb2
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|hl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb2
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
id|drv-&gt;interface
op_member_access_from_pointer
id|writebuf_skb
c_func
(paren
id|slot-&gt;di
comma
id|slot-&gt;ch
comma
l_int|1
comma
id|skb2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
id|kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
r_else
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|retval
OG
l_int|0
)paren
id|slot-&gt;obytes
op_add_assign
id|retval
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|__isdn_drv_lookup
id|__isdn_drv_lookup
c_func
(paren
r_char
op_star
id|drvid
)paren
(brace
r_int
id|drvidx
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|drivers
(braket
id|drvidx
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|id
comma
id|drvid
)paren
op_eq
l_int|0
)paren
r_return
id|drvidx
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|isdn_drv_lookup
id|isdn_drv_lookup
c_func
(paren
r_char
op_star
id|drvid
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|drvidx
op_assign
id|__isdn_drv_lookup
c_func
(paren
id|drvid
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|drvidx
suffix:semicolon
)brace
r_static
r_void
DECL|function|drv_destroy
id|drv_destroy
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
id|kfree
c_func
(paren
id|drv-&gt;slots
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_static
r_struct
id|isdn_driver
op_star
DECL|function|get_drv_by_nr
id|get_drv_by_nr
c_func
(paren
r_int
id|di
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
id|BUG_ON
c_func
(paren
id|di
OL
l_int|0
op_logical_or
id|di
op_ge
id|ISDN_MAX_DRIVERS
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|drv
op_assign
id|drivers
(braket
id|di
)braket
suffix:semicolon
r_if
c_cond
(paren
id|drv
)paren
id|get_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|drv
suffix:semicolon
)brace
r_char
op_star
DECL|function|isdn_drv_drvid
id|isdn_drv_drvid
c_func
(paren
r_int
id|di
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|drivers
(braket
id|di
)braket
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_string|&quot;&quot;
suffix:semicolon
)brace
r_return
id|drivers
(braket
id|di
)braket
op_member_access_from_pointer
id|id
suffix:semicolon
)brace
multiline_comment|/* &n; * Helper keeping track of the features the drivers support&n; */
r_static
r_void
DECL|function|set_global_features
id|set_global_features
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
id|dev-&gt;global_features
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|drivers
(braket
id|drvidx
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|fi.state
op_ne
id|ST_DRV_RUNNING
)paren
r_continue
suffix:semicolon
id|dev-&gt;global_features
op_or_assign
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|features
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * driver state machine&n; */
r_static
r_int
id|isdn_add_channels
c_func
(paren
r_struct
id|isdn_driver
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|isdn_receive_skb_callback
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|isdn_status_callback
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
suffix:semicolon
r_static
r_void
id|isdn_v110_add_features
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
suffix:semicolon
r_static
r_int
DECL|function|drv_register
id|drv_register
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_if
op_star
id|iif
op_assign
id|arg
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_DRV_LOADED
)paren
suffix:semicolon
id|drv-&gt;maxbufsize
op_assign
id|iif-&gt;maxbufsize
suffix:semicolon
id|drv-&gt;interface
op_assign
id|iif
suffix:semicolon
id|iif-&gt;channels
op_assign
id|drv-&gt;di
suffix:semicolon
id|iif-&gt;rcvcallb_skb
op_assign
id|isdn_receive_skb_callback
suffix:semicolon
id|iif-&gt;statcallb
op_assign
id|isdn_status_callback
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|drv_stat_run
id|drv_stat_run
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_DRV_RUNNING
)paren
suffix:semicolon
id|drv-&gt;features
op_assign
id|drv-&gt;interface-&gt;features
suffix:semicolon
id|isdn_v110_add_features
c_func
(paren
id|drv
)paren
suffix:semicolon
id|set_global_features
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|drv_stat_stop
id|drv_stat_stop
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
id|fsm_change_state
c_func
(paren
id|fi
comma
id|ST_DRV_LOADED
)paren
suffix:semicolon
id|set_global_features
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|drv_stat_unload
id|drv_stat_unload
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|drivers
(braket
id|drv-&gt;di
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|put_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
id|dev-&gt;channels
op_sub_assign
id|drv-&gt;channels
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|drv_stat_stavail
id|drv_stat_stavail
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|isdn_ctrl
op_star
id|c
op_assign
id|arg
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
id|drv-&gt;stavail
op_add_assign
id|c-&gt;arg
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|drv-&gt;st_waitq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|drv_to_slot
id|drv_to_slot
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_int
id|pr
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
id|isdn_ctrl
op_star
id|c
op_assign
id|arg
suffix:semicolon
r_int
id|ch
op_assign
id|c-&gt;arg
op_amp
l_int|0xff
suffix:semicolon
r_return
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;slots
(braket
id|ch
)braket
dot
id|fi
comma
id|pr
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|drv_fn_tbl
r_static
r_struct
id|fsm_node
id|drv_fn_tbl
(braket
)braket
op_assign
(brace
(brace
id|ST_DRV_NULL
comma
id|EV_DRV_REGISTER
comma
id|drv_register
)brace
comma
(brace
id|ST_DRV_LOADED
comma
id|EV_STAT_RUN
comma
id|drv_stat_run
)brace
comma
(brace
id|ST_DRV_LOADED
comma
id|EV_STAT_STAVAIL
comma
id|drv_stat_stavail
)brace
comma
(brace
id|ST_DRV_LOADED
comma
id|EV_STAT_UNLOAD
comma
id|drv_stat_unload
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_STOP
comma
id|drv_stat_stop
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_STAVAIL
comma
id|drv_stat_stavail
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_ICALL
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_DCONN
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_BCONN
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_BHUP
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_DHUP
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_BSENT
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_CINF
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_CAUSE
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_DISPLAY
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_FAXIND
comma
id|drv_to_slot
)brace
comma
(brace
id|ST_DRV_RUNNING
comma
id|EV_STAT_AUDIO
comma
id|drv_to_slot
)brace
comma
)brace
suffix:semicolon
DECL|variable|drv_fsm
r_static
r_struct
id|fsm
id|drv_fsm
op_assign
(brace
dot
id|st_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|drv_st_str
)paren
comma
dot
id|st_str
op_assign
id|drv_st_str
comma
dot
id|ev_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|ev_str
)paren
comma
dot
id|ev_str
op_assign
id|ev_str
comma
dot
id|fn_cnt
op_assign
id|ARRAY_SIZE
c_func
(paren
id|drv_fn_tbl
)paren
comma
dot
id|fn_tbl
op_assign
id|drv_fn_tbl
comma
)brace
suffix:semicolon
DECL|function|drv_debug
r_static
r_void
id|drv_debug
c_func
(paren
r_struct
id|fsm_inst
op_star
id|fi
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|fi-&gt;userdata
suffix:semicolon
r_char
id|buf
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s: &quot;
comma
id|drv-&gt;id
)paren
suffix:semicolon
id|p
op_add_assign
id|vsprintf
c_func
(paren
id|p
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* callbacks from hardware driver                                         */
multiline_comment|/* ====================================================================== */
multiline_comment|/* Receive a packet from B-Channel. */
r_static
r_void
DECL|function|isdn_receive_skb_callback
id|isdn_receive_skb_callback
c_func
(paren
r_int
id|di
comma
r_int
id|ch
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
id|drv
op_assign
id|get_drv_by_nr
c_func
(paren
id|di
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv
)paren
(brace
multiline_comment|/* hardware driver is buggy - driver isn&squot;t registered */
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* we short-cut here instead of going through the driver fsm */
r_if
c_cond
(paren
id|drv-&gt;fi.state
op_ne
id|ST_DRV_RUNNING
)paren
(brace
multiline_comment|/* hardware driver is buggy - driver isn&squot;t running */
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;slots
(braket
id|ch
)braket
dot
id|fi
comma
id|EV_DATA_IND
comma
id|skb
)paren
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
id|put_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
multiline_comment|/* Receive status indications */
r_static
r_int
DECL|function|isdn_status_callback
id|isdn_status_callback
c_func
(paren
id|isdn_ctrl
op_star
id|c
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|drv
op_assign
id|get_drv_by_nr
c_func
(paren
id|c-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv
)paren
(brace
multiline_comment|/* hardware driver is buggy - driver isn&squot;t registered */
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_STAT_STAVAIL
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_STAVAIL
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_RUN
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_RUN
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_STOP
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_STOP
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_UNLOAD
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_UNLOAD
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ADDCH
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_ADDCH
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_ICALL
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_ICALL
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DCONN
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_DCONN
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_BCONN
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BHUP
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_BHUP
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_DHUP
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BSENT
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_BSENT
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CINF
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_CINF
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_CAUSE
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_CAUSE
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DISPLAY
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_DISPLAY
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_FAXIND
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_FAXIND
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_AUDIO
suffix:colon
id|rc
op_assign
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_STAT_AUDIO
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|ISDN_STAT_ICALL
suffix:colon
multiline_comment|/* Find any ttyI, waiting for D-channel setup */
r_if
c_cond
(paren
id|isdn_tty_stat_callback
c_func
(paren
id|i
comma
id|c
)paren
)paren
(brace
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_ACCEPTB
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|r
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
)paren
)paren
r_return
id|retval
suffix:semicolon
multiline_comment|/* processed */
r_if
c_cond
(paren
(paren
op_logical_neg
id|retval
)paren
op_logical_and
(paren
id|drivers
(braket
id|di
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DRV_FLAG_REJBUS
)paren
)paren
(brace
multiline_comment|/* No tty responding */
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
id|retval
op_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* incoming call accepted by net interface */
r_case
l_int|2
suffix:colon
multiline_comment|/* For calling back, first reject incoming call ... */
r_case
l_int|3
suffix:colon
multiline_comment|/* Interface found, but down, reject call actively  */
id|retval
op_assign
l_int|2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Rejecting Call&bslash;n&quot;
)paren
suffix:semicolon
id|cmd.driver
op_assign
id|di
suffix:semicolon
id|cmd.arg
op_assign
id|c-&gt;arg
suffix:semicolon
id|cmd.command
op_assign
id|ISDN_CMD_HANGUP
suffix:semicolon
id|isdn_command
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|3
)paren
r_break
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_int|4
suffix:colon
multiline_comment|/* ... then start callback. */
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Number would eventually match, if longer */
id|retval
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dbg_statcallb
c_func
(paren
l_string|&quot;ICALL: ret=%d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_DHUP
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BCONN
suffix:colon
r_break
suffix:semicolon
r_case
id|ISDN_STAT_BHUP
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#if 0 
singleline_comment|// FIXME
r_case
id|ISDN_STAT_DISCH
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|slots
(braket
id|i
)braket
dot
id|di
op_eq
id|di
)paren
op_logical_and
(paren
id|slots
(braket
id|i
)braket
dot
id|ch
op_eq
id|c-&gt;arg
)paren
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;parm.num
(braket
l_int|0
)braket
)paren
id|slots
(braket
id|i
)braket
dot
id|usage
op_and_assign
op_complement
id|ISDN_USAGE_DISABLED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|USG_NONE
c_func
(paren
id|isdn_slot_usage
c_func
(paren
id|i
)paren
)paren
)paren
id|slots
(braket
id|i
)braket
dot
id|usage
op_or_assign
id|ISDN_USAGE_DISABLED
suffix:semicolon
r_else
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPI_PUT_MESSAGE
suffix:colon
r_return
id|isdn_capi_rec_hl_msg
c_func
(paren
op_amp
id|c-&gt;parm.cmsg
)paren
suffix:semicolon
r_case
id|ISDN_STAT_PROT
suffix:colon
r_case
id|ISDN_STAT_REDIR
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
r_return
id|divert_if
op_member_access_from_pointer
id|stat_callback
c_func
(paren
id|c
)paren
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
id|put_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/*&n; * Register a new ISDN interface&n; */
r_int
DECL|function|register_isdn
id|register_isdn
c_func
(paren
id|isdn_if
op_star
id|iif
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
id|drv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|drv
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: out of mem&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|memset
c_func
(paren
id|drv
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|drv
)paren
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|drv-&gt;refcnt
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|drv-&gt;lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|drv-&gt;st_waitq
)paren
suffix:semicolon
id|drv-&gt;fi.fsm
op_assign
op_amp
id|drv_fsm
suffix:semicolon
id|drv-&gt;fi.state
op_assign
id|ST_DRV_NULL
suffix:semicolon
id|drv-&gt;fi.debug
op_assign
l_int|1
suffix:semicolon
id|drv-&gt;fi.userdata
op_assign
id|drv
suffix:semicolon
id|drv-&gt;fi.printdebug
op_assign
id|drv_debug
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|drivers
(braket
id|drvidx
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
id|ISDN_MAX_DRIVERS
)paren
r_goto
id|fail_unlock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|iif-&gt;id
)paren
)paren
id|sprintf
c_func
(paren
id|iif-&gt;id
comma
l_string|&quot;line%d&quot;
comma
id|drvidx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__isdn_drv_lookup
c_func
(paren
id|iif-&gt;id
)paren
op_ge
l_int|0
)paren
r_goto
id|fail_unlock
suffix:semicolon
id|strcpy
c_func
(paren
id|drv-&gt;id
comma
id|iif-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdn_add_channels
c_func
(paren
id|drv
comma
id|iif-&gt;channels
)paren
)paren
r_goto
id|fail_unlock
suffix:semicolon
id|drv-&gt;di
op_assign
id|drvidx
suffix:semicolon
id|drivers
(braket
id|drvidx
)braket
op_assign
id|get_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
op_amp
id|drv-&gt;fi
comma
id|EV_DRV_REGISTER
comma
id|iif
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|fail_unlock
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drivers_lock
comma
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|drv
)paren
suffix:semicolon
id|fail
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
macro_line|#if defined(CONFIG_ISDN_DIVERSION) || defined(CONFIG_ISDN_DIVERSION_MODULE)
DECL|variable|divert_if
r_static
id|isdn_divert_if
op_star
id|divert_if
suffix:semicolon
multiline_comment|/* = NULL */
macro_line|#else
DECL|macro|divert_if
mdefine_line|#define divert_if ((isdn_divert_if *) NULL)
macro_line|#endif
r_static
r_int
id|isdn_wildmat
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
suffix:semicolon
r_static
r_void
DECL|function|isdn_lock_driver
id|isdn_lock_driver
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
singleline_comment|// FIXME don&squot;t ignore return value
id|try_module_get
c_func
(paren
id|drv-&gt;interface-&gt;owner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|isdn_unlock_driver
id|isdn_unlock_driver
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
id|module_put
c_func
(paren
id|drv-&gt;interface-&gt;owner
)paren
suffix:semicolon
)brace
macro_line|#if defined(ISDN_DEBUG_NET_DUMP) || defined(ISDN_DEBUG_MODEM_DUMP)
r_void
DECL|function|isdn_dumppkt
id|isdn_dumppkt
c_func
(paren
r_char
op_star
id|s
comma
id|u_char
op_star
id|p
comma
r_int
id|len
comma
r_int
id|dumplen
)paren
(brace
r_int
id|dumpc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(%d) &quot;
comma
id|s
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dumpc
op_assign
l_int|0
suffix:semicolon
(paren
id|dumpc
OL
id|dumplen
)paren
op_logical_and
(paren
id|len
)paren
suffix:semicolon
id|len
op_decrement
comma
id|dumpc
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p
op_increment
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * I picked the pattern-matching-functions from an old GNU-tar version (1.10)&n; * It was originally written and put to PD by rs@mirror.TMC.COM (Rich Salz)&n; */
r_static
r_int
DECL|function|isdn_star
id|isdn_star
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
(brace
r_while
c_loop
(paren
id|isdn_wildmat
c_func
(paren
id|s
comma
id|p
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
op_increment
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Shell-type Pattern-matching for incoming caller-Ids&n; * This function gets a string in s and checks, if it matches the pattern&n; * given in p.&n; *&n; * Return:&n; *   0 = match.&n; *   1 = no match.&n; *   2 = no match. Would eventually match, if s would be longer.&n; *&n; * Possible Patterns:&n; *&n; * &squot;?&squot;     matches one character&n; * &squot;*&squot;     matches zero or more characters&n; * [xyz]   matches the set of characters in brackets.&n; * [^xyz]  matches any single character not in the set of characters&n; */
r_static
r_int
DECL|function|isdn_wildmat
id|isdn_wildmat
c_func
(paren
r_char
op_star
id|s
comma
r_char
op_star
id|p
)paren
(brace
r_register
r_int
id|last
suffix:semicolon
r_register
r_int
id|matched
suffix:semicolon
r_register
r_int
id|reverse
suffix:semicolon
r_register
r_int
id|nostar
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|s
)paren
op_logical_and
op_logical_neg
(paren
op_star
id|p
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_star
id|p
suffix:semicolon
id|s
op_increment
comma
id|p
op_increment
)paren
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
l_char|&squot;&bslash;&bslash;&squot;
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * Literal match with following character,&n;&t;&t;&t;&t; * fall through.&n;&t;&t;&t;&t; */
id|p
op_increment
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_star
id|s
op_ne
op_star
id|p
)paren
r_return
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;?&squot;
suffix:colon
multiline_comment|/* Match anything. */
r_if
c_cond
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
(paren
l_int|2
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
l_char|&squot;*&squot;
suffix:colon
id|nostar
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Trailing star matches everything. */
r_return
(paren
op_star
op_increment
id|p
ques
c_cond
id|isdn_star
c_func
(paren
id|s
comma
id|p
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
r_case
l_char|&squot;[&squot;
suffix:colon
multiline_comment|/* [^....] means inverse character class. */
r_if
c_cond
(paren
(paren
id|reverse
op_assign
(paren
id|p
(braket
l_int|1
)braket
op_eq
l_char|&squot;^&squot;
)paren
)paren
)paren
id|p
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|last
op_assign
l_int|0
comma
id|matched
op_assign
l_int|0
suffix:semicolon
op_star
op_increment
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;]&squot;
)paren
suffix:semicolon
id|last
op_assign
op_star
id|p
)paren
multiline_comment|/* This next line requires a good C compiler. */
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;-&squot;
ques
c_cond
op_star
id|s
op_le
op_star
op_increment
id|p
op_logical_and
op_star
id|s
op_ge
id|last
suffix:colon
op_star
id|s
op_eq
op_star
id|p
)paren
id|matched
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|matched
op_eq
id|reverse
)paren
r_return
(paren
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;0&squot;
)paren
ques
c_cond
l_int|0
suffix:colon
id|nostar
suffix:semicolon
)brace
DECL|function|isdn_msncmp
r_int
id|isdn_msncmp
c_func
(paren
r_const
r_char
op_star
id|msn1
comma
r_const
r_char
op_star
id|msn2
)paren
(brace
r_char
id|TmpMsn1
(braket
id|ISDN_MSNLEN
)braket
suffix:semicolon
r_char
id|TmpMsn2
(braket
id|ISDN_MSNLEN
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|TmpMsn1
suffix:semicolon
op_star
id|msn1
op_logical_and
op_star
id|msn1
op_ne
l_char|&squot;:&squot;
suffix:semicolon
)paren
singleline_comment|// Strip off a SPID
op_star
id|p
op_increment
op_assign
op_star
id|msn1
op_increment
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|TmpMsn2
suffix:semicolon
op_star
id|msn2
op_logical_and
op_star
id|msn2
op_ne
l_char|&squot;:&squot;
suffix:semicolon
)paren
singleline_comment|// Strip off a SPID
op_star
id|p
op_increment
op_assign
op_star
id|msn2
op_increment
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
id|isdn_wildmat
c_func
(paren
id|TmpMsn1
comma
id|TmpMsn2
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|__drv_command
id|__drv_command
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
macro_line|#ifdef ISDN_DEBUG_COMMAND
r_switch
c_cond
(paren
id|c-&gt;command
)paren
(brace
r_case
id|ISDN_CMD_SETL2
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_SETL2 %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_SETL3 %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_DIAL %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_ACCEPTD %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_ACCEPTB %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_HANGUP %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_CLREAZ %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ISDN_CMD_SETEAZ %d/%ld&bslash;n&quot;
comma
id|c-&gt;driver
comma
id|c-&gt;arg
op_amp
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: cmd = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|c-&gt;command
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|drv-&gt;interface
op_member_access_from_pointer
id|command
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|__slot_command
id|__slot_command
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
id|isdn_ctrl
op_star
id|cmd
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|slot-&gt;drv
suffix:semicolon
r_return
id|__drv_command
c_func
(paren
id|drv
comma
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Begin of a CAPI like LL&lt;-&gt;HL interface, currently used only for &n; * supplementary service (CAPI 2.0 part III)&n; */
macro_line|#include &lt;linux/isdn/capicmd.h&gt;
r_int
DECL|function|isdn_capi_rec_hl_msg
id|isdn_capi_rec_hl_msg
c_func
(paren
id|capi_msg
op_star
id|cm
)paren
(brace
r_switch
c_cond
(paren
id|cm-&gt;Command
)paren
(brace
r_case
id|CAPI_FACILITY
suffix:colon
multiline_comment|/* in the moment only handled in tty */
r_return
id|isdn_tty_capi_facility
c_func
(paren
id|cm
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Get integer from char-pointer, set pointer to end of number&n; */
r_int
DECL|function|isdn_getnum
id|isdn_getnum
c_func
(paren
r_char
op_star
op_star
id|p
)paren
(brace
r_int
id|v
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|p
(braket
l_int|0
)braket
op_le
l_char|&squot;9&squot;
)paren
id|v
op_assign
(paren
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
id|v
op_star
l_int|10
)paren
)paren
op_plus
(paren
r_int
)paren
(paren
(paren
op_star
id|p
(braket
l_int|0
)braket
op_increment
)paren
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
r_static
r_struct
id|isdn_slot
op_star
DECL|function|get_slot_by_minor
id|get_slot_by_minor
c_func
(paren
r_int
id|minor
)paren
(brace
r_int
id|di
comma
id|ch
suffix:semicolon
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
r_for
c_loop
(paren
id|di
op_assign
l_int|0
suffix:semicolon
id|di
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|di
op_increment
)paren
(brace
id|drv
op_assign
id|get_drv_by_nr
c_func
(paren
id|di
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|drv-&gt;channels
suffix:semicolon
id|ch
op_increment
)paren
(brace
r_if
c_cond
(paren
id|minor
op_decrement
op_eq
l_int|0
)paren
r_goto
id|found
suffix:semicolon
)brace
id|put_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
id|found
suffix:colon
r_return
id|drv-&gt;slots
op_plus
id|ch
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|put_slot
id|put_slot
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
id|put_drv
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
)brace
r_static
r_char
op_star
DECL|function|isdn_statstr
id|isdn_statstr
c_func
(paren
r_void
)paren
(brace
r_static
r_char
id|istatbuf
(braket
l_int|2048
)braket
suffix:semicolon
r_struct
id|isdn_slot
op_star
id|slot
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sprintf
c_func
(paren
id|istatbuf
comma
l_string|&quot;idmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
id|slot-&gt;drv-&gt;id
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;- &quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nchmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|slot-&gt;ch
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;-1 &quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;ndrmap:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|slot-&gt;di
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;-1 &quot;
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nusage:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%d &quot;
comma
id|slot-&gt;usage
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;0 &quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nflags:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;0 &quot;
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;? &quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;nphone:&bslash;t&quot;
)paren
suffix:semicolon
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%s &quot;
comma
id|slot-&gt;num
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
id|p
op_assign
id|istatbuf
op_plus
id|strlen
c_func
(paren
id|istatbuf
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|istatbuf
suffix:semicolon
)brace
multiline_comment|/* &n; * /dev/isdninfo&n; */
r_void
DECL|function|isdn_info_update
id|isdn_info_update
c_func
(paren
r_void
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
op_star
(paren
id|p
op_member_access_from_pointer
r_private
)paren
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
id|p-&gt;next
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_status_open
id|isdn_status_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|infostruct
op_star
id|p
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|infostruct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;next
op_assign
(paren
r_char
op_star
)paren
id|dev-&gt;infochain
suffix:semicolon
id|p
op_member_access_from_pointer
r_private
op_assign
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
suffix:semicolon
id|dev-&gt;infochain
op_assign
id|p
suffix:semicolon
multiline_comment|/* At opening we allow a single update */
id|filep-&gt;private_data
op_assign
(paren
r_char
op_star
)paren
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_status_release
id|isdn_status_release
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|infostruct
op_star
id|p
op_assign
id|dev-&gt;infochain
suffix:semicolon
id|infostruct
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p
op_member_access_from_pointer
r_private
op_eq
(paren
r_char
op_star
)paren
op_amp
(paren
id|filep-&gt;private_data
)paren
)paren
(brace
r_if
c_cond
(paren
id|q
)paren
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
r_else
id|dev-&gt;infochain
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
(paren
id|infostruct
op_star
)paren
(paren
id|p-&gt;next
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: No private data while closing isdnctrl&bslash;n&quot;
)paren
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_status_read
id|isdn_status_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|retval
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file-&gt;private_data
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
(paren
id|dev-&gt;info_waitq
)paren
)paren
suffix:semicolon
)brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|p
op_assign
id|isdn_statstr
c_func
(paren
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|strlen
c_func
(paren
id|p
)paren
)paren
op_le
id|count
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
op_star
id|off
op_add_assign
id|len
suffix:semicolon
id|retval
op_assign
id|len
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_status_write
id|isdn_status_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|isdn_status_poll
id|isdn_status_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
(paren
id|dev-&gt;info_waitq
)paren
comma
id|wait
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_status_ioctl
id|isdn_status_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|uint
id|cmd
comma
id|ulong
id|arg
)paren
(brace
r_static
r_int
r_int
id|zero_ul
op_assign
l_int|0UL
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_struct
id|isdn_slot
op_star
id|slot
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCGETDVR
suffix:colon
r_return
(paren
id|TTY_DV
op_plus
(paren
id|NET_DV
op_lshift
l_int|8
)paren
op_plus
(paren
id|INF_DV
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_case
id|IIOCGETCPS
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
id|ulong
op_star
id|p
op_assign
(paren
id|ulong
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ulong
)paren
op_star
id|ISDN_MAX_CHANNELS
op_star
l_int|2
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot
)paren
(brace
id|put_user
c_func
(paren
id|slot-&gt;ibytes
comma
id|p
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|slot-&gt;obytes
comma
id|p
op_increment
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
)brace
r_else
(brace
id|put_user
c_func
(paren
id|zero_ul
comma
id|p
op_increment
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|zero_ul
comma
id|p
op_increment
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCNETGPN
suffix:colon
r_return
id|isdn_net_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|variable|isdn_status_fops
r_static
r_struct
id|file_operations
id|isdn_status_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|isdn_status_read
comma
dot
id|write
op_assign
id|isdn_status_write
comma
dot
id|poll
op_assign
id|isdn_status_poll
comma
dot
id|ioctl
op_assign
id|isdn_status_ioctl
comma
dot
id|open
op_assign
id|isdn_status_open
comma
dot
id|release
op_assign
id|isdn_status_release
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * /dev/isdnctrlX&n; */
r_static
r_int
DECL|function|isdn_ctrl_open
id|isdn_ctrl_open
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
r_int
id|minor
op_assign
id|iminor
c_func
(paren
id|ino
)paren
suffix:semicolon
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|get_slot_by_minor
c_func
(paren
id|minor
op_minus
id|ISDN_MINOR_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|isdn_lock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|slot
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ctrl_release
id|isdn_ctrl_release
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;profd
op_eq
id|current
)paren
id|dev-&gt;profd
op_assign
l_int|NULL
suffix:semicolon
id|isdn_unlock_driver
c_func
(paren
id|slot-&gt;drv
)paren
suffix:semicolon
id|put_slot
c_func
(paren
id|slot
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_ctrl_read
id|isdn_ctrl_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;drv-&gt;interface-&gt;readstat
)paren
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|slot-&gt;drv-&gt;st_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
id|len
op_assign
id|slot-&gt;drv-&gt;stavail
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|len
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|len
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|slot-&gt;drv-&gt;st_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|len
)paren
id|count
op_assign
id|len
suffix:semicolon
id|len
op_assign
id|slot-&gt;drv-&gt;interface
op_member_access_from_pointer
id|readstat
c_func
(paren
id|buf
comma
id|count
comma
l_int|1
comma
id|slot-&gt;di
comma
id|slot-&gt;ch
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
id|slot-&gt;drv-&gt;stavail
op_sub_assign
id|len
suffix:semicolon
)brace
r_else
(brace
id|isdn_BUG
c_func
(paren
)paren
suffix:semicolon
id|slot-&gt;drv-&gt;stavail
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|stat_lock
comma
id|flags
)paren
suffix:semicolon
op_star
id|off
op_add_assign
id|len
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|isdn_ctrl_write
id|isdn_ctrl_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|file-&gt;private_data
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
(brace
id|retval
op_assign
op_minus
id|ESPIPE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;drv-&gt;interface-&gt;writecmd
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
id|slot-&gt;drv-&gt;interface
op_member_access_from_pointer
id|writecmd
c_func
(paren
id|buf
comma
id|count
comma
l_int|1
comma
id|slot-&gt;di
comma
id|slot-&gt;ch
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|isdn_ctrl_poll
id|isdn_ctrl_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
op_assign
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|slot-&gt;drv-&gt;st_waitq
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|slot-&gt;drv-&gt;stavail
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_ctrl_ioctl
id|isdn_ctrl_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|uint
id|cmd
comma
id|ulong
id|arg
)paren
(brace
id|isdn_ctrl
id|c
suffix:semicolon
r_int
id|drvidx
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
multiline_comment|/* save stack space */
r_union
(brace
r_char
id|bname
(braket
l_int|20
)braket
suffix:semicolon
id|isdn_ioctl_struct
id|iocts
suffix:semicolon
)brace
id|iocpar
suffix:semicolon
DECL|macro|iocts
mdefine_line|#define iocts iocpar.iocts
DECL|macro|bname
mdefine_line|#define bname iocpar.bname
multiline_comment|/*&n; * isdn net devices manage lots of configuration variables as linked lists.&n; * Those lists must only be manipulated from user space. Some of the ioctl&squot;s&n; * service routines access user space and are not atomic. Therefor, ioctl&squot;s&n; * manipulating the lists and ioctl&squot;s sleeping while accessing the lists&n; * are serialized by means of a semaphore.&n; */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IIOCNETAIF
suffix:colon
r_case
id|IIOCNETASL
suffix:colon
r_case
id|IIOCNETDIF
suffix:colon
r_case
id|IIOCNETSCF
suffix:colon
r_case
id|IIOCNETGCF
suffix:colon
r_case
id|IIOCNETANM
suffix:colon
r_case
id|IIOCNETGNM
suffix:colon
r_case
id|IIOCNETDNM
suffix:colon
r_case
id|IIOCNETDIL
suffix:colon
r_case
id|IIOCNETALN
suffix:colon
r_case
id|IIOCNETDLN
suffix:colon
r_case
id|IIOCNETHUP
suffix:colon
r_return
id|isdn_net_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|IIOCSETVER
suffix:colon
id|dev-&gt;net_verbose
op_assign
id|arg
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isdn: Verbose-Level is %d&bslash;n&quot;
comma
id|dev-&gt;net_verbose
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETGST
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
id|dev-&gt;global_flags
op_or_assign
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
id|isdn_net_hangup_all
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;global_flags
op_and_assign
op_complement
id|ISDN_GLOBAL_STOPPED
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSETBRJ
suffix:colon
id|drvidx
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|iocts.drvid
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|iocts.drvid
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|drvidx
op_assign
id|isdn_drv_lookup
c_func
(paren
id|iocts.drvid
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|iocts.arg
)paren
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_or_assign
id|DRV_FLAG_REJBUS
suffix:semicolon
r_else
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
id|DRV_FLAG_REJBUS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IIOCSIGPRF
suffix:colon
id|dev-&gt;profd
op_assign
id|current
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCGETPRF
suffix:colon
multiline_comment|/* Get all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
op_plus
id|ISDN_LMSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|ISDN_MODEM_NUMREG
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_NUMREG
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|ISDN_MSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.plmsn
comma
id|ISDN_LMSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_LMSNLEN
suffix:semicolon
)brace
r_return
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
op_plus
id|ISDN_LMSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETPRF
suffix:colon
multiline_comment|/* Set all Modem-Profiles */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|arg
comma
(paren
id|ISDN_MODEM_NUMREG
op_plus
id|ISDN_MSNLEN
op_plus
id|ISDN_LMSNLEN
)paren
op_star
id|ISDN_MAX_CHANNELS
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.profile
comma
id|p
comma
id|ISDN_MODEM_NUMREG
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MODEM_NUMREG
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.plmsn
comma
id|p
comma
id|ISDN_LMSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_LMSNLEN
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|isdn_mdm.info
(braket
id|i
)braket
dot
id|emu.pmsn
comma
id|p
comma
id|ISDN_MSNLEN
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|ISDN_MSNLEN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IIOCSETMAP
suffix:colon
r_case
id|IIOCGETMAP
suffix:colon
multiline_comment|/* Set/Get MSN-&gt;EAZ-Mapping for a driver */
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|drvidx
op_assign
id|isdn_drv_lookup
c_func
(paren
id|iocts.drvid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|IIOCSETMAP
)paren
(brace
r_int
id|loop
op_assign
l_int|1
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loop
)paren
(brace
r_int
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|p
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|get_user
c_func
(paren
id|bname
(braket
id|j
)braket
comma
id|p
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bname
(braket
id|j
)braket
)paren
(brace
r_case
l_char|&squot;&bslash;0&squot;
suffix:colon
id|loop
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Fall through */
r_case
l_char|&squot;,&squot;
suffix:colon
id|bname
(braket
id|j
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
comma
id|bname
)paren
suffix:semicolon
id|j
op_assign
id|ISDN_MSNLEN
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|j
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_ge
id|ISDN_MSNLEN
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|i
OG
l_int|9
)paren
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|p
op_assign
(paren
r_char
op_star
)paren
id|iocts.arg
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|bname
comma
l_string|&quot;%s%s&quot;
comma
id|strlen
c_func
(paren
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
)paren
ques
c_cond
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|msn2eaz
(braket
id|i
)braket
suffix:colon
l_string|&quot;_&quot;
comma
(paren
id|i
OL
l_int|9
)paren
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&bslash;0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|p
comma
id|bname
comma
id|strlen
c_func
(paren
id|bname
)paren
op_plus
l_int|1
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|bname
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|IIOCDBGVAR
suffix:colon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
(paren
r_char
op_star
)paren
op_amp
id|dev
comma
r_sizeof
(paren
id|ulong
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_amp
id|IIOCDRVCTL
)paren
op_eq
id|IIOCDRVCTL
)paren
id|cmd
op_assign
(paren
(paren
id|cmd
op_rshift
id|_IOC_NRSHIFT
)paren
op_amp
id|_IOC_NRMASK
)paren
op_amp
id|ISDN_DRVIOCTL_MASK
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts
comma
(paren
r_char
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|drvidx
op_assign
id|isdn_drv_lookup
c_func
(paren
id|iocts.drvid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drvidx
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|c.driver
op_assign
id|drvidx
suffix:semicolon
id|c.command
op_assign
id|ISDN_CMD_IOCTL
suffix:semicolon
id|c.arg
op_assign
id|cmd
suffix:semicolon
id|memcpy
c_func
(paren
id|c.parm.num
comma
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|__drv_command
c_func
(paren
id|drivers
(braket
id|drvidx
)braket
comma
op_amp
id|c
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|iocts.arg
comma
id|c.parm.num
comma
r_sizeof
(paren
id|ulong
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|iocts
comma
r_sizeof
(paren
id|isdn_ioctl_struct
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|macro|iocts
macro_line|#undef iocts
DECL|macro|bname
macro_line|#undef bname
)brace
DECL|variable|isdn_ctrl_fops
r_static
r_struct
id|file_operations
id|isdn_ctrl_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|isdn_ctrl_read
comma
dot
id|write
op_assign
id|isdn_ctrl_write
comma
dot
id|poll
op_assign
id|isdn_ctrl_poll
comma
dot
id|ioctl
op_assign
id|isdn_ctrl_ioctl
comma
dot
id|open
op_assign
id|isdn_ctrl_open
comma
dot
id|release
op_assign
id|isdn_ctrl_release
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * file_operations for major 45, /dev/isdn*&n; * stolen from drivers/char/misc.c&n; */
r_static
r_int
DECL|function|isdn_open
id|isdn_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_struct
id|file_operations
op_star
id|old_fops
comma
op_star
id|new_fops
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_ge
id|ISDN_MINOR_CTRL
op_logical_and
id|minor
op_le
id|ISDN_MINOR_CTRLMAX
)paren
id|new_fops
op_assign
id|fops_get
c_func
(paren
op_amp
id|isdn_ctrl_fops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
r_else
r_if
c_cond
(paren
id|minor
op_ge
id|ISDN_MINOR_PPP
op_logical_and
id|minor
op_le
id|ISDN_MINOR_PPPMAX
)paren
id|new_fops
op_assign
id|fops_get
c_func
(paren
op_amp
id|isdn_ppp_fops
)paren
suffix:semicolon
macro_line|#endif
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|ISDN_MINOR_STATUS
)paren
id|new_fops
op_assign
id|fops_get
c_func
(paren
op_amp
id|isdn_status_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_fops
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|old_fops
op_assign
id|file-&gt;f_op
suffix:semicolon
id|file-&gt;f_op
op_assign
id|new_fops
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_op-&gt;open
)paren
(brace
id|err
op_assign
id|file-&gt;f_op
op_member_access_from_pointer
id|open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|fops_put
c_func
(paren
id|file-&gt;f_op
)paren
suffix:semicolon
id|file-&gt;f_op
op_assign
id|fops_get
c_func
(paren
id|old_fops
)paren
suffix:semicolon
)brace
)brace
id|fops_put
c_func
(paren
id|old_fops
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|isdn_fops
r_static
r_struct
id|file_operations
id|isdn_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|isdn_open
comma
)brace
suffix:semicolon
r_char
op_star
DECL|function|isdn_map_eaz2msn
id|isdn_map_eaz2msn
c_func
(paren
r_char
op_star
id|msn
comma
r_int
id|di
)paren
(brace
r_struct
id|isdn_driver
op_star
id|this
op_assign
id|drivers
(braket
id|di
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|msn
)paren
op_eq
l_int|1
)paren
(brace
id|i
op_assign
id|msn
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ge
l_int|0
)paren
op_logical_and
(paren
id|i
op_le
l_int|9
)paren
)paren
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
)paren
r_return
(paren
id|this-&gt;msn2eaz
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
(paren
id|msn
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an unused ISDN-channel, whose feature-flags match the&n; * given L2- and L3-protocols.&n; */
r_struct
id|isdn_slot
op_star
DECL|function|isdn_get_free_slot
id|isdn_get_free_slot
c_func
(paren
r_int
id|usage
comma
r_int
id|l2_proto
comma
r_int
id|l3_proto
comma
r_int
id|pre_dev
comma
r_int
id|pre_chan
comma
r_char
op_star
id|msn
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
suffix:semicolon
r_struct
id|isdn_slot
op_star
id|slot
suffix:semicolon
r_int
id|di
comma
id|ch
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|features
suffix:semicolon
id|features
op_assign
(paren
(paren
l_int|1
op_lshift
id|l2_proto
)paren
op_or
(paren
l_int|0x10000
op_lshift
id|l3_proto
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|di
op_assign
l_int|0
suffix:semicolon
id|di
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|di
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pre_dev
op_ge
l_int|0
op_logical_and
id|pre_dev
op_ne
id|di
)paren
r_continue
suffix:semicolon
id|drv
op_assign
id|get_drv_by_nr
c_func
(paren
id|di
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|drv-&gt;fi.state
op_ne
id|ST_DRV_RUNNING
)paren
r_goto
id|put
suffix:semicolon
r_if
c_cond
(paren
(paren
id|drv-&gt;features
op_amp
id|features
)paren
op_ne
id|features
)paren
r_goto
id|put
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|drv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|drv-&gt;channels
suffix:semicolon
id|ch
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pre_chan
op_ge
l_int|0
op_logical_and
id|pre_chan
op_ne
id|ch
)paren
r_continue
suffix:semicolon
id|slot
op_assign
op_amp
id|drv-&gt;slots
(braket
id|ch
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|USG_NONE
c_func
(paren
id|slot-&gt;usage
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|slot-&gt;usage
op_amp
id|ISDN_USAGE_DISABLED
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|isdn_map_eaz2msn
c_func
(paren
id|msn
comma
id|drv-&gt;di
)paren
comma
l_string|&quot;-&quot;
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|put
suffix:colon
id|put_drv
c_func
(paren
id|drv
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
id|found
suffix:colon
id|slot-&gt;usage
op_assign
id|usage
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|drv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_SLOT_BIND
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|slot
suffix:semicolon
)brace
multiline_comment|/*&n; * Set state of ISDN-channel to &squot;unused&squot;&n; */
r_void
DECL|function|isdn_slot_free
id|isdn_slot_free
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_SLOT_UNBIND
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Return: length of data on success, -ERRcode on failure.&n; */
r_int
DECL|function|isdn_slot_write
id|isdn_slot_write
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_DATA_REQ
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_add_channels
id|isdn_add_channels
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
comma
r_int
id|n
)paren
(brace
r_struct
id|isdn_slot
op_star
id|slot
suffix:semicolon
r_int
id|ch
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;channels
op_plus
id|n
OG
id|ISDN_MAX_CHANNELS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;register_isdn: Max. %d channels supported&bslash;n&quot;
comma
id|ISDN_MAX_CHANNELS
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev-&gt;channels
op_add_assign
id|n
suffix:semicolon
id|drv-&gt;slots
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isdn_slot
)paren
op_star
id|n
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drv-&gt;slots
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|n
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|slot
op_assign
id|drv-&gt;slots
op_plus
id|ch
suffix:semicolon
id|slot-&gt;ch
op_assign
id|ch
suffix:semicolon
id|slot-&gt;di
op_assign
id|drv-&gt;di
suffix:semicolon
id|slot-&gt;drv
op_assign
id|drv
suffix:semicolon
id|strcpy
c_func
(paren
id|slot-&gt;num
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
id|slot-&gt;fi.fsm
op_assign
op_amp
id|slot_fsm
suffix:semicolon
id|slot-&gt;fi.state
op_assign
id|ST_SLOT_NULL
suffix:semicolon
id|slot-&gt;fi.debug
op_assign
l_int|1
suffix:semicolon
id|slot-&gt;fi.userdata
op_assign
id|slot
suffix:semicolon
id|slot-&gt;fi.printdebug
op_assign
id|slot_debug
suffix:semicolon
)brace
id|drv-&gt;channels
op_assign
id|n
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Low-level-driver registration&n; */
macro_line|#if defined(CONFIG_ISDN_DIVERSION) || defined(CONFIG_ISDN_DIVERSION_MODULE)
DECL|function|map_drvname
r_static
r_char
op_star
id|map_drvname
c_func
(paren
r_int
id|di
)paren
(brace
r_if
c_cond
(paren
(paren
id|di
OL
l_int|0
)paren
op_logical_or
(paren
id|di
op_ge
id|ISDN_MAX_DRIVERS
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|dev-&gt;drvid
(braket
id|di
)braket
suffix:semicolon
multiline_comment|/* driver name */
)brace
multiline_comment|/* map_drvname */
DECL|function|map_namedrv
r_static
r_int
id|map_namedrv
c_func
(paren
r_char
op_star
id|id
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|dev-&gt;drvid
(braket
id|i
)braket
comma
id|id
)paren
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* map_namedrv */
DECL|function|DIVERT_REG_NAME
r_int
id|DIVERT_REG_NAME
c_func
(paren
id|isdn_divert_if
op_star
id|i_div
)paren
(brace
r_if
c_cond
(paren
id|i_div-&gt;if_magic
op_ne
id|DIVERT_IF_MAGIC
)paren
r_return
id|DIVERT_VER_ERR
suffix:semicolon
r_switch
c_cond
(paren
id|i_div-&gt;cmd
)paren
(brace
r_case
id|DIVERT_CMD_REL
suffix:colon
r_if
c_cond
(paren
id|divert_if
op_ne
id|i_div
)paren
r_return
id|DIVERT_REL_ERR
suffix:semicolon
id|divert_if
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* free interface */
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|DIVERT_NO_ERR
suffix:semicolon
r_case
id|DIVERT_CMD_REG
suffix:colon
r_if
c_cond
(paren
id|divert_if
)paren
r_return
id|DIVERT_REG_ERR
suffix:semicolon
id|i_div-&gt;ll_cmd
op_assign
id|isdn_command
suffix:semicolon
multiline_comment|/* set command function */
id|i_div-&gt;drv_to_name
op_assign
id|map_drvname
suffix:semicolon
id|i_div-&gt;name_to_drv
op_assign
id|map_namedrv
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|divert_if
op_assign
id|i_div
suffix:semicolon
multiline_comment|/* remember interface */
r_return
id|DIVERT_NO_ERR
suffix:semicolon
r_default
suffix:colon
r_return
id|DIVERT_CMD_ERR
suffix:semicolon
)brace
)brace
multiline_comment|/* DIVERT_REG_NAME */
DECL|variable|DIVERT_REG_NAME
id|EXPORT_SYMBOL
c_func
(paren
id|DIVERT_REG_NAME
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|register_isdn
id|EXPORT_SYMBOL
c_func
(paren
id|register_isdn
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
DECL|variable|isdn_ppp_register_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|isdn_ppp_register_compressor
)paren
suffix:semicolon
DECL|variable|isdn_ppp_unregister_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|isdn_ppp_unregister_compressor
)paren
suffix:semicolon
macro_line|#endif
r_int
DECL|function|isdn_slot_maxbufsize
id|isdn_slot_maxbufsize
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
r_return
id|slot-&gt;drv-&gt;maxbufsize
suffix:semicolon
)brace
r_int
DECL|function|isdn_slot_hdrlen
id|isdn_slot_hdrlen
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
r_return
id|slot-&gt;drv-&gt;interface-&gt;hl_hdrlen
suffix:semicolon
)brace
r_char
op_star
DECL|function|isdn_slot_map_eaz2msn
id|isdn_slot_map_eaz2msn
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_char
op_star
id|msn
)paren
(brace
r_return
id|isdn_map_eaz2msn
c_func
(paren
id|msn
comma
id|slot-&gt;di
)paren
suffix:semicolon
)brace
r_int
DECL|function|isdn_slot_command
id|isdn_slot_command
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_int
id|cmd
comma
id|isdn_ctrl
op_star
id|ctrl
)paren
(brace
id|ctrl-&gt;command
op_assign
id|cmd
suffix:semicolon
id|ctrl-&gt;driver
op_assign
id|slot-&gt;di
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ISDN_CMD_SETL2
suffix:colon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_case
id|ISDN_CMD_PROT_IO
suffix:colon
id|ctrl-&gt;arg
op_and_assign
op_complement
l_int|0xff
suffix:semicolon
id|ctrl-&gt;arg
op_or_assign
id|slot-&gt;ch
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;global_flags
op_amp
id|ISDN_GLOBAL_STOPPED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* fall through */
r_default
suffix:colon
id|ctrl-&gt;arg
op_assign
id|slot-&gt;ch
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ISDN_CMD_CLREAZ
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_CLREAZ
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_SETEAZ
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_SETEAZ
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_SETL2
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_SETL2
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_SETL3
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_SETL3
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_DIAL
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_DIAL
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTD
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_ACCEPTD
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_ACCEPTB
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_ACCEPTB
comma
id|ctrl
)paren
suffix:semicolon
r_case
id|ISDN_CMD_HANGUP
suffix:colon
r_return
id|fsm_event
c_func
(paren
op_amp
id|slot-&gt;fi
comma
id|EV_CMD_HANGUP
comma
id|ctrl
)paren
suffix:semicolon
)brace
id|HERE
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|isdn_slot_dial
id|isdn_slot_dial
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|dial_info
op_star
id|dial
)paren
(brace
id|isdn_ctrl
id|cmd
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_char
op_star
id|msn
op_assign
id|isdn_slot_map_eaz2msn
c_func
(paren
id|slot
comma
id|dial-&gt;msn
)paren
suffix:semicolon
multiline_comment|/* check for DOV */
r_if
c_cond
(paren
id|dial-&gt;si1
op_eq
l_int|7
op_logical_and
id|tolower
c_func
(paren
id|dial-&gt;phone
(braket
l_int|0
)braket
)paren
op_eq
l_char|&squot;v&squot;
)paren
(brace
multiline_comment|/* DOV call */
id|dial-&gt;si1
op_assign
l_int|1
suffix:semicolon
id|dial-&gt;phone
op_increment
suffix:semicolon
multiline_comment|/* skip v/V */
)brace
id|strcpy
c_func
(paren
id|slot-&gt;num
comma
id|dial-&gt;phone
)paren
suffix:semicolon
id|slot-&gt;usage
op_or_assign
id|ISDN_USAGE_OUTGOING
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_CLREAZ
comma
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.num
comma
id|msn
)paren
suffix:semicolon
id|retval
op_assign
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_SETEAZ
comma
op_amp
id|cmd
)paren
suffix:semicolon
id|cmd.arg
op_assign
id|dial-&gt;l2_proto
op_lshift
l_int|8
suffix:semicolon
id|cmd.parm.fax
op_assign
id|dial-&gt;fax
suffix:semicolon
id|retval
op_assign
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_SETL2
comma
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|cmd.arg
op_assign
id|dial-&gt;l3_proto
op_lshift
l_int|8
suffix:semicolon
id|retval
op_assign
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_SETL3
comma
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|cmd.parm.setup.si1
op_assign
id|dial-&gt;si1
suffix:semicolon
id|cmd.parm.setup.si2
op_assign
id|dial-&gt;si2
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.setup.eazmsn
comma
id|msn
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd.parm.setup.phone
comma
id|dial-&gt;phone
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ISDN: Dialing %s -&gt; %s (SI %d/%d) (B %d/%d)&bslash;n&quot;
comma
id|cmd.parm.setup.eazmsn
comma
id|cmd.parm.setup.phone
comma
id|cmd.parm.setup.si1
comma
id|cmd.parm.setup.si2
comma
id|dial-&gt;l2_proto
comma
id|dial-&gt;l3_proto
)paren
suffix:semicolon
r_return
id|isdn_slot_command
c_func
(paren
id|slot
comma
id|ISDN_CMD_DIAL
comma
op_amp
id|cmd
)paren
suffix:semicolon
)brace
r_int
DECL|function|isdn_hard_header_len
id|isdn_hard_header_len
c_func
(paren
r_void
)paren
(brace
r_int
id|drvidx
suffix:semicolon
r_int
id|max
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|drvidx
op_assign
l_int|0
suffix:semicolon
id|drvidx
OL
id|ISDN_MAX_DRIVERS
suffix:semicolon
id|drvidx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|drivers
(braket
id|drvidx
)braket
op_logical_and
id|max
OL
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
)paren
(brace
id|max
op_assign
id|drivers
(braket
id|drvidx
)braket
op_member_access_from_pointer
id|interface-&gt;hl_hdrlen
suffix:semicolon
)brace
)brace
r_return
id|max
suffix:semicolon
)brace
DECL|function|isdn_init_devfs
r_static
r_void
id|isdn_init_devfs
c_func
(paren
r_void
)paren
(brace
id|devfs_mk_dir
c_func
(paren
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ISDN_PPP
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|devfs_mk_cdev
c_func
(paren
id|MKDEV
c_func
(paren
id|ISDN_MAJOR
comma
id|ISDN_MINOR_PPP
op_plus
id|i
)paren
comma
l_int|0600
op_or
id|S_IFCHR
comma
l_string|&quot;isdn/ippp%d&quot;
comma
id|i
)paren
suffix:semicolon
)brace
macro_line|#endif
id|devfs_mk_cdev
c_func
(paren
id|MKDEV
c_func
(paren
id|ISDN_MAJOR
comma
id|ISDN_MINOR_STATUS
)paren
comma
l_int|0600
op_or
id|S_IFCHR
comma
l_string|&quot;isdn/isdninfo&quot;
)paren
suffix:semicolon
id|devfs_mk_cdev
c_func
(paren
id|MKDEV
c_func
(paren
id|ISDN_MAJOR
comma
id|ISDN_MINOR_CTRL
)paren
comma
l_int|0600
op_or
id|S_IFCHR
comma
l_string|&quot;isdn/isdnctrl&quot;
)paren
suffix:semicolon
)brace
DECL|function|isdn_cleanup_devfs
r_static
r_void
id|isdn_cleanup_devfs
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISDN_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|devfs_remove
c_func
(paren
l_string|&quot;isdn/ippp%d&quot;
comma
id|i
)paren
suffix:semicolon
macro_line|#endif
id|devfs_remove
c_func
(paren
l_string|&quot;isdn/isdninfo&quot;
)paren
suffix:semicolon
id|devfs_remove
c_func
(paren
l_string|&quot;isdn/isdnctrl&quot;
)paren
suffix:semicolon
id|devfs_remove
c_func
(paren
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocate and initialize all data, register modem-devices&n; */
DECL|function|isdn_init
r_static
r_int
id|__init
id|isdn_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|fsm_new
c_func
(paren
op_amp
id|slot_fsm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err
suffix:semicolon
id|retval
op_assign
id|fsm_new
c_func
(paren
op_amp
id|drv_fsm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|err_slot_fsm
suffix:semicolon
id|dev
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_drv_fsm
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|dev
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|dev-&gt;sem
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev-&gt;info_waitq
)paren
suffix:semicolon
id|retval
op_assign
id|register_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
comma
op_amp
id|isdn_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register control devices&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_vfree
suffix:semicolon
)brace
id|isdn_init_devfs
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
id|isdn_tty_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not register tty devices&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_cleanup_devfs
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ISDN_PPP
id|retval
op_assign
id|isdn_ppp_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;isdn: Could not create PPP-device-structs&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_tty_modem
suffix:semicolon
)brace
macro_line|#endif                          /* CONFIG_ISDN_PPP */
id|isdn_net_lib_init
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ISDN subsystem initialized&bslash;n&quot;
)paren
suffix:semicolon
id|isdn_info_update
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_tty_modem
suffix:colon
id|isdn_tty_exit
c_func
(paren
)paren
suffix:semicolon
id|err_cleanup_devfs
suffix:colon
id|isdn_cleanup_devfs
c_func
(paren
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
id|err_vfree
suffix:colon
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_drv_fsm
suffix:colon
id|fsm_free
c_func
(paren
op_amp
id|drv_fsm
)paren
suffix:semicolon
id|err_slot_fsm
suffix:colon
id|fsm_free
c_func
(paren
op_amp
id|slot_fsm
)paren
suffix:semicolon
id|err
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Unload module&n; */
DECL|function|isdn_exit
r_static
r_void
id|__exit
id|isdn_exit
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_ISDN_PPP
id|isdn_ppp_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|isdn_net_lib_exit
c_func
(paren
)paren
suffix:semicolon
id|isdn_tty_exit
c_func
(paren
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|ISDN_MAJOR
comma
l_string|&quot;isdn&quot;
)paren
suffix:semicolon
id|isdn_cleanup_devfs
c_func
(paren
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|fsm_free
c_func
(paren
op_amp
id|drv_fsm
)paren
suffix:semicolon
id|fsm_free
c_func
(paren
op_amp
id|slot_fsm
)paren
suffix:semicolon
)brace
DECL|variable|isdn_init
id|module_init
c_func
(paren
id|isdn_init
)paren
suffix:semicolon
DECL|variable|isdn_exit
id|module_exit
c_func
(paren
id|isdn_exit
)paren
suffix:semicolon
r_static
r_void
DECL|function|isdn_v110_add_features
id|isdn_v110_add_features
c_func
(paren
r_struct
id|isdn_driver
op_star
id|drv
)paren
(brace
r_int
r_int
id|features
op_assign
id|drv-&gt;features
op_rshift
id|ISDN_FEATURE_L2_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|features
op_amp
id|ISDN_FEATURE_L2_TRANS
)paren
id|drv-&gt;features
op_or_assign
(paren
id|ISDN_FEATURE_L2_V11096
op_or
id|ISDN_FEATURE_L2_V11019
op_or
id|ISDN_FEATURE_L2_V11038
)paren
op_lshift
id|ISDN_FEATURE_L2_SHIFT
suffix:semicolon
)brace
r_static
r_void
DECL|function|__isdn_v110_open
id|__isdn_v110_open
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;iv110.v110emu
)paren
r_return
suffix:semicolon
id|isdn_v110_open
c_func
(paren
id|slot
comma
op_amp
id|slot-&gt;iv110
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|__isdn_v110_close
id|__isdn_v110_close
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;iv110.v110emu
)paren
r_return
suffix:semicolon
id|isdn_v110_close
c_func
(paren
id|slot
comma
op_amp
id|slot-&gt;iv110
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|__isdn_v110_bsent
id|__isdn_v110_bsent
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_int
id|pr
comma
id|isdn_ctrl
op_star
id|c
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;iv110.v110emu
)paren
(brace
id|do_event_cb
c_func
(paren
id|slot
comma
id|pr
comma
id|c
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|isdn_v110_bsent
c_func
(paren
id|slot
comma
op_amp
id|slot-&gt;iv110
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Intercept command from Linklevel to Lowlevel.&n; * If layer 2 protocol is V.110 and this is not supported by current&n; * lowlevel-driver, use driver&squot;s transparent mode and handle V.110 in&n; * linklevel instead.&n; */
r_static
r_void
DECL|function|isdn_v110_setl2
id|isdn_v110_setl2
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
id|isdn_ctrl
op_star
id|cmd
)paren
(brace
r_struct
id|isdn_driver
op_star
id|drv
op_assign
id|slot-&gt;drv
suffix:semicolon
r_int
r_int
id|l2prot
op_assign
(paren
id|cmd-&gt;arg
op_rshift
l_int|8
)paren
op_amp
l_int|255
suffix:semicolon
r_int
r_int
id|l2_feature
op_assign
l_int|1
op_lshift
id|l2prot
suffix:semicolon
r_int
r_int
id|features
op_assign
id|drv-&gt;interface-&gt;features
op_rshift
id|ISDN_FEATURE_L2_SHIFT
suffix:semicolon
r_switch
c_cond
(paren
id|l2prot
)paren
(brace
r_case
id|ISDN_PROTO_L2_V11096
suffix:colon
r_case
id|ISDN_PROTO_L2_V11019
suffix:colon
r_case
id|ISDN_PROTO_L2_V11038
suffix:colon
multiline_comment|/* If V.110 requested, but not supported by&n;&t;&t; * HL-driver, set emulator-flag and change&n;&t;&t; * Layer-2 to transparent&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|features
op_amp
id|l2_feature
)paren
)paren
(brace
id|slot-&gt;iv110.v110emu
op_assign
id|l2prot
suffix:semicolon
id|cmd-&gt;arg
op_assign
(paren
id|cmd-&gt;arg
op_amp
l_int|255
)paren
op_or
(paren
id|ISDN_PROTO_L2_TRANS
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|slot-&gt;iv110.v110emu
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|isdn_v110_data_ind
id|isdn_v110_data_ind
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;iv110.v110emu
)paren
r_goto
id|recv
suffix:semicolon
id|skb
op_assign
id|isdn_v110_decode
c_func
(paren
id|slot-&gt;iv110.v110
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
l_int|0
suffix:semicolon
id|recv
suffix:colon
r_if
c_cond
(paren
id|slot-&gt;event_cb
)paren
id|slot
op_member_access_from_pointer
id|event_cb
c_func
(paren
id|slot
comma
id|EV_DATA_IND
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|isdn_v110_data_req
id|isdn_v110_data_req
c_func
(paren
r_struct
id|isdn_slot
op_star
id|slot
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|retval
comma
id|v110_ret
suffix:semicolon
r_struct
id|sk_buff
op_star
id|nskb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;iv110.v110emu
)paren
r_return
id|isdn_writebuf_skb
c_func
(paren
id|slot
comma
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|slot-&gt;iv110.v110use
)paren
suffix:semicolon
id|nskb
op_assign
id|isdn_v110_encode
c_func
(paren
id|slot-&gt;iv110.v110
comma
id|skb
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|slot-&gt;iv110.v110use
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nskb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|v110_ret
op_assign
op_star
(paren
r_int
op_star
)paren
id|nskb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|nskb
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nskb-&gt;len
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|nskb
)paren
suffix:semicolon
r_return
id|v110_ret
suffix:semicolon
)brace
id|retval
op_assign
id|isdn_writebuf_skb
c_func
(paren
id|slot
comma
id|nskb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_le
l_int|0
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|nskb
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|slot-&gt;iv110.v110use
)paren
suffix:semicolon
id|slot-&gt;iv110.v110-&gt;skbuser
op_increment
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|slot-&gt;iv110.v110use
)paren
suffix:semicolon
multiline_comment|/* For V.110 return unencoded data length */
r_return
id|v110_ret
suffix:semicolon
)brace
eof
