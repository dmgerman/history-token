multiline_comment|/* &n; *  FiberChannel transport specific attributes exported to sysfs.&n; *&n; *  Copyright (c) 2003 Silicon Graphics, Inc.  All rights reserved.&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; *  ========&n; *&n; *  Copyright (C) 2004-2005   James Smart, Emulex Corporation&n; *    Rewrite for host, target, device, and remote port attributes,&n; *    statistics, and service functions...&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;scsi/scsi_device.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &lt;scsi/scsi_transport.h&gt;
macro_line|#include &lt;scsi/scsi_transport_fc.h&gt;
macro_line|#include &quot;scsi_priv.h&quot;
DECL|macro|FC_PRINTK
mdefine_line|#define FC_PRINTK(x, l, f, a...)&t;printk(l &quot;scsi(%d:%d:%d:%d): &quot; f, (x)-&gt;host-&gt;host_no, (x)-&gt;channel, (x)-&gt;id, (x)-&gt;lun , ##a)
multiline_comment|/*&n; * Redefine so that we can have same named attributes in the&n; * sdev/starget/host objects.&n; */
DECL|macro|FC_CLASS_DEVICE_ATTR
mdefine_line|#define FC_CLASS_DEVICE_ATTR(_prefix,_name,_mode,_show,_store)&t;&t;&bslash;&n;struct class_device_attribute class_device_attr_##_prefix##_##_name = &t;&bslash;&n;&t;__ATTR(_name,_mode,_show,_store)
DECL|macro|fc_enum_name_search
mdefine_line|#define fc_enum_name_search(title, table_type, table)&t;&t;&t;&bslash;&n;static const char *get_fc_##title##_name(enum table_type table_key)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;char *name = NULL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&t;&bslash;&n;&t;&t;if (table[i].value == table_key) {&t;&t;&t;&bslash;&n;&t;&t;&t;name = table[i].name;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return name;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_enum_name_match
mdefine_line|#define fc_enum_name_match(title, table_type, table)&t;&t;&t;&bslash;&n;static int get_fc_##title##_match(const char *table_key,&t;&t;&bslash;&n;&t;&t;enum table_type *value)&t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&t;&bslash;&n;&t;&t;if (strncmp(table_key, table[i].name,&t;&t;&t;&bslash;&n;&t;&t;&t;&t;table[i].matchlen) == 0) {&t;&t;&bslash;&n;&t;&t;&t;*value = table[i].value;&t;&t;&t;&bslash;&n;&t;&t;&t;return 0; /* success */&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return 1; /* failure */&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/* Convert fc_port_type values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_port_type
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_type_names
)brace
id|fc_port_type_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTTYPE_UNKNOWN
comma
l_string|&quot;Unknown&quot;
)brace
comma
(brace
id|FC_PORTTYPE_OTHER
comma
l_string|&quot;Other&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NOTPRESENT
comma
l_string|&quot;Not Present&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NPORT
comma
l_string|&quot;NPort (fabric via point-to-point)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NLPORT
comma
l_string|&quot;NLPort (fabric via loop)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_LPORT
comma
l_string|&quot;LPort (private loop)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_PTP
comma
l_string|&quot;Point-To-Point (direct nport connection&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|port_type
comma
id|fc_port_type
comma
id|fc_port_type_names
)paren
DECL|macro|FC_PORTTYPE_MAX_NAMELEN
mdefine_line|#define FC_PORTTYPE_MAX_NAMELEN&t;&t;50
multiline_comment|/* Convert fc_port_state values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_port_state
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_state_names
)brace
id|fc_port_state_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTSTATE_UNKNOWN
comma
l_string|&quot;Unknown&quot;
)brace
comma
(brace
id|FC_PORTSTATE_NOTPRESENT
comma
l_string|&quot;Not Present&quot;
)brace
comma
(brace
id|FC_PORTSTATE_ONLINE
comma
l_string|&quot;Online&quot;
)brace
comma
(brace
id|FC_PORTSTATE_OFFLINE
comma
l_string|&quot;Offline&quot;
)brace
comma
(brace
id|FC_PORTSTATE_BLOCKED
comma
l_string|&quot;Blocked&quot;
)brace
comma
(brace
id|FC_PORTSTATE_BYPASSED
comma
l_string|&quot;Bypassed&quot;
)brace
comma
(brace
id|FC_PORTSTATE_DIAGNOSTICS
comma
l_string|&quot;Diagnostics&quot;
)brace
comma
(brace
id|FC_PORTSTATE_LINKDOWN
comma
l_string|&quot;Linkdown&quot;
)brace
comma
(brace
id|FC_PORTSTATE_ERROR
comma
l_string|&quot;Error&quot;
)brace
comma
(brace
id|FC_PORTSTATE_LOOPBACK
comma
l_string|&quot;Loopback&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|port_state
comma
id|fc_port_state
comma
id|fc_port_state_names
)paren
DECL|macro|FC_PORTSTATE_MAX_NAMELEN
mdefine_line|#define FC_PORTSTATE_MAX_NAMELEN&t;20
multiline_comment|/* Convert fc_tgtid_binding_type values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_tgtid_binding_type
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|matchlen
r_int
id|matchlen
suffix:semicolon
DECL|variable|fc_tgtid_binding_type_names
)brace
id|fc_tgtid_binding_type_names
(braket
)braket
op_assign
(brace
(brace
id|FC_TGTID_BIND_NONE
comma
l_string|&quot;none&quot;
comma
l_int|4
)brace
comma
(brace
id|FC_TGTID_BIND_BY_WWPN
comma
l_string|&quot;wwpn (World Wide Port Name)&quot;
comma
l_int|4
)brace
comma
(brace
id|FC_TGTID_BIND_BY_WWNN
comma
l_string|&quot;wwnn (World Wide Node Name)&quot;
comma
l_int|4
)brace
comma
(brace
id|FC_TGTID_BIND_BY_ID
comma
l_string|&quot;port_id (FC Address)&quot;
comma
l_int|7
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|tgtid_bind_type
comma
id|fc_tgtid_binding_type
comma
id|fc_tgtid_binding_type_names
)paren
id|fc_enum_name_match
c_func
(paren
id|tgtid_bind_type
comma
id|fc_tgtid_binding_type
comma
id|fc_tgtid_binding_type_names
)paren
DECL|macro|FC_BINDTYPE_MAX_NAMELEN
mdefine_line|#define FC_BINDTYPE_MAX_NAMELEN&t;30
DECL|macro|fc_bitfield_name_search
mdefine_line|#define fc_bitfield_name_search(title, table)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&bslash;&n;get_fc_##title##_names(u32 table_key, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;char *prefix = &quot;&quot;;&t;&t;&t;&t;&t;&bslash;&n;&t;ssize_t len = 0;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&bslash;&n;&t;&t;if (table[i].value &amp; table_key) {&t;&t;&bslash;&n;&t;&t;&t;len += sprintf(buf + len, &quot;%s%s&quot;,&t;&bslash;&n;&t;&t;&t;&t;prefix, table[i].name);&t;&t;&bslash;&n;&t;&t;&t;prefix = &quot;, &quot;;&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;len += sprintf(buf + len, &quot;&bslash;n&quot;);&t;&t;&t;&bslash;&n;&t;return len;&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/* Convert FC_COS bit values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
id|u32
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_cos_names
)brace
id|fc_cos_names
(braket
)braket
op_assign
(brace
(brace
id|FC_COS_CLASS1
comma
l_string|&quot;Class 1&quot;
)brace
comma
(brace
id|FC_COS_CLASS2
comma
l_string|&quot;Class 2&quot;
)brace
comma
(brace
id|FC_COS_CLASS3
comma
l_string|&quot;Class 3&quot;
)brace
comma
(brace
id|FC_COS_CLASS4
comma
l_string|&quot;Class 4&quot;
)brace
comma
(brace
id|FC_COS_CLASS6
comma
l_string|&quot;Class 6&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_bitfield_name_search
c_func
(paren
id|cos
comma
id|fc_cos_names
)paren
multiline_comment|/* Convert FC_PORTSPEED bit values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
id|u32
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_speed_names
)brace
id|fc_port_speed_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTSPEED_1GBIT
comma
l_string|&quot;1 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_2GBIT
comma
l_string|&quot;2 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_4GBIT
comma
l_string|&quot;4 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_10GBIT
comma
l_string|&quot;10 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_NOT_NEGOTIATED
comma
l_string|&quot;Not Negotiated&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_bitfield_name_search
c_func
(paren
id|port_speed
comma
id|fc_port_speed_names
)paren
r_static
r_int
DECL|function|show_fc_fc4s
id|show_fc_fc4s
(paren
r_char
op_star
id|buf
comma
id|u8
op_star
id|fc4_list
)paren
(brace
r_int
id|i
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FC_FC4_LIST_SIZE
suffix:semicolon
id|i
op_increment
comma
id|fc4_list
op_increment
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;0x%02x &quot;
comma
op_star
id|fc4_list
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* Convert FC_RPORT_ROLE bit values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
id|u32
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_remote_port_role_names
)brace
id|fc_remote_port_role_names
(braket
)braket
op_assign
(brace
(brace
id|FC_RPORT_ROLE_FCP_TARGET
comma
l_string|&quot;FCP Target&quot;
)brace
comma
(brace
id|FC_RPORT_ROLE_FCP_INITIATOR
comma
l_string|&quot;FCP Initiator&quot;
)brace
comma
(brace
id|FC_RPORT_ROLE_IP_PORT
comma
l_string|&quot;IP Port&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_bitfield_name_search
c_func
(paren
id|remote_port_roles
comma
id|fc_remote_port_role_names
)paren
multiline_comment|/*&n; * Define roles that are specific to port_id. Values are relative to ROLE_MASK.&n; */
DECL|macro|FC_WELLKNOWN_PORTID_MASK
mdefine_line|#define FC_WELLKNOWN_PORTID_MASK&t;0xfffff0
DECL|macro|FC_WELLKNOWN_ROLE_MASK
mdefine_line|#define FC_WELLKNOWN_ROLE_MASK  &t;0x00000f
DECL|macro|FC_FPORT_PORTID
mdefine_line|#define FC_FPORT_PORTID&t;&t;&t;0x00000e
DECL|macro|FC_FABCTLR_PORTID
mdefine_line|#define FC_FABCTLR_PORTID&t;&t;0x00000d
DECL|macro|FC_DIRSRVR_PORTID
mdefine_line|#define FC_DIRSRVR_PORTID&t;&t;0x00000c
DECL|macro|FC_TIMESRVR_PORTID
mdefine_line|#define FC_TIMESRVR_PORTID&t;&t;0x00000b
DECL|macro|FC_MGMTSRVR_PORTID
mdefine_line|#define FC_MGMTSRVR_PORTID&t;&t;0x00000a
r_static
r_void
id|fc_timeout_blocked_rport
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|fc_scsi_scan_rport
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|fc_rport_terminate
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
suffix:semicolon
multiline_comment|/*&n; * Attribute counts pre object type...&n; * Increase these values if you add attributes&n; */
DECL|macro|FC_STARGET_NUM_ATTRS
mdefine_line|#define FC_STARGET_NUM_ATTRS &t;3
DECL|macro|FC_RPORT_NUM_ATTRS
mdefine_line|#define FC_RPORT_NUM_ATTRS&t;9
DECL|macro|FC_HOST_NUM_ATTRS
mdefine_line|#define FC_HOST_NUM_ATTRS&t;15
DECL|struct|fc_internal
r_struct
id|fc_internal
(brace
DECL|member|t
r_struct
id|scsi_transport_template
id|t
suffix:semicolon
DECL|member|f
r_struct
id|fc_function_template
op_star
id|f
suffix:semicolon
multiline_comment|/*&n;&t; * For attributes : each object has :&n;&t; *   An array of the actual attributes structures&n;&t; *   An array of null-terminated pointers to the attribute&n;&t; *     structures - used for mid-layer interaction.&n;&t; *&n;&t; * The attribute containers for the starget and host are are&n;&t; * part of the midlayer. As the remote port is specific to the&n;&t; * fc transport, we must provide the attribute container.&n;&t; */
DECL|member|private_starget_attrs
r_struct
id|class_device_attribute
id|private_starget_attrs
(braket
id|FC_STARGET_NUM_ATTRS
)braket
suffix:semicolon
DECL|member|starget_attrs
r_struct
id|class_device_attribute
op_star
id|starget_attrs
(braket
id|FC_STARGET_NUM_ATTRS
op_plus
l_int|1
)braket
suffix:semicolon
DECL|member|private_host_attrs
r_struct
id|class_device_attribute
id|private_host_attrs
(braket
id|FC_HOST_NUM_ATTRS
)braket
suffix:semicolon
DECL|member|host_attrs
r_struct
id|class_device_attribute
op_star
id|host_attrs
(braket
id|FC_HOST_NUM_ATTRS
op_plus
l_int|1
)braket
suffix:semicolon
DECL|member|rport_attr_cont
r_struct
id|transport_container
id|rport_attr_cont
suffix:semicolon
DECL|member|private_rport_attrs
r_struct
id|class_device_attribute
id|private_rport_attrs
(braket
id|FC_RPORT_NUM_ATTRS
)braket
suffix:semicolon
DECL|member|rport_attrs
r_struct
id|class_device_attribute
op_star
id|rport_attrs
(braket
id|FC_RPORT_NUM_ATTRS
op_plus
l_int|1
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|to_fc_internal
mdefine_line|#define to_fc_internal(tmpl)&t;container_of(tmpl, struct fc_internal, t)
DECL|function|fc_target_setup
r_static
r_int
id|fc_target_setup
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|scsi_target
op_star
id|starget
op_assign
id|to_scsi_target
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|fc_rport
op_star
id|rport
op_assign
id|starget_to_rport
c_func
(paren
id|starget
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * if parent is remote port, use values from remote port.&n;&t; * Otherwise, this host uses the fc_transport, but not the&n;&t; * remote port interface. As such, initialize to known non-values.&n;&t; */
r_if
c_cond
(paren
id|rport
)paren
(brace
id|fc_starget_node_name
c_func
(paren
id|starget
)paren
op_assign
id|rport-&gt;node_name
suffix:semicolon
id|fc_starget_port_name
c_func
(paren
id|starget
)paren
op_assign
id|rport-&gt;port_name
suffix:semicolon
id|fc_starget_port_id
c_func
(paren
id|starget
)paren
op_assign
id|rport-&gt;port_id
suffix:semicolon
)brace
r_else
(brace
id|fc_starget_node_name
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_starget_port_name
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_starget_port_id
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|DECLARE_TRANSPORT_CLASS
c_func
(paren
id|fc_transport_class
comma
l_string|&quot;fc_transport&quot;
comma
id|fc_target_setup
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|fc_host_setup
r_static
r_int
id|fc_host_setup
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Set default values easily detected by the midlayer as&n;&t; * failure cases.  The scsi lldd is responsible for initializing&n;&t; * all transport attributes to valid values per host.&n;&t; */
id|fc_host_node_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_port_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
op_assign
id|FC_COS_UNSPECIFIED
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_symbolic_name
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_symbolic_name
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSPEED_UNKNOWN
suffix:semicolon
id|fc_host_maxframe_size
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_serial_number
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_serial_number
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_port_id
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_port_type
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTTYPE_UNKNOWN
suffix:semicolon
id|fc_host_port_state
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSTATE_UNKNOWN
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_speed
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSPEED_UNKNOWN
suffix:semicolon
id|fc_host_fabric_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_assign
id|FC_TGTID_BIND_BY_WWPN
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|fc_host_rports
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|fc_host_rport_bindings
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
id|fc_host_next_rport_number
c_func
(paren
id|shost
)paren
op_assign
l_int|0
suffix:semicolon
id|fc_host_next_target_id
c_func
(paren
id|shost
)paren
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|DECLARE_TRANSPORT_CLASS
c_func
(paren
id|fc_host_class
comma
l_string|&quot;fc_host&quot;
comma
id|fc_host_setup
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n; * Setup and Remove actions for remote ports are handled&n; * in the service functions below.&n; */
r_static
id|DECLARE_TRANSPORT_CLASS
c_func
(paren
id|fc_rport_class
comma
l_string|&quot;fc_remote_ports&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n; * Module Parameters&n; */
multiline_comment|/*&n; * dev_loss_tmo: the default number of seconds that the FC transport&n; *   should insulate the loss of a remote port.&n; *   The maximum will be capped by the value of SCSI_DEVICE_BLOCK_MAX_TIMEOUT.&n; */
DECL|variable|fc_dev_loss_tmo
r_static
r_int
r_int
id|fc_dev_loss_tmo
op_assign
id|SCSI_DEVICE_BLOCK_MAX_TIMEOUT
suffix:semicolon
id|module_param_named
c_func
(paren
id|dev_loss_tmo
comma
id|fc_dev_loss_tmo
comma
r_int
comma
id|S_IRUGO
op_or
id|S_IWUSR
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dev_loss_tmo
comma
l_string|&quot;Maximum number of seconds that the FC transport should&quot;
l_string|&quot; insulate the loss of a remote port. Once this value is&quot;
l_string|&quot; exceeded, the scsi target is removed. Value should be&quot;
l_string|&quot; between 1 and SCSI_DEVICE_BLOCK_MAX_TIMEOUT.&quot;
)paren
suffix:semicolon
DECL|function|fc_transport_init
r_static
id|__init
r_int
id|fc_transport_init
c_func
(paren
r_void
)paren
(brace
r_int
id|error
op_assign
id|transport_class_register
c_func
(paren
op_amp
id|fc_host_class
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|error
op_assign
id|transport_class_register
c_func
(paren
op_amp
id|fc_rport_class
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|transport_class_register
c_func
(paren
op_amp
id|fc_transport_class
)paren
suffix:semicolon
)brace
DECL|function|fc_transport_exit
r_static
r_void
id|__exit
id|fc_transport_exit
c_func
(paren
r_void
)paren
(brace
id|transport_class_unregister
c_func
(paren
op_amp
id|fc_transport_class
)paren
suffix:semicolon
id|transport_class_unregister
c_func
(paren
op_amp
id|fc_rport_class
)paren
suffix:semicolon
id|transport_class_unregister
c_func
(paren
op_amp
id|fc_host_class
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * FC Remote Port Attribute Management&n; */
DECL|macro|fc_rport_show_function
mdefine_line|#define fc_rport_show_function(field, format_string, sz, cast)&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_rport_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct fc_rport *rport = transport_class_to_rport(cdev);&t;&bslash;&n;&t;struct Scsi_Host *shost = rport_to_shost(rport);&t;&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_rport_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_rport_##field(rport);&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast rport-&gt;field); &t;&bslash;&n;}
DECL|macro|fc_rport_store_function
mdefine_line|#define fc_rport_store_function(field)&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;store_fc_rport_##field(struct class_device *cdev, const char *buf,&t;&bslash;&n;&t;&t;&t;   size_t count)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int val;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct fc_rport *rport = transport_class_to_rport(cdev);&t;&bslash;&n;&t;struct Scsi_Host *shost = rport_to_shost(rport);&t;&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;val = simple_strtoul(buf, NULL, 0);&t;&t;&t;&t;&bslash;&n;&t;i-&gt;f-&gt;set_rport_##field(rport, val);&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_rport_rd_attr
mdefine_line|#define fc_rport_rd_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_rport_show_function(field, format_string, sz, )&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_rport_##field, NULL)
DECL|macro|fc_rport_rd_attr_cast
mdefine_line|#define fc_rport_rd_attr_cast(field, format_string, sz, cast)&t;&t;&bslash;&n;&t;fc_rport_show_function(field, format_string, sz, (cast))&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_rport_##field, NULL)
DECL|macro|fc_rport_rw_attr
mdefine_line|#define fc_rport_rw_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_rport_show_function(field, format_string, sz, )&t;&t;&bslash;&n;&t;fc_rport_store_function(field)&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, field, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;&t;show_fc_rport_##field,&t;&t;&t;&t;&bslash;&n;&t;&t;&t;store_fc_rport_##field)
DECL|macro|fc_private_rport_show_function
mdefine_line|#define fc_private_rport_show_function(field, format_string, sz, cast)&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_rport_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct fc_rport *rport = transport_class_to_rport(cdev);&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast rport-&gt;field); &t;&bslash;&n;}
DECL|macro|fc_private_rport_rd_attr
mdefine_line|#define fc_private_rport_rd_attr(field, format_string, sz)&t;&t;&bslash;&n;&t;fc_private_rport_show_function(field, format_string, sz, )&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_rport_##field, NULL)
DECL|macro|fc_private_rport_rd_attr_cast
mdefine_line|#define fc_private_rport_rd_attr_cast(field, format_string, sz, cast)&t;&bslash;&n;&t;fc_private_rport_show_function(field, format_string, sz, (cast)) &bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_rport_##field, NULL)
DECL|macro|fc_private_rport_rd_enum_attr
mdefine_line|#define fc_private_rport_rd_enum_attr(title, maxlen)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_rport_##title (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct fc_rport *rport = transport_class_to_rport(cdev);&t;&bslash;&n;&t;const char *name;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;name = get_fc_##title##_name(rport-&gt;title);&t;&t;&t;&bslash;&n;&t;if (!name)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, maxlen, &quot;%s&bslash;n&quot;, name);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(rport, title, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;show_fc_rport_##title, NULL)
DECL|macro|SETUP_RPORT_ATTRIBUTE_RD
mdefine_line|#define SETUP_RPORT_ATTRIBUTE_RD(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_rport_attrs[count] = class_device_attr_rport_##field; &bslash;&n;&t;i-&gt;private_rport_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_rport_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;rport_attrs[count] = &amp;i-&gt;private_rport_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_rport_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
mdefine_line|#define SETUP_PRIVATE_RPORT_ATTRIBUTE_RD(field)&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_rport_attrs[count] = class_device_attr_rport_##field; &bslash;&n;&t;i-&gt;private_rport_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_rport_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;rport_attrs[count] = &amp;i-&gt;private_rport_attrs[count];&t;&t;&bslash;&n;&t;count++
DECL|macro|SETUP_RPORT_ATTRIBUTE_RW
mdefine_line|#define SETUP_RPORT_ATTRIBUTE_RW(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_rport_attrs[count] = class_device_attr_rport_##field; &bslash;&n;&t;if (!i-&gt;f-&gt;set_rport_##field) {&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;private_rport_attrs[count].attr.mode = S_IRUGO;&t;&bslash;&n;&t;&t;i-&gt;private_rport_attrs[count].store = NULL;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;rport_attrs[count] = &amp;i-&gt;private_rport_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_rport_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
multiline_comment|/* The FC Transport Remote Port Attributes: */
multiline_comment|/* Fixed Remote Port Attributes */
id|fc_private_rport_rd_attr
c_func
(paren
id|maxframe_size
comma
l_string|&quot;%u bytes&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_rport_supported_classes
id|show_fc_rport_supported_classes
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
op_assign
id|transport_class_to_rport
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rport-&gt;supported_classes
op_eq
id|FC_COS_UNSPECIFIED
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unspecified&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_cos_names
c_func
(paren
id|rport-&gt;supported_classes
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|rport
comma
id|supported_classes
comma
id|S_IRUGO
comma
id|show_fc_rport_supported_classes
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Dynamic Remote Port Attributes */
id|fc_rport_rw_attr
c_func
(paren
id|dev_loss_tmo
comma
l_string|&quot;%d&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Private Remote Port Attributes */
id|fc_private_rport_rd_attr_cast
c_func
(paren
id|node_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_rport_rd_attr_cast
c_func
(paren
id|port_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_rport_rd_attr
c_func
(paren
id|port_id
comma
l_string|&quot;0x%06x&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_rport_roles
id|show_fc_rport_roles
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
op_assign
id|transport_class_to_rport
c_func
(paren
id|cdev
)paren
suffix:semicolon
multiline_comment|/* identify any roles that are port_id specific */
r_if
c_cond
(paren
(paren
id|rport-&gt;port_id
op_ne
op_minus
l_int|1
)paren
op_logical_and
(paren
id|rport-&gt;port_id
op_amp
id|FC_WELLKNOWN_PORTID_MASK
)paren
op_eq
id|FC_WELLKNOWN_PORTID_MASK
)paren
(brace
r_switch
c_cond
(paren
id|rport-&gt;port_id
op_amp
id|FC_WELLKNOWN_ROLE_MASK
)paren
(brace
r_case
id|FC_FPORT_PORTID
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Fabric Port&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|FC_FABCTLR_PORTID
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Fabric Controller&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|FC_DIRSRVR_PORTID
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Directory Server&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|FC_TIMESRVR_PORTID
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Time Server&bslash;n&quot;
)paren
suffix:semicolon
r_case
id|FC_MGMTSRVR_PORTID
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Management Server&bslash;n&quot;
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|30
comma
l_string|&quot;Unknown Fabric Entity&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|rport-&gt;roles
op_eq
id|FC_RPORT_ROLE_UNKNOWN
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_remote_port_roles_names
c_func
(paren
id|rport-&gt;roles
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|rport
comma
id|roles
comma
id|S_IRUGO
comma
id|show_fc_rport_roles
comma
l_int|NULL
)paren
suffix:semicolon
id|fc_private_rport_rd_enum_attr
c_func
(paren
id|port_state
comma
id|FC_PORTSTATE_MAX_NAMELEN
)paren
suffix:semicolon
id|fc_private_rport_rd_attr
c_func
(paren
id|scsi_target_id
comma
l_string|&quot;%d&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/*&n; * FC SCSI Target Attribute Management&n; */
multiline_comment|/*&n; * Note: in the target show function we recognize when the remote&n; *  port is in the heirarchy and do not allow the driver to get&n; *  involved in sysfs functions. The driver only gets involved if&n; *  it&squot;s the &quot;old&quot; style that doesn&squot;t use rports.&n; */
DECL|macro|fc_starget_show_function
mdefine_line|#define fc_starget_show_function(field, format_string, sz, cast)&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_starget_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct scsi_target *starget = transport_class_to_starget(cdev);&t;&bslash;&n;&t;struct Scsi_Host *shost = dev_to_shost(starget-&gt;dev.parent);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;struct fc_rport *rport = starget_to_rport(starget);&t;&t;&bslash;&n;&t;if (rport)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;fc_starget_##field(starget) = rport-&gt;field;&t;&t;&bslash;&n;&t;else if (i-&gt;f-&gt;get_starget_##field)&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_starget_##field(starget);&t;&t;&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, &t;&t;&t;&bslash;&n;&t;&t;cast fc_starget_##field(starget)); &t;&t;&t;&bslash;&n;}
DECL|macro|fc_starget_rd_attr
mdefine_line|#define fc_starget_rd_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_starget_show_function(field, format_string, sz, )&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(starget, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_starget_##field, NULL)
DECL|macro|fc_starget_rd_attr_cast
mdefine_line|#define fc_starget_rd_attr_cast(field, format_string, sz, cast)&t;&t;&bslash;&n;&t;fc_starget_show_function(field, format_string, sz, (cast))&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(starget, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_starget_##field, NULL)
DECL|macro|SETUP_STARGET_ATTRIBUTE_RD
mdefine_line|#define SETUP_STARGET_ATTRIBUTE_RD(field)&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count] = class_device_attr_starget_##field; &bslash;&n;&t;i-&gt;private_starget_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;starget_attrs[count] = &amp;i-&gt;private_starget_attrs[count];&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_starget_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|SETUP_STARGET_ATTRIBUTE_RW
mdefine_line|#define SETUP_STARGET_ATTRIBUTE_RW(field)&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count] = class_device_attr_starget_##field; &bslash;&n;&t;if (!i-&gt;f-&gt;set_starget_##field) {&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;private_starget_attrs[count].attr.mode = S_IRUGO;&t;&bslash;&n;&t;&t;i-&gt;private_starget_attrs[count].store = NULL;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;starget_attrs[count] = &amp;i-&gt;private_starget_attrs[count];&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_starget_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
multiline_comment|/* The FC Transport SCSI Target Attributes: */
id|fc_starget_rd_attr_cast
c_func
(paren
id|node_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_starget_rd_attr_cast
c_func
(paren
id|port_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_starget_rd_attr
c_func
(paren
id|port_id
comma
l_string|&quot;0x%06x&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/*&n; * Host Attribute Management&n; */
DECL|macro|fc_host_show_function
mdefine_line|#define fc_host_show_function(field, format_string, sz, cast)&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_host_##field(shost);&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast fc_host_##field(shost)); &bslash;&n;}
DECL|macro|fc_host_store_function
mdefine_line|#define fc_host_store_function(field)&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;store_fc_host_##field(struct class_device *cdev, const char *buf,&t;&bslash;&n;&t;&t;&t;   size_t count)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int val;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;val = simple_strtoul(buf, NULL, 0);&t;&t;&t;&t;&bslash;&n;&t;i-&gt;f-&gt;set_host_##field(shost, val);&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_host_rd_attr
mdefine_line|#define fc_host_rd_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, )&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_host_##field, NULL)
DECL|macro|fc_host_rd_attr_cast
mdefine_line|#define fc_host_rd_attr_cast(field, format_string, sz, cast)&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, (cast))&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_host_##field, NULL)
DECL|macro|fc_host_rw_attr
mdefine_line|#define fc_host_rw_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, )&t;&t;&bslash;&n;&t;fc_host_store_function(field)&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;&t;show_fc_host_##field,&t;&t;&t;&t;&bslash;&n;&t;&t;&t;store_fc_host_##field)
DECL|macro|fc_host_rd_enum_attr
mdefine_line|#define fc_host_rd_enum_attr(title, maxlen)&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##title (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;const char *name;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_host_##title)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_host_##title(shost);&t;&t;&t;&t;&bslash;&n;&t;name = get_fc_##title##_name(fc_host_##title(shost));&t;&t;&bslash;&n;&t;if (!name)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, maxlen, &quot;%s&bslash;n&quot;, name);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, title, S_IRUGO, show_fc_host_##title, NULL)
DECL|macro|SETUP_HOST_ATTRIBUTE_RD
mdefine_line|#define SETUP_HOST_ATTRIBUTE_RD(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|SETUP_HOST_ATTRIBUTE_RW
mdefine_line|#define SETUP_HOST_ATTRIBUTE_RW(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;if (!i-&gt;f-&gt;set_host_##field) {&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&bslash;&n;&t;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|fc_private_host_show_function
mdefine_line|#define fc_private_host_show_function(field, format_string, sz, cast)&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast fc_host_##field(shost)); &bslash;&n;}
DECL|macro|fc_private_host_rd_attr
mdefine_line|#define fc_private_host_rd_attr(field, format_string, sz)&t;&t;&bslash;&n;&t;fc_private_host_show_function(field, format_string, sz, )&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_host_##field, NULL)
DECL|macro|fc_private_host_rd_attr_cast
mdefine_line|#define fc_private_host_rd_attr_cast(field, format_string, sz, cast)&t;&bslash;&n;&t;fc_private_host_show_function(field, format_string, sz, (cast)) &bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_host_##field, NULL)
DECL|macro|SETUP_PRIVATE_HOST_ATTRIBUTE_RD
mdefine_line|#define SETUP_PRIVATE_HOST_ATTRIBUTE_RD(field)&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;count++
DECL|macro|SETUP_PRIVATE_HOST_ATTRIBUTE_RW
mdefine_line|#define SETUP_PRIVATE_HOST_ATTRIBUTE_RW(field)&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;count++
multiline_comment|/* Fixed Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_host_supported_classes
id|show_fc_host_supported_classes
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
op_eq
id|FC_COS_UNSPECIFIED
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unspecified&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_cos_names
c_func
(paren
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_classes
comma
id|S_IRUGO
comma
id|show_fc_host_supported_classes
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_supported_fc4s
id|show_fc_host_supported_fc4s
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_return
(paren
id|ssize_t
)paren
id|show_fc_fc4s
c_func
(paren
id|buf
comma
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_fc4s
comma
id|S_IRUGO
comma
id|show_fc_host_supported_fc4s
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_supported_speeds
id|show_fc_host_supported_speeds
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
op_eq
id|FC_PORTSPEED_UNKNOWN
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_port_speed_names
c_func
(paren
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_speeds
comma
id|S_IRUGO
comma
id|show_fc_host_supported_speeds
comma
l_int|NULL
)paren
suffix:semicolon
id|fc_private_host_rd_attr_cast
c_func
(paren
id|node_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_host_rd_attr_cast
c_func
(paren
id|port_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|symbolic_name
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_SYMBOLIC_NAME_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|maxframe_size
comma
l_string|&quot;%u bytes&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|serial_number
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_SERIAL_NUMBER_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* Dynamic Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_host_active_fc4s
id|show_fc_host_active_fc4s
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_host_active_fc4s
)paren
id|i-&gt;f
op_member_access_from_pointer
id|get_host_active_fc4s
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
(paren
id|ssize_t
)paren
id|show_fc_fc4s
c_func
(paren
id|buf
comma
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|active_fc4s
comma
id|S_IRUGO
comma
id|show_fc_host_active_fc4s
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_speed
id|show_fc_host_speed
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_host_speed
)paren
id|i-&gt;f
op_member_access_from_pointer
id|get_host_speed
c_func
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_speed
c_func
(paren
id|shost
)paren
op_eq
id|FC_PORTSPEED_UNKNOWN
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_port_speed_names
c_func
(paren
id|fc_host_speed
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|speed
comma
id|S_IRUGO
comma
id|show_fc_host_speed
comma
l_int|NULL
)paren
suffix:semicolon
id|fc_host_rd_attr
c_func
(paren
id|port_id
comma
l_string|&quot;0x%06x&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
id|fc_host_rd_enum_attr
c_func
(paren
id|port_type
comma
id|FC_PORTTYPE_MAX_NAMELEN
)paren
suffix:semicolon
id|fc_host_rd_enum_attr
c_func
(paren
id|port_state
comma
id|FC_PORTSTATE_MAX_NAMELEN
)paren
suffix:semicolon
id|fc_host_rd_attr_cast
c_func
(paren
id|fabric_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/* Private Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_private_host_tgtid_bind_type
id|show_fc_private_host_tgtid_bind_type
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
id|name
op_assign
id|get_fc_tgtid_bind_type_name
c_func
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|FC_BINDTYPE_MAX_NAMELEN
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_fc_private_host_tgtid_bind_type
id|store_fc_private_host_tgtid_bind_type
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_rport
op_star
id|rport
comma
op_star
id|next_rport
suffix:semicolon
r_enum
id|fc_tgtid_binding_type
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|get_fc_tgtid_bind_type_match
c_func
(paren
id|buf
comma
op_amp
id|val
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* if changing bind type, purge all unused consistent bindings */
r_if
c_cond
(paren
id|val
op_ne
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|rport
comma
id|next_rport
comma
op_amp
id|fc_host_rport_bindings
c_func
(paren
id|shost
)paren
comma
id|peers
)paren
id|fc_rport_terminate
c_func
(paren
id|rport
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_assign
id|val
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|tgtid_bind_type
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_fc_private_host_tgtid_bind_type
comma
id|store_fc_private_host_tgtid_bind_type
)paren
suffix:semicolon
multiline_comment|/*&n; * Host Statistics Management&n; */
multiline_comment|/* Show a given an attribute in the statistics group */
r_static
id|ssize_t
DECL|function|fc_stat_show
id|fc_stat_show
c_func
(paren
r_const
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
comma
r_int
r_int
id|offset
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_struct
id|fc_host_statistics
op_star
id|stats
suffix:semicolon
id|ssize_t
id|ret
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
r_sizeof
(paren
r_struct
id|fc_host_statistics
)paren
op_logical_or
id|offset
op_mod
r_sizeof
(paren
id|u64
)paren
op_ne
l_int|0
)paren
id|WARN_ON
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_fc_host_stats
)paren
(brace
id|stats
op_assign
(paren
id|i-&gt;f-&gt;get_fc_host_stats
)paren
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stats
)paren
id|ret
op_assign
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
op_star
(paren
id|u64
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|stats
)paren
op_plus
id|offset
)paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* generate a read-only statistics attribute */
DECL|macro|fc_host_statistic
mdefine_line|#define fc_host_statistic(name)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fcstat_##name(struct class_device *cd, char *buf) &t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return fc_stat_show(cd, buf, &t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;    offsetof(struct fc_host_statistics, name));&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, name, S_IRUGO, show_fcstat_##name, NULL)
DECL|variable|seconds_since_last_reset
id|fc_host_statistic
c_func
(paren
id|seconds_since_last_reset
)paren
suffix:semicolon
DECL|variable|tx_frames
id|fc_host_statistic
c_func
(paren
id|tx_frames
)paren
suffix:semicolon
DECL|variable|tx_words
id|fc_host_statistic
c_func
(paren
id|tx_words
)paren
suffix:semicolon
DECL|variable|rx_frames
id|fc_host_statistic
c_func
(paren
id|rx_frames
)paren
suffix:semicolon
DECL|variable|rx_words
id|fc_host_statistic
c_func
(paren
id|rx_words
)paren
suffix:semicolon
DECL|variable|lip_count
id|fc_host_statistic
c_func
(paren
id|lip_count
)paren
suffix:semicolon
DECL|variable|nos_count
id|fc_host_statistic
c_func
(paren
id|nos_count
)paren
suffix:semicolon
DECL|variable|error_frames
id|fc_host_statistic
c_func
(paren
id|error_frames
)paren
suffix:semicolon
DECL|variable|dumped_frames
id|fc_host_statistic
c_func
(paren
id|dumped_frames
)paren
suffix:semicolon
DECL|variable|link_failure_count
id|fc_host_statistic
c_func
(paren
id|link_failure_count
)paren
suffix:semicolon
DECL|variable|loss_of_sync_count
id|fc_host_statistic
c_func
(paren
id|loss_of_sync_count
)paren
suffix:semicolon
DECL|variable|loss_of_signal_count
id|fc_host_statistic
c_func
(paren
id|loss_of_signal_count
)paren
suffix:semicolon
DECL|variable|prim_seq_protocol_err_count
id|fc_host_statistic
c_func
(paren
id|prim_seq_protocol_err_count
)paren
suffix:semicolon
DECL|variable|invalid_tx_word_count
id|fc_host_statistic
c_func
(paren
id|invalid_tx_word_count
)paren
suffix:semicolon
DECL|variable|invalid_crc_count
id|fc_host_statistic
c_func
(paren
id|invalid_crc_count
)paren
suffix:semicolon
DECL|variable|fcp_input_requests
id|fc_host_statistic
c_func
(paren
id|fcp_input_requests
)paren
suffix:semicolon
DECL|variable|fcp_output_requests
id|fc_host_statistic
c_func
(paren
id|fcp_output_requests
)paren
suffix:semicolon
DECL|variable|fcp_control_requests
id|fc_host_statistic
c_func
(paren
id|fcp_control_requests
)paren
suffix:semicolon
DECL|variable|fcp_input_megabytes
id|fc_host_statistic
c_func
(paren
id|fcp_input_megabytes
)paren
suffix:semicolon
DECL|variable|fcp_output_megabytes
id|fc_host_statistic
c_func
(paren
id|fcp_output_megabytes
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|fc_reset_statistics
id|fc_reset_statistics
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
multiline_comment|/* ignore any data value written to the attribute */
r_if
c_cond
(paren
id|i-&gt;f-&gt;reset_fc_host_stats
)paren
(brace
id|i-&gt;f
op_member_access_from_pointer
id|reset_fc_host_stats
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|reset_statistics
comma
id|S_IWUSR
comma
l_int|NULL
comma
id|fc_reset_statistics
)paren
suffix:semicolon
DECL|variable|fc_statistics_attrs
r_static
r_struct
id|attribute
op_star
id|fc_statistics_attrs
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_host_seconds_since_last_reset.attr
comma
op_amp
id|class_device_attr_host_tx_frames.attr
comma
op_amp
id|class_device_attr_host_tx_words.attr
comma
op_amp
id|class_device_attr_host_rx_frames.attr
comma
op_amp
id|class_device_attr_host_rx_words.attr
comma
op_amp
id|class_device_attr_host_lip_count.attr
comma
op_amp
id|class_device_attr_host_nos_count.attr
comma
op_amp
id|class_device_attr_host_error_frames.attr
comma
op_amp
id|class_device_attr_host_dumped_frames.attr
comma
op_amp
id|class_device_attr_host_link_failure_count.attr
comma
op_amp
id|class_device_attr_host_loss_of_sync_count.attr
comma
op_amp
id|class_device_attr_host_loss_of_signal_count.attr
comma
op_amp
id|class_device_attr_host_prim_seq_protocol_err_count.attr
comma
op_amp
id|class_device_attr_host_invalid_tx_word_count.attr
comma
op_amp
id|class_device_attr_host_invalid_crc_count.attr
comma
op_amp
id|class_device_attr_host_fcp_input_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_output_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_control_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_input_megabytes.attr
comma
op_amp
id|class_device_attr_host_fcp_output_megabytes.attr
comma
op_amp
id|class_device_attr_host_reset_statistics.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|fc_statistics_group
r_static
r_struct
id|attribute_group
id|fc_statistics_group
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;statistics&quot;
comma
dot
id|attrs
op_assign
id|fc_statistics_attrs
comma
)brace
suffix:semicolon
DECL|function|fc_host_match
r_static
r_int
id|fc_host_match
c_func
(paren
r_struct
id|attribute_container
op_star
id|cont
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsi_is_host_device
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost-&gt;transportt
op_logical_or
id|shost-&gt;transportt-&gt;host_attrs.ac
dot
r_class
op_ne
op_amp
id|fc_host_class
dot
r_class
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_return
op_amp
id|i-&gt;t.host_attrs.ac
op_eq
id|cont
suffix:semicolon
)brace
DECL|function|fc_target_match
r_static
r_int
id|fc_target_match
c_func
(paren
r_struct
id|attribute_container
op_star
id|cont
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsi_is_target_device
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost-&gt;transportt
op_logical_or
id|shost-&gt;transportt-&gt;host_attrs.ac
dot
r_class
op_ne
op_amp
id|fc_host_class
dot
r_class
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_return
op_amp
id|i-&gt;t.target_attrs.ac
op_eq
id|cont
suffix:semicolon
)brace
DECL|function|fc_rport_dev_release
r_static
r_void
id|fc_rport_dev_release
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
op_assign
id|dev_to_rport
c_func
(paren
id|dev
)paren
suffix:semicolon
id|put_device
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|rport
)paren
suffix:semicolon
)brace
DECL|function|scsi_is_fc_rport
r_int
id|scsi_is_fc_rport
c_func
(paren
r_const
r_struct
id|device
op_star
id|dev
)paren
(brace
r_return
id|dev-&gt;release
op_eq
id|fc_rport_dev_release
suffix:semicolon
)brace
DECL|variable|scsi_is_fc_rport
id|EXPORT_SYMBOL
c_func
(paren
id|scsi_is_fc_rport
)paren
suffix:semicolon
DECL|function|fc_rport_match
r_static
r_int
id|fc_rport_match
c_func
(paren
r_struct
id|attribute_container
op_star
id|cont
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsi_is_fc_rport
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost-&gt;transportt
op_logical_or
id|shost-&gt;transportt-&gt;host_attrs.ac
dot
r_class
op_ne
op_amp
id|fc_host_class
dot
r_class
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_return
op_amp
id|i-&gt;rport_attr_cont.ac
op_eq
id|cont
suffix:semicolon
)brace
r_struct
id|scsi_transport_template
op_star
DECL|function|fc_attach_transport
id|fc_attach_transport
c_func
(paren
r_struct
id|fc_function_template
op_star
id|ft
)paren
(brace
r_struct
id|fc_internal
op_star
id|i
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fc_internal
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
id|i
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|i
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fc_internal
)paren
)paren
suffix:semicolon
id|i-&gt;t.target_attrs.ac.attrs
op_assign
op_amp
id|i-&gt;starget_attrs
(braket
l_int|0
)braket
suffix:semicolon
id|i-&gt;t.target_attrs.ac
dot
r_class
op_assign
op_amp
id|fc_transport_class
dot
r_class
suffix:semicolon
id|i-&gt;t.target_attrs.ac.match
op_assign
id|fc_target_match
suffix:semicolon
id|i-&gt;t.target_size
op_assign
r_sizeof
(paren
r_struct
id|fc_starget_attrs
)paren
suffix:semicolon
id|transport_container_register
c_func
(paren
op_amp
id|i-&gt;t.target_attrs
)paren
suffix:semicolon
id|i-&gt;t.host_attrs.ac.attrs
op_assign
op_amp
id|i-&gt;host_attrs
(braket
l_int|0
)braket
suffix:semicolon
id|i-&gt;t.host_attrs.ac
dot
r_class
op_assign
op_amp
id|fc_host_class
dot
r_class
suffix:semicolon
id|i-&gt;t.host_attrs.ac.match
op_assign
id|fc_host_match
suffix:semicolon
id|i-&gt;t.host_size
op_assign
r_sizeof
(paren
r_struct
id|fc_host_attrs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ft-&gt;get_fc_host_stats
)paren
id|i-&gt;t.host_attrs.statistics
op_assign
op_amp
id|fc_statistics_group
suffix:semicolon
id|transport_container_register
c_func
(paren
op_amp
id|i-&gt;t.host_attrs
)paren
suffix:semicolon
id|i-&gt;rport_attr_cont.ac.attrs
op_assign
op_amp
id|i-&gt;rport_attrs
(braket
l_int|0
)braket
suffix:semicolon
id|i-&gt;rport_attr_cont.ac
dot
r_class
op_assign
op_amp
id|fc_rport_class
dot
r_class
suffix:semicolon
id|i-&gt;rport_attr_cont.ac.match
op_assign
id|fc_rport_match
suffix:semicolon
id|transport_container_register
c_func
(paren
op_amp
id|i-&gt;rport_attr_cont
)paren
suffix:semicolon
id|i-&gt;f
op_assign
id|ft
suffix:semicolon
multiline_comment|/* Transport uses the shost workq for scsi scanning */
id|i-&gt;t.create_work_queue
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Setup SCSI Target Attributes.&n;&t; */
id|count
op_assign
l_int|0
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|node_name
)paren
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|port_name
)paren
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|port_id
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|count
OG
id|FC_STARGET_NUM_ATTRS
)paren
suffix:semicolon
id|i-&gt;starget_attrs
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Setup SCSI Host Attributes.&n;&t; */
id|count
op_assign
l_int|0
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|node_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_classes
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_fc4s
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|symbolic_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_speeds
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|maxframe_size
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|serial_number
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_id
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_type
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_state
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|active_fc4s
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|speed
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|fabric_name
)paren
suffix:semicolon
multiline_comment|/* Transport-managed attributes */
id|SETUP_PRIVATE_HOST_ATTRIBUTE_RW
c_func
(paren
id|tgtid_bind_type
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|count
OG
id|FC_HOST_NUM_ATTRS
)paren
suffix:semicolon
id|i-&gt;host_attrs
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Setup Remote Port Attributes.&n;&t; */
id|count
op_assign
l_int|0
suffix:semicolon
id|SETUP_RPORT_ATTRIBUTE_RD
c_func
(paren
id|maxframe_size
)paren
suffix:semicolon
id|SETUP_RPORT_ATTRIBUTE_RD
c_func
(paren
id|supported_classes
)paren
suffix:semicolon
id|SETUP_RPORT_ATTRIBUTE_RW
c_func
(paren
id|dev_loss_tmo
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|node_name
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|port_name
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|port_id
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|roles
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|port_state
)paren
suffix:semicolon
id|SETUP_PRIVATE_RPORT_ATTRIBUTE_RD
c_func
(paren
id|scsi_target_id
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|count
OG
id|FC_RPORT_NUM_ATTRS
)paren
suffix:semicolon
id|i-&gt;rport_attrs
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_amp
id|i-&gt;t
suffix:semicolon
)brace
DECL|variable|fc_attach_transport
id|EXPORT_SYMBOL
c_func
(paren
id|fc_attach_transport
)paren
suffix:semicolon
DECL|function|fc_release_transport
r_void
id|fc_release_transport
c_func
(paren
r_struct
id|scsi_transport_template
op_star
id|t
)paren
(brace
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|t
)paren
suffix:semicolon
id|transport_container_unregister
c_func
(paren
op_amp
id|i-&gt;t.target_attrs
)paren
suffix:semicolon
id|transport_container_unregister
c_func
(paren
op_amp
id|i-&gt;t.host_attrs
)paren
suffix:semicolon
id|transport_container_unregister
c_func
(paren
op_amp
id|i-&gt;rport_attr_cont
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|variable|fc_release_transport
id|EXPORT_SYMBOL
c_func
(paren
id|fc_release_transport
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_remove_host - called to terminate any fc_transport-related elements&n; *                  for a scsi host.&n; * @rport:&t;remote port to be unblocked.&n; *&n; * This routine is expected to be called immediately preceeding the&n; * a driver&squot;s call to scsi_remove_host().&n; *&n; * WARNING: A driver utilizing the fc_transport, which fails to call&n; *   this routine prior to scsi_remote_host(), will leave dangling&n; *   objects in /sys/class/fc_remote_ports. Access to any of these&n; *   objects can result in a system crash !!!&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_remove_host
id|fc_remove_host
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shost
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
comma
op_star
id|next_rport
suffix:semicolon
multiline_comment|/* Remove any remote ports */
id|list_for_each_entry_safe
c_func
(paren
id|rport
comma
id|next_rport
comma
op_amp
id|fc_host_rports
c_func
(paren
id|shost
)paren
comma
id|peers
)paren
id|fc_rport_terminate
c_func
(paren
id|rport
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|rport
comma
id|next_rport
comma
op_amp
id|fc_host_rport_bindings
c_func
(paren
id|shost
)paren
comma
id|peers
)paren
id|fc_rport_terminate
c_func
(paren
id|rport
)paren
suffix:semicolon
)brace
DECL|variable|fc_remove_host
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remove_host
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_rport_create - allocates and creates a remote FC port.&n; * @shost:&t;scsi host the remote port is connected to.&n; * @channel:&t;Channel on shost port connected to.&n; * @ids:&t;The world wide names, fc address, and FC4 port&n; *&t;&t;roles for the remote port.&n; *&n; * Allocates and creates the remoter port structure, including the&n; * class and sysfs creation.&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_struct
id|fc_rport
op_star
DECL|function|fc_rport_create
id|fc_rport_create
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shost
comma
r_int
id|channel
comma
r_struct
id|fc_rport_identifiers
op_star
id|ids
)paren
(brace
r_struct
id|fc_host_attrs
op_star
id|fc_host
op_assign
(paren
r_struct
id|fc_host_attrs
op_star
)paren
id|shost-&gt;shost_data
suffix:semicolon
r_struct
id|fc_internal
op_star
id|fci
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_struct
id|fc_rport
op_star
id|rport
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|error
suffix:semicolon
r_int
id|size
suffix:semicolon
id|size
op_assign
(paren
r_sizeof
(paren
r_struct
id|fc_rport
)paren
op_plus
id|fci-&gt;f-&gt;dd_fcrport_size
)paren
suffix:semicolon
id|rport
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
id|rport
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: allocation failure&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|rport
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|rport-&gt;maxframe_size
op_assign
op_minus
l_int|1
suffix:semicolon
id|rport-&gt;supported_classes
op_assign
id|FC_COS_UNSPECIFIED
suffix:semicolon
id|rport-&gt;dev_loss_tmo
op_assign
id|fc_dev_loss_tmo
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rport-&gt;node_name
comma
op_amp
id|ids-&gt;node_name
comma
r_sizeof
(paren
id|rport-&gt;node_name
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rport-&gt;port_name
comma
op_amp
id|ids-&gt;port_name
comma
r_sizeof
(paren
id|rport-&gt;port_name
)paren
)paren
suffix:semicolon
id|rport-&gt;port_id
op_assign
id|ids-&gt;port_id
suffix:semicolon
id|rport-&gt;roles
op_assign
id|ids-&gt;roles
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_ONLINE
suffix:semicolon
r_if
c_cond
(paren
id|fci-&gt;f-&gt;dd_fcrport_size
)paren
id|rport-&gt;dd_data
op_assign
op_amp
id|rport
(braket
l_int|1
)braket
suffix:semicolon
id|rport-&gt;channel
op_assign
id|channel
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|rport-&gt;dev_loss_work
comma
id|fc_timeout_blocked_rport
comma
id|rport
)paren
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|rport-&gt;scan_work
comma
id|fc_scsi_scan_rport
comma
id|rport
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|rport-&gt;number
op_assign
id|fc_host-&gt;next_rport_number
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rport-&gt;roles
op_amp
id|FC_RPORT_ROLE_FCP_TARGET
)paren
id|rport-&gt;scsi_target_id
op_assign
id|fc_host-&gt;next_target_id
op_increment
suffix:semicolon
r_else
id|rport-&gt;scsi_target_id
op_assign
op_minus
l_int|1
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|rport-&gt;peers
comma
op_amp
id|fc_host_rports
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
id|get_device
c_func
(paren
op_amp
id|shost-&gt;shost_gendev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|dev
op_assign
op_amp
id|rport-&gt;dev
suffix:semicolon
id|device_initialize
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;parent
op_assign
id|get_device
c_func
(paren
op_amp
id|shost-&gt;shost_gendev
)paren
suffix:semicolon
id|dev-&gt;release
op_assign
id|fc_rport_dev_release
suffix:semicolon
id|sprintf
c_func
(paren
id|dev-&gt;bus_id
comma
l_string|&quot;rport-%d:%d-%d&quot;
comma
id|shost-&gt;host_no
comma
id|channel
comma
id|rport-&gt;number
)paren
suffix:semicolon
id|transport_setup_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|error
op_assign
id|device_add
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FC Remote Port device_add failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|delete_rport
suffix:semicolon
)brace
id|transport_add_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|transport_configure_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rport-&gt;roles
op_amp
id|FC_RPORT_ROLE_FCP_TARGET
)paren
multiline_comment|/* initiate a scan of the target */
id|scsi_queue_work
c_func
(paren
id|shost
comma
op_amp
id|rport-&gt;scan_work
)paren
suffix:semicolon
r_return
id|rport
suffix:semicolon
id|delete_rport
suffix:colon
id|transport_destroy_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|put_device
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|rport-&gt;peers
)paren
suffix:semicolon
id|put_device
c_func
(paren
op_amp
id|shost-&gt;shost_gendev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|put_device
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|rport
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_remote_port_add - notifies the fc transport of the existence&n; *&t;&t;of a remote FC port.&n; * @shost:&t;scsi host the remote port is connected to.&n; * @channel:&t;Channel on shost port connected to.&n; * @ids:&t;The world wide names, fc address, and FC4 port&n; *&t;&t;roles for the remote port.&n; *&n; * The LLDD calls this routine to notify the transport of the existence&n; * of a remote port. The LLDD provides the unique identifiers (wwpn,wwn)&n; * of the port, it&squot;s FC address (port_id), and the FC4 roles that are&n; * active for the port.&n; *&n; * For ports that are FCP targets (aka scsi targets), the FC transport&n; * maintains consistent target id bindings on behalf of the LLDD.&n; * A consistent target id binding is an assignment of a target id to&n; * a remote port identifier, which persists while the scsi host is&n; * attached. The remote port can disappear, then later reappear, and&n; * it&squot;s target id assignment remains the same. This allows for shifts&n; * in FC addressing (if binding by wwpn or wwnn) with no apparent&n; * changes to the scsi subsystem which is based on scsi host number and&n; * target id values.  Bindings are only valid during the attachment of&n; * the scsi host. If the host detaches, then later re-attaches, target&n; * id bindings may change.&n; *&n; * This routine is responsible for returning a remote port structure.&n; * The routine will search the list of remote ports it maintains&n; * internally on behalf of consistent target id mappings. If found, the&n; * remote port structure will be reused. Otherwise, a new remote port&n; * structure will be allocated.&n; *&n; * Whenever a remote port is allocated, a new fc_remote_port class&n; * device is created.&n; *&n; * Should not be called from interrupt context.&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_struct
id|fc_rport
op_star
DECL|function|fc_remote_port_add
id|fc_remote_port_add
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shost
comma
r_int
id|channel
comma
r_struct
id|fc_rport_identifiers
op_star
id|ids
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|match
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
(paren
id|ids-&gt;roles
op_amp
id|FC_RPORT_ROLE_FCP_TARGET
)paren
op_logical_and
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_ne
id|FC_TGTID_BIND_NONE
)paren
)paren
)paren
(brace
multiline_comment|/* search for a matching consistent binding */
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|rport
comma
op_amp
id|fc_host_rport_bindings
c_func
(paren
id|shost
)paren
comma
id|peers
)paren
(brace
r_if
c_cond
(paren
id|rport-&gt;channel
op_ne
id|channel
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
)paren
(brace
r_case
id|FC_TGTID_BIND_BY_WWPN
suffix:colon
r_if
c_cond
(paren
id|rport-&gt;port_name
op_eq
id|ids-&gt;port_name
)paren
id|match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_BY_WWNN
suffix:colon
r_if
c_cond
(paren
id|rport-&gt;node_name
op_eq
id|ids-&gt;node_name
)paren
id|match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_BY_ID
suffix:colon
r_if
c_cond
(paren
id|rport-&gt;port_id
op_eq
id|ids-&gt;port_id
)paren
id|match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_NONE
suffix:colon
multiline_comment|/* to keep compiler happy */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|match
)paren
(brace
id|list_move_tail
c_func
(paren
op_amp
id|rport-&gt;peers
comma
op_amp
id|fc_host_rports
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|match
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|rport-&gt;node_name
comma
op_amp
id|ids-&gt;node_name
comma
r_sizeof
(paren
id|rport-&gt;node_name
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rport-&gt;port_name
comma
op_amp
id|ids-&gt;port_name
comma
r_sizeof
(paren
id|rport-&gt;port_name
)paren
)paren
suffix:semicolon
id|rport-&gt;port_id
op_assign
id|ids-&gt;port_id
suffix:semicolon
id|rport-&gt;roles
op_assign
id|ids-&gt;roles
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_ONLINE
suffix:semicolon
r_if
c_cond
(paren
id|rport-&gt;roles
op_amp
id|FC_RPORT_ROLE_FCP_TARGET
)paren
multiline_comment|/* initiate a scan of the target */
id|scsi_queue_work
c_func
(paren
id|shost
comma
op_amp
id|rport-&gt;scan_work
)paren
suffix:semicolon
r_return
id|rport
suffix:semicolon
)brace
)brace
multiline_comment|/* No consistent binding found - create new remote port entry */
id|rport
op_assign
id|fc_rport_create
c_func
(paren
id|shost
comma
id|channel
comma
id|ids
)paren
suffix:semicolon
r_return
id|rport
suffix:semicolon
)brace
DECL|variable|fc_remote_port_add
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remote_port_add
)paren
suffix:semicolon
multiline_comment|/*&n; * fc_rport_tgt_remove - Removes the scsi target on the remote port&n; * @rport:&t;The remote port to be operated on&n; */
r_static
r_void
DECL|function|fc_rport_tgt_remove
id|fc_rport_tgt_remove
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|rport_to_shost
c_func
(paren
id|rport
)paren
suffix:semicolon
id|scsi_target_unblock
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Stop anything on the workq */
r_if
c_cond
(paren
op_logical_neg
id|cancel_delayed_work
c_func
(paren
op_amp
id|rport-&gt;dev_loss_work
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
id|scsi_flush_work
c_func
(paren
id|shost
)paren
suffix:semicolon
id|scsi_remove_target
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fc_rport_terminate - this routine tears down and deallocates a remote port.&n; * @rport:&t;The remote port to be terminated&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; */
r_static
r_void
DECL|function|fc_rport_terminate
id|fc_rport_terminate
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|rport_to_shost
c_func
(paren
id|rport
)paren
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
op_amp
id|rport-&gt;dev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|fc_rport_tgt_remove
c_func
(paren
id|rport
)paren
suffix:semicolon
id|transport_remove_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|device_del
c_func
(paren
id|dev
)paren
suffix:semicolon
id|transport_destroy_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|rport-&gt;peers
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|put_device
c_func
(paren
op_amp
id|shost-&gt;shost_gendev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_remote_port_delete - notifies the fc transport that a remote&n; *&t;&t;port is no longer in existence.&n; * @rport:&t;The remote port that no longer exists&n; *&n; * The LLDD calls this routine to notify the transport that a remote&n; * port is no longer part of the topology. Note: Although a port&n; * may no longer be part of the topology, it may persist in the remote&n; * ports displayed by the fc_host. This is done so that target id&n; * mappings (managed via the remote port structures), are always visible&n; * as long as the mapping is valid, regardless of port state,&n; *&n; * If the remote port is not an FCP Target, it will be fully torn down&n; * and deallocated, including the fc_remote_port class device.&n; *&n; * If the remote port is an FCP Target, the port structure will be&n; * marked as Not Present, but will remain as long as there is a valid&n; * SCSI target id mapping associated with the port structure. Validity&n; * is determined by the binding type. If binding by wwpn, then the port&n; * structure is always valid and will not be deallocated until the host&n; * is removed.  If binding by wwnn, then the port structure is valid&n; * until another port with the same node name is found in the topology.&n; * If binding by port id (fc address), then the port structure is valid&n; * valid until another port with the same address is identified.&n; *&n; * Called from interrupt or normal process context.&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_remote_port_delete
id|fc_remote_port_delete
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|rport_to_shost
c_func
(paren
id|rport
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* If no scsi target id mapping or consistent binding type, delete it */
r_if
c_cond
(paren
(paren
id|rport-&gt;scsi_target_id
op_eq
op_minus
l_int|1
)paren
op_logical_or
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_eq
id|FC_TGTID_BIND_NONE
)paren
)paren
(brace
id|fc_rport_terminate
c_func
(paren
id|rport
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fc_rport_tgt_remove
c_func
(paren
id|rport
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|list_move_tail
c_func
(paren
op_amp
id|rport-&gt;peers
comma
op_amp
id|fc_host_rport_bindings
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Note: We do not remove or clear the hostdata area. This allows&n;&t; *   host-specific target data to persist along with the&n;&t; *   scsi_target_id. It&squot;s up to the host to manage it&squot;s hostdata area.&n;&t; */
multiline_comment|/*&n;&t; * Reinitialize port attributes that may change if the port comes back.&n;&t; */
id|rport-&gt;maxframe_size
op_assign
op_minus
l_int|1
suffix:semicolon
id|rport-&gt;supported_classes
op_assign
id|FC_COS_UNSPECIFIED
suffix:semicolon
id|rport-&gt;roles
op_assign
id|FC_RPORT_ROLE_UNKNOWN
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_NOTPRESENT
suffix:semicolon
multiline_comment|/* remove the identifiers that aren&squot;t used in the consisting binding */
r_switch
c_cond
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
)paren
(brace
r_case
id|FC_TGTID_BIND_BY_WWPN
suffix:colon
id|rport-&gt;node_name
op_assign
op_minus
l_int|1
suffix:semicolon
id|rport-&gt;port_id
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_BY_WWNN
suffix:colon
id|rport-&gt;port_name
op_assign
op_minus
l_int|1
suffix:semicolon
id|rport-&gt;port_id
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_BY_ID
suffix:colon
id|rport-&gt;node_name
op_assign
op_minus
l_int|1
suffix:semicolon
id|rport-&gt;port_name
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FC_TGTID_BIND_NONE
suffix:colon
multiline_comment|/* to keep compiler happy */
r_break
suffix:semicolon
)brace
)brace
DECL|variable|fc_remote_port_delete
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remote_port_delete
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_remote_port_rolechg - notifies the fc transport that the roles&n; *&t;&t;on a remote may have changed.&n; * @rport:&t;The remote port that changed.&n; *&n; * The LLDD calls this routine to notify the transport that the roles&n; * on a remote port may have changed. The largest effect of this is&n; * if a port now becomes a FCP Target, it must be allocated a&n; * scsi target id.  If the port is no longer a FCP target, any&n; * scsi target id value assigned to it will persist in case the&n; * role changes back to include FCP Target. No changes in the scsi&n; * midlayer will be invoked if the role changes (in the expectation&n; * that the role will be resumed. If it doesn&squot;t normal error processing&n; * will take place).&n; *&n; * Should not be called from interrupt context.&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_remote_port_rolechg
id|fc_remote_port_rolechg
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
comma
id|u32
id|roles
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|rport_to_shost
c_func
(paren
id|rport
)paren
suffix:semicolon
r_struct
id|fc_host_attrs
op_star
id|fc_host
op_assign
(paren
r_struct
id|fc_host_attrs
op_star
)paren
id|shost-&gt;shost_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|create
op_assign
l_int|0
suffix:semicolon
id|rport-&gt;roles
op_assign
id|roles
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rport-&gt;scsi_target_id
op_eq
op_minus
l_int|1
)paren
op_logical_and
(paren
id|rport-&gt;roles
op_amp
id|FC_RPORT_ROLE_FCP_TARGET
)paren
)paren
(brace
id|rport-&gt;scsi_target_id
op_assign
id|fc_host-&gt;next_target_id
op_increment
suffix:semicolon
id|create
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|shost-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|create
)paren
multiline_comment|/* initiate a scan of the target */
id|scsi_queue_work
c_func
(paren
id|shost
comma
op_amp
id|rport-&gt;scan_work
)paren
suffix:semicolon
)brace
DECL|variable|fc_remote_port_rolechg
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remote_port_rolechg
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_timeout_blocked_rport - Timeout handler for blocked remote port&n; *                       that fails to return in the alloted time.&n; * @data:&t;scsi target that failed to reappear in the alloted time.&n; **/
r_static
r_void
DECL|function|fc_timeout_blocked_rport
id|fc_timeout_blocked_rport
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
op_assign
(paren
r_struct
id|fc_rport
op_star
)paren
id|data
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_OFFLINE
suffix:semicolon
id|dev_printk
c_func
(paren
id|KERN_ERR
comma
op_amp
id|rport-&gt;dev
comma
l_string|&quot;blocked FC remote port time out: removing target&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * As this only occurs if the remote port (scsi target)&n;&t; * went away and didn&squot;t come back - we&squot;ll remove&n;&t; * all attached scsi devices.&n;&t; */
id|scsi_target_unblock
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
id|scsi_remove_target
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_remote_port_block - temporarily block any scsi traffic to a remote port.&n; * @rport:&t;remote port to be blocked.&n; *&n; * scsi lldd&squot;s with a FC transport call this routine to temporarily stop&n; * all scsi traffic to a remote port. If the port is not a SCSI target,&n; * no action is taken. If the port is a SCSI target, all attached devices&n; * are placed into a SDEV_BLOCK state and a timer is started. The timer is&n; * represents the maximum amount of time the port may be blocked. If the&n; * timer expires, the port is considered non-existent and the attached&n; * scsi devices will be removed.&n; *&n; * Called from interrupt or normal process context.&n; *&n; * Returns zero if successful or error if not&n; *&n; * Notes:&n; *      This routine assumes no locks are held on entry.&n; *&n; *&t;The timeout and timer types are extracted from the fc transport &n; *&t;attributes from the caller&squot;s rport pointer.&n; **/
r_int
DECL|function|fc_remote_port_block
id|fc_remote_port_block
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
(brace
r_int
id|timeout
op_assign
id|rport-&gt;dev_loss_tmo
suffix:semicolon
r_struct
id|work_struct
op_star
id|work
op_assign
op_amp
id|rport-&gt;dev_loss_work
suffix:semicolon
r_if
c_cond
(paren
id|timeout
template_param
id|SCSI_DEVICE_BLOCK_MAX_TIMEOUT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scsi_target_block
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* cap the length the devices can be blocked */
id|schedule_delayed_work
c_func
(paren
id|work
comma
id|timeout
op_star
id|HZ
)paren
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_BLOCKED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fc_remote_port_block
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remote_port_block
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_remote_port_unblock - restart any blocked scsi traffic to a remote port.&n; * @rport:&t;remote port to be unblocked.&n; *&n; * scsi lld&squot;s with a FC transport call this routine to restart IO to all&n; * devices associated with the caller&squot;s scsi target following a fc_target_block&n; * request.  Called from interrupt or normal process context.&n; *&n; * Notes:&n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_remote_port_unblock
id|fc_remote_port_unblock
c_func
(paren
r_struct
id|fc_rport
op_star
id|rport
)paren
(brace
r_struct
id|work_struct
op_star
id|work
op_assign
op_amp
id|rport-&gt;dev_loss_work
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|rport_to_shost
c_func
(paren
id|rport
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Stop the target timer first. Take no action on the del_timer&n;&t; * failure as the state machine state change will validate the&n;&t; * transaction.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|cancel_delayed_work
c_func
(paren
id|work
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rport-&gt;port_state
op_eq
id|FC_PORTSTATE_OFFLINE
)paren
multiline_comment|/*&n;&t;&t; * initiate a scan of the target as the target has&n;&t;&t; * been torn down.&n;&t;&t; */
id|scsi_queue_work
c_func
(paren
id|shost
comma
op_amp
id|rport-&gt;scan_work
)paren
suffix:semicolon
r_else
id|scsi_target_unblock
c_func
(paren
op_amp
id|rport-&gt;dev
)paren
suffix:semicolon
id|rport-&gt;port_state
op_assign
id|FC_PORTSTATE_ONLINE
suffix:semicolon
)brace
DECL|variable|fc_remote_port_unblock
id|EXPORT_SYMBOL
c_func
(paren
id|fc_remote_port_unblock
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_scsi_scan_rport - called to perform a scsi scan on a remote port.&n; * @data:&t;remote port to be scanned.&n; **/
r_static
r_void
DECL|function|fc_scsi_scan_rport
id|fc_scsi_scan_rport
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|fc_rport
op_star
id|rport
op_assign
(paren
r_struct
id|fc_rport
op_star
)paren
id|data
suffix:semicolon
id|scsi_scan_target
c_func
(paren
op_amp
id|rport-&gt;dev
comma
id|rport-&gt;channel
comma
id|rport-&gt;scsi_target_id
comma
id|SCAN_WILD_CARD
comma
l_int|1
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Martin Hicks&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FC Transport Attributes&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|fc_transport_init
id|module_init
c_func
(paren
id|fc_transport_init
)paren
suffix:semicolon
DECL|variable|fc_transport_exit
id|module_exit
c_func
(paren
id|fc_transport_exit
)paren
suffix:semicolon
eof
