multiline_comment|/* &n; *  FiberChannel transport specific attributes exported to sysfs.&n; *&n; *  Copyright (c) 2003 Silicon Graphics, Inc.  All rights reserved.&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;scsi/scsi_device.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &lt;scsi/scsi_transport.h&gt;
macro_line|#include &lt;scsi/scsi_transport_fc.h&gt;
macro_line|#include &quot;scsi_priv.h&quot;
DECL|macro|FC_PRINTK
mdefine_line|#define FC_PRINTK(x, l, f, a...)&t;printk(l &quot;scsi(%d:%d:%d:%d): &quot; f, (x)-&gt;host-&gt;host_no, (x)-&gt;channel, (x)-&gt;id, (x)-&gt;lun , ##a)
multiline_comment|/*&n; * Redefine so that we can have same named attributes in the&n; * sdev/starget/host objects.&n; */
DECL|macro|FC_CLASS_DEVICE_ATTR
mdefine_line|#define FC_CLASS_DEVICE_ATTR(_prefix,_name,_mode,_show,_store)&t;&t;&bslash;&n;struct class_device_attribute class_device_attr_##_prefix##_##_name = &t;&bslash;&n;&t;__ATTR(_name,_mode,_show,_store)
DECL|macro|fc_enum_name_search
mdefine_line|#define fc_enum_name_search(title, table_type, table)&t;&t;&t;&bslash;&n;static const char *get_fc_##title##_name(enum table_type table_key)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;char *name = NULL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&t;&bslash;&n;&t;&t;if (table[i].value == table_key) {&t;&t;&t;&bslash;&n;&t;&t;&t;name = table[i].name;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return name;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_enum_name_match
mdefine_line|#define fc_enum_name_match(title, table_type, table)&t;&t;&t;&bslash;&n;static int get_fc_##title##_match(const char *table_key,&t;&t;&bslash;&n;&t;&t;enum table_type *value)&t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&t;&bslash;&n;&t;&t;if (strncmp(table_key, table[i].name,&t;&t;&t;&bslash;&n;&t;&t;&t;&t;table[i].matchlen) == 0) {&t;&t;&bslash;&n;&t;&t;&t;*value = table[i].value;&t;&t;&t;&bslash;&n;&t;&t;&t;return 0; /* success */&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return 1; /* failure */&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/* Convert fc_port_type values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_port_type
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_type_names
)brace
id|fc_port_type_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTTYPE_UNKNOWN
comma
l_string|&quot;Unknown&quot;
)brace
comma
(brace
id|FC_PORTTYPE_OTHER
comma
l_string|&quot;Other&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NOTPRESENT
comma
l_string|&quot;Not Present&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NPORT
comma
l_string|&quot;NPort (fabric via point-to-point)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_NLPORT
comma
l_string|&quot;NLPort (fabric via loop)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_LPORT
comma
l_string|&quot;LPort (private loop)&quot;
)brace
comma
(brace
id|FC_PORTTYPE_PTP
comma
l_string|&quot;Point-To-Point (direct nport connection&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|port_type
comma
id|fc_port_type
comma
id|fc_port_type_names
)paren
DECL|macro|FC_PORTTYPE_MAX_NAMELEN
mdefine_line|#define FC_PORTTYPE_MAX_NAMELEN&t;&t;50
multiline_comment|/* Convert fc_port_state values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_port_state
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_state_names
)brace
id|fc_port_state_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTSTATE_UNKNOWN
comma
l_string|&quot;Unknown&quot;
)brace
comma
(brace
id|FC_PORTSTATE_ONLINE
comma
l_string|&quot;Online&quot;
)brace
comma
(brace
id|FC_PORTSTATE_OFFLINE
comma
l_string|&quot;Offline&quot;
)brace
comma
(brace
id|FC_PORTSTATE_BYPASSED
comma
l_string|&quot;Bypassed&quot;
)brace
comma
(brace
id|FC_PORTSTATE_DIAGNOSTICS
comma
l_string|&quot;Diagnostics&quot;
)brace
comma
(brace
id|FC_PORTSTATE_LINKDOWN
comma
l_string|&quot;Linkdown&quot;
)brace
comma
(brace
id|FC_PORTSTATE_ERROR
comma
l_string|&quot;Error&quot;
)brace
comma
(brace
id|FC_PORTSTATE_LOOPBACK
comma
l_string|&quot;Loopback&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|port_state
comma
id|fc_port_state
comma
id|fc_port_state_names
)paren
DECL|macro|FC_PORTSTATE_MAX_NAMELEN
mdefine_line|#define FC_PORTSTATE_MAX_NAMELEN&t;20
multiline_comment|/* Convert fc_tgtid_binding_type values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
r_enum
id|fc_tgtid_binding_type
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|matchlen
r_int
id|matchlen
suffix:semicolon
DECL|variable|fc_tgtid_binding_type_names
)brace
id|fc_tgtid_binding_type_names
(braket
)braket
op_assign
(brace
(brace
id|FC_TGTID_BIND_BY_WWPN
comma
l_string|&quot;wwpn (World Wide Port Name)&quot;
comma
l_int|4
)brace
comma
(brace
id|FC_TGTID_BIND_BY_WWNN
comma
l_string|&quot;wwnn (World Wide Node Name)&quot;
comma
l_int|4
)brace
comma
(brace
id|FC_TGTID_BIND_BY_ID
comma
l_string|&quot;fcportid (FC Address)&quot;
comma
l_int|8
)brace
comma
)brace
suffix:semicolon
id|fc_enum_name_search
c_func
(paren
id|tgtid_bind_type
comma
id|fc_tgtid_binding_type
comma
id|fc_tgtid_binding_type_names
)paren
id|fc_enum_name_match
c_func
(paren
id|tgtid_bind_type
comma
id|fc_tgtid_binding_type
comma
id|fc_tgtid_binding_type_names
)paren
DECL|macro|FC_BINDTYPE_MAX_NAMELEN
mdefine_line|#define FC_BINDTYPE_MAX_NAMELEN&t;30
DECL|macro|fc_bitfield_name_search
mdefine_line|#define fc_bitfield_name_search(title, table)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&bslash;&n;get_fc_##title##_names(u32 table_key, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;char *prefix = &quot;&quot;;&t;&t;&t;&t;&t;&bslash;&n;&t;ssize_t len = 0;&t;&t;&t;&t;&t;&bslash;&n;&t;int i;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; sizeof(table)/sizeof(table[0]); i++) {&t;&bslash;&n;&t;&t;if (table[i].value &amp; table_key) {&t;&t;&bslash;&n;&t;&t;&t;len += sprintf(buf + len, &quot;%s%s&quot;,&t;&bslash;&n;&t;&t;&t;&t;prefix, table[i].name);&t;&t;&bslash;&n;&t;&t;&t;prefix = &quot;, &quot;;&t;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;len += sprintf(buf + len, &quot;&bslash;n&quot;);&t;&t;&t;&bslash;&n;&t;return len;&t;&t;&t;&t;&t;&t;&bslash;&n;}
multiline_comment|/* Convert fc_cos bit values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
id|u32
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_cos_names
)brace
id|fc_cos_names
(braket
)braket
op_assign
(brace
(brace
id|FC_COS_CLASS1
comma
l_string|&quot;Class 1&quot;
)brace
comma
(brace
id|FC_COS_CLASS2
comma
l_string|&quot;Class 2&quot;
)brace
comma
(brace
id|FC_COS_CLASS3
comma
l_string|&quot;Class 3&quot;
)brace
comma
(brace
id|FC_COS_CLASS4
comma
l_string|&quot;Class 4&quot;
)brace
comma
(brace
id|FC_COS_CLASS6
comma
l_string|&quot;Class 6&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_bitfield_name_search
c_func
(paren
id|cos
comma
id|fc_cos_names
)paren
multiline_comment|/* Convert fc_port_speed bit values to ascii string name */
r_static
r_struct
(brace
DECL|member|value
id|u32
id|value
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fc_port_speed_names
)brace
id|fc_port_speed_names
(braket
)braket
op_assign
(brace
(brace
id|FC_PORTSPEED_1GBIT
comma
l_string|&quot;1 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_2GBIT
comma
l_string|&quot;2 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_4GBIT
comma
l_string|&quot;4 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_10GBIT
comma
l_string|&quot;10 Gbit&quot;
)brace
comma
(brace
id|FC_PORTSPEED_NOT_NEGOTIATED
comma
l_string|&quot;Not Negotiated&quot;
)brace
comma
)brace
suffix:semicolon
id|fc_bitfield_name_search
c_func
(paren
id|port_speed
comma
id|fc_port_speed_names
)paren
r_static
r_int
DECL|function|show_fc_fc4s
id|show_fc_fc4s
(paren
r_char
op_star
id|buf
comma
id|u8
op_star
id|fc4_list
)paren
(brace
r_int
id|i
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FC_FC4_LIST_SIZE
suffix:semicolon
id|i
op_increment
comma
id|fc4_list
op_increment
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;0x%02x &quot;
comma
op_star
id|fc4_list
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_static
r_void
id|fc_timeout_blocked_host
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|fc_timeout_blocked_tgt
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|macro|FC_STARGET_NUM_ATTRS
mdefine_line|#define FC_STARGET_NUM_ATTRS &t;4&t;/* increase this if you add attributes */
DECL|macro|FC_STARGET_OTHER_ATTRS
mdefine_line|#define FC_STARGET_OTHER_ATTRS &t;0&t;/* increase this if you add &quot;always on&quot;&n;&t;&t;&t;&t;&t; * attributes */
DECL|macro|FC_HOST_NUM_ATTRS
mdefine_line|#define FC_HOST_NUM_ATTRS&t;15
DECL|struct|fc_internal
r_struct
id|fc_internal
(brace
DECL|member|t
r_struct
id|scsi_transport_template
id|t
suffix:semicolon
DECL|member|f
r_struct
id|fc_function_template
op_star
id|f
suffix:semicolon
multiline_comment|/* The actual attributes */
DECL|member|private_starget_attrs
r_struct
id|class_device_attribute
id|private_starget_attrs
(braket
id|FC_STARGET_NUM_ATTRS
)braket
suffix:semicolon
multiline_comment|/* The array of null terminated pointers to attributes&n;&t; * needed by scsi_sysfs.c */
DECL|member|starget_attrs
r_struct
id|class_device_attribute
op_star
id|starget_attrs
(braket
id|FC_STARGET_NUM_ATTRS
op_plus
id|FC_STARGET_OTHER_ATTRS
op_plus
l_int|1
)braket
suffix:semicolon
DECL|member|private_host_attrs
r_struct
id|class_device_attribute
id|private_host_attrs
(braket
id|FC_HOST_NUM_ATTRS
)braket
suffix:semicolon
DECL|member|host_attrs
r_struct
id|class_device_attribute
op_star
id|host_attrs
(braket
id|FC_HOST_NUM_ATTRS
op_plus
l_int|1
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|to_fc_internal
mdefine_line|#define to_fc_internal(tmpl)&t;container_of(tmpl, struct fc_internal, t)
DECL|function|fc_add_target
r_static
r_int
id|fc_add_target
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|scsi_target
op_star
id|starget
op_assign
id|to_scsi_target
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Set default values easily detected by the midlayer as&n;&t; * failure cases.  The scsi lldd is responsible for initializing&n;&t; * all transport attributes to valid values per target.&n;&t; */
id|fc_starget_node_name
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_starget_port_name
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_starget_port_id
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_starget_dev_loss_tmo
c_func
(paren
id|starget
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|fc_starget_dev_loss_work
c_func
(paren
id|starget
)paren
comma
id|fc_timeout_blocked_tgt
comma
id|starget
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fc_remove_target
r_static
r_int
id|fc_remove_target
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|scsi_target
op_star
id|starget
op_assign
id|to_scsi_target
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Stop the target timer */
r_if
c_cond
(paren
id|cancel_delayed_work
c_func
(paren
op_amp
id|fc_starget_dev_loss_work
c_func
(paren
id|starget
)paren
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|DECLARE_TRANSPORT_CLASS
c_func
(paren
id|fc_transport_class
comma
l_string|&quot;fc_transport&quot;
comma
id|fc_add_target
comma
id|fc_remove_target
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|fc_add_host
r_static
r_int
id|fc_add_host
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Set default values easily detected by the midlayer as&n;&t; * failure cases.  The scsi lldd is responsible for initializing&n;&t; * all transport attributes to valid values per host.&n;&t; */
id|fc_host_node_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_port_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
op_assign
id|FC_COS_UNSPECIFIED
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_symbolic_name
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_symbolic_name
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSPEED_UNKNOWN
suffix:semicolon
id|fc_host_maxframe_size
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_hardware_version
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_hardware_version
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_firmware_version
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_firmware_version
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_serial_number
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_serial_number
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_opt_rom_version
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_opt_rom_version
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_driver_version
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_driver_version
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_port_id
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_port_type
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTTYPE_UNKNOWN
suffix:semicolon
id|fc_host_port_state
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSTATE_UNKNOWN
suffix:semicolon
id|memset
c_func
(paren
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
)paren
)paren
suffix:semicolon
id|fc_host_speed
c_func
(paren
id|shost
)paren
op_assign
id|FC_PORTSPEED_UNKNOWN
suffix:semicolon
id|fc_host_fabric_name
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_link_down_tmo
c_func
(paren
id|shost
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_assign
id|FC_TGTID_BIND_BY_WWPN
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|fc_host_link_down_work
c_func
(paren
id|shost
)paren
comma
id|fc_timeout_blocked_host
comma
id|shost
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fc_remove_host
r_static
r_int
id|fc_remove_host
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Stop the host timer */
r_if
c_cond
(paren
id|cancel_delayed_work
c_func
(paren
op_amp
id|fc_host_link_down_work
c_func
(paren
id|shost
)paren
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|DECLARE_TRANSPORT_CLASS
c_func
(paren
id|fc_host_class
comma
l_string|&quot;fc_host&quot;
comma
id|fc_add_host
comma
id|fc_remove_host
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|fc_transport_init
r_static
id|__init
r_int
id|fc_transport_init
c_func
(paren
r_void
)paren
(brace
r_int
id|error
op_assign
id|transport_class_register
c_func
(paren
op_amp
id|fc_host_class
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|transport_class_register
c_func
(paren
op_amp
id|fc_transport_class
)paren
suffix:semicolon
)brace
DECL|function|fc_transport_exit
r_static
r_void
id|__exit
id|fc_transport_exit
c_func
(paren
r_void
)paren
(brace
id|transport_class_unregister
c_func
(paren
op_amp
id|fc_transport_class
)paren
suffix:semicolon
id|transport_class_unregister
c_func
(paren
op_amp
id|fc_host_class
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Remote Port (Target) Attribute Management&n; */
DECL|macro|fc_starget_show_function
mdefine_line|#define fc_starget_show_function(field, format_string, cast)&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_starget_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct scsi_target *starget = transport_class_to_starget(cdev);&t;&bslash;&n;&t;struct Scsi_Host *shost = dev_to_shost(starget-&gt;dev.parent);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_starget_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_starget_##field(starget);&t;&t;&t;&bslash;&n;&t;return snprintf(buf, 20, format_string, &t;&t;&t;&bslash;&n;&t;&t;cast fc_starget_##field(starget)); &t;&t;&t;&bslash;&n;}
DECL|macro|fc_starget_store_function
mdefine_line|#define fc_starget_store_function(field, format_string)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;store_fc_starget_##field(struct class_device *cdev, const char *buf,&t;&bslash;&n;&t;&t;&t;   size_t count)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int val;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct scsi_target *starget = transport_class_to_starget(cdev);&t;&bslash;&n;&t;struct Scsi_Host *shost = dev_to_shost(starget-&gt;dev.parent);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;val = simple_strtoul(buf, NULL, 0);&t;&t;&t;&t;&bslash;&n;&t;i-&gt;f-&gt;set_starget_##field(starget, val);&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_starget_rd_attr
mdefine_line|#define fc_starget_rd_attr(field, format_string)&t;&t;&t;&bslash;&n;&t;fc_starget_show_function(field, format_string, )&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(starget, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_starget_##field, NULL)
DECL|macro|fc_starget_rd_attr_cast
mdefine_line|#define fc_starget_rd_attr_cast(field, format_string, cast)&t;&t;&bslash;&n;&t;fc_starget_show_function(field, format_string, (cast))&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(starget, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_starget_##field, NULL)
DECL|macro|fc_starget_rw_attr
mdefine_line|#define fc_starget_rw_attr(field, format_string)&t;&t;&t;&bslash;&n;&t;fc_starget_show_function(field, format_string, )&t;&t;&bslash;&n;&t;fc_starget_store_function(field, format_string)&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(starget, field, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;&t;show_fc_starget_##field,&t;&t;&t;&bslash;&n;&t;&t;&t;store_fc_starget_##field)
DECL|macro|SETUP_STARGET_ATTRIBUTE_RD
mdefine_line|#define SETUP_STARGET_ATTRIBUTE_RD(field)&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count] = class_device_attr_starget_##field; &bslash;&n;&t;i-&gt;private_starget_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;starget_attrs[count] = &amp;i-&gt;private_starget_attrs[count];&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_starget_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|SETUP_STARGET_ATTRIBUTE_RW
mdefine_line|#define SETUP_STARGET_ATTRIBUTE_RW(field)&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_starget_attrs[count] = class_device_attr_starget_##field; &bslash;&n;&t;if (!i-&gt;f-&gt;set_starget_##field) {&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;private_starget_attrs[count].attr.mode = S_IRUGO;&t;&bslash;&n;&t;&t;i-&gt;private_starget_attrs[count].store = NULL;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;starget_attrs[count] = &amp;i-&gt;private_starget_attrs[count];&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_starget_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
multiline_comment|/* The FC Tranport Remote Port (Target) Attributes: */
id|fc_starget_rd_attr_cast
c_func
(paren
id|node_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_starget_rd_attr_cast
c_func
(paren
id|port_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_starget_rd_attr
c_func
(paren
id|port_id
comma
l_string|&quot;0x%06x&bslash;n&quot;
)paren
suffix:semicolon
id|fc_starget_rw_attr
c_func
(paren
id|dev_loss_tmo
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Host Attribute Management&n; */
DECL|macro|fc_host_show_function
mdefine_line|#define fc_host_show_function(field, format_string, sz, cast)&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_host_##field(shost);&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast fc_host_##field(shost)); &bslash;&n;}
DECL|macro|fc_host_store_function
mdefine_line|#define fc_host_store_function(field, format_string)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;store_fc_host_##field(struct class_device *cdev, const char *buf,&t;&bslash;&n;&t;&t;&t;   size_t count)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int val;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;val = simple_strtoul(buf, NULL, 0);&t;&t;&t;&t;&bslash;&n;&t;i-&gt;f-&gt;set_host_##field(shost, val);&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|macro|fc_host_rd_attr
mdefine_line|#define fc_host_rd_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, )&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_host_##field, NULL)
DECL|macro|fc_host_rd_attr_cast
mdefine_line|#define fc_host_rd_attr_cast(field, format_string, sz, cast)&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, (cast))&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_host_##field, NULL)
DECL|macro|fc_host_rw_attr
mdefine_line|#define fc_host_rw_attr(field, format_string, sz)&t;&t;&t;&bslash;&n;&t;fc_host_show_function(field, format_string, sz, )&t;&t;&bslash;&n;&t;fc_host_store_function(field, format_string)&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;&t;show_fc_host_##field,&t;&t;&t;&t;&bslash;&n;&t;&t;&t;store_fc_host_##field)
DECL|macro|fc_host_rd_enum_attr
mdefine_line|#define fc_host_rd_enum_attr(title, maxlen)&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##title (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;struct fc_internal *i = to_fc_internal(shost-&gt;transportt);&t;&bslash;&n;&t;const char *name;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;get_host_##title)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;f-&gt;get_host_##title(shost);&t;&t;&t;&t;&bslash;&n;&t;name = get_fc_##title##_name(fc_host_##title(shost));&t;&t;&bslash;&n;&t;if (!name)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return snprintf(buf, maxlen, &quot;%s&bslash;n&quot;, name);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, title, S_IRUGO, show_fc_host_##title, NULL)
DECL|macro|SETUP_HOST_ATTRIBUTE_RD
mdefine_line|#define SETUP_HOST_ATTRIBUTE_RD(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|SETUP_HOST_ATTRIBUTE_RW
mdefine_line|#define SETUP_HOST_ATTRIBUTE_RW(field)&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;if (!i-&gt;f-&gt;set_host_##field) {&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&bslash;&n;&t;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;if (i-&gt;f-&gt;show_host_##field)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;count++
DECL|macro|fc_private_host_show_function
mdefine_line|#define fc_private_host_show_function(field, format_string, sz, cast)&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_fc_host_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct Scsi_Host *shost = transport_class_to_shost(cdev);&t;&bslash;&n;&t;return snprintf(buf, sz, format_string, cast fc_host_##field(shost)); &bslash;&n;}
DECL|macro|fc_private_host_rd_attr
mdefine_line|#define fc_private_host_rd_attr(field, format_string, sz)&t;&t;&bslash;&n;&t;fc_private_host_show_function(field, format_string, sz, )&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t; show_fc_host_##field, NULL)
DECL|macro|fc_private_host_rd_attr_cast
mdefine_line|#define fc_private_host_rd_attr_cast(field, format_string, sz, cast)&t;&bslash;&n;&t;fc_private_host_show_function(field, format_string, sz, (cast)) &bslash;&n;static FC_CLASS_DEVICE_ATTR(host, field, S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;&t;  show_fc_host_##field, NULL)
DECL|macro|SETUP_PRIVATE_HOST_ATTRIBUTE_RD
mdefine_line|#define SETUP_PRIVATE_HOST_ATTRIBUTE_RD(field)&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].attr.mode = S_IRUGO;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count].store = NULL;&t;&t;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;count++
DECL|macro|SETUP_PRIVATE_HOST_ATTRIBUTE_RW
mdefine_line|#define SETUP_PRIVATE_HOST_ATTRIBUTE_RW(field)&t;&t;&t;&bslash;&n;&t;i-&gt;private_host_attrs[count] = class_device_attr_host_##field;&t;&bslash;&n;&t;i-&gt;host_attrs[count] = &amp;i-&gt;private_host_attrs[count];&t;&t;&bslash;&n;&t;count++
multiline_comment|/* Fixed Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_host_supported_classes
id|show_fc_host_supported_classes
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
op_eq
id|FC_COS_UNSPECIFIED
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unspecified&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_cos_names
c_func
(paren
id|fc_host_supported_classes
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_classes
comma
id|S_IRUGO
comma
id|show_fc_host_supported_classes
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_supported_fc4s
id|show_fc_host_supported_fc4s
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_return
(paren
id|ssize_t
)paren
id|show_fc_fc4s
c_func
(paren
id|buf
comma
id|fc_host_supported_fc4s
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_fc4s
comma
id|S_IRUGO
comma
id|show_fc_host_supported_fc4s
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_supported_speeds
id|show_fc_host_supported_speeds
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
op_eq
id|FC_PORTSPEED_UNKNOWN
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_port_speed_names
c_func
(paren
id|fc_host_supported_speeds
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|supported_speeds
comma
id|S_IRUGO
comma
id|show_fc_host_supported_speeds
comma
l_int|NULL
)paren
suffix:semicolon
id|fc_private_host_rd_attr_cast
c_func
(paren
id|node_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_host_rd_attr_cast
c_func
(paren
id|port_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|symbolic_name
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_SYMBOLIC_NAME_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|maxframe_size
comma
l_string|&quot;%u bytes&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|hardware_version
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_VERSION_STRING_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|firmware_version
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_VERSION_STRING_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|serial_number
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_SERIAL_NUMBER_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|opt_rom_version
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_VERSION_STRING_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|fc_private_host_rd_attr
c_func
(paren
id|driver_version
comma
l_string|&quot;%s&bslash;n&quot;
comma
(paren
id|FC_VERSION_STRING_SIZE
op_plus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* Dynamic Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_host_active_fc4s
id|show_fc_host_active_fc4s
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_host_active_fc4s
)paren
id|i-&gt;f
op_member_access_from_pointer
id|get_host_active_fc4s
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
(paren
id|ssize_t
)paren
id|show_fc_fc4s
c_func
(paren
id|buf
comma
id|fc_host_active_fc4s
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|active_fc4s
comma
id|S_IRUGO
comma
id|show_fc_host_active_fc4s
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|show_fc_host_speed
id|show_fc_host_speed
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_host_speed
)paren
id|i-&gt;f
op_member_access_from_pointer
id|get_host_speed
c_func
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fc_host_speed
c_func
(paren
id|shost
)paren
op_eq
id|FC_PORTSPEED_UNKNOWN
)paren
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|get_fc_port_speed_names
c_func
(paren
id|fc_host_speed
c_func
(paren
id|shost
)paren
comma
id|buf
)paren
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|speed
comma
id|S_IRUGO
comma
id|show_fc_host_speed
comma
l_int|NULL
)paren
suffix:semicolon
id|fc_host_rd_attr
c_func
(paren
id|port_id
comma
l_string|&quot;0x%06x&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
id|fc_host_rd_enum_attr
c_func
(paren
id|port_type
comma
id|FC_PORTTYPE_MAX_NAMELEN
)paren
suffix:semicolon
id|fc_host_rd_enum_attr
c_func
(paren
id|port_state
comma
id|FC_PORTSTATE_MAX_NAMELEN
)paren
suffix:semicolon
id|fc_host_rd_attr_cast
c_func
(paren
id|fabric_name
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
l_int|20
comma
r_int
r_int
r_int
)paren
suffix:semicolon
id|fc_host_rw_attr
c_func
(paren
id|link_down_tmo
comma
l_string|&quot;%d&bslash;n&quot;
comma
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Private Host Attributes */
r_static
id|ssize_t
DECL|function|show_fc_private_host_tgtid_bind_type
id|show_fc_private_host_tgtid_bind_type
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
id|name
op_assign
id|get_fc_tgtid_bind_type_name
c_func
(paren
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|FC_BINDTYPE_MAX_NAMELEN
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_fc_private_host_tgtid_bind_type
id|store_fc_private_host_tgtid_bind_type
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_enum
id|fc_tgtid_binding_type
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_fc_tgtid_bind_type_match
c_func
(paren
id|buf
comma
op_amp
id|val
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fc_host_tgtid_bind_type
c_func
(paren
id|shost
)paren
op_assign
id|val
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|tgtid_bind_type
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_fc_private_host_tgtid_bind_type
comma
id|store_fc_private_host_tgtid_bind_type
)paren
suffix:semicolon
multiline_comment|/*&n; * Host Statistics Management&n; */
multiline_comment|/* Show a given an attribute in the statistics group */
r_static
id|ssize_t
DECL|function|fc_stat_show
id|fc_stat_show
c_func
(paren
r_const
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
comma
r_int
r_int
id|offset
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_struct
id|fc_host_statistics
op_star
id|stats
suffix:semicolon
id|ssize_t
id|ret
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
r_sizeof
(paren
r_struct
id|fc_host_statistics
)paren
op_logical_or
id|offset
op_mod
r_sizeof
(paren
id|u64
)paren
op_ne
l_int|0
)paren
id|WARN_ON
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;f-&gt;get_fc_host_stats
)paren
(brace
id|stats
op_assign
(paren
id|i-&gt;f-&gt;get_fc_host_stats
)paren
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stats
)paren
id|ret
op_assign
id|snprintf
c_func
(paren
id|buf
comma
l_int|20
comma
l_string|&quot;0x%llx&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
op_star
(paren
id|u64
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|stats
)paren
op_plus
id|offset
)paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* generate a read-only statistics attribute */
DECL|macro|fc_host_statistic
mdefine_line|#define fc_host_statistic(name)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fcstat_##name(struct class_device *cd, char *buf) &t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return fc_stat_show(cd, buf, &t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;    offsetof(struct fc_host_statistics, name));&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static FC_CLASS_DEVICE_ATTR(host, name, S_IRUGO, show_fcstat_##name, NULL)
DECL|variable|seconds_since_last_reset
id|fc_host_statistic
c_func
(paren
id|seconds_since_last_reset
)paren
suffix:semicolon
DECL|variable|tx_frames
id|fc_host_statistic
c_func
(paren
id|tx_frames
)paren
suffix:semicolon
DECL|variable|tx_words
id|fc_host_statistic
c_func
(paren
id|tx_words
)paren
suffix:semicolon
DECL|variable|rx_frames
id|fc_host_statistic
c_func
(paren
id|rx_frames
)paren
suffix:semicolon
DECL|variable|rx_words
id|fc_host_statistic
c_func
(paren
id|rx_words
)paren
suffix:semicolon
DECL|variable|lip_count
id|fc_host_statistic
c_func
(paren
id|lip_count
)paren
suffix:semicolon
DECL|variable|nos_count
id|fc_host_statistic
c_func
(paren
id|nos_count
)paren
suffix:semicolon
DECL|variable|error_frames
id|fc_host_statistic
c_func
(paren
id|error_frames
)paren
suffix:semicolon
DECL|variable|dumped_frames
id|fc_host_statistic
c_func
(paren
id|dumped_frames
)paren
suffix:semicolon
DECL|variable|link_failure_count
id|fc_host_statistic
c_func
(paren
id|link_failure_count
)paren
suffix:semicolon
DECL|variable|loss_of_sync_count
id|fc_host_statistic
c_func
(paren
id|loss_of_sync_count
)paren
suffix:semicolon
DECL|variable|loss_of_signal_count
id|fc_host_statistic
c_func
(paren
id|loss_of_signal_count
)paren
suffix:semicolon
DECL|variable|prim_seq_protocol_err_count
id|fc_host_statistic
c_func
(paren
id|prim_seq_protocol_err_count
)paren
suffix:semicolon
DECL|variable|invalid_tx_word_count
id|fc_host_statistic
c_func
(paren
id|invalid_tx_word_count
)paren
suffix:semicolon
DECL|variable|invalid_crc_count
id|fc_host_statistic
c_func
(paren
id|invalid_crc_count
)paren
suffix:semicolon
DECL|variable|fcp_input_requests
id|fc_host_statistic
c_func
(paren
id|fcp_input_requests
)paren
suffix:semicolon
DECL|variable|fcp_output_requests
id|fc_host_statistic
c_func
(paren
id|fcp_output_requests
)paren
suffix:semicolon
DECL|variable|fcp_control_requests
id|fc_host_statistic
c_func
(paren
id|fcp_control_requests
)paren
suffix:semicolon
DECL|variable|fcp_input_megabytes
id|fc_host_statistic
c_func
(paren
id|fcp_input_megabytes
)paren
suffix:semicolon
DECL|variable|fcp_output_megabytes
id|fc_host_statistic
c_func
(paren
id|fcp_output_megabytes
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|fc_reset_statistics
id|fc_reset_statistics
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|transport_class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
multiline_comment|/* ignore any data value written to the attribute */
r_if
c_cond
(paren
id|i-&gt;f-&gt;reset_fc_host_stats
)paren
(brace
id|i-&gt;f
op_member_access_from_pointer
id|reset_fc_host_stats
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_static
id|FC_CLASS_DEVICE_ATTR
c_func
(paren
id|host
comma
id|reset_statistics
comma
id|S_IWUSR
comma
l_int|NULL
comma
id|fc_reset_statistics
)paren
suffix:semicolon
DECL|variable|fc_statistics_attrs
r_static
r_struct
id|attribute
op_star
id|fc_statistics_attrs
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_host_seconds_since_last_reset.attr
comma
op_amp
id|class_device_attr_host_tx_frames.attr
comma
op_amp
id|class_device_attr_host_tx_words.attr
comma
op_amp
id|class_device_attr_host_rx_frames.attr
comma
op_amp
id|class_device_attr_host_rx_words.attr
comma
op_amp
id|class_device_attr_host_lip_count.attr
comma
op_amp
id|class_device_attr_host_nos_count.attr
comma
op_amp
id|class_device_attr_host_error_frames.attr
comma
op_amp
id|class_device_attr_host_dumped_frames.attr
comma
op_amp
id|class_device_attr_host_link_failure_count.attr
comma
op_amp
id|class_device_attr_host_loss_of_sync_count.attr
comma
op_amp
id|class_device_attr_host_loss_of_signal_count.attr
comma
op_amp
id|class_device_attr_host_prim_seq_protocol_err_count.attr
comma
op_amp
id|class_device_attr_host_invalid_tx_word_count.attr
comma
op_amp
id|class_device_attr_host_invalid_crc_count.attr
comma
op_amp
id|class_device_attr_host_fcp_input_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_output_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_control_requests.attr
comma
op_amp
id|class_device_attr_host_fcp_input_megabytes.attr
comma
op_amp
id|class_device_attr_host_fcp_output_megabytes.attr
comma
op_amp
id|class_device_attr_host_reset_statistics.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|fc_statistics_group
r_static
r_struct
id|attribute_group
id|fc_statistics_group
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;statistics&quot;
comma
dot
id|attrs
op_assign
id|fc_statistics_attrs
comma
)brace
suffix:semicolon
DECL|function|fc_host_match
r_static
r_int
id|fc_host_match
c_func
(paren
r_struct
id|attribute_container
op_star
id|cont
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsi_is_host_device
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost-&gt;transportt
op_logical_or
id|shost-&gt;transportt-&gt;host_attrs
dot
r_class
op_ne
op_amp
id|fc_host_class
dot
r_class
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_return
op_amp
id|i-&gt;t.host_attrs
op_eq
id|cont
suffix:semicolon
)brace
DECL|function|fc_target_match
r_static
r_int
id|fc_target_match
c_func
(paren
r_struct
id|attribute_container
op_star
id|cont
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_struct
id|fc_internal
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsi_is_target_device
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|shost
op_assign
id|dev_to_shost
c_func
(paren
id|dev-&gt;parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost-&gt;transportt
op_logical_or
id|shost-&gt;transportt-&gt;host_attrs
dot
r_class
op_ne
op_amp
id|fc_host_class
dot
r_class
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|shost-&gt;transportt
)paren
suffix:semicolon
r_return
op_amp
id|i-&gt;t.target_attrs
op_eq
id|cont
suffix:semicolon
)brace
r_struct
id|scsi_transport_template
op_star
DECL|function|fc_attach_transport
id|fc_attach_transport
c_func
(paren
r_struct
id|fc_function_template
op_star
id|ft
)paren
(brace
r_struct
id|fc_internal
op_star
id|i
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fc_internal
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
id|i
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|i
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fc_internal
)paren
)paren
suffix:semicolon
id|i-&gt;t.target_attrs.attrs
op_assign
op_amp
id|i-&gt;starget_attrs
(braket
l_int|0
)braket
suffix:semicolon
id|i-&gt;t.target_attrs
dot
r_class
op_assign
op_amp
id|fc_transport_class
dot
r_class
suffix:semicolon
id|i-&gt;t.target_attrs.match
op_assign
id|fc_target_match
suffix:semicolon
id|attribute_container_register
c_func
(paren
op_amp
id|i-&gt;t.target_attrs
)paren
suffix:semicolon
id|i-&gt;t.target_size
op_assign
r_sizeof
(paren
r_struct
id|fc_starget_attrs
)paren
suffix:semicolon
id|i-&gt;t.host_attrs.attrs
op_assign
op_amp
id|i-&gt;host_attrs
(braket
l_int|0
)braket
suffix:semicolon
id|i-&gt;t.host_attrs
dot
r_class
op_assign
op_amp
id|fc_host_class
dot
r_class
suffix:semicolon
id|i-&gt;t.host_attrs.match
op_assign
id|fc_host_match
suffix:semicolon
id|attribute_container_register
c_func
(paren
op_amp
id|i-&gt;t.host_attrs
)paren
suffix:semicolon
id|i-&gt;t.host_size
op_assign
r_sizeof
(paren
r_struct
id|fc_host_attrs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ft-&gt;get_fc_host_stats
)paren
id|i-&gt;t.host_statistics
op_assign
op_amp
id|fc_statistics_group
suffix:semicolon
id|i-&gt;f
op_assign
id|ft
suffix:semicolon
multiline_comment|/*&n;&t; * setup remote port (target) attributes&n;&t; */
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|port_id
)paren
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|port_name
)paren
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RD
c_func
(paren
id|node_name
)paren
suffix:semicolon
id|SETUP_STARGET_ATTRIBUTE_RW
c_func
(paren
id|dev_loss_tmo
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|count
OG
id|FC_STARGET_NUM_ATTRS
)paren
suffix:semicolon
multiline_comment|/* Setup the always-on attributes here */
id|i-&gt;starget_attrs
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* setup host attributes */
id|count
op_assign
l_int|0
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|node_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_classes
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_fc4s
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|symbolic_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|supported_speeds
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|maxframe_size
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|hardware_version
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|firmware_version
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|serial_number
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|opt_rom_version
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|driver_version
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_id
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_type
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|port_state
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|active_fc4s
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|speed
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RD
c_func
(paren
id|fabric_name
)paren
suffix:semicolon
id|SETUP_HOST_ATTRIBUTE_RW
c_func
(paren
id|link_down_tmo
)paren
suffix:semicolon
multiline_comment|/* Transport-managed attributes */
id|SETUP_PRIVATE_HOST_ATTRIBUTE_RW
c_func
(paren
id|tgtid_bind_type
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|count
OG
id|FC_HOST_NUM_ATTRS
)paren
suffix:semicolon
id|i-&gt;host_attrs
(braket
id|count
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
op_amp
id|i-&gt;t
suffix:semicolon
)brace
DECL|variable|fc_attach_transport
id|EXPORT_SYMBOL
c_func
(paren
id|fc_attach_transport
)paren
suffix:semicolon
DECL|function|fc_release_transport
r_void
id|fc_release_transport
c_func
(paren
r_struct
id|scsi_transport_template
op_star
id|t
)paren
(brace
r_struct
id|fc_internal
op_star
id|i
op_assign
id|to_fc_internal
c_func
(paren
id|t
)paren
suffix:semicolon
id|attribute_container_unregister
c_func
(paren
op_amp
id|i-&gt;t.target_attrs
)paren
suffix:semicolon
id|attribute_container_unregister
c_func
(paren
op_amp
id|i-&gt;t.host_attrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|variable|fc_release_transport
id|EXPORT_SYMBOL
c_func
(paren
id|fc_release_transport
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_device_block - called by target functions to block a scsi device&n; * @dev:&t;scsi device&n; * @data:&t;unused&n; **/
DECL|function|fc_device_block
r_static
r_void
id|fc_device_block
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
comma
r_void
op_star
id|data
)paren
(brace
id|scsi_internal_device_block
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_device_unblock - called by target functions to unblock a scsi device&n; * @dev:&t;scsi device&n; * @data:&t;unused&n; **/
DECL|function|fc_device_unblock
r_static
r_void
id|fc_device_unblock
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
comma
r_void
op_star
id|data
)paren
(brace
id|scsi_internal_device_unblock
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_timeout_blocked_tgt - Timeout handler for blocked scsi targets&n; *&t;&t;&t; that fail to recover in the alloted time.&n; * @data:&t;scsi target that failed to reappear in the alloted time.&n; **/
DECL|function|fc_timeout_blocked_tgt
r_static
r_void
id|fc_timeout_blocked_tgt
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|scsi_target
op_star
id|starget
op_assign
(paren
r_struct
id|scsi_target
op_star
)paren
id|data
suffix:semicolon
id|dev_printk
c_func
(paren
id|KERN_ERR
comma
op_amp
id|starget-&gt;dev
comma
l_string|&quot;blocked target time out: target resuming&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * set the device going again ... if the scsi lld didn&squot;t&n;&t; * unblock this device, then IO errors will probably&n;&t; * result if the host still isn&squot;t ready.&n;&t; */
id|starget_for_each_device
c_func
(paren
id|starget
comma
l_int|NULL
comma
id|fc_device_unblock
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * fc_target_block - block a target by temporarily putting all its scsi devices&n; *&t;&t;into the SDEV_BLOCK state.&n; * @starget:&t;scsi target managed by this fc scsi lldd.&n; *&n; * scsi lldd&squot;s with a FC transport call this routine to temporarily stop all&n; * scsi commands to all devices managed by this scsi target.  Called &n; * from interrupt or normal process context.&n; *&n; * Returns zero if successful or error if not&n; *&n; * Notes:       &n; *&t;The timeout and timer types are extracted from the fc transport &n; *&t;attributes from the caller&squot;s target pointer.  This routine assumes no&n; *&t;locks are held on entry.&n; **/
r_int
DECL|function|fc_target_block
id|fc_target_block
c_func
(paren
r_struct
id|scsi_target
op_star
id|starget
)paren
(brace
r_int
id|timeout
op_assign
id|fc_starget_dev_loss_tmo
c_func
(paren
id|starget
)paren
suffix:semicolon
r_struct
id|work_struct
op_star
id|work
op_assign
op_amp
id|fc_starget_dev_loss_work
c_func
(paren
id|starget
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
template_param
id|SCSI_DEVICE_BLOCK_MAX_TIMEOUT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|starget_for_each_device
c_func
(paren
id|starget
comma
l_int|NULL
comma
id|fc_device_block
)paren
suffix:semicolon
multiline_comment|/* The scsi lld blocks this target for the timeout period only. */
id|schedule_delayed_work
c_func
(paren
id|work
comma
id|timeout
op_star
id|HZ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fc_target_block
id|EXPORT_SYMBOL
c_func
(paren
id|fc_target_block
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_target_unblock - unblock a target following a fc_target_block request.&n; * @starget:&t;scsi target managed by this fc scsi lldd.&t;&n; *&n; * scsi lld&squot;s with a FC transport call this routine to restart IO to all &n; * devices associated with the caller&squot;s scsi target following a fc_target_block&n; * request.  Called from interrupt or normal process context.&n; *&n; * Notes:       &n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_target_unblock
id|fc_target_unblock
c_func
(paren
r_struct
id|scsi_target
op_star
id|starget
)paren
(brace
multiline_comment|/* &n;&t; * Stop the target timer first. Take no action on the del_timer&n;&t; * failure as the state machine state change will validate the&n;&t; * transaction. &n;&t; */
r_if
c_cond
(paren
id|cancel_delayed_work
c_func
(paren
op_amp
id|fc_starget_dev_loss_work
c_func
(paren
id|starget
)paren
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
id|starget_for_each_device
c_func
(paren
id|starget
comma
l_int|NULL
comma
id|fc_device_unblock
)paren
suffix:semicolon
)brace
DECL|variable|fc_target_unblock
id|EXPORT_SYMBOL
c_func
(paren
id|fc_target_unblock
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_timeout_blocked_host - Timeout handler for blocked scsi hosts&n; *&t;&t;&t; that fail to recover in the alloted time.&n; * @data:&t;scsi host that failed to recover its devices in the alloted&n; *&t;&t;time.&n; **/
DECL|function|fc_timeout_blocked_host
r_static
r_void
id|fc_timeout_blocked_host
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
(paren
r_struct
id|Scsi_Host
op_star
)paren
id|data
suffix:semicolon
r_struct
id|scsi_device
op_star
id|sdev
suffix:semicolon
id|dev_printk
c_func
(paren
id|KERN_ERR
comma
op_amp
id|shost-&gt;shost_gendev
comma
l_string|&quot;blocked host time out: host resuming&bslash;n&quot;
)paren
suffix:semicolon
id|shost_for_each_device
c_func
(paren
id|sdev
comma
id|shost
)paren
(brace
multiline_comment|/* &n;&t;&t; * set the device going again ... if the scsi lld didn&squot;t&n;&t;&t; * unblock this device, then IO errors will probably&n;&t;&t; * result if the host still isn&squot;t ready.&n;&t;&t; */
id|scsi_internal_device_unblock
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * fc_host_block - block all scsi devices managed by the calling host temporarily &n; *&t;&t;by putting each device in the SDEV_BLOCK state.&n; * @shost:&t;scsi host pointer that contains all scsi device siblings.&n; *&n; * scsi lld&squot;s with a FC transport call this routine to temporarily stop all&n; * scsi commands to all devices managed by this host.  Called &n; * from interrupt or normal process context.&n; *&n; * Returns zero if successful or error if not&n; *&n; * Notes:&n; *&t;The timeout and timer types are extracted from the fc transport &n; *&t;attributes from the caller&squot;s host pointer.  This routine assumes no&n; *&t;locks are held on entry.&n; **/
r_int
DECL|function|fc_host_block
id|fc_host_block
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shost
)paren
(brace
r_struct
id|scsi_device
op_star
id|sdev
suffix:semicolon
r_int
id|timeout
op_assign
id|fc_host_link_down_tmo
c_func
(paren
id|shost
)paren
suffix:semicolon
r_struct
id|work_struct
op_star
id|work
op_assign
op_amp
id|fc_host_link_down_work
c_func
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
template_param
id|SCSI_DEVICE_BLOCK_MAX_TIMEOUT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|shost_for_each_device
c_func
(paren
id|sdev
comma
id|shost
)paren
(brace
id|scsi_internal_device_block
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
id|schedule_delayed_work
c_func
(paren
id|work
comma
id|timeout
op_star
id|HZ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fc_host_block
id|EXPORT_SYMBOL
c_func
(paren
id|fc_host_block
)paren
suffix:semicolon
multiline_comment|/**&n; * fc_host_unblock - unblock all devices managed by this host following a &n; *&t;&t;fc_host_block request.&n; * @shost:&t;scsi host containing all scsi device siblings to unblock.&n; *&n; * scsi lld&squot;s with a FC transport call this routine to restart IO to all scsi&n; * devices managed by the specified scsi host following an fc_host_block &n; * request.  Called from interrupt or normal process context.&n; *&n; * Notes:       &n; *&t;This routine assumes no locks are held on entry.&n; **/
r_void
DECL|function|fc_host_unblock
id|fc_host_unblock
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shost
)paren
(brace
r_struct
id|scsi_device
op_star
id|sdev
suffix:semicolon
multiline_comment|/* &n;&t; * Stop the host timer first. Take no action on the del_timer&n;&t; * failure as the state machine state change will validate the&n;&t; * transaction.&n;&t; */
r_if
c_cond
(paren
id|cancel_delayed_work
c_func
(paren
op_amp
id|fc_host_link_down_work
c_func
(paren
id|shost
)paren
)paren
)paren
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
id|shost_for_each_device
c_func
(paren
id|sdev
comma
id|shost
)paren
(brace
id|scsi_internal_device_unblock
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
)brace
DECL|variable|fc_host_unblock
id|EXPORT_SYMBOL
c_func
(paren
id|fc_host_unblock
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Martin Hicks&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FC Transport Attributes&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|fc_transport_init
id|module_init
c_func
(paren
id|fc_transport_init
)paren
suffix:semicolon
DECL|variable|fc_transport_exit
id|module_exit
c_func
(paren
id|fc_transport_exit
)paren
suffix:semicolon
eof
