multiline_comment|/* &n; *  Parallel SCSI (SPI) transport specific attributes exported to sysfs.&n; *&n; *  Copyright (c) 2003 Silicon Graphics, Inc.  All rights reserved.&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;scsi/scsi_device.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &lt;scsi/scsi_transport.h&gt;
macro_line|#include &lt;scsi/scsi_transport_spi.h&gt;
r_static
r_void
id|transport_class_release
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
)paren
suffix:semicolon
DECL|variable|spi_transport_class
r_struct
r_class
id|spi_transport_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;spi_transport&quot;
comma
dot
id|release
op_assign
id|transport_class_release
comma
)brace
suffix:semicolon
DECL|function|spi_transport_init
r_static
id|__init
r_int
id|spi_transport_init
c_func
(paren
r_void
)paren
(brace
r_return
id|class_register
c_func
(paren
op_amp
id|spi_transport_class
)paren
suffix:semicolon
)brace
DECL|function|spi_transport_exit
r_static
r_void
id|__exit
id|spi_transport_exit
c_func
(paren
r_void
)paren
(brace
id|class_unregister
c_func
(paren
op_amp
id|spi_transport_class
)paren
suffix:semicolon
)brace
DECL|function|spi_setup_transport_attrs
r_static
r_int
id|spi_setup_transport_attrs
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
)paren
(brace
id|spi_period
c_func
(paren
id|sdev
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* illegal value */
id|spi_offset
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* async */
id|spi_width
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* narrow */
id|spi_iu
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no IU */
id|spi_dt
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ST */
id|spi_qas
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
id|spi_wr_flow
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
id|spi_rd_strm
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
id|spi_rti
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
id|spi_pcomp_en
c_func
(paren
id|sdev
)paren
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|transport_class_release
r_static
r_void
id|transport_class_release
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
)paren
(brace
r_struct
id|scsi_device
op_star
id|sdev
op_assign
id|transport_class_to_sdev
c_func
(paren
id|class_dev
)paren
suffix:semicolon
id|put_device
c_func
(paren
op_amp
id|sdev-&gt;sdev_gendev
)paren
suffix:semicolon
)brace
DECL|macro|spi_transport_show_function
mdefine_line|#define spi_transport_show_function(field, format_string)&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_spi_transport_##field (struct class_device *cdev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct scsi_device *sdev = transport_class_to_sdev(cdev);&t;&t;&bslash;&n;&t;struct spi_transport_attrs *tp;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;tp = (struct spi_transport_attrs *)&amp;sdev-&gt;transport_data;&t;&t;&bslash;&n;&t;return snprintf(buf, 20, format_string, tp-&gt;field);&t;&t;&t;&bslash;&n;}
DECL|macro|spi_transport_rd_attr
mdefine_line|#define spi_transport_rd_attr(field, format_string)&t;&t;&t;&t;&bslash;&n;&t;spi_transport_show_function(field, format_string)&t;&t;&t;&bslash;&n;static CLASS_DEVICE_ATTR( field, S_IRUGO, show_spi_transport_##field, NULL)
multiline_comment|/* The Parallel SCSI Tranport Attributes: */
id|spi_transport_rd_attr
c_func
(paren
id|offset
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|width
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|iu
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|dt
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|qas
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|wr_flow
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|rd_strm
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|rti
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
id|spi_transport_rd_attr
c_func
(paren
id|pcomp_en
comma
l_string|&quot;%d&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Translate the period into ns according to the current spec&n; * for SDTR/PPR messages */
DECL|function|show_spi_transport_period
r_static
id|ssize_t
id|show_spi_transport_period
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|scsi_device
op_star
id|sdev
op_assign
id|transport_class_to_sdev
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|spi_transport_attrs
op_star
id|tp
suffix:semicolon
r_char
op_star
id|str
suffix:semicolon
id|tp
op_assign
(paren
r_struct
id|spi_transport_attrs
op_star
)paren
op_amp
id|sdev-&gt;transport_data
suffix:semicolon
r_switch
c_cond
(paren
id|tp-&gt;period
)paren
(brace
r_case
l_int|0x00
dot
dot
dot
l_int|0x06
suffix:colon
id|str
op_assign
l_string|&quot;reserved&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x07
suffix:colon
id|str
op_assign
l_string|&quot;3.125&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
id|str
op_assign
l_string|&quot;6.25&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x09
suffix:colon
id|str
op_assign
l_string|&quot;12.5&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0a
suffix:colon
id|str
op_assign
l_string|&quot;25&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0b
suffix:colon
id|str
op_assign
l_string|&quot;30.3&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0c
suffix:colon
id|str
op_assign
l_string|&quot;50&quot;
suffix:semicolon
r_case
l_int|0x0d
dot
dot
dot
l_int|0xff
suffix:colon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|tp-&gt;period
op_star
l_int|4
)paren
suffix:semicolon
r_default
suffix:colon
id|str
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
)brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|period
comma
id|S_IRUGO
comma
id|show_spi_transport_period
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|spi_transport_attrs
r_struct
id|class_device_attribute
op_star
id|spi_transport_attrs
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_period
comma
op_amp
id|class_device_attr_offset
comma
op_amp
id|class_device_attr_width
comma
op_amp
id|class_device_attr_iu
comma
op_amp
id|class_device_attr_dt
comma
op_amp
id|class_device_attr_qas
comma
op_amp
id|class_device_attr_wr_flow
comma
op_amp
id|class_device_attr_rd_strm
comma
op_amp
id|class_device_attr_rti
comma
op_amp
id|class_device_attr_pcomp_en
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|spi_transport_template
r_struct
id|scsi_transport_template
id|spi_transport_template
op_assign
(brace
dot
id|attrs
op_assign
id|spi_transport_attrs
comma
dot
r_class
op_assign
op_amp
id|spi_transport_class
comma
dot
id|setup
op_assign
op_amp
id|spi_setup_transport_attrs
comma
dot
id|cleanup
op_assign
l_int|NULL
comma
dot
id|size
op_assign
r_sizeof
(paren
r_struct
id|spi_transport_attrs
)paren
op_minus
r_sizeof
(paren
r_int
r_int
)paren
comma
)brace
suffix:semicolon
DECL|variable|spi_transport_template
id|EXPORT_SYMBOL
c_func
(paren
id|spi_transport_template
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Martin Hicks&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SPI Transport Attributes&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|spi_transport_init
id|module_init
c_func
(paren
id|spi_transport_init
)paren
suffix:semicolon
DECL|variable|spi_transport_exit
id|module_exit
c_func
(paren
id|spi_transport_exit
)paren
suffix:semicolon
eof
