multiline_comment|/* gdth_proc.c &n; * $Id: gdth_proc.c,v 1.42 2004/03/05 15:50:20 achim Exp $&n; */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,7)
macro_line|#include &lt;linux/completion.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|function|gdth_proc_info
r_int
id|gdth_proc_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
comma
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|inout
)paren
(brace
r_int
id|hanum
comma
id|busnum
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_proc_info() length %d offs %d inout %d&bslash;n&quot;
comma
id|length
comma
(paren
r_int
)paren
id|offset
comma
id|inout
)paren
)paren
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|busnum
op_assign
id|NUMDATA
c_func
(paren
id|host
)paren
op_member_access_from_pointer
id|busnum
suffix:semicolon
r_if
c_cond
(paren
id|inout
)paren
r_return
id|gdth_set_info
c_func
(paren
id|buffer
comma
id|length
comma
id|host
comma
id|hanum
comma
id|busnum
)paren
suffix:semicolon
r_else
r_return
id|gdth_get_info
c_func
(paren
id|buffer
comma
id|start
comma
id|offset
comma
id|length
comma
id|host
comma
id|hanum
comma
id|busnum
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|gdth_proc_info
r_int
id|gdth_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|hostno
comma
r_int
id|inout
)paren
(brace
r_int
id|hanum
comma
id|busnum
comma
id|i
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_proc_info() length %d offs %d inout %d&bslash;n&quot;
comma
id|length
comma
(paren
r_int
)paren
id|offset
comma
id|inout
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gdth_ctr_vcount
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gdth_ctr_vtab
(braket
id|i
)braket
op_member_access_from_pointer
id|host_no
op_eq
id|hostno
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|gdth_ctr_vcount
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|gdth_ctr_vtab
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|busnum
op_assign
id|NUMDATA
c_func
(paren
id|gdth_ctr_vtab
(braket
id|i
)braket
)paren
op_member_access_from_pointer
id|busnum
suffix:semicolon
r_if
c_cond
(paren
id|inout
)paren
r_return
id|gdth_set_info
c_func
(paren
id|buffer
comma
id|length
comma
id|gdth_ctr_vtab
(braket
id|i
)braket
comma
id|hanum
comma
id|busnum
)paren
suffix:semicolon
r_else
r_return
id|gdth_get_info
c_func
(paren
id|buffer
comma
id|start
comma
id|offset
comma
id|length
comma
id|gdth_ctr_vtab
(braket
id|i
)braket
comma
id|hanum
comma
id|busnum
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|gdth_set_info
r_static
r_int
id|gdth_set_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_struct
id|Scsi_Host
op_star
id|host
comma
r_int
id|hanum
comma
r_int
id|busnum
)paren
(brace
r_int
id|ret_val
op_assign
op_minus
id|EINVAL
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
id|Scsi_Device
id|sdev
suffix:semicolon
macro_line|#endif
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_set_info() ha %d bus %d&bslash;n&quot;
comma
id|hanum
comma
id|busnum
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|host
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_request
c_func
(paren
id|sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|host
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|sdev.host
op_assign
id|scp.host
op_assign
id|host
suffix:semicolon
id|sdev.id
op_assign
id|scp.target
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|sdev
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|length
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;gdth&quot;
comma
l_int|4
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|5
suffix:semicolon
id|length
op_sub_assign
l_int|5
suffix:semicolon
id|ret_val
op_assign
id|gdth_set_asc_info
c_func
(paren
id|buffer
comma
id|length
comma
id|hanum
comma
id|scp
)paren
suffix:semicolon
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_release_request
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret_val
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|function|gdth_set_asc_info
r_static
r_int
id|gdth_set_asc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_int
id|hanum
comma
id|Scsi_Request
op_star
id|scp
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
r_static
r_int
id|gdth_set_asc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
macro_line|#else
r_static
r_int
id|gdth_set_asc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|length
comma
r_int
id|hanum
comma
id|Scsi_Cmnd
id|scp
)paren
macro_line|#endif
(brace
r_int
id|orig_length
comma
id|drive
comma
id|wb_mode
suffix:semicolon
r_int
id|i
comma
id|found
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_cmd_str
id|gdtcmd
suffix:semicolon
id|gdth_cpar_str
op_star
id|pcpar
suffix:semicolon
id|ulong64
id|paddr
suffix:semicolon
r_char
id|cmnd
(braket
id|MAX_COMMAND_SIZE
)braket
suffix:semicolon
id|memset
c_func
(paren
id|cmnd
comma
l_int|0xff
comma
l_int|12
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|gdtcmd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_set_asc_info() ha %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|orig_length
op_assign
id|length
op_plus
l_int|5
suffix:semicolon
id|drive
op_assign
op_minus
l_int|1
suffix:semicolon
id|wb_mode
op_assign
l_int|0
suffix:semicolon
id|found
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|length
op_ge
l_int|5
op_logical_and
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;flush&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|6
suffix:semicolon
id|length
op_sub_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|length
op_logical_and
op_star
id|buffer
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|buffer
op_le
l_char|&squot;9&squot;
)paren
(brace
id|drive
op_assign
(paren
r_int
)paren
(paren
op_star
id|buffer
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
op_increment
id|buffer
suffix:semicolon
op_decrement
id|length
suffix:semicolon
r_if
c_cond
(paren
id|length
op_logical_and
op_star
id|buffer
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|buffer
op_le
l_char|&squot;9&squot;
)paren
(brace
id|drive
op_assign
id|drive
op_star
l_int|10
op_plus
(paren
r_int
)paren
(paren
op_star
id|buffer
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
op_increment
id|buffer
suffix:semicolon
op_decrement
id|length
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;GDT: Flushing host drive %d .. &quot;
comma
id|drive
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Flushing all host drives .. &quot;
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
)paren
(brace
r_if
c_cond
(paren
id|drive
op_ne
op_minus
l_int|1
op_logical_and
id|i
op_ne
id|drive
)paren
r_continue
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_FLUSH
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
id|gdtcmd.u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
id|gdtcmd.u.cache64.BlockNo
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|gdtcmd.u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
id|gdtcmd.u.cache.BlockNo
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;nNo host drive found !&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|orig_length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
op_ge
l_int|7
op_logical_and
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;wbp_off&quot;
comma
l_int|7
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|8
suffix:semicolon
id|length
op_sub_assign
l_int|8
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: Disabling write back permanently .. &quot;
)paren
suffix:semicolon
id|wb_mode
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|length
op_ge
l_int|6
op_logical_and
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;wbp_on&quot;
comma
l_int|6
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|7
suffix:semicolon
id|length
op_sub_assign
l_int|7
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: Enabling write back permanently .. &quot;
)paren
suffix:semicolon
id|wb_mode
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|length
op_ge
l_int|6
op_logical_and
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;wb_off&quot;
comma
l_int|6
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|7
suffix:semicolon
id|length
op_sub_assign
l_int|7
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: Disabling write back commands .. &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_WR_THROUGH
)paren
(brace
id|gdth_write_through
op_assign
id|TRUE
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Not supported !&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|orig_length
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|length
op_ge
l_int|5
op_logical_and
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;wb_on&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
(brace
id|buffer
op_add_assign
l_int|6
suffix:semicolon
id|length
op_sub_assign
l_int|6
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: Enabling write back commands .. &quot;
)paren
suffix:semicolon
id|gdth_write_through
op_assign
id|FALSE
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|orig_length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wb_mode
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
r_sizeof
(paren
id|gdth_cpar_str
)paren
comma
id|TRUE
comma
op_amp
id|paddr
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|pcpar
op_assign
(paren
id|gdth_cpar_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|memcpy
c_func
(paren
id|pcpar
comma
op_amp
id|ha-&gt;cpar
comma
r_sizeof
(paren
id|gdth_cpar_str
)paren
)paren
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd.u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd.u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_cpar_str
)paren
suffix:semicolon
id|gdtcmd.u.ioctl.subfunc
op_assign
id|CACHE_CONFIG
suffix:semicolon
id|gdtcmd.u.ioctl.channel
op_assign
id|INVALID_CHANNEL
suffix:semicolon
id|pcpar-&gt;write_back
op_assign
id|wb_mode
op_eq
l_int|1
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#endif
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|ha-&gt;pscratch
comma
id|paddr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|orig_length
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;GDT: Unknown command: %s  Length: %d&bslash;n&quot;
comma
id|buffer
comma
id|length
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|gdth_get_info
r_static
r_int
id|gdth_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_struct
id|Scsi_Host
op_star
id|host
comma
r_int
id|hanum
comma
r_int
id|busnum
)paren
(brace
r_int
id|size
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
comma
id|pos
op_assign
l_int|0
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|id
comma
id|i
comma
id|j
comma
id|k
comma
id|sec
comma
id|flag
suffix:semicolon
r_int
id|no_mdrv
op_assign
l_int|0
comma
id|drv_no
comma
id|is_mirr
suffix:semicolon
id|ulong32
id|cnt
suffix:semicolon
id|ulong64
id|paddr
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|gdth_cmd_str
op_star
id|gdtcmd
suffix:semicolon
id|gdth_evt_str
op_star
id|estr
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
id|Scsi_Device
id|sdev
suffix:semicolon
macro_line|#endif
r_char
id|hrec
(braket
l_int|161
)braket
suffix:semicolon
r_struct
id|timeval
id|tv
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
id|gdth_dskstat_str
op_star
id|pds
suffix:semicolon
id|gdth_diskinfo_str
op_star
id|pdi
suffix:semicolon
id|gdth_arrayinf_str
op_star
id|pai
suffix:semicolon
id|gdth_defcnt_str
op_star
id|pdef
suffix:semicolon
id|gdth_cdrinfo_str
op_star
id|pcdi
suffix:semicolon
id|gdth_hget_str
op_star
id|phg
suffix:semicolon
r_char
id|cmnd
(braket
id|MAX_COMMAND_SIZE
)braket
suffix:semicolon
id|gdtcmd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|gdtcmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|estr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|estr
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdtcmd
op_logical_or
op_logical_neg
id|estr
)paren
r_goto
id|free_fail
suffix:semicolon
id|memset
c_func
(paren
id|cmnd
comma
l_int|0xff
comma
l_int|12
)paren
suffix:semicolon
id|memset
c_func
(paren
id|gdtcmd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_get_info() ha %d bus %d&bslash;n&quot;
comma
id|hanum
comma
id|busnum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|host
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_request
c_func
(paren
id|sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_goto
id|free_fail
suffix:semicolon
id|scp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|host
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_goto
id|free_fail
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|sdev.host
op_assign
id|scp.host
op_assign
id|host
suffix:semicolon
id|sdev.id
op_assign
id|scp.target
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|sdev
suffix:semicolon
macro_line|#endif
multiline_comment|/* request is i.e. &quot;cat /proc/scsi/gdth/0&quot; */
multiline_comment|/* format: %-15s&bslash;t%-10s&bslash;t%-15s&bslash;t%s */
multiline_comment|/* driver parameters */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Driver Parameters:&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|reserve_list
(braket
l_int|0
)braket
op_eq
l_int|0xff
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;--&quot;
)paren
suffix:semicolon
r_else
(brace
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%d&quot;
comma
id|reserve_list
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_RES_ARGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|reserve_list
(braket
id|i
)braket
op_eq
l_int|0xff
)paren
r_break
suffix:semicolon
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%s,%d&quot;
comma
id|hrec
comma
id|reserve_list
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; reserve_mode: &bslash;t%d         &bslash;treserve_list:  &bslash;t%s&bslash;n&quot;
comma
id|reserve_mode
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; max_ids:      &bslash;t%-3d       &bslash;thdr_channel:   &bslash;t%d&bslash;n&quot;
comma
id|max_ids
comma
id|hdr_channel
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
multiline_comment|/* controller information */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nDisk Array Controller Information:&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|virt_ctr
)paren
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%s (Bus %d)&quot;
comma
id|ha-&gt;binfo.type_string
comma
id|busnum
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|hrec
comma
id|ha-&gt;binfo.type_string
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Number:       &bslash;t%d         &bslash;tName:          &bslash;t%s&bslash;n&quot;
comma
id|hanum
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;more_proc
)paren
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%d.%02d.%02d-%c%03X&quot;
comma
(paren
id|unchar
)paren
(paren
id|ha-&gt;binfo.upd_fw_ver
op_rshift
l_int|24
)paren
comma
(paren
id|unchar
)paren
(paren
id|ha-&gt;binfo.upd_fw_ver
op_rshift
l_int|16
)paren
comma
(paren
id|unchar
)paren
(paren
id|ha-&gt;binfo.upd_fw_ver
)paren
comma
id|ha-&gt;bfeat.raid
ques
c_cond
l_char|&squot;R&squot;
suffix:colon
l_char|&squot;N&squot;
comma
id|ha-&gt;binfo.upd_revision
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%d.%02d&quot;
comma
(paren
id|unchar
)paren
(paren
id|ha-&gt;cpar.version
op_rshift
l_int|8
)paren
comma
(paren
id|unchar
)paren
(paren
id|ha-&gt;cpar.version
)paren
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Driver Ver.:  &bslash;t%-10s&bslash;tFirmware Ver.: &bslash;t%s&bslash;n&quot;
comma
id|GDTH_VERSION_STR
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;more_proc
)paren
(brace
multiline_comment|/* more information: 1. about controller */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Serial No.:   &bslash;t0x%8X&bslash;tCache RAM size:&bslash;t%d KB&bslash;n&quot;
comma
id|ha-&gt;binfo.ser_no
comma
id|ha-&gt;binfo.memsize
op_div
l_int|1024
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
macro_line|#ifdef GDTH_DMA_STATISTICS
multiline_comment|/* controller statistics */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nController Statistics:&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; 32-bit DMA buffer:&bslash;t%lu&bslash;t64-bit DMA buffer:&bslash;t%lu&bslash;n&quot;
comma
id|ha-&gt;dma32_cnt
comma
id|ha-&gt;dma64_cnt
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;more_proc
)paren
(brace
multiline_comment|/* more information: 2. about physical devices */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nPhysical Devices:&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|FALSE
suffix:semicolon
id|buf
op_assign
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|FALSE
comma
op_amp
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_goto
id|stop_output
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* 2.a statistics (and retries/reassigns) */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;pdr_statistics() chn %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|pds
op_assign
(paren
id|gdth_dskstat_str
op_star
)paren
(paren
id|buf
op_plus
id|GDTH_SCRATCH
op_div
l_int|4
)paren
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
op_plus
id|GDTH_SCRATCH
op_div
l_int|4
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
l_int|3
op_star
id|GDTH_SCRATCH
op_div
l_int|4
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|DSK_STATISTICS
op_or
id|L_CTRL_PATTERN
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|address
op_or
id|INVALID_CHANNEL
suffix:semicolon
id|pds-&gt;bid
op_assign
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|local_no
suffix:semicolon
id|pds-&gt;first
op_assign
l_int|0
suffix:semicolon
id|pds-&gt;entries
op_assign
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|pdev_cnt
suffix:semicolon
id|cnt
op_assign
(paren
l_int|3
op_star
id|GDTH_SCRATCH
op_div
l_int|4
op_minus
l_int|5
op_star
r_sizeof
(paren
id|ulong32
)paren
)paren
op_div
r_sizeof
(paren
id|pds-&gt;list
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pds-&gt;entries
OG
id|cnt
)paren
id|pds-&gt;entries
op_assign
id|cnt
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_ne
id|S_OK
)paren
macro_line|#endif
(brace
id|pds-&gt;count
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* other IOCTLs must fit into area GDTH_SCRATCH/4 */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|pdev_cnt
suffix:semicolon
op_increment
id|j
)paren
(brace
multiline_comment|/* 2.b drive info */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;scsi_drv_info() chn %d dev %d&bslash;n&quot;
comma
id|i
comma
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|id_list
(braket
id|j
)braket
)paren
)paren
suffix:semicolon
id|pdi
op_assign
(paren
id|gdth_diskinfo_str
op_star
)paren
id|buf
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_diskinfo_str
)paren
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|SCSI_DR_INFO
op_or
id|L_CTRL_PATTERN
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|address
op_or
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|id_list
(braket
id|j
)braket
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_eq
id|S_OK
)paren
macro_line|#endif
(brace
id|strncpy
c_func
(paren
id|hrec
comma
id|pdi-&gt;vendor
comma
l_int|8
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|hrec
op_plus
l_int|8
comma
id|pdi-&gt;product
comma
l_int|16
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|hrec
op_plus
l_int|24
comma
id|pdi-&gt;revision
comma
l_int|4
)paren
suffix:semicolon
id|hrec
(braket
l_int|28
)braket
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n Chn/ID/LUN:   &bslash;t%c/%02d/%d    &bslash;tName:          &bslash;t%s&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|i
comma
id|pdi-&gt;target_id
comma
id|pdi-&gt;lun
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|TRUE
suffix:semicolon
id|pdi-&gt;no_ldrive
op_and_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|pdi-&gt;no_ldrive
op_eq
l_int|0xffff
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;--&quot;
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%d&quot;
comma
id|pdi-&gt;no_ldrive
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Capacity [MB]:&bslash;t%-6d    &bslash;tTo Log. Drive: &bslash;t%s&bslash;n&quot;
comma
id|pdi-&gt;blkcnt
op_div
(paren
l_int|1024
op_star
l_int|1024
op_div
id|pdi-&gt;blksize
)paren
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
r_else
(brace
id|pdi-&gt;devtype
op_assign
l_int|0xff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pdi-&gt;devtype
op_eq
l_int|0
)paren
(brace
multiline_comment|/* search retries/reassigns */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|pds-&gt;count
suffix:semicolon
op_increment
id|k
)paren
(brace
r_if
c_cond
(paren
id|pds-&gt;list
(braket
id|k
)braket
dot
id|tid
op_eq
id|pdi-&gt;target_id
op_logical_and
id|pds-&gt;list
(braket
id|k
)braket
dot
id|lun
op_eq
id|pdi-&gt;lun
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Retries:      &bslash;t%-6d    &bslash;tReassigns:     &bslash;t%d&bslash;n&quot;
comma
id|pds-&gt;list
(braket
id|k
)braket
dot
id|retries
comma
id|pds-&gt;list
(braket
id|k
)braket
dot
id|reassigns
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* 2.c grown defects */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;scsi_drv_defcnt() chn %d dev %d&bslash;n&quot;
comma
id|i
comma
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|id_list
(braket
id|j
)braket
)paren
)paren
suffix:semicolon
id|pdef
op_assign
(paren
id|gdth_defcnt_str
op_star
)paren
id|buf
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_defcnt_str
)paren
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|SCSI_DEF_CNT
op_or
id|L_CTRL_PATTERN
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|address
op_or
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|id_list
(braket
id|j
)braket
suffix:semicolon
id|pdef-&gt;sddc_type
op_assign
l_int|0x08
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_eq
id|S_OK
)paren
macro_line|#endif
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Grown Defects:&bslash;t%d&bslash;n&quot;
comma
id|pdef-&gt;sddc_cnt
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
)brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flag
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n --&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
multiline_comment|/* 3. about logical drives */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nLogical Drives:&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|FALSE
suffix:semicolon
id|buf
op_assign
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|FALSE
comma
op_amp
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_goto
id|stop_output
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_logdrv
)paren
r_continue
suffix:semicolon
id|drv_no
op_assign
id|i
suffix:semicolon
id|j
op_assign
id|k
op_assign
l_int|0
suffix:semicolon
id|is_mirr
op_assign
id|FALSE
suffix:semicolon
r_do
(brace
multiline_comment|/* 3.a log. drive info */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache_drv_info() drive no %d&bslash;n&quot;
comma
id|drv_no
)paren
)paren
suffix:semicolon
id|pcdi
op_assign
(paren
id|gdth_cdrinfo_str
op_star
)paren
id|buf
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_cdrinfo_str
)paren
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|CACHE_DRV_INFO
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|drv_no
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_ne
id|S_OK
)paren
macro_line|#endif
(brace
r_break
suffix:semicolon
)brace
id|pcdi-&gt;ld_dtype
op_rshift_assign
l_int|16
suffix:semicolon
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pcdi-&gt;ld_dtype
OG
l_int|2
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;missing&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcdi-&gt;ld_error
op_amp
l_int|1
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;fault&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcdi-&gt;ld_error
op_amp
l_int|2
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;invalid&quot;
)paren
suffix:semicolon
id|k
op_increment
suffix:semicolon
id|j
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;ok&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|drv_no
op_eq
id|i
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n Number:       &bslash;t%-2d        &bslash;tStatus:        &bslash;t%s&bslash;n&quot;
comma
id|drv_no
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|TRUE
suffix:semicolon
id|no_mdrv
op_assign
id|pcdi-&gt;cd_ldcnt
suffix:semicolon
r_if
c_cond
(paren
id|no_mdrv
OG
l_int|1
op_logical_or
id|pcdi-&gt;ld_slave
op_ne
op_minus
l_int|1
)paren
(brace
id|is_mirr
op_assign
id|TRUE
suffix:semicolon
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-1&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcdi-&gt;ld_dtype
op_eq
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;Disk&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcdi-&gt;ld_dtype
op_eq
l_int|1
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-0&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcdi-&gt;ld_dtype
op_eq
l_int|2
)paren
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;Chain&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;???&quot;
)paren
suffix:semicolon
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Capacity [MB]:&bslash;t%-6d    &bslash;tType:          &bslash;t%s&bslash;n&quot;
comma
id|pcdi-&gt;ld_blkcnt
op_div
(paren
l_int|1024
op_star
l_int|1024
op_div
id|pcdi-&gt;ld_blksize
)paren
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
r_else
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Slave Number: &bslash;t%-2d        &bslash;tStatus:        &bslash;t%s&bslash;n&quot;
comma
id|drv_no
op_amp
l_int|0x7fff
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
id|drv_no
op_assign
id|pcdi-&gt;ld_slave
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
r_while
c_loop
(paren
id|drv_no
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_mirr
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Missing Drv.: &bslash;t%-2d        &bslash;tInvalid Drv.:  &bslash;t%d&bslash;n&quot;
comma
id|no_mdrv
op_minus
id|j
op_minus
id|k
comma
id|k
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_arraydrv
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;--&quot;
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|hrec
comma
l_string|&quot;%d&quot;
comma
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|master_no
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; To Array Drv.:&bslash;t%s&bslash;n&quot;
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flag
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n --&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
multiline_comment|/* 4. about array drives */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nArray Drives:&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|FALSE
suffix:semicolon
id|buf
op_assign
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|FALSE
comma
op_amp
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_goto
id|stop_output
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_arraydrv
op_logical_and
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_master
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* 4.a array drive info */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;array_info() drive no %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|pai
op_assign
(paren
id|gdth_arrayinf_str
op_star
)paren
id|buf
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_arrayinf_str
)paren
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|ARRAY_INFO
op_or
id|LA_CTRL_PATTERN
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_eq
id|S_OK
)paren
macro_line|#endif
(brace
r_if
c_cond
(paren
id|pai-&gt;ai_state
op_eq
l_int|0
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;idle&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_state
op_eq
l_int|2
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;build&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_state
op_eq
l_int|4
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;ready&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_state
op_eq
l_int|6
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;fail&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_state
op_eq
l_int|8
op_logical_or
id|pai-&gt;ai_state
op_eq
l_int|10
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;rebuild&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pai-&gt;ai_ext_state
op_amp
l_int|0x10
)paren
id|strcat
c_func
(paren
id|hrec
comma
l_string|&quot;/expand&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_ext_state
op_amp
l_int|0x1
)paren
id|strcat
c_func
(paren
id|hrec
comma
l_string|&quot;/patch&quot;
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n Number:       &bslash;t%-2d        &bslash;tStatus:        &bslash;t%s&bslash;n&quot;
comma
id|i
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|pai-&gt;ai_type
op_eq
l_int|0
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-0&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_type
op_eq
l_int|4
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-4&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pai-&gt;ai_type
op_eq
l_int|5
)paren
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-5&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|hrec
comma
l_string|&quot;RAID-10&quot;
)paren
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Capacity [MB]:&bslash;t%-6d    &bslash;tType:          &bslash;t%s&bslash;n&quot;
comma
id|pai-&gt;ai_size
op_div
(paren
l_int|1024
op_star
l_int|1024
op_div
id|pai-&gt;ai_secsize
)paren
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
)brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|GDTH_SCRATCH
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flag
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n --&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
multiline_comment|/* 5. about host drives */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nHost Drives:&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|FALSE
suffix:semicolon
id|buf
op_assign
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
r_sizeof
(paren
id|gdth_hget_str
)paren
comma
id|FALSE
comma
op_amp
id|paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_goto
id|stop_output
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_logdrv
op_logical_or
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_arraydrv
op_logical_and
op_logical_neg
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|is_master
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* 5.a get host drive list */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;host_get() drv_no %d&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|phg
op_assign
(paren
id|gdth_hget_str
op_star
)paren
id|buf
suffix:semicolon
id|gdtcmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd-&gt;OpCode
op_assign
id|GDT_IOCTL
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.param_size
op_assign
r_sizeof
(paren
id|gdth_hget_str
)paren
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.subfunc
op_assign
id|HOST_GET
op_or
id|LA_CTRL_PATTERN
suffix:semicolon
id|gdtcmd-&gt;u.ioctl.channel
op_assign
id|i
suffix:semicolon
id|phg-&gt;entries
op_assign
id|MAX_HDRIVES
suffix:semicolon
id|phg-&gt;offset
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_hget_str
comma
id|entry
(braket
l_int|0
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;sr_command-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_ne
id|S_OK
)paren
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_ne
id|S_OK
)paren
macro_line|#endif
(brace
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|ldr_no
op_assign
id|i
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|rw_attribs
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|start_sec
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|phg-&gt;entries
suffix:semicolon
op_increment
id|j
)paren
(brace
id|k
op_assign
id|phg-&gt;entry
(braket
id|j
)braket
dot
id|host_drive
suffix:semicolon
r_if
c_cond
(paren
id|k
op_ge
id|MAX_LDRIVES
)paren
r_continue
suffix:semicolon
id|ha-&gt;hdr
(braket
id|k
)braket
dot
id|ldr_no
op_assign
id|phg-&gt;entry
(braket
id|j
)braket
dot
id|log_drive
suffix:semicolon
id|ha-&gt;hdr
(braket
id|k
)braket
dot
id|rw_attribs
op_assign
id|phg-&gt;entry
(braket
id|j
)braket
dot
id|rw_attribs
suffix:semicolon
id|ha-&gt;hdr
(braket
id|k
)braket
dot
id|start_sec
op_assign
id|phg-&gt;entry
(braket
id|j
)braket
dot
id|start_sec
suffix:semicolon
)brace
)brace
)brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
r_sizeof
(paren
id|gdth_hget_str
)paren
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
)paren
)paren
r_continue
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n Number:       &bslash;t%-2d        &bslash;tArr/Log. Drive:&bslash;t%d&bslash;n&quot;
comma
id|i
comma
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|ldr_no
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
id|flag
op_assign
id|TRUE
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; Capacity [MB]:&bslash;t%-6d    &bslash;tStart Sector:  &bslash;t%d&bslash;n&quot;
comma
(paren
id|ulong32
)paren
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|size
op_div
l_int|2048
)paren
comma
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|start_sec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|flag
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n --&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
)brace
)brace
multiline_comment|/* controller events */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nController Events:&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)paren
(brace
id|id
op_assign
id|gdth_read_event
c_func
(paren
id|ha
comma
id|id
comma
id|estr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|estr-&gt;event_source
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|estr-&gt;event_data.eu.driver.ionode
op_eq
id|hanum
op_logical_and
id|estr-&gt;event_source
op_eq
id|ES_ASYNC
)paren
(brace
id|gdth_log_event
c_func
(paren
op_amp
id|estr-&gt;event_data
comma
id|hrec
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|sec
op_assign
(paren
r_int
)paren
(paren
id|tv.tv_sec
op_minus
id|estr-&gt;first_stamp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sec
OL
l_int|0
)paren
id|sec
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; date- %02d:%02d:%02d&bslash;t%s&bslash;n&quot;
comma
id|sec
op_div
l_int|3600
comma
id|sec
op_mod
l_int|3600
op_div
l_int|60
comma
id|sec
op_mod
l_int|60
comma
id|hrec
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_goto
id|stop_output
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
op_minus
l_int|1
)paren
r_break
suffix:semicolon
)brace
id|stop_output
suffix:colon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_release_request
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#endif
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;get_info() len %d pos %d begin %d offset %d length %d size %d&bslash;n&quot;
comma
id|len
comma
(paren
r_int
)paren
id|pos
comma
(paren
r_int
)paren
id|begin
comma
(paren
r_int
)paren
id|offset
comma
id|length
comma
id|size
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|len
suffix:semicolon
id|free_fail
suffix:colon
id|kfree
c_func
(paren
id|gdtcmd
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|estr
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|function|gdth_do_req
r_static
r_void
id|gdth_do_req
c_func
(paren
id|Scsi_Request
op_star
id|scp
comma
id|gdth_cmd_str
op_star
id|gdtcmd
comma
r_char
op_star
id|cmnd
comma
r_int
id|timeout
)paren
(brace
r_int
id|bufflen
suffix:semicolon
id|DECLARE_COMPLETION
c_func
(paren
id|wait
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_do_req()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdtcmd
op_ne
l_int|NULL
)paren
(brace
id|bufflen
op_assign
r_sizeof
(paren
id|gdth_cmd_str
)paren
suffix:semicolon
)brace
r_else
(brace
id|bufflen
op_assign
l_int|0
suffix:semicolon
)brace
id|scp-&gt;sr_request-&gt;rq_status
op_assign
id|RQ_SCSI_BUSY
suffix:semicolon
id|scp-&gt;sr_request-&gt;waiting
op_assign
op_amp
id|wait
suffix:semicolon
id|scsi_do_req
c_func
(paren
id|scp
comma
id|cmnd
comma
id|gdtcmd
comma
id|bufflen
comma
id|gdth_scsi_done
comma
id|timeout
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|wait
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|gdth_do_cmd
r_static
r_void
id|gdth_do_cmd
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
id|gdth_cmd_str
op_star
id|gdtcmd
comma
r_char
op_star
id|cmnd
comma
r_int
id|timeout
)paren
(brace
r_int
id|bufflen
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,7)
id|DECLARE_COMPLETION
c_func
(paren
id|wait
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|DECLARE_MUTEX_LOCKED
c_func
(paren
id|sem
)paren
suffix:semicolon
macro_line|#else
r_struct
id|semaphore
id|sem
op_assign
id|MUTEX_LOCKED
suffix:semicolon
macro_line|#endif
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_do_cmd()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdtcmd
op_ne
l_int|NULL
)paren
(brace
id|scp-&gt;SCp.this_residual
op_assign
id|IOCTL_PRI
suffix:semicolon
id|bufflen
op_assign
r_sizeof
(paren
id|gdth_cmd_str
)paren
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;SCp.this_residual
op_assign
id|DEFAULT_PRI
suffix:semicolon
id|bufflen
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,7)
id|scp-&gt;request.rq_status
op_assign
id|RQ_SCSI_BUSY
suffix:semicolon
id|scp-&gt;request.waiting
op_assign
op_amp
id|wait
suffix:semicolon
id|scsi_do_cmd
c_func
(paren
id|scp
comma
id|cmnd
comma
id|gdtcmd
comma
id|bufflen
comma
id|gdth_scsi_done
comma
id|timeout
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|wait
)paren
suffix:semicolon
macro_line|#else
id|scp-&gt;request.sem
op_assign
op_amp
id|sem
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_do_cmd
c_func
(paren
id|scp
comma
id|cmnd
comma
id|gdtcmd
comma
id|bufflen
comma
id|gdth_scsi_done
comma
id|timeout
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
macro_line|#else
id|spin_lock_irq
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
id|scsi_do_cmd
c_func
(paren
id|scp
comma
id|cmnd
comma
id|gdtcmd
comma
id|bufflen
comma
id|gdth_scsi_done
comma
id|timeout
op_star
id|HZ
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|io_request_lock
)paren
suffix:semicolon
macro_line|#endif
id|down
c_func
(paren
op_amp
id|sem
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
DECL|function|gdth_scsi_done
r_void
id|gdth_scsi_done
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_scsi_done()&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scp-&gt;request-&gt;rq_status
op_assign
id|RQ_SCSI_DONE
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;request-&gt;waiting
op_ne
l_int|NULL
)paren
id|complete
c_func
(paren
id|scp-&gt;request-&gt;waiting
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,7)
id|scp-&gt;request.rq_status
op_assign
id|RQ_SCSI_DONE
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;request.waiting
op_ne
l_int|NULL
)paren
id|complete
c_func
(paren
id|scp-&gt;request.waiting
)paren
suffix:semicolon
macro_line|#else
id|scp-&gt;request.rq_status
op_assign
id|RQ_SCSI_DONE
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;request.sem
op_ne
l_int|NULL
)paren
id|up
c_func
(paren
id|scp-&gt;request.sem
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|gdth_ioctl_alloc
r_static
r_char
op_star
id|gdth_ioctl_alloc
c_func
(paren
r_int
id|hanum
comma
r_int
id|size
comma
r_int
id|scratch
comma
id|ulong64
op_star
id|paddr
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_char
op_star
id|ret_val
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;scratch_busy
op_logical_and
id|size
op_le
id|GDTH_SCRATCH
)paren
(brace
id|ha-&gt;scratch_busy
op_assign
id|TRUE
suffix:semicolon
id|ret_val
op_assign
id|ha-&gt;pscratch
suffix:semicolon
op_star
id|paddr
op_assign
id|ha-&gt;scratch_phys
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scratch
)paren
(brace
id|ret_val
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|dma_addr_t
id|dma_addr
suffix:semicolon
id|ret_val
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|size
comma
op_amp
id|dma_addr
)paren
suffix:semicolon
op_star
id|paddr
op_assign
id|dma_addr
suffix:semicolon
macro_line|#else
id|ret_val
op_assign
id|scsi_init_malloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret_val
)paren
op_star
id|paddr
op_assign
id|virt_to_bus
c_func
(paren
id|ret_val
)paren
suffix:semicolon
macro_line|#endif
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
DECL|function|gdth_ioctl_free
r_static
r_void
id|gdth_ioctl_free
c_func
(paren
r_int
id|hanum
comma
r_int
id|size
comma
r_char
op_star
id|buf
comma
id|ulong64
id|paddr
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_eq
id|ha-&gt;pscratch
)paren
(brace
id|ha-&gt;scratch_busy
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|size
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
macro_line|#else
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|buf
comma
id|size
)paren
suffix:semicolon
macro_line|#endif
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef GDTH_IOCTL_PROC
DECL|function|gdth_ioctl_check_bin
r_static
r_int
id|gdth_ioctl_check_bin
c_func
(paren
r_int
id|hanum
comma
id|ushort
id|size
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|ret_val
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ret_val
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;scratch_busy
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|gdth_iord_str
op_star
)paren
id|ha-&gt;pscratch
)paren
op_member_access_from_pointer
id|size
op_eq
(paren
id|ulong32
)paren
id|size
)paren
id|ret_val
op_assign
id|TRUE
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
macro_line|#endif
DECL|function|gdth_wait_completion
r_static
r_void
id|gdth_wait_completion
c_func
(paren
r_int
id|hanum
comma
r_int
id|busnum
comma
r_int
id|id
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|scp
op_assign
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|SPECIAL_SCP
c_func
(paren
id|scp
)paren
op_logical_and
id|t
op_eq
(paren
id|unchar
)paren
id|id
op_logical_and
id|b
op_eq
(paren
id|unchar
)paren
id|busnum
)paren
(brace
id|scp-&gt;SCp.have_data_in
op_assign
l_int|0
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|scp-&gt;SCp.have_data_in
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|GDTH_LOCK_SCSI_DONE
c_func
(paren
id|scp-&gt;device-&gt;host
comma
id|flags
)paren
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
id|GDTH_UNLOCK_SCSI_DONE
c_func
(paren
id|scp-&gt;device-&gt;host
comma
id|flags
)paren
suffix:semicolon
macro_line|#else
id|GDTH_LOCK_SCSI_DONE
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
id|GDTH_UNLOCK_SCSI_DONE
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_stop_timeout
r_static
r_void
id|gdth_stop_timeout
c_func
(paren
r_int
id|hanum
comma
r_int
id|busnum
comma
r_int
id|id
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|scp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|scp
suffix:semicolon
id|scp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|scp-&gt;SCp.ptr
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|t
op_eq
(paren
id|unchar
)paren
id|id
op_logical_and
id|b
op_eq
(paren
id|unchar
)paren
id|busnum
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_stop_timeout(): update_timeout()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|scp-&gt;SCp.buffers_residual
op_assign
id|gdth_update_timeout
c_func
(paren
id|hanum
comma
id|scp
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_start_timeout
r_static
r_void
id|gdth_start_timeout
c_func
(paren
r_int
id|hanum
comma
r_int
id|busnum
comma
r_int
id|id
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|scp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|scp
suffix:semicolon
id|scp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|scp-&gt;SCp.ptr
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|t
op_eq
(paren
id|unchar
)paren
id|id
op_logical_and
id|b
op_eq
(paren
id|unchar
)paren
id|busnum
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_start_timeout(): update_timeout()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_update_timeout
c_func
(paren
id|hanum
comma
id|scp
comma
id|scp-&gt;SCp.buffers_residual
)paren
suffix:semicolon
)brace
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_update_timeout
r_static
r_int
id|gdth_update_timeout
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
r_int
id|timeout
)paren
(brace
r_int
id|oldto
suffix:semicolon
id|oldto
op_assign
id|scp-&gt;timeout_per_command
suffix:semicolon
id|scp-&gt;timeout_per_command
op_assign
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|scp-&gt;eh_timeout
)paren
suffix:semicolon
id|scp-&gt;eh_timeout.data
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|scp-&gt;eh_timeout.expires
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|scp-&gt;eh_timeout.data
op_ne
(paren
r_int
r_int
)paren
l_int|NULL
)paren
id|del_timer
c_func
(paren
op_amp
id|scp-&gt;eh_timeout
)paren
suffix:semicolon
id|scp-&gt;eh_timeout.data
op_assign
(paren
r_int
r_int
)paren
id|scp
suffix:semicolon
id|scp-&gt;eh_timeout.expires
op_assign
id|jiffies
op_plus
id|timeout
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|scp-&gt;eh_timeout
)paren
suffix:semicolon
)brace
r_return
id|oldto
suffix:semicolon
)brace
eof
