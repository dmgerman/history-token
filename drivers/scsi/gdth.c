multiline_comment|/************************************************************************&n; * Linux driver for                                                     *  &n; * ICP vortex GmbH:    GDT ISA/EISA/PCI Disk Array Controllers          *&n; * Intel Corporation:  Storage RAID Controllers                         *&n; *                                                                      *&n; * gdth.c                                                               *&n; * Copyright (C) 1995-04 ICP vortex GmbH, Achim Leubner                 *&n; * Copyright (C) 2002-04 Intel Corporation                              *&n; * Copyright (C) 2003-04 Adaptec Inc.                                   *&n; * &lt;achim_leubner@adaptec.com&gt;                                          *&n; *                                                                      *&n; * Additions/Fixes:                                                     *&n; * Boji Tony Kannanthanam &lt;boji.t.kannanthanam@intel.com&gt;               *&n; * Johannes Dinner &lt;johannes_dinner@adaptec.com&gt;                        *&n; *                                                                      *&n; * This program is free software; you can redistribute it and/or modify *&n; * it under the terms of the GNU General Public License as published    *&n; * by the Free Software Foundation; either version 2 of the License,    *&n; * or (at your option) any later version.                               *&n; *                                                                      *&n; * This program is distributed in the hope that it will be useful,      *&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of       *&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the         *&n; * GNU General Public License for more details.                         *&n; *                                                                      *&n; * You should have received a copy of the GNU General Public License    *&n; * along with this kernel; if not, write to the Free Software           *&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.            *&n; *                                                                      *&n; * Linux kernel 2.2.x, 2.4.x, 2.6.x supported                           *&n; *                                                                      *&n; * $Log: gdth.c,v $&n; * Revision 1.73  2004/03/31 13:33:03  achim&n; * Special command 0xfd implemented to detect 64-bit DMA support&n; *&n; * Revision 1.72  2004/03/17 08:56:04  achim&n; * 64-bit DMA only enabled if FW &gt;= x.43&n; *&n; * Revision 1.71  2004/03/05 15:51:29  achim&n; * Screen service: separate message buffer, bugfixes&n; *&n; * Revision 1.70  2004/02/27 12:19:07  achim&n; * Bugfix: Reset bit in config (0xfe) call removed&n; *&n; * Revision 1.69  2004/02/20 09:50:24  achim&n; * Compatibility changes for kernels &lt; 2.4.20&n; * Bugfix screen service command size&n; * pci_set_dma_mask() error handling added&n; *&n; * Revision 1.68  2004/02/19 15:46:54  achim&n; * 64-bit DMA bugfixes&n; * Drive size bugfix for drives &gt; 1TB&n; *&n; * Revision 1.67  2004/01/14 13:11:57  achim&n; * Tool access over /proc no longer supported&n; * Bugfixes IOCTLs&n; *&n; * Revision 1.66  2003/12/19 15:04:06  achim&n; * Bugfixes support for drives &gt; 2TB&n; *&n; * Revision 1.65  2003/12/15 11:21:56  achim&n; * 64-bit DMA support added&n; * Support for drives &gt; 2 TB implemented&n; * Kernels 2.2.x, 2.4.x, 2.6.x supported&n; *&n; * Revision 1.64  2003/09/17 08:30:26  achim&n; * EISA/ISA controller scan disabled&n; * Command line switch probe_eisa_isa added&n; *&n; * Revision 1.63  2003/07/12 14:01:00  Daniele Bellucci &lt;bellucda@tiscali.it&gt;&n; * Minor cleanups in gdth_ioctl.&n; *&n; * Revision 1.62  2003/02/27 15:01:59  achim&n; * Dynamic DMA mapping implemented&n; * New (character device) IOCTL interface added&n; * Other controller related changes made&n; *&n; * Revision 1.61  2002/11/08 13:09:52  boji&n; * Added support for XSCALE based RAID Controllers&n; * Fixed SCREENSERVICE initialization in SMP cases&n; * Added checks for gdth_polling before GDTH_HA_LOCK&n; *&n; * Revision 1.60  2002/02/05 09:35:22  achim&n; * MODULE_LICENSE only if kernel &gt;= 2.4.11&n; *&n; * Revision 1.59  2002/01/30 09:46:33  achim&n; * Small changes&n; *&n; * Revision 1.58  2002/01/29 15:30:02  achim&n; * Set default value of shared_access to Y&n; * New status S_CACHE_RESERV for clustering added&n; *&n; * Revision 1.57  2001/08/21 11:16:35  achim&n; * Bugfix free_irq()&n; *&n; * Revision 1.56  2001/08/09 11:19:39  achim&n; * Scsi_Host_Template changes&n; *&n; * Revision 1.55  2001/08/09 10:11:28  achim&n; * Command HOST_UNFREEZE_IO before cache service init.&n; *&n; * Revision 1.54  2001/07/20 13:48:12  achim&n; * Expand: gdth_analyse_hdrive() removed&n; *&n; * Revision 1.53  2001/07/17 09:52:49  achim&n; * Small OEM related change&n; *&n; * Revision 1.52  2001/06/19 15:06:20  achim&n; * New host command GDT_UNFREEZE_IO added&n; *&n; * Revision 1.51  2001/05/22 06:42:37  achim&n; * PCI: Subdevice ID added&n; *&n; * Revision 1.50  2001/05/17 13:42:16  achim&n; * Support for Intel Storage RAID Controllers added&n; *&n; * Revision 1.50  2001/05/17 12:12:34  achim&n; * Support for Intel Storage RAID Controllers added&n; *&n; * Revision 1.49  2001/03/15 15:07:17  achim&n; * New __setup interface for boot command line options added&n; *&n; * Revision 1.48  2001/02/06 12:36:28  achim&n; * Bugfix Cluster protocol&n; *&n; * Revision 1.47  2001/01/10 14:42:06  achim&n; * New switch shared_access added&n; *&n; * Revision 1.46  2001/01/09 08:11:35  achim&n; * gdth_command() removed&n; * meaning of Scsi_Pointer members changed&n; *&n; * Revision 1.45  2000/11/16 12:02:24  achim&n; * Changes for kernel 2.4&n; *&n; * Revision 1.44  2000/10/11 08:44:10  achim&n; * Clustering changes: New flag media_changed added&n; *&n; * Revision 1.43  2000/09/20 12:59:01  achim&n; * DPMEM remap functions for all PCI controller types implemented&n; * Small changes for ia64 platform&n; *&n; * Revision 1.42  2000/07/20 09:04:50  achim&n; * Small changes for kernel 2.4&n; *&n; * Revision 1.41  2000/07/04 14:11:11  achim&n; * gdth_analyse_hdrive() added to rescan drives after online expansion&n; *&n; * Revision 1.40  2000/06/27 11:24:16  achim&n; * Changes Clustering, Screenservice&n; *&n; * Revision 1.39  2000/06/15 13:09:04  achim&n; * Changes for gdth_do_cmd()&n; *&n; * Revision 1.38  2000/06/15 12:08:43  achim&n; * Bugfix gdth_sync_event(), service SCREENSERVICE&n; * Data direction for command 0xc2 changed to DOU&n; *&n; * Revision 1.37  2000/05/25 13:50:10  achim&n; * New driver parameter virt_ctr added&n; *&n; * Revision 1.36  2000/05/04 08:50:46  achim&n; * Event buffer now in gdth_ha_str&n; *&n; * Revision 1.35  2000/03/03 10:44:08  achim&n; * New event_string only valid for the RP controller family&n; *&n; * Revision 1.34  2000/03/02 14:55:29  achim&n; * New mechanism for async. event handling implemented&n; *&n; * Revision 1.33  2000/02/21 15:37:37  achim&n; * Bugfix Alpha platform + DPMEM above 4GB&n; *&n; * Revision 1.32  2000/02/14 16:17:37  achim&n; * Bugfix sense_buffer[] + raw devices&n; *&n; * Revision 1.31  2000/02/10 10:29:00  achim&n; * Delete sense_buffer[0], if command OK&n; *&n; * Revision 1.30  1999/11/02 13:42:39  achim&n; * ARRAY_DRV_LIST2 implemented&n; * Now 255 log. and 100 host drives supported&n; *&n; * Revision 1.29  1999/10/05 13:28:47  achim&n; * GDT_CLUST_RESET added&n; *&n; * Revision 1.28  1999/08/12 13:44:54  achim&n; * MOUNTALL removed&n; * Cluster drives -&gt; removeable drives&n; *&n; * Revision 1.27  1999/06/22 07:22:38  achim&n; * Small changes&n; *&n; * Revision 1.26  1999/06/10 16:09:12  achim&n; * Cluster Host Drive support: Bugfixes&n; *&n; * Revision 1.25  1999/06/01 16:03:56  achim&n; * gdth_init_pci(): Manipulate config. space to start RP controller&n; *&n; * Revision 1.24  1999/05/26 11:53:06  achim&n; * Cluster Host Drive support added&n; *&n; * Revision 1.23  1999/03/26 09:12:31  achim&n; * Default value for hdr_channel set to 0&n; *&n; * Revision 1.22  1999/03/22 16:27:16  achim&n; * Bugfix: gdth_store_event() must not be locked with GDTH_LOCK_HA()&n; *&n; * Revision 1.21  1999/03/16 13:40:34  achim&n; * Problems with reserved drives solved&n; * gdth_eh_bus_reset() implemented&n; *&n; * Revision 1.20  1999/03/10 09:08:13  achim&n; * Bugfix: Corrections in gdth_direction_tab[] made&n; * Bugfix: Increase command timeout (gdth_update_timeout()) NOT in gdth_putq()&n; *&n; * Revision 1.19  1999/03/05 14:38:16  achim&n; * Bugfix: Heads/Sectors mapping for reserved devices possibly wrong&n; * -&gt; gdth_eval_mapping() implemented, changes in gdth_bios_param()&n; * INIT_RETRIES set to 100s to avoid DEINIT-Timeout for controllers&n; * with BIOS disabled and memory test set to Intensive&n; * Enhanced /proc support&n; *&n; * Revision 1.18  1999/02/24 09:54:33  achim&n; * Command line parameter hdr_channel implemented&n; * Bugfix for EISA controllers + Linux 2.2.x&n; *&n; * Revision 1.17  1998/12/17 15:58:11  achim&n; * Command line parameters implemented&n; * Changes for Alpha platforms&n; * PCI controller scan changed&n; * SMP support improved (spin_lock_irqsave(),...)&n; * New async. events, new scan/reserve commands included&n; *&n; * Revision 1.16  1998/09/28 16:08:46  achim&n; * GDT_PCIMPR: DPMEM remapping, if required&n; * mdelay() added&n; *&n; * Revision 1.15  1998/06/03 14:54:06  achim&n; * gdth_delay(), gdth_flush() implemented&n; * Bugfix: gdth_release() changed&n; *&n; * Revision 1.14  1998/05/22 10:01:17  achim&n; * mj: pcibios_strerror() removed&n; * Improved SMP support (if version &gt;= 2.1.95)&n; * gdth_halt(): halt_called flag added (if version &lt; 2.1)&n; *&n; * Revision 1.13  1998/04/16 09:14:57  achim&n; * Reserve drives (for raw service) implemented&n; * New error handling code enabled&n; * Get controller name from board_info() IOCTL&n; * Final round of PCI device driver patches by Martin Mares&n; *&n; * Revision 1.12  1998/03/03 09:32:37  achim&n; * Fibre channel controller support added&n; *&n; * Revision 1.11  1998/01/27 16:19:14  achim&n; * SA_SHIRQ added&n; * add_timer()/del_timer() instead of GDTH_TIMER&n; * scsi_add_timer()/scsi_del_timer() instead of SCSI_TIMER&n; * New error handling included&n; *&n; * Revision 1.10  1997/10/31 12:29:57  achim&n; * Read heads/sectors from host drive&n; *&n; * Revision 1.9  1997/09/04 10:07:25  achim&n; * IO-mapping with virt_to_bus(), gdth_readb(), gdth_writeb(), ...&n; * register_reboot_notifier() to get a notify on shutown used&n; *&n; * Revision 1.8  1997/04/02 12:14:30  achim&n; * Version 1.00 (see gdth.h), tested with kernel 2.0.29&n; *&n; * Revision 1.7  1997/03/12 13:33:37  achim&n; * gdth_reset() changed, new async. events&n; *&n; * Revision 1.6  1997/03/04 14:01:11  achim&n; * Shutdown routine gdth_halt() implemented&n; *&n; * Revision 1.5  1997/02/21 09:08:36  achim&n; * New controller included (RP, RP1, RP2 series)&n; * IOCTL interface implemented&n; *&n; * Revision 1.4  1996/07/05 12:48:55  achim&n; * Function gdth_bios_param() implemented&n; * New constant GDTH_MAXC_P_L inserted&n; * GDT_WRITE_THR, GDT_EXT_INFO implemented&n; * Function gdth_reset() changed&n; *&n; * Revision 1.3  1996/05/10 09:04:41  achim&n; * Small changes for Linux 1.2.13&n; *&n; * Revision 1.2  1996/05/09 12:45:27  achim&n; * Loadable module support implemented&n; * /proc support corrections made&n; *&n; * Revision 1.1  1996/04/11 07:35:57  achim&n; * Initial revision&n; *&n; ************************************************************************/
multiline_comment|/* All GDT Disk Array Controllers are fully supported by this driver.&n; * This includes the PCI/EISA/ISA SCSI Disk Array Controllers and the&n; * PCI Fibre Channel Disk Array Controllers. See gdth.h for a complete&n; * list of all controller types.&n; * &n; * If you have one or more GDT3000/3020 EISA controllers with &n; * controller BIOS disabled, you have to set the IRQ values with the &n; * command line option &quot;gdth=irq1,irq2,...&quot;, where the irq1,irq2,... are&n; * the IRQ values for the EISA controllers.&n; * &n; * After the optional list of IRQ values, other possible &n; * command line options are:&n; * disable:Y                    disable driver&n; * disable:N                    enable driver&n; * reserve_mode:0               reserve no drives for the raw service&n; * reserve_mode:1               reserve all not init., removable drives&n; * reserve_mode:2               reserve all not init. drives&n; * reserve_list:h,b,t,l,h,b,t,l,...     reserve particular drive(s) with &n; *                              h- controller no., b- channel no., &n; *                              t- target ID, l- LUN&n; * reverse_scan:Y               reverse scan order for PCI controllers         &n; * reverse_scan:N               scan PCI controllers like BIOS&n; * max_ids:x                    x - target ID count per channel (1..MAXID)&n; * rescan:Y                     rescan all channels/IDs &n; * rescan:N                     use all devices found until now&n; * virt_ctr:Y                   map every channel to a virtual controller &n; * virt_ctr:N                   use multi channel support &n; * hdr_channel:x                x - number of virtual bus for host drives&n; * shared_access:Y              disable driver reserve/release protocol to &n; *                              access a shared resource from several nodes, &n; *                              appropiate controller firmware required&n; * shared_access:N              enable driver reserve/release protocol&n; * probe_eisa_isa:Y             scan for EISA/ISA controllers&n; * probe_eisa_isa:N             do not scan for EISA/ISA controllers&n; * force_dma32:Y                use only 32 bit DMA mode&n; * force_dma32:N                use 64 bit DMA mode, if supported&n; *&n; * The default values are: &quot;gdth=disable:N,reserve_mode:1,reverse_scan:N,&n; *                          max_ids:127,rescan:N,virt_ctr:N,hdr_channel:0,&n; *                          shared_access:Y,probe_eisa_isa:N,force_dma32:N&quot;.&n; * Here is another example: &quot;gdth=reserve_list:0,1,2,0,0,1,3,0,rescan:Y&quot;.&n; * &n; * When loading the gdth driver as a module, the same options are available. &n; * You can set the IRQs with &quot;IRQ=...&quot;. However, the syntax to specify the&n; * options changes slightly. You must replace all &squot;,&squot; between options &n; * with &squot; &squot; and all &squot;:&squot; with &squot;=&squot; and you must use &n; * &squot;1&squot; in place of &squot;Y&squot; and &squot;0&squot; in place of &squot;N&squot;.&n; * &n; * Default: &quot;modprobe gdth disable=0 reserve_mode=1 reverse_scan=0&n; *           max_ids=127 rescan=0 virt_ctr=0 hdr_channel=0 shared_access=0 &n; *           probe_eisa_isa=0 force_dma32=0&quot;&n; * The other example: &quot;modprobe gdth reserve_list=0,1,2,0,0,1,3,0 rescan=1&quot;.&n; */
multiline_comment|/* The meaning of the Scsi_Pointer members in this driver is as follows:&n; * ptr:                     Chaining&n; * this_residual:           Command priority&n; * buffer:                  phys. DMA sense buffer &n; * dma_handle:              phys. DMA buffer (kernel &gt;= 2.4.0)&n; * buffers_residual:        Timeout value&n; * Status:                  Command status (gdth_do_cmd()), DMA mem. mappings&n; * Message:                 Additional info (gdth_do_cmd()), DMA direction&n; * have_data_in:            Flag for gdth_wait_completion()&n; * sent_command:            Opcode special command&n; * phase:                   Service/parameter/return code special command&n; */
multiline_comment|/* interrupt coalescing */
multiline_comment|/* #define INT_COAL */
multiline_comment|/* statistics */
DECL|macro|GDTH_STATISTICS
mdefine_line|#define GDTH_STATISTICS
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#ifdef GDTH_RTC
macro_line|#include &lt;linux/mc146818rtc.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#else
macro_line|#include &lt;asm/spinlock.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#else
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;sd.h&quot;
macro_line|#endif
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &quot;gdth.h&quot;
r_static
r_void
id|gdth_delay
c_func
(paren
r_int
id|milliseconds
)paren
suffix:semicolon
r_static
r_void
id|gdth_eval_mapping
c_func
(paren
id|ulong32
id|size
comma
id|ulong32
op_star
id|cyls
comma
r_int
op_star
id|heads
comma
r_int
op_star
id|secs
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_static
id|irqreturn_t
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
macro_line|#else
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|gdth_sync_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
comma
id|unchar
id|index
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
suffix:semicolon
r_static
r_int
id|gdth_async_event
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_void
id|gdth_log_event
c_func
(paren
id|gdth_evt_data
op_star
id|dvr
comma
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_static
r_void
id|gdth_putq
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|priority
)paren
suffix:semicolon
r_static
r_void
id|gdth_next
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_fill_raw_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
suffix:semicolon
r_static
r_int
id|gdth_special_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
suffix:semicolon
r_static
id|gdth_evt_str
op_star
id|gdth_store_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
id|ushort
id|source
comma
id|ushort
id|idx
comma
id|gdth_evt_data
op_star
id|evt
)paren
suffix:semicolon
r_static
r_int
id|gdth_read_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
r_int
id|handle
comma
id|gdth_evt_str
op_star
id|estr
)paren
suffix:semicolon
r_static
r_void
id|gdth_readapp_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
id|unchar
id|application
comma
id|gdth_evt_str
op_star
id|estr
)paren
suffix:semicolon
r_static
r_void
id|gdth_clear_events
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|gdth_copy_internal_data
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
r_char
op_star
id|buffer
comma
id|ushort
id|count
)paren
suffix:semicolon
r_static
r_int
id|gdth_internal_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
suffix:semicolon
r_static
r_int
id|gdth_fill_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|ushort
id|hdrive
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_eisa
c_func
(paren
id|ushort
id|eisa_adr
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_isa
c_func
(paren
id|ulong32
id|bios_adr
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
)paren
suffix:semicolon
r_static
r_void
id|gdth_search_dev
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|ushort
op_star
id|cnt
comma
id|ushort
id|vendor
comma
id|ushort
id|dev
)paren
suffix:semicolon
r_static
r_void
id|gdth_sort_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
r_int
id|cnt
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_eisa
c_func
(paren
id|ushort
id|eisa_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_isa
c_func
(paren
id|ulong32
id|bios_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_int
id|gdth_init_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|gdth_ha_str
op_star
id|ha
)paren
suffix:semicolon
r_static
r_void
id|gdth_enable_int
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_get_status
c_func
(paren
id|unchar
op_star
id|pIStatus
comma
r_int
id|irq
)paren
suffix:semicolon
r_static
r_int
id|gdth_test_busy
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_get_cmd_index
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_void
id|gdth_release_event
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_wait
c_func
(paren
r_int
id|hanum
comma
r_int
id|index
comma
id|ulong32
id|time
)paren
suffix:semicolon
r_static
r_int
id|gdth_internal_cmd
c_func
(paren
r_int
id|hanum
comma
id|unchar
id|service
comma
id|ushort
id|opcode
comma
id|ulong32
id|p1
comma
id|ulong64
id|p2
comma
id|ulong64
id|p3
)paren
suffix:semicolon
r_static
r_int
id|gdth_search_drives
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_analyse_hdrive
c_func
(paren
r_int
id|hanum
comma
id|ushort
id|hdrive
)paren
suffix:semicolon
r_static
r_const
r_char
op_star
id|gdth_ctr_name
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
)paren
suffix:semicolon
r_static
r_int
id|gdth_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
)paren
suffix:semicolon
r_static
r_int
id|gdth_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|gdth_flush
c_func
(paren
r_int
id|hanum
)paren
suffix:semicolon
r_static
r_int
id|gdth_halt
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
id|ulong
id|event
comma
r_void
op_star
id|buf
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_GDTH
DECL|variable|DebugState
r_static
id|unchar
id|DebugState
op_assign
id|DEBUG_GDTH
suffix:semicolon
macro_line|#ifdef __SERIAL__
DECL|macro|MAX_SERBUF
mdefine_line|#define MAX_SERBUF 160
r_static
r_void
id|ser_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ser_puts
c_func
(paren
r_char
op_star
id|str
)paren
suffix:semicolon
r_static
r_void
id|ser_putc
c_func
(paren
r_char
id|c
)paren
suffix:semicolon
r_static
r_int
id|ser_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
suffix:semicolon
DECL|variable|strbuf
r_static
r_char
id|strbuf
(braket
id|MAX_SERBUF
op_plus
l_int|1
)braket
suffix:semicolon
macro_line|#ifdef __COM2__
DECL|macro|COM_BASE
mdefine_line|#define COM_BASE 0x2f8
macro_line|#else
DECL|macro|COM_BASE
mdefine_line|#define COM_BASE 0x3f8
macro_line|#endif
DECL|function|ser_init
r_static
r_void
id|ser_init
c_func
(paren
)paren
(brace
r_int
id|port
op_assign
id|COM_BASE
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
comma
id|port
op_plus
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 19200 Baud, if 9600: outb(12,port) */
id|outb
c_func
(paren
l_int|6
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|3
comma
id|port
op_plus
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;    ser_putc(&squot;I&squot;);&n;    ser_putc(&squot; &squot;);&n;    */
)brace
DECL|function|ser_puts
r_static
r_void
id|ser_puts
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|ptr
suffix:semicolon
id|ser_init
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|str
suffix:semicolon
op_star
id|ptr
suffix:semicolon
op_increment
id|ptr
)paren
id|ser_putc
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|ser_putc
r_static
r_void
id|ser_putc
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|port
op_assign
id|COM_BASE
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|port
op_plus
l_int|5
)paren
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
id|c
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|0x0a
)paren
(brace
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|port
op_plus
l_int|5
)paren
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0d
comma
id|port
)paren
suffix:semicolon
)brace
)brace
DECL|function|ser_printk
r_static
r_int
id|ser_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
c_func
(paren
id|strbuf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|ser_puts
c_func
(paren
id|strbuf
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|macro|TRACE
mdefine_line|#define TRACE(a)    {if (DebugState==1) {ser_printk a;}}
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)   {if (DebugState==1 || DebugState==2) {ser_printk a;}}
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)   {if (DebugState!=0) {ser_printk a;}}
macro_line|#else /* !__SERIAL__ */
DECL|macro|TRACE
mdefine_line|#define TRACE(a)    {if (DebugState==1) {printk a;}}
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)   {if (DebugState==1 || DebugState==2) {printk a;}}
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)   {if (DebugState!=0) {printk a;}}
macro_line|#endif
macro_line|#else /* !DEBUG */
DECL|macro|TRACE
mdefine_line|#define TRACE(a)
DECL|macro|TRACE2
mdefine_line|#define TRACE2(a)
DECL|macro|TRACE3
mdefine_line|#define TRACE3(a)
macro_line|#endif
macro_line|#ifdef GDTH_STATISTICS
DECL|variable|max_rq
DECL|variable|max_index
DECL|variable|max_sg
r_static
id|ulong32
id|max_rq
op_assign
l_int|0
comma
id|max_index
op_assign
l_int|0
comma
id|max_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef INT_COAL
DECL|variable|max_int_coal
r_static
id|ulong32
id|max_int_coal
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|act_ints
DECL|variable|act_ios
DECL|variable|act_stats
DECL|variable|act_rq
r_static
id|ulong32
id|act_ints
op_assign
l_int|0
comma
id|act_ios
op_assign
l_int|0
comma
id|act_stats
op_assign
l_int|0
comma
id|act_rq
op_assign
l_int|0
suffix:semicolon
DECL|variable|gdth_timer
r_static
r_struct
id|timer_list
id|gdth_timer
suffix:semicolon
macro_line|#endif
DECL|macro|PTR2USHORT
mdefine_line|#define PTR2USHORT(a)   (ushort)(ulong)(a)
DECL|macro|GDTOFFSOF
mdefine_line|#define GDTOFFSOF(a,b)  (size_t)&amp;(((a*)0)-&gt;b)   
DECL|macro|INDEX_OK
mdefine_line|#define INDEX_OK(i,t)   ((i)&lt;sizeof(t)/sizeof((t)[0]))
DECL|macro|NUMDATA
mdefine_line|#define NUMDATA(a)      ( (gdth_num_str  *)((a)-&gt;hostdata))
DECL|macro|HADATA
mdefine_line|#define HADATA(a)       (&amp;((gdth_ext_str *)((a)-&gt;hostdata))-&gt;haext)
DECL|macro|CMDDATA
mdefine_line|#define CMDDATA(a)      (&amp;((gdth_ext_str *)((a)-&gt;hostdata))-&gt;cmdext)
DECL|macro|BUS_L2P
mdefine_line|#define BUS_L2P(a,b)    ((b)&gt;(a)-&gt;virt_bus ? (b-1):(b))
DECL|macro|gdth_readb
mdefine_line|#define gdth_readb(addr)        readb(addr)
DECL|macro|gdth_readw
mdefine_line|#define gdth_readw(addr)        readw(addr)
DECL|macro|gdth_readl
mdefine_line|#define gdth_readl(addr)        readl(addr)
DECL|macro|gdth_writeb
mdefine_line|#define gdth_writeb(b,addr)     writeb((b),(addr))
DECL|macro|gdth_writew
mdefine_line|#define gdth_writew(b,addr)     writew((b),(addr))
DECL|macro|gdth_writel
mdefine_line|#define gdth_writel(b,addr)     writel((b),(addr))
DECL|variable|gdth_drq_tab
r_static
id|unchar
id|gdth_drq_tab
(braket
l_int|4
)braket
op_assign
(brace
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|7
)brace
suffix:semicolon
multiline_comment|/* DRQ table */
DECL|variable|gdth_irq_tab
r_static
id|unchar
id|gdth_irq_tab
(braket
l_int|6
)braket
op_assign
(brace
l_int|0
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|14
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* IRQ table */
DECL|variable|gdth_polling
r_static
id|unchar
id|gdth_polling
suffix:semicolon
multiline_comment|/* polling if TRUE */
DECL|variable|gdth_from_wait
r_static
id|unchar
id|gdth_from_wait
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* gdth_wait() */
DECL|variable|wait_index
DECL|variable|wait_hanum
r_static
r_int
id|wait_index
comma
id|wait_hanum
suffix:semicolon
multiline_comment|/* gdth_wait() */
DECL|variable|gdth_ctr_count
r_static
r_int
id|gdth_ctr_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* controller count */
DECL|variable|gdth_ctr_vcount
r_static
r_int
id|gdth_ctr_vcount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* virt. ctr. count */
DECL|variable|gdth_ctr_released
r_static
r_int
id|gdth_ctr_released
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* gdth_release() */
DECL|variable|gdth_ctr_tab
r_static
r_struct
id|Scsi_Host
op_star
id|gdth_ctr_tab
(braket
id|MAXHA
)braket
suffix:semicolon
multiline_comment|/* controller table */
DECL|variable|gdth_ctr_vtab
r_static
r_struct
id|Scsi_Host
op_star
id|gdth_ctr_vtab
(braket
id|MAXHA
op_star
id|MAXBUS
)braket
suffix:semicolon
multiline_comment|/* virt. ctr. table */
DECL|variable|gdth_write_through
r_static
id|unchar
id|gdth_write_through
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* write through */
DECL|variable|ebuffer
r_static
id|gdth_evt_str
id|ebuffer
(braket
id|MAX_EVENTS
)braket
suffix:semicolon
multiline_comment|/* event buffer */
DECL|variable|elastidx
r_static
r_int
id|elastidx
suffix:semicolon
DECL|variable|eoldidx
r_static
r_int
id|eoldidx
suffix:semicolon
DECL|variable|major
r_static
r_int
id|major
suffix:semicolon
DECL|macro|DIN
mdefine_line|#define DIN     1                               /* IN data direction */
DECL|macro|DOU
mdefine_line|#define DOU     2                               /* OUT data direction */
DECL|macro|DNO
mdefine_line|#define DNO     DIN                             /* no data transfer */
DECL|macro|DUN
mdefine_line|#define DUN     DIN                             /* unknown data direction */
DECL|variable|gdth_direction_tab
r_static
id|unchar
id|gdth_direction_tab
(braket
l_int|0x100
)braket
op_assign
(brace
id|DNO
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DUN
comma
id|DOU
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DOU
comma
id|DNO
comma
id|DNO
comma
id|DOU
comma
id|DNO
comma
id|DIN
comma
id|DNO
comma
id|DIN
comma
id|DOU
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DOU
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DIN
comma
id|DOU
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DNO
comma
id|DIN
comma
id|DNO
comma
id|DNO
comma
id|DIN
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DIN
comma
id|DIN
comma
id|DIN
comma
id|DNO
comma
id|DUN
comma
id|DNO
comma
id|DNO
comma
id|DNO
comma
id|DUN
comma
id|DNO
comma
id|DOU
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DNO
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DNO
comma
id|DOU
comma
id|DUN
comma
id|DNO
comma
id|DUN
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DOU
comma
id|DNO
comma
id|DUN
comma
id|DIN
comma
id|DOU
comma
id|DIN
comma
id|DIN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DOU
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
comma
id|DUN
)brace
suffix:semicolon
multiline_comment|/* __initfunc, __initdata macros */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
DECL|macro|GDTH_INITFUNC
mdefine_line|#define GDTH_INITFUNC(type, func)       type __init func 
macro_line|#include &lt;linux/init.h&gt;
macro_line|#else
DECL|macro|GDTH_INITFUNC
mdefine_line|#define GDTH_INITFUNC(type, func)       __initfunc(type func)
macro_line|#include &lt;linux/init.h&gt;
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|macro|GDTH_INIT_LOCK_HA
mdefine_line|#define GDTH_INIT_LOCK_HA(ha)           spin_lock_init(&amp;(ha)-&gt;smp_lock)
DECL|macro|GDTH_LOCK_HA
mdefine_line|#define GDTH_LOCK_HA(ha,flags)          spin_lock_irqsave(&amp;(ha)-&gt;smp_lock,flags)
DECL|macro|GDTH_UNLOCK_HA
mdefine_line|#define GDTH_UNLOCK_HA(ha,flags)        spin_unlock_irqrestore(&amp;(ha)-&gt;smp_lock,flags)
DECL|macro|GDTH_LOCK_SCSI_DONE
mdefine_line|#define GDTH_LOCK_SCSI_DONE(dev, flags) spin_lock_irqsave(dev-&gt;host_lock,flags)
DECL|macro|GDTH_UNLOCK_SCSI_DONE
mdefine_line|#define GDTH_UNLOCK_SCSI_DONE(dev, flags) spin_unlock_irqrestore(dev-&gt;host_lock,flags)
macro_line|#else
DECL|macro|GDTH_INIT_LOCK_HA
mdefine_line|#define GDTH_INIT_LOCK_HA(ha)           spin_lock_init(&amp;(ha)-&gt;smp_lock)
DECL|macro|GDTH_LOCK_HA
mdefine_line|#define GDTH_LOCK_HA(ha,flags)          spin_lock_irqsave(&amp;(ha)-&gt;smp_lock,flags)
DECL|macro|GDTH_UNLOCK_HA
mdefine_line|#define GDTH_UNLOCK_HA(ha,flags)        spin_unlock_irqrestore(&amp;(ha)-&gt;smp_lock,flags)
DECL|macro|GDTH_LOCK_SCSI_DONE
mdefine_line|#define GDTH_LOCK_SCSI_DONE(flags)      spin_lock_irqsave(&amp;io_request_lock,flags)
DECL|macro|GDTH_UNLOCK_SCSI_DONE
mdefine_line|#define GDTH_UNLOCK_SCSI_DONE(flags)    spin_unlock_irqrestore(&amp;io_request_lock,flags)
macro_line|#endif
multiline_comment|/* LILO and modprobe/insmod parameters */
multiline_comment|/* IRQ list for GDT3000/3020 EISA controllers */
DECL|variable|__initdata
r_static
r_int
id|irq
(braket
id|MAXHA
)braket
id|__initdata
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/* disable driver flag */
DECL|variable|__initdata
r_static
r_int
id|disable
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reserve flag */
DECL|variable|reserve_mode
r_static
r_int
id|reserve_mode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* reserve list */
DECL|variable|reserve_list
r_static
r_int
id|reserve_list
(braket
id|MAX_RES_ARGS
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/* scan order for PCI controllers */
DECL|variable|reverse_scan
r_static
r_int
id|reverse_scan
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* virtual channel for the host drives */
DECL|variable|hdr_channel
r_static
r_int
id|hdr_channel
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* max. IDs per channel */
DECL|variable|max_ids
r_static
r_int
id|max_ids
op_assign
id|MAXID
suffix:semicolon
multiline_comment|/* rescan all IDs */
DECL|variable|rescan
r_static
r_int
id|rescan
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* map channels to virtual controllers */
DECL|variable|virt_ctr
r_static
r_int
id|virt_ctr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* shared access */
DECL|variable|shared_access
r_static
r_int
id|shared_access
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* enable support for EISA and ISA controllers */
DECL|variable|probe_eisa_isa
r_static
r_int
id|probe_eisa_isa
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 64 bit DMA mode, support for drives &gt; 2 TB, if force_dma32 = 0 */
DECL|variable|force_dma32
r_static
r_int
id|force_dma32
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/* parameters for modprobe/insmod */
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|disable
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|reserve_mode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|reserve_list
comma
l_string|&quot;4-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_RES_ARGS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|reverse_scan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hdr_channel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_ids
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rescan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|virt_ctr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|shared_access
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|probe_eisa_isa
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|force_dma32
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Achim Leubner&quot;
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,11)
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
multiline_comment|/* ioctl interface */
DECL|variable|gdth_fops
r_static
r_struct
id|file_operations
id|gdth_fops
op_assign
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
dot
id|ioctl
op_assign
id|gdth_ioctl
comma
dot
id|open
op_assign
id|gdth_open
comma
dot
id|release
op_assign
id|gdth_close
comma
macro_line|#else
id|ioctl
suffix:colon
id|gdth_ioctl
comma
id|open
suffix:colon
id|gdth_open
comma
id|release
suffix:colon
id|gdth_close
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/* /proc support */
macro_line|#include &lt;linux/stat.h&gt; 
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,0)
DECL|variable|proc_scsi_gdth
r_struct
id|proc_dir_entry
id|proc_scsi_gdth
op_assign
(brace
id|PROC_SCSI_GDTH
comma
l_int|4
comma
l_string|&quot;gdth&quot;
comma
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
l_int|2
)brace
suffix:semicolon
macro_line|#endif
macro_line|#include &quot;gdth_proc.h&quot;
macro_line|#include &quot;gdth_proc.c&quot;
multiline_comment|/* notifier block to get a notify on system shutdown/halt/reboot */
DECL|variable|gdth_notifier
r_static
r_struct
id|notifier_block
id|gdth_notifier
op_assign
(brace
id|gdth_halt
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
DECL|function|gdth_delay
r_static
r_void
id|gdth_delay
c_func
(paren
r_int
id|milliseconds
)paren
(brace
r_if
c_cond
(paren
id|milliseconds
op_eq
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|mdelay
c_func
(paren
id|milliseconds
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_eval_mapping
r_static
r_void
id|gdth_eval_mapping
c_func
(paren
id|ulong32
id|size
comma
id|ulong32
op_star
id|cyls
comma
r_int
op_star
id|heads
comma
r_int
op_star
id|secs
)paren
(brace
op_star
id|cyls
op_assign
id|size
op_div
id|HEADS
op_div
id|SECS
suffix:semicolon
r_if
c_cond
(paren
op_star
id|cyls
op_le
id|MAXCYLS
)paren
(brace
op_star
id|heads
op_assign
id|HEADS
suffix:semicolon
op_star
id|secs
op_assign
id|SECS
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* too high for 64*32 */
op_star
id|cyls
op_assign
id|size
op_div
id|MEDHEADS
op_div
id|MEDSECS
suffix:semicolon
r_if
c_cond
(paren
op_star
id|cyls
op_le
id|MAXCYLS
)paren
(brace
op_star
id|heads
op_assign
id|MEDHEADS
suffix:semicolon
op_star
id|secs
op_assign
id|MEDSECS
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* too high for 127*63 */
op_star
id|cyls
op_assign
id|size
op_div
id|BIGHEADS
op_div
id|BIGSECS
suffix:semicolon
op_star
id|heads
op_assign
id|BIGHEADS
suffix:semicolon
op_star
id|secs
op_assign
id|BIGSECS
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* controller search and initialization functions */
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_search_eisa
c_func
(paren
id|ushort
id|eisa_adr
)paren
)paren
(brace
id|ulong32
id|id
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_eisa() adr. %x&bslash;n&quot;
comma
id|eisa_adr
)paren
)paren
suffix:semicolon
id|id
op_assign
id|inl
c_func
(paren
id|eisa_adr
op_plus
id|ID0REG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|GDT3A_ID
op_logical_or
id|id
op_eq
id|GDT3B_ID
)paren
(brace
multiline_comment|/* GDT3000A or GDT3000B */
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EISAREG
)paren
op_amp
l_int|8
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* not EISA configured */
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
id|GDT3_ID
)paren
multiline_comment|/* GDT3000 */
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_search_isa
c_func
(paren
id|ulong32
id|bios_adr
)paren
)paren
(brace
r_void
id|__iomem
op_star
id|addr
suffix:semicolon
id|ulong32
id|id
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_isa() bios adr. %x&bslash;n&quot;
comma
id|bios_adr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
op_assign
id|ioremap
c_func
(paren
id|bios_adr
op_plus
id|BIOS_ID_OFFS
comma
r_sizeof
(paren
id|ulong32
)paren
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|id
op_assign
id|gdth_readl
c_func
(paren
id|addr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|GDT2_ID
)paren
multiline_comment|/* GDT2000 */
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_search_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
)paren
)paren
(brace
id|ushort
id|device
comma
id|cnt
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_pci()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|device
op_assign
l_int|0
suffix:semicolon
id|device
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6555
suffix:semicolon
op_increment
id|device
)paren
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_VORTEX
comma
id|device
)paren
suffix:semicolon
r_for
c_loop
(paren
id|device
op_assign
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
suffix:semicolon
id|device
op_le
id|PCI_DEVICE_ID_VORTEX_GDTMAXRP
suffix:semicolon
op_increment
id|device
)paren
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_VORTEX
comma
id|device
)paren
suffix:semicolon
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_VORTEX
comma
id|PCI_DEVICE_ID_VORTEX_GDTNEWRX
)paren
suffix:semicolon
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_VORTEX
comma
id|PCI_DEVICE_ID_VORTEX_GDTNEWRX2
)paren
suffix:semicolon
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_SRC
)paren
suffix:semicolon
id|gdth_search_dev
c_func
(paren
id|pcistr
comma
op_amp
id|cnt
comma
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_SRC_XSCALE
)paren
suffix:semicolon
r_return
id|cnt
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
multiline_comment|/* Vortex only makes RAID controllers.&n; * We do not really want to specify all 550 ids here, so wildcard match.&n; */
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|gdthtable
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_VORTEX
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
)brace
comma
(brace
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_SRC
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
)brace
comma
(brace
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_SRC_XSCALE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|gdthtable
)paren
suffix:semicolon
macro_line|#endif
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_void
comma
id|gdth_search_dev
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|ushort
op_star
id|cnt
comma
id|ushort
id|vendor
comma
id|ushort
id|device
)paren
)paren
(brace
id|ulong
id|base0
comma
id|base1
comma
id|base2
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_dev() cnt %d vendor %x device %x&bslash;n&quot;
comma
op_star
id|cnt
comma
id|vendor
comma
id|device
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|vendor
comma
id|device
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_star
id|cnt
op_ge
id|MAXHA
)paren
r_return
suffix:semicolon
multiline_comment|/* GDT PCI controller found, resources are already in pdev */
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|pdev
op_assign
id|pdev
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|vendor_id
op_assign
id|vendor
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_id
op_assign
id|device
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|subdevice_id
op_assign
id|pdev-&gt;subsystem_device
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|bus
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_fn
op_assign
id|pdev-&gt;devfn
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|base0
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|base1
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|base2
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6000B
op_logical_or
multiline_comment|/* GDT6000/B */
id|device
op_ge
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
)paren
(brace
multiline_comment|/* MPR */
r_if
c_cond
(paren
op_logical_neg
(paren
id|base0
op_amp
id|IORESOURCE_MEM
)paren
)paren
r_continue
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GDT6110, GDT6120, .. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|base0
op_amp
id|IORESOURCE_MEM
)paren
op_logical_or
op_logical_neg
(paren
id|base2
op_amp
id|IORESOURCE_MEM
)paren
op_logical_or
op_logical_neg
(paren
id|base1
op_amp
id|IORESOURCE_IO
)paren
)paren
r_continue
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|io_mm
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|io
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Controller found at %d/%d, irq %d, dpmem 0x%lx&bslash;n&quot;
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|bus
comma
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_fn
)paren
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|irq
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
)paren
)paren
suffix:semicolon
(paren
op_star
id|cnt
)paren
op_increment
suffix:semicolon
)brace
macro_line|#else
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|vendor
comma
id|device
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_star
id|cnt
op_ge
id|MAXHA
)paren
r_return
suffix:semicolon
multiline_comment|/* GDT PCI controller found, resources are already in pdev */
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|pdev
op_assign
id|pdev
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|vendor_id
op_assign
id|vendor
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_id
op_assign
id|device
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|bus
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_fn
op_assign
id|pdev-&gt;devfn
suffix:semicolon
id|pcibios_read_config_word
c_func
(paren
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|bus
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_fn
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|subdevice_id
)paren
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|base0
op_assign
id|pdev-&gt;base_address
(braket
l_int|0
)braket
suffix:semicolon
id|base1
op_assign
id|pdev-&gt;base_address
(braket
l_int|1
)braket
suffix:semicolon
id|base2
op_assign
id|pdev-&gt;base_address
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|device
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6000B
op_logical_or
multiline_comment|/* GDT6000/B */
id|device
op_ge
id|PCI_DEVICE_ID_VORTEX_GDT6x17RP
)paren
(brace
multiline_comment|/* MPR */
r_if
c_cond
(paren
(paren
id|base0
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
)paren
r_continue
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
op_assign
id|base0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GDT6110, GDT6120, .. */
r_if
c_cond
(paren
(paren
id|base0
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
op_logical_or
(paren
id|base2
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_MEMORY
op_logical_or
(paren
id|base1
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_ne
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
r_continue
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
op_assign
id|base2
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|io_mm
op_assign
id|base0
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|io
op_assign
id|base1
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Controller found at %d/%d, irq %d, dpmem 0x%lx&bslash;n&quot;
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|bus
comma
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|device_fn
)paren
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|irq
comma
id|pcistr
(braket
op_star
id|cnt
)braket
dot
id|dpmem
)paren
)paren
suffix:semicolon
(paren
op_star
id|cnt
)paren
op_increment
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_void
comma
id|gdth_sort_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
r_int
id|cnt
)paren
)paren
(brace
id|gdth_pci_str
id|temp
suffix:semicolon
r_int
id|i
comma
id|changed
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_sort_pci() cnt %d&bslash;n&quot;
comma
id|cnt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_do
(brace
id|changed
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
op_minus
l_int|1
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|reverse_scan
)paren
(brace
r_if
c_cond
(paren
(paren
id|pcistr
(braket
id|i
)braket
dot
id|bus
OG
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|bus
)paren
op_logical_or
(paren
id|pcistr
(braket
id|i
)braket
dot
id|bus
op_eq
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|bus
op_logical_and
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
id|i
)braket
dot
id|device_fn
)paren
OG
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|device_fn
)paren
)paren
)paren
(brace
id|temp
op_assign
id|pcistr
(braket
id|i
)braket
suffix:semicolon
id|pcistr
(braket
id|i
)braket
op_assign
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|temp
suffix:semicolon
id|changed
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|pcistr
(braket
id|i
)braket
dot
id|bus
OL
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|bus
)paren
op_logical_or
(paren
id|pcistr
(braket
id|i
)braket
dot
id|bus
op_eq
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|bus
op_logical_and
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
id|i
)braket
dot
id|device_fn
)paren
OL
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|device_fn
)paren
)paren
)paren
(brace
id|temp
op_assign
id|pcistr
(braket
id|i
)braket
suffix:semicolon
id|pcistr
(braket
id|i
)braket
op_assign
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|pcistr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|temp
suffix:semicolon
id|changed
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
)brace
r_while
c_loop
(paren
id|changed
)paren
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_init_eisa
c_func
(paren
id|ushort
id|eisa_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
)paren
(brace
id|ulong32
id|retries
comma
id|id
suffix:semicolon
id|unchar
id|prot_ver
comma
id|eisacf
comma
id|i
comma
id|irq_found
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_eisa() adr. %x&bslash;n&quot;
comma
id|eisa_adr
)paren
)paren
suffix:semicolon
multiline_comment|/* disable board interrupts, deinitialize services */
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|eisa_adr
op_plus
id|EDENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|eisa_adr
op_plus
id|EINTENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|LDOORREG
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EDOORREG
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;wait for DEINIT: retries=%d&bslash;n&quot;
comma
id|retries
)paren
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;bmic
op_assign
id|eisa_adr
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
(paren
id|ulong32
)paren
id|eisa_adr
op_rshift
l_int|12
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|4
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* detect IRQ */
r_if
c_cond
(paren
(paren
id|id
op_assign
id|inl
c_func
(paren
id|eisa_adr
op_plus
id|ID0REG
)paren
)paren
op_eq
id|GDT3_ID
)paren
(brace
id|ha-&gt;oem_id
op_assign
id|OEM_ID_ICP
suffix:semicolon
id|ha-&gt;type
op_assign
id|GDT_EISA
suffix:semicolon
id|ha-&gt;stype
op_assign
id|id
suffix:semicolon
id|outl
c_func
(paren
l_int|1
comma
id|eisa_adr
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xfe
comma
id|eisa_adr
op_plus
id|LDOORREG
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EDOORREG
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (get IRQ failed)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|ha-&gt;irq
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|eisa_adr
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;GDT3000/3020: IRQ=%d&bslash;n&quot;
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
multiline_comment|/* check the result */
r_if
c_cond
(paren
id|ha-&gt;irq
op_eq
l_int|0
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Unknown IRQ, use IRQ table from cmd line !&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|irq_found
op_assign
id|FALSE
suffix:semicolon
id|i
OL
id|MAXHA
op_logical_and
id|irq
(braket
id|i
)braket
op_ne
l_int|0xff
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|irq
(braket
id|i
)braket
op_eq
l_int|10
op_logical_or
id|irq
(braket
id|i
)braket
op_eq
l_int|11
op_logical_or
id|irq
(braket
id|i
)braket
op_eq
l_int|12
op_logical_or
id|irq
(braket
id|i
)braket
op_eq
l_int|14
)paren
(brace
id|irq_found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|irq_found
)paren
(brace
id|ha-&gt;irq
op_assign
id|irq
(braket
id|i
)braket
suffix:semicolon
id|irq
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Can not detect controller IRQ,&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Use IRQ setting from command line (IRQ = %d)&bslash;n&quot;
comma
id|ha-&gt;irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Initialization error (unknown IRQ), Enable&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;the controller BIOS or use command line parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|eisacf
op_assign
id|inb
c_func
(paren
id|eisa_adr
op_plus
id|EISAREG
)paren
op_amp
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|eisacf
OG
l_int|4
)paren
multiline_comment|/* level triggered */
id|eisacf
op_sub_assign
l_int|4
suffix:semicolon
id|ha-&gt;irq
op_assign
id|gdth_irq_tab
(braket
id|eisacf
)braket
suffix:semicolon
id|ha-&gt;oem_id
op_assign
id|OEM_ID_ICP
suffix:semicolon
id|ha-&gt;type
op_assign
id|GDT_EISA
suffix:semicolon
id|ha-&gt;stype
op_assign
id|id
suffix:semicolon
)brace
id|ha-&gt;dma64_support
op_assign
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_init_isa
c_func
(paren
id|ulong32
id|bios_adr
comma
id|gdth_ha_str
op_star
id|ha
)paren
)paren
(brace
r_register
id|gdt2_dpram_str
id|__iomem
op_star
id|dp2_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|unchar
id|irq_drq
comma
id|prot_ver
suffix:semicolon
id|ulong32
id|retries
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_isa() bios adr. %x&bslash;n&quot;
comma
id|bios_adr
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|bios_adr
comma
r_sizeof
(paren
id|gdt2_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp2_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.memlock
)paren
suffix:semicolon
multiline_comment|/* switch off write protection */
multiline_comment|/* reset interface area */
id|memset_io
c_func
(paren
op_amp
id|dp2_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp2_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, read DRQ and IRQ */
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;io.irqen
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|irq_drq
op_assign
id|gdth_readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;io.rq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|irq_drq
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|irq_drq
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|ha-&gt;drq
op_assign
id|gdth_drq_tab
(braket
id|i
)braket
suffix:semicolon
id|irq_drq
op_assign
id|gdth_readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;io.rq
)paren
op_rshift
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|irq_drq
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|irq_drq
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|ha-&gt;irq
op_assign
id|gdth_irq_tab
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* deinitialize services */
id|gdth_writel
c_func
(paren
id|bios_adr
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|gdth_readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;oem_id
op_assign
id|OEM_ID_ICP
suffix:semicolon
id|ha-&gt;type
op_assign
id|GDT_ISA
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp2_ptr-&gt;u
)paren
suffix:semicolon
id|ha-&gt;stype
op_assign
id|GDT2_ID
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
id|bios_adr
op_rshift
l_int|4
suffix:semicolon
multiline_comment|/* special request to controller BIOS */
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x01
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp2_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|ha-&gt;dma64_support
op_assign
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_init_pci
c_func
(paren
id|gdth_pci_str
op_star
id|pcistr
comma
id|gdth_ha_str
op_star
id|ha
)paren
)paren
(brace
r_register
id|gdt6_dpram_str
id|__iomem
op_star
id|dp6_ptr
suffix:semicolon
r_register
id|gdt6c_dpram_str
id|__iomem
op_star
id|dp6c_ptr
suffix:semicolon
r_register
id|gdt6m_dpram_str
id|__iomem
op_star
id|dp6m_ptr
suffix:semicolon
id|ulong32
id|retries
suffix:semicolon
id|unchar
id|prot_ver
suffix:semicolon
id|ushort
id|command
suffix:semicolon
r_int
id|i
comma
id|found
op_assign
id|FALSE
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_init_pci()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcistr-&gt;vendor_id
op_eq
id|PCI_VENDOR_ID_INTEL
)paren
id|ha-&gt;oem_id
op_assign
id|OEM_ID_INTEL
suffix:semicolon
r_else
id|ha-&gt;oem_id
op_assign
id|OEM_ID_ICP
suffix:semicolon
id|ha-&gt;brd_phys
op_assign
(paren
id|pcistr-&gt;bus
op_lshift
l_int|8
)paren
op_or
(paren
id|pcistr-&gt;device_fn
op_amp
l_int|0xf8
)paren
suffix:semicolon
id|ha-&gt;stype
op_assign
(paren
id|ulong32
)paren
id|pcistr-&gt;device_id
suffix:semicolon
id|ha-&gt;subdevice_id
op_assign
id|pcistr-&gt;subdevice_id
suffix:semicolon
id|ha-&gt;irq
op_assign
id|pcistr-&gt;irq
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|ha-&gt;pdev
op_assign
id|pcistr-&gt;pdev
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;stype
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6000B
)paren
(brace
multiline_comment|/* GDT6000/B */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci() dpmem %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check and reset interface area */
id|dp6_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u
)paren
op_ne
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Cannot access DPMEM at 0x%lx (shadowed?)&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
)paren
suffix:semicolon
id|found
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0xC8000
suffix:semicolon
id|i
OL
l_int|0xE8000
suffix:semicolon
id|i
op_add_assign
l_int|0x4000
)paren
(brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|ushort
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gdth_readw
c_func
(paren
id|ha-&gt;brd
)paren
op_ne
l_int|0xffff
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_old() address 0x%x busy&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_BASE_ADDRESS_0
comma
id|i
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|gdt6_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u
)paren
op_eq
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Use free address at 0x%x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: No free address found!&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|memset_io
c_func
(paren
op_amp
id|dp6_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, deinit services */
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;io.irqen
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCI
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.event
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|ha-&gt;dma64_support
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;stype
op_le
id|PCI_DEVICE_ID_VORTEX_GDT6555
)paren
(brace
multiline_comment|/* GDT6110, ... */
id|ha-&gt;plx
op_assign
(paren
id|gdt6c_plx_regs
op_star
)paren
id|pcistr-&gt;io
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_new() dpmem %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6c_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check and reset interface area */
id|dp6c_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6c_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u
)paren
op_ne
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Cannot access DPMEM at 0x%lx (shadowed?)&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
)paren
suffix:semicolon
id|found
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0xC8000
suffix:semicolon
id|i
OL
l_int|0xE8000
suffix:semicolon
id|i
op_add_assign
l_int|0x4000
)paren
(brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|ushort
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gdth_readw
c_func
(paren
id|ha-&gt;brd
)paren
op_ne
l_int|0xffff
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_plx() address 0x%x busy&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_BASE_ADDRESS_2
comma
id|i
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|gdt6c_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6c_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6c_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u
)paren
op_eq
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Use free address at 0x%x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: No free address found!&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|memset_io
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6c_ptr-&gt;u
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM write error)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable board interrupts, deinit services */
id|outb
c_func
(paren
l_int|0x00
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;control1
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6c_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCINEW
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6c_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6c_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|ha-&gt;dma64_support
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* MPR */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_mpr() dpmem %lx irq %d&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
comma
id|ha-&gt;irq
)paren
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|pcistr-&gt;dpmem
comma
r_sizeof
(paren
id|gdt6m_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* manipulate config. space to enable DPMEM, start RP controller */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|pci_read_config_word
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
suffix:semicolon
id|command
op_or_assign
l_int|6
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_COMMAND
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_resource_start
c_func
(paren
id|pcistr-&gt;pdev
comma
l_int|8
)paren
op_eq
l_int|1UL
)paren
id|pci_resource_start
c_func
(paren
id|pcistr-&gt;pdev
comma
l_int|8
)paren
op_assign
l_int|0UL
suffix:semicolon
id|i
op_assign
l_int|0xFEFF0001UL
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_ROM_ADDRESS
comma
id|i
)paren
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_ROM_ADDRESS
comma
id|pci_resource_start
c_func
(paren
id|pcistr-&gt;pdev
comma
l_int|8
)paren
)paren
suffix:semicolon
macro_line|#else
id|pci_read_config_word
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
suffix:semicolon
id|command
op_or_assign
l_int|6
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_COMMAND
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcistr-&gt;pdev-&gt;rom_address
op_eq
l_int|1UL
)paren
id|pcistr-&gt;pdev-&gt;rom_address
op_assign
l_int|0UL
suffix:semicolon
id|i
op_assign
l_int|0xFEFF0001UL
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_ROM_ADDRESS
comma
id|i
)paren
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_ROM_ADDRESS
comma
id|pcistr-&gt;pdev-&gt;rom_address
)paren
suffix:semicolon
macro_line|#endif
id|dp6m_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
multiline_comment|/* Ensure that it is safe to access the non HW portions of DPMEM.&n;         * Aditional check needed for Xscale based RAID controllers */
r_while
c_loop
(paren
(paren
(paren
r_int
)paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.sema0_reg
)paren
)paren
op_amp
l_int|3
)paren
(brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* check and reset interface area */
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6m_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u
)paren
op_ne
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Cannot access DPMEM at 0x%lx (shadowed?)&bslash;n&quot;
comma
id|pcistr-&gt;dpmem
)paren
suffix:semicolon
id|found
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0xC8000
suffix:semicolon
id|i
OL
l_int|0xE8000
suffix:semicolon
id|i
op_add_assign
l_int|0x4000
)paren
(brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|ushort
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gdth_readw
c_func
(paren
id|ha-&gt;brd
)paren
op_ne
l_int|0xffff
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;init_pci_mpr() address 0x%x busy&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcistr-&gt;pdev
comma
id|PCI_BASE_ADDRESS_0
comma
id|i
)paren
suffix:semicolon
id|ha-&gt;brd
op_assign
id|ioremap
c_func
(paren
id|i
comma
r_sizeof
(paren
id|gdt6m_dpram_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;brd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DPMEM remap error)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dp6m_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writel
c_func
(paren
id|DPMEM_MAGIC
comma
op_amp
id|dp6m_ptr-&gt;u
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u
)paren
op_eq
id|DPMEM_MAGIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Use free address at 0x%x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: No free address found!&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|memset_io
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u
comma
l_int|0
comma
r_sizeof
(paren
id|dp6m_ptr-&gt;u
)paren
)paren
suffix:semicolon
multiline_comment|/* disable board interrupts, deinit services */
id|gdth_writeb
c_func
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
op_or
l_int|4
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
id|pcistr-&gt;dpmem
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6m_ptr-&gt;i960r.ldoor_reg
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
op_ne
id|PROTOCOL_VERSION
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Illegal protocol version&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;type
op_assign
id|GDT_PCIMPR
suffix:semicolon
id|ha-&gt;ic_all_size
op_assign
r_sizeof
(paren
id|dp6m_ptr-&gt;u
)paren
suffix:semicolon
multiline_comment|/* special command to controller BIOS */
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|gdth_writel
c_func
(paren
l_int|0x00
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xfe
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6m_ptr-&gt;i960r.ldoor_reg
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfe
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
multiline_comment|/* read FW version to detect 64-bit DMA support */
id|gdth_writeb
c_func
(paren
l_int|0xfd
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Cmd_Indx
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6m_ptr-&gt;i960r.ldoor_reg
)paren
suffix:semicolon
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_while
c_loop
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
op_ne
l_int|0xfd
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|retries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Initialization error (DEINIT failed)&bslash;n&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|ha-&gt;brd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|prot_ver
op_assign
(paren
id|unchar
)paren
(paren
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.S_Info
(braket
l_int|0
)braket
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;u.ic.S_Status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prot_ver
OL
l_int|0x2b
)paren
multiline_comment|/* FW &lt; x.43: no 64-bit DMA support */
id|ha-&gt;dma64_support
op_assign
l_int|0
suffix:semicolon
r_else
id|ha-&gt;dma64_support
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* controller protocol functions */
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_void
comma
id|gdth_enable_int
c_func
(paren
r_int
id|hanum
)paren
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|gdt2_dpram_str
id|__iomem
op_star
id|dp2_ptr
suffix:semicolon
id|gdt6_dpram_str
id|__iomem
op_star
id|dp6_ptr
suffix:semicolon
id|gdt6m_dpram_str
id|__iomem
op_star
id|dp6m_ptr
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_enable_int() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDENABREG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|ha-&gt;bmic
op_plus
id|EINTENABREG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp2_ptr-&gt;io.irqen
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
id|dp6_ptr-&gt;io.irqen
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x03
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;control1
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
id|gdth_readb
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
op_amp
op_complement
l_int|4
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_en_reg
)paren
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_get_status
r_static
r_int
id|gdth_get_status
c_func
(paren
id|unchar
op_star
id|pIStatus
comma
r_int
id|irq
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|i
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_get_status() irq %d ctr_count %d&bslash;n&quot;
comma
id|irq
comma
id|gdth_ctr_count
)paren
)paren
suffix:semicolon
op_star
id|pIStatus
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gdth_ctr_count
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;irq
op_ne
(paren
id|unchar
)paren
id|irq
)paren
multiline_comment|/* check IRQ */
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
op_star
id|pIStatus
op_assign
id|inb
c_func
(paren
(paren
id|ushort
)paren
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
op_star
id|pIStatus
op_assign
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt2_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Cmd_Index
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
op_star
id|pIStatus
op_assign
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Cmd_Index
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
op_star
id|pIStatus
op_assign
id|inb
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
op_star
id|pIStatus
op_assign
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.edoor_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pIStatus
)paren
r_return
id|i
suffix:semicolon
multiline_comment|/* board found */
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_test_busy
r_static
r_int
id|gdth_test_busy
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
r_int
id|gdtsema0
op_assign
l_int|0
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_test_busy() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|inb
c_func
(paren
id|ha-&gt;bmic
op_plus
id|SEMA0REG
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt2_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|inb
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema0_reg
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
id|gdtsema0
op_assign
(paren
r_int
)paren
id|gdth_readb
c_func
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.sema0_reg
)paren
suffix:semicolon
r_return
(paren
id|gdtsema0
op_amp
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|gdth_get_cmd_index
r_static
r_int
id|gdth_get_cmd_index
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|i
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_get_cmd_index() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_eq
id|UNUSED_CMND
)paren
(brace
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_assign
id|ha-&gt;pccb-&gt;RequestBuffer
suffix:semicolon
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|service
op_assign
id|ha-&gt;pccb-&gt;Service
suffix:semicolon
id|ha-&gt;pccb-&gt;CommandIndex
op_assign
(paren
id|ulong32
)paren
id|i
op_plus
l_int|2
suffix:semicolon
r_return
(paren
id|i
op_plus
l_int|2
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_set_sema0
r_static
r_void
id|gdth_set_sema0
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_set_sema0() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
id|outb
c_func
(paren
l_int|1
comma
id|ha-&gt;bmic
op_plus
id|SEMA0REG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt2_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|u.ic.Sema0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema0_reg
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.sema0_reg
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_copy_command
r_static
r_void
id|gdth_copy_command
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmd_ptr
suffix:semicolon
r_register
id|gdt6m_dpram_str
id|__iomem
op_star
id|dp6m_ptr
suffix:semicolon
r_register
id|gdt6c_dpram_str
id|__iomem
op_star
id|dp6c_ptr
suffix:semicolon
id|gdt6_dpram_str
id|__iomem
op_star
id|dp6_ptr
suffix:semicolon
id|gdt2_dpram_str
id|__iomem
op_star
id|dp2_ptr
suffix:semicolon
id|ushort
id|cp_count
comma
id|dp_offset
comma
id|cmd_no
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_copy_command() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cp_count
op_assign
id|ha-&gt;cmd_len
suffix:semicolon
id|dp_offset
op_assign
id|ha-&gt;cmd_offs_dpmem
suffix:semicolon
id|cmd_no
op_assign
id|ha-&gt;cmd_cnt
suffix:semicolon
id|cmd_ptr
op_assign
id|ha-&gt;pccb
suffix:semicolon
op_increment
id|ha-&gt;cmd_cnt
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
r_return
suffix:semicolon
multiline_comment|/* no DPMEM, no copy */
multiline_comment|/* set cpcount dword aligned */
r_if
c_cond
(paren
id|cp_count
op_amp
l_int|3
)paren
id|cp_count
op_add_assign
(paren
l_int|4
op_minus
(paren
id|cp_count
op_amp
l_int|3
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_add_assign
id|cp_count
suffix:semicolon
multiline_comment|/* set offset and service, copy command to DPMEM */
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp2_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|gdth_writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp2_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|gdth_writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|dp6c_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6c_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|gdth_writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6c_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6c_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
id|gdth_writew
c_func
(paren
id|dp_offset
op_plus
id|DPMEM_COMMAND_OFFSET
comma
op_amp
id|dp6m_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|offset
)paren
suffix:semicolon
id|gdth_writew
c_func
(paren
(paren
id|ushort
)paren
id|cmd_ptr-&gt;Service
comma
op_amp
id|dp6m_ptr-&gt;u.ic.comm_queue
(braket
id|cmd_no
)braket
dot
id|serv_id
)paren
suffix:semicolon
id|memcpy_toio
c_func
(paren
op_amp
id|dp6m_ptr-&gt;u.ic.gdt_dpr_cmd
(braket
id|dp_offset
)braket
comma
id|cmd_ptr
comma
id|cp_count
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_release_event
r_static
r_void
id|gdth_release_event
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_release_event() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
(brace
id|ulong32
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|j
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;cmd_tab
(braket
id|j
)braket
dot
id|cmnd
op_ne
id|UNUSED_CMND
)paren
op_increment
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|max_index
OL
id|i
)paren
(brace
id|max_index
op_assign
id|i
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_index = %d&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pccb-&gt;OpCode
op_eq
id|GDT_INIT
)paren
id|ha-&gt;pccb-&gt;Service
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;pccb-&gt;OpCode
op_eq
id|GDT_INIT
)paren
multiline_comment|/* store DMA buffer */
id|outl
c_func
(paren
id|ha-&gt;ccb_phys
comma
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ha-&gt;pccb-&gt;Service
comma
id|ha-&gt;bmic
op_plus
id|LDOORREG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
id|gdt2_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|io.event
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
id|gdt6_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|io.event
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
id|outb
c_func
(paren
l_int|1
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;ldoor_reg
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|1
comma
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.ldoor_reg
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_wait
r_static
r_int
id|gdth_wait
c_func
(paren
r_int
id|hanum
comma
r_int
id|index
comma
id|ulong32
id|time
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|answer_found
op_assign
id|FALSE
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_wait() hanum %d index %d time %d&bslash;n&quot;
comma
id|hanum
comma
id|index
comma
id|time
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* no wait required */
id|gdth_from_wait
op_assign
id|TRUE
suffix:semicolon
r_do
(brace
id|gdth_interrupt
c_func
(paren
(paren
r_int
)paren
id|ha-&gt;irq
comma
id|ha
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_hanum
op_eq
id|hanum
op_logical_and
id|wait_index
op_eq
id|index
)paren
(brace
id|answer_found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|time
)paren
suffix:semicolon
id|gdth_from_wait
op_assign
id|FALSE
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|answer_found
)paren
suffix:semicolon
)brace
DECL|function|gdth_internal_cmd
r_static
r_int
id|gdth_internal_cmd
c_func
(paren
r_int
id|hanum
comma
id|unchar
id|service
comma
id|ushort
id|opcode
comma
id|ulong32
id|p1
comma
id|ulong64
id|p2
comma
id|ulong64
id|p3
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmd_ptr
suffix:semicolon
r_int
id|retries
comma
id|index
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_internal_cmd() service %d opcode %d&bslash;n&quot;
comma
id|service
comma
id|opcode
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmd_ptr
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|cmd_ptr
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
multiline_comment|/* make command  */
r_for
c_loop
(paren
id|retries
op_assign
id|INIT_RETRIES
suffix:semicolon
suffix:semicolon
)paren
(brace
id|cmd_ptr-&gt;Service
op_assign
id|service
suffix:semicolon
id|cmd_ptr-&gt;RequestBuffer
op_assign
id|INTERNAL_CMND
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmd_ptr-&gt;OpCode
op_assign
id|opcode
suffix:semicolon
id|cmd_ptr-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|CACHESERVICE
)paren
(brace
r_if
c_cond
(paren
id|opcode
op_eq
id|GDT_IOCTL
)paren
(brace
id|cmd_ptr-&gt;u.ioctl.subfunc
op_assign
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.channel
op_assign
(paren
id|ulong32
)paren
id|p2
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.param_size
op_assign
(paren
id|ushort
)paren
id|p3
suffix:semicolon
id|cmd_ptr-&gt;u.ioctl.p_param
op_assign
id|ha-&gt;scratch_phys
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
id|cmd_ptr-&gt;u.cache64.DeviceNo
op_assign
(paren
id|ushort
)paren
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.cache64.BlockNo
op_assign
id|p2
suffix:semicolon
)brace
r_else
(brace
id|cmd_ptr-&gt;u.cache.DeviceNo
op_assign
(paren
id|ushort
)paren
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.cache.BlockNo
op_assign
(paren
id|ulong32
)paren
id|p2
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|service
op_eq
id|SCSIRAWSERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|GDT_64BIT
)paren
(brace
id|cmd_ptr-&gt;u.raw64.direction
op_assign
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.raw64.bus
op_assign
(paren
id|unchar
)paren
id|p2
suffix:semicolon
id|cmd_ptr-&gt;u.raw64.target
op_assign
(paren
id|unchar
)paren
id|p3
suffix:semicolon
id|cmd_ptr-&gt;u.raw64.lun
op_assign
(paren
id|unchar
)paren
(paren
id|p3
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmd_ptr-&gt;u.raw.direction
op_assign
id|p1
suffix:semicolon
id|cmd_ptr-&gt;u.raw.bus
op_assign
(paren
id|unchar
)paren
id|p2
suffix:semicolon
id|cmd_ptr-&gt;u.raw.target
op_assign
(paren
id|unchar
)paren
id|p3
suffix:semicolon
id|cmd_ptr-&gt;u.raw.lun
op_assign
(paren
id|unchar
)paren
(paren
id|p3
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|service
op_eq
id|SCREENSERVICE
)paren
(brace
r_if
c_cond
(paren
id|opcode
op_eq
id|GDT_REALTIME
)paren
(brace
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|cmd_ptr-&gt;u.screen.su.data
(braket
l_int|0
)braket
op_assign
id|p1
suffix:semicolon
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|cmd_ptr-&gt;u.screen.su.data
(braket
l_int|4
)braket
op_assign
(paren
id|ulong32
)paren
id|p2
suffix:semicolon
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|cmd_ptr-&gt;u.screen.su.data
(braket
l_int|8
)braket
op_assign
(paren
id|ulong32
)paren
id|p3
suffix:semicolon
)brace
)brace
id|ha-&gt;cmd_len
op_assign
r_sizeof
(paren
id|gdth_cmd_str
)paren
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_wait
c_func
(paren
id|hanum
comma
id|index
comma
id|INIT_TIMEOUT
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT: Initialization error (timeout service %d)&bslash;n&quot;
comma
id|service
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;status
op_ne
id|S_BSY
op_logical_or
op_decrement
id|retries
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
id|ha-&gt;status
op_ne
id|S_OK
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* search for devices */
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_static
r_int
comma
id|gdth_search_drives
c_func
(paren
r_int
id|hanum
)paren
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ushort
id|cdev_cnt
comma
id|i
suffix:semicolon
r_int
id|ok
suffix:semicolon
id|ulong32
id|bus_no
comma
id|drv_cnt
comma
id|drv_no
comma
id|j
suffix:semicolon
id|gdth_getch_str
op_star
id|chn
suffix:semicolon
id|gdth_drlist_str
op_star
id|drl
suffix:semicolon
id|gdth_iochan_str
op_star
id|ioc
suffix:semicolon
id|gdth_raw_iochan_str
op_star
id|iocr
suffix:semicolon
id|gdth_arcdl_str
op_star
id|alst
suffix:semicolon
id|gdth_alist_str
op_star
id|alst2
suffix:semicolon
id|gdth_oem_str_ioctl
op_star
id|oemstr
suffix:semicolon
macro_line|#ifdef INT_COAL
id|gdth_perf_modes
op_star
id|pmod
suffix:semicolon
macro_line|#endif
macro_line|#ifdef GDTH_RTC
id|unchar
id|rtc
(braket
l_int|12
)braket
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
macro_line|#endif     
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|ok
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initialize controller services, at first: screen service */
id|ha-&gt;screen_feat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|force_dma32
)paren
(brace
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCREENSERVICE
comma
id|GDT_X_INIT_SCR
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
)paren
id|ha-&gt;screen_feat
op_assign
id|GDT_64BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_dma32
op_logical_or
(paren
op_logical_neg
id|ok
op_logical_and
id|ha-&gt;status
op_eq
(paren
id|ushort
)paren
id|S_NOFUNC
)paren
)paren
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCREENSERVICE
comma
id|GDT_INIT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Initialization error screen service (code %d)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): SCREENSERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#ifdef GDTH_RTC
multiline_comment|/* read realtime clock info, send to controller */
multiline_comment|/* 1. wait for the falling edge of update flag */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|rtc_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|1000000
suffix:semicolon
op_increment
id|j
)paren
r_if
c_cond
(paren
id|CMOS_READ
c_func
(paren
id|RTC_FREQ_SELECT
)paren
op_amp
id|RTC_UIP
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|1000000
suffix:semicolon
op_increment
id|j
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|CMOS_READ
c_func
(paren
id|RTC_FREQ_SELECT
)paren
op_amp
id|RTC_UIP
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* 2. read info */
r_do
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|12
suffix:semicolon
op_increment
id|j
)paren
id|rtc
(braket
id|j
)braket
op_assign
id|CMOS_READ
c_func
(paren
id|j
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rtc
(braket
l_int|0
)braket
op_ne
id|CMOS_READ
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|spin_lock_irqrestore
c_func
(paren
op_amp
id|rtc_lock
comma
id|flags
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): RTC: %x/%x/%x&bslash;n&quot;
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|0
)braket
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|4
)braket
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|8
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* 3. send to controller firmware */
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCREENSERVICE
comma
id|GDT_REALTIME
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|0
)braket
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|4
)braket
comma
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|rtc
(braket
l_int|8
)braket
)paren
suffix:semicolon
macro_line|#endif  
multiline_comment|/* unfreeze all IOs */
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_UNFREEZE_IO
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* initialize cache service */
id|ha-&gt;cache_feat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|force_dma32
)paren
(brace
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_X_INIT_HOST
comma
id|LINUX_OS
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
)paren
id|ha-&gt;cache_feat
op_assign
id|GDT_64BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_dma32
op_logical_or
(paren
op_logical_neg
id|ok
op_logical_and
id|ha-&gt;status
op_eq
(paren
id|ushort
)paren
id|S_NOFUNC
)paren
)paren
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_INIT
comma
id|LINUX_OS
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Initialization error cache service (code %d)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): CACHESERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|cdev_cnt
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
id|ha-&gt;fw_vers
op_assign
id|ha-&gt;service
suffix:semicolon
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
multiline_comment|/* set perf. modes */
id|pmod
op_assign
(paren
id|gdth_perf_modes
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|pmod-&gt;version
op_assign
l_int|1
suffix:semicolon
id|pmod-&gt;st_mode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* enable one status buffer */
op_star
(paren
(paren
id|ulong64
op_star
)paren
op_amp
id|pmod-&gt;st_buff_addr1
)paren
op_assign
id|ha-&gt;coal_stat_phys
suffix:semicolon
id|pmod-&gt;st_buff_indx1
op_assign
id|COALINDEX
suffix:semicolon
id|pmod-&gt;st_buff_addr2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;st_buff_u_addr2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;st_buff_indx2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;st_buff_size
op_assign
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
suffix:semicolon
id|pmod-&gt;cmd_mode
op_assign
l_int|0
suffix:semicolon
singleline_comment|// disable all cmd buffers
id|pmod-&gt;cmd_buff_addr1
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_u_addr1
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_indx1
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_addr2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_u_addr2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_indx2
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;cmd_buff_size
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;reserved1
op_assign
l_int|0
suffix:semicolon
id|pmod-&gt;reserved2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|SET_PERF_MODES
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_perf_modes
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Interrupt coalescing activated&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* detect number of buses - try new IOCTL */
id|iocr
op_assign
(paren
id|gdth_raw_iochan_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|iocr-&gt;hdr.version
op_assign
l_int|0xffffffff
suffix:semicolon
id|iocr-&gt;hdr.list_entries
op_assign
id|MAXBUS
suffix:semicolon
id|iocr-&gt;hdr.first_chan
op_assign
l_int|0
suffix:semicolon
id|iocr-&gt;hdr.last_chan
op_assign
id|MAXBUS
op_minus
l_int|1
suffix:semicolon
id|iocr-&gt;hdr.list_offset
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_raw_iochan_str
comma
id|list
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|IOCHAN_RAW_DESC
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_raw_iochan_str
)paren
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;IOCHAN_RAW_DESC supported!&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;bus_cnt
op_assign
id|iocr-&gt;hdr.chan_count
suffix:semicolon
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
r_if
c_cond
(paren
id|iocr-&gt;list
(braket
id|bus_no
)braket
dot
id|proc_id
OL
id|MAXID
)paren
id|ha-&gt;bus_id
(braket
id|bus_no
)braket
op_assign
id|iocr-&gt;list
(braket
id|bus_no
)braket
dot
id|proc_id
suffix:semicolon
r_else
id|ha-&gt;bus_id
(braket
id|bus_no
)braket
op_assign
l_int|0xff
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* old method */
id|chn
op_assign
(paren
id|gdth_getch_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|MAXBUS
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
id|chn-&gt;channel_no
op_assign
id|bus_no
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|SCSI_CHAN_CNT
op_or
id|L_CTRL_PATTERN
comma
id|IO_CHANNEL
op_or
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_getch_str
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|bus_no
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Error detecting channel count (0x%x)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chn-&gt;siop_id
OL
id|MAXID
)paren
id|ha-&gt;bus_id
(braket
id|bus_no
)braket
op_assign
id|chn-&gt;siop_id
suffix:semicolon
r_else
id|ha-&gt;bus_id
(braket
id|bus_no
)braket
op_assign
l_int|0xff
suffix:semicolon
)brace
id|ha-&gt;bus_cnt
op_assign
(paren
id|unchar
)paren
id|bus_no
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() %d channels&bslash;n&quot;
comma
id|ha-&gt;bus_cnt
)paren
)paren
suffix:semicolon
multiline_comment|/* read cache configuration */
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|CACHE_INFO
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_cinfo_str
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Initialization error cache service (code %d)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ha-&gt;cpar
op_assign
(paren
(paren
id|gdth_cinfo_str
op_star
)paren
id|ha-&gt;pscratch
)paren
op_member_access_from_pointer
id|cpar
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() cinfo: vs %x sta %d str %d dw %d b %d&bslash;n&quot;
comma
id|ha-&gt;cpar.version
comma
id|ha-&gt;cpar.state
comma
id|ha-&gt;cpar.strategy
comma
id|ha-&gt;cpar.write_back
comma
id|ha-&gt;cpar.block_size
)paren
)paren
suffix:semicolon
multiline_comment|/* read board info and features */
id|ha-&gt;more_proc
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|BOARD_INFO
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_binfo_str
)paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|ha-&gt;binfo
comma
(paren
id|gdth_binfo_str
op_star
)paren
id|ha-&gt;pscratch
comma
r_sizeof
(paren
id|gdth_binfo_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|BOARD_FEATURES
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_bfeat_str
)paren
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;BOARD_INFO/BOARD_FEATURES supported&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;bfeat
op_assign
op_star
(paren
id|gdth_bfeat_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|ha-&gt;more_proc
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_else
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;BOARD_INFO requires firmware &gt;= 1.10/2.08&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ha-&gt;binfo.type_string
comma
id|gdth_ctr_name
c_func
(paren
id|hanum
)paren
)paren
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Controller name: %s&bslash;n&quot;
comma
id|ha-&gt;binfo.type_string
)paren
)paren
suffix:semicolon
multiline_comment|/* read more informations */
r_if
c_cond
(paren
id|ha-&gt;more_proc
)paren
(brace
multiline_comment|/* physical drives, channel addresses */
id|ioc
op_assign
(paren
id|gdth_iochan_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|ioc-&gt;hdr.version
op_assign
l_int|0xffffffff
suffix:semicolon
id|ioc-&gt;hdr.list_entries
op_assign
id|MAXBUS
suffix:semicolon
id|ioc-&gt;hdr.first_chan
op_assign
l_int|0
suffix:semicolon
id|ioc-&gt;hdr.last_chan
op_assign
id|MAXBUS
op_minus
l_int|1
suffix:semicolon
id|ioc-&gt;hdr.list_offset
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_iochan_str
comma
id|list
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|IOCHAN_DESC
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_iochan_str
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|address
op_assign
id|ioc-&gt;list
(braket
id|bus_no
)braket
dot
id|address
suffix:semicolon
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|local_no
op_assign
id|ioc-&gt;list
(braket
id|bus_no
)braket
dot
id|local_no
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|address
op_assign
id|IO_CHANNEL
suffix:semicolon
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|local_no
op_assign
id|bus_no
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|bus_no
op_assign
l_int|0
suffix:semicolon
id|bus_no
OL
id|ha-&gt;bus_cnt
suffix:semicolon
op_increment
id|bus_no
)paren
(brace
id|chn
op_assign
(paren
id|gdth_getch_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|chn-&gt;channel_no
op_assign
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|local_no
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|SCSI_CHAN_CNT
op_or
id|L_CTRL_PATTERN
comma
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|address
op_or
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_getch_str
)paren
)paren
)paren
(brace
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|pdev_cnt
op_assign
id|chn-&gt;drive_cnt
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Channel %d: %d phys. drives&bslash;n&quot;
comma
id|bus_no
comma
id|chn-&gt;drive_cnt
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|pdev_cnt
OG
l_int|0
)paren
(brace
id|drl
op_assign
(paren
id|gdth_drlist_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|drl-&gt;sc_no
op_assign
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|local_no
suffix:semicolon
id|drl-&gt;sc_cnt
op_assign
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|pdev_cnt
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|SCSI_DR_LIST
op_or
id|L_CTRL_PATTERN
comma
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|address
op_or
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_drlist_str
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|pdev_cnt
suffix:semicolon
op_increment
id|j
)paren
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|id_list
(braket
id|j
)braket
op_assign
id|drl-&gt;sc_list
(braket
id|j
)braket
suffix:semicolon
)brace
r_else
(brace
id|ha-&gt;raw
(braket
id|bus_no
)braket
dot
id|pdev_cnt
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* logical drives */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|CACHE_DRV_CNT
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|ulong32
)paren
)paren
)paren
(brace
id|drv_cnt
op_assign
op_star
(paren
id|ulong32
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|CACHE_DRV_LIST
comma
id|INVALID_CHANNEL
comma
id|drv_cnt
op_star
r_sizeof
(paren
id|ulong32
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|drv_cnt
suffix:semicolon
op_increment
id|j
)paren
(brace
id|drv_no
op_assign
(paren
(paren
id|ulong32
op_star
)paren
id|ha-&gt;pscratch
)paren
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|drv_no
OL
id|MAX_LDRIVES
)paren
(brace
id|ha-&gt;hdr
(braket
id|drv_no
)braket
dot
id|is_logdrv
op_assign
id|TRUE
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Drive %d is log. drive&bslash;n&quot;
comma
id|drv_no
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
id|alst
op_assign
(paren
id|gdth_arcdl_str
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|alst-&gt;entries_avail
op_assign
id|MAX_LDRIVES
suffix:semicolon
id|alst-&gt;first_entry
op_assign
l_int|0
suffix:semicolon
id|alst-&gt;list_offset
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_arcdl_str
comma
id|list
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|ARRAY_DRV_LIST2
op_or
id|LA_CTRL_PATTERN
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_arcdl_str
)paren
op_plus
(paren
id|alst-&gt;entries_avail
op_minus
l_int|1
)paren
op_star
r_sizeof
(paren
id|gdth_alist_str
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|alst-&gt;entries_init
suffix:semicolon
op_increment
id|j
)paren
(brace
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_arraydrv
op_assign
id|alst-&gt;list
(braket
id|j
)braket
dot
id|is_arrayd
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_master
op_assign
id|alst-&gt;list
(braket
id|j
)braket
dot
id|is_master
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_parity
op_assign
id|alst-&gt;list
(braket
id|j
)braket
dot
id|is_parity
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_hotfix
op_assign
id|alst-&gt;list
(braket
id|j
)braket
dot
id|is_hotfix
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|master_no
op_assign
id|alst-&gt;list
(braket
id|j
)braket
dot
id|cd_handle
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|ARRAY_DRV_LIST
op_or
id|LA_CTRL_PATTERN
comma
l_int|0
comma
l_int|35
op_star
r_sizeof
(paren
id|gdth_alist_str
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|35
suffix:semicolon
op_increment
id|j
)paren
(brace
id|alst2
op_assign
op_amp
(paren
(paren
id|gdth_alist_str
op_star
)paren
id|ha-&gt;pscratch
)paren
(braket
id|j
)braket
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_arraydrv
op_assign
id|alst2-&gt;is_arrayd
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_master
op_assign
id|alst2-&gt;is_master
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_parity
op_assign
id|alst2-&gt;is_parity
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|is_hotfix
op_assign
id|alst2-&gt;is_hotfix
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|master_no
op_assign
id|alst2-&gt;cd_handle
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* initialize raw service */
id|ha-&gt;raw_feat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|force_dma32
)paren
(brace
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_X_INIT_RAW
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ok
)paren
id|ha-&gt;raw_feat
op_assign
id|GDT_64BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_dma32
op_logical_or
(paren
op_logical_neg
id|ok
op_logical_and
id|ha-&gt;status
op_eq
(paren
id|ushort
)paren
id|S_NOFUNC
)paren
)paren
id|ok
op_assign
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_INIT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Initialization error raw service (code %d)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): RAWSERVICE initialized&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* set/get features raw service (scatter/gather) */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_SET_FEAT
comma
id|SCATTER_GATHER
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): set features RAWSERVICE OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_GET_FEAT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr(): get feat RAWSERVICE %d&bslash;n&quot;
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;raw_feat
op_or_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
)brace
multiline_comment|/* set/get features cache service (equal to raw service) */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_SET_FEAT
comma
l_int|0
comma
id|SCATTER_GATHER
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): set features CACHESERVICE OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_GET_FEAT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr(): get feat CACHESERV. %d&bslash;n&quot;
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;cache_feat
op_or_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
)brace
multiline_comment|/* reserve drives for raw service */
r_if
c_cond
(paren
id|reserve_mode
op_ne
l_int|0
)paren
(brace
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_RESERVE_ALL
comma
id|reserve_mode
op_eq
l_int|1
ques
c_cond
l_int|1
suffix:colon
l_int|3
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): RESERVE_ALL code %d&bslash;n&quot;
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_RES_ARGS
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|reserve_list
(braket
id|i
)braket
op_eq
id|hanum
op_logical_and
id|reserve_list
(braket
id|i
op_plus
l_int|1
)braket
OL
id|ha-&gt;bus_cnt
op_logical_and
id|reserve_list
(braket
id|i
op_plus
l_int|2
)braket
OL
id|ha-&gt;tid_cnt
op_logical_and
id|reserve_list
(braket
id|i
op_plus
l_int|3
)braket
OL
id|MAXLUN
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): reserve ha %d bus %d id %d lun %d&bslash;n&quot;
comma
id|reserve_list
(braket
id|i
)braket
comma
id|reserve_list
(braket
id|i
op_plus
l_int|1
)braket
comma
id|reserve_list
(braket
id|i
op_plus
l_int|2
)braket
comma
id|reserve_list
(braket
id|i
op_plus
l_int|3
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_RESERVE
comma
l_int|0
comma
id|reserve_list
(braket
id|i
op_plus
l_int|1
)braket
comma
id|reserve_list
(braket
id|i
op_plus
l_int|2
)braket
op_or
(paren
id|reserve_list
(braket
id|i
op_plus
l_int|3
)braket
op_lshift
l_int|8
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Error raw service (RESERVE, code %d)&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;status
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Determine OEM string using IOCTL */
id|oemstr
op_assign
(paren
id|gdth_oem_str_ioctl
op_star
)paren
id|ha-&gt;pscratch
suffix:semicolon
id|oemstr-&gt;params.ctl_version
op_assign
l_int|0x01
suffix:semicolon
id|oemstr-&gt;params.buffer_size
op_assign
r_sizeof
(paren
id|oemstr-&gt;text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_IOCTL
comma
id|CACHE_READ_OEM_STRING_RECORD
comma
id|INVALID_CHANNEL
comma
r_sizeof
(paren
id|gdth_oem_str_ioctl
)paren
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): CACHE_READ_OEM_STRING_RECORD OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Vendor: %s Name: %s&bslash;n&quot;
comma
id|hanum
comma
id|oemstr-&gt;text.oem_company_name
comma
id|ha-&gt;binfo.type_string
)paren
suffix:semicolon
multiline_comment|/* Save the Host Drive inquiry data */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|strlcpy
c_func
(paren
id|ha-&gt;oem_name
comma
id|oemstr-&gt;text.scsi_host_drive_inquiry_vendor_id
comma
r_sizeof
(paren
id|ha-&gt;oem_name
)paren
)paren
suffix:semicolon
macro_line|#else
id|strncpy
c_func
(paren
id|ha-&gt;oem_name
comma
id|oemstr-&gt;text.scsi_host_drive_inquiry_vendor_id
comma
l_int|7
)paren
suffix:semicolon
id|ha-&gt;oem_name
(braket
l_int|7
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
multiline_comment|/* Old method, based on PCI ID */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_drives(): CACHE_READ_OEM_STRING_RECORD failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Name: %s&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;binfo.type_string
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_if
c_cond
(paren
id|ha-&gt;oem_id
op_eq
id|OEM_ID_INTEL
)paren
id|strlcpy
c_func
(paren
id|ha-&gt;oem_name
comma
l_string|&quot;Intel  &quot;
comma
r_sizeof
(paren
id|ha-&gt;oem_name
)paren
)paren
suffix:semicolon
r_else
id|strlcpy
c_func
(paren
id|ha-&gt;oem_name
comma
l_string|&quot;ICP    &quot;
comma
r_sizeof
(paren
id|ha-&gt;oem_name
)paren
)paren
suffix:semicolon
macro_line|#else 
r_if
c_cond
(paren
id|ha-&gt;oem_id
op_eq
id|OEM_ID_INTEL
)paren
id|strcpy
c_func
(paren
id|ha-&gt;oem_name
comma
l_string|&quot;Intel  &quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|ha-&gt;oem_name
comma
l_string|&quot;ICP    &quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* scanning for host drives */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cdev_cnt
suffix:semicolon
op_increment
id|i
)paren
id|gdth_analyse_hdrive
c_func
(paren
id|hanum
comma
id|i
)paren
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_search_drives() OK&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_analyse_hdrive
r_static
r_int
id|gdth_analyse_hdrive
c_func
(paren
r_int
id|hanum
comma
id|ushort
id|hdrive
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong32
id|drv_cyls
suffix:semicolon
r_int
id|drv_hds
comma
id|drv_secs
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_analyse_hdrive() hanum %d drive %d&bslash;n&quot;
comma
id|hanum
comma
id|hdrive
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdrive
op_ge
id|MAX_HDRIVES
)paren
r_return
l_int|0
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_INFO
comma
id|hdrive
comma
l_int|0
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|present
op_assign
id|TRUE
suffix:semicolon
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
op_assign
id|ha-&gt;info
suffix:semicolon
multiline_comment|/* evaluate mapping (sectors per head, heads per cylinder) */
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
op_and_assign
op_complement
id|SECS32
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;info2
op_eq
l_int|0
)paren
(brace
id|gdth_eval_mapping
c_func
(paren
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
comma
op_amp
id|drv_cyls
comma
op_amp
id|drv_hds
comma
op_amp
id|drv_secs
)paren
suffix:semicolon
)brace
r_else
(brace
id|drv_hds
op_assign
id|ha-&gt;info2
op_amp
l_int|0xff
suffix:semicolon
id|drv_secs
op_assign
(paren
id|ha-&gt;info2
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|drv_cyls
op_assign
(paren
id|ulong32
)paren
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
op_div
id|drv_hds
op_div
id|drv_secs
suffix:semicolon
)brace
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|heads
op_assign
(paren
id|unchar
)paren
id|drv_hds
suffix:semicolon
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|secs
op_assign
(paren
id|unchar
)paren
id|drv_secs
suffix:semicolon
multiline_comment|/* round size */
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
op_assign
id|drv_cyls
op_star
id|drv_hds
op_star
id|drv_secs
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_X_INFO
comma
id|hdrive
comma
l_int|0
comma
l_int|0
)paren
op_logical_and
id|ha-&gt;info2
op_ne
l_int|0
)paren
(brace
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
op_assign
(paren
(paren
id|ulong64
)paren
id|ha-&gt;info2
op_lshift
l_int|32
)paren
op_or
id|ha-&gt;info
suffix:semicolon
)brace
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cdr. %d size %d hds %d scs %d&bslash;n&quot;
comma
id|hdrive
comma
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|size
comma
id|drv_hds
comma
id|drv_secs
)paren
)paren
suffix:semicolon
multiline_comment|/* get informations about device */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_DEVTYPE
comma
id|hdrive
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cache drive %d devtype %d&bslash;n&quot;
comma
id|hdrive
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|devtype
op_assign
(paren
id|ushort
)paren
id|ha-&gt;info
suffix:semicolon
)brace
multiline_comment|/* cluster info */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_CLUST_INFO
comma
id|hdrive
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cache drive %d cluster info %d&bslash;n&quot;
comma
id|hdrive
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shared_access
)paren
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|cluster_type
op_assign
(paren
id|unchar
)paren
id|ha-&gt;info
suffix:semicolon
)brace
multiline_comment|/* R/W attributes */
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_RW_ATTRIBS
comma
id|hdrive
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_search_dr() cache drive %d r/w attrib. %d&bslash;n&quot;
comma
id|hdrive
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|rw_attribs
op_assign
(paren
id|unchar
)paren
id|ha-&gt;info
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* command queueing/sending functions */
DECL|function|gdth_putq
r_static
r_void
id|gdth_putq
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|priority
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|pscp
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_putq() priority %d&bslash;n&quot;
comma
id|priority
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|scp-&gt;SCp.this_residual
op_assign
(paren
r_int
)paren
id|priority
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|priority
op_ge
id|DEFAULT_PRI
)paren
(brace
r_if
c_cond
(paren
(paren
id|b
op_ne
id|ha-&gt;virt_bus
op_logical_and
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|lock
)paren
op_logical_or
(paren
id|b
op_eq
id|ha-&gt;virt_bus
op_logical_and
id|t
OL
id|MAX_HDRIVES
op_logical_and
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|lock
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_putq(): locked IO -&gt; update_timeout()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|scp-&gt;SCp.buffers_residual
op_assign
id|gdth_update_timeout
c_func
(paren
id|hanum
comma
id|scp
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ha-&gt;req_first
op_eq
l_int|NULL
)paren
(brace
id|ha-&gt;req_first
op_assign
id|scp
suffix:semicolon
multiline_comment|/* queue was empty */
id|scp-&gt;SCp.ptr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* queue not empty */
id|pscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
multiline_comment|/* priority: 0-highest,..,0xff-lowest */
r_while
c_loop
(paren
id|nscp
op_logical_and
(paren
id|unchar
)paren
id|nscp-&gt;SCp.this_residual
op_le
id|priority
)paren
(brace
id|pscp
op_assign
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
)brace
id|pscp-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
id|scp
suffix:semicolon
id|scp-&gt;SCp.ptr
op_assign
(paren
r_char
op_star
)paren
id|nscp
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
id|flags
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|nscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
op_increment
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|max_rq
OL
id|flags
)paren
(brace
id|max_rq
op_assign
id|flags
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_rq = %d&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|max_rq
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|gdth_next
r_static
r_void
id|gdth_next
c_func
(paren
r_int
id|hanum
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|pscp
suffix:semicolon
r_register
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|unchar
id|b
comma
id|t
comma
id|l
comma
id|firsttime
suffix:semicolon
id|unchar
id|this_cmd
comma
id|next_cmd
suffix:semicolon
id|ulong
id|flags
op_assign
l_int|0
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_next() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|this_cmd
op_assign
id|firsttime
op_assign
id|TRUE
suffix:semicolon
id|next_cmd
op_assign
id|gdth_polling
ques
c_cond
id|FALSE
suffix:colon
id|TRUE
suffix:semicolon
id|cmd_index
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|nscp
op_assign
id|pscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
(brace
r_if
c_cond
(paren
id|nscp
op_ne
id|pscp
op_logical_and
id|nscp
op_ne
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
)paren
id|pscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|pscp-&gt;SCp.ptr
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|nscp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|nscp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|nscp-&gt;device-&gt;id
suffix:semicolon
id|l
op_assign
id|nscp-&gt;device-&gt;lun
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|nscp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|nscp-&gt;channel
suffix:semicolon
id|t
op_assign
id|nscp-&gt;target
suffix:semicolon
id|l
op_assign
id|nscp-&gt;lun
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|nscp-&gt;SCp.this_residual
op_ge
id|DEFAULT_PRI
)paren
(brace
r_if
c_cond
(paren
(paren
id|b
op_ne
id|ha-&gt;virt_bus
op_logical_and
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|lock
)paren
op_logical_or
(paren
id|b
op_eq
id|ha-&gt;virt_bus
op_logical_and
id|t
OL
id|MAX_HDRIVES
op_logical_and
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|lock
)paren
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|firsttime
)paren
(brace
r_if
c_cond
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
(brace
multiline_comment|/* controller busy ? */
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_next() controller %d busy !&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
(brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|firsttime
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nscp-&gt;done
op_ne
id|gdth_scsi_done
op_logical_or
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|nscp-&gt;SCp.phase
op_eq
op_minus
l_int|1
)paren
(brace
id|nscp-&gt;SCp.phase
op_assign
id|CACHESERVICE
suffix:semicolon
multiline_comment|/* default: cache svc. */
r_if
c_cond
(paren
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|TEST_UNIT_READY
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;TEST_UNIT_READY Bus %d Id %d LUN %d&bslash;n&quot;
comma
id|b
comma
id|t
comma
id|l
)paren
)paren
suffix:semicolon
multiline_comment|/* TEST_UNIT_READY -&gt; set scan mode */
r_if
c_cond
(paren
(paren
id|ha-&gt;scan_mode
op_amp
l_int|0x0f
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|b
op_eq
l_int|0
op_logical_and
id|t
op_eq
l_int|0
op_logical_and
id|l
op_eq
l_int|0
)paren
(brace
id|ha-&gt;scan_mode
op_or_assign
l_int|1
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Scan mode: 0x%x&bslash;n&quot;
comma
id|ha-&gt;scan_mode
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|ha-&gt;scan_mode
op_amp
l_int|0x0f
)paren
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|b
op_eq
l_int|0
op_logical_and
(paren
(paren
id|t
op_eq
l_int|0
op_logical_and
id|l
op_eq
l_int|1
)paren
op_logical_or
(paren
id|t
op_eq
l_int|1
op_logical_and
id|l
op_eq
l_int|0
)paren
)paren
)paren
(brace
id|nscp-&gt;SCp.sent_command
op_assign
id|GDT_SCAN_START
suffix:semicolon
id|nscp-&gt;SCp.phase
op_assign
(paren
(paren
id|ha-&gt;scan_mode
op_amp
l_int|0x10
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
op_lshift
l_int|8
)paren
op_or
id|SCSIRAWSERVICE
suffix:semicolon
id|ha-&gt;scan_mode
op_assign
l_int|0x12
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Scan mode: 0x%x (SCAN_START)&bslash;n&quot;
comma
id|ha-&gt;scan_mode
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ha-&gt;scan_mode
op_and_assign
l_int|0x10
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Scan mode: 0x%x&bslash;n&quot;
comma
id|ha-&gt;scan_mode
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;scan_mode
op_eq
l_int|0x12
)paren
(brace
r_if
c_cond
(paren
id|b
op_eq
id|ha-&gt;bus_cnt
op_logical_and
id|t
op_eq
id|ha-&gt;tid_cnt
op_minus
l_int|1
)paren
(brace
id|nscp-&gt;SCp.phase
op_assign
id|SCSIRAWSERVICE
suffix:semicolon
id|nscp-&gt;SCp.sent_command
op_assign
id|GDT_SCAN_END
suffix:semicolon
id|ha-&gt;scan_mode
op_and_assign
l_int|0x10
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Scan mode: 0x%x (SCAN_END)&bslash;n&quot;
comma
id|ha-&gt;scan_mode
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|b
op_eq
id|ha-&gt;virt_bus
op_logical_and
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_ne
id|INQUIRY
op_logical_and
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_ne
id|READ_CAPACITY
op_logical_and
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_ne
id|MODE_SENSE
op_logical_and
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_DRIVE
)paren
)paren
(brace
multiline_comment|/* always GDT_CLUST_INFO! */
id|nscp-&gt;SCp.sent_command
op_assign
id|GDT_CLUST_INFO
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|nscp-&gt;SCp.sent_command
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|nscp-&gt;SCp.phase
op_amp
l_int|0xff
)paren
op_eq
id|CACHESERVICE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|t
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|nscp-&gt;SCp.phase
op_amp
l_int|0xff
)paren
op_eq
id|SCSIRAWSERVICE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_raw_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|nscp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|NOT_READY
suffix:semicolon
id|nscp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|nscp-&gt;done
op_eq
id|gdth_scsi_done
op_logical_and
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_special_cmd
c_func
(paren
id|hanum
comma
id|nscp
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
id|next_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|b
op_ne
id|ha-&gt;virt_bus
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|io_cnt
(braket
id|t
)braket
op_ge
id|GDTH_MAX_RAW
op_logical_or
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_raw_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
r_else
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|io_cnt
(braket
id|t
)braket
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t
op_ge
id|MAX_HDRIVES
op_logical_or
op_logical_neg
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|present
op_logical_or
id|l
op_ne
l_int|0
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Command 0x%x to bus %d id %d lun %d -&gt; IGNORE&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|b
comma
id|t
comma
id|l
)paren
)paren
suffix:semicolon
id|nscp-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
r_case
id|INQUIRY
suffix:colon
r_case
id|REQUEST_SENSE
suffix:colon
r_case
id|READ_CAPACITY
suffix:colon
r_case
id|VERIFY
suffix:colon
r_case
id|START_STOP
suffix:colon
r_case
id|MODE_SENSE
suffix:colon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_case
id|SERVICE_ACTION_IN
suffix:colon
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
op_logical_and
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_ne
id|INQUIRY
)paren
(brace
multiline_comment|/* return UNIT_ATTENTION */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cmd 0x%x target %d: UNIT_ATTENTION&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|t
)paren
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
op_assign
id|FALSE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|nscp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|UNIT_ATTENTION
suffix:semicolon
id|nscp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|gdth_internal_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ALLOW_MEDIUM_REMOVAL
suffix:colon
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
op_amp
l_int|1
)paren
op_logical_and
op_logical_neg
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;Prevent r. nonremov. drive-&gt;do nothing&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|nscp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
op_assign
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;Prevent/allow r. %d rem. drive %d&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|t
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RESERVE
suffix:colon
r_case
id|RELEASE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache cmd %s&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|RESERVE
ques
c_cond
l_string|&quot;RESERVE&quot;
suffix:colon
l_string|&quot;RELEASE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|t
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_6
suffix:colon
r_case
id|WRITE_6
suffix:colon
r_case
id|READ_10
suffix:colon
r_case
id|WRITE_10
suffix:colon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_case
id|READ_16
suffix:colon
r_case
id|WRITE_16
suffix:colon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
)paren
(brace
multiline_comment|/* return UNIT_ATTENTION */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cmd 0x%x target %d: UNIT_ATTENTION&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|t
)paren
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
op_assign
id|FALSE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|nscp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|nscp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|UNIT_ATTENTION
suffix:semicolon
id|nscp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_fill_cache_cmd
c_func
(paren
id|hanum
comma
id|nscp
comma
id|t
)paren
)paren
)paren
id|this_cmd
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache cmd %x/%x/%x/%x/%x/%x unknown&bslash;n&quot;
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|1
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|2
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|3
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|4
)braket
comma
id|nscp-&gt;cmnd
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Unknown SCSI command 0x%x to cache service !&bslash;n&quot;
comma
id|hanum
comma
id|nscp-&gt;cmnd
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|nscp-&gt;result
op_assign
id|DID_ABORT
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nscp-&gt;SCp.have_data_in
)paren
id|nscp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* io_request_lock already active ! */
id|nscp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|nscp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|this_cmd
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nscp
op_eq
id|ha-&gt;req_first
)paren
id|ha-&gt;req_first
op_assign
id|pscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
suffix:semicolon
r_else
id|pscp-&gt;SCp.ptr
op_assign
id|nscp-&gt;SCp.ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|next_cmd
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_polling
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_wait
c_func
(paren
id|hanum
comma
id|cmd_index
comma
id|POLL_TIMEOUT
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: Command %d timed out !&bslash;n&quot;
comma
id|hanum
comma
id|cmd_index
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_copy_internal_data
r_static
r_void
id|gdth_copy_internal_data
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
r_char
op_star
id|buffer
comma
id|ushort
id|count
)paren
(brace
id|ushort
id|cpcount
comma
id|i
suffix:semicolon
id|ushort
id|cpsum
comma
id|cpnow
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_char
op_star
id|address
suffix:semicolon
id|cpcount
op_assign
id|count
op_le
(paren
id|ushort
)paren
id|scp-&gt;bufflen
ques
c_cond
id|count
suffix:colon
(paren
id|ushort
)paren
id|scp-&gt;bufflen
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cpsum
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cpnow
op_assign
(paren
id|ushort
)paren
id|sl-&gt;length
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;copy_internal() now %d sum %d count %d %d&bslash;n&quot;
comma
id|cpnow
comma
id|cpsum
comma
id|cpcount
comma
(paren
id|ushort
)paren
id|scp-&gt;bufflen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_plus
id|cpnow
OG
id|cpcount
)paren
id|cpnow
op_assign
id|cpcount
op_minus
id|cpsum
suffix:semicolon
id|cpsum
op_add_assign
id|cpnow
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sl-&gt;page
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA %d: invalid sc/gt element in gdth_copy_internal_data()&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|address
op_assign
id|kmap_atomic
c_func
(paren
id|sl-&gt;page
comma
id|KM_BIO_SRC_IRQ
)paren
op_plus
id|sl-&gt;offset
suffix:semicolon
id|memcpy
c_func
(paren
id|address
comma
id|buffer
comma
id|cpnow
)paren
suffix:semicolon
id|flush_dcache_page
c_func
(paren
id|sl-&gt;page
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|address
comma
id|KM_BIO_SRC_IRQ
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_eq
id|cpcount
)paren
r_break
suffix:semicolon
id|buffer
op_add_assign
id|cpnow
suffix:semicolon
)brace
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|cpsum
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cpnow
op_assign
(paren
id|ushort
)paren
id|sl-&gt;length
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;copy_internal() now %d sum %d count %d %d&bslash;n&quot;
comma
id|cpnow
comma
id|cpsum
comma
id|cpcount
comma
(paren
id|ushort
)paren
id|scp-&gt;bufflen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_plus
id|cpnow
OG
id|cpcount
)paren
id|cpnow
op_assign
id|cpcount
op_minus
id|cpsum
suffix:semicolon
id|cpsum
op_add_assign
id|cpnow
suffix:semicolon
id|address
op_assign
(paren
r_char
op_star
)paren
id|sl-&gt;address
suffix:semicolon
id|memcpy
c_func
(paren
id|address
comma
id|buffer
comma
id|cpnow
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpsum
op_eq
id|cpcount
)paren
r_break
suffix:semicolon
id|buffer
op_add_assign
id|cpnow
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;copy_internal() count %d&bslash;n&quot;
comma
id|cpcount
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|scp-&gt;request_buffer
comma
id|buffer
comma
id|cpcount
)paren
suffix:semicolon
)brace
)brace
DECL|function|gdth_internal_cache_cmd
r_static
r_int
id|gdth_internal_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|unchar
id|t
suffix:semicolon
id|gdth_inq_data
id|inq
suffix:semicolon
id|gdth_rdcap_data
id|rdc
suffix:semicolon
id|gdth_sense_data
id|sd
suffix:semicolon
id|gdth_modep_data
id|mpd
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_internal_cache_cmd() cmd 0x%x hdrive %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|t
)paren
)paren
suffix:semicolon
id|scp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
r_case
id|VERIFY
suffix:colon
r_case
id|START_STOP
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Test/Verify/Start hdrive %d&bslash;n&quot;
comma
id|t
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INQUIRY
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Inquiry hdrive %d devtype %d&bslash;n&quot;
comma
id|t
comma
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
)paren
)paren
suffix:semicolon
id|inq.type_qual
op_assign
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|4
)paren
ques
c_cond
id|TYPE_ROM
suffix:colon
id|TYPE_DISK
suffix:semicolon
multiline_comment|/* you can here set all disks to removable, if you want to do&n;           a flush using the ALLOW_MEDIUM_REMOVAL command */
id|inq.modif_rmb
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|1
)paren
op_logical_or
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_DRIVE
)paren
)paren
id|inq.modif_rmb
op_assign
l_int|0x80
suffix:semicolon
id|inq.version
op_assign
l_int|2
suffix:semicolon
id|inq.resp_aenc
op_assign
l_int|2
suffix:semicolon
id|inq.add_length
op_assign
l_int|32
suffix:semicolon
id|strcpy
c_func
(paren
id|inq.vendor
comma
id|ha-&gt;oem_name
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|inq.product
comma
l_string|&quot;Host Drive  #%02d&quot;
comma
id|t
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|inq.revision
comma
l_string|&quot;   &quot;
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|hanum
comma
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|inq
comma
r_sizeof
(paren
id|gdth_inq_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REQUEST_SENSE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Request sense hdrive %d&bslash;n&quot;
comma
id|t
)paren
)paren
suffix:semicolon
id|sd.errorcode
op_assign
l_int|0x70
suffix:semicolon
id|sd.segno
op_assign
l_int|0x00
suffix:semicolon
id|sd.key
op_assign
id|NO_SENSE
suffix:semicolon
id|sd.info
op_assign
l_int|0
suffix:semicolon
id|sd.add_length
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|hanum
comma
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|sd
comma
r_sizeof
(paren
id|gdth_sense_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Mode sense hdrive %d&bslash;n&quot;
comma
id|t
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|mpd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_modep_data
)paren
)paren
suffix:semicolon
id|mpd.hd.data_length
op_assign
r_sizeof
(paren
id|gdth_modep_data
)paren
suffix:semicolon
id|mpd.hd.dev_par
op_assign
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|devtype
op_amp
l_int|2
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
suffix:semicolon
id|mpd.hd.bd_length
op_assign
r_sizeof
(paren
id|mpd.bd
)paren
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|0
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x00ff0000
)paren
op_rshift
l_int|16
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|1
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|mpd.bd.block_length
(braket
l_int|2
)braket
op_assign
(paren
id|SECTOR_SIZE
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|hanum
comma
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|mpd
comma
r_sizeof
(paren
id|gdth_modep_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_CAPACITY
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Read capacity hdrive %d&bslash;n&quot;
comma
id|t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|size
OG
(paren
id|ulong64
)paren
l_int|0xffffffff
)paren
id|rdc.last_block_no
op_assign
l_int|0xffffffff
suffix:semicolon
r_else
id|rdc.last_block_no
op_assign
id|cpu_to_be32
c_func
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|size
op_minus
l_int|1
)paren
suffix:semicolon
id|rdc.block_length
op_assign
id|cpu_to_be32
c_func
(paren
id|SECTOR_SIZE
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|hanum
comma
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|rdc
comma
r_sizeof
(paren
id|gdth_rdcap_data
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_case
id|SERVICE_ACTION_IN
suffix:colon
r_if
c_cond
(paren
(paren
id|scp-&gt;cmnd
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
op_eq
id|SAI_READ_CAPACITY_16
op_logical_and
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
)paren
(brace
id|gdth_rdcap16_data
id|rdc16
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Read capacity (16) hdrive %d&bslash;n&quot;
comma
id|t
)paren
)paren
suffix:semicolon
id|rdc16.last_block_no
op_assign
id|cpu_to_be64
c_func
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|size
op_minus
l_int|1
)paren
suffix:semicolon
id|rdc16.block_length
op_assign
id|cpu_to_be32
c_func
(paren
id|SECTOR_SIZE
)paren
suffix:semicolon
id|gdth_copy_internal_data
c_func
(paren
id|hanum
comma
id|scp
comma
(paren
r_char
op_star
)paren
op_amp
id|rdc16
comma
r_sizeof
(paren
id|gdth_rdcap16_data
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;result
op_assign
id|DID_ABORT
op_lshift
l_int|16
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Internal cache cmd 0x%x unknown&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|scp-&gt;SCp.have_data_in
)paren
id|scp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_fill_cache_cmd
r_static
r_int
id|gdth_fill_cache_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|ushort
id|hdrive
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|ulong32
id|cnt
comma
id|blockcnt
suffix:semicolon
id|ulong64
id|no
comma
id|blockno
suffix:semicolon
id|dma_addr_t
id|phys_addr
suffix:semicolon
r_int
id|i
comma
id|cmd_index
comma
id|read_write
comma
id|sgcnt
comma
id|mode64
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
r_struct
id|page
op_star
id|page
suffix:semicolon
id|ulong
id|offset
suffix:semicolon
macro_line|#endif
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_fill_cache_cmd() cmd 0x%x cmdsize %d hdrive %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|scp-&gt;cmd_len
comma
id|hdrive
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|mode64
op_assign
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
multiline_comment|/* test for READ_16, WRITE_16 if !mode64 ? ---&n;       not required, should not occur due to error return on &n;       READ_CAPACITY_16 */
id|cmdp-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* fill command */
id|read_write
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_ne
op_minus
l_int|1
)paren
id|cmdp-&gt;OpCode
op_assign
id|scp-&gt;SCp.sent_command
suffix:semicolon
multiline_comment|/* special cache cmd. */
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|RESERVE
)paren
id|cmdp-&gt;OpCode
op_assign
id|GDT_RESERVE_DRV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|RELEASE
)paren
id|cmdp-&gt;OpCode
op_assign
id|GDT_RELEASE_DRV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|ALLOW_MEDIUM_REMOVAL
)paren
(brace
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|4
)braket
op_amp
l_int|1
)paren
multiline_comment|/* prevent ? */
id|cmdp-&gt;OpCode
op_assign
id|GDT_MOUNT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|3
)braket
op_amp
l_int|1
)paren
multiline_comment|/* removable drive ? */
id|cmdp-&gt;OpCode
op_assign
id|GDT_UNMOUNT
suffix:semicolon
r_else
id|cmdp-&gt;OpCode
op_assign
id|GDT_FLUSH
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_6
op_logical_or
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_10
op_logical_or
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_12
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
op_logical_or
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|WRITE_16
macro_line|#endif
)paren
(brace
id|read_write
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|gdth_write_through
op_logical_or
(paren
(paren
id|ha-&gt;hdr
(braket
id|hdrive
)braket
dot
id|rw_attribs
op_amp
l_int|1
)paren
op_logical_and
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_WR_THROUGH
)paren
)paren
)paren
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE_THR
suffix:semicolon
r_else
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
)brace
r_else
(brace
id|read_write
op_assign
l_int|2
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
)brace
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.cache64.DeviceNo
op_assign
id|hdrive
suffix:semicolon
id|cmdp-&gt;u.cache64.BlockNo
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache.DeviceNo
op_assign
id|hdrive
suffix:semicolon
id|cmdp-&gt;u.cache.BlockNo
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|read_write
)paren
(brace
r_if
c_cond
(paren
id|scp-&gt;cmd_len
op_eq
l_int|16
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|no
comma
op_amp
id|scp-&gt;cmnd
(braket
l_int|2
)braket
comma
r_sizeof
(paren
id|ulong64
)paren
)paren
suffix:semicolon
id|blockno
op_assign
id|be64_to_cpu
c_func
(paren
id|no
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cnt
comma
op_amp
id|scp-&gt;cmnd
(braket
l_int|10
)braket
comma
r_sizeof
(paren
id|ulong32
)paren
)paren
suffix:semicolon
id|blockcnt
op_assign
id|be32_to_cpu
c_func
(paren
id|cnt
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;cmd_len
op_eq
l_int|10
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|no
comma
op_amp
id|scp-&gt;cmnd
(braket
l_int|2
)braket
comma
r_sizeof
(paren
id|ulong32
)paren
)paren
suffix:semicolon
id|blockno
op_assign
id|be32_to_cpu
c_func
(paren
id|no
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cnt
comma
op_amp
id|scp-&gt;cmnd
(braket
l_int|7
)braket
comma
r_sizeof
(paren
id|ushort
)paren
)paren
suffix:semicolon
id|blockcnt
op_assign
id|be16_to_cpu
c_func
(paren
id|cnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|no
comma
op_amp
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|ulong32
)paren
)paren
suffix:semicolon
id|blockno
op_assign
id|be32_to_cpu
c_func
(paren
id|no
)paren
op_amp
l_int|0x001fffffUL
suffix:semicolon
id|blockcnt
op_assign
id|scp-&gt;cmnd
(braket
l_int|4
)braket
op_eq
l_int|0
ques
c_cond
l_int|0x100
suffix:colon
id|scp-&gt;cmnd
(braket
l_int|4
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.cache64.BlockNo
op_assign
id|blockno
suffix:semicolon
id|cmdp-&gt;u.cache64.BlockCnt
op_assign
id|blockcnt
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache.BlockNo
op_assign
(paren
id|ulong32
)paren
id|blockno
suffix:semicolon
id|cmdp-&gt;u.cache.BlockCnt
op_assign
id|blockcnt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
id|sgcnt
op_assign
id|scp-&gt;use_sg
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
id|scp-&gt;SCp.Status
op_assign
id|GDTH_MAP_SG
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
(paren
id|read_write
op_eq
l_int|1
ques
c_cond
id|PCI_DMA_TODEVICE
suffix:colon
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|sgcnt
op_assign
id|pci_map_sg
c_func
(paren
id|ha-&gt;pdev
comma
id|sl
comma
id|scp-&gt;use_sg
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.cache64.DestAddr
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_canz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.cache64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|sg_dma_address
c_func
(paren
id|sl
)paren
suffix:semicolon
macro_line|#ifdef GDTH_DMA_STATISTICS
r_if
c_cond
(paren
id|cmdp-&gt;u.cache64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
OG
(paren
id|ulong64
)paren
l_int|0xffffffff
)paren
id|ha-&gt;dma64_cnt
op_increment
suffix:semicolon
r_else
id|ha-&gt;dma32_cnt
op_increment
suffix:semicolon
macro_line|#endif
id|cmdp-&gt;u.cache64.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
id|sg_dma_len
c_func
(paren
id|sl
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|sg_dma_address
c_func
(paren
id|sl
)paren
suffix:semicolon
macro_line|#ifdef GDTH_DMA_STATISTICS
id|ha-&gt;dma32_cnt
op_increment
suffix:semicolon
macro_line|#endif
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
id|sg_dma_len
c_func
(paren
id|sl
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.cache64.DestAddr
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_canz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.cache64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong32
)paren
id|sl-&gt;length
suffix:semicolon
)brace
)brace
r_else
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong32
)paren
id|sl-&gt;length
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef GDTH_STATISTICS
r_if
c_cond
(paren
id|max_sg
OL
(paren
id|ulong32
)paren
id|sgcnt
)paren
(brace
id|max_sg
op_assign
(paren
id|ulong32
)paren
id|sgcnt
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_sg = %d&bslash;n&quot;
comma
id|max_sg
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
id|scp-&gt;SCp.Status
op_assign
id|GDTH_MAP_SINGLE
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
(paren
id|read_write
op_eq
l_int|1
ques
c_cond
id|PCI_DMA_TODEVICE
suffix:colon
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|page
op_assign
id|virt_to_page
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|ulong
)paren
id|scp-&gt;request_buffer
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|phys_addr
op_assign
id|pci_map_page
c_func
(paren
id|ha-&gt;pdev
comma
id|page
comma
id|offset
comma
id|scp-&gt;request_bufflen
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
id|scp-&gt;SCp.dma_handle
op_assign
id|phys_addr
suffix:semicolon
macro_line|#else
id|phys_addr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|mode64
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.cache64.DestAddr
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_canz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache64.DestAddr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.cache64.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.cache.DestAddr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* evaluate command size, check space */
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: addr. %x sganz %x sgptr0 %x sglen0 %x&bslash;n&quot;
comma
id|cmdp-&gt;u.cache64.DestAddr
comma
id|cmdp-&gt;u.cache64.sg_canz
comma
id|cmdp-&gt;u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: cmd %d blockno. %d, blockcnt %d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.cache64.BlockNo
comma
id|cmdp-&gt;u.cache64.BlockCnt
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache64.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.cache64.sg_canz
op_star
r_sizeof
(paren
id|gdth_sg64_str
)paren
suffix:semicolon
)brace
r_else
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: addr. %x sganz %x sgptr0 %x sglen0 %x&bslash;n&quot;
comma
id|cmdp-&gt;u.cache.DestAddr
comma
id|cmdp-&gt;u.cache.sg_canz
comma
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;cache cmd: cmd %d blockno. %d, blockcnt %d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.cache.BlockNo
comma
id|cmdp-&gt;u.cache.BlockCnt
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.cache.sg_canz
op_star
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_fill_cache() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
DECL|function|gdth_fill_raw_cmd
r_static
r_int
id|gdth_fill_raw_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
comma
id|unchar
id|b
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sl
suffix:semicolon
id|ushort
id|i
suffix:semicolon
id|dma_addr_t
id|phys_addr
comma
id|sense_paddr
suffix:semicolon
r_int
id|cmd_index
comma
id|sgcnt
comma
id|mode64
suffix:semicolon
id|unchar
id|t
comma
id|l
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
r_struct
id|page
op_star
id|page
suffix:semicolon
id|ulong
id|offset
suffix:semicolon
macro_line|#endif
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
id|l
op_assign
id|scp-&gt;device-&gt;lun
suffix:semicolon
macro_line|#else
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
id|l
op_assign
id|scp-&gt;lun
suffix:semicolon
macro_line|#endif
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_fill_raw_cmd() cmd 0x%x bus %d ID %d LUN %d&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
comma
id|b
comma
id|t
comma
id|l
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|mode64
op_assign
(paren
id|ha-&gt;raw_feat
op_amp
id|GDT_64BIT
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCSIRAWSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* fill command */
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_ne
op_minus
l_int|1
)paren
(brace
id|cmdp-&gt;OpCode
op_assign
id|scp-&gt;SCp.sent_command
suffix:semicolon
multiline_comment|/* special raw cmd. */
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.raw64.direction
op_assign
(paren
id|scp-&gt;SCp.phase
op_rshift
l_int|8
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;special raw cmd 0x%x param 0x%x&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.raw64.direction
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw64.sg_lst
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.raw.direction
op_assign
(paren
id|scp-&gt;SCp.phase
op_rshift
l_int|8
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;special raw cmd 0x%x param 0x%x&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
comma
id|cmdp-&gt;u.raw.direction
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw.sg_lst
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
id|page
op_assign
id|virt_to_page
c_func
(paren
id|scp-&gt;sense_buffer
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|ulong
)paren
id|scp-&gt;sense_buffer
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|sense_paddr
op_assign
id|pci_map_page
c_func
(paren
id|ha-&gt;pdev
comma
id|page
comma
id|offset
comma
l_int|16
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|scp-&gt;SCp.buffer
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
(paren
(paren
id|ulong32
)paren
id|sense_paddr
)paren
suffix:semicolon
multiline_comment|/* high part, if 64bit */
id|scp-&gt;host_scribble
op_assign
(paren
r_char
op_star
)paren
(paren
id|ulong32
)paren
(paren
(paren
id|ulong64
)paren
id|sense_paddr
op_rshift
l_int|32
)paren
suffix:semicolon
macro_line|#else
id|sense_paddr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;sense_buffer
)paren
suffix:semicolon
macro_line|#endif
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
multiline_comment|/* always */
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.raw64.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw64.mdisc_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw64.mcon_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw64.clen
op_assign
id|scp-&gt;cmd_len
suffix:semicolon
id|cmdp-&gt;u.raw64.target
op_assign
id|t
suffix:semicolon
id|cmdp-&gt;u.raw64.lun
op_assign
id|l
suffix:semicolon
id|cmdp-&gt;u.raw64.bus
op_assign
id|b
suffix:semicolon
id|cmdp-&gt;u.raw64.priority
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw64.sdlen
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw64.sense_len
op_assign
l_int|16
suffix:semicolon
id|cmdp-&gt;u.raw64.sense_data
op_assign
id|sense_paddr
suffix:semicolon
id|cmdp-&gt;u.raw64.direction
op_assign
id|gdth_direction_tab
(braket
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)braket
op_eq
id|DOU
ques
c_cond
id|GDTH_DATA_OUT
suffix:colon
id|GDTH_DATA_IN
suffix:semicolon
id|memcpy
c_func
(paren
id|cmdp-&gt;u.raw64.cmd
comma
id|scp-&gt;cmnd
comma
l_int|16
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.raw.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.mdisc_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.mcon_time
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.clen
op_assign
id|scp-&gt;cmd_len
suffix:semicolon
id|cmdp-&gt;u.raw.target
op_assign
id|t
suffix:semicolon
id|cmdp-&gt;u.raw.lun
op_assign
id|l
suffix:semicolon
id|cmdp-&gt;u.raw.bus
op_assign
id|b
suffix:semicolon
id|cmdp-&gt;u.raw.priority
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.link_p
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.raw.sdlen
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw.sense_len
op_assign
l_int|16
suffix:semicolon
id|cmdp-&gt;u.raw.sense_data
op_assign
id|sense_paddr
suffix:semicolon
id|cmdp-&gt;u.raw.direction
op_assign
id|gdth_direction_tab
(braket
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)braket
op_eq
id|DOU
ques
c_cond
id|GDTH_DATA_OUT
suffix:colon
id|GDTH_DATA_IN
suffix:semicolon
id|memcpy
c_func
(paren
id|cmdp-&gt;u.raw.cmd
comma
id|scp-&gt;cmnd
comma
l_int|12
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scp-&gt;use_sg
)paren
(brace
id|sl
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
id|sgcnt
op_assign
id|scp-&gt;use_sg
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
id|scp-&gt;SCp.Status
op_assign
id|GDTH_MAP_SG
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
id|PCI_DMA_BIDIRECTIONAL
suffix:semicolon
id|sgcnt
op_assign
id|pci_map_sg
c_func
(paren
id|ha-&gt;pdev
comma
id|sl
comma
id|scp-&gt;use_sg
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.raw64.sdata
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_ranz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.raw64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|sg_dma_address
c_func
(paren
id|sl
)paren
suffix:semicolon
macro_line|#ifdef GDTH_DMA_STATISTICS
r_if
c_cond
(paren
id|cmdp-&gt;u.raw64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
OG
(paren
id|ulong64
)paren
l_int|0xffffffff
)paren
id|ha-&gt;dma64_cnt
op_increment
suffix:semicolon
r_else
id|ha-&gt;dma32_cnt
op_increment
suffix:semicolon
macro_line|#endif
id|cmdp-&gt;u.raw64.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
id|sg_dma_len
c_func
(paren
id|sl
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|sg_dma_address
c_func
(paren
id|sl
)paren
suffix:semicolon
macro_line|#ifdef GDTH_DMA_STATISTICS
id|ha-&gt;dma32_cnt
op_increment
suffix:semicolon
macro_line|#endif
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
id|sg_dma_len
c_func
(paren
id|sl
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|cmdp-&gt;u.raw64.sdata
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_ranz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.raw64.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong32
)paren
id|sl-&gt;length
suffix:semicolon
)brace
)brace
r_else
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
id|sgcnt
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sgcnt
suffix:semicolon
op_increment
id|i
comma
op_increment
id|sl
)paren
(brace
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_ptr
op_assign
id|virt_to_bus
c_func
(paren
id|sl-&gt;address
)paren
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
id|i
)braket
dot
id|sg_len
op_assign
(paren
id|ulong32
)paren
id|sl-&gt;length
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef GDTH_STATISTICS
r_if
c_cond
(paren
id|max_sg
OL
id|sgcnt
)paren
(brace
id|max_sg
op_assign
id|sgcnt
suffix:semicolon
id|TRACE3
c_func
(paren
(paren
l_string|&quot;GDT: max_sg = %d&bslash;n&quot;
comma
id|sgcnt
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
id|scp-&gt;SCp.Status
op_assign
id|GDTH_MAP_SINGLE
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
id|PCI_DMA_BIDIRECTIONAL
suffix:semicolon
id|page
op_assign
id|virt_to_page
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|ulong
)paren
id|scp-&gt;request_buffer
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|phys_addr
op_assign
id|pci_map_page
c_func
(paren
id|ha-&gt;pdev
comma
id|page
comma
id|offset
comma
id|scp-&gt;request_bufflen
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
id|scp-&gt;SCp.dma_handle
op_assign
id|phys_addr
suffix:semicolon
macro_line|#else
id|phys_addr
op_assign
id|virt_to_bus
c_func
(paren
id|scp-&gt;request_buffer
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|mode64
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.raw64.sdata
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_ranz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.raw64.sdata
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.raw64.sg_ranz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
l_int|0xffffffff
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
l_int|1
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|cmdp-&gt;u.raw.sdata
op_assign
id|phys_addr
suffix:semicolon
id|cmdp-&gt;u.raw.sg_ranz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|mode64
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;raw cmd: addr. %x sganz %x sgptr0 %x sglen0 %x&bslash;n&quot;
comma
id|cmdp-&gt;u.raw64.sdata
comma
id|cmdp-&gt;u.raw64.sg_ranz
comma
id|cmdp-&gt;u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw64.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.raw64.sg_ranz
op_star
r_sizeof
(paren
id|gdth_sg64_str
)paren
suffix:semicolon
)brace
r_else
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;raw cmd: addr. %x sganz %x sgptr0 %x sglen0 %x&bslash;n&quot;
comma
id|cmdp-&gt;u.raw.sdata
comma
id|cmdp-&gt;u.raw.sg_ranz
comma
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
comma
id|cmdp-&gt;u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
)paren
)paren
suffix:semicolon
multiline_comment|/* evaluate command size */
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw.sg_lst
)paren
op_plus
(paren
id|ushort
)paren
id|cmdp-&gt;u.raw.sg_ranz
op_star
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* check space */
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_fill_raw() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
DECL|function|gdth_special_cmd
r_static
r_int
id|gdth_special_cmd
c_func
(paren
r_int
id|hanum
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_register
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_special_cmd(): &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
op_logical_and
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|cmdp
comma
id|scp-&gt;request_buffer
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|scp
suffix:semicolon
multiline_comment|/* search free command index */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
)paren
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;GDT: No free command index found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if it&squot;s the first command, set command semaphore */
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
op_eq
l_int|0
)paren
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
multiline_comment|/* evaluate command size, check space */
r_if
c_cond
(paren
id|cmdp-&gt;OpCode
op_eq
id|GDT_IOCTL
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;IOCTL&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.ioctl.p_param
)paren
op_plus
r_sizeof
(paren
id|ulong64
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmdp-&gt;Service
op_eq
id|CACHESERVICE
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;cache command %d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache64.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg64_str
)paren
suffix:semicolon
r_else
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.cache.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmdp-&gt;Service
op_eq
id|SCSIRAWSERVICE
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;raw command %d&bslash;n&quot;
comma
id|cmdp-&gt;OpCode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|GDT_64BIT
)paren
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw64.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg64_str
)paren
suffix:semicolon
r_else
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.raw.sg_lst
)paren
op_plus
r_sizeof
(paren
id|gdth_sg_str
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
id|ha-&gt;cmd_len
op_add_assign
(paren
l_int|4
op_minus
(paren
id|ha-&gt;cmd_len
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cmd_cnt
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ha-&gt;cmd_offs_dpmem
op_plus
id|ha-&gt;cmd_len
op_plus
id|DPMEM_COMMAND_OFFSET
)paren
OG
id|ha-&gt;ic_all_size
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_special_cmd() DPMEM overflow&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;cmd_tab
(braket
id|cmd_index
op_minus
l_int|2
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* copy command */
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
id|cmd_index
suffix:semicolon
)brace
multiline_comment|/* Controller event handling functions */
DECL|function|gdth_store_event
r_static
id|gdth_evt_str
op_star
id|gdth_store_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
id|ushort
id|source
comma
id|ushort
id|idx
comma
id|gdth_evt_data
op_star
id|evt
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
r_struct
id|timeval
id|tv
suffix:semicolon
multiline_comment|/* no GDTH_LOCK_HA() ! */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_store_event() source %d idx %d&bslash;n&quot;
comma
id|source
comma
id|idx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|source
op_eq
l_int|0
)paren
multiline_comment|/* no source -&gt; no event */
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_source
op_eq
id|source
op_logical_and
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_idx
op_eq
id|idx
op_logical_and
(paren
(paren
id|evt-&gt;size
op_ne
l_int|0
op_logical_and
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_data.size
op_ne
l_int|0
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_data.eu
comma
(paren
r_char
op_star
)paren
op_amp
id|evt-&gt;eu
comma
id|evt-&gt;size
)paren
)paren
op_logical_or
(paren
id|evt-&gt;size
op_eq
l_int|0
op_logical_and
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_data.size
op_eq
l_int|0
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_data.event_string
comma
(paren
r_char
op_star
)paren
op_amp
id|evt-&gt;event_string
)paren
)paren
)paren
)paren
(brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|elastidx
)braket
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|e-&gt;last_stamp
op_assign
id|tv.tv_sec
suffix:semicolon
op_increment
id|e-&gt;same_count
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ebuffer
(braket
id|elastidx
)braket
dot
id|event_source
op_ne
l_int|0
)paren
(brace
multiline_comment|/* entry not free ? */
op_increment
id|elastidx
suffix:semicolon
r_if
c_cond
(paren
id|elastidx
op_eq
id|MAX_EVENTS
)paren
id|elastidx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|elastidx
op_eq
id|eoldidx
)paren
(brace
multiline_comment|/* reached mark ? */
op_increment
id|eoldidx
suffix:semicolon
r_if
c_cond
(paren
id|eoldidx
op_eq
id|MAX_EVENTS
)paren
id|eoldidx
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|elastidx
)braket
suffix:semicolon
id|e-&gt;event_source
op_assign
id|source
suffix:semicolon
id|e-&gt;event_idx
op_assign
id|idx
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|e-&gt;first_stamp
op_assign
id|e-&gt;last_stamp
op_assign
id|tv.tv_sec
suffix:semicolon
id|e-&gt;same_count
op_assign
l_int|1
suffix:semicolon
id|e-&gt;event_data
op_assign
op_star
id|evt
suffix:semicolon
id|e-&gt;application
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|e
suffix:semicolon
)brace
DECL|function|gdth_read_event
r_static
r_int
id|gdth_read_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
r_int
id|handle
comma
id|gdth_evt_str
op_star
id|estr
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
r_int
id|eindex
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_read_event() handle %d&bslash;n&quot;
comma
id|handle
)paren
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handle
op_eq
op_minus
l_int|1
)paren
id|eindex
op_assign
id|eoldidx
suffix:semicolon
r_else
id|eindex
op_assign
id|handle
suffix:semicolon
id|estr-&gt;event_source
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|eindex
op_ge
id|MAX_EVENTS
)paren
(brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_return
id|eindex
suffix:semicolon
)brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|eindex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;event_source
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|eindex
op_ne
id|elastidx
)paren
(brace
r_if
c_cond
(paren
op_increment
id|eindex
op_eq
id|MAX_EVENTS
)paren
id|eindex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|eindex
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|estr
comma
id|e
comma
r_sizeof
(paren
id|gdth_evt_str
)paren
)paren
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_return
id|eindex
suffix:semicolon
)brace
DECL|function|gdth_readapp_event
r_static
r_void
id|gdth_readapp_event
c_func
(paren
id|gdth_ha_str
op_star
id|ha
comma
id|unchar
id|application
comma
id|gdth_evt_str
op_star
id|estr
)paren
(brace
id|gdth_evt_str
op_star
id|e
suffix:semicolon
r_int
id|eindex
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|unchar
id|found
op_assign
id|FALSE
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_readapp_event() app. %d&bslash;n&quot;
comma
id|application
)paren
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|eindex
op_assign
id|eoldidx
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|e
op_assign
op_amp
id|ebuffer
(braket
id|eindex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;event_source
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|e-&gt;application
op_amp
id|application
)paren
op_eq
l_int|0
)paren
(brace
id|e-&gt;application
op_or_assign
id|application
suffix:semicolon
id|found
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eindex
op_eq
id|elastidx
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|eindex
op_eq
id|MAX_EVENTS
)paren
id|eindex
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
id|memcpy
c_func
(paren
id|estr
comma
id|e
comma
r_sizeof
(paren
id|gdth_evt_str
)paren
)paren
suffix:semicolon
r_else
id|estr-&gt;event_source
op_assign
l_int|0
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|gdth_clear_events
r_static
r_void
id|gdth_clear_events
c_func
(paren
r_void
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_clear_events()&quot;
)paren
)paren
suffix:semicolon
id|eoldidx
op_assign
id|elastidx
op_assign
l_int|0
suffix:semicolon
id|ebuffer
(braket
l_int|0
)braket
dot
id|event_source
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SCSI interface functions */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|function|gdth_interrupt
r_static
id|irqreturn_t
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
macro_line|#else
r_static
r_void
id|gdth_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
macro_line|#endif
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdt6m_dpram_str
id|__iomem
op_star
id|dp6m_ptr
op_assign
l_int|NULL
suffix:semicolon
id|gdt6_dpram_str
id|__iomem
op_star
id|dp6_ptr
suffix:semicolon
id|gdt2_dpram_str
id|__iomem
op_star
id|dp2_ptr
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
r_int
id|hanum
comma
id|rval
comma
id|i
suffix:semicolon
id|unchar
id|IStatus
suffix:semicolon
id|ushort
id|Service
suffix:semicolon
id|ulong
id|flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef INT_COAL
r_int
id|coalesced
op_assign
id|FALSE
suffix:semicolon
r_int
id|next
op_assign
id|FALSE
suffix:semicolon
id|gdth_coal_status
op_star
id|pcs
op_assign
l_int|NULL
suffix:semicolon
r_int
id|act_int_coal
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() IRQ %d&bslash;n&quot;
comma
id|irq
)paren
)paren
suffix:semicolon
multiline_comment|/* if polling and not from gdth_wait() -&gt; return */
r_if
c_cond
(paren
id|gdth_polling
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_from_wait
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_LOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
id|wait_index
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* search controller */
r_if
c_cond
(paren
(paren
id|hanum
op_assign
id|gdth_get_status
c_func
(paren
op_amp
id|IStatus
comma
id|irq
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* spurious interrupt */
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
op_increment
id|act_ints
suffix:semicolon
macro_line|#endif
macro_line|#ifdef INT_COAL
multiline_comment|/* See if the fw is returning coalesced status */
r_if
c_cond
(paren
id|IStatus
op_eq
id|COALINDEX
)paren
(brace
multiline_comment|/* Coalesced status.  Setup the initial status &n;           buffer pointer and flags */
id|pcs
op_assign
id|ha-&gt;coal_stat
suffix:semicolon
id|coalesced
op_assign
id|TRUE
suffix:semicolon
id|next
op_assign
id|TRUE
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
id|coalesced
)paren
(brace
multiline_comment|/* For coalesced requests all status&n;               information is found in the status buffer */
id|IStatus
op_assign
(paren
id|unchar
)paren
(paren
id|pcs-&gt;status
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|ha-&gt;status
op_assign
id|inw
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|8
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* no error */
id|ha-&gt;status
op_assign
id|S_OK
suffix:semicolon
id|ha-&gt;info
op_assign
id|inl
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|12
)paren
suffix:semicolon
id|ha-&gt;service
op_assign
id|inw
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|10
)paren
suffix:semicolon
id|ha-&gt;info2
op_assign
id|inl
c_func
(paren
id|ha-&gt;bmic
op_plus
id|MAILBOXREG
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ha-&gt;bmic
op_plus
id|EDOORREG
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|outb
c_func
(paren
l_int|0x00
comma
id|ha-&gt;bmic
op_plus
id|SEMA1REG
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
id|dp2_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|ha-&gt;status
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* no error */
id|ha-&gt;status
op_assign
id|S_OK
suffix:semicolon
id|ha-&gt;info
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ha-&gt;service
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Service
)paren
suffix:semicolon
id|ha-&gt;info2
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp2_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp2_ptr-&gt;io.irqdel
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
multiline_comment|/* reset command index */
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp2_ptr-&gt;io.Sema1
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
id|dp6_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|ha-&gt;status
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* no error */
id|ha-&gt;status
op_assign
id|S_OK
suffix:semicolon
id|ha-&gt;info
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ha-&gt;service
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Service
)paren
suffix:semicolon
id|ha-&gt;info2
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp6_ptr-&gt;u.ic.Info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6_ptr-&gt;io.irqdel
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;u.ic.Cmd_Index
)paren
suffix:semicolon
multiline_comment|/* reset command index */
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6_ptr-&gt;io.Sema1
)paren
suffix:semicolon
multiline_comment|/* reset status semaphore */
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCINEW
)paren
(brace
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|ha-&gt;status
op_assign
id|inw
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;status
)paren
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_else
id|ha-&gt;status
op_assign
id|S_OK
suffix:semicolon
id|ha-&gt;info
op_assign
id|inl
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;info
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|ha-&gt;service
op_assign
id|inw
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;service
)paren
)paren
suffix:semicolon
id|ha-&gt;info2
op_assign
id|inl
c_func
(paren
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;info
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;edoor_reg
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PTR2USHORT
c_func
(paren
op_amp
id|ha-&gt;plx-&gt;sema1_reg
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
)paren
(brace
id|dp6m_ptr
op_assign
id|ha-&gt;brd
suffix:semicolon
r_if
c_cond
(paren
id|IStatus
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* error flag */
id|IStatus
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|coalesced
)paren
id|ha-&gt;status
op_assign
id|pcs-&gt;ext_status
op_logical_and
l_int|0xffff
suffix:semicolon
r_else
macro_line|#endif
id|ha-&gt;status
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.status
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() error %d/%d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* no error */
id|ha-&gt;status
op_assign
id|S_OK
suffix:semicolon
macro_line|#ifdef INT_COAL
multiline_comment|/* get information */
r_if
c_cond
(paren
id|coalesced
)paren
(brace
id|ha-&gt;info
op_assign
id|pcs-&gt;info0
suffix:semicolon
id|ha-&gt;info2
op_assign
id|pcs-&gt;info1
suffix:semicolon
id|ha-&gt;service
op_assign
(paren
id|pcs-&gt;ext_status
op_rshift
l_int|16
)paren
op_logical_and
l_int|0xffff
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|ha-&gt;info
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.info
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ha-&gt;service
op_assign
id|gdth_readw
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.service
)paren
suffix:semicolon
id|ha-&gt;info2
op_assign
id|gdth_readl
c_func
(paren
op_amp
id|dp6m_ptr-&gt;i960r.info
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* event string */
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;service
op_ne
id|SCREENSERVICE
op_logical_and
(paren
id|ha-&gt;fw_vers
op_amp
l_int|0xff
)paren
op_ge
l_int|0x1a
)paren
(brace
id|ha-&gt;dvr.severity
op_assign
id|gdth_readb
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.severity
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ha-&gt;dvr.event_string
(braket
id|i
)braket
op_assign
id|gdth_readb
(paren
op_amp
(paren
(paren
id|gdt6m_dpram_str
id|__iomem
op_star
)paren
id|ha-&gt;brd
)paren
op_member_access_from_pointer
id|i960r.evt_str
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;dvr.event_string
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef INT_COAL
multiline_comment|/* Make sure that non coalesced interrupts get cleared&n;               before being handled by gdth_async_event/gdth_sync_event */
r_if
c_cond
(paren
op_logical_neg
id|coalesced
)paren
macro_line|#endif                          
(brace
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;i960r.sema1_reg
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() unknown controller type&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() index %d stat %d info %d&bslash;n&quot;
comma
id|IStatus
comma
id|ha-&gt;status
comma
id|ha-&gt;info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_from_wait
)paren
(brace
id|wait_hanum
op_assign
id|hanum
suffix:semicolon
id|wait_index
op_assign
(paren
r_int
)paren
id|IStatus
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IStatus
op_eq
id|ASYNCINDEX
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() async. event&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_async_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
id|gdth_next
c_func
(paren
id|hanum
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|IStatus
op_eq
id|SPEZINDEX
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Service unknown or not initialized !&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha-&gt;dvr.size
op_assign
r_sizeof
(paren
id|ha-&gt;dvr.eu.driver
)paren
suffix:semicolon
id|ha-&gt;dvr.eu.driver.ionode
op_assign
id|hanum
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ha
comma
id|ES_DRIVER
comma
l_int|4
comma
op_amp
id|ha-&gt;dvr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
id|scp
op_assign
id|ha-&gt;cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
dot
id|cmnd
suffix:semicolon
id|Service
op_assign
id|ha-&gt;cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
dot
id|service
suffix:semicolon
id|ha-&gt;cmd_tab
(braket
id|IStatus
op_minus
l_int|2
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
r_if
c_cond
(paren
id|scp
op_eq
id|UNUSED_CMND
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() index to unused command (%d)&bslash;n&quot;
comma
id|IStatus
)paren
)paren
suffix:semicolon
id|ha-&gt;dvr.size
op_assign
r_sizeof
(paren
id|ha-&gt;dvr.eu.driver
)paren
suffix:semicolon
id|ha-&gt;dvr.eu.driver.ionode
op_assign
id|hanum
suffix:semicolon
id|ha-&gt;dvr.eu.driver.index
op_assign
id|IStatus
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ha
comma
id|ES_DRIVER
comma
l_int|1
comma
op_amp
id|ha-&gt;dvr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|scp
op_eq
id|INTERNAL_CMND
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() answer to internal command&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_interrupt() sync. status&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|rval
op_assign
id|gdth_sync_event
c_func
(paren
id|hanum
comma
id|Service
comma
id|IStatus
comma
id|scp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_polling
)paren
id|GDTH_UNLOCK_HA
c_func
(paren
(paren
id|gdth_ha_str
op_star
)paren
id|dev_id
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rval
op_eq
l_int|2
)paren
(brace
id|gdth_putq
c_func
(paren
id|hanum
comma
id|scp
comma
id|scp-&gt;SCp.this_residual
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rval
op_eq
l_int|1
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|GDTH_LOCK_SCSI_DONE
c_func
(paren
id|scp-&gt;device-&gt;host
comma
id|flags
)paren
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
id|GDTH_UNLOCK_SCSI_DONE
c_func
(paren
id|scp-&gt;device-&gt;host
comma
id|flags
)paren
suffix:semicolon
macro_line|#else
id|GDTH_LOCK_SCSI_DONE
c_func
(paren
id|flags
)paren
suffix:semicolon
id|scp
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|scp
)paren
suffix:semicolon
id|GDTH_UNLOCK_SCSI_DONE
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|coalesced
)paren
(brace
multiline_comment|/* go to the next status in the status buffer */
op_increment
id|pcs
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
op_increment
id|act_int_coal
suffix:semicolon
r_if
c_cond
(paren
id|act_int_coal
OG
id|max_int_coal
)paren
(brace
id|max_int_coal
op_assign
id|act_int_coal
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT: max_int_coal = %d&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|max_int_coal
)paren
suffix:semicolon
)brace
macro_line|#endif      
multiline_comment|/* see if there is another status */
r_if
c_cond
(paren
id|pcs-&gt;status
op_eq
l_int|0
)paren
multiline_comment|/* Stop the coalesce loop */
id|next
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|next
)paren
suffix:semicolon
multiline_comment|/* coalescing only for new GDT_PCIMPR controllers available */
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
op_logical_and
id|coalesced
)paren
(brace
id|gdth_writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|dp6m_ptr-&gt;i960r.edoor_reg
)paren
suffix:semicolon
id|gdth_writeb
c_func
(paren
l_int|0
comma
op_amp
id|dp6m_ptr-&gt;i960r.sema1_reg
)paren
suffix:semicolon
)brace
macro_line|#endif
id|gdth_next
c_func
(paren
id|hanum
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_return
id|IRQ_HANDLED
suffix:semicolon
macro_line|#endif
)brace
DECL|function|gdth_sync_event
r_static
r_int
id|gdth_sync_event
c_func
(paren
r_int
id|hanum
comma
r_int
id|service
comma
id|unchar
id|index
comma
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
r_register
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_msg_str
op_star
id|msg
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
id|unchar
id|b
comma
id|t
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_sync_event() serv %d status %d&bslash;n&quot;
comma
id|service
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|service
op_eq
id|SCREENSERVICE
)paren
(brace
id|msg
op_assign
id|ha-&gt;pmsg
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;len: %d, answer: %d, ext: %d, alen: %d&bslash;n&quot;
comma
id|msg-&gt;msg_len
comma
id|msg-&gt;msg_answer
comma
id|msg-&gt;msg_ext
comma
id|msg-&gt;msg_alen
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_len
OG
id|MSGLEN
op_plus
l_int|1
)paren
id|msg-&gt;msg_len
op_assign
id|MSGLEN
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_len
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|msg-&gt;msg_answer
op_logical_and
id|msg-&gt;msg_ext
)paren
)paren
(brace
id|msg-&gt;msg_text
(braket
id|msg-&gt;msg_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|msg-&gt;msg_text
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;msg_ext
op_logical_and
op_logical_neg
id|msg-&gt;msg_answer
)paren
(brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_handle
op_assign
id|msg-&gt;msg_handle
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_addr
op_assign
id|ha-&gt;msg_phys
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.su.msg.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong64
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;msg_answer
op_logical_and
id|msg-&gt;msg_alen
)paren
(brace
multiline_comment|/* default answers (getchar() not possible) */
r_if
c_cond
(paren
id|msg-&gt;msg_alen
op_eq
l_int|1
)paren
(brace
id|msg-&gt;msg_alen
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;msg_len
op_assign
l_int|1
suffix:semicolon
id|msg-&gt;msg_text
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|msg-&gt;msg_alen
op_sub_assign
l_int|2
suffix:semicolon
id|msg-&gt;msg_len
op_assign
l_int|2
suffix:semicolon
id|msg-&gt;msg_text
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|msg-&gt;msg_text
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|msg-&gt;msg_ext
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;msg_answer
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_WRITE
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_handle
op_assign
id|msg-&gt;msg_handle
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_addr
op_assign
id|ha-&gt;msg_phys
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.su.msg.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong64
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;device-&gt;id
suffix:semicolon
macro_line|#else
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
id|t
op_assign
id|scp-&gt;target
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
op_minus
l_int|1
op_logical_and
id|b
op_ne
id|ha-&gt;virt_bus
)paren
(brace
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|io_cnt
(braket
id|t
)braket
op_decrement
suffix:semicolon
)brace
multiline_comment|/* cache or raw service */
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|S_BSY
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Controller busy -&gt; retry !&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_MOUNT
)paren
id|scp-&gt;SCp.sent_command
op_assign
id|GDT_CLUST_INFO
suffix:semicolon
multiline_comment|/* retry */
r_return
l_int|2
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,13)
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|GDTH_MAP_SG
)paren
id|pci_unmap_sg
c_func
(paren
id|ha-&gt;pdev
comma
id|scp-&gt;request_buffer
comma
id|scp-&gt;use_sg
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|GDTH_MAP_SINGLE
)paren
id|pci_unmap_page
c_func
(paren
id|ha-&gt;pdev
comma
id|scp-&gt;SCp.dma_handle
comma
id|scp-&gt;request_bufflen
comma
id|scp-&gt;SCp.Message
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.buffer
)paren
(brace
id|dma_addr_t
id|addr
suffix:semicolon
id|addr
op_assign
(paren
id|dma_addr_t
)paren
(paren
id|ulong32
)paren
id|scp-&gt;SCp.buffer
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;host_scribble
)paren
id|addr
op_add_assign
(paren
id|dma_addr_t
)paren
(paren
(paren
id|ulong64
)paren
(paren
id|ulong32
)paren
id|scp-&gt;host_scribble
op_lshift
l_int|32
)paren
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|ha-&gt;pdev
comma
id|addr
comma
l_int|16
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|S_OK
)paren
(brace
id|scp-&gt;SCp.Status
op_assign
id|S_OK
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
id|ha-&gt;info
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_ne
op_minus
l_int|1
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_sync_event(): special cmd 0x%x OK&bslash;n&quot;
comma
id|scp-&gt;SCp.sent_command
)paren
)paren
suffix:semicolon
multiline_comment|/* special commands GDT_CLUST_INFO/GDT_MOUNT ? */
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_CLUST_INFO
)paren
(brace
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_assign
(paren
id|unchar
)paren
id|ha-&gt;info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_MOUNTED
)paren
)paren
(brace
multiline_comment|/* NOT MOUNTED -&gt; MOUNT */
id|scp-&gt;SCp.sent_command
op_assign
id|GDT_MOUNT
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_RESERVED
)paren
(brace
multiline_comment|/* cluster drive RESERVED (on the other node) */
id|scp-&gt;SCp.phase
op_assign
op_minus
l_int|2
suffix:semicolon
multiline_comment|/* reservation conflict */
)brace
)brace
r_else
(brace
id|scp-&gt;SCp.sent_command
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_MOUNT
)paren
(brace
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_or_assign
id|CLUSTER_MOUNTED
suffix:semicolon
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_UNMOUNT
)paren
(brace
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_and_assign
op_complement
id|CLUSTER_MOUNTED
suffix:semicolon
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|media_changed
op_assign
id|TRUE
suffix:semicolon
)brace
id|scp-&gt;SCp.sent_command
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* retry */
id|scp-&gt;SCp.this_residual
op_assign
id|HIGH_PRI
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* RESERVE/RELEASE ? */
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|RESERVE
)paren
(brace
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_or_assign
id|CLUSTER_RESERVED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scp-&gt;cmnd
(braket
l_int|0
)braket
op_eq
id|RELEASE
)paren
(brace
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_and_assign
op_complement
id|CLUSTER_RESERVED
suffix:semicolon
)brace
id|scp-&gt;result
op_assign
id|DID_OK
op_lshift
l_int|16
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|scp-&gt;SCp.Status
op_assign
id|ha-&gt;status
suffix:semicolon
id|scp-&gt;SCp.Message
op_assign
id|ha-&gt;info
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_ne
op_minus
l_int|1
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_sync_event(): special cmd 0x%x error 0x%x&bslash;n&quot;
comma
id|scp-&gt;SCp.sent_command
comma
id|ha-&gt;status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_SCAN_START
op_logical_or
id|scp-&gt;SCp.sent_command
op_eq
id|GDT_SCAN_END
)paren
(brace
id|scp-&gt;SCp.sent_command
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* retry */
id|scp-&gt;SCp.this_residual
op_assign
id|HIGH_PRI
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|scp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|NOT_READY
suffix:semicolon
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|service
op_eq
id|CACHESERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|S_CACHE_UNKNOWN
op_logical_and
(paren
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_RESERVE_STATE
)paren
op_eq
id|CLUSTER_RESERVE_STATE
)paren
(brace
multiline_comment|/* bus reset -&gt; force GDT_CLUST_INFO */
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|cluster_type
op_and_assign
op_complement
id|CLUSTER_RESERVED
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|scp-&gt;sense_buffer
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
(paren
id|ushort
)paren
id|S_CACHE_RESERV
)paren
(brace
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|RESERVATION_CONFLICT
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;sense_buffer
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|scp-&gt;sense_buffer
(braket
l_int|2
)braket
op_assign
id|NOT_READY
suffix:semicolon
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
(paren
id|CHECK_CONDITION
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|scp-&gt;done
op_ne
id|gdth_scsi_done
)paren
(brace
id|ha-&gt;dvr.size
op_assign
r_sizeof
(paren
id|ha-&gt;dvr.eu.sync
)paren
suffix:semicolon
id|ha-&gt;dvr.eu.sync.ionode
op_assign
id|hanum
suffix:semicolon
id|ha-&gt;dvr.eu.sync.service
op_assign
id|service
suffix:semicolon
id|ha-&gt;dvr.eu.sync.status
op_assign
id|ha-&gt;status
suffix:semicolon
id|ha-&gt;dvr.eu.sync.info
op_assign
id|ha-&gt;info
suffix:semicolon
id|ha-&gt;dvr.eu.sync.hostdrive
op_assign
id|t
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;status
op_ge
l_int|0x8000
)paren
id|gdth_store_event
c_func
(paren
id|ha
comma
id|ES_SYNC
comma
l_int|0
comma
op_amp
id|ha-&gt;dvr
)paren
suffix:semicolon
r_else
id|gdth_store_event
c_func
(paren
id|ha
comma
id|ES_SYNC
comma
id|service
comma
op_amp
id|ha-&gt;dvr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* sense buffer filled from controller firmware (DMA) */
r_if
c_cond
(paren
id|ha-&gt;status
op_ne
id|S_RAW_SCSI
op_logical_or
id|ha-&gt;info
op_ge
l_int|0x100
)paren
(brace
id|scp-&gt;result
op_assign
id|DID_BAD_TARGET
op_lshift
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|scp-&gt;result
op_assign
(paren
id|DID_OK
op_lshift
l_int|16
)paren
op_or
id|ha-&gt;info
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|scp-&gt;SCp.have_data_in
)paren
id|scp-&gt;SCp.have_data_in
op_increment
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|async_cache_tab
r_static
r_char
op_star
id|async_cache_tab
(braket
)braket
op_assign
(brace
multiline_comment|/* 0*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;002&bslash;002&bslash;004&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, service %u, async. status %u/%lu unknown&quot;
comma
multiline_comment|/* 1*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;002&bslash;002&bslash;004&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, service %u, async. status %u/%lu unknown&quot;
comma
multiline_comment|/* 2*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu not ready&quot;
comma
multiline_comment|/* 3*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu: REASSIGN not successful and/or data error on reassigned blocks. Drive may crash in the future and should be replaced&quot;
comma
multiline_comment|/* 4*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, mirror update on Host Drive %lu failed&quot;
comma
multiline_comment|/* 5*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu failed&quot;
comma
multiline_comment|/* 6*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu: REASSIGN not successful and/or data error on reassigned blocks. Drive may crash in the future and should be replaced&quot;
comma
multiline_comment|/* 7*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu write protected&quot;
comma
multiline_comment|/* 8*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, media changed in Host Drive %lu&quot;
comma
multiline_comment|/* 9*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host Drive %lu is offline&quot;
comma
multiline_comment|/*10*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, media change of Mirror Drive %lu&quot;
comma
multiline_comment|/*11*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Mirror Drive %lu is write protected&quot;
comma
multiline_comment|/*12*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, general error on Host Drive %lu. Please check the devices of this drive!&quot;
comma
multiline_comment|/*13*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Cache Drive %u failed&quot;
comma
multiline_comment|/*14*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: FAIL state entered&quot;
comma
multiline_comment|/*15*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: error&quot;
comma
multiline_comment|/*16*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: failed drive replaced by Cache Drive %u&quot;
comma
multiline_comment|/*17*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity build failed&quot;
comma
multiline_comment|/*18*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild failed&quot;
comma
multiline_comment|/*19*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Test of Hot Fix %u failed&quot;
comma
multiline_comment|/*20*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive build finished successfully&quot;
comma
multiline_comment|/*21*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild finished successfully&quot;
comma
multiline_comment|/*22*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Hot Fix %u activated&quot;
comma
multiline_comment|/*23*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host Drive %u: processing of i/o aborted due to serious drive error&quot;
comma
multiline_comment|/*24*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, mirror update on Cache Drive %u completed&quot;
comma
multiline_comment|/*25*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, mirror update on Cache Drive %lu failed&quot;
comma
multiline_comment|/*26*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild started&quot;
comma
multiline_comment|/*27*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;012&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u: SHELF OK detected&quot;
comma
multiline_comment|/*28*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;012&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u: SHELF not OK detected&quot;
comma
multiline_comment|/*29*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug started&quot;
comma
multiline_comment|/*30*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: new disk detected&quot;
comma
multiline_comment|/*31*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: old disk detected&quot;
comma
multiline_comment|/*32*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: plugging an active disk is invalid&quot;
comma
multiline_comment|/*33*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: invalid device detected&quot;
comma
multiline_comment|/*34*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: insufficient disk capacity (%lu MB required)&quot;
comma
multiline_comment|/*35*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: disk write protected&quot;
comma
multiline_comment|/*36*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: disk not available&quot;
comma
multiline_comment|/*37*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Fault bus %u: swap detected (%lu)&quot;
comma
multiline_comment|/*38*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug finished successfully&quot;
comma
multiline_comment|/*39*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug aborted due to user Hot Plug&quot;
comma
multiline_comment|/*40*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug aborted&quot;
comma
multiline_comment|/*41*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, Fault bus %u, ID %u: Auto Hot Plug for Hot Fix started&quot;
comma
multiline_comment|/*42*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive build started&quot;
comma
multiline_comment|/*43*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, DRAM parity error detected&quot;
comma
multiline_comment|/*44*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: update started&quot;
comma
multiline_comment|/*45*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;006&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: Hot Fix %u activated&quot;
comma
multiline_comment|/*46*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: no matching Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*47*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*48*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: no matching Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*49*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: Pool Hot Fix Drive available&quot;
comma
multiline_comment|/*50*/
l_string|&quot;&bslash;007&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&quot;
l_string|&quot;GDT HA %u, SCSI bus %u, ID %u: IGNORE_WIDE_RESIDUE message received&quot;
comma
multiline_comment|/*51*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand started&quot;
comma
multiline_comment|/*52*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand finished successfully&quot;
comma
multiline_comment|/*53*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand failed&quot;
comma
multiline_comment|/*54*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, CPU temperature critical&quot;
comma
multiline_comment|/*55*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, CPU temperature OK&quot;
comma
multiline_comment|/*56*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;004&quot;
l_string|&quot;GDT HA %u, Host drive %lu created&quot;
comma
multiline_comment|/*57*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand restarted&quot;
comma
multiline_comment|/*58*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: expand stopped&quot;
comma
multiline_comment|/*59*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;010&bslash;002&quot;
l_string|&quot;GDT HA %u, Mirror Drive %u: drive build quited&quot;
comma
multiline_comment|/*60*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity build quited&quot;
comma
multiline_comment|/*61*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: drive rebuild quited&quot;
comma
multiline_comment|/*62*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity verify started&quot;
comma
multiline_comment|/*63*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity verify done&quot;
comma
multiline_comment|/*64*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity verify failed&quot;
comma
multiline_comment|/*65*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity error detected&quot;
comma
multiline_comment|/*66*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Array Drive %u: parity verify quited&quot;
comma
multiline_comment|/*67*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host Drive %u reserved&quot;
comma
multiline_comment|/*68*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host Drive %u mounted and released&quot;
comma
multiline_comment|/*69*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host Drive %u released&quot;
comma
multiline_comment|/*70*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, DRAM error detected and corrected with ECC&quot;
comma
multiline_comment|/*71*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, Uncorrectable DRAM error detected with ECC&quot;
comma
multiline_comment|/*72*/
l_string|&quot;&bslash;011&bslash;000&bslash;002&bslash;012&bslash;001&bslash;013&bslash;001&bslash;014&bslash;001&quot;
l_string|&quot;GDT HA %u, SCSI bus %u, ID %u, LUN %u: reassigning block&quot;
comma
multiline_comment|/*73*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host drive %u resetted locally&quot;
comma
multiline_comment|/*74*/
l_string|&quot;&bslash;005&bslash;000&bslash;002&bslash;006&bslash;002&quot;
l_string|&quot;GDT HA %u, Host drive %u resetted remotely&quot;
comma
multiline_comment|/*75*/
l_string|&quot;&bslash;003&bslash;000&bslash;002&quot;
l_string|&quot;GDT HA %u, async. status 75 unknown&quot;
comma
)brace
suffix:semicolon
DECL|function|gdth_async_event
r_static
r_int
id|gdth_async_event
c_func
(paren
r_int
id|hanum
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmdp
suffix:semicolon
r_int
id|cmd_index
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|cmdp
op_assign
id|ha-&gt;pccb
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_async_event() ha %d serv %d&bslash;n&quot;
comma
id|hanum
comma
id|ha-&gt;service
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;service
op_eq
id|SCREENSERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;status
op_eq
id|MSG_REQUEST
)paren
(brace
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|cmdp-&gt;Service
op_assign
id|SCREENSERVICE
suffix:semicolon
id|cmdp-&gt;RequestBuffer
op_assign
id|SCREEN_CMND
suffix:semicolon
id|cmd_index
op_assign
id|gdth_get_cmd_index
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|gdth_set_sema0
c_func
(paren
id|hanum
)paren
suffix:semicolon
id|cmdp-&gt;OpCode
op_assign
id|GDT_READ
suffix:semicolon
id|cmdp-&gt;BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|cmdp-&gt;u.screen.reserved
op_assign
l_int|0
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_handle
op_assign
id|MSG_INV_HANDLE
suffix:semicolon
id|cmdp-&gt;u.screen.su.msg.msg_addr
op_assign
id|ha-&gt;msg_phys
suffix:semicolon
id|ha-&gt;cmd_offs_dpmem
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;cmd_len
op_assign
id|GDTOFFSOF
c_func
(paren
id|gdth_cmd_str
comma
id|u.screen.su.msg.msg_addr
)paren
op_plus
r_sizeof
(paren
id|ulong64
)paren
suffix:semicolon
id|ha-&gt;cmd_cnt
op_assign
l_int|0
suffix:semicolon
id|gdth_copy_command
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
id|printk
c_func
(paren
l_string|&quot;[EISA slot %d] &quot;
comma
(paren
id|ushort
)paren
id|ha-&gt;brd_phys
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
id|printk
c_func
(paren
l_string|&quot;[DPMEM 0x%4X] &quot;
comma
(paren
id|ushort
)paren
id|ha-&gt;brd_phys
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;[PCI %d/%d] &quot;
comma
(paren
id|ushort
)paren
(paren
id|ha-&gt;brd_phys
op_rshift
l_int|8
)paren
comma
(paren
id|ushort
)paren
(paren
(paren
id|ha-&gt;brd_phys
op_rshift
l_int|3
)paren
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
id|gdth_release_event
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCIMPR
op_logical_and
(paren
id|ha-&gt;fw_vers
op_amp
l_int|0xff
)paren
op_ge
l_int|0x1a
)paren
(brace
id|ha-&gt;dvr.size
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;dvr.eu.async.ionode
op_assign
id|hanum
suffix:semicolon
id|ha-&gt;dvr.eu.async.status
op_assign
id|ha-&gt;status
suffix:semicolon
multiline_comment|/* severity and event_string already set! */
)brace
r_else
(brace
id|ha-&gt;dvr.size
op_assign
r_sizeof
(paren
id|ha-&gt;dvr.eu.async
)paren
suffix:semicolon
id|ha-&gt;dvr.eu.async.ionode
op_assign
id|hanum
suffix:semicolon
id|ha-&gt;dvr.eu.async.service
op_assign
id|ha-&gt;service
suffix:semicolon
id|ha-&gt;dvr.eu.async.status
op_assign
id|ha-&gt;status
suffix:semicolon
id|ha-&gt;dvr.eu.async.info
op_assign
id|ha-&gt;info
suffix:semicolon
op_star
(paren
id|ulong32
op_star
)paren
id|ha-&gt;dvr.eu.async.scsi_coord
op_assign
id|ha-&gt;info2
suffix:semicolon
)brace
id|gdth_store_event
c_func
(paren
id|ha
comma
id|ES_ASYNC
comma
id|ha-&gt;service
comma
op_amp
id|ha-&gt;dvr
)paren
suffix:semicolon
id|gdth_log_event
c_func
(paren
op_amp
id|ha-&gt;dvr
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* new host drive from expand? */
r_if
c_cond
(paren
id|ha-&gt;service
op_eq
id|CACHESERVICE
op_logical_and
id|ha-&gt;status
op_eq
l_int|56
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_async_event(): new host drive %d created&bslash;n&quot;
comma
(paren
id|ushort
)paren
id|ha-&gt;info
)paren
)paren
suffix:semicolon
multiline_comment|/* gdth_analyse_hdrive(hanum, (ushort)ha-&gt;info); */
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|gdth_log_event
r_static
r_void
id|gdth_log_event
c_func
(paren
id|gdth_evt_data
op_star
id|dvr
comma
r_char
op_star
id|buffer
)paren
(brace
id|gdth_stackframe
id|stack
suffix:semicolon
r_char
op_star
id|f
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_log_event()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dvr-&gt;size
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|buffer
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Adapter %d: %s&bslash;n&quot;
comma
id|dvr-&gt;eu.async.ionode
comma
id|dvr-&gt;event_string
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Adapter %d: %s&bslash;n&quot;
comma
id|dvr-&gt;eu.async.ionode
comma
id|dvr-&gt;event_string
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dvr-&gt;eu.async.service
op_eq
id|CACHESERVICE
op_logical_and
id|INDEX_OK
c_func
(paren
id|dvr-&gt;eu.async.status
comma
id|async_cache_tab
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;GDT: Async. event cache service, event no.: %d&bslash;n&quot;
comma
id|dvr-&gt;eu.async.status
)paren
)paren
suffix:semicolon
id|f
op_assign
id|async_cache_tab
(braket
id|dvr-&gt;eu.async.status
)braket
suffix:semicolon
multiline_comment|/* i: parameter to push, j: stack element to fill */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|f
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_switch
c_cond
(paren
id|f
(braket
id|i
op_plus
l_int|1
)braket
)paren
(brace
r_case
l_int|4
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|ulong32
op_star
)paren
op_amp
id|dvr-&gt;eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|ushort
op_star
)paren
op_amp
id|dvr-&gt;eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|stack.b
(braket
id|j
op_increment
)braket
op_assign
op_star
(paren
id|unchar
op_star
)paren
op_amp
id|dvr-&gt;eu.stream
(braket
(paren
r_int
)paren
id|f
(braket
id|i
)braket
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
op_amp
id|f
(braket
(paren
r_int
)paren
id|f
(braket
l_int|0
)braket
)braket
comma
id|stack
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|buffer
comma
op_amp
id|f
(braket
(paren
r_int
)paren
id|f
(braket
l_int|0
)braket
)braket
comma
id|stack
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|buffer
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT HA %u, Unknown async. event service %d event no. %d&bslash;n&quot;
comma
id|dvr-&gt;eu.async.ionode
comma
id|dvr-&gt;eu.async.service
comma
id|dvr-&gt;eu.async.status
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;GDT HA %u, Unknown async. event service %d event no. %d&quot;
comma
id|dvr-&gt;eu.async.ionode
comma
id|dvr-&gt;eu.async.service
comma
id|dvr-&gt;eu.async.status
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef GDTH_STATISTICS
DECL|function|gdth_timeout
r_void
id|gdth_timeout
c_func
(paren
id|ulong
id|data
)paren
(brace
id|ulong32
id|i
suffix:semicolon
id|Scsi_Cmnd
op_star
id|nscp
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|hanum
op_assign
l_int|0
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|act_stats
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_ne
id|UNUSED_CMND
)paren
op_increment
id|act_stats
suffix:semicolon
r_for
c_loop
(paren
id|act_rq
op_assign
l_int|0
comma
id|nscp
op_assign
id|ha-&gt;req_first
suffix:semicolon
id|nscp
suffix:semicolon
id|nscp
op_assign
(paren
id|Scsi_Cmnd
op_star
)paren
id|nscp-&gt;SCp.ptr
)paren
op_increment
id|act_rq
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_to(): ints %d, ios %d, act_stats %d, act_rq %d&bslash;n&quot;
comma
id|act_ints
comma
id|act_ios
comma
id|act_stats
comma
id|act_rq
)paren
)paren
suffix:semicolon
id|act_ints
op_assign
id|act_ios
op_assign
l_int|0
suffix:semicolon
id|gdth_timer.expires
op_assign
id|jiffies
op_plus
l_int|30
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|gdth_timer
)paren
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_void
comma
id|internal_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
)paren
(brace
r_int
id|i
comma
id|argc
suffix:semicolon
r_char
op_star
id|cur_str
comma
op_star
id|argv
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;internal_setup() str %s ints[0] %d&bslash;n&quot;
comma
id|str
ques
c_cond
id|str
suffix:colon
l_string|&quot;NULL&quot;
comma
id|ints
ques
c_cond
id|ints
(braket
l_int|0
)braket
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* read irq[] from ints[] */
r_if
c_cond
(paren
id|ints
)paren
(brace
id|argc
op_assign
id|ints
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|argc
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|argc
OG
id|MAXHA
)paren
id|argc
op_assign
id|MAXHA
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|argc
suffix:semicolon
op_increment
id|i
)paren
id|irq
(braket
id|i
)braket
op_assign
id|ints
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* analyse string */
id|argv
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
id|argv
op_logical_and
(paren
id|cur_str
op_assign
id|strchr
c_func
(paren
id|argv
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
r_int
id|val
op_assign
l_int|0
comma
id|c
op_assign
op_star
op_increment
id|cur_str
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;n&squot;
op_logical_or
id|c
op_eq
l_char|&squot;N&squot;
)paren
id|val
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;y&squot;
op_logical_or
id|c
op_eq
l_char|&squot;Y&squot;
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_else
id|val
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|cur_str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;disable:&quot;
comma
l_int|8
)paren
)paren
id|disable
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;reserve_mode:&quot;
comma
l_int|13
)paren
)paren
id|reserve_mode
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;reverse_scan:&quot;
comma
l_int|13
)paren
)paren
id|reverse_scan
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;hdr_channel:&quot;
comma
l_int|12
)paren
)paren
id|hdr_channel
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;max_ids:&quot;
comma
l_int|8
)paren
)paren
id|max_ids
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;rescan:&quot;
comma
l_int|7
)paren
)paren
id|rescan
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;virt_ctr:&quot;
comma
l_int|9
)paren
)paren
id|virt_ctr
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;shared_access:&quot;
comma
l_int|14
)paren
)paren
id|shared_access
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;probe_eisa_isa:&quot;
comma
l_int|15
)paren
)paren
id|probe_eisa_isa
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|argv
comma
l_string|&quot;reserve_list:&quot;
comma
l_int|13
)paren
)paren
(brace
id|reserve_list
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_RES_ARGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cur_str
op_assign
id|strchr
c_func
(paren
id|cur_str
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cur_str
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
(paren
r_int
)paren
op_star
op_increment
id|cur_str
)paren
)paren
(brace
op_decrement
id|cur_str
suffix:semicolon
r_break
suffix:semicolon
)brace
id|reserve_list
(braket
id|i
)braket
op_assign
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|cur_str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cur_str
)paren
r_break
suffix:semicolon
id|argv
op_assign
op_increment
id|cur_str
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|argv
op_assign
id|strchr
c_func
(paren
id|argv
comma
l_char|&squot;,&squot;
)paren
)paren
)paren
op_increment
id|argv
suffix:semicolon
)brace
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_int
comma
id|option_setup
c_func
(paren
r_char
op_star
id|str
)paren
)paren
(brace
r_int
id|ints
(braket
id|MAXHA
)braket
suffix:semicolon
r_char
op_star
id|cur
op_assign
id|str
suffix:semicolon
r_int
id|i
op_assign
l_int|1
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;option_setup() str %s&bslash;n&quot;
comma
id|str
ques
c_cond
id|str
suffix:colon
l_string|&quot;NULL&quot;
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|cur
op_logical_and
id|isdigit
c_func
(paren
op_star
id|cur
)paren
op_logical_and
id|i
op_le
id|MAXHA
)paren
(brace
id|ints
(braket
id|i
op_increment
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|cur
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cur
op_assign
id|strchr
c_func
(paren
id|cur
comma
l_char|&squot;,&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
id|cur
op_increment
suffix:semicolon
)brace
id|ints
(braket
l_int|0
)braket
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|internal_setup
c_func
(paren
id|cur
comma
id|ints
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_int
comma
id|gdth_detect
c_func
(paren
id|Scsi_Host_Template
op_star
id|shtp
)paren
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shp
suffix:semicolon
id|gdth_pci_str
id|pcistr
(braket
id|MAXHA
)braket
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong32
id|isa_bios
suffix:semicolon
id|ushort
id|eisa_slot
suffix:semicolon
r_int
id|i
comma
id|hanum
comma
id|cnt
comma
id|ctr
comma
id|err
suffix:semicolon
id|unchar
id|b
suffix:semicolon
macro_line|#ifdef DEBUG_GDTH
id|printk
c_func
(paren
l_string|&quot;GDT: This driver contains debugging information !! Trace level = %d&bslash;n&quot;
comma
id|DebugState
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;     Destination of debugging information: &quot;
)paren
suffix:semicolon
macro_line|#ifdef __SERIAL__
macro_line|#ifdef __COM2__
id|printk
c_func
(paren
l_string|&quot;Serial port COM2&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;Serial port COM1&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;Console&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|gdth_delay
c_func
(paren
l_int|3000
)paren
suffix:semicolon
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_detect()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disable
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA: Controller driver disabled from command line !&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;GDT-HA: Storage RAID Controller Driver. Version: %s &bslash;n&quot;
comma
id|GDTH_VERSION_STR
)paren
suffix:semicolon
multiline_comment|/* initializations */
id|gdth_polling
op_assign
id|TRUE
suffix:semicolon
id|b
op_assign
l_int|0
suffix:semicolon
id|gdth_clear_events
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* As default we do not probe for EISA or ISA controllers */
r_if
c_cond
(paren
id|probe_eisa_isa
)paren
(brace
multiline_comment|/* scanning for controllers, at first: ISA controller */
r_for
c_loop
(paren
id|isa_bios
op_assign
l_int|0xc8000UL
suffix:semicolon
id|isa_bios
op_le
l_int|0xd8000UL
suffix:semicolon
id|isa_bios
op_add_assign
l_int|0x8000UL
)paren
(brace
id|dma_addr_t
id|scratch_dma_handle
suffix:semicolon
id|scratch_dma_handle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_count
op_ge
id|MAXHA
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|gdth_search_isa
c_func
(paren
id|isa_bios
)paren
)paren
(brace
multiline_comment|/* controller found */
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shp
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_isa
c_func
(paren
id|isa_bios
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#ifdef __ia64__
r_break
suffix:semicolon
macro_line|#else
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-ISA HA at BIOS 0x%05X IRQ %u DRQ %u&bslash;n&quot;
comma
id|isa_bios
comma
id|ha-&gt;irq
comma
id|ha-&gt;drq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
comma
id|ha
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|ha-&gt;drq
comma
l_string|&quot;gdth&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Unable to allocate DMA channel&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
id|ha
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|set_dma_mode
c_func
(paren
id|ha-&gt;drq
comma
id|DMA_MODE_CASCADE
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
id|ha-&gt;drq
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|1
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
id|ha-&gt;drq
suffix:semicolon
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;ccb_phys
op_assign
l_int|0L
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|ha-&gt;pdev
op_assign
l_int|NULL
suffix:semicolon
id|ha-&gt;pscratch
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;scratch_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;msg_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
(paren
id|gdth_coal_status
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;coal_stat_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#endif
macro_line|#else
id|ha-&gt;pscratch
op_assign
id|scsi_init_malloc
c_func
(paren
id|GDTH_SCRATCH
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|ha-&gt;scratch_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pscratch
)paren
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|ha-&gt;msg_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pmsg
)paren
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|ha-&gt;coal_stat_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;coal_stat
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|ha-&gt;scratch_busy
op_assign
id|FALSE
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
id|ha-&gt;tid_cnt
op_assign
id|MAX_HDRIVES
suffix:semicolon
r_if
c_cond
(paren
id|max_ids
OG
l_int|0
op_logical_and
id|max_ids
OL
id|ha-&gt;tid_cnt
)paren
id|ha-&gt;tid_cnt
op_assign
id|max_ids
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
id|ha-&gt;scan_mode
op_assign
id|rescan
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
op_eq
l_int|NULL
op_logical_or
id|ha-&gt;pmsg
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-ISA: Error during device scan&bslash;n&quot;
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|ha-&gt;coal_stat
comma
id|ha-&gt;coal_stat_phys
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
id|ha-&gt;pscratch
comma
id|ha-&gt;scratch_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|ha-&gt;pmsg
comma
id|ha-&gt;msg_phys
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;coal_stat
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pscratch
comma
id|GDTH_SCRATCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pmsg
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
)paren
suffix:semicolon
macro_line|#endif
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
id|ha
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hdr_channel
template_param
id|ha-&gt;bus_cnt
)paren
id|hdr_channel
op_assign
id|ha-&gt;bus_cnt
suffix:semicolon
id|ha-&gt;virt_bus
op_assign
id|hdr_channel
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,20) &amp;&amp; &bslash;&n;    LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)
id|shp-&gt;highmem_io
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|ha-&gt;raw_feat
op_amp
id|ha-&gt;screen_feat
op_amp
id|GDT_64BIT
)paren
id|shp-&gt;max_cmd_len
op_assign
l_int|16
suffix:semicolon
macro_line|#endif
id|shp-&gt;max_id
op_assign
id|ha-&gt;tid_cnt
suffix:semicolon
id|shp-&gt;max_lun
op_assign
id|MAXLUN
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|ha-&gt;bus_cnt
suffix:semicolon
r_if
c_cond
(paren
id|virt_ctr
)paren
(brace
id|virt_ctr
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
op_plus
l_int|1
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|1
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
id|ha-&gt;drq
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
)brace
)brace
id|GDTH_INIT_LOCK_HA
c_func
(paren
id|ha
)paren
suffix:semicolon
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
macro_line|#endif /* !__ia64__ */
)brace
)brace
multiline_comment|/* scanning for EISA controllers */
r_for
c_loop
(paren
id|eisa_slot
op_assign
l_int|0x1000
suffix:semicolon
id|eisa_slot
op_le
l_int|0x8000
suffix:semicolon
id|eisa_slot
op_add_assign
l_int|0x1000
)paren
(brace
id|dma_addr_t
id|scratch_dma_handle
suffix:semicolon
id|scratch_dma_handle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_count
op_ge
id|MAXHA
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|gdth_search_eisa
c_func
(paren
id|eisa_slot
)paren
)paren
(brace
multiline_comment|/* controller found */
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shp
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_eisa
c_func
(paren
id|eisa_slot
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-EISA HA at Slot %d IRQ %u&bslash;n&quot;
comma
id|eisa_slot
op_rshift
l_int|12
comma
id|ha-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;gdth&quot;
comma
id|ha
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;EISA detect Bus 0: hanum %d&bslash;n&quot;
comma
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
)paren
)paren
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;ccb_phys
op_assign
l_int|0L
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|ha-&gt;pdev
op_assign
l_int|NULL
suffix:semicolon
id|ha-&gt;pscratch
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;scratch_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;msg_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
(paren
id|gdth_coal_status
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;coal_stat_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#endif
id|ha-&gt;ccb_phys
op_assign
id|pci_map_single
c_func
(paren
id|ha-&gt;pdev
comma
id|ha-&gt;pccb
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
comma
id|PCI_DMA_BIDIRECTIONAL
)paren
suffix:semicolon
macro_line|#else
id|ha-&gt;pscratch
op_assign
id|scsi_init_malloc
c_func
(paren
id|GDTH_SCRATCH
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|ha-&gt;scratch_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pscratch
)paren
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|ha-&gt;msg_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pmsg
)paren
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|ha-&gt;coal_stat_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;coal_stat
)paren
suffix:semicolon
macro_line|#endif
id|ha-&gt;ccb_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pccb
)paren
suffix:semicolon
macro_line|#endif
id|ha-&gt;scratch_busy
op_assign
id|FALSE
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
id|ha-&gt;tid_cnt
op_assign
id|MAX_HDRIVES
suffix:semicolon
r_if
c_cond
(paren
id|max_ids
OG
l_int|0
op_logical_and
id|max_ids
OL
id|ha-&gt;tid_cnt
)paren
id|ha-&gt;tid_cnt
op_assign
id|max_ids
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
id|ha-&gt;scan_mode
op_assign
id|rescan
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
op_eq
l_int|NULL
op_logical_or
id|ha-&gt;pmsg
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-EISA: Error during device scan&bslash;n&quot;
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|ha-&gt;coal_stat
comma
id|ha-&gt;coal_stat_phys
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
id|ha-&gt;pscratch
comma
id|ha-&gt;scratch_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|ha-&gt;pmsg
comma
id|ha-&gt;msg_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;ccb_phys
)paren
id|pci_unmap_single
c_func
(paren
id|ha-&gt;pdev
comma
id|ha-&gt;ccb_phys
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
comma
id|PCI_DMA_BIDIRECTIONAL
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;coal_stat
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pscratch
comma
id|GDTH_SCRATCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pmsg
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
)paren
suffix:semicolon
macro_line|#endif
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
id|ha
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hdr_channel
template_param
id|ha-&gt;bus_cnt
)paren
id|hdr_channel
op_assign
id|ha-&gt;bus_cnt
suffix:semicolon
id|ha-&gt;virt_bus
op_assign
id|hdr_channel
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,20) &amp;&amp; &bslash;&n;    LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)
id|shp-&gt;highmem_io
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|ha-&gt;raw_feat
op_amp
id|ha-&gt;screen_feat
op_amp
id|GDT_64BIT
)paren
id|shp-&gt;max_cmd_len
op_assign
l_int|16
suffix:semicolon
macro_line|#endif
id|shp-&gt;max_id
op_assign
id|ha-&gt;tid_cnt
suffix:semicolon
id|shp-&gt;max_lun
op_assign
id|MAXLUN
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|ha-&gt;bus_cnt
suffix:semicolon
r_if
c_cond
(paren
id|virt_ctr
)paren
(brace
id|virt_ctr
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
op_plus
l_int|1
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
)brace
)brace
id|GDTH_INIT_LOCK_HA
c_func
(paren
id|ha
)paren
suffix:semicolon
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* scanning for PCI controllers */
id|cnt
op_assign
id|gdth_search_pci
c_func
(paren
id|pcistr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-HA: Found %d PCI Storage RAID Controllers&bslash;n&quot;
comma
id|cnt
)paren
suffix:semicolon
id|gdth_sort_pci
c_func
(paren
id|pcistr
comma
id|cnt
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctr
op_assign
l_int|0
suffix:semicolon
id|ctr
OL
id|cnt
suffix:semicolon
op_increment
id|ctr
)paren
(brace
id|dma_addr_t
id|scratch_dma_handle
suffix:semicolon
id|scratch_dma_handle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_count
op_ge
id|MAXHA
)paren
r_break
suffix:semicolon
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_ext_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shp
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|shp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gdth_init_pci
c_func
(paren
op_amp
id|pcistr
(braket
id|ctr
)braket
comma
id|ha
)paren
)paren
(brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* controller found and initialized */
id|printk
c_func
(paren
l_string|&quot;Configuring GDT-PCI HA at %d/%d IRQ %u&bslash;n&quot;
comma
id|pcistr
(braket
id|ctr
)braket
dot
id|bus
comma
id|PCI_SLOT
c_func
(paren
id|pcistr
(braket
id|ctr
)braket
dot
id|device_fn
)paren
comma
id|ha-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|ha-&gt;irq
comma
id|gdth_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;gdth&quot;
comma
id|ha
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI: Unable to allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
id|hanum
op_assign
id|gdth_ctr_count
suffix:semicolon
id|gdth_ctr_tab
(braket
id|gdth_ctr_count
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
l_int|0
suffix:semicolon
id|ha-&gt;pccb
op_assign
id|CMDDATA
c_func
(paren
id|shp
)paren
suffix:semicolon
id|ha-&gt;ccb_phys
op_assign
l_int|0L
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|ha-&gt;pscratch
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;scratch_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;msg_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
(paren
id|gdth_coal_status
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
op_amp
id|scratch_dma_handle
)paren
suffix:semicolon
id|ha-&gt;coal_stat_phys
op_assign
id|scratch_dma_handle
suffix:semicolon
macro_line|#endif
macro_line|#else
id|ha-&gt;pscratch
op_assign
id|scsi_init_malloc
c_func
(paren
id|GDTH_SCRATCH
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|ha-&gt;scratch_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pscratch
)paren
suffix:semicolon
id|ha-&gt;pmsg
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|ha-&gt;msg_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;pmsg
)paren
suffix:semicolon
macro_line|#ifdef INT_COAL
id|ha-&gt;coal_stat
op_assign
id|scsi_init_malloc
c_func
(paren
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|ha-&gt;coal_stat_phys
op_assign
id|virt_to_bus
c_func
(paren
id|ha-&gt;coal_stat
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|ha-&gt;scratch_busy
op_assign
id|FALSE
suffix:semicolon
id|ha-&gt;req_first
op_assign
l_int|NULL
suffix:semicolon
id|ha-&gt;tid_cnt
op_assign
id|pcistr
(braket
id|ctr
)braket
dot
id|device_id
op_ge
l_int|0x200
ques
c_cond
id|MAXID
suffix:colon
id|MAX_HDRIVES
suffix:semicolon
r_if
c_cond
(paren
id|max_ids
OG
l_int|0
op_logical_and
id|max_ids
OL
id|ha-&gt;tid_cnt
)paren
id|ha-&gt;tid_cnt
op_assign
id|max_ids
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
id|ha-&gt;scan_mode
op_assign
id|rescan
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
suffix:semicolon
id|err
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pscratch
op_eq
l_int|NULL
op_logical_or
id|ha-&gt;pmsg
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|gdth_search_drives
c_func
(paren
id|hanum
)paren
)paren
(brace
id|err
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|hdr_channel
template_param
id|ha-&gt;bus_cnt
)paren
id|hdr_channel
op_assign
id|ha-&gt;bus_cnt
suffix:semicolon
id|ha-&gt;virt_bus
op_assign
id|hdr_channel
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_set_device
c_func
(paren
id|shp
comma
op_amp
id|pcistr
(braket
id|ctr
)braket
dot
id|pdev-&gt;dev
)paren
suffix:semicolon
macro_line|#else
id|scsi_set_pci_device
c_func
(paren
id|shp
comma
id|pcistr
(braket
id|ctr
)braket
dot
id|pdev
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|ha-&gt;cache_feat
op_amp
id|ha-&gt;raw_feat
op_amp
id|ha-&gt;screen_feat
op_amp
id|GDT_64BIT
)paren
op_logical_or
multiline_comment|/* 64-bit DMA only supported from FW &gt;= x.43 */
(paren
op_logical_neg
id|ha-&gt;dma64_support
)paren
)paren
(brace
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pcistr
(braket
id|ctr
)braket
dot
id|pdev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;GDT-PCI %d: Unable to set 32-bit DMA&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
id|err
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_else
(brace
id|shp-&gt;max_cmd_len
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_set_dma_mask
c_func
(paren
id|pcistr
(braket
id|ctr
)braket
dot
id|pdev
comma
l_int|0xffffffffffffffffULL
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI %d: 64-bit DMA enabled&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pcistr
(braket
id|ctr
)braket
dot
id|pdev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;GDT-PCI %d: Unable to set 64/32-bit DMA&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
id|err
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;GDT-PCI %d: Error during device scan&bslash;n&quot;
comma
id|hanum
)paren
suffix:semicolon
op_decrement
id|gdth_ctr_count
suffix:semicolon
op_decrement
id|gdth_ctr_vcount
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|ha-&gt;coal_stat
comma
id|ha-&gt;coal_stat_phys
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
id|ha-&gt;pscratch
comma
id|ha-&gt;scratch_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|ha-&gt;pmsg
comma
id|ha-&gt;msg_phys
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;coal_stat
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pscratch
comma
id|GDTH_SCRATCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pmsg
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
)paren
suffix:semicolon
macro_line|#endif
id|free_irq
c_func
(paren
id|ha-&gt;irq
comma
id|ha
)paren
suffix:semicolon
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|shp-&gt;max_id
op_assign
id|ha-&gt;tid_cnt
suffix:semicolon
id|shp-&gt;max_lun
op_assign
id|MAXLUN
suffix:semicolon
id|shp-&gt;max_channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|ha-&gt;bus_cnt
suffix:semicolon
r_if
c_cond
(paren
id|virt_ctr
)paren
(brace
id|virt_ctr
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* register addit. SCSI channels as virtual controllers */
r_for
c_loop
(paren
id|b
op_assign
l_int|1
suffix:semicolon
id|b
OL
id|ha-&gt;bus_cnt
op_plus
l_int|1
suffix:semicolon
op_increment
id|b
)paren
(brace
id|shp
op_assign
id|scsi_register
c_func
(paren
id|shtp
comma
r_sizeof
(paren
id|gdth_num_str
)paren
)paren
suffix:semicolon
id|shp-&gt;unchecked_isa_dma
op_assign
l_int|0
suffix:semicolon
id|shp-&gt;irq
op_assign
id|ha-&gt;irq
suffix:semicolon
id|shp-&gt;dma_channel
op_assign
l_int|0xff
suffix:semicolon
id|gdth_ctr_vtab
(braket
id|gdth_ctr_vcount
op_increment
)braket
op_assign
id|shp
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
op_assign
(paren
id|ushort
)paren
id|hanum
suffix:semicolon
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_assign
id|b
suffix:semicolon
)brace
)brace
id|GDTH_INIT_LOCK_HA
c_func
(paren
id|ha
)paren
suffix:semicolon
id|gdth_enable_int
c_func
(paren
id|hanum
)paren
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_detect() %d controller detected&bslash;n&quot;
comma
id|gdth_ctr_count
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_count
OG
l_int|0
)paren
(brace
macro_line|#ifdef GDTH_STATISTICS
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_detect(): Initializing timer !&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|gdth_timer
)paren
suffix:semicolon
id|gdth_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|gdth_timer.data
op_assign
l_int|0L
suffix:semicolon
id|gdth_timer.function
op_assign
id|gdth_timeout
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|gdth_timer
)paren
suffix:semicolon
macro_line|#endif
id|major
op_assign
id|register_chrdev
c_func
(paren
l_int|0
comma
l_string|&quot;gdth&quot;
comma
op_amp
id|gdth_fops
)paren
suffix:semicolon
id|register_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
)brace
id|gdth_polling
op_assign
id|FALSE
suffix:semicolon
r_return
id|gdth_ctr_vcount
suffix:semicolon
)brace
DECL|function|gdth_release
r_int
id|gdth_release
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shp
)paren
(brace
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_release()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|busnum
op_eq
l_int|0
)paren
(brace
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
r_if
c_cond
(paren
id|ha-&gt;sdev
)paren
(brace
id|scsi_free_host_dev
c_func
(paren
id|ha-&gt;sdev
)paren
suffix:semicolon
id|ha-&gt;sdev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|gdth_flush
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shp-&gt;irq
)paren
(brace
id|free_irq
c_func
(paren
id|shp-&gt;irq
comma
id|ha
)paren
suffix:semicolon
)brace
macro_line|#ifndef __ia64__
r_if
c_cond
(paren
id|shp-&gt;dma_channel
op_ne
l_int|0xff
)paren
(brace
id|free_dma
c_func
(paren
id|shp-&gt;dma_channel
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
comma
id|ha-&gt;coal_stat
comma
id|ha-&gt;coal_stat_phys
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
id|GDTH_SCRATCH
comma
id|ha-&gt;pscratch
comma
id|ha-&gt;scratch_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|pci_free_consistent
c_func
(paren
id|ha-&gt;pdev
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
comma
id|ha-&gt;pmsg
comma
id|ha-&gt;msg_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;ccb_phys
)paren
id|pci_unmap_single
c_func
(paren
id|ha-&gt;pdev
comma
id|ha-&gt;ccb_phys
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
comma
id|PCI_DMA_BIDIRECTIONAL
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef INT_COAL
r_if
c_cond
(paren
id|ha-&gt;coal_stat
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;coal_stat
comma
r_sizeof
(paren
id|gdth_coal_status
)paren
op_star
id|MAXOFFSETS
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ha-&gt;pscratch
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pscratch
comma
id|GDTH_SCRATCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;pmsg
)paren
id|scsi_init_free
c_func
(paren
(paren
r_void
op_star
)paren
id|ha-&gt;pmsg
comma
r_sizeof
(paren
id|gdth_msg_str
)paren
)paren
suffix:semicolon
macro_line|#endif
id|gdth_ctr_released
op_increment
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_release(): HA %d of %d&bslash;n&quot;
comma
id|gdth_ctr_released
comma
id|gdth_ctr_count
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_ctr_released
op_eq
id|gdth_ctr_count
)paren
(brace
macro_line|#ifdef GDTH_STATISTICS
id|del_timer
c_func
(paren
op_amp
id|gdth_timer
)paren
suffix:semicolon
macro_line|#endif
id|unregister_chrdev
c_func
(paren
id|major
comma
l_string|&quot;gdth&quot;
)paren
suffix:semicolon
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
)brace
)brace
id|scsi_unregister
c_func
(paren
id|shp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_ctr_name
r_static
r_const
r_char
op_star
id|gdth_ctr_name
c_func
(paren
r_int
id|hanum
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_ctr_name()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|GDT3_ID
suffix:colon
r_return
l_string|&quot;GDT3000/3020&quot;
suffix:semicolon
r_case
id|GDT3A_ID
suffix:colon
r_return
l_string|&quot;GDT3000A/3020A/3050A&quot;
suffix:semicolon
r_case
id|GDT3B_ID
suffix:colon
r_return
l_string|&quot;GDT3000B/3010A&quot;
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
)paren
(brace
r_return
l_string|&quot;GDT2000/2020&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_PCI
)paren
(brace
r_switch
c_cond
(paren
id|ha-&gt;stype
)paren
(brace
r_case
id|PCI_DEVICE_ID_VORTEX_GDT60x0
suffix:colon
r_return
l_string|&quot;GDT6000/6020/6050&quot;
suffix:semicolon
r_case
id|PCI_DEVICE_ID_VORTEX_GDT6000B
suffix:colon
r_return
l_string|&quot;GDT6000B/6010&quot;
suffix:semicolon
)brace
)brace
multiline_comment|/* new controllers (GDT_PCINEW, GDT_PCIMPR, ..) use board_info IOCTL! */
r_return
l_string|&quot;&quot;
suffix:semicolon
)brace
DECL|function|gdth_info
r_const
r_char
op_star
id|gdth_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shp
)paren
(brace
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_info()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|shp
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_return
(paren
(paren
r_const
r_char
op_star
)paren
id|ha-&gt;binfo.type_string
)paren
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,0)
multiline_comment|/* old error handling */
DECL|function|gdth_abort
r_int
id|gdth_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_abort() reason %d&bslash;n&quot;
comma
id|scp-&gt;abort_reason
)paren
)paren
suffix:semicolon
r_return
id|SCSI_ABORT_SNOOZE
suffix:semicolon
)brace
DECL|function|gdth_reset
r_int
id|gdth_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_int
r_int
id|reset_flags
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_reset()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|SCSI_RESET_PUNT
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* new error handling */
DECL|function|gdth_eh_abort
r_int
id|gdth_eh_abort
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_eh_abort()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
DECL|function|gdth_eh_device_reset
r_int
id|gdth_eh_device_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_eh_device_reset()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
DECL|function|gdth_eh_bus_reset
r_int
id|gdth_eh_bus_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
r_int
id|i
comma
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|Scsi_Cmnd
op_star
id|cmnd
suffix:semicolon
id|unchar
id|b
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_eh_bus_reset()&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;device-&gt;channel
suffix:semicolon
macro_line|#else
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|scp-&gt;channel
suffix:semicolon
macro_line|#endif
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
multiline_comment|/* clear command tab */
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GDTH_MAXCMDS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|cmnd
op_assign
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
r_if
c_cond
(paren
op_logical_neg
id|SPECIAL_SCP
c_func
(paren
id|cmnd
)paren
op_logical_and
id|cmnd-&gt;device-&gt;channel
op_eq
id|b
)paren
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|SPECIAL_SCP
c_func
(paren
id|cmnd
)paren
op_logical_and
id|cmnd-&gt;channel
op_eq
id|b
)paren
macro_line|#endif
id|ha-&gt;cmd_tab
(braket
id|i
)braket
dot
id|cmnd
op_assign
id|UNUSED_CMND
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
op_eq
id|ha-&gt;virt_bus
)paren
(brace
multiline_comment|/* host drives */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
)paren
(brace
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|gdth_polling
op_assign
id|TRUE
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|CACHESERVICE
comma
id|GDT_CLUST_RESET
comma
id|i
comma
l_int|0
comma
l_int|0
)paren
)paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|cluster_type
op_and_assign
op_complement
id|CLUSTER_RESERVED
suffix:semicolon
id|gdth_polling
op_assign
id|FALSE
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* raw devices */
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXID
suffix:semicolon
op_increment
id|i
)paren
id|ha-&gt;raw
(braket
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
)braket
dot
id|io_cnt
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|gdth_polling
op_assign
id|TRUE
suffix:semicolon
r_while
c_loop
(paren
id|gdth_test_busy
c_func
(paren
id|hanum
)paren
)paren
id|gdth_delay
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|gdth_internal_cmd
c_func
(paren
id|hanum
comma
id|SCSIRAWSERVICE
comma
id|GDT_RESET_BUS
comma
id|BUS_L2P
c_func
(paren
id|ha
comma
id|b
)paren
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|gdth_polling
op_assign
id|FALSE
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|gdth_eh_host_reset
r_int
id|gdth_eh_host_reset
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_eh_host_reset()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
DECL|function|gdth_bios_param
r_int
id|gdth_bios_param
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
comma
r_struct
id|block_device
op_star
id|bdev
comma
id|sector_t
id|cap
comma
r_int
op_star
id|ip
)paren
macro_line|#else
r_int
id|gdth_bios_param
c_func
(paren
id|Disk
op_star
id|disk
comma
id|kdev_t
id|dev
comma
r_int
op_star
id|ip
)paren
macro_line|#endif
(brace
id|unchar
id|b
comma
id|t
suffix:semicolon
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_struct
id|scsi_device
op_star
id|sd
suffix:semicolon
r_int
id|capacity
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|sd
op_assign
id|sdev
suffix:semicolon
id|capacity
op_assign
id|cap
suffix:semicolon
macro_line|#else
id|sd
op_assign
id|disk-&gt;device
suffix:semicolon
id|capacity
op_assign
id|disk-&gt;capacity
suffix:semicolon
macro_line|#endif
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|sd-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
id|b
op_assign
id|virt_ctr
ques
c_cond
id|NUMDATA
c_func
(paren
id|sd-&gt;host
)paren
op_member_access_from_pointer
id|busnum
suffix:colon
id|sd-&gt;channel
suffix:semicolon
id|t
op_assign
id|sd-&gt;id
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_bios_param() ha %d bus %d target %d&bslash;n&quot;
comma
id|hanum
comma
id|b
comma
id|t
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
op_ne
id|ha-&gt;virt_bus
op_logical_or
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|heads
op_eq
l_int|0
)paren
(brace
multiline_comment|/* raw device or host drive without mapping information */
id|TRACE2
c_func
(paren
(paren
l_string|&quot;Evaluate mapping&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|gdth_eval_mapping
c_func
(paren
id|capacity
comma
op_amp
id|ip
(braket
l_int|2
)braket
comma
op_amp
id|ip
(braket
l_int|0
)braket
comma
op_amp
id|ip
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|ip
(braket
l_int|0
)braket
op_assign
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|heads
suffix:semicolon
id|ip
(braket
l_int|1
)braket
op_assign
id|ha-&gt;hdr
(braket
id|t
)braket
dot
id|secs
suffix:semicolon
id|ip
(braket
l_int|2
)braket
op_assign
id|capacity
op_div
id|ip
(braket
l_int|0
)braket
op_div
id|ip
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_bios_param(): %d heads, %d secs, %d cyls&bslash;n&quot;
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_queuecommand
r_int
id|gdth_queuecommand
c_func
(paren
id|Scsi_Cmnd
op_star
id|scp
comma
r_void
(paren
op_star
id|done
)paren
(paren
id|Scsi_Cmnd
op_star
)paren
)paren
(brace
r_int
id|hanum
suffix:semicolon
r_int
id|priority
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_queuecommand() cmd 0x%x&bslash;n&quot;
comma
id|scp-&gt;cmnd
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|scp-&gt;scsi_done
op_assign
(paren
r_void
op_star
)paren
id|done
suffix:semicolon
id|scp-&gt;SCp.have_data_in
op_assign
l_int|1
suffix:semicolon
id|scp-&gt;SCp.phase
op_assign
op_minus
l_int|1
suffix:semicolon
id|scp-&gt;SCp.sent_command
op_assign
op_minus
l_int|1
suffix:semicolon
id|scp-&gt;SCp.Status
op_assign
id|GDTH_MAP_NONE
suffix:semicolon
id|scp-&gt;SCp.buffer
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
l_int|NULL
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|scp-&gt;device-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
macro_line|#else
id|hanum
op_assign
id|NUMDATA
c_func
(paren
id|scp-&gt;host
)paren
op_member_access_from_pointer
id|hanum
suffix:semicolon
macro_line|#endif
macro_line|#ifdef GDTH_STATISTICS
op_increment
id|act_ios
suffix:semicolon
macro_line|#endif
id|priority
op_assign
id|DEFAULT_PRI
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;done
op_eq
id|gdth_scsi_done
)paren
id|priority
op_assign
id|scp-&gt;SCp.this_residual
suffix:semicolon
id|gdth_update_timeout
c_func
(paren
id|hanum
comma
id|scp
comma
id|scp-&gt;timeout_per_command
op_star
l_int|6
)paren
suffix:semicolon
id|gdth_putq
c_func
(paren
id|hanum
comma
id|scp
comma
id|priority
)paren
suffix:semicolon
id|gdth_next
c_func
(paren
id|hanum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_open
r_static
r_int
id|gdth_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gdth_ctr_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;sdev
)paren
id|ha-&gt;sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|gdth_ctr_tab
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_open()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gdth_close
r_static
r_int
id|gdth_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
)paren
(brace
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_close()&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ioc_event
r_static
r_int
id|ioc_event
c_func
(paren
r_void
id|__user
op_star
id|arg
)paren
(brace
id|gdth_ioctl_event
id|evt
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|evt
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_event
)paren
)paren
op_logical_or
id|evt.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|evt.ionode
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evt.erase
op_eq
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|evt.event.event_source
op_eq
id|ES_TEST
)paren
id|evt.event.event_data.size
op_assign
r_sizeof
(paren
id|evt.event.event_data.eu.test
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|evt.event.event_source
op_eq
id|ES_DRIVER
)paren
id|evt.event.event_data.size
op_assign
r_sizeof
(paren
id|evt.event.event_data.eu.driver
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|evt.event.event_source
op_eq
id|ES_SYNC
)paren
id|evt.event.event_data.size
op_assign
r_sizeof
(paren
id|evt.event.event_data.eu.sync
)paren
suffix:semicolon
r_else
id|evt.event.event_data.size
op_assign
r_sizeof
(paren
id|evt.event.event_data.eu.async
)paren
suffix:semicolon
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|gdth_store_event
c_func
(paren
id|ha
comma
id|evt.event.event_source
comma
id|evt.event.event_idx
comma
op_amp
id|evt.event.event_data
)paren
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|evt.erase
op_eq
l_int|0xfe
)paren
(brace
id|gdth_clear_events
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|evt.erase
op_eq
l_int|0
)paren
(brace
id|evt.handle
op_assign
id|gdth_read_event
c_func
(paren
id|ha
comma
id|evt.handle
comma
op_amp
id|evt.event
)paren
suffix:semicolon
)brace
r_else
(brace
id|gdth_readapp_event
c_func
(paren
id|ha
comma
id|evt.erase
comma
op_amp
id|evt.event
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|evt
comma
r_sizeof
(paren
id|gdth_ioctl_event
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ioc_lockdrv
r_static
r_int
id|ioc_lockdrv
c_func
(paren
r_void
id|__user
op_star
id|arg
)paren
(brace
id|gdth_ioctl_lockdrv
id|ldrv
suffix:semicolon
id|unchar
id|i
comma
id|j
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ldrv
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_lockdrv
)paren
)paren
op_logical_or
id|ldrv.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|ldrv.ionode
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ldrv.drive_cnt
op_logical_and
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
id|j
op_assign
id|ldrv.drives
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
id|MAX_HDRIVES
op_logical_or
op_logical_neg
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|present
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ldrv.lock
)paren
(brace
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|lock
op_assign
l_int|1
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|gdth_wait_completion
c_func
(paren
id|ldrv.ionode
comma
id|ha-&gt;bus_cnt
comma
id|j
)paren
suffix:semicolon
id|gdth_stop_timeout
c_func
(paren
id|ldrv.ionode
comma
id|ha-&gt;bus_cnt
comma
id|j
)paren
suffix:semicolon
)brace
r_else
(brace
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|j
)braket
dot
id|lock
op_assign
l_int|0
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|gdth_start_timeout
c_func
(paren
id|ldrv.ionode
comma
id|ha-&gt;bus_cnt
comma
id|j
)paren
suffix:semicolon
id|gdth_next
c_func
(paren
id|ldrv.ionode
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ioc_resetdrv
r_static
r_int
id|ioc_resetdrv
c_func
(paren
r_void
id|__user
op_star
id|arg
comma
r_char
op_star
id|cmnd
)paren
(brace
id|gdth_ioctl_reset
id|res
suffix:semicolon
id|gdth_cmd_str
id|cmd
suffix:semicolon
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|res
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_reset
)paren
)paren
op_logical_or
id|res.ionode
op_ge
id|gdth_ctr_count
op_logical_or
id|res.number
op_ge
id|MAX_HDRIVES
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|hanum
op_assign
id|res.ionode
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;hdr
(braket
id|res.number
)braket
dot
id|present
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
id|cmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd.OpCode
op_assign
id|GDT_CLUST_RESET
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd.u.cache64.DeviceNo
op_assign
id|res.number
suffix:semicolon
r_else
id|cmd.u.cache.DeviceNo
op_assign
id|res.number
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|ha-&gt;sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_req
c_func
(paren
id|srp
comma
op_amp
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|ha-&gt;sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|ha-&gt;sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|ha-&gt;sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|ha-&gt;sdev.id
op_assign
id|scp.target
op_assign
id|ha-&gt;sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|ha-&gt;sdev
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|res
comma
r_sizeof
(paren
id|gdth_ioctl_reset
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ioc_general
r_static
r_int
id|ioc_general
c_func
(paren
r_void
id|__user
op_star
id|arg
comma
r_char
op_star
id|cmnd
)paren
(brace
id|gdth_ioctl_general
id|gen
suffix:semicolon
r_char
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
id|ulong64
id|paddr
suffix:semicolon
r_int
id|hanum
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|gen
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_general
)paren
)paren
op_logical_or
id|gen.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|hanum
op_assign
id|gen.ionode
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gen.data_len
op_plus
id|gen.sense_len
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
op_assign
id|gdth_ioctl_alloc
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|FALSE
comma
op_amp
id|paddr
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|arg
op_plus
r_sizeof
(paren
id|gdth_ioctl_general
)paren
comma
id|gen.data_len
op_plus
id|gen.sense_len
)paren
)paren
(brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gen.command.OpCode
op_eq
id|GDT_IOCTL
)paren
(brace
id|gen.command.u.ioctl.p_param
op_assign
id|paddr
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|gen.command.Service
op_eq
id|CACHESERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
multiline_comment|/* copy elements from 32-bit IOCTL structure */
id|gen.command.u.cache64.BlockCnt
op_assign
id|gen.command.u.cache.BlockCnt
suffix:semicolon
id|gen.command.u.cache64.BlockNo
op_assign
id|gen.command.u.cache.BlockNo
suffix:semicolon
id|gen.command.u.cache64.DeviceNo
op_assign
id|gen.command.u.cache.DeviceNo
suffix:semicolon
multiline_comment|/* addresses */
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|gen.command.u.cache64.DestAddr
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|gen.command.u.cache64.sg_canz
op_assign
l_int|1
suffix:semicolon
id|gen.command.u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.cache64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|gen.data_len
suffix:semicolon
id|gen.command.u.cache64.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|gen.command.u.cache64.DestAddr
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.cache64.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|gen.command.u.cache.DestAddr
op_assign
l_int|0xffffffff
suffix:semicolon
id|gen.command.u.cache.sg_canz
op_assign
l_int|1
suffix:semicolon
id|gen.command.u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
(paren
id|ulong32
)paren
id|paddr
suffix:semicolon
id|gen.command.u.cache.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|gen.data_len
suffix:semicolon
id|gen.command.u.cache.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|gen.command.u.cache.DestAddr
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|gen.command.Service
op_eq
id|SCSIRAWSERVICE
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|GDT_64BIT
)paren
(brace
multiline_comment|/* copy elements from 32-bit IOCTL structure */
r_char
id|cmd
(braket
l_int|16
)braket
suffix:semicolon
id|gen.command.u.raw64.sense_len
op_assign
id|gen.command.u.raw.sense_len
suffix:semicolon
id|gen.command.u.raw64.bus
op_assign
id|gen.command.u.raw.bus
suffix:semicolon
id|gen.command.u.raw64.lun
op_assign
id|gen.command.u.raw.lun
suffix:semicolon
id|gen.command.u.raw64.target
op_assign
id|gen.command.u.raw.target
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd
comma
id|gen.command.u.raw.cmd
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|gen.command.u.raw64.cmd
comma
id|cmd
comma
l_int|16
)paren
suffix:semicolon
id|gen.command.u.raw64.clen
op_assign
id|gen.command.u.raw.clen
suffix:semicolon
id|gen.command.u.raw64.sdlen
op_assign
id|gen.command.u.raw.sdlen
suffix:semicolon
id|gen.command.u.raw64.direction
op_assign
id|gen.command.u.raw.direction
suffix:semicolon
multiline_comment|/* addresses */
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|gen.command.u.raw64.sdata
op_assign
(paren
id|ulong64
)paren
op_minus
l_int|1
suffix:semicolon
id|gen.command.u.raw64.sg_ranz
op_assign
l_int|1
suffix:semicolon
id|gen.command.u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.raw64.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|gen.data_len
suffix:semicolon
id|gen.command.u.raw64.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|gen.command.u.raw64.sdata
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.raw64.sg_ranz
op_assign
l_int|0
suffix:semicolon
)brace
id|gen.command.u.raw64.sense_data
op_assign
id|paddr
op_plus
id|gen.data_len
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;raw_feat
op_amp
id|SCATTER_GATHER
)paren
(brace
id|gen.command.u.raw.sdata
op_assign
l_int|0xffffffff
suffix:semicolon
id|gen.command.u.raw.sg_ranz
op_assign
l_int|1
suffix:semicolon
id|gen.command.u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_ptr
op_assign
(paren
id|ulong32
)paren
id|paddr
suffix:semicolon
id|gen.command.u.raw.sg_lst
(braket
l_int|0
)braket
dot
id|sg_len
op_assign
id|gen.data_len
suffix:semicolon
id|gen.command.u.raw.sg_lst
(braket
l_int|1
)braket
dot
id|sg_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|gen.command.u.raw.sdata
op_assign
id|paddr
suffix:semicolon
id|gen.command.u.raw.sg_ranz
op_assign
l_int|0
suffix:semicolon
)brace
id|gen.command.u.raw.sense_data
op_assign
(paren
id|ulong32
)paren
id|paddr
op_plus
id|gen.data_len
suffix:semicolon
)brace
)brace
r_else
(brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|ha-&gt;sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_req
c_func
(paren
id|srp
comma
op_amp
id|gen.command
comma
id|cmnd
comma
id|gen.timeout
)paren
suffix:semicolon
id|gen.status
op_assign
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|gen.info
op_assign
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|ha-&gt;sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|gen.command
comma
id|cmnd
comma
id|gen.timeout
)paren
suffix:semicolon
id|gen.status
op_assign
id|scp-&gt;SCp.Status
suffix:semicolon
id|gen.info
op_assign
id|scp-&gt;SCp.Message
suffix:semicolon
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|ha-&gt;sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|ha-&gt;sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|ha-&gt;sdev.id
op_assign
id|scp.target
op_assign
id|ha-&gt;sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|ha-&gt;sdev
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|gen.command
comma
id|cmnd
comma
id|gen.timeout
)paren
suffix:semicolon
id|gen.status
op_assign
id|scp.SCp.Status
suffix:semicolon
id|gen.info
op_assign
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
op_plus
r_sizeof
(paren
id|gdth_ioctl_general
)paren
comma
id|buf
comma
id|gen.data_len
op_plus
id|gen.sense_len
)paren
)paren
(brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|gen
comma
r_sizeof
(paren
id|gdth_ioctl_general
)paren
op_minus
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
)paren
(brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|gdth_ioctl_free
c_func
(paren
id|hanum
comma
id|gen.data_len
op_plus
id|gen.sense_len
comma
id|buf
comma
id|paddr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ioc_hdrlist
r_static
r_int
id|ioc_hdrlist
c_func
(paren
r_void
id|__user
op_star
id|arg
comma
r_char
op_star
id|cmnd
)paren
(brace
id|gdth_ioctl_rescan
op_star
id|rsc
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmd
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|unchar
id|i
suffix:semicolon
r_int
id|hanum
comma
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
macro_line|#endif
id|rsc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|rsc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cmd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsc
op_logical_or
op_logical_neg
id|cmd
)paren
r_goto
id|free_fail
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|rsc
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_rescan
)paren
)paren
op_logical_or
id|rsc-&gt;ionode
op_ge
id|gdth_ctr_count
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|free_fail
suffix:semicolon
)brace
id|hanum
op_assign
id|rsc-&gt;ionode
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|ha-&gt;sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
r_goto
id|free_fail
suffix:semicolon
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|ha-&gt;sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_goto
id|free_fail
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|ha-&gt;sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|ha-&gt;sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|ha-&gt;sdev.id
op_assign
id|scp.target
op_assign
id|ha-&gt;sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|ha-&gt;sdev
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
)paren
(brace
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|bus
op_assign
l_int|0xff
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|bus
op_assign
id|ha-&gt;virt_bus
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|target
op_assign
id|i
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|lun
op_assign
l_int|0
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|cluster_type
op_assign
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|cluster_type
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|cluster_type
op_amp
id|CLUSTER_DRIVE
)paren
(brace
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd-&gt;OpCode
op_assign
id|GDT_CLUST_INFO
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
r_else
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srp-&gt;sr_command-&gt;SCp.Status
op_eq
id|S_OK
)paren
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|cluster_type
op_assign
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp-&gt;SCp.Status
op_eq
id|S_OK
)paren
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|cluster_type
op_assign
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scp.SCp.Status
op_eq
id|S_OK
)paren
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|cluster_type
op_assign
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#endif       
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
id|rsc
comma
r_sizeof
(paren
id|gdth_ioctl_rescan
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|rc
op_assign
l_int|0
suffix:semicolon
id|free_fail
suffix:colon
id|kfree
c_func
(paren
id|rsc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|ioc_rescan
r_static
r_int
id|ioc_rescan
c_func
(paren
r_void
id|__user
op_star
id|arg
comma
r_char
op_star
id|cmnd
)paren
(brace
id|gdth_ioctl_rescan
op_star
id|rsc
suffix:semicolon
id|gdth_cmd_str
op_star
id|cmd
suffix:semicolon
id|ushort
id|i
comma
id|status
comma
id|hdr_cnt
suffix:semicolon
id|ulong32
id|info
suffix:semicolon
r_int
id|hanum
comma
id|cyls
comma
id|hds
comma
id|secs
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
macro_line|#endif
id|rsc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|rsc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cmd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd
op_logical_or
op_logical_neg
id|rsc
)paren
r_goto
id|free_fail
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|rsc
comma
id|arg
comma
r_sizeof
(paren
id|gdth_ioctl_rescan
)paren
)paren
op_logical_or
id|rsc-&gt;ionode
op_ge
id|gdth_ctr_count
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|free_fail
suffix:semicolon
)brace
id|hanum
op_assign
id|rsc-&gt;ionode
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|gdth_cmd_str
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|ha-&gt;sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
r_goto
id|free_fail
suffix:semicolon
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|ha-&gt;sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_goto
id|free_fail
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|ha-&gt;sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|ha-&gt;sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|ha-&gt;sdev.id
op_assign
id|scp.target
op_assign
id|ha-&gt;sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|ha-&gt;sdev
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rsc-&gt;flag
op_eq
l_int|0
)paren
(brace
multiline_comment|/* old method: re-init. cache service */
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
id|cmd-&gt;OpCode
op_assign
id|GDT_X_INIT_HOST
suffix:semicolon
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|LINUX_OS
suffix:semicolon
)brace
r_else
(brace
id|cmd-&gt;OpCode
op_assign
id|GDT_INIT
suffix:semicolon
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|LINUX_OS
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
id|i
op_assign
l_int|0
suffix:semicolon
id|hdr_cnt
op_assign
(paren
id|status
op_eq
id|S_OK
ques
c_cond
(paren
id|ushort
)paren
id|info
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
id|rsc-&gt;hdr_no
suffix:semicolon
id|hdr_cnt
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|hdr_cnt
op_logical_and
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd-&gt;OpCode
op_assign
id|GDT_INFO
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
r_else
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|bus
op_assign
id|ha-&gt;virt_bus
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|target
op_assign
id|i
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|lun
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|S_OK
)paren
(brace
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
(brace
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
op_assign
id|TRUE
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|size
op_assign
id|info
suffix:semicolon
multiline_comment|/* evaluate mapping */
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|size
op_and_assign
op_complement
id|SECS32
suffix:semicolon
id|gdth_eval_mapping
c_func
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|size
comma
op_amp
id|cyls
comma
op_amp
id|hds
comma
op_amp
id|secs
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|heads
op_assign
id|hds
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|secs
op_assign
id|secs
suffix:semicolon
multiline_comment|/* round size */
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|size
op_assign
id|cyls
op_star
id|hds
op_star
id|secs
suffix:semicolon
)brace
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|S_OK
)paren
r_continue
suffix:semicolon
multiline_comment|/* extended info, if GDT_64BIT, for drives &gt; 2 TB */
multiline_comment|/* but we need ha-&gt;info2, not yet stored in scp-&gt;SCp */
multiline_comment|/* devtype, cluster info, R/W attribs */
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd-&gt;OpCode
op_assign
id|GDT_DEVTYPE
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
r_else
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|devtype
op_assign
(paren
id|status
op_eq
id|S_OK
ques
c_cond
(paren
id|ushort
)paren
id|info
suffix:colon
l_int|0
)paren
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd-&gt;OpCode
op_assign
id|GDT_CLUST_INFO
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
r_else
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|cluster_type
op_assign
(paren
(paren
id|status
op_eq
id|S_OK
op_logical_and
op_logical_neg
id|shared_access
)paren
ques
c_cond
(paren
id|ushort
)paren
id|info
suffix:colon
l_int|0
)paren
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|rsc-&gt;hdr_list
(braket
id|i
)braket
dot
id|cluster_type
op_assign
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|cluster_type
suffix:semicolon
id|cmd-&gt;Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|cmd-&gt;OpCode
op_assign
id|GDT_RW_ATTRIBS
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
id|cmd-&gt;u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
r_else
id|cmd-&gt;u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|srp-&gt;sr_command-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|srp-&gt;sr_command-&gt;SCp.Message
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp-&gt;SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp-&gt;SCp.Message
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
id|cmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
id|status
op_assign
(paren
id|ushort
)paren
id|scp.SCp.Status
suffix:semicolon
id|info
op_assign
(paren
id|ulong32
)paren
id|scp.SCp.Message
suffix:semicolon
macro_line|#endif
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|rw_attribs
op_assign
(paren
id|status
op_eq
id|S_OK
ques
c_cond
(paren
id|ushort
)paren
id|info
suffix:colon
l_int|0
)paren
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#endif       
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
id|rsc
comma
r_sizeof
(paren
id|gdth_ioctl_rescan
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|rc
op_assign
l_int|0
suffix:semicolon
id|free_fail
suffix:colon
id|kfree
c_func
(paren
id|rsc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|gdth_ioctl
r_static
r_int
id|gdth_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filep
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
macro_line|#endif
id|ulong
id|flags
suffix:semicolon
r_char
id|cmnd
(braket
id|MAX_COMMAND_SIZE
)braket
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
id|memset
c_func
(paren
id|cmnd
comma
l_int|0xff
comma
l_int|12
)paren
suffix:semicolon
id|TRACE
c_func
(paren
(paren
l_string|&quot;gdth_ioctl() cmd 0x%x&bslash;n&quot;
comma
id|cmd
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|GDTIOCTL_CTRCNT
suffix:colon
(brace
r_int
id|cnt
op_assign
id|gdth_ctr_count
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|cnt
comma
(paren
r_int
id|__user
op_star
)paren
id|argp
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_DRVERS
suffix:colon
(brace
r_int
id|ver
op_assign
(paren
id|GDTH_VERSION
op_lshift
l_int|8
)paren
op_or
id|GDTH_SUBVERSION
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|ver
comma
(paren
r_int
id|__user
op_star
)paren
id|argp
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_OSVERS
suffix:colon
(brace
id|gdth_ioctl_osvers
id|osv
suffix:semicolon
id|osv.version
op_assign
(paren
id|unchar
)paren
(paren
id|LINUX_VERSION_CODE
op_rshift
l_int|16
)paren
suffix:semicolon
id|osv.subversion
op_assign
(paren
id|unchar
)paren
(paren
id|LINUX_VERSION_CODE
op_rshift
l_int|8
)paren
suffix:semicolon
id|osv.revision
op_assign
(paren
id|ushort
)paren
(paren
id|LINUX_VERSION_CODE
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|osv
comma
r_sizeof
(paren
id|gdth_ioctl_osvers
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_CTRTYPE
suffix:colon
(brace
id|gdth_ioctl_ctrtype
id|ctrt
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ctrt
comma
id|argp
comma
r_sizeof
(paren
id|gdth_ioctl_ctrtype
)paren
)paren
op_logical_or
id|ctrt.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|ctrt.ionode
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;type
op_eq
id|GDT_ISA
op_logical_or
id|ha-&gt;type
op_eq
id|GDT_EISA
)paren
(brace
id|ctrt.type
op_assign
(paren
id|unchar
)paren
(paren
(paren
id|ha-&gt;stype
op_rshift
l_int|20
)paren
op_minus
l_int|0x10
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ha-&gt;type
op_ne
id|GDT_PCIMPR
)paren
(brace
id|ctrt.type
op_assign
(paren
id|unchar
)paren
(paren
(paren
id|ha-&gt;stype
op_lshift
l_int|4
)paren
op_plus
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|ctrt.type
op_assign
(paren
id|ha-&gt;oem_id
op_eq
id|OEM_ID_INTEL
ques
c_cond
l_int|0xfd
suffix:colon
l_int|0xfe
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;stype
op_ge
l_int|0x300
)paren
id|ctrt.ext_type
op_assign
l_int|0x6000
op_or
id|ha-&gt;subdevice_id
suffix:semicolon
r_else
id|ctrt.ext_type
op_assign
l_int|0x6000
op_or
id|ha-&gt;stype
suffix:semicolon
)brace
id|ctrt.device_id
op_assign
id|ha-&gt;stype
suffix:semicolon
id|ctrt.sub_device_id
op_assign
id|ha-&gt;subdevice_id
suffix:semicolon
)brace
id|ctrt.info
op_assign
id|ha-&gt;brd_phys
suffix:semicolon
id|ctrt.oem_id
op_assign
id|ha-&gt;oem_id
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|ctrt
comma
r_sizeof
(paren
id|gdth_ioctl_ctrtype
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_GENERAL
suffix:colon
r_return
id|ioc_general
c_func
(paren
id|argp
comma
id|cmnd
)paren
suffix:semicolon
r_case
id|GDTIOCTL_EVENT
suffix:colon
r_return
id|ioc_event
c_func
(paren
id|argp
)paren
suffix:semicolon
r_case
id|GDTIOCTL_LOCKDRV
suffix:colon
r_return
id|ioc_lockdrv
c_func
(paren
id|argp
)paren
suffix:semicolon
r_case
id|GDTIOCTL_LOCKCHN
suffix:colon
(brace
id|gdth_ioctl_lockchn
id|lchn
suffix:semicolon
id|unchar
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|lchn
comma
id|argp
comma
r_sizeof
(paren
id|gdth_ioctl_lockchn
)paren
)paren
op_logical_or
id|lchn.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|lchn.ionode
)braket
)paren
suffix:semicolon
id|i
op_assign
id|lchn.channel
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|ha-&gt;bus_cnt
)paren
(brace
r_if
c_cond
(paren
id|lchn.lock
)paren
(brace
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|lock
op_assign
l_int|1
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ha-&gt;tid_cnt
suffix:semicolon
op_increment
id|j
)paren
(brace
id|gdth_wait_completion
c_func
(paren
id|lchn.ionode
comma
id|i
comma
id|j
)paren
suffix:semicolon
id|gdth_stop_timeout
c_func
(paren
id|lchn.ionode
comma
id|i
comma
id|j
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|GDTH_LOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
id|ha-&gt;raw
(braket
id|i
)braket
dot
id|lock
op_assign
l_int|0
suffix:semicolon
id|GDTH_UNLOCK_HA
c_func
(paren
id|ha
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ha-&gt;tid_cnt
suffix:semicolon
op_increment
id|j
)paren
(brace
id|gdth_start_timeout
c_func
(paren
id|lchn.ionode
comma
id|i
comma
id|j
)paren
suffix:semicolon
id|gdth_next
c_func
(paren
id|lchn.ionode
)paren
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_RESCAN
suffix:colon
r_return
id|ioc_rescan
c_func
(paren
id|argp
comma
id|cmnd
)paren
suffix:semicolon
r_case
id|GDTIOCTL_HDRLIST
suffix:colon
r_return
id|ioc_hdrlist
c_func
(paren
id|argp
comma
id|cmnd
)paren
suffix:semicolon
r_case
id|GDTIOCTL_RESET_BUS
suffix:colon
(brace
id|gdth_ioctl_reset
id|res
suffix:semicolon
r_int
id|hanum
comma
id|rval
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|res
comma
id|argp
comma
r_sizeof
(paren
id|gdth_ioctl_reset
)paren
)paren
op_logical_or
id|res.ionode
op_ge
id|gdth_ctr_count
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|hanum
op_assign
id|res.ionode
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
multiline_comment|/* Because we need a Scsi_Cmnd struct., we make a scsi_allocate device also for kernels &gt;=2.6.x */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scp
op_assign
id|scsi_get_command
c_func
(paren
id|ha-&gt;sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;device-&gt;channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|res.number
suffix:semicolon
id|rval
op_assign
id|gdth_eh_bus_reset
c_func
(paren
id|scp
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|rval
op_eq
id|SUCCESS
ques
c_cond
id|S_OK
suffix:colon
id|S_GENERR
)paren
suffix:semicolon
id|scsi_put_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|ha-&gt;sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
id|scp-&gt;channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|res.number
suffix:semicolon
id|rval
op_assign
id|gdth_eh_bus_reset
c_func
(paren
id|scp
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|rval
op_eq
id|SUCCESS
ques
c_cond
id|S_OK
suffix:colon
id|S_GENERR
)paren
suffix:semicolon
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
macro_line|#else 
id|memset
c_func
(paren
op_amp
id|ha-&gt;sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|ha-&gt;sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|ha-&gt;sdev.id
op_assign
id|scp.target
op_assign
id|ha-&gt;sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|ha-&gt;sdev
suffix:semicolon
id|scp.channel
op_assign
id|virt_ctr
ques
c_cond
l_int|0
suffix:colon
id|res.number
suffix:semicolon
id|rval
op_assign
id|gdth_eh_bus_reset
c_func
(paren
op_amp
id|scp
)paren
suffix:semicolon
id|res.status
op_assign
(paren
id|rval
op_eq
id|SUCCESS
ques
c_cond
id|S_OK
suffix:colon
id|S_GENERR
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|res
comma
r_sizeof
(paren
id|gdth_ioctl_reset
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|GDTIOCTL_RESET_DRV
suffix:colon
r_return
id|ioc_resetdrv
c_func
(paren
id|argp
comma
id|cmnd
)paren
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* flush routine */
DECL|function|gdth_flush
r_static
r_void
id|gdth_flush
c_func
(paren
r_int
id|hanum
)paren
(brace
r_int
id|i
suffix:semicolon
id|gdth_ha_str
op_star
id|ha
suffix:semicolon
id|gdth_cmd_str
id|gdtcmd
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
id|Scsi_Device
id|sdev
suffix:semicolon
macro_line|#endif
r_char
id|cmnd
(braket
id|MAX_COMMAND_SIZE
)braket
suffix:semicolon
id|memset
c_func
(paren
id|cmnd
comma
l_int|0xff
comma
id|MAX_COMMAND_SIZE
)paren
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_flush() hanum %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
id|ha
op_assign
id|HADATA
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
r_return
suffix:semicolon
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
r_return
suffix:semicolon
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|sdev.id
op_assign
id|scp.target
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|sdev
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HDRIVES
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ha-&gt;hdr
(braket
id|i
)braket
dot
id|present
)paren
(brace
id|gdtcmd.BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_FLUSH
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;cache_feat
op_amp
id|GDT_64BIT
)paren
(brace
id|gdtcmd.u.cache64.DeviceNo
op_assign
id|i
suffix:semicolon
id|gdtcmd.u.cache64.BlockNo
op_assign
l_int|1
suffix:semicolon
id|gdtcmd.u.cache64.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|gdtcmd.u.cache.DeviceNo
op_assign
id|i
suffix:semicolon
id|gdtcmd.u.cache.BlockNo
op_assign
l_int|1
suffix:semicolon
id|gdtcmd.u.cache.sg_canz
op_assign
l_int|0
suffix:semicolon
)brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_flush(): flush ha %d drive %d&bslash;n&quot;
comma
id|hanum
comma
id|i
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|gdth_do_req
c_func
(paren
id|srp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#else
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|30
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* shutdown routine */
DECL|function|gdth_halt
r_static
r_int
id|gdth_halt
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
comma
id|ulong
id|event
comma
r_void
op_star
id|buf
)paren
(brace
r_int
id|hanum
suffix:semicolon
macro_line|#ifndef __alpha__
id|gdth_cmd_str
id|gdtcmd
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|Scsi_Request
op_star
id|srp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|Scsi_Cmnd
op_star
id|scp
suffix:semicolon
id|Scsi_Device
op_star
id|sdev
suffix:semicolon
macro_line|#else
id|Scsi_Cmnd
id|scp
suffix:semicolon
id|Scsi_Device
id|sdev
suffix:semicolon
macro_line|#endif
r_char
id|cmnd
(braket
id|MAX_COMMAND_SIZE
)braket
suffix:semicolon
macro_line|#endif
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt() event %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|event
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|event
op_ne
id|SYS_RESTART
op_logical_and
id|event
op_ne
id|SYS_HALT
op_logical_and
id|event
op_ne
id|SYS_POWER_OFF
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GDT-HA: Flushing all host drives .. &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hanum
op_assign
l_int|0
suffix:semicolon
id|hanum
OL
id|gdth_ctr_count
suffix:semicolon
op_increment
id|hanum
)paren
(brace
id|gdth_flush
c_func
(paren
id|hanum
)paren
suffix:semicolon
macro_line|#ifndef __alpha__
multiline_comment|/* controller reset */
id|memset
c_func
(paren
id|cmnd
comma
l_int|0xff
comma
id|MAX_COMMAND_SIZE
)paren
suffix:semicolon
id|gdtcmd.BoardNode
op_assign
id|LOCALBOARD
suffix:semicolon
id|gdtcmd.Service
op_assign
id|CACHESERVICE
suffix:semicolon
id|gdtcmd.OpCode
op_assign
id|GDT_RESET
suffix:semicolon
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_halt(): reset controller %d&bslash;n&quot;
comma
id|hanum
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|srp
op_assign
id|scsi_allocate_request
c_func
(paren
id|sdev
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srp
)paren
(brace
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
id|srp-&gt;sr_cmd_len
op_assign
l_int|12
suffix:semicolon
id|srp-&gt;sr_use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_req
c_func
(paren
id|srp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|10
)paren
suffix:semicolon
id|scsi_release_request
c_func
(paren
id|srp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#elif LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
id|sdev
op_assign
id|scsi_get_host_dev
c_func
(paren
id|gdth_ctr_tab
(braket
id|hanum
)braket
)paren
suffix:semicolon
id|scp
op_assign
id|scsi_allocate_device
c_func
(paren
id|sdev
comma
l_int|1
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scp
)paren
(brace
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
id|scp-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|scp-&gt;use_sg
op_assign
l_int|0
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|10
)paren
suffix:semicolon
id|scsi_release_command
c_func
(paren
id|scp
)paren
suffix:semicolon
id|scsi_free_host_dev
c_func
(paren
id|sdev
)paren
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
op_amp
id|sdev
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Device
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scp
comma
l_int|0
comma
r_sizeof
(paren
id|Scsi_Cmnd
)paren
)paren
suffix:semicolon
id|sdev.host
op_assign
id|scp.host
op_assign
id|gdth_ctr_tab
(braket
id|hanum
)braket
suffix:semicolon
id|sdev.id
op_assign
id|scp.target
op_assign
id|sdev.host-&gt;this_id
suffix:semicolon
id|scp.device
op_assign
op_amp
id|sdev
suffix:semicolon
id|gdth_do_cmd
c_func
(paren
op_amp
id|scp
comma
op_amp
id|gdtcmd
comma
id|cmnd
comma
l_int|10
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
)brace
id|printk
c_func
(paren
l_string|&quot;Done.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef GDTH_STATISTICS
id|del_timer
c_func
(paren
op_amp
id|gdth_timer
)paren
suffix:semicolon
macro_line|#endif
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|gdth_notifier
)paren
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,0) &amp;&amp; !defined(MODULE)
DECL|function|GDTH_INITFUNC
id|GDTH_INITFUNC
c_func
(paren
r_void
comma
id|gdth_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
)paren
(brace
id|TRACE2
c_func
(paren
(paren
l_string|&quot;gdth_setup() str %s ints[0] %d&bslash;n&quot;
comma
id|str
ques
c_cond
id|str
suffix:colon
l_string|&quot;NULL&quot;
comma
id|ints
ques
c_cond
id|ints
(braket
l_int|0
)braket
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|internal_setup
c_func
(paren
id|str
comma
id|ints
)paren
suffix:semicolon
)brace
macro_line|#else
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,0)
DECL|variable|driver_template
r_static
id|Scsi_Host_Template
id|driver_template
op_assign
(brace
dot
id|proc_name
op_assign
l_string|&quot;gdth&quot;
comma
dot
id|proc_info
op_assign
id|gdth_proc_info
comma
dot
id|name
op_assign
l_string|&quot;GDT SCSI Disk Array Controller&quot;
comma
dot
id|detect
op_assign
id|gdth_detect
comma
dot
id|release
op_assign
id|gdth_release
comma
dot
id|info
op_assign
id|gdth_info
comma
dot
id|queuecommand
op_assign
id|gdth_queuecommand
comma
dot
id|eh_abort_handler
op_assign
id|gdth_eh_abort
comma
dot
id|eh_device_reset_handler
op_assign
id|gdth_eh_device_reset
comma
dot
id|eh_bus_reset_handler
op_assign
id|gdth_eh_bus_reset
comma
dot
id|eh_host_reset_handler
op_assign
id|gdth_eh_host_reset
comma
dot
id|bios_param
op_assign
id|gdth_bios_param
comma
dot
id|can_queue
op_assign
id|GDTH_MAXCMDS
comma
dot
id|this_id
op_assign
op_minus
l_int|1
comma
dot
id|sg_tablesize
op_assign
id|GDTH_MAXSG
comma
dot
id|cmd_per_lun
op_assign
id|GDTH_MAXC_P_L
comma
dot
id|unchecked_isa_dma
op_assign
l_int|1
comma
dot
id|use_clustering
op_assign
id|ENABLE_CLUSTERING
comma
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)
dot
id|use_new_eh_code
op_assign
l_int|1
comma
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,4,20)
dot
id|highmem_io
op_assign
l_int|1
comma
macro_line|#endif
macro_line|#endif
)brace
suffix:semicolon
macro_line|#else
DECL|variable|driver_template
r_static
id|Scsi_Host_Template
id|driver_template
op_assign
id|GDTH
suffix:semicolon
macro_line|#endif
macro_line|#include &quot;scsi_module.c&quot;
macro_line|#ifndef MODULE
id|__setup
c_func
(paren
l_string|&quot;gdth=&quot;
comma
id|option_setup
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
eof
