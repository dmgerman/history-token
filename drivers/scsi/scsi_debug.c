multiline_comment|/*&n; *  linux/kernel/scsi_debug.c&n; * vvvvvvvvvvvvvvvvvvvvvvv Original vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv&n; *  Copyright (C) 1992  Eric Youngdale&n; *  Simulate a host adapter with 2 disks attached.  Do a lot of checking&n; *  to make sure that we are not getting blocks mixed up, and PANIC if&n; *  anything out of the ordinary is seen.&n; * ^^^^^^^^^^^^^^^^^^^^^^^ Original ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&n; *&n; *  This version is more generic, simulating a variable number of disk&n; *  (or disk like devices) sharing a common amount of RAM&n; *&n; *&n; *  For documentation see http://www.torque.net/sg/sdebug26.html&n; *&n; *   D. Gilbert (dpg) work for Magneto-Optical device test [20010421]&n; *   dpg: work for devfs large number of disks [20010809]&n; *        forked for lk 2.5 series [20011216, 20020101]&n; *        use vmalloc() more inquiry+mode_sense [20020302]&n; *        add timers for delayed responses [20020721]&n; *   Patrick Mansfield &lt;patmans@us.ibm.com&gt; max_luns+scsi_level [20021031]&n; *   Mike Anderson &lt;andmike@us.ibm.com&gt; sysfs work [20021118]&n; *   dpg: change style of boot options to &quot;scsi_debug.num_tgts=2&quot; and&n; *        module options to &quot;modprobe scsi_debug num_tgts=2&quot; [20021221]&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/genhd.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &lt;scsi/scsicam.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#ifndef LINUX_VERSION_CODE
macro_line|#include &lt;linux/version.h&gt;
macro_line|#endif
macro_line|#include &quot;scsi_logging.h&quot;
macro_line|#include &quot;scsi_debug.h&quot;
DECL|macro|SCSI_DEBUG_VERSION
mdefine_line|#define SCSI_DEBUG_VERSION &quot;1.75&quot;
DECL|variable|scsi_debug_version_date
r_static
r_const
r_char
op_star
id|scsi_debug_version_date
op_assign
l_string|&quot;20050113&quot;
suffix:semicolon
multiline_comment|/* Additional Sense Code (ASC) used */
DECL|macro|NO_ADDED_SENSE
mdefine_line|#define NO_ADDED_SENSE 0x0
DECL|macro|UNRECOVERED_READ_ERR
mdefine_line|#define UNRECOVERED_READ_ERR 0x11
DECL|macro|INVALID_OPCODE
mdefine_line|#define INVALID_OPCODE 0x20
DECL|macro|ADDR_OUT_OF_RANGE
mdefine_line|#define ADDR_OUT_OF_RANGE 0x21
DECL|macro|INVALID_FIELD_IN_CDB
mdefine_line|#define INVALID_FIELD_IN_CDB 0x24
DECL|macro|POWERON_RESET
mdefine_line|#define POWERON_RESET 0x29
DECL|macro|SAVING_PARAMS_UNSUP
mdefine_line|#define SAVING_PARAMS_UNSUP 0x39
DECL|macro|THRESHHOLD_EXCEEDED
mdefine_line|#define THRESHHOLD_EXCEEDED 0x5d
DECL|macro|SDEBUG_TAGGED_QUEUING
mdefine_line|#define SDEBUG_TAGGED_QUEUING 0 /* 0 | MSG_SIMPLE_TAG | MSG_ORDERED_TAG */
multiline_comment|/* Default values for driver parameters */
DECL|macro|DEF_NUM_HOST
mdefine_line|#define DEF_NUM_HOST   1
DECL|macro|DEF_NUM_TGTS
mdefine_line|#define DEF_NUM_TGTS   1
DECL|macro|DEF_MAX_LUNS
mdefine_line|#define DEF_MAX_LUNS   1
multiline_comment|/* With these defaults, this driver will make 1 host with 1 target&n; * (id 0) containing 1 logical unit (lun 0). That is 1 device.&n; */
DECL|macro|DEF_DELAY
mdefine_line|#define DEF_DELAY   1
DECL|macro|DEF_DEV_SIZE_MB
mdefine_line|#define DEF_DEV_SIZE_MB   8
DECL|macro|DEF_EVERY_NTH
mdefine_line|#define DEF_EVERY_NTH   0
DECL|macro|DEF_NUM_PARTS
mdefine_line|#define DEF_NUM_PARTS   0
DECL|macro|DEF_OPTS
mdefine_line|#define DEF_OPTS   0
DECL|macro|DEF_SCSI_LEVEL
mdefine_line|#define DEF_SCSI_LEVEL   5    /* INQUIRY, byte2 [5-&gt;SPC-3] */
DECL|macro|DEF_PTYPE
mdefine_line|#define DEF_PTYPE   0
DECL|macro|DEF_D_SENSE
mdefine_line|#define DEF_D_SENSE   0
multiline_comment|/* bit mask values for scsi_debug_opts */
DECL|macro|SCSI_DEBUG_OPT_NOISE
mdefine_line|#define SCSI_DEBUG_OPT_NOISE   1
DECL|macro|SCSI_DEBUG_OPT_MEDIUM_ERR
mdefine_line|#define SCSI_DEBUG_OPT_MEDIUM_ERR   2
DECL|macro|SCSI_DEBUG_OPT_TIMEOUT
mdefine_line|#define SCSI_DEBUG_OPT_TIMEOUT   4
DECL|macro|SCSI_DEBUG_OPT_RECOVERED_ERR
mdefine_line|#define SCSI_DEBUG_OPT_RECOVERED_ERR   8
multiline_comment|/* When &quot;every_nth&quot; &gt; 0 then modulo &quot;every_nth&quot; commands:&n; *   - a no response is simulated if SCSI_DEBUG_OPT_TIMEOUT is set&n; *   - a RECOVERED_ERROR is simulated on successful read and write&n; *     commands if SCSI_DEBUG_OPT_RECOVERED_ERR is set.&n; *&n; * When &quot;every_nth&quot; &lt; 0 then after &quot;- every_nth&quot; commands:&n; *   - a no response is simulated if SCSI_DEBUG_OPT_TIMEOUT is set&n; *   - a RECOVERED_ERROR is simulated on successful read and write&n; *     commands if SCSI_DEBUG_OPT_RECOVERED_ERR is set.&n; * This will continue until some other action occurs (e.g. the user&n; * writing a new value (other than -1 or 1) to every_nth via sysfs).&n; */
multiline_comment|/* when 1==SCSI_DEBUG_OPT_MEDIUM_ERR, a medium error is simulated at this&n; * sector on read commands: */
DECL|macro|OPT_MEDIUM_ERR_ADDR
mdefine_line|#define OPT_MEDIUM_ERR_ADDR   0x1234 /* that&squot;s sector 4660 in decimal */
multiline_comment|/* If REPORT LUNS has luns &gt;= 256 it can choose &quot;flat space&quot; (value 1)&n; * or &quot;peripheral device&quot; addressing (value 0) */
DECL|macro|SAM2_LUN_ADDRESS_METHOD
mdefine_line|#define SAM2_LUN_ADDRESS_METHOD 0
DECL|variable|scsi_debug_add_host
r_static
r_int
id|scsi_debug_add_host
op_assign
id|DEF_NUM_HOST
suffix:semicolon
DECL|variable|scsi_debug_delay
r_static
r_int
id|scsi_debug_delay
op_assign
id|DEF_DELAY
suffix:semicolon
DECL|variable|scsi_debug_dev_size_mb
r_static
r_int
id|scsi_debug_dev_size_mb
op_assign
id|DEF_DEV_SIZE_MB
suffix:semicolon
DECL|variable|scsi_debug_every_nth
r_static
r_int
id|scsi_debug_every_nth
op_assign
id|DEF_EVERY_NTH
suffix:semicolon
DECL|variable|scsi_debug_max_luns
r_static
r_int
id|scsi_debug_max_luns
op_assign
id|DEF_MAX_LUNS
suffix:semicolon
DECL|variable|scsi_debug_num_parts
r_static
r_int
id|scsi_debug_num_parts
op_assign
id|DEF_NUM_PARTS
suffix:semicolon
DECL|variable|scsi_debug_num_tgts
r_static
r_int
id|scsi_debug_num_tgts
op_assign
id|DEF_NUM_TGTS
suffix:semicolon
multiline_comment|/* targets per host */
DECL|variable|scsi_debug_opts
r_static
r_int
id|scsi_debug_opts
op_assign
id|DEF_OPTS
suffix:semicolon
DECL|variable|scsi_debug_scsi_level
r_static
r_int
id|scsi_debug_scsi_level
op_assign
id|DEF_SCSI_LEVEL
suffix:semicolon
DECL|variable|scsi_debug_ptype
r_static
r_int
id|scsi_debug_ptype
op_assign
id|DEF_PTYPE
suffix:semicolon
multiline_comment|/* SCSI peripheral type (0==disk) */
DECL|variable|scsi_debug_dsense
r_static
r_int
id|scsi_debug_dsense
op_assign
id|DEF_D_SENSE
suffix:semicolon
DECL|variable|scsi_debug_cmnd_count
r_static
r_int
id|scsi_debug_cmnd_count
op_assign
l_int|0
suffix:semicolon
DECL|macro|DEV_READONLY
mdefine_line|#define DEV_READONLY(TGT)      (0)
DECL|macro|DEV_REMOVEABLE
mdefine_line|#define DEV_REMOVEABLE(TGT)    (0)
DECL|variable|sdebug_store_size
r_static
r_int
r_int
id|sdebug_store_size
suffix:semicolon
multiline_comment|/* in bytes */
DECL|variable|sdebug_capacity
r_static
id|sector_t
id|sdebug_capacity
suffix:semicolon
multiline_comment|/* in sectors */
multiline_comment|/* old BIOS stuff, kernel may get rid of them but some mode sense pages&n;   may still need them */
DECL|variable|sdebug_heads
r_static
r_int
id|sdebug_heads
suffix:semicolon
multiline_comment|/* heads per disk */
DECL|variable|sdebug_cylinders_per
r_static
r_int
id|sdebug_cylinders_per
suffix:semicolon
multiline_comment|/* cylinders per surface */
DECL|variable|sdebug_sectors_per
r_static
r_int
id|sdebug_sectors_per
suffix:semicolon
multiline_comment|/* sectors per cylinder */
multiline_comment|/* default sector size is 512 bytes, 2**9 bytes */
DECL|macro|POW2_SECT_SIZE
mdefine_line|#define POW2_SECT_SIZE 9
DECL|macro|SECT_SIZE
mdefine_line|#define SECT_SIZE (1 &lt;&lt; POW2_SECT_SIZE)
DECL|macro|SECT_SIZE_PER
mdefine_line|#define SECT_SIZE_PER(TGT) SECT_SIZE
DECL|macro|SDEBUG_MAX_PARTS
mdefine_line|#define SDEBUG_MAX_PARTS 4
DECL|macro|SDEBUG_SENSE_LEN
mdefine_line|#define SDEBUG_SENSE_LEN 32
DECL|struct|sdebug_dev_info
r_struct
id|sdebug_dev_info
(brace
DECL|member|dev_list
r_struct
id|list_head
id|dev_list
suffix:semicolon
DECL|member|sense_buff
r_int
r_char
id|sense_buff
(braket
id|SDEBUG_SENSE_LEN
)braket
suffix:semicolon
multiline_comment|/* weak nexus */
DECL|member|channel
r_int
r_int
id|channel
suffix:semicolon
DECL|member|target
r_int
r_int
id|target
suffix:semicolon
DECL|member|lun
r_int
r_int
id|lun
suffix:semicolon
DECL|member|sdbg_host
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
DECL|member|reset
r_char
id|reset
suffix:semicolon
DECL|member|used
r_char
id|used
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sdebug_host_info
r_struct
id|sdebug_host_info
(brace
DECL|member|host_list
r_struct
id|list_head
id|host_list
suffix:semicolon
DECL|member|shost
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
DECL|member|dev
r_struct
id|device
id|dev
suffix:semicolon
DECL|member|dev_info_list
r_struct
id|list_head
id|dev_info_list
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|to_sdebug_host
mdefine_line|#define to_sdebug_host(d)&t;&bslash;&n;&t;container_of(d, struct sdebug_host_info, dev)
r_static
id|LIST_HEAD
c_func
(paren
id|sdebug_host_list
)paren
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|sdebug_host_list_lock
)paren
suffix:semicolon
DECL|typedef|done_funct_t
r_typedef
r_void
(paren
op_star
id|done_funct_t
)paren
(paren
r_struct
id|scsi_cmnd
op_star
)paren
suffix:semicolon
DECL|struct|sdebug_queued_cmd
r_struct
id|sdebug_queued_cmd
(brace
DECL|member|in_use
r_int
id|in_use
suffix:semicolon
DECL|member|cmnd_timer
r_struct
id|timer_list
id|cmnd_timer
suffix:semicolon
DECL|member|done_funct
id|done_funct_t
id|done_funct
suffix:semicolon
DECL|member|a_cmnd
r_struct
id|scsi_cmnd
op_star
id|a_cmnd
suffix:semicolon
DECL|member|scsi_result
r_int
id|scsi_result
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|queued_arr
r_static
r_struct
id|sdebug_queued_cmd
id|queued_arr
(braket
id|SCSI_DEBUG_CANQUEUE
)braket
suffix:semicolon
DECL|variable|sdebug_driver_template
r_static
id|Scsi_Host_Template
id|sdebug_driver_template
op_assign
(brace
dot
id|proc_info
op_assign
id|scsi_debug_proc_info
comma
dot
id|name
op_assign
l_string|&quot;SCSI DEBUG&quot;
comma
dot
id|info
op_assign
id|scsi_debug_info
comma
dot
id|slave_alloc
op_assign
id|scsi_debug_slave_alloc
comma
dot
id|slave_configure
op_assign
id|scsi_debug_slave_configure
comma
dot
id|slave_destroy
op_assign
id|scsi_debug_slave_destroy
comma
dot
id|ioctl
op_assign
id|scsi_debug_ioctl
comma
dot
id|queuecommand
op_assign
id|scsi_debug_queuecommand
comma
dot
id|eh_abort_handler
op_assign
id|scsi_debug_abort
comma
dot
id|eh_bus_reset_handler
op_assign
id|scsi_debug_bus_reset
comma
dot
id|eh_device_reset_handler
op_assign
id|scsi_debug_device_reset
comma
dot
id|eh_host_reset_handler
op_assign
id|scsi_debug_host_reset
comma
dot
id|bios_param
op_assign
id|scsi_debug_biosparam
comma
dot
id|can_queue
op_assign
id|SCSI_DEBUG_CANQUEUE
comma
dot
id|this_id
op_assign
l_int|7
comma
dot
id|sg_tablesize
op_assign
l_int|64
comma
dot
id|cmd_per_lun
op_assign
l_int|3
comma
dot
id|max_sectors
op_assign
l_int|4096
comma
dot
id|unchecked_isa_dma
op_assign
l_int|0
comma
dot
id|use_clustering
op_assign
id|DISABLE_CLUSTERING
comma
dot
id|module
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
DECL|variable|fake_storep
r_static
r_int
r_char
op_star
id|fake_storep
suffix:semicolon
multiline_comment|/* ramdisk storage */
DECL|variable|num_aborts
r_static
r_int
id|num_aborts
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_dev_resets
r_static
r_int
id|num_dev_resets
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_bus_resets
r_static
r_int
id|num_bus_resets
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_host_resets
r_static
r_int
id|num_host_resets
op_assign
l_int|0
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|queued_arr_lock
)paren
suffix:semicolon
r_static
id|DEFINE_RWLOCK
c_func
(paren
id|atomic_rw
)paren
suffix:semicolon
DECL|variable|sdebug_proc_name
r_static
r_char
id|sdebug_proc_name
(braket
)braket
op_assign
l_string|&quot;scsi_debug&quot;
suffix:semicolon
r_static
r_int
id|sdebug_driver_probe
c_func
(paren
r_struct
id|device
op_star
)paren
suffix:semicolon
r_static
r_int
id|sdebug_driver_remove
c_func
(paren
r_struct
id|device
op_star
)paren
suffix:semicolon
DECL|variable|pseudo_lld_bus
r_static
r_struct
id|bus_type
id|pseudo_lld_bus
suffix:semicolon
DECL|variable|sdebug_driverfs_driver
r_static
r_struct
id|device_driver
id|sdebug_driverfs_driver
op_assign
(brace
dot
id|name
op_assign
id|sdebug_proc_name
comma
dot
id|bus
op_assign
op_amp
id|pseudo_lld_bus
comma
dot
id|probe
op_assign
id|sdebug_driver_probe
comma
dot
id|remove
op_assign
id|sdebug_driver_remove
comma
)brace
suffix:semicolon
DECL|variable|check_condition_result
r_static
r_const
r_int
id|check_condition_result
op_assign
(paren
id|DRIVER_SENSE
op_lshift
l_int|24
)paren
op_or
id|SAM_STAT_CHECK_CONDITION
suffix:semicolon
multiline_comment|/* function declarations */
r_static
r_int
id|resp_inquiry
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|target
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_requests
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_readcap
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_mode_sense
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|target
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_read
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|upper_blk
comma
r_int
id|block
comma
r_int
id|num
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_write
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|upper_blk
comma
r_int
id|block
comma
r_int
id|num
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|resp_report_luns
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|fill_from_dev_buffer
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
r_char
op_star
id|arr
comma
r_int
id|arr_len
)paren
suffix:semicolon
r_static
r_int
id|fetch_to_dev_buffer
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
r_char
op_star
id|arr
comma
r_int
id|max_arr_len
)paren
suffix:semicolon
r_static
r_void
id|timer_intr_handler
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_struct
id|sdebug_dev_info
op_star
id|devInfoReg
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
)paren
suffix:semicolon
r_static
r_void
id|mk_sense_buffer
c_func
(paren
r_struct
id|sdebug_dev_info
op_star
id|devip
comma
r_int
id|key
comma
r_int
id|asc
comma
r_int
id|asq
)paren
suffix:semicolon
r_static
r_int
id|check_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
suffix:semicolon
r_static
r_int
id|schedule_resp
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|cmnd
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
comma
id|done_funct_t
id|done
comma
r_int
id|scsi_result
comma
r_int
id|delta_jiff
)paren
suffix:semicolon
r_static
r_void
id|__init
id|sdebug_build_parts
c_func
(paren
r_int
r_char
op_star
id|ramp
)paren
suffix:semicolon
r_static
r_void
id|__init
id|init_all_queued
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|stop_all_queued
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|stop_queued_cmnd
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|cmnd
)paren
suffix:semicolon
r_static
r_int
id|inquiry_evpd_83
c_func
(paren
r_int
r_char
op_star
id|arr
comma
r_int
id|dev_id_num
comma
r_const
r_char
op_star
id|dev_id_str
comma
r_int
id|dev_id_str_len
)paren
suffix:semicolon
r_static
r_void
id|do_create_driverfs_files
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|do_remove_driverfs_files
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sdebug_add_adapter
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|sdebug_remove_adapter
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|sdebug_max_tgts_luns
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|pseudo_primary
r_static
r_struct
id|device
id|pseudo_primary
suffix:semicolon
DECL|variable|pseudo_lld_bus
r_static
r_struct
id|bus_type
id|pseudo_lld_bus
suffix:semicolon
r_static
DECL|function|scsi_debug_queuecommand
r_int
id|scsi_debug_queuecommand
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
id|done_funct_t
id|done
)paren
(brace
r_int
r_char
op_star
id|cmd
op_assign
(paren
r_int
r_char
op_star
)paren
id|SCpnt-&gt;cmnd
suffix:semicolon
r_int
id|block
comma
id|upper_blk
comma
id|num
comma
id|k
suffix:semicolon
r_int
id|errsts
op_assign
l_int|0
suffix:semicolon
r_int
id|target
op_assign
id|SCpnt-&gt;device-&gt;id
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|devip
op_assign
l_int|NULL
suffix:semicolon
r_int
id|inj_recovered
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|done
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* assume mid level reprocessing command */
r_if
c_cond
(paren
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
op_logical_and
id|cmd
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: cmd &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|num
op_assign
id|SCpnt-&gt;cmd_len
suffix:semicolon
id|k
OL
id|num
suffix:semicolon
op_increment
id|k
)paren
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
(paren
r_int
)paren
id|cmd
(braket
id|k
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|target
op_eq
id|sdebug_driver_template.this_id
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: initiator&squot;s id used as &quot;
l_string|&quot;target!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|schedule_resp
c_func
(paren
id|SCpnt
comma
l_int|NULL
comma
id|done
comma
id|DID_NO_CONNECT
op_lshift
l_int|16
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SCpnt-&gt;device-&gt;lun
op_ge
id|scsi_debug_max_luns
)paren
r_return
id|schedule_resp
c_func
(paren
id|SCpnt
comma
l_int|NULL
comma
id|done
comma
id|DID_NO_CONNECT
op_lshift
l_int|16
comma
l_int|0
)paren
suffix:semicolon
id|devip
op_assign
id|devInfoReg
c_func
(paren
id|SCpnt-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|devip
)paren
r_return
id|schedule_resp
c_func
(paren
id|SCpnt
comma
l_int|NULL
comma
id|done
comma
id|DID_NO_CONNECT
op_lshift
l_int|16
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scsi_debug_every_nth
op_ne
l_int|0
)paren
op_logical_and
(paren
op_increment
id|scsi_debug_cmnd_count
op_ge
id|abs
c_func
(paren
id|scsi_debug_every_nth
)paren
)paren
)paren
(brace
id|scsi_debug_cmnd_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_every_nth
OL
op_minus
l_int|1
)paren
id|scsi_debug_every_nth
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_TIMEOUT
op_amp
id|scsi_debug_opts
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* ignore command causing timeout */
r_else
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_RECOVERED_ERR
op_amp
id|scsi_debug_opts
)paren
id|inj_recovered
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* to reads and writes below */
)brace
r_switch
c_cond
(paren
op_star
id|cmd
)paren
(brace
r_case
id|INQUIRY
suffix:colon
multiline_comment|/* mandatory, ignore unit attention */
id|errsts
op_assign
id|resp_inquiry
c_func
(paren
id|SCpnt
comma
id|target
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REQUEST_SENSE
suffix:colon
multiline_comment|/* mandatory, ignore unit attention */
id|errsts
op_assign
id|resp_requests
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REZERO_UNIT
suffix:colon
multiline_comment|/* actually this is REWIND for SSC */
r_case
id|START_STOP
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALLOW_MEDIUM_REMOVAL
suffix:colon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: Medium removal %s&bslash;n&quot;
comma
id|cmd
(braket
l_int|4
)braket
ques
c_cond
l_string|&quot;inhibited&quot;
suffix:colon
l_string|&quot;enabled&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEND_DIAGNOSTIC
suffix:colon
multiline_comment|/* mandatory */
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TEST_UNIT_READY
suffix:colon
multiline_comment|/* mandatory */
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESERVE
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESERVE_10
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RELEASE
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RELEASE_10
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_CAPACITY
suffix:colon
id|errsts
op_assign
id|resp_readcap
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_16
suffix:colon
r_case
id|READ_12
suffix:colon
r_case
id|READ_10
suffix:colon
r_case
id|READ_6
suffix:colon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
)paren
)paren
r_break
suffix:semicolon
id|upper_blk
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|READ_16
)paren
(brace
id|upper_blk
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|block
op_assign
id|cmd
(braket
l_int|9
)braket
op_plus
(paren
id|cmd
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|6
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|13
)braket
op_plus
(paren
id|cmd
(braket
l_int|12
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|11
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|10
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|READ_12
)paren
(brace
id|block
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|9
)braket
op_plus
(paren
id|cmd
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|6
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|READ_10
)paren
(brace
id|block
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|8
)braket
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|block
op_assign
id|cmd
(braket
l_int|3
)braket
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
(paren
id|cmd
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|4
)braket
suffix:semicolon
)brace
id|errsts
op_assign
id|resp_read
c_func
(paren
id|SCpnt
comma
id|upper_blk
comma
id|block
comma
id|num
comma
id|devip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inj_recovered
op_logical_and
(paren
l_int|0
op_eq
id|errsts
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|RECOVERED_ERROR
comma
id|THRESHHOLD_EXCEEDED
comma
l_int|0
)paren
suffix:semicolon
id|errsts
op_assign
id|check_condition_result
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|REPORT_LUNS
suffix:colon
multiline_comment|/* mandatory, ignore unit attention */
id|errsts
op_assign
id|resp_report_luns
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERIFY
suffix:colon
multiline_comment|/* 10 byte SBC-2 command */
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_16
suffix:colon
r_case
id|WRITE_12
suffix:colon
r_case
id|WRITE_10
suffix:colon
r_case
id|WRITE_6
suffix:colon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
)paren
)paren
r_break
suffix:semicolon
id|upper_blk
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|WRITE_16
)paren
(brace
id|upper_blk
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|block
op_assign
id|cmd
(braket
l_int|9
)braket
op_plus
(paren
id|cmd
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|6
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|13
)braket
op_plus
(paren
id|cmd
(braket
l_int|12
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|11
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|10
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|WRITE_12
)paren
(brace
id|block
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|9
)braket
op_plus
(paren
id|cmd
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|6
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|cmd
)paren
op_eq
id|WRITE_10
)paren
(brace
id|block
op_assign
id|cmd
(braket
l_int|5
)braket
op_plus
(paren
id|cmd
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|8
)braket
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|block
op_assign
id|cmd
(braket
l_int|3
)braket
op_plus
(paren
id|cmd
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
(paren
id|cmd
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|num
op_assign
id|cmd
(braket
l_int|4
)braket
suffix:semicolon
)brace
id|errsts
op_assign
id|resp_write
c_func
(paren
id|SCpnt
comma
id|upper_blk
comma
id|block
comma
id|num
comma
id|devip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inj_recovered
op_logical_and
(paren
l_int|0
op_eq
id|errsts
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|RECOVERED_ERROR
comma
id|THRESHHOLD_EXCEEDED
comma
l_int|0
)paren
suffix:semicolon
id|errsts
op_assign
id|check_condition_result
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MODE_SENSE
suffix:colon
r_case
id|MODE_SENSE_10
suffix:colon
id|errsts
op_assign
id|resp_mode_sense
c_func
(paren
id|SCpnt
comma
id|target
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SYNCHRONIZE_CACHE
suffix:colon
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: Opcode: 0x%x not &quot;
l_string|&quot;supported&bslash;n&quot;
comma
op_star
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|SCpnt
comma
id|devip
)paren
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* Unit attention takes precedence */
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_OPCODE
comma
l_int|0
)paren
suffix:semicolon
id|errsts
op_assign
id|check_condition_result
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|schedule_resp
c_func
(paren
id|SCpnt
comma
id|devip
comma
id|done
comma
id|errsts
comma
id|scsi_debug_delay
)paren
suffix:semicolon
)brace
DECL|function|scsi_debug_ioctl
r_static
r_int
id|scsi_debug_ioctl
c_func
(paren
r_struct
id|scsi_device
op_star
id|dev
comma
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: ioctl: cmd=0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* return -ENOTTY; // correct return but upsets fdisk */
)brace
DECL|function|check_reset
r_static
r_int
id|check_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_if
c_cond
(paren
id|devip-&gt;reset
)paren
(brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: Reporting Unit &quot;
l_string|&quot;attention: power on reset&bslash;n&quot;
)paren
suffix:semicolon
id|devip-&gt;reset
op_assign
l_int|0
suffix:semicolon
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|UNIT_ATTENTION
comma
id|POWERON_RESET
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Returns 0 if ok else (DID_ERROR &lt;&lt; 16). Sets scp-&gt;resid . */
DECL|function|fill_from_dev_buffer
r_static
r_int
id|fill_from_dev_buffer
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
r_char
op_star
id|arr
comma
r_int
id|arr_len
)paren
(brace
r_int
id|k
comma
id|req_len
comma
id|act_len
comma
id|len
comma
id|active
suffix:semicolon
r_void
op_star
id|kaddr
suffix:semicolon
r_void
op_star
id|kaddr_off
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sgpnt
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|scp-&gt;request_bufflen
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|scp-&gt;request_buffer
)paren
r_return
(paren
id|DID_ERROR
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|scp-&gt;sc_data_direction
op_eq
id|DMA_BIDIRECTIONAL
)paren
op_logical_or
(paren
id|scp-&gt;sc_data_direction
op_eq
id|DMA_FROM_DEVICE
)paren
)paren
)paren
r_return
(paren
id|DID_ERROR
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|scp-&gt;use_sg
)paren
(brace
id|req_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|act_len
op_assign
(paren
id|req_len
OL
id|arr_len
)paren
ques
c_cond
id|req_len
suffix:colon
id|arr_len
suffix:semicolon
id|memcpy
c_func
(paren
id|scp-&gt;request_buffer
comma
id|arr
comma
id|act_len
)paren
suffix:semicolon
id|scp-&gt;resid
op_assign
id|req_len
op_minus
id|act_len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sgpnt
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
id|active
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|req_len
op_assign
l_int|0
comma
id|act_len
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|k
comma
op_increment
id|sgpnt
)paren
(brace
r_if
c_cond
(paren
id|active
)paren
(brace
id|kaddr
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmap_atomic
c_func
(paren
id|sgpnt-&gt;page
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|kaddr
)paren
r_return
(paren
id|DID_ERROR
op_lshift
l_int|16
)paren
suffix:semicolon
id|kaddr_off
op_assign
(paren
r_int
r_char
op_star
)paren
id|kaddr
op_plus
id|sgpnt-&gt;offset
suffix:semicolon
id|len
op_assign
id|sgpnt-&gt;length
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req_len
op_plus
id|len
)paren
OG
id|arr_len
)paren
(brace
id|active
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|arr_len
op_minus
id|req_len
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|kaddr_off
comma
id|arr
op_plus
id|req_len
comma
id|len
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|kaddr
comma
id|KM_USER0
)paren
suffix:semicolon
id|act_len
op_add_assign
id|len
suffix:semicolon
)brace
id|req_len
op_add_assign
id|sgpnt-&gt;length
suffix:semicolon
)brace
id|scp-&gt;resid
op_assign
id|req_len
op_minus
id|act_len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Returns number of bytes fetched into &squot;arr&squot; or -1 if error. */
DECL|function|fetch_to_dev_buffer
r_static
r_int
id|fetch_to_dev_buffer
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
r_char
op_star
id|arr
comma
r_int
id|max_arr_len
)paren
(brace
r_int
id|k
comma
id|req_len
comma
id|len
comma
id|fin
suffix:semicolon
r_void
op_star
id|kaddr
suffix:semicolon
r_void
op_star
id|kaddr_off
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sgpnt
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|scp-&gt;request_bufflen
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|scp-&gt;request_buffer
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|scp-&gt;sc_data_direction
op_eq
id|DMA_BIDIRECTIONAL
)paren
op_logical_or
(paren
id|scp-&gt;sc_data_direction
op_eq
id|DMA_TO_DEVICE
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|scp-&gt;use_sg
)paren
(brace
id|req_len
op_assign
id|scp-&gt;request_bufflen
suffix:semicolon
id|len
op_assign
(paren
id|req_len
OL
id|max_arr_len
)paren
ques
c_cond
id|req_len
suffix:colon
id|max_arr_len
suffix:semicolon
id|memcpy
c_func
(paren
id|arr
comma
id|scp-&gt;request_buffer
comma
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
id|sgpnt
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|scp-&gt;request_buffer
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|req_len
op_assign
l_int|0
comma
id|fin
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|scp-&gt;use_sg
suffix:semicolon
op_increment
id|k
comma
op_increment
id|sgpnt
)paren
(brace
id|kaddr
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmap_atomic
c_func
(paren
id|sgpnt-&gt;page
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|kaddr
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|kaddr_off
op_assign
(paren
r_int
r_char
op_star
)paren
id|kaddr
op_plus
id|sgpnt-&gt;offset
suffix:semicolon
id|len
op_assign
id|sgpnt-&gt;length
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req_len
op_plus
id|len
)paren
OG
id|max_arr_len
)paren
(brace
id|len
op_assign
id|max_arr_len
op_minus
id|req_len
suffix:semicolon
id|fin
op_assign
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|arr
op_plus
id|req_len
comma
id|kaddr_off
comma
id|len
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|kaddr
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fin
)paren
r_return
id|req_len
op_plus
id|len
suffix:semicolon
id|req_len
op_add_assign
id|sgpnt-&gt;length
suffix:semicolon
)brace
r_return
id|req_len
suffix:semicolon
)brace
DECL|variable|inq_vendor_id
r_static
r_const
r_char
op_star
id|inq_vendor_id
op_assign
l_string|&quot;Linux   &quot;
suffix:semicolon
DECL|variable|inq_product_id
r_static
r_const
r_char
op_star
id|inq_product_id
op_assign
l_string|&quot;scsi_debug      &quot;
suffix:semicolon
DECL|variable|inq_product_rev
r_static
r_const
r_char
op_star
id|inq_product_rev
op_assign
l_string|&quot;0004&quot;
suffix:semicolon
DECL|function|inquiry_evpd_83
r_static
r_int
id|inquiry_evpd_83
c_func
(paren
r_int
r_char
op_star
id|arr
comma
r_int
id|dev_id_num
comma
r_const
r_char
op_star
id|dev_id_str
comma
r_int
id|dev_id_str_len
)paren
(brace
r_int
id|num
suffix:semicolon
multiline_comment|/* Two identification descriptors: */
multiline_comment|/* T10 vendor identifier field format (faked) */
id|arr
(braket
l_int|0
)braket
op_assign
l_int|0x2
suffix:semicolon
multiline_comment|/* ASCII */
id|arr
(braket
l_int|1
)braket
op_assign
l_int|0x1
suffix:semicolon
id|arr
(braket
l_int|2
)braket
op_assign
l_int|0x0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|4
)braket
comma
id|inq_vendor_id
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|12
)braket
comma
id|inq_product_id
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|28
)braket
comma
id|dev_id_str
comma
id|dev_id_str_len
)paren
suffix:semicolon
id|num
op_assign
l_int|8
op_plus
l_int|16
op_plus
id|dev_id_str_len
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
id|num
suffix:semicolon
id|num
op_add_assign
l_int|4
suffix:semicolon
multiline_comment|/* NAA IEEE registered identifier (faked) */
id|arr
(braket
id|num
)braket
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* binary */
id|arr
(braket
id|num
op_plus
l_int|1
)braket
op_assign
l_int|0x3
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|2
)braket
op_assign
l_int|0x0
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|3
)braket
op_assign
l_int|0x8
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|4
)braket
op_assign
l_int|0x51
suffix:semicolon
multiline_comment|/* ieee company id=0x123456 (faked) */
id|arr
(braket
id|num
op_plus
l_int|5
)braket
op_assign
l_int|0x23
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|6
)braket
op_assign
l_int|0x45
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|7
)braket
op_assign
l_int|0x60
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|8
)braket
op_assign
(paren
id|dev_id_num
op_rshift
l_int|24
)paren
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|9
)braket
op_assign
(paren
id|dev_id_num
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|10
)braket
op_assign
(paren
id|dev_id_num
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
id|num
op_plus
l_int|11
)braket
op_assign
id|dev_id_num
op_amp
l_int|0xff
suffix:semicolon
r_return
id|num
op_plus
l_int|12
suffix:semicolon
)brace
DECL|macro|SDEBUG_LONG_INQ_SZ
mdefine_line|#define SDEBUG_LONG_INQ_SZ 96
DECL|macro|SDEBUG_MAX_INQ_ARR_SZ
mdefine_line|#define SDEBUG_MAX_INQ_ARR_SZ 128
DECL|function|resp_inquiry
r_static
r_int
id|resp_inquiry
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
id|target
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_char
id|pq_pdt
suffix:semicolon
r_int
r_char
id|arr
(braket
id|SDEBUG_MAX_INQ_ARR_SZ
)braket
suffix:semicolon
r_int
r_char
op_star
id|cmd
op_assign
(paren
r_int
r_char
op_star
)paren
id|scp-&gt;cmnd
suffix:semicolon
r_int
id|alloc_len
suffix:semicolon
id|alloc_len
op_assign
(paren
id|cmd
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_plus
id|cmd
(braket
l_int|4
)braket
suffix:semicolon
id|memset
c_func
(paren
id|arr
comma
l_int|0
comma
id|SDEBUG_MAX_INQ_ARR_SZ
)paren
suffix:semicolon
id|pq_pdt
op_assign
(paren
id|scsi_debug_ptype
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|arr
(braket
l_int|0
)braket
op_assign
id|pq_pdt
suffix:semicolon
r_if
c_cond
(paren
l_int|0x2
op_amp
id|cmd
(braket
l_int|1
)braket
)paren
(brace
multiline_comment|/* CMDDT bit set */
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_FIELD_IN_CDB
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|0x1
op_amp
id|cmd
(braket
l_int|1
)braket
)paren
(brace
multiline_comment|/* EVPD bit set */
r_int
id|dev_id_num
comma
id|len
suffix:semicolon
r_char
id|dev_id_str
(braket
l_int|6
)braket
suffix:semicolon
id|dev_id_num
op_assign
(paren
(paren
id|devip-&gt;sdbg_host-&gt;shost-&gt;host_no
op_plus
l_int|1
)paren
op_star
l_int|2000
)paren
op_plus
(paren
id|devip-&gt;target
op_star
l_int|1000
)paren
op_plus
id|devip-&gt;lun
suffix:semicolon
id|len
op_assign
id|scnprintf
c_func
(paren
id|dev_id_str
comma
l_int|6
comma
l_string|&quot;%d&quot;
comma
id|dev_id_num
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|cmd
(braket
l_int|2
)braket
)paren
(brace
multiline_comment|/* supported vital product data pages */
id|arr
(braket
l_int|3
)braket
op_assign
l_int|3
suffix:semicolon
id|arr
(braket
l_int|4
)braket
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* this page */
id|arr
(braket
l_int|5
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* unit serial number */
id|arr
(braket
l_int|6
)braket
op_assign
l_int|0x83
suffix:semicolon
multiline_comment|/* device identification */
)brace
r_else
r_if
c_cond
(paren
l_int|0x80
op_eq
id|cmd
(braket
l_int|2
)braket
)paren
(brace
multiline_comment|/* unit serial number */
id|arr
(braket
l_int|1
)braket
op_assign
l_int|0x80
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
id|len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|4
)braket
comma
id|dev_id_str
comma
id|len
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|0x83
op_eq
id|cmd
(braket
l_int|2
)braket
)paren
(brace
multiline_comment|/* device identification */
id|arr
(braket
l_int|1
)braket
op_assign
l_int|0x83
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
id|inquiry_evpd_83
c_func
(paren
op_amp
id|arr
(braket
l_int|4
)braket
comma
id|dev_id_num
comma
id|dev_id_str
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Illegal request, invalid field in cdb */
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_FIELD_IN_CDB
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|min
c_func
(paren
id|alloc_len
comma
id|SDEBUG_MAX_INQ_ARR_SZ
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* drops through here for a standard inquiry */
id|arr
(braket
l_int|1
)braket
op_assign
id|DEV_REMOVEABLE
c_func
(paren
id|target
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* Removable disk */
id|arr
(braket
l_int|2
)braket
op_assign
id|scsi_debug_scsi_level
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* response_data_format==2 */
id|arr
(braket
l_int|4
)braket
op_assign
id|SDEBUG_LONG_INQ_SZ
op_minus
l_int|5
suffix:semicolon
id|arr
(braket
l_int|6
)braket
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* claim: ADDR16 */
multiline_comment|/* arr[6] |= 0x40; ... claim: EncServ (enclosure services) */
id|arr
(braket
l_int|7
)braket
op_assign
l_int|0x3a
suffix:semicolon
multiline_comment|/* claim: WBUS16, SYNC, LINKED + CMDQUE */
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|8
)braket
comma
id|inq_vendor_id
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|16
)braket
comma
id|inq_product_id
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arr
(braket
l_int|32
)braket
comma
id|inq_product_rev
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* version descriptors (2 bytes each) follow */
id|arr
(braket
l_int|58
)braket
op_assign
l_int|0x0
suffix:semicolon
id|arr
(braket
l_int|59
)braket
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* SAM-2 */
id|arr
(braket
l_int|60
)braket
op_assign
l_int|0x3
suffix:semicolon
id|arr
(braket
l_int|61
)braket
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* SPC-3 */
r_if
c_cond
(paren
id|scsi_debug_ptype
op_eq
l_int|0
)paren
(brace
id|arr
(braket
l_int|62
)braket
op_assign
l_int|0x1
suffix:semicolon
id|arr
(braket
l_int|63
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* SBC */
)brace
r_else
r_if
c_cond
(paren
id|scsi_debug_ptype
op_eq
l_int|1
)paren
(brace
id|arr
(braket
l_int|62
)braket
op_assign
l_int|0x2
suffix:semicolon
id|arr
(braket
l_int|63
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* SSC */
)brace
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|min
c_func
(paren
id|alloc_len
comma
id|SDEBUG_LONG_INQ_SZ
)paren
)paren
suffix:semicolon
)brace
DECL|function|resp_requests
r_static
r_int
id|resp_requests
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_char
op_star
id|sbuff
suffix:semicolon
r_int
r_char
op_star
id|cmd
op_assign
(paren
r_int
r_char
op_star
)paren
id|scp-&gt;cmnd
suffix:semicolon
r_int
r_char
id|arr
(braket
id|SDEBUG_SENSE_LEN
)braket
suffix:semicolon
r_int
id|len
op_assign
l_int|18
suffix:semicolon
id|memset
c_func
(paren
id|arr
comma
l_int|0
comma
id|SDEBUG_SENSE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devip-&gt;reset
op_eq
l_int|1
)paren
id|mk_sense_buffer
c_func
(paren
id|devip
comma
l_int|0
comma
id|NO_ADDED_SENSE
comma
l_int|0
)paren
suffix:semicolon
id|sbuff
op_assign
id|devip-&gt;sense_buff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmd
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
op_logical_and
(paren
op_logical_neg
id|scsi_debug_dsense
)paren
)paren
(brace
multiline_comment|/* DESC bit set and sense_buff in fixed format */
id|arr
(braket
l_int|0
)braket
op_assign
l_int|0x72
suffix:semicolon
id|arr
(braket
l_int|1
)braket
op_assign
id|sbuff
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* sense key */
id|arr
(braket
l_int|2
)braket
op_assign
id|sbuff
(braket
l_int|12
)braket
suffix:semicolon
multiline_comment|/* asc */
id|arr
(braket
l_int|3
)braket
op_assign
id|sbuff
(braket
l_int|13
)braket
suffix:semicolon
multiline_comment|/* ascq */
id|len
op_assign
l_int|8
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|arr
comma
id|sbuff
comma
id|SDEBUG_SENSE_LEN
)paren
suffix:semicolon
id|mk_sense_buffer
c_func
(paren
id|devip
comma
l_int|0
comma
id|NO_ADDED_SENSE
comma
l_int|0
)paren
suffix:semicolon
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|len
)paren
suffix:semicolon
)brace
DECL|macro|SDEBUG_READCAP_ARR_SZ
mdefine_line|#define SDEBUG_READCAP_ARR_SZ 8
DECL|function|resp_readcap
r_static
r_int
id|resp_readcap
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_char
id|arr
(braket
id|SDEBUG_READCAP_ARR_SZ
)braket
suffix:semicolon
r_int
r_int
id|capac
suffix:semicolon
r_int
id|errsts
suffix:semicolon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|scp
comma
id|devip
)paren
)paren
)paren
r_return
id|errsts
suffix:semicolon
id|memset
c_func
(paren
id|arr
comma
l_int|0
comma
id|SDEBUG_READCAP_ARR_SZ
)paren
suffix:semicolon
id|capac
op_assign
(paren
r_int
r_int
)paren
id|sdebug_capacity
op_minus
l_int|1
suffix:semicolon
id|arr
(braket
l_int|0
)braket
op_assign
(paren
id|capac
op_rshift
l_int|24
)paren
suffix:semicolon
id|arr
(braket
l_int|1
)braket
op_assign
(paren
id|capac
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|2
)braket
op_assign
(paren
id|capac
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
id|capac
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|6
)braket
op_assign
(paren
id|SECT_SIZE_PER
c_func
(paren
id|target
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|7
)braket
op_assign
id|SECT_SIZE_PER
c_func
(paren
id|target
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|SDEBUG_READCAP_ARR_SZ
)paren
suffix:semicolon
)brace
multiline_comment|/* &lt;&lt;Following mode page info copied from ST318451LW&gt;&gt; */
DECL|function|resp_err_recov_pg
r_static
r_int
id|resp_err_recov_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Read-Write Error Recovery page for mode_sense */
r_int
r_char
id|err_recov_pg
(braket
)braket
op_assign
(brace
l_int|0x1
comma
l_int|0xa
comma
l_int|0xc0
comma
l_int|11
comma
l_int|240
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|5
comma
l_int|0
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|err_recov_pg
comma
r_sizeof
(paren
id|err_recov_pg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|err_recov_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|err_recov_pg
)paren
suffix:semicolon
)brace
DECL|function|resp_disconnect_pg
r_static
r_int
id|resp_disconnect_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Disconnect-Reconnect page for mode_sense */
r_int
r_char
id|disconnect_pg
(braket
)braket
op_assign
(brace
l_int|0x2
comma
l_int|0xe
comma
l_int|128
comma
l_int|128
comma
l_int|0
comma
l_int|10
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|disconnect_pg
comma
r_sizeof
(paren
id|disconnect_pg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|disconnect_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|disconnect_pg
)paren
suffix:semicolon
)brace
DECL|function|resp_format_pg
r_static
r_int
id|resp_format_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Format device page for mode_sense */
r_int
r_char
id|format_pg
(braket
)braket
op_assign
(brace
l_int|0x3
comma
l_int|0x16
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x40
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|format_pg
comma
r_sizeof
(paren
id|format_pg
)paren
)paren
suffix:semicolon
id|p
(braket
l_int|10
)braket
op_assign
(paren
id|sdebug_sectors_per
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|11
)braket
op_assign
id|sdebug_sectors_per
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|12
)braket
op_assign
(paren
id|SECT_SIZE
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|13
)braket
op_assign
id|SECT_SIZE
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|DEV_REMOVEABLE
c_func
(paren
id|target
)paren
)paren
id|p
(braket
l_int|20
)braket
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* should agree with INQUIRY */
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|format_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|format_pg
)paren
suffix:semicolon
)brace
DECL|function|resp_caching_pg
r_static
r_int
id|resp_caching_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Caching page for mode_sense */
r_int
r_char
id|caching_pg
(braket
)braket
op_assign
(brace
l_int|0x8
comma
l_int|18
comma
l_int|0x14
comma
l_int|0
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0
comma
l_int|0
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x80
comma
l_int|0x14
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|caching_pg
comma
r_sizeof
(paren
id|caching_pg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|caching_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|caching_pg
)paren
suffix:semicolon
)brace
DECL|function|resp_ctrl_m_pg
r_static
r_int
id|resp_ctrl_m_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Control mode page for mode_sense */
r_int
r_char
id|ctrl_m_pg
(braket
)braket
op_assign
(brace
l_int|0xa
comma
l_int|10
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x2
comma
l_int|0x4b
)brace
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_dsense
)paren
id|ctrl_m_pg
(braket
l_int|2
)braket
op_or_assign
l_int|0x4
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|ctrl_m_pg
comma
r_sizeof
(paren
id|ctrl_m_pg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|ctrl_m_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|ctrl_m_pg
)paren
suffix:semicolon
)brace
DECL|function|resp_iec_m_pg
r_static
r_int
id|resp_iec_m_pg
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|pcontrol
comma
r_int
id|target
)paren
(brace
multiline_comment|/* Informational Exceptions control mode page for mode_sense */
r_int
r_char
id|iec_m_pg
(braket
)braket
op_assign
(brace
l_int|0x1c
comma
l_int|0xa
comma
l_int|0x08
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x0
comma
l_int|0x0
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|iec_m_pg
comma
r_sizeof
(paren
id|iec_m_pg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|pcontrol
)paren
id|memset
c_func
(paren
id|p
op_plus
l_int|2
comma
l_int|0
comma
r_sizeof
(paren
id|iec_m_pg
)paren
op_minus
l_int|2
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|iec_m_pg
)paren
suffix:semicolon
)brace
DECL|macro|SDEBUG_MAX_MSENSE_SZ
mdefine_line|#define SDEBUG_MAX_MSENSE_SZ 256
DECL|function|resp_mode_sense
r_static
r_int
id|resp_mode_sense
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_int
id|target
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_char
id|dbd
suffix:semicolon
r_int
id|pcontrol
comma
id|pcode
comma
id|subpcode
suffix:semicolon
r_int
r_char
id|dev_spec
suffix:semicolon
r_int
id|alloc_len
comma
id|msense_6
comma
id|offset
comma
id|len
comma
id|errsts
suffix:semicolon
r_int
r_char
op_star
id|ap
suffix:semicolon
r_int
r_char
id|arr
(braket
id|SDEBUG_MAX_MSENSE_SZ
)braket
suffix:semicolon
r_int
r_char
op_star
id|cmd
op_assign
(paren
r_int
r_char
op_star
)paren
id|scp-&gt;cmnd
suffix:semicolon
r_if
c_cond
(paren
(paren
id|errsts
op_assign
id|check_reset
c_func
(paren
id|scp
comma
id|devip
)paren
)paren
)paren
r_return
id|errsts
suffix:semicolon
id|dbd
op_assign
id|cmd
(braket
l_int|1
)braket
op_amp
l_int|0x8
suffix:semicolon
id|pcontrol
op_assign
(paren
id|cmd
(braket
l_int|2
)braket
op_amp
l_int|0xc0
)paren
op_rshift
l_int|6
suffix:semicolon
id|pcode
op_assign
id|cmd
(braket
l_int|2
)braket
op_amp
l_int|0x3f
suffix:semicolon
id|subpcode
op_assign
id|cmd
(braket
l_int|3
)braket
suffix:semicolon
id|msense_6
op_assign
(paren
id|MODE_SENSE
op_eq
id|cmd
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|alloc_len
op_assign
id|msense_6
ques
c_cond
id|cmd
(braket
l_int|4
)braket
suffix:colon
(paren
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|8
)paren
op_or
id|cmd
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|memset
c_func
(paren
id|arr
comma
l_int|0
comma
id|SDEBUG_MAX_MSENSE_SZ
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0x3
op_eq
id|pcontrol
)paren
(brace
multiline_comment|/* Saving values not supported */
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|SAVING_PARAMS_UNSUP
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
id|dev_spec
op_assign
id|DEV_READONLY
c_func
(paren
id|target
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x0
suffix:semicolon
r_if
c_cond
(paren
id|msense_6
)paren
(brace
id|arr
(braket
l_int|2
)braket
op_assign
id|dev_spec
suffix:semicolon
id|offset
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|arr
(braket
l_int|3
)braket
op_assign
id|dev_spec
suffix:semicolon
id|offset
op_assign
l_int|8
suffix:semicolon
)brace
id|ap
op_assign
id|arr
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|subpcode
)paren
(brace
multiline_comment|/* TODO: Control Extension page */
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_FIELD_IN_CDB
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|pcode
)paren
(brace
r_case
l_int|0x1
suffix:colon
multiline_comment|/* Read-Write error recovery page, direct access */
id|len
op_assign
id|resp_err_recov_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
multiline_comment|/* Disconnect-Reconnect page, all devices */
id|len
op_assign
id|resp_disconnect_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
multiline_comment|/* Format device page, direct access */
id|len
op_assign
id|resp_format_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x8
suffix:colon
multiline_comment|/* Caching page, direct access */
id|len
op_assign
id|resp_caching_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xa
suffix:colon
multiline_comment|/* Control Mode page, all devices */
id|len
op_assign
id|resp_ctrl_m_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1c
suffix:colon
multiline_comment|/* Informational Exceptions Mode page, all devices */
id|len
op_assign
id|resp_iec_m_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3f
suffix:colon
multiline_comment|/* Read all Mode pages */
id|len
op_assign
id|resp_err_recov_pg
c_func
(paren
id|ap
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|len
op_add_assign
id|resp_disconnect_pg
c_func
(paren
id|ap
op_plus
id|len
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|len
op_add_assign
id|resp_format_pg
c_func
(paren
id|ap
op_plus
id|len
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|len
op_add_assign
id|resp_caching_pg
c_func
(paren
id|ap
op_plus
id|len
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|len
op_add_assign
id|resp_ctrl_m_pg
c_func
(paren
id|ap
op_plus
id|len
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|len
op_add_assign
id|resp_iec_m_pg
c_func
(paren
id|ap
op_plus
id|len
comma
id|pcontrol
comma
id|target
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_FIELD_IN_CDB
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msense_6
)paren
id|arr
(braket
l_int|0
)braket
op_assign
id|offset
op_minus
l_int|1
suffix:semicolon
r_else
(brace
id|arr
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|offset
op_minus
l_int|2
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|1
)braket
op_assign
(paren
id|offset
op_minus
l_int|2
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|min
c_func
(paren
id|alloc_len
comma
id|offset
)paren
)paren
suffix:semicolon
)brace
DECL|function|resp_read
r_static
r_int
id|resp_read
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|upper_blk
comma
r_int
id|block
comma
r_int
id|num
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|upper_blk
op_logical_or
(paren
id|block
op_plus
id|num
OG
id|sdebug_capacity
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|ADDR_OUT_OF_RANGE
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|SCSI_DEBUG_OPT_MEDIUM_ERR
op_amp
id|scsi_debug_opts
)paren
op_logical_and
(paren
id|block
op_le
id|OPT_MEDIUM_ERR_ADDR
)paren
op_logical_and
(paren
(paren
id|block
op_plus
id|num
)paren
OG
id|OPT_MEDIUM_ERR_ADDR
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|MEDIUM_ERROR
comma
id|UNRECOVERED_READ_ERR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* claim unrecoverable read error */
r_return
id|check_condition_result
suffix:semicolon
)brace
id|read_lock_irqsave
c_func
(paren
op_amp
id|atomic_rw
comma
id|iflags
)paren
suffix:semicolon
id|ret
op_assign
id|fill_from_dev_buffer
c_func
(paren
id|SCpnt
comma
id|fake_storep
op_plus
(paren
id|block
op_star
id|SECT_SIZE
)paren
comma
id|num
op_star
id|SECT_SIZE
)paren
suffix:semicolon
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|atomic_rw
comma
id|iflags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|resp_write
r_static
r_int
id|resp_write
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_int
id|upper_blk
comma
r_int
id|block
comma
r_int
id|num
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|upper_blk
op_logical_or
(paren
id|block
op_plus
id|num
OG
id|sdebug_capacity
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|ADDR_OUT_OF_RANGE
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
id|write_lock_irqsave
c_func
(paren
op_amp
id|atomic_rw
comma
id|iflags
)paren
suffix:semicolon
id|res
op_assign
id|fetch_to_dev_buffer
c_func
(paren
id|SCpnt
comma
id|fake_storep
op_plus
(paren
id|block
op_star
id|SECT_SIZE
)paren
comma
id|num
op_star
id|SECT_SIZE
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|atomic_rw
comma
id|iflags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_minus
l_int|1
op_eq
id|res
)paren
r_return
(paren
id|DID_ERROR
op_lshift
l_int|16
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|res
OL
(paren
id|num
op_star
id|SECT_SIZE
)paren
)paren
op_logical_and
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: write: cdb indicated=%d, &quot;
l_string|&quot; IO sent=%d bytes&bslash;n&quot;
comma
id|num
op_star
id|SECT_SIZE
comma
id|res
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|SDEBUG_RLUN_ARR_SZ
mdefine_line|#define SDEBUG_RLUN_ARR_SZ 128
DECL|function|resp_report_luns
r_static
r_int
id|resp_report_luns
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|scp
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
)paren
(brace
r_int
r_int
id|alloc_len
suffix:semicolon
r_int
id|lun_cnt
comma
id|i
comma
id|upper
suffix:semicolon
r_int
r_char
op_star
id|cmd
op_assign
(paren
r_int
r_char
op_star
)paren
id|scp-&gt;cmnd
suffix:semicolon
r_int
id|select_report
op_assign
(paren
r_int
)paren
id|cmd
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|scsi_lun
op_star
id|one_lun
suffix:semicolon
r_int
r_char
id|arr
(braket
id|SDEBUG_RLUN_ARR_SZ
)braket
suffix:semicolon
id|alloc_len
op_assign
id|cmd
(braket
l_int|9
)braket
op_plus
(paren
id|cmd
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|cmd
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|cmd
(braket
l_int|6
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|alloc_len
OL
l_int|16
)paren
op_logical_or
(paren
id|select_report
OG
l_int|2
)paren
)paren
(brace
id|mk_sense_buffer
c_func
(paren
id|devip
comma
id|ILLEGAL_REQUEST
comma
id|INVALID_FIELD_IN_CDB
comma
l_int|0
)paren
suffix:semicolon
r_return
id|check_condition_result
suffix:semicolon
)brace
multiline_comment|/* can produce response with up to 16k luns (lun 0 to lun 16383) */
id|memset
c_func
(paren
id|arr
comma
l_int|0
comma
id|SDEBUG_RLUN_ARR_SZ
)paren
suffix:semicolon
id|lun_cnt
op_assign
id|scsi_debug_max_luns
suffix:semicolon
id|arr
(braket
l_int|2
)braket
op_assign
(paren
(paren
r_sizeof
(paren
r_struct
id|scsi_lun
)paren
op_star
id|lun_cnt
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|arr
(braket
l_int|3
)braket
op_assign
(paren
r_sizeof
(paren
r_struct
id|scsi_lun
)paren
op_star
id|lun_cnt
)paren
op_amp
l_int|0xff
suffix:semicolon
id|lun_cnt
op_assign
id|min
c_func
(paren
(paren
r_int
)paren
(paren
(paren
id|SDEBUG_RLUN_ARR_SZ
op_minus
l_int|8
)paren
op_div
r_sizeof
(paren
r_struct
id|scsi_lun
)paren
)paren
comma
id|lun_cnt
)paren
suffix:semicolon
id|one_lun
op_assign
(paren
r_struct
id|scsi_lun
op_star
)paren
op_amp
id|arr
(braket
l_int|8
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lun_cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|upper
op_assign
(paren
id|i
op_rshift
l_int|8
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|upper
)paren
id|one_lun
(braket
id|i
)braket
dot
id|scsi_lun
(braket
l_int|0
)braket
op_assign
(paren
id|upper
op_or
(paren
id|SAM2_LUN_ADDRESS_METHOD
op_lshift
l_int|6
)paren
)paren
suffix:semicolon
id|one_lun
(braket
id|i
)braket
dot
id|scsi_lun
(braket
l_int|1
)braket
op_assign
id|i
op_amp
l_int|0xff
suffix:semicolon
)brace
r_return
id|fill_from_dev_buffer
c_func
(paren
id|scp
comma
id|arr
comma
id|min
c_func
(paren
(paren
r_int
)paren
id|alloc_len
comma
id|SDEBUG_RLUN_ARR_SZ
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* When timer goes off this function is called. */
DECL|function|timer_intr_handler
r_static
r_void
id|timer_intr_handler
c_func
(paren
r_int
r_int
id|indx
)paren
(brace
r_struct
id|sdebug_queued_cmd
op_star
id|sqcp
suffix:semicolon
r_int
r_int
id|iflags
suffix:semicolon
r_if
c_cond
(paren
id|indx
op_ge
id|SCSI_DEBUG_CANQUEUE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;scsi_debug:timer_intr_handler: indx too &quot;
l_string|&quot;large&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
id|sqcp
op_assign
op_amp
id|queued_arr
(braket
(paren
r_int
)paren
id|indx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sqcp-&gt;in_use
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;scsi_debug:timer_intr_handler: Unexpected &quot;
l_string|&quot;interrupt&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sqcp-&gt;in_use
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sqcp-&gt;done_funct
)paren
(brace
id|sqcp-&gt;a_cmnd-&gt;result
op_assign
id|sqcp-&gt;scsi_result
suffix:semicolon
id|sqcp
op_member_access_from_pointer
id|done_funct
c_func
(paren
id|sqcp-&gt;a_cmnd
)paren
suffix:semicolon
multiline_comment|/* callback to mid level */
)brace
id|sqcp-&gt;done_funct
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
)brace
DECL|function|scsi_debug_slave_alloc
r_static
r_int
id|scsi_debug_slave_alloc
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdp
)paren
(brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: slave_alloc &lt;%u %u %u %u&gt;&bslash;n&quot;
comma
id|sdp-&gt;host-&gt;host_no
comma
id|sdp-&gt;channel
comma
id|sdp-&gt;id
comma
id|sdp-&gt;lun
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|scsi_debug_slave_configure
r_static
r_int
id|scsi_debug_slave_configure
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdp
)paren
(brace
r_struct
id|sdebug_dev_info
op_star
id|devip
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: slave_configure &lt;%u %u %u %u&gt;&bslash;n&quot;
comma
id|sdp-&gt;host-&gt;host_no
comma
id|sdp-&gt;channel
comma
id|sdp-&gt;id
comma
id|sdp-&gt;lun
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdp-&gt;host-&gt;max_cmd_len
op_ne
id|SCSI_DEBUG_MAX_CMD_LEN
)paren
id|sdp-&gt;host-&gt;max_cmd_len
op_assign
id|SCSI_DEBUG_MAX_CMD_LEN
suffix:semicolon
id|devip
op_assign
id|devInfoReg
c_func
(paren
id|sdp
)paren
suffix:semicolon
id|sdp-&gt;hostdata
op_assign
id|devip
suffix:semicolon
r_if
c_cond
(paren
id|sdp-&gt;host-&gt;cmd_per_lun
)paren
id|scsi_adjust_queue_depth
c_func
(paren
id|sdp
comma
id|SDEBUG_TAGGED_QUEUING
comma
id|sdp-&gt;host-&gt;cmd_per_lun
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|scsi_debug_slave_destroy
r_static
r_void
id|scsi_debug_slave_destroy
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdp
)paren
(brace
r_struct
id|sdebug_dev_info
op_star
id|devip
op_assign
(paren
r_struct
id|sdebug_dev_info
op_star
)paren
id|sdp-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: slave_destroy &lt;%u %u %u %u&gt;&bslash;n&quot;
comma
id|sdp-&gt;host-&gt;host_no
comma
id|sdp-&gt;channel
comma
id|sdp-&gt;id
comma
id|sdp-&gt;lun
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devip
)paren
(brace
multiline_comment|/* make this slot avaliable for re-use */
id|devip-&gt;used
op_assign
l_int|0
suffix:semicolon
id|sdp-&gt;hostdata
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|devInfoReg
r_static
r_struct
id|sdebug_dev_info
op_star
id|devInfoReg
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|open_devip
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|devip
op_assign
(paren
r_struct
id|sdebug_dev_info
op_star
)paren
id|sdev-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|devip
)paren
r_return
id|devip
suffix:semicolon
id|sdbg_host
op_assign
op_star
(paren
r_struct
id|sdebug_host_info
op_star
op_star
)paren
id|sdev-&gt;host-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sdbg_host
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Host info NULL&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|list_for_each_entry
c_func
(paren
id|devip
comma
op_amp
id|sdbg_host-&gt;dev_info_list
comma
id|dev_list
)paren
(brace
r_if
c_cond
(paren
(paren
id|devip-&gt;used
)paren
op_logical_and
(paren
id|devip-&gt;channel
op_eq
id|sdev-&gt;channel
)paren
op_logical_and
(paren
id|devip-&gt;target
op_eq
id|sdev-&gt;id
)paren
op_logical_and
(paren
id|devip-&gt;lun
op_eq
id|sdev-&gt;lun
)paren
)paren
r_return
id|devip
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|devip-&gt;used
)paren
op_logical_and
(paren
op_logical_neg
id|open_devip
)paren
)paren
id|open_devip
op_assign
id|devip
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|open_devip
)paren
(brace
multiline_comment|/* try and make a new one */
id|open_devip
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|open_devip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|open_devip
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory at line %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|__LINE__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|open_devip
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|open_devip
)paren
)paren
suffix:semicolon
id|open_devip-&gt;sdbg_host
op_assign
id|sdbg_host
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|open_devip-&gt;dev_list
comma
op_amp
id|sdbg_host-&gt;dev_info_list
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|open_devip
)paren
(brace
id|open_devip-&gt;channel
op_assign
id|sdev-&gt;channel
suffix:semicolon
id|open_devip-&gt;target
op_assign
id|sdev-&gt;id
suffix:semicolon
id|open_devip-&gt;lun
op_assign
id|sdev-&gt;lun
suffix:semicolon
id|open_devip-&gt;sdbg_host
op_assign
id|sdbg_host
suffix:semicolon
id|open_devip-&gt;reset
op_assign
l_int|1
suffix:semicolon
id|open_devip-&gt;used
op_assign
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|open_devip-&gt;sense_buff
comma
l_int|0
comma
id|SDEBUG_SENSE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_dsense
)paren
id|open_devip-&gt;sense_buff
(braket
l_int|0
)braket
op_assign
l_int|0x72
suffix:semicolon
r_else
(brace
id|open_devip-&gt;sense_buff
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
id|open_devip-&gt;sense_buff
(braket
l_int|7
)braket
op_assign
l_int|0xa
suffix:semicolon
)brace
r_return
id|open_devip
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|mk_sense_buffer
r_static
r_void
id|mk_sense_buffer
c_func
(paren
r_struct
id|sdebug_dev_info
op_star
id|devip
comma
r_int
id|key
comma
r_int
id|asc
comma
r_int
id|asq
)paren
(brace
r_int
r_char
op_star
id|sbuff
suffix:semicolon
id|sbuff
op_assign
id|devip-&gt;sense_buff
suffix:semicolon
id|memset
c_func
(paren
id|sbuff
comma
l_int|0
comma
id|SDEBUG_SENSE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_dsense
)paren
(brace
id|sbuff
(braket
l_int|0
)braket
op_assign
l_int|0x72
suffix:semicolon
multiline_comment|/* descriptor, current */
id|sbuff
(braket
l_int|1
)braket
op_assign
id|key
suffix:semicolon
id|sbuff
(braket
l_int|2
)braket
op_assign
id|asc
suffix:semicolon
id|sbuff
(braket
l_int|3
)braket
op_assign
id|asq
suffix:semicolon
)brace
r_else
(brace
id|sbuff
(braket
l_int|0
)braket
op_assign
l_int|0x70
suffix:semicolon
multiline_comment|/* fixed, current */
id|sbuff
(braket
l_int|2
)braket
op_assign
id|key
suffix:semicolon
id|sbuff
(braket
l_int|7
)braket
op_assign
l_int|0xa
suffix:semicolon
multiline_comment|/* implies 18 byte sense buffer */
id|sbuff
(braket
l_int|12
)braket
op_assign
id|asc
suffix:semicolon
id|sbuff
(braket
l_int|13
)braket
op_assign
id|asq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug:    [sense_key,asc,ascq]: &quot;
l_string|&quot;[0x%x,0x%x,0x%x]&bslash;n&quot;
comma
id|key
comma
id|asc
comma
id|asq
)paren
suffix:semicolon
)brace
DECL|function|scsi_debug_abort
r_static
r_int
id|scsi_debug_abort
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: abort&bslash;n&quot;
)paren
suffix:semicolon
op_increment
id|num_aborts
suffix:semicolon
id|stop_queued_cmnd
c_func
(paren
id|SCpnt
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|scsi_debug_biosparam
r_static
r_int
id|scsi_debug_biosparam
c_func
(paren
r_struct
id|scsi_device
op_star
id|sdev
comma
r_struct
id|block_device
op_star
id|bdev
comma
id|sector_t
id|capacity
comma
r_int
op_star
id|info
)paren
(brace
r_int
id|res
suffix:semicolon
r_int
r_char
op_star
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: biosparam&bslash;n&quot;
)paren
suffix:semicolon
id|buf
op_assign
id|scsi_bios_ptable
c_func
(paren
id|bdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
)paren
(brace
id|res
op_assign
id|scsi_partsize
c_func
(paren
id|buf
comma
id|capacity
comma
op_amp
id|info
(braket
l_int|2
)braket
comma
op_amp
id|info
(braket
l_int|0
)braket
comma
op_amp
id|info
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
id|res
suffix:semicolon
)brace
id|info
(braket
l_int|0
)braket
op_assign
id|sdebug_heads
suffix:semicolon
id|info
(braket
l_int|1
)braket
op_assign
id|sdebug_sectors_per
suffix:semicolon
id|info
(braket
l_int|2
)braket
op_assign
id|sdebug_cylinders_per
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|scsi_debug_device_reset
r_static
r_int
id|scsi_debug_device_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
r_struct
id|sdebug_dev_info
op_star
id|devip
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: device_reset&bslash;n&quot;
)paren
suffix:semicolon
op_increment
id|num_dev_resets
suffix:semicolon
r_if
c_cond
(paren
id|SCpnt
)paren
(brace
id|devip
op_assign
id|devInfoReg
c_func
(paren
id|SCpnt-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devip
)paren
id|devip-&gt;reset
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|scsi_debug_bus_reset
r_static
r_int
id|scsi_debug_bus_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|dev_info
suffix:semicolon
r_struct
id|scsi_device
op_star
id|sdp
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|hp
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: bus_reset&bslash;n&quot;
)paren
suffix:semicolon
op_increment
id|num_bus_resets
suffix:semicolon
r_if
c_cond
(paren
id|SCpnt
op_logical_and
(paren
(paren
id|sdp
op_assign
id|SCpnt-&gt;device
)paren
)paren
op_logical_and
(paren
(paren
id|hp
op_assign
id|sdp-&gt;host
)paren
)paren
)paren
(brace
id|sdbg_host
op_assign
op_star
(paren
r_struct
id|sdebug_host_info
op_star
op_star
)paren
id|hp-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|sdbg_host
)paren
(brace
id|list_for_each_entry
c_func
(paren
id|dev_info
comma
op_amp
id|sdbg_host-&gt;dev_info_list
comma
id|dev_list
)paren
id|dev_info-&gt;reset
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|scsi_debug_host_reset
r_static
r_int
id|scsi_debug_host_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|dev_info
suffix:semicolon
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: host_reset&bslash;n&quot;
)paren
suffix:semicolon
op_increment
id|num_host_resets
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|sdbg_host
comma
op_amp
id|sdebug_host_list
comma
id|host_list
)paren
(brace
id|list_for_each_entry
c_func
(paren
id|dev_info
comma
op_amp
id|sdbg_host-&gt;dev_info_list
comma
id|dev_list
)paren
id|dev_info-&gt;reset
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
id|stop_all_queued
c_func
(paren
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
multiline_comment|/* Returns 1 if found &squot;cmnd&squot; and deleted its timer. else returns 0 */
DECL|function|stop_queued_cmnd
r_static
r_int
id|stop_queued_cmnd
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|cmnd
)paren
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|k
suffix:semicolon
r_struct
id|sdebug_queued_cmd
op_star
id|sqcp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|SCSI_DEBUG_CANQUEUE
suffix:semicolon
op_increment
id|k
)paren
(brace
id|sqcp
op_assign
op_amp
id|queued_arr
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sqcp-&gt;in_use
op_logical_and
(paren
id|cmnd
op_eq
id|sqcp-&gt;a_cmnd
)paren
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|sqcp-&gt;cmnd_timer
)paren
suffix:semicolon
id|sqcp-&gt;in_use
op_assign
l_int|0
suffix:semicolon
id|sqcp-&gt;a_cmnd
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_return
(paren
id|k
OL
id|SCSI_DEBUG_CANQUEUE
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Deletes (stops) timers of all queued commands */
DECL|function|stop_all_queued
r_static
r_void
id|stop_all_queued
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|k
suffix:semicolon
r_struct
id|sdebug_queued_cmd
op_star
id|sqcp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|SCSI_DEBUG_CANQUEUE
suffix:semicolon
op_increment
id|k
)paren
(brace
id|sqcp
op_assign
op_amp
id|queued_arr
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sqcp-&gt;in_use
op_logical_and
id|sqcp-&gt;a_cmnd
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|sqcp-&gt;cmnd_timer
)paren
suffix:semicolon
id|sqcp-&gt;in_use
op_assign
l_int|0
suffix:semicolon
id|sqcp-&gt;a_cmnd
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
)brace
multiline_comment|/* Initializes timers in queued array */
DECL|function|init_all_queued
r_static
r_void
id|__init
id|init_all_queued
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|k
suffix:semicolon
r_struct
id|sdebug_queued_cmd
op_star
id|sqcp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|SCSI_DEBUG_CANQUEUE
suffix:semicolon
op_increment
id|k
)paren
(brace
id|sqcp
op_assign
op_amp
id|queued_arr
(braket
id|k
)braket
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|sqcp-&gt;cmnd_timer
)paren
suffix:semicolon
id|sqcp-&gt;in_use
op_assign
l_int|0
suffix:semicolon
id|sqcp-&gt;a_cmnd
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
)brace
DECL|function|sdebug_build_parts
r_static
r_void
id|__init
id|sdebug_build_parts
c_func
(paren
r_int
r_char
op_star
id|ramp
)paren
(brace
r_struct
id|partition
op_star
id|pp
suffix:semicolon
r_int
id|starts
(braket
id|SDEBUG_MAX_PARTS
op_plus
l_int|2
)braket
suffix:semicolon
r_int
id|sectors_per_part
comma
id|num_sectors
comma
id|k
suffix:semicolon
r_int
id|heads_by_sects
comma
id|start_sec
comma
id|end_sec
suffix:semicolon
multiline_comment|/* assume partition table already zeroed */
r_if
c_cond
(paren
(paren
id|scsi_debug_num_parts
OL
l_int|1
)paren
op_logical_or
(paren
id|sdebug_store_size
OL
l_int|1048576
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_num_parts
OG
id|SDEBUG_MAX_PARTS
)paren
(brace
id|scsi_debug_num_parts
op_assign
id|SDEBUG_MAX_PARTS
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;scsi_debug:build_parts: reducing &quot;
l_string|&quot;partitions to %d&bslash;n&quot;
comma
id|SDEBUG_MAX_PARTS
)paren
suffix:semicolon
)brace
id|num_sectors
op_assign
(paren
r_int
)paren
(paren
id|sdebug_store_size
op_div
id|SECT_SIZE
)paren
suffix:semicolon
id|sectors_per_part
op_assign
(paren
id|num_sectors
op_minus
id|sdebug_sectors_per
)paren
op_div
id|scsi_debug_num_parts
suffix:semicolon
id|heads_by_sects
op_assign
id|sdebug_heads
op_star
id|sdebug_sectors_per
suffix:semicolon
id|starts
(braket
l_int|0
)braket
op_assign
id|sdebug_sectors_per
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|1
suffix:semicolon
id|k
OL
id|scsi_debug_num_parts
suffix:semicolon
op_increment
id|k
)paren
id|starts
(braket
id|k
)braket
op_assign
(paren
(paren
id|k
op_star
id|sectors_per_part
)paren
op_div
id|heads_by_sects
)paren
op_star
id|heads_by_sects
suffix:semicolon
id|starts
(braket
id|scsi_debug_num_parts
)braket
op_assign
id|num_sectors
suffix:semicolon
id|starts
(braket
id|scsi_debug_num_parts
op_plus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|ramp
(braket
l_int|510
)braket
op_assign
l_int|0x55
suffix:semicolon
multiline_comment|/* magic partition markings */
id|ramp
(braket
l_int|511
)braket
op_assign
l_int|0xAA
suffix:semicolon
id|pp
op_assign
(paren
r_struct
id|partition
op_star
)paren
(paren
id|ramp
op_plus
l_int|0x1be
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|starts
(braket
id|k
op_plus
l_int|1
)braket
suffix:semicolon
op_increment
id|k
comma
op_increment
id|pp
)paren
(brace
id|start_sec
op_assign
id|starts
(braket
id|k
)braket
suffix:semicolon
id|end_sec
op_assign
id|starts
(braket
id|k
op_plus
l_int|1
)braket
op_minus
l_int|1
suffix:semicolon
id|pp-&gt;boot_ind
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;cyl
op_assign
id|start_sec
op_div
id|heads_by_sects
suffix:semicolon
id|pp-&gt;head
op_assign
(paren
id|start_sec
op_minus
(paren
id|pp-&gt;cyl
op_star
id|heads_by_sects
)paren
)paren
op_div
id|sdebug_sectors_per
suffix:semicolon
id|pp-&gt;sector
op_assign
(paren
id|start_sec
op_mod
id|sdebug_sectors_per
)paren
op_plus
l_int|1
suffix:semicolon
id|pp-&gt;end_cyl
op_assign
id|end_sec
op_div
id|heads_by_sects
suffix:semicolon
id|pp-&gt;end_head
op_assign
(paren
id|end_sec
op_minus
(paren
id|pp-&gt;end_cyl
op_star
id|heads_by_sects
)paren
)paren
op_div
id|sdebug_sectors_per
suffix:semicolon
id|pp-&gt;end_sector
op_assign
(paren
id|end_sec
op_mod
id|sdebug_sectors_per
)paren
op_plus
l_int|1
suffix:semicolon
id|pp-&gt;start_sect
op_assign
id|start_sec
suffix:semicolon
id|pp-&gt;nr_sects
op_assign
id|end_sec
op_minus
id|start_sec
op_plus
l_int|1
suffix:semicolon
id|pp-&gt;sys_ind
op_assign
l_int|0x83
suffix:semicolon
multiline_comment|/* plain Linux partition */
)brace
)brace
DECL|function|schedule_resp
r_static
r_int
id|schedule_resp
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|cmnd
comma
r_struct
id|sdebug_dev_info
op_star
id|devip
comma
id|done_funct_t
id|done
comma
r_int
id|scsi_result
comma
r_int
id|delta_jiff
)paren
(brace
r_if
c_cond
(paren
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
op_logical_and
id|cmnd
)paren
(brace
r_if
c_cond
(paren
id|scsi_result
)paren
(brace
r_struct
id|scsi_device
op_star
id|sdp
op_assign
id|cmnd-&gt;device
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug:    &lt;%u %u %u %u&gt; &quot;
l_string|&quot;non-zero result=0x%x&bslash;n&quot;
comma
id|sdp-&gt;host-&gt;host_no
comma
id|sdp-&gt;channel
comma
id|sdp-&gt;id
comma
id|sdp-&gt;lun
comma
id|scsi_result
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmnd
op_logical_and
id|devip
)paren
(brace
multiline_comment|/* simulate autosense by this driver */
r_if
c_cond
(paren
id|SAM_STAT_CHECK_CONDITION
op_eq
(paren
id|scsi_result
op_amp
l_int|0xff
)paren
)paren
id|memcpy
c_func
(paren
id|cmnd-&gt;sense_buffer
comma
id|devip-&gt;sense_buff
comma
(paren
id|SCSI_SENSE_BUFFERSIZE
OG
id|SDEBUG_SENSE_LEN
)paren
ques
c_cond
id|SDEBUG_SENSE_LEN
suffix:colon
id|SCSI_SENSE_BUFFERSIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delta_jiff
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|cmnd
)paren
id|cmnd-&gt;result
op_assign
id|scsi_result
suffix:semicolon
r_if
c_cond
(paren
id|done
)paren
id|done
c_func
(paren
id|cmnd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|iflags
suffix:semicolon
r_int
id|k
suffix:semicolon
r_struct
id|sdebug_queued_cmd
op_star
id|sqcp
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|SCSI_DEBUG_CANQUEUE
suffix:semicolon
op_increment
id|k
)paren
(brace
id|sqcp
op_assign
op_amp
id|queued_arr
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sqcp-&gt;in_use
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_ge
id|SCSI_DEBUG_CANQUEUE
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;scsi_debug: can_queue exceeded&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* report busy to mid level */
)brace
id|sqcp-&gt;in_use
op_assign
l_int|1
suffix:semicolon
id|sqcp-&gt;a_cmnd
op_assign
id|cmnd
suffix:semicolon
id|sqcp-&gt;scsi_result
op_assign
id|scsi_result
suffix:semicolon
id|sqcp-&gt;done_funct
op_assign
id|done
suffix:semicolon
id|sqcp-&gt;cmnd_timer.function
op_assign
id|timer_intr_handler
suffix:semicolon
id|sqcp-&gt;cmnd_timer.data
op_assign
id|k
suffix:semicolon
id|sqcp-&gt;cmnd_timer.expires
op_assign
id|jiffies
op_plus
id|delta_jiff
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sqcp-&gt;cmnd_timer
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queued_arr_lock
comma
id|iflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmnd
)paren
id|cmnd-&gt;result
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Set &squot;perm&squot; (4th argument) to 0 to disable module_param&squot;s definition&n; * of sysfs parameters (which module_param doesn&squot;t yet support).&n; * Sysfs parameters defined explicitly below.&n; */
id|module_param_named
c_func
(paren
id|add_host
comma
id|scsi_debug_add_host
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* perm=0644 */
id|module_param_named
c_func
(paren
id|delay
comma
id|scsi_debug_delay
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* perm=0644 */
id|module_param_named
c_func
(paren
id|dev_size_mb
comma
id|scsi_debug_dev_size_mb
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|dsense
comma
id|scsi_debug_dsense
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|every_nth
comma
id|scsi_debug_every_nth
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|max_luns
comma
id|scsi_debug_max_luns
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|num_parts
comma
id|scsi_debug_num_parts
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|num_tgts
comma
id|scsi_debug_num_tgts
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|opts
comma
id|scsi_debug_opts
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* perm=0644 */
id|module_param_named
c_func
(paren
id|ptype
comma
id|scsi_debug_ptype
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|scsi_level
comma
id|scsi_debug_scsi_level
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Eric Youngdale + Douglas Gilbert&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SCSI debug adapter driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|SCSI_DEBUG_VERSION
id|MODULE_VERSION
c_func
(paren
id|SCSI_DEBUG_VERSION
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|add_host
comma
l_string|&quot;0..127 hosts allowed(def=1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|delay
comma
l_string|&quot;# of jiffies to delay response(def=1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dev_size_mb
comma
l_string|&quot;size in MB of ram shared by devs&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dsense
comma
l_string|&quot;use descriptor sense format(def: fixed)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|every_nth
comma
l_string|&quot;timeout every nth command(def=100)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_luns
comma
l_string|&quot;number of SCSI LUNs per target to simulate&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|num_parts
comma
l_string|&quot;number of partitions(def=0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|num_tgts
comma
l_string|&quot;number of SCSI targets per host to simulate&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|opts
comma
l_string|&quot;1-&gt;noise, 2-&gt;medium_error, 4-&gt;...&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ptype
comma
l_string|&quot;SCSI peripheral type(def=0[disk])&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|scsi_level
comma
l_string|&quot;SCSI level to simulate(def=5[SPC-3])&quot;
)paren
suffix:semicolon
DECL|variable|sdebug_info
r_static
r_char
id|sdebug_info
(braket
l_int|256
)braket
suffix:semicolon
DECL|function|scsi_debug_info
r_static
r_const
r_char
op_star
id|scsi_debug_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|shp
)paren
(brace
id|sprintf
c_func
(paren
id|sdebug_info
comma
l_string|&quot;scsi_debug, version %s [%s], &quot;
l_string|&quot;dev_size_mb=%d, opts=0x%x&quot;
comma
id|SCSI_DEBUG_VERSION
comma
id|scsi_debug_version_date
comma
id|scsi_debug_dev_size_mb
comma
id|scsi_debug_opts
)paren
suffix:semicolon
r_return
id|sdebug_info
suffix:semicolon
)brace
multiline_comment|/* scsi_debug_proc_info&n; * Used if the driver currently has no own support for /proc/scsi&n; */
DECL|function|scsi_debug_proc_info
r_static
r_int
id|scsi_debug_proc_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
comma
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|inout
)paren
(brace
r_int
id|len
comma
id|pos
comma
id|begin
suffix:semicolon
r_int
id|orig_length
suffix:semicolon
id|orig_length
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|inout
op_eq
l_int|1
)paren
(brace
r_char
id|arr
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|minLen
op_assign
id|length
OG
l_int|15
ques
c_cond
l_int|15
suffix:colon
id|length
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
op_logical_or
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|memcpy
c_func
(paren
id|arr
comma
id|buffer
comma
id|minLen
)paren
suffix:semicolon
id|arr
(braket
id|minLen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|sscanf
c_func
(paren
id|arr
comma
l_string|&quot;%d&quot;
comma
op_amp
id|pos
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scsi_debug_opts
op_assign
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_every_nth
op_ne
l_int|0
)paren
id|scsi_debug_cmnd_count
op_assign
l_int|0
suffix:semicolon
r_return
id|length
suffix:semicolon
)brace
id|begin
op_assign
l_int|0
suffix:semicolon
id|pos
op_assign
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;scsi_debug adapter driver, version &quot;
l_string|&quot;%s [%s]&bslash;n&quot;
l_string|&quot;num_tgts=%d, shared (ram) size=%d MB, opts=0x%x, &quot;
l_string|&quot;every_nth=%d(curr:%d)&bslash;n&quot;
l_string|&quot;delay=%d, max_luns=%d, scsi_level=%d&bslash;n&quot;
l_string|&quot;sector_size=%d bytes, cylinders=%d, heads=%d, sectors=%d&bslash;n&quot;
l_string|&quot;number of aborts=%d, device_reset=%d, bus_resets=%d, &quot;
l_string|&quot;host_resets=%d&bslash;n&quot;
comma
id|SCSI_DEBUG_VERSION
comma
id|scsi_debug_version_date
comma
id|scsi_debug_num_tgts
comma
id|scsi_debug_dev_size_mb
comma
id|scsi_debug_opts
comma
id|scsi_debug_every_nth
comma
id|scsi_debug_cmnd_count
comma
id|scsi_debug_delay
comma
id|scsi_debug_max_luns
comma
id|scsi_debug_scsi_level
comma
id|SECT_SIZE
comma
id|sdebug_cylinders_per
comma
id|sdebug_heads
comma
id|sdebug_sectors_per
comma
id|num_aborts
comma
id|num_dev_resets
comma
id|num_bus_resets
comma
id|num_host_resets
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|sdebug_delay_show
r_static
id|ssize_t
id|sdebug_delay_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_delay
)paren
suffix:semicolon
)brace
DECL|function|sdebug_delay_store
r_static
id|ssize_t
id|sdebug_delay_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|delay
suffix:semicolon
r_char
id|work
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%10s&quot;
comma
id|work
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|work
comma
l_string|&quot;%d&quot;
comma
op_amp
id|delay
)paren
)paren
op_logical_and
(paren
id|delay
op_ge
l_int|0
)paren
)paren
(brace
id|scsi_debug_delay
op_assign
id|delay
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|delay
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_delay_show
comma
id|sdebug_delay_store
)paren
suffix:semicolon
DECL|function|sdebug_opts_show
r_static
id|ssize_t
id|sdebug_opts_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|scsi_debug_opts
)paren
suffix:semicolon
)brace
DECL|function|sdebug_opts_store
r_static
id|ssize_t
id|sdebug_opts_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|opts
suffix:semicolon
r_char
id|work
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%10s&quot;
comma
id|work
)paren
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_eq
id|strnicmp
c_func
(paren
id|work
comma
l_string|&quot;0x&quot;
comma
l_int|2
)paren
)paren
(brace
r_if
c_cond
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
op_amp
id|work
(braket
l_int|2
)braket
comma
l_string|&quot;%x&quot;
comma
op_amp
id|opts
)paren
)paren
r_goto
id|opts_done
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|work
comma
l_string|&quot;%d&quot;
comma
op_amp
id|opts
)paren
)paren
r_goto
id|opts_done
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
id|opts_done
suffix:colon
id|scsi_debug_opts
op_assign
id|opts
suffix:semicolon
id|scsi_debug_cmnd_count
op_assign
l_int|0
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|opts
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_opts_show
comma
id|sdebug_opts_store
)paren
suffix:semicolon
DECL|function|sdebug_ptype_show
r_static
id|ssize_t
id|sdebug_ptype_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_ptype
)paren
suffix:semicolon
)brace
DECL|function|sdebug_ptype_store
r_static
id|ssize_t
id|sdebug_ptype_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
l_int|0
)paren
op_logical_and
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|n
)paren
)paren
op_logical_and
(paren
id|n
op_ge
l_int|0
)paren
)paren
(brace
id|scsi_debug_ptype
op_assign
id|n
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|ptype
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_ptype_show
comma
id|sdebug_ptype_store
)paren
suffix:semicolon
DECL|function|sdebug_dsense_show
r_static
id|ssize_t
id|sdebug_dsense_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_dsense
)paren
suffix:semicolon
)brace
DECL|function|sdebug_dsense_store
r_static
id|ssize_t
id|sdebug_dsense_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
l_int|0
)paren
op_logical_and
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|n
)paren
)paren
op_logical_and
(paren
id|n
op_ge
l_int|0
)paren
)paren
(brace
id|scsi_debug_dsense
op_assign
id|n
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|dsense
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_dsense_show
comma
id|sdebug_dsense_store
)paren
suffix:semicolon
DECL|function|sdebug_num_tgts_show
r_static
id|ssize_t
id|sdebug_num_tgts_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_num_tgts
)paren
suffix:semicolon
)brace
DECL|function|sdebug_num_tgts_store
r_static
id|ssize_t
id|sdebug_num_tgts_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
l_int|0
)paren
op_logical_and
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|n
)paren
)paren
op_logical_and
(paren
id|n
op_ge
l_int|0
)paren
)paren
(brace
id|scsi_debug_num_tgts
op_assign
id|n
suffix:semicolon
id|sdebug_max_tgts_luns
c_func
(paren
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|num_tgts
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_num_tgts_show
comma
id|sdebug_num_tgts_store
)paren
suffix:semicolon
DECL|function|sdebug_dev_size_mb_show
r_static
id|ssize_t
id|sdebug_dev_size_mb_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_dev_size_mb
)paren
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|dev_size_mb
comma
id|S_IRUGO
comma
id|sdebug_dev_size_mb_show
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|sdebug_num_parts_show
r_static
id|ssize_t
id|sdebug_num_parts_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_num_parts
)paren
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|num_parts
comma
id|S_IRUGO
comma
id|sdebug_num_parts_show
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|sdebug_every_nth_show
r_static
id|ssize_t
id|sdebug_every_nth_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_every_nth
)paren
suffix:semicolon
)brace
DECL|function|sdebug_every_nth_store
r_static
id|ssize_t
id|sdebug_every_nth_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|nth
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
l_int|0
)paren
op_logical_and
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|nth
)paren
)paren
)paren
(brace
id|scsi_debug_every_nth
op_assign
id|nth
suffix:semicolon
id|scsi_debug_cmnd_count
op_assign
l_int|0
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|every_nth
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_every_nth_show
comma
id|sdebug_every_nth_store
)paren
suffix:semicolon
DECL|function|sdebug_max_luns_show
r_static
id|ssize_t
id|sdebug_max_luns_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_max_luns
)paren
suffix:semicolon
)brace
DECL|function|sdebug_max_luns_store
r_static
id|ssize_t
id|sdebug_max_luns_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
OG
l_int|0
)paren
op_logical_and
(paren
l_int|1
op_eq
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|n
)paren
)paren
op_logical_and
(paren
id|n
op_ge
l_int|0
)paren
)paren
(brace
id|scsi_debug_max_luns
op_assign
id|n
suffix:semicolon
id|sdebug_max_tgts_luns
c_func
(paren
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|max_luns
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_max_luns_show
comma
id|sdebug_max_luns_store
)paren
suffix:semicolon
DECL|function|sdebug_scsi_level_show
r_static
id|ssize_t
id|sdebug_scsi_level_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_scsi_level
)paren
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|scsi_level
comma
id|S_IRUGO
comma
id|sdebug_scsi_level_show
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|sdebug_add_host_show
r_static
id|ssize_t
id|sdebug_add_host_show
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|scnprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|scsi_debug_add_host
)paren
suffix:semicolon
)brace
DECL|function|sdebug_add_host_store
r_static
id|ssize_t
id|sdebug_add_host_store
c_func
(paren
r_struct
id|device_driver
op_star
id|ddp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|delta_hosts
suffix:semicolon
r_char
id|work
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%10s&quot;
comma
id|work
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
(brace
multiline_comment|/* temporary hack around sscanf() problem with -ve nums */
r_int
id|neg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_char|&squot;-&squot;
op_eq
op_star
id|work
)paren
id|neg
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|sscanf
c_func
(paren
id|work
op_plus
id|neg
comma
l_string|&quot;%d&quot;
comma
op_amp
id|delta_hosts
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|neg
)paren
id|delta_hosts
op_assign
op_minus
id|delta_hosts
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delta_hosts
OG
l_int|0
)paren
(brace
r_do
(brace
id|sdebug_add_adapter
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|delta_hosts
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|delta_hosts
OL
l_int|0
)paren
(brace
r_do
(brace
id|sdebug_remove_adapter
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|delta_hosts
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
id|DRIVER_ATTR
c_func
(paren
id|add_host
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sdebug_add_host_show
comma
id|sdebug_add_host_store
)paren
suffix:semicolon
DECL|function|do_create_driverfs_files
r_static
r_void
id|do_create_driverfs_files
c_func
(paren
r_void
)paren
(brace
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_add_host
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_delay
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_dev_size_mb
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_dsense
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_every_nth
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_max_luns
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_num_tgts
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_num_parts
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_ptype
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_opts
)paren
suffix:semicolon
id|driver_create_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_scsi_level
)paren
suffix:semicolon
)brace
DECL|function|do_remove_driverfs_files
r_static
r_void
id|do_remove_driverfs_files
c_func
(paren
r_void
)paren
(brace
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_scsi_level
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_opts
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_ptype
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_num_parts
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_num_tgts
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_max_luns
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_every_nth
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_dsense
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_dev_size_mb
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_delay
)paren
suffix:semicolon
id|driver_remove_file
c_func
(paren
op_amp
id|sdebug_driverfs_driver
comma
op_amp
id|driver_attr_add_host
)paren
suffix:semicolon
)brace
DECL|function|scsi_debug_init
r_static
r_int
id|__init
id|scsi_debug_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|sz
suffix:semicolon
r_int
id|host_to_add
suffix:semicolon
r_int
id|k
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_dev_size_mb
OL
l_int|1
)paren
id|scsi_debug_dev_size_mb
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* force minimum 1 MB ramdisk */
id|sdebug_store_size
op_assign
(paren
r_int
r_int
)paren
id|scsi_debug_dev_size_mb
op_star
l_int|1048576
suffix:semicolon
id|sdebug_capacity
op_assign
id|sdebug_store_size
op_div
id|SECT_SIZE
suffix:semicolon
multiline_comment|/* play around with geometry, don&squot;t waste too much on track 0 */
id|sdebug_heads
op_assign
l_int|8
suffix:semicolon
id|sdebug_sectors_per
op_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_dev_size_mb
op_ge
l_int|16
)paren
id|sdebug_heads
op_assign
l_int|32
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scsi_debug_dev_size_mb
op_ge
l_int|256
)paren
id|sdebug_heads
op_assign
l_int|64
suffix:semicolon
id|sdebug_cylinders_per
op_assign
(paren
r_int
r_int
)paren
id|sdebug_capacity
op_div
(paren
id|sdebug_sectors_per
op_star
id|sdebug_heads
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdebug_cylinders_per
op_ge
l_int|1024
)paren
(brace
multiline_comment|/* other LLDs do this; implies &gt;= 1GB ram disk ... */
id|sdebug_heads
op_assign
l_int|255
suffix:semicolon
id|sdebug_sectors_per
op_assign
l_int|63
suffix:semicolon
id|sdebug_cylinders_per
op_assign
(paren
r_int
r_int
)paren
id|sdebug_capacity
op_div
(paren
id|sdebug_sectors_per
op_star
id|sdebug_heads
)paren
suffix:semicolon
)brace
id|sz
op_assign
id|sdebug_store_size
suffix:semicolon
id|fake_storep
op_assign
id|vmalloc
c_func
(paren
id|sz
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|fake_storep
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;scsi_debug_init: out of memory, 1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fake_storep
comma
l_int|0
comma
id|sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scsi_debug_num_parts
OG
l_int|0
)paren
id|sdebug_build_parts
c_func
(paren
id|fake_storep
)paren
suffix:semicolon
id|init_all_queued
c_func
(paren
)paren
suffix:semicolon
id|device_register
c_func
(paren
op_amp
id|pseudo_primary
)paren
suffix:semicolon
id|bus_register
c_func
(paren
op_amp
id|pseudo_lld_bus
)paren
suffix:semicolon
id|driver_register
c_func
(paren
op_amp
id|sdebug_driverfs_driver
)paren
suffix:semicolon
id|do_create_driverfs_files
c_func
(paren
)paren
suffix:semicolon
id|sdebug_driver_template.proc_name
op_assign
(paren
r_char
op_star
)paren
id|sdebug_proc_name
suffix:semicolon
id|host_to_add
op_assign
id|scsi_debug_add_host
suffix:semicolon
id|scsi_debug_add_host
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|host_to_add
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sdebug_add_adapter
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;scsi_debug_init: &quot;
l_string|&quot;sdebug_add_adapter failed k=%d&bslash;n&quot;
comma
id|k
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug_init: built %d host(s)&bslash;n&quot;
comma
id|scsi_debug_add_host
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|scsi_debug_exit
r_static
r_void
id|__exit
id|scsi_debug_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|k
op_assign
id|scsi_debug_add_host
suffix:semicolon
id|stop_all_queued
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|k
suffix:semicolon
id|k
op_decrement
)paren
id|sdebug_remove_adapter
c_func
(paren
)paren
suffix:semicolon
id|do_remove_driverfs_files
c_func
(paren
)paren
suffix:semicolon
id|driver_unregister
c_func
(paren
op_amp
id|sdebug_driverfs_driver
)paren
suffix:semicolon
id|bus_unregister
c_func
(paren
op_amp
id|pseudo_lld_bus
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|pseudo_primary
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|fake_storep
)paren
suffix:semicolon
)brace
DECL|variable|scsi_debug_init
id|device_initcall
c_func
(paren
id|scsi_debug_init
)paren
suffix:semicolon
DECL|variable|scsi_debug_exit
id|module_exit
c_func
(paren
id|scsi_debug_exit
)paren
suffix:semicolon
DECL|function|pseudo_0_release
r_void
id|pseudo_0_release
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|SCSI_DEBUG_OPT_NOISE
op_amp
id|scsi_debug_opts
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;scsi_debug: pseudo_0_release() called&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|pseudo_primary
r_static
r_struct
id|device
id|pseudo_primary
op_assign
(brace
dot
id|bus_id
op_assign
l_string|&quot;pseudo_0&quot;
comma
dot
id|release
op_assign
id|pseudo_0_release
comma
)brace
suffix:semicolon
DECL|function|pseudo_lld_bus_match
r_static
r_int
id|pseudo_lld_bus_match
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|device_driver
op_star
id|dev_driver
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|pseudo_lld_bus
r_static
r_struct
id|bus_type
id|pseudo_lld_bus
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;pseudo&quot;
comma
dot
id|match
op_assign
id|pseudo_lld_bus_match
comma
)brace
suffix:semicolon
DECL|function|sdebug_release_adapter
r_static
r_void
id|sdebug_release_adapter
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
id|sdbg_host
op_assign
id|to_sdebug_host
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sdbg_host
)paren
suffix:semicolon
)brace
DECL|function|sdebug_add_adapter
r_static
r_int
id|sdebug_add_adapter
c_func
(paren
r_void
)paren
(brace
r_int
id|k
comma
id|devs_per_host
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|sdbg_devinfo
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
comma
op_star
id|lh_sf
suffix:semicolon
id|sdbg_host
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sdbg_host
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|sdbg_host
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory at line %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|__LINE__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sdbg_host
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sdbg_host
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sdbg_host-&gt;dev_info_list
)paren
suffix:semicolon
id|devs_per_host
op_assign
id|scsi_debug_num_tgts
op_star
id|scsi_debug_max_luns
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|devs_per_host
suffix:semicolon
id|k
op_increment
)paren
(brace
id|sdbg_devinfo
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sdbg_devinfo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|sdbg_devinfo
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory at line %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|__LINE__
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|clean
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sdbg_devinfo
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sdbg_devinfo
)paren
)paren
suffix:semicolon
id|sdbg_devinfo-&gt;sdbg_host
op_assign
id|sdbg_host
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|sdbg_devinfo-&gt;dev_list
comma
op_amp
id|sdbg_host-&gt;dev_info_list
)paren
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|sdbg_host-&gt;host_list
comma
op_amp
id|sdebug_host_list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
id|sdbg_host-&gt;dev.bus
op_assign
op_amp
id|pseudo_lld_bus
suffix:semicolon
id|sdbg_host-&gt;dev.parent
op_assign
op_amp
id|pseudo_primary
suffix:semicolon
id|sdbg_host-&gt;dev.release
op_assign
op_amp
id|sdebug_release_adapter
suffix:semicolon
id|sprintf
c_func
(paren
id|sdbg_host-&gt;dev.bus_id
comma
l_string|&quot;adapter%d&quot;
comma
id|scsi_debug_add_host
)paren
suffix:semicolon
id|error
op_assign
id|device_register
c_func
(paren
op_amp
id|sdbg_host-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|clean
suffix:semicolon
op_increment
id|scsi_debug_add_host
suffix:semicolon
r_return
id|error
suffix:semicolon
id|clean
suffix:colon
id|list_for_each_safe
c_func
(paren
id|lh
comma
id|lh_sf
comma
op_amp
id|sdbg_host-&gt;dev_info_list
)paren
(brace
id|sdbg_devinfo
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|sdebug_dev_info
comma
id|dev_list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sdbg_devinfo-&gt;dev_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sdbg_devinfo
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|sdbg_host
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|sdebug_remove_adapter
r_static
r_void
id|sdebug_remove_adapter
c_func
(paren
r_void
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|sdebug_host_list
)paren
)paren
(brace
id|sdbg_host
op_assign
id|list_entry
c_func
(paren
id|sdebug_host_list.prev
comma
r_struct
id|sdebug_host_info
comma
id|host_list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sdbg_host-&gt;host_list
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sdbg_host
)paren
r_return
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|sdbg_host-&gt;dev
)paren
suffix:semicolon
op_decrement
id|scsi_debug_add_host
suffix:semicolon
)brace
DECL|function|sdebug_driver_probe
r_static
r_int
id|sdebug_driver_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|hpnt
suffix:semicolon
id|sdbg_host
op_assign
id|to_sdebug_host
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hpnt
op_assign
id|scsi_host_alloc
c_func
(paren
op_amp
id|sdebug_driver_template
comma
r_sizeof
(paren
id|sdbg_host
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|hpnt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: scsi_register failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|sdbg_host-&gt;shost
op_assign
id|hpnt
suffix:semicolon
op_star
(paren
(paren
r_struct
id|sdebug_host_info
op_star
op_star
)paren
id|hpnt-&gt;hostdata
)paren
op_assign
id|sdbg_host
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hpnt-&gt;this_id
op_ge
l_int|0
)paren
op_logical_and
(paren
id|scsi_debug_num_tgts
OG
id|hpnt-&gt;this_id
)paren
)paren
id|hpnt-&gt;max_id
op_assign
id|scsi_debug_num_tgts
op_plus
l_int|1
suffix:semicolon
r_else
id|hpnt-&gt;max_id
op_assign
id|scsi_debug_num_tgts
suffix:semicolon
id|hpnt-&gt;max_lun
op_assign
id|scsi_debug_max_luns
suffix:semicolon
id|error
op_assign
id|scsi_add_host
c_func
(paren
id|hpnt
comma
op_amp
id|sdbg_host-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: scsi_add_host failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|scsi_host_put
c_func
(paren
id|hpnt
)paren
suffix:semicolon
)brace
r_else
id|scsi_scan_host
c_func
(paren
id|hpnt
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|sdebug_driver_remove
r_static
r_int
id|sdebug_driver_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|list_head
op_star
id|lh
comma
op_star
id|lh_sf
suffix:semicolon
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|sdebug_dev_info
op_star
id|sdbg_devinfo
suffix:semicolon
id|sdbg_host
op_assign
id|to_sdebug_host
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sdbg_host
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Unable to locate host info&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|scsi_remove_host
c_func
(paren
id|sdbg_host-&gt;shost
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|lh
comma
id|lh_sf
comma
op_amp
id|sdbg_host-&gt;dev_info_list
)paren
(brace
id|sdbg_devinfo
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|sdebug_dev_info
comma
id|dev_list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sdbg_devinfo-&gt;dev_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sdbg_devinfo
)paren
suffix:semicolon
)brace
id|scsi_host_put
c_func
(paren
id|sdbg_host-&gt;shost
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sdebug_max_tgts_luns
r_static
r_void
id|sdebug_max_tgts_luns
c_func
(paren
r_void
)paren
(brace
r_struct
id|sdebug_host_info
op_star
id|sdbg_host
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|hpnt
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|sdbg_host
comma
op_amp
id|sdebug_host_list
comma
id|host_list
)paren
(brace
id|hpnt
op_assign
id|sdbg_host-&gt;shost
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hpnt-&gt;this_id
op_ge
l_int|0
)paren
op_logical_and
(paren
id|scsi_debug_num_tgts
OG
id|hpnt-&gt;this_id
)paren
)paren
id|hpnt-&gt;max_id
op_assign
id|scsi_debug_num_tgts
op_plus
l_int|1
suffix:semicolon
r_else
id|hpnt-&gt;max_id
op_assign
id|scsi_debug_num_tgts
suffix:semicolon
id|hpnt-&gt;max_lun
op_assign
id|scsi_debug_max_luns
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|sdebug_host_list_lock
)paren
suffix:semicolon
)brace
eof
