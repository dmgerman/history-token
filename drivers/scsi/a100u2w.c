multiline_comment|/**************************************************************************&n; * Initio A100 device driver for Linux.&n; *&n; * Copyright (c) 1994-1998 Initio Corporation&n; * All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; see the file COPYING.  If not, write to&n; * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * --------------------------------------------------------------------------&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification, immediately at the beginning of the file.&n; * 2. Redistributions in binary form must reproduce the above copyright&n; *    notice, this list of conditions and the following disclaimer in the&n; *    documentation and/or other materials provided with the distribution.&n; * 3. The name of the author may not be used to endorse or promote products&n; *    derived from this software without specific prior written permission.&n; *&n; * Where this Software is combined with software released under the terms of &n; * the GNU General Public License (&quot;GPL&quot;) and the terms of the GPL would require the &n; * combined work to also be released under the terms of the GPL, the terms&n; * and conditions of this License will apply in addition to those of the&n; * GPL with the exception of any terms or conditions of this License that&n; * conflict with, or are expressly prohibited by, the GPL.&n; *&n; * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&squot;&squot; AND&n; * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE&n; * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE&n; * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR&n; * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT&n; * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY&n; * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF&n; * SUCH DAMAGE.&n; *&n; **************************************************************************&n; * &n; * module: inia100.c&n; * DESCRIPTION:&n; * &t;This is the Linux low-level SCSI driver for Initio INIA100 SCSI host&n; * &t;adapters&n; * 07/02/98 hl&t;- v.91n Initial drivers.&n; * 09/14/98 hl - v1.01 Support new Kernel.&n; * 09/22/98 hl - v1.01a Support reset.&n; * 09/24/98 hl - v1.01b Fixed reset.&n; * 10/05/98 hl - v1.02 split the source code and release.&n; * 12/19/98 bv - v1.02a Use spinlocks for 2.1.95 and up&n; * 01/31/99 bv - v1.02b Use mdelay instead of waitForPause&n; * 08/08/99 bv - v1.02c Use waitForPause again.&n; * 06/25/02 Doug Ledford &lt;dledford@redhat.com&gt; - v1.02d&n; *          - Remove limit on number of controllers&n; *          - Port to DMA mapping API&n; *          - Clean up interrupt handler registration&n; *          - Fix memory leaks&n; *          - Fix allocation of scsi host structs and private data&n; * 18/11/03 Christoph Hellwig &lt;hch@lst.de&gt;&n; *&t;    - Port to new probing API&n; *&t;    - Fix some more leaks in init failure cases&n; * TODO:&n; *&t;    - use list.h macros for SCB queue&n; *&t;  ( - merge with i60uscsi.c )&n; **************************************************************************/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;scsi/scsi.h&gt;
macro_line|#include &lt;scsi/scsi_cmnd.h&gt;
macro_line|#include &lt;scsi/scsi_device.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;inia100.h&quot;
DECL|macro|ORC_RDWORD
mdefine_line|#define ORC_RDWORD(x,y)         (short)(inl((int)((ULONG)((ULONG)x+(UCHAR)y)) ))
DECL|variable|inia100_Copyright
r_char
op_star
id|inia100_Copyright
op_assign
l_string|&quot;Copyright (C) 1998-99&quot;
suffix:semicolon
DECL|variable|inia100_InitioName
r_char
op_star
id|inia100_InitioName
op_assign
l_string|&quot;by Initio Corporation&quot;
suffix:semicolon
DECL|variable|inia100_ProductName
r_char
op_star
id|inia100_ProductName
op_assign
l_string|&quot;INI-A100U2W&quot;
suffix:semicolon
DECL|variable|inia100_Version
r_char
op_star
id|inia100_Version
op_assign
l_string|&quot;v1.02d&quot;
suffix:semicolon
DECL|macro|JIFFIES_TO_MS
mdefine_line|#define JIFFIES_TO_MS(t) ((t) * 1000 / HZ)
DECL|macro|MS_TO_JIFFIES
mdefine_line|#define MS_TO_JIFFIES(j) ((j * HZ) / 1000)
multiline_comment|/* ---- INTERNAL FUNCTIONS ---- */
r_static
id|UCHAR
id|waitChipReady
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|waitFWReady
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|waitFWReady
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|waitSCSIRSTdone
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|waitHDOoff
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|waitHDIset
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|UCHAR
op_star
id|pData
)paren
suffix:semicolon
r_static
r_int
r_int
id|get_FW_version
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|set_NVRAM
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
r_int
r_char
id|address
comma
r_int
r_char
id|value
)paren
suffix:semicolon
r_static
id|UCHAR
id|get_NVRAM
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
r_int
r_char
id|address
comma
r_int
r_char
op_star
id|pDataIn
)paren
suffix:semicolon
r_static
r_int
id|se2_rd_all
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
r_void
id|se2_update_all
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* setup default pattern        */
r_static
r_void
id|read_eeprom
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
id|UCHAR
id|load_FW
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
r_void
id|setup_SCBs
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
r_static
r_void
id|initAFlag
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
id|ORC_SCB
op_star
id|orc_alloc_scb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* ---- EXTERNAL FUNCTIONS ---- */
r_extern
r_void
id|inia100SCBPost
c_func
(paren
id|BYTE
op_star
id|pHcb
comma
id|BYTE
op_star
id|pScb
)paren
suffix:semicolon
DECL|variable|nvram
DECL|variable|nvramp
id|NVRAM
id|nvram
comma
op_star
id|nvramp
op_assign
op_amp
id|nvram
suffix:semicolon
DECL|variable|dftNvRam
r_static
id|UCHAR
id|dftNvRam
(braket
l_int|64
)braket
op_assign
(brace
multiline_comment|/*----------header -------------*/
l_int|0x01
comma
multiline_comment|/* 0x00: Sub System Vendor ID 0 */
l_int|0x11
comma
multiline_comment|/* 0x01: Sub System Vendor ID 1 */
l_int|0x60
comma
multiline_comment|/* 0x02: Sub System ID 0        */
l_int|0x10
comma
multiline_comment|/* 0x03: Sub System ID 1        */
l_int|0x00
comma
multiline_comment|/* 0x04: SubClass               */
l_int|0x01
comma
multiline_comment|/* 0x05: Vendor ID 0            */
l_int|0x11
comma
multiline_comment|/* 0x06: Vendor ID 1            */
l_int|0x60
comma
multiline_comment|/* 0x07: Device ID 0            */
l_int|0x10
comma
multiline_comment|/* 0x08: Device ID 1            */
l_int|0x00
comma
multiline_comment|/* 0x09: Reserved               */
l_int|0x00
comma
multiline_comment|/* 0x0A: Reserved               */
l_int|0x01
comma
multiline_comment|/* 0x0B: Revision of Data Structure     */
multiline_comment|/* -- Host Adapter Structure --- */
l_int|0x01
comma
multiline_comment|/* 0x0C: Number Of SCSI Channel */
l_int|0x01
comma
multiline_comment|/* 0x0D: BIOS Configuration 1   */
l_int|0x00
comma
multiline_comment|/* 0x0E: BIOS Configuration 2   */
l_int|0x00
comma
multiline_comment|/* 0x0F: BIOS Configuration 3   */
multiline_comment|/* --- SCSI Channel 0 Configuration --- */
l_int|0x07
comma
multiline_comment|/* 0x10: H/A ID                 */
l_int|0x83
comma
multiline_comment|/* 0x11: Channel Configuration  */
l_int|0x20
comma
multiline_comment|/* 0x12: MAX TAG per target     */
l_int|0x0A
comma
multiline_comment|/* 0x13: SCSI Reset Recovering time     */
l_int|0x00
comma
multiline_comment|/* 0x14: Channel Configuration4 */
l_int|0x00
comma
multiline_comment|/* 0x15: Channel Configuration5 */
multiline_comment|/* SCSI Channel 0 Target Configuration  */
multiline_comment|/* 0x16-0x25                    */
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
multiline_comment|/* --- SCSI Channel 1 Configuration --- */
l_int|0x07
comma
multiline_comment|/* 0x26: H/A ID                 */
l_int|0x83
comma
multiline_comment|/* 0x27: Channel Configuration  */
l_int|0x20
comma
multiline_comment|/* 0x28: MAX TAG per target     */
l_int|0x0A
comma
multiline_comment|/* 0x29: SCSI Reset Recovering time     */
l_int|0x00
comma
multiline_comment|/* 0x2A: Channel Configuration4 */
l_int|0x00
comma
multiline_comment|/* 0x2B: Channel Configuration5 */
multiline_comment|/* SCSI Channel 1 Target Configuration  */
multiline_comment|/* 0x2C-0x3B                    */
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0xC8
comma
l_int|0x00
comma
multiline_comment|/* 0x3C: Reserved               */
l_int|0x00
comma
multiline_comment|/* 0x3D: Reserved               */
l_int|0x00
comma
multiline_comment|/* 0x3E: Reserved               */
l_int|0x00
multiline_comment|/* 0x3F: Checksum               */
)brace
suffix:semicolon
multiline_comment|/***************************************************************************/
DECL|function|waitForPause
r_static
r_void
id|waitForPause
c_func
(paren
r_int
id|amount
)paren
(brace
id|ULONG
id|the_time
op_assign
id|jiffies
op_plus
id|MS_TO_JIFFIES
c_func
(paren
id|amount
)paren
suffix:semicolon
r_while
c_loop
(paren
id|time_before_eq
c_func
(paren
id|jiffies
comma
id|the_time
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|waitChipReady
id|UCHAR
id|waitChipReady
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Wait 1 second for report timeout     */
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HCTRL
)paren
op_amp
id|HOSTSTOP
)paren
multiline_comment|/* Wait HOSTSTOP set */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
id|waitForPause
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait 100ms before try again  */
)brace
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|waitFWReady
id|UCHAR
id|waitFWReady
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Wait 1 second for report timeout     */
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HSTUS
)paren
op_amp
id|RREADY
)paren
multiline_comment|/* Wait READY set */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
id|waitForPause
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait 100ms before try again  */
)brace
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|waitSCSIRSTdone
id|UCHAR
id|waitSCSIRSTdone
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Wait 1 second for report timeout     */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HCTRL
)paren
op_amp
id|SCSIRST
)paren
)paren
multiline_comment|/* Wait SCSIRST done */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
id|waitForPause
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait 100ms before try again  */
)brace
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|waitHDOoff
id|UCHAR
id|waitHDOoff
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Wait 1 second for report timeout     */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HCTRL
)paren
op_amp
id|HDO
)paren
)paren
multiline_comment|/* Wait HDO off */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
id|waitForPause
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait 100ms before try again  */
)brace
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|waitHDIset
id|UCHAR
id|waitHDIset
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|UCHAR
op_star
id|pData
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Wait 1 second for report timeout     */
r_if
c_cond
(paren
(paren
op_star
id|pData
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HSTUS
)paren
)paren
op_amp
id|HDI
)paren
r_return
(paren
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* Wait HDI set */
id|waitForPause
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait 100ms before try again  */
)brace
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|get_FW_version
r_int
r_int
id|get_FW_version
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|UCHAR
id|bData
suffix:semicolon
r_union
(brace
r_int
r_int
id|sVersion
suffix:semicolon
r_int
r_char
id|cVersion
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|Version
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|ORC_CMD_VERSION
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDIset
c_func
(paren
id|hcsp
comma
op_amp
id|bData
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDI set   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|Version.cVersion
(braket
l_int|0
)braket
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HDATA
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HSTUS
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Clear HDI            */
r_if
c_cond
(paren
id|waitHDIset
c_func
(paren
id|hcsp
comma
op_amp
id|bData
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDI set   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|Version.cVersion
(braket
l_int|1
)braket
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HDATA
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HSTUS
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Clear HDI            */
r_return
(paren
id|Version.sVersion
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|set_NVRAM
id|UCHAR
id|set_NVRAM
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
r_int
r_char
id|address
comma
r_int
r_char
id|value
)paren
(brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|ORC_CMD_SET_NVM
)paren
suffix:semicolon
multiline_comment|/* Write command */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|address
)paren
suffix:semicolon
multiline_comment|/* Write address */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* Write value  */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
r_return
(paren
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|get_NVRAM
id|UCHAR
id|get_NVRAM
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
r_int
r_char
id|address
comma
r_int
r_char
op_star
id|pDataIn
)paren
(brace
r_int
r_char
id|bData
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|ORC_CMD_GET_NVM
)paren
suffix:semicolon
multiline_comment|/* Write command */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|address
)paren
suffix:semicolon
multiline_comment|/* Write address */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDIset
c_func
(paren
id|hcsp
comma
op_amp
id|bData
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDI set   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
op_star
id|pDataIn
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HDATA
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HSTUS
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Clear HDI    */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|orc_exec_scb
r_void
id|orc_exec_scb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|ORC_SCB
op_star
id|scbp
)paren
(brace
id|scbp-&gt;SCB_Status
op_assign
id|ORCSCB_POST
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_PQUEUE
comma
id|scbp-&gt;SCB_ScbIdx
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; Read SCSI H/A configuration parameters from serial EEPROM&n;************************************************************************/
DECL|function|se2_rd_all
r_int
id|se2_rd_all
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_int
id|i
suffix:semicolon
id|UCHAR
op_star
id|np
comma
id|chksum
op_assign
l_int|0
suffix:semicolon
id|np
op_assign
(paren
id|UCHAR
op_star
)paren
id|nvramp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
comma
id|np
op_increment
)paren
(brace
multiline_comment|/* &lt;01&gt; */
r_if
c_cond
(paren
id|get_NVRAM
c_func
(paren
id|hcsp
comma
(paren
r_int
r_char
)paren
id|i
comma
id|np
)paren
op_eq
id|FALSE
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|//      *np++ = get_NVRAM(hcsp, (unsigned char ) i);
)brace
multiline_comment|/*------ Is ckecksum ok ? ------*/
id|np
op_assign
(paren
id|UCHAR
op_star
)paren
id|nvramp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|63
suffix:semicolon
id|i
op_increment
)paren
id|chksum
op_add_assign
op_star
id|np
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|nvramp-&gt;CheckSum
op_ne
(paren
id|UCHAR
)paren
id|chksum
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/************************************************************************&n; Update SCSI H/A configuration parameters from serial EEPROM&n;*************************************************************************/
DECL|function|se2_update_all
r_void
id|se2_update_all
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
multiline_comment|/* setup default pattern  */
r_int
id|i
suffix:semicolon
id|UCHAR
op_star
id|np
comma
op_star
id|np1
comma
id|chksum
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Calculate checksum first   */
id|np
op_assign
(paren
id|UCHAR
op_star
)paren
id|dftNvRam
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|63
suffix:semicolon
id|i
op_increment
)paren
id|chksum
op_add_assign
op_star
id|np
op_increment
suffix:semicolon
op_star
id|np
op_assign
id|chksum
suffix:semicolon
id|np
op_assign
(paren
id|UCHAR
op_star
)paren
id|dftNvRam
suffix:semicolon
id|np1
op_assign
(paren
id|UCHAR
op_star
)paren
id|nvramp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
comma
id|np
op_increment
comma
id|np1
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|np
op_ne
op_star
id|np1
)paren
(brace
id|set_NVRAM
c_func
(paren
id|hcsp
comma
(paren
r_int
r_char
)paren
id|i
comma
op_star
id|np
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*************************************************************************&n; Function name  : read_eeprom&n;**************************************************************************/
DECL|function|read_eeprom
r_void
id|read_eeprom
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
r_if
c_cond
(paren
id|se2_rd_all
c_func
(paren
id|hcsp
)paren
op_ne
l_int|1
)paren
(brace
id|se2_update_all
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* setup default pattern        */
id|se2_rd_all
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* load again                   */
)brace
)brace
multiline_comment|/***************************************************************************/
DECL|function|load_FW
id|UCHAR
id|load_FW
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|U32
id|dData
suffix:semicolon
id|USHORT
id|wBIOSAddress
suffix:semicolon
id|USHORT
id|i
suffix:semicolon
id|UCHAR
op_star
id|pData
comma
id|bData
suffix:semicolon
id|bData
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_GCFG
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GCFG
comma
id|bData
op_or
id|EEPRG
)paren
suffix:semicolon
multiline_comment|/* Enable EEPROM programming */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR2
comma
l_int|0x00
)paren
suffix:semicolon
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
op_ne
l_int|0x55
)paren
(brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GCFG
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Disable EEPROM programming */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
op_ne
l_int|0xAA
)paren
(brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GCFG
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Disable EEPROM programming */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_RISCCTL
comma
id|PRGMRST
op_or
id|DOWNLOAD
)paren
suffix:semicolon
multiline_comment|/* Enable SRAM programming */
id|pData
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|dData
suffix:semicolon
id|dData
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initial FW address to 0 */
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
l_int|0x10
)paren
suffix:semicolon
op_star
id|pData
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
suffix:semicolon
multiline_comment|/* Read from BIOS */
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
l_int|0x11
)paren
suffix:semicolon
op_star
(paren
id|pData
op_plus
l_int|1
)paren
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
suffix:semicolon
multiline_comment|/* Read from BIOS */
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
l_int|0x12
)paren
suffix:semicolon
op_star
(paren
id|pData
op_plus
l_int|2
)paren
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
suffix:semicolon
multiline_comment|/* Read from BIOS */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR2
comma
op_star
(paren
id|pData
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|ORC_WRLONG
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_FWBASEADR
comma
id|dData
)paren
suffix:semicolon
multiline_comment|/* Write FW address */
id|wBIOSAddress
op_assign
(paren
id|USHORT
)paren
id|dData
suffix:semicolon
multiline_comment|/* FW code locate at BIOS address + ? */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|pData
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|dData
suffix:semicolon
multiline_comment|/* Download the code    */
id|i
OL
l_int|0x1000
suffix:semicolon
multiline_comment|/* Firmware code size = 4K      */
id|i
op_increment
comma
id|wBIOSAddress
op_increment
)paren
(brace
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
id|wBIOSAddress
)paren
suffix:semicolon
op_star
id|pData
op_increment
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
suffix:semicolon
multiline_comment|/* Read from BIOS */
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|4
)paren
op_eq
l_int|3
)paren
(brace
id|ORC_WRLONG
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_RISCRAM
comma
id|dData
)paren
suffix:semicolon
multiline_comment|/* Write every 4 bytes */
id|pData
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|dData
suffix:semicolon
)brace
)brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_RISCCTL
comma
id|PRGMRST
op_or
id|DOWNLOAD
)paren
suffix:semicolon
multiline_comment|/* Reset program count 0 */
id|wBIOSAddress
op_sub_assign
l_int|0x1000
suffix:semicolon
multiline_comment|/* Reset the BIOS adddress      */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|pData
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|dData
suffix:semicolon
multiline_comment|/* Check the code       */
id|i
OL
l_int|0x1000
suffix:semicolon
multiline_comment|/* Firmware code size = 4K      */
id|i
op_increment
comma
id|wBIOSAddress
op_increment
)paren
(brace
id|ORC_WRSHORT
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_EBIOSADR0
comma
id|wBIOSAddress
)paren
suffix:semicolon
op_star
id|pData
op_increment
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_EBIOSDATA
)paren
suffix:semicolon
multiline_comment|/* Read from BIOS */
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|4
)paren
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|ORC_RDLONG
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_RISCRAM
)paren
op_ne
id|dData
)paren
(brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_RISCCTL
comma
id|PRGMRST
)paren
suffix:semicolon
multiline_comment|/* Reset program to 0 */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GCFG
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/*Disable EEPROM programming */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
)brace
id|pData
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
id|dData
suffix:semicolon
)brace
)brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_RISCCTL
comma
id|PRGMRST
)paren
suffix:semicolon
multiline_comment|/* Reset program to 0   */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GCFG
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Disable EEPROM programming */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|setup_SCBs
r_void
id|setup_SCBs
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|ORC_SCB
op_star
id|pVirScb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ESCB
op_star
id|pVirEscb
suffix:semicolon
id|dma_addr_t
id|pPhysEscb
suffix:semicolon
multiline_comment|/* Setup SCB HCS_Base and SCB Size registers */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_SCBSIZE
comma
id|ORC_MAXQUEUE
)paren
suffix:semicolon
multiline_comment|/* Total number of SCBs */
multiline_comment|/* SCB HCS_Base address 0      */
id|ORC_WRLONG
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_SCBBASE0
comma
id|hcsp-&gt;HCS_physScbArray
)paren
suffix:semicolon
multiline_comment|/* SCB HCS_Base address 1      */
id|ORC_WRLONG
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_SCBBASE1
comma
id|hcsp-&gt;HCS_physScbArray
)paren
suffix:semicolon
multiline_comment|/* setup scatter list address with one buffer */
id|pVirScb
op_assign
(paren
id|ORC_SCB
op_star
)paren
id|hcsp-&gt;HCS_virScbArray
suffix:semicolon
id|pVirEscb
op_assign
(paren
id|ESCB
op_star
)paren
id|hcsp-&gt;HCS_virEscbArray
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ORC_MAXQUEUE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pPhysEscb
op_assign
(paren
id|hcsp-&gt;HCS_physEscbArray
op_plus
(paren
r_sizeof
(paren
id|ESCB
)paren
op_star
id|i
)paren
)paren
suffix:semicolon
id|pVirScb-&gt;SCB_SGPAddr
op_assign
(paren
id|U32
)paren
id|pPhysEscb
suffix:semicolon
id|pVirScb-&gt;SCB_SensePAddr
op_assign
(paren
id|U32
)paren
id|pPhysEscb
suffix:semicolon
id|pVirScb-&gt;SCB_EScb
op_assign
id|pVirEscb
suffix:semicolon
id|pVirScb-&gt;SCB_ScbIdx
op_assign
id|i
suffix:semicolon
id|pVirScb
op_increment
suffix:semicolon
id|pVirEscb
op_increment
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|initAFlag
r_static
r_void
id|initAFlag
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|UCHAR
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|hcsp-&gt;BitAllocFlag
(braket
id|i
)braket
(braket
id|j
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/***************************************************************************/
DECL|function|init_orchid
r_int
id|init_orchid
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|UBYTE
op_star
id|readBytep
suffix:semicolon
id|USHORT
id|revision
suffix:semicolon
id|UCHAR
id|i
suffix:semicolon
id|initAFlag
c_func
(paren
id|hcsp
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GIMSK
comma
l_int|0xFF
)paren
suffix:semicolon
multiline_comment|/* Disable all interrupt        */
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HSTUS
)paren
op_amp
id|RREADY
)paren
(brace
multiline_comment|/* Orchid is ready              */
id|revision
op_assign
id|get_FW_version
c_func
(paren
id|hcsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|revision
op_eq
l_int|0xFFFF
)paren
(brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|DEVRST
)paren
suffix:semicolon
multiline_comment|/* Reset Host Adapter   */
r_if
c_cond
(paren
id|waitChipReady
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|load_FW
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* Download FW                  */
id|setup_SCBs
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* Setup SCB HCS_Base and SCB Size registers */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clear HOSTSTOP       */
r_if
c_cond
(paren
id|waitFWReady
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Wait for firmware ready     */
)brace
r_else
(brace
id|setup_SCBs
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* Setup SCB HCS_Base and SCB Size registers */
)brace
)brace
r_else
(brace
multiline_comment|/* Orchid is not Ready          */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|DEVRST
)paren
suffix:semicolon
multiline_comment|/* Reset Host Adapter   */
r_if
c_cond
(paren
id|waitChipReady
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|load_FW
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* Download FW                  */
id|setup_SCBs
c_func
(paren
id|hcsp
)paren
suffix:semicolon
multiline_comment|/* Setup SCB HCS_Base and SCB Size registers */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
multiline_comment|/* Do Hardware Reset &amp;  */
multiline_comment|/*     clear HOSTSTOP  */
r_if
c_cond
(paren
id|waitFWReady
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait for firmware ready      */
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*------------- get serial EEProm settting -------*/
id|read_eeprom
c_func
(paren
id|hcsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nvramp-&gt;Revision
op_ne
l_int|1
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|hcsp-&gt;HCS_SCSI_ID
op_assign
id|nvramp-&gt;SCSI0Id
suffix:semicolon
id|hcsp-&gt;HCS_BIOS
op_assign
id|nvramp-&gt;BIOSConfig1
suffix:semicolon
id|hcsp-&gt;HCS_MaxTar
op_assign
id|MAX_TARGETS
suffix:semicolon
id|readBytep
op_assign
(paren
id|UCHAR
op_star
)paren
op_amp
(paren
id|nvramp-&gt;Target00Config
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|readBytep
op_increment
comma
id|i
op_increment
)paren
(brace
id|hcsp-&gt;TargetFlag
(braket
id|i
)braket
op_assign
op_star
id|readBytep
suffix:semicolon
id|hcsp-&gt;MaximumTags
(braket
id|i
)braket
op_assign
id|ORC_MAXTAGS
suffix:semicolon
)brace
multiline_comment|/* for                          */
r_if
c_cond
(paren
id|nvramp-&gt;SCSI0Config
op_amp
id|NCC_BUSRESET
)paren
(brace
multiline_comment|/* Reset SCSI bus               */
id|hcsp-&gt;HCS_Flags
op_or_assign
id|HCF_SCSI_RESET
suffix:semicolon
)brace
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_GIMSK
comma
l_int|0xFB
)paren
suffix:semicolon
multiline_comment|/* enable RP FIFO interrupt     */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : orc_reset_scsi_bus&n; Description    : Reset registers, reset a hanging bus and&n;                  kill active and disconnected commands for target w/o soft reset&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|orc_reset_scsi_bus
r_int
id|orc_reset_scsi_bus
c_func
(paren
id|ORC_HCS
op_star
id|pHCB
)paren
(brace
multiline_comment|/* I need Host Control Block Information */
id|ULONG
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
id|initAFlag
c_func
(paren
id|pHCB
)paren
suffix:semicolon
multiline_comment|/* reset scsi bus */
id|ORC_WR
c_func
(paren
id|pHCB-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|SCSIRST
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitSCSIRSTdone
c_func
(paren
id|pHCB
)paren
op_eq
id|FALSE
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************&n; Function name  : orc_device_reset&n; Description    : Reset registers, reset a hanging bus and&n;                  kill active and disconnected commands for target w/o soft reset&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|orc_device_reset
r_int
id|orc_device_reset
c_func
(paren
id|ORC_HCS
op_star
id|pHCB
comma
id|Scsi_Cmnd
op_star
id|SCpnt
comma
r_int
r_int
id|target
)paren
(brace
multiline_comment|/* I need Host Control Block Information */
id|ORC_SCB
op_star
id|pScb
suffix:semicolon
id|ESCB
op_star
id|pVirEscb
suffix:semicolon
id|ORC_SCB
op_star
id|pVirScb
suffix:semicolon
id|UCHAR
id|i
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
id|pScb
op_assign
(paren
id|ORC_SCB
op_star
)paren
l_int|NULL
suffix:semicolon
id|pVirEscb
op_assign
(paren
id|ESCB
op_star
)paren
l_int|NULL
suffix:semicolon
multiline_comment|/* setup scatter list address with one buffer */
id|pVirScb
op_assign
(paren
id|ORC_SCB
op_star
)paren
id|pHCB-&gt;HCS_virScbArray
suffix:semicolon
id|initAFlag
c_func
(paren
id|pHCB
)paren
suffix:semicolon
multiline_comment|/* device reset */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ORC_MAXQUEUE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pVirEscb
op_assign
id|pVirScb-&gt;SCB_EScb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pVirScb-&gt;SCB_Status
)paren
op_logical_and
(paren
id|pVirEscb-&gt;SCB_Srb
op_eq
id|SCpnt
)paren
)paren
r_break
suffix:semicolon
id|pVirScb
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|ORC_MAXQUEUE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Unable to Reset - No SCB Found&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pScb
op_assign
id|orc_alloc_scb
c_func
(paren
id|pHCB
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
id|pScb-&gt;SCB_Opcode
op_assign
id|ORC_BUSDEVRST
suffix:semicolon
id|pScb-&gt;SCB_Target
op_assign
id|target
suffix:semicolon
id|pScb-&gt;SCB_HaStat
op_assign
l_int|0
suffix:semicolon
id|pScb-&gt;SCB_TaStat
op_assign
l_int|0
suffix:semicolon
id|pScb-&gt;SCB_Status
op_assign
l_int|0x0
suffix:semicolon
id|pScb-&gt;SCB_Link
op_assign
l_int|0xFF
suffix:semicolon
id|pScb-&gt;SCB_Reserved0
op_assign
l_int|0
suffix:semicolon
id|pScb-&gt;SCB_Reserved1
op_assign
l_int|0
suffix:semicolon
id|pScb-&gt;SCB_XferLen
op_assign
l_int|0
suffix:semicolon
id|pScb-&gt;SCB_SGLen
op_assign
l_int|0
suffix:semicolon
id|pVirEscb-&gt;SCB_Srb
op_assign
l_int|NULL
suffix:semicolon
id|pVirEscb-&gt;SCB_Srb
op_assign
id|SCpnt
suffix:semicolon
id|orc_exec_scb
c_func
(paren
id|pHCB
comma
id|pScb
)paren
suffix:semicolon
multiline_comment|/* Start execute SCB            */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|pHCB-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|__orc_alloc_scb
id|ORC_SCB
op_star
id|__orc_alloc_scb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|ORC_SCB
op_star
id|pTmpScb
suffix:semicolon
id|UCHAR
id|Ch
suffix:semicolon
id|ULONG
id|idx
suffix:semicolon
id|UCHAR
id|index
suffix:semicolon
id|UCHAR
id|i
suffix:semicolon
id|Ch
op_assign
id|hcsp-&gt;HCS_Index
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
l_int|32
suffix:semicolon
id|index
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|hcsp-&gt;BitAllocFlag
(braket
id|Ch
)braket
(braket
id|i
)braket
op_rshift
id|index
)paren
op_amp
l_int|0x01
)paren
(brace
id|hcsp-&gt;BitAllocFlag
(braket
id|Ch
)braket
(braket
id|i
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|index
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|idx
op_assign
id|index
op_plus
l_int|32
op_star
id|i
suffix:semicolon
id|pTmpScb
op_assign
(paren
id|PVOID
)paren
(paren
(paren
id|ULONG
)paren
id|hcsp-&gt;HCS_virScbArray
op_plus
(paren
id|idx
op_star
r_sizeof
(paren
id|ORC_SCB
)paren
)paren
)paren
suffix:semicolon
r_return
(paren
id|pTmpScb
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|orc_alloc_scb
id|ORC_SCB
op_star
id|orc_alloc_scb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|ORC_SCB
op_star
id|pTmpScb
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
id|pTmpScb
op_assign
id|__orc_alloc_scb
c_func
(paren
id|hcsp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|pTmpScb
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
DECL|function|orc_release_scb
r_void
id|orc_release_scb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|ORC_SCB
op_star
id|scbp
)paren
(brace
id|ULONG
id|flags
suffix:semicolon
id|UCHAR
id|Index
suffix:semicolon
id|UCHAR
id|i
suffix:semicolon
id|UCHAR
id|Ch
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
id|Ch
op_assign
id|hcsp-&gt;HCS_Index
suffix:semicolon
id|Index
op_assign
id|scbp-&gt;SCB_ScbIdx
suffix:semicolon
id|i
op_assign
id|Index
op_div
l_int|32
suffix:semicolon
id|Index
op_mod_assign
l_int|32
suffix:semicolon
id|hcsp-&gt;BitAllocFlag
(braket
id|Ch
)braket
(braket
id|i
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|Index
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : abort_SCB&n; Description    : Abort a queued command.&n;&t;                 (commands that are on the bus can&squot;t be aborted easily)&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|abort_SCB
r_int
id|abort_SCB
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|ORC_SCB
op_star
id|pScb
)paren
(brace
r_int
r_char
id|bData
comma
id|bStatus
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|ORC_CMD_ABORT_SCB
)paren
suffix:semicolon
multiline_comment|/* Write command */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HDATA
comma
id|pScb-&gt;SCB_ScbIdx
)paren
suffix:semicolon
multiline_comment|/* Write address */
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HCTRL
comma
id|HDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDOoff
c_func
(paren
id|hcsp
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDO off   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitHDIset
c_func
(paren
id|hcsp
comma
op_amp
id|bData
)paren
op_eq
id|FALSE
)paren
multiline_comment|/* Wait HDI set   */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
id|bStatus
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_HDATA
)paren
suffix:semicolon
id|ORC_WR
c_func
(paren
id|hcsp-&gt;HCS_Base
op_plus
id|ORC_HSTUS
comma
id|bData
)paren
suffix:semicolon
multiline_comment|/* Clear HDI    */
r_if
c_cond
(paren
id|bStatus
op_eq
l_int|1
)paren
multiline_comment|/* 0 - Successfully               */
r_return
(paren
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* 1 - Fail                     */
r_return
(paren
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100_abort&n; Description    : Abort a queued command.&n;&t;                 (commands that are on the bus can&squot;t be aborted easily)&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|orc_abort_srb
r_int
id|orc_abort_srb
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
comma
id|Scsi_Cmnd
op_star
id|SCpnt
)paren
(brace
id|ESCB
op_star
id|pVirEscb
suffix:semicolon
id|ORC_SCB
op_star
id|pVirScb
suffix:semicolon
id|UCHAR
id|i
suffix:semicolon
id|ULONG
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
id|pVirScb
op_assign
(paren
id|ORC_SCB
op_star
)paren
id|hcsp-&gt;HCS_virScbArray
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ORC_MAXQUEUE
suffix:semicolon
id|i
op_increment
comma
id|pVirScb
op_increment
)paren
(brace
id|pVirEscb
op_assign
id|pVirScb-&gt;SCB_EScb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pVirScb-&gt;SCB_Status
)paren
op_logical_and
(paren
id|pVirEscb-&gt;SCB_Srb
op_eq
id|SCpnt
)paren
)paren
(brace
r_if
c_cond
(paren
id|pVirScb-&gt;SCB_TagMsg
op_eq
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|abort_SCB
c_func
(paren
id|hcsp
comma
id|pVirScb
)paren
)paren
(brace
id|pVirEscb-&gt;SCB_Srb
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
)brace
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|hcsp-&gt;BitAllocFlagLock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|FAILED
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; Routine Description:&n;&t;  This is the interrupt service routine for the Orchid SCSI adapter.&n;&t;  It reads the interrupt register to determine if the adapter is indeed&n;&t;  the source of the interrupt and clears the interrupt at the device.&n; Arguments:&n;&t;  HwDeviceExtension - HBA miniport driver&squot;s adapter data storage&n; Return Value:&n;***********************************************************************/
DECL|function|orc_interrupt
r_void
id|orc_interrupt
c_func
(paren
id|ORC_HCS
op_star
id|hcsp
)paren
(brace
id|BYTE
id|bScbIdx
suffix:semicolon
id|ORC_SCB
op_star
id|pScb
suffix:semicolon
r_if
c_cond
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_RQUEUECNT
)paren
op_eq
l_int|0
)paren
(brace
r_return
suffix:semicolon
singleline_comment|// (FALSE);
)brace
r_do
(brace
id|bScbIdx
op_assign
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_RQUEUE
)paren
suffix:semicolon
id|pScb
op_assign
(paren
id|ORC_SCB
op_star
)paren
(paren
(paren
id|ULONG
)paren
id|hcsp-&gt;HCS_virScbArray
op_plus
(paren
id|ULONG
)paren
(paren
r_sizeof
(paren
id|ORC_SCB
)paren
op_star
id|bScbIdx
)paren
)paren
suffix:semicolon
id|pScb-&gt;SCB_Status
op_assign
l_int|0x0
suffix:semicolon
id|inia100SCBPost
c_func
(paren
(paren
id|BYTE
op_star
)paren
id|hcsp
comma
(paren
id|BYTE
op_star
)paren
id|pScb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ORC_RD
c_func
(paren
id|hcsp-&gt;HCS_Base
comma
id|ORC_RQUEUECNT
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
singleline_comment|//(TRUE);
)brace
multiline_comment|/* End of I1060Interrupt() */
multiline_comment|/*****************************************************************************&n; Function name  : inia100BuildSCB&n; Description    : &n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|inia100BuildSCB
r_static
r_void
id|inia100BuildSCB
c_func
(paren
id|ORC_HCS
op_star
id|pHCB
comma
id|ORC_SCB
op_star
id|pSCB
comma
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
multiline_comment|/* Create corresponding SCB     */
r_struct
id|scatterlist
op_star
id|pSrbSG
suffix:semicolon
id|ORC_SG
op_star
id|pSG
suffix:semicolon
multiline_comment|/* Pointer to SG list           */
r_int
id|i
comma
id|count_sg
suffix:semicolon
id|ESCB
op_star
id|pEScb
suffix:semicolon
id|pEScb
op_assign
id|pSCB-&gt;SCB_EScb
suffix:semicolon
id|pEScb-&gt;SCB_Srb
op_assign
id|SCpnt
suffix:semicolon
id|pSG
op_assign
l_int|NULL
suffix:semicolon
id|pSCB-&gt;SCB_Opcode
op_assign
id|ORC_EXECSCSI
suffix:semicolon
id|pSCB-&gt;SCB_Flags
op_assign
id|SCF_NO_DCHK
suffix:semicolon
multiline_comment|/* Clear done bit               */
id|pSCB-&gt;SCB_Target
op_assign
id|SCpnt-&gt;device-&gt;id
suffix:semicolon
id|pSCB-&gt;SCB_Lun
op_assign
id|SCpnt-&gt;device-&gt;lun
suffix:semicolon
id|pSCB-&gt;SCB_Reserved0
op_assign
l_int|0
suffix:semicolon
id|pSCB-&gt;SCB_Reserved1
op_assign
l_int|0
suffix:semicolon
id|pSCB-&gt;SCB_SGLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSCB-&gt;SCB_XferLen
op_assign
(paren
id|U32
)paren
id|SCpnt-&gt;request_bufflen
)paren
)paren
(brace
id|pSG
op_assign
(paren
id|ORC_SG
op_star
)paren
op_amp
id|pEScb-&gt;ESCB_SGList
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|SCpnt-&gt;use_sg
)paren
(brace
id|pSrbSG
op_assign
(paren
r_struct
id|scatterlist
op_star
)paren
id|SCpnt-&gt;request_buffer
suffix:semicolon
id|count_sg
op_assign
id|pci_map_sg
c_func
(paren
id|pHCB-&gt;pdev
comma
id|pSrbSG
comma
id|SCpnt-&gt;use_sg
comma
id|SCpnt-&gt;sc_data_direction
)paren
suffix:semicolon
id|pSCB-&gt;SCB_SGLen
op_assign
(paren
id|U32
)paren
(paren
id|count_sg
op_star
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count_sg
suffix:semicolon
id|i
op_increment
comma
id|pSG
op_increment
comma
id|pSrbSG
op_increment
)paren
(brace
id|pSG-&gt;SG_Ptr
op_assign
(paren
id|U32
)paren
id|sg_dma_address
c_func
(paren
id|pSrbSG
)paren
suffix:semicolon
id|pSG-&gt;SG_Len
op_assign
(paren
id|U32
)paren
id|sg_dma_len
c_func
(paren
id|pSrbSG
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|SCpnt-&gt;request_bufflen
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Non SG */
id|pSCB-&gt;SCB_SGLen
op_assign
l_int|0x8
suffix:semicolon
id|SCpnt-&gt;SCp.dma_handle
op_assign
id|pci_map_single
c_func
(paren
id|pHCB-&gt;pdev
comma
id|SCpnt-&gt;request_buffer
comma
id|SCpnt-&gt;request_bufflen
comma
id|SCpnt-&gt;sc_data_direction
)paren
suffix:semicolon
id|pSG-&gt;SG_Ptr
op_assign
(paren
id|U32
)paren
id|SCpnt-&gt;SCp.dma_handle
suffix:semicolon
id|pSG-&gt;SG_Len
op_assign
(paren
id|U32
)paren
id|SCpnt-&gt;request_bufflen
suffix:semicolon
)brace
r_else
(brace
id|pSCB-&gt;SCB_SGLen
op_assign
l_int|0
suffix:semicolon
id|pSG-&gt;SG_Ptr
op_assign
l_int|0
suffix:semicolon
id|pSG-&gt;SG_Len
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|pSCB-&gt;SCB_SGPAddr
op_assign
(paren
id|U32
)paren
id|pSCB-&gt;SCB_SensePAddr
suffix:semicolon
id|pSCB-&gt;SCB_HaStat
op_assign
l_int|0
suffix:semicolon
id|pSCB-&gt;SCB_TaStat
op_assign
l_int|0
suffix:semicolon
id|pSCB-&gt;SCB_Link
op_assign
l_int|0xFF
suffix:semicolon
id|pSCB-&gt;SCB_SenseLen
op_assign
id|SENSE_SIZE
suffix:semicolon
id|pSCB-&gt;SCB_CDBLen
op_assign
id|SCpnt-&gt;cmd_len
suffix:semicolon
r_if
c_cond
(paren
id|pSCB-&gt;SCB_CDBLen
op_ge
id|IMAX_CDB
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;max cdb length= %x&bslash;b&quot;
comma
id|SCpnt-&gt;cmd_len
)paren
suffix:semicolon
id|pSCB-&gt;SCB_CDBLen
op_assign
id|IMAX_CDB
suffix:semicolon
)brace
id|pSCB-&gt;SCB_Ident
op_assign
id|SCpnt-&gt;device-&gt;lun
op_or
id|DISC_ALLOW
suffix:semicolon
r_if
c_cond
(paren
id|SCpnt-&gt;device-&gt;tagged_supported
)paren
(brace
multiline_comment|/* Tag Support                  */
id|pSCB-&gt;SCB_TagMsg
op_assign
id|SIMPLE_QUEUE_TAG
suffix:semicolon
multiline_comment|/* Do simple tag only   */
)brace
r_else
(brace
id|pSCB-&gt;SCB_TagMsg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No tag support               */
)brace
id|memcpy
c_func
(paren
op_amp
id|pSCB-&gt;SCB_CDB
(braket
l_int|0
)braket
comma
op_amp
id|SCpnt-&gt;cmnd
comma
id|pSCB-&gt;SCB_CDBLen
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100_queue&n; Description    : Queue a command and setup interrupts for a free bus.&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|inia100_queue
r_static
r_int
id|inia100_queue
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_void
(paren
op_star
id|done
)paren
(paren
r_struct
id|scsi_cmnd
op_star
)paren
)paren
(brace
r_register
id|ORC_SCB
op_star
id|pSCB
suffix:semicolon
id|ORC_HCS
op_star
id|pHCB
suffix:semicolon
multiline_comment|/* Point to Host adapter control block */
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|SCpnt-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
id|SCpnt-&gt;scsi_done
op_assign
id|done
suffix:semicolon
multiline_comment|/* Get free SCSI control block  */
r_if
c_cond
(paren
(paren
id|pSCB
op_assign
id|orc_alloc_scb
c_func
(paren
id|pHCB
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|SCSI_MLQUEUE_HOST_BUSY
suffix:semicolon
id|inia100BuildSCB
c_func
(paren
id|pHCB
comma
id|pSCB
comma
id|SCpnt
)paren
suffix:semicolon
id|orc_exec_scb
c_func
(paren
id|pHCB
comma
id|pSCB
)paren
suffix:semicolon
multiline_comment|/* Start execute SCB            */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100_abort&n; Description    : Abort a queued command.&n;&t;                 (commands that are on the bus can&squot;t be aborted easily)&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|inia100_abort
r_static
r_int
id|inia100_abort
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
id|ORC_HCS
op_star
id|hcsp
suffix:semicolon
id|hcsp
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|SCpnt-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
r_return
id|orc_abort_srb
c_func
(paren
id|hcsp
comma
id|SCpnt
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100_reset&n; Description    : Reset registers, reset a hanging bus and&n;                  kill active and disconnected commands for target w/o soft reset&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|inia100_bus_reset
r_static
r_int
id|inia100_bus_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
multiline_comment|/* I need Host Control Block Information */
id|ORC_HCS
op_star
id|pHCB
suffix:semicolon
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|SCpnt-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
r_return
id|orc_reset_scsi_bus
c_func
(paren
id|pHCB
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100_device_reset&n; Description    : Reset the device&n; Input          : pHCB  -       Pointer to host adapter structure&n; Output         : None.&n; Return         : pSRB  -       Pointer to SCSI request block.&n;*****************************************************************************/
DECL|function|inia100_device_reset
r_static
r_int
id|inia100_device_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
multiline_comment|/* I need Host Control Block Information */
id|ORC_HCS
op_star
id|pHCB
suffix:semicolon
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|SCpnt-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
r_return
id|orc_device_reset
c_func
(paren
id|pHCB
comma
id|SCpnt
comma
id|SCpnt-&gt;device-&gt;id
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; Function name  : inia100SCBPost&n; Description    : This is callback routine be called when orc finish one&n;&t;&t;&t;SCSI command.&n; Input          : pHCB  -       Pointer to host adapter control block.&n;&t;&t;  pSCB  -       Pointer to SCSI control block.&n; Output         : None.&n; Return         : None.&n;*****************************************************************************/
DECL|function|inia100SCBPost
r_void
id|inia100SCBPost
c_func
(paren
id|BYTE
op_star
id|pHcb
comma
id|BYTE
op_star
id|pScb
)paren
(brace
r_struct
id|scsi_cmnd
op_star
id|pSRB
suffix:semicolon
multiline_comment|/* Pointer to SCSI request block */
id|ORC_HCS
op_star
id|pHCB
suffix:semicolon
id|ORC_SCB
op_star
id|pSCB
suffix:semicolon
id|ESCB
op_star
id|pEScb
suffix:semicolon
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|pHcb
suffix:semicolon
id|pSCB
op_assign
(paren
id|ORC_SCB
op_star
)paren
id|pScb
suffix:semicolon
id|pEScb
op_assign
id|pSCB-&gt;SCB_EScb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSRB
op_assign
(paren
r_struct
id|scsi_cmnd
op_star
)paren
id|pEScb-&gt;SCB_Srb
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;inia100SCBPost: SRB pointer is empty&bslash;n&quot;
)paren
suffix:semicolon
id|orc_release_scb
c_func
(paren
id|pHCB
comma
id|pSCB
)paren
suffix:semicolon
multiline_comment|/* Release SCB for current channel */
r_return
suffix:semicolon
)brace
id|pEScb-&gt;SCB_Srb
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|pSCB-&gt;SCB_HaStat
)paren
(brace
r_case
l_int|0x0
suffix:colon
r_case
l_int|0xa
suffix:colon
multiline_comment|/* Linked command complete without error and linked normally */
r_case
l_int|0xb
suffix:colon
multiline_comment|/* Linked command complete without error interrupt generated */
id|pSCB-&gt;SCB_HaStat
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x11
suffix:colon
multiline_comment|/* Selection time out-The initiator selection or target&n;&t;&t;&t;&t;   reselection was not complete within the SCSI Time out period */
id|pSCB-&gt;SCB_HaStat
op_assign
id|DID_TIME_OUT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x14
suffix:colon
multiline_comment|/* Target bus phase sequence failure-An invalid bus phase or bus&n;&t;&t;&t;&t;   phase sequence was requested by the target. The host adapter&n;&t;&t;&t;&t;   will generate a SCSI Reset Condition, notifying the host with&n;&t;&t;&t;&t;   a SCRD interrupt */
id|pSCB-&gt;SCB_HaStat
op_assign
id|DID_RESET
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1a
suffix:colon
multiline_comment|/* SCB Aborted. 07/21/98 */
id|pSCB-&gt;SCB_HaStat
op_assign
id|DID_ABORT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x12
suffix:colon
multiline_comment|/* Data overrun/underrun-The target attempted to transfer more data&n;&t;&t;&t;&t;   than was allocated by the Data Length field or the sum of the&n;&t;&t;&t;&t;   Scatter / Gather Data Length fields. */
r_case
l_int|0x13
suffix:colon
multiline_comment|/* Unexpected bus free-The target dropped the SCSI BSY at an unexpected time. */
r_case
l_int|0x16
suffix:colon
multiline_comment|/* Invalid CCB Operation Code-The first byte of the CCB was invalid. */
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;inia100: %x %x&bslash;n&quot;
comma
id|pSCB-&gt;SCB_HaStat
comma
id|pSCB-&gt;SCB_TaStat
)paren
suffix:semicolon
id|pSCB-&gt;SCB_HaStat
op_assign
id|DID_ERROR
suffix:semicolon
multiline_comment|/* Couldn&squot;t find any better */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pSCB-&gt;SCB_TaStat
op_eq
l_int|2
)paren
(brace
multiline_comment|/* Check condition              */
id|memcpy
c_func
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|pSRB-&gt;sense_buffer
(braket
l_int|0
)braket
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|pEScb-&gt;ESCB_SGList
(braket
l_int|0
)braket
comma
id|SENSE_SIZE
)paren
suffix:semicolon
)brace
id|pSRB-&gt;result
op_assign
id|pSCB-&gt;SCB_TaStat
op_or
(paren
id|pSCB-&gt;SCB_HaStat
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSRB-&gt;use_sg
)paren
(brace
id|pci_unmap_sg
c_func
(paren
id|pHCB-&gt;pdev
comma
(paren
r_struct
id|scatterlist
op_star
)paren
id|pSRB-&gt;request_buffer
comma
id|pSRB-&gt;use_sg
comma
id|pSRB-&gt;sc_data_direction
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pSRB-&gt;request_bufflen
op_ne
l_int|0
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|pHCB-&gt;pdev
comma
id|pSRB-&gt;SCp.dma_handle
comma
id|pSRB-&gt;request_bufflen
comma
id|pSRB-&gt;sc_data_direction
)paren
suffix:semicolon
)brace
id|pSRB
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|pSRB
)paren
suffix:semicolon
multiline_comment|/* Notify system DONE           */
id|orc_release_scb
c_func
(paren
id|pHCB
comma
id|pSCB
)paren
suffix:semicolon
multiline_comment|/* Release SCB for current channel */
)brace
multiline_comment|/*&n; * Interrupt handler (main routine of the driver)&n; */
DECL|function|inia100_intr
r_static
id|irqreturn_t
id|inia100_intr
c_func
(paren
r_int
id|irqno
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|host
op_assign
(paren
r_struct
id|Scsi_Host
op_star
)paren
id|devid
suffix:semicolon
id|ORC_HCS
op_star
id|pHcb
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|host-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|orc_interrupt
c_func
(paren
id|pHcb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|host-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|variable|inia100_template
r_static
r_struct
id|scsi_host_template
id|inia100_template
op_assign
(brace
dot
id|proc_name
op_assign
l_string|&quot;inia100&quot;
comma
dot
id|name
op_assign
id|inia100_REVID
comma
dot
id|queuecommand
op_assign
id|inia100_queue
comma
dot
id|eh_abort_handler
op_assign
id|inia100_abort
comma
dot
id|eh_bus_reset_handler
op_assign
id|inia100_bus_reset
comma
dot
id|eh_device_reset_handler
op_assign
id|inia100_device_reset
comma
dot
id|can_queue
op_assign
l_int|1
comma
dot
id|this_id
op_assign
l_int|1
comma
dot
id|sg_tablesize
op_assign
id|SG_ALL
comma
dot
id|cmd_per_lun
op_assign
l_int|1
comma
dot
id|use_clustering
op_assign
id|ENABLE_CLUSTERING
comma
)brace
suffix:semicolon
DECL|function|inia100_probe_one
r_static
r_int
id|__devinit
id|inia100_probe_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
id|ORC_HCS
op_star
id|pHCB
suffix:semicolon
r_int
r_int
id|port
comma
id|bios
suffix:semicolon
r_int
id|error
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|u32
id|sz
suffix:semicolon
r_int
r_int
id|dBiosAdr
suffix:semicolon
r_char
op_star
id|pbBiosAdr
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
l_int|0xffffffffULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unable to set 32bit DMA &quot;
l_string|&quot;on inia100 adapter, ignoring.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_disable_device
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|port
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|port
comma
l_int|256
comma
l_string|&quot;inia100&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;inia100: io port 0x%lx, is busy.&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_goto
id|out_disable_device
suffix:semicolon
)brace
multiline_comment|/* &lt;02&gt; read from base address + 0x50 offset to get the bios balue. */
id|bios
op_assign
id|ORC_RDWORD
c_func
(paren
id|port
comma
l_int|0x50
)paren
suffix:semicolon
id|shost
op_assign
id|scsi_host_alloc
c_func
(paren
op_amp
id|inia100_template
comma
r_sizeof
(paren
id|ORC_HCS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost
)paren
r_goto
id|out_release_region
suffix:semicolon
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|shost-&gt;hostdata
suffix:semicolon
id|pHCB-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|pHCB-&gt;HCS_Base
op_assign
id|port
suffix:semicolon
id|pHCB-&gt;HCS_BIOS
op_assign
id|bios
suffix:semicolon
id|pHCB-&gt;BitAllocFlagLock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* Get total memory needed for SCB */
id|sz
op_assign
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ORC_SCB
)paren
suffix:semicolon
id|pHCB-&gt;HCS_virScbArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|sz
comma
op_amp
id|pHCB-&gt;HCS_physScbArray
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pHCB-&gt;HCS_virScbArray
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;inia100: SCB memory allocation error&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_host_put
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pHCB-&gt;HCS_virScbArray
comma
l_int|0
comma
id|sz
)paren
suffix:semicolon
multiline_comment|/* Get total memory needed for ESCB */
id|sz
op_assign
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ESCB
)paren
suffix:semicolon
id|pHCB-&gt;HCS_virEscbArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|sz
comma
op_amp
id|pHCB-&gt;HCS_physEscbArray
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pHCB-&gt;HCS_virEscbArray
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;inia100: ESCB memory allocation error&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_free_scb_array
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pHCB-&gt;HCS_virEscbArray
comma
l_int|0
comma
id|sz
)paren
suffix:semicolon
id|dBiosAdr
op_assign
id|pHCB-&gt;HCS_BIOS
suffix:semicolon
id|dBiosAdr
op_assign
(paren
id|dBiosAdr
op_lshift
l_int|4
)paren
suffix:semicolon
id|pbBiosAdr
op_assign
id|phys_to_virt
c_func
(paren
id|dBiosAdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_orchid
c_func
(paren
id|pHCB
)paren
)paren
(brace
multiline_comment|/* Initialize orchid chip */
id|printk
c_func
(paren
l_string|&quot;inia100: initial orchid fail!!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_free_escb_array
suffix:semicolon
)brace
id|shost-&gt;io_port
op_assign
id|pHCB-&gt;HCS_Base
suffix:semicolon
id|shost-&gt;n_io_port
op_assign
l_int|0xff
suffix:semicolon
id|shost-&gt;can_queue
op_assign
id|ORC_MAXQUEUE
suffix:semicolon
id|shost-&gt;unique_id
op_assign
id|shost-&gt;io_port
suffix:semicolon
id|shost-&gt;max_id
op_assign
id|pHCB-&gt;HCS_MaxTar
suffix:semicolon
id|shost-&gt;max_lun
op_assign
l_int|16
suffix:semicolon
id|shost-&gt;irq
op_assign
id|pHCB-&gt;HCS_Intr
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|shost-&gt;this_id
op_assign
id|pHCB-&gt;HCS_SCSI_ID
suffix:semicolon
multiline_comment|/* Assign HCS index */
id|shost-&gt;sg_tablesize
op_assign
id|TOTAL_SG_ENTRY
suffix:semicolon
multiline_comment|/* Initial orc chip           */
id|error
op_assign
id|request_irq
c_func
(paren
id|pdev-&gt;irq
comma
id|inia100_intr
comma
id|SA_SHIRQ
comma
l_string|&quot;inia100&quot;
comma
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;inia100: unable to get irq %d&bslash;n&quot;
comma
id|pdev-&gt;irq
)paren
suffix:semicolon
r_goto
id|out_free_escb_array
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|shost
)paren
suffix:semicolon
id|error
op_assign
id|scsi_add_host
c_func
(paren
id|shost
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out_free_irq
suffix:semicolon
id|scsi_scan_host
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|shost-&gt;irq
comma
id|shost
)paren
suffix:semicolon
id|out_free_escb_array
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ESCB
)paren
comma
id|pHCB-&gt;HCS_virEscbArray
comma
id|pHCB-&gt;HCS_physEscbArray
)paren
suffix:semicolon
id|out_free_scb_array
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ORC_SCB
)paren
comma
id|pHCB-&gt;HCS_virScbArray
comma
id|pHCB-&gt;HCS_physScbArray
)paren
suffix:semicolon
id|out_host_put
suffix:colon
id|scsi_host_put
c_func
(paren
id|shost
)paren
suffix:semicolon
id|out_release_region
suffix:colon
id|release_region
c_func
(paren
id|port
comma
l_int|256
)paren
suffix:semicolon
id|out_disable_device
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
DECL|function|inia100_remove_one
r_static
r_void
id|__devexit
id|inia100_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|ORC_HCS
op_star
id|pHCB
op_assign
(paren
id|ORC_HCS
op_star
)paren
id|shost-&gt;hostdata
suffix:semicolon
id|scsi_remove_host
c_func
(paren
id|shost
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|shost-&gt;irq
comma
id|shost
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ESCB
)paren
comma
id|pHCB-&gt;HCS_virEscbArray
comma
id|pHCB-&gt;HCS_physEscbArray
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|ORC_MAXQUEUE
op_star
r_sizeof
(paren
id|ORC_SCB
)paren
comma
id|pHCB-&gt;HCS_virScbArray
comma
id|pHCB-&gt;HCS_physScbArray
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|shost-&gt;io_port
comma
l_int|256
)paren
suffix:semicolon
id|scsi_host_put
c_func
(paren
id|shost
)paren
suffix:semicolon
)brace
DECL|variable|inia100_pci_tbl
r_static
r_struct
id|pci_device_id
id|inia100_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|ORC_VENDOR_ID
comma
id|ORC_DEVICE_ID
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|inia100_pci_tbl
)paren
suffix:semicolon
DECL|variable|inia100_pci_driver
r_static
r_struct
id|pci_driver
id|inia100_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;inia100&quot;
comma
dot
id|id_table
op_assign
id|inia100_pci_tbl
comma
dot
id|probe
op_assign
id|inia100_probe_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|inia100_remove_one
)paren
comma
)brace
suffix:semicolon
DECL|function|inia100_init
r_static
r_int
id|__init
id|inia100_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|inia100_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|inia100_exit
r_static
r_void
id|__exit
id|inia100_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|inia100_pci_driver
)paren
suffix:semicolon
)brace
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Initio A100U2W SCSI driver&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Initio Corporation&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
DECL|variable|inia100_init
id|module_init
c_func
(paren
id|inia100_init
)paren
suffix:semicolon
DECL|variable|inia100_exit
id|module_exit
c_func
(paren
id|inia100_exit
)paren
suffix:semicolon
eof
