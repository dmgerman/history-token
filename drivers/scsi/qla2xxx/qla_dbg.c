multiline_comment|/*&n; *                  QLOGIC LINUX SOFTWARE&n; *&n; * QLogic ISP2x00 device driver for Linux 2.6.x&n; * Copyright (C) 2003-2004 QLogic Corporation&n; * (www.qlogic.com)&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2, or (at your option) any&n; * later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; *&n; */
macro_line|#include &quot;qla_def.h&quot;
macro_line|#include &lt;linux/delay.h&gt;
r_static
r_int
id|qla_uprintf
c_func
(paren
r_char
op_star
op_star
comma
r_char
op_star
comma
dot
dot
dot
)paren
suffix:semicolon
multiline_comment|/**&n; * qla2300_fw_dump() - Dumps binary data from the 2300 firmware.&n; * @ha: HA context&n; * @hardware_locked: Called with the hardware_lock&n; */
r_void
DECL|function|qla2300_fw_dump
id|qla2300_fw_dump
c_func
(paren
id|scsi_qla_host_t
op_star
id|ha
comma
r_int
id|hardware_locked
)paren
(brace
r_int
id|rval
suffix:semicolon
r_uint32
id|cnt
comma
id|timer
suffix:semicolon
r_uint32
id|risc_address
suffix:semicolon
r_uint16
id|mb0
comma
id|mb2
suffix:semicolon
r_uint32
id|stat
suffix:semicolon
id|device_reg_t
op_star
id|reg
suffix:semicolon
r_uint16
op_star
id|dmp_reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|qla2300_fw_dump
op_star
id|fw
suffix:semicolon
r_uint32
id|dump_size
comma
id|data_ram_cnt
suffix:semicolon
id|reg
op_assign
id|ha-&gt;iobase
suffix:semicolon
id|risc_address
op_assign
id|data_ram_cnt
op_assign
l_int|0
suffix:semicolon
id|mb0
op_assign
id|mb2
op_assign
l_int|0
suffix:semicolon
id|flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hardware_locked
)paren
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ha-&gt;hardware_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;fw_dump
op_ne
l_int|NULL
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Firmware has been previously dumped (%p) -- ignoring &quot;
l_string|&quot;request...&bslash;n&quot;
comma
id|ha-&gt;fw_dump
)paren
suffix:semicolon
r_goto
id|qla2300_fw_dump_failed
suffix:semicolon
)brace
multiline_comment|/* Allocate (large) dump buffer. */
id|dump_size
op_assign
r_sizeof
(paren
r_struct
id|qla2300_fw_dump
)paren
suffix:semicolon
id|dump_size
op_add_assign
(paren
id|ha-&gt;fw_memory_size
op_minus
l_int|0x11000
)paren
op_star
r_sizeof
(paren
r_uint16
)paren
suffix:semicolon
id|ha-&gt;fw_dump_order
op_assign
id|get_order
c_func
(paren
id|dump_size
)paren
suffix:semicolon
id|ha-&gt;fw_dump
op_assign
(paren
r_struct
id|qla2300_fw_dump
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|ha-&gt;fw_dump_order
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;fw_dump
op_eq
l_int|NULL
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Unable to allocated memory for firmware dump (%d/%d).&bslash;n&quot;
comma
id|ha-&gt;fw_dump_order
comma
id|dump_size
)paren
suffix:semicolon
r_goto
id|qla2300_fw_dump_failed
suffix:semicolon
)brace
id|fw
op_assign
id|ha-&gt;fw_dump
suffix:semicolon
id|rval
op_assign
id|QLA_SUCCESS
suffix:semicolon
id|fw-&gt;hccr
op_assign
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
)paren
suffix:semicolon
multiline_comment|/* Pause RISC. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_PAUSE_RISC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_QLA2300
c_func
(paren
id|ha
)paren
)paren
(brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|30000
suffix:semicolon
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
)paren
op_amp
id|HCCR_RISC_PAUSE
)paren
op_eq
l_int|0
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|cnt
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
id|rval
op_assign
id|QLA_FUNCTION_TIMEOUT
suffix:semicolon
)brace
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
id|reg
op_plus
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;pbiu_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;pbiu_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_host_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_host_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x40
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;mailbox_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;mailbox_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x40
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;resp_dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;resp_dma_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x50
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;dma_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x00
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0xA0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_hdw_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2000
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp0_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2200
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp1_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2400
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp2_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp2_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2600
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp3_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp3_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2800
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp4_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp4_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2A00
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp5_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp5_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2C00
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp6_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp6_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2E00
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp7_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp7_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x10
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;frame_buf_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;frame_buf_hdw_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x20
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;fpm_b0_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x30
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;fpm_b1_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
multiline_comment|/* Reset RISC. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
id|CSR_ISP_SOFT_RESET
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
l_int|30000
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
)paren
op_amp
id|CSR_ISP_SOFT_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|IS_QLA2300
c_func
(paren
id|ha
)paren
)paren
(brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|30000
suffix:semicolon
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
op_ne
l_int|0
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|cnt
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
id|rval
op_assign
id|QLA_FUNCTION_TIMEOUT
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
multiline_comment|/* Get RISC SRAM. */
id|risc_address
op_assign
l_int|0x800
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
comma
id|MBC_READ_RAM_WORD
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_ram
)paren
op_div
l_int|2
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_increment
comma
id|risc_address
op_increment
)paren
(brace
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|1
comma
(paren
r_uint16
)paren
id|risc_address
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_SET_HOST_INT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|6000000
suffix:semicolon
id|timer
suffix:semicolon
id|timer
op_decrement
)paren
(brace
multiline_comment|/* Check for pending interrupts. */
id|stat
op_assign
id|RD_REG_DWORD
c_func
(paren
op_amp
id|reg-&gt;u.isp2300.host_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HSR_RISC_INT
)paren
(brace
id|stat
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x1
op_logical_or
id|stat
op_eq
l_int|0x2
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Release mailbox registers. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;semaphore
comma
l_int|0
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x10
op_logical_or
id|stat
op_eq
l_int|0x11
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* clear this intr; it wasn&squot;t a mailbox intr */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
)paren
(brace
id|rval
op_assign
id|mb0
op_amp
id|MBS_MASK
suffix:semicolon
id|fw-&gt;risc_ram
(braket
id|cnt
)braket
op_assign
id|mb2
suffix:semicolon
)brace
r_else
(brace
id|rval
op_assign
id|QLA_FUNCTION_FAILED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
multiline_comment|/* Get stack SRAM. */
id|risc_address
op_assign
l_int|0x10000
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
comma
id|MBC_READ_RAM_EXTENDED
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;stack_ram
)paren
op_div
l_int|2
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_increment
comma
id|risc_address
op_increment
)paren
(brace
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|1
comma
id|LSW
c_func
(paren
id|risc_address
)paren
)paren
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|8
comma
id|MSW
c_func
(paren
id|risc_address
)paren
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_SET_HOST_INT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|6000000
suffix:semicolon
id|timer
suffix:semicolon
id|timer
op_decrement
)paren
(brace
multiline_comment|/* Check for pending interrupts. */
id|stat
op_assign
id|RD_REG_DWORD
c_func
(paren
op_amp
id|reg-&gt;u.isp2300.host_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HSR_RISC_INT
)paren
(brace
id|stat
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x1
op_logical_or
id|stat
op_eq
l_int|0x2
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Release mailbox registers. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;semaphore
comma
l_int|0
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x10
op_logical_or
id|stat
op_eq
l_int|0x11
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* clear this intr; it wasn&squot;t a mailbox intr */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
)paren
(brace
id|rval
op_assign
id|mb0
op_amp
id|MBS_MASK
suffix:semicolon
id|fw-&gt;stack_ram
(braket
id|cnt
)braket
op_assign
id|mb2
suffix:semicolon
)brace
r_else
(brace
id|rval
op_assign
id|QLA_FUNCTION_FAILED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
multiline_comment|/* Get data SRAM. */
id|risc_address
op_assign
l_int|0x11000
suffix:semicolon
id|data_ram_cnt
op_assign
id|ha-&gt;fw_memory_size
op_minus
id|risc_address
op_plus
l_int|1
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
comma
id|MBC_READ_RAM_EXTENDED
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|data_ram_cnt
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_increment
comma
id|risc_address
op_increment
)paren
(brace
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|1
comma
id|LSW
c_func
(paren
id|risc_address
)paren
)paren
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|8
comma
id|MSW
c_func
(paren
id|risc_address
)paren
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_SET_HOST_INT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|6000000
suffix:semicolon
id|timer
suffix:semicolon
id|timer
op_decrement
)paren
(brace
multiline_comment|/* Check for pending interrupts. */
id|stat
op_assign
id|RD_REG_DWORD
c_func
(paren
op_amp
id|reg-&gt;u.isp2300.host_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|HSR_RISC_INT
)paren
(brace
id|stat
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x1
op_logical_or
id|stat
op_eq
l_int|0x2
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Release mailbox registers. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;semaphore
comma
l_int|0
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_eq
l_int|0x10
op_logical_or
id|stat
op_eq
l_int|0x11
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* clear this intr; it wasn&squot;t a mailbox intr */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
)paren
(brace
id|rval
op_assign
id|mb0
op_amp
id|MBS_MASK
suffix:semicolon
id|fw-&gt;data_ram
(braket
id|cnt
)braket
op_assign
id|mb2
suffix:semicolon
)brace
r_else
(brace
id|rval
op_assign
id|QLA_FUNCTION_FAILED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_ne
id|QLA_SUCCESS
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Failed to dump firmware (%x)!!!&bslash;n&quot;
comma
id|rval
)paren
suffix:semicolon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|ha-&gt;fw_dump
comma
id|ha-&gt;fw_dump_order
)paren
suffix:semicolon
id|ha-&gt;fw_dump
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|qla_printk
c_func
(paren
id|KERN_INFO
comma
id|ha
comma
l_string|&quot;Firmware dump saved to temp buffer (%ld/%p).&bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|ha-&gt;fw_dump
)paren
suffix:semicolon
)brace
id|qla2300_fw_dump_failed
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hardware_locked
)paren
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ha-&gt;hardware_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * qla2300_ascii_fw_dump() - Converts a binary firmware dump to ASCII.&n; * @ha: HA context&n; */
r_void
DECL|function|qla2300_ascii_fw_dump
id|qla2300_ascii_fw_dump
c_func
(paren
id|scsi_qla_host_t
op_star
id|ha
)paren
(brace
r_uint32
id|cnt
suffix:semicolon
r_char
op_star
id|uiter
suffix:semicolon
r_char
id|fw_info
(braket
l_int|30
)braket
suffix:semicolon
r_struct
id|qla2300_fw_dump
op_star
id|fw
suffix:semicolon
r_uint32
id|data_ram_cnt
suffix:semicolon
id|uiter
op_assign
id|ha-&gt;fw_dump_buffer
suffix:semicolon
id|fw
op_assign
id|ha-&gt;fw_dump
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%s Firmware Version %s&bslash;n&quot;
comma
id|ha-&gt;model_number
comma
id|qla2x00_get_fw_version_str
c_func
(paren
id|ha
comma
id|fw_info
)paren
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n[==&gt;BEG]&bslash;n&quot;
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;HCCR Register:&bslash;n%04x&bslash;n&bslash;n&quot;
comma
id|fw-&gt;hccr
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;PBIU Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;pbiu_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;pbiu_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nReqQ-RspQ-Risc2Host Status registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_host_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_host_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nMailbox Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;mailbox_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;mailbox_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nAuto Request Response DMA Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;resp_dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;resp_dma_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nDMA Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;dma_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC Hardware Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_hdw_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP0 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp0_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP1 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp1_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP2 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp2_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp2_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP3 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp3_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp3_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP4 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp4_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp4_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP5 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp5_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp5_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP6 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp6_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp6_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP7 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp7_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp7_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFrame Buffer Hardware Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;frame_buf_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;frame_buf_hdw_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFPM B0 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;fpm_b0_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFPM B1 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;fpm_b1_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nCode RAM Dump:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_ram
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n%04x: &quot;
comma
id|cnt
op_plus
l_int|0x0800
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_ram
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nStack RAM Dump:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;stack_ram
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n%05x: &quot;
comma
id|cnt
op_plus
l_int|0x10000
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;stack_ram
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nData RAM Dump:&quot;
)paren
suffix:semicolon
id|data_ram_cnt
op_assign
id|ha-&gt;fw_memory_size
op_minus
l_int|0x11000
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|data_ram_cnt
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n%05x: &quot;
comma
id|cnt
op_plus
l_int|0x11000
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;data_ram
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;n[&lt;==END] ISP Debug Dump.&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * qla2100_fw_dump() - Dumps binary data from the 2100/2200 firmware.&n; * @ha: HA context&n; * @hardware_locked: Called with the hardware_lock&n; */
r_void
DECL|function|qla2100_fw_dump
id|qla2100_fw_dump
c_func
(paren
id|scsi_qla_host_t
op_star
id|ha
comma
r_int
id|hardware_locked
)paren
(brace
r_int
id|rval
suffix:semicolon
r_uint32
id|cnt
comma
id|timer
suffix:semicolon
r_uint16
id|risc_address
suffix:semicolon
r_uint16
id|mb0
comma
id|mb2
suffix:semicolon
id|device_reg_t
op_star
id|reg
suffix:semicolon
r_uint16
op_star
id|dmp_reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|qla2100_fw_dump
op_star
id|fw
suffix:semicolon
id|reg
op_assign
id|ha-&gt;iobase
suffix:semicolon
id|risc_address
op_assign
l_int|0
suffix:semicolon
id|mb0
op_assign
id|mb2
op_assign
l_int|0
suffix:semicolon
id|flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hardware_locked
)paren
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ha-&gt;hardware_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;fw_dump
op_ne
l_int|NULL
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Firmware has been previously dumped (%p) -- ignoring &quot;
l_string|&quot;request...&bslash;n&quot;
comma
id|ha-&gt;fw_dump
)paren
suffix:semicolon
r_goto
id|qla2100_fw_dump_failed
suffix:semicolon
)brace
multiline_comment|/* Allocate (large) dump buffer. */
id|ha-&gt;fw_dump_order
op_assign
id|get_order
c_func
(paren
r_sizeof
(paren
r_struct
id|qla2100_fw_dump
)paren
)paren
suffix:semicolon
id|ha-&gt;fw_dump
op_assign
(paren
r_struct
id|qla2100_fw_dump
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|ha-&gt;fw_dump_order
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ha-&gt;fw_dump
op_eq
l_int|NULL
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Unable to allocated memory for firmware dump (%d/%Zd).&bslash;n&quot;
comma
id|ha-&gt;fw_dump_order
comma
r_sizeof
(paren
r_struct
id|qla2100_fw_dump
)paren
)paren
suffix:semicolon
r_goto
id|qla2100_fw_dump_failed
suffix:semicolon
)brace
id|fw
op_assign
id|ha-&gt;fw_dump
suffix:semicolon
id|rval
op_assign
id|QLA_SUCCESS
suffix:semicolon
id|fw-&gt;hccr
op_assign
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
)paren
suffix:semicolon
multiline_comment|/* Pause RISC. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_PAUSE_RISC
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|30000
suffix:semicolon
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
)paren
op_amp
id|HCCR_RISC_PAUSE
)paren
op_eq
l_int|0
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|cnt
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
id|rval
op_assign
id|QLA_FUNCTION_TIMEOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
id|reg
op_plus
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;pbiu_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;pbiu_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|ha-&gt;mbx_count
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_eq
l_int|8
)paren
(brace
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0xe0
)paren
suffix:semicolon
)brace
id|fw-&gt;mailbox_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
)brace
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x20
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;dma_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x00
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0xA0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_hdw_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2000
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp0_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2100
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp1_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2200
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp2_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp2_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2300
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp3_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp3_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2400
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp4_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp4_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2500
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp5_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp5_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2600
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp6_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp6_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;pcr
comma
l_int|0x2700
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp7_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;risc_gp7_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x10
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;frame_buf_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;frame_buf_hdw_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x20
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;fpm_b0_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
l_int|0x30
)paren
suffix:semicolon
id|dmp_reg
op_assign
(paren
r_uint16
op_star
)paren
(paren
(paren
r_uint8
op_star
)paren
id|reg
op_plus
l_int|0x80
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
id|fw-&gt;fpm_b1_reg
(braket
id|cnt
)braket
op_assign
id|RD_REG_WORD
c_func
(paren
id|dmp_reg
op_increment
)paren
suffix:semicolon
multiline_comment|/* Reset the ISP. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;ctrl_status
comma
id|CSR_ISP_SOFT_RESET
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|30000
suffix:semicolon
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
op_ne
l_int|0
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|cnt
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
id|rval
op_assign
id|QLA_FUNCTION_TIMEOUT
suffix:semicolon
)brace
multiline_comment|/* Pause RISC. */
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
op_logical_and
(paren
id|IS_QLA2200
c_func
(paren
id|ha
)paren
op_logical_or
(paren
id|IS_QLA2100
c_func
(paren
id|ha
)paren
op_logical_and
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;mctr
)paren
op_amp
(paren
id|BIT_1
op_or
id|BIT_0
)paren
)paren
op_ne
l_int|0
)paren
)paren
)paren
(brace
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_PAUSE_RISC
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|30000
suffix:semicolon
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
)paren
op_amp
id|HCCR_RISC_PAUSE
)paren
op_eq
l_int|0
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|cnt
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
id|rval
op_assign
id|QLA_FUNCTION_TIMEOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
multiline_comment|/* Set memory configuration and timing. */
r_if
c_cond
(paren
id|IS_QLA2100
c_func
(paren
id|ha
)paren
)paren
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;mctr
comma
l_int|0xf1
)paren
suffix:semicolon
r_else
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;mctr
comma
l_int|0xf2
)paren
suffix:semicolon
multiline_comment|/* Release RISC. */
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_RELEASE_RISC
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_eq
id|QLA_SUCCESS
)paren
(brace
multiline_comment|/* Get RISC SRAM. */
id|risc_address
op_assign
l_int|0x1000
suffix:semicolon
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
comma
id|MBC_READ_RAM_WORD
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_ram
)paren
op_div
l_int|2
op_logical_and
id|rval
op_eq
id|QLA_SUCCESS
suffix:semicolon
id|cnt
op_increment
comma
id|risc_address
op_increment
)paren
(brace
id|WRT_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|1
comma
id|risc_address
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_SET_HOST_INT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|6000000
suffix:semicolon
id|timer
op_ne
l_int|0
suffix:semicolon
id|timer
op_decrement
)paren
(brace
multiline_comment|/* Check for pending interrupts. */
r_if
c_cond
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;istatus
)paren
op_amp
id|ISR_RISC_INT
)paren
(brace
r_if
c_cond
(paren
id|RD_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;semaphore
)paren
op_amp
id|BIT_0
)paren
(brace
id|set_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
suffix:semicolon
id|mb0
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
suffix:semicolon
id|mb2
op_assign
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;semaphore
comma
l_int|0
)paren
suffix:semicolon
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|WRT_REG_WORD
c_func
(paren
op_amp
id|reg-&gt;hccr
comma
id|HCCR_CLR_RISC_INT
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|MBX_INTERRUPT
comma
op_amp
id|ha-&gt;mbx_cmd_flags
)paren
)paren
(brace
id|rval
op_assign
id|mb0
op_amp
id|MBS_MASK
suffix:semicolon
id|fw-&gt;risc_ram
(braket
id|cnt
)braket
op_assign
id|mb2
suffix:semicolon
)brace
r_else
(brace
id|rval
op_assign
id|QLA_FUNCTION_FAILED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rval
op_ne
id|QLA_SUCCESS
)paren
(brace
id|qla_printk
c_func
(paren
id|KERN_WARNING
comma
id|ha
comma
l_string|&quot;Failed to dump firmware (%x)!!!&bslash;n&quot;
comma
id|rval
)paren
suffix:semicolon
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|ha-&gt;fw_dump
comma
id|ha-&gt;fw_dump_order
)paren
suffix:semicolon
id|ha-&gt;fw_dump
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|qla_printk
c_func
(paren
id|KERN_INFO
comma
id|ha
comma
l_string|&quot;Firmware dump saved to temp buffer (%ld/%p).&bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|ha-&gt;fw_dump
)paren
suffix:semicolon
)brace
id|qla2100_fw_dump_failed
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hardware_locked
)paren
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ha-&gt;hardware_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * qla2100_ascii_fw_dump() - Converts a binary firmware dump to ASCII.&n; * @ha: HA context&n; */
r_void
DECL|function|qla2100_ascii_fw_dump
id|qla2100_ascii_fw_dump
c_func
(paren
id|scsi_qla_host_t
op_star
id|ha
)paren
(brace
r_uint32
id|cnt
suffix:semicolon
r_char
op_star
id|uiter
suffix:semicolon
r_char
id|fw_info
(braket
l_int|30
)braket
suffix:semicolon
r_struct
id|qla2100_fw_dump
op_star
id|fw
suffix:semicolon
id|uiter
op_assign
id|ha-&gt;fw_dump_buffer
suffix:semicolon
id|fw
op_assign
id|ha-&gt;fw_dump
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%s Firmware Version %s&bslash;n&quot;
comma
id|ha-&gt;model_number
comma
id|qla2x00_get_fw_version_str
c_func
(paren
id|ha
comma
id|fw_info
)paren
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n[==&gt;BEG]&bslash;n&quot;
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;HCCR Register:&bslash;n%04x&bslash;n&bslash;n&quot;
comma
id|fw-&gt;hccr
)paren
suffix:semicolon
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;PBIU Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;pbiu_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;pbiu_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nMailbox Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;mailbox_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;mailbox_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nDMA Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;dma_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;dma_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC Hardware Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_hdw_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP0 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp0_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP1 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp1_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP2 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp2_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp2_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP3 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp3_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp3_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP4 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp4_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp4_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP5 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp5_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp5_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP6 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp6_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp6_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC GP7 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_gp7_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_gp7_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFrame Buffer Hardware Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;frame_buf_hdw_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;frame_buf_hdw_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFPM B0 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b0_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;fpm_b0_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nFPM B1 Registers:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;fpm_b1_reg
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;fpm_b1_reg
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;nRISC SRAM:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
r_sizeof
(paren
id|fw-&gt;risc_ram
)paren
op_div
l_int|2
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n%04x: &quot;
comma
id|cnt
op_plus
l_int|0x1000
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;%04x &quot;
comma
id|fw-&gt;risc_ram
(braket
id|cnt
)braket
)paren
suffix:semicolon
)brace
id|qla_uprintf
c_func
(paren
op_amp
id|uiter
comma
l_string|&quot;&bslash;n&bslash;n[&lt;==END] ISP Debug Dump.&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|qla_uprintf
id|qla_uprintf
c_func
(paren
r_char
op_star
op_star
id|uiter
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_int
id|iter
comma
id|len
suffix:semicolon
r_char
id|buf
(braket
l_int|128
)braket
suffix:semicolon
id|va_list
id|args
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|len
op_assign
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_for
c_loop
(paren
id|iter
op_assign
l_int|0
suffix:semicolon
id|iter
OL
id|len
suffix:semicolon
id|iter
op_increment
comma
op_star
id|uiter
op_add_assign
l_int|1
)paren
op_star
id|uiter
(braket
l_int|0
)braket
op_assign
id|buf
(braket
id|iter
)braket
suffix:semicolon
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
singleline_comment|//FIXME
multiline_comment|/****************************************************************************/
multiline_comment|/*                         Driver Debug Functions.                          */
multiline_comment|/****************************************************************************/
r_void
DECL|function|qla2x00_dump_regs
id|qla2x00_dump_regs
c_func
(paren
id|scsi_qla_host_t
op_star
id|ha
)paren
(brace
id|device_reg_t
op_star
id|reg
suffix:semicolon
id|reg
op_assign
id|ha-&gt;iobase
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Mailbox registers:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 0 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|0
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 1 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|1
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 2 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|2
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 3 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|3
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 4 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|4
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scsi(%ld): mbox 5 0x%04x &bslash;n&quot;
comma
id|ha-&gt;host_no
comma
id|RD_MAILBOX_REG
c_func
(paren
id|ha
comma
id|reg
comma
l_int|5
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|qla2x00_dump_buffer
id|qla2x00_dump_buffer
c_func
(paren
r_uint8
op_star
id|b
comma
r_uint32
id|size
)paren
(brace
r_uint32
id|cnt
suffix:semicolon
r_uint8
id|c
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; 0   1   2   3   4   5   6   7   8   9  &quot;
l_string|&quot;Ah  Bh  Ch  Dh  Eh  Fh&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;----------------------------------------&quot;
l_string|&quot;----------------------&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|size
suffix:semicolon
)paren
(brace
id|c
op_assign
op_star
id|b
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
(paren
r_uint32
)paren
id|c
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cnt
op_mod
l_int|16
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|16
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**************************************************************************&n; *   qla2x00_print_scsi_cmd&n; *&t; Dumps out info about the scsi cmd and srb.&n; *   Input&t; &n; *&t; cmd : struct scsi_cmnd&n; **************************************************************************/
r_void
DECL|function|qla2x00_print_scsi_cmd
id|qla2x00_print_scsi_cmd
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|cmd
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|scsi_qla_host
op_star
id|ha
suffix:semicolon
id|srb_t
op_star
id|sp
suffix:semicolon
id|ha
op_assign
(paren
r_struct
id|scsi_qla_host
op_star
)paren
id|cmd-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
id|sp
op_assign
(paren
id|srb_t
op_star
)paren
id|cmd-&gt;SCp.ptr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SCSI Command @=0x%p, Handle=0x%p&bslash;n&quot;
comma
id|cmd
comma
id|cmd-&gt;host_scribble
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  chan=0x%02x, target=0x%02x, lun=0x%02x, cmd_len=0x%02x&bslash;n&quot;
comma
id|cmd-&gt;device-&gt;channel
comma
id|cmd-&gt;device-&gt;id
comma
id|cmd-&gt;device-&gt;lun
comma
id|cmd-&gt;cmd_len
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; CDB: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cmd-&gt;cmd_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;0x%02x &quot;
comma
id|cmd-&gt;cmnd
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n  seg_cnt=%d, allowed=%d, retries=%d, &quot;
l_string|&quot;serial_number_at_timeout=0x%lx&bslash;n&quot;
comma
id|cmd-&gt;use_sg
comma
id|cmd-&gt;allowed
comma
id|cmd-&gt;retries
comma
id|cmd-&gt;serial_number_at_timeout
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  request buffer=0x%p, request buffer len=0x%x&bslash;n&quot;
comma
id|cmd-&gt;request_buffer
comma
id|cmd-&gt;request_bufflen
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  tag=%d, transfersize=0x%x&bslash;n&quot;
comma
id|cmd-&gt;tag
comma
id|cmd-&gt;transfersize
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  serial_number=%lx, SP=%p&bslash;n&quot;
comma
id|cmd-&gt;serial_number
comma
id|sp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  data direction=%d&bslash;n&quot;
comma
id|cmd-&gt;sc_data_direction
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  sp flags=0x%x&bslash;n&quot;
comma
id|sp-&gt;flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  r_start=0x%lx, u_start=0x%lx, f_start=0x%lx, state=%d&bslash;n&quot;
comma
id|sp-&gt;r_start
comma
id|sp-&gt;u_start
comma
id|sp-&gt;f_start
comma
id|sp-&gt;state
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; e_start= 0x%lx, ext_history=%d, fo retry=%d, loopid=%x, &quot;
l_string|&quot;port path=%d&bslash;n&quot;
comma
id|sp-&gt;e_start
comma
id|sp-&gt;ext_history
comma
id|sp-&gt;fo_retry_cnt
comma
id|sp-&gt;lun_queue-&gt;fclun-&gt;fcport-&gt;loop_id
comma
id|sp-&gt;lun_queue-&gt;fclun-&gt;fcport-&gt;cur_path
)paren
suffix:semicolon
)brace
macro_line|#if defined(QL_DEBUG_ROUTINES)
multiline_comment|/*&n; * qla2x00_formatted_dump_buffer&n; *       Prints string plus buffer.&n; *&n; * Input:&n; *       string  = Null terminated string (no newline at end).&n; *       buffer  = buffer address.&n; *       wd_size = word size 8, 16, 32 or 64 bits&n; *       count   = number of words.&n; */
r_void
DECL|function|qla2x00_formatted_dump_buffer
id|qla2x00_formatted_dump_buffer
c_func
(paren
r_char
op_star
id|string
comma
r_uint8
op_star
id|buffer
comma
r_uint8
id|wd_size
comma
r_uint32
id|count
)paren
(brace
r_uint32
id|cnt
suffix:semicolon
r_uint16
op_star
id|buf16
suffix:semicolon
r_uint32
op_star
id|buf32
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|string
comma
l_string|&quot;&quot;
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|string
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|wd_size
)paren
(brace
r_case
l_int|8
suffix:colon
id|printk
c_func
(paren
l_string|&quot; 0    1    2    3    4    5    6    7    &quot;
l_string|&quot;8    9    Ah   Bh   Ch   Dh   Eh   Fh&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;-----------------------------------------&quot;
l_string|&quot;-------------------------------------&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|1
suffix:semicolon
id|cnt
op_le
id|count
suffix:semicolon
id|cnt
op_increment
comma
id|buffer
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
op_star
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_mod
l_int|16
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|16
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|printk
c_func
(paren
l_string|&quot;   0      2      4      6      8      Ah &quot;
l_string|&quot;&t;Ch     Eh&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;-----------------------------------------&quot;
l_string|&quot;-------------&bslash;n&quot;
)paren
suffix:semicolon
id|buf16
op_assign
(paren
r_uint16
op_star
)paren
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|1
suffix:semicolon
id|cnt
op_le
id|count
suffix:semicolon
id|cnt
op_increment
comma
id|buf16
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%4x&quot;
comma
op_star
id|buf16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_star
id|buf16
OL
l_int|10
)paren
id|printk
c_func
(paren
l_string|&quot;   &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|8
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|printk
c_func
(paren
l_string|&quot;       0          4          8          Ch&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;------------------------------------------&bslash;n&quot;
)paren
suffix:semicolon
id|buf32
op_assign
(paren
r_uint32
op_star
)paren
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|1
suffix:semicolon
id|cnt
op_le
id|count
suffix:semicolon
id|cnt
op_increment
comma
id|buf32
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%8x&quot;
comma
op_star
id|buf32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_mod
l_int|4
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_star
id|buf32
OL
l_int|10
)paren
id|printk
c_func
(paren
l_string|&quot;   &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
op_mod
l_int|4
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
eof
