multiline_comment|/*&n;    dmx3191d.c - driver for the Domex DMX3191D SCSI card.&n;    Copyright (C) 2000 by Massimo Piccioni &lt;dafastidio@libero.it&gt;&n;    Portions Copyright (C) 2004 by Christoph Hellwig &lt;hch@lst.de&gt;&n;&n;    Based on the generic NCR5380 driver by Drew Eckhardt et al.&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
multiline_comment|/*&n; * Defintions for the generic 5380 driver.&n; */
DECL|macro|AUTOSENSE
mdefine_line|#define AUTOSENSE
DECL|macro|NCR5380_read
mdefine_line|#define NCR5380_read(reg)&t;&t;inb(port + reg)
DECL|macro|NCR5380_write
mdefine_line|#define NCR5380_write(reg, value)&t;outb(value, port + reg)
DECL|macro|NCR5380_implementation_fields
mdefine_line|#define NCR5380_implementation_fields&t;unsigned int port
DECL|macro|NCR5380_local_declare
mdefine_line|#define NCR5380_local_declare()&t;&t;NCR5380_implementation_fields
DECL|macro|NCR5380_setup
mdefine_line|#define NCR5380_setup(instance)&t;&t;port = instance-&gt;io_port
multiline_comment|/*&n; * Includes needed for NCR5380.[ch] (XXX: Move them to NCR5380.h)&n; */
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;NCR5380.h&quot;
macro_line|#include &quot;NCR5380.c&quot;
DECL|macro|DMX3191D_DRIVER_NAME
mdefine_line|#define DMX3191D_DRIVER_NAME&t;&quot;dmx3191d&quot;
DECL|macro|DMX3191D_REGION_LEN
mdefine_line|#define DMX3191D_REGION_LEN&t;8
DECL|variable|dmx3191d_driver_template
r_static
r_struct
id|scsi_host_template
id|dmx3191d_driver_template
op_assign
(brace
dot
id|proc_name
op_assign
id|DMX3191D_DRIVER_NAME
comma
dot
id|name
op_assign
l_string|&quot;Domex DMX3191D&quot;
comma
dot
id|queuecommand
op_assign
id|NCR5380_queue_command
comma
dot
id|eh_abort_handler
op_assign
id|NCR5380_abort
comma
dot
id|eh_bus_reset_handler
op_assign
id|NCR5380_bus_reset
comma
dot
id|eh_device_reset_handler
op_assign
id|NCR5380_device_reset
comma
dot
id|eh_host_reset_handler
op_assign
id|NCR5380_host_reset
comma
dot
id|can_queue
op_assign
l_int|32
comma
dot
id|this_id
op_assign
l_int|7
comma
dot
id|sg_tablesize
op_assign
id|SG_ALL
comma
dot
id|cmd_per_lun
op_assign
l_int|2
comma
dot
id|use_clustering
op_assign
id|DISABLE_CLUSTERING
comma
)brace
suffix:semicolon
DECL|function|dmx3191d_probe_one
r_static
r_int
id|__devinit
id|dmx3191d_probe_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
suffix:semicolon
r_int
r_int
id|io
suffix:semicolon
r_int
id|error
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_goto
id|out
suffix:semicolon
id|io
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|io
comma
id|DMX3191D_REGION_LEN
comma
id|DMX3191D_DRIVER_NAME
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dmx3191: region 0x%lx-0x%lx already reserved&bslash;n&quot;
comma
id|io
comma
id|io
op_plus
id|DMX3191D_REGION_LEN
)paren
suffix:semicolon
r_goto
id|out_disable_device
suffix:semicolon
)brace
id|shost
op_assign
id|scsi_host_alloc
c_func
(paren
op_amp
id|dmx3191d_driver_template
comma
r_sizeof
(paren
r_struct
id|NCR5380_hostdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|shost
)paren
r_goto
id|out_release_region
suffix:semicolon
id|shost-&gt;io_port
op_assign
id|io
suffix:semicolon
id|shost-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|NCR5380_init
c_func
(paren
id|shost
comma
id|FLAG_NO_PSEUDO_DMA
op_or
id|FLAG_DTC3181E
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pdev-&gt;irq
comma
id|NCR5380_intr
comma
id|SA_SHIRQ
comma
id|DMX3191D_DRIVER_NAME
comma
id|shost
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Steam powered scsi controllers run without an IRQ anyway&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dmx3191: IRQ %d not available - &quot;
l_string|&quot;switching to polled mode.&bslash;n&quot;
comma
id|pdev-&gt;irq
)paren
suffix:semicolon
id|shost-&gt;irq
op_assign
id|SCSI_IRQ_NONE
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|shost
)paren
suffix:semicolon
id|error
op_assign
id|scsi_add_host
c_func
(paren
id|shost
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out_free_irq
suffix:semicolon
id|scsi_scan_host
c_func
(paren
id|shost
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|shost-&gt;irq
comma
id|shost
)paren
suffix:semicolon
id|out_release_region
suffix:colon
id|release_region
c_func
(paren
id|shost-&gt;io_port
comma
id|DMX3191D_REGION_LEN
)paren
suffix:semicolon
id|out_disable_device
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
DECL|function|dmx3191d_remove_one
r_static
r_void
id|__devexit
id|dmx3191d_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|scsi_remove_host
c_func
(paren
id|shost
)paren
suffix:semicolon
id|NCR5380_exit
c_func
(paren
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shost-&gt;irq
op_ne
id|SCSI_IRQ_NONE
)paren
id|free_irq
c_func
(paren
id|shost-&gt;irq
comma
id|shost
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|shost-&gt;io_port
comma
id|DMX3191D_REGION_LEN
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|scsi_host_put
c_func
(paren
id|shost
)paren
suffix:semicolon
)brace
DECL|variable|dmx3191d_pci_tbl
r_static
r_struct
id|pci_device_id
id|dmx3191d_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_DOMEX
comma
id|PCI_DEVICE_ID_DOMEX_DMX3191D
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|4
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|dmx3191d_pci_tbl
)paren
suffix:semicolon
DECL|variable|dmx3191d_pci_driver
r_static
r_struct
id|pci_driver
id|dmx3191d_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|DMX3191D_DRIVER_NAME
comma
dot
id|id_table
op_assign
id|dmx3191d_pci_tbl
comma
dot
id|probe
op_assign
id|dmx3191d_probe_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|dmx3191d_remove_one
)paren
comma
)brace
suffix:semicolon
DECL|function|dmx3191d_init
r_static
r_int
id|__init
id|dmx3191d_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|dmx3191d_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|dmx3191d_exit
r_static
r_void
id|__exit
id|dmx3191d_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|dmx3191d_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|dmx3191d_init
id|module_init
c_func
(paren
id|dmx3191d_init
)paren
suffix:semicolon
DECL|variable|dmx3191d_exit
id|module_exit
c_func
(paren
id|dmx3191d_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Massimo Piccioni &lt;dafastidio@libero.it&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Domex DMX3191D SCSI driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
