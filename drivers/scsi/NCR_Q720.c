multiline_comment|/* -*- mode: c; c-basic-offset: 8 -*- */
multiline_comment|/* NCR Quad 720 MCA SCSI Driver&n; *&n; * Copyright (C) 2003 by James.Bottomley@HansenPartnership.com&n; */
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/mca.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &quot;ncr53c8xx.h&quot;
macro_line|#include &quot;NCR_Q720.h&quot;
DECL|variable|__initdata
r_static
r_struct
id|ncr_chip
id|q720_chip
id|__initdata
op_assign
(brace
dot
id|revision_id
op_assign
l_int|0x0f
comma
dot
id|burst_max
op_assign
l_int|3
comma
dot
id|offset_max
op_assign
l_int|8
comma
dot
id|nr_divisor
op_assign
l_int|4
comma
dot
id|features
op_assign
id|FE_WIDE
op_or
id|FE_DIFF
op_or
id|FE_VARCLK
comma
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;James Bottomley&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;NCR Quad 720 SCSI Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|NCR_Q720_VERSION
mdefine_line|#define NCR_Q720_VERSION&t;&t;&quot;0.9&quot;
multiline_comment|/* We needs this helper because we have up to four hosts per struct device */
DECL|struct|NCR_Q720_private
r_struct
id|NCR_Q720_private
(brace
DECL|member|dev
r_struct
id|device
op_star
id|dev
suffix:semicolon
DECL|member|mem_base
r_void
id|__iomem
op_star
id|mem_base
suffix:semicolon
DECL|member|phys_mem_base
id|__u32
id|phys_mem_base
suffix:semicolon
DECL|member|mem_size
id|__u32
id|mem_size
suffix:semicolon
DECL|member|irq
id|__u8
id|irq
suffix:semicolon
DECL|member|siops
id|__u8
id|siops
suffix:semicolon
DECL|member|irq_enable
id|__u8
id|irq_enable
suffix:semicolon
DECL|member|hosts
r_struct
id|Scsi_Host
op_star
id|hosts
(braket
l_int|4
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|NCR_Q720_tpnt
r_static
r_struct
id|scsi_host_template
id|NCR_Q720_tpnt
op_assign
(brace
dot
id|module
op_assign
id|THIS_MODULE
comma
dot
id|proc_name
op_assign
l_string|&quot;NCR_Q720&quot;
comma
)brace
suffix:semicolon
r_static
id|irqreturn_t
DECL|function|NCR_Q720_intr
id|NCR_Q720_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|data
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|NCR_Q720_private
op_star
id|p
op_assign
(paren
r_struct
id|NCR_Q720_private
op_star
)paren
id|data
suffix:semicolon
id|__u8
id|sir
op_assign
(paren
id|readb
c_func
(paren
id|p-&gt;mem_base
op_plus
l_int|0x0d
)paren
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
id|__u8
id|siop
suffix:semicolon
id|sir
op_or_assign
op_complement
id|p-&gt;irq_enable
suffix:semicolon
r_if
c_cond
(paren
id|sir
op_eq
l_int|0xff
)paren
(brace
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|siop
op_assign
id|ffz
c_func
(paren
id|sir
)paren
)paren
OL
id|p-&gt;siops
)paren
(brace
id|sir
op_or_assign
l_int|1
op_lshift
id|siop
suffix:semicolon
id|ncr53c8xx_intr
c_func
(paren
id|irq
comma
id|p-&gt;hosts
(braket
id|siop
)braket
comma
id|regs
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|NCR_Q720_probe_one
id|NCR_Q720_probe_one
c_func
(paren
r_struct
id|NCR_Q720_private
op_star
id|p
comma
r_int
id|siop
comma
r_int
id|irq
comma
r_int
id|slot
comma
id|__u32
id|paddr
comma
r_void
id|__iomem
op_star
id|vaddr
)paren
(brace
r_struct
id|ncr_device
id|device
suffix:semicolon
id|__u8
id|scsi_id
suffix:semicolon
r_static
r_int
id|unit
op_assign
l_int|0
suffix:semicolon
id|__u8
id|scsr1
op_assign
id|readb
c_func
(paren
id|vaddr
op_plus
id|NCR_Q720_SCSR_OFFSET
op_plus
l_int|1
)paren
suffix:semicolon
id|__u8
id|differential
op_assign
id|readb
c_func
(paren
id|vaddr
op_plus
id|NCR_Q720_SCSR_OFFSET
)paren
op_amp
l_int|0x20
suffix:semicolon
id|__u8
id|version
suffix:semicolon
r_int
id|error
suffix:semicolon
id|scsi_id
op_assign
id|scsr1
op_rshift
l_int|4
suffix:semicolon
multiline_comment|/* enable burst length 16 (FIXME: should allow this) */
id|scsr1
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* force a siop reset */
id|scsr1
op_or_assign
l_int|0x04
suffix:semicolon
id|writeb
c_func
(paren
id|scsr1
comma
id|vaddr
op_plus
id|NCR_Q720_SCSR_OFFSET
op_plus
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|version
op_assign
id|readb
c_func
(paren
id|vaddr
op_plus
l_int|0x18
)paren
op_rshift
l_int|4
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|device
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ncr_device
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialise ncr_device structure with items required by ncr_attach. */
id|device.chip
op_assign
id|q720_chip
suffix:semicolon
id|device.chip.revision_id
op_assign
id|version
suffix:semicolon
id|device.host_id
op_assign
id|scsi_id
suffix:semicolon
id|device.dev
op_assign
id|p-&gt;dev
suffix:semicolon
id|device.slot.base
op_assign
id|paddr
suffix:semicolon
id|device.slot.base_c
op_assign
id|paddr
suffix:semicolon
id|device.slot.base_v
op_assign
id|vaddr
suffix:semicolon
id|device.slot.irq
op_assign
id|irq
suffix:semicolon
id|device.differential
op_assign
id|differential
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Q720 probe unit %d (siop%d) at 0x%lx, diff = %d, vers = %d&bslash;n&quot;
comma
id|unit
comma
id|siop
comma
(paren
r_int
r_int
)paren
id|paddr
comma
id|differential
comma
id|version
)paren
suffix:semicolon
id|p-&gt;hosts
(braket
id|siop
)braket
op_assign
id|ncr_attach
c_func
(paren
op_amp
id|NCR_Q720_tpnt
comma
id|unit
op_increment
comma
op_amp
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;hosts
(braket
id|siop
)braket
)paren
r_goto
id|fail
suffix:semicolon
id|p-&gt;irq_enable
op_or_assign
(paren
l_int|1
op_lshift
id|siop
)paren
suffix:semicolon
id|scsr1
op_assign
id|readb
c_func
(paren
id|vaddr
op_plus
id|NCR_Q720_SCSR_OFFSET
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* clear the disable interrupt bit */
id|scsr1
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|writeb
c_func
(paren
id|scsr1
comma
id|vaddr
op_plus
id|NCR_Q720_SCSR_OFFSET
op_plus
l_int|1
)paren
suffix:semicolon
id|error
op_assign
id|scsi_add_host
c_func
(paren
id|p-&gt;hosts
(braket
id|siop
)braket
comma
id|p-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|ncr53c8xx_release
c_func
(paren
id|p-&gt;hosts
(braket
id|siop
)braket
)paren
suffix:semicolon
r_else
id|scsi_scan_host
c_func
(paren
id|p-&gt;hosts
(braket
id|siop
)braket
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
id|fail
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Detect a Q720 card.  Note, because of the setup --- the chips are&n; * essentially connectecd to the MCA bus independently, it is easier&n; * to set them up as two separate host adapters, rather than one&n; * adapter with two channels */
r_static
r_int
id|__init
DECL|function|NCR_Q720_probe
id|NCR_Q720_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|NCR_Q720_private
op_star
id|p
suffix:semicolon
r_static
r_int
id|banner
op_assign
l_int|1
suffix:semicolon
r_struct
id|mca_device
op_star
id|mca_dev
op_assign
id|to_mca_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|slot
op_assign
id|mca_dev-&gt;slot
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_int
id|irq
comma
id|i
comma
id|siops
suffix:semicolon
id|__u8
id|pos2
comma
id|pos4
comma
id|asr2
comma
id|asr9
comma
id|asr10
suffix:semicolon
id|__u16
id|io_base
suffix:semicolon
id|__u32
id|base_addr
comma
id|mem_size
suffix:semicolon
r_void
id|__iomem
op_star
id|mem_base
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|p
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
id|pos2
op_assign
id|mca_device_read_pos
c_func
(paren
id|mca_dev
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* enable device */
id|pos2
op_or_assign
id|NCR_Q720_POS2_BOARD_ENABLE
op_or
id|NCR_Q720_POS2_INTERRUPT_ENABLE
suffix:semicolon
id|mca_device_write_pos
c_func
(paren
id|mca_dev
comma
l_int|2
comma
id|pos2
)paren
suffix:semicolon
id|io_base
op_assign
(paren
id|pos2
op_amp
id|NCR_Q720_POS2_IO_MASK
)paren
op_lshift
id|NCR_Q720_POS2_IO_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|banner
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NCR Q720: Driver Version &quot;
id|NCR_Q720_VERSION
l_string|&quot;&bslash;n&quot;
l_string|&quot;NCR Q720:  Copyright (c) 2003 by James.Bottomley@HansenPartnership.com&bslash;n&quot;
l_string|&quot;NCR Q720:&bslash;n&quot;
)paren
suffix:semicolon
id|banner
op_assign
l_int|0
suffix:semicolon
)brace
id|io_base
op_assign
id|mca_device_transform_ioport
c_func
(paren
id|mca_dev
comma
id|io_base
)paren
suffix:semicolon
multiline_comment|/* OK, this is phase one of the bootstrap, we now know the&n;&t; * I/O space base address.  All the configuration registers&n;&t; * are mapped here (including pos) */
multiline_comment|/* sanity check I/O mapping */
id|i
op_assign
id|inb
c_func
(paren
id|io_base
)paren
op_or
(paren
id|inb
c_func
(paren
id|io_base
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
id|NCR_Q720_MCA_ID
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NCR_Q720, adapter failed to I/O map registers correctly at 0x%x(0x%x)&bslash;n&quot;
comma
id|io_base
comma
id|i
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Phase II, find the ram base and memory map the board register */
id|pos4
op_assign
id|inb
c_func
(paren
id|io_base
op_plus
l_int|4
)paren
suffix:semicolon
multiline_comment|/* enable streaming data */
id|pos4
op_or_assign
l_int|0x01
suffix:semicolon
id|outb
c_func
(paren
id|pos4
comma
id|io_base
op_plus
l_int|4
)paren
suffix:semicolon
id|base_addr
op_assign
(paren
id|pos4
op_amp
l_int|0x7e
)paren
op_lshift
l_int|20
suffix:semicolon
id|base_addr
op_add_assign
(paren
id|pos4
op_amp
l_int|0x80
)paren
op_lshift
l_int|23
suffix:semicolon
id|asr10
op_assign
id|inb
c_func
(paren
id|io_base
op_plus
l_int|0x12
)paren
suffix:semicolon
id|base_addr
op_add_assign
(paren
id|asr10
op_amp
l_int|0x80
)paren
op_lshift
l_int|24
suffix:semicolon
id|base_addr
op_add_assign
(paren
id|asr10
op_amp
l_int|0x70
)paren
op_lshift
l_int|23
suffix:semicolon
multiline_comment|/* OK, got the base addr, now we need to find the ram size,&n;&t; * enable and map it */
id|asr9
op_assign
id|inb
c_func
(paren
id|io_base
op_plus
l_int|0x11
)paren
suffix:semicolon
id|i
op_assign
(paren
id|asr9
op_amp
l_int|0xc0
)paren
op_rshift
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|mem_size
op_assign
l_int|1024
suffix:semicolon
)brace
r_else
id|mem_size
op_assign
l_int|1
op_lshift
(paren
l_int|19
op_plus
id|i
)paren
suffix:semicolon
multiline_comment|/* enable the sram mapping */
id|asr9
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* disable the rom mapping */
id|asr9
op_and_assign
op_complement
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
id|asr9
comma
id|io_base
op_plus
l_int|0x11
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|base_addr
comma
id|mem_size
comma
l_string|&quot;NCR_Q720&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NCR_Q720: Failed to claim memory region 0x%lx&bslash;n-0x%lx&quot;
comma
(paren
r_int
r_int
)paren
id|base_addr
comma
(paren
r_int
r_int
)paren
(paren
id|base_addr
op_plus
id|mem_size
)paren
)paren
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_declare_coherent_memory
c_func
(paren
id|dev
comma
id|base_addr
comma
id|base_addr
comma
id|mem_size
comma
id|DMA_MEMORY_MAP
)paren
op_ne
id|DMA_MEMORY_MAP
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NCR_Q720: DMA declare memory failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_release_region
suffix:semicolon
)brace
multiline_comment|/* The first 1k of the memory buffer is a memory map of the registers&n;&t; */
id|mem_base
op_assign
(paren
id|__u32
)paren
id|dma_mark_declared_memory_occupied
c_func
(paren
id|dev
comma
id|base_addr
comma
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|mem_base
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;NCR_Q720 failed to reserve memory mapped region&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
multiline_comment|/* now also enable accesses in asr 2 */
id|asr2
op_assign
id|inb
c_func
(paren
id|io_base
op_plus
l_int|0x0a
)paren
suffix:semicolon
id|asr2
op_or_assign
l_int|0x01
suffix:semicolon
id|outb
c_func
(paren
id|asr2
comma
id|io_base
op_plus
l_int|0x0a
)paren
suffix:semicolon
multiline_comment|/* get the number of SIOPs (this should be 2 or 4) */
id|siops
op_assign
(paren
(paren
id|asr2
op_amp
l_int|0xe0
)paren
op_rshift
l_int|5
)paren
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* sanity check mapping (again) */
id|i
op_assign
id|readw
c_func
(paren
id|mem_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
id|NCR_Q720_MCA_ID
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NCR_Q720, adapter failed to memory map registers correctly at 0x%lx(0x%x)&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|base_addr
comma
id|i
)paren
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
id|irq
op_assign
id|readb
c_func
(paren
id|mem_base
op_plus
l_int|5
)paren
op_amp
l_int|0x0f
suffix:semicolon
multiline_comment|/* now do the bus related transforms */
id|irq
op_assign
id|mca_device_transform_irq
c_func
(paren
id|mca_dev
comma
id|irq
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NCR Q720: found in slot %d  irq = %d  mem base = 0x%lx siops = %d&bslash;n&quot;
comma
id|slot
comma
id|irq
comma
(paren
r_int
r_int
)paren
id|base_addr
comma
id|siops
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NCR Q720: On board ram %dk&bslash;n&quot;
comma
id|mem_size
op_div
l_int|1024
)paren
suffix:semicolon
id|p-&gt;dev
op_assign
id|dev
suffix:semicolon
id|p-&gt;mem_base
op_assign
id|mem_base
suffix:semicolon
id|p-&gt;phys_mem_base
op_assign
id|base_addr
suffix:semicolon
id|p-&gt;mem_size
op_assign
id|mem_size
suffix:semicolon
id|p-&gt;irq
op_assign
id|irq
suffix:semicolon
id|p-&gt;siops
op_assign
id|siops
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|NCR_Q720_intr
comma
id|SA_SHIRQ
comma
l_string|&quot;NCR_Q720&quot;
comma
id|p
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NCR_Q720: request irq %d failed&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
multiline_comment|/* disable all the siop interrupts */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|siops
suffix:semicolon
id|i
op_increment
)paren
(brace
r_void
id|__iomem
op_star
id|reg_scsr1
op_assign
id|mem_base
op_plus
id|NCR_Q720_CHIP_REGISTER_OFFSET
op_plus
id|i
op_star
id|NCR_Q720_SIOP_SHIFT
op_plus
id|NCR_Q720_SCSR_OFFSET
op_plus
l_int|1
suffix:semicolon
id|__u8
id|scsr1
op_assign
id|readb
c_func
(paren
id|reg_scsr1
)paren
suffix:semicolon
id|scsr1
op_or_assign
l_int|0x01
suffix:semicolon
id|writeb
c_func
(paren
id|scsr1
comma
id|reg_scsr1
)paren
suffix:semicolon
)brace
multiline_comment|/* plumb in all 720 chips */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|siops
suffix:semicolon
id|i
op_increment
)paren
(brace
r_void
id|__iomem
op_star
id|siop_v_base
op_assign
id|mem_base
op_plus
id|NCR_Q720_CHIP_REGISTER_OFFSET
op_plus
id|i
op_star
id|NCR_Q720_SIOP_SHIFT
suffix:semicolon
id|__u32
id|siop_p_base
op_assign
id|base_addr
op_plus
id|NCR_Q720_CHIP_REGISTER_OFFSET
op_plus
id|i
op_star
id|NCR_Q720_SIOP_SHIFT
suffix:semicolon
id|__u16
id|port
op_assign
id|io_base
op_plus
id|NCR_Q720_CHIP_REGISTER_OFFSET
op_plus
id|i
op_star
id|NCR_Q720_SIOP_SHIFT
suffix:semicolon
r_int
id|err
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|port
op_plus
l_int|0x40
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x07
comma
id|port
op_plus
l_int|0x41
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|NCR_Q720_probe_one
c_func
(paren
id|p
comma
id|i
comma
id|irq
comma
id|slot
comma
id|siop_p_base
comma
id|siop_v_base
)paren
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;Q720: SIOP%d: probe failed, error = %d&bslash;n&quot;
comma
id|i
comma
id|err
)paren
suffix:semicolon
r_else
id|found
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|mca_device_set_claim
c_func
(paren
id|mca_dev
comma
l_int|1
)paren
suffix:semicolon
id|mca_device_set_name
c_func
(paren
id|mca_dev
comma
l_string|&quot;NCR_Q720&quot;
)paren
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
id|dev
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_release
suffix:colon
id|dma_release_declared_memory
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out_release_region
suffix:colon
id|release_mem_region
c_func
(paren
id|base_addr
comma
id|mem_size
)paren
suffix:semicolon
id|out_free
suffix:colon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|NCR_Q720_remove_one
id|NCR_Q720_remove_one
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|host
)paren
(brace
id|scsi_remove_host
c_func
(paren
id|host
)paren
suffix:semicolon
id|ncr53c8xx_release
c_func
(paren
id|host
)paren
suffix:semicolon
)brace
r_static
r_int
id|__exit
DECL|function|NCR_Q720_remove
id|NCR_Q720_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|NCR_Q720_private
op_star
id|p
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;siops
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|p-&gt;hosts
(braket
id|i
)braket
)paren
(brace
id|NCR_Q720_remove_one
c_func
(paren
id|p-&gt;hosts
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|dma_release_declared_memory
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|p-&gt;phys_mem_base
comma
id|p-&gt;mem_size
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|p-&gt;irq
comma
id|p
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|NCR_Q720_id_table
r_static
r_int
id|NCR_Q720_id_table
(braket
)braket
op_assign
(brace
id|NCR_Q720_MCA_ID
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|NCR_Q720_driver
r_static
r_struct
id|mca_driver
id|NCR_Q720_driver
op_assign
(brace
dot
id|id_table
op_assign
id|NCR_Q720_id_table
comma
dot
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;NCR_Q720&quot;
comma
dot
id|bus
op_assign
op_amp
id|mca_bus_type
comma
dot
id|probe
op_assign
id|NCR_Q720_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|NCR_Q720_remove
)paren
comma
)brace
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|NCR_Q720_init
id|NCR_Q720_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
id|ncr53c8xx_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
id|mca_register_driver
c_func
(paren
op_amp
id|NCR_Q720_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|ncr53c8xx_exit
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|NCR_Q720_exit
id|NCR_Q720_exit
c_func
(paren
r_void
)paren
(brace
id|mca_unregister_driver
c_func
(paren
op_amp
id|NCR_Q720_driver
)paren
suffix:semicolon
id|ncr53c8xx_exit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|NCR_Q720_init
id|module_init
c_func
(paren
id|NCR_Q720_init
)paren
suffix:semicolon
DECL|variable|NCR_Q720_exit
id|module_exit
c_func
(paren
id|NCR_Q720_exit
)paren
suffix:semicolon
eof
