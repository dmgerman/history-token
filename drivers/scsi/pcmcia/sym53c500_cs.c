multiline_comment|/*&n;*  sym53c500_cs.c&t;Bob Tracy (rct@frus.com)&n;*&n;*  A rewrite of the pcmcia-cs add-on driver for newer (circa 1997)&n;*  New Media Bus Toaster PCMCIA SCSI cards using the Symbios Logic&n;*  53c500 controller: intended for use with 2.6 and later kernels.&n;*  The pcmcia-cs add-on version of this driver is not supported&n;*  beyond 2.4.  It consisted of three files with history/copyright&n;*  information as follows:&n;*&n;*  SYM53C500.h&n;*&t;Bob Tracy (rct@frus.com)&n;*&t;Original by Tom Corner (tcorner@via.at).&n;*&t;Adapted from NCR53c406a.h which is Copyrighted (C) 1994&n;*&t;Normunds Saumanis (normunds@rx.tech.swh.lv)&n;*&n;*  SYM53C500.c&n;*&t;Bob Tracy (rct@frus.com)&n;*&t;Original driver by Tom Corner (tcorner@via.at) was adapted&n;*&t;from NCR53c406a.c which is Copyrighted (C) 1994, 1995, 1996 &n;*&t;Normunds Saumanis (normunds@fi.ibm.com)&n;*&n;*  sym53c500.c&n;*&t;Bob Tracy (rct@frus.com)&n;*&t;Original by Tom Corner (tcorner@via.at) was adapted from a&n;*&t;driver for the Qlogic SCSI card written by&n;*&t;David Hinds (dhinds@allegro.stanford.edu).&n;* &n;*  This program is free software; you can redistribute it and/or modify it&n;*  under the terms of the GNU General Public License as published by the&n;*  Free Software Foundation; either version 2, or (at your option) any&n;*  later version.&n;*&n;*  This program is distributed in the hope that it will be useful, but&n;*  WITHOUT ANY WARRANTY; without even the implied warranty of&n;*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n;*  General Public License for more details.&n;*/
DECL|macro|SYM53C500_DEBUG
mdefine_line|#define SYM53C500_DEBUG 0
DECL|macro|VERBOSE_SYM53C500_DEBUG
mdefine_line|#define VERBOSE_SYM53C500_DEBUG 0
multiline_comment|/*&n;*  Set this to 0 if you encounter kernel lockups while transferring &n;*  data in PIO mode.  Note this can be changed via &quot;sysfs&quot;.&n;*/
DECL|macro|USE_FAST_PIO
mdefine_line|#define USE_FAST_PIO 1
multiline_comment|/* =============== End of user configurable parameters ============== */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;scsi/scsi_ioctl.h&gt;
macro_line|#include &lt;scsi/scsi_cmnd.h&gt;
macro_line|#include &lt;scsi/scsi_device.h&gt;
macro_line|#include &lt;scsi/scsi.h&gt;
macro_line|#include &lt;scsi/scsi_host.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/ds.h&gt;
macro_line|#include &lt;pcmcia/ciscode.h&gt;
multiline_comment|/* ================================================================== */
macro_line|#ifdef PCMCIA_DEBUG
DECL|variable|pc_debug
r_static
r_int
id|pc_debug
op_assign
id|PCMCIA_DEBUG
suffix:semicolon
id|module_param
c_func
(paren
id|pc_debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|DEBUG
mdefine_line|#define DEBUG(n, args...) if (pc_debug&gt;(n)) printk(KERN_DEBUG args)
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;sym53c500_cs.c 0.9b 2004/05/10 (Bob Tracy)&quot;
suffix:semicolon
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG(n, args...)
macro_line|#endif
multiline_comment|/* ================================================================== */
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
multiline_comment|/* Bit map of interrupts to choose from */
DECL|variable|irq_mask
r_static
r_int
r_int
id|irq_mask
op_assign
l_int|0xdeb8
suffix:semicolon
multiline_comment|/* 3, 6, 7, 9-12, 14, 15 */
DECL|variable|irq_list
r_static
r_int
id|irq_list
(braket
l_int|4
)braket
op_assign
(brace
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|num_irqs
r_static
r_int
id|num_irqs
op_assign
l_int|1
suffix:semicolon
id|module_param
c_func
(paren
id|irq_mask
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq_mask
comma
l_string|&quot;IRQ mask bits (default: 0xdeb8)&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|irq_list
comma
r_int
comma
id|num_irqs
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq_list
comma
l_string|&quot;Comma-separated list of up to 4 IRQs to try (default: auto select).&quot;
)paren
suffix:semicolon
multiline_comment|/* ================================================================== */
DECL|macro|SYNC_MODE
mdefine_line|#define SYNC_MODE 0 &t;&t;/* Synchronous transfer mode */
multiline_comment|/* Default configuration */
DECL|macro|C1_IMG
mdefine_line|#define C1_IMG   0x07&t;&t;/* ID=7 */
DECL|macro|C2_IMG
mdefine_line|#define C2_IMG   0x48&t;&t;/* FE SCSI2 */
DECL|macro|C3_IMG
mdefine_line|#define C3_IMG   0x20&t;&t;/* CDB */
DECL|macro|C4_IMG
mdefine_line|#define C4_IMG   0x04&t;&t;/* ANE */
DECL|macro|C5_IMG
mdefine_line|#define C5_IMG   0xa4&t;&t;/* ? changed from b6= AA PI SIE POL */
DECL|macro|C7_IMG
mdefine_line|#define C7_IMG   0x80&t;&t;/* added for SYM53C500 t. corner */
multiline_comment|/* Hardware Registers: offsets from io_port (base) */
multiline_comment|/* Control Register Set 0 */
DECL|macro|TC_LSB
mdefine_line|#define TC_LSB&t;&t;0x00&t;&t;/* transfer counter lsb */
DECL|macro|TC_MSB
mdefine_line|#define TC_MSB&t;&t;0x01&t;&t;/* transfer counter msb */
DECL|macro|SCSI_FIFO
mdefine_line|#define SCSI_FIFO&t;0x02&t;&t;/* scsi fifo register */
DECL|macro|CMD_REG
mdefine_line|#define CMD_REG&t;&t;0x03&t;&t;/* command register */
DECL|macro|STAT_REG
mdefine_line|#define STAT_REG&t;0x04&t;&t;/* status register */
DECL|macro|DEST_ID
mdefine_line|#define DEST_ID&t;&t;0x04&t;&t;/* selection/reselection bus id */
DECL|macro|INT_REG
mdefine_line|#define INT_REG&t;&t;0x05&t;&t;/* interrupt status register */
DECL|macro|SRTIMOUT
mdefine_line|#define SRTIMOUT&t;0x05&t;&t;/* select/reselect timeout reg */
DECL|macro|SEQ_REG
mdefine_line|#define SEQ_REG&t;&t;0x06&t;&t;/* sequence step register */
DECL|macro|SYNCPRD
mdefine_line|#define SYNCPRD&t;&t;0x06&t;&t;/* synchronous transfer period */
DECL|macro|FIFO_FLAGS
mdefine_line|#define FIFO_FLAGS&t;0x07&t;&t;/* indicates # of bytes in fifo */
DECL|macro|SYNCOFF
mdefine_line|#define SYNCOFF&t;&t;0x07&t;&t;/* synchronous offset register */
DECL|macro|CONFIG1
mdefine_line|#define CONFIG1&t;&t;0x08&t;&t;/* configuration register */
DECL|macro|CLKCONV
mdefine_line|#define CLKCONV&t;&t;0x09&t;&t;/* clock conversion register */
multiline_comment|/* #define TESTREG&t;0x0A */
multiline_comment|/* test mode register */
DECL|macro|CONFIG2
mdefine_line|#define CONFIG2&t;&t;0x0B&t;&t;/* configuration 2 register */
DECL|macro|CONFIG3
mdefine_line|#define CONFIG3&t;&t;0x0C&t;&t;/* configuration 3 register */
DECL|macro|CONFIG4
mdefine_line|#define CONFIG4&t;&t;0x0D&t;&t;/* configuration 4 register */
DECL|macro|TC_HIGH
mdefine_line|#define TC_HIGH&t;&t;0x0E&t;&t;/* transfer counter high */
multiline_comment|/* #define FIFO_BOTTOM&t;0x0F */
multiline_comment|/* reserve FIFO byte register */
multiline_comment|/* Control Register Set 1 */
multiline_comment|/* #define JUMPER_SENSE&t;0x00 */
multiline_comment|/* jumper sense port reg (r/w) */
multiline_comment|/* #define SRAM_PTR&t;0x01 */
multiline_comment|/* SRAM address pointer reg (r/w) */
multiline_comment|/* #define SRAM_DATA&t;0x02 */
multiline_comment|/* SRAM data register (r/w) */
DECL|macro|PIO_FIFO
mdefine_line|#define PIO_FIFO&t;0x04&t;&t;/* PIO FIFO registers (r/w) */
multiline_comment|/* #define PIO_FIFO1&t;0x05 */
multiline_comment|/*  */
multiline_comment|/* #define PIO_FIFO2&t;0x06 */
multiline_comment|/*  */
multiline_comment|/* #define PIO_FIFO3&t;0x07 */
multiline_comment|/*  */
DECL|macro|PIO_STATUS
mdefine_line|#define PIO_STATUS&t;0x08&t;&t;/* PIO status (r/w) */
multiline_comment|/* #define ATA_CMD&t;0x09 */
multiline_comment|/* ATA command/status reg (r/w) */
multiline_comment|/* #define ATA_ERR&t;0x0A */
multiline_comment|/* ATA features/error reg (r/w) */
DECL|macro|PIO_FLAG
mdefine_line|#define PIO_FLAG&t;0x0B&t;&t;/* PIO flag interrupt enable (r/w) */
DECL|macro|CONFIG5
mdefine_line|#define CONFIG5&t;&t;0x09&t;&t;/* configuration 5 register */
multiline_comment|/* #define SIGNATURE&t;0x0E */
multiline_comment|/* signature register (r) */
multiline_comment|/* #define CONFIG6&t;0x0F */
multiline_comment|/* configuration 6 register (r) */
DECL|macro|CONFIG7
mdefine_line|#define CONFIG7&t;&t;0x0d
multiline_comment|/* select register set 0 */
DECL|macro|REG0
mdefine_line|#define REG0(x)&t;&t;(outb(C4_IMG, (x) + CONFIG4))
multiline_comment|/* select register set 1 */
DECL|macro|REG1
mdefine_line|#define REG1(x)&t;&t;outb(C7_IMG, (x) + CONFIG7); outb(C5_IMG, (x) + CONFIG5)
macro_line|#if SYM53C500_DEBUG
DECL|macro|DEB
mdefine_line|#define DEB(x) x
macro_line|#else
DECL|macro|DEB
mdefine_line|#define DEB(x)
macro_line|#endif
macro_line|#if VERBOSE_SYM53C500_DEBUG
DECL|macro|VDEB
mdefine_line|#define VDEB(x) x
macro_line|#else
DECL|macro|VDEB
mdefine_line|#define VDEB(x)
macro_line|#endif
DECL|macro|LOAD_DMA_COUNT
mdefine_line|#define LOAD_DMA_COUNT(x, count) &bslash;&n;  outb(count &amp; 0xff, (x) + TC_LSB); &bslash;&n;  outb((count &gt;&gt; 8) &amp; 0xff, (x) + TC_MSB); &bslash;&n;  outb((count &gt;&gt; 16) &amp; 0xff, (x) + TC_HIGH);
multiline_comment|/* Chip commands */
DECL|macro|DMA_OP
mdefine_line|#define DMA_OP               0x80
DECL|macro|SCSI_NOP
mdefine_line|#define SCSI_NOP             0x00
DECL|macro|FLUSH_FIFO
mdefine_line|#define FLUSH_FIFO           0x01
DECL|macro|CHIP_RESET
mdefine_line|#define CHIP_RESET           0x02
DECL|macro|SCSI_RESET
mdefine_line|#define SCSI_RESET           0x03
DECL|macro|RESELECT
mdefine_line|#define RESELECT             0x40
DECL|macro|SELECT_NO_ATN
mdefine_line|#define SELECT_NO_ATN        0x41
DECL|macro|SELECT_ATN
mdefine_line|#define SELECT_ATN           0x42
DECL|macro|SELECT_ATN_STOP
mdefine_line|#define SELECT_ATN_STOP      0x43
DECL|macro|ENABLE_SEL
mdefine_line|#define ENABLE_SEL           0x44
DECL|macro|DISABLE_SEL
mdefine_line|#define DISABLE_SEL          0x45
DECL|macro|SELECT_ATN3
mdefine_line|#define SELECT_ATN3          0x46
DECL|macro|RESELECT3
mdefine_line|#define RESELECT3            0x47
DECL|macro|TRANSFER_INFO
mdefine_line|#define TRANSFER_INFO        0x10
DECL|macro|INIT_CMD_COMPLETE
mdefine_line|#define INIT_CMD_COMPLETE    0x11
DECL|macro|MSG_ACCEPT
mdefine_line|#define MSG_ACCEPT           0x12
DECL|macro|TRANSFER_PAD
mdefine_line|#define TRANSFER_PAD         0x18
DECL|macro|SET_ATN
mdefine_line|#define SET_ATN              0x1a
DECL|macro|RESET_ATN
mdefine_line|#define RESET_ATN            0x1b
DECL|macro|SEND_MSG
mdefine_line|#define SEND_MSG             0x20
DECL|macro|SEND_STATUS
mdefine_line|#define SEND_STATUS          0x21
DECL|macro|SEND_DATA
mdefine_line|#define SEND_DATA            0x22
DECL|macro|DISCONN_SEQ
mdefine_line|#define DISCONN_SEQ          0x23
DECL|macro|TERMINATE_SEQ
mdefine_line|#define TERMINATE_SEQ        0x24
DECL|macro|TARG_CMD_COMPLETE
mdefine_line|#define TARG_CMD_COMPLETE    0x25
DECL|macro|DISCONN
mdefine_line|#define DISCONN              0x27
DECL|macro|RECV_MSG
mdefine_line|#define RECV_MSG             0x28
DECL|macro|RECV_CMD
mdefine_line|#define RECV_CMD             0x29
DECL|macro|RECV_DATA
mdefine_line|#define RECV_DATA            0x2a
DECL|macro|RECV_CMD_SEQ
mdefine_line|#define RECV_CMD_SEQ         0x2b
DECL|macro|TARGET_ABORT_DMA
mdefine_line|#define TARGET_ABORT_DMA     0x04
multiline_comment|/* ================================================================== */
DECL|struct|scsi_info_t
r_struct
id|scsi_info_t
(brace
DECL|member|link
id|dev_link_t
id|link
suffix:semicolon
DECL|member|node
id|dev_node_t
id|node
suffix:semicolon
DECL|member|host
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
DECL|member|manf_id
r_int
r_int
id|manf_id
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n;*  Repository for per-instance host data.&n;*/
DECL|struct|sym53c500_data
r_struct
id|sym53c500_data
(brace
DECL|member|current_SC
r_struct
id|scsi_cmnd
op_star
id|current_SC
suffix:semicolon
DECL|member|fast_pio
r_int
id|fast_pio
suffix:semicolon
)brace
suffix:semicolon
DECL|enum|Phase
r_enum
id|Phase
(brace
DECL|enumerator|idle
id|idle
comma
DECL|enumerator|data_out
id|data_out
comma
DECL|enumerator|data_in
id|data_in
comma
DECL|enumerator|command_ph
id|command_ph
comma
DECL|enumerator|status_ph
id|status_ph
comma
DECL|enumerator|message_out
id|message_out
comma
DECL|enumerator|message_in
id|message_in
)brace
suffix:semicolon
multiline_comment|/* ================================================================== */
multiline_comment|/*&n;*  Global (within this module) variables other than&n;*  sym53c500_driver_template (the scsi_host_template).&n;*/
DECL|variable|dev_list
r_static
id|dev_link_t
op_star
id|dev_list
suffix:semicolon
DECL|variable|dev_info
r_static
id|dev_info_t
id|dev_info
op_assign
l_string|&quot;sym53c500_cs&quot;
suffix:semicolon
multiline_comment|/* ================================================================== */
r_static
r_void
DECL|function|chip_init
id|chip_init
c_func
(paren
r_int
id|io_port
)paren
(brace
id|REG1
c_func
(paren
id|io_port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|io_port
op_plus
id|PIO_STATUS
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|io_port
op_plus
id|PIO_FLAG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|C4_IMG
comma
id|io_port
op_plus
id|CONFIG4
)paren
suffix:semicolon
multiline_comment|/* REG0(io_port); */
id|outb
c_func
(paren
id|C3_IMG
comma
id|io_port
op_plus
id|CONFIG3
)paren
suffix:semicolon
id|outb
c_func
(paren
id|C2_IMG
comma
id|io_port
op_plus
id|CONFIG2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|C1_IMG
comma
id|io_port
op_plus
id|CONFIG1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x05
comma
id|io_port
op_plus
id|CLKCONV
)paren
suffix:semicolon
multiline_comment|/* clock conversion factor */
id|outb
c_func
(paren
l_int|0x9C
comma
id|io_port
op_plus
id|SRTIMOUT
)paren
suffix:semicolon
multiline_comment|/* Selection timeout */
id|outb
c_func
(paren
l_int|0x05
comma
id|io_port
op_plus
id|SYNCPRD
)paren
suffix:semicolon
multiline_comment|/* Synchronous transfer period */
id|outb
c_func
(paren
id|SYNC_MODE
comma
id|io_port
op_plus
id|SYNCOFF
)paren
suffix:semicolon
multiline_comment|/* synchronous mode */
)brace
r_static
r_void
DECL|function|SYM53C500_int_host_reset
id|SYM53C500_int_host_reset
c_func
(paren
r_int
id|io_port
)paren
(brace
id|outb
c_func
(paren
id|C4_IMG
comma
id|io_port
op_plus
id|CONFIG4
)paren
suffix:semicolon
multiline_comment|/* REG0(io_port); */
id|outb
c_func
(paren
id|CHIP_RESET
comma
id|io_port
op_plus
id|CMD_REG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SCSI_NOP
comma
id|io_port
op_plus
id|CMD_REG
)paren
suffix:semicolon
multiline_comment|/* required after reset */
id|outb
c_func
(paren
id|SCSI_RESET
comma
id|io_port
op_plus
id|CMD_REG
)paren
suffix:semicolon
id|chip_init
c_func
(paren
id|io_port
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_int
DECL|function|SYM53C500_pio_read
id|SYM53C500_pio_read
c_func
(paren
r_int
id|fast_pio
comma
r_int
id|base
comma
r_int
r_char
op_star
id|request
comma
r_int
r_int
id|reqlen
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|len
suffix:semicolon
multiline_comment|/* current scsi fifo size */
id|REG1
c_func
(paren
id|base
)paren
suffix:semicolon
r_while
c_loop
(paren
id|reqlen
)paren
(brace
id|i
op_assign
id|inb
c_func
(paren
id|base
op_plus
id|PIO_STATUS
)paren
suffix:semicolon
multiline_comment|/* VDEB(printk(&quot;pio_status=%x&bslash;n&quot;, i)); */
r_if
c_cond
(paren
id|i
op_amp
l_int|0x80
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|i
op_amp
l_int|0x1e
)paren
(brace
r_default
suffix:colon
r_case
l_int|0x10
suffix:colon
multiline_comment|/* fifo empty */
id|len
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0
suffix:colon
id|len
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x8
suffix:colon
multiline_comment|/* fifo 1/3 full */
id|len
op_assign
l_int|42
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc
suffix:colon
multiline_comment|/* fifo 2/3 full */
id|len
op_assign
l_int|84
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe
suffix:colon
multiline_comment|/* fifo full */
id|len
op_assign
l_int|128
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0x40
)paren
op_logical_and
id|len
op_eq
l_int|0
)paren
(brace
multiline_comment|/* fifo empty and interrupt occurred */
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
id|len
OG
id|reqlen
)paren
id|len
op_assign
id|reqlen
suffix:semicolon
r_if
c_cond
(paren
id|fast_pio
op_logical_and
id|len
OG
l_int|3
)paren
(brace
id|insl
c_func
(paren
id|base
op_plus
id|PIO_FIFO
comma
id|request
comma
id|len
op_rshift
l_int|2
)paren
suffix:semicolon
id|request
op_add_assign
id|len
op_amp
l_int|0xfc
suffix:semicolon
id|reqlen
op_sub_assign
id|len
op_amp
l_int|0xfc
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
op_star
id|request
op_increment
op_assign
id|inb
c_func
(paren
id|base
op_plus
id|PIO_FIFO
)paren
suffix:semicolon
id|reqlen
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|__inline__
r_int
DECL|function|SYM53C500_pio_write
id|SYM53C500_pio_write
c_func
(paren
r_int
id|fast_pio
comma
r_int
id|base
comma
r_int
r_char
op_star
id|request
comma
r_int
r_int
id|reqlen
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|len
suffix:semicolon
multiline_comment|/* current scsi fifo size */
id|REG1
c_func
(paren
id|base
)paren
suffix:semicolon
r_while
c_loop
(paren
id|reqlen
op_logical_and
op_logical_neg
(paren
id|i
op_amp
l_int|0x40
)paren
)paren
(brace
id|i
op_assign
id|inb
c_func
(paren
id|base
op_plus
id|PIO_STATUS
)paren
suffix:semicolon
multiline_comment|/* VDEB(printk(&quot;pio_status=%x&bslash;n&quot;, i)); */
r_if
c_cond
(paren
id|i
op_amp
l_int|0x80
)paren
multiline_comment|/* error */
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|i
op_amp
l_int|0x1e
)paren
(brace
r_case
l_int|0x10
suffix:colon
id|len
op_assign
l_int|128
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0
suffix:colon
id|len
op_assign
l_int|84
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x8
suffix:colon
id|len
op_assign
l_int|42
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc
suffix:colon
id|len
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
l_int|0xe
suffix:colon
id|len
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
id|len
OG
id|reqlen
)paren
id|len
op_assign
id|reqlen
suffix:semicolon
r_if
c_cond
(paren
id|fast_pio
op_logical_and
id|len
OG
l_int|3
)paren
(brace
id|outsl
c_func
(paren
id|base
op_plus
id|PIO_FIFO
comma
id|request
comma
id|len
op_rshift
l_int|2
)paren
suffix:semicolon
id|request
op_add_assign
id|len
op_amp
l_int|0xfc
suffix:semicolon
id|reqlen
op_sub_assign
id|len
op_amp
l_int|0xfc
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
id|outb
c_func
(paren
op_star
id|request
op_increment
comma
id|base
op_plus
id|PIO_FIFO
)paren
suffix:semicolon
id|reqlen
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|irqreturn_t
DECL|function|SYM53C500_intr
id|SYM53C500_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
id|DEB
c_func
(paren
r_int
r_char
id|fifo_size
suffix:semicolon
)paren
id|DEB
c_func
(paren
r_int
r_char
id|seq_reg
suffix:semicolon
)paren
r_int
r_char
id|status
comma
id|int_reg
suffix:semicolon
r_int
r_char
id|pio_status
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sglist
suffix:semicolon
r_int
r_int
id|sgcount
suffix:semicolon
r_int
id|port_base
op_assign
id|dev-&gt;io_port
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|dev-&gt;hostdata
suffix:semicolon
r_struct
id|scsi_cmnd
op_star
id|curSC
op_assign
id|data-&gt;current_SC
suffix:semicolon
r_int
id|fast_pio
op_assign
id|data-&gt;fast_pio
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|dev-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500_intr called&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|REG1
c_func
(paren
id|port_base
)paren
suffix:semicolon
id|pio_status
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|PIO_STATUS
)paren
suffix:semicolon
id|REG0
c_func
(paren
id|port_base
)paren
suffix:semicolon
id|status
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|STAT_REG
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|seq_reg
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|SEQ_REG
)paren
)paren
suffix:semicolon
id|int_reg
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|INT_REG
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|fifo_size
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|FIFO_FLAGS
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
macro_line|#if SYM53C500_DEBUG
id|printk
c_func
(paren
l_string|&quot;status=%02x, seq_reg=%02x, int_reg=%02x, fifo_size=%02x&quot;
comma
id|status
comma
id|seq_reg
comma
id|int_reg
comma
id|fifo_size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, pio=%02x&bslash;n&quot;
comma
id|pio_status
)paren
suffix:semicolon
macro_line|#endif /* SYM53C500_DEBUG */
r_if
c_cond
(paren
id|int_reg
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* SCSI reset intr */
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: reset intr received&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|curSC-&gt;result
op_assign
id|DID_RESET
op_lshift
l_int|16
suffix:semicolon
r_goto
id|idle_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pio_status
op_amp
l_int|0x80
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Warning: PIO error!&bslash;n&quot;
)paren
suffix:semicolon
id|curSC-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
r_goto
id|idle_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Parity error */
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Warning: parity error!&bslash;n&quot;
)paren
suffix:semicolon
id|curSC-&gt;result
op_assign
id|DID_PARITY
op_lshift
l_int|16
suffix:semicolon
r_goto
id|idle_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x40
)paren
(brace
multiline_comment|/* Gross error */
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Warning: gross error!&bslash;n&quot;
)paren
suffix:semicolon
id|curSC-&gt;result
op_assign
id|DID_ERROR
op_lshift
l_int|16
suffix:semicolon
r_goto
id|idle_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|int_reg
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Disconnect */
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: disconnect intr received&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curSC-&gt;SCp.phase
op_ne
id|message_in
)paren
(brace
multiline_comment|/* Unexpected disconnect */
id|curSC-&gt;result
op_assign
id|DID_NO_CONNECT
op_lshift
l_int|16
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Command complete, return status and message */
id|curSC-&gt;result
op_assign
(paren
id|curSC-&gt;SCp.Status
op_amp
l_int|0xff
)paren
op_or
(paren
(paren
id|curSC-&gt;SCp.Message
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|DID_OK
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
r_goto
id|idle_out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|status
op_amp
l_int|0x07
)paren
(brace
multiline_comment|/* scsi phase */
r_case
l_int|0x00
suffix:colon
multiline_comment|/* DATA-OUT */
r_if
c_cond
(paren
id|int_reg
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* Target requesting info transfer */
id|curSC-&gt;SCp.phase
op_assign
id|data_out
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Data-Out phase&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FLUSH_FIFO
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
id|LOAD_DMA_COUNT
c_func
(paren
id|port_base
comma
id|curSC-&gt;request_bufflen
)paren
suffix:semicolon
multiline_comment|/* Max transfer size */
id|outb
c_func
(paren
id|TRANSFER_INFO
op_or
id|DMA_OP
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|curSC-&gt;use_sg
)paren
multiline_comment|/* Don&squot;t use scatter-gather */
id|SYM53C500_pio_write
c_func
(paren
id|fast_pio
comma
id|port_base
comma
id|curSC-&gt;request_buffer
comma
id|curSC-&gt;request_bufflen
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* use scatter-gather */
id|sgcount
op_assign
id|curSC-&gt;use_sg
suffix:semicolon
id|sglist
op_assign
id|curSC-&gt;request_buffer
suffix:semicolon
r_while
c_loop
(paren
id|sgcount
op_decrement
)paren
(brace
id|SYM53C500_pio_write
c_func
(paren
id|fast_pio
comma
id|port_base
comma
id|page_address
c_func
(paren
id|sglist-&gt;page
)paren
op_plus
id|sglist-&gt;offset
comma
id|sglist-&gt;length
)paren
suffix:semicolon
id|sglist
op_increment
suffix:semicolon
)brace
)brace
id|REG0
c_func
(paren
id|port_base
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
multiline_comment|/* DATA-IN */
r_if
c_cond
(paren
id|int_reg
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* Target requesting info transfer */
id|curSC-&gt;SCp.phase
op_assign
id|data_in
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Data-In phase&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FLUSH_FIFO
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
id|LOAD_DMA_COUNT
c_func
(paren
id|port_base
comma
id|curSC-&gt;request_bufflen
)paren
suffix:semicolon
multiline_comment|/* Max transfer size */
id|outb
c_func
(paren
id|TRANSFER_INFO
op_or
id|DMA_OP
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|curSC-&gt;use_sg
)paren
multiline_comment|/* Don&squot;t use scatter-gather */
id|SYM53C500_pio_read
c_func
(paren
id|fast_pio
comma
id|port_base
comma
id|curSC-&gt;request_buffer
comma
id|curSC-&gt;request_bufflen
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Use scatter-gather */
id|sgcount
op_assign
id|curSC-&gt;use_sg
suffix:semicolon
id|sglist
op_assign
id|curSC-&gt;request_buffer
suffix:semicolon
r_while
c_loop
(paren
id|sgcount
op_decrement
)paren
(brace
id|SYM53C500_pio_read
c_func
(paren
id|fast_pio
comma
id|port_base
comma
id|page_address
c_func
(paren
id|sglist-&gt;page
)paren
op_plus
id|sglist-&gt;offset
comma
id|sglist-&gt;length
)paren
suffix:semicolon
id|sglist
op_increment
suffix:semicolon
)brace
)brace
id|REG0
c_func
(paren
id|port_base
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
multiline_comment|/* COMMAND */
id|curSC-&gt;SCp.phase
op_assign
id|command_ph
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Warning: Unknown interrupt occurred in command phase!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
multiline_comment|/* STATUS */
id|curSC-&gt;SCp.phase
op_assign
id|status_ph
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Status phase&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|FLUSH_FIFO
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|INIT_CMD_COMPLETE
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
multiline_comment|/* Reserved */
r_case
l_int|0x05
suffix:colon
multiline_comment|/* Reserved */
id|printk
c_func
(paren
l_string|&quot;SYM53C500: WARNING: Reserved phase!!!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x06
suffix:colon
multiline_comment|/* MESSAGE-OUT */
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Message-Out phase&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|curSC-&gt;SCp.phase
op_assign
id|message_out
suffix:semicolon
id|outb
c_func
(paren
id|SET_ATN
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
multiline_comment|/* Reject the message */
id|outb
c_func
(paren
id|MSG_ACCEPT
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x07
suffix:colon
multiline_comment|/* MESSAGE-IN */
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Message-In phase&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|curSC-&gt;SCp.phase
op_assign
id|message_in
suffix:semicolon
id|curSC-&gt;SCp.Status
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|SCSI_FIFO
)paren
suffix:semicolon
id|curSC-&gt;SCp.Message
op_assign
id|inb
c_func
(paren
id|port_base
op_plus
id|SCSI_FIFO
)paren
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SCSI FIFO size=%d&bslash;n&quot;
comma
id|inb
c_func
(paren
id|port_base
op_plus
id|FIFO_FLAGS
)paren
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Status = %02x  Message = %02x&bslash;n&quot;
comma
id|curSC-&gt;SCp.Status
comma
id|curSC-&gt;SCp.Message
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curSC-&gt;SCp.Message
op_eq
id|SAVE_POINTERS
op_logical_or
id|curSC-&gt;SCp.Message
op_eq
id|DISCONNECT
)paren
(brace
id|outb
c_func
(paren
id|SET_ATN
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
multiline_comment|/* Reject message */
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Discarding SAVE_POINTERS message&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|MSG_ACCEPT
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
id|dev-&gt;host_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
id|idle_out
suffix:colon
id|curSC-&gt;SCp.phase
op_assign
id|idle
suffix:semicolon
id|curSC
op_member_access_from_pointer
id|scsi_done
c_func
(paren
id|curSC
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_static
r_void
DECL|function|SYM53C500_release
id|SYM53C500_release
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
r_struct
id|scsi_info_t
op_star
id|info
op_assign
id|link-&gt;priv
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|shost
op_assign
id|info-&gt;host
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;SYM53C500_release(0x%p)&bslash;n&quot;
comma
id|link
)paren
suffix:semicolon
multiline_comment|/*&n;&t;*  Do this before releasing/freeing resources.&n;&t;*/
id|scsi_remove_host
c_func
(paren
id|shost
)paren
suffix:semicolon
multiline_comment|/*&n;&t;*  Interrupts getting hosed on card removal.  Try&n;&t;*  the following code, mostly from qlogicfas.c.&n;&t;*/
r_if
c_cond
(paren
id|shost-&gt;irq
)paren
id|free_irq
c_func
(paren
id|shost-&gt;irq
comma
id|shost
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shost-&gt;dma_channel
op_ne
l_int|0xff
)paren
id|free_dma
c_func
(paren
id|shost-&gt;dma_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shost-&gt;io_port
op_logical_and
id|shost-&gt;n_io_port
)paren
id|release_region
c_func
(paren
id|shost-&gt;io_port
comma
id|shost-&gt;n_io_port
)paren
suffix:semicolon
id|link-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|pcmcia_release_configuration
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
id|pcmcia_release_io
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
id|pcmcia_release_irq
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;irq
)paren
suffix:semicolon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG
suffix:semicolon
id|scsi_host_put
c_func
(paren
id|shost
)paren
suffix:semicolon
)brace
multiline_comment|/* SYM53C500_release */
r_static
r_const
r_char
op_star
DECL|function|SYM53C500_info
id|SYM53C500_info
c_func
(paren
r_struct
id|Scsi_Host
op_star
id|SChost
)paren
(brace
r_static
r_char
id|info_msg
(braket
l_int|256
)braket
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|SChost-&gt;hostdata
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500_info called&bslash;n&quot;
)paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|snprintf
c_func
(paren
id|info_msg
comma
r_sizeof
(paren
id|info_msg
)paren
comma
l_string|&quot;SYM53C500 at 0x%lx, IRQ %d, %s PIO mode.&quot;
comma
id|SChost-&gt;io_port
comma
id|SChost-&gt;irq
comma
id|data-&gt;fast_pio
ques
c_cond
l_string|&quot;fast&quot;
suffix:colon
l_string|&quot;slow&quot;
)paren
suffix:semicolon
r_return
(paren
id|info_msg
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|SYM53C500_queue
id|SYM53C500_queue
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
comma
r_void
(paren
op_star
id|done
)paren
(paren
r_struct
id|scsi_cmnd
op_star
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|port_base
op_assign
id|SCpnt-&gt;device-&gt;host-&gt;io_port
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|SCpnt-&gt;device-&gt;host-&gt;hostdata
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500_queue called&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;cmd=%02x, cmd_len=%02x, target=%02x, lun=%02x, bufflen=%d&bslash;n&quot;
comma
id|SCpnt-&gt;cmnd
(braket
l_int|0
)braket
comma
id|SCpnt-&gt;cmd_len
comma
id|SCpnt-&gt;device-&gt;id
comma
id|SCpnt-&gt;device-&gt;lun
comma
id|SCpnt-&gt;request_bufflen
)paren
)paren
suffix:semicolon
id|VDEB
c_func
(paren
r_for
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SCpnt-&gt;cmd_len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;cmd[%d]=%02x  &quot;
comma
id|i
comma
id|SCpnt-&gt;cmnd
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|VDEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|data-&gt;current_SC
op_assign
id|SCpnt
suffix:semicolon
id|data-&gt;current_SC-&gt;scsi_done
op_assign
id|done
suffix:semicolon
id|data-&gt;current_SC-&gt;SCp.phase
op_assign
id|command_ph
suffix:semicolon
id|data-&gt;current_SC-&gt;SCp.Status
op_assign
l_int|0
suffix:semicolon
id|data-&gt;current_SC-&gt;SCp.Message
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We are locked here already by the mid layer */
id|REG0
c_func
(paren
id|port_base
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SCpnt-&gt;device-&gt;id
comma
id|port_base
op_plus
id|DEST_ID
)paren
suffix:semicolon
multiline_comment|/* set destination */
id|outb
c_func
(paren
id|FLUSH_FIFO
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
multiline_comment|/* reset the fifos */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SCpnt-&gt;cmd_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|SCpnt-&gt;cmnd
(braket
id|i
)braket
comma
id|port_base
op_plus
id|SCSI_FIFO
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|SELECT_NO_ATN
comma
id|port_base
op_plus
id|CMD_REG
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|SYM53C500_host_reset
id|SYM53C500_host_reset
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|SCpnt
)paren
(brace
r_int
id|port_base
op_assign
id|SCpnt-&gt;device-&gt;host-&gt;io_port
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500_host_reset called&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SYM53C500_int_host_reset
c_func
(paren
id|port_base
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
r_static
r_int
DECL|function|SYM53C500_biosparm
id|SYM53C500_biosparm
c_func
(paren
r_struct
id|scsi_device
op_star
id|disk
comma
r_struct
id|block_device
op_star
id|dev
comma
id|sector_t
id|capacity
comma
r_int
op_star
id|info_array
)paren
(brace
r_int
id|size
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500_biosparm called&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|size
op_assign
id|capacity
suffix:semicolon
id|info_array
(braket
l_int|0
)braket
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* heads */
id|info_array
(braket
l_int|1
)braket
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* sectors */
id|info_array
(braket
l_int|2
)braket
op_assign
id|size
op_rshift
l_int|11
suffix:semicolon
multiline_comment|/* cylinders */
r_if
c_cond
(paren
id|info_array
(braket
l_int|2
)braket
OG
l_int|1024
)paren
(brace
multiline_comment|/* big disk */
id|info_array
(braket
l_int|0
)braket
op_assign
l_int|255
suffix:semicolon
id|info_array
(braket
l_int|1
)braket
op_assign
l_int|63
suffix:semicolon
id|info_array
(braket
l_int|2
)braket
op_assign
id|size
op_div
(paren
l_int|255
op_star
l_int|63
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|SYM53C500_show_pio
id|SYM53C500_show_pio
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|SHp
op_assign
id|class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|SHp-&gt;hostdata
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
l_int|4
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;fast_pio
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|SYM53C500_store_pio
id|SYM53C500_store_pio
c_func
(paren
r_struct
id|class_device
op_star
id|cdev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|pio
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|SHp
op_assign
id|class_to_shost
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|SHp-&gt;hostdata
suffix:semicolon
id|pio
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pio
op_eq
l_int|0
op_logical_or
id|pio
op_eq
l_int|1
)paren
(brace
id|data-&gt;fast_pio
op_assign
id|pio
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;*  SCSI HBA device attributes we want to&n;*  make available via sysfs.&n;*/
DECL|variable|SYM53C500_pio_attr
r_static
r_struct
id|class_device_attribute
id|SYM53C500_pio_attr
op_assign
(brace
dot
id|attr
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;fast_pio&quot;
comma
dot
id|mode
op_assign
(paren
id|S_IRUGO
op_or
id|S_IWUSR
)paren
comma
)brace
comma
dot
id|show
op_assign
id|SYM53C500_show_pio
comma
dot
id|store
op_assign
id|SYM53C500_store_pio
comma
)brace
suffix:semicolon
DECL|variable|SYM53C500_shost_attrs
r_static
r_struct
id|class_device_attribute
op_star
id|SYM53C500_shost_attrs
(braket
)braket
op_assign
(brace
op_amp
id|SYM53C500_pio_attr
comma
l_int|NULL
comma
)brace
suffix:semicolon
multiline_comment|/*&n;*  scsi_host_template initializer&n;*/
DECL|variable|sym53c500_driver_template
r_static
r_struct
id|scsi_host_template
id|sym53c500_driver_template
op_assign
(brace
dot
id|module
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;SYM53C500&quot;
comma
dot
id|info
op_assign
id|SYM53C500_info
comma
dot
id|queuecommand
op_assign
id|SYM53C500_queue
comma
dot
id|eh_host_reset_handler
op_assign
id|SYM53C500_host_reset
comma
dot
id|bios_param
op_assign
id|SYM53C500_biosparm
comma
dot
id|proc_name
op_assign
l_string|&quot;SYM53C500&quot;
comma
dot
id|can_queue
op_assign
l_int|1
comma
dot
id|this_id
op_assign
l_int|7
comma
dot
id|sg_tablesize
op_assign
l_int|32
comma
dot
id|cmd_per_lun
op_assign
l_int|1
comma
dot
id|use_clustering
op_assign
id|ENABLE_CLUSTERING
comma
dot
id|shost_attrs
op_assign
id|SYM53C500_shost_attrs
)brace
suffix:semicolon
DECL|macro|CS_CHECK
mdefine_line|#define CS_CHECK(fn, ret) &bslash;&n;do { last_fn = (fn); if ((last_ret = (ret)) != 0) goto cs_failed; } while (0)
r_static
r_void
DECL|function|SYM53C500_config
id|SYM53C500_config
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|client_handle_t
id|handle
op_assign
id|link-&gt;handle
suffix:semicolon
r_struct
id|scsi_info_t
op_star
id|info
op_assign
id|link-&gt;priv
suffix:semicolon
id|tuple_t
id|tuple
suffix:semicolon
id|cisparse_t
id|parse
suffix:semicolon
r_int
id|i
comma
id|last_ret
comma
id|last_fn
suffix:semicolon
r_int
id|irq_level
comma
id|port_base
suffix:semicolon
r_int
r_int
id|tuple_data
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|Scsi_Host
op_star
id|host
suffix:semicolon
r_struct
id|scsi_host_template
op_star
id|tpnt
op_assign
op_amp
id|sym53c500_driver_template
suffix:semicolon
r_struct
id|sym53c500_data
op_star
id|data
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;SYM53C500_config(0x%p)&bslash;n&quot;
comma
id|link
)paren
suffix:semicolon
id|tuple.TupleData
op_assign
(paren
id|cisdata_t
op_star
)paren
id|tuple_data
suffix:semicolon
id|tuple.TupleDataMax
op_assign
l_int|64
suffix:semicolon
id|tuple.TupleOffset
op_assign
l_int|0
suffix:semicolon
id|tuple.DesiredTuple
op_assign
id|CISTPL_CONFIG
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetFirstTuple
comma
id|pcmcia_get_first_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetTupleData
comma
id|pcmcia_get_tuple_data
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|ParseTuple
comma
id|pcmcia_parse_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
comma
op_amp
id|parse
)paren
)paren
suffix:semicolon
id|link-&gt;conf.ConfigBase
op_assign
id|parse.config.base
suffix:semicolon
id|tuple.DesiredTuple
op_assign
id|CISTPL_MANFID
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pcmcia_get_first_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
op_eq
id|CS_SUCCESS
)paren
op_logical_and
(paren
id|pcmcia_get_tuple_data
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
op_eq
id|CS_SUCCESS
)paren
)paren
id|info-&gt;manf_id
op_assign
id|le16_to_cpu
c_func
(paren
id|tuple.TupleData
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Configure card */
id|link-&gt;state
op_or_assign
id|DEV_CONFIG
suffix:semicolon
id|tuple.DesiredTuple
op_assign
id|CISTPL_CFTABLE_ENTRY
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetFirstTuple
comma
id|pcmcia_get_first_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|pcmcia_get_tuple_data
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
op_ne
l_int|0
op_logical_or
id|pcmcia_parse_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
comma
op_amp
id|parse
)paren
op_ne
l_int|0
)paren
r_goto
id|next_entry
suffix:semicolon
id|link-&gt;conf.ConfigIndex
op_assign
id|parse.cftable_entry.index
suffix:semicolon
id|link-&gt;io.BasePort1
op_assign
id|parse.cftable_entry.io.win
(braket
l_int|0
)braket
dot
id|base
suffix:semicolon
id|link-&gt;io.NumPorts1
op_assign
id|parse.cftable_entry.io.win
(braket
l_int|0
)braket
dot
id|len
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;io.BasePort1
op_ne
l_int|0
)paren
(brace
id|i
op_assign
id|pcmcia_request_io
c_func
(paren
id|handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CS_SUCCESS
)paren
r_break
suffix:semicolon
)brace
id|next_entry
suffix:colon
id|CS_CHECK
c_func
(paren
id|GetNextTuple
comma
id|pcmcia_get_next_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
)brace
id|CS_CHECK
c_func
(paren
id|RequestIRQ
comma
id|pcmcia_request_irq
c_func
(paren
id|handle
comma
op_amp
id|link-&gt;irq
)paren
)paren
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|RequestConfiguration
comma
id|pcmcia_request_configuration
c_func
(paren
id|handle
comma
op_amp
id|link-&gt;conf
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;*  That&squot;s the trouble with copying liberally from another driver.&n;&t;*  Some things probably aren&squot;t relevant, and I suspect this entire&n;&t;*  section dealing with manufacturer IDs can be scrapped.&t;--rct&n;&t;*/
r_if
c_cond
(paren
(paren
id|info-&gt;manf_id
op_eq
id|MANFID_MACNICA
)paren
op_logical_or
(paren
id|info-&gt;manf_id
op_eq
id|MANFID_PIONEER
)paren
op_logical_or
(paren
id|info-&gt;manf_id
op_eq
l_int|0x0098
)paren
)paren
(brace
multiline_comment|/* set ATAcmd */
id|outb
c_func
(paren
l_int|0xb4
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0xd
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x24
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0x9
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x04
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0xd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;*  irq_level == 0 implies tpnt-&gt;can_queue == 0, which&n;&t;*  is not supported in 2.6.  Thus, only irq_level &gt; 0&n;&t;*  will be allowed.&n;&t;*&n;&t;*  Possible port_base values are as follows:&n;&t;*&n;&t;*&t;0x130, 0x230, 0x280, 0x290,&n;&t;*&t;0x320, 0x330, 0x340, 0x350&n;&t;*/
id|port_base
op_assign
id|link-&gt;io.BasePort1
suffix:semicolon
id|irq_level
op_assign
id|link-&gt;irq.AssignedIRQ
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: port_base=0x%x, irq=%d, fast_pio=%d&bslash;n&quot;
comma
id|port_base
comma
id|irq_level
comma
id|USE_FAST_PIO
)paren
suffix:semicolon
)paren
id|chip_init
c_func
(paren
id|port_base
)paren
suffix:semicolon
id|host
op_assign
id|scsi_host_alloc
c_func
(paren
id|tpnt
comma
r_sizeof
(paren
r_struct
id|sym53c500_data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|host
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Unable to register host, giving up.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_release
suffix:semicolon
)brace
id|data
op_assign
(paren
r_struct
id|sym53c500_data
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
id|irq_level
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq_level
comma
id|SYM53C500_intr
comma
l_int|0
comma
l_string|&quot;SYM53C500&quot;
comma
id|host
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SYM53C500: unable to allocate IRQ %d&bslash;n&quot;
comma
id|irq_level
)paren
suffix:semicolon
r_goto
id|err_free_scsi
suffix:semicolon
)brace
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: allocated IRQ %d&bslash;n&quot;
comma
id|irq_level
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_level
op_eq
l_int|0
)paren
(brace
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: No interrupts detected&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_goto
id|err_free_scsi
suffix:semicolon
)brace
r_else
(brace
id|DEB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;SYM53C500: Shouldn&squot;t get here!&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_goto
id|err_free_scsi
suffix:semicolon
)brace
id|host-&gt;unique_id
op_assign
id|port_base
suffix:semicolon
id|host-&gt;irq
op_assign
id|irq_level
suffix:semicolon
id|host-&gt;io_port
op_assign
id|port_base
suffix:semicolon
id|host-&gt;n_io_port
op_assign
l_int|0x10
suffix:semicolon
id|host-&gt;dma_channel
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;*  Note fast_pio is set to USE_FAST_PIO by&n;&t;*  default, but can be changed via &quot;sysfs&quot;.&n;&t;*/
id|data-&gt;fast_pio
op_assign
id|USE_FAST_PIO
suffix:semicolon
id|sprintf
c_func
(paren
id|info-&gt;node.dev_name
comma
l_string|&quot;scsi%d&quot;
comma
id|host-&gt;host_no
)paren
suffix:semicolon
id|link-&gt;dev
op_assign
op_amp
id|info-&gt;node
suffix:semicolon
id|info-&gt;host
op_assign
id|host
suffix:semicolon
r_if
c_cond
(paren
id|scsi_add_host
c_func
(paren
id|host
comma
l_int|NULL
)paren
)paren
r_goto
id|err_free_irq
suffix:semicolon
id|scsi_scan_host
c_func
(paren
id|host
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
multiline_comment|/* SUCCESS */
id|err_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|irq_level
comma
id|host
)paren
suffix:semicolon
id|err_free_scsi
suffix:colon
id|scsi_host_put
c_func
(paren
id|host
)paren
suffix:semicolon
id|err_release
suffix:colon
id|release_region
c_func
(paren
id|port_base
comma
l_int|0x10
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sym53c500_cs: no SCSI devices found&bslash;n&quot;
)paren
suffix:semicolon
id|out
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG_PENDING
suffix:semicolon
r_return
suffix:semicolon
id|cs_failed
suffix:colon
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|last_fn
comma
id|last_ret
)paren
suffix:semicolon
id|SYM53C500_release
c_func
(paren
id|link
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* SYM53C500_config */
r_static
r_int
DECL|function|SYM53C500_event
id|SYM53C500_event
c_func
(paren
id|event_t
id|event
comma
r_int
id|priority
comma
id|event_callback_args_t
op_star
id|args
)paren
(brace
id|dev_link_t
op_star
id|link
op_assign
id|args-&gt;client_data
suffix:semicolon
r_struct
id|scsi_info_t
op_star
id|info
op_assign
id|link-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;SYM53C500_event(0x%06x)&bslash;n&quot;
comma
id|event
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|CS_EVENT_CARD_REMOVAL
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_PRESENT
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
id|SYM53C500_release
c_func
(paren
id|link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_EVENT_CARD_INSERTION
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_PRESENT
op_or
id|DEV_CONFIG_PENDING
suffix:semicolon
id|SYM53C500_config
c_func
(paren
id|link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_SUSPEND
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_SUSPEND
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_RESET_PHYSICAL
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
id|pcmcia_release_configuration
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_RESUME
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_SUSPEND
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_CARD_RESET
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
id|pcmcia_request_configuration
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;conf
)paren
suffix:semicolon
multiline_comment|/* See earlier comment about manufacturer IDs. */
r_if
c_cond
(paren
(paren
id|info-&gt;manf_id
op_eq
id|MANFID_MACNICA
)paren
op_logical_or
(paren
id|info-&gt;manf_id
op_eq
id|MANFID_PIONEER
)paren
op_logical_or
(paren
id|info-&gt;manf_id
op_eq
l_int|0x0098
)paren
)paren
(brace
id|outb
c_func
(paren
l_int|0x80
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0xd
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x24
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0x9
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x04
comma
id|link-&gt;io.BasePort1
op_plus
l_int|0xd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;*  If things don&squot;t work after a &quot;resume&quot;,&n;&t;&t;&t;*  this is a good place to start looking.&n;&t;&t;&t;*/
id|SYM53C500_int_host_reset
c_func
(paren
id|link-&gt;io.BasePort1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SYM53C500_event */
r_static
r_void
DECL|function|SYM53C500_detach
id|SYM53C500_detach
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|dev_link_t
op_star
op_star
id|linkp
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;SYM53C500_detach(0x%p)&bslash;n&quot;
comma
id|link
)paren
suffix:semicolon
multiline_comment|/* Locate device structure */
r_for
c_loop
(paren
id|linkp
op_assign
op_amp
id|dev_list
suffix:semicolon
op_star
id|linkp
suffix:semicolon
id|linkp
op_assign
op_amp
(paren
op_star
id|linkp
)paren
op_member_access_from_pointer
id|next
)paren
r_if
c_cond
(paren
op_star
id|linkp
op_eq
id|link
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_star
id|linkp
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
id|SYM53C500_release
c_func
(paren
id|link
)paren
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;handle
)paren
id|pcmcia_deregister_client
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
multiline_comment|/* Unlink device structure, free bits. */
op_star
id|linkp
op_assign
id|link-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|link-&gt;priv
)paren
suffix:semicolon
id|link-&gt;priv
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* SYM53C500_detach */
r_static
id|dev_link_t
op_star
DECL|function|SYM53C500_attach
id|SYM53C500_attach
c_func
(paren
r_void
)paren
(brace
r_struct
id|scsi_info_t
op_star
id|info
suffix:semicolon
id|client_reg_t
id|client_reg
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;SYM53C500_attach()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Create new SCSI device */
id|info
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|info
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|info
)paren
)paren
suffix:semicolon
id|link
op_assign
op_amp
id|info-&gt;link
suffix:semicolon
id|link-&gt;priv
op_assign
id|info
suffix:semicolon
id|link-&gt;io.NumPorts1
op_assign
l_int|16
suffix:semicolon
id|link-&gt;io.Attributes1
op_assign
id|IO_DATA_PATH_WIDTH_AUTO
suffix:semicolon
id|link-&gt;io.IOAddrLines
op_assign
l_int|10
suffix:semicolon
id|link-&gt;irq.Attributes
op_assign
id|IRQ_TYPE_EXCLUSIVE
suffix:semicolon
id|link-&gt;irq.IRQInfo1
op_assign
id|IRQ_INFO2_VALID
op_or
id|IRQ_LEVEL_ID
suffix:semicolon
r_if
c_cond
(paren
id|irq_list
(braket
l_int|0
)braket
op_eq
op_minus
l_int|1
)paren
id|link-&gt;irq.IRQInfo2
op_assign
id|irq_mask
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|link-&gt;irq.IRQInfo2
op_or_assign
l_int|1
op_lshift
id|irq_list
(braket
id|i
)braket
suffix:semicolon
id|link-&gt;conf.Attributes
op_assign
id|CONF_ENABLE_IRQ
suffix:semicolon
id|link-&gt;conf.Vcc
op_assign
l_int|50
suffix:semicolon
id|link-&gt;conf.IntType
op_assign
id|INT_MEMORY_AND_IO
suffix:semicolon
id|link-&gt;conf.Present
op_assign
id|PRESENT_OPTION
suffix:semicolon
multiline_comment|/* Register with Card Services */
id|link-&gt;next
op_assign
id|dev_list
suffix:semicolon
id|dev_list
op_assign
id|link
suffix:semicolon
id|client_reg.dev_info
op_assign
op_amp
id|dev_info
suffix:semicolon
id|client_reg.Attributes
op_assign
id|INFO_IO_CLIENT
op_or
id|INFO_CARD_SHARE
suffix:semicolon
id|client_reg.event_handler
op_assign
op_amp
id|SYM53C500_event
suffix:semicolon
id|client_reg.EventMask
op_assign
id|CS_EVENT_RESET_REQUEST
op_or
id|CS_EVENT_CARD_RESET
op_or
id|CS_EVENT_CARD_INSERTION
op_or
id|CS_EVENT_CARD_REMOVAL
op_or
id|CS_EVENT_PM_SUSPEND
op_or
id|CS_EVENT_PM_RESUME
suffix:semicolon
id|client_reg.Version
op_assign
l_int|0x0210
suffix:semicolon
id|client_reg.event_callback_args.client_data
op_assign
id|link
suffix:semicolon
id|ret
op_assign
id|pcmcia_register_client
c_func
(paren
op_amp
id|link-&gt;handle
comma
op_amp
id|client_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
(brace
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|RegisterClient
comma
id|ret
)paren
suffix:semicolon
id|SYM53C500_detach
c_func
(paren
id|link
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|link
suffix:semicolon
)brace
multiline_comment|/* SYM53C500_attach */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Bob Tracy &lt;rct@frus.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SYM53C500 PCMCIA SCSI driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sym53c500_cs_driver
r_static
r_struct
id|pcmcia_driver
id|sym53c500_cs_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|drv
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sym53c500_cs&quot;
comma
)brace
comma
dot
id|attach
op_assign
id|SYM53C500_attach
comma
dot
id|detach
op_assign
id|SYM53C500_detach
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|init_sym53c500_cs
id|init_sym53c500_cs
c_func
(paren
r_void
)paren
(brace
r_return
id|pcmcia_register_driver
c_func
(paren
op_amp
id|sym53c500_cs_driver
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|exit_sym53c500_cs
id|exit_sym53c500_cs
c_func
(paren
r_void
)paren
(brace
id|pcmcia_unregister_driver
c_func
(paren
op_amp
id|sym53c500_cs_driver
)paren
suffix:semicolon
)brace
DECL|variable|init_sym53c500_cs
id|module_init
c_func
(paren
id|init_sym53c500_cs
)paren
suffix:semicolon
DECL|variable|exit_sym53c500_cs
id|module_exit
c_func
(paren
id|exit_sym53c500_cs
)paren
suffix:semicolon
eof
