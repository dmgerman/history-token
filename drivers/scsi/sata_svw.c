multiline_comment|/*&n; *  ata_k2.c - Broadcom (Apple K2) SATA&n; *&n; *  Copyright 2003 Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;&n; *&n; *  Bits from Jeff Garzik, Copyright RedHat, Inc.&n; *&n; *  This driver probably works with non-Apple versions of the&n; *  Broadcom chipset...&n; *&n; *  The contents of this file are subject to the Open&n; *  Software License version 1.1 that can be found at&n; *  http://www.opensource.org/licenses/osl-1.1.txt and is included herein&n; *  by reference.&n; *&n; *  Alternatively, the contents of this file may be used under the terms&n; *  of the GNU General Public License version 2 (the &quot;GPL&quot;) as distributed&n; *  in the kernel source COPYING file, in which case the provisions of&n; *  the GPL are applicable instead of the above.  If you wish to allow&n; *  the use of your version of this file only under the terms of the&n; *  GPL and not to allow others to use your version of this file under&n; *  the OSL, indicate your decision by deleting the provisions above and&n; *  replace them with the notice and other provisions required by the GPL.&n; *  If you do not delete the provisions above, a recipient may use your&n; *  version of this file under either the OSL or the GPL.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &quot;scsi.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &lt;linux/libata.h&gt;
macro_line|#ifdef CONFIG_ALL_PPC
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#endif /* CONFIG_ALL_PPC */
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;sata_svw&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.03&quot;
DECL|function|k2_sata_scr_read
r_static
id|u32
id|k2_sata_scr_read
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_int
r_int
id|sc_reg
)paren
(brace
r_if
c_cond
(paren
id|sc_reg
OG
id|SCR_CONTROL
)paren
r_return
l_int|0xffffffffU
suffix:semicolon
r_return
id|readl
c_func
(paren
(paren
r_void
op_star
)paren
id|ap-&gt;ioaddr.scr_addr
op_plus
(paren
id|sc_reg
op_star
l_int|4
)paren
)paren
suffix:semicolon
)brace
DECL|function|k2_sata_scr_write
r_static
r_void
id|k2_sata_scr_write
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_int
r_int
id|sc_reg
comma
id|u32
id|val
)paren
(brace
r_if
c_cond
(paren
id|sc_reg
OG
id|SCR_CONTROL
)paren
r_return
suffix:semicolon
id|writel
c_func
(paren
id|val
comma
(paren
r_void
op_star
)paren
id|ap-&gt;ioaddr.scr_addr
op_plus
(paren
id|sc_reg
op_star
l_int|4
)paren
)paren
suffix:semicolon
)brace
DECL|function|k2_sata_tf_load
r_static
r_void
id|k2_sata_tf_load
c_func
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_struct
id|ata_taskfile
op_star
id|tf
)paren
(brace
r_struct
id|ata_ioports
op_star
id|ioaddr
op_assign
op_amp
id|ap-&gt;ioaddr
suffix:semicolon
r_int
r_int
id|is_addr
op_assign
id|tf-&gt;flags
op_amp
id|ATA_TFLAG_ISADDR
suffix:semicolon
r_if
c_cond
(paren
id|tf-&gt;ctl
op_ne
id|ap-&gt;last_ctl
)paren
(brace
id|writeb
c_func
(paren
id|tf-&gt;ctl
comma
id|ioaddr-&gt;ctl_addr
)paren
suffix:semicolon
id|ap-&gt;last_ctl
op_assign
id|tf-&gt;ctl
suffix:semicolon
id|ata_wait_idle
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is_addr
op_logical_and
(paren
id|tf-&gt;flags
op_amp
id|ATA_TFLAG_LBA48
)paren
)paren
(brace
id|writew
c_func
(paren
id|tf-&gt;feature
op_or
(paren
(paren
(paren
id|u16
)paren
id|tf-&gt;hob_feature
)paren
op_lshift
l_int|8
)paren
comma
id|ioaddr-&gt;error_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;nsect
op_or
(paren
(paren
(paren
id|u16
)paren
id|tf-&gt;hob_nsect
)paren
op_lshift
l_int|8
)paren
comma
id|ioaddr-&gt;nsect_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbal
op_or
(paren
(paren
(paren
id|u16
)paren
id|tf-&gt;hob_lbal
)paren
op_lshift
l_int|8
)paren
comma
id|ioaddr-&gt;lbal_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbam
op_or
(paren
(paren
(paren
id|u16
)paren
id|tf-&gt;hob_lbam
)paren
op_lshift
l_int|8
)paren
comma
id|ioaddr-&gt;lbam_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbah
op_or
(paren
(paren
(paren
id|u16
)paren
id|tf-&gt;hob_lbah
)paren
op_lshift
l_int|8
)paren
comma
id|ioaddr-&gt;lbah_addr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|is_addr
)paren
(brace
id|writew
c_func
(paren
id|tf-&gt;feature
comma
id|ioaddr-&gt;error_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;nsect
comma
id|ioaddr-&gt;nsect_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbal
comma
id|ioaddr-&gt;lbal_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbam
comma
id|ioaddr-&gt;lbam_addr
)paren
suffix:semicolon
id|writew
c_func
(paren
id|tf-&gt;lbah
comma
id|ioaddr-&gt;lbah_addr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tf-&gt;flags
op_amp
id|ATA_TFLAG_DEVICE
)paren
id|writeb
c_func
(paren
id|tf-&gt;device
comma
id|ioaddr-&gt;device_addr
)paren
suffix:semicolon
id|ata_wait_idle
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
DECL|function|k2_sata_tf_read
r_static
r_void
id|k2_sata_tf_read
c_func
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_struct
id|ata_taskfile
op_star
id|tf
)paren
(brace
r_struct
id|ata_ioports
op_star
id|ioaddr
op_assign
op_amp
id|ap-&gt;ioaddr
suffix:semicolon
id|u16
id|nsect
comma
id|lbal
comma
id|lbam
comma
id|lbah
suffix:semicolon
id|nsect
op_assign
id|tf-&gt;nsect
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;nsect_addr
)paren
suffix:semicolon
id|lbal
op_assign
id|tf-&gt;lbal
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;lbal_addr
)paren
suffix:semicolon
id|lbam
op_assign
id|tf-&gt;lbam
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;lbam_addr
)paren
suffix:semicolon
id|lbah
op_assign
id|tf-&gt;lbah
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;lbah_addr
)paren
suffix:semicolon
id|tf-&gt;device
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;device_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tf-&gt;flags
op_amp
id|ATA_TFLAG_LBA48
)paren
(brace
id|tf-&gt;hob_feature
op_assign
id|readw
c_func
(paren
id|ioaddr-&gt;error_addr
)paren
op_rshift
l_int|8
suffix:semicolon
id|tf-&gt;hob_nsect
op_assign
id|nsect
op_rshift
l_int|8
suffix:semicolon
id|tf-&gt;hob_lbal
op_assign
id|lbal
op_rshift
l_int|8
suffix:semicolon
id|tf-&gt;hob_lbam
op_assign
id|lbam
op_rshift
l_int|8
suffix:semicolon
id|tf-&gt;hob_lbah
op_assign
id|lbah
op_rshift
l_int|8
suffix:semicolon
)brace
)brace
DECL|function|k2_stat_check_status
r_static
id|u8
id|k2_stat_check_status
c_func
(paren
r_struct
id|ata_port
op_star
id|ap
)paren
(brace
r_return
id|readl
c_func
(paren
(paren
r_void
op_star
)paren
id|ap-&gt;ioaddr.cmdstat_addr
)paren
suffix:semicolon
)brace
DECL|function|k2_sata_set_piomode
r_static
r_void
id|k2_sata_set_piomode
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_struct
id|ata_device
op_star
id|adev
comma
r_int
r_int
id|pio
)paren
(brace
multiline_comment|/* We need empty implementation, the core doesn&squot;t test for NULL&n;&t; * function pointer&n;&t; */
)brace
DECL|function|k2_sata_set_udmamode
r_static
r_void
id|k2_sata_set_udmamode
(paren
r_struct
id|ata_port
op_star
id|ap
comma
r_struct
id|ata_device
op_star
id|adev
comma
r_int
r_int
id|udma
)paren
(brace
multiline_comment|/* We need empty implementation, the core doesn&squot;t test for NULL&n;&t; * function pointer&n;&t; */
)brace
macro_line|#ifdef CONFIG_ALL_PPC
multiline_comment|/*&n; * k2_sata_proc_info&n; * inout : decides on the direction of the dataflow and the meaning of the&n; *&t;   variables&n; * buffer: If inout==FALSE data is being written to it else read from it&n; * *start: If inout==FALSE start of the valid data in the buffer&n; * offset: If inout==FALSE offset from the beginning of the imaginary file&n; *&t;   from which we start writing into the buffer&n; * length: If inout==FALSE max number of bytes to be written into the buffer&n; *&t;   else number of bytes in the buffer&n; */
DECL|function|k2_sata_proc_info
r_static
r_int
id|k2_sata_proc_info
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|count
comma
r_int
id|hostno
comma
r_int
id|inout
)paren
(brace
r_struct
id|Scsi_Host
op_star
id|hpnt
suffix:semicolon
r_struct
id|ata_port
op_star
id|ap
suffix:semicolon
r_struct
id|device_node
op_star
id|np
suffix:semicolon
r_int
id|len
comma
id|index
suffix:semicolon
multiline_comment|/* Find ourself. That&squot;s locking-broken, shitty etc... but thanks to&n;&t; * /proc/scsi interface and lack of state kept around in this driver,&n;&t; * its best I want to do for now...&n;&t; */
id|hpnt
op_assign
id|scsi_hostlist
suffix:semicolon
r_while
c_loop
(paren
id|hpnt
)paren
(brace
r_if
c_cond
(paren
id|hostno
op_eq
id|hpnt-&gt;host_no
)paren
r_break
suffix:semicolon
id|hpnt
op_assign
id|hpnt-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|hpnt
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Find  the ata_port */
id|ap
op_assign
(paren
r_struct
id|ata_port
op_star
)paren
op_amp
id|hpnt-&gt;hostdata
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ap
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Find the OF node for the PCI device proper */
id|np
op_assign
id|pci_device_to_OF_node
c_func
(paren
id|ap-&gt;host_set-&gt;pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Match it to a port node */
id|index
op_assign
(paren
id|ap
op_eq
id|ap-&gt;host_set-&gt;ports
(braket
l_int|0
)braket
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|np
op_assign
id|np-&gt;child
suffix:semicolon
id|np
op_ne
l_int|NULL
suffix:semicolon
id|np
op_assign
id|np-&gt;sibling
)paren
(brace
id|u32
op_star
id|reg
op_assign
(paren
id|u32
op_star
)paren
id|get_property
c_func
(paren
id|np
comma
l_string|&quot;reg&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|reg
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
op_star
id|reg
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;devspec: %s&bslash;n&quot;
comma
id|np-&gt;full_name
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ALL_PPC */
DECL|variable|k2_sata_sht
r_static
id|Scsi_Host_Template
id|k2_sata_sht
op_assign
(brace
dot
id|module
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
id|DRV_NAME
comma
dot
id|queuecommand
op_assign
id|ata_scsi_queuecmd
comma
dot
id|eh_strategy_handler
op_assign
id|ata_scsi_error
comma
dot
id|can_queue
op_assign
id|ATA_DEF_QUEUE
comma
dot
id|this_id
op_assign
id|ATA_SHT_THIS_ID
comma
dot
id|sg_tablesize
op_assign
id|ATA_MAX_PRD
comma
dot
id|max_sectors
op_assign
id|ATA_MAX_SECTORS
comma
dot
id|cmd_per_lun
op_assign
id|ATA_SHT_CMD_PER_LUN
comma
dot
id|emulated
op_assign
id|ATA_SHT_EMULATED
comma
dot
id|use_clustering
op_assign
id|ATA_SHT_USE_CLUSTERING
comma
dot
id|proc_name
op_assign
id|DRV_NAME
comma
dot
id|dma_boundary
op_assign
id|ATA_DMA_BOUNDARY
comma
dot
id|slave_configure
op_assign
id|ata_scsi_slave_config
comma
macro_line|#ifdef CONFIG_ALL_PPC
dot
id|proc_info
op_assign
id|k2_sata_proc_info
macro_line|#endif
dot
id|bios_param
op_assign
id|ata_std_bios_param
comma
)brace
suffix:semicolon
DECL|variable|k2_sata_ops
r_static
r_struct
id|ata_port_operations
id|k2_sata_ops
op_assign
(brace
dot
id|port_disable
op_assign
id|ata_port_disable
comma
dot
id|set_piomode
op_assign
id|k2_sata_set_piomode
comma
dot
id|set_udmamode
op_assign
id|k2_sata_set_udmamode
comma
dot
id|tf_load
op_assign
id|k2_sata_tf_load
comma
dot
id|tf_read
op_assign
id|k2_sata_tf_read
comma
dot
id|check_status
op_assign
id|k2_stat_check_status
comma
dot
id|exec_command
op_assign
id|ata_exec_command_mmio
comma
dot
id|phy_reset
op_assign
id|sata_phy_reset
comma
dot
id|phy_config
op_assign
id|pata_phy_config
comma
multiline_comment|/* not a typo */
dot
id|bmdma_start
op_assign
id|ata_bmdma_start_mmio
comma
dot
id|fill_sg
op_assign
id|ata_fill_sg
comma
dot
id|eng_timeout
op_assign
id|ata_eng_timeout
comma
dot
id|irq_handler
op_assign
id|ata_interrupt
comma
dot
id|scr_read
op_assign
id|k2_sata_scr_read
comma
dot
id|scr_write
op_assign
id|k2_sata_scr_write
comma
dot
id|port_start
op_assign
id|ata_port_start
comma
dot
id|port_stop
op_assign
id|ata_port_stop
comma
)brace
suffix:semicolon
DECL|function|k2_sata_setup_port
r_static
r_void
id|k2_sata_setup_port
c_func
(paren
r_struct
id|ata_ioports
op_star
id|port
comma
r_int
r_int
id|base
)paren
(brace
id|port-&gt;cmd_addr
op_assign
id|base
suffix:semicolon
id|port-&gt;data_addr
op_assign
id|base
suffix:semicolon
id|port-&gt;error_addr
op_assign
id|base
op_plus
l_int|0x4
suffix:semicolon
id|port-&gt;nsect_addr
op_assign
id|base
op_plus
l_int|0x8
suffix:semicolon
id|port-&gt;lbal_addr
op_assign
id|base
op_plus
l_int|0xc
suffix:semicolon
id|port-&gt;lbam_addr
op_assign
id|base
op_plus
l_int|0x10
suffix:semicolon
id|port-&gt;lbah_addr
op_assign
id|base
op_plus
l_int|0x14
suffix:semicolon
id|port-&gt;device_addr
op_assign
id|base
op_plus
l_int|0x18
suffix:semicolon
id|port-&gt;cmdstat_addr
op_assign
id|base
op_plus
l_int|0x1c
suffix:semicolon
id|port-&gt;ctl_addr
op_assign
id|base
op_plus
l_int|0x20
suffix:semicolon
id|port-&gt;bmdma_addr
op_assign
id|base
op_plus
l_int|0x30
suffix:semicolon
id|port-&gt;scr_addr
op_assign
id|base
op_plus
l_int|0x40
suffix:semicolon
)brace
DECL|function|k2_sata_init_one
r_static
r_int
id|k2_sata_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|printed_version
suffix:semicolon
r_struct
id|ata_probe_ent
op_star
id|probe_ent
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
r_void
op_star
id|mmio_base
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
id|DRV_NAME
l_string|&quot; version &quot;
id|DRV_VERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If this driver happens to only be useful on Apple&squot;s K2, then&n;&t; * we should check that here as it has a normal Serverworks ID&n;&t; */
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out
suffix:semicolon
id|rc
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
id|ATA_DMA_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_regions
suffix:semicolon
id|probe_ent
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|probe_ent
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|probe_ent
op_eq
l_int|NULL
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_regions
suffix:semicolon
)brace
id|memset
c_func
(paren
id|probe_ent
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|probe_ent
)paren
)paren
suffix:semicolon
id|probe_ent-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|probe_ent-&gt;node
)paren
suffix:semicolon
id|mmio_base
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|5
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|5
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mmio_base
op_eq
l_int|NULL
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_ent
suffix:semicolon
)brace
id|base
op_assign
(paren
r_int
r_int
)paren
id|mmio_base
suffix:semicolon
multiline_comment|/*&n;&t; * Check for the &quot;disabled&quot; second function to avoid registering&n;&t; * useless interfaces on K2&n;&t; */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|mmio_base
op_plus
l_int|0x40
)paren
op_eq
l_int|0xffffffffUL
op_logical_and
id|readl
c_func
(paren
id|mmio_base
op_plus
l_int|0x140
)paren
op_eq
l_int|0xffffffffUL
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_unmap
suffix:semicolon
)brace
multiline_comment|/* Clear a magic bit in SCR1 according to Darwin, those help&n;&t; * some funky seagate drives (though so far, those were already&n;&t; * set by the firmware on the machines I had access to&n;&t; */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|mmio_base
op_plus
l_int|0x80
)paren
op_amp
op_complement
l_int|0x00040000
comma
id|mmio_base
op_plus
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Clear SATA error &amp; interrupts we don&squot;t use */
id|writel
c_func
(paren
l_int|0xffffffff
comma
id|mmio_base
op_plus
l_int|0x44
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio_base
op_plus
l_int|0x88
)paren
suffix:semicolon
id|probe_ent-&gt;sht
op_assign
op_amp
id|k2_sata_sht
suffix:semicolon
id|probe_ent-&gt;host_flags
op_assign
id|ATA_FLAG_SATA
op_or
id|ATA_FLAG_SATA_RESET
op_or
id|ATA_FLAG_NO_LEGACY
op_or
id|ATA_FLAG_MMIO
suffix:semicolon
id|probe_ent-&gt;port_ops
op_assign
op_amp
id|k2_sata_ops
suffix:semicolon
id|probe_ent-&gt;n_ports
op_assign
l_int|2
suffix:semicolon
id|probe_ent-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|probe_ent-&gt;irq_flags
op_assign
id|SA_SHIRQ
suffix:semicolon
id|probe_ent-&gt;mmio_base
op_assign
id|mmio_base
suffix:semicolon
multiline_comment|/*&n;&t; * We don&squot;t care much about the PIO/UDMA masks, but the core won&squot;t like us&n;&t; * if we don&squot;t fill these&n;&t; */
id|probe_ent-&gt;pio_mask
op_assign
l_int|0x1f
suffix:semicolon
id|probe_ent-&gt;udma_mask
op_assign
l_int|0x7f
suffix:semicolon
id|k2_sata_setup_port
c_func
(paren
op_amp
id|probe_ent-&gt;port
(braket
l_int|0
)braket
comma
id|base
)paren
suffix:semicolon
id|k2_sata_setup_port
c_func
(paren
op_amp
id|probe_ent-&gt;port
(braket
l_int|1
)braket
comma
id|base
op_plus
l_int|0x100
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* FIXME: check ata_device_add return value */
id|ata_device_add
c_func
(paren
id|probe_ent
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|probe_ent
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_unmap
suffix:colon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|base
)paren
suffix:semicolon
id|err_out_free_ent
suffix:colon
id|kfree
c_func
(paren
id|probe_ent
)paren
suffix:semicolon
id|err_out_regions
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|k2_sata_pci_tbl
r_static
r_struct
id|pci_device_id
id|k2_sata_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x1166
comma
l_int|0x0240
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
)brace
)brace
suffix:semicolon
DECL|variable|k2_sata_pci_driver
r_static
r_struct
id|pci_driver
id|k2_sata_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|DRV_NAME
comma
dot
id|id_table
op_assign
id|k2_sata_pci_tbl
comma
dot
id|probe
op_assign
id|k2_sata_init_one
comma
dot
id|remove
op_assign
id|ata_pci_remove_one
comma
)brace
suffix:semicolon
DECL|function|k2_sata_init
r_static
r_int
id|__init
id|k2_sata_init
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|k2_sata_pci_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|k2_sata_exit
r_static
r_void
id|__exit
id|k2_sata_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|k2_sata_pci_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Benjamin Herrenschmidt&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;low-level driver for K2 SATA controller&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|k2_sata_pci_tbl
)paren
suffix:semicolon
DECL|variable|k2_sata_init
id|module_init
c_func
(paren
id|k2_sata_init
)paren
suffix:semicolon
DECL|variable|k2_sata_exit
id|module_exit
c_func
(paren
id|k2_sata_exit
)paren
suffix:semicolon
eof
