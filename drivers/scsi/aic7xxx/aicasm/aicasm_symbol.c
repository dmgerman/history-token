multiline_comment|/*&n; * Aic7xxx SCSI host adapter firmware asssembler symbol table implementation&n; *&n; * Copyright (c) 1997 Justin T. Gibbs.&n; * Copyright (c) 2002 Adaptec Inc.&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; *&n; * $Id: //depot/aic7xxx/aic7xxx/aicasm/aicasm_symbol.c#23 $&n; *&n; * $FreeBSD$&n; */
macro_line|#include &lt;sys/types.h&gt;
macro_line|#ifdef __linux__
macro_line|#include &quot;aicdb.h&quot;
macro_line|#else
macro_line|#include &lt;db.h&gt;
macro_line|#endif
macro_line|#include &lt;fcntl.h&gt;
macro_line|#include &lt;inttypes.h&gt;
macro_line|#include &lt;regex.h&gt;
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;sysexits.h&gt;
macro_line|#include &quot;aicasm_symbol.h&quot;
macro_line|#include &quot;aicasm.h&quot;
DECL|variable|symtable
r_static
id|DB
op_star
id|symtable
suffix:semicolon
id|symbol_t
op_star
DECL|function|symbol_create
id|symbol_create
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|symbol_t
op_star
id|new_symbol
suffix:semicolon
id|new_symbol
op_assign
(paren
id|symbol_t
op_star
)paren
id|malloc
c_func
(paren
r_sizeof
(paren
id|symbol_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_symbol
op_eq
l_int|NULL
)paren
(brace
id|perror
c_func
(paren
l_string|&quot;Unable to create new symbol&quot;
)paren
suffix:semicolon
m_exit
(paren
id|EX_SOFTWARE
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|new_symbol
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|new_symbol
)paren
)paren
suffix:semicolon
id|new_symbol-&gt;name
op_assign
id|strdup
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_symbol-&gt;name
op_eq
l_int|NULL
)paren
id|stop
c_func
(paren
l_string|&quot;Unable to strdup symbol name&quot;
comma
id|EX_SOFTWARE
)paren
suffix:semicolon
id|new_symbol-&gt;type
op_assign
id|UNINITIALIZED
suffix:semicolon
r_return
(paren
id|new_symbol
)paren
suffix:semicolon
)brace
r_void
DECL|function|symbol_delete
id|symbol_delete
c_func
(paren
id|symbol_t
op_star
id|symbol
)paren
(brace
r_if
c_cond
(paren
id|symtable
op_ne
l_int|NULL
)paren
(brace
id|DBT
id|key
suffix:semicolon
id|key.data
op_assign
id|symbol-&gt;name
suffix:semicolon
id|key.size
op_assign
id|strlen
c_func
(paren
id|symbol-&gt;name
)paren
suffix:semicolon
id|symtable
op_member_access_from_pointer
id|del
c_func
(paren
id|symtable
comma
op_amp
id|key
comma
multiline_comment|/*flags*/
l_int|0
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|symbol-&gt;type
)paren
(brace
r_case
id|SCBLOC
suffix:colon
r_case
id|SRAMLOC
suffix:colon
r_case
id|REGISTER
suffix:colon
r_if
c_cond
(paren
id|symbol-&gt;info.rinfo
op_ne
l_int|NULL
)paren
id|free
c_func
(paren
id|symbol-&gt;info.rinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALIAS
suffix:colon
r_if
c_cond
(paren
id|symbol-&gt;info.ainfo
op_ne
l_int|NULL
)paren
id|free
c_func
(paren
id|symbol-&gt;info.ainfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MASK
suffix:colon
r_case
id|FIELD
suffix:colon
r_case
id|ENUM
suffix:colon
r_case
id|ENUM_ENTRY
suffix:colon
r_if
c_cond
(paren
id|symbol-&gt;info.finfo
op_ne
l_int|NULL
)paren
(brace
id|symlist_free
c_func
(paren
op_amp
id|symbol-&gt;info.finfo-&gt;symrefs
)paren
suffix:semicolon
id|free
c_func
(paren
id|symbol-&gt;info.finfo
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|DOWNLOAD_CONST
suffix:colon
r_case
id|CONST
suffix:colon
r_if
c_cond
(paren
id|symbol-&gt;info.cinfo
op_ne
l_int|NULL
)paren
id|free
c_func
(paren
id|symbol-&gt;info.cinfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LABEL
suffix:colon
r_if
c_cond
(paren
id|symbol-&gt;info.linfo
op_ne
l_int|NULL
)paren
id|free
c_func
(paren
id|symbol-&gt;info.linfo
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|UNINITIALIZED
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|free
c_func
(paren
id|symbol-&gt;name
)paren
suffix:semicolon
id|free
c_func
(paren
id|symbol
)paren
suffix:semicolon
)brace
r_void
DECL|function|symtable_open
id|symtable_open
c_func
(paren
)paren
(brace
id|symtable
op_assign
id|dbopen
c_func
(paren
multiline_comment|/*filename*/
l_int|NULL
comma
id|O_CREAT
op_or
id|O_NONBLOCK
op_or
id|O_RDWR
comma
multiline_comment|/*mode*/
l_int|0
comma
id|DB_HASH
comma
multiline_comment|/*openinfo*/
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|symtable
op_eq
l_int|NULL
)paren
(brace
id|perror
c_func
(paren
l_string|&quot;Symbol table creation failed&quot;
)paren
suffix:semicolon
m_exit
(paren
id|EX_SOFTWARE
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
)brace
r_void
DECL|function|symtable_close
id|symtable_close
c_func
(paren
)paren
(brace
r_if
c_cond
(paren
id|symtable
op_ne
l_int|NULL
)paren
(brace
id|DBT
id|key
suffix:semicolon
id|DBT
id|data
suffix:semicolon
r_while
c_loop
(paren
id|symtable
op_member_access_from_pointer
id|seq
c_func
(paren
id|symtable
comma
op_amp
id|key
comma
op_amp
id|data
comma
id|R_FIRST
)paren
op_eq
l_int|0
)paren
(brace
id|symbol_t
op_star
id|stored_ptr
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|stored_ptr
comma
id|data.data
comma
r_sizeof
(paren
id|stored_ptr
)paren
)paren
suffix:semicolon
id|symbol_delete
c_func
(paren
id|stored_ptr
)paren
suffix:semicolon
)brace
id|symtable
op_member_access_from_pointer
id|close
c_func
(paren
id|symtable
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * The semantics of get is to return an uninitialized symbol entry&n; * if a lookup fails.&n; */
id|symbol_t
op_star
DECL|function|symtable_get
id|symtable_get
c_func
(paren
r_char
op_star
id|name
)paren
(brace
id|symbol_t
op_star
id|stored_ptr
suffix:semicolon
id|DBT
id|key
suffix:semicolon
id|DBT
id|data
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|key.data
op_assign
(paren
r_void
op_star
)paren
id|name
suffix:semicolon
id|key.size
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|symtable
op_member_access_from_pointer
id|get
c_func
(paren
id|symtable
comma
op_amp
id|key
comma
op_amp
id|data
comma
multiline_comment|/*flags*/
l_int|0
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|retval
op_eq
op_minus
l_int|1
)paren
(brace
id|perror
c_func
(paren
l_string|&quot;Symbol table get operation failed&quot;
)paren
suffix:semicolon
m_exit
(paren
id|EX_SOFTWARE
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
r_else
r_if
c_cond
(paren
id|retval
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Symbol wasn&squot;t found, so create a new one */
id|symbol_t
op_star
id|new_symbol
suffix:semicolon
id|new_symbol
op_assign
id|symbol_create
c_func
(paren
id|name
)paren
suffix:semicolon
id|data.data
op_assign
op_amp
id|new_symbol
suffix:semicolon
id|data.size
op_assign
r_sizeof
(paren
id|new_symbol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|symtable
op_member_access_from_pointer
id|put
c_func
(paren
id|symtable
comma
op_amp
id|key
comma
op_amp
id|data
comma
multiline_comment|/*flags*/
l_int|0
)paren
op_ne
l_int|0
)paren
(brace
id|perror
c_func
(paren
l_string|&quot;Symtable put failed&quot;
)paren
suffix:semicolon
m_exit
(paren
id|EX_SOFTWARE
)paren
suffix:semicolon
)brace
r_return
(paren
id|new_symbol
)paren
suffix:semicolon
)brace
r_else
(brace
id|perror
c_func
(paren
l_string|&quot;Unexpected return value from db get routine&quot;
)paren
suffix:semicolon
m_exit
(paren
id|EX_SOFTWARE
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
)brace
id|memcpy
c_func
(paren
op_amp
id|stored_ptr
comma
id|data.data
comma
r_sizeof
(paren
id|stored_ptr
)paren
)paren
suffix:semicolon
r_return
(paren
id|stored_ptr
)paren
suffix:semicolon
)brace
id|symbol_node_t
op_star
DECL|function|symlist_search
id|symlist_search
c_func
(paren
id|symlist_t
op_star
id|symlist
comma
r_char
op_star
id|symname
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
id|symlist
)paren
suffix:semicolon
r_while
c_loop
(paren
id|curnode
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|symname
comma
id|curnode-&gt;symbol-&gt;name
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|curnode
op_assign
id|SLIST_NEXT
c_func
(paren
id|curnode
comma
id|links
)paren
suffix:semicolon
)brace
r_return
(paren
id|curnode
)paren
suffix:semicolon
)brace
r_void
DECL|function|symlist_add
id|symlist_add
c_func
(paren
id|symlist_t
op_star
id|symlist
comma
id|symbol_t
op_star
id|symbol
comma
r_int
id|how
)paren
(brace
id|symbol_node_t
op_star
id|newnode
suffix:semicolon
id|newnode
op_assign
(paren
id|symbol_node_t
op_star
)paren
id|malloc
c_func
(paren
r_sizeof
(paren
id|symbol_node_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newnode
op_eq
l_int|NULL
)paren
(brace
id|stop
c_func
(paren
l_string|&quot;symlist_add: Unable to malloc symbol_node&quot;
comma
id|EX_SOFTWARE
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
id|newnode-&gt;symbol
op_assign
id|symbol
suffix:semicolon
r_if
c_cond
(paren
id|how
op_eq
id|SYMLIST_SORT
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
r_int
id|field
suffix:semicolon
id|field
op_assign
id|FALSE
suffix:semicolon
r_switch
c_cond
(paren
id|symbol-&gt;type
)paren
(brace
r_case
id|REGISTER
suffix:colon
r_case
id|SCBLOC
suffix:colon
r_case
id|SRAMLOC
suffix:colon
r_break
suffix:semicolon
r_case
id|FIELD
suffix:colon
r_case
id|MASK
suffix:colon
r_case
id|ENUM
suffix:colon
r_case
id|ENUM_ENTRY
suffix:colon
id|field
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|stop
c_func
(paren
l_string|&quot;symlist_add: Invalid symbol type for sorting&quot;
comma
id|EX_SOFTWARE
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
id|symlist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curnode
op_eq
l_int|NULL
op_logical_or
(paren
id|field
op_logical_and
(paren
id|curnode-&gt;symbol-&gt;type
OG
id|newnode-&gt;symbol-&gt;type
op_logical_or
(paren
id|curnode-&gt;symbol-&gt;type
op_eq
id|newnode-&gt;symbol-&gt;type
op_logical_and
(paren
id|curnode-&gt;symbol-&gt;info.finfo-&gt;value
OG
id|newnode-&gt;symbol-&gt;info.finfo-&gt;value
)paren
)paren
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|field
op_logical_and
(paren
id|curnode-&gt;symbol-&gt;info.rinfo-&gt;address
OG
id|newnode-&gt;symbol-&gt;info.rinfo-&gt;address
)paren
)paren
)paren
(brace
id|SLIST_INSERT_HEAD
c_func
(paren
id|symlist
comma
id|newnode
comma
id|links
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|SLIST_NEXT
c_func
(paren
id|curnode
comma
id|links
)paren
op_eq
l_int|NULL
)paren
(brace
id|SLIST_INSERT_AFTER
c_func
(paren
id|curnode
comma
id|newnode
comma
id|links
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|symbol_t
op_star
id|cursymbol
suffix:semicolon
id|cursymbol
op_assign
id|SLIST_NEXT
c_func
(paren
id|curnode
comma
id|links
)paren
op_member_access_from_pointer
id|symbol
suffix:semicolon
r_if
c_cond
(paren
(paren
id|field
op_logical_and
(paren
id|cursymbol-&gt;type
OG
id|symbol-&gt;type
op_logical_or
(paren
id|cursymbol-&gt;type
op_eq
id|symbol-&gt;type
op_logical_and
(paren
id|cursymbol-&gt;info.finfo-&gt;value
OG
id|symbol-&gt;info.finfo-&gt;value
)paren
)paren
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|field
op_logical_and
(paren
id|cursymbol-&gt;info.rinfo-&gt;address
OG
id|symbol-&gt;info.rinfo-&gt;address
)paren
)paren
)paren
(brace
id|SLIST_INSERT_AFTER
c_func
(paren
id|curnode
comma
id|newnode
comma
id|links
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|curnode
op_assign
id|SLIST_NEXT
c_func
(paren
id|curnode
comma
id|links
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|SLIST_INSERT_HEAD
c_func
(paren
id|symlist
comma
id|newnode
comma
id|links
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|symlist_free
id|symlist_free
c_func
(paren
id|symlist_t
op_star
id|symlist
)paren
(brace
id|symbol_node_t
op_star
id|node1
comma
op_star
id|node2
suffix:semicolon
id|node1
op_assign
id|SLIST_FIRST
c_func
(paren
id|symlist
)paren
suffix:semicolon
r_while
c_loop
(paren
id|node1
op_ne
l_int|NULL
)paren
(brace
id|node2
op_assign
id|SLIST_NEXT
c_func
(paren
id|node1
comma
id|links
)paren
suffix:semicolon
id|free
c_func
(paren
id|node1
)paren
suffix:semicolon
id|node1
op_assign
id|node2
suffix:semicolon
)brace
id|SLIST_INIT
c_func
(paren
id|symlist
)paren
suffix:semicolon
)brace
r_void
DECL|function|symlist_merge
id|symlist_merge
c_func
(paren
id|symlist_t
op_star
id|symlist_dest
comma
id|symlist_t
op_star
id|symlist_src1
comma
id|symlist_t
op_star
id|symlist_src2
)paren
(brace
id|symbol_node_t
op_star
id|node
suffix:semicolon
op_star
id|symlist_dest
op_assign
op_star
id|symlist_src1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|node
op_assign
id|SLIST_FIRST
c_func
(paren
id|symlist_src2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|SLIST_REMOVE_HEAD
c_func
(paren
id|symlist_src2
comma
id|links
)paren
suffix:semicolon
id|SLIST_INSERT_HEAD
c_func
(paren
id|symlist_dest
comma
id|node
comma
id|links
)paren
suffix:semicolon
)brace
multiline_comment|/* These are now empty */
id|SLIST_INIT
c_func
(paren
id|symlist_src1
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
id|symlist_src2
)paren
suffix:semicolon
)brace
r_void
DECL|function|aic_print_file_prologue
id|aic_print_file_prologue
c_func
(paren
id|FILE
op_star
id|ofile
)paren
(brace
r_if
c_cond
(paren
id|ofile
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;/*&bslash;n&quot;
l_string|&quot; * DO NOT EDIT - This file is automatically generated&bslash;n&quot;
l_string|&quot; *&t;&t; from the following source files:&bslash;n&quot;
l_string|&quot; *&bslash;n&quot;
l_string|&quot;%s */&bslash;n&quot;
comma
id|versions
)paren
suffix:semicolon
)brace
r_void
DECL|function|aic_print_include
id|aic_print_include
c_func
(paren
id|FILE
op_star
id|dfile
comma
r_char
op_star
id|include_file
)paren
(brace
r_if
c_cond
(paren
id|dfile
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;&bslash;n#include &bslash;&quot;%s&bslash;&quot;&bslash;n&bslash;n&quot;
comma
id|include_file
)paren
suffix:semicolon
)brace
r_void
DECL|function|aic_print_reg_dump_types
id|aic_print_reg_dump_types
c_func
(paren
id|FILE
op_star
id|ofile
)paren
(brace
r_if
c_cond
(paren
id|ofile
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;typedef int (%sreg_print_t)(u_int, u_int *, u_int);&bslash;n&quot;
l_string|&quot;typedef struct %sreg_parse_entry {&bslash;n&quot;
l_string|&quot;&t;char&t;*name;&bslash;n&quot;
l_string|&quot;&t;uint8_t&t; value;&bslash;n&quot;
l_string|&quot;&t;uint8_t&t; mask;&bslash;n&quot;
l_string|&quot;} %sreg_parse_entry_t;&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
comma
id|prefix
comma
id|prefix
comma
id|prefix
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|aic_print_reg_dump_start
id|aic_print_reg_dump_start
c_func
(paren
id|FILE
op_star
id|dfile
comma
id|symbol_node_t
op_star
id|regnode
)paren
(brace
r_if
c_cond
(paren
id|dfile
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;static %sreg_parse_entry_t %s_parse_table[] = {&bslash;n&quot;
comma
id|prefix
comma
id|regnode-&gt;symbol-&gt;name
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|aic_print_reg_dump_end
id|aic_print_reg_dump_end
c_func
(paren
id|FILE
op_star
id|ofile
comma
id|FILE
op_star
id|dfile
comma
id|symbol_node_t
op_star
id|regnode
comma
id|u_int
id|num_entries
)paren
(brace
r_char
op_star
id|lower_name
suffix:semicolon
r_char
op_star
id|letter
suffix:semicolon
id|lower_name
op_assign
id|strdup
c_func
(paren
id|regnode-&gt;symbol-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lower_name
op_eq
l_int|NULL
)paren
id|stop
c_func
(paren
l_string|&quot;Unable to strdup symbol name&quot;
comma
id|EX_SOFTWARE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|letter
op_assign
id|lower_name
suffix:semicolon
op_star
id|letter
op_ne
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|letter
op_increment
)paren
op_star
id|letter
op_assign
id|tolower
c_func
(paren
op_star
id|letter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dfile
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|num_entries
op_ne
l_int|0
)paren
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;};&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;int&bslash;n&quot;
l_string|&quot;%s%s_print(u_int regvalue, u_int *cur_col, u_int wrap)&bslash;n&quot;
l_string|&quot;{&bslash;n&quot;
l_string|&quot;&t;return (%sprint_register(%s%s, %d, &bslash;&quot;%s&bslash;&quot;,&bslash;n&quot;
l_string|&quot;&t;    0x%02x, regvalue, cur_col, wrap));&bslash;n&quot;
l_string|&quot;}&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
comma
id|prefix
comma
id|lower_name
comma
id|prefix
comma
id|num_entries
op_ne
l_int|0
ques
c_cond
id|regnode-&gt;symbol-&gt;name
suffix:colon
l_string|&quot;NULL&quot;
comma
id|num_entries
op_ne
l_int|0
ques
c_cond
l_string|&quot;_parse_table&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|num_entries
comma
id|regnode-&gt;symbol-&gt;name
comma
id|regnode-&gt;symbol-&gt;info.rinfo-&gt;address
)paren
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#if AIC_DEBUG_REGISTERS&bslash;n&quot;
l_string|&quot;%sreg_print_t %s%s_print;&bslash;n&quot;
l_string|&quot;#else&bslash;n&quot;
l_string|&quot;#define %s%s_print(regvalue, cur_col, wrap) &bslash;&bslash;&bslash;n&quot;
l_string|&quot;    %sprint_register(NULL, 0, &bslash;&quot;%s&bslash;&quot;, 0x%02x, regvalue, cur_col, wrap)&bslash;n&quot;
l_string|&quot;#endif&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
comma
id|prefix
comma
id|prefix
comma
id|lower_name
comma
id|prefix
comma
id|lower_name
comma
id|prefix
comma
id|regnode-&gt;symbol-&gt;name
comma
id|regnode-&gt;symbol-&gt;info.rinfo-&gt;address
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|aic_print_reg_dump_entry
id|aic_print_reg_dump_entry
c_func
(paren
id|FILE
op_star
id|dfile
comma
id|symbol_node_t
op_star
id|curnode
)paren
(brace
r_int
id|num_tabs
suffix:semicolon
r_if
c_cond
(paren
id|dfile
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;&t;{ &bslash;&quot;%s&bslash;&quot;,&quot;
comma
id|curnode-&gt;symbol-&gt;name
)paren
suffix:semicolon
id|num_tabs
op_assign
l_int|3
op_minus
(paren
id|strlen
c_func
(paren
id|curnode-&gt;symbol-&gt;name
)paren
op_plus
l_int|5
)paren
op_div
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|num_tabs
op_decrement
OG
l_int|0
)paren
id|fputc
c_func
(paren
l_char|&squot;&bslash;t&squot;
comma
id|dfile
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|dfile
comma
l_string|&quot;0x%02x, 0x%02x }&quot;
comma
id|curnode-&gt;symbol-&gt;info.finfo-&gt;value
comma
id|curnode-&gt;symbol-&gt;info.finfo-&gt;mask
)paren
suffix:semicolon
)brace
r_void
DECL|function|symtable_dump
id|symtable_dump
c_func
(paren
id|FILE
op_star
id|ofile
comma
id|FILE
op_star
id|dfile
)paren
(brace
multiline_comment|/*&n;&t; * Sort the registers by address with a simple insertion sort.&n;&t; * Put bitmasks next to the first register that defines them.&n;&t; * Put constants at the end.&n;&t; */
id|symlist_t
id|registers
suffix:semicolon
id|symlist_t
id|masks
suffix:semicolon
id|symlist_t
id|constants
suffix:semicolon
id|symlist_t
id|download_constants
suffix:semicolon
id|symlist_t
id|aliases
suffix:semicolon
id|symlist_t
id|exported_labels
suffix:semicolon
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|symbol_node_t
op_star
id|regnode
suffix:semicolon
id|DBT
id|key
suffix:semicolon
id|DBT
id|data
suffix:semicolon
r_int
id|flag
suffix:semicolon
id|u_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|symtable
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|registers
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|masks
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|constants
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|download_constants
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|aliases
)paren
suffix:semicolon
id|SLIST_INIT
c_func
(paren
op_amp
id|exported_labels
)paren
suffix:semicolon
id|flag
op_assign
id|R_FIRST
suffix:semicolon
r_while
c_loop
(paren
id|symtable
op_member_access_from_pointer
id|seq
c_func
(paren
id|symtable
comma
op_amp
id|key
comma
op_amp
id|data
comma
id|flag
)paren
op_eq
l_int|0
)paren
(brace
id|symbol_t
op_star
id|cursym
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cursym
comma
id|data.data
comma
r_sizeof
(paren
id|cursym
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cursym-&gt;type
)paren
(brace
r_case
id|REGISTER
suffix:colon
r_case
id|SCBLOC
suffix:colon
r_case
id|SRAMLOC
suffix:colon
id|symlist_add
c_func
(paren
op_amp
id|registers
comma
id|cursym
comma
id|SYMLIST_SORT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MASK
suffix:colon
r_case
id|FIELD
suffix:colon
r_case
id|ENUM
suffix:colon
r_case
id|ENUM_ENTRY
suffix:colon
id|symlist_add
c_func
(paren
op_amp
id|masks
comma
id|cursym
comma
id|SYMLIST_SORT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CONST
suffix:colon
id|symlist_add
c_func
(paren
op_amp
id|constants
comma
id|cursym
comma
id|SYMLIST_INSERT_HEAD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOWNLOAD_CONST
suffix:colon
id|symlist_add
c_func
(paren
op_amp
id|download_constants
comma
id|cursym
comma
id|SYMLIST_INSERT_HEAD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALIAS
suffix:colon
id|symlist_add
c_func
(paren
op_amp
id|aliases
comma
id|cursym
comma
id|SYMLIST_INSERT_HEAD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LABEL
suffix:colon
r_if
c_cond
(paren
id|cursym-&gt;info.linfo-&gt;exported
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|symlist_add
c_func
(paren
op_amp
id|exported_labels
comma
id|cursym
comma
id|SYMLIST_INSERT_HEAD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|flag
op_assign
id|R_NEXT
suffix:semicolon
)brace
multiline_comment|/* Register dianostic functions/declarations first. */
id|aic_print_file_prologue
c_func
(paren
id|ofile
)paren
suffix:semicolon
id|aic_print_reg_dump_types
c_func
(paren
id|ofile
)paren
suffix:semicolon
id|aic_print_file_prologue
c_func
(paren
id|dfile
)paren
suffix:semicolon
id|aic_print_include
c_func
(paren
id|dfile
comma
id|stock_include_file
)paren
suffix:semicolon
id|SLIST_FOREACH
c_func
(paren
id|curnode
comma
op_amp
id|registers
comma
id|links
)paren
(brace
r_switch
c_cond
(paren
id|curnode-&gt;symbol-&gt;type
)paren
(brace
r_case
id|REGISTER
suffix:colon
r_case
id|SCBLOC
suffix:colon
r_case
id|SRAMLOC
suffix:colon
(brace
id|symlist_t
op_star
id|fields
suffix:semicolon
id|symbol_node_t
op_star
id|fieldnode
suffix:semicolon
r_int
id|num_entries
suffix:semicolon
id|num_entries
op_assign
l_int|0
suffix:semicolon
id|fields
op_assign
op_amp
id|curnode-&gt;symbol-&gt;info.rinfo-&gt;fields
suffix:semicolon
id|SLIST_FOREACH
c_func
(paren
id|fieldnode
comma
id|fields
comma
id|links
)paren
(brace
r_if
c_cond
(paren
id|num_entries
op_eq
l_int|0
)paren
id|aic_print_reg_dump_start
c_func
(paren
id|dfile
comma
id|curnode
)paren
suffix:semicolon
r_else
id|fputs
c_func
(paren
l_string|&quot;,&bslash;n&quot;
comma
id|dfile
)paren
suffix:semicolon
id|num_entries
op_increment
suffix:semicolon
id|aic_print_reg_dump_entry
c_func
(paren
id|dfile
comma
id|fieldnode
)paren
suffix:semicolon
)brace
id|aic_print_reg_dump_end
c_func
(paren
id|ofile
comma
id|dfile
comma
id|curnode
comma
id|num_entries
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Fold in the masks and bits */
r_while
c_loop
(paren
id|SLIST_FIRST
c_func
(paren
op_amp
id|masks
)paren
op_ne
l_int|NULL
)paren
(brace
r_char
op_star
id|regname
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|masks
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|masks
comma
id|links
)paren
suffix:semicolon
id|regnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|curnode-&gt;symbol-&gt;info.finfo-&gt;symrefs
)paren
suffix:semicolon
id|regname
op_assign
id|regnode-&gt;symbol-&gt;name
suffix:semicolon
id|regnode
op_assign
id|symlist_search
c_func
(paren
op_amp
id|registers
comma
id|regname
)paren
suffix:semicolon
id|SLIST_INSERT_AFTER
c_func
(paren
id|regnode
comma
id|curnode
comma
id|links
)paren
suffix:semicolon
)brace
multiline_comment|/* Add the aliases */
r_while
c_loop
(paren
id|SLIST_FIRST
c_func
(paren
op_amp
id|aliases
)paren
op_ne
l_int|NULL
)paren
(brace
r_char
op_star
id|regname
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|aliases
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|aliases
comma
id|links
)paren
suffix:semicolon
id|regname
op_assign
id|curnode-&gt;symbol-&gt;info.ainfo-&gt;parent-&gt;name
suffix:semicolon
id|regnode
op_assign
id|symlist_search
c_func
(paren
op_amp
id|registers
comma
id|regname
)paren
suffix:semicolon
id|SLIST_INSERT_AFTER
c_func
(paren
id|regnode
comma
id|curnode
comma
id|links
)paren
suffix:semicolon
)brace
multiline_comment|/* Output generated #defines. */
r_while
c_loop
(paren
id|SLIST_FIRST
c_func
(paren
op_amp
id|registers
)paren
op_ne
l_int|NULL
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|u_int
id|value
suffix:semicolon
r_char
op_star
id|tab_str
suffix:semicolon
r_char
op_star
id|tab_str2
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|registers
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|registers
comma
id|links
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|curnode-&gt;symbol-&gt;type
)paren
(brace
r_case
id|REGISTER
suffix:colon
r_case
id|SCBLOC
suffix:colon
r_case
id|SRAMLOC
suffix:colon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|value
op_assign
id|curnode-&gt;symbol-&gt;info.rinfo-&gt;address
suffix:semicolon
id|tab_str
op_assign
l_string|&quot;&bslash;t&quot;
suffix:semicolon
id|tab_str2
op_assign
l_string|&quot;&bslash;t&bslash;t&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALIAS
suffix:colon
(brace
id|symbol_t
op_star
id|parent
suffix:semicolon
id|parent
op_assign
id|curnode-&gt;symbol-&gt;info.ainfo-&gt;parent
suffix:semicolon
id|value
op_assign
id|parent-&gt;info.rinfo-&gt;address
suffix:semicolon
id|tab_str
op_assign
l_string|&quot;&bslash;t&quot;
suffix:semicolon
id|tab_str2
op_assign
l_string|&quot;&bslash;t&bslash;t&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MASK
suffix:colon
r_case
id|FIELD
suffix:colon
r_case
id|ENUM
suffix:colon
r_case
id|ENUM_ENTRY
suffix:colon
id|value
op_assign
id|curnode-&gt;symbol-&gt;info.finfo-&gt;value
suffix:semicolon
id|tab_str
op_assign
l_string|&quot;&bslash;t&bslash;t&quot;
suffix:semicolon
id|tab_str2
op_assign
l_string|&quot;&bslash;t&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|value
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Quiet compiler */
id|tab_str
op_assign
l_int|NULL
suffix:semicolon
id|tab_str2
op_assign
l_int|NULL
suffix:semicolon
id|stop
c_func
(paren
l_string|&quot;symtable_dump: Invalid symbol type &quot;
l_string|&quot;encountered&quot;
comma
id|EX_SOFTWARE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#define%s%-16s%s0x%02x&bslash;n&quot;
comma
id|tab_str
comma
id|curnode-&gt;symbol-&gt;name
comma
id|tab_str2
comma
id|value
)paren
suffix:semicolon
id|free
c_func
(paren
id|curnode
)paren
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|SLIST_FIRST
c_func
(paren
op_amp
id|constants
)paren
op_ne
l_int|NULL
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|constants
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|constants
comma
id|links
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#define&bslash;t%-8s&bslash;t0x%02x&bslash;n&quot;
comma
id|curnode-&gt;symbol-&gt;name
comma
id|curnode-&gt;symbol-&gt;info.cinfo-&gt;value
)paren
suffix:semicolon
id|free
c_func
(paren
id|curnode
)paren
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;&bslash;n&bslash;n/* Downloaded Constant Definitions */&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|SLIST_FIRST
c_func
(paren
op_amp
id|download_constants
)paren
op_ne
l_int|NULL
suffix:semicolon
id|i
op_increment
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|download_constants
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|download_constants
comma
id|links
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#define&bslash;t%-8s&bslash;t0x%02x&bslash;n&quot;
comma
id|curnode-&gt;symbol-&gt;name
comma
id|curnode-&gt;symbol-&gt;info.cinfo-&gt;value
)paren
suffix:semicolon
id|free
c_func
(paren
id|curnode
)paren
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#define&bslash;tDOWNLOAD_CONST_COUNT&bslash;t0x%02x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;&bslash;n&bslash;n/* Exported Labels */&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|SLIST_FIRST
c_func
(paren
op_amp
id|exported_labels
)paren
op_ne
l_int|NULL
)paren
(brace
id|symbol_node_t
op_star
id|curnode
suffix:semicolon
id|curnode
op_assign
id|SLIST_FIRST
c_func
(paren
op_amp
id|exported_labels
)paren
suffix:semicolon
id|SLIST_REMOVE_HEAD
c_func
(paren
op_amp
id|exported_labels
comma
id|links
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|ofile
comma
l_string|&quot;#define&bslash;tLABEL_%-8s&bslash;t0x%02x&bslash;n&quot;
comma
id|curnode-&gt;symbol-&gt;name
comma
id|curnode-&gt;symbol-&gt;info.linfo-&gt;address
)paren
suffix:semicolon
id|free
c_func
(paren
id|curnode
)paren
suffix:semicolon
)brace
)brace
eof
