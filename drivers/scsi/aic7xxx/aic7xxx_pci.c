multiline_comment|/*&n; * Product specific probe and attach routines for:&n; *      3940, 2940, aic7895, aic7890, aic7880,&n; *&t;aic7870, aic7860 and aic7850 SCSI controllers&n; *&n; * Copyright (c) 1994-2001 Justin T. Gibbs.&n; * Copyright (c) 2000-2001 Adaptec Inc.&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; *&n; * $Id: //depot/aic7xxx/aic7xxx/aic7xxx_pci.c#57 $&n; *&n; * $FreeBSD$&n; */
macro_line|#ifdef __linux__
macro_line|#include &quot;aic7xxx_osm.h&quot;
macro_line|#include &quot;aic7xxx_inline.h&quot;
macro_line|#include &quot;aic7xxx_93cx6.h&quot;
macro_line|#else
macro_line|#include &lt;dev/aic7xxx/aic7xxx_osm.h&gt;
macro_line|#include &lt;dev/aic7xxx/aic7xxx_inline.h&gt;
macro_line|#include &lt;dev/aic7xxx/aic7xxx_93cx6.h&gt;
macro_line|#endif
DECL|macro|AHC_PCI_IOADDR
mdefine_line|#define AHC_PCI_IOADDR&t;PCIR_MAPS&t;/* I/O Address */
DECL|macro|AHC_PCI_MEMADDR
mdefine_line|#define AHC_PCI_MEMADDR&t;(PCIR_MAPS + 4)&t;/* Mem I/O Address */
r_static
id|__inline
r_uint64
DECL|function|ahc_compose_id
id|ahc_compose_id
c_func
(paren
id|u_int
id|device
comma
id|u_int
id|vendor
comma
id|u_int
id|subdevice
comma
id|u_int
id|subvendor
)paren
(brace
r_uint64
id|id
suffix:semicolon
id|id
op_assign
id|subvendor
op_or
(paren
id|subdevice
op_lshift
l_int|16
)paren
op_or
(paren
(paren
r_uint64
)paren
id|vendor
op_lshift
l_int|32
)paren
op_or
(paren
(paren
r_uint64
)paren
id|device
op_lshift
l_int|48
)paren
suffix:semicolon
r_return
(paren
id|id
)paren
suffix:semicolon
)brace
DECL|macro|ID_ALL_MASK
mdefine_line|#define ID_ALL_MASK&t;&t;&t;0xFFFFFFFFFFFFFFFFull
DECL|macro|ID_DEV_VENDOR_MASK
mdefine_line|#define ID_DEV_VENDOR_MASK&t;&t;0xFFFFFFFF00000000ull
DECL|macro|ID_9005_GENERIC_MASK
mdefine_line|#define ID_9005_GENERIC_MASK&t;&t;0xFFF0FFFF00000000ull
DECL|macro|ID_9005_SISL_MASK
mdefine_line|#define ID_9005_SISL_MASK&t;&t;0x000FFFFF00000000ull
DECL|macro|ID_9005_SISL_ID
mdefine_line|#define ID_9005_SISL_ID&t;&t;&t;0x0005900500000000ull
DECL|macro|ID_AIC7850
mdefine_line|#define ID_AIC7850&t;&t;&t;0x5078900400000000ull
DECL|macro|ID_AHA_2902_04_10_15_20_30C
mdefine_line|#define ID_AHA_2902_04_10_15_20_30C&t;0x5078900478509004ull
DECL|macro|ID_AIC7855
mdefine_line|#define ID_AIC7855&t;&t;&t;0x5578900400000000ull
DECL|macro|ID_AIC7859
mdefine_line|#define ID_AIC7859&t;&t;&t;0x3860900400000000ull
DECL|macro|ID_AHA_2930CU
mdefine_line|#define ID_AHA_2930CU&t;&t;&t;0x3860900438699004ull
DECL|macro|ID_AIC7860
mdefine_line|#define ID_AIC7860&t;&t;&t;0x6078900400000000ull
DECL|macro|ID_AIC7860C
mdefine_line|#define ID_AIC7860C&t;&t;&t;0x6078900478609004ull
DECL|macro|ID_AHA_1480A
mdefine_line|#define ID_AHA_1480A&t;&t;&t;0x6075900400000000ull
DECL|macro|ID_AHA_2940AU_0
mdefine_line|#define ID_AHA_2940AU_0&t;&t;&t;0x6178900400000000ull
DECL|macro|ID_AHA_2940AU_1
mdefine_line|#define ID_AHA_2940AU_1&t;&t;&t;0x6178900478619004ull
DECL|macro|ID_AHA_2940AU_CN
mdefine_line|#define ID_AHA_2940AU_CN&t;&t;0x2178900478219004ull
DECL|macro|ID_AHA_2930C_VAR
mdefine_line|#define ID_AHA_2930C_VAR&t;&t;0x6038900438689004ull
DECL|macro|ID_AIC7870
mdefine_line|#define ID_AIC7870&t;&t;&t;0x7078900400000000ull
DECL|macro|ID_AHA_2940
mdefine_line|#define ID_AHA_2940&t;&t;&t;0x7178900400000000ull
DECL|macro|ID_AHA_3940
mdefine_line|#define ID_AHA_3940&t;&t;&t;0x7278900400000000ull
DECL|macro|ID_AHA_398X
mdefine_line|#define ID_AHA_398X&t;&t;&t;0x7378900400000000ull
DECL|macro|ID_AHA_2944
mdefine_line|#define ID_AHA_2944&t;&t;&t;0x7478900400000000ull
DECL|macro|ID_AHA_3944
mdefine_line|#define ID_AHA_3944&t;&t;&t;0x7578900400000000ull
DECL|macro|ID_AHA_4944
mdefine_line|#define ID_AHA_4944&t;&t;&t;0x7678900400000000ull
DECL|macro|ID_AIC7880
mdefine_line|#define ID_AIC7880&t;&t;&t;0x8078900400000000ull
DECL|macro|ID_AIC7880_B
mdefine_line|#define ID_AIC7880_B&t;&t;&t;0x8078900478809004ull
DECL|macro|ID_AHA_2940U
mdefine_line|#define ID_AHA_2940U&t;&t;&t;0x8178900400000000ull
DECL|macro|ID_AHA_3940U
mdefine_line|#define ID_AHA_3940U&t;&t;&t;0x8278900400000000ull
DECL|macro|ID_AHA_2944U
mdefine_line|#define ID_AHA_2944U&t;&t;&t;0x8478900400000000ull
DECL|macro|ID_AHA_3944U
mdefine_line|#define ID_AHA_3944U&t;&t;&t;0x8578900400000000ull
DECL|macro|ID_AHA_398XU
mdefine_line|#define ID_AHA_398XU&t;&t;&t;0x8378900400000000ull
DECL|macro|ID_AHA_4944U
mdefine_line|#define ID_AHA_4944U&t;&t;&t;0x8678900400000000ull
DECL|macro|ID_AHA_2940UB
mdefine_line|#define ID_AHA_2940UB&t;&t;&t;0x8178900478819004ull
DECL|macro|ID_AHA_2930U
mdefine_line|#define ID_AHA_2930U&t;&t;&t;0x8878900478889004ull
DECL|macro|ID_AHA_2940U_PRO
mdefine_line|#define ID_AHA_2940U_PRO&t;&t;0x8778900478879004ull
DECL|macro|ID_AHA_2940U_CN
mdefine_line|#define ID_AHA_2940U_CN&t;&t;&t;0x0078900478009004ull
DECL|macro|ID_AIC7895
mdefine_line|#define ID_AIC7895&t;&t;&t;0x7895900478959004ull
DECL|macro|ID_AIC7895_ARO
mdefine_line|#define ID_AIC7895_ARO&t;&t;&t;0x7890900478939004ull
DECL|macro|ID_AIC7895_ARO_MASK
mdefine_line|#define ID_AIC7895_ARO_MASK&t;&t;0xFFF0FFFFFFFFFFFFull
DECL|macro|ID_AHA_2940U_DUAL
mdefine_line|#define ID_AHA_2940U_DUAL&t;&t;0x7895900478919004ull
DECL|macro|ID_AHA_3940AU
mdefine_line|#define ID_AHA_3940AU&t;&t;&t;0x7895900478929004ull
DECL|macro|ID_AHA_3944AU
mdefine_line|#define ID_AHA_3944AU&t;&t;&t;0x7895900478949004ull
DECL|macro|ID_AIC7890
mdefine_line|#define ID_AIC7890&t;&t;&t;0x001F9005000F9005ull
DECL|macro|ID_AIC7890_ARO
mdefine_line|#define ID_AIC7890_ARO&t;&t;&t;0x00139005000F9005ull
DECL|macro|ID_AAA_131U2
mdefine_line|#define ID_AAA_131U2&t;&t;&t;0x0013900500039005ull
DECL|macro|ID_AHA_2930U2
mdefine_line|#define ID_AHA_2930U2&t;&t;&t;0x0011900501819005ull
DECL|macro|ID_AHA_2940U2B
mdefine_line|#define ID_AHA_2940U2B&t;&t;&t;0x00109005A1009005ull
DECL|macro|ID_AHA_2940U2_OEM
mdefine_line|#define ID_AHA_2940U2_OEM&t;&t;0x0010900521809005ull
DECL|macro|ID_AHA_2940U2
mdefine_line|#define ID_AHA_2940U2&t;&t;&t;0x00109005A1809005ull
DECL|macro|ID_AHA_2950U2B
mdefine_line|#define ID_AHA_2950U2B&t;&t;&t;0x00109005E1009005ull
DECL|macro|ID_AIC7892
mdefine_line|#define ID_AIC7892&t;&t;&t;0x008F9005FFFF9005ull
DECL|macro|ID_AIC7892_ARO
mdefine_line|#define ID_AIC7892_ARO&t;&t;&t;0x00839005FFFF9005ull
DECL|macro|ID_AHA_29160
mdefine_line|#define ID_AHA_29160&t;&t;&t;0x00809005E2A09005ull
DECL|macro|ID_AHA_29160_CPQ
mdefine_line|#define ID_AHA_29160_CPQ&t;&t;0x00809005E2A00E11ull
DECL|macro|ID_AHA_29160N
mdefine_line|#define ID_AHA_29160N&t;&t;&t;0x0080900562A09005ull
DECL|macro|ID_AHA_29160C
mdefine_line|#define ID_AHA_29160C&t;&t;&t;0x0080900562209005ull
DECL|macro|ID_AHA_29160B
mdefine_line|#define ID_AHA_29160B&t;&t;&t;0x00809005E2209005ull
DECL|macro|ID_AHA_19160B
mdefine_line|#define ID_AHA_19160B&t;&t;&t;0x0081900562A19005ull
DECL|macro|ID_AIC7896
mdefine_line|#define ID_AIC7896&t;&t;&t;0x005F9005FFFF9005ull
DECL|macro|ID_AIC7896_ARO
mdefine_line|#define ID_AIC7896_ARO&t;&t;&t;0x00539005FFFF9005ull
DECL|macro|ID_AHA_3950U2B_0
mdefine_line|#define ID_AHA_3950U2B_0&t;&t;0x00509005FFFF9005ull
DECL|macro|ID_AHA_3950U2B_1
mdefine_line|#define ID_AHA_3950U2B_1&t;&t;0x00509005F5009005ull
DECL|macro|ID_AHA_3950U2D_0
mdefine_line|#define ID_AHA_3950U2D_0&t;&t;0x00519005FFFF9005ull
DECL|macro|ID_AHA_3950U2D_1
mdefine_line|#define ID_AHA_3950U2D_1&t;&t;0x00519005B5009005ull
DECL|macro|ID_AIC7899
mdefine_line|#define ID_AIC7899&t;&t;&t;0x00CF9005FFFF9005ull
DECL|macro|ID_AIC7899_ARO
mdefine_line|#define ID_AIC7899_ARO&t;&t;&t;0x00C39005FFFF9005ull
DECL|macro|ID_AHA_3960D
mdefine_line|#define ID_AHA_3960D&t;&t;&t;0x00C09005F6209005ull
DECL|macro|ID_AHA_3960D_CPQ
mdefine_line|#define ID_AHA_3960D_CPQ&t;&t;0x00C09005F6200E11ull
DECL|macro|ID_AIC7810
mdefine_line|#define ID_AIC7810&t;&t;&t;0x1078900400000000ull
DECL|macro|ID_AIC7815
mdefine_line|#define ID_AIC7815&t;&t;&t;0x7815900400000000ull
DECL|macro|DEVID_9005_TYPE
mdefine_line|#define DEVID_9005_TYPE(id) ((id) &amp; 0xF)
DECL|macro|DEVID_9005_TYPE_HBA
mdefine_line|#define&t;&t;DEVID_9005_TYPE_HBA&t;&t;0x0&t;/* Standard Card */
DECL|macro|DEVID_9005_TYPE_AAA
mdefine_line|#define&t;&t;DEVID_9005_TYPE_AAA&t;&t;0x3&t;/* RAID Card */
DECL|macro|DEVID_9005_TYPE_SISL
mdefine_line|#define&t;&t;DEVID_9005_TYPE_SISL&t;&t;0x5&t;/* Container ROMB */
DECL|macro|DEVID_9005_TYPE_MB
mdefine_line|#define&t;&t;DEVID_9005_TYPE_MB&t;&t;0xF&t;/* On Motherboard */
DECL|macro|DEVID_9005_MAXRATE
mdefine_line|#define DEVID_9005_MAXRATE(id) (((id) &amp; 0x30) &gt;&gt; 4)
DECL|macro|DEVID_9005_MAXRATE_U160
mdefine_line|#define&t;&t;DEVID_9005_MAXRATE_U160&t;&t;0x0
DECL|macro|DEVID_9005_MAXRATE_ULTRA2
mdefine_line|#define&t;&t;DEVID_9005_MAXRATE_ULTRA2&t;0x1
DECL|macro|DEVID_9005_MAXRATE_ULTRA
mdefine_line|#define&t;&t;DEVID_9005_MAXRATE_ULTRA&t;0x2
DECL|macro|DEVID_9005_MAXRATE_FAST
mdefine_line|#define&t;&t;DEVID_9005_MAXRATE_FAST&t;&t;0x3
DECL|macro|DEVID_9005_MFUNC
mdefine_line|#define DEVID_9005_MFUNC(id) (((id) &amp; 0x40) &gt;&gt; 6)
DECL|macro|DEVID_9005_CLASS
mdefine_line|#define DEVID_9005_CLASS(id) (((id) &amp; 0xFF00) &gt;&gt; 8)
DECL|macro|DEVID_9005_CLASS_SPI
mdefine_line|#define&t;&t;DEVID_9005_CLASS_SPI&t;&t;0x0&t;/* Parallel SCSI */
DECL|macro|SUBID_9005_TYPE
mdefine_line|#define SUBID_9005_TYPE(id) ((id) &amp; 0xF)
DECL|macro|SUBID_9005_TYPE_MB
mdefine_line|#define&t;&t;SUBID_9005_TYPE_MB&t;&t;0xF&t;/* On Motherboard */
DECL|macro|SUBID_9005_TYPE_CARD
mdefine_line|#define&t;&t;SUBID_9005_TYPE_CARD&t;&t;0x0&t;/* Standard Card */
DECL|macro|SUBID_9005_TYPE_LCCARD
mdefine_line|#define&t;&t;SUBID_9005_TYPE_LCCARD&t;&t;0x1&t;/* Low Cost Card */
DECL|macro|SUBID_9005_TYPE_RAID
mdefine_line|#define&t;&t;SUBID_9005_TYPE_RAID&t;&t;0x3&t;/* Combined with Raid */
DECL|macro|SUBID_9005_TYPE_KNOWN
mdefine_line|#define SUBID_9005_TYPE_KNOWN(id)&t;&t;&t;&bslash;&n;&t;  ((((id) &amp; 0xF) == SUBID_9005_TYPE_MB)&t;&t;&bslash;&n;&t;|| (((id) &amp; 0xF) == SUBID_9005_TYPE_CARD)&t;&bslash;&n;&t;|| (((id) &amp; 0xF) == SUBID_9005_TYPE_LCCARD)&t;&bslash;&n;&t;|| (((id) &amp; 0xF) == SUBID_9005_TYPE_RAID))
DECL|macro|SUBID_9005_MAXRATE
mdefine_line|#define SUBID_9005_MAXRATE(id) (((id) &amp; 0x30) &gt;&gt; 4)
DECL|macro|SUBID_9005_MAXRATE_ULTRA2
mdefine_line|#define&t;&t;SUBID_9005_MAXRATE_ULTRA2&t;0x0
DECL|macro|SUBID_9005_MAXRATE_ULTRA
mdefine_line|#define&t;&t;SUBID_9005_MAXRATE_ULTRA&t;0x1
DECL|macro|SUBID_9005_MAXRATE_U160
mdefine_line|#define&t;&t;SUBID_9005_MAXRATE_U160&t;&t;0x2
DECL|macro|SUBID_9005_MAXRATE_RESERVED
mdefine_line|#define&t;&t;SUBID_9005_MAXRATE_RESERVED&t;0x3
DECL|macro|SUBID_9005_SEEPTYPE
mdefine_line|#define SUBID_9005_SEEPTYPE(id)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;((SUBID_9005_TYPE(id) == SUBID_9005_TYPE_MB)&t;&t;&t;&bslash;&n;&t; ? ((id) &amp; 0xC0) &gt;&gt; 6&t;&t;&t;&t;&t;&t;&bslash;&n;&t; : ((id) &amp; 0x300) &gt;&gt; 8)
DECL|macro|SUBID_9005_SEEPTYPE_NONE
mdefine_line|#define&t;&t;SUBID_9005_SEEPTYPE_NONE&t;0x0
DECL|macro|SUBID_9005_SEEPTYPE_1K
mdefine_line|#define&t;&t;SUBID_9005_SEEPTYPE_1K&t;&t;0x1
DECL|macro|SUBID_9005_SEEPTYPE_2K_4K
mdefine_line|#define&t;&t;SUBID_9005_SEEPTYPE_2K_4K&t;0x2
DECL|macro|SUBID_9005_SEEPTYPE_RESERVED
mdefine_line|#define&t;&t;SUBID_9005_SEEPTYPE_RESERVED&t;0x3
DECL|macro|SUBID_9005_AUTOTERM
mdefine_line|#define SUBID_9005_AUTOTERM(id)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;((SUBID_9005_TYPE(id) == SUBID_9005_TYPE_MB)&t;&t;&t;&bslash;&n;&t; ? (((id) &amp; 0x400) &gt;&gt; 10) == 0&t;&t;&t;&t;&t;&bslash;&n;&t; : (((id) &amp; 0x40) &gt;&gt; 6) == 0)
DECL|macro|SUBID_9005_NUMCHAN
mdefine_line|#define SUBID_9005_NUMCHAN(id)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;((SUBID_9005_TYPE(id) == SUBID_9005_TYPE_MB)&t;&t;&t;&bslash;&n;&t; ? ((id) &amp; 0x300) &gt;&gt; 8&t;&t;&t;&t;&t;&t;&bslash;&n;&t; : ((id) &amp; 0xC00) &gt;&gt; 10)
DECL|macro|SUBID_9005_LEGACYCONN
mdefine_line|#define SUBID_9005_LEGACYCONN(id)&t;&t;&t;&t;&t;&bslash;&n;&t;((SUBID_9005_TYPE(id) == SUBID_9005_TYPE_MB)&t;&t;&t;&bslash;&n;&t; ? 0&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t; : ((id) &amp; 0x80) &gt;&gt; 7)
DECL|macro|SUBID_9005_MFUNCENB
mdefine_line|#define SUBID_9005_MFUNCENB(id)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;((SUBID_9005_TYPE(id) == SUBID_9005_TYPE_MB)&t;&t;&t;&bslash;&n;&t; ? ((id) &amp; 0x800) &gt;&gt; 11&t;&t;&t;&t;&t;&t;&bslash;&n;&t; : ((id) &amp; 0x1000) &gt;&gt; 12)
multiline_comment|/*&n; * Informational only. Should use chip register to be&n; * certain, but may be use in identification strings.&n; */
DECL|macro|SUBID_9005_CARD_SCSIWIDTH_MASK
mdefine_line|#define SUBID_9005_CARD_SCSIWIDTH_MASK&t;0x2000
DECL|macro|SUBID_9005_CARD_PCIWIDTH_MASK
mdefine_line|#define SUBID_9005_CARD_PCIWIDTH_MASK&t;0x4000
DECL|macro|SUBID_9005_CARD_SEDIFF_MASK
mdefine_line|#define SUBID_9005_CARD_SEDIFF_MASK&t;0x8000
DECL|variable|ahc_aic785X_setup
r_static
id|ahc_device_setup_t
id|ahc_aic785X_setup
suffix:semicolon
DECL|variable|ahc_aic7860_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7860_setup
suffix:semicolon
DECL|variable|ahc_apa1480_setup
r_static
id|ahc_device_setup_t
id|ahc_apa1480_setup
suffix:semicolon
DECL|variable|ahc_aic7870_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7870_setup
suffix:semicolon
DECL|variable|ahc_aha394X_setup
r_static
id|ahc_device_setup_t
id|ahc_aha394X_setup
suffix:semicolon
DECL|variable|ahc_aha494X_setup
r_static
id|ahc_device_setup_t
id|ahc_aha494X_setup
suffix:semicolon
DECL|variable|ahc_aha398X_setup
r_static
id|ahc_device_setup_t
id|ahc_aha398X_setup
suffix:semicolon
DECL|variable|ahc_aic7880_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7880_setup
suffix:semicolon
DECL|variable|ahc_aha2940Pro_setup
r_static
id|ahc_device_setup_t
id|ahc_aha2940Pro_setup
suffix:semicolon
DECL|variable|ahc_aha394XU_setup
r_static
id|ahc_device_setup_t
id|ahc_aha394XU_setup
suffix:semicolon
DECL|variable|ahc_aha398XU_setup
r_static
id|ahc_device_setup_t
id|ahc_aha398XU_setup
suffix:semicolon
DECL|variable|ahc_aic7890_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7890_setup
suffix:semicolon
DECL|variable|ahc_aic7892_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7892_setup
suffix:semicolon
DECL|variable|ahc_aic7895_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7895_setup
suffix:semicolon
DECL|variable|ahc_aic7896_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7896_setup
suffix:semicolon
DECL|variable|ahc_aic7899_setup
r_static
id|ahc_device_setup_t
id|ahc_aic7899_setup
suffix:semicolon
DECL|variable|ahc_aha29160C_setup
r_static
id|ahc_device_setup_t
id|ahc_aha29160C_setup
suffix:semicolon
DECL|variable|ahc_raid_setup
r_static
id|ahc_device_setup_t
id|ahc_raid_setup
suffix:semicolon
DECL|variable|ahc_aha394XX_setup
r_static
id|ahc_device_setup_t
id|ahc_aha394XX_setup
suffix:semicolon
DECL|variable|ahc_aha494XX_setup
r_static
id|ahc_device_setup_t
id|ahc_aha494XX_setup
suffix:semicolon
DECL|variable|ahc_aha398XX_setup
r_static
id|ahc_device_setup_t
id|ahc_aha398XX_setup
suffix:semicolon
DECL|variable|ahc_pci_ident_table
r_struct
id|ahc_pci_identity
id|ahc_pci_ident_table
(braket
)braket
op_assign
(brace
multiline_comment|/* aic7850 based controllers */
(brace
id|ID_AHA_2902_04_10_15_20_30C
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2902/04/10/15/20/30C SCSI adapter&quot;
comma
id|ahc_aic785X_setup
)brace
comma
multiline_comment|/* aic7860 based controllers */
(brace
id|ID_AHA_2930CU
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2930CU SCSI adapter&quot;
comma
id|ahc_aic7860_setup
)brace
comma
(brace
id|ID_AHA_1480A
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 1480A Ultra SCSI adapter&quot;
comma
id|ahc_apa1480_setup
)brace
comma
(brace
id|ID_AHA_2940AU_0
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2940A Ultra SCSI adapter&quot;
comma
id|ahc_aic7860_setup
)brace
comma
(brace
id|ID_AHA_2940AU_CN
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2940A/CN Ultra SCSI adapter&quot;
comma
id|ahc_aic7860_setup
)brace
comma
(brace
id|ID_AHA_2930C_VAR
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2930C Ultra SCSI adapter (VAR)&quot;
comma
id|ahc_aic7860_setup
)brace
comma
multiline_comment|/* aic7870 based controllers */
(brace
id|ID_AHA_2940
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2940 SCSI adapter&quot;
comma
id|ahc_aic7870_setup
)brace
comma
(brace
id|ID_AHA_3940
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3940 SCSI adapter&quot;
comma
id|ahc_aha394X_setup
)brace
comma
(brace
id|ID_AHA_398X
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 398X SCSI RAID adapter&quot;
comma
id|ahc_aha398X_setup
)brace
comma
(brace
id|ID_AHA_2944
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2944 SCSI adapter&quot;
comma
id|ahc_aic7870_setup
)brace
comma
(brace
id|ID_AHA_3944
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3944 SCSI adapter&quot;
comma
id|ahc_aha394X_setup
)brace
comma
(brace
id|ID_AHA_4944
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 4944 SCSI adapter&quot;
comma
id|ahc_aha494X_setup
)brace
comma
multiline_comment|/* aic7880 based controllers */
(brace
id|ID_AHA_2940U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2940 Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
(brace
id|ID_AHA_3940U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 3940 Ultra SCSI adapter&quot;
comma
id|ahc_aha394XU_setup
)brace
comma
(brace
id|ID_AHA_2944U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2944 Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
(brace
id|ID_AHA_3944U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 3944 Ultra SCSI adapter&quot;
comma
id|ahc_aha394XU_setup
)brace
comma
(brace
id|ID_AHA_398XU
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 398X Ultra SCSI RAID adapter&quot;
comma
id|ahc_aha398XU_setup
)brace
comma
(brace
multiline_comment|/*&n;&t;&t; * XXX Don&squot;t know the slot numbers&n;&t;&t; * so we can&squot;t identify channels&n;&t;&t; */
id|ID_AHA_4944U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 4944 Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
(brace
id|ID_AHA_2930U
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2930 Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
(brace
id|ID_AHA_2940U_PRO
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2940 Pro Ultra SCSI adapter&quot;
comma
id|ahc_aha2940Pro_setup
)brace
comma
(brace
id|ID_AHA_2940U_CN
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec 2940/CN Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
multiline_comment|/* Ignore all SISL (AAC on MB) based controllers. */
(brace
id|ID_9005_SISL_ID
comma
id|ID_9005_SISL_MASK
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
multiline_comment|/* aic7890 based controllers */
(brace
id|ID_AHA_2930U2
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2930 Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AHA_2940U2B
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2940B Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AHA_2940U2_OEM
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2940 Ultra2 SCSI adapter (OEM)&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AHA_2940U2
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2940 Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AHA_2950U2B
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2950 Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AIC7890_ARO
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec aic7890/91 Ultra2 SCSI adapter (ARO)&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AAA_131U2
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec AAA-131 Ultra2 RAID adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
multiline_comment|/* aic7892 based controllers */
(brace
id|ID_AHA_29160
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 29160 Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AHA_29160_CPQ
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec (Compaq OEM) 29160 Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AHA_29160N
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 29160N Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AHA_29160C
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 29160C Ultra160 SCSI adapter&quot;
comma
id|ahc_aha29160C_setup
)brace
comma
(brace
id|ID_AHA_29160B
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 29160B Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AHA_19160B
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 19160B Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AIC7892_ARO
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec aic7892 Ultra160 SCSI adapter (ARO)&quot;
comma
id|ahc_aic7892_setup
)brace
comma
multiline_comment|/* aic7895 based controllers */
(brace
id|ID_AHA_2940U_DUAL
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 2940/DUAL Ultra SCSI adapter&quot;
comma
id|ahc_aic7895_setup
)brace
comma
(brace
id|ID_AHA_3940AU
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3940A Ultra SCSI adapter&quot;
comma
id|ahc_aic7895_setup
)brace
comma
(brace
id|ID_AHA_3944AU
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3944A Ultra SCSI adapter&quot;
comma
id|ahc_aic7895_setup
)brace
comma
(brace
id|ID_AIC7895_ARO
comma
id|ID_AIC7895_ARO_MASK
comma
l_string|&quot;Adaptec aic7895 Ultra SCSI adapter (ARO)&quot;
comma
id|ahc_aic7895_setup
)brace
comma
multiline_comment|/* aic7896/97 based controllers */
(brace
id|ID_AHA_3950U2B_0
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3950B Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7896_setup
)brace
comma
(brace
id|ID_AHA_3950U2B_1
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3950B Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7896_setup
)brace
comma
(brace
id|ID_AHA_3950U2D_0
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3950D Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7896_setup
)brace
comma
(brace
id|ID_AHA_3950U2D_1
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3950D Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7896_setup
)brace
comma
(brace
id|ID_AIC7896_ARO
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec aic7896/97 Ultra2 SCSI adapter (ARO)&quot;
comma
id|ahc_aic7896_setup
)brace
comma
multiline_comment|/* aic7899 based controllers */
(brace
id|ID_AHA_3960D
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec 3960D Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7899_setup
)brace
comma
(brace
id|ID_AHA_3960D_CPQ
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec (Compaq OEM) 3960D Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7899_setup
)brace
comma
(brace
id|ID_AIC7899_ARO
comma
id|ID_ALL_MASK
comma
l_string|&quot;Adaptec aic7899 Ultra160 SCSI adapter (ARO)&quot;
comma
id|ahc_aic7899_setup
)brace
comma
multiline_comment|/* Generic chip probes for devices we don&squot;t know &squot;exactly&squot; */
(brace
id|ID_AIC7850
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7850 SCSI adapter&quot;
comma
id|ahc_aic785X_setup
)brace
comma
(brace
id|ID_AIC7855
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7855 SCSI adapter&quot;
comma
id|ahc_aic785X_setup
)brace
comma
(brace
id|ID_AIC7859
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7859 SCSI adapter&quot;
comma
id|ahc_aic7860_setup
)brace
comma
(brace
id|ID_AIC7860
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7860 Ultra SCSI adapter&quot;
comma
id|ahc_aic7860_setup
)brace
comma
(brace
id|ID_AIC7870
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7870 SCSI adapter&quot;
comma
id|ahc_aic7870_setup
)brace
comma
(brace
id|ID_AIC7880
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7880 Ultra SCSI adapter&quot;
comma
id|ahc_aic7880_setup
)brace
comma
(brace
id|ID_AIC7890
op_amp
id|ID_9005_GENERIC_MASK
comma
id|ID_9005_GENERIC_MASK
comma
l_string|&quot;Adaptec aic7890/91 Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7890_setup
)brace
comma
(brace
id|ID_AIC7892
op_amp
id|ID_9005_GENERIC_MASK
comma
id|ID_9005_GENERIC_MASK
comma
l_string|&quot;Adaptec aic7892 Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7892_setup
)brace
comma
(brace
id|ID_AIC7895
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7895 Ultra SCSI adapter&quot;
comma
id|ahc_aic7895_setup
)brace
comma
(brace
id|ID_AIC7896
op_amp
id|ID_9005_GENERIC_MASK
comma
id|ID_9005_GENERIC_MASK
comma
l_string|&quot;Adaptec aic7896/97 Ultra2 SCSI adapter&quot;
comma
id|ahc_aic7896_setup
)brace
comma
(brace
id|ID_AIC7899
op_amp
id|ID_9005_GENERIC_MASK
comma
id|ID_9005_GENERIC_MASK
comma
l_string|&quot;Adaptec aic7899 Ultra160 SCSI adapter&quot;
comma
id|ahc_aic7899_setup
)brace
comma
(brace
id|ID_AIC7810
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7810 RAID memory controller&quot;
comma
id|ahc_raid_setup
)brace
comma
(brace
id|ID_AIC7815
op_amp
id|ID_DEV_VENDOR_MASK
comma
id|ID_DEV_VENDOR_MASK
comma
l_string|&quot;Adaptec aic7815 RAID memory controller&quot;
comma
id|ahc_raid_setup
)brace
)brace
suffix:semicolon
DECL|variable|ahc_num_pci_devs
r_const
id|u_int
id|ahc_num_pci_devs
op_assign
id|NUM_ELEMENTS
c_func
(paren
id|ahc_pci_ident_table
)paren
suffix:semicolon
DECL|macro|AHC_394X_SLOT_CHANNEL_A
mdefine_line|#define AHC_394X_SLOT_CHANNEL_A&t;4
DECL|macro|AHC_394X_SLOT_CHANNEL_B
mdefine_line|#define AHC_394X_SLOT_CHANNEL_B&t;5
DECL|macro|AHC_398X_SLOT_CHANNEL_A
mdefine_line|#define AHC_398X_SLOT_CHANNEL_A&t;4
DECL|macro|AHC_398X_SLOT_CHANNEL_B
mdefine_line|#define AHC_398X_SLOT_CHANNEL_B&t;8
DECL|macro|AHC_398X_SLOT_CHANNEL_C
mdefine_line|#define AHC_398X_SLOT_CHANNEL_C&t;12
DECL|macro|AHC_494X_SLOT_CHANNEL_A
mdefine_line|#define AHC_494X_SLOT_CHANNEL_A&t;4
DECL|macro|AHC_494X_SLOT_CHANNEL_B
mdefine_line|#define AHC_494X_SLOT_CHANNEL_B&t;5
DECL|macro|AHC_494X_SLOT_CHANNEL_C
mdefine_line|#define AHC_494X_SLOT_CHANNEL_C&t;6
DECL|macro|AHC_494X_SLOT_CHANNEL_D
mdefine_line|#define AHC_494X_SLOT_CHANNEL_D&t;7
DECL|macro|DEVCONFIG
mdefine_line|#define&t;DEVCONFIG&t;&t;0x40
DECL|macro|PCIERRGENDIS
mdefine_line|#define&t;&t;PCIERRGENDIS&t;0x80000000ul
DECL|macro|SCBSIZE32
mdefine_line|#define&t;&t;SCBSIZE32&t;0x00010000ul&t;/* aic789X only */
DECL|macro|REXTVALID
mdefine_line|#define&t;&t;REXTVALID&t;0x00001000ul&t;/* ultra cards only */
DECL|macro|MPORTMODE
mdefine_line|#define&t;&t;MPORTMODE&t;0x00000400ul&t;/* aic7870+ only */
DECL|macro|RAMPSM
mdefine_line|#define&t;&t;RAMPSM&t;&t;0x00000200ul&t;/* aic7870+ only */
DECL|macro|VOLSENSE
mdefine_line|#define&t;&t;VOLSENSE&t;0x00000100ul
DECL|macro|PCI64BIT
mdefine_line|#define&t;&t;PCI64BIT&t;0x00000080ul&t;/* 64Bit PCI bus (Ultra2 Only)*/
DECL|macro|SCBRAMSEL
mdefine_line|#define&t;&t;SCBRAMSEL&t;0x00000080ul
DECL|macro|MRDCEN
mdefine_line|#define&t;&t;MRDCEN&t;&t;0x00000040ul
DECL|macro|EXTSCBTIME
mdefine_line|#define&t;&t;EXTSCBTIME&t;0x00000020ul&t;/* aic7870 only */
DECL|macro|EXTSCBPEN
mdefine_line|#define&t;&t;EXTSCBPEN&t;0x00000010ul&t;/* aic7870 only */
DECL|macro|BERREN
mdefine_line|#define&t;&t;BERREN&t;&t;0x00000008ul
DECL|macro|DACEN
mdefine_line|#define&t;&t;DACEN&t;&t;0x00000004ul
DECL|macro|STPWLEVEL
mdefine_line|#define&t;&t;STPWLEVEL&t;0x00000002ul
DECL|macro|DIFACTNEGEN
mdefine_line|#define&t;&t;DIFACTNEGEN&t;0x00000001ul&t;/* aic7870 only */
DECL|macro|CSIZE_LATTIME
mdefine_line|#define&t;CSIZE_LATTIME&t;&t;0x0c
DECL|macro|CACHESIZE
mdefine_line|#define&t;&t;CACHESIZE&t;0x0000003ful&t;/* only 5 bits */
DECL|macro|LATTIME
mdefine_line|#define&t;&t;LATTIME&t;&t;0x0000ff00ul
multiline_comment|/* PCI STATUS definitions */
DECL|macro|DPE
mdefine_line|#define&t;DPE&t;0x80
DECL|macro|SSE
mdefine_line|#define SSE&t;0x40
DECL|macro|RMA
mdefine_line|#define&t;RMA&t;0x20
DECL|macro|RTA
mdefine_line|#define&t;RTA&t;0x10
DECL|macro|STA
mdefine_line|#define STA&t;0x08
DECL|macro|DPR
mdefine_line|#define DPR&t;0x01
r_static
r_int
id|ahc_9005_subdevinfo_valid
c_func
(paren
r_uint16
id|vendor
comma
r_uint16
id|device
comma
r_uint16
id|subvendor
comma
r_uint16
id|subdevice
)paren
suffix:semicolon
r_static
r_int
id|ahc_ext_scbram_present
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
suffix:semicolon
r_static
r_void
id|ahc_scbram_config
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
id|enable
comma
r_int
id|pcheck
comma
r_int
id|fast
comma
r_int
id|large
)paren
suffix:semicolon
r_static
r_void
id|ahc_probe_ext_scbram
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
suffix:semicolon
r_static
r_void
id|check_extport
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
id|u_int
op_star
id|sxfrctl1
)paren
suffix:semicolon
r_static
r_void
id|ahc_parse_pci_eeprom
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|seeprom_config
op_star
id|sc
)paren
suffix:semicolon
r_static
r_void
id|configure_termination
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|seeprom_descriptor
op_star
id|sd
comma
id|u_int
id|adapter_control
comma
id|u_int
op_star
id|sxfrctl1
)paren
suffix:semicolon
r_static
r_void
id|ahc_new_term_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|enableSEC_low
comma
r_int
op_star
id|enableSEC_high
comma
r_int
op_star
id|enablePRI_low
comma
r_int
op_star
id|enablePRI_high
comma
r_int
op_star
id|eeprom_present
)paren
suffix:semicolon
r_static
r_void
id|aic787X_cable_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|internal50_present
comma
r_int
op_star
id|internal68_present
comma
r_int
op_star
id|externalcable_present
comma
r_int
op_star
id|eeprom_present
)paren
suffix:semicolon
r_static
r_void
id|aic785X_cable_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|internal50_present
comma
r_int
op_star
id|externalcable_present
comma
r_int
op_star
id|eeprom_present
)paren
suffix:semicolon
r_static
r_void
id|write_brdctl
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_uint8
id|value
)paren
suffix:semicolon
r_static
r_uint8
id|read_brdctl
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
suffix:semicolon
r_static
r_int
DECL|function|ahc_9005_subdevinfo_valid
id|ahc_9005_subdevinfo_valid
c_func
(paren
r_uint16
id|device
comma
r_uint16
id|vendor
comma
r_uint16
id|subdevice
comma
r_uint16
id|subvendor
)paren
(brace
r_int
id|result
suffix:semicolon
multiline_comment|/* Default to invalid. */
id|result
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vendor
op_eq
l_int|0x9005
op_logical_and
id|subvendor
op_eq
l_int|0x9005
op_logical_and
id|subdevice
op_ne
id|device
op_logical_and
id|SUBID_9005_TYPE_KNOWN
c_func
(paren
id|subdevice
)paren
op_ne
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|SUBID_9005_TYPE
c_func
(paren
id|subdevice
)paren
)paren
(brace
r_case
id|SUBID_9005_TYPE_MB
suffix:colon
r_break
suffix:semicolon
r_case
id|SUBID_9005_TYPE_CARD
suffix:colon
r_case
id|SUBID_9005_TYPE_LCCARD
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Currently only trust Adaptec cards to&n;&t;&t;&t; * get the sub device info correct.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|DEVID_9005_TYPE
c_func
(paren
id|device
)paren
op_eq
id|DEVID_9005_TYPE_HBA
)paren
id|result
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUBID_9005_TYPE_RAID
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|result
)paren
suffix:semicolon
)brace
r_struct
id|ahc_pci_identity
op_star
DECL|function|ahc_find_pci_device
id|ahc_find_pci_device
c_func
(paren
id|ahc_dev_softc_t
id|pci
)paren
(brace
r_uint64
id|full_id
suffix:semicolon
r_uint16
id|device
suffix:semicolon
r_uint16
id|vendor
suffix:semicolon
r_uint16
id|subdevice
suffix:semicolon
r_uint16
id|subvendor
suffix:semicolon
r_struct
id|ahc_pci_identity
op_star
id|entry
suffix:semicolon
id|u_int
id|i
suffix:semicolon
id|vendor
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_DEVVENDOR
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
id|device
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_DEVICE
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
id|subvendor
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_SUBVEND_0
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
id|subdevice
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_SUBDEV_0
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
id|full_id
op_assign
id|ahc_compose_id
c_func
(paren
id|device
comma
id|vendor
comma
id|subdevice
comma
id|subvendor
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If the second function is not hooked up, ignore it.&n;&t; * Unfortunately, not all MB vendors implement the&n;&t; * subdevice ID as per the Adaptec spec, so do our best&n;&t; * to sanity check it prior to accepting the subdevice&n;&t; * ID as valid.&n;&t; */
r_if
c_cond
(paren
id|ahc_get_pci_function
c_func
(paren
id|pci
)paren
OG
l_int|0
op_logical_and
id|ahc_9005_subdevinfo_valid
c_func
(paren
id|vendor
comma
id|device
comma
id|subvendor
comma
id|subdevice
)paren
op_logical_and
id|SUBID_9005_MFUNCENB
c_func
(paren
id|subdevice
)paren
op_eq
l_int|0
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ahc_num_pci_devs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|entry
op_assign
op_amp
id|ahc_pci_ident_table
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;full_id
op_eq
(paren
id|full_id
op_amp
id|entry-&gt;id_mask
)paren
)paren
(brace
multiline_comment|/* Honor exclusion entries. */
r_if
c_cond
(paren
id|entry-&gt;name
op_eq
l_int|NULL
)paren
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
r_return
(paren
id|entry
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_int
DECL|function|ahc_pci_config
id|ahc_pci_config
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|ahc_pci_identity
op_star
id|entry
)paren
(brace
id|u_long
id|l
suffix:semicolon
id|u_int
id|command
suffix:semicolon
id|u_int
id|our_id
suffix:semicolon
id|u_int
id|sxfrctl1
suffix:semicolon
id|u_int
id|scsiseq
suffix:semicolon
id|u_int
id|dscommand0
suffix:semicolon
r_uint32
id|devconfig
suffix:semicolon
r_int
id|error
suffix:semicolon
r_uint8
id|sblkctl
suffix:semicolon
id|our_id
op_assign
l_int|0
suffix:semicolon
id|error
op_assign
id|entry
op_member_access_from_pointer
id|setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
id|ahc-&gt;chip
op_or_assign
id|AHC_PCI
suffix:semicolon
id|ahc-&gt;description
op_assign
id|entry-&gt;name
suffix:semicolon
id|ahc_power_state_change
c_func
(paren
id|ahc
comma
id|AHC_POWER_STATE_D0
)paren
suffix:semicolon
id|error
op_assign
id|ahc_pci_map_registers
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Before we continue probing the card, ensure that&n;&t; * its interrupts are *disabled*.  We don&squot;t want&n;&t; * a misstep to hang the machine in an interrupt&n;&t; * storm.&n;&t; */
id|ahc_intr_enable
c_func
(paren
id|ahc
comma
id|FALSE
)paren
suffix:semicolon
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we need to support high memory, enable dual&n;&t; * address cycles.  This bit must be set to enable&n;&t; * high address bit generation even if we are on a&n;&t; * 64bit bus (PCI64BIT set in devconfig).&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_39BIT_ADDRESSING
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Enabling 39Bit Addressing&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
id|devconfig
op_or_assign
id|DACEN
suffix:semicolon
)brace
multiline_comment|/* Ensure that pci error generation, a test feature, is disabled. */
id|devconfig
op_or_assign
id|PCIERRGENDIS
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
id|devconfig
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Ensure busmastering is enabled */
id|command
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_COMMAND
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|command
op_or_assign
id|PCIM_CMD_BUSMASTEREN
suffix:semicolon
multiline_comment|/*&n;&t; * Disable PCI parity error reporting.  Users typically&n;&t; * do this to work around broken PCI chipsets that get&n;&t; * the parity timing wrong and thus generate lots of spurious&n;&t; * errors.&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_DISABLE_PCI_PERR
)paren
op_ne
l_int|0
)paren
id|command
op_and_assign
op_complement
id|PCIM_CMD_PERRESPEN
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_COMMAND
comma
id|command
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
multiline_comment|/* On all PCI adapters, we allow SCB paging */
id|ahc-&gt;flags
op_or_assign
id|AHC_PAGESCBS
suffix:semicolon
id|error
op_assign
id|ahc_softc_init
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
id|ahc-&gt;bus_intr
op_assign
id|ahc_pci_intr
suffix:semicolon
multiline_comment|/* Remeber how the card was setup in case there is no SEEPROM */
r_if
c_cond
(paren
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|HCNTRL
)paren
op_amp
id|POWRDN
)paren
op_eq
l_int|0
)paren
(brace
id|ahc_pause
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
id|our_id
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCSIID_ULTRA2
)paren
op_amp
id|OID
suffix:semicolon
r_else
id|our_id
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCSIID
)paren
op_amp
id|OID
suffix:semicolon
id|sxfrctl1
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SXFRCTL1
)paren
op_amp
id|STPWEN
suffix:semicolon
id|scsiseq
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCSISEQ
)paren
suffix:semicolon
)brace
r_else
(brace
id|sxfrctl1
op_assign
id|STPWEN
suffix:semicolon
id|our_id
op_assign
l_int|7
suffix:semicolon
id|scsiseq
op_assign
l_int|0
suffix:semicolon
)brace
id|error
op_assign
id|ahc_reset
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_DT
)paren
op_ne
l_int|0
)paren
(brace
id|u_int
id|sfunct
suffix:semicolon
multiline_comment|/* Perform ALT-Mode Setup */
id|sfunct
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SFUNCT
)paren
op_amp
op_complement
id|ALT_MODE
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SFUNCT
comma
id|sfunct
op_or
id|ALT_MODE
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|OPTIONMODE
comma
id|OPTIONMODE_DEFAULTS
op_or
id|AUTOACKEN
op_or
id|BUSFREEREV
op_or
id|EXPPHASEDIS
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SFUNCT
comma
id|sfunct
)paren
suffix:semicolon
multiline_comment|/* Normal mode setup */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CRCCONTROL1
comma
id|CRCVALCHKEN
op_or
id|CRCENDCHKEN
op_or
id|CRCREQCHKEN
op_or
id|TARGCRCENDEN
)paren
suffix:semicolon
)brace
id|dscommand0
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|DSCOMMAND0
)paren
suffix:semicolon
id|dscommand0
op_or_assign
id|MPARCKEN
op_or
id|CACHETHEN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * DPARCKEN doesn&squot;t work correctly on&n;&t;&t; * some MBs so don&squot;t use it.&n;&t;&t; */
id|dscommand0
op_and_assign
op_complement
id|DPARCKEN
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Handle chips that must have cache line&n;&t; * streaming (dis/en)abled.&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;bugs
op_amp
id|AHC_CACHETHEN_DIS_BUG
)paren
op_ne
l_int|0
)paren
id|dscommand0
op_or_assign
id|CACHETHEN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;bugs
op_amp
id|AHC_CACHETHEN_BUG
)paren
op_ne
l_int|0
)paren
id|dscommand0
op_and_assign
op_complement
id|CACHETHEN
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DSCOMMAND0
comma
id|dscommand0
)paren
suffix:semicolon
id|ahc-&gt;pci_cachesize
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|CSIZE_LATTIME
comma
multiline_comment|/*bytes*/
l_int|1
)paren
op_amp
id|CACHESIZE
suffix:semicolon
id|ahc-&gt;pci_cachesize
op_mul_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;bugs
op_amp
id|AHC_PCI_2_1_RETRY_BUG
)paren
op_ne
l_int|0
op_logical_and
id|ahc-&gt;pci_cachesize
op_eq
l_int|4
)paren
(brace
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|CSIZE_LATTIME
comma
l_int|0
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|ahc-&gt;pci_cachesize
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We cannot perform ULTRA speeds without the presense&n;&t; * of the external precision resistor.&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA
)paren
op_ne
l_int|0
)paren
(brace
r_uint32
id|devconfig
suffix:semicolon
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|devconfig
op_amp
id|REXTVALID
)paren
op_eq
l_int|0
)paren
id|ahc-&gt;features
op_and_assign
op_complement
id|AHC_ULTRA
suffix:semicolon
)brace
multiline_comment|/* See if we have a SEEPROM and perform auto-term */
id|check_extport
c_func
(paren
id|ahc
comma
op_amp
id|sxfrctl1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Take the LED out of diagnostic mode&n;&t; */
id|sblkctl
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SBLKCTL
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SBLKCTL
comma
(paren
id|sblkctl
op_amp
op_complement
(paren
id|DIAGLEDEN
op_or
id|DIAGLEDON
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DFF_THRSH
comma
id|RD_DFTHRSH_MAX
op_or
id|WR_DFTHRSH_MAX
)paren
suffix:semicolon
)brace
r_else
(brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DSPCISTATUS
comma
id|DFTHRSH_100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ahc-&gt;flags
op_amp
id|AHC_USEDEFAULTS
)paren
(brace
multiline_comment|/*&n;&t;&t; * PCI Adapter default setup&n;&t;&t; * Should only be used if the adapter does not have&n;&t;&t; * a SEEPROM.&n;&t;&t; */
multiline_comment|/* See if someone else set us up already */
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_NO_BIOS_INIT
)paren
op_eq
l_int|0
op_logical_and
id|scsiseq
op_ne
l_int|0
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Using left over BIOS settings&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
id|ahc-&gt;flags
op_and_assign
op_complement
id|AHC_USEDEFAULTS
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_BIOS_ENABLED
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * Assume only one connector and always turn&n;&t;&t;&t; * on termination.&n;&t;&t;&t; */
id|our_id
op_assign
l_int|0x07
suffix:semicolon
id|sxfrctl1
op_assign
id|STPWEN
suffix:semicolon
)brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SCSICONF
comma
id|our_id
op_or
id|ENSPCHK
op_or
id|RESET_SCSI
)paren
suffix:semicolon
id|ahc-&gt;our_id
op_assign
id|our_id
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Take a look to see if we have external SRAM.&n;&t; * We currently do not attempt to use SRAM that is&n;&t; * shared among multiple controllers.&n;&t; */
id|ahc_probe_ext_scbram
c_func
(paren
id|ahc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Record our termination setting for the&n;&t; * generic initialization routine.&n;&t; */
r_if
c_cond
(paren
(paren
id|sxfrctl1
op_amp
id|STPWEN
)paren
op_ne
l_int|0
)paren
id|ahc-&gt;flags
op_or_assign
id|AHC_TERM_ENB_A
suffix:semicolon
multiline_comment|/* Core initialization */
id|error
op_assign
id|ahc_init
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Allow interrupts now that we are completely setup.&n;&t; */
id|error
op_assign
id|ahc_pci_map_int
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
id|ahc_list_lock
c_func
(paren
op_amp
id|l
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Link this softc in with all other ahc instances.&n;&t; */
id|ahc_softc_insert
c_func
(paren
id|ahc
)paren
suffix:semicolon
id|ahc_list_unlock
c_func
(paren
op_amp
id|l
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Test for the presense of external sram in an&n; * &quot;unshared&quot; configuration.&n; */
r_static
r_int
DECL|function|ahc_ext_scbram_present
id|ahc_ext_scbram_present
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|u_int
id|chip
suffix:semicolon
r_int
id|ramps
suffix:semicolon
r_int
id|single_user
suffix:semicolon
r_uint32
id|devconfig
suffix:semicolon
id|chip
op_assign
id|ahc-&gt;chip
op_amp
id|AHC_CHIPID_MASK
suffix:semicolon
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
id|single_user
op_assign
(paren
id|devconfig
op_amp
id|MPORTMODE
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
id|ramps
op_assign
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|DSCOMMAND0
)paren
op_amp
id|RAMPS
)paren
op_ne
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|chip
op_eq
id|AHC_AIC7895
op_logical_or
id|chip
op_eq
id|AHC_AIC7895C
)paren
multiline_comment|/*&n;&t;&t; * External SCBRAM arbitration is flakey&n;&t;&t; * on these chips.  Unfortunately this means&n;&t;&t; * we don&squot;t use the extra SCB ram space on the&n;&t;&t; * 3940AUW.&n;&t;&t; */
id|ramps
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|chip
op_ge
id|AHC_AIC7870
)paren
id|ramps
op_assign
(paren
id|devconfig
op_amp
id|RAMPSM
)paren
op_ne
l_int|0
suffix:semicolon
r_else
id|ramps
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ramps
op_logical_and
id|single_user
)paren
r_return
(paren
l_int|1
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enable external scbram.&n; */
r_static
r_void
DECL|function|ahc_scbram_config
id|ahc_scbram_config
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
id|enable
comma
r_int
id|pcheck
comma
r_int
id|fast
comma
r_int
id|large
)paren
(brace
r_uint32
id|devconfig
suffix:semicolon
r_if
c_cond
(paren
id|ahc-&gt;features
op_amp
id|AHC_MULTI_FUNC
)paren
(brace
multiline_comment|/*&n;&t;&t; * Set the SCB Base addr (highest address bit)&n;&t;&t; * depending on which channel we are.&n;&t;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SCBBADDR
comma
id|ahc_get_pci_function
c_func
(paren
id|ahc-&gt;dev_softc
)paren
)paren
suffix:semicolon
)brace
id|ahc-&gt;flags
op_and_assign
op_complement
id|AHC_LSCBS_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|large
)paren
id|ahc-&gt;flags
op_or_assign
id|AHC_LSCBS_ENABLED
suffix:semicolon
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
id|u_int
id|dscommand0
suffix:semicolon
id|dscommand0
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|DSCOMMAND0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|dscommand0
op_and_assign
op_complement
id|INTSCBRAMSEL
suffix:semicolon
r_else
id|dscommand0
op_or_assign
id|INTSCBRAMSEL
suffix:semicolon
r_if
c_cond
(paren
id|large
)paren
id|dscommand0
op_and_assign
op_complement
id|USCBSIZE32
suffix:semicolon
r_else
id|dscommand0
op_or_assign
id|USCBSIZE32
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DSCOMMAND0
comma
id|dscommand0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|fast
)paren
id|devconfig
op_and_assign
op_complement
id|EXTSCBTIME
suffix:semicolon
r_else
id|devconfig
op_or_assign
id|EXTSCBTIME
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|devconfig
op_and_assign
op_complement
id|SCBRAMSEL
suffix:semicolon
r_else
id|devconfig
op_or_assign
id|SCBRAMSEL
suffix:semicolon
r_if
c_cond
(paren
id|large
)paren
id|devconfig
op_and_assign
op_complement
id|SCBSIZE32
suffix:semicolon
r_else
id|devconfig
op_or_assign
id|SCBSIZE32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcheck
)paren
id|devconfig
op_or_assign
id|EXTSCBPEN
suffix:semicolon
r_else
id|devconfig
op_and_assign
op_complement
id|EXTSCBPEN
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
id|devconfig
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Take a look to see if we have external SRAM.&n; * We currently do not attempt to use SRAM that is&n; * shared among multiple controllers.&n; */
r_static
r_void
DECL|function|ahc_probe_ext_scbram
id|ahc_probe_ext_scbram
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|num_scbs
suffix:semicolon
r_int
id|test_num_scbs
suffix:semicolon
r_int
id|enable
suffix:semicolon
r_int
id|pcheck
suffix:semicolon
r_int
id|fast
suffix:semicolon
r_int
id|large
suffix:semicolon
id|enable
op_assign
id|FALSE
suffix:semicolon
id|pcheck
op_assign
id|FALSE
suffix:semicolon
id|fast
op_assign
id|FALSE
suffix:semicolon
id|large
op_assign
id|FALSE
suffix:semicolon
id|num_scbs
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ahc_ext_scbram_present
c_func
(paren
id|ahc
)paren
op_eq
l_int|0
)paren
r_goto
id|done
suffix:semicolon
multiline_comment|/*&n;&t; * Probe for the best parameters to use.&n;&t; */
id|ahc_scbram_config
c_func
(paren
id|ahc
comma
multiline_comment|/*enable*/
id|TRUE
comma
id|pcheck
comma
id|fast
comma
id|large
)paren
suffix:semicolon
id|num_scbs
op_assign
id|ahc_probe_scbs
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_scbs
op_eq
l_int|0
)paren
(brace
multiline_comment|/* The SRAM wasn&squot;t really present. */
r_goto
id|done
suffix:semicolon
)brace
id|enable
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/*&n;&t; * Clear any outstanding parity error&n;&t; * and ensure that parity error reporting&n;&t; * is enabled.&n;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SEQCTL
comma
l_int|0
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRBRKADRINT
)paren
suffix:semicolon
multiline_comment|/* Now see if we can do parity */
id|ahc_scbram_config
c_func
(paren
id|ahc
comma
id|enable
comma
multiline_comment|/*pcheck*/
id|TRUE
comma
id|fast
comma
id|large
)paren
suffix:semicolon
id|num_scbs
op_assign
id|ahc_probe_scbs
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|INTSTAT
)paren
op_amp
id|BRKADRINT
)paren
op_eq
l_int|0
op_logical_or
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|ERROR
)paren
op_amp
id|MPARERR
)paren
op_eq
l_int|0
)paren
id|pcheck
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* Clear any resulting parity error */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRBRKADRINT
)paren
suffix:semicolon
multiline_comment|/* Now see if we can do fast timing */
id|ahc_scbram_config
c_func
(paren
id|ahc
comma
id|enable
comma
id|pcheck
comma
multiline_comment|/*fast*/
id|TRUE
comma
id|large
)paren
suffix:semicolon
id|test_num_scbs
op_assign
id|ahc_probe_scbs
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_num_scbs
op_eq
id|num_scbs
op_logical_and
(paren
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|INTSTAT
)paren
op_amp
id|BRKADRINT
)paren
op_eq
l_int|0
op_logical_or
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|ERROR
)paren
op_amp
id|MPARERR
)paren
op_eq
l_int|0
)paren
)paren
id|fast
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/*&n;&t; * See if we can use large SCBs and still maintain&n;&t; * the same overall count of SCBs.&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_LARGE_SCBS
)paren
op_ne
l_int|0
)paren
(brace
id|ahc_scbram_config
c_func
(paren
id|ahc
comma
id|enable
comma
id|pcheck
comma
id|fast
comma
multiline_comment|/*large*/
id|TRUE
)paren
suffix:semicolon
id|test_num_scbs
op_assign
id|ahc_probe_scbs
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_num_scbs
op_ge
id|num_scbs
)paren
(brace
id|large
op_assign
id|TRUE
suffix:semicolon
id|num_scbs
op_assign
id|test_num_scbs
suffix:semicolon
r_if
c_cond
(paren
id|num_scbs
op_ge
l_int|64
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * We have enough space to move the&n;&t;&t;&t;&t; * &quot;busy targets table&quot; into SCB space&n;&t;&t;&t;&t; * and make it qualify all the way to the&n;&t;&t;&t;&t; * lun level.&n;&t;&t;&t;&t; */
id|ahc-&gt;flags
op_or_assign
id|AHC_SCB_BTT
suffix:semicolon
)brace
)brace
)brace
id|done
suffix:colon
multiline_comment|/*&n;&t; * Disable parity error reporting until we&n;&t; * can load instruction ram.&n;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SEQCTL
comma
id|PERRORDIS
op_or
id|FAILDIS
)paren
suffix:semicolon
multiline_comment|/* Clear any latched parity error */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRBRKADRINT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
op_logical_and
id|enable
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: External SRAM, %s access%s, %dbytes/SCB&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|fast
ques
c_cond
l_string|&quot;fast&quot;
suffix:colon
l_string|&quot;slow&quot;
comma
id|pcheck
ques
c_cond
l_string|&quot;, parity checking enabled&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|large
ques
c_cond
l_int|64
suffix:colon
l_int|32
)paren
suffix:semicolon
)brace
id|ahc_scbram_config
c_func
(paren
id|ahc
comma
id|enable
comma
id|pcheck
comma
id|fast
comma
id|large
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Perform some simple tests that should catch situations where&n; * our registers are invalidly mapped.&n; */
r_int
DECL|function|ahc_pci_test_register_access
id|ahc_pci_test_register_access
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|u_int
id|status1
suffix:semicolon
r_uint32
id|cmd
suffix:semicolon
r_uint8
id|hcntrl
suffix:semicolon
id|error
op_assign
id|EIO
suffix:semicolon
multiline_comment|/*&n;&t; * Enable PCI error interrupt status, but suppress NMIs&n;&t; * generated by SERR raised due to target aborts.&n;&t; */
id|cmd
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_COMMAND
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_COMMAND
comma
id|cmd
op_amp
op_complement
id|PCIM_CMD_SERRESPEN
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * First a simple test to see if any&n;&t; * registers can be read.  Reading&n;&t; * HCNTRL has no side effects and has&n;&t; * at least one bit that is guaranteed to&n;&t; * be zero so it is a good register to&n;&t; * use for this test.&n;&t; */
id|hcntrl
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|HCNTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcntrl
op_eq
l_int|0xFF
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/*&n;&t; * Next create a situation where write combining&n;&t; * or read prefetching could be initiated by the&n;&t; * CPU or host bridge.  Our device does not support&n;&t; * either, so look for data corruption and/or flagged&n;&t; * PCI errors.&n;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|HCNTRL
comma
id|hcntrl
op_or
id|PAUSE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ahc_is_paused
c_func
(paren
id|ahc
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SEQCTL
comma
id|PERRORDIS
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SCBPTR
comma
l_int|0
)paren
suffix:semicolon
id|ahc_outl
c_func
(paren
id|ahc
comma
id|SCB_BASE
comma
l_int|0x5aa555aa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ahc_inl
c_func
(paren
id|ahc
comma
id|SCB_BASE
)paren
op_ne
l_int|0x5aa555aa
)paren
r_goto
id|fail
suffix:semicolon
id|status1
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_STATUS
op_plus
l_int|1
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status1
op_amp
id|STA
)paren
op_ne
l_int|0
)paren
r_goto
id|fail
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|fail
suffix:colon
multiline_comment|/* Silently clear any latched errors. */
id|status1
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_STATUS
op_plus
l_int|1
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_STATUS
op_plus
l_int|1
comma
id|status1
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SEQCTL
comma
id|PERRORDIS
op_or
id|FAILDIS
)paren
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_COMMAND
comma
id|cmd
comma
multiline_comment|/*bytes*/
l_int|2
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Check the external port logic for a serial eeprom&n; * and termination/cable detection contrls.&n; */
r_static
r_void
DECL|function|check_extport
id|check_extport
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
id|u_int
op_star
id|sxfrctl1
)paren
(brace
r_struct
id|seeprom_descriptor
id|sd
suffix:semicolon
r_struct
id|seeprom_config
op_star
id|sc
suffix:semicolon
r_int
id|have_seeprom
suffix:semicolon
r_int
id|have_autoterm
suffix:semicolon
id|sd.sd_ahc
op_assign
id|ahc
suffix:semicolon
id|sd.sd_control_offset
op_assign
id|SEECTL
suffix:semicolon
id|sd.sd_status_offset
op_assign
id|SEECTL
suffix:semicolon
id|sd.sd_dataout_offset
op_assign
id|SEECTL
suffix:semicolon
id|sc
op_assign
id|ahc-&gt;seep_config
suffix:semicolon
multiline_comment|/*&n;&t; * For some multi-channel devices, the c46 is simply too&n;&t; * small to work.  For the other controller types, we can&n;&t; * get our information from either SEEPROM type.  Set the&n;&t; * type to start our probe with accordingly.&n;&t; */
r_if
c_cond
(paren
id|ahc-&gt;flags
op_amp
id|AHC_LARGE_SEEPROM
)paren
id|sd.sd_chip
op_assign
id|C56_66
suffix:semicolon
r_else
id|sd.sd_chip
op_assign
id|C46
suffix:semicolon
id|sd.sd_MS
op_assign
id|SEEMS
suffix:semicolon
id|sd.sd_RDY
op_assign
id|SEERDY
suffix:semicolon
id|sd.sd_CS
op_assign
id|SEECS
suffix:semicolon
id|sd.sd_CK
op_assign
id|SEECK
suffix:semicolon
id|sd.sd_DO
op_assign
id|SEEDO
suffix:semicolon
id|sd.sd_DI
op_assign
id|SEEDI
suffix:semicolon
id|have_seeprom
op_assign
id|ahc_acquire_seeprom
c_func
(paren
id|ahc
comma
op_amp
id|sd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_seeprom
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Reading SEEPROM...&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|u_int
id|start_addr
suffix:semicolon
id|start_addr
op_assign
l_int|32
op_star
(paren
id|ahc-&gt;channel
op_minus
l_char|&squot;A&squot;
)paren
suffix:semicolon
id|have_seeprom
op_assign
id|ahc_read_seeprom
c_func
(paren
op_amp
id|sd
comma
(paren
r_uint16
op_star
)paren
id|sc
comma
id|start_addr
comma
r_sizeof
(paren
op_star
id|sc
)paren
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_seeprom
)paren
id|have_seeprom
op_assign
id|ahc_verify_cksum
c_func
(paren
id|sc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_seeprom
op_ne
l_int|0
op_logical_or
id|sd.sd_chip
op_eq
id|C56_66
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
(brace
r_if
c_cond
(paren
id|have_seeprom
op_eq
l_int|0
)paren
id|printf
(paren
l_string|&quot;checksum error&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|sd.sd_chip
op_assign
id|C56_66
suffix:semicolon
)brace
id|ahc_release_seeprom
c_func
(paren
op_amp
id|sd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|have_seeprom
)paren
(brace
multiline_comment|/*&n;&t;&t; * Pull scratch ram settings and treat them as&n;&t;&t; * if they are the contents of an seeprom if&n;&t;&t; * the &squot;ADPT&squot; signature is found in SCB2.&n;&t;&t; * We manually compose the data as 16bit values&n;&t;&t; * to avoid endian issues.&n;&t;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SCBPTR
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCB_BASE
)paren
op_eq
l_char|&squot;A&squot;
op_logical_and
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCB_BASE
op_plus
l_int|1
)paren
op_eq
l_char|&squot;D&squot;
op_logical_and
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCB_BASE
op_plus
l_int|2
)paren
op_eq
l_char|&squot;P&squot;
op_logical_and
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SCB_BASE
op_plus
l_int|3
)paren
op_eq
l_char|&squot;T&squot;
)paren
(brace
r_uint16
op_star
id|sc_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sc_data
op_assign
(paren
r_uint16
op_star
)paren
id|sc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
comma
id|sc_data
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
id|j
op_assign
id|i
op_star
l_int|2
suffix:semicolon
op_star
id|sc_data
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SRAM_BASE
op_plus
id|j
)paren
op_or
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SRAM_BASE
op_plus
id|j
op_plus
l_int|1
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
id|have_seeprom
op_assign
id|ahc_verify_cksum
c_func
(paren
id|sc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_seeprom
)paren
id|ahc-&gt;flags
op_or_assign
id|AHC_SCB_CONFIG_USED
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Clear any SCB parity errors in case this data and&n;&t;&t; * its associated parity was not initialized by the BIOS&n;&t;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRBRKADRINT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|have_seeprom
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: No SEEPROM available.&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_USEDEFAULTS
suffix:semicolon
id|free
c_func
(paren
id|ahc-&gt;seep_config
comma
id|M_DEVBUF
)paren
suffix:semicolon
id|ahc-&gt;seep_config
op_assign
l_int|NULL
suffix:semicolon
id|sc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|ahc_parse_pci_eeprom
c_func
(paren
id|ahc
comma
id|sc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Cards that have the external logic necessary to talk to&n;&t; * a SEEPROM, are almost certain to have the remaining logic&n;&t; * necessary for auto-termination control.  This assumption&n;&t; * hasn&squot;t failed yet...&n;&t; */
id|have_autoterm
op_assign
id|have_seeprom
suffix:semicolon
multiline_comment|/*&n;&t; * Some low-cost chips have SEEPROM and auto-term control built&n;&t; * in, instead of using a GAL.  They can tell us directly&n;&t; * if the termination logic is enabled.&n;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_SPIOCAP
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SPIOCAP
)paren
op_amp
id|SSPIOCPS
)paren
op_eq
l_int|0
)paren
id|have_autoterm
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|have_autoterm
)paren
(brace
id|ahc_acquire_seeprom
c_func
(paren
id|ahc
comma
op_amp
id|sd
)paren
suffix:semicolon
id|configure_termination
c_func
(paren
id|ahc
comma
op_amp
id|sd
comma
id|sc-&gt;adapter_control
comma
id|sxfrctl1
)paren
suffix:semicolon
id|ahc_release_seeprom
c_func
(paren
op_amp
id|sd
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|have_seeprom
)paren
(brace
op_star
id|sxfrctl1
op_and_assign
op_complement
id|STPWEN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sc-&gt;adapter_control
op_amp
id|CFSTERM
)paren
op_ne
l_int|0
)paren
op_star
id|sxfrctl1
op_or_assign
id|STPWEN
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Low byte termination %sabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
(paren
op_star
id|sxfrctl1
op_amp
id|STPWEN
)paren
ques
c_cond
l_string|&quot;en&quot;
suffix:colon
l_string|&quot;dis&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ahc_parse_pci_eeprom
id|ahc_parse_pci_eeprom
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|seeprom_config
op_star
id|sc
)paren
(brace
multiline_comment|/*&n;&t; * Put the data we&squot;ve collected down into SRAM&n;&t; * where ahc_init will find it.&n;&t; */
r_int
id|i
suffix:semicolon
r_int
id|max_targ
op_assign
id|sc-&gt;max_targets
op_amp
id|CFMAXTARG
suffix:semicolon
id|u_int
id|scsi_conf
suffix:semicolon
r_uint16
id|discenable
suffix:semicolon
r_uint16
id|ultraenb
suffix:semicolon
id|discenable
op_assign
l_int|0
suffix:semicolon
id|ultraenb
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sc-&gt;adapter_control
op_amp
id|CFULTRAEN
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * Determine if this adapter has a &quot;newstyle&quot;&n;&t;&t; * SEEPROM format.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_targ
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFSYNCHISULTRA
)paren
op_ne
l_int|0
)paren
(brace
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_targ
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u_int
id|scsirate
suffix:semicolon
r_uint16
id|target_mask
suffix:semicolon
id|target_mask
op_assign
l_int|0x01
op_lshift
id|i
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFDISC
)paren
id|discenable
op_or_assign
id|target_mask
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_NEWEEPROM_FMT
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFSYNCHISULTRA
)paren
op_ne
l_int|0
)paren
id|ultraenb
op_or_assign
id|target_mask
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|sc-&gt;adapter_control
op_amp
id|CFULTRAEN
)paren
op_ne
l_int|0
)paren
(brace
id|ultraenb
op_or_assign
id|target_mask
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFXFER
)paren
op_eq
l_int|0x04
op_logical_and
(paren
id|ultraenb
op_amp
id|target_mask
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Treat 10MHz as a non-ultra speed */
id|sc-&gt;device_flags
(braket
id|i
)braket
op_and_assign
op_complement
id|CFXFER
suffix:semicolon
id|ultraenb
op_and_assign
op_complement
id|target_mask
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
id|u_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFSYNCH
)paren
id|offset
op_assign
id|MAX_OFFSET_ULTRA2
suffix:semicolon
r_else
id|offset
op_assign
l_int|0
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|TARG_OFFSET
op_plus
id|i
comma
id|offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * The ultra enable bits contain the&n;&t;&t;&t; * high bit of the ultra2 sync rate&n;&t;&t;&t; * field.&n;&t;&t;&t; */
id|scsirate
op_assign
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFXFER
)paren
op_or
(paren
(paren
id|ultraenb
op_amp
id|target_mask
)paren
ques
c_cond
l_int|0x8
suffix:colon
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFWIDEB
)paren
id|scsirate
op_or_assign
id|WIDEXFER
suffix:semicolon
)brace
r_else
(brace
id|scsirate
op_assign
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFXFER
)paren
op_lshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFSYNCH
)paren
id|scsirate
op_or_assign
id|SOFS
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;device_flags
(braket
id|i
)braket
op_amp
id|CFWIDEB
)paren
id|scsirate
op_or_assign
id|WIDEXFER
suffix:semicolon
)brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|TARG_SCSIRATE
op_plus
id|i
comma
id|scsirate
)paren
suffix:semicolon
)brace
id|ahc-&gt;our_id
op_assign
id|sc-&gt;brtime_id
op_amp
id|CFSCSIID
suffix:semicolon
id|scsi_conf
op_assign
(paren
id|ahc-&gt;our_id
op_amp
l_int|0x7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;adapter_control
op_amp
id|CFSPARITY
)paren
id|scsi_conf
op_or_assign
id|ENSPCHK
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;adapter_control
op_amp
id|CFRESETB
)paren
id|scsi_conf
op_or_assign
id|RESET_SCSI
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
(paren
id|sc-&gt;adapter_control
op_amp
id|CFBOOTCHAN
)paren
op_rshift
id|CFBOOTCHANSHIFT
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;bios_control
op_amp
id|CFEXTEND
)paren
id|ahc-&gt;flags
op_or_assign
id|AHC_EXTENDED_TRANS_A
suffix:semicolon
r_if
c_cond
(paren
id|sc-&gt;bios_control
op_amp
id|CFBIOSEN
)paren
id|ahc-&gt;flags
op_or_assign
id|AHC_BIOS_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA
op_logical_and
(paren
id|ahc-&gt;flags
op_amp
id|AHC_NEWEEPROM_FMT
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Should we enable Ultra mode? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sc-&gt;adapter_control
op_amp
id|CFULTRAEN
)paren
)paren
multiline_comment|/* Treat us as a non-ultra card */
id|ultraenb
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sc-&gt;signature
op_eq
id|CFSIGNATURE
op_logical_or
id|sc-&gt;signature
op_eq
id|CFSIGNATURE2
)paren
(brace
r_uint32
id|devconfig
suffix:semicolon
multiline_comment|/* Honor the STPWLEVEL settings */
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
id|devconfig
op_and_assign
op_complement
id|STPWLEVEL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sc-&gt;bios_control
op_amp
id|CFSTPWLEVEL
)paren
op_ne
l_int|0
)paren
id|devconfig
op_or_assign
id|STPWLEVEL
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|DEVCONFIG
comma
id|devconfig
comma
multiline_comment|/*bytes*/
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/* Set SCSICONF info */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SCSICONF
comma
id|scsi_conf
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DISC_DSB
comma
op_complement
(paren
id|discenable
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|DISC_DSB
op_plus
l_int|1
comma
op_complement
(paren
(paren
id|discenable
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|ULTRA_ENB
comma
id|ultraenb
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|ULTRA_ENB
op_plus
l_int|1
comma
(paren
id|ultraenb
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|configure_termination
id|configure_termination
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|seeprom_descriptor
op_star
id|sd
comma
id|u_int
id|adapter_control
comma
id|u_int
op_star
id|sxfrctl1
)paren
(brace
r_uint8
id|brddat
suffix:semicolon
id|brddat
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Update the settings in sxfrctl1 to match the&n;&t; * termination settings &n;&t; */
op_star
id|sxfrctl1
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * SEECS must be on for the GALS to latch&n;&t; * the data properly.  Be sure to leave MS&n;&t; * on or we will release the seeprom.&n;&t; */
id|SEEPROM_OUTB
c_func
(paren
id|sd
comma
id|sd-&gt;sd_MS
op_or
id|sd-&gt;sd_CS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter_control
op_amp
id|CFAUTOTERM
)paren
op_ne
l_int|0
op_logical_or
(paren
id|ahc-&gt;features
op_amp
id|AHC_NEW_TERMCTL
)paren
op_ne
l_int|0
)paren
(brace
r_int
id|internal50_present
suffix:semicolon
r_int
id|internal68_present
suffix:semicolon
r_int
id|externalcable_present
suffix:semicolon
r_int
id|eeprom_present
suffix:semicolon
r_int
id|enableSEC_low
suffix:semicolon
r_int
id|enableSEC_high
suffix:semicolon
r_int
id|enablePRI_low
suffix:semicolon
r_int
id|enablePRI_high
suffix:semicolon
r_int
id|sum
suffix:semicolon
id|enableSEC_low
op_assign
l_int|0
suffix:semicolon
id|enableSEC_high
op_assign
l_int|0
suffix:semicolon
id|enablePRI_low
op_assign
l_int|0
suffix:semicolon
id|enablePRI_high
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_NEW_TERMCTL
)paren
op_ne
l_int|0
)paren
(brace
id|ahc_new_term_detect
c_func
(paren
id|ahc
comma
op_amp
id|enableSEC_low
comma
op_amp
id|enableSEC_high
comma
op_amp
id|enablePRI_low
comma
op_amp
id|enablePRI_high
comma
op_amp
id|eeprom_present
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter_control
op_amp
id|CFSEAUTOTERM
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Manual SE Termination&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
id|enableSEC_low
op_assign
(paren
id|adapter_control
op_amp
id|CFSELOWTERM
)paren
suffix:semicolon
id|enableSEC_high
op_assign
(paren
id|adapter_control
op_amp
id|CFSEHIGHTERM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|adapter_control
op_amp
id|CFAUTOTERM
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Manual LVD Termination&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
id|enablePRI_low
op_assign
(paren
id|adapter_control
op_amp
id|CFSTERM
)paren
suffix:semicolon
id|enablePRI_high
op_assign
(paren
id|adapter_control
op_amp
id|CFWSTERM
)paren
suffix:semicolon
)brace
multiline_comment|/* Make the table calculations below happy */
id|internal50_present
op_assign
l_int|0
suffix:semicolon
id|internal68_present
op_assign
l_int|1
suffix:semicolon
id|externalcable_present
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_SPIOCAP
)paren
op_ne
l_int|0
)paren
(brace
id|aic785X_cable_detect
c_func
(paren
id|ahc
comma
op_amp
id|internal50_present
comma
op_amp
id|externalcable_present
comma
op_amp
id|eeprom_present
)paren
suffix:semicolon
multiline_comment|/* Can never support a wide connector. */
id|internal68_present
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|aic787X_cable_detect
c_func
(paren
id|ahc
comma
op_amp
id|internal50_present
comma
op_amp
id|internal68_present
comma
op_amp
id|externalcable_present
comma
op_amp
id|eeprom_present
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_WIDE
)paren
op_eq
l_int|0
)paren
id|internal68_present
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
op_logical_and
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_eq
l_int|0
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: internal 50 cable %s present&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|internal50_present
ques
c_cond
l_string|&quot;is&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_WIDE
)paren
op_ne
l_int|0
)paren
id|printf
c_func
(paren
l_string|&quot;, internal 68 cable %s present&quot;
comma
id|internal68_present
ques
c_cond
l_string|&quot;is&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;n%s: external cable %s present&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|externalcable_present
ques
c_cond
l_string|&quot;is&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: BIOS eeprom %s present&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|eeprom_present
ques
c_cond
l_string|&quot;is&quot;
suffix:colon
l_string|&quot;not&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_INT50_SPEEDFLEX
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * The 50 pin connector is a separate bus,&n;&t;&t;&t; * so force it to always be terminated.&n;&t;&t;&t; * In the future, perform current sensing&n;&t;&t;&t; * to determine if we are in the middle of&n;&t;&t;&t; * a properly terminated bus.&n;&t;&t;&t; */
id|internal50_present
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Now set the termination based on what&n;&t;&t; * we found.&n;&t;&t; * Flash Enable = BRDDAT7&n;&t;&t; * Secondary High Term Enable = BRDDAT6&n;&t;&t; * Secondary Low Term Enable = BRDDAT5 (7890)&n;&t;&t; * Primary High Term Enable = BRDDAT4 (7890)&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_eq
l_int|0
op_logical_and
(paren
id|internal50_present
op_ne
l_int|0
)paren
op_logical_and
(paren
id|internal68_present
op_ne
l_int|0
)paren
op_logical_and
(paren
id|externalcable_present
op_ne
l_int|0
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Illegal cable configuration!!. &quot;
l_string|&quot;Only two connectors on the &quot;
l_string|&quot;adapter may be used at a &quot;
l_string|&quot;time!&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Pretend there are no cables in the hope&n;&t;&t;&t; * that having all of the termination on&n;&t;&t;&t; * gives us a more stable bus.&n;&t;&t;&t; */
id|internal50_present
op_assign
l_int|0
suffix:semicolon
id|internal68_present
op_assign
l_int|0
suffix:semicolon
id|externalcable_present
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_WIDE
)paren
op_ne
l_int|0
op_logical_and
(paren
(paren
id|externalcable_present
op_eq
l_int|0
)paren
op_logical_or
(paren
id|internal68_present
op_eq
l_int|0
)paren
op_logical_or
(paren
id|enableSEC_high
op_ne
l_int|0
)paren
)paren
)paren
(brace
id|brddat
op_or_assign
id|BRDDAT6
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
(brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_INT50_SPEEDFLEX
)paren
op_ne
l_int|0
)paren
id|printf
c_func
(paren
l_string|&quot;%s: 68 pin termination &quot;
l_string|&quot;Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s: %sHigh byte termination &quot;
l_string|&quot;Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|enableSEC_high
ques
c_cond
l_string|&quot;Secondary &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
)brace
id|sum
op_assign
id|internal50_present
op_plus
id|internal68_present
op_plus
id|externalcable_present
suffix:semicolon
r_if
c_cond
(paren
id|sum
OL
l_int|2
op_logical_or
(paren
id|enableSEC_low
op_ne
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
id|brddat
op_or_assign
id|BRDDAT5
suffix:semicolon
r_else
op_star
id|sxfrctl1
op_or_assign
id|STPWEN
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
(brace
r_if
c_cond
(paren
(paren
id|ahc-&gt;flags
op_amp
id|AHC_INT50_SPEEDFLEX
)paren
op_ne
l_int|0
)paren
id|printf
c_func
(paren
l_string|&quot;%s: 50 pin termination &quot;
l_string|&quot;Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s: %sLow byte termination &quot;
l_string|&quot;Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|enableSEC_low
ques
c_cond
l_string|&quot;Secondary &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|enablePRI_low
op_ne
l_int|0
)paren
(brace
op_star
id|sxfrctl1
op_or_assign
id|STPWEN
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Primary Low Byte termination &quot;
l_string|&quot;Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Setup STPWEN before setting up the rest of&n;&t;&t; * the termination per the tech note on the U160 cards.&n;&t;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SXFRCTL1
comma
op_star
id|sxfrctl1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enablePRI_high
op_ne
l_int|0
)paren
(brace
id|brddat
op_or_assign
id|BRDDAT4
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: Primary High Byte &quot;
l_string|&quot;termination Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
id|write_brdctl
c_func
(paren
id|ahc
comma
id|brddat
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|adapter_control
op_amp
id|CFSTERM
)paren
op_ne
l_int|0
)paren
(brace
op_star
id|sxfrctl1
op_or_assign
id|STPWEN
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: %sLow byte termination Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
ques
c_cond
l_string|&quot;Primary &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|adapter_control
op_amp
id|CFWSTERM
)paren
op_ne
l_int|0
op_logical_and
(paren
id|ahc-&gt;features
op_amp
id|AHC_WIDE
)paren
op_ne
l_int|0
)paren
(brace
id|brddat
op_or_assign
id|BRDDAT6
suffix:semicolon
r_if
c_cond
(paren
id|bootverbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s: %sHigh byte termination Enabled&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
ques
c_cond
l_string|&quot;Secondary &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Setup STPWEN before setting up the rest of&n;&t;&t; * the termination per the tech note on the U160 cards.&n;&t;&t; */
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SXFRCTL1
comma
op_star
id|sxfrctl1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_WIDE
)paren
op_ne
l_int|0
)paren
id|write_brdctl
c_func
(paren
id|ahc
comma
id|brddat
)paren
suffix:semicolon
)brace
id|SEEPROM_OUTB
c_func
(paren
id|sd
comma
id|sd-&gt;sd_MS
)paren
suffix:semicolon
multiline_comment|/* Clear CS */
)brace
r_static
r_void
DECL|function|ahc_new_term_detect
id|ahc_new_term_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|enableSEC_low
comma
r_int
op_star
id|enableSEC_high
comma
r_int
op_star
id|enablePRI_low
comma
r_int
op_star
id|enablePRI_high
comma
r_int
op_star
id|eeprom_present
)paren
(brace
r_uint8
id|brdctl
suffix:semicolon
multiline_comment|/*&n;&t; * BRDDAT7 = Eeprom&n;&t; * BRDDAT6 = Enable Secondary High Byte termination&n;&t; * BRDDAT5 = Enable Secondary Low Byte termination&n;&t; * BRDDAT4 = Enable Primary high byte termination&n;&t; * BRDDAT3 = Enable Primary low byte termination&n;&t; */
id|brdctl
op_assign
id|read_brdctl
c_func
(paren
id|ahc
)paren
suffix:semicolon
op_star
id|eeprom_present
op_assign
id|brdctl
op_amp
id|BRDDAT7
suffix:semicolon
op_star
id|enableSEC_high
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT6
)paren
suffix:semicolon
op_star
id|enableSEC_low
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT5
)paren
suffix:semicolon
op_star
id|enablePRI_high
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT4
)paren
suffix:semicolon
op_star
id|enablePRI_low
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT3
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|aic787X_cable_detect
id|aic787X_cable_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|internal50_present
comma
r_int
op_star
id|internal68_present
comma
r_int
op_star
id|externalcable_present
comma
r_int
op_star
id|eeprom_present
)paren
(brace
r_uint8
id|brdctl
suffix:semicolon
multiline_comment|/*&n;&t; * First read the status of our cables.&n;&t; * Set the rom bank to 0 since the&n;&t; * bank setting serves as a multiplexor&n;&t; * for the cable detection logic.&n;&t; * BRDDAT5 controls the bank switch.&n;&t; */
id|write_brdctl
c_func
(paren
id|ahc
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now read the state of the internal&n;&t; * connectors.  BRDDAT6 is INT50 and&n;&t; * BRDDAT7 is INT68.&n;&t; */
id|brdctl
op_assign
id|read_brdctl
c_func
(paren
id|ahc
)paren
suffix:semicolon
op_star
id|internal50_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT6
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
op_star
id|internal68_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT7
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Set the rom bank to 1 and determine&n;&t; * the other signals.&n;&t; */
id|write_brdctl
c_func
(paren
id|ahc
comma
id|BRDDAT5
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now read the state of the external&n;&t; * connectors.  BRDDAT6 is EXT68 and&n;&t; * BRDDAT7 is EPROMPS.&n;&t; */
id|brdctl
op_assign
id|read_brdctl
c_func
(paren
id|ahc
)paren
suffix:semicolon
op_star
id|externalcable_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT6
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
op_star
id|eeprom_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT7
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|aic785X_cable_detect
id|aic785X_cable_detect
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_int
op_star
id|internal50_present
comma
r_int
op_star
id|externalcable_present
comma
r_int
op_star
id|eeprom_present
)paren
(brace
r_uint8
id|brdctl
suffix:semicolon
r_uint8
id|spiocap
suffix:semicolon
id|spiocap
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SPIOCAP
)paren
suffix:semicolon
id|spiocap
op_and_assign
op_complement
id|SOFTCMDEN
suffix:semicolon
id|spiocap
op_or_assign
id|EXT_BRDCTL
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|SPIOCAP
comma
id|spiocap
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|BRDRW
op_or
id|BRDCS
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
l_int|0
)paren
suffix:semicolon
id|brdctl
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|BRDCTL
)paren
suffix:semicolon
op_star
id|internal50_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT5
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
op_star
id|externalcable_present
op_assign
(paren
id|brdctl
op_amp
id|BRDDAT6
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
op_star
id|eeprom_present
op_assign
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SPIOCAP
)paren
op_amp
id|EEPROM
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|ahc_acquire_seeprom
id|ahc_acquire_seeprom
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_struct
id|seeprom_descriptor
op_star
id|sd
)paren
(brace
r_int
id|wait
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_SPIOCAP
)paren
op_ne
l_int|0
op_logical_and
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SPIOCAP
)paren
op_amp
id|SEEPROM
)paren
op_eq
l_int|0
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Request access of the memory port.  When access is&n;&t; * granted, SEERDY will go high.  We use a 1 second&n;&t; * timeout which should be near 1 second more than&n;&t; * is needed.  Reason: after the chip reset, there&n;&t; * should be no contention.&n;&t; */
id|SEEPROM_OUTB
c_func
(paren
id|sd
comma
id|sd-&gt;sd_MS
)paren
suffix:semicolon
id|wait
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1 second timeout in msec */
r_while
c_loop
(paren
op_decrement
id|wait
op_logical_and
(paren
(paren
id|SEEPROM_STATUS_INB
c_func
(paren
id|sd
)paren
op_amp
id|sd-&gt;sd_RDY
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|ahc_delay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* delay 1 msec */
)brace
r_if
c_cond
(paren
(paren
id|SEEPROM_STATUS_INB
c_func
(paren
id|sd
)paren
op_amp
id|sd-&gt;sd_RDY
)paren
op_eq
l_int|0
)paren
(brace
id|SEEPROM_OUTB
c_func
(paren
id|sd
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|ahc_release_seeprom
id|ahc_release_seeprom
c_func
(paren
r_struct
id|seeprom_descriptor
op_star
id|sd
)paren
(brace
multiline_comment|/* Release access to the memory port and the serial EEPROM. */
id|SEEPROM_OUTB
c_func
(paren
id|sd
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|write_brdctl
id|write_brdctl
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
comma
r_uint8
id|value
)paren
(brace
r_uint8
id|brdctl
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;chip
op_amp
id|AHC_CHIPID_MASK
)paren
op_eq
id|AHC_AIC7895
)paren
(brace
id|brdctl
op_assign
id|BRDSTB
suffix:semicolon
r_if
c_cond
(paren
id|ahc-&gt;channel
op_eq
l_char|&squot;B&squot;
)paren
id|brdctl
op_or_assign
id|BRDCS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
id|brdctl
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|brdctl
op_assign
id|BRDSTB
op_or
id|BRDCS
suffix:semicolon
)brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|brdctl
)paren
suffix:semicolon
id|ahc_flush_device_writes
c_func
(paren
id|ahc
)paren
suffix:semicolon
id|brdctl
op_or_assign
id|value
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|brdctl
)paren
suffix:semicolon
id|ahc_flush_device_writes
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
id|brdctl
op_or_assign
id|BRDSTB_ULTRA2
suffix:semicolon
r_else
id|brdctl
op_and_assign
op_complement
id|BRDSTB
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|brdctl
)paren
suffix:semicolon
id|ahc_flush_device_writes
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
id|brdctl
op_assign
l_int|0
suffix:semicolon
r_else
id|brdctl
op_and_assign
op_complement
id|BRDCS
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|brdctl
)paren
suffix:semicolon
)brace
r_static
r_uint8
DECL|function|read_brdctl
id|read_brdctl
c_func
(paren
id|ahc
)paren
r_struct
id|ahc_softc
op_star
id|ahc
suffix:semicolon
(brace
r_uint8
id|brdctl
suffix:semicolon
r_uint8
id|value
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ahc-&gt;chip
op_amp
id|AHC_CHIPID_MASK
)paren
op_eq
id|AHC_AIC7895
)paren
(brace
id|brdctl
op_assign
id|BRDRW
suffix:semicolon
r_if
c_cond
(paren
id|ahc-&gt;channel
op_eq
l_char|&squot;B&squot;
)paren
id|brdctl
op_or_assign
id|BRDCS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|ahc-&gt;features
op_amp
id|AHC_ULTRA2
)paren
op_ne
l_int|0
)paren
(brace
id|brdctl
op_assign
id|BRDRW_ULTRA2
suffix:semicolon
)brace
r_else
(brace
id|brdctl
op_assign
id|BRDRW
op_or
id|BRDCS
suffix:semicolon
)brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
id|brdctl
)paren
suffix:semicolon
id|ahc_flush_device_writes
c_func
(paren
id|ahc
)paren
suffix:semicolon
id|value
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|BRDCTL
)paren
suffix:semicolon
id|ahc_outb
c_func
(paren
id|ahc
comma
id|BRDCTL
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|value
)paren
suffix:semicolon
)brace
r_void
DECL|function|ahc_pci_intr
id|ahc_pci_intr
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|u_int
id|error
suffix:semicolon
id|u_int
id|status1
suffix:semicolon
id|error
op_assign
id|ahc_inb
c_func
(paren
id|ahc
comma
id|ERROR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_amp
id|PCIERRSTAT
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|status1
op_assign
id|ahc_pci_read_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_STATUS
op_plus
l_int|1
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%s: PCI error Interrupt at seqaddr = 0x%x&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
comma
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SEQADDR0
)paren
op_or
(paren
id|ahc_inb
c_func
(paren
id|ahc
comma
id|SEQADDR1
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status1
op_amp
id|DPE
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Data Parity Error Detected during address &quot;
l_string|&quot;or write data phase&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status1
op_amp
id|SSE
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Signal System Error Detected&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status1
op_amp
id|RMA
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Received a Master Abort&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status1
op_amp
id|RTA
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Received a Target Abort&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status1
op_amp
id|STA
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Signaled a Target Abort&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status1
op_amp
id|DPR
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Data Parity Error has been reported via PERR#&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear latched errors. */
id|ahc_pci_write_config
c_func
(paren
id|ahc-&gt;dev_softc
comma
id|PCIR_STATUS
op_plus
l_int|1
comma
id|status1
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status1
op_amp
(paren
id|DPE
op_or
id|SSE
op_or
id|RMA
op_or
id|RTA
op_or
id|STA
op_or
id|DPR
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s: Latched PCIERR interrupt with &quot;
l_string|&quot;no status bits set&bslash;n&quot;
comma
id|ahc_name
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ahc_outb
c_func
(paren
id|ahc
comma
id|CLRINT
comma
id|CLRPARERR
)paren
suffix:semicolon
)brace
id|ahc_unpause
c_func
(paren
id|ahc
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic785X_setup
id|ahc_aic785X_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
r_uint8
id|rev
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7850
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7850_FE
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_TMODE_WIDEODD_BUG
op_or
id|AHC_CACHETHEN_BUG
op_or
id|AHC_PCI_MWI_BUG
suffix:semicolon
id|rev
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_REVID
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ge
l_int|1
)paren
id|ahc-&gt;bugs
op_or_assign
id|AHC_PCI_2_1_RETRY_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7860_setup
id|ahc_aic7860_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
r_uint8
id|rev
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7860
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7860_FE
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_TMODE_WIDEODD_BUG
op_or
id|AHC_CACHETHEN_BUG
op_or
id|AHC_PCI_MWI_BUG
suffix:semicolon
id|rev
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_REVID
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ge
l_int|1
)paren
id|ahc-&gt;bugs
op_or_assign
id|AHC_PCI_2_1_RETRY_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_apa1480_setup
id|ahc_apa1480_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7860_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
id|ahc-&gt;features
op_or_assign
id|AHC_REMOVABLE
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7870_setup
id|ahc_aic7870_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7870
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7870_FE
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_TMODE_WIDEODD_BUG
op_or
id|AHC_CACHETHEN_BUG
op_or
id|AHC_PCI_MWI_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha394X_setup
id|ahc_aha394X_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7870_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|ahc_aha394XX_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha398X_setup
id|ahc_aha398X_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7870_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|ahc_aha398XX_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha494X_setup
id|ahc_aha494X_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7870_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|ahc_aha494XX_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7880_setup
id|ahc_aic7880_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
r_uint8
id|rev
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7880
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7880_FE
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_TMODE_WIDEODD_BUG
suffix:semicolon
id|rev
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_REVID
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ge
l_int|1
)paren
(brace
id|ahc-&gt;bugs
op_or_assign
id|AHC_PCI_2_1_RETRY_BUG
suffix:semicolon
)brace
r_else
(brace
id|ahc-&gt;bugs
op_or_assign
id|AHC_CACHETHEN_BUG
op_or
id|AHC_PCI_MWI_BUG
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha2940Pro_setup
id|ahc_aha2940Pro_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc-&gt;flags
op_or_assign
id|AHC_INT50_SPEEDFLEX
suffix:semicolon
r_return
(paren
id|ahc_aic7880_setup
c_func
(paren
id|ahc
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha394XU_setup
id|ahc_aha394XU_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7880_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|ahc_aha394XX_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha398XU_setup
id|ahc_aha398XU_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7880_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|ahc_aha398XX_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_return
(paren
id|error
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7890_setup
id|ahc_aic7890_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
r_uint8
id|rev
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7890
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7890_FE
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
id|rev
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_REVID
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|0
)paren
id|ahc-&gt;bugs
op_or_assign
id|AHC_AUTOFLUSH_BUG
op_or
id|AHC_CACHETHEN_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7892_setup
id|ahc_aic7892_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7892
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7892_FE
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_SCBCHAN_UPLOAD_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7895_setup
id|ahc_aic7895_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
r_uint8
id|rev
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
id|ahc_get_pci_function
c_func
(paren
id|pci
)paren
op_eq
l_int|1
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
suffix:semicolon
multiline_comment|/*&n;&t; * The &squot;C&squot; revision of the aic7895 has a few additional features.&n;&t; */
id|rev
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_REVID
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ge
l_int|4
)paren
(brace
id|ahc-&gt;chip
op_assign
id|AHC_AIC7895C
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7895C_FE
suffix:semicolon
)brace
r_else
(brace
id|u_int
id|command
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7895
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7895_FE
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The BIOS disables the use of MWI transactions&n;&t;&t; * since it does not have the MWI bug work around&n;&t;&t; * we have.  Disabling MWI reduces performance, so&n;&t;&t; * turn it on again.&n;&t;&t; */
id|command
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|PCIR_COMMAND
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|command
op_or_assign
id|PCIM_CMD_MWRICEN
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|pci
comma
id|PCIR_COMMAND
comma
id|command
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_PCI_MWI_BUG
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * XXX Does CACHETHEN really not work???  What about PCI retry?&n;&t; * on C level chips.  Need to test, but for now, play it safe.&n;&t; */
id|ahc-&gt;bugs
op_or_assign
id|AHC_TMODE_WIDEODD_BUG
op_or
id|AHC_PCI_2_1_RETRY_BUG
op_or
id|AHC_CACHETHEN_BUG
suffix:semicolon
macro_line|#if 0
r_uint32
id|devconfig
suffix:semicolon
multiline_comment|/*&n;&t; * Cachesize must also be zero due to stray DAC&n;&t; * problem when sitting behind some bridges.&n;&t; */
id|ahc_pci_write_config
c_func
(paren
id|pci
comma
id|CSIZE_LATTIME
comma
l_int|0
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|devconfig
op_assign
id|ahc_pci_read_config
c_func
(paren
id|pci
comma
id|DEVCONFIG
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
id|devconfig
op_or_assign
id|MRDCEN
suffix:semicolon
id|ahc_pci_write_config
c_func
(paren
id|pci
comma
id|DEVCONFIG
comma
id|devconfig
comma
multiline_comment|/*bytes*/
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7896_setup
id|ahc_aic7896_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
id|ahc_get_pci_function
c_func
(paren
id|pci
)paren
op_eq
l_int|1
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7896
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7896_FE
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_CACHETHEN_DIS_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aic7899_setup
id|ahc_aic7899_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
id|ahc-&gt;channel
op_assign
id|ahc_get_pci_function
c_func
(paren
id|pci
)paren
op_eq
l_int|1
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
suffix:semicolon
id|ahc-&gt;chip
op_assign
id|AHC_AIC7899
suffix:semicolon
id|ahc-&gt;features
op_assign
id|AHC_AIC7899_FE
suffix:semicolon
id|ahc-&gt;flags
op_or_assign
id|AHC_NEWEEPROM_FMT
suffix:semicolon
id|ahc-&gt;bugs
op_or_assign
id|AHC_SCBCHAN_UPLOAD_BUG
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha29160C_setup
id|ahc_aha29160C_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|ahc_aic7899_setup
c_func
(paren
id|ahc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
l_int|0
)paren
r_return
(paren
id|error
)paren
suffix:semicolon
id|ahc-&gt;features
op_or_assign
id|AHC_REMOVABLE
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_raid_setup
id|ahc_raid_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;RAID functionality unsupported&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|ENXIO
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha394XX_setup
id|ahc_aha394XX_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
r_switch
c_cond
(paren
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
(brace
r_case
id|AHC_394X_SLOT_CHANNEL_A
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_394X_SLOT_CHANNEL_B
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;B&squot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printf
c_func
(paren
l_string|&quot;adapter at unexpected slot %d&bslash;n&quot;
l_string|&quot;unable to map to a channel&bslash;n&quot;
comma
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha398XX_setup
id|ahc_aha398XX_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
r_switch
c_cond
(paren
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
(brace
r_case
id|AHC_398X_SLOT_CHANNEL_A
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_398X_SLOT_CHANNEL_B
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;B&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_398X_SLOT_CHANNEL_C
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;C&squot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printf
c_func
(paren
l_string|&quot;adapter at unexpected slot %d&bslash;n&quot;
l_string|&quot;unable to map to a channel&bslash;n&quot;
comma
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ahc-&gt;flags
op_or_assign
id|AHC_LARGE_SEEPROM
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ahc_aha494XX_setup
id|ahc_aha494XX_setup
c_func
(paren
r_struct
id|ahc_softc
op_star
id|ahc
)paren
(brace
id|ahc_dev_softc_t
id|pci
suffix:semicolon
id|pci
op_assign
id|ahc-&gt;dev_softc
suffix:semicolon
r_switch
c_cond
(paren
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
(brace
r_case
id|AHC_494X_SLOT_CHANNEL_A
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_494X_SLOT_CHANNEL_B
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;B&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_494X_SLOT_CHANNEL_C
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;C&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AHC_494X_SLOT_CHANNEL_D
suffix:colon
id|ahc-&gt;channel
op_assign
l_char|&squot;D&squot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printf
c_func
(paren
l_string|&quot;adapter at unexpected slot %d&bslash;n&quot;
l_string|&quot;unable to map to a channel&bslash;n&quot;
comma
id|ahc_get_pci_slot
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|ahc-&gt;channel
op_assign
l_char|&squot;A&squot;
suffix:semicolon
)brace
id|ahc-&gt;flags
op_or_assign
id|AHC_LARGE_SEEPROM
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
eof
