multiline_comment|/*&n; * IBM ASM Service Processor Device Driver&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; *&n; * Copyright (C) IBM Corporation, 2004&n; *&n; * Author: Max Asb&#xfffd;ck &lt;amax@us.ibm.com&gt; &n; *&n; */
macro_line|#include &quot;ibmasm.h&quot;
macro_line|#include &quot;lowlevel.h&quot;
macro_line|#include &quot;i2o.h&quot;
macro_line|#include &quot;dot_command.h&quot;
macro_line|#include &quot;remote.h&quot;
DECL|variable|header
r_static
r_struct
id|i2o_header
id|header
op_assign
id|I2O_HEADER_TEMPLATE
suffix:semicolon
DECL|function|ibmasm_send_i2o_message
r_int
id|ibmasm_send_i2o_message
c_func
(paren
r_struct
id|service_processor
op_star
id|sp
)paren
(brace
id|u32
id|mfa
suffix:semicolon
r_int
r_int
id|command_size
suffix:semicolon
r_struct
id|i2o_message
op_star
id|message
suffix:semicolon
r_struct
id|command
op_star
id|command
op_assign
id|sp-&gt;current_command
suffix:semicolon
id|mfa
op_assign
id|get_mfa_inbound
c_func
(paren
id|sp-&gt;base_address
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mfa
)paren
r_return
l_int|1
suffix:semicolon
id|command_size
op_assign
id|get_dot_command_size
c_func
(paren
id|command-&gt;buffer
)paren
suffix:semicolon
id|header.message_size
op_assign
id|outgoing_message_size
c_func
(paren
id|command_size
)paren
suffix:semicolon
id|message
op_assign
id|get_i2o_message
c_func
(paren
id|sp-&gt;base_address
comma
id|mfa
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|message-&gt;header
comma
op_amp
id|header
comma
r_sizeof
(paren
r_struct
id|i2o_header
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|message-&gt;data
comma
id|command-&gt;buffer
comma
id|command_size
)paren
suffix:semicolon
id|set_mfa_inbound
c_func
(paren
id|sp-&gt;base_address
comma
id|mfa
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ibmasm_interrupt_handler
id|irqreturn_t
id|ibmasm_interrupt_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|mfa
suffix:semicolon
r_struct
id|service_processor
op_star
id|sp
op_assign
(paren
r_struct
id|service_processor
op_star
)paren
id|dev_id
suffix:semicolon
r_void
id|__iomem
op_star
id|base_address
op_assign
id|sp-&gt;base_address
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp_interrupt_pending
c_func
(paren
id|base_address
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
r_if
c_cond
(paren
id|mouse_interrupt_pending
c_func
(paren
id|sp
)paren
)paren
(brace
id|ibmasm_handle_mouse_interrupt
c_func
(paren
id|sp
)paren
suffix:semicolon
id|mfa
op_assign
id|get_mfa_outbound
c_func
(paren
id|base_address
)paren
suffix:semicolon
id|clear_mouse_interrupt
c_func
(paren
id|sp
)paren
suffix:semicolon
id|set_mfa_outbound
c_func
(paren
id|base_address
comma
id|mfa
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
id|mfa
op_assign
id|get_mfa_outbound
c_func
(paren
id|base_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|valid_mfa
c_func
(paren
id|mfa
)paren
)paren
(brace
r_struct
id|i2o_message
op_star
id|msg
op_assign
id|get_i2o_message
c_func
(paren
id|base_address
comma
id|mfa
)paren
suffix:semicolon
id|ibmasm_receive_message
c_func
(paren
id|sp
comma
op_amp
id|msg-&gt;data
comma
id|incoming_data_size
c_func
(paren
id|msg
)paren
)paren
suffix:semicolon
)brace
id|set_mfa_outbound
c_func
(paren
id|base_address
comma
id|mfa
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
eof
