multiline_comment|/*&n; * linux/arch/i386/kernel/edd.c&n; *  Copyright (C) 2002, 2003, 2004 Dell Inc.&n; *  by Matt Domsch &lt;Matt_Domsch@dell.com&gt;&n; *  disk signature by Matt Domsch, Andrew Wilks, and Sandeep K. Shandilya&n; *  legacy CHS by Patrick J. LoPresti &lt;patl@users.sourceforge.net&gt;&n; *&n; * BIOS Enhanced Disk Drive Services (EDD)&n; * conformant to T13 Committee www.t13.org&n; *   projects 1572D, 1484D, 1386D, 1226DT&n; *&n; * This code takes information provided by BIOS EDD calls&n; * fn41 - Check Extensions Present and&n; * fn48 - Get Device Parametes with EDD extensions&n; * made in setup.S, copied to safe structures in setup.c,&n; * and presents it in sysfs.&n; *&n; * Please see http://linux.dell.com/edd30/results.html for&n; * the list of BIOSs which have been reported to implement EDD.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License v2.0 as published by&n; * the Free Software Foundation&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/limits.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/edd.h&gt;
DECL|macro|EDD_VERSION
mdefine_line|#define EDD_VERSION &quot;0.16&quot;
DECL|macro|EDD_DATE
mdefine_line|#define EDD_DATE    &quot;2004-Jun-25&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Matt Domsch &lt;Matt_Domsch@Dell.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;sysfs interface to BIOS EDD information&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|EDD_VERSION
id|MODULE_VERSION
c_func
(paren
id|EDD_VERSION
)paren
suffix:semicolon
DECL|macro|left
mdefine_line|#define left (PAGE_SIZE - (p - buf) - 1)
DECL|struct|edd_device
r_struct
id|edd_device
(brace
DECL|member|index
r_int
r_int
id|index
suffix:semicolon
DECL|member|mbr_signature
r_int
r_int
id|mbr_signature
suffix:semicolon
DECL|member|info
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
DECL|member|kobj
r_struct
id|kobject
id|kobj
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|edd_attribute
r_struct
id|edd_attribute
(brace
DECL|member|attr
r_struct
id|attribute
id|attr
suffix:semicolon
DECL|member|show
id|ssize_t
c_func
(paren
op_star
id|show
)paren
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
suffix:semicolon
DECL|member|test
r_int
(paren
op_star
id|test
)paren
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* forward declarations */
r_static
r_int
id|edd_dev_is_type
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_const
r_char
op_star
id|type
)paren
suffix:semicolon
r_static
r_struct
id|pci_dev
op_star
id|edd_get_pci_dev
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
suffix:semicolon
DECL|variable|edd_devices
r_static
r_struct
id|edd_device
op_star
id|edd_devices
(braket
id|EDD_MBR_SIG_MAX
)braket
suffix:semicolon
DECL|macro|EDD_DEVICE_ATTR
mdefine_line|#define EDD_DEVICE_ATTR(_name,_mode,_show,_test) &bslash;&n;struct edd_attribute edd_attr_##_name = { &t;&bslash;&n;&t;.attr = {.name = __stringify(_name), .mode = _mode, .owner = THIS_MODULE },&t;&bslash;&n;&t;.show&t;= _show,&t;&t;&t;&t;&bslash;&n;&t;.test&t;= _test,&t;&t;&t;&t;&bslash;&n;};
r_static
r_int
DECL|function|edd_has_mbr_signature
id|edd_has_mbr_signature
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_return
id|edev-&gt;index
OL
id|min_t
c_func
(paren
r_int
r_char
comma
id|edd.mbr_signature_nr
comma
id|EDD_MBR_SIG_MAX
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_edd_info
id|edd_has_edd_info
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_return
id|edev-&gt;index
OL
id|min_t
c_func
(paren
r_int
r_char
comma
id|edd.edd_info_nr
comma
id|EDDMAXNR
)paren
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|edd_info
op_star
DECL|function|edd_dev_get_info
id|edd_dev_get_info
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_return
id|edev-&gt;info
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|edd_dev_set_info
id|edd_dev_set_info
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_int
id|i
)paren
(brace
id|edev-&gt;index
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|edd_has_mbr_signature
c_func
(paren
id|edev
)paren
)paren
id|edev-&gt;mbr_signature
op_assign
id|edd.mbr_signature
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|edd_has_edd_info
c_func
(paren
id|edev
)paren
)paren
id|edev-&gt;info
op_assign
op_amp
id|edd.edd_info
(braket
id|i
)braket
suffix:semicolon
)brace
DECL|macro|to_edd_attr
mdefine_line|#define to_edd_attr(_attr) container_of(_attr,struct edd_attribute,attr)
DECL|macro|to_edd_device
mdefine_line|#define to_edd_device(obj) container_of(obj,struct edd_device,kobj)
r_static
id|ssize_t
DECL|function|edd_attr_show
id|edd_attr_show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_device
op_star
id|dev
op_assign
id|to_edd_device
c_func
(paren
id|kobj
)paren
suffix:semicolon
r_struct
id|edd_attribute
op_star
id|edd_attr
op_assign
id|to_edd_attr
c_func
(paren
id|attr
)paren
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|edd_attr-&gt;show
)paren
id|ret
op_assign
id|edd_attr
op_member_access_from_pointer
id|show
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|edd_attr_ops
r_static
r_struct
id|sysfs_ops
id|edd_attr_ops
op_assign
(brace
dot
id|show
op_assign
id|edd_attr_show
comma
)brace
suffix:semicolon
r_static
id|ssize_t
DECL|function|edd_show_host_bus
id|edd_show_host_bus
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isprint
c_func
(paren
id|info-&gt;params.host_bus_type
(braket
id|i
)braket
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%c&quot;
comma
id|info-&gt;params.host_bus_type
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;ISA&quot;
comma
l_int|3
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tbase_address: %x&bslash;n&quot;
comma
id|info-&gt;params.interface_path.isa.base_address
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;PCIX&quot;
comma
l_int|4
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;PCI&quot;
comma
l_int|3
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;t%02x:%02x.%d  channel: %u&bslash;n&quot;
comma
id|info-&gt;params.interface_path.pci.bus
comma
id|info-&gt;params.interface_path.pci.slot
comma
id|info-&gt;params.interface_path.pci.function
comma
id|info-&gt;params.interface_path.pci.channel
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;IBND&quot;
comma
l_int|4
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;XPRS&quot;
comma
l_int|4
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
l_string|&quot;HTPT&quot;
comma
l_int|4
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tTBD: %llx&bslash;n&quot;
comma
id|info-&gt;params.interface_path.ibnd.reserved
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tunknown: %llx&bslash;n&quot;
comma
id|info-&gt;params.interface_path.unknown.reserved
)paren
suffix:semicolon
)brace
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_interface
id|edd_show_interface
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isprint
c_func
(paren
id|info-&gt;params.interface_type
(braket
id|i
)braket
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%c&quot;
comma
id|info-&gt;params.interface_type
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;ATAPI&quot;
comma
l_int|5
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tdevice: %u  lun: %u&bslash;n&quot;
comma
id|info-&gt;params.device_path.atapi.device
comma
id|info-&gt;params.device_path.atapi.lun
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;ATA&quot;
comma
l_int|3
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tdevice: %u&bslash;n&quot;
comma
id|info-&gt;params.device_path.ata.device
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;SCSI&quot;
comma
l_int|4
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tid: %u  lun: %llu&bslash;n&quot;
comma
id|info-&gt;params.device_path.scsi.id
comma
id|info-&gt;params.device_path.scsi.lun
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;USB&quot;
comma
l_int|3
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tserial_number: %llx&bslash;n&quot;
comma
id|info-&gt;params.device_path.usb.serial_number
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;1394&quot;
comma
l_int|4
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;teui: %llx&bslash;n&quot;
comma
id|info-&gt;params.device_path.i1394.eui
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;FIBRE&quot;
comma
l_int|5
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;twwid: %llx lun: %llx&bslash;n&quot;
comma
id|info-&gt;params.device_path.fibre.wwid
comma
id|info-&gt;params.device_path.fibre.lun
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;I2O&quot;
comma
l_int|3
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tidentity_tag: %llx&bslash;n&quot;
comma
id|info-&gt;params.device_path.i2o.identity_tag
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;RAID&quot;
comma
l_int|4
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tidentity_tag: %x&bslash;n&quot;
comma
id|info-&gt;params.device_path.raid.array_number
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
l_string|&quot;SATA&quot;
comma
l_int|4
)paren
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tdevice: %u&bslash;n&quot;
comma
id|info-&gt;params.device_path.sata.device
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;&bslash;tunknown: %llx %llx&bslash;n&quot;
comma
id|info-&gt;params.device_path.unknown.reserved1
comma
id|info-&gt;params.device_path.unknown.reserved2
)paren
suffix:semicolon
)brace
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * edd_show_raw_data() - copies raw data to buffer for userspace to parse&n; *&n; * Returns: number of bytes written, or -EINVAL on failure&n; */
r_static
id|ssize_t
DECL|function|edd_show_raw_data
id|edd_show_raw_data
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
id|ssize_t
id|len
op_assign
r_sizeof
(paren
id|info-&gt;params
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;params.key
op_eq
l_int|0xBEDD
op_logical_or
id|info-&gt;params.key
op_eq
l_int|0xDDBE
)paren
)paren
id|len
op_assign
id|info-&gt;params.length
suffix:semicolon
multiline_comment|/* In case of buggy BIOSs */
r_if
c_cond
(paren
id|len
OG
(paren
r_sizeof
(paren
id|info-&gt;params
)paren
)paren
)paren
id|len
op_assign
r_sizeof
(paren
id|info-&gt;params
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
op_amp
id|info-&gt;params
comma
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_version
id|edd_show_version
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;0x%02x&bslash;n&quot;
comma
id|info-&gt;version
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_mbr_signature
id|edd_show_mbr_signature
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|edev-&gt;mbr_signature
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_extensions
id|edd_show_extensions
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;interface_support
op_amp
id|EDD_EXT_FIXED_DISK_ACCESS
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;Fixed disk access&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;interface_support
op_amp
id|EDD_EXT_DEVICE_LOCKING_AND_EJECTING
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;Device locking and ejecting&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;interface_support
op_amp
id|EDD_EXT_ENHANCED_DISK_DRIVE_SUPPORT
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;Enhanced Disk Drive support&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;interface_support
op_amp
id|EDD_EXT_64BIT_EXTENSIONS
)paren
(brace
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;64-bit extensions&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_info_flags
id|edd_show_info_flags
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_DMA_BOUNDARY_ERROR_TRANSPARENT
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;DMA boundary error transparent&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_GEOMETRY_VALID
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;geometry valid&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_REMOVABLE
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;removable&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_WRITE_VERIFY
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;write verify&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_MEDIA_CHANGE_NOTIFICATION
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;media change notification&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_LOCKABLE
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;lockable&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_NO_MEDIA_PRESENT
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;no media present&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;params.info_flags
op_amp
id|EDD_INFO_USE_INT13_FN50
)paren
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;use int13 fn50&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_legacy_max_cylinder
id|edd_show_legacy_max_cylinder
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|snprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;legacy_max_cylinder
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_legacy_max_head
id|edd_show_legacy_max_head
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|snprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;legacy_max_head
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_legacy_sectors_per_track
id|edd_show_legacy_sectors_per_track
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|snprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;legacy_sectors_per_track
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_default_cylinders
id|edd_show_default_cylinders
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;params.num_default_cylinders
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_default_heads
id|edd_show_default_heads
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;params.num_default_heads
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_default_sectors_per_track
id|edd_show_default_sectors_per_track
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|info-&gt;params.sectors_per_track
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|edd_show_sectors
id|edd_show_sectors
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
op_logical_or
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_add_assign
id|scnprintf
c_func
(paren
id|p
comma
id|left
comma
l_string|&quot;%llu&bslash;n&quot;
comma
id|info-&gt;params.number_of_sectors
)paren
suffix:semicolon
r_return
(paren
id|p
op_minus
id|buf
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Some device instances may not have all the above attributes,&n; * or the attribute values may be meaningless (i.e. if&n; * the device is &lt; EDD 3.0, it won&squot;t have host_bus and interface&n; * information), so don&squot;t bother making files for them.  Likewise&n; * if the default_{cylinders,heads,sectors_per_track} values&n; * are zero, the BIOS doesn&squot;t provide sane values, don&squot;t bother&n; * creating files for them either.&n; */
r_static
r_int
DECL|function|edd_has_legacy_max_cylinder
id|edd_has_legacy_max_cylinder
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;legacy_max_cylinder
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_legacy_max_head
id|edd_has_legacy_max_head
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;legacy_max_head
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_legacy_sectors_per_track
id|edd_has_legacy_sectors_per_track
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;legacy_sectors_per_track
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_default_cylinders
id|edd_has_default_cylinders
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;params.num_default_cylinders
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_default_heads
id|edd_has_default_heads
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;params.num_default_heads
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_default_sectors_per_track
id|edd_has_default_sectors_per_track
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|info-&gt;params.sectors_per_track
OG
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_has_edd30
id|edd_has_edd30
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_int
id|i
comma
id|nonzero_path
op_assign
l_int|0
suffix:semicolon
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|info-&gt;params.key
op_eq
l_int|0xBEDD
op_logical_or
id|info-&gt;params.key
op_eq
l_int|0xDDBE
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|30
suffix:semicolon
id|i
op_le
l_int|73
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c
op_assign
op_star
(paren
(paren
(paren
r_uint8
op_star
)paren
id|info
)paren
op_plus
id|i
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
)paren
(brace
id|nonzero_path
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|nonzero_path
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|raw_data
comma
l_int|0444
comma
id|edd_show_raw_data
comma
id|edd_has_edd_info
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|version
comma
l_int|0444
comma
id|edd_show_version
comma
id|edd_has_edd_info
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|extensions
comma
l_int|0444
comma
id|edd_show_extensions
comma
id|edd_has_edd_info
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|info_flags
comma
l_int|0444
comma
id|edd_show_info_flags
comma
id|edd_has_edd_info
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|sectors
comma
l_int|0444
comma
id|edd_show_sectors
comma
id|edd_has_edd_info
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|legacy_max_cylinder
comma
l_int|0444
comma
id|edd_show_legacy_max_cylinder
comma
id|edd_has_legacy_max_cylinder
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|legacy_max_head
comma
l_int|0444
comma
id|edd_show_legacy_max_head
comma
id|edd_has_legacy_max_head
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|legacy_sectors_per_track
comma
l_int|0444
comma
id|edd_show_legacy_sectors_per_track
comma
id|edd_has_legacy_sectors_per_track
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|default_cylinders
comma
l_int|0444
comma
id|edd_show_default_cylinders
comma
id|edd_has_default_cylinders
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|default_heads
comma
l_int|0444
comma
id|edd_show_default_heads
comma
id|edd_has_default_heads
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|default_sectors_per_track
comma
l_int|0444
comma
id|edd_show_default_sectors_per_track
comma
id|edd_has_default_sectors_per_track
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|interface
comma
l_int|0444
comma
id|edd_show_interface
comma
id|edd_has_edd30
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|host_bus
comma
l_int|0444
comma
id|edd_show_host_bus
comma
id|edd_has_edd30
)paren
suffix:semicolon
r_static
id|EDD_DEVICE_ATTR
c_func
(paren
id|mbr_signature
comma
l_int|0444
comma
id|edd_show_mbr_signature
comma
id|edd_has_mbr_signature
)paren
suffix:semicolon
multiline_comment|/* These are default attributes that are added for every edd&n; * device discovered.  There are none.&n; */
DECL|variable|def_attrs
r_static
r_struct
id|attribute
op_star
id|def_attrs
(braket
)braket
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
multiline_comment|/* These attributes are conditional and only added for some devices. */
DECL|variable|edd_attrs
r_static
r_struct
id|edd_attribute
op_star
id|edd_attrs
(braket
)braket
op_assign
(brace
op_amp
id|edd_attr_raw_data
comma
op_amp
id|edd_attr_version
comma
op_amp
id|edd_attr_extensions
comma
op_amp
id|edd_attr_info_flags
comma
op_amp
id|edd_attr_sectors
comma
op_amp
id|edd_attr_legacy_max_cylinder
comma
op_amp
id|edd_attr_legacy_max_head
comma
op_amp
id|edd_attr_legacy_sectors_per_track
comma
op_amp
id|edd_attr_default_cylinders
comma
op_amp
id|edd_attr_default_heads
comma
op_amp
id|edd_attr_default_sectors_per_track
comma
op_amp
id|edd_attr_interface
comma
op_amp
id|edd_attr_host_bus
comma
op_amp
id|edd_attr_mbr_signature
comma
l_int|NULL
comma
)brace
suffix:semicolon
multiline_comment|/**&n; *&t;edd_release - free edd structure&n; *&t;@kobj:&t;kobject of edd structure&n; *&n; *&t;This is called when the refcount of the edd structure&n; *&t;reaches 0. This should happen right after we unregister,&n; *&t;but just in case, we use the release callback anyway.&n; */
DECL|function|edd_release
r_static
r_void
id|edd_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
r_struct
id|edd_device
op_star
id|dev
op_assign
id|to_edd_device
c_func
(paren
id|kobj
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|ktype_edd
r_static
r_struct
id|kobj_type
id|ktype_edd
op_assign
(brace
dot
id|release
op_assign
id|edd_release
comma
dot
id|sysfs_ops
op_assign
op_amp
id|edd_attr_ops
comma
dot
id|default_attrs
op_assign
id|def_attrs
comma
)brace
suffix:semicolon
DECL|variable|decl_subsys
r_static
id|decl_subsys
c_func
(paren
id|edd
comma
op_amp
id|ktype_edd
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/**&n; * edd_dev_is_type() - is this EDD device a &squot;type&squot; device?&n; * @edev&n; * @type - a host bus or interface identifier string per the EDD spec&n; *&n; * Returns 1 (TRUE) if it is a &squot;type&squot; device, 0 otherwise.&n; */
r_static
r_int
DECL|function|edd_dev_is_type
id|edd_dev_is_type
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_const
r_char
op_star
id|type
)paren
(brace
r_struct
id|edd_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|0
suffix:semicolon
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_logical_and
id|info
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.host_bus_type
comma
id|type
comma
id|strlen
c_func
(paren
id|type
)paren
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|info-&gt;params.interface_type
comma
id|type
comma
id|strlen
c_func
(paren
id|type
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * edd_get_pci_dev() - finds pci_dev that matches edev&n; * @edev - edd_device&n; *&n; * Returns pci_dev if found, or NULL&n; */
r_static
r_struct
id|pci_dev
op_star
DECL|function|edd_get_pci_dev
id|edd_get_pci_dev
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_info
op_star
id|info
op_assign
id|edd_dev_get_info
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edd_dev_is_type
c_func
(paren
id|edev
comma
l_string|&quot;PCI&quot;
)paren
)paren
(brace
r_return
id|pci_find_slot
c_func
(paren
id|info-&gt;params.interface_path.pci.bus
comma
id|PCI_DEVFN
c_func
(paren
id|info-&gt;params.interface_path.pci.slot
comma
id|info-&gt;params.interface_path.pci
dot
id|function
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_int
DECL|function|edd_create_symlink_to_pcidev
id|edd_create_symlink_to_pcidev
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
id|edd_get_pci_dev
c_func
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_dev
)paren
r_return
l_int|1
suffix:semicolon
r_return
id|sysfs_create_link
c_func
(paren
op_amp
id|edev-&gt;kobj
comma
op_amp
id|pci_dev-&gt;dev.kobj
comma
l_string|&quot;pci_dev&quot;
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|edd_device_unregister
id|edd_device_unregister
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
id|kobject_unregister
c_func
(paren
op_amp
id|edev-&gt;kobj
)paren
suffix:semicolon
)brace
DECL|function|edd_populate_dir
r_static
r_void
id|edd_populate_dir
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
)paren
(brace
r_struct
id|edd_attribute
op_star
id|attr
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|attr
op_assign
id|edd_attrs
(braket
id|i
)braket
)paren
op_logical_and
op_logical_neg
id|error
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|attr-&gt;test
op_logical_or
(paren
id|attr-&gt;test
op_logical_and
id|attr
op_member_access_from_pointer
id|test
c_func
(paren
id|edev
)paren
)paren
)paren
id|error
op_assign
id|sysfs_create_file
c_func
(paren
op_amp
id|edev-&gt;kobj
comma
op_amp
id|attr-&gt;attr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|edd_create_symlink_to_pcidev
c_func
(paren
id|edev
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|edd_device_register
id|edd_device_register
c_func
(paren
r_struct
id|edd_device
op_star
id|edev
comma
r_int
id|i
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|edev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|edev
)paren
)paren
suffix:semicolon
id|edd_dev_set_info
c_func
(paren
id|edev
comma
id|i
)paren
suffix:semicolon
id|kobject_set_name
c_func
(paren
op_amp
id|edev-&gt;kobj
comma
l_string|&quot;int13_dev%02x&quot;
comma
l_int|0x80
op_plus
id|i
)paren
suffix:semicolon
id|kobj_set_kset_s
c_func
(paren
id|edev
comma
id|edd_subsys
)paren
suffix:semicolon
id|error
op_assign
id|kobject_register
c_func
(paren
op_amp
id|edev-&gt;kobj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|edd_populate_dir
c_func
(paren
id|edev
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|edd_num_devices
r_static
r_inline
r_int
id|edd_num_devices
c_func
(paren
r_void
)paren
(brace
r_return
id|max_t
c_func
(paren
r_int
r_char
comma
id|min_t
c_func
(paren
r_int
r_char
comma
id|EDD_MBR_SIG_MAX
comma
id|edd.mbr_signature_nr
)paren
comma
id|min_t
c_func
(paren
r_int
r_char
comma
id|EDDMAXNR
comma
id|edd.edd_info_nr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * edd_init() - creates sysfs tree of EDD data&n; */
r_static
r_int
id|__init
DECL|function|edd_init
id|edd_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|edd_device
op_star
id|edev
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;BIOS EDD facility v%s %s, %d devices found&bslash;n&quot;
comma
id|EDD_VERSION
comma
id|EDD_DATE
comma
id|edd_num_devices
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edd_num_devices
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;EDD information not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|rc
op_assign
id|firmware_register
c_func
(paren
op_amp
id|edd_subsys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|edd_num_devices
c_func
(paren
)paren
op_logical_and
op_logical_neg
id|rc
suffix:semicolon
id|i
op_increment
)paren
(brace
id|edev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|edev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rc
op_assign
id|edd_device_register
c_func
(paren
id|edev
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|kfree
c_func
(paren
id|edev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|edd_devices
(braket
id|i
)braket
op_assign
id|edev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rc
)paren
id|firmware_unregister
c_func
(paren
op_amp
id|edd_subsys
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|edd_exit
id|edd_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|edd_device
op_star
id|edev
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|edd_num_devices
c_func
(paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|edev
op_assign
id|edd_devices
(braket
id|i
)braket
)paren
)paren
id|edd_device_unregister
c_func
(paren
id|edev
)paren
suffix:semicolon
)brace
id|firmware_unregister
c_func
(paren
op_amp
id|edd_subsys
)paren
suffix:semicolon
)brace
DECL|variable|edd_init
id|late_initcall
c_func
(paren
id|edd_init
)paren
suffix:semicolon
DECL|variable|edd_exit
id|module_exit
c_func
(paren
id|edd_exit
)paren
suffix:semicolon
eof
