multiline_comment|/*&n; *  Copyright (C) 1997-1998&t;Mark Lord&n; *&n; * This is the /proc/ide/ filesystem implementation.&n; *&n; * The major reason this exists is to provide sufficient access&n; * to driver and config data, such that user-mode programs can&n; * be developed to handle chipset tuning for most PCI interfaces.&n; * This should provide better utilities, and less kernel bloat.&n; *&n; * The entire pci config space for a PCI interface chipset can be&n; * retrieved by just reading it.  e.g.    &quot;cat /proc/ide3/config&quot;&n; *&n; * To modify registers *safely*, do something like:&n; *   echo &quot;P40:88&quot; &gt;/proc/ide/ide3/config&n; * That expression writes 0x88 to pci config register 0x40&n; * on the chip which controls ide3.  Multiple tuples can be issued,&n; * and the writes will be completed as an atomic set:&n; *   echo &quot;P40:88 P41:35 P42:00 P43:00&quot; &gt;/proc/ide/ide3/config&n; *&n; * All numbers must be specified using pairs of ascii hex digits.&n; * It is important to note that these writes will be performed&n; * after waiting for the IDE controller (both interfaces)&n; * to be completely idle, to ensure no corruption of I/O in progress.&n; *&n; * Non-PCI registers can also be written, using &quot;R&quot; in place of &quot;P&quot;&n; * in the above examples.  The size of the port transfer is determined&n; * by the number of pairs of hex digits given for the data.  If a two&n; * digit value is given, the write will be a byte operation; if four&n; * digits are used, the write will be performed as a 16-bit operation;&n; * and if eight digits are specified, a 32-bit &quot;dword&quot; write will be&n; * performed.  Odd numbers of digits are not permitted.&n; *&n; * If there is an error *anywhere* in the string of registers/data&n; * then *none* of the writes will be performed.&n; *&n; * Drive/Driver settings can be retrieved by reading the drive&squot;s&n; * &quot;settings&quot; files.  e.g.    &quot;cat /proc/ide0/hda/settings&quot;&n; * To write a new value &quot;val&quot; into a specific setting &quot;name&quot;, use:&n; *   echo &quot;name:val&quot; &gt;/proc/ide/ide0/hda/settings&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) (((a) &lt; (b)) ? (a) : (b))
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_extern
id|byte
id|aec62xx_proc
suffix:semicolon
DECL|variable|aec62xx_display_info
r_int
(paren
op_star
id|aec62xx_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_extern
id|byte
id|ali_proc
suffix:semicolon
DECL|variable|ali_display_info
r_int
(paren
op_star
id|ali_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD74XX
r_extern
id|byte
id|amd74xx_proc
suffix:semicolon
DECL|variable|amd74xx_display_info
r_int
(paren
op_star
id|amd74xx_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD74XX */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_extern
id|byte
id|cmd64x_proc
suffix:semicolon
DECL|variable|cmd64x_display_info
r_int
(paren
op_star
id|cmd64x_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_extern
id|byte
id|cs5530_proc
suffix:semicolon
DECL|variable|cs5530_display_info
r_int
(paren
op_star
id|cs5530_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_extern
id|byte
id|hpt34x_proc
suffix:semicolon
DECL|variable|hpt34x_display_info
r_int
(paren
op_star
id|hpt34x_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_extern
id|byte
id|hpt366_proc
suffix:semicolon
DECL|variable|hpt366_display_info
r_int
(paren
op_star
id|hpt366_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_extern
id|byte
id|pdc202xx_proc
suffix:semicolon
DECL|variable|pdc202xx_display_info
r_int
(paren
op_star
id|pdc202xx_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_extern
id|byte
id|piix_proc
suffix:semicolon
DECL|variable|piix_display_info
r_int
(paren
op_star
id|piix_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SVWKS
r_extern
id|byte
id|svwks_proc
suffix:semicolon
DECL|variable|svwks_display_info
r_int
(paren
op_star
id|svwks_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SVWKS */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_extern
id|byte
id|sis_proc
suffix:semicolon
DECL|variable|sis_display_info
r_int
(paren
op_star
id|sis_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_extern
id|byte
id|via_proc
suffix:semicolon
DECL|variable|via_display_info
r_int
(paren
op_star
id|via_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
DECL|variable|proc_ide_root
r_static
r_struct
id|proc_dir_entry
op_star
id|proc_ide_root
op_assign
l_int|NULL
suffix:semicolon
DECL|function|ide_getdigit
r_static
r_int
id|ide_getdigit
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|digit
suffix:semicolon
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|c
)paren
)paren
id|digit
op_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_else
id|digit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|digit
suffix:semicolon
)brace
DECL|function|proc_ide_read_settings
r_static
r_int
id|proc_ide_read_settings
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
id|data
suffix:semicolon
id|ide_settings_t
op_star
id|setting
op_assign
id|drive-&gt;settings
suffix:semicolon
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
comma
id|rc
comma
id|mul_factor
comma
id|div_factor
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;name&bslash;t&bslash;t&bslash;tvalue&bslash;t&bslash;tmin&bslash;t&bslash;tmax&bslash;t&bslash;tmode&bslash;n&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;----&bslash;t&bslash;t&bslash;t-----&bslash;t&bslash;t---&bslash;t&bslash;t---&bslash;t&bslash;t----&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|setting
)paren
(brace
id|mul_factor
op_assign
id|setting-&gt;mul_factor
suffix:semicolon
id|div_factor
op_assign
id|setting-&gt;div_factor
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-24s&quot;
comma
id|setting-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ide_read_setting
c_func
(paren
id|drive
comma
id|setting
)paren
)paren
op_ge
l_int|0
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16d&quot;
comma
id|rc
op_star
id|mul_factor
op_div
id|div_factor
)paren
suffix:semicolon
r_else
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16s&quot;
comma
l_string|&quot;write-only&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16d%-16d&quot;
comma
(paren
id|setting-&gt;min
op_star
id|mul_factor
op_plus
id|div_factor
op_minus
l_int|1
)paren
op_div
id|div_factor
comma
id|setting-&gt;max
op_star
id|mul_factor
op_div
id|div_factor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setting-&gt;rw
op_amp
id|SETTING_READ
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setting-&gt;rw
op_amp
id|SETTING_WRITE
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|setting
op_assign
id|setting-&gt;next
suffix:semicolon
)brace
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|macro|MAX_LEN
mdefine_line|#define MAX_LEN&t;30
DECL|function|proc_ide_write_settings
r_static
r_int
id|proc_ide_write_settings
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
id|data
suffix:semicolon
r_char
id|name
(braket
id|MAX_LEN
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|for_real
op_assign
l_int|0
comma
id|len
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
r_const
r_char
op_star
id|start
op_assign
l_int|NULL
suffix:semicolon
id|ide_settings_t
op_star
id|setting
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
multiline_comment|/*&n;&t; * Skip over leading whitespace&n;&t; */
r_while
c_loop
(paren
id|count
op_logical_and
id|isspace
c_func
(paren
op_star
id|buffer
)paren
)paren
(brace
op_decrement
id|count
suffix:semicolon
op_increment
id|buffer
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Do one full pass to verify all parameters,&n;&t; * then do another to actually write the new settings.&n;&t; */
r_do
(brace
r_const
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|buffer
suffix:semicolon
id|n
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
)paren
(brace
r_int
id|d
comma
id|digits
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|start
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
(brace
op_decrement
id|n
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
r_goto
id|parse_error
suffix:semicolon
id|len
op_assign
id|min
c_func
(paren
id|p
op_minus
id|start
comma
id|MAX_LEN
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|name
comma
id|start
comma
id|min
c_func
(paren
id|len
comma
id|MAX_LEN
)paren
)paren
suffix:semicolon
id|name
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|0
)paren
(brace
op_decrement
id|n
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
r_else
r_goto
id|parse_error
suffix:semicolon
id|digits
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
(paren
id|d
op_assign
id|ide_getdigit
c_func
(paren
op_star
id|p
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|val
op_assign
(paren
id|val
op_star
l_int|10
)paren
op_plus
id|d
suffix:semicolon
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
op_increment
id|digits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
OG
l_int|0
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
r_goto
id|parse_error
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
(brace
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
)brace
multiline_comment|/* Find setting by name */
id|setting
op_assign
id|drive-&gt;settings
suffix:semicolon
r_while
c_loop
(paren
id|setting
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|setting-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|setting
op_assign
id|setting-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|setting
)paren
r_goto
id|parse_error
suffix:semicolon
r_if
c_cond
(paren
id|for_real
)paren
id|ide_write_setting
c_func
(paren
id|drive
comma
id|setting
comma
id|val
op_star
id|setting-&gt;div_factor
op_div
id|setting-&gt;mul_factor
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
id|for_real
op_increment
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
id|parse_error
suffix:colon
id|printk
c_func
(paren
l_string|&quot;proc_ide_write_settings(): parse error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|generic_drive_entries
r_static
id|ide_proc_entry_t
id|generic_drive_entries
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;settings&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|proc_ide_read_settings
comma
id|proc_ide_write_settings
)brace
comma
(brace
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|ide_add_proc_entries
r_void
id|ide_add_proc_entries
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|dir
comma
id|ide_proc_entry_t
op_star
id|p
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir
op_logical_or
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|p-&gt;name
op_ne
l_int|NULL
)paren
(brace
id|ent
op_assign
id|create_proc_entry
c_func
(paren
id|p-&gt;name
comma
id|p-&gt;mode
comma
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
r_return
suffix:semicolon
id|ent-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|ent-&gt;data
op_assign
id|data
suffix:semicolon
id|ent-&gt;read_proc
op_assign
id|p-&gt;read_proc
suffix:semicolon
id|ent-&gt;write_proc
op_assign
id|p-&gt;write_proc
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
DECL|function|ide_remove_proc_entries
r_void
id|ide_remove_proc_entries
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|dir
comma
id|ide_proc_entry_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dir
op_logical_or
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|p-&gt;name
op_ne
l_int|NULL
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|p-&gt;name
comma
id|dir
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* FIXME: we should iterate over the hwifs here as everywhere else.&n; */
DECL|function|create_proc_ide_drives
r_static
r_void
id|create_proc_ide_drives
c_func
(paren
r_struct
id|ata_channel
op_star
id|hwif
)paren
(brace
r_int
id|d
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|parent
op_assign
id|hwif-&gt;proc
suffix:semicolon
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
l_int|0
suffix:semicolon
id|d
OL
id|MAX_DRIVES
suffix:semicolon
id|d
op_increment
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
op_amp
id|hwif-&gt;drives
(braket
id|d
)braket
suffix:semicolon
r_struct
id|ata_operations
op_star
id|driver
op_assign
id|drive-&gt;driver
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drive-&gt;present
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
r_continue
suffix:semicolon
id|drive-&gt;proc
op_assign
id|proc_mkdir
c_func
(paren
id|drive-&gt;name
comma
id|parent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
(brace
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_drive_entries
comma
id|drive
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
(brace
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_subdriver_entries
comma
id|drive
)paren
suffix:semicolon
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|driver-&gt;proc
comma
id|drive
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;ide%d/%s&quot;
comma
(paren
id|drive-&gt;name
(braket
l_int|2
)braket
op_minus
l_char|&squot;a&squot;
)paren
op_div
l_int|2
comma
id|drive-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|destroy_proc_ide_device
r_static
r_void
id|destroy_proc_ide_device
c_func
(paren
r_struct
id|ata_channel
op_star
id|hwif
comma
id|ide_drive_t
op_star
id|drive
)paren
(brace
r_struct
id|ata_operations
op_star
id|driver
op_assign
id|drive-&gt;driver
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
(brace
r_if
c_cond
(paren
id|driver
)paren
id|ide_remove_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|driver-&gt;proc
)paren
suffix:semicolon
id|ide_remove_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_drive_entries
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|drive-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|drive-&gt;name
comma
id|hwif-&gt;proc
)paren
suffix:semicolon
id|drive-&gt;proc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|destroy_proc_ide_drives
r_void
id|destroy_proc_ide_drives
c_func
(paren
r_struct
id|ata_channel
op_star
id|hwif
)paren
(brace
r_int
id|d
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
l_int|0
suffix:semicolon
id|d
OL
id|MAX_DRIVES
suffix:semicolon
id|d
op_increment
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
op_amp
id|hwif-&gt;drives
(braket
id|d
)braket
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
id|destroy_proc_ide_device
c_func
(paren
id|hwif
comma
id|drive
)paren
suffix:semicolon
)brace
)brace
DECL|function|create_proc_ide_interfaces
r_void
id|create_proc_ide_interfaces
c_func
(paren
r_void
)paren
(brace
r_int
id|h
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
id|h
op_increment
)paren
(brace
r_struct
id|ata_channel
op_star
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;present
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;proc
)paren
(brace
id|hwif-&gt;proc
op_assign
id|proc_mkdir
c_func
(paren
id|hwif-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;proc
)paren
r_return
suffix:semicolon
)brace
id|create_proc_ide_drives
c_func
(paren
id|hwif
)paren
suffix:semicolon
)brace
)brace
DECL|function|destroy_proc_ide_interfaces
r_static
r_void
id|destroy_proc_ide_interfaces
c_func
(paren
r_void
)paren
(brace
r_int
id|h
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
id|h
op_increment
)paren
(brace
r_struct
id|ata_channel
op_star
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_int
id|exist
op_assign
(paren
id|hwif-&gt;proc
op_ne
l_int|NULL
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;present
)paren
r_continue
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|exist
)paren
(brace
id|destroy_proc_ide_drives
c_func
(paren
id|hwif
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|hwif-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
id|hwif-&gt;proc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_continue
suffix:semicolon
)brace
)brace
DECL|function|proc_ide_create
r_void
id|proc_ide_create
c_func
(paren
r_void
)paren
(brace
id|proc_ide_root
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;ide&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_ide_root
)paren
r_return
suffix:semicolon
id|create_proc_ide_interfaces
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_if
c_cond
(paren
(paren
id|aec62xx_display_info
)paren
op_logical_and
(paren
id|aec62xx_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;aec62xx&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|aec62xx_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_if
c_cond
(paren
(paren
id|ali_display_info
)paren
op_logical_and
(paren
id|ali_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;ali&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|ali_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD74XX
r_if
c_cond
(paren
(paren
id|amd74xx_display_info
)paren
op_logical_and
(paren
id|amd74xx_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;amd74xx&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|amd74xx_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD74XX */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_if
c_cond
(paren
(paren
id|cmd64x_display_info
)paren
op_logical_and
(paren
id|cmd64x_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;cmd64x&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|cmd64x_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_if
c_cond
(paren
(paren
id|cs5530_display_info
)paren
op_logical_and
(paren
id|cs5530_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;cs5530&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|cs5530_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_if
c_cond
(paren
(paren
id|hpt34x_display_info
)paren
op_logical_and
(paren
id|hpt34x_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;hpt34x&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|hpt34x_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_if
c_cond
(paren
(paren
id|hpt366_display_info
)paren
op_logical_and
(paren
id|hpt366_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;hpt366&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|hpt366_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_SVWKS
r_if
c_cond
(paren
(paren
id|svwks_display_info
)paren
op_logical_and
(paren
id|svwks_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;svwks&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|svwks_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SVWKS */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_if
c_cond
(paren
(paren
id|pdc202xx_display_info
)paren
op_logical_and
(paren
id|pdc202xx_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;pdc202xx&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|pdc202xx_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_if
c_cond
(paren
(paren
id|piix_display_info
)paren
op_logical_and
(paren
id|piix_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;piix&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|piix_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_if
c_cond
(paren
(paren
id|sis_display_info
)paren
op_logical_and
(paren
id|sis_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;sis&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|sis_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_if
c_cond
(paren
(paren
id|via_display_info
)paren
op_logical_and
(paren
id|via_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;via&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|via_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
)brace
DECL|function|proc_ide_destroy
r_void
id|proc_ide_destroy
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Mmmm.. does this free up all resources,&n;&t; * or do we need to do a more proper cleanup here ??&n;&t; */
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_if
c_cond
(paren
(paren
id|aec62xx_display_info
)paren
op_logical_and
(paren
id|aec62xx_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/aec62xx&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_if
c_cond
(paren
(paren
id|ali_display_info
)paren
op_logical_and
(paren
id|ali_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/ali&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD74XX
r_if
c_cond
(paren
(paren
id|amd74xx_display_info
)paren
op_logical_and
(paren
id|amd74xx_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/amd74xx&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD74XX */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_if
c_cond
(paren
(paren
id|cmd64x_display_info
)paren
op_logical_and
(paren
id|cmd64x_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/cmd64x&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_if
c_cond
(paren
(paren
id|cs5530_display_info
)paren
op_logical_and
(paren
id|cs5530_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/cs5530&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_if
c_cond
(paren
(paren
id|hpt34x_display_info
)paren
op_logical_and
(paren
id|hpt34x_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/hpt34x&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_if
c_cond
(paren
(paren
id|hpt366_display_info
)paren
op_logical_and
(paren
id|hpt366_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/hpt366&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_if
c_cond
(paren
(paren
id|pdc202xx_display_info
)paren
op_logical_and
(paren
id|pdc202xx_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/pdc202xx&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_if
c_cond
(paren
(paren
id|piix_display_info
)paren
op_logical_and
(paren
id|piix_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/piix&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SVWKS
r_if
c_cond
(paren
(paren
id|svwks_display_info
)paren
op_logical_and
(paren
id|svwks_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/svwks&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SVWKS */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_if
c_cond
(paren
(paren
id|sis_display_info
)paren
op_logical_and
(paren
id|sis_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/sis&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_if
c_cond
(paren
(paren
id|via_display_info
)paren
op_logical_and
(paren
id|via_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/via&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/drivers&quot;
comma
l_int|0
)paren
suffix:semicolon
id|destroy_proc_ide_interfaces
c_func
(paren
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
eof
