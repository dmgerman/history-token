multiline_comment|/*&n;   hptraid.c  Copyright (C) 2001 Red Hat, Inc. All rights reserved.&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License as published by&n;   the Free Software Foundation; either version 2, or (at your option)&n;   any later version.&n;   &n;   You should have received a copy of the GNU General Public License&n;   (for example /usr/src/linux/COPYING); if not, write to the Free&n;   Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  &n;   &n;   Authors: &t;Arjan van de Ven &lt;arjanv@redhat.com&gt;&n;&n;   Based on work&n;   &t;Copyleft  (C) 2001 by Wilfried Weissmann &lt;wweissmann@gmx.at&gt;&n;&t;Copyright (C) 1994-96 Marc ZYNGIER &lt;zyngier@ufr-info-p7.ibp.fr&gt;&n;   Based on work done by S&#xfffd;ren Schmidt for FreeBSD&n;&n;   &n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/blkpg.h&gt;
macro_line|#include &lt;linux/genhd.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;ataraid.h&quot;
r_static
r_int
id|hptraid_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
suffix:semicolon
r_static
r_int
id|hptraid_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
suffix:semicolon
r_static
r_int
id|hptraid_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_int
id|hptraid_make_request
(paren
id|request_queue_t
op_star
id|q
comma
r_int
id|rw
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
suffix:semicolon
DECL|struct|hptdisk
r_struct
id|hptdisk
(brace
DECL|member|device
id|kdev_t
id|device
suffix:semicolon
DECL|member|sectors
r_int
r_int
id|sectors
suffix:semicolon
DECL|member|bdev
r_struct
id|block_device
op_star
id|bdev
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|hptraid
r_struct
id|hptraid
(brace
DECL|member|stride
r_int
r_int
id|stride
suffix:semicolon
DECL|member|disks
r_int
r_int
id|disks
suffix:semicolon
DECL|member|sectors
r_int
r_int
id|sectors
suffix:semicolon
DECL|member|geom
r_struct
id|geom
id|geom
suffix:semicolon
DECL|member|disk
r_struct
id|hptdisk
id|disk
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|cutoff
r_int
r_int
id|cutoff
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|cutoff_disks
r_int
r_int
id|cutoff_disks
(braket
l_int|8
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|hptraid_ops
r_static
r_struct
id|raid_device_operations
id|hptraid_ops
op_assign
(brace
id|open
suffix:colon
id|hptraid_open
comma
id|release
suffix:colon
id|hptraid_release
comma
id|ioctl
suffix:colon
id|hptraid_ioctl
comma
id|make_request
suffix:colon
id|hptraid_make_request
)brace
suffix:semicolon
DECL|variable|raid
r_static
r_struct
id|hptraid
id|raid
(braket
l_int|16
)braket
suffix:semicolon
DECL|function|hptraid_ioctl
r_static
r_int
id|hptraid_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|minor
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
r_int
id|sectors
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
op_logical_or
op_logical_neg
id|inode-&gt;i_rdev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_rshift
id|SHIFT
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|BLKGETSIZE
suffix:colon
multiline_comment|/* Return device size */
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sectors
op_assign
id|ataraid_gendisk.part
(braket
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)braket
dot
id|nr_sects
suffix:semicolon
r_if
c_cond
(paren
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|15
)paren
r_return
id|put_user
c_func
(paren
id|sectors
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|raid
(braket
id|minor
)braket
dot
id|sectors
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HDIO_GETGEO
suffix:colon
(brace
r_struct
id|hd_geometry
op_star
id|loc
op_assign
(paren
r_struct
id|hd_geometry
op_star
)paren
id|arg
suffix:semicolon
r_int
r_int
id|bios_cyl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loc
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
id|byte
op_star
)paren
op_amp
id|loc-&gt;heads
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
l_int|63
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
id|byte
op_star
)paren
op_amp
id|loc-&gt;sectors
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bios_cyl
op_assign
id|raid
(braket
id|minor
)braket
dot
id|sectors
op_div
l_int|63
op_div
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|bios_cyl
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|loc-&gt;cylinders
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
(paren
r_int
)paren
id|ataraid_gendisk.part
(braket
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)braket
dot
id|start_sect
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|loc-&gt;start
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|HDIO_GETGEO_BIG
suffix:colon
(brace
r_struct
id|hd_big_geometry
op_star
id|loc
op_assign
(paren
r_struct
id|hd_big_geometry
op_star
)paren
id|arg
suffix:semicolon
r_int
r_int
id|bios_cyl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|loc
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
id|byte
op_star
)paren
op_amp
id|loc-&gt;heads
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
l_int|63
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
id|byte
op_star
)paren
op_amp
id|loc-&gt;sectors
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bios_cyl
op_assign
id|raid
(braket
id|minor
)braket
dot
id|sectors
op_div
l_int|63
op_div
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|bios_cyl
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|loc-&gt;cylinders
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
(paren
r_int
)paren
id|ataraid_gendisk.part
(braket
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)braket
dot
id|start_sect
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|loc-&gt;start
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|BLKROSET
suffix:colon
r_case
id|BLKROGET
suffix:colon
r_case
id|BLKSSZGET
suffix:colon
r_return
id|blk_ioctl
c_func
(paren
id|inode-&gt;i_rdev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hptraid_make_request
r_static
r_int
id|hptraid_make_request
(paren
id|request_queue_t
op_star
id|q
comma
r_int
id|rw
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_int
r_int
id|rsect
suffix:semicolon
r_int
r_int
id|rsect_left
comma
id|rsect_accum
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|block
suffix:semicolon
r_int
r_int
id|disk
op_assign
l_int|0
comma
id|real_disk
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|device
suffix:semicolon
r_struct
id|hptraid
op_star
id|thisraid
suffix:semicolon
id|rsect
op_assign
id|bh-&gt;b_rsector
suffix:semicolon
multiline_comment|/* Ok. We need to modify this sector number to a new disk + new sector number. &n;&t; * If there are disks of different sizes, this gets tricky. &n;&t; * Example with 3 disks (1Gb, 4Gb and 5 GB):&n;&t; * The first 3 Gb of the &quot;RAID&quot; are evenly spread over the 3 disks.&n;&t; * Then things get interesting. The next 2Gb (RAID view) are spread across disk 2 and 3&n;&t; * and the last 1Gb is disk 3 only.&n;&t; *&n;&t; * the way this is solved is like this: We have a list of &quot;cutoff&quot; points where everytime&n;&t; * a disk falls out of the &quot;higher&quot; count, we mark the max sector. So once we pass a cutoff&n;&t; * point, we have to divide by one less.&n;&t; */
id|device
op_assign
(paren
id|bh-&gt;b_rdev
op_rshift
id|SHIFT
)paren
op_amp
id|MAJOR_MASK
suffix:semicolon
id|thisraid
op_assign
op_amp
id|raid
(braket
id|device
)braket
suffix:semicolon
r_if
c_cond
(paren
id|thisraid-&gt;stride
op_eq
l_int|0
)paren
id|thisraid-&gt;stride
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Partitions need adding of the start sector of the partition to the requested sector */
id|rsect
op_add_assign
id|ataraid_gendisk.part
(braket
id|MINOR
c_func
(paren
id|bh-&gt;b_rdev
)paren
)braket
dot
id|start_sect
suffix:semicolon
multiline_comment|/* Woops we need to split the request to avoid crossing a stride barrier */
r_if
c_cond
(paren
(paren
id|rsect
op_div
id|thisraid-&gt;stride
)paren
op_ne
(paren
(paren
id|rsect
op_plus
(paren
id|bh-&gt;b_size
op_div
l_int|512
)paren
op_minus
l_int|1
)paren
op_div
id|thisraid-&gt;stride
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|rsect_left
op_assign
id|rsect
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|thisraid-&gt;cutoff_disks
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|rsect
OG
id|thisraid-&gt;cutoff
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* we&squot;re in the wrong area so far */
id|rsect_left
op_sub_assign
id|thisraid-&gt;cutoff
(braket
id|i
)braket
suffix:semicolon
id|rsect_accum
op_add_assign
id|thisraid-&gt;cutoff
(braket
id|i
)braket
op_div
id|thisraid-&gt;cutoff_disks
(braket
id|i
)braket
suffix:semicolon
)brace
r_else
(brace
id|block
op_assign
id|rsect_left
op_div
id|thisraid-&gt;stride
suffix:semicolon
id|disk
op_assign
id|block
op_mod
id|thisraid-&gt;cutoff_disks
(braket
id|i
)braket
suffix:semicolon
id|block
op_assign
(paren
id|block
op_div
id|thisraid-&gt;cutoff_disks
(braket
id|i
)braket
)paren
op_star
id|thisraid-&gt;stride
suffix:semicolon
id|rsect
op_assign
id|rsect_accum
op_plus
(paren
id|rsect_left
op_mod
id|thisraid-&gt;stride
)paren
op_plus
id|block
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|disk
op_eq
l_int|0
)paren
op_logical_and
(paren
id|thisraid-&gt;disk
(braket
id|i
)braket
dot
id|sectors
OG
id|rsect_accum
)paren
)paren
(brace
id|real_disk
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|disk
OG
l_int|0
)paren
op_logical_and
(paren
id|thisraid-&gt;disk
(braket
id|i
)braket
dot
id|sectors
op_ge
id|rsect_accum
)paren
)paren
(brace
id|disk
op_decrement
suffix:semicolon
)brace
)brace
id|disk
op_assign
id|real_disk
suffix:semicolon
multiline_comment|/* All but the first disk have a 10 sector offset */
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|rsect
op_add_assign
l_int|10
suffix:semicolon
multiline_comment|/*&n;&t; * The new BH_Lock semantics in ll_rw_blk.c guarantee that this&n;&t; * is the only IO operation happening on this bh.&n;&t; */
id|bh-&gt;b_rdev
op_assign
id|thisraid-&gt;disk
(braket
id|disk
)braket
dot
id|device
suffix:semicolon
id|bh-&gt;b_rsector
op_assign
id|rsect
suffix:semicolon
multiline_comment|/*&n;&t; * Let the main block layer submit the IO and resolve recursion:&n;&t; */
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#include &quot;hptraid.h&quot;
DECL|function|read_disk_sb
r_static
r_int
id|__init
id|read_disk_sb
c_func
(paren
r_struct
id|block_device
op_star
id|bdev
comma
r_struct
id|highpoint_raid_conf
op_star
id|buf
)paren
(brace
multiline_comment|/* Superblock is at 9*512 bytes */
id|Sector
id|sect
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|read_dev_sector
c_func
(paren
id|bdev
comma
l_int|9
comma
op_amp
id|sect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|p
comma
l_int|512
)paren
suffix:semicolon
id|put_dev_sector
c_func
(paren
op_amp
id|sect
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hptraid: Error reading superblock.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|maxsectors
r_static
r_int
r_int
id|maxsectors
(paren
r_int
id|major
comma
r_int
id|minor
)paren
(brace
r_int
r_int
id|lba
op_assign
l_int|0
suffix:semicolon
id|kdev_t
id|dev
suffix:semicolon
id|ide_drive_t
op_star
id|ideinfo
suffix:semicolon
id|dev
op_assign
id|MKDEV
c_func
(paren
id|major
comma
id|minor
)paren
suffix:semicolon
id|ideinfo
op_assign
id|get_info_ptr
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ideinfo
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* first sector of the last cluster */
r_if
c_cond
(paren
id|ideinfo-&gt;head
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ideinfo-&gt;sect
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|lba
op_assign
(paren
id|ideinfo-&gt;capacity
)paren
suffix:semicolon
r_return
id|lba
suffix:semicolon
)brace
DECL|variable|prom
r_static
r_struct
id|highpoint_raid_conf
id|__initdata
id|prom
suffix:semicolon
DECL|function|probedisk
r_static
r_void
id|__init
id|probedisk
c_func
(paren
r_int
id|major
comma
r_int
id|minor
comma
r_int
id|device
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|block_device
op_star
id|bdev
op_assign
id|bdget
c_func
(paren
id|MKDEV
c_func
(paren
id|major
comma
id|minor
)paren
)paren
suffix:semicolon
r_struct
id|gendisk
op_star
id|gd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bdev
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|blkdev_get
c_func
(paren
id|bdev
comma
id|FMODE_READ
op_or
id|FMODE_WRITE
comma
l_int|0
comma
id|BDEV_RAW
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|maxsectors
c_func
(paren
id|major
comma
id|minor
)paren
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|read_disk_sb
c_func
(paren
id|bdev
comma
op_amp
id|prom
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|prom.magic
op_ne
l_int|0x5a7816f0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|prom.type
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hptraid: only RAID0 is supported currently&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|i
op_assign
id|prom.disk_number
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|8
)paren
r_goto
id|out
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|bdev
op_assign
id|bdev
suffix:semicolon
multiline_comment|/* This is supposed to prevent others from stealing our underlying disks */
multiline_comment|/* now blank the /proc/partitions table for the wrong partition table,&n;&t;   so that scripts don&squot;t accidentally mount it and crash the kernel */
multiline_comment|/* XXX: the 0 is an utter hack  --hch */
id|gd
op_assign
id|get_gendisk
c_func
(paren
id|MKDEV
c_func
(paren
id|major
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gd
op_ne
l_int|NULL
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
op_plus
(paren
id|minor
op_lshift
id|gd-&gt;minor_shift
)paren
suffix:semicolon
id|j
OL
(paren
(paren
id|minor
op_plus
l_int|1
)paren
op_lshift
id|gd-&gt;minor_shift
)paren
suffix:semicolon
id|j
op_increment
)paren
id|gd-&gt;part
(braket
id|j
)braket
dot
id|nr_sects
op_assign
l_int|0
suffix:semicolon
)brace
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|device
op_assign
id|MKDEV
c_func
(paren
id|major
comma
id|minor
)paren
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|sectors
op_assign
id|maxsectors
c_func
(paren
id|major
comma
id|minor
)paren
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|stride
op_assign
(paren
l_int|1
op_lshift
id|prom.raid0_shift
)paren
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|disks
op_assign
id|prom.raid_disks
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|sectors
op_assign
id|prom.total_secs
suffix:semicolon
r_return
suffix:semicolon
id|out
suffix:colon
id|blkdev_put
c_func
(paren
id|bdev
)paren
suffix:semicolon
)brace
DECL|function|fill_cutoff
r_static
r_void
id|__init
id|fill_cutoff
c_func
(paren
r_int
id|device
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_int
id|smallest
suffix:semicolon
r_int
r_int
id|bar
suffix:semicolon
r_int
id|count
suffix:semicolon
id|bar
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|smallest
op_assign
op_complement
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
(paren
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|j
)braket
dot
id|sectors
OL
id|smallest
)paren
op_logical_and
(paren
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|j
)braket
dot
id|sectors
OG
id|bar
)paren
)paren
id|smallest
op_assign
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|j
)braket
dot
id|sectors
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|j
)braket
dot
id|sectors
op_ge
id|smallest
)paren
id|count
op_increment
suffix:semicolon
id|smallest
op_assign
id|smallest
op_star
id|count
suffix:semicolon
id|bar
op_assign
id|smallest
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|cutoff
(braket
id|i
)braket
op_assign
id|smallest
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|cutoff_disks
(braket
id|i
)braket
op_assign
id|count
suffix:semicolon
)brace
)brace
DECL|function|hptraid_init_one
r_static
id|__init
r_int
id|hptraid_init_one
c_func
(paren
r_int
id|device
)paren
(brace
r_int
id|i
comma
id|count
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE0_MAJOR
comma
l_int|0
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE0_MAJOR
comma
l_int|64
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE1_MAJOR
comma
l_int|0
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE1_MAJOR
comma
l_int|64
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE2_MAJOR
comma
l_int|0
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE2_MAJOR
comma
l_int|64
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE3_MAJOR
comma
l_int|0
comma
id|device
)paren
suffix:semicolon
id|probedisk
c_func
(paren
id|IDE3_MAJOR
comma
l_int|64
comma
id|device
)paren
suffix:semicolon
id|fill_cutoff
c_func
(paren
id|device
)paren
suffix:semicolon
multiline_comment|/* Initialize the gendisk structure */
id|ataraid_register_disk
c_func
(paren
id|device
comma
id|raid
(braket
id|device
)braket
dot
id|sectors
)paren
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Highpoint HPT370 Softwareraid driver for linux version 0.01&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|device
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Drive %i is %li Mb &bslash;n&quot;
comma
id|i
comma
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|sectors
op_div
l_int|2048
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|count
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Raid array consists of %i drives. &bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;No raid array found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
DECL|function|hptraid_init
r_static
id|__init
r_int
id|hptraid_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
comma
id|device
suffix:semicolon
id|device
op_assign
id|ataraid_get_device
c_func
(paren
op_amp
id|hptraid_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|retval
op_assign
id|hptraid_init_one
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|ataraid_release_device
c_func
(paren
id|device
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|hptraid_exit
r_static
r_void
id|__exit
id|hptraid_exit
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|device
suffix:semicolon
r_for
c_loop
(paren
id|device
op_assign
l_int|0
suffix:semicolon
id|device
OL
l_int|16
suffix:semicolon
id|device
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|block_device
op_star
id|bdev
op_assign
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|bdev
suffix:semicolon
id|raid
(braket
id|device
)braket
dot
id|disk
(braket
id|i
)braket
dot
id|bdev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|bdev
)paren
id|blkdev_put
c_func
(paren
id|bdev
comma
id|BDEV_RAW
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|raid
(braket
id|device
)braket
dot
id|sectors
)paren
id|ataraid_release_device
c_func
(paren
id|device
)paren
suffix:semicolon
)brace
)brace
DECL|function|hptraid_open
r_static
r_int
id|hptraid_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hptraid_release
r_static
r_int
id|hptraid_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hptraid_init
id|module_init
c_func
(paren
id|hptraid_init
)paren
suffix:semicolon
DECL|variable|hptraid_exit
id|module_exit
c_func
(paren
id|hptraid_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
