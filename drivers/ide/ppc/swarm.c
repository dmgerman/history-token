multiline_comment|/*&n; * Copyright (C) 2001 Broadcom Corporation&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; */
multiline_comment|/*  Derived loosely from ide-pmac.c, so:&n; *  &n; *  Copyright (C) 1998 Paul Mackerras.&n; *  Copyright (C) 1995-1998 Mark Lord&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sibyte/sb1250_int.h&gt;
DECL|macro|__IDE_SWARM_C
mdefine_line|#define __IDE_SWARM_C
macro_line|#include &lt;asm/sibyte/swarm_ide.h&gt;
DECL|function|swarm_ide_probe
r_void
id|__init
id|swarm_ide_probe
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|ide_hwif_t
op_star
id|hwif
suffix:semicolon
multiline_comment|/* &n;&t; * Find the first untaken slot in hwifs &n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_HWIFS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ide_hwifs
(braket
id|i
)braket
dot
id|io_ports
(braket
id|IDE_DATA_OFFSET
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|MAX_HWIFS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;No space for SWARM onboard IDE driver in ide_hwifs[].  Not enabled.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Set up our stuff */
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|i
)braket
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f0
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_ERROR_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f1
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_NSECTOR_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f2
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_SECTOR_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f3
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_LCYL_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f4
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_HCYL_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f5
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_SELECT_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f6
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_STATUS_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x1f7
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_CONTROL_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x3f6
)paren
suffix:semicolon
id|hwif-&gt;hw.io_ports
(braket
id|IDE_IRQ_OFFSET
)braket
op_assign
id|SWARM_IDE_REG
c_func
(paren
l_int|0x3f7
)paren
suffix:semicolon
singleline_comment|//&t;hwif-&gt;hw-&gt;ack_intr                    = swarm_ide_ack_intr;
id|hwif-&gt;hw.irq
op_assign
id|SWARM_IDE_INT
suffix:semicolon
macro_line|#if 0
id|hwif-&gt;iops
op_assign
id|swarm_iops
suffix:semicolon
macro_line|#else
id|hwif-&gt;OUTB
op_assign
id|hwif-&gt;OUTBP
op_assign
id|swarm_outb
suffix:semicolon
id|hwif-&gt;OUTW
op_assign
id|hwif-&gt;OUTWP
op_assign
id|swarm_outw
suffix:semicolon
id|hwif-&gt;OUTL
op_assign
id|hwif-&gt;OUTLP
op_assign
id|swarm_outl
suffix:semicolon
id|hwif-&gt;OUTSW
op_assign
id|hwif-&gt;OUTSWP
op_assign
id|swarm_outsw
suffix:semicolon
id|hwif-&gt;OUTSL
op_assign
id|hwif-&gt;OUTSLP
op_assign
id|swarm_outsl
suffix:semicolon
id|hwif-&gt;INB
op_assign
id|hwif-&gt;INBP
op_assign
id|swarm_inb
suffix:semicolon
id|hwif-&gt;INW
op_assign
id|hwif-&gt;INWP
op_assign
id|swarm_inw
suffix:semicolon
id|hwif-&gt;INL
op_assign
id|hwif-&gt;INLP
op_assign
id|swarm_inl
suffix:semicolon
id|hwif-&gt;INSW
op_assign
id|hwif-&gt;INSWP
op_assign
id|swarm_insw
suffix:semicolon
id|hwif-&gt;INSL
op_assign
id|hwif-&gt;INSLP
op_assign
id|swarm_insl
suffix:semicolon
macro_line|#endif
macro_line|#if 0
id|hwif-&gt;pioops
op_assign
id|swarm_pio_ops
suffix:semicolon
macro_line|#else
id|hwif-&gt;ata_input_data
op_assign
id|swarm_ata_input_data
suffix:semicolon
id|hwif-&gt;ata_output_data
op_assign
id|swarm_ata_output_data
suffix:semicolon
id|hwif-&gt;atapi_input_bytes
op_assign
id|swarm_atapi_input_bytes
suffix:semicolon
id|hwif-&gt;atapi_output_bytes
op_assign
id|swarm_atapi_output_bytes
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|hwif-&gt;io_ports
comma
id|hwif-&gt;hw.io_ports
comma
r_sizeof
(paren
id|hwif-&gt;io_ports
)paren
)paren
suffix:semicolon
id|hwif-&gt;irq
op_assign
id|hwif-&gt;hw.irq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SWARM onboard IDE configured as device %i&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
macro_line|#ifndef HWIF_PROBE_CLASSIC_METHOD
id|probe_hwif_init
c_func
(paren
id|hwif-&gt;index
)paren
suffix:semicolon
macro_line|#endif /* HWIF_PROBE_CLASSIC_METHOD */
)brace
eof
