multiline_comment|/*&n; *  linux/drivers/ide/legacy/q40ide.c -- Q40 I/O port IDE Driver&n; *&n; *     (c) Richard Zidlicky&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; *&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
multiline_comment|/*&n;     *  Bases of the IDE interfaces&n;     */
DECL|macro|Q40IDE_NUM_HWIFS
mdefine_line|#define Q40IDE_NUM_HWIFS&t;2
DECL|macro|PCIDE_BASE1
mdefine_line|#define PCIDE_BASE1&t;0x1f0
DECL|macro|PCIDE_BASE2
mdefine_line|#define PCIDE_BASE2&t;0x170
DECL|macro|PCIDE_BASE3
mdefine_line|#define PCIDE_BASE3&t;0x1e8
DECL|macro|PCIDE_BASE4
mdefine_line|#define PCIDE_BASE4&t;0x168
DECL|macro|PCIDE_BASE5
mdefine_line|#define PCIDE_BASE5&t;0x1e0
DECL|macro|PCIDE_BASE6
mdefine_line|#define PCIDE_BASE6&t;0x160
DECL|variable|pcide_bases
r_static
r_const
r_int
r_int
id|pcide_bases
(braket
id|Q40IDE_NUM_HWIFS
)braket
op_assign
(brace
id|PCIDE_BASE1
comma
id|PCIDE_BASE2
comma
multiline_comment|/* PCIDE_BASE3, PCIDE_BASE4  , PCIDE_BASE5,&n;    PCIDE_BASE6 */
)brace
suffix:semicolon
multiline_comment|/*&n;     *  Offsets from one of the above bases&n;     */
multiline_comment|/* used to do addr translation here but it is easier to do in setup ports */
multiline_comment|/*#define IDE_OFF_B(x)&t;((unsigned long)Q40_ISA_IO_B((IDE_##x##_OFFSET)))*/
DECL|macro|IDE_OFF_B
mdefine_line|#define IDE_OFF_B(x)&t;((unsigned long)((IDE_##x##_OFFSET)))
DECL|macro|IDE_OFF_W
mdefine_line|#define IDE_OFF_W(x)&t;((unsigned long)((IDE_##x##_OFFSET)))
DECL|variable|pcide_offsets
r_static
r_const
r_int
id|pcide_offsets
(braket
id|IDE_NR_PORTS
)braket
op_assign
(brace
id|IDE_OFF_W
c_func
(paren
id|DATA
)paren
comma
id|IDE_OFF_B
c_func
(paren
id|ERROR
)paren
comma
id|IDE_OFF_B
c_func
(paren
id|NSECTOR
)paren
comma
id|IDE_OFF_B
c_func
(paren
id|SECTOR
)paren
comma
id|IDE_OFF_B
c_func
(paren
id|LCYL
)paren
comma
id|IDE_OFF_B
c_func
(paren
id|HCYL
)paren
comma
l_int|6
multiline_comment|/*IDE_OFF_B(CURRENT)*/
comma
id|IDE_OFF_B
c_func
(paren
id|STATUS
)paren
comma
l_int|518
multiline_comment|/*IDE_OFF(CMD)*/
)brace
suffix:semicolon
DECL|function|q40ide_default_irq
r_static
r_int
id|q40ide_default_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_switch
c_cond
(paren
id|base
)paren
(brace
r_case
l_int|0x1f0
suffix:colon
r_return
l_int|14
suffix:semicolon
r_case
l_int|0x170
suffix:colon
r_return
l_int|15
suffix:semicolon
r_case
l_int|0x1e8
suffix:colon
r_return
l_int|11
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * This is very similar to ide_setup_ports except that addresses&n; * are pretranslated for q40 ISA access&n; */
DECL|function|q40_ide_setup_ports
r_void
id|q40_ide_setup_ports
(paren
id|hw_regs_t
op_star
id|hw
comma
r_int
r_int
id|base
comma
r_int
op_star
id|offsets
comma
r_int
r_int
id|ctrl
comma
r_int
r_int
id|intr
comma
id|ide_ack_intr_t
op_star
id|ack_intr
comma
multiline_comment|/*&n; *&t;&t;&t;ide_io_ops_t *iops,&n; */
r_int
id|irq
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IDE_NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* BIG FAT WARNING: &n;&t;&t;   assumption: only DATA port is ever used in 16 bit mode */
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|hw-&gt;io_ports
(braket
id|i
)braket
op_assign
id|Q40_ISA_IO_W
c_func
(paren
id|base
op_plus
id|offsets
(braket
id|i
)braket
)paren
suffix:semicolon
r_else
id|hw-&gt;io_ports
(braket
id|i
)braket
op_assign
id|Q40_ISA_IO_B
c_func
(paren
id|base
op_plus
id|offsets
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|hw-&gt;irq
op_assign
id|irq
suffix:semicolon
id|hw-&gt;dma
op_assign
id|NO_DMA
suffix:semicolon
id|hw-&gt;ack_intr
op_assign
id|ack_intr
suffix:semicolon
multiline_comment|/*&n; *&t;hw-&gt;iops = iops;&n; */
)brace
multiline_comment|/* &n; * the static array is needed to have the name reported in /proc/ioports,&n; * hwif-&gt;name unfortunately isn&#xfffd;t available yet&n; */
DECL|variable|q40_ide_names
r_static
r_const
r_char
op_star
id|q40_ide_names
(braket
id|Q40IDE_NUM_HWIFS
)braket
op_assign
initialization_block
suffix:semicolon
multiline_comment|/*&n; *  Probe for Q40 IDE interfaces&n; */
DECL|function|q40ide_init
r_void
id|q40ide_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|ide_hwif_t
op_star
id|hwif
suffix:semicolon
r_int
id|index
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACH_IS_Q40
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|Q40IDE_NUM_HWIFS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw_regs_t
id|hw
suffix:semicolon
id|name
op_assign
id|q40_ide_names
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|pcide_bases
(braket
id|i
)braket
comma
l_int|8
comma
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;could not reserve ports %lx-%lx for %s&bslash;n&quot;
comma
id|pcide_bases
(braket
id|i
)braket
comma
id|pcide_bases
(braket
id|i
)braket
op_plus
l_int|8
comma
id|name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|pcide_bases
(braket
id|i
)braket
op_plus
l_int|0x206
comma
l_int|1
comma
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;could not reserve port %lx for %s&bslash;n&quot;
comma
id|pcide_bases
(braket
id|i
)braket
op_plus
l_int|0x206
comma
id|name
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|pcide_bases
(braket
id|i
)braket
comma
l_int|8
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|q40_ide_setup_ports
c_func
(paren
op_amp
id|hw
comma
(paren
r_int
r_int
)paren
id|pcide_bases
(braket
id|i
)braket
comma
(paren
r_int
op_star
)paren
id|pcide_offsets
comma
id|pcide_bases
(braket
id|i
)braket
op_plus
l_int|0x206
comma
l_int|0
comma
l_int|NULL
comma
singleline_comment|//&t;&t;&t;m68kide_iops,
id|q40ide_default_irq
c_func
(paren
id|pcide_bases
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|index
op_assign
id|ide_register_hw
c_func
(paren
op_amp
id|hw
comma
op_amp
id|hwif
)paren
suffix:semicolon
singleline_comment|// **FIXME**
r_if
c_cond
(paren
id|index
op_ne
op_minus
l_int|1
)paren
id|hwif-&gt;mmio
op_assign
l_int|2
suffix:semicolon
)brace
)brace
eof
