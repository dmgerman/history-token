multiline_comment|/*&n; * sound/opl3sa2.c&n; *&n; * A low level driver for Yamaha OPL3-SA2 and SA3 cards.&n; * NOTE: All traces of the name OPL3-SAx have now (December 2000) been&n; *       removed from the driver code, as an email exchange with Yamaha&n; *       provided the information that the YMF-719 is indeed just a&n; *       re-badged 715.&n; *&n; * Copyright 1998-2001 Scott Murray &lt;scott@spiteful.org&gt;&n; *&n; * Originally based on the CS4232 driver (in cs4232.c) by Hannu Savolainen&n; * and others.  Now incorporates code/ideas from pss.c, also by Hannu&n; * Savolainen.  Both of those files are distributed with the following&n; * license:&n; *&n; * &quot;Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; *  OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; *  Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; *  for more info.&quot;&n; *&n; * As such, in accordance with the above license, this file, opl3sa2.c, is&n; * distributed under the GNU GENERAL PUBLIC LICENSE (GPL) Version 2 (June 1991).&n; * See the &quot;COPYING&quot; file distributed with this software for more information.&n; *&n; * Change History&n; * --------------&n; * Scott Murray            Original driver (Jun 14, 1998)&n; * Paul J.Y. Lahaie        Changed probing / attach code order&n; * Scott Murray            Added mixer support (Dec 03, 1998)&n; * Scott Murray            Changed detection code to be more forgiving,&n; *                         added force option as last resort,&n; *                         fixed ioctl return values. (Dec 30, 1998)&n; * Scott Murray            Simpler detection code should work all the time now&n; *                         (with thanks to Ben Hutchings for the heuristic),&n; *                         removed now unnecessary force option. (Jan 5, 1999)&n; * Christoph Hellwig&t;   Adapted to module_init/module_exit (Mar 4, 2000)&n; * Scott Murray            Reworked SA2 versus SA3 mixer code, updated chipset&n; *                         version detection code (again!). (Dec 5, 2000)&n; * Scott Murray            Adjusted master volume mixer scaling. (Dec 6, 2000)&n; * Scott Murray            Based on a patch by Joel Yliluoma (aka Bisqwit),&n; *                         integrated wide mixer and adjusted mic, bass, treble&n; *                         scaling. (Dec 6, 2000)&n; * Scott Murray            Based on a patch by Peter Englmaier, integrated&n; *                         ymode and loopback options. (Dec 6, 2000)&n; * Scott Murray            Inspired by a patch by Peter Englmaier, and based on&n; *                         what ALSA does, added initialization code for the&n; *                         default DMA and IRQ settings. (Dec 6, 2000)&n; * Scott Murray            Added some more checks to the card detection code,&n; *                         based on what ALSA does. (Dec 12, 2000)&n; * Scott Murray            Inspired by similar patches from John Fremlin,&n; *                         Jim Radford, Mike Rolig, and Ingmar Steen, added 2.4&n; *                         ISA PnP API support, mainly based on bits from&n; *                         sb_card.c and awe_wave.c. (Dec 12, 2000)&n; * Scott Murray            Some small cleanups to the init code output.&n; *                         (Jan 7, 2001)&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;ad1848.h&quot;
macro_line|#include &quot;mpu401.h&quot;
multiline_comment|/* Useful control port indexes: */
DECL|macro|OPL3SA2_SYS_CTRL
mdefine_line|#define OPL3SA2_SYS_CTRL     0x02
DECL|macro|OPL3SA2_IRQ_CONFIG
mdefine_line|#define OPL3SA2_IRQ_CONFIG   0x03
DECL|macro|OPL3SA2_DMA_CONFIG
mdefine_line|#define OPL3SA2_DMA_CONFIG   0x06
DECL|macro|OPL3SA2_MASTER_LEFT
mdefine_line|#define OPL3SA2_MASTER_LEFT  0x07
DECL|macro|OPL3SA2_MASTER_RIGHT
mdefine_line|#define OPL3SA2_MASTER_RIGHT 0x08
DECL|macro|OPL3SA2_MIC
mdefine_line|#define OPL3SA2_MIC          0x09
DECL|macro|OPL3SA2_MISC
mdefine_line|#define OPL3SA2_MISC         0x0A
DECL|macro|OPL3SA3_WIDE
mdefine_line|#define OPL3SA3_WIDE         0x14
DECL|macro|OPL3SA3_BASS
mdefine_line|#define OPL3SA3_BASS         0x15
DECL|macro|OPL3SA3_TREBLE
mdefine_line|#define OPL3SA3_TREBLE       0x16
multiline_comment|/* Useful constants: */
DECL|macro|DEFAULT_VOLUME
mdefine_line|#define DEFAULT_VOLUME 50
DECL|macro|DEFAULT_MIC
mdefine_line|#define DEFAULT_MIC    50
DECL|macro|DEFAULT_TIMBRE
mdefine_line|#define DEFAULT_TIMBRE 0
multiline_comment|/* For checking against what the card returns: */
DECL|macro|VERSION_UNKNOWN
mdefine_line|#define VERSION_UNKNOWN 0
DECL|macro|VERSION_YMF711
mdefine_line|#define VERSION_YMF711  1
DECL|macro|VERSION_YMF715
mdefine_line|#define VERSION_YMF715  2
DECL|macro|VERSION_YMF715B
mdefine_line|#define VERSION_YMF715B 3
DECL|macro|VERSION_YMF715E
mdefine_line|#define VERSION_YMF715E 4
multiline_comment|/* also assuming that anything &gt; 4 but &lt;= 7 is a 715E */
multiline_comment|/* Chipset type constants for use below */
DECL|macro|CHIPSET_UNKNOWN
mdefine_line|#define CHIPSET_UNKNOWN -1
DECL|macro|CHIPSET_OPL3SA2
mdefine_line|#define CHIPSET_OPL3SA2 0
DECL|macro|CHIPSET_OPL3SA3
mdefine_line|#define CHIPSET_OPL3SA3 1
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
DECL|macro|OPL3SA2_CARDS_MAX
mdefine_line|#define OPL3SA2_CARDS_MAX 4
macro_line|#else
DECL|macro|OPL3SA2_CARDS_MAX
mdefine_line|#define OPL3SA2_CARDS_MAX 1
macro_line|#endif
multiline_comment|/* This should be pretty obvious */
DECL|variable|opl3sa2_cards_num
r_static
r_int
id|opl3sa2_cards_num
suffix:semicolon
multiline_comment|/* = 0 */
multiline_comment|/* What&squot;s my version(s)? */
DECL|variable|chipset
r_static
r_int
id|chipset
(braket
id|OPL3SA2_CARDS_MAX
)braket
op_assign
(brace
id|CHIPSET_UNKNOWN
)brace
suffix:semicolon
multiline_comment|/* Oh well, let&squot;s just cache the name(s) */
DECL|variable|chipset_name
r_static
r_char
id|chipset_name
(braket
id|OPL3SA2_CARDS_MAX
)braket
(braket
l_int|12
)braket
suffix:semicolon
multiline_comment|/* Where&squot;s my mixer(s)? */
DECL|variable|opl3sa2_mixer
r_static
r_int
id|opl3sa2_mixer
(braket
id|OPL3SA2_CARDS_MAX
)braket
op_assign
(brace
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Bag o&squot; mixer data */
DECL|struct|opl3sa2_mixerdata_tag
r_typedef
r_struct
id|opl3sa2_mixerdata_tag
(brace
DECL|member|cfg_port
r_int
r_int
id|cfg_port
suffix:semicolon
DECL|member|padding
r_int
r_int
id|padding
suffix:semicolon
DECL|member|volume_l
r_int
r_int
id|volume_l
suffix:semicolon
DECL|member|volume_r
r_int
r_int
id|volume_r
suffix:semicolon
DECL|member|mic
r_int
r_int
id|mic
suffix:semicolon
DECL|member|bass_l
r_int
r_int
id|bass_l
suffix:semicolon
DECL|member|bass_r
r_int
r_int
id|bass_r
suffix:semicolon
DECL|member|treble_l
r_int
r_int
id|treble_l
suffix:semicolon
DECL|member|treble_r
r_int
r_int
id|treble_r
suffix:semicolon
DECL|member|wide_l
r_int
r_int
id|wide_l
suffix:semicolon
DECL|member|wide_r
r_int
r_int
id|wide_r
suffix:semicolon
DECL|typedef|opl3sa2_mixerdata
)brace
id|opl3sa2_mixerdata
suffix:semicolon
DECL|variable|opl3sa2_data
r_static
id|opl3sa2_mixerdata
id|opl3sa2_data
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
DECL|variable|cfg
r_static
r_struct
id|address_info
id|cfg
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
DECL|variable|cfg_mss
r_static
r_struct
id|address_info
id|cfg_mss
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
DECL|variable|cfg_mpu
r_static
r_struct
id|address_info
id|cfg_mpu
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
multiline_comment|/* Our parameters */
DECL|variable|io
r_static
r_int
id|__initdata
id|io
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mss_io
r_static
r_int
id|__initdata
id|mss_io
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mpu_io
r_static
r_int
id|__initdata
id|mpu_io
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|__initdata
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|__initdata
id|dma
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dma2
r_static
r_int
id|__initdata
id|dma2
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|ymode
r_static
r_int
id|__initdata
id|ymode
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|loopback
r_static
r_int
id|__initdata
id|loopback
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
multiline_comment|/* PnP specific parameters */
DECL|variable|isapnp
r_static
r_int
id|__initdata
id|isapnp
op_assign
l_int|1
suffix:semicolon
DECL|variable|multiple
r_static
r_int
id|__initdata
id|multiple
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* PnP devices */
DECL|variable|opl3sa2_dev
r_struct
id|pci_dev
op_star
id|opl3sa2_dev
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
multiline_comment|/* Whether said devices have been activated */
DECL|variable|opl3sa2_activated
r_static
r_int
id|opl3sa2_activated
(braket
id|OPL3SA2_CARDS_MAX
)braket
suffix:semicolon
macro_line|#else
DECL|variable|isapnp
r_static
r_int
id|__initdata
id|isapnp
suffix:semicolon
multiline_comment|/* = 0 */
DECL|variable|multiple
r_static
r_int
id|__initdata
id|multiple
suffix:semicolon
multiline_comment|/* = 0 */
macro_line|#endif
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Module for OPL3-SA2 and SA3 sound cards (uses AD1848 MSS driver).&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Scott Murray &lt;scott@spiteful.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|io
comma
l_string|&quot;Set I/O base of OPL3-SA2 or SA3 card (usually 0x370.  Address must be even and must be from 0x100 to 0xFFE)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mss_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mss_io
comma
l_string|&quot;Set MSS (audio) I/O base (0x530, 0xE80, or other. Address must end in 0 or 4 and must be from 0x530 to 0xF48)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mpu_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mpu_io
comma
l_string|&quot;Set MIDI I/O base (0x330 or other. Address must be even and must be from 0x300 to 0x334)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mss_irq
comma
l_string|&quot;Set MSS (audio) IRQ (5, 7, 9, 10, 11, 12)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dma
comma
l_string|&quot;Set MSS (audio) first DMA channel (0, 1, 3)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma2
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dma2
comma
l_string|&quot;Set MSS (audio) second DMA channel (0, 1, 3)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ymode
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ymode
comma
l_string|&quot;Set Yamaha 3D enhancement mode (0 = Desktop/Normal, 1 = Notebook PC (1), 2 = Notebook PC (2), 3 = Hi-Fi)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|loopback
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|loopback
comma
l_string|&quot;Set A/D input source. Useful for echo cancellation (0 = Mic Rch (default), 1 = Mono output loopback)&quot;
)paren
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
id|MODULE_PARM
c_func
(paren
id|isapnp
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp
comma
l_string|&quot;When set to 0, ISA PnP support will be disabled&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|multiple
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|multiple
comma
l_string|&quot;When set to 0, will not search for multiple cards&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Standard read and write functions&n;*/
DECL|function|opl3sa2_write
r_static
r_inline
r_void
id|opl3sa2_write
c_func
(paren
r_int
r_int
id|port
comma
r_int
r_char
id|index
comma
r_int
r_char
id|data
)paren
(brace
id|outb_p
c_func
(paren
id|index
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|opl3sa2_read
r_static
r_inline
r_void
id|opl3sa2_read
c_func
(paren
r_int
r_int
id|port
comma
r_int
r_char
id|index
comma
r_int
r_char
op_star
id|data
)paren
(brace
id|outb_p
c_func
(paren
id|index
comma
id|port
)paren
suffix:semicolon
op_star
id|data
op_assign
id|inb
c_func
(paren
id|port
op_plus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * All of the mixer functions...&n; */
DECL|function|opl3sa2_set_volume
r_static
r_void
id|opl3sa2_set_volume
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|left
comma
r_int
id|right
)paren
(brace
r_static
r_int
r_char
id|scale
(braket
l_int|101
)braket
op_assign
(brace
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
r_int
r_char
id|vol
suffix:semicolon
id|vol
op_assign
id|scale
(braket
id|left
)braket
suffix:semicolon
multiline_comment|/* If level is zero, turn on mute */
r_if
c_cond
(paren
op_logical_neg
id|left
)paren
(brace
id|vol
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA2_MASTER_LEFT
comma
id|vol
)paren
suffix:semicolon
id|vol
op_assign
id|scale
(braket
id|right
)braket
suffix:semicolon
multiline_comment|/* If level is zero, turn on mute */
r_if
c_cond
(paren
op_logical_neg
id|right
)paren
(brace
id|vol
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA2_MASTER_RIGHT
comma
id|vol
)paren
suffix:semicolon
)brace
DECL|function|opl3sa2_set_mic
r_static
r_void
id|opl3sa2_set_mic
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|level
)paren
(brace
r_int
r_char
id|vol
op_assign
l_int|0x1F
suffix:semicolon
r_if
c_cond
(paren
(paren
id|level
op_ge
l_int|0
)paren
op_logical_and
(paren
id|level
op_le
l_int|100
)paren
)paren
(brace
id|vol
op_assign
l_int|0x1F
op_minus
(paren
r_int
r_char
)paren
(paren
l_int|32
op_star
id|level
op_div
l_int|101
)paren
suffix:semicolon
)brace
multiline_comment|/* If level is zero, turn on mute */
r_if
c_cond
(paren
op_logical_neg
id|level
)paren
(brace
id|vol
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA2_MIC
comma
id|vol
)paren
suffix:semicolon
)brace
DECL|function|opl3sa3_set_bass
r_static
r_void
id|opl3sa3_set_bass
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|left
comma
r_int
id|right
)paren
(brace
r_int
r_char
id|bass
suffix:semicolon
id|bass
op_assign
id|left
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|left
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
suffix:semicolon
id|bass
op_or_assign
(paren
id|right
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|right
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
)paren
op_lshift
l_int|4
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA3_BASS
comma
id|bass
)paren
suffix:semicolon
)brace
DECL|function|opl3sa3_set_treble
r_static
r_void
id|opl3sa3_set_treble
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|left
comma
r_int
id|right
)paren
(brace
r_int
r_char
id|treble
suffix:semicolon
id|treble
op_assign
id|left
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|left
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
suffix:semicolon
id|treble
op_or_assign
(paren
id|right
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|right
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
)paren
op_lshift
l_int|4
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA3_TREBLE
comma
id|treble
)paren
suffix:semicolon
)brace
DECL|function|opl3sa3_set_wide
r_static
r_void
id|opl3sa3_set_wide
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|left
comma
r_int
id|right
)paren
(brace
r_int
r_char
id|wide
suffix:semicolon
id|wide
op_assign
id|left
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|left
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
suffix:semicolon
id|wide
op_or_assign
(paren
id|right
ques
c_cond
(paren
(paren
r_int
r_char
)paren
(paren
l_int|8
op_star
id|right
op_div
l_int|101
)paren
)paren
suffix:colon
l_int|0
)paren
op_lshift
l_int|4
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|devc-&gt;cfg_port
comma
id|OPL3SA3_WIDE
comma
id|wide
)paren
suffix:semicolon
)brace
DECL|function|opl3sa2_mixer_reset
r_static
r_void
id|opl3sa2_mixer_reset
c_func
(paren
id|opl3sa2_mixerdata
op_star
id|devc
comma
r_int
id|card
)paren
(brace
r_if
c_cond
(paren
id|devc
)paren
(brace
id|opl3sa2_set_volume
c_func
(paren
id|devc
comma
id|DEFAULT_VOLUME
comma
id|DEFAULT_VOLUME
)paren
suffix:semicolon
id|devc-&gt;volume_l
op_assign
id|devc-&gt;volume_r
op_assign
id|DEFAULT_VOLUME
suffix:semicolon
id|opl3sa2_set_mic
c_func
(paren
id|devc
comma
id|DEFAULT_MIC
)paren
suffix:semicolon
id|devc-&gt;mic
op_assign
id|DEFAULT_MIC
suffix:semicolon
r_if
c_cond
(paren
id|chipset
(braket
id|card
)braket
op_eq
id|CHIPSET_OPL3SA3
)paren
(brace
id|opl3sa3_set_bass
c_func
(paren
id|devc
comma
id|DEFAULT_TIMBRE
comma
id|DEFAULT_TIMBRE
)paren
suffix:semicolon
id|devc-&gt;bass_l
op_assign
id|devc-&gt;bass_r
op_assign
id|DEFAULT_TIMBRE
suffix:semicolon
id|opl3sa3_set_treble
c_func
(paren
id|devc
comma
id|DEFAULT_TIMBRE
comma
id|DEFAULT_TIMBRE
)paren
suffix:semicolon
id|devc-&gt;treble_l
op_assign
id|devc-&gt;treble_r
op_assign
id|DEFAULT_TIMBRE
suffix:semicolon
)brace
)brace
)brace
DECL|function|arg_to_vol_mono
r_static
r_inline
r_void
id|arg_to_vol_mono
c_func
(paren
r_int
r_int
id|vol
comma
r_int
op_star
id|value
)paren
(brace
r_int
id|left
suffix:semicolon
id|left
op_assign
id|vol
op_amp
l_int|0x00ff
suffix:semicolon
r_if
c_cond
(paren
id|left
OG
l_int|100
)paren
id|left
op_assign
l_int|100
suffix:semicolon
op_star
id|value
op_assign
id|left
suffix:semicolon
)brace
DECL|function|arg_to_vol_stereo
r_static
r_inline
r_void
id|arg_to_vol_stereo
c_func
(paren
r_int
r_int
id|vol
comma
r_int
op_star
id|aleft
comma
r_int
op_star
id|aright
)paren
(brace
id|arg_to_vol_mono
c_func
(paren
id|vol
comma
id|aleft
)paren
suffix:semicolon
id|arg_to_vol_mono
c_func
(paren
id|vol
op_rshift
l_int|8
comma
id|aright
)paren
suffix:semicolon
)brace
DECL|function|ret_vol_mono
r_static
r_inline
r_int
id|ret_vol_mono
c_func
(paren
r_int
id|vol
)paren
(brace
r_return
(paren
(paren
id|vol
op_lshift
l_int|8
)paren
op_or
id|vol
)paren
suffix:semicolon
)brace
DECL|function|ret_vol_stereo
r_static
r_inline
r_int
id|ret_vol_stereo
c_func
(paren
r_int
id|left
comma
r_int
id|right
)paren
(brace
r_return
(paren
(paren
id|right
op_lshift
l_int|8
)paren
op_or
id|left
)paren
suffix:semicolon
)brace
DECL|function|opl3sa2_mixer_ioctl
r_static
r_int
id|opl3sa2_mixer_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_int
id|cmdf
op_assign
id|cmd
op_amp
l_int|0xff
suffix:semicolon
id|opl3sa2_mixerdata
op_star
id|devc
op_assign
(paren
id|opl3sa2_mixerdata
op_star
)paren
id|mixer_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
r_case
id|SOUND_MIXER_MIC
suffix:colon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_ne
l_char|&squot;M&squot;
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
id|arg_to_vol_stereo
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_amp
id|devc-&gt;volume_l
comma
op_amp
id|devc-&gt;volume_r
)paren
suffix:semicolon
id|opl3sa2_set_volume
c_func
(paren
id|devc
comma
id|devc-&gt;volume_l
comma
id|devc-&gt;volume_r
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;volume_l
comma
id|devc-&gt;volume_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_MIC
suffix:colon
id|arg_to_vol_mono
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_amp
id|devc-&gt;mic
)paren
suffix:semicolon
id|opl3sa2_set_mic
c_func
(paren
id|devc
comma
id|devc-&gt;mic
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_mono
c_func
(paren
id|devc-&gt;mic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Return parameters&n;&t;&t; */
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
(paren
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|SOUND_MASK_VOLUME
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* No recording devices */
r_return
(paren
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|SOUND_CAP_EXCL_INPUT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* No recording source */
r_return
(paren
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;volume_l
comma
id|devc-&gt;volume_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_MIC
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_mono
c_func
(paren
id|devc-&gt;mic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* opl3sa2_mixer_ioctl end */
DECL|function|opl3sa3_mixer_ioctl
r_static
r_int
id|opl3sa3_mixer_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_int
id|cmdf
op_assign
id|cmd
op_amp
l_int|0xff
suffix:semicolon
id|opl3sa2_mixerdata
op_star
id|devc
op_assign
(paren
id|opl3sa2_mixerdata
op_star
)paren
id|mixer_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_BASS
suffix:colon
r_case
id|SOUND_MIXER_TREBLE
suffix:colon
r_case
id|SOUND_MIXER_DIGITAL1
suffix:colon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|opl3sa2_mixer_ioctl
c_func
(paren
id|dev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_ne
l_char|&squot;M&squot;
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_BASS
suffix:colon
id|arg_to_vol_stereo
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_amp
id|devc-&gt;bass_l
comma
op_amp
id|devc-&gt;bass_r
)paren
suffix:semicolon
id|opl3sa3_set_bass
c_func
(paren
id|devc
comma
id|devc-&gt;bass_l
comma
id|devc-&gt;bass_r
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;bass_l
comma
id|devc-&gt;bass_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_TREBLE
suffix:colon
id|arg_to_vol_stereo
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_amp
id|devc-&gt;treble_l
comma
op_amp
id|devc-&gt;treble_r
)paren
suffix:semicolon
id|opl3sa3_set_treble
c_func
(paren
id|devc
comma
id|devc-&gt;treble_l
comma
id|devc-&gt;treble_r
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;treble_l
comma
id|devc-&gt;treble_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_DIGITAL1
suffix:colon
id|arg_to_vol_stereo
c_func
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|arg
comma
op_amp
id|devc-&gt;wide_l
comma
op_amp
id|devc-&gt;wide_r
)paren
suffix:semicolon
id|opl3sa3_set_wide
c_func
(paren
id|devc
comma
id|devc-&gt;wide_l
comma
id|devc-&gt;wide_r
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;wide_l
comma
id|devc-&gt;wide_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Return parameters&n;&t;&t; */
r_switch
c_cond
(paren
id|cmdf
)paren
(brace
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
(paren
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_BASS
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_DIGITAL1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
(paren
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_BASS
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_DIGITAL1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_BASS
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;bass_l
comma
id|devc-&gt;bass_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_TREBLE
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;treble_l
comma
id|devc-&gt;treble_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_DIGITAL1
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|ret_vol_stereo
c_func
(paren
id|devc-&gt;wide_l
comma
id|devc-&gt;wide_r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* opl3sa3_mixer_ioctl end */
DECL|variable|opl3sa2_mixer_operations
r_static
r_struct
id|mixer_operations
id|opl3sa2_mixer_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|id
suffix:colon
l_string|&quot;OPL3-SA2&quot;
comma
id|name
suffix:colon
l_string|&quot;Yamaha OPL3-SA2&quot;
comma
id|ioctl
suffix:colon
id|opl3sa2_mixer_ioctl
)brace
suffix:semicolon
DECL|variable|opl3sa3_mixer_operations
r_static
r_struct
id|mixer_operations
id|opl3sa3_mixer_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|id
suffix:colon
l_string|&quot;OPL3-SA3&quot;
comma
id|name
suffix:colon
l_string|&quot;Yamaha OPL3-SA3&quot;
comma
id|ioctl
suffix:colon
id|opl3sa3_mixer_ioctl
)brace
suffix:semicolon
multiline_comment|/* End of mixer-related stuff */
multiline_comment|/*&n; * Component probe, attach, unload functions&n; */
DECL|function|probe_opl3sa2_mpu
r_static
r_inline
r_int
id|__init
id|probe_opl3sa2_mpu
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_return
id|probe_mpu401
c_func
(paren
id|hw_config
)paren
suffix:semicolon
)brace
DECL|function|attach_opl3sa2_mpu
r_static
r_inline
r_void
id|__init
id|attach_opl3sa2_mpu
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|attach_mpu401
c_func
(paren
id|hw_config
comma
id|THIS_MODULE
)paren
suffix:semicolon
)brace
DECL|function|unload_opl3sa2_mpu
r_static
r_inline
r_void
id|__exit
id|unload_opl3sa2_mpu
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|unload_mpu401
c_func
(paren
id|hw_config
)paren
suffix:semicolon
)brace
DECL|function|probe_opl3sa2_mss
r_static
r_inline
r_int
id|__init
id|probe_opl3sa2_mss
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_return
id|probe_ms_sound
c_func
(paren
id|hw_config
)paren
suffix:semicolon
)brace
DECL|function|attach_opl3sa2_mss
r_static
r_void
id|__init
id|attach_opl3sa2_mss
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
id|initial_mixers
suffix:semicolon
id|initial_mixers
op_assign
id|num_mixers
suffix:semicolon
id|attach_ms_sound
c_func
(paren
id|hw_config
comma
id|THIS_MODULE
)paren
suffix:semicolon
multiline_comment|/* Slot 0 */
r_if
c_cond
(paren
id|hw_config-&gt;slots
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Did the MSS driver install? */
r_if
c_cond
(paren
id|num_mixers
op_eq
(paren
id|initial_mixers
op_plus
l_int|1
)paren
)paren
(brace
multiline_comment|/* The MSS mixer is installed, reroute mixers appropiately */
id|AD1848_REROUTE
c_func
(paren
id|SOUND_MIXER_LINE1
comma
id|SOUND_MIXER_CD
)paren
suffix:semicolon
id|AD1848_REROUTE
c_func
(paren
id|SOUND_MIXER_LINE2
comma
id|SOUND_MIXER_SYNTH
)paren
suffix:semicolon
id|AD1848_REROUTE
c_func
(paren
id|SOUND_MIXER_LINE3
comma
id|SOUND_MIXER_LINE
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: MSS mixer not installed?&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|unload_opl3sa2_mss
r_static
r_inline
r_void
id|__exit
id|unload_opl3sa2_mss
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|unload_ms_sound
c_func
(paren
id|hw_config
)paren
suffix:semicolon
)brace
DECL|function|probe_opl3sa2
r_static
r_int
id|__init
id|probe_opl3sa2
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|card
)paren
(brace
r_int
r_char
id|misc
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_int
r_char
id|version
suffix:semicolon
r_char
id|tag
suffix:semicolon
multiline_comment|/*&n;&t; * Verify that the I/O port range is free.&n;&t; */
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: Control I/O port %#x not free&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Check if writing to the read-only version bits of the miscellaneous&n;&t; * register succeeds or not (it should not).&n;&t; */
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MISC
comma
op_amp
id|misc
)paren
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MISC
comma
id|misc
op_xor
l_int|0x07
)paren
suffix:semicolon
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MISC
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|misc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: Control I/O port %#x is not a YMF7xx chipset!&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Check if the MIC register is accessible.&n;&t; */
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MIC
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MIC
comma
l_int|0x8a
)paren
suffix:semicolon
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MIC
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0x9f
)paren
op_ne
l_int|0x8a
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: Control I/O port %#x is not a YMF7xx chipset!&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MIC
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Determine chipset type (SA2 or SA3)&n;&t; *&n;&t; * This is done by looking at the chipset version in the lower 3 bits&n;&t; * of the miscellaneous register.&n;&t; */
id|version
op_assign
id|misc
op_amp
l_int|0x07
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;opl3sa2: chipset version = %#x&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|version
)paren
(brace
r_case
l_int|0
suffix:colon
id|chipset
(braket
id|card
)braket
op_assign
id|CHIPSET_UNKNOWN
suffix:semicolon
id|tag
op_assign
l_char|&squot;?&squot;
suffix:semicolon
multiline_comment|/* silence compiler warning */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: Unknown Yamaha audio controller version&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERSION_YMF711
suffix:colon
id|chipset
(braket
id|card
)braket
op_assign
id|CHIPSET_OPL3SA2
suffix:semicolon
id|tag
op_assign
l_char|&squot;2&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: Found OPL3-SA2 (YMF711)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERSION_YMF715
suffix:colon
id|chipset
(braket
id|card
)braket
op_assign
id|CHIPSET_OPL3SA3
suffix:semicolon
id|tag
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: Found OPL3-SA3 (YMF715 or YMF719)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERSION_YMF715B
suffix:colon
id|chipset
(braket
id|card
)braket
op_assign
id|CHIPSET_OPL3SA3
suffix:semicolon
id|tag
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: Found OPL3-SA3 (YMF715B or YMF719B)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERSION_YMF715E
suffix:colon
r_default
suffix:colon
id|chipset
(braket
id|card
)braket
op_assign
id|CHIPSET_OPL3SA3
suffix:semicolon
id|tag
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: Found OPL3-SA3 (YMF715E or YMF719E)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chipset
(braket
id|card
)braket
op_ne
id|CHIPSET_UNKNOWN
)paren
(brace
multiline_comment|/* Generate a pretty name */
id|sprintf
c_func
(paren
id|chipset_name
(braket
id|card
)braket
comma
l_string|&quot;OPL3-SA%c&quot;
comma
id|tag
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|attach_opl3sa2
r_static
r_void
id|__init
id|attach_opl3sa2
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|card
)paren
(brace
id|request_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|2
comma
id|chipset_name
(braket
id|card
)braket
)paren
suffix:semicolon
multiline_comment|/* Initialize IRQ configuration to IRQ-B: -, IRQ-A: WSS+MPU+OPL3 */
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_IRQ_CONFIG
comma
l_int|0x0d
)paren
suffix:semicolon
multiline_comment|/* Initialize DMA configuration */
r_if
c_cond
(paren
id|hw_config-&gt;dma2
op_eq
id|hw_config-&gt;dma
)paren
(brace
multiline_comment|/* Want DMA configuration DMA-B: -, DMA-A: WSS-P+WSS-R */
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_DMA_CONFIG
comma
l_int|0x03
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Want DMA configuration DMA-B: WSS-R, DMA-A: WSS-P */
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_DMA_CONFIG
comma
l_int|0x21
)paren
suffix:semicolon
)brace
)brace
DECL|function|attach_opl3sa2_mixer
r_static
r_void
id|__init
id|attach_opl3sa2_mixer
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|card
)paren
(brace
r_struct
id|mixer_operations
op_star
id|mixer_operations
suffix:semicolon
id|opl3sa2_mixerdata
op_star
id|devc
suffix:semicolon
multiline_comment|/* Install master mixer */
r_if
c_cond
(paren
id|chipset
(braket
id|card
)braket
op_eq
id|CHIPSET_OPL3SA3
)paren
(brace
id|mixer_operations
op_assign
op_amp
id|opl3sa3_mixer_operations
suffix:semicolon
)brace
r_else
(brace
id|mixer_operations
op_assign
op_amp
id|opl3sa2_mixer_operations
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|devc
op_assign
op_amp
id|opl3sa2_data
(braket
id|card
)braket
)paren
)paren
(brace
id|devc-&gt;cfg_port
op_assign
id|hw_config-&gt;io_base
suffix:semicolon
id|opl3sa2_mixer
(braket
id|card
)braket
op_assign
id|sound_install_mixer
c_func
(paren
id|MIXER_DRIVER_VERSION
comma
id|mixer_operations-&gt;name
comma
id|mixer_operations
comma
r_sizeof
(paren
r_struct
id|mixer_operations
)paren
comma
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opl3sa2_mixer
(braket
id|card
)braket
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: Could not install %s master mixer&bslash;n&quot;
comma
id|mixer_operations-&gt;name
)paren
suffix:semicolon
)brace
r_else
id|opl3sa2_mixer_reset
c_func
(paren
id|devc
comma
id|card
)paren
suffix:semicolon
)brace
)brace
DECL|function|opl3sa2_clear_slots
r_static
r_void
id|__init
id|opl3sa2_clear_slots
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw_config-&gt;slots
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|opl3sa2_set_ymode
r_static
r_void
id|__init
id|opl3sa2_set_ymode
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|ymode
)paren
(brace
multiline_comment|/*&n;&t; * Set the Yamaha 3D enhancement mode (aka Ymersion) if asked to and&n;&t; * it&squot;s supported.&n;&t; *&n;&t; * 0: Desktop (aka normal)   5-12 cm speakers&n;&t; * 1: Notebook PC mode 1     3 cm speakers&n;&t; * 2: Notebook PC mode 2     1.5 cm speakers&n;&t; * 3: Hi-fi                  16-38 cm speakers&n;&t; */
r_if
c_cond
(paren
id|ymode
op_ge
l_int|0
op_logical_and
id|ymode
op_le
l_int|3
)paren
(brace
r_int
r_char
id|sys_ctrl
suffix:semicolon
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_SYS_CTRL
comma
op_amp
id|sys_ctrl
)paren
suffix:semicolon
id|sys_ctrl
op_assign
(paren
id|sys_ctrl
op_amp
l_int|0xcf
)paren
op_or
(paren
(paren
id|ymode
op_amp
l_int|3
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_SYS_CTRL
comma
id|sys_ctrl
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: not setting ymode, it must be one of 0,1,2,3&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|opl3sa2_set_loopback
r_static
r_void
id|__init
id|opl3sa2_set_loopback
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|loopback
)paren
(brace
r_if
c_cond
(paren
id|loopback
op_ge
l_int|0
op_logical_and
id|loopback
op_le
l_int|1
)paren
(brace
r_int
r_char
id|misc
suffix:semicolon
id|opl3sa2_read
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MISC
comma
op_amp
id|misc
)paren
suffix:semicolon
id|misc
op_assign
(paren
id|misc
op_amp
l_int|0xef
)paren
op_or
(paren
(paren
id|loopback
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|opl3sa2_write
c_func
(paren
id|hw_config-&gt;io_base
comma
id|OPL3SA2_MISC
comma
id|misc
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: not setting loopback, it must be either 0 or 1&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|unload_opl3sa2
r_static
r_void
id|__exit
id|unload_opl3sa2
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|card
)paren
(brace
multiline_comment|/* Release control ports */
id|release_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Unload mixer */
r_if
c_cond
(paren
id|opl3sa2_mixer
(braket
id|card
)braket
op_ge
l_int|0
)paren
(brace
id|sound_unload_mixerdev
c_func
(paren
id|opl3sa2_mixer
(braket
id|card
)braket
)paren
suffix:semicolon
)brace
)brace
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
DECL|variable|__initdata
r_struct
id|isapnp_device_id
id|isapnp_opl3sa2_list
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;Y&squot;
comma
l_char|&squot;M&squot;
comma
l_char|&squot;H&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0021
)paren
comma
l_int|0
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|isapnp
comma
id|isapnp_opl3sa2_list
)paren
suffix:semicolon
DECL|function|opl3sa2_isapnp_probe
r_static
r_int
id|__init
id|opl3sa2_isapnp_probe
c_func
(paren
r_struct
id|address_info
op_star
id|hw_cfg
comma
r_struct
id|address_info
op_star
id|mss_cfg
comma
r_struct
id|address_info
op_star
id|mpu_cfg
comma
r_int
id|card
)paren
(brace
r_static
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Find and configure device */
id|dev
op_assign
id|isapnp_find_dev
c_func
(paren
l_int|NULL
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;Y&squot;
comma
l_char|&squot;M&squot;
comma
l_char|&squot;H&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0021
)paren
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If device is active, assume configured with /proc/isapnp&n;&t; * and use anyway. Any other way to check this?&n;&t; */
id|ret
op_assign
id|dev
op_member_access_from_pointer
id|prepare
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_logical_and
id|ret
op_ne
op_minus
id|EBUSY
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: ISA PnP found device that could not be autoconfigured.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|EBUSY
)paren
(brace
id|opl3sa2_activated
(braket
id|card
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|activate
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;opl3sa2: ISA PnP activate failed&bslash;n&quot;
)paren
suffix:semicolon
id|opl3sa2_activated
(braket
id|card
)braket
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;opl3sa2: Activated ISA PnP card %d (active=%d)&bslash;n&quot;
comma
id|card
comma
id|dev-&gt;active
)paren
suffix:semicolon
)brace
multiline_comment|/* Our own config: */
id|hw_cfg-&gt;io_base
op_assign
id|dev-&gt;resource
(braket
l_int|4
)braket
dot
id|start
suffix:semicolon
id|hw_cfg-&gt;irq
op_assign
l_int|0
suffix:semicolon
id|hw_cfg-&gt;dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_cfg-&gt;dma2
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* The MSS config: */
id|mss_cfg-&gt;io_base
op_assign
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
id|mss_cfg-&gt;irq
op_assign
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|mss_cfg-&gt;dma
op_assign
id|dev-&gt;dma_resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|mss_cfg-&gt;dma2
op_assign
id|dev-&gt;dma_resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
id|mss_cfg-&gt;card_subtype
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* No IRQ or DMA setup */
id|mpu_cfg-&gt;io_base
op_assign
id|dev-&gt;resource
(braket
l_int|3
)braket
dot
id|start
suffix:semicolon
id|mpu_cfg-&gt;irq
op_assign
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|mpu_cfg-&gt;dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|mpu_cfg-&gt;dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|mpu_cfg-&gt;always_detect
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* It&squot;s there, so use shared IRQs */
multiline_comment|/* Call me paranoid: */
id|opl3sa2_clear_slots
c_func
(paren
id|hw_cfg
)paren
suffix:semicolon
id|opl3sa2_clear_slots
c_func
(paren
id|mss_cfg
)paren
suffix:semicolon
id|opl3sa2_clear_slots
c_func
(paren
id|mpu_cfg
)paren
suffix:semicolon
id|opl3sa2_dev
(braket
id|card
)braket
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ISAPNP || CONFIG_ISAPNP_MODULE */
multiline_comment|/* End of component functions */
multiline_comment|/*&n; * Install OPL3-SA2 based card(s).&n; *&n; * Need to have ad1848 and mpu401 loaded ready.&n; */
DECL|function|init_opl3sa2
r_static
r_int
id|__init
id|init_opl3sa2
c_func
(paren
r_void
)paren
(brace
r_int
id|card
suffix:semicolon
r_int
id|max
suffix:semicolon
multiline_comment|/* Sanitize isapnp and multiple settings */
id|isapnp
op_assign
id|isapnp
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|multiple
op_assign
id|multiple
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|max
op_assign
(paren
id|multiple
op_logical_and
id|isapnp
)paren
ques
c_cond
id|OPL3SA2_CARDS_MAX
suffix:colon
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|card
op_assign
l_int|0
suffix:semicolon
id|card
OL
id|max
suffix:semicolon
id|card
op_increment
comma
id|opl3sa2_cards_num
op_increment
)paren
(brace
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
multiline_comment|/*&n;&t;&t; * Please remember that even with CONFIG_ISAPNP defined one&n;&t;&t; * should still be able to disable PNP support for this &n;&t;&t; * single driver!&n;&t;&t; */
r_if
c_cond
(paren
id|isapnp
op_logical_and
id|opl3sa2_isapnp_probe
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
op_amp
id|cfg_mss
(braket
id|card
)braket
comma
op_amp
id|cfg_mpu
(braket
id|card
)braket
comma
id|card
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|opl3sa2_cards_num
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: No PnP cards found&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
)paren
(brace
r_break
suffix:semicolon
)brace
id|isapnp
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;opl3sa2: Search for a card at 0x%d.&bslash;n&quot;
comma
id|io
)paren
suffix:semicolon
multiline_comment|/* Fall through */
)brace
macro_line|#endif
multiline_comment|/* If a user wants an I/O then assume they meant it */
r_if
c_cond
(paren
op_logical_neg
id|isapnp
)paren
(brace
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
id|irq
op_eq
op_minus
l_int|1
op_logical_or
id|dma
op_eq
op_minus
l_int|1
op_logical_or
id|dma2
op_eq
op_minus
l_int|1
op_logical_or
id|mss_io
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: io, mss_io, irq, dma, and dma2 must be set&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * Our own config:&n;&t;&t;&t; * (NOTE: IRQ and DMA aren&squot;t used, so they&squot;re set to&n;&t;&t;&t; *  give pretty output from conf_printf. :)&n;&t;&t;&t; */
id|cfg
(braket
id|card
)braket
dot
id|io_base
op_assign
id|io
suffix:semicolon
id|cfg
(braket
id|card
)braket
dot
id|irq
op_assign
l_int|0
suffix:semicolon
id|cfg
(braket
id|card
)braket
dot
id|dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|cfg
(braket
id|card
)braket
dot
id|dma2
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* The MSS config: */
id|cfg_mss
(braket
id|card
)braket
dot
id|io_base
op_assign
id|mss_io
suffix:semicolon
id|cfg_mss
(braket
id|card
)braket
dot
id|irq
op_assign
id|irq
suffix:semicolon
id|cfg_mss
(braket
id|card
)braket
dot
id|dma
op_assign
id|dma
suffix:semicolon
id|cfg_mss
(braket
id|card
)braket
dot
id|dma2
op_assign
id|dma2
suffix:semicolon
id|cfg_mss
(braket
id|card
)braket
dot
id|card_subtype
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* No IRQ or DMA setup */
id|cfg_mpu
(braket
id|card
)braket
dot
id|io_base
op_assign
id|mpu_io
suffix:semicolon
id|cfg_mpu
(braket
id|card
)braket
dot
id|irq
op_assign
id|irq
suffix:semicolon
id|cfg_mpu
(braket
id|card
)braket
dot
id|dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|cfg_mpu
(braket
id|card
)braket
dot
id|always_detect
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Use shared IRQs */
multiline_comment|/* Call me paranoid: */
id|opl3sa2_clear_slots
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
)paren
suffix:semicolon
id|opl3sa2_clear_slots
c_func
(paren
op_amp
id|cfg_mss
(braket
id|card
)braket
)paren
suffix:semicolon
id|opl3sa2_clear_slots
c_func
(paren
op_amp
id|cfg_mpu
(braket
id|card
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|probe_opl3sa2
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|card
)paren
op_logical_or
op_logical_neg
id|probe_opl3sa2_mss
c_func
(paren
op_amp
id|cfg_mss
(braket
id|card
)braket
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * If one or more cards are already registered, don&squot;t&n;&t;&t;&t; * return an error but print a warning.  Note, this&n;&t;&t;&t; * should never really happen unless the hardware or&n;&t;&t;&t; * ISA PnP screwed up.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|opl3sa2_cards_num
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;opl3sa2: There was a problem probing one &quot;
l_string|&quot; of the ISA PNP cards, continuing&bslash;n&quot;
)paren
suffix:semicolon
id|opl3sa2_cards_num
op_decrement
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|attach_opl3sa2
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|card
)paren
suffix:semicolon
id|conf_printf
c_func
(paren
id|chipset_name
(braket
id|card
)braket
comma
op_amp
id|cfg
(braket
id|card
)braket
)paren
suffix:semicolon
id|attach_opl3sa2_mss
c_func
(paren
op_amp
id|cfg_mss
(braket
id|card
)braket
)paren
suffix:semicolon
id|attach_opl3sa2_mixer
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|card
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Set the Yamaha 3D enhancement mode (aka Ymersion) if asked to and&n;&t;&t; * it&squot;s supported.&n;&t;&t; */
r_if
c_cond
(paren
id|ymode
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|chipset
(braket
id|card
)braket
op_eq
id|CHIPSET_OPL3SA2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;opl3sa2: ymode not supported on OPL3-SA2&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|opl3sa2_set_ymode
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|ymode
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Set A/D input to Mono loopback if asked to. */
r_if
c_cond
(paren
id|loopback
op_ne
op_minus
l_int|1
)paren
(brace
id|opl3sa2_set_loopback
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|loopback
)paren
suffix:semicolon
)brace
multiline_comment|/* Attach MPU if we&squot;ve been asked to do so */
r_if
c_cond
(paren
id|cfg_mpu
(braket
id|card
)braket
dot
id|io_base
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|probe_opl3sa2_mpu
c_func
(paren
op_amp
id|cfg_mpu
(braket
id|card
)braket
)paren
)paren
(brace
id|attach_opl3sa2_mpu
c_func
(paren
op_amp
id|cfg_mpu
(braket
id|card
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|isapnp
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;opl3sa2: %d PnP card(s) found.&bslash;n&quot;
comma
id|opl3sa2_cards_num
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Uninstall OPL3-SA2 based card(s).&n; */
DECL|function|cleanup_opl3sa2
r_static
r_void
id|__exit
id|cleanup_opl3sa2
c_func
(paren
r_void
)paren
(brace
r_int
id|card
suffix:semicolon
r_for
c_loop
(paren
id|card
op_assign
l_int|0
suffix:semicolon
id|card
OL
id|opl3sa2_cards_num
suffix:semicolon
id|card
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cfg_mpu
(braket
id|card
)braket
dot
id|slots
(braket
l_int|1
)braket
op_ne
op_minus
l_int|1
)paren
(brace
id|unload_opl3sa2_mpu
c_func
(paren
op_amp
id|cfg_mpu
(braket
id|card
)braket
)paren
suffix:semicolon
)brace
id|unload_opl3sa2_mss
c_func
(paren
op_amp
id|cfg_mss
(braket
id|card
)braket
)paren
suffix:semicolon
id|unload_opl3sa2
c_func
(paren
op_amp
id|cfg
(braket
id|card
)braket
comma
id|card
)paren
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
r_if
c_cond
(paren
id|opl3sa2_activated
(braket
id|card
)braket
op_logical_and
id|opl3sa2_dev
(braket
id|card
)braket
)paren
(brace
id|opl3sa2_dev
(braket
id|card
)braket
op_member_access_from_pointer
id|deactivate
c_func
(paren
id|opl3sa2_dev
(braket
id|card
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;opl3sa2: Deactivated ISA PnP card %d (active=%d)&bslash;n&quot;
comma
id|card
comma
id|opl3sa2_dev
(braket
id|card
)braket
op_member_access_from_pointer
id|active
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
DECL|variable|init_opl3sa2
id|module_init
c_func
(paren
id|init_opl3sa2
)paren
suffix:semicolon
DECL|variable|cleanup_opl3sa2
id|module_exit
c_func
(paren
id|cleanup_opl3sa2
)paren
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|setup_opl3sa2
r_static
r_int
id|__init
id|setup_opl3sa2
c_func
(paren
r_char
op_star
id|str
)paren
(brace
multiline_comment|/* io, irq, dma, dma2,... */
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
r_int
id|ints
(braket
l_int|11
)braket
suffix:semicolon
macro_line|#else
r_int
id|ints
(braket
l_int|9
)braket
suffix:semicolon
macro_line|#endif
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
id|ARRAY_SIZE
c_func
(paren
id|ints
)paren
comma
id|ints
)paren
suffix:semicolon
id|io
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|irq
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|dma
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
id|dma2
op_assign
id|ints
(braket
l_int|4
)braket
suffix:semicolon
id|mss_io
op_assign
id|ints
(braket
l_int|5
)braket
suffix:semicolon
id|mpu_io
op_assign
id|ints
(braket
l_int|6
)braket
suffix:semicolon
id|ymode
op_assign
id|ints
(braket
l_int|7
)braket
suffix:semicolon
id|loopback
op_assign
id|ints
(braket
l_int|8
)braket
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
id|isapnp
op_assign
id|ints
(braket
l_int|9
)braket
suffix:semicolon
id|multiple
op_assign
id|ints
(braket
l_int|10
)braket
suffix:semicolon
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;opl3sa2=&quot;
comma
id|setup_opl3sa2
)paren
suffix:semicolon
macro_line|#endif
eof
