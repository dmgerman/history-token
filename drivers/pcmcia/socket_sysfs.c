multiline_comment|/*&n; * socket_sysfs.c -- most of socket-related sysfs output&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; * (C) 2003 - 2004&t;&t;Dominik Brodowski&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|macro|IN_CARD_SERVICES
mdefine_line|#define IN_CARD_SERVICES
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/ss.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/bulkmem.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/cisreg.h&gt;
macro_line|#include &lt;pcmcia/ds.h&gt;
macro_line|#include &quot;cs_internal.h&quot;
DECL|macro|to_socket
mdefine_line|#define to_socket(_dev) container_of(_dev, struct pcmcia_socket, dev)
DECL|function|pccard_show_type
r_static
id|ssize_t
id|pccard_show_type
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|val
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s-&gt;ops
op_member_access_from_pointer
id|get_status
c_func
(paren
id|s
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_CARDBUS
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;32-bit&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_DETECT
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;16-bit&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;invalid&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_type
comma
l_int|0400
comma
id|pccard_show_type
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|pccard_show_voltage
r_static
id|ssize_t
id|pccard_show_voltage
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|val
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s-&gt;ops
op_member_access_from_pointer
id|get_status
c_func
(paren
id|s
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_3VCARD
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;3.3V&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|SS_XVCARD
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;X.XV&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;5.0V&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_voltage
comma
l_int|0400
comma
id|pccard_show_voltage
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|pccard_show_vpp
r_static
id|ssize_t
id|pccard_show_vpp
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d.%dV&bslash;n&quot;
comma
id|s-&gt;socket.Vpp
op_div
l_int|10
comma
id|s-&gt;socket.Vpp
op_mod
l_int|10
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_vpp
comma
l_int|0400
comma
id|pccard_show_vpp
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|pccard_show_vcc
r_static
id|ssize_t
id|pccard_show_vcc
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;state
op_amp
id|SOCKET_PRESENT
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d.%dV&bslash;n&quot;
comma
id|s-&gt;socket.Vcc
op_div
l_int|10
comma
id|s-&gt;socket.Vcc
op_mod
l_int|10
)paren
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_vcc
comma
l_int|0400
comma
id|pccard_show_vcc
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|pccard_store_insert
r_static
id|ssize_t
id|pccard_store_insert
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|ssize_t
id|ret
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|pcmcia_insert_card
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_insert
comma
l_int|0200
comma
l_int|NULL
comma
id|pccard_store_insert
)paren
suffix:semicolon
DECL|function|pccard_store_eject
r_static
id|ssize_t
id|pccard_store_eject
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|ssize_t
id|ret
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|pcmcia_eject_card
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_eject
comma
l_int|0200
comma
l_int|NULL
comma
id|pccard_store_eject
)paren
suffix:semicolon
DECL|function|pccard_show_irq_mask
r_static
id|ssize_t
id|pccard_show_irq_mask
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|s-&gt;irq_mask
)paren
suffix:semicolon
)brace
DECL|function|pccard_store_irq_mask
r_static
id|ssize_t
id|pccard_store_irq_mask
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|ssize_t
id|ret
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|mask
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|sscanf
(paren
id|buf
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|1
)paren
(brace
id|s-&gt;irq_mask
op_and_assign
id|mask
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
ques
c_cond
id|ret
suffix:colon
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|card_irq_mask
comma
l_int|0600
comma
id|pccard_show_irq_mask
comma
id|pccard_store_irq_mask
)paren
suffix:semicolon
DECL|function|pccard_show_resource
r_static
id|ssize_t
id|pccard_show_resource
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s-&gt;resource_setup_done
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
)brace
DECL|function|pccard_store_resource
r_static
id|ssize_t
id|pccard_store_resource
c_func
(paren
r_struct
id|class_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|pcmcia_socket
op_star
id|s
op_assign
id|to_socket
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;resource_setup_done
)paren
(brace
id|s-&gt;resource_setup_done
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* later on, a call which starts PCMCIA device registration will be added here */
r_return
id|count
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|available_resources_setup_done
comma
l_int|0600
comma
id|pccard_show_resource
comma
id|pccard_store_resource
)paren
suffix:semicolon
DECL|variable|pccard_socket_attributes
r_static
r_struct
id|class_device_attribute
op_star
id|pccard_socket_attributes
(braket
)braket
op_assign
(brace
op_amp
id|class_device_attr_card_type
comma
op_amp
id|class_device_attr_card_voltage
comma
op_amp
id|class_device_attr_card_vpp
comma
op_amp
id|class_device_attr_card_vcc
comma
op_amp
id|class_device_attr_card_insert
comma
op_amp
id|class_device_attr_card_eject
comma
op_amp
id|class_device_attr_card_irq_mask
comma
op_amp
id|class_device_attr_available_resources_setup_done
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|function|pccard_sysfs_add_socket
r_static
r_int
id|__devinit
id|pccard_sysfs_add_socket
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
)paren
(brace
r_struct
id|class_device_attribute
op_star
op_star
id|attr
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|attr
op_assign
id|pccard_socket_attributes
suffix:semicolon
op_star
id|attr
suffix:semicolon
id|attr
op_increment
)paren
(brace
id|ret
op_assign
id|class_device_create_file
c_func
(paren
id|class_dev
comma
op_star
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|pccard_sysfs_remove_socket
r_static
r_void
id|__devexit
id|pccard_sysfs_remove_socket
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
)paren
(brace
r_struct
id|class_device_attribute
op_star
op_star
id|attr
suffix:semicolon
r_for
c_loop
(paren
id|attr
op_assign
id|pccard_socket_attributes
suffix:semicolon
op_star
id|attr
suffix:semicolon
id|attr
op_increment
)paren
id|class_device_remove_file
c_func
(paren
id|class_dev
comma
op_star
id|attr
)paren
suffix:semicolon
)brace
DECL|variable|pccard_sysfs_interface
r_struct
id|class_interface
id|pccard_sysfs_interface
op_assign
(brace
dot
r_class
op_assign
op_amp
id|pcmcia_socket_class
comma
dot
id|add
op_assign
op_amp
id|pccard_sysfs_add_socket
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
op_amp
id|pccard_sysfs_remove_socket
)paren
comma
)brace
suffix:semicolon
eof
