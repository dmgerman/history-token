multiline_comment|/*======================================================================&n;&n;    Device driver for Intel 82365 and compatible PC Card controllers.&n;&n;    i82365.c 1.265 1999/11/10 18:36:21&n;&n;    The contents of this file are subject to the Mozilla Public&n;    License Version 1.1 (the &quot;License&quot;); you may not use this file&n;    except in compliance with the License. You may obtain a copy of&n;    the License at http://www.mozilla.org/MPL/&n;&n;    Software distributed under the License is distributed on an &quot;AS&n;    IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or&n;    implied. See the License for the specific language governing&n;    rights and limitations under the License.&n;&n;    The initial developer of the original code is David A. Hinds&n;    &lt;dahinds@users.sourceforge.net&gt;.  Portions created by David A. Hinds&n;    are Copyright (C) 1999 David A. Hinds.  All Rights Reserved.&n;&n;    Alternatively, the contents of this file may be used under the&n;    terms of the GNU General Public License version 2 (the &quot;GPL&quot;), in which&n;    case the provisions of the GPL are applicable instead of the&n;    above.  If you wish to allow the use of your version of this file&n;    only under the terms of the GPL and not to allow others to use&n;    your version of this file under the MPL, indicate your decision&n;    by deleting the provisions above and replace them with the notice&n;    and other provisions required by the GPL.  If you do not delete&n;    the provisions above, a recipient may use your version of this&n;    file under either the MPL or the GPL.&n;    &n;======================================================================*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/workqueue.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/ss.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
multiline_comment|/* ISA-bus controllers */
macro_line|#include &quot;i82365.h&quot;
macro_line|#include &quot;cirrus.h&quot;
macro_line|#include &quot;vg468.h&quot;
macro_line|#include &quot;ricoh.h&quot;
macro_line|#include &quot;o2micro.h&quot;
macro_line|#ifdef DEBUG
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;i82365.c 1.265 1999/11/10 18:36:21 (David Hinds)&quot;
suffix:semicolon
DECL|variable|pc_debug
r_static
r_int
id|pc_debug
suffix:semicolon
id|module_param
c_func
(paren
id|pc_debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
DECL|macro|debug
mdefine_line|#define debug(lvl, fmt, arg...) do {&t;&t;&t;&t;&bslash;&n;&t;if (pc_debug &gt; (lvl))&t;&t;&t;&t;&t;&bslash;&n;&t;&t;printk(KERN_DEBUG &quot;i82365: &quot; fmt , ## arg);&t;&bslash;&n;} while (0)
macro_line|#else
DECL|macro|debug
mdefine_line|#define debug(lvl, fmt, arg...) do { } while (0)
macro_line|#endif
r_static
id|irqreturn_t
id|i365_count_irq
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
DECL|function|_check_irq
r_static
r_inline
r_int
id|_check_irq
c_func
(paren
r_int
id|irq
comma
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|i365_count_irq
comma
id|flags
comma
l_string|&quot;x&quot;
comma
id|i365_count_irq
)paren
op_ne
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
id|i365_count_irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
multiline_comment|/* Default base address for i82365sl and other ISA chips */
DECL|variable|i365_base
r_static
r_int
id|i365_base
op_assign
l_int|0x3e0
suffix:semicolon
multiline_comment|/* Should we probe at 0x3e2 for an extra ISA controller? */
DECL|variable|extra_sockets
r_static
r_int
id|extra_sockets
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Specify a socket number to ignore */
DECL|variable|ignore
r_static
r_int
id|ignore
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Bit map or list of interrupts to choose from */
DECL|variable|irq_mask
r_static
id|u_int
id|irq_mask
op_assign
l_int|0xffff
suffix:semicolon
DECL|variable|irq_list
r_static
r_int
id|irq_list
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|irq_list_count
r_static
r_int
id|irq_list_count
suffix:semicolon
multiline_comment|/* The card status change interrupt -- 0 means autoselect */
DECL|variable|cs_irq
r_static
r_int
id|cs_irq
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Probe for safe interrupts? */
DECL|variable|do_scan
r_static
r_int
id|do_scan
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Poll status interval -- 0 means default to interrupt */
DECL|variable|poll_interval
r_static
r_int
id|poll_interval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* External clock time, in nanoseconds.  120 ns = 8.33 MHz */
DECL|variable|cycle_time
r_static
r_int
id|cycle_time
op_assign
l_int|120
suffix:semicolon
multiline_comment|/* Cirrus options */
DECL|variable|has_dma
r_static
r_int
id|has_dma
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|has_led
r_static
r_int
id|has_led
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|has_ring
r_static
r_int
id|has_ring
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dynamic_mode
r_static
r_int
id|dynamic_mode
op_assign
l_int|0
suffix:semicolon
DECL|variable|freq_bypass
r_static
r_int
id|freq_bypass
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|setup_time
r_static
r_int
id|setup_time
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cmd_time
r_static
r_int
id|cmd_time
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|recov_time
r_static
r_int
id|recov_time
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Vadem options */
DECL|variable|async_clock
r_static
r_int
id|async_clock
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|cable_mode
r_static
r_int
id|cable_mode
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|wakeup
r_static
r_int
id|wakeup
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|i365_base
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|ignore
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|extra_sockets
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|irq_mask
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|irq_list
comma
r_int
comma
id|irq_list_count
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|cs_irq
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|async_clock
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|cable_mode
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|wakeup
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|do_scan
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|poll_interval
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|cycle_time
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|has_dma
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|has_led
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|has_ring
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|dynamic_mode
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|freq_bypass
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|setup_time
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|cmd_time
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|recov_time
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
DECL|struct|cirrus_state_t
r_typedef
r_struct
id|cirrus_state_t
(brace
DECL|member|misc1
DECL|member|misc2
id|u_char
id|misc1
comma
id|misc2
suffix:semicolon
DECL|member|timer
id|u_char
id|timer
(braket
l_int|6
)braket
suffix:semicolon
DECL|typedef|cirrus_state_t
)brace
id|cirrus_state_t
suffix:semicolon
DECL|struct|vg46x_state_t
r_typedef
r_struct
id|vg46x_state_t
(brace
DECL|member|ctl
DECL|member|ema
id|u_char
id|ctl
comma
id|ema
suffix:semicolon
DECL|typedef|vg46x_state_t
)brace
id|vg46x_state_t
suffix:semicolon
DECL|struct|i82365_socket
r_struct
id|i82365_socket
(brace
DECL|member|type
DECL|member|flags
id|u_short
id|type
comma
id|flags
suffix:semicolon
DECL|member|socket
r_struct
id|pcmcia_socket
id|socket
suffix:semicolon
DECL|member|number
r_int
r_int
id|number
suffix:semicolon
DECL|member|ioaddr
id|ioaddr_t
id|ioaddr
suffix:semicolon
DECL|member|psock
id|u_short
id|psock
suffix:semicolon
DECL|member|cs_irq
DECL|member|intr
id|u_char
id|cs_irq
comma
id|intr
suffix:semicolon
r_union
(brace
DECL|member|cirrus
id|cirrus_state_t
id|cirrus
suffix:semicolon
DECL|member|vg46x
id|vg46x_state_t
id|vg46x
suffix:semicolon
DECL|member|state
)brace
id|state
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Where we keep track of our sockets... */
DECL|variable|sockets
r_static
r_int
id|sockets
op_assign
l_int|0
suffix:semicolon
DECL|variable|socket
r_static
r_struct
id|i82365_socket
id|socket
(braket
l_int|8
)braket
op_assign
(brace
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* ... */
)brace
suffix:semicolon
multiline_comment|/* Default ISA interrupt mask */
DECL|macro|I365_MASK
mdefine_line|#define I365_MASK&t;0xdeb8&t;/* irq 15,14,12,11,10,9,7,5,4,3 */
DECL|variable|grab_irq
r_static
r_int
id|grab_irq
suffix:semicolon
DECL|variable|isa_lock
r_static
id|spinlock_t
id|isa_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|ISA_LOCK
mdefine_line|#define ISA_LOCK(n, f) spin_lock_irqsave(&amp;isa_lock, f)
DECL|macro|ISA_UNLOCK
mdefine_line|#define ISA_UNLOCK(n, f) spin_unlock_irqrestore(&amp;isa_lock, f)
DECL|variable|poll_timer
r_static
r_struct
id|timer_list
id|poll_timer
suffix:semicolon
multiline_comment|/*====================================================================*/
multiline_comment|/* These definitions must match the pcic table! */
DECL|enum|pcic_id
r_typedef
r_enum
id|pcic_id
(brace
DECL|enumerator|IS_I82365A
DECL|enumerator|IS_I82365B
DECL|enumerator|IS_I82365DF
id|IS_I82365A
comma
id|IS_I82365B
comma
id|IS_I82365DF
comma
DECL|enumerator|IS_IBM
DECL|enumerator|IS_RF5Cx96
DECL|enumerator|IS_VLSI
DECL|enumerator|IS_VG468
DECL|enumerator|IS_VG469
id|IS_IBM
comma
id|IS_RF5Cx96
comma
id|IS_VLSI
comma
id|IS_VG468
comma
id|IS_VG469
comma
DECL|enumerator|IS_PD6710
DECL|enumerator|IS_PD672X
DECL|enumerator|IS_VT83C469
id|IS_PD6710
comma
id|IS_PD672X
comma
id|IS_VT83C469
comma
DECL|typedef|pcic_id
)brace
id|pcic_id
suffix:semicolon
multiline_comment|/* Flags for classifying groups of controllers */
DECL|macro|IS_VADEM
mdefine_line|#define IS_VADEM&t;0x0001
DECL|macro|IS_CIRRUS
mdefine_line|#define IS_CIRRUS&t;0x0002
DECL|macro|IS_VIA
mdefine_line|#define IS_VIA&t;&t;0x0010
DECL|macro|IS_UNKNOWN
mdefine_line|#define IS_UNKNOWN&t;0x0400
DECL|macro|IS_VG_PWR
mdefine_line|#define IS_VG_PWR&t;0x0800
DECL|macro|IS_DF_PWR
mdefine_line|#define IS_DF_PWR&t;0x1000
DECL|macro|IS_ALIVE
mdefine_line|#define IS_ALIVE&t;0x8000
DECL|struct|pcic_t
r_typedef
r_struct
id|pcic_t
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|flags
id|u_short
id|flags
suffix:semicolon
DECL|typedef|pcic_t
)brace
id|pcic_t
suffix:semicolon
DECL|variable|pcic
r_static
id|pcic_t
id|pcic
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Intel i82365sl A step&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Intel i82365sl B step&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Intel i82365sl DF&quot;
comma
id|IS_DF_PWR
)brace
comma
(brace
l_string|&quot;IBM Clone&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Ricoh RF5C296/396&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;VLSI 82C146&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Vadem VG-468&quot;
comma
id|IS_VADEM
)brace
comma
(brace
l_string|&quot;Vadem VG-469&quot;
comma
id|IS_VADEM
op_or
id|IS_VG_PWR
)brace
comma
(brace
l_string|&quot;Cirrus PD6710&quot;
comma
id|IS_CIRRUS
)brace
comma
(brace
l_string|&quot;Cirrus PD672x&quot;
comma
id|IS_CIRRUS
)brace
comma
(brace
l_string|&quot;VIA VT83C469&quot;
comma
id|IS_CIRRUS
op_or
id|IS_VIA
)brace
comma
)brace
suffix:semicolon
DECL|macro|PCIC_COUNT
mdefine_line|#define PCIC_COUNT&t;(sizeof(pcic)/sizeof(pcic_t))
multiline_comment|/*====================================================================*/
DECL|variable|bus_lock
r_static
id|spinlock_t
id|bus_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|i365_get
r_static
id|u_char
id|i365_get
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|bus_lock
comma
id|flags
)paren
suffix:semicolon
(brace
id|ioaddr_t
id|port
op_assign
id|socket
(braket
id|sock
)braket
dot
id|ioaddr
suffix:semicolon
id|u_char
id|val
suffix:semicolon
id|reg
op_assign
id|I365_REG
c_func
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
comma
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|port
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|port
op_plus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|bus_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
)brace
DECL|function|i365_set
r_static
r_void
id|i365_set
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|bus_lock
comma
id|flags
)paren
suffix:semicolon
(brace
id|ioaddr_t
id|port
op_assign
id|socket
(braket
id|sock
)braket
dot
id|ioaddr
suffix:semicolon
id|u_char
id|val
op_assign
id|I365_REG
c_func
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
comma
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|port
op_plus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|bus_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|i365_bset
r_static
r_void
id|i365_bset
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|d
op_or_assign
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_bclr
r_static
r_void
id|i365_bclr
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|d
op_and_assign
op_complement
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_bflip
r_static
r_void
id|i365_bflip
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_char
id|mask
comma
r_int
id|b
)paren
(brace
id|u_char
id|d
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
)paren
id|d
op_or_assign
id|mask
suffix:semicolon
r_else
id|d
op_and_assign
op_complement
id|mask
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|d
)paren
suffix:semicolon
)brace
DECL|function|i365_get_pair
r_static
id|u_short
id|i365_get_pair
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
)paren
(brace
id|u_short
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
)paren
suffix:semicolon
id|b
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
r_return
(paren
id|a
op_plus
(paren
id|b
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
DECL|function|i365_set_pair
r_static
r_void
id|i365_set_pair
c_func
(paren
id|u_short
id|sock
comma
id|u_short
id|reg
comma
id|u_short
id|data
)paren
(brace
id|i365_set
c_func
(paren
id|sock
comma
id|reg
comma
id|data
op_amp
l_int|0xff
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|reg
op_plus
l_int|1
comma
id|data
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for Cirrus&n;    PD67xx controllers, and to set and report global configuration&n;    options.&n;&n;    The VIA controllers also use these routines, as they are mostly&n;    Cirrus lookalikes, without the timing registers.&n;    &n;======================================================================*/
DECL|macro|flip
mdefine_line|#define flip(v,b,f) (v = ((f)&lt;0) ? v : ((f) ? ((v)|(b)) : ((v)&amp;(~b))))
DECL|function|cirrus_get_state
r_static
r_void
id|cirrus_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|p-&gt;misc1
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
)paren
suffix:semicolon
id|p-&gt;misc1
op_and_assign
(paren
id|PD67_MC1_MEDIA_ENA
op_or
id|PD67_MC1_INPACK_ENA
)paren
suffix:semicolon
id|p-&gt;misc2
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|p-&gt;timer
(braket
id|i
)braket
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_TIME_SETUP
c_func
(paren
l_int|0
)paren
op_plus
id|i
)paren
suffix:semicolon
)brace
DECL|function|cirrus_set_state
r_static
r_void
id|cirrus_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_char
id|misc
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|misc
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_2
comma
id|p-&gt;misc2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|misc
op_amp
id|PD67_MC2_SUSPEND
)paren
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|misc
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
)paren
suffix:semicolon
id|misc
op_and_assign
op_complement
(paren
id|PD67_MC1_MEDIA_ENA
op_or
id|PD67_MC1_INPACK_ENA
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|PD67_MISC_CTL_1
comma
id|misc
op_or
id|p-&gt;misc1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|i365_set
c_func
(paren
id|s
comma
id|PD67_TIME_SETUP
c_func
(paren
l_int|0
)paren
op_plus
id|i
comma
id|p-&gt;timer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
DECL|function|cirrus_set_opts
r_static
id|u_int
id|__init
id|cirrus_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
id|cirrus_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.cirrus
suffix:semicolon
id|u_int
id|mask
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|has_ring
op_eq
op_minus
l_int|1
)paren
id|has_ring
op_assign
l_int|1
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_IRQ15_RI
comma
id|has_ring
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_DYNAMIC_MODE
comma
id|dynamic_mode
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;misc2
comma
id|PD67_MC2_FREQ_BYPASS
comma
id|freq_bypass
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_IRQ15_RI
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [ring]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_DYNAMIC_MODE
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [dyn mode]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_FREQ_BYPASS
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [freq bypass]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc1
op_amp
id|PD67_MC1_INPACK_ENA
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [inpack]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;misc2
op_amp
id|PD67_MC2_IRQ15_RI
)paren
id|mask
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
r_if
c_cond
(paren
id|has_led
OG
l_int|0
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [led]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|has_dma
OG
l_int|0
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [dma]&quot;
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
l_int|0x0600
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;flags
op_amp
id|IS_VIA
)paren
)paren
(brace
r_if
c_cond
(paren
id|setup_time
op_ge
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_assign
id|p-&gt;timer
(braket
l_int|3
)braket
op_assign
id|setup_time
suffix:semicolon
r_if
c_cond
(paren
id|cmd_time
OG
l_int|0
)paren
(brace
id|p-&gt;timer
(braket
l_int|1
)braket
op_assign
id|cmd_time
suffix:semicolon
id|p-&gt;timer
(braket
l_int|4
)braket
op_assign
id|cmd_time
op_star
l_int|2
op_plus
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;timer
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
(brace
id|p-&gt;timer
(braket
l_int|1
)braket
op_assign
l_int|6
suffix:semicolon
id|p-&gt;timer
(braket
l_int|4
)braket
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|0
)braket
op_assign
id|p-&gt;timer
(braket
l_int|3
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|recov_time
op_ge
l_int|0
)paren
id|p-&gt;timer
(braket
l_int|2
)braket
op_assign
id|p-&gt;timer
(braket
l_int|5
)braket
op_assign
id|recov_time
suffix:semicolon
id|buf
op_add_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot; [%d/%d/%d] [%d/%d/%d]&quot;
comma
id|p-&gt;timer
(braket
l_int|0
)braket
comma
id|p-&gt;timer
(braket
l_int|1
)braket
comma
id|p-&gt;timer
(braket
l_int|2
)braket
comma
id|p-&gt;timer
(braket
l_int|3
)braket
comma
id|p-&gt;timer
(braket
l_int|4
)braket
comma
id|p-&gt;timer
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Code to save and restore global state information for Vadem VG468&n;    and VG469 controllers, and to set and report global configuration&n;    options.&n;    &n;======================================================================*/
DECL|function|vg46x_get_state
r_static
r_void
id|vg46x_get_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|p-&gt;ctl
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG468_CTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
id|p-&gt;ema
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG469_EXT_MODE
)paren
suffix:semicolon
)brace
DECL|function|vg46x_set_state
r_static
r_void
id|vg46x_set_state
c_func
(paren
id|u_short
id|s
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|VG468_CTL
comma
id|p-&gt;ctl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
id|i365_set
c_func
(paren
id|s
comma
id|VG469_EXT_MODE
comma
id|p-&gt;ema
)paren
suffix:semicolon
)brace
DECL|function|vg46x_set_opts
r_static
id|u_int
id|__init
id|vg46x_set_opts
c_func
(paren
id|u_short
id|s
comma
r_char
op_star
id|buf
)paren
(brace
id|vg46x_state_t
op_star
id|p
op_assign
op_amp
id|socket
(braket
id|s
)braket
dot
id|state.vg46x
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;ctl
comma
id|VG468_CTL_ASYNC
comma
id|async_clock
)paren
suffix:semicolon
id|flip
c_func
(paren
id|p-&gt;ema
comma
id|VG469_MODE_CABLE
comma
id|cable_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ctl
op_amp
id|VG468_CTL_ASYNC
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [async]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ctl
op_amp
id|VG468_CTL_INPACK
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [inpack]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|s
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
(brace
id|u_char
id|vsel
op_assign
id|i365_get
c_func
(paren
id|s
comma
id|VG469_VSELECT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vsel
op_amp
id|VG469_VSEL_EXT_STAT
)paren
(brace
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [ext mode]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vsel
op_amp
id|VG469_VSEL_EXT_BUS
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [isa buf]&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;ema
op_amp
id|VG469_MODE_CABLE
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [cable]&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ema
op_amp
id|VG469_MODE_COMPAT
)paren
id|strcat
c_func
(paren
id|buf
comma
l_string|&quot; [c step]&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0xffff
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Generic routines to get and set controller options&n;    &n;======================================================================*/
DECL|function|get_bridge_state
r_static
r_void
id|get_bridge_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
id|cirrus_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VADEM
)paren
id|vg46x_get_state
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|set_bridge_state
r_static
r_void
id|set_bridge_state
c_func
(paren
id|u_short
id|s
)paren
(brace
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|s
)braket
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
id|cirrus_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
r_else
(brace
id|i365_set
c_func
(paren
id|s
comma
id|I365_GBLCTL
comma
l_int|0x00
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|s
comma
id|I365_GENCTL
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|i365_bflip
c_func
(paren
id|s
comma
id|I365_INTCTL
comma
id|I365_INTR_ENA
comma
id|t-&gt;intr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VADEM
)paren
id|vg46x_set_state
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|set_bridge_opts
r_static
id|u_int
id|__init
id|set_bridge_opts
c_func
(paren
id|u_short
id|s
comma
id|u_short
id|ns
)paren
(brace
id|u_short
id|i
suffix:semicolon
id|u_int
id|m
op_assign
l_int|0xffff
suffix:semicolon
r_char
id|buf
(braket
l_int|128
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|s
suffix:semicolon
id|i
OL
id|s
op_plus
id|ns
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    host opts [%d]: already alive!&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|buf
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|get_bridge_state
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_CIRRUS
)paren
id|m
op_assign
id|cirrus_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|flags
op_amp
id|IS_VADEM
)paren
id|m
op_assign
id|vg46x_set_opts
c_func
(paren
id|i
comma
id|buf
)paren
suffix:semicolon
id|set_bridge_state
c_func
(paren
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    host opts [%d]:%s&bslash;n&quot;
comma
id|i
comma
(paren
op_star
id|buf
)paren
ques
c_cond
id|buf
suffix:colon
l_string|&quot; none&quot;
)paren
suffix:semicolon
)brace
r_return
id|m
suffix:semicolon
)brace
multiline_comment|/*======================================================================&n;&n;    Interrupt testing code, for ISA and PCI interrupts&n;    &n;======================================================================*/
DECL|variable|irq_hits
r_static
r_volatile
id|u_int
id|irq_hits
suffix:semicolon
DECL|variable|irq_sock
r_static
id|u_short
id|irq_sock
suffix:semicolon
DECL|function|i365_count_irq
r_static
id|irqreturn_t
id|i365_count_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|i365_get
c_func
(paren
id|irq_sock
comma
id|I365_CSC
)paren
suffix:semicolon
id|irq_hits
op_increment
suffix:semicolon
id|debug
c_func
(paren
l_int|2
comma
l_string|&quot;-&gt; hit on irq %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|test_irq
r_static
id|u_int
id|__init
id|test_irq
c_func
(paren
id|u_short
id|sock
comma
r_int
id|irq
)paren
(brace
id|debug
c_func
(paren
l_int|2
comma
l_string|&quot;  testing ISA irq %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|i365_count_irq
comma
l_int|0
comma
l_string|&quot;scan&quot;
comma
id|i365_count_irq
)paren
op_ne
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|irq_hits
op_assign
l_int|0
suffix:semicolon
id|irq_sock
op_assign
id|sock
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_hits
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
id|i365_count_irq
)paren
suffix:semicolon
id|debug
c_func
(paren
l_int|2
comma
l_string|&quot;    spurious hit!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Generate one interrupt */
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|I365_CSC_DETECT
op_or
(paren
id|irq
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_GENCTL
comma
id|I365_CTL_SW_IRQ
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
id|i365_count_irq
)paren
suffix:semicolon
multiline_comment|/* mask all interrupts */
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
id|debug
c_func
(paren
l_int|2
comma
l_string|&quot;    hits = %d&bslash;n&quot;
comma
id|irq_hits
)paren
suffix:semicolon
r_return
(paren
id|irq_hits
op_ne
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|isa_scan
r_static
id|u_int
id|__init
id|isa_scan
c_func
(paren
id|u_short
id|sock
comma
id|u_int
id|mask0
)paren
(brace
id|u_int
id|mask1
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef __alpha__
DECL|macro|PIC
mdefine_line|#define PIC 0x4d0
multiline_comment|/* Don&squot;t probe level-triggered interrupts -- reserved for PCI */
id|mask0
op_and_assign
op_complement
(paren
id|inb
c_func
(paren
id|PIC
)paren
op_or
(paren
id|inb
c_func
(paren
id|PIC
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|do_scan
)paren
(brace
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask0
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
)paren
op_eq
l_int|0
)paren
)paren
id|mask1
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask1
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|test_irq
c_func
(paren
id|sock
comma
id|i
)paren
op_ne
l_int|0
)paren
)paren
id|mask1
op_xor_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    ISA irqs (&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;scanned&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Fallback: just find interrupts that aren&squot;t in use */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mask0
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_logical_and
(paren
id|_check_irq
c_func
(paren
id|i
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
id|mask1
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;default&quot;
)paren
suffix:semicolon
multiline_comment|/* If scan failed, default to polled status */
r_if
c_cond
(paren
op_logical_neg
id|cs_irq
op_logical_and
(paren
id|poll_interval
op_eq
l_int|0
)paren
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;) = &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mask1
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s%d&quot;
comma
(paren
(paren
id|mask1
op_amp
(paren
(paren
l_int|1
op_lshift
id|i
)paren
op_minus
l_int|1
)paren
)paren
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask1
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;none!&quot;
)paren
suffix:semicolon
r_return
id|mask1
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
multiline_comment|/* Time conversion functions */
DECL|function|to_cycles
r_static
r_int
id|to_cycles
c_func
(paren
r_int
id|ns
)paren
(brace
r_return
id|ns
op_div
id|cycle_time
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
DECL|function|identify
r_static
r_int
id|__init
id|identify
c_func
(paren
id|u_short
id|port
comma
id|u_short
id|sock
)paren
(brace
id|u_char
id|val
suffix:semicolon
r_int
id|type
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Use the next free entry in the socket table */
id|socket
(braket
id|sockets
)braket
dot
id|ioaddr
op_assign
id|port
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|psock
op_assign
id|sock
suffix:semicolon
multiline_comment|/* Wake up a sleepy Cirrus controller */
r_if
c_cond
(paren
id|wakeup
)paren
(brace
id|i365_bclr
c_func
(paren
id|sockets
comma
id|PD67_MISC_CTL_2
comma
id|PD67_MC2_SUSPEND
)paren
suffix:semicolon
multiline_comment|/* Pause at least 50 ms */
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|I365_IDENT
)paren
)paren
op_amp
l_int|0x70
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0x82
suffix:colon
id|type
op_assign
id|IS_I82365A
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x83
suffix:colon
id|type
op_assign
id|IS_I82365B
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x84
suffix:colon
id|type
op_assign
id|IS_I82365DF
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x88
suffix:colon
r_case
l_int|0x89
suffix:colon
r_case
l_int|0x8a
suffix:colon
id|type
op_assign
id|IS_IBM
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Check for Vadem VG-468 chips */
id|outb
c_func
(paren
l_int|0x0e
comma
id|port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x37
comma
id|port
)paren
suffix:semicolon
id|i365_bset
c_func
(paren
id|sockets
comma
id|VG468_MISC
comma
id|VG468_MISC_VADEMREV
)paren
suffix:semicolon
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|I365_IDENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|I365_IDENT_VADEM
)paren
(brace
id|i365_bclr
c_func
(paren
id|sockets
comma
id|VG468_MISC
comma
id|VG468_MISC_VADEMREV
)paren
suffix:semicolon
id|type
op_assign
(paren
(paren
id|val
op_amp
l_int|7
)paren
op_ge
l_int|4
)paren
ques
c_cond
id|IS_VG469
suffix:colon
id|IS_VG468
suffix:semicolon
)brace
multiline_comment|/* Check for Ricoh chips */
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|RF5C_CHIP_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_eq
id|RF5C_CHIP_RF5C296
)paren
op_logical_or
(paren
id|val
op_eq
id|RF5C_CHIP_RF5C396
)paren
)paren
id|type
op_assign
id|IS_RF5Cx96
suffix:semicolon
multiline_comment|/* Check for Cirrus CL-PD67xx chips */
id|i365_set
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
comma
l_int|0
)paren
suffix:semicolon
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|PD67_INFO_CHIP_ID
)paren
op_eq
id|PD67_INFO_CHIP_ID
)paren
(brace
id|val
op_assign
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_CHIP_INFO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|PD67_INFO_CHIP_ID
)paren
op_eq
l_int|0
)paren
(brace
id|type
op_assign
(paren
id|val
op_amp
id|PD67_INFO_SLOTS
)paren
ques
c_cond
id|IS_PD672X
suffix:colon
id|IS_PD6710
suffix:semicolon
id|i365_set
c_func
(paren
id|sockets
comma
id|PD67_EXT_INDEX
comma
l_int|0xe5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sockets
comma
id|PD67_EXT_INDEX
)paren
op_ne
l_int|0xe5
)paren
id|type
op_assign
id|IS_VT83C469
suffix:semicolon
)brace
)brace
r_return
id|type
suffix:semicolon
)brace
multiline_comment|/* identify */
multiline_comment|/*======================================================================&n;&n;    See if a card is present, powered up, in IO mode, and already&n;    bound to a (non PC Card) Linux driver.  We leave these alone.&n;&n;    We make an exception for cards that seem to be serial devices.&n;    &n;======================================================================*/
DECL|function|is_alive
r_static
r_int
id|__init
id|is_alive
c_func
(paren
id|u_short
id|sock
)paren
(brace
id|u_char
id|stat
suffix:semicolon
id|u_short
id|start
comma
id|stop
suffix:semicolon
id|stat
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_STATUS
)paren
suffix:semicolon
id|start
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_START
)paren
suffix:semicolon
id|stop
op_assign
id|i365_get_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_STOP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|I365_CS_DETECT
)paren
op_logical_and
(paren
id|stat
op_amp
id|I365_CS_POWERON
)paren
op_logical_and
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
op_logical_and
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_IO
c_func
(paren
l_int|0
)paren
)paren
op_logical_and
(paren
id|check_region
c_func
(paren
id|start
comma
id|stop
op_minus
id|start
op_plus
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|start
op_amp
l_int|0xfeef
)paren
op_ne
l_int|0x02e8
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
DECL|function|add_socket
r_static
r_void
id|__init
id|add_socket
c_func
(paren
id|u_short
id|port
comma
r_int
id|psock
comma
r_int
id|type
)paren
(brace
id|socket
(braket
id|sockets
)braket
dot
id|ioaddr
op_assign
id|port
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|psock
op_assign
id|psock
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|type
op_assign
id|type
suffix:semicolon
id|socket
(braket
id|sockets
)braket
dot
id|flags
op_assign
id|pcic
(braket
id|type
)braket
dot
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|is_alive
c_func
(paren
id|sockets
)paren
)paren
id|socket
(braket
id|sockets
)braket
dot
id|flags
op_or_assign
id|IS_ALIVE
suffix:semicolon
id|sockets
op_increment
suffix:semicolon
)brace
DECL|function|add_pcic
r_static
r_void
id|__init
id|add_pcic
c_func
(paren
r_int
id|ns
comma
r_int
id|type
)paren
(brace
id|u_int
id|mask
op_assign
l_int|0
comma
id|i
comma
id|base
suffix:semicolon
r_int
id|isa_irq
op_assign
l_int|0
suffix:semicolon
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sockets
op_minus
id|ns
)braket
suffix:semicolon
id|base
op_assign
id|sockets
op_minus
id|ns
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;ioaddr
OG
l_int|0
)paren
id|request_region
c_func
(paren
id|t-&gt;ioaddr
comma
l_int|2
comma
l_string|&quot;i82365&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|base
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  %s&quot;
comma
id|pcic
(braket
id|type
)braket
dot
id|name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; ISA-to-PCMCIA at port %#x ofs 0x%02x&quot;
comma
id|t-&gt;ioaddr
comma
id|t-&gt;psock
op_star
l_int|0x40
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, %d socket%s&bslash;n&quot;
comma
id|ns
comma
(paren
(paren
id|ns
OG
l_int|1
)paren
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Set host options, build basic interrupt mask */
r_if
c_cond
(paren
id|irq_list_count
op_eq
l_int|0
)paren
id|mask
op_assign
id|irq_mask
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
id|mask
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_list_count
suffix:semicolon
id|i
op_increment
)paren
id|mask
op_or_assign
(paren
l_int|1
op_lshift
id|irq_list
(braket
id|i
)braket
)paren
suffix:semicolon
id|mask
op_and_assign
id|I365_MASK
op_amp
id|set_bridge_opts
c_func
(paren
id|base
comma
id|ns
)paren
suffix:semicolon
multiline_comment|/* Scan for ISA interrupts */
id|mask
op_assign
id|isa_scan
c_func
(paren
id|base
comma
id|mask
)paren
suffix:semicolon
multiline_comment|/* Poll if only two interrupts available */
r_if
c_cond
(paren
op_logical_neg
id|poll_interval
)paren
(brace
id|u_int
id|tmp
op_assign
(paren
id|mask
op_amp
l_int|0xff20
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp
op_amp
(paren
id|tmp
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
(paren
id|tmp
op_minus
l_int|1
)paren
)paren
op_eq
l_int|0
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
)brace
multiline_comment|/* Only try an ISA cs_irq if this is the first controller */
r_if
c_cond
(paren
op_logical_neg
id|grab_irq
op_logical_and
(paren
id|cs_irq
op_logical_or
op_logical_neg
id|poll_interval
)paren
)paren
(brace
multiline_comment|/* Avoid irq 12 unless it is explicitly requested */
id|u_int
id|cs_mask
op_assign
id|mask
op_amp
(paren
(paren
id|cs_irq
)paren
ques
c_cond
(paren
l_int|1
op_lshift
id|cs_irq
)paren
suffix:colon
op_complement
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cs_irq
op_assign
l_int|15
suffix:semicolon
id|cs_irq
OG
l_int|0
suffix:semicolon
id|cs_irq
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|cs_mask
op_amp
(paren
l_int|1
op_lshift
id|cs_irq
)paren
)paren
op_logical_and
(paren
id|_check_irq
c_func
(paren
id|cs_irq
comma
l_int|0
)paren
op_eq
l_int|0
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|cs_irq
)paren
(brace
id|grab_irq
op_assign
l_int|1
suffix:semicolon
id|isa_irq
op_assign
id|cs_irq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; status change on irq %d&bslash;n&quot;
comma
id|cs_irq
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|isa_irq
)paren
(brace
r_if
c_cond
(paren
id|poll_interval
op_eq
l_int|0
)paren
id|poll_interval
op_assign
id|HZ
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; polling interval = %d ms&bslash;n&quot;
comma
id|poll_interval
op_star
l_int|1000
op_div
id|HZ
)paren
suffix:semicolon
)brace
multiline_comment|/* Update socket interrupt information, capabilities */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ns
suffix:semicolon
id|i
op_increment
)paren
(brace
id|t
(braket
id|i
)braket
dot
id|socket.features
op_or_assign
id|SS_CAP_PCCARD
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|socket.map_size
op_assign
l_int|0x1000
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|socket.irq_mask
op_assign
id|mask
suffix:semicolon
id|t
(braket
id|i
)braket
dot
id|cs_irq
op_assign
id|isa_irq
suffix:semicolon
)brace
)brace
multiline_comment|/* add_pcic */
multiline_comment|/*====================================================================*/
macro_line|#ifdef CONFIG_PNP
DECL|variable|__initdata
r_static
r_struct
id|isapnp_device_id
id|id_table
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;P&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;P&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0e00
)paren
comma
(paren
r_int
r_int
)paren
l_string|&quot;Intel 82365-Compatible&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;P&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;P&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0e01
)paren
comma
(paren
r_int
r_int
)paren
l_string|&quot;Cirrus Logic CL-PD6720&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;P&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;P&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0e02
)paren
comma
(paren
r_int
r_int
)paren
l_string|&quot;VLSI VL82C146&quot;
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|isapnp
comma
id|id_table
)paren
suffix:semicolon
DECL|variable|i82365_pnpdev
r_static
r_struct
id|pnp_dev
op_star
id|i82365_pnpdev
suffix:semicolon
macro_line|#endif
DECL|function|isa_probe
r_static
r_void
id|__init
id|isa_probe
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
comma
id|sock
comma
id|k
comma
id|ns
comma
id|id
suffix:semicolon
id|ioaddr_t
id|port
suffix:semicolon
macro_line|#ifdef CONFIG_PNP
r_struct
id|isapnp_device_id
op_star
id|devid
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|devid
op_assign
id|id_table
suffix:semicolon
id|devid-&gt;vendor
suffix:semicolon
id|devid
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|pnp_find_dev
c_func
(paren
l_int|NULL
comma
id|devid-&gt;vendor
comma
id|devid-&gt;function
comma
l_int|NULL
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pnp_device_attach
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pnp_activate_dev
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;activate failed&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pnp_port_valid
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;invalid resources ?&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i365_base
op_assign
id|pnp_port_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|i82365_pnpdev
op_assign
id|dev
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|i365_base
comma
l_int|2
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sockets
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;port conflict at %#x&bslash;n&quot;
comma
id|i365_base
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|id
op_assign
id|identify
c_func
(paren
id|i365_base
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|id
op_eq
id|IS_I82365DF
)paren
op_logical_and
(paren
id|identify
c_func
(paren
id|i365_base
comma
l_int|1
)paren
op_ne
id|id
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|ignore
)paren
r_continue
suffix:semicolon
id|port
op_assign
id|i365_base
op_plus
(paren
(paren
id|i
op_amp
l_int|1
)paren
op_lshift
l_int|2
)paren
op_plus
(paren
(paren
id|i
op_amp
l_int|2
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|sock
op_assign
(paren
id|i
op_amp
l_int|1
)paren
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|identify
c_func
(paren
id|port
comma
id|sock
)paren
op_eq
id|IS_I82365DF
)paren
(brace
id|add_socket
c_func
(paren
id|port
comma
id|sock
comma
id|IS_VLSI
)paren
suffix:semicolon
id|add_pcic
c_func
(paren
l_int|1
comma
id|IS_VLSI
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|sockets
op_logical_and
op_logical_neg
id|extra_sockets
op_logical_and
(paren
id|i
op_eq
l_int|4
)paren
)paren
r_break
suffix:semicolon
id|port
op_assign
id|i365_base
op_plus
l_int|2
op_star
(paren
id|i
op_rshift
l_int|2
)paren
suffix:semicolon
id|sock
op_assign
(paren
id|i
op_amp
l_int|3
)paren
suffix:semicolon
id|id
op_assign
id|identify
c_func
(paren
id|port
comma
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|ns
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
multiline_comment|/* Does the socket exist? */
r_if
c_cond
(paren
(paren
id|ignore
op_eq
id|i
op_plus
id|j
)paren
op_logical_or
(paren
id|identify
c_func
(paren
id|port
comma
id|sock
op_plus
id|j
)paren
OL
l_int|0
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* Check for bad socket decode */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
op_le
id|sockets
suffix:semicolon
id|k
op_increment
)paren
id|i365_set
c_func
(paren
id|k
comma
id|I365_MEM
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_OFF
comma
id|k
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
op_le
id|sockets
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|k
comma
id|I365_MEM
c_func
(paren
l_int|0
)paren
op_plus
id|I365_W_OFF
)paren
op_ne
id|k
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|k
op_le
id|sockets
)paren
r_break
suffix:semicolon
id|add_socket
c_func
(paren
id|port
comma
id|sock
op_plus
id|j
comma
id|id
)paren
suffix:semicolon
id|ns
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ns
op_ne
l_int|0
)paren
id|add_pcic
c_func
(paren
id|ns
comma
id|id
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*====================================================================*/
DECL|function|pcic_interrupt
r_static
id|irqreturn_t
id|pcic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
comma
id|j
comma
id|csc
suffix:semicolon
id|u_int
id|events
comma
id|active
suffix:semicolon
id|u_long
id|flags
op_assign
l_int|0
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|debug
c_func
(paren
l_int|4
comma
l_string|&quot;pcic_interrupt(%d)&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|20
suffix:semicolon
id|j
op_increment
)paren
(brace
id|active
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|socket
(braket
id|i
)braket
dot
id|cs_irq
op_ne
id|irq
)paren
r_continue
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
id|ISA_LOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
id|csc
op_assign
id|i365_get
c_func
(paren
id|i
comma
id|I365_CSC
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|csc
op_eq
l_int|0
)paren
op_logical_or
(paren
id|i365_get
c_func
(paren
id|i
comma
id|I365_IDENT
)paren
op_amp
l_int|0x70
)paren
)paren
(brace
id|ISA_UNLOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|events
op_assign
(paren
id|csc
op_amp
id|I365_CSC_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|i
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_STSCHG
)paren
ques
c_cond
id|SS_STSCHG
suffix:colon
l_int|0
suffix:semicolon
r_else
(brace
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_BVD1
)paren
ques
c_cond
id|SS_BATDEAD
suffix:colon
l_int|0
suffix:semicolon
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_BVD2
)paren
ques
c_cond
id|SS_BATWARN
suffix:colon
l_int|0
suffix:semicolon
id|events
op_or_assign
(paren
id|csc
op_amp
id|I365_CSC_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
)brace
id|ISA_UNLOCK
c_func
(paren
id|i
comma
id|flags
)paren
suffix:semicolon
id|debug
c_func
(paren
l_int|2
comma
l_string|&quot;socket %d event 0x%02x&bslash;n&quot;
comma
id|i
comma
id|events
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
)paren
id|pcmcia_parse_events
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket
comma
id|events
)paren
suffix:semicolon
id|active
op_or_assign
id|events
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|active
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|20
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;i82365: infinite loop in interrupt handler&bslash;n&quot;
)paren
suffix:semicolon
id|debug
c_func
(paren
l_int|4
comma
l_string|&quot;interrupt done&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
multiline_comment|/* pcic_interrupt */
DECL|function|pcic_interrupt_wrapper
r_static
r_void
id|pcic_interrupt_wrapper
c_func
(paren
id|u_long
id|data
)paren
(brace
id|pcic_interrupt
c_func
(paren
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|poll_timer.expires
op_assign
id|jiffies
op_plus
id|poll_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*====================================================================*/
DECL|function|i365_get_status
r_static
r_int
id|i365_get_status
c_func
(paren
id|u_short
id|sock
comma
id|u_int
op_star
id|value
)paren
(brace
id|u_int
id|status
suffix:semicolon
id|status
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_STATUS
)paren
suffix:semicolon
op_star
id|value
op_assign
(paren
(paren
id|status
op_amp
id|I365_CS_DETECT
)paren
op_eq
id|I365_CS_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
op_amp
id|I365_PC_IOCARD
)paren
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_STSCHG
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_STSCHG
suffix:semicolon
r_else
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_BVD1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_BATDEAD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_BVD2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_BATWARN
suffix:semicolon
)brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_WRPROT
)paren
ques
c_cond
id|SS_WRPROT
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|I365_CS_POWERON
)paren
ques
c_cond
id|SS_POWERON
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|type
op_eq
id|IS_VG469
)paren
(brace
id|status
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|VG469_VSENSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|psock
op_amp
l_int|1
)paren
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_B_VS1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_3VCARD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_B_VS2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_XVCARD
suffix:semicolon
)brace
r_else
(brace
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_A_VS1
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_3VCARD
suffix:semicolon
op_star
id|value
op_or_assign
(paren
id|status
op_amp
id|VG469_VSENSE_A_VS2
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_XVCARD
suffix:semicolon
)brace
)brace
id|debug
c_func
(paren
l_int|1
comma
l_string|&quot;GetStatus(%d) = %#4.4x&bslash;n&quot;
comma
id|sock
comma
op_star
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_status */
multiline_comment|/*====================================================================*/
DECL|function|i365_get_socket
r_static
r_int
id|i365_get_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|reg
comma
id|vcc
comma
id|vpp
suffix:semicolon
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_POWER
)paren
suffix:semicolon
id|state-&gt;flags
op_assign
(paren
id|reg
op_amp
id|I365_PWR_AUTO
)paren
ques
c_cond
id|SS_PWR_AUTO
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;flags
op_or_assign
(paren
id|reg
op_amp
id|I365_PWR_OUT
)paren
ques
c_cond
id|SS_OUTPUT_ENA
suffix:colon
l_int|0
suffix:semicolon
id|vcc
op_assign
id|reg
op_amp
id|I365_VCC_MASK
suffix:semicolon
id|vpp
op_assign
id|reg
op_amp
id|I365_VPP1_MASK
suffix:semicolon
id|state-&gt;Vcc
op_assign
id|state-&gt;Vpp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
)paren
op_amp
id|PD67_MC1_VCC_3V
)paren
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|33
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VG_PWR
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|VG469_VSELECT
)paren
op_amp
id|VG469_VSEL_VCC
)paren
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|33
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_DF_PWR
)paren
(brace
r_if
c_cond
(paren
id|vcc
op_eq
id|I365_VCC_3V
)paren
id|state-&gt;Vcc
op_assign
l_int|33
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
id|I365_VCC_5V
)paren
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|reg
op_amp
id|I365_VCC_5V
)paren
(brace
id|state-&gt;Vcc
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_5V
)paren
id|state-&gt;Vpp
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|vpp
op_eq
id|I365_VPP1_12V
)paren
id|state-&gt;Vpp
op_assign
l_int|120
suffix:semicolon
)brace
)brace
multiline_comment|/* IO card, RESET flags, IO interrupt */
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_INTCTL
)paren
suffix:semicolon
id|state-&gt;flags
op_or_assign
(paren
id|reg
op_amp
id|I365_PC_RESET
)paren
ques
c_cond
l_int|0
suffix:colon
id|SS_RESET
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|I365_PC_IOCARD
)paren
id|state-&gt;flags
op_or_assign
id|SS_IOCARD
suffix:semicolon
id|state-&gt;io_irq
op_assign
id|reg
op_amp
id|I365_IRQ_MASK
suffix:semicolon
multiline_comment|/* speaker control */
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
)paren
op_amp
id|PD67_MC1_SPKR_ENA
)paren
id|state-&gt;flags
op_or_assign
id|SS_SPKR_ENA
suffix:semicolon
)brace
multiline_comment|/* Card status change mask */
id|reg
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_CSCINT
)paren
suffix:semicolon
id|state-&gt;csc_mask
op_assign
(paren
id|reg
op_amp
id|I365_CSC_DETECT
)paren
ques
c_cond
id|SS_DETECT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_STSCHG
)paren
ques
c_cond
id|SS_STSCHG
suffix:colon
l_int|0
suffix:semicolon
r_else
(brace
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_BVD1
)paren
ques
c_cond
id|SS_BATDEAD
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_BVD2
)paren
ques
c_cond
id|SS_BATWARN
suffix:colon
l_int|0
suffix:semicolon
id|state-&gt;csc_mask
op_or_assign
(paren
id|reg
op_amp
id|I365_CSC_READY
)paren
ques
c_cond
id|SS_READY
suffix:colon
l_int|0
suffix:semicolon
)brace
id|debug
c_func
(paren
l_int|1
comma
l_string|&quot;GetSocket(%d) = flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_get_socket */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_socket
r_static
r_int
id|i365_set_socket
c_func
(paren
id|u_short
id|sock
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_struct
id|i82365_socket
op_star
id|t
op_assign
op_amp
id|socket
(braket
id|sock
)braket
suffix:semicolon
id|u_char
id|reg
suffix:semicolon
id|debug
c_func
(paren
l_int|1
comma
l_string|&quot;SetSocket(%d, flags %#3.3x, Vcc %d, Vpp %d, &quot;
l_string|&quot;io_irq %d, csc_mask %#2.2x)&bslash;n&quot;
comma
id|sock
comma
id|state-&gt;flags
comma
id|state-&gt;Vcc
comma
id|state-&gt;Vpp
comma
id|state-&gt;io_irq
comma
id|state-&gt;csc_mask
)paren
suffix:semicolon
multiline_comment|/* First set global controller options */
id|set_bridge_state
c_func
(paren
id|sock
)paren
suffix:semicolon
multiline_comment|/* IO card, RESET flag, IO interrupt */
id|reg
op_assign
id|t-&gt;intr
suffix:semicolon
id|reg
op_or_assign
id|state-&gt;io_irq
suffix:semicolon
id|reg
op_or_assign
(paren
id|state-&gt;flags
op_amp
id|SS_RESET
)paren
ques
c_cond
l_int|0
suffix:colon
id|I365_PC_RESET
suffix:semicolon
id|reg
op_or_assign
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
ques
c_cond
id|I365_PC_IOCARD
suffix:colon
l_int|0
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_INTCTL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|I365_PWR_NORESET
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_PWR_AUTO
)paren
id|reg
op_or_assign
id|I365_PWR_AUTO
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_OUTPUT_ENA
)paren
id|reg
op_or_assign
id|I365_PWR_OUT
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
l_int|120
)paren
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
id|state-&gt;Vcc
)paren
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;Vcc
op_ne
l_int|0
)paren
(brace
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|33
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_VCC_3V
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|50
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_VCC_3V
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_VG_PWR
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
l_int|120
)paren
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vpp
op_eq
id|state-&gt;Vcc
)paren
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;Vcc
op_ne
l_int|0
)paren
(brace
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|33
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|VG469_VSELECT
comma
id|VG469_VSEL_VCC
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state-&gt;Vcc
op_eq
l_int|50
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|VG469_VSELECT
comma
id|VG469_VSEL_VCC
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_DF_PWR
)paren
(brace
r_switch
c_cond
(paren
id|state-&gt;Vcc
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|33
suffix:colon
id|reg
op_or_assign
id|I365_VCC_3V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|state-&gt;Vpp
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_12V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|state-&gt;Vcc
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VCC_5V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|state-&gt;Vpp
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_5V
op_or
id|I365_VPP2_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
id|reg
op_or_assign
id|I365_VPP1_12V
op_or
id|I365_VPP2_12V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|reg
op_ne
id|i365_get
c_func
(paren
id|sock
comma
id|I365_POWER
)paren
)paren
id|i365_set
c_func
(paren
id|sock
comma
id|I365_POWER
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Chipset-specific functions */
r_if
c_cond
(paren
id|t-&gt;flags
op_amp
id|IS_CIRRUS
)paren
(brace
multiline_comment|/* Speaker control */
id|i365_bflip
c_func
(paren
id|sock
comma
id|PD67_MISC_CTL_1
comma
id|PD67_MC1_SPKR_ENA
comma
id|state-&gt;flags
op_amp
id|SS_SPKR_ENA
)paren
suffix:semicolon
)brace
multiline_comment|/* Card status change interrupt mask */
id|reg
op_assign
id|t-&gt;cs_irq
op_lshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_DETECT
)paren
id|reg
op_or_assign
id|I365_CSC_DETECT
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;flags
op_amp
id|SS_IOCARD
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_STSCHG
)paren
id|reg
op_or_assign
id|I365_CSC_STSCHG
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_BATDEAD
)paren
id|reg
op_or_assign
id|I365_CSC_BVD1
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_BATWARN
)paren
id|reg
op_or_assign
id|I365_CSC_BVD2
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;csc_mask
op_amp
id|SS_READY
)paren
id|reg
op_or_assign
id|I365_CSC_READY
suffix:semicolon
)brace
id|i365_set
c_func
(paren
id|sock
comma
id|I365_CSCINT
comma
id|reg
)paren
suffix:semicolon
id|i365_get
c_func
(paren
id|sock
comma
id|I365_CSC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_socket */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_io_map
r_static
r_int
id|i365_set_io_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
id|u_char
id|map
comma
id|ioctl
suffix:semicolon
id|debug
c_func
(paren
l_int|1
comma
l_string|&quot;SetIOMap(%d, %d, %#2.2x, %d ns, &quot;
l_string|&quot;%#4.4x-%#4.4x)&bslash;n&quot;
comma
id|sock
comma
id|io-&gt;map
comma
id|io-&gt;flags
comma
id|io-&gt;speed
comma
id|io-&gt;start
comma
id|io-&gt;stop
)paren
suffix:semicolon
id|map
op_assign
id|io-&gt;map
suffix:semicolon
r_if
c_cond
(paren
(paren
id|map
OG
l_int|1
)paren
op_logical_or
(paren
id|io-&gt;start
OG
l_int|0xffff
)paren
op_logical_or
(paren
id|io-&gt;stop
OG
l_int|0xffff
)paren
op_logical_or
(paren
id|io-&gt;stop
OL
id|io-&gt;start
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Turn off the window before changing anything */
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_START
comma
id|io-&gt;start
)paren
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|I365_IO
c_func
(paren
id|map
)paren
op_plus
id|I365_W_STOP
comma
id|io-&gt;stop
)paren
suffix:semicolon
id|ioctl
op_assign
id|i365_get
c_func
(paren
id|sock
comma
id|I365_IOCTL
)paren
op_amp
op_complement
id|I365_IOCTL_MASK
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;speed
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_WAIT
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_0WS
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_0WS
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_16BIT
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_16BIT
c_func
(paren
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_AUTOSZ
)paren
id|ioctl
op_or_assign
id|I365_IOCTL_IOCS16
c_func
(paren
id|map
)paren
suffix:semicolon
id|i365_set
c_func
(paren
id|sock
comma
id|I365_IOCTL
comma
id|ioctl
)paren
suffix:semicolon
multiline_comment|/* Turn on the window if necessary */
r_if
c_cond
(paren
id|io-&gt;flags
op_amp
id|MAP_ACTIVE
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_IO
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_io_map */
multiline_comment|/*====================================================================*/
DECL|function|i365_set_mem_map
r_static
r_int
id|i365_set_mem_map
c_func
(paren
id|u_short
id|sock
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
id|u_short
id|base
comma
id|i
suffix:semicolon
id|u_char
id|map
suffix:semicolon
id|debug
c_func
(paren
l_int|1
comma
l_string|&quot;SetMemMap(%d, %d, %#2.2x, %d ns, %#5.5lx-%#5.5&quot;
l_string|&quot;lx, %#5.5x)&bslash;n&quot;
comma
id|sock
comma
id|mem-&gt;map
comma
id|mem-&gt;flags
comma
id|mem-&gt;speed
comma
id|mem-&gt;sys_start
comma
id|mem-&gt;sys_stop
comma
id|mem-&gt;card_start
)paren
suffix:semicolon
id|map
op_assign
id|mem-&gt;map
suffix:semicolon
r_if
c_cond
(paren
(paren
id|map
OG
l_int|4
)paren
op_logical_or
(paren
id|mem-&gt;card_start
OG
l_int|0x3ffffff
)paren
op_logical_or
(paren
id|mem-&gt;sys_start
OG
id|mem-&gt;sys_stop
)paren
op_logical_or
(paren
id|mem-&gt;speed
OG
l_int|1000
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mem-&gt;sys_start
OG
l_int|0xffffff
)paren
op_logical_or
(paren
id|mem-&gt;sys_stop
OG
l_int|0xffffff
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Turn off the window before changing anything */
r_if
c_cond
(paren
id|i365_get
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
)paren
op_amp
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
id|i365_bclr
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
id|base
op_assign
id|I365_MEM
c_func
(paren
id|map
)paren
suffix:semicolon
id|i
op_assign
(paren
id|mem-&gt;sys_start
op_rshift
l_int|12
)paren
op_amp
l_int|0x0fff
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_16BIT
)paren
id|i
op_or_assign
id|I365_MEM_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_0WS
)paren
id|i
op_or_assign
id|I365_MEM_0WS
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_START
comma
id|i
)paren
suffix:semicolon
id|i
op_assign
(paren
id|mem-&gt;sys_stop
op_rshift
l_int|12
)paren
op_amp
l_int|0x0fff
suffix:semicolon
r_switch
c_cond
(paren
id|to_cycles
c_func
(paren
id|mem-&gt;speed
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|i
op_or_assign
id|I365_MEM_WS1
op_or
id|I365_MEM_WS0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_STOP
comma
id|i
)paren
suffix:semicolon
id|i
op_assign
(paren
(paren
id|mem-&gt;card_start
op_minus
id|mem-&gt;sys_start
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0x3fff
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_WRPROT
)paren
id|i
op_or_assign
id|I365_MEM_WRPROT
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_ATTRIB
)paren
id|i
op_or_assign
id|I365_MEM_REG
suffix:semicolon
id|i365_set_pair
c_func
(paren
id|sock
comma
id|base
op_plus
id|I365_W_OFF
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Turn on the window if necessary */
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|MAP_ACTIVE
)paren
id|i365_bset
c_func
(paren
id|sock
comma
id|I365_ADDRWIN
comma
id|I365_ENA_MEM
c_func
(paren
id|map
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* i365_set_mem_map */
macro_line|#if 0 /* driver model ordering issue */
multiline_comment|/*======================================================================&n;&n;    Routines for accessing socket information and register dumps via&n;    /sys/class/pcmcia_socket/...&n;    &n;======================================================================*/
r_static
id|ssize_t
id|show_info
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|i82365_socket
op_star
id|s
op_assign
id|container_of
c_func
(paren
id|class_dev
comma
r_struct
id|i82365_socket
comma
id|socket.dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;type:     %s&bslash;npsock:    %d&bslash;n&quot;
comma
id|pcic
(braket
id|s-&gt;type
)braket
dot
id|name
comma
id|s-&gt;psock
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
id|show_exca
c_func
(paren
r_struct
id|class_device
op_star
id|class_dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|i82365_socket
op_star
id|s
op_assign
id|container_of
c_func
(paren
id|class_dev
comma
r_struct
id|i82365_socket
comma
id|socket.dev
)paren
suffix:semicolon
r_int
r_int
id|sock
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
id|sock
op_assign
id|s-&gt;number
suffix:semicolon
id|ISA_LOCK
c_func
(paren
id|sock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x40
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|ret
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%02x %02x %02x %02x%s&quot;
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|1
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|2
)paren
comma
id|i365_get
c_func
(paren
id|sock
comma
id|i
op_plus
l_int|3
)paren
comma
(paren
(paren
id|i
op_mod
l_int|16
)paren
op_eq
l_int|12
)paren
ques
c_cond
l_string|&quot;&bslash;n&quot;
suffix:colon
l_string|&quot; &quot;
)paren
suffix:semicolon
id|buf
op_add_assign
id|ret
suffix:semicolon
)brace
id|ISA_UNLOCK
c_func
(paren
id|sock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|exca
comma
id|S_IRUGO
comma
id|show_exca
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|info
comma
id|S_IRUGO
comma
id|show_info
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*====================================================================*/
multiline_comment|/* this is horribly ugly... proper locking needs to be done here at &n; * some time... */
DECL|macro|LOCKED
mdefine_line|#define LOCKED(x) do { &bslash;&n;&t;int retval; &bslash;&n;&t;unsigned long flags; &bslash;&n;&t;spin_lock_irqsave(&amp;isa_lock, flags); &bslash;&n;&t;retval = x; &bslash;&n;&t;spin_unlock_irqrestore(&amp;isa_lock, flags); &bslash;&n;&t;return retval; &bslash;&n;} while (0)
DECL|function|pcic_get_status
r_static
r_int
id|pcic_get_status
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
comma
id|u_int
op_star
id|value
)paren
(brace
r_int
r_int
id|sock
op_assign
id|container_of
c_func
(paren
id|s
comma
r_struct
id|i82365_socket
comma
id|socket
)paren
op_member_access_from_pointer
id|number
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
(brace
op_star
id|value
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|LOCKED
c_func
(paren
id|i365_get_status
c_func
(paren
id|sock
comma
id|value
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_get_socket
r_static
r_int
id|pcic_get_socket
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_int
r_int
id|sock
op_assign
id|container_of
c_func
(paren
id|s
comma
r_struct
id|i82365_socket
comma
id|socket
)paren
op_member_access_from_pointer
id|number
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_get_socket
c_func
(paren
id|sock
comma
id|state
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_socket
r_static
r_int
id|pcic_set_socket
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
comma
id|socket_state_t
op_star
id|state
)paren
(brace
r_int
r_int
id|sock
op_assign
id|container_of
c_func
(paren
id|s
comma
r_struct
id|i82365_socket
comma
id|socket
)paren
op_member_access_from_pointer
id|number
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_set_socket
c_func
(paren
id|sock
comma
id|state
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_io_map
r_static
r_int
id|pcic_set_io_map
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
comma
r_struct
id|pccard_io_map
op_star
id|io
)paren
(brace
r_int
r_int
id|sock
op_assign
id|container_of
c_func
(paren
id|s
comma
r_struct
id|i82365_socket
comma
id|socket
)paren
op_member_access_from_pointer
id|number
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_set_io_map
c_func
(paren
id|sock
comma
id|io
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_set_mem_map
r_static
r_int
id|pcic_set_mem_map
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
comma
r_struct
id|pccard_mem_map
op_star
id|mem
)paren
(brace
r_int
r_int
id|sock
op_assign
id|container_of
c_func
(paren
id|s
comma
r_struct
id|i82365_socket
comma
id|socket
)paren
op_member_access_from_pointer
id|number
suffix:semicolon
r_if
c_cond
(paren
id|socket
(braket
id|sock
)braket
dot
id|flags
op_amp
id|IS_ALIVE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|LOCKED
c_func
(paren
id|i365_set_mem_map
c_func
(paren
id|sock
comma
id|mem
)paren
)paren
suffix:semicolon
)brace
DECL|function|pcic_init
r_static
r_int
id|pcic_init
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|pccard_io_map
id|io
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
suffix:semicolon
id|pccard_mem_map
id|mem
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|mem.sys_stop
op_assign
l_int|0x1000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|io.map
op_assign
id|i
suffix:semicolon
id|pcic_set_io_map
c_func
(paren
id|s
comma
op_amp
id|io
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mem.map
op_assign
id|i
suffix:semicolon
id|pcic_set_mem_map
c_func
(paren
id|s
comma
op_amp
id|mem
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcic_suspend
r_static
r_int
id|pcic_suspend
c_func
(paren
r_struct
id|pcmcia_socket
op_star
id|sock
)paren
(brace
r_return
id|pcic_set_socket
c_func
(paren
id|sock
comma
op_amp
id|dead_socket
)paren
suffix:semicolon
)brace
DECL|variable|pcic_operations
r_static
r_struct
id|pccard_operations
id|pcic_operations
op_assign
(brace
dot
id|init
op_assign
id|pcic_init
comma
dot
id|suspend
op_assign
id|pcic_suspend
comma
dot
id|get_status
op_assign
id|pcic_get_status
comma
dot
id|get_socket
op_assign
id|pcic_get_socket
comma
dot
id|set_socket
op_assign
id|pcic_set_socket
comma
dot
id|set_io_map
op_assign
id|pcic_set_io_map
comma
dot
id|set_mem_map
op_assign
id|pcic_set_mem_map
comma
)brace
suffix:semicolon
multiline_comment|/*====================================================================*/
DECL|function|i82365_suspend
r_static
r_int
id|i82365_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_SAVE_STATE
)paren
id|ret
op_assign
id|pcmcia_socket_dev_suspend
c_func
(paren
id|dev
comma
id|state
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|i82365_resume
r_static
r_int
id|i82365_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|level
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
id|RESUME_RESTORE_STATE
)paren
id|ret
op_assign
id|pcmcia_socket_dev_resume
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|i82365_driver
r_static
r_struct
id|device_driver
id|i82365_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i82365&quot;
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
dot
id|suspend
op_assign
id|i82365_suspend
comma
dot
id|resume
op_assign
id|i82365_resume
comma
)brace
suffix:semicolon
DECL|variable|i82365_device
r_static
r_struct
id|platform_device
id|i82365_device
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i82365&quot;
comma
dot
id|id
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|init_i82365
r_static
r_int
id|__init
id|init_i82365
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
id|ret
op_assign
id|driver_register
c_func
(paren
op_amp
id|i82365_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|platform_device_register
c_func
(paren
op_amp
id|i82365_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|i82365_driver
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Intel ISA PCIC probe: &quot;
)paren
suffix:semicolon
id|sockets
op_assign
l_int|0
suffix:semicolon
id|isa_probe
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sockets
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;not found.&bslash;n&quot;
)paren
suffix:semicolon
id|platform_device_unregister
c_func
(paren
op_amp
id|i82365_device
)paren
suffix:semicolon
id|driver_unregister
c_func
(paren
op_amp
id|i82365_driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Set up interrupt handler(s) */
r_if
c_cond
(paren
id|grab_irq
op_ne
l_int|0
)paren
id|request_irq
c_func
(paren
id|cs_irq
comma
id|pcic_interrupt
comma
l_int|0
comma
l_string|&quot;i82365&quot;
comma
id|pcic_interrupt
)paren
suffix:semicolon
multiline_comment|/* register sockets with the pcmcia core */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|socket
(braket
id|i
)braket
dot
id|socket.dev.dev
op_assign
op_amp
id|i82365_device.dev
suffix:semicolon
id|socket
(braket
id|i
)braket
dot
id|socket.ops
op_assign
op_amp
id|pcic_operations
suffix:semicolon
id|socket
(braket
id|i
)braket
dot
id|socket.owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|socket
(braket
id|i
)braket
dot
id|number
op_assign
id|i
suffix:semicolon
id|ret
op_assign
id|pcmcia_register_socket
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_logical_and
id|i
op_decrement
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|pcmcia_unregister_socket
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#if 0 /* driver model ordering issue */
id|class_device_create_file
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket.dev
comma
op_amp
id|class_device_attr_info
)paren
suffix:semicolon
id|class_device_create_file
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket.dev
comma
op_amp
id|class_device_attr_exca
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Finally, schedule a polling interrupt */
r_if
c_cond
(paren
id|poll_interval
op_ne
l_int|0
)paren
(brace
id|poll_timer.function
op_assign
id|pcic_interrupt_wrapper
suffix:semicolon
id|poll_timer.data
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
id|poll_timer.expires
op_assign
id|jiffies
op_plus
id|poll_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* init_i82365 */
DECL|function|exit_i82365
r_static
r_void
id|__exit
id|exit_i82365
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pcmcia_unregister_socket
c_func
(paren
op_amp
id|socket
(braket
id|i
)braket
dot
id|socket
)paren
suffix:semicolon
)brace
id|platform_device_unregister
c_func
(paren
op_amp
id|i82365_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poll_interval
op_ne
l_int|0
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|poll_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|grab_irq
op_ne
l_int|0
)paren
id|free_irq
c_func
(paren
id|cs_irq
comma
id|pcic_interrupt
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sockets
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Turn off all interrupt sources! */
id|i365_set
c_func
(paren
id|i
comma
id|I365_CSCINT
comma
l_int|0
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|socket
(braket
id|i
)braket
dot
id|ioaddr
comma
l_int|2
)paren
suffix:semicolon
)brace
macro_line|#ifdef __ISAPNP__
r_if
c_cond
(paren
id|i82365_pnpdev
)paren
id|pnp_disable_dev
c_func
(paren
id|i82365_pnpdev
)paren
suffix:semicolon
macro_line|#endif
id|driver_unregister
c_func
(paren
op_amp
id|i82365_driver
)paren
suffix:semicolon
)brace
multiline_comment|/* exit_i82365 */
DECL|variable|init_i82365
id|module_init
c_func
(paren
id|init_i82365
)paren
suffix:semicolon
DECL|variable|exit_i82365
id|module_exit
c_func
(paren
id|exit_i82365
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual MPL/GPL&quot;
)paren
suffix:semicolon
multiline_comment|/*====================================================================*/
eof
