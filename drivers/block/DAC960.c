multiline_comment|/*&n;&n;  Linux Driver for Mylex DAC960/AcceleRAID/eXtremeRAID PCI RAID Controllers&n;&n;  Copyright 1998-2001 by Leonard N. Zubkoff &lt;lnz@dandelion.com&gt;&n;&n;  This program is free software; you may redistribute and/or modify it under&n;  the terms of the GNU General Public License Version 2 as published by the&n;  Free Software Foundation.&n;&n;  This program is distributed in the hope that it will be useful, but&n;  WITHOUT ANY WARRANTY, without even the implied warranty of MERCHANTABILITY&n;  or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n;  for complete details.&n;&n;*/
DECL|macro|DAC960_DriverVersion
mdefine_line|#define DAC960_DriverVersion&t;&t;&t;&quot;2.5.47&quot;
DECL|macro|DAC960_DriverDate
mdefine_line|#define DAC960_DriverDate&t;&t;&t;&quot;14 November 2002&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/miscdevice.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/bio.h&gt;
macro_line|#include &lt;linux/completion.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/genhd.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/blkpg.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;DAC960.h&quot;
DECL|macro|DAC960_GAM_MINOR
mdefine_line|#define DAC960_GAM_MINOR&t;252
DECL|variable|DAC960_Controllers
r_static
id|DAC960_Controller_T
op_star
id|DAC960_Controllers
(braket
id|DAC960_MaxControllers
)braket
suffix:semicolon
DECL|variable|DAC960_ControllerCount
r_static
r_int
id|DAC960_ControllerCount
suffix:semicolon
DECL|variable|DAC960_ProcDirectoryEntry
r_static
r_struct
id|proc_dir_entry
op_star
id|DAC960_ProcDirectoryEntry
suffix:semicolon
DECL|function|disk_size
r_static
r_int
id|disk_size
c_func
(paren
id|DAC960_Controller_T
op_star
id|p
comma
r_int
id|drive_nr
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
r_if
c_cond
(paren
id|drive_nr
op_ge
id|p-&gt;LogicalDriveCount
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|p-&gt;V1.LogicalDriveInformation
(braket
id|drive_nr
)braket
dot
id|LogicalDriveSize
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|i
op_assign
id|p-&gt;V2.LogicalDeviceInformation
(braket
id|drive_nr
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i-&gt;ConfigurableDeviceSize
suffix:semicolon
)brace
)brace
DECL|function|DAC960_open
r_static
r_int
id|DAC960_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|gendisk
op_star
id|disk
op_assign
id|inode-&gt;i_bdev-&gt;bd_disk
suffix:semicolon
id|DAC960_Controller_T
op_star
id|p
op_assign
id|disk-&gt;queue-&gt;queuedata
suffix:semicolon
r_int
id|drive_nr
op_assign
(paren
r_int
)paren
id|disk-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;V1.LogicalDriveInformation
(braket
id|drive_nr
)braket
dot
id|LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Offline
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|i
op_assign
id|p-&gt;V2.LogicalDeviceInformation
(braket
id|drive_nr
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_or
id|i-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Offline
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|check_disk_change
c_func
(paren
id|inode-&gt;i_bdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get_capacity
c_func
(paren
id|p-&gt;disks
(braket
id|drive_nr
)braket
)paren
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DAC960_ioctl
r_static
r_int
id|DAC960_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|gendisk
op_star
id|disk
op_assign
id|inode-&gt;i_bdev-&gt;bd_disk
suffix:semicolon
id|DAC960_Controller_T
op_star
id|p
op_assign
id|disk-&gt;queue-&gt;queuedata
suffix:semicolon
r_int
id|drive_nr
op_assign
(paren
r_int
)paren
id|disk-&gt;private_data
suffix:semicolon
r_struct
id|hd_geometry
id|g
comma
op_star
id|loc
op_assign
(paren
r_struct
id|hd_geometry
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|HDIO_GETGEO
op_logical_or
op_logical_neg
id|loc
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|g.heads
op_assign
id|p-&gt;V1.GeometryTranslationHeads
suffix:semicolon
id|g.sectors
op_assign
id|p-&gt;V1.GeometryTranslationSectors
suffix:semicolon
id|g.cylinders
op_assign
id|p-&gt;V1.LogicalDriveInformation
(braket
id|drive_nr
)braket
dot
id|LogicalDriveSize
op_div
(paren
id|g.heads
op_star
id|g.sectors
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|i
op_assign
id|p-&gt;V2.LogicalDeviceInformation
(braket
id|drive_nr
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|i-&gt;DriveGeometry
)paren
(brace
r_case
id|DAC960_V2_Geometry_128_32
suffix:colon
id|g.heads
op_assign
l_int|128
suffix:semicolon
id|g.sectors
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V2_Geometry_255_63
suffix:colon
id|g.heads
op_assign
l_int|255
suffix:semicolon
id|g.sectors
op_assign
l_int|63
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Illegal Logical Device Geometry %d&bslash;n&quot;
comma
id|p
comma
id|i-&gt;DriveGeometry
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|g.cylinders
op_assign
id|i-&gt;ConfigurableDeviceSize
op_div
(paren
id|g.heads
op_star
id|g.sectors
)paren
suffix:semicolon
)brace
id|g.start
op_assign
id|get_start_sect
c_func
(paren
id|inode-&gt;i_bdev
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|loc
comma
op_amp
id|g
comma
r_sizeof
id|g
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|DAC960_media_changed
r_static
r_int
id|DAC960_media_changed
c_func
(paren
r_struct
id|gendisk
op_star
id|disk
)paren
(brace
id|DAC960_Controller_T
op_star
id|p
op_assign
id|disk-&gt;queue-&gt;queuedata
suffix:semicolon
r_int
id|drive_nr
op_assign
(paren
r_int
)paren
id|disk-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;LogicalDriveInitiallyAccessible
(braket
id|drive_nr
)braket
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DAC960_revalidate_disk
r_static
r_int
id|DAC960_revalidate_disk
c_func
(paren
r_struct
id|gendisk
op_star
id|disk
)paren
(brace
id|DAC960_Controller_T
op_star
id|p
op_assign
id|disk-&gt;queue-&gt;queuedata
suffix:semicolon
r_int
id|unit
op_assign
(paren
r_int
)paren
id|disk-&gt;private_data
suffix:semicolon
id|set_capacity
c_func
(paren
id|disk
comma
id|disk_size
c_func
(paren
id|p
comma
id|unit
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|DAC960_BlockDeviceOperations
r_static
r_struct
id|block_device_operations
id|DAC960_BlockDeviceOperations
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|DAC960_open
comma
dot
id|ioctl
op_assign
id|DAC960_ioctl
comma
dot
id|media_changed
op_assign
id|DAC960_media_changed
comma
dot
id|revalidate_disk
op_assign
id|DAC960_revalidate_disk
comma
)brace
suffix:semicolon
multiline_comment|/*&n;  DAC960_AnnounceDriver announces the Driver Version and Date, Author&squot;s Name,&n;  Copyright Notice, and Electronic Mail Address.&n;*/
DECL|function|DAC960_AnnounceDriver
r_static
r_void
id|DAC960_AnnounceDriver
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Announce
c_func
(paren
l_string|&quot;***** DAC960 RAID Driver Version &quot;
id|DAC960_DriverVersion
l_string|&quot; of &quot;
id|DAC960_DriverDate
l_string|&quot; *****&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_Announce
c_func
(paren
l_string|&quot;Copyright 1998-2001 by Leonard N. Zubkoff &quot;
l_string|&quot;&lt;lnz@dandelion.com&gt;&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Failure prints a standardized error message, and then returns false.&n;*/
DECL|function|DAC960_Failure
r_static
id|boolean
id|DAC960_Failure
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|ErrorMessage
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;While configuring DAC960 PCI RAID Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;IO_Address
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;%s FAILED - DETACHING&bslash;n&quot;
comma
id|Controller
comma
id|ErrorMessage
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  init_dma_loaf() and slice_dma_loaf() are helper functions for&n;  aggregating the dma-mapped memory for a well-known collection of&n;  data structures that are of different lengths.&n;&n;  These routines don&squot;t guarantee any alignment.  The caller must&n;  include any space needed for alignment in the sizes of the structures&n;  that are passed in.&n; */
DECL|function|init_dma_loaf
r_static
id|boolean
id|init_dma_loaf
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|dma_loaf
op_star
id|loaf
comma
r_int
id|len
)paren
(brace
r_void
op_star
id|cpu_addr
suffix:semicolon
id|dma_addr_t
id|dma_handle
suffix:semicolon
id|cpu_addr
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
id|len
comma
op_amp
id|dma_handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_addr
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|loaf-&gt;cpu_free
op_assign
id|loaf-&gt;cpu_base
op_assign
id|cpu_addr
suffix:semicolon
id|loaf-&gt;dma_free
op_assign
id|loaf-&gt;dma_base
op_assign
id|dma_handle
suffix:semicolon
id|loaf-&gt;length
op_assign
id|len
suffix:semicolon
id|memset
c_func
(paren
id|cpu_addr
comma
l_int|0
comma
id|len
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
DECL|function|slice_dma_loaf
r_static
r_void
op_star
id|slice_dma_loaf
c_func
(paren
r_struct
id|dma_loaf
op_star
id|loaf
comma
r_int
id|len
comma
id|dma_addr_t
op_star
id|dma_handle
)paren
(brace
r_void
op_star
id|cpu_end
op_assign
id|loaf-&gt;cpu_free
op_plus
id|len
suffix:semicolon
r_void
op_star
id|cpu_addr
op_assign
id|loaf-&gt;cpu_free
suffix:semicolon
r_if
c_cond
(paren
id|cpu_end
OG
id|loaf-&gt;cpu_base
op_plus
id|loaf-&gt;length
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
op_star
id|dma_handle
op_assign
id|loaf-&gt;dma_free
suffix:semicolon
id|loaf-&gt;cpu_free
op_assign
id|cpu_end
suffix:semicolon
id|loaf-&gt;dma_free
op_add_assign
id|len
suffix:semicolon
r_return
id|cpu_addr
suffix:semicolon
)brace
DECL|function|free_dma_loaf
r_static
r_void
id|free_dma_loaf
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|dma_loaf
op_star
id|loaf_handle
)paren
(brace
r_if
c_cond
(paren
id|loaf_handle-&gt;cpu_base
op_ne
l_int|NULL
)paren
id|pci_free_consistent
c_func
(paren
id|dev
comma
id|loaf_handle-&gt;length
comma
id|loaf_handle-&gt;cpu_base
comma
id|loaf_handle-&gt;dma_base
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CreateAuxiliaryStructures allocates and initializes the auxiliary&n;  data structures for Controller.  It returns true on success and false on&n;  failure.&n;*/
DECL|function|DAC960_CreateAuxiliaryStructures
r_static
id|boolean
id|DAC960_CreateAuxiliaryStructures
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|CommandAllocationLength
comma
id|CommandAllocationGroupSize
suffix:semicolon
r_int
id|CommandsRemaining
op_assign
l_int|0
comma
id|CommandIdentifier
comma
id|CommandGroupByteCount
suffix:semicolon
r_void
op_star
id|AllocationPointer
op_assign
l_int|NULL
suffix:semicolon
r_void
op_star
id|ScatterGatherCPU
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|ScatterGatherDMA
suffix:semicolon
r_struct
id|pci_pool
op_star
id|ScatterGatherPool
suffix:semicolon
r_void
op_star
id|RequestSenseCPU
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|RequestSenseDMA
suffix:semicolon
r_struct
id|pci_pool
op_star
id|RequestSensePool
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|CommandAllocationLength
op_assign
m_offsetof
(paren
id|DAC960_Command_T
comma
id|V1.EndMarker
)paren
suffix:semicolon
id|CommandAllocationGroupSize
op_assign
id|DAC960_V1_CommandAllocationGroupSize
suffix:semicolon
id|ScatterGatherPool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;DAC960_V1_ScatterGather&quot;
comma
id|Controller-&gt;PCIDevice
comma
id|DAC960_V1_ScatterGatherLimit
op_star
r_sizeof
(paren
id|DAC960_V1_ScatterGatherSegment_T
)paren
comma
r_sizeof
(paren
id|DAC960_V1_ScatterGatherSegment_T
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ScatterGatherPool
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION (SG)&quot;
)paren
suffix:semicolon
id|Controller-&gt;ScatterGatherPool
op_assign
id|ScatterGatherPool
suffix:semicolon
)brace
r_else
(brace
id|CommandAllocationLength
op_assign
m_offsetof
(paren
id|DAC960_Command_T
comma
id|V2.EndMarker
)paren
suffix:semicolon
id|CommandAllocationGroupSize
op_assign
id|DAC960_V2_CommandAllocationGroupSize
suffix:semicolon
id|ScatterGatherPool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;DAC960_V2_ScatterGather&quot;
comma
id|Controller-&gt;PCIDevice
comma
id|DAC960_V2_ScatterGatherLimit
op_star
r_sizeof
(paren
id|DAC960_V2_ScatterGatherSegment_T
)paren
comma
r_sizeof
(paren
id|DAC960_V2_ScatterGatherSegment_T
)paren
comma
l_int|0
)paren
suffix:semicolon
id|RequestSensePool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;DAC960_V2_RequestSense&quot;
comma
id|Controller-&gt;PCIDevice
comma
r_sizeof
(paren
id|DAC960_SCSI_RequestSense_T
)paren
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ScatterGatherPool
op_eq
l_int|NULL
op_logical_or
id|RequestSensePool
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION (SG)&quot;
)paren
suffix:semicolon
id|Controller-&gt;ScatterGatherPool
op_assign
id|ScatterGatherPool
suffix:semicolon
id|Controller-&gt;V2.RequestSensePool
op_assign
id|RequestSensePool
suffix:semicolon
)brace
id|Controller-&gt;CommandAllocationGroupSize
op_assign
id|CommandAllocationGroupSize
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|CommandIdentifier
op_le
id|Controller-&gt;DriverQueueDepth
suffix:semicolon
id|CommandIdentifier
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|CommandsRemaining
op_le
l_int|0
)paren
(brace
id|CommandsRemaining
op_assign
id|Controller-&gt;DriverQueueDepth
op_minus
id|CommandIdentifier
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|CommandsRemaining
OG
id|CommandAllocationGroupSize
)paren
id|CommandsRemaining
op_assign
id|CommandAllocationGroupSize
suffix:semicolon
id|CommandGroupByteCount
op_assign
id|CommandsRemaining
op_star
id|CommandAllocationLength
suffix:semicolon
id|AllocationPointer
op_assign
id|kmalloc
c_func
(paren
id|CommandGroupByteCount
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AllocationPointer
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|AllocationPointer
comma
l_int|0
comma
id|CommandGroupByteCount
)paren
suffix:semicolon
)brace
id|Command
op_assign
(paren
id|DAC960_Command_T
op_star
)paren
id|AllocationPointer
suffix:semicolon
id|AllocationPointer
op_add_assign
id|CommandAllocationLength
suffix:semicolon
id|Command-&gt;CommandIdentifier
op_assign
id|CommandIdentifier
suffix:semicolon
id|Command-&gt;Controller
op_assign
id|Controller
suffix:semicolon
id|Command-&gt;Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command
suffix:semicolon
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
op_assign
id|Command
suffix:semicolon
id|ScatterGatherCPU
op_assign
id|pci_pool_alloc
c_func
(paren
id|ScatterGatherPool
comma
id|SLAB_ATOMIC
comma
op_amp
id|ScatterGatherDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ScatterGatherCPU
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSensePool
op_ne
l_int|NULL
)paren
(brace
id|RequestSenseCPU
op_assign
id|pci_pool_alloc
c_func
(paren
id|RequestSensePool
comma
id|SLAB_ATOMIC
comma
op_amp
id|RequestSenseDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseCPU
op_eq
l_int|NULL
)paren
(brace
id|pci_pool_free
c_func
(paren
id|ScatterGatherPool
comma
id|ScatterGatherCPU
comma
id|ScatterGatherDMA
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;AUXILIARY STRUCTURE CREATION&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|Command-&gt;cmd_sglist
op_assign
id|Command-&gt;V1.ScatterList
suffix:semicolon
id|Command-&gt;V1.ScatterGatherList
op_assign
(paren
id|DAC960_V1_ScatterGatherSegment_T
op_star
)paren
id|ScatterGatherCPU
suffix:semicolon
id|Command-&gt;V1.ScatterGatherListDMA
op_assign
id|ScatterGatherDMA
suffix:semicolon
)brace
r_else
(brace
id|Command-&gt;cmd_sglist
op_assign
id|Command-&gt;V2.ScatterList
suffix:semicolon
id|Command-&gt;V2.ScatterGatherList
op_assign
(paren
id|DAC960_V2_ScatterGatherSegment_T
op_star
)paren
id|ScatterGatherCPU
suffix:semicolon
id|Command-&gt;V2.ScatterGatherListDMA
op_assign
id|ScatterGatherDMA
suffix:semicolon
id|Command-&gt;V2.RequestSense
op_assign
(paren
id|DAC960_SCSI_RequestSense_T
op_star
)paren
id|RequestSenseCPU
suffix:semicolon
id|Command-&gt;V2.RequestSenseDMA
op_assign
id|RequestSenseDMA
suffix:semicolon
)brace
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DestroyAuxiliaryStructures deallocates the auxiliary data&n;  structures for Controller.&n;*/
DECL|function|DAC960_DestroyAuxiliaryStructures
r_static
r_void
id|DAC960_DestroyAuxiliaryStructures
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pci_pool
op_star
id|ScatterGatherPool
op_assign
id|Controller-&gt;ScatterGatherPool
suffix:semicolon
r_struct
id|pci_pool
op_star
id|RequestSensePool
op_assign
l_int|NULL
suffix:semicolon
r_void
op_star
id|ScatterGatherCPU
suffix:semicolon
id|dma_addr_t
id|ScatterGatherDMA
suffix:semicolon
r_void
op_star
id|RequestSenseCPU
suffix:semicolon
id|dma_addr_t
id|RequestSenseDMA
suffix:semicolon
id|DAC960_Command_T
op_star
id|CommandGroup
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V2_Controller
)paren
id|RequestSensePool
op_assign
id|Controller-&gt;V2.RequestSensePool
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|Controller-&gt;DriverQueueDepth
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|ScatterGatherCPU
op_assign
(paren
r_void
op_star
)paren
id|Command-&gt;V1.ScatterGatherList
suffix:semicolon
id|ScatterGatherDMA
op_assign
id|Command-&gt;V1.ScatterGatherListDMA
suffix:semicolon
id|RequestSenseCPU
op_assign
l_int|NULL
suffix:semicolon
id|RequestSenseDMA
op_assign
(paren
id|dma_addr_t
)paren
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ScatterGatherCPU
op_assign
(paren
r_void
op_star
)paren
id|Command-&gt;V2.ScatterGatherList
suffix:semicolon
id|ScatterGatherDMA
op_assign
id|Command-&gt;V2.ScatterGatherListDMA
suffix:semicolon
id|RequestSenseCPU
op_assign
(paren
r_void
op_star
)paren
id|Command-&gt;V2.RequestSense
suffix:semicolon
id|RequestSenseDMA
op_assign
id|Command-&gt;V2.RequestSenseDMA
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ScatterGatherCPU
op_ne
l_int|NULL
)paren
id|pci_pool_free
c_func
(paren
id|ScatterGatherPool
comma
id|ScatterGatherCPU
comma
id|ScatterGatherDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseCPU
op_ne
l_int|NULL
)paren
id|pci_pool_free
c_func
(paren
id|RequestSensePool
comma
id|RequestSenseCPU
comma
id|RequestSenseDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Command-&gt;CommandIdentifier
op_mod
id|Controller-&gt;CommandAllocationGroupSize
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/*&n;&t;    * We can&squot;t free the group of commands until all of the&n;&t;    * request sense and scatter gather dma structures are free.&n;            * Remember the beginning of the group, but don&squot;t free it&n;&t;    * until we&squot;ve reached the beginning of the next group.&n;&t;    */
r_if
c_cond
(paren
id|CommandGroup
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|CommandGroup
)paren
suffix:semicolon
id|CommandGroup
op_assign
id|Command
suffix:semicolon
)brace
id|Controller-&gt;Commands
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandGroup
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|CommandGroup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBuffer
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;CombinedStatusBuffer
)paren
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ScatterGatherPool
op_ne
l_int|NULL
)paren
id|pci_pool_destroy
c_func
(paren
id|ScatterGatherPool
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|RequestSensePool
op_ne
l_int|NULL
)paren
id|pci_pool_destroy
c_func
(paren
id|RequestSensePool
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_V2_MaxPhysicalDevices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
)paren
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;  DAC960_V1_ClearCommand clears critical fields of Command for DAC960 V1&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ClearCommand
r_static
r_inline
r_void
id|DAC960_V1_ClearCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ClearCommand clears critical fields of Command for DAC960 V2&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ClearCommand
r_static
r_inline
r_void
id|DAC960_V2_ClearCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memset
c_func
(paren
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_AllocateCommand allocates a Command structure from Controller&squot;s&n;  free list.  During driver initialization, a special initialization command&n;  has been placed on the free list to guarantee that command allocation can&n;  never fail.&n;*/
DECL|function|DAC960_AllocateCommand
r_static
r_inline
id|DAC960_Command_T
op_star
id|DAC960_AllocateCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command-&gt;Next
suffix:semicolon
id|Command-&gt;Next
op_assign
l_int|NULL
suffix:semicolon
r_return
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DeallocateCommand deallocates Command, returning it to Controller&squot;s&n;  free list.&n;*/
DECL|function|DAC960_DeallocateCommand
r_static
r_inline
r_void
id|DAC960_DeallocateCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|Command-&gt;Request
op_assign
l_int|NULL
suffix:semicolon
id|Command-&gt;Next
op_assign
id|Controller-&gt;FreeCommands
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
id|Command
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_WaitForCommand waits for a wake_up on Controller&squot;s Command Wait Queue.&n;*/
DECL|function|DAC960_WaitForCommand
r_static
r_void
id|DAC960_WaitForCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
)paren
suffix:semicolon
id|__wait_event
c_func
(paren
id|Controller-&gt;CommandWaitQueue
comma
id|Controller-&gt;FreeCommands
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_BA_QueueCommand queues Command for DAC960 BA Series Controllers.&n;*/
DECL|function|DAC960_BA_QueueCommand
r_static
r_void
id|DAC960_BA_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_BA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V2.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V2.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_BA_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V2.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LP_QueueCommand queues Command for DAC960 LP Series Controllers.&n;*/
DECL|function|DAC960_LP_QueueCommand
r_static
r_void
id|DAC960_LP_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LP_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V2.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V2.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LP_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V2.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_QueueCommandDualMode queues Command for DAC960 LA Series&n;  Controllers with Dual Mode Firmware.&n;*/
DECL|function|DAC960_LA_QueueCommandDualMode
r_static
r_void
id|DAC960_LA_QueueCommandDualMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LA_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_QueueCommandSingleMode queues Command for DAC960 LA Series&n;  Controllers with Single Mode Firmware.&n;*/
DECL|function|DAC960_LA_QueueCommandSingleMode
r_static
r_void
id|DAC960_LA_QueueCommandSingleMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_LA_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_LA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_QueueCommandDualMode queues Command for DAC960 PG Series&n;  Controllers with Dual Mode Firmware.&n;*/
DECL|function|DAC960_PG_QueueCommandDualMode
r_static
r_void
id|DAC960_PG_QueueCommandDualMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_PG_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_PG_MemoryMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_QueueCommandSingleMode queues Command for DAC960 PG Series&n;  Controllers with Single Mode Firmware.&n;*/
DECL|function|DAC960_PG_QueueCommandSingleMode
r_static
r_void
id|DAC960_PG_QueueCommandSingleMode
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.NextCommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
id|DAC960_PG_WriteCommandMailbox
c_func
(paren
id|NextCommandMailbox
comma
id|CommandMailbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.PreviousCommandMailbox1-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Controller-&gt;V1.PreviousCommandMailbox2-&gt;Words
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
id|DAC960_PG_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.PreviousCommandMailbox1
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|NextCommandMailbox
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextCommandMailbox
OG
id|Controller-&gt;V1.LastCommandMailbox
)paren
id|NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|NextCommandMailbox
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PD_QueueCommand queues Command for DAC960 PD Series Controllers.&n;*/
DECL|function|DAC960_PD_QueueCommand
r_static
r_void
id|DAC960_PD_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_MailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_PD_WriteCommandMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_PD_NewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_P_QueueCommand queues Command for DAC960 P Series Controllers.&n;*/
DECL|function|DAC960_P_QueueCommand
r_static
r_void
id|DAC960_P_QueueCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandIdentifier
op_assign
id|Command-&gt;CommandIdentifier
suffix:semicolon
r_switch
c_cond
(paren
id|CommandMailbox-&gt;Common.CommandOpcode
)paren
(brace
r_case
id|DAC960_V1_Enquiry
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_Enquiry_Old
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_GetDeviceState
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_GetDeviceState_Old
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Read
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_Read_Old
suffix:semicolon
id|DAC960_PD_To_P_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Write
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_Write_Old
suffix:semicolon
id|DAC960_PD_To_P_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_ReadWithScatterGather
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_ReadWithScatterGather_Old
suffix:semicolon
id|DAC960_PD_To_P_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_WriteWithScatterGather
suffix:colon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V1_WriteWithScatterGather_Old
suffix:semicolon
id|DAC960_PD_To_P_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|DAC960_PD_MailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_PD_WriteCommandMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_PD_NewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ExecuteCommand executes Command and waits for completion.&n;*/
DECL|function|DAC960_ExecuteCommand
r_static
r_void
id|DAC960_ExecuteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DECLARE_COMPLETION
c_func
(paren
id|Completion
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|Command-&gt;Completion
op_assign
op_amp
id|Completion
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
r_return
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|Completion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteType3 executes a DAC960 V1 Firmware Controller Type 3&n;  Command and waits for completion.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V1_ExecuteType3
r_static
id|boolean
id|DAC960_V1_ExecuteType3
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
comma
id|dma_addr_t
id|DataDMA
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|DataDMA
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteTypeB executes a DAC960 V1 Firmware Controller Type 3B&n;  Command and waits for completion.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V1_ExecuteType3B
r_static
id|boolean
id|DAC960_V1_ExecuteType3B
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
comma
r_int
r_char
id|CommandOpcode2
comma
id|dma_addr_t
id|DataDMA
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3B.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3B.CommandOpcode2
op_assign
id|CommandOpcode2
suffix:semicolon
id|CommandMailbox-&gt;Type3B.BusAddress
op_assign
id|DataDMA
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteType3D executes a DAC960 V1 Firmware Controller Type 3D&n;  Command and waits for completion.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V1_ExecuteType3D
r_static
id|boolean
id|DAC960_V1_ExecuteType3D
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
id|dma_addr_t
id|DataDMA
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|CommandOpcode
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.BusAddress
op_assign
id|DataDMA
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_GeneralInfo executes a DAC960 V2 Firmware General Information&n;  Reading IOCTL Command and waits for completion.  It returns true on success&n;  and false on failure.&n;&n;  Return data in The controller&squot;s HealthStatusBuffer, which is dma-able memory&n;*/
DECL|function|DAC960_V2_GeneralInfo
r_static
id|boolean
id|DAC960_V2_GeneralInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.IOCTL_Opcode
op_assign
id|DAC960_V2_GetHealthStatus
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.HealthStatusBufferDMA
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ControllerInfo executes a DAC960 V2 Firmware Controller&n;  Information Reading IOCTL Command and waits for completion.  It returns&n;  true on success and false on failure.&n;&n;  Data is returned in the controller&squot;s V2.NewControllerInformation dma-able&n;  memory buffer.&n;*/
DECL|function|DAC960_V2_NewControllerInfo
r_static
id|boolean
id|DAC960_V2_NewControllerInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetControllerInfo
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewControllerInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_LogicalDeviceInfo executes a DAC960 V2 Firmware Controller Logical&n;  Device Information Reading IOCTL Command and waits for completion.  It&n;  returns true on success and false on failure.&n;&n;  Data is returned in the controller&squot;s V2.NewLogicalDeviceInformation&n;*/
DECL|function|DAC960_V2_NewLogicalDeviceInfo
r_static
id|boolean
id|DAC960_V2_NewLogicalDeviceInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_int
id|LogicalDeviceNumber
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetLogicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_PhysicalDeviceInfo executes a DAC960 V2 Firmware Controller &quot;Read&n;  Physical Device Information&quot; IOCTL Command and waits for completion.  It&n;  returns true on success and false on failure.&n;&n;  The Channel, TargetID, LogicalUnit arguments should be 0 the first time&n;  this function is called for a given controller.  This will return data&n;  for the &quot;first&quot; device on that controller.  The returned data includes a&n;  Channel, TargetID, LogicalUnit that can be passed in to this routine to&n;  get data for the NEXT device on that controller.&n;&n;  Data is stored in the controller&squot;s V2.NewPhysicalDeviceInfo dma-able&n;  memory buffer.&n;&n;*/
DECL|function|DAC960_V2_NewPhysicalDeviceInfo
r_static
id|boolean
id|DAC960_V2_NewPhysicalDeviceInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_int
r_char
id|LogicalUnit
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.LogicalUnit
op_assign
id|LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetPhysicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
DECL|function|DAC960_V2_ConstructNewUnitSerialNumber
r_static
r_void
id|DAC960_V2_ConstructNewUnitSerialNumber
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
comma
r_int
id|Channel
comma
r_int
id|TargetID
comma
r_int
id|LogicalUnit
)paren
(brace
id|CommandMailbox-&gt;SCSI_10.CommandOpcode
op_assign
id|DAC960_V2_SCSI_10_Passthru
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.LogicalUnit
op_assign
id|LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CDBLength
op_assign
l_int|6
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewInquiryUnitSerialNumberDMA
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_NewUnitSerialNumber executes an SCSI pass-through&n;  Inquiry command to a SCSI device identified by Channel number,&n;  Target id, Logical Unit Number.  This function Waits for completion&n;  of the command.&n;&n;  The return data includes Unit Serial Number information for the&n;  specified device.&n;&n;  Data is stored in the controller&squot;s V2.NewPhysicalDeviceInfo dma-able&n;  memory buffer.&n;*/
DECL|function|DAC960_V2_NewInquiryUnitSerialNumber
r_static
id|boolean
id|DAC960_V2_NewInquiryUnitSerialNumber
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
id|Channel
comma
r_int
id|TargetID
comma
r_int
id|LogicalUnit
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|DAC960_V2_ConstructNewUnitSerialNumber
c_func
(paren
id|Controller
comma
id|CommandMailbox
comma
id|Channel
comma
id|TargetID
comma
id|LogicalUnit
)paren
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_DeviceOperation executes a DAC960 V2 Firmware Controller Device&n;  Operation IOCTL Command and waits for completion.  It returns true on&n;  success and false on failure.&n;*/
DECL|function|DAC960_V2_DeviceOperation
r_static
id|boolean
id|DAC960_V2_DeviceOperation
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_IOCTL_Opcode_T
id|IOCTL_Opcode
comma
id|DAC960_V2_OperationDevice_T
id|OperationDevice
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.IOCTL_Opcode
op_assign
id|IOCTL_Opcode
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.OperationDevice
op_assign
id|OperationDevice
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_EnableMemoryMailboxInterface enables the Memory Mailbox Interface&n;  for DAC960 V1 Firmware Controllers.&n;&n;  PD and P controller types have no memory mailbox, but still need the&n;  other dma mapped memory.&n;*/
DECL|function|DAC960_V1_EnableMemoryMailboxInterface
r_static
id|boolean
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_HardwareType_T
id|hw_type
op_assign
id|Controller-&gt;HardwareType
suffix:semicolon
r_struct
id|pci_dev
op_star
id|PCI_Device
op_assign
id|Controller-&gt;PCIDevice
suffix:semicolon
r_struct
id|dma_loaf
op_star
id|DmaPages
op_assign
op_amp
id|Controller-&gt;DmaPages
suffix:semicolon
r_int
id|DmaPagesSize
suffix:semicolon
r_int
id|CommandMailboxesSize
suffix:semicolon
r_int
id|StatusMailboxesSize
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailboxesMemory
suffix:semicolon
id|dma_addr_t
id|CommandMailboxesMemoryDMA
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|StatusMailboxesMemory
suffix:semicolon
id|dma_addr_t
id|StatusMailboxesMemoryDMA
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
id|CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
r_int
id|TimeoutCounter
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|DAC690_V1_PciDmaMask
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;DMA mask out of range&quot;
)paren
suffix:semicolon
id|Controller-&gt;BounceBufferLimit
op_assign
id|DAC690_V1_PciDmaMask
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hw_type
op_eq
id|DAC960_PD_Controller
)paren
op_logical_or
(paren
id|hw_type
op_eq
id|DAC960_P_Controller
)paren
)paren
(brace
id|CommandMailboxesSize
op_assign
l_int|0
suffix:semicolon
id|StatusMailboxesSize
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|CommandMailboxesSize
op_assign
id|DAC960_V1_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
suffix:semicolon
id|StatusMailboxesSize
op_assign
id|DAC960_V1_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V1_StatusMailbox_T
)paren
suffix:semicolon
)brace
id|DmaPagesSize
op_assign
id|CommandMailboxesSize
op_plus
id|StatusMailboxesSize
op_plus
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_ErrorTable_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_EventLogEntry_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_RebuildProgress_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_LogicalDriveInformationArray_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_BackgroundInitializationStatus_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_DeviceState_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_dma_loaf
c_func
(paren
id|PCI_Device
comma
id|DmaPages
comma
id|DmaPagesSize
)paren
)paren
r_return
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hw_type
op_eq
id|DAC960_PD_Controller
)paren
op_logical_or
(paren
id|hw_type
op_eq
id|DAC960_P_Controller
)paren
)paren
r_goto
id|skip_mailboxes
suffix:semicolon
id|CommandMailboxesMemory
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
id|CommandMailboxesSize
comma
op_amp
id|CommandMailboxesMemoryDMA
)paren
suffix:semicolon
multiline_comment|/* These are the base addresses for the command memory mailbox array */
id|Controller-&gt;V1.FirstCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.FirstCommandMailboxDMA
op_assign
id|CommandMailboxesMemoryDMA
suffix:semicolon
id|CommandMailboxesMemory
op_add_assign
id|DAC960_V1_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.LastCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.NextCommandMailbox
op_assign
id|Controller-&gt;V1.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox1
op_assign
id|Controller-&gt;V1.LastCommandMailbox
suffix:semicolon
id|Controller-&gt;V1.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V1.LastCommandMailbox
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* These are the base addresses for the status memory mailbox array */
id|StatusMailboxesMemory
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
id|StatusMailboxesSize
comma
op_amp
id|StatusMailboxesMemoryDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.FirstStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.FirstStatusMailboxDMA
op_assign
id|StatusMailboxesMemoryDMA
suffix:semicolon
id|StatusMailboxesMemory
op_add_assign
id|DAC960_V1_StatusMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V1.LastStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V1.NextStatusMailbox
op_assign
id|Controller-&gt;V1.FirstStatusMailbox
suffix:semicolon
id|skip_mailboxes
suffix:colon
id|Controller-&gt;V1.MonitoringDCDB
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
comma
op_amp
id|Controller-&gt;V1.MonitoringDCDB_DMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewEnquiry
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewEnquiryDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewErrorTable
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_ErrorTable_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewErrorTableDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.EventLogEntry
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_EventLogEntry_T
)paren
comma
op_amp
id|Controller-&gt;V1.EventLogEntryDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.RebuildProgress
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_RebuildProgress_T
)paren
comma
op_amp
id|Controller-&gt;V1.RebuildProgressDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewLogicalDriveInformation
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_LogicalDriveInformationArray_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewLogicalDriveInformationDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.BackgroundInitializationStatus
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_BackgroundInitializationStatus_T
)paren
comma
op_amp
id|Controller-&gt;V1.BackgroundInitializationStatusDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewDeviceState
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V1_DeviceState_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewDeviceStateDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewInquiryStandardData
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewInquiryStandardDataDMA
)paren
suffix:semicolon
id|Controller-&gt;V1.NewInquiryUnitSerialNumber
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
op_amp
id|Controller-&gt;V1.NewInquiryUnitSerialNumberDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hw_type
op_eq
id|DAC960_PD_Controller
)paren
op_logical_or
(paren
id|hw_type
op_eq
id|DAC960_P_Controller
)paren
)paren
r_return
l_bool|true
suffix:semicolon
multiline_comment|/* Enable the Memory Mailbox Interface. */
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode
op_assign
l_int|0x2B
suffix:semicolon
id|CommandMailbox.TypeX.CommandIdentifier
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x14
suffix:semicolon
id|CommandMailbox.TypeX.CommandMailboxesBusAddress
op_assign
id|Controller-&gt;V1.FirstCommandMailboxDMA
suffix:semicolon
id|CommandMailbox.TypeX.StatusMailboxesBusAddress
op_assign
id|Controller-&gt;V1.FirstStatusMailboxDMA
suffix:semicolon
DECL|macro|TIMEOUT_COUNT
mdefine_line|#define TIMEOUT_COUNT 1000000
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_LA_Controller
suffix:colon
id|TimeoutCounter
op_assign
id|TIMEOUT_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_LA_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_LA_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_LA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|TimeoutCounter
op_assign
id|TIMEOUT_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LA_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_LA_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|TimeoutCounter
op_assign
id|TIMEOUT_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_PG_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_PG_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
op_amp
id|CommandMailbox
)paren
suffix:semicolon
id|DAC960_PG_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|TimeoutCounter
op_assign
id|TIMEOUT_COUNT
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|TimeoutCounter
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PG_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|TimeoutCounter
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_PG_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
r_return
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox.TypeX.CommandOpcode2
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;Unknown Controller Type&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_EnableMemoryMailboxInterface enables the Memory Mailbox Interface&n;  for DAC960 V2 Firmware Controllers.&n;&n;  Aggregate the space needed for the controller&squot;s memory mailbox and&n;  the other data structures that will be targets of dma transfers with&n;  the controller.  Allocate a dma-mapped region of memory to hold these&n;  structures.  Then, save CPU pointers and dma_addr_t values to reference&n;  the structures that are contained in that region.&n;*/
DECL|function|DAC960_V2_EnableMemoryMailboxInterface
r_static
id|boolean
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
r_struct
id|pci_dev
op_star
id|PCI_Device
op_assign
id|Controller-&gt;PCIDevice
suffix:semicolon
r_struct
id|dma_loaf
op_star
id|DmaPages
op_assign
op_amp
id|Controller-&gt;DmaPages
suffix:semicolon
r_int
id|DmaPagesSize
suffix:semicolon
r_int
id|CommandMailboxesSize
suffix:semicolon
r_int
id|StatusMailboxesSize
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailboxesMemory
suffix:semicolon
id|dma_addr_t
id|CommandMailboxesMemoryDMA
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|StatusMailboxesMemory
suffix:semicolon
id|dma_addr_t
id|StatusMailboxesMemoryDMA
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|dma_addr_t
id|CommandMailboxDMA
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|DAC690_V2_PciDmaMask
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;DMA mask out of range&quot;
)paren
suffix:semicolon
id|Controller-&gt;BounceBufferLimit
op_assign
id|DAC690_V2_PciDmaMask
suffix:semicolon
multiline_comment|/* This is a temporary dma mapping, used only in the scope of this function */
id|CommandMailbox
op_assign
(paren
id|DAC960_V2_CommandMailbox_T
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|PCI_Device
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
comma
op_amp
id|CommandMailboxDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandMailbox
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|CommandMailboxesSize
op_assign
id|DAC960_V2_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
suffix:semicolon
id|StatusMailboxesSize
op_assign
id|DAC960_V2_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_StatusMailbox_T
)paren
suffix:semicolon
id|DmaPagesSize
op_assign
id|CommandMailboxesSize
op_plus
id|StatusMailboxesSize
op_plus
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_Event_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V2_PhysicalToLogicalDevice_T
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_dma_loaf
c_func
(paren
id|PCI_Device
comma
id|DmaPages
comma
id|DmaPagesSize
)paren
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|PCI_Device
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
comma
id|CommandMailbox
comma
id|CommandMailboxDMA
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
id|CommandMailboxesMemory
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
id|CommandMailboxesSize
comma
op_amp
id|CommandMailboxesMemoryDMA
)paren
suffix:semicolon
multiline_comment|/* These are the base addresses for the command memory mailbox array */
id|Controller-&gt;V2.FirstCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.FirstCommandMailboxDMA
op_assign
id|CommandMailboxesMemoryDMA
suffix:semicolon
id|CommandMailboxesMemory
op_add_assign
id|DAC960_V2_CommandMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V2.LastCommandMailbox
op_assign
id|CommandMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.NextCommandMailbox
op_assign
id|Controller-&gt;V2.FirstCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox1
op_assign
id|Controller-&gt;V2.LastCommandMailbox
suffix:semicolon
id|Controller-&gt;V2.PreviousCommandMailbox2
op_assign
id|Controller-&gt;V2.LastCommandMailbox
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* These are the base addresses for the status memory mailbox array */
id|StatusMailboxesMemory
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
id|StatusMailboxesSize
comma
op_amp
id|StatusMailboxesMemoryDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.FirstStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.FirstStatusMailboxDMA
op_assign
id|StatusMailboxesMemoryDMA
suffix:semicolon
id|StatusMailboxesMemory
op_add_assign
id|DAC960_V2_StatusMailboxCount
op_minus
l_int|1
suffix:semicolon
id|Controller-&gt;V2.LastStatusMailbox
op_assign
id|StatusMailboxesMemory
suffix:semicolon
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|Controller-&gt;V2.HealthStatusBuffer
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
comma
op_amp
id|Controller-&gt;V2.HealthStatusBufferDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.NewControllerInformation
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
comma
op_amp
id|Controller-&gt;V2.NewControllerInformationDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.NewLogicalDeviceInformation
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
comma
op_amp
id|Controller-&gt;V2.NewLogicalDeviceInformationDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
comma
op_amp
id|Controller-&gt;V2.NewPhysicalDeviceInformationDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.NewInquiryUnitSerialNumber
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
op_amp
id|Controller-&gt;V2.NewInquiryUnitSerialNumberDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.Event
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_Event_T
)paren
comma
op_amp
id|Controller-&gt;V2.EventDMA
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalToLogicalDevice
op_assign
id|slice_dma_loaf
c_func
(paren
id|DmaPages
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalToLogicalDevice_T
)paren
comma
op_amp
id|Controller-&gt;V2.PhysicalToLogicalDeviceDMA
)paren
suffix:semicolon
multiline_comment|/*&n;    Enable the Memory Mailbox Interface.&n;    &n;    I don&squot;t know why we can&squot;t just use one of the memory mailboxes&n;    we just allocated to do this, instead of using this temporary one.&n;    Try this change later.&n;  */
id|memset
c_func
(paren
id|CommandMailbox
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.CommandControlBits.NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.FirstCommandMailboxSizeKB
op_assign
(paren
id|DAC960_V2_CommandMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
op_rshift
l_int|10
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.FirstStatusMailboxSizeKB
op_assign
(paren
id|DAC960_V2_StatusMailboxCount
op_star
r_sizeof
(paren
id|DAC960_V2_StatusMailbox_T
)paren
)paren
op_rshift
l_int|10
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.SecondCommandMailboxSizeKB
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.SecondStatusMailboxSizeKB
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.RequestSenseSize
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.IOCTL_Opcode
op_assign
id|DAC960_V2_SetMemoryMailbox
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.HealthStatusBufferSizeKB
op_assign
l_int|1
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.HealthStatusBufferBusAddress
op_assign
id|Controller-&gt;V2.HealthStatusBufferDMA
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.FirstCommandMailboxBusAddress
op_assign
id|Controller-&gt;V2.FirstCommandMailboxDMA
suffix:semicolon
id|CommandMailbox-&gt;SetMemoryMailbox.FirstStatusMailboxBusAddress
op_assign
id|Controller-&gt;V2.FirstStatusMailboxDMA
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_BA_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_BA_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailboxDMA
)paren
suffix:semicolon
id|DAC960_BA_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|DAC960_BA_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_BA_ReadCommandStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
r_while
c_loop
(paren
id|DAC960_LP_HardwareMailboxFullP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DAC960_LP_WriteHardwareMailbox
c_func
(paren
id|ControllerBaseAddress
comma
id|CommandMailboxDMA
)paren
suffix:semicolon
id|DAC960_LP_HardwareMailboxNewCommand
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|DAC960_LP_HardwareMailboxStatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_LP_ReadCommandStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;Unknown Controller Type&bslash;n&quot;
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|DAC960_V2_AbormalCompletion
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pci_free_consistent
c_func
(paren
id|PCI_Device
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
comma
id|CommandMailbox
comma
id|CommandMailboxDMA
)paren
suffix:semicolon
r_return
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadControllerConfiguration reads the Configuration Information&n;  from DAC960 V1 Firmware Controllers and initializes the Controller structure.&n;*/
DECL|function|DAC960_V1_ReadControllerConfiguration
r_static
id|boolean
id|DAC960_V1_ReadControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_V1_Enquiry2_T
op_star
id|Enquiry2
suffix:semicolon
id|dma_addr_t
id|Enquiry2DMA
suffix:semicolon
id|DAC960_V1_Config2_T
op_star
id|Config2
suffix:semicolon
id|dma_addr_t
id|Config2DMA
suffix:semicolon
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
r_struct
id|dma_loaf
id|local_dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry2_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_V1_Config2_T
)paren
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;LOGICAL DEVICE ALLOCATION&quot;
)paren
suffix:semicolon
id|Enquiry2
op_assign
id|slice_dma_loaf
c_func
(paren
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry2_T
)paren
comma
op_amp
id|Enquiry2DMA
)paren
suffix:semicolon
id|Config2
op_assign
id|slice_dma_loaf
c_func
(paren
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_V1_Config2_T
)paren
comma
op_amp
id|Config2DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Enquiry
comma
id|Controller-&gt;V1.NewEnquiryDMA
)paren
)paren
(brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY&quot;
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.Enquiry
comma
id|Controller-&gt;V1.NewEnquiry
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Enquiry2
comma
id|Enquiry2DMA
)paren
)paren
(brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;ENQUIRY2&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_ReadConfig2
comma
id|Config2DMA
)paren
)paren
(brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;READ CONFIG2&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_GetLogicalDriveInformation
comma
id|Controller-&gt;V1.NewLogicalDriveInformationDMA
)paren
)paren
(brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET LOGICAL DRIVE INFORMATION&quot;
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
comma
id|Controller-&gt;V1.NewLogicalDriveInformation
comma
r_sizeof
(paren
id|DAC960_V1_LogicalDriveInformationArray_T
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Enquiry2-&gt;ActualChannels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Enquiry2-&gt;MaxTargets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_ExecuteType3D
c_func
(paren
id|Controller
comma
id|DAC960_V1_GetDeviceState
comma
id|Channel
comma
id|TargetID
comma
id|Controller-&gt;V1.NewDeviceStateDMA
)paren
)paren
(brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET DEVICE STATE&quot;
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
comma
id|Controller-&gt;V1.NewDeviceState
comma
r_sizeof
(paren
id|DAC960_V1_DeviceState_T
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Model Name and Full Model Name fields.&n;  */
r_switch
c_cond
(paren
id|Enquiry2-&gt;HardwareID.SubModel
)paren
(brace
r_case
id|DAC960_V1_P_PD_PU
suffix:colon
r_if
c_cond
(paren
id|Enquiry2-&gt;SCSICapability.BusSpeed
op_eq
id|DAC960_V1_Ultra
)paren
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PU&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PD&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PG
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PG&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PJ
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PJ&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PR
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PR&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PT
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PT&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PTL0
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL0&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PRL
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PRL&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_PTL1
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC960PTL1&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_1164P
suffix:colon
id|strcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
l_string|&quot;DAC1164P&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;MODEL VERIFICATION&quot;
)paren
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;Mylex &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|Controller-&gt;FullModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Firmware Version field and verify that it&n;    is a supported firmware version.  The supported firmware versions are:&n;&n;    DAC1164P&t;&t;    5.06 and above&n;    DAC960PTL/PRL/PJ/PG&t;    4.06 and above&n;    DAC960PU/PD/PL&t;    3.51 and above&n;    DAC960PU/PD/PL/P&t;    2.73 and above&n;  */
r_if
c_cond
(paren
id|Enquiry2-&gt;FirmwareID.MajorVersion
op_eq
l_int|0
)paren
(brace
id|Enquiry2-&gt;FirmwareID.MajorVersion
op_assign
id|Controller-&gt;V1.Enquiry.MajorFirmwareVersion
suffix:semicolon
id|Enquiry2-&gt;FirmwareID.MinorVersion
op_assign
id|Controller-&gt;V1.Enquiry.MinorFirmwareVersion
suffix:semicolon
id|Enquiry2-&gt;FirmwareID.FirmwareType
op_assign
l_char|&squot;0&squot;
suffix:semicolon
id|Enquiry2-&gt;FirmwareID.TurnID
op_assign
l_int|0
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;%d.%02d-%c-%02d&quot;
comma
id|Enquiry2-&gt;FirmwareID.MajorVersion
comma
id|Enquiry2-&gt;FirmwareID.MinorVersion
comma
id|Enquiry2-&gt;FirmwareID.FirmwareType
comma
id|Enquiry2-&gt;FirmwareID.TurnID
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;5&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;5.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;4&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;4.06&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;3&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;3.51&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;2&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;2.73&quot;
)paren
op_ge
l_int|0
)paren
)paren
)paren
(brace
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;FIRMWARE VERSION VERIFICATION&quot;
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;Firmware Version = &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Channels, Targets, Memory Size, and SAF-TE&n;    Enclosure Management Enabled fields.&n;  */
id|Controller-&gt;Channels
op_assign
id|Enquiry2-&gt;ActualChannels
suffix:semicolon
id|Controller-&gt;Targets
op_assign
id|Enquiry2-&gt;MaxTargets
suffix:semicolon
id|Controller-&gt;MemorySize
op_assign
id|Enquiry2-&gt;MemorySize
op_rshift
l_int|20
suffix:semicolon
id|Controller-&gt;V1.SAFTE_EnclosureManagementEnabled
op_assign
(paren
id|Enquiry2-&gt;FaultManagementType
op_eq
id|DAC960_V1_SAFTE
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Queue Depth, Driver Queue Depth, Logical Drive&n;    Count, Maximum Blocks per Command, Controller Scatter/Gather Limit, and&n;    Driver Scatter/Gather Limit.  The Driver Queue Depth must be at most one&n;    less than the Controller Queue Depth to allow for an automatic drive&n;    rebuild operation.&n;  */
id|Controller-&gt;ControllerQueueDepth
op_assign
id|Controller-&gt;V1.Enquiry.MaxCommands
suffix:semicolon
id|Controller-&gt;DriverQueueDepth
op_assign
id|Controller-&gt;ControllerQueueDepth
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverQueueDepth
OG
id|DAC960_MaxDriverQueueDepth
)paren
id|Controller-&gt;DriverQueueDepth
op_assign
id|DAC960_MaxDriverQueueDepth
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|Controller-&gt;V1.Enquiry.NumberOfLogicalDrives
suffix:semicolon
id|Controller-&gt;MaxBlocksPerCommand
op_assign
id|Enquiry2-&gt;MaxBlocksPerCommand
suffix:semicolon
id|Controller-&gt;ControllerScatterGatherLimit
op_assign
id|Enquiry2-&gt;MaxScatterGatherEntries
suffix:semicolon
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|Controller-&gt;ControllerScatterGatherLimit
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverScatterGatherLimit
OG
id|DAC960_V1_ScatterGatherLimit
)paren
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|DAC960_V1_ScatterGatherLimit
suffix:semicolon
multiline_comment|/*&n;    Initialize the Stripe Size, Segment Size, and Geometry Translation.&n;  */
id|Controller-&gt;V1.StripeSize
op_assign
id|Config2-&gt;BlocksPerStripe
op_star
id|Config2-&gt;BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
id|Controller-&gt;V1.SegmentSize
op_assign
id|Config2-&gt;BlocksPerCacheLine
op_star
id|Config2-&gt;BlockFactor
op_rshift
(paren
l_int|10
op_minus
id|DAC960_BlockSizeBits
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Config2-&gt;DriveGeometry
)paren
(brace
r_case
id|DAC960_V1_Geometry_128_32
suffix:colon
id|Controller-&gt;V1.GeometryTranslationHeads
op_assign
l_int|128
suffix:semicolon
id|Controller-&gt;V1.GeometryTranslationSectors
op_assign
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Geometry_255_63
suffix:colon
id|Controller-&gt;V1.GeometryTranslationHeads
op_assign
l_int|255
suffix:semicolon
id|Controller-&gt;V1.GeometryTranslationSectors
op_assign
l_int|63
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;CONFIG2 DRIVE GEOMETRY&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Background Initialization Status.&n;  */
r_if
c_cond
(paren
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;4&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;4.08&quot;
)paren
op_ge
l_int|0
)paren
op_logical_or
(paren
id|Controller-&gt;FirmwareVersion
(braket
l_int|0
)braket
op_eq
l_char|&squot;5&squot;
op_logical_and
id|strcmp
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;5.08&quot;
)paren
op_ge
l_int|0
)paren
)paren
(brace
id|Controller-&gt;V1.BackgroundInitializationStatusSupported
op_assign
l_bool|true
suffix:semicolon
id|DAC960_V1_ExecuteType3B
c_func
(paren
id|Controller
comma
id|DAC960_V1_BackgroundInitializationControl
comma
l_int|0x20
comma
id|Controller
op_member_access_from_pointer
id|V1.BackgroundInitializationStatusDMA
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.LastBackgroundInitializationStatus
comma
id|Controller-&gt;V1.BackgroundInitializationStatus
comma
r_sizeof
(paren
id|DAC960_V1_BackgroundInitializationStatus_T
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Logical Drive Initially Accessible flag.&n;  */
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
r_if
c_cond
(paren
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
dot
id|LogicalDriveState
op_ne
id|DAC960_V1_LogicalDrive_Offline
)paren
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDriveNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.LastRebuildStatus
op_assign
id|DAC960_V1_NoRebuildOrCheckInProgress
suffix:semicolon
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadControllerConfiguration reads the Configuration Information&n;  from DAC960 V2 Firmware Controllers and initializes the Controller structure.&n;*/
DECL|function|DAC960_V2_ReadControllerConfiguration
r_static
id|boolean
id|DAC960_V2_ReadControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
op_assign
l_int|0
suffix:semicolon
r_int
id|ModelNameLength
suffix:semicolon
multiline_comment|/* Get data into dma-able area, then copy into permanant location */
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_NewControllerInfo
c_func
(paren
id|Controller
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET CONTROLLER INFO&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ControllerInfo
comma
id|Controller-&gt;V2.NewControllerInformation
comma
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_GeneralInfo
c_func
(paren
id|Controller
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;GET HEALTH STATUS&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Model Name and Full Model Name fields.&n;  */
id|ModelNameLength
op_assign
r_sizeof
(paren
id|ControllerInfo-&gt;ControllerName
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ModelNameLength
OG
r_sizeof
(paren
id|Controller-&gt;ModelName
)paren
op_minus
l_int|1
)paren
id|ModelNameLength
op_assign
r_sizeof
(paren
id|Controller-&gt;ModelName
)paren
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|Controller-&gt;ModelName
comma
id|ControllerInfo-&gt;ControllerName
comma
id|ModelNameLength
)paren
suffix:semicolon
id|ModelNameLength
op_decrement
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;ModelName
(braket
id|ModelNameLength
)braket
op_eq
l_char|&squot; &squot;
op_logical_or
id|Controller-&gt;ModelName
(braket
id|ModelNameLength
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
id|ModelNameLength
op_decrement
suffix:semicolon
id|Controller-&gt;ModelName
(braket
op_increment
id|ModelNameLength
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;Mylex &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|Controller-&gt;FullModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Firmware Version field.&n;  */
id|sprintf
c_func
(paren
id|Controller-&gt;FirmwareVersion
comma
l_string|&quot;%d.%02d-%02d&quot;
comma
id|ControllerInfo-&gt;FirmwareMajorVersion
comma
id|ControllerInfo-&gt;FirmwareMinorVersion
comma
id|ControllerInfo-&gt;FirmwareTurnNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ControllerInfo-&gt;FirmwareMajorVersion
op_eq
l_int|6
op_logical_and
id|ControllerInfo-&gt;FirmwareMinorVersion
op_eq
l_int|0
op_logical_and
id|ControllerInfo-&gt;FirmwareTurnNumber
OL
l_int|1
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;FIRMWARE VERSION %s DOES NOT PROVIDE THE CONTROLLER&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;STATUS MONITORING FUNCTIONALITY NEEDED BY THIS DRIVER.&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;PLEASE UPGRADE TO VERSION 6.00-01 OR ABOVE.&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Initialize the Controller Channels, Targets, and Memory Size.&n;  */
id|Controller-&gt;Channels
op_assign
id|ControllerInfo-&gt;NumberOfPhysicalChannelsPresent
suffix:semicolon
id|Controller-&gt;Targets
op_assign
id|ControllerInfo-&gt;MaximumTargetsPerChannel
(braket
id|ControllerInfo-&gt;NumberOfPhysicalChannelsPresent
op_minus
l_int|1
)braket
suffix:semicolon
id|Controller-&gt;MemorySize
op_assign
id|ControllerInfo-&gt;MemorySizeMB
suffix:semicolon
multiline_comment|/*&n;    Initialize the Controller Queue Depth, Driver Queue Depth, Logical Drive&n;    Count, Maximum Blocks per Command, Controller Scatter/Gather Limit, and&n;    Driver Scatter/Gather Limit.  The Driver Queue Depth must be at most one&n;    less than the Controller Queue Depth to allow for an automatic drive&n;    rebuild operation.&n;  */
id|Controller-&gt;ControllerQueueDepth
op_assign
id|ControllerInfo-&gt;MaximumParallelCommands
suffix:semicolon
id|Controller-&gt;DriverQueueDepth
op_assign
id|Controller-&gt;ControllerQueueDepth
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverQueueDepth
OG
id|DAC960_MaxDriverQueueDepth
)paren
id|Controller-&gt;DriverQueueDepth
op_assign
id|DAC960_MaxDriverQueueDepth
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|ControllerInfo-&gt;LogicalDevicesPresent
suffix:semicolon
id|Controller-&gt;MaxBlocksPerCommand
op_assign
id|ControllerInfo-&gt;MaximumDataTransferSizeInBlocks
suffix:semicolon
id|Controller-&gt;ControllerScatterGatherLimit
op_assign
id|ControllerInfo-&gt;MaximumScatterGatherEntries
suffix:semicolon
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|Controller-&gt;ControllerScatterGatherLimit
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;DriverScatterGatherLimit
OG
id|DAC960_V2_ScatterGatherLimit
)paren
id|Controller-&gt;DriverScatterGatherLimit
op_assign
id|DAC960_V2_ScatterGatherLimit
suffix:semicolon
multiline_comment|/*&n;    Initialize the Logical Device Information.&n;  */
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|NewLogicalDeviceInfo
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformation
suffix:semicolon
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
suffix:semicolon
id|DAC960_V2_PhysicalDevice_T
id|PhysicalDevice
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_NewLogicalDeviceInfo
c_func
(paren
id|Controller
comma
id|LogicalDeviceNumber
)paren
)paren
r_break
suffix:semicolon
id|LogicalDeviceNumber
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceNumber
op_ge
id|DAC960_MaxLogicalDrives
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;DAC960: Logical Drive Number %d not supported&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;DeviceBlockSizeInBytes
op_ne
id|DAC960_BlockSize
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;DAC960: Logical Drive Block Size %d not supported&bslash;n&quot;
comma
id|Controller
comma
id|NewLogicalDeviceInfo-&gt;DeviceBlockSizeInBytes
)paren
suffix:semicolon
id|LogicalDeviceNumber
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|PhysicalDevice.Controller
op_assign
l_int|0
suffix:semicolon
id|PhysicalDevice.Channel
op_assign
id|NewLogicalDeviceInfo-&gt;Channel
suffix:semicolon
id|PhysicalDevice.TargetID
op_assign
id|NewLogicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|PhysicalDevice.LogicalUnit
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|PhysicalDevice
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_ne
id|DAC960_V2_LogicalDevice_Offline
)paren
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDeviceNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|LogicalDeviceInfo
op_assign
(paren
id|DAC960_V2_LogicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;LOGICAL DEVICE ALLOCATION&quot;
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|LogicalDeviceInfo
suffix:semicolon
id|memcpy
c_func
(paren
id|LogicalDeviceInfo
comma
id|NewLogicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|LogicalDeviceNumber
op_increment
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReportControllerConfiguration reports the Configuration Information&n;  for Controller.&n;*/
DECL|function|DAC960_ReportControllerConfiguration
r_static
id|boolean
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;Configuring Mylex %s PCI RAID Controller&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Firmware Version: %s, Channels: %d, Memory Size: %dMB&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;FirmwareVersion
comma
id|Controller-&gt;Channels
comma
id|Controller-&gt;MemorySize
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Bus: %d, Device: %d, Function: %d, I/O Address: &quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;Unassigned&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IO_Address
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  PCI Address: 0x%X mapped at 0x%lX, IRQ Channel: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;PCI_Address
comma
(paren
r_int
r_int
)paren
id|Controller-&gt;BaseAddress
comma
id|Controller-&gt;IRQ_Channel
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Controller Queue Depth: %d, &quot;
l_string|&quot;Maximum Blocks per Command: %d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerQueueDepth
comma
id|Controller-&gt;MaxBlocksPerCommand
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Driver Queue Depth: %d, &quot;
l_string|&quot;Scatter/Gather Limit: %d of %d Segments&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;DriverQueueDepth
comma
id|Controller-&gt;DriverScatterGatherLimit
comma
id|Controller-&gt;ControllerScatterGatherLimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Stripe Size: %dKB, Segment Size: %dKB, &quot;
l_string|&quot;BIOS Geometry: %d/%d&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;V1.StripeSize
comma
id|Controller-&gt;V1.SegmentSize
comma
id|Controller-&gt;V1.GeometryTranslationHeads
comma
id|Controller-&gt;V1.GeometryTranslationSectors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.SAFTE_EnclosureManagementEnabled
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;  SAF-TE Enclosure Management Enabled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadDeviceConfiguration reads the Device Configuration Information&n;  for DAC960 V1 Firmware Controllers by requesting the SCSI Inquiry and SCSI&n;  Inquiry Unit Serial Number information for each device connected to&n;  Controller.&n;*/
DECL|function|DAC960_V1_ReadDeviceConfiguration
r_static
id|boolean
id|DAC960_V1_ReadDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_struct
id|dma_loaf
id|local_dma
suffix:semicolon
id|dma_addr_t
id|DCDBs_dma
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
id|DAC960_V1_DCDB_T
op_star
id|DCDBs_cpu
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
id|dma_addr_t
id|SCSI_Inquiry_dma
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|SCSI_Inquiry_cpu
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
id|dma_addr_t
id|SCSI_NewInquiryUnitSerialNumberDMA
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|SCSI_NewInquiryUnitSerialNumberCPU
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
r_struct
id|completion
id|Completions
(braket
id|DAC960_V1_MaxChannels
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
comma
id|DAC960_V1_MaxChannels
op_star
(paren
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
op_plus
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
)paren
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;DMA ALLOCATION FAILED IN ReadDeviceConfiguration&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DCDBs_cpu
(braket
id|Channel
)braket
op_assign
id|slice_dma_loaf
c_func
(paren
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
comma
id|DCDBs_dma
op_plus
id|Channel
)paren
suffix:semicolon
id|SCSI_Inquiry_cpu
(braket
id|Channel
)braket
op_assign
id|slice_dma_loaf
c_func
(paren
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
comma
id|SCSI_Inquiry_dma
op_plus
id|Channel
)paren
suffix:semicolon
id|SCSI_NewInquiryUnitSerialNumberCPU
(braket
id|Channel
)braket
op_assign
id|slice_dma_loaf
c_func
(paren
op_amp
id|local_dma
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
id|SCSI_NewInquiryUnitSerialNumberDMA
op_plus
id|Channel
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
multiline_comment|/*&n;       * For each channel, submit a probe for a device on that channel.&n;       * The timeout interval for a device that is present is 10 seconds.&n;       * With this approach, the timeout periods can elapse in parallel&n;       * on each channel.&n;       */
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|dma_addr_t
id|NewInquiryStandardDataDMA
op_assign
id|SCSI_Inquiry_dma
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
id|DCDBs_cpu
(braket
id|Channel
)braket
suffix:semicolon
id|dma_addr_t
id|DCDB_dma
op_assign
id|DCDBs_dma
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
r_struct
id|completion
op_star
id|Completion
op_assign
op_amp
id|Completions
(braket
id|Channel
)braket
suffix:semicolon
id|init_completion
c_func
(paren
id|Completion
)paren
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|Command-&gt;Completion
op_assign
id|Completion
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|DCDB_dma
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Channel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|TargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|NewInquiryStandardDataDMA
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;       * Wait for the problems submitted in the previous loop&n;       * to complete.  On the probes that are successful, &n;       * get the serial number of the device that was found.&n;       */
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
(brace
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|NewInquiryStandardData
op_assign
id|SCSI_Inquiry_cpu
(braket
id|Channel
)braket
suffix:semicolon
id|dma_addr_t
id|NewInquiryUnitSerialNumberDMA
op_assign
id|SCSI_NewInquiryUnitSerialNumberDMA
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|NewInquiryUnitSerialNumber
op_assign
id|SCSI_NewInquiryUnitSerialNumberCPU
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|Channel
)braket
suffix:semicolon
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
id|DCDBs_cpu
(braket
id|Channel
)braket
suffix:semicolon
r_struct
id|completion
op_star
id|Completion
op_assign
op_amp
id|Completions
(braket
id|Channel
)braket
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|Completion
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;V1.CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
(brace
id|memset
c_func
(paren
id|InquiryStandardData
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
)paren
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryStandardData
comma
id|NewInquiryStandardData
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
)paren
suffix:semicolon
multiline_comment|/* Preserve Channel and TargetID values from the previous loop */
id|Command-&gt;Completion
op_assign
id|Completion
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|NewInquiryUnitSerialNumberDMA
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
id|Completion
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;V1.CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
(brace
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryUnitSerialNumber
comma
id|NewInquiryUnitSerialNumber
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
)brace
)brace
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|local_dma
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadDeviceConfiguration reads the Device Configuration Information&n;  for DAC960 V2 Firmware Controllers by requesting the Physical Device&n;  Information and SCSI Inquiry Unit Serial Number information for each&n;  device connected to Controller.&n;*/
DECL|function|DAC960_V2_ReadDeviceConfiguration
r_static
id|boolean
id|DAC960_V2_ReadDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
r_char
id|Channel
op_assign
l_int|0
comma
id|TargetID
op_assign
l_int|0
comma
id|LogicalUnit
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|NewPhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation
suffix:semicolon
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|NewInquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.NewInquiryUnitSerialNumber
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_NewPhysicalDeviceInfo
c_func
(paren
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|LogicalUnit
)paren
)paren
r_break
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
)paren
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;PHYSICAL DEVICE ALLOCATION&quot;
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|PhysicalDeviceInfo
suffix:semicolon
id|memcpy
c_func
(paren
id|PhysicalDeviceInfo
comma
id|NewPhysicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber
op_assign
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|PhysicalDeviceInfo
)paren
suffix:semicolon
r_return
id|DAC960_Failure
c_func
(paren
id|Controller
comma
l_string|&quot;SERIAL NUMBER ALLOCATION&quot;
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|InquiryUnitSerialNumber
suffix:semicolon
id|Channel
op_assign
id|NewPhysicalDeviceInfo-&gt;Channel
suffix:semicolon
id|TargetID
op_assign
id|NewPhysicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|LogicalUnit
op_assign
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
multiline_comment|/*&n;&t; Some devices do NOT have Unit Serial Numbers.&n;&t; This command fails for them.  But, we still want to&n;&t; remember those devices are there.  Construct a&n;&t; UnitSerialNumber structure for the failure case.&n;      */
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_NewInquiryUnitSerialNumber
c_func
(paren
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|LogicalUnit
)paren
)paren
(brace
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryUnitSerialNumber
comma
id|NewInquiryUnitSerialNumber
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|PhysicalDeviceIndex
op_increment
suffix:semicolon
id|LogicalUnit
op_increment
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_SanitizeInquiryData sanitizes the Vendor, Model, Revision, and&n;  Product Serial Number fields of the Inquiry Standard Data and Inquiry&n;  Unit Serial Number structures.&n;*/
DECL|function|DAC960_SanitizeInquiryData
r_static
r_void
id|DAC960_SanitizeInquiryData
c_func
(paren
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
comma
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
comma
r_int
r_char
op_star
id|Vendor
comma
r_int
r_char
op_star
id|Model
comma
r_int
r_char
op_star
id|Revision
comma
r_int
r_char
op_star
id|SerialNumber
)paren
(brace
r_int
id|SerialNumberLength
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|InquiryStandardData-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|VendorCharacter
op_assign
id|InquiryStandardData-&gt;VendorIdentification
(braket
id|i
)braket
suffix:semicolon
id|Vendor
(braket
id|i
)braket
op_assign
(paren
id|VendorCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|VendorCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|VendorCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Vendor
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|ModelCharacter
op_assign
id|InquiryStandardData-&gt;ProductIdentification
(braket
id|i
)braket
suffix:semicolon
id|Model
(braket
id|i
)braket
op_assign
(paren
id|ModelCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|ModelCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|ModelCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Model
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|RevisionCharacter
op_assign
id|InquiryStandardData-&gt;ProductRevisionLevel
(braket
id|i
)braket
suffix:semicolon
id|Revision
(braket
id|i
)braket
op_assign
(paren
id|RevisionCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|RevisionCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|RevisionCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|Revision
(braket
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_return
suffix:semicolon
id|SerialNumberLength
op_assign
id|InquiryUnitSerialNumber-&gt;PageLength
suffix:semicolon
r_if
c_cond
(paren
id|SerialNumberLength
OG
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
)paren
id|SerialNumberLength
op_assign
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SerialNumberLength
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|SerialNumberCharacter
op_assign
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
(braket
id|i
)braket
suffix:semicolon
id|SerialNumber
(braket
id|i
)braket
op_assign
(paren
id|SerialNumberCharacter
op_ge
l_char|&squot; &squot;
op_logical_and
id|SerialNumberCharacter
op_le
l_char|&squot;~&squot;
ques
c_cond
id|SerialNumberCharacter
suffix:colon
l_char|&squot; &squot;
)paren
suffix:semicolon
)brace
id|SerialNumber
(braket
id|SerialNumberLength
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReportDeviceConfiguration reports the Device Configuration&n;  Information for DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ReportDeviceConfiguration
r_static
id|boolean
id|DAC960_V1_ReportDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|LogicalDriveNumber
comma
id|Channel
comma
id|TargetID
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Physical Devices:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_ErrorTableEntry_T
op_star
id|ErrorEntry
op_assign
op_amp
id|Controller-&gt;V1.ErrorTable.ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_char
id|Vendor
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
suffix:semicolon
r_char
id|Model
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
suffix:semicolon
r_char
id|Revision
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
suffix:semicolon
r_char
id|SerialNumber
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryUnitSerialNumber
op_member_access_from_pointer
id|ProductSerialNumber
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|InquiryStandardData-&gt;PeripheralDeviceType
op_eq
l_int|0x1F
)paren
r_continue
suffix:semicolon
id|DAC960_SanitizeInquiryData
c_func
(paren
id|InquiryStandardData
comma
id|InquiryUnitSerialNumber
comma
id|Vendor
comma
id|Model
comma
id|Revision
comma
id|SerialNumber
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    %d:%d%s Vendor: %s  Model: %s  Revision: %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|TargetID
OL
l_int|10
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|Vendor
comma
id|Model
comma
id|Revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_ne
l_int|0x1F
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Serial Number: %s&bslash;n&quot;
comma
id|Controller
comma
id|SerialNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V1.DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %u blocks, %d resets&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
comma
id|Controller-&gt;V1.DeviceResetCount
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %u blocks&bslash;n&quot;
comma
id|Controller
comma
(paren
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;Write-Only&quot;
suffix:colon
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
l_string|&quot;Standby&quot;
)paren
comma
id|DeviceState-&gt;DiskSize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ErrorEntry-&gt;ParityErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;SoftErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;HardErrorCount
OG
l_int|0
op_logical_or
id|ErrorEntry-&gt;MiscErrorCount
OG
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Errors - Parity: %d, Soft: %d, &quot;
l_string|&quot;Hard: %d, Misc: %d&bslash;n&quot;
comma
id|Controller
comma
id|ErrorEntry-&gt;ParityErrorCount
comma
id|ErrorEntry-&gt;SoftErrorCount
comma
id|ErrorEntry-&gt;HardErrorCount
comma
id|ErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Logical Drives:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|LogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    /dev/rd/c%dd%d: RAID-%d, %s, %u blocks, %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|LogicalDriveInformation-&gt;RAIDLevel
comma
(paren
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|LogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
l_string|&quot;Offline&quot;
)paren
comma
id|LogicalDriveInformation-&gt;LogicalDriveSize
comma
(paren
id|LogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;Write Back&quot;
suffix:colon
l_string|&quot;Write Thru&quot;
)paren
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReportDeviceConfiguration reports the Device Configuration&n;  Information for DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ReportDeviceConfiguration
r_static
id|boolean
id|DAC960_V2_ReportDeviceConfiguration
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|PhysicalDeviceIndex
comma
id|LogicalDriveNumber
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;  Physical Devices:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
id|PhysicalDeviceIndex
OL
id|DAC960_V2_MaxPhysicalDevices
suffix:semicolon
id|PhysicalDeviceIndex
op_increment
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
(paren
id|DAC960_SCSI_Inquiry_T
op_star
)paren
op_amp
id|PhysicalDeviceInfo-&gt;SCSI_InquiryData
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
r_char
id|Vendor
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;VendorIdentification
)paren
)braket
suffix:semicolon
r_char
id|Model
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductIdentification
)paren
)braket
suffix:semicolon
r_char
id|Revision
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryStandardData-&gt;ProductRevisionLevel
)paren
)braket
suffix:semicolon
r_char
id|SerialNumber
(braket
l_int|1
op_plus
r_sizeof
(paren
id|InquiryUnitSerialNumber-&gt;ProductSerialNumber
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|DAC960_SanitizeInquiryData
c_func
(paren
id|InquiryStandardData
comma
id|InquiryUnitSerialNumber
comma
id|Vendor
comma
id|Model
comma
id|Revision
comma
id|SerialNumber
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;    %d:%d%s Vendor: %s  Model: %s  Revision: %s&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;Channel
comma
id|PhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|PhysicalDeviceInfo-&gt;TargetID
OL
l_int|10
ques
c_cond
l_string|&quot; &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|Vendor
comma
id|Model
comma
id|Revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedSynchronousMegaTransfers
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         %sAsynchronous&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_eq
l_int|16
ques
c_cond
l_string|&quot;Wide &quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;         %sSynchronous at %d MB/sec&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_eq
l_int|16
ques
c_cond
l_string|&quot;Wide &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|PhysicalDeviceInfo-&gt;NegotiatedSynchronousMegaTransfers
op_star
id|PhysicalDeviceInfo-&gt;NegotiatedDataWidthBits
op_div
l_int|8
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_ne
l_int|0x1F
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;         Serial Number: %s&bslash;n&quot;
comma
id|Controller
comma
id|SerialNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Unconfigured
)paren
r_continue
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;         Disk Status: %s, %u blocks&bslash;n&quot;
comma
id|Controller
comma
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Rebuild
ques
c_cond
l_string|&quot;Rebuild&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Missing
ques
c_cond
l_string|&quot;Missing&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
ques
c_cond
l_string|&quot;Dead&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_SuspectedDead
ques
c_cond
l_string|&quot;Suspected-Dead&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_CommandedOffline
ques
c_cond
l_string|&quot;Commanded-Offline&quot;
suffix:colon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Standby
ques
c_cond
l_string|&quot;Standby&quot;
suffix:colon
l_string|&quot;Unknown&quot;
)paren
comma
id|PhysicalDeviceInfo-&gt;ConfigurableDeviceSize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo-&gt;ParityErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;SoftErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;HardErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;CommandTimeouts
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;Retries
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;Aborts
op_eq
l_int|0
op_logical_and
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;         Errors - Parity: %d, Soft: %d, &quot;
l_string|&quot;Hard: %d, Misc: %d&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;ParityErrors
comma
id|PhysicalDeviceInfo-&gt;SoftErrors
comma
id|PhysicalDeviceInfo-&gt;HardErrors
comma
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Timeouts: %d, Retries: %d, &quot;
l_string|&quot;Aborts: %d, Predicted: %d&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;CommandTimeouts
comma
id|PhysicalDeviceInfo-&gt;Retries
comma
id|PhysicalDeviceInfo-&gt;Aborts
comma
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;  Logical Drives:&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_int
r_char
op_star
id|ReadCacheStatus
(braket
)braket
op_assign
(brace
l_string|&quot;Read Cache Disabled&quot;
comma
l_string|&quot;Read Cache Enabled&quot;
comma
l_string|&quot;Read Ahead Enabled&quot;
comma
l_string|&quot;Intelligent Read Ahead Enabled&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|WriteCacheStatus
(braket
)braket
op_assign
(brace
l_string|&quot;Write Cache Disabled&quot;
comma
l_string|&quot;Logical Device Read Only&quot;
comma
l_string|&quot;Write Cache Enabled&quot;
comma
l_string|&quot;Intelligent Write Cache Enabled&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
comma
l_string|&quot;-&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|GeometryTranslation
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
(brace
r_case
id|DAC960_V2_Geometry_128_32
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;128/32&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V2_Geometry_255_63
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;255/63&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|GeometryTranslation
op_assign
l_string|&quot;Invalid&quot;
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;Illegal Logical Device Geometry %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceInfo-&gt;DriveGeometry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;    /dev/rd/c%dd%d: RAID-%d, %s, %u blocks&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|LogicalDeviceInfo-&gt;RAIDLevel
comma
(paren
id|LogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Online
ques
c_cond
l_string|&quot;Online&quot;
suffix:colon
id|LogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Critical
ques
c_cond
l_string|&quot;Critical&quot;
suffix:colon
l_string|&quot;Offline&quot;
)paren
comma
id|LogicalDeviceInfo-&gt;ConfigurableDeviceSize
)paren
suffix:semicolon
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Logical Device %s, BIOS Geometry: %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|LogicalDeviceInfo-&gt;LogicalDeviceControl
dot
id|LogicalDeviceInitialized
ques
c_cond
l_string|&quot;Initialized&quot;
suffix:colon
l_string|&quot;Uninitialized&quot;
)paren
comma
id|GeometryTranslation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: N/A, &quot;
l_string|&quot;Segment Size: N/A&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: N/A, &quot;
l_string|&quot;Segment Size: %dKB&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_eq
l_int|0
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: %dKB, &quot;
l_string|&quot;Segment Size: N/A&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
r_else
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Stripe Size: %dKB, &quot;
l_string|&quot;Segment Size: %dKB&bslash;n&quot;
comma
id|Controller
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;StripeSize
op_minus
l_int|2
)paren
comma
l_int|1
op_lshift
(paren
id|LogicalDeviceInfo-&gt;CacheLineSize
op_minus
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|DAC960_Info
c_func
(paren
l_string|&quot;                  %s, %s&bslash;n&quot;
comma
id|Controller
comma
id|ReadCacheStatus
(braket
id|LogicalDeviceInfo-&gt;LogicalDeviceControl.ReadCache
)braket
comma
id|WriteCacheStatus
(braket
id|LogicalDeviceInfo-&gt;LogicalDeviceControl.WriteCache
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;SoftErrors
OG
l_int|0
op_logical_or
id|LogicalDeviceInfo-&gt;CommandsFailed
OG
l_int|0
op_logical_or
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
id|DAC960_Info
c_func
(paren
l_string|&quot;                  Errors - Soft: %d, Failed: %d, &quot;
l_string|&quot;Deferred Write: %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceInfo-&gt;SoftErrors
comma
id|LogicalDeviceInfo-&gt;CommandsFailed
comma
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RegisterBlockDevice registers the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_RegisterBlockDevice
r_static
id|boolean
id|DAC960_RegisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
r_struct
id|request_queue
op_star
id|RequestQueue
suffix:semicolon
r_int
id|n
suffix:semicolon
multiline_comment|/*&n;    Register the Block Device Major Number for this DAC960 Controller.&n;  */
r_if
c_cond
(paren
id|register_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;dac960&quot;
)paren
OL
l_int|0
)paren
r_return
l_bool|false
suffix:semicolon
multiline_comment|/*&n;    Initialize the I/O Request Queue.&n;  */
id|RequestQueue
op_assign
id|blk_init_queue
c_func
(paren
id|DAC960_RequestFunction
comma
op_amp
id|Controller-&gt;queue_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RequestQueue
)paren
(brace
id|unregister_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;dac960&quot;
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
id|Controller-&gt;RequestQueue
op_assign
id|RequestQueue
suffix:semicolon
id|blk_queue_bounce_limit
c_func
(paren
id|RequestQueue
comma
id|Controller-&gt;BounceBufferLimit
)paren
suffix:semicolon
id|RequestQueue-&gt;queuedata
op_assign
id|Controller
suffix:semicolon
id|blk_queue_max_hw_segments
c_func
(paren
id|RequestQueue
comma
id|Controller-&gt;DriverScatterGatherLimit
)paren
suffix:semicolon
id|blk_queue_max_phys_segments
c_func
(paren
id|RequestQueue
comma
id|Controller-&gt;DriverScatterGatherLimit
)paren
suffix:semicolon
id|blk_queue_max_sectors
c_func
(paren
id|RequestQueue
comma
id|Controller-&gt;MaxBlocksPerCommand
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|n
op_increment
)paren
(brace
r_struct
id|gendisk
op_star
id|disk
op_assign
id|Controller-&gt;disks
(braket
id|n
)braket
suffix:semicolon
id|disk-&gt;queue
op_assign
id|RequestQueue
suffix:semicolon
id|sprintf
c_func
(paren
id|disk-&gt;disk_name
comma
l_string|&quot;rd/c%dd%d&quot;
comma
id|Controller-&gt;ControllerNumber
comma
id|n
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|disk-&gt;devfs_name
comma
l_string|&quot;rd/host%d/target%d&quot;
comma
id|Controller-&gt;ControllerNumber
comma
id|n
)paren
suffix:semicolon
id|disk-&gt;major
op_assign
id|MajorNumber
suffix:semicolon
id|disk-&gt;first_minor
op_assign
id|n
op_lshift
id|DAC960_MaxPartitionsBits
suffix:semicolon
id|disk-&gt;fops
op_assign
op_amp
id|DAC960_BlockDeviceOperations
suffix:semicolon
)brace
multiline_comment|/*&n;    Indicate the Block Device Registration completed successfully,&n;  */
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_UnregisterBlockDevice unregisters the Block Device structures&n;  associated with Controller.&n;*/
DECL|function|DAC960_UnregisterBlockDevice
r_static
r_void
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|MajorNumber
op_assign
id|DAC960_MAJOR
op_plus
id|Controller-&gt;ControllerNumber
suffix:semicolon
r_int
id|disk
suffix:semicolon
r_for
c_loop
(paren
id|disk
op_assign
l_int|0
suffix:semicolon
id|disk
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|disk
op_increment
)paren
id|del_gendisk
c_func
(paren
id|Controller-&gt;disks
(braket
id|disk
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;    Unregister the Block Device Major Number for this DAC960 Controller.&n;  */
id|unregister_blkdev
c_func
(paren
id|MajorNumber
comma
l_string|&quot;dac960&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;    Remove the I/O Request Queue.&n;  */
id|blk_cleanup_queue
c_func
(paren
id|Controller-&gt;RequestQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ComputeGenericDiskInfo computes the values for the Generic Disk&n;  Information Partition Sector Counts and Block Sizes.&n;*/
DECL|function|DAC960_ComputeGenericDiskInfo
r_static
r_void
id|DAC960_ComputeGenericDiskInfo
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|disk
suffix:semicolon
r_for
c_loop
(paren
id|disk
op_assign
l_int|0
suffix:semicolon
id|disk
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|disk
op_increment
)paren
id|set_capacity
c_func
(paren
id|Controller-&gt;disks
(braket
id|disk
)braket
comma
id|disk_size
c_func
(paren
id|Controller
comma
id|disk
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ReportErrorStatus reports Controller BIOS Messages passed through&n;  the Error Status Register when the driver performs the BIOS handshaking.&n;  It returns true for fatal errors and false otherwise.&n;*/
DECL|function|DAC960_ReportErrorStatus
r_static
id|boolean
id|DAC960_ReportErrorStatus
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
id|ErrorStatus
comma
r_int
r_char
id|Parameter0
comma
r_int
r_char
id|Parameter1
)paren
(brace
r_switch
c_cond
(paren
id|ErrorStatus
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Physical Device %d:%d Not Responding&bslash;n&quot;
comma
id|Controller
comma
id|Parameter1
comma
id|Parameter0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;DriveSpinUpMessageDisplayed
)paren
r_break
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Spinning Up Drives&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;DriveSpinUpMessageDisplayed
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x30
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Configuration Checksum Error&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x60
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race Recovery Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x70
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race Recovery In Progress&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x90
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Physical Device %d:%d COD Mismatch&bslash;n&quot;
comma
id|Controller
comma
id|Parameter1
comma
id|Parameter0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xA0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Logical Drive Installation Aborted&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xB0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;Mirror Race On A Critical Logical Drive&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xD0
suffix:colon
id|DAC960_Notice
c_func
(paren
l_string|&quot;New Controller Configuration Found&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xF0
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Fatal Memory Parity Error for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Unknown Initialization Error %02X for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|ErrorStatus
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n; * DAC960_DetectCleanup releases the resources that were allocated&n; * during DAC960_DetectController().  DAC960_DetectController can&n; * has several internal failure points, so not ALL resources may &n; * have been allocated.  It&squot;s important to free only&n; * resources that HAVE been allocated.  The code below always&n; * tests that the resource has been allocated before attempting to&n; * free it.&n; */
DECL|function|DAC960_DetectCleanup
r_static
r_void
id|DAC960_DetectCleanup
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Free the memory mailbox, status, and related structures */
id|free_dma_loaf
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_amp
id|Controller-&gt;DmaPages
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
(brace
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|DAC960_BA_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|DAC960_LP_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
id|DAC960_LA_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|DAC960_PG_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|DAC960_PD_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_P_Controller
suffix:colon
id|DAC960_PD_DisableInterrupts
c_func
(paren
id|Controller-&gt;BaseAddress
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|iounmap
c_func
(paren
id|Controller-&gt;MemoryMappedAddress
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;IRQ_Channel
)paren
id|free_irq
c_func
(paren
id|Controller-&gt;IRQ_Channel
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
)paren
id|release_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|Controller-&gt;PCIDevice
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|DAC960_MaxLogicalDrives
)paren
op_logical_and
id|Controller-&gt;disks
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
id|put_disk
c_func
(paren
id|Controller-&gt;disks
(braket
id|i
)braket
)paren
suffix:semicolon
id|DAC960_Controllers
(braket
id|Controller-&gt;ControllerNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DetectController detects Mylex DAC960/AcceleRAID/eXtremeRAID&n;  PCI RAID Controllers by interrogating the PCI Configuration Space for&n;  Controller Type.&n;*/
r_static
id|DAC960_Controller_T
op_star
DECL|function|DAC960_DetectController
id|DAC960_DetectController
c_func
(paren
r_struct
id|pci_dev
op_star
id|PCI_Device
comma
r_const
r_struct
id|pci_device_id
op_star
id|entry
)paren
(brace
r_struct
id|DAC960_privdata
op_star
id|privdata
op_assign
(paren
r_struct
id|DAC960_privdata
op_star
)paren
id|entry-&gt;driver_data
suffix:semicolon
id|irqreturn_t
(paren
op_star
id|InterruptHandler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
op_assign
id|privdata-&gt;InterruptHandler
suffix:semicolon
r_int
r_int
id|MemoryWindowSize
op_assign
id|privdata-&gt;MemoryWindowSize
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|DeviceFunction
op_assign
id|PCI_Device-&gt;devfn
suffix:semicolon
r_int
r_char
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
suffix:semicolon
r_int
r_int
id|IRQ_Channel
op_assign
id|PCI_Device-&gt;irq
suffix:semicolon
r_void
op_star
id|BaseAddress
suffix:semicolon
r_int
id|i
suffix:semicolon
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_Controller_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to allocate Controller structure for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|Controller
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_Controller_T
)paren
)paren
suffix:semicolon
id|Controller-&gt;ControllerNumber
op_assign
id|DAC960_ControllerCount
suffix:semicolon
id|DAC960_Controllers
(braket
id|DAC960_ControllerCount
op_increment
)braket
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;Bus
op_assign
id|PCI_Device-&gt;bus-&gt;number
suffix:semicolon
id|Controller-&gt;FirmwareType
op_assign
id|privdata-&gt;FirmwareType
suffix:semicolon
id|Controller-&gt;HardwareType
op_assign
id|privdata-&gt;HardwareType
suffix:semicolon
id|Controller-&gt;Device
op_assign
id|DeviceFunction
op_rshift
l_int|3
suffix:semicolon
id|Controller-&gt;Function
op_assign
id|DeviceFunction
op_amp
l_int|0x7
suffix:semicolon
id|Controller-&gt;PCIDevice
op_assign
id|PCI_Device
suffix:semicolon
id|strcpy
c_func
(paren
id|Controller-&gt;FullModelName
comma
l_string|&quot;DAC960&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|PCI_Device
)paren
)paren
(brace
id|kfree
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
id|Controller-&gt;IO_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_P_Controller
suffix:colon
id|Controller-&gt;IO_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|0
)paren
suffix:semicolon
id|Controller-&gt;PCI_Address
op_assign
id|pci_resource_start
c_func
(paren
id|PCI_Device
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|PCI_Device
comma
(paren
r_void
op_star
)paren
(paren
(paren
r_int
)paren
id|Controller-&gt;ControllerNumber
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Controller-&gt;disks
(braket
id|i
)braket
op_assign
id|alloc_disk
c_func
(paren
l_int|1
op_lshift
id|DAC960_MaxPartitionsBits
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;disks
(braket
id|i
)braket
)paren
r_goto
id|Failure
suffix:semicolon
id|Controller-&gt;disks
(braket
id|i
)braket
op_member_access_from_pointer
id|private_data
op_assign
(paren
r_void
op_star
)paren
id|i
suffix:semicolon
)brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
)paren
suffix:semicolon
id|Controller-&gt;queue_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
multiline_comment|/*&n;    Map the Controller Register Window.&n;  */
r_if
c_cond
(paren
id|MemoryWindowSize
OL
id|PAGE_SIZE
)paren
id|MemoryWindowSize
op_assign
id|PAGE_SIZE
suffix:semicolon
id|Controller-&gt;MemoryMappedAddress
op_assign
id|ioremap_nocache
c_func
(paren
id|Controller-&gt;PCI_Address
op_amp
id|PAGE_MASK
comma
id|MemoryWindowSize
)paren
suffix:semicolon
id|Controller-&gt;BaseAddress
op_assign
id|Controller-&gt;MemoryMappedAddress
op_plus
(paren
id|Controller-&gt;PCI_Address
op_amp
op_complement
id|PAGE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MemoryMappedAddress
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to map Controller Register Window for &quot;
l_string|&quot;Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|BaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
r_switch
c_cond
(paren
id|Controller-&gt;HardwareType
)paren
(brace
r_case
id|DAC960_BA_Controller
suffix:colon
id|DAC960_BA_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_BA_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_BA_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_BA_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_BA_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V2_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V2_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V2_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V2_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LP_Controller
suffix:colon
id|DAC960_LP_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_LP_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LP_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V2_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_LP_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LP_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V2_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V2_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V2_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V2_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_LA_Controller
suffix:colon
id|DAC960_LA_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_LA_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_LA_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_LA_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LA_QueueCommandDualMode
suffix:semicolon
r_else
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_LA_QueueCommandSingleMode
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PG_Controller
suffix:colon
id|DAC960_PG_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeHardwareMailboxStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PG_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PG_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to Enable Memory Mailbox Interface &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PG_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;V1.DualModeMemoryMailboxInterface
)paren
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PG_QueueCommandDualMode
suffix:semicolon
r_else
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PG_QueueCommandSingleMode
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_PD_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
comma
id|Controller-&gt;FullModelName
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;IO port 0x%d busy for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IO_Address
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PD_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PD_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to allocate DMA mapped memory &quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PD_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_PD_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_P_Controller
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
comma
id|Controller-&gt;FullModelName
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;IO port 0x%d busy for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IO_Address
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PD_DisableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_InitializationInProgressP
c_func
(paren
id|BaseAddress
)paren
)paren
(brace
r_if
c_cond
(paren
id|DAC960_PD_ReadErrorStatus
c_func
(paren
id|BaseAddress
comma
op_amp
id|ErrorStatus
comma
op_amp
id|Parameter0
comma
op_amp
id|Parameter1
)paren
op_logical_and
id|DAC960_ReportErrorStatus
c_func
(paren
id|Controller
comma
id|ErrorStatus
comma
id|Parameter0
comma
id|Parameter1
)paren
)paren
r_goto
id|Failure
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_V1_EnableMemoryMailboxInterface
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to allocate DMA mapped memory&quot;
l_string|&quot;for Controller at&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|DAC960_PD_EnableInterrupts
c_func
(paren
id|BaseAddress
)paren
suffix:semicolon
id|Controller-&gt;QueueCommand
op_assign
id|DAC960_P_QueueCommand
suffix:semicolon
id|Controller-&gt;ReadControllerConfiguration
op_assign
id|DAC960_V1_ReadControllerConfiguration
suffix:semicolon
id|Controller-&gt;ReadDeviceConfiguration
op_assign
id|DAC960_V1_ReadDeviceConfiguration
suffix:semicolon
id|Controller-&gt;ReportDeviceConfiguration
op_assign
id|DAC960_V1_ReportDeviceConfiguration
suffix:semicolon
id|Controller-&gt;QueueReadWriteCommand
op_assign
id|DAC960_V1_QueueReadWriteCommand
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;     Acquire shared access to the IRQ Channel.&n;  */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_Channel
comma
id|InterruptHandler
comma
id|SA_SHIRQ
comma
id|Controller-&gt;FullModelName
comma
id|Controller
)paren
OL
l_int|0
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Unable to acquire IRQ Channel %d for Controller at&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;IRQ_Channel
)paren
suffix:semicolon
r_goto
id|Failure
suffix:semicolon
)brace
id|Controller-&gt;IRQ_Channel
op_assign
id|IRQ_Channel
suffix:semicolon
id|Controller-&gt;InitialCommand.CommandIdentifier
op_assign
l_int|1
suffix:semicolon
id|Controller-&gt;InitialCommand.Controller
op_assign
id|Controller
suffix:semicolon
id|Controller-&gt;Commands
(braket
l_int|0
)braket
op_assign
op_amp
id|Controller-&gt;InitialCommand
suffix:semicolon
id|Controller-&gt;FreeCommands
op_assign
op_amp
id|Controller-&gt;InitialCommand
suffix:semicolon
r_return
id|Controller
suffix:semicolon
id|Failure
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;IO_Address
op_eq
l_int|0
)paren
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address N/A &quot;
l_string|&quot;PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
r_else
id|DAC960_Error
c_func
(paren
l_string|&quot;PCI Bus %d Device %d Function %d I/O Address &quot;
l_string|&quot;0x%X PCI Address 0x%X&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;Bus
comma
id|Controller-&gt;Device
comma
id|Controller-&gt;Function
comma
id|Controller-&gt;IO_Address
comma
id|Controller-&gt;PCI_Address
)paren
suffix:semicolon
id|DAC960_DetectCleanup
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ControllerCount
op_decrement
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_InitializeController initializes Controller.&n;*/
r_static
id|boolean
DECL|function|DAC960_InitializeController
id|DAC960_InitializeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|DAC960_ReadControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_CreateAuxiliaryStructures
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReadDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
op_logical_and
id|DAC960_RegisterBlockDevice
c_func
(paren
id|Controller
)paren
)paren
(brace
multiline_comment|/*&n;&t;Initialize the Monitoring Timer.&n;      */
id|init_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|Controller-&gt;MonitoringTimer.data
op_assign
(paren
r_int
r_int
)paren
id|Controller
suffix:semicolon
id|Controller-&gt;MonitoringTimer.function
op_assign
id|DAC960_MonitoringTimerFunction
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
id|Controller-&gt;ControllerInitialized
op_assign
l_bool|true
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_FinalizeController finalizes Controller.&n;*/
DECL|function|DAC960_FinalizeController
r_static
r_void
id|DAC960_FinalizeController
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ControllerInitialized
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/*&n;       * Acquiring and releasing lock here eliminates&n;       * a very low probability race.&n;       *&n;       * The code below allocates controller command structures&n;       * from the free list without holding the controller lock.&n;       * This is safe assuming there is no other activity on&n;       * the controller at the time.&n;       * &n;       * But, there might be a monitoring command still&n;       * in progress.  Setting the Shutdown flag while holding&n;       * the lock ensures that there is no monitoring command&n;       * in the interrupt handler currently, and any monitoring&n;       * commands that complete from this time on will NOT return&n;       * their command structure to the free list.&n;       */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|Controller-&gt;ShutdownMonitoringTimer
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|DAC960_Notice
c_func
(paren
l_string|&quot;Flushing Cache...&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_V1_ExecuteType3
c_func
(paren
id|Controller
comma
id|DAC960_V1_Flush
comma
l_int|0
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;done&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;HardwareType
op_eq
id|DAC960_PD_Controller
)paren
id|release_region
c_func
(paren
id|Controller-&gt;IO_Address
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_Notice
c_func
(paren
l_string|&quot;Flushing Cache...&quot;
comma
id|Controller
)paren
suffix:semicolon
id|DAC960_V2_DeviceOperation
c_func
(paren
id|Controller
comma
id|DAC960_V2_PauseDevice
comma
id|DAC960_V2_RAID_Controller
)paren
suffix:semicolon
id|DAC960_Notice
c_func
(paren
l_string|&quot;done&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
)brace
id|DAC960_UnregisterBlockDevice
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_DestroyAuxiliaryStructures
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_DestroyProcEntries
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_DetectCleanup
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Probe verifies controller&squot;s existence and&n;  initializes the DAC960 Driver for that controller.&n;*/
r_static
r_int
DECL|function|DAC960_Probe
id|DAC960_Probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|entry
)paren
(brace
r_int
id|disk
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ControllerCount
op_eq
id|DAC960_MaxControllers
)paren
(brace
id|DAC960_Error
c_func
(paren
l_string|&quot;More than %d DAC960 Controllers detected - &quot;
l_string|&quot;ignoring from Controller at&bslash;n&quot;
comma
l_int|NULL
comma
id|DAC960_MaxControllers
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|Controller
op_assign
id|DAC960_DetectController
c_func
(paren
id|dev
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_InitializeController
c_func
(paren
id|Controller
)paren
)paren
(brace
id|DAC960_FinalizeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|disk
op_assign
l_int|0
suffix:semicolon
id|disk
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|disk
op_increment
)paren
(brace
id|set_capacity
c_func
(paren
id|Controller-&gt;disks
(braket
id|disk
)braket
comma
id|disk_size
c_func
(paren
id|Controller
comma
id|disk
)paren
)paren
suffix:semicolon
id|add_disk
c_func
(paren
id|Controller-&gt;disks
(braket
id|disk
)braket
)paren
suffix:semicolon
)brace
id|DAC960_CreateProcEntries
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Finalize finalizes the DAC960 Driver.&n;*/
DECL|function|DAC960_Remove
r_static
r_void
id|DAC960_Remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|PCI_Device
)paren
(brace
r_int
id|Controller_Number
op_assign
(paren
r_int
)paren
id|pci_get_drvdata
c_func
(paren
id|PCI_Device
)paren
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|Controller_Number
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_ne
l_int|NULL
)paren
id|DAC960_FinalizeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_QueueReadWriteCommand prepares and queues a Read/Write Command for&n;  DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_QueueReadWriteCommand
r_static
r_void
id|DAC960_V1_QueueReadWriteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_ScatterGatherSegment_T
op_star
id|ScatterGatherList
op_assign
id|Command-&gt;V1.ScatterGatherList
suffix:semicolon
r_struct
id|scatterlist
op_star
id|ScatterList
op_assign
id|Command-&gt;V1.ScatterList
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|Command-&gt;DmaDirection
op_eq
id|PCI_DMA_FROMDEVICE
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Read
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_Write
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
(paren
id|DAC960_BusAddress32_T
)paren
id|sg_dma_address
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;DmaDirection
op_eq
id|PCI_DMA_FROMDEVICE
)paren
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_ReadWithScatterGather
suffix:semicolon
r_else
id|CommandMailbox-&gt;Type5.CommandOpcode
op_assign
id|DAC960_V1_WriteWithScatterGather
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.TransferLength
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
id|CommandMailbox-&gt;Type5.LD.LogicalDriveNumber
op_assign
id|Command-&gt;LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.LogicalBlockAddress
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;Type5.BusAddress
op_assign
id|Command-&gt;V1.ScatterGatherListDMA
suffix:semicolon
id|CommandMailbox-&gt;Type5.ScatterGatherCount
op_assign
id|Command-&gt;SegmentCount
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|Command-&gt;SegmentCount
suffix:semicolon
id|i
op_increment
comma
id|ScatterList
op_increment
comma
id|ScatterGatherList
op_increment
)paren
(brace
id|ScatterGatherList-&gt;SegmentDataPointer
op_assign
(paren
id|DAC960_BusAddress32_T
)paren
id|sg_dma_address
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
id|ScatterGatherList-&gt;SegmentByteCount
op_assign
(paren
id|DAC960_ByteCount32_T
)paren
id|sg_dma_len
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
)brace
)brace
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_QueueReadWriteCommand prepares and queues a Read/Write Command for&n;  DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_QueueReadWriteCommand
r_static
r_void
id|DAC960_V2_QueueReadWriteCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
r_struct
id|scatterlist
op_star
id|ScatterList
op_assign
id|Command-&gt;V2.ScatterList
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandOpcode
op_assign
id|DAC960_V2_SCSI_10
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits.DataTransferControllerToHost
op_assign
(paren
id|Command-&gt;DmaDirection
op_eq
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
op_assign
id|Command-&gt;BlockCount
op_lshift
id|DAC960_BlockSizeBits
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.RequestSenseBusAddress
op_assign
id|Command-&gt;V2.RequestSenseDMA
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.PhysicalDevice
op_assign
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|Command-&gt;LogicalDriveNumber
)braket
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.RequestSenseSize
op_assign
r_sizeof
(paren
id|DAC960_SCSI_RequestSense_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CDBLength
op_assign
l_int|10
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|0
)braket
op_assign
(paren
id|Command-&gt;DmaDirection
op_eq
id|PCI_DMA_FROMDEVICE
ques
c_cond
l_int|0x28
suffix:colon
l_int|0x2A
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|2
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|24
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|3
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|16
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|4
)braket
op_assign
id|Command-&gt;BlockNumber
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|5
)braket
op_assign
id|Command-&gt;BlockNumber
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|7
)braket
op_assign
id|Command-&gt;BlockCount
op_rshift
l_int|8
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.SCSI_CDB
(braket
l_int|8
)braket
op_assign
id|Command-&gt;BlockCount
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
op_eq
l_int|1
)paren
(brace
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
(paren
id|DAC960_BusAddress64_T
)paren
id|sg_dma_address
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferSize
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_ScatterGatherSegment_T
op_star
id|ScatterGatherList
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;SegmentCount
OG
l_int|2
)paren
(brace
id|ScatterGatherList
op_assign
id|Command-&gt;V2.ScatterGatherList
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ExtendedScatterGather.ScatterGatherList0Length
op_assign
id|Command-&gt;SegmentCount
suffix:semicolon
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ExtendedScatterGather.ScatterGatherList0Address
op_assign
id|Command-&gt;V2.ScatterGatherListDMA
suffix:semicolon
)brace
r_else
id|ScatterGatherList
op_assign
id|CommandMailbox-&gt;SCSI_10.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|Command-&gt;SegmentCount
suffix:semicolon
id|i
op_increment
comma
id|ScatterList
op_increment
comma
id|ScatterGatherList
op_increment
)paren
(brace
id|ScatterGatherList-&gt;SegmentDataPointer
op_assign
(paren
id|DAC960_BusAddress64_T
)paren
id|sg_dma_address
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
id|ScatterGatherList-&gt;SegmentByteCount
op_assign
(paren
id|DAC960_ByteCount64_T
)paren
id|sg_dma_len
c_func
(paren
id|ScatterList
)paren
suffix:semicolon
)brace
)brace
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessRequest attempts to remove one I/O Request from Controller&squot;s&n;  I/O Request Queue and queues it to the Controller.  WaitForCommand is true if&n;  this function should wait for a Command to become available if necessary.&n;  This function returns true if an I/O Request was queued and false otherwise.&n;*/
DECL|function|DAC960_ProcessRequest
r_static
id|boolean
id|DAC960_ProcessRequest
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|boolean
id|WaitForCommand
)paren
(brace
r_struct
id|request_queue
op_star
id|RequestQueue
op_assign
id|Controller-&gt;RequestQueue
suffix:semicolon
r_struct
id|request
op_star
id|Request
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;ControllerInitialized
)paren
r_return
l_bool|false
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|Request
op_assign
id|elv_next_request
c_func
(paren
id|RequestQueue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Request
)paren
r_return
l_bool|false
suffix:semicolon
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|WaitForCommand
)paren
r_return
l_bool|false
suffix:semicolon
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rq_data_dir
c_func
(paren
id|Request
)paren
op_eq
id|READ
)paren
(brace
id|Command-&gt;DmaDirection
op_assign
id|PCI_DMA_FROMDEVICE
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadCommand
suffix:semicolon
)brace
r_else
(brace
id|Command-&gt;DmaDirection
op_assign
id|PCI_DMA_TODEVICE
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteCommand
suffix:semicolon
)brace
id|Command-&gt;Completion
op_assign
id|Request-&gt;waiting
suffix:semicolon
id|Command-&gt;LogicalDriveNumber
op_assign
(paren
r_int
)paren
id|Request-&gt;rq_disk-&gt;private_data
suffix:semicolon
id|Command-&gt;BlockNumber
op_assign
id|Request-&gt;sector
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
id|Request-&gt;nr_sectors
suffix:semicolon
id|Command-&gt;Request
op_assign
id|Request
suffix:semicolon
id|blkdev_dequeue_request
c_func
(paren
id|Request
)paren
suffix:semicolon
id|Command-&gt;SegmentCount
op_assign
id|blk_rq_map_sg
c_func
(paren
id|Controller-&gt;RequestQueue
comma
id|Command-&gt;Request
comma
id|Command-&gt;cmd_sglist
)paren
suffix:semicolon
multiline_comment|/* pci_map_sg MAY change the value of SegCount */
id|Command-&gt;SegmentCount
op_assign
id|pci_map_sg
c_func
(paren
id|Command-&gt;PciDevice
comma
id|Command-&gt;cmd_sglist
comma
id|Command-&gt;SegmentCount
comma
id|Command-&gt;DmaDirection
)paren
suffix:semicolon
id|DAC960_QueueReadWriteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_queue_partial_rw extracts one bio from the request already&n;  associated with argument command, and construct a new command block to retry I/O&n;  only on that bio.  Queue that command to the controller.&n;&n;  This function re-uses a previously-allocated Command,&n;  &t;there is no failure mode from trying to allocate a command.&n;*/
DECL|function|DAC960_queue_partial_rw
r_static
r_void
id|DAC960_queue_partial_rw
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_struct
id|request
op_star
id|Request
op_assign
id|Command-&gt;Request
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;DmaDirection
op_eq
id|PCI_DMA_FROMDEVICE
)paren
id|Command-&gt;CommandType
op_assign
id|DAC960_ReadRetryCommand
suffix:semicolon
r_else
id|Command-&gt;CommandType
op_assign
id|DAC960_WriteRetryCommand
suffix:semicolon
multiline_comment|/*&n;   * We could be more efficient with these mapping requests&n;   * and map only the portions that we need.  But since this&n;   * code should almost never be called, just go with a&n;   * simple coding.&n;   */
(paren
r_void
)paren
id|blk_rq_map_sg
c_func
(paren
id|Controller-&gt;RequestQueue
comma
id|Command-&gt;Request
comma
id|Command-&gt;cmd_sglist
)paren
suffix:semicolon
(paren
r_void
)paren
id|pci_map_sg
c_func
(paren
id|Command-&gt;PciDevice
comma
id|Command-&gt;cmd_sglist
comma
l_int|1
comma
id|Command-&gt;DmaDirection
)paren
suffix:semicolon
multiline_comment|/*&n;   * Resubmitting the request sector at a time is really tedious.&n;   * But, this should almost never happen.  So, we&squot;re willing to pay&n;   * this price so that in the end, as much of the transfer is completed&n;   * successfully as possible.&n;   */
id|Command-&gt;SegmentCount
op_assign
l_int|1
suffix:semicolon
id|Command-&gt;BlockNumber
op_assign
id|Request-&gt;sector
suffix:semicolon
id|Command-&gt;BlockCount
op_assign
l_int|1
suffix:semicolon
id|DAC960_QueueReadWriteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_RequestFunction is the I/O Request Function for DAC960 Controllers.&n;*/
DECL|function|DAC960_RequestFunction
r_static
r_void
id|DAC960_RequestFunction
c_func
(paren
r_struct
id|request_queue
op_star
id|RequestQueue
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|RequestQueue-&gt;queuedata
comma
(paren
id|i
op_increment
op_eq
l_int|0
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcessCompletedBuffer performs completion processing for an&n;  individual Buffer.&n;*/
DECL|function|DAC960_ProcessCompletedRequest
r_static
r_inline
id|boolean
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
comma
id|boolean
id|SuccessfulIO
)paren
(brace
r_struct
id|request
op_star
id|Request
op_assign
id|Command-&gt;Request
suffix:semicolon
r_int
id|UpToDate
suffix:semicolon
id|UpToDate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|SuccessfulIO
)paren
id|UpToDate
op_assign
l_int|1
suffix:semicolon
id|pci_unmap_sg
c_func
(paren
id|Command-&gt;PciDevice
comma
id|Command-&gt;cmd_sglist
comma
id|Command-&gt;SegmentCount
comma
id|Command-&gt;DmaDirection
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|end_that_request_first
c_func
(paren
id|Request
comma
id|UpToDate
comma
id|Command-&gt;BlockCount
)paren
)paren
(brace
id|end_that_request_last
c_func
(paren
id|Request
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;Completion
)paren
(brace
id|complete
c_func
(paren
id|Command-&gt;Completion
)paren
suffix:semicolon
id|Command-&gt;Completion
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_bool|true
suffix:semicolon
)brace
r_return
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ReadWriteError prints an appropriate error message for Command&n;  when an error occurs on a Read or Write operation.&n;*/
DECL|function|DAC960_V1_ReadWriteError
r_static
r_void
id|DAC960_V1_ReadWriteError
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_int
r_char
op_star
id|CommandName
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandType
)paren
(brace
r_case
id|DAC960_ReadCommand
suffix:colon
r_case
id|DAC960_ReadRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;READ&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_WriteCommand
suffix:colon
r_case
id|DAC960_WriteRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;WRITE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_MonitoringCommand
suffix:colon
r_case
id|DAC960_ImmediateCommand
suffix:colon
r_case
id|DAC960_QueuedCommand
suffix:colon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_IrrecoverableDataError
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Irrecoverable Data Error on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_LogicalDriveNonexistentOrOffline
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Logical Drive Nonexistent or Offline on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_AccessBeyondEndOfLogicalDrive
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Attempt to Access Beyond End of Logical Drive &quot;
l_string|&quot;on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BadDataEncountered
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Bad Data Encountered on %s:&bslash;n&quot;
comma
id|Controller
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Error
c_func
(paren
l_string|&quot;Unexpected Error Status %04X on %s:&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;V1.CommandStatus
comma
id|CommandName
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%d:   absolute blocks %u..%u&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|Command-&gt;BlockNumber
comma
id|Command-&gt;BlockNumber
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_ProcessCompletedCommand performs completion processing for Command&n;  for DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_ProcessCompletedCommand
r_static
r_void
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandType_T
id|CommandType
op_assign
id|Command-&gt;CommandType
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
op_assign
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteCommand
)paren
(brace
macro_line|#ifdef FORCE_RETRY_DEBUG
id|CommandStatus
op_assign
id|DAC960_V1_IrrecoverableDataError
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
l_bool|true
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_IrrecoverableDataError
op_logical_or
id|CommandStatus
op_eq
id|DAC960_V1_BadDataEncountered
)paren
(brace
multiline_comment|/*&n;&t;   * break the command down into pieces and resubmit each&n;&t;   * piece, hoping that some of them will succeed.&n;&t;   */
id|DAC960_queue_partial_rw
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_V1_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
l_bool|false
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadRetryCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteRetryCommand
)paren
(brace
id|boolean
id|normal_completion
suffix:semicolon
macro_line|#ifdef FORCE_RETRY_FAILURE_DEBUG
r_static
r_int
id|retry_count
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;        Perform completion processing for the portion that was&n;        retried, and submit the next portion, if any.&n;      */
id|normal_completion
op_assign
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
(brace
id|normal_completion
op_assign
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_LogicalDriveNonexistentOrOffline
)paren
id|DAC960_V1_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
macro_line|#ifdef FORCE_RETRY_FAILURE_DEBUG
r_if
c_cond
(paren
op_logical_neg
(paren
op_increment
id|retry_count
op_mod
l_int|10000
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;V1 error retry failure test&bslash;n&quot;
)paren
suffix:semicolon
id|normal_completion
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V1_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
id|normal_completion
)paren
)paren
(brace
id|DAC960_queue_partial_rw
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ShutdownMonitoringTimer
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_Enquiry
)paren
(brace
id|DAC960_V1_Enquiry_T
op_star
id|OldEnquiry
op_assign
op_amp
id|Controller-&gt;V1.Enquiry
suffix:semicolon
id|DAC960_V1_Enquiry_T
op_star
id|NewEnquiry
op_assign
id|Controller-&gt;V1.NewEnquiry
suffix:semicolon
r_int
r_int
id|OldCriticalLogicalDriveCount
op_assign
id|OldEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_int
r_int
id|NewCriticalLogicalDriveCount
op_assign
id|NewEnquiry-&gt;CriticalLogicalDriveCount
suffix:semicolon
r_if
c_cond
(paren
id|NewEnquiry-&gt;NumberOfLogicalDrives
OG
id|Controller-&gt;LogicalDriveCount
)paren
(brace
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;LogicalDriveCount
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|LogicalDriveNumber
OL
id|NewEnquiry-&gt;NumberOfLogicalDrives
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;Now Exists&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|NewEnquiry-&gt;NumberOfLogicalDrives
suffix:semicolon
id|DAC960_ComputeGenericDiskInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;NumberOfLogicalDrives
OL
id|Controller-&gt;LogicalDriveCount
)paren
(brace
r_int
id|LogicalDriveNumber
op_assign
id|NewEnquiry-&gt;NumberOfLogicalDrives
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;No Longer Exists&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|NewEnquiry-&gt;NumberOfLogicalDrives
suffix:semicolon
id|DAC960_ComputeGenericDiskInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
op_ne
id|OldEnquiry-&gt;StatusFlags.DeferredWriteError
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Deferred Write Error Flag is now %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|NewEnquiry-&gt;StatusFlags.DeferredWriteError
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewCriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewCriticalLogicalDriveCount
op_ne
id|OldCriticalLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;OfflineLogicalDriveCount
op_ne
id|OldEnquiry-&gt;OfflineLogicalDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;DeadDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;DeadDriveCount
op_ne
id|OldEnquiry-&gt;DeadDriveCount
)paren
op_logical_or
(paren
id|NewEnquiry-&gt;EventLogSequenceNumber
op_ne
id|OldEnquiry-&gt;EventLogSequenceNumber
)paren
op_logical_or
id|Controller-&gt;MonitoringTimerCount
op_eq
l_int|0
op_logical_or
(paren
id|jiffies
op_minus
id|Controller-&gt;SecondaryMonitoringTime
op_ge
id|DAC960_SecondaryMonitoringInterval
)paren
)paren
(brace
id|Controller-&gt;V1.NeedLogicalDriveInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NewEventLogSequenceNumber
op_assign
id|NewEnquiry-&gt;EventLogSequenceNumber
suffix:semicolon
id|Controller-&gt;V1.NeedErrorTableInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceStateInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.StartDeviceStateScan
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NeedBackgroundInitializationStatus
op_assign
id|Controller-&gt;V1.BackgroundInitializationStatusSupported
suffix:semicolon
id|Controller-&gt;SecondaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_StandbyRebuildInProgress
op_logical_or
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_StandbyRebuildInProgress
op_logical_or
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundRebuildInProgress
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.RebuildProgressFirst
op_assign
(paren
id|NewEnquiry-&gt;CriticalLogicalDriveCount
OL
id|OldEnquiry-&gt;CriticalLogicalDriveCount
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|OldEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundCheckInProgress
)paren
r_switch
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
)paren
(brace
r_case
id|DAC960_V1_NoStandbyRebuildOrCheckInProgress
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_StandbyRebuildInProgress
suffix:colon
r_case
id|DAC960_V1_BackgroundRebuildInProgress
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundCheckInProgress
suffix:colon
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_StandbyRebuildCompletedWithError
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Completed with Error&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_DriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Physical Device Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_LogicalDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Logical Drive Failed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckFailed_OtherCauses
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Failed - Other Causes&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundRebuildOrCheckSuccessfullyTerminated
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check Successfully Terminated&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
op_eq
id|DAC960_V1_BackgroundCheckInProgress
)paren
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;MonitoringAlertMode
op_assign
(paren
id|NewEnquiry-&gt;CriticalLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;OfflineLogicalDriveCount
OG
l_int|0
op_logical_or
id|NewEnquiry-&gt;DeadDriveCount
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewEnquiry-&gt;RebuildFlag
OG
id|DAC960_V1_BackgroundCheckInProgress
)paren
(brace
id|Controller-&gt;V1.PendingRebuildFlag
op_assign
id|NewEnquiry-&gt;RebuildFlag
suffix:semicolon
id|Controller-&gt;V1.RebuildFlagPending
op_assign
l_bool|true
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.Enquiry
comma
op_amp
id|Controller-&gt;V1.NewEnquiry
comma
r_sizeof
(paren
id|DAC960_V1_Enquiry_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_PerformEventLogOperation
)paren
(brace
r_static
r_char
op_star
id|DAC960_EventMessages
(braket
)braket
op_assign
(brace
l_string|&quot;killed because write recovery failed&quot;
comma
l_string|&quot;killed because of SCSI bus reset failure&quot;
comma
l_string|&quot;killed because of double check condition&quot;
comma
l_string|&quot;killed because it was removed&quot;
comma
l_string|&quot;killed because of gross error on SCSI chip&quot;
comma
l_string|&quot;killed because of bad tag returned from drive&quot;
comma
l_string|&quot;killed because of timeout on SCSI command&quot;
comma
l_string|&quot;killed because of reset SCSI command issued from system&quot;
comma
l_string|&quot;killed because busy or parity error count exceeded limit&quot;
comma
l_string|&quot;killed because of &squot;kill drive&squot; command from system&quot;
comma
l_string|&quot;killed because of selection timeout&quot;
comma
l_string|&quot;killed due to SCSI phase sequence error&quot;
comma
l_string|&quot;killed due to unknown status&quot;
)brace
suffix:semicolon
id|DAC960_V1_EventLogEntry_T
op_star
id|EventLogEntry
op_assign
id|Controller-&gt;V1.EventLogEntry
suffix:semicolon
r_if
c_cond
(paren
id|EventLogEntry-&gt;SequenceNumber
op_eq
id|Controller-&gt;V1.OldEventLogSequenceNumber
)paren
(brace
r_int
r_char
id|SenseKey
op_assign
id|EventLogEntry-&gt;SenseKey
suffix:semicolon
r_int
r_char
id|AdditionalSenseCode
op_assign
id|EventLogEntry-&gt;AdditionalSenseCode
suffix:semicolon
r_int
r_char
id|AdditionalSenseCodeQualifier
op_assign
id|EventLogEntry-&gt;AdditionalSenseCodeQualifier
suffix:semicolon
r_if
c_cond
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_VendorSpecific
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x80
op_logical_and
id|AdditionalSenseCodeQualifier
OL
r_sizeof
(paren
id|DAC960_EventMessages
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|DAC960_EventMessages
(braket
id|AdditionalSenseCodeQualifier
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_UnitAttention
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x29
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;MonitoringTimerCount
OG
l_int|0
)paren
id|Controller-&gt;V1.DeviceResetCount
(braket
id|EventLogEntry-&gt;Channel
)braket
(braket
id|EventLogEntry-&gt;TargetID
)braket
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_NoSense
op_logical_or
(paren
id|SenseKey
op_eq
id|DAC960_SenseKey_NotReady
op_logical_and
id|AdditionalSenseCode
op_eq
l_int|0x04
op_logical_and
(paren
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x01
op_logical_or
id|AdditionalSenseCodeQualifier
op_eq
l_int|0x02
)paren
)paren
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Error Log: &quot;
l_string|&quot;Sense Key = %X, ASC = %02X, ASCQ = %02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|SenseKey
comma
id|AdditionalSenseCode
comma
id|AdditionalSenseCodeQualifier
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Error Log: &quot;
l_string|&quot;Information = %02X%02X%02X%02X &quot;
l_string|&quot;%02X%02X%02X%02X&bslash;n&quot;
comma
id|Controller
comma
id|EventLogEntry-&gt;Channel
comma
id|EventLogEntry-&gt;TargetID
comma
id|EventLogEntry-&gt;Information
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;Information
(braket
l_int|3
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|0
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|1
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|2
)braket
comma
id|EventLogEntry-&gt;CommandSpecificInformation
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
)brace
id|Controller-&gt;V1.OldEventLogSequenceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetErrorTable
)paren
(brace
id|DAC960_V1_ErrorTable_T
op_star
id|OldErrorTable
op_assign
op_amp
id|Controller-&gt;V1.ErrorTable
suffix:semicolon
id|DAC960_V1_ErrorTable_T
op_star
id|NewErrorTable
op_assign
id|Controller-&gt;V1.NewErrorTable
suffix:semicolon
r_int
id|Channel
comma
id|TargetID
suffix:semicolon
r_for
c_loop
(paren
id|Channel
op_assign
l_int|0
suffix:semicolon
id|Channel
OL
id|Controller-&gt;Channels
suffix:semicolon
id|Channel
op_increment
)paren
r_for
c_loop
(paren
id|TargetID
op_assign
l_int|0
suffix:semicolon
id|TargetID
OL
id|Controller-&gt;Targets
suffix:semicolon
id|TargetID
op_increment
)paren
(brace
id|DAC960_V1_ErrorTableEntry_T
op_star
id|NewErrorEntry
op_assign
op_amp
id|NewErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
id|DAC960_V1_ErrorTableEntry_T
op_star
id|OldErrorEntry
op_assign
op_amp
id|OldErrorTable-&gt;ErrorTableEntries
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewErrorEntry-&gt;ParityErrorCount
op_ne
id|OldErrorEntry-&gt;ParityErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;SoftErrorCount
op_ne
id|OldErrorEntry-&gt;SoftErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;HardErrorCount
op_ne
id|OldErrorEntry-&gt;HardErrorCount
)paren
op_logical_or
(paren
id|NewErrorEntry-&gt;MiscErrorCount
op_ne
id|OldErrorEntry-&gt;MiscErrorCount
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Parity = %d, Soft = %d, &quot;
l_string|&quot;Hard = %d, Misc = %d&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|NewErrorEntry-&gt;ParityErrorCount
comma
id|NewErrorEntry-&gt;SoftErrorCount
comma
id|NewErrorEntry-&gt;HardErrorCount
comma
id|NewErrorEntry-&gt;MiscErrorCount
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.ErrorTable
comma
id|Controller-&gt;V1.NewErrorTable
comma
r_sizeof
(paren
id|DAC960_V1_ErrorTable_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetDeviceState
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|OldDeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
id|DAC960_V1_DeviceState_T
op_star
id|NewDeviceState
op_assign
id|Controller-&gt;V1.NewDeviceState
suffix:semicolon
r_if
c_cond
(paren
id|NewDeviceState-&gt;DeviceState
op_ne
id|OldDeviceState-&gt;DeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d is now %s&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;V1.DeviceStateChannel
comma
id|Controller-&gt;V1.DeviceStateTargetID
comma
(paren
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
ques
c_cond
l_string|&quot;DEAD&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_WriteOnly
ques
c_cond
l_string|&quot;WRITE-ONLY&quot;
suffix:colon
id|NewDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
l_string|&quot;STANDBY&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|OldDeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
op_logical_and
id|NewDeviceState-&gt;DeviceState
op_ne
id|DAC960_V1_Device_Dead
)paren
(brace
id|Controller-&gt;V1.NeedDeviceInquiryInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V1.DeviceResetCount
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|OldDeviceState
comma
id|NewDeviceState
comma
r_sizeof
(paren
id|DAC960_V1_DeviceState_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetLogicalDriveInformation
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|Controller-&gt;LogicalDriveCount
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|OldLogicalDriveInformation
op_assign
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
id|DAC960_V1_LogicalDriveInformation_T
op_star
id|NewLogicalDriveInformation
op_assign
op_amp
(paren
op_star
id|Controller-&gt;V1.NewLogicalDriveInformation
)paren
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_ne
id|OldLogicalDriveInformation-&gt;LogicalDriveState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewLogicalDriveInformation-&gt;LogicalDriveState
op_eq
id|DAC960_V1_LogicalDrive_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
l_string|&quot;OFFLINE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
op_ne
id|OldLogicalDriveInformation-&gt;WriteBack
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|NewLogicalDriveInformation-&gt;WriteBack
ques
c_cond
l_string|&quot;WRITE BACK&quot;
suffix:colon
l_string|&quot;WRITE THRU&quot;
)paren
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.LogicalDriveInformation
comma
id|Controller-&gt;V1.NewLogicalDriveInformation
comma
r_sizeof
(paren
id|DAC960_V1_LogicalDriveInformationArray_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_GetRebuildProgress
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;V1.RebuildProgress-&gt;LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;V1.RebuildProgress-&gt;LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;V1.RebuildProgress-&gt;RemainingBlocks
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NoRebuildOrCheckInProgress
op_logical_and
id|Controller-&gt;V1.LastRebuildStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
id|CommandStatus
op_assign
id|DAC960_V1_RebuildSuccessful
suffix:semicolon
r_switch
c_cond
(paren
id|CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_LogicalDriveFailure
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Logical Drive Failure&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_BadBlocksOnOther
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Bad Blocks on Other Drives&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildFailed_NewDriveFailed
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Failed due to &quot;
l_string|&quot;Failure of Drive Being Rebuilt&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NoRebuildOrCheckInProgress
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildSuccessful
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildSuccessfullyTerminated
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Rebuild Successfully Terminated&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|Controller-&gt;V1.LastRebuildStatus
op_assign
id|CommandStatus
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_ne
id|DAC960_MonitoringCommand
op_logical_and
id|Controller-&gt;V1.RebuildStatusPending
)paren
(brace
id|Command-&gt;V1.CommandStatus
op_assign
id|Controller-&gt;V1.PendingRebuildStatus
suffix:semicolon
id|Controller-&gt;V1.RebuildStatusPending
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
op_logical_and
id|CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
op_logical_and
id|CommandStatus
op_ne
id|DAC960_V1_NoRebuildOrCheckInProgress
)paren
(brace
id|Controller-&gt;V1.PendingRebuildStatus
op_assign
id|CommandStatus
suffix:semicolon
id|Controller-&gt;V1.RebuildStatusPending
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_RebuildStat
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;V1.RebuildProgress-&gt;LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;V1.RebuildProgress-&gt;LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|LogicalDriveSize
op_minus
id|Controller-&gt;V1.RebuildProgress-&gt;RemainingBlocks
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V1_NormalCompletion
)paren
(brace
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Consistency Check in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_BackgroundInitializationControl
)paren
(brace
r_int
r_int
id|LogicalDriveNumber
op_assign
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDriveSize
op_assign
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;LogicalDriveSize
suffix:semicolon
r_int
r_int
id|BlocksCompleted
op_assign
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;BlocksCompleted
suffix:semicolon
r_switch
c_cond
(paren
id|CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
r_switch
c_cond
(paren
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;Status
)paren
(brace
r_case
id|DAC960_V1_BackgroundInitializationInvalid
suffix:colon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitializationStarted
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization Started&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitializationInProgress
suffix:colon
r_if
c_cond
(paren
id|BlocksCompleted
op_eq
id|Controller-&gt;V1.LastBackgroundInitializationStatus
dot
id|BlocksCompleted
op_logical_and
id|LogicalDriveNumber
op_eq
id|Controller-&gt;V1.LastBackgroundInitializationStatus
dot
id|LogicalDriveNumber
)paren
r_break
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization in Progress: &quot;
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDriveSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitializationSuspended
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization Suspended&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitializationCancelled
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization Cancelled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|Controller-&gt;V1.LastBackgroundInitializationStatus
comma
id|Controller-&gt;V1.BackgroundInitializationStatus
comma
r_sizeof
(paren
id|DAC960_V1_BackgroundInitializationStatus_T
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitSuccessful
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;Status
op_eq
id|DAC960_V1_BackgroundInitializationInProgress
)paren
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization &quot;
l_string|&quot;Completed Successfully&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;Status
op_assign
id|DAC960_V1_BackgroundInitializationInvalid
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_BackgroundInitAborted
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;Status
op_eq
id|DAC960_V1_BackgroundInitializationInProgress
)paren
id|DAC960_Progress
c_func
(paren
l_string|&quot;Background Initialization Aborted&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
id|Controller-&gt;V1.BackgroundInitializationStatus-&gt;Status
op_assign
id|DAC960_V1_BackgroundInitializationInvalid
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NoBackgroundInitInProgress
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
multiline_comment|/*&n;&t;     This is a bit ugly.&n;&n;&t;     The InquiryStandardData and &n;&t;     the InquiryUntitSerialNumber information&n;&t;     retrieval operations BOTH use the DAC960_V1_DCDB&n;&t;     commands.  the test above can&squot;t distinguish between&n;&t;     these two cases.&n;&n;&t;     Instead, we rely on the order of code later in this&n;             function to ensure that DeviceInquiryInformation commands&n;             are submitted before DeviceSerialNumber commands.&n;&t;   */
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceInquiryInformation
)paren
(brace
id|DAC960_SCSI_Inquiry_T
op_star
id|InquiryStandardData
op_assign
op_amp
id|Controller-&gt;V1.InquiryStandardData
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
(brace
id|memset
c_func
(paren
id|InquiryStandardData
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
)paren
suffix:semicolon
id|InquiryStandardData-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryStandardData
comma
id|Controller-&gt;V1.NewInquiryStandardData
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
)paren
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceInquiryInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
op_amp
id|Controller-&gt;V1.InquiryUnitSerialNumber
(braket
id|Controller-&gt;V1.DeviceStateChannel
)braket
(braket
id|Controller-&gt;V1.DeviceStateTargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V1_NormalCompletion
)paren
(brace
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryUnitSerialNumber
comma
id|Controller-&gt;V1.NewInquiryUnitSerialNumber
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
op_assign
l_bool|false
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;        Begin submitting new monitoring commands.&n;       */
r_if
c_cond
(paren
id|Controller-&gt;V1.NewEventLogSequenceNumber
op_minus
id|Controller-&gt;V1.OldEventLogSequenceNumber
OG
l_int|0
)paren
(brace
id|Command-&gt;V1.CommandMailbox.Type3E.CommandOpcode
op_assign
id|DAC960_V1_PerformEventLogOperation
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.OperationType
op_assign
id|DAC960_V1_GetEventLogEntry
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.OperationQualifier
op_assign
l_int|1
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.SequenceNumber
op_assign
id|Controller-&gt;V1.OldEventLogSequenceNumber
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3E.BusAddress
op_assign
id|Controller-&gt;V1.EventLogEntryDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedErrorTableInformation
)paren
(brace
id|Controller-&gt;V1.NeedErrorTableInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetErrorTable
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Controller-&gt;V1.NewErrorTableDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedRebuildProgress
op_logical_and
id|Controller-&gt;V1.RebuildProgressFirst
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetRebuildProgress
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Controller-&gt;V1.RebuildProgressDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceStateInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceInquiryInformation
)paren
(brace
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
id|Controller-&gt;V1.MonitoringDCDB
suffix:semicolon
id|dma_addr_t
id|DCDB_DMA
op_assign
id|Controller-&gt;V1.MonitoringDCDB_DMA
suffix:semicolon
id|dma_addr_t
id|NewInquiryStandardDataDMA
op_assign
id|Controller-&gt;V1.NewInquiryStandardDataDMA
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|DCDB_DMA
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|NewInquiryStandardDataDMA
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* EVPD = 0 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_V1_DCDB_T
op_star
id|DCDB
op_assign
id|Controller-&gt;V1.MonitoringDCDB
suffix:semicolon
id|dma_addr_t
id|DCDB_DMA
op_assign
id|Controller-&gt;V1.MonitoringDCDB_DMA
suffix:semicolon
id|dma_addr_t
id|NewInquiryUnitSerialNumberDMA
op_assign
id|Controller-&gt;V1.NewInquiryUnitSerialNumberDMA
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_DCDB
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|DCDB_DMA
suffix:semicolon
id|DCDB-&gt;Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|DCDB-&gt;TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|DCDB-&gt;Direction
op_assign
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
suffix:semicolon
id|DCDB-&gt;EarlyStatus
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;Timeout
op_assign
id|DAC960_V1_DCDB_Timeout_10_seconds
suffix:semicolon
id|DCDB-&gt;NoAutomaticRequestSense
op_assign
l_bool|false
suffix:semicolon
id|DCDB-&gt;DisconnectPermitted
op_assign
l_bool|true
suffix:semicolon
id|DCDB-&gt;TransferLength
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;BusAddress
op_assign
id|NewInquiryUnitSerialNumberDMA
suffix:semicolon
id|DCDB-&gt;CDBLength
op_assign
l_int|6
suffix:semicolon
id|DCDB-&gt;TransferLengthHigh4
op_assign
l_int|0
suffix:semicolon
id|DCDB-&gt;SenseLength
op_assign
r_sizeof
(paren
id|DCDB-&gt;SenseData
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|0
)braket
op_assign
l_int|0x12
suffix:semicolon
multiline_comment|/* INQUIRY */
id|DCDB-&gt;CDB
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* EVPD = 1 */
id|DCDB-&gt;CDB
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Page Code */
id|DCDB-&gt;CDB
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Reserved */
id|DCDB-&gt;CDB
(braket
l_int|4
)braket
op_assign
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
suffix:semicolon
id|DCDB-&gt;CDB
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Control */
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.StartDeviceStateScan
)paren
(brace
id|Controller-&gt;V1.DeviceStateChannel
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V1.DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V1.StartDeviceStateScan
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_increment
id|Controller-&gt;V1.DeviceStateTargetID
op_eq
id|Controller-&gt;Targets
)paren
(brace
id|Controller-&gt;V1.DeviceStateChannel
op_increment
suffix:semicolon
id|Controller-&gt;V1.DeviceStateTargetID
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.DeviceStateChannel
OL
id|Controller-&gt;Channels
)paren
(brace
id|Controller-&gt;V1.NewDeviceState-&gt;DeviceState
op_assign
id|DAC960_V1_Device_Dead
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.CommandOpcode
op_assign
id|DAC960_V1_GetDeviceState
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.Channel
op_assign
id|Controller-&gt;V1.DeviceStateChannel
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.TargetID
op_assign
id|Controller-&gt;V1.DeviceStateTargetID
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3D.BusAddress
op_assign
id|Controller-&gt;V1.NewDeviceStateDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;V1.NeedDeviceStateInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedLogicalDriveInformation
)paren
(brace
id|Controller-&gt;V1.NeedLogicalDriveInformation
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetLogicalDriveInformation
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Controller-&gt;V1.NewLogicalDriveInformationDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedRebuildProgress
)paren
(brace
id|Controller-&gt;V1.NeedRebuildProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_GetRebuildProgress
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Controller-&gt;V1.RebuildProgressDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedConsistencyCheckProgress
)paren
(brace
id|Controller-&gt;V1.NeedConsistencyCheckProgress
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.CommandOpcode
op_assign
id|DAC960_V1_RebuildStat
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|Controller-&gt;V1.RebuildProgressDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V1.NeedBackgroundInitializationStatus
)paren
(brace
id|Controller-&gt;V1.NeedBackgroundInitializationStatus
op_assign
l_bool|false
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3B.CommandOpcode
op_assign
id|DAC960_V1_BackgroundInitializationControl
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3B.CommandOpcode2
op_assign
l_int|0x20
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3B.BusAddress
op_assign
id|Controller-&gt;V1.BackgroundInitializationStatusDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;MonitoringTimerCount
op_increment
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_MonitoringTimerInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ImmediateCommand
)paren
(brace
id|complete
c_func
(paren
id|Command-&gt;Completion
)paren
suffix:semicolon
id|Command-&gt;Completion
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_QueuedCommand
)paren
(brace
id|DAC960_V1_KernelCommand_T
op_star
id|KernelCommand
op_assign
id|Command-&gt;V1.KernelCommand
suffix:semicolon
id|KernelCommand-&gt;CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|Command-&gt;V1.KernelCommand
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
id|Controller-&gt;V1.DirectCommandActive
(braket
id|KernelCommand-&gt;DCDB-&gt;Channel
)braket
(braket
id|KernelCommand-&gt;DCDB-&gt;TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|KernelCommand
op_member_access_from_pointer
id|CompletionFunction
c_func
(paren
id|KernelCommand
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Queue a Status Monitoring Command to the Controller using the just&n;    completed Command if one was deferred previously due to lack of a&n;    free Command when the Monitoring Timer Function was called.&n;  */
r_if
c_cond
(paren
id|Controller-&gt;MonitoringCommandDeferred
)paren
(brace
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Deallocate the Command.&n;  */
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;    Wake up any processes waiting on a free Command.&n;  */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReadWriteError prints an appropriate error message for Command&n;  when an error occurs on a Read or Write operation.&n;*/
DECL|function|DAC960_V2_ReadWriteError
r_static
r_void
id|DAC960_V2_ReadWriteError
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
r_int
r_char
op_star
id|SenseErrors
(braket
)braket
op_assign
(brace
l_string|&quot;NO SENSE&quot;
comma
l_string|&quot;RECOVERED ERROR&quot;
comma
l_string|&quot;NOT READY&quot;
comma
l_string|&quot;MEDIUM ERROR&quot;
comma
l_string|&quot;HARDWARE ERROR&quot;
comma
l_string|&quot;ILLEGAL REQUEST&quot;
comma
l_string|&quot;UNIT ATTENTION&quot;
comma
l_string|&quot;DATA PROTECT&quot;
comma
l_string|&quot;BLANK CHECK&quot;
comma
l_string|&quot;VENDOR-SPECIFIC&quot;
comma
l_string|&quot;COPY ABORTED&quot;
comma
l_string|&quot;ABORTED COMMAND&quot;
comma
l_string|&quot;EQUAL&quot;
comma
l_string|&quot;VOLUME OVERFLOW&quot;
comma
l_string|&quot;MISCOMPARE&quot;
comma
l_string|&quot;RESERVED&quot;
)brace
suffix:semicolon
r_int
r_char
op_star
id|CommandName
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;CommandType
)paren
(brace
r_case
id|DAC960_ReadCommand
suffix:colon
r_case
id|DAC960_ReadRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;READ&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_WriteCommand
suffix:colon
r_case
id|DAC960_WriteRetryCommand
suffix:colon
id|CommandName
op_assign
l_string|&quot;WRITE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_MonitoringCommand
suffix:colon
r_case
id|DAC960_ImmediateCommand
suffix:colon
r_case
id|DAC960_QueuedCommand
suffix:colon
r_break
suffix:semicolon
)brace
id|DAC960_Error
c_func
(paren
l_string|&quot;Error Condition %s on %s:&bslash;n&quot;
comma
id|Controller
comma
id|SenseErrors
(braket
id|Command-&gt;V2.RequestSense-&gt;SenseKey
)braket
comma
id|CommandName
)paren
suffix:semicolon
id|DAC960_Error
c_func
(paren
l_string|&quot;  /dev/rd/c%dd%d:   absolute blocks %u..%u&bslash;n&quot;
comma
id|Controller
comma
id|Controller-&gt;ControllerNumber
comma
id|Command-&gt;LogicalDriveNumber
comma
id|Command-&gt;BlockNumber
comma
id|Command-&gt;BlockNumber
op_plus
id|Command-&gt;BlockCount
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ReportEvent prints an appropriate message when a Controller Event&n;  occurs.&n;*/
DECL|function|DAC960_V2_ReportEvent
r_static
r_void
id|DAC960_V2_ReportEvent
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_V2_Event_T
op_star
id|Event
)paren
(brace
id|DAC960_SCSI_RequestSense_T
op_star
id|RequestSense
op_assign
(paren
id|DAC960_SCSI_RequestSense_T
op_star
)paren
op_amp
id|Event-&gt;RequestSenseData
suffix:semicolon
r_int
r_char
id|MessageBuffer
(braket
id|DAC960_LineBufferSize
)braket
suffix:semicolon
r_static
r_struct
(brace
r_int
id|EventCode
suffix:semicolon
r_int
r_char
op_star
id|EventMessage
suffix:semicolon
)brace
id|EventList
(braket
)braket
op_assign
(brace
multiline_comment|/* Physical Device Events (0x0000 - 0x007F) */
(brace
l_int|0x0001
comma
l_string|&quot;P Online&quot;
)brace
comma
(brace
l_int|0x0002
comma
l_string|&quot;P Standby&quot;
)brace
comma
(brace
l_int|0x0005
comma
l_string|&quot;P Automatic Rebuild Started&quot;
)brace
comma
(brace
l_int|0x0006
comma
l_string|&quot;P Manual Rebuild Started&quot;
)brace
comma
(brace
l_int|0x0007
comma
l_string|&quot;P Rebuild Completed&quot;
)brace
comma
(brace
l_int|0x0008
comma
l_string|&quot;P Rebuild Cancelled&quot;
)brace
comma
(brace
l_int|0x0009
comma
l_string|&quot;P Rebuild Failed for Unknown Reasons&quot;
)brace
comma
(brace
l_int|0x000A
comma
l_string|&quot;P Rebuild Failed due to New Physical Device&quot;
)brace
comma
(brace
l_int|0x000B
comma
l_string|&quot;P Rebuild Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x000C
comma
l_string|&quot;S Offline&quot;
)brace
comma
(brace
l_int|0x000D
comma
l_string|&quot;P Found&quot;
)brace
comma
(brace
l_int|0x000E
comma
l_string|&quot;P Removed&quot;
)brace
comma
(brace
l_int|0x000F
comma
l_string|&quot;P Unconfigured&quot;
)brace
comma
(brace
l_int|0x0010
comma
l_string|&quot;P Expand Capacity Started&quot;
)brace
comma
(brace
l_int|0x0011
comma
l_string|&quot;P Expand Capacity Completed&quot;
)brace
comma
(brace
l_int|0x0012
comma
l_string|&quot;P Expand Capacity Failed&quot;
)brace
comma
(brace
l_int|0x0013
comma
l_string|&quot;P Command Timed Out&quot;
)brace
comma
(brace
l_int|0x0014
comma
l_string|&quot;P Command Aborted&quot;
)brace
comma
(brace
l_int|0x0015
comma
l_string|&quot;P Command Retried&quot;
)brace
comma
(brace
l_int|0x0016
comma
l_string|&quot;P Parity Error&quot;
)brace
comma
(brace
l_int|0x0017
comma
l_string|&quot;P Soft Error&quot;
)brace
comma
(brace
l_int|0x0018
comma
l_string|&quot;P Miscellaneous Error&quot;
)brace
comma
(brace
l_int|0x0019
comma
l_string|&quot;P Reset&quot;
)brace
comma
(brace
l_int|0x001A
comma
l_string|&quot;P Active Spare Found&quot;
)brace
comma
(brace
l_int|0x001B
comma
l_string|&quot;P Warm Spare Found&quot;
)brace
comma
(brace
l_int|0x001C
comma
l_string|&quot;S Sense Data Received&quot;
)brace
comma
(brace
l_int|0x001D
comma
l_string|&quot;P Initialization Started&quot;
)brace
comma
(brace
l_int|0x001E
comma
l_string|&quot;P Initialization Completed&quot;
)brace
comma
(brace
l_int|0x001F
comma
l_string|&quot;P Initialization Failed&quot;
)brace
comma
(brace
l_int|0x0020
comma
l_string|&quot;P Initialization Cancelled&quot;
)brace
comma
(brace
l_int|0x0021
comma
l_string|&quot;P Failed because Write Recovery Failed&quot;
)brace
comma
(brace
l_int|0x0022
comma
l_string|&quot;P Failed because SCSI Bus Reset Failed&quot;
)brace
comma
(brace
l_int|0x0023
comma
l_string|&quot;P Failed because of Double Check Condition&quot;
)brace
comma
(brace
l_int|0x0024
comma
l_string|&quot;P Failed because Device Cannot Be Accessed&quot;
)brace
comma
(brace
l_int|0x0025
comma
l_string|&quot;P Failed because of Gross Error on SCSI Processor&quot;
)brace
comma
(brace
l_int|0x0026
comma
l_string|&quot;P Failed because of Bad Tag from Device&quot;
)brace
comma
(brace
l_int|0x0027
comma
l_string|&quot;P Failed because of Command Timeout&quot;
)brace
comma
(brace
l_int|0x0028
comma
l_string|&quot;P Failed because of System Reset&quot;
)brace
comma
(brace
l_int|0x0029
comma
l_string|&quot;P Failed because of Busy Status or Parity Error&quot;
)brace
comma
(brace
l_int|0x002A
comma
l_string|&quot;P Failed because Host Set Device to Failed State&quot;
)brace
comma
(brace
l_int|0x002B
comma
l_string|&quot;P Failed because of Selection Timeout&quot;
)brace
comma
(brace
l_int|0x002C
comma
l_string|&quot;P Failed because of SCSI Bus Phase Error&quot;
)brace
comma
(brace
l_int|0x002D
comma
l_string|&quot;P Failed because Device Returned Unknown Status&quot;
)brace
comma
(brace
l_int|0x002E
comma
l_string|&quot;P Failed because Device Not Ready&quot;
)brace
comma
(brace
l_int|0x002F
comma
l_string|&quot;P Failed because Device Not Found at Startup&quot;
)brace
comma
(brace
l_int|0x0030
comma
l_string|&quot;P Failed because COD Write Operation Failed&quot;
)brace
comma
(brace
l_int|0x0031
comma
l_string|&quot;P Failed because BDT Write Operation Failed&quot;
)brace
comma
(brace
l_int|0x0039
comma
l_string|&quot;P Missing at Startup&quot;
)brace
comma
(brace
l_int|0x003A
comma
l_string|&quot;P Start Rebuild Failed due to Physical Drive Too Small&quot;
)brace
comma
(brace
l_int|0x003C
comma
l_string|&quot;P Temporarily Offline Device Automatically Made Online&quot;
)brace
comma
(brace
l_int|0x003D
comma
l_string|&quot;P Standby Rebuild Started&quot;
)brace
comma
multiline_comment|/* Logical Device Events (0x0080 - 0x00FF) */
(brace
l_int|0x0080
comma
l_string|&quot;M Consistency Check Started&quot;
)brace
comma
(brace
l_int|0x0081
comma
l_string|&quot;M Consistency Check Completed&quot;
)brace
comma
(brace
l_int|0x0082
comma
l_string|&quot;M Consistency Check Cancelled&quot;
)brace
comma
(brace
l_int|0x0083
comma
l_string|&quot;M Consistency Check Completed With Errors&quot;
)brace
comma
(brace
l_int|0x0084
comma
l_string|&quot;M Consistency Check Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x0085
comma
l_string|&quot;M Consistency Check Failed due to Physical Device Failure&quot;
)brace
comma
(brace
l_int|0x0086
comma
l_string|&quot;L Offline&quot;
)brace
comma
(brace
l_int|0x0087
comma
l_string|&quot;L Critical&quot;
)brace
comma
(brace
l_int|0x0088
comma
l_string|&quot;L Online&quot;
)brace
comma
(brace
l_int|0x0089
comma
l_string|&quot;M Automatic Rebuild Started&quot;
)brace
comma
(brace
l_int|0x008A
comma
l_string|&quot;M Manual Rebuild Started&quot;
)brace
comma
(brace
l_int|0x008B
comma
l_string|&quot;M Rebuild Completed&quot;
)brace
comma
(brace
l_int|0x008C
comma
l_string|&quot;M Rebuild Cancelled&quot;
)brace
comma
(brace
l_int|0x008D
comma
l_string|&quot;M Rebuild Failed for Unknown Reasons&quot;
)brace
comma
(brace
l_int|0x008E
comma
l_string|&quot;M Rebuild Failed due to New Physical Device&quot;
)brace
comma
(brace
l_int|0x008F
comma
l_string|&quot;M Rebuild Failed due to Logical Drive Failure&quot;
)brace
comma
(brace
l_int|0x0090
comma
l_string|&quot;M Initialization Started&quot;
)brace
comma
(brace
l_int|0x0091
comma
l_string|&quot;M Initialization Completed&quot;
)brace
comma
(brace
l_int|0x0092
comma
l_string|&quot;M Initialization Cancelled&quot;
)brace
comma
(brace
l_int|0x0093
comma
l_string|&quot;M Initialization Failed&quot;
)brace
comma
(brace
l_int|0x0094
comma
l_string|&quot;L Found&quot;
)brace
comma
(brace
l_int|0x0095
comma
l_string|&quot;L Deleted&quot;
)brace
comma
(brace
l_int|0x0096
comma
l_string|&quot;M Expand Capacity Started&quot;
)brace
comma
(brace
l_int|0x0097
comma
l_string|&quot;M Expand Capacity Completed&quot;
)brace
comma
(brace
l_int|0x0098
comma
l_string|&quot;M Expand Capacity Failed&quot;
)brace
comma
(brace
l_int|0x0099
comma
l_string|&quot;L Bad Block Found&quot;
)brace
comma
(brace
l_int|0x009A
comma
l_string|&quot;L Size Changed&quot;
)brace
comma
(brace
l_int|0x009B
comma
l_string|&quot;L Type Changed&quot;
)brace
comma
(brace
l_int|0x009C
comma
l_string|&quot;L Bad Data Block Found&quot;
)brace
comma
(brace
l_int|0x009E
comma
l_string|&quot;L Read of Data Block in BDT&quot;
)brace
comma
(brace
l_int|0x009F
comma
l_string|&quot;L Write Back Data for Disk Block Lost&quot;
)brace
comma
(brace
l_int|0x00A0
comma
l_string|&quot;L Temporarily Offline RAID-5/3 Drive Made Online&quot;
)brace
comma
(brace
l_int|0x00A1
comma
l_string|&quot;L Temporarily Offline RAID-6/1/0/7 Drive Made Online&quot;
)brace
comma
(brace
l_int|0x00A2
comma
l_string|&quot;L Standby Rebuild Started&quot;
)brace
comma
multiline_comment|/* Fault Management Events (0x0100 - 0x017F) */
(brace
l_int|0x0140
comma
l_string|&quot;E Fan %d Failed&quot;
)brace
comma
(brace
l_int|0x0141
comma
l_string|&quot;E Fan %d OK&quot;
)brace
comma
(brace
l_int|0x0142
comma
l_string|&quot;E Fan %d Not Present&quot;
)brace
comma
(brace
l_int|0x0143
comma
l_string|&quot;E Power Supply %d Failed&quot;
)brace
comma
(brace
l_int|0x0144
comma
l_string|&quot;E Power Supply %d OK&quot;
)brace
comma
(brace
l_int|0x0145
comma
l_string|&quot;E Power Supply %d Not Present&quot;
)brace
comma
(brace
l_int|0x0146
comma
l_string|&quot;E Temperature Sensor %d Temperature Exceeds Safe Limit&quot;
)brace
comma
(brace
l_int|0x0147
comma
l_string|&quot;E Temperature Sensor %d Temperature Exceeds Working Limit&quot;
)brace
comma
(brace
l_int|0x0148
comma
l_string|&quot;E Temperature Sensor %d Temperature Normal&quot;
)brace
comma
(brace
l_int|0x0149
comma
l_string|&quot;E Temperature Sensor %d Not Present&quot;
)brace
comma
(brace
l_int|0x014A
comma
l_string|&quot;E Enclosure Management Unit %d Access Critical&quot;
)brace
comma
(brace
l_int|0x014B
comma
l_string|&quot;E Enclosure Management Unit %d Access OK&quot;
)brace
comma
(brace
l_int|0x014C
comma
l_string|&quot;E Enclosure Management Unit %d Access Offline&quot;
)brace
comma
multiline_comment|/* Controller Events (0x0180 - 0x01FF) */
(brace
l_int|0x0181
comma
l_string|&quot;C Cache Write Back Error&quot;
)brace
comma
(brace
l_int|0x0188
comma
l_string|&quot;C Battery Backup Unit Found&quot;
)brace
comma
(brace
l_int|0x0189
comma
l_string|&quot;C Battery Backup Unit Charge Level Low&quot;
)brace
comma
(brace
l_int|0x018A
comma
l_string|&quot;C Battery Backup Unit Charge Level OK&quot;
)brace
comma
(brace
l_int|0x0193
comma
l_string|&quot;C Installation Aborted&quot;
)brace
comma
(brace
l_int|0x0195
comma
l_string|&quot;C Battery Backup Unit Physically Removed&quot;
)brace
comma
(brace
l_int|0x0196
comma
l_string|&quot;C Memory Error During Warm Boot&quot;
)brace
comma
(brace
l_int|0x019E
comma
l_string|&quot;C Memory Soft ECC Error Corrected&quot;
)brace
comma
(brace
l_int|0x019F
comma
l_string|&quot;C Memory Hard ECC Error Corrected&quot;
)brace
comma
(brace
l_int|0x01A2
comma
l_string|&quot;C Battery Backup Unit Failed&quot;
)brace
comma
(brace
l_int|0x01AB
comma
l_string|&quot;C Mirror Race Recovery Failed&quot;
)brace
comma
(brace
l_int|0x01AC
comma
l_string|&quot;C Mirror Race on Critical Drive&quot;
)brace
comma
multiline_comment|/* Controller Internal Processor Events */
(brace
l_int|0x0380
comma
l_string|&quot;C Internal Controller Hung&quot;
)brace
comma
(brace
l_int|0x0381
comma
l_string|&quot;C Internal Controller Firmware Breakpoint&quot;
)brace
comma
(brace
l_int|0x0390
comma
l_string|&quot;C Internal Controller i960 Processor Specific Error&quot;
)brace
comma
(brace
l_int|0x03A0
comma
l_string|&quot;C Internal Controller StrongARM Processor Specific Error&quot;
)brace
comma
(brace
l_int|0
comma
l_string|&quot;&quot;
)brace
)brace
suffix:semicolon
r_int
id|EventListIndex
op_assign
l_int|0
comma
id|EventCode
suffix:semicolon
r_int
r_char
id|EventType
comma
op_star
id|EventMessage
suffix:semicolon
r_if
c_cond
(paren
id|Event-&gt;EventCode
op_eq
l_int|0x1C
op_logical_and
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_VendorSpecific
op_logical_and
(paren
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x80
op_logical_or
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x81
)paren
)paren
id|Event-&gt;EventCode
op_assign
(paren
(paren
id|RequestSense-&gt;AdditionalSenseCode
op_minus
l_int|0x80
)paren
op_lshift
l_int|8
)paren
op_or
id|RequestSense-&gt;AdditionalSenseCodeQualifier
suffix:semicolon
r_while
c_loop
(paren
l_bool|true
)paren
(brace
id|EventCode
op_assign
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventCode
suffix:semicolon
r_if
c_cond
(paren
id|EventCode
op_eq
id|Event-&gt;EventCode
op_logical_or
id|EventCode
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|EventListIndex
op_increment
suffix:semicolon
)brace
id|EventType
op_assign
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventMessage
(braket
l_int|0
)braket
suffix:semicolon
id|EventMessage
op_assign
op_amp
id|EventList
(braket
id|EventListIndex
)braket
dot
id|EventMessage
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|EventCode
op_eq
l_int|0
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Unknown Controller Event Code %04X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;EventCode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|EventType
)paren
(brace
r_case
l_char|&squot;P&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;LogicalUnit
comma
id|Controller-&gt;ControllerNumber
comma
id|Event-&gt;LogicalUnit
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|DAC960_Progress
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;LogicalUnit
comma
id|Controller-&gt;ControllerNumber
comma
id|Event-&gt;LogicalUnit
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;S&squot;
suffix:colon
r_if
c_cond
(paren
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_NoSense
op_logical_or
(paren
id|RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_NotReady
op_logical_and
id|RequestSense-&gt;AdditionalSenseCode
op_eq
l_int|0x04
op_logical_and
(paren
id|RequestSense-&gt;AdditionalSenseCodeQualifier
op_eq
l_int|0x01
op_logical_or
id|RequestSense-&gt;AdditionalSenseCodeQualifier
op_eq
l_int|0x02
)paren
)paren
)paren
r_break
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|EventMessage
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Request Sense: &quot;
l_string|&quot;Sense Key = %X, ASC = %02X, ASCQ = %02X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|RequestSense-&gt;SenseKey
comma
id|RequestSense-&gt;AdditionalSenseCode
comma
id|RequestSense-&gt;AdditionalSenseCodeQualifier
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Request Sense: &quot;
l_string|&quot;Information = %02X%02X%02X%02X &quot;
l_string|&quot;%02X%02X%02X%02X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;Channel
comma
id|Event-&gt;TargetID
comma
id|RequestSense-&gt;Information
(braket
l_int|0
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|1
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|2
)braket
comma
id|RequestSense-&gt;Information
(braket
l_int|3
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|0
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|1
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|2
)braket
comma
id|RequestSense-&gt;CommandSpecificInformation
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
id|Controller-&gt;SuppressEnclosureMessages
)paren
r_break
suffix:semicolon
id|sprintf
c_func
(paren
id|MessageBuffer
comma
id|EventMessage
comma
id|Event-&gt;LogicalUnit
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Enclosure %d %s&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;TargetID
comma
id|MessageBuffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Controller %s&bslash;n&quot;
comma
id|Controller
comma
id|EventMessage
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Unknown Controller Event Code %04X&bslash;n&quot;
comma
id|Controller
comma
id|Event-&gt;EventCode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_V2_ReportProgress prints an appropriate progress message for&n;  Logical Device Long Operations.&n;*/
DECL|function|DAC960_V2_ReportProgress
r_static
r_void
id|DAC960_V2_ReportProgress
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|MessageString
comma
r_int
r_int
id|LogicalDeviceNumber
comma
r_int
r_int
id|BlocksCompleted
comma
r_int
r_int
id|LogicalDeviceSize
)paren
(brace
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|true
suffix:semicolon
id|DAC960_Progress
c_func
(paren
l_string|&quot;%s in Progress: Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;%d%% completed&bslash;n&quot;
comma
id|Controller
comma
id|MessageString
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
l_int|100
op_star
(paren
id|BlocksCompleted
op_rshift
l_int|7
)paren
)paren
op_div
(paren
id|LogicalDeviceSize
op_rshift
l_int|7
)paren
)paren
suffix:semicolon
id|Controller-&gt;EphemeralProgressMessage
op_assign
l_bool|false
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ProcessCompletedCommand performs completion processing for Command&n;  for DAC960 V2 Firmware Controllers.&n;*/
DECL|function|DAC960_V2_ProcessCompletedCommand
r_static
r_void
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_CommandType_T
id|CommandType
op_assign
id|Command-&gt;CommandType
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_IOCTL_Opcode_T
id|CommandOpcode
op_assign
id|CommandMailbox-&gt;Common.IOCTL_Opcode
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteCommand
)paren
(brace
macro_line|#ifdef FORCE_RETRY_DEBUG
id|CommandStatus
op_assign
id|DAC960_V2_AbormalCompletion
suffix:semicolon
macro_line|#endif
id|Command-&gt;V2.RequestSense-&gt;SenseKey
op_assign
id|DAC960_SenseKey_MediumError
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
l_bool|true
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense-&gt;SenseKey
op_eq
id|DAC960_SenseKey_MediumError
)paren
(brace
multiline_comment|/*&n;&t;   * break the command down into pieces and resubmit each&n;&t;   * piece, hoping that some of them will succeed.&n;&t;   */
id|DAC960_queue_partial_rw
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense-&gt;SenseKey
op_ne
id|DAC960_SenseKey_NotReady
)paren
id|DAC960_V2_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;&t;    Perform completion processing for all buffers in this I/O Request.&n;&t;  */
(paren
r_void
)paren
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
l_bool|false
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ReadRetryCommand
op_logical_or
id|CommandType
op_eq
id|DAC960_WriteRetryCommand
)paren
(brace
id|boolean
id|normal_completion
suffix:semicolon
macro_line|#ifdef FORCE_RETRY_FAILURE_DEBUG
r_static
r_int
id|retry_count
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;        Perform completion processing for the portion that was&n;&t;retried, and submit the next portion, if any.&n;      */
id|normal_completion
op_assign
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V2_NormalCompletion
)paren
(brace
id|normal_completion
op_assign
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;V2.RequestSense-&gt;SenseKey
op_ne
id|DAC960_SenseKey_NotReady
)paren
id|DAC960_V2_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
macro_line|#ifdef FORCE_RETRY_FAILURE_DEBUG
r_if
c_cond
(paren
op_logical_neg
(paren
op_increment
id|retry_count
op_mod
l_int|10000
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;V2 error retry failure test&bslash;n&quot;
)paren
suffix:semicolon
id|normal_completion
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V2_ReadWriteError
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|DAC960_ProcessCompletedRequest
c_func
(paren
id|Command
comma
id|normal_completion
)paren
)paren
(brace
id|DAC960_queue_partial_rw
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_MonitoringCommand
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ShutdownMonitoringTimer
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetControllerInfo
)paren
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|NewControllerInfo
op_assign
id|Controller-&gt;V2.NewControllerInformation
suffix:semicolon
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
id|Controller-&gt;LogicalDriveCount
op_assign
id|NewControllerInfo-&gt;LogicalDevicesPresent
suffix:semicolon
id|Controller-&gt;V2.NeedLogicalDeviceInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V2.StartLogicalDeviceInformationScan
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;V2.StartPhysicalDeviceInformationScan
op_assign
l_bool|true
suffix:semicolon
id|Controller-&gt;MonitoringAlertMode
op_assign
(paren
id|NewControllerInfo-&gt;LogicalDevicesCritical
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;LogicalDevicesOffline
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;PhysicalDisksCritical
OG
l_int|0
op_logical_or
id|NewControllerInfo-&gt;PhysicalDisksOffline
OG
l_int|0
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ControllerInfo
comma
id|NewControllerInfo
comma
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetEvent
)paren
(brace
r_if
c_cond
(paren
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|DAC960_V2_ReportEvent
c_func
(paren
id|Controller
comma
id|Controller-&gt;V2.Event
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NextEventSequenceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetPhysicalDeviceInfoValid
op_logical_and
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|NewPhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation
suffix:semicolon
r_int
r_int
id|PhysicalDeviceIndex
op_assign
id|Controller-&gt;V2.PhysicalDeviceIndex
suffix:semicolon
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
r_int
r_int
id|DeviceIndex
suffix:semicolon
r_while
c_loop
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
op_logical_and
(paren
id|NewPhysicalDeviceInfo-&gt;Channel
OG
id|PhysicalDeviceInfo-&gt;Channel
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Channel
op_eq
id|PhysicalDeviceInfo-&gt;Channel
op_logical_and
(paren
id|NewPhysicalDeviceInfo-&gt;TargetID
OG
id|PhysicalDeviceInfo-&gt;TargetID
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;TargetID
op_eq
id|PhysicalDeviceInfo-&gt;TargetID
op_logical_and
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
OG
id|PhysicalDeviceInfo-&gt;LogicalUnit
)paren
)paren
)paren
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d No Longer Exists&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;Channel
comma
id|PhysicalDeviceInfo-&gt;TargetID
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|PhysicalDeviceInfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
r_for
c_loop
(paren
id|DeviceIndex
op_assign
id|PhysicalDeviceIndex
suffix:semicolon
id|DeviceIndex
OL
id|DAC960_V2_MaxPhysicalDevices
op_minus
l_int|1
suffix:semicolon
id|DeviceIndex
op_increment
)paren
(brace
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
)braket
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
op_plus
l_int|1
)braket
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
)braket
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
op_plus
l_int|1
)braket
suffix:semicolon
)brace
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DAC960_V2_MaxPhysicalDevices
op_minus
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DAC960_V2_MaxPhysicalDevices
op_minus
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Channel
op_ne
id|PhysicalDeviceInfo-&gt;Channel
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;TargetID
op_ne
id|PhysicalDeviceInfo-&gt;TargetID
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
op_ne
id|PhysicalDeviceInfo-&gt;LogicalUnit
)paren
)paren
(brace
id|PhysicalDeviceInfo
op_assign
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|InquiryUnitSerialNumber
op_assign
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|InquiryUnitSerialNumber
op_eq
l_int|NULL
op_logical_and
id|PhysicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|PhysicalDeviceInfo
)paren
suffix:semicolon
id|PhysicalDeviceInfo
op_assign
l_int|NULL
suffix:semicolon
)brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Now Exists%s&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; - Allocation Failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
id|memset
c_func
(paren
id|PhysicalDeviceInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_assign
id|DAC960_V2_Device_InvalidState
suffix:semicolon
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
r_for
c_loop
(paren
id|DeviceIndex
op_assign
id|DAC960_V2_MaxPhysicalDevices
op_minus
l_int|1
suffix:semicolon
id|DeviceIndex
OG
id|PhysicalDeviceIndex
suffix:semicolon
id|DeviceIndex
op_decrement
)paren
(brace
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
)braket
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
op_minus
l_int|1
)braket
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
)braket
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
op_minus
l_int|1
)braket
suffix:semicolon
)brace
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|PhysicalDeviceInfo
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|PhysicalDeviceIndex
)braket
op_assign
id|InquiryUnitSerialNumber
suffix:semicolon
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_ne
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d is now %s&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
(paren
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Rebuild
ques
c_cond
l_string|&quot;REBUILD&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Missing
ques
c_cond
l_string|&quot;MISSING&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
ques
c_cond
l_string|&quot;DEAD&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_SuspectedDead
ques
c_cond
l_string|&quot;SUSPECTED-DEAD&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_CommandedOffline
ques
c_cond
l_string|&quot;COMMANDED-OFFLINE&quot;
suffix:colon
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Standby
ques
c_cond
l_string|&quot;STANDBY&quot;
suffix:colon
l_string|&quot;UNKNOWN&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewPhysicalDeviceInfo-&gt;ParityErrors
op_ne
id|PhysicalDeviceInfo-&gt;ParityErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;SoftErrors
op_ne
id|PhysicalDeviceInfo-&gt;SoftErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;HardErrors
op_ne
id|PhysicalDeviceInfo-&gt;HardErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;MiscellaneousErrors
op_ne
id|PhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;CommandTimeouts
op_ne
id|PhysicalDeviceInfo-&gt;CommandTimeouts
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Retries
op_ne
id|PhysicalDeviceInfo-&gt;Retries
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;Aborts
op_ne
id|PhysicalDeviceInfo-&gt;Aborts
)paren
op_logical_or
(paren
id|NewPhysicalDeviceInfo-&gt;PredictedFailuresDetected
op_ne
id|PhysicalDeviceInfo-&gt;PredictedFailuresDetected
)paren
)paren
(brace
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Parity = %d, Soft = %d, &quot;
l_string|&quot;Hard = %d, Misc = %d&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
id|NewPhysicalDeviceInfo-&gt;ParityErrors
comma
id|NewPhysicalDeviceInfo-&gt;SoftErrors
comma
id|NewPhysicalDeviceInfo-&gt;HardErrors
comma
id|NewPhysicalDeviceInfo-&gt;MiscellaneousErrors
)paren
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d Errors: &quot;
l_string|&quot;Timeouts = %d, Retries = %d, &quot;
l_string|&quot;Aborts = %d, Predicted = %d&bslash;n&quot;
comma
id|Controller
comma
id|NewPhysicalDeviceInfo-&gt;Channel
comma
id|NewPhysicalDeviceInfo-&gt;TargetID
comma
id|NewPhysicalDeviceInfo-&gt;CommandTimeouts
comma
id|NewPhysicalDeviceInfo-&gt;Retries
comma
id|NewPhysicalDeviceInfo-&gt;Aborts
comma
id|NewPhysicalDeviceInfo
op_member_access_from_pointer
id|PredictedFailuresDetected
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_Dead
op_logical_or
id|PhysicalDeviceInfo-&gt;PhysicalDeviceState
op_eq
id|DAC960_V2_Device_InvalidState
)paren
op_logical_and
id|NewPhysicalDeviceInfo-&gt;PhysicalDeviceState
op_ne
id|DAC960_V2_Device_Dead
)paren
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|true
suffix:semicolon
id|memcpy
c_func
(paren
id|PhysicalDeviceInfo
comma
id|NewPhysicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
)paren
suffix:semicolon
)brace
id|NewPhysicalDeviceInfo-&gt;LogicalUnit
op_increment
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceIndex
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetPhysicalDeviceInfoValid
)paren
(brace
r_int
r_int
id|DeviceIndex
suffix:semicolon
r_for
c_loop
(paren
id|DeviceIndex
op_assign
id|Controller-&gt;V2.PhysicalDeviceIndex
suffix:semicolon
id|DeviceIndex
OL
id|DAC960_V2_MaxPhysicalDevices
suffix:semicolon
id|DeviceIndex
op_increment
)paren
(brace
id|DAC960_V2_PhysicalDeviceInfo_T
op_star
id|PhysicalDeviceInfo
op_assign
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
)braket
suffix:semicolon
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
)braket
suffix:semicolon
r_if
c_cond
(paren
id|PhysicalDeviceInfo
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Physical Device %d:%d No Longer Exists&bslash;n&quot;
comma
id|Controller
comma
id|PhysicalDeviceInfo-&gt;Channel
comma
id|PhysicalDeviceInfo-&gt;TargetID
)paren
suffix:semicolon
id|Controller-&gt;V2.PhysicalDeviceInformation
(braket
id|DeviceIndex
)braket
op_assign
l_int|NULL
suffix:semicolon
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|DeviceIndex
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|PhysicalDeviceInfo
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|InquiryUnitSerialNumber
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetLogicalDeviceInfoValid
op_logical_and
id|CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|NewLogicalDeviceInfo
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformation
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
suffix:semicolon
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
(brace
id|DAC960_V2_PhysicalDevice_T
id|PhysicalDevice
suffix:semicolon
id|PhysicalDevice.Controller
op_assign
l_int|0
suffix:semicolon
id|PhysicalDevice.Channel
op_assign
id|NewLogicalDeviceInfo-&gt;Channel
suffix:semicolon
id|PhysicalDevice.TargetID
op_assign
id|NewLogicalDeviceInfo-&gt;TargetID
suffix:semicolon
id|PhysicalDevice.LogicalUnit
op_assign
id|NewLogicalDeviceInfo-&gt;LogicalUnit
suffix:semicolon
id|Controller-&gt;V2.LogicalDriveToVirtualDevice
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|PhysicalDevice
suffix:semicolon
id|LogicalDeviceInfo
op_assign
(paren
id|DAC960_V2_LogicalDeviceInfo_T
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDeviceNumber
)braket
op_assign
id|LogicalDeviceInfo
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;Now Exists%s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; - Allocation Failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
id|memset
c_func
(paren
id|LogicalDeviceInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
id|DAC960_ComputeGenericDiskInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|LogicalDeviceSize
op_assign
id|NewLogicalDeviceInfo-&gt;ConfigurableDeviceSize
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_ne
id|LogicalDeviceInfo-&gt;LogicalDeviceState
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;is now %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Online
ques
c_cond
l_string|&quot;ONLINE&quot;
suffix:colon
id|NewLogicalDeviceInfo-&gt;LogicalDeviceState
op_eq
id|DAC960_V2_LogicalDevice_Critical
ques
c_cond
l_string|&quot;CRITICAL&quot;
suffix:colon
l_string|&quot;OFFLINE&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewLogicalDeviceInfo-&gt;SoftErrors
op_ne
id|LogicalDeviceInfo-&gt;SoftErrors
)paren
op_logical_or
(paren
id|NewLogicalDeviceInfo-&gt;CommandsFailed
op_ne
id|LogicalDeviceInfo-&gt;CommandsFailed
)paren
op_logical_or
(paren
id|NewLogicalDeviceInfo-&gt;DeferredWriteErrors
op_ne
id|LogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
)paren
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) Errors: &quot;
l_string|&quot;Soft = %d, Failed = %d, Deferred Write = %d&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo-&gt;SoftErrors
comma
id|NewLogicalDeviceInfo-&gt;CommandsFailed
comma
id|NewLogicalDeviceInfo-&gt;DeferredWriteErrors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;ConsistencyCheckInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Consistency Check&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|ConsistencyCheckBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;RebuildInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Rebuild&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|RebuildBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;BackgroundInitializationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Background Initialization&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|BackgroundInitializationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;ForegroundInitializationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Foreground Initialization&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|ForegroundInitializationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;DataMigrationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Data Migration&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|DataMigrationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|NewLogicalDeviceInfo-&gt;PatrolOperationInProgress
)paren
id|DAC960_V2_ReportProgress
c_func
(paren
id|Controller
comma
l_string|&quot;Patrol Operation&quot;
comma
id|LogicalDeviceNumber
comma
id|NewLogicalDeviceInfo
op_member_access_from_pointer
id|PatrolOperationBlockNumber
comma
id|LogicalDeviceSize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo-&gt;BackgroundInitializationInProgress
op_logical_and
op_logical_neg
id|NewLogicalDeviceInfo-&gt;BackgroundInitializationInProgress
)paren
id|DAC960_Progress
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;Background Initialization %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDeviceNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDeviceNumber
comma
(paren
id|NewLogicalDeviceInfo-&gt;LogicalDeviceControl
dot
id|LogicalDeviceInitialized
ques
c_cond
l_string|&quot;Completed&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|LogicalDeviceInfo
comma
id|NewLogicalDeviceInfo
comma
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.LogicalDriveFoundDuringScan
(braket
id|LogicalDeviceNumber
)braket
op_assign
l_bool|true
suffix:semicolon
id|NewLogicalDeviceInfo-&gt;LogicalDeviceNumber
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_GetLogicalDeviceInfoValid
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
op_logical_or
id|Controller-&gt;V2.LogicalDriveFoundDuringScan
(braket
id|LogicalDriveNumber
)braket
)paren
r_continue
suffix:semicolon
id|DAC960_Critical
c_func
(paren
l_string|&quot;Logical Drive %d (/dev/rd/c%dd%d) &quot;
l_string|&quot;No Longer Exists&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|LogicalDeviceInfo
)paren
suffix:semicolon
id|Controller-&gt;LogicalDriveInitiallyAccessible
(braket
id|LogicalDriveNumber
)braket
op_assign
l_bool|false
suffix:semicolon
id|DAC960_ComputeGenericDiskInfo
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NeedLogicalDeviceInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V2_SCSI_10_Passthru
)paren
(brace
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.InquiryUnitSerialNumber
(braket
id|Controller-&gt;V2.PhysicalDeviceIndex
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|CommandStatus
op_ne
id|DAC960_V2_NormalCompletion
)paren
(brace
id|memset
c_func
(paren
id|InquiryUnitSerialNumber
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|InquiryUnitSerialNumber
comma
id|Controller-&gt;V2.NewInquiryUnitSerialNumber
comma
r_sizeof
(paren
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
)paren
)paren
suffix:semicolon
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
op_assign
l_bool|false
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_minus
id|Controller-&gt;V2.NextEventSequenceNumber
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;GetEvent.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_Event_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.EventSequenceNumberHigh16
op_assign
id|Controller-&gt;V2.NextEventSequenceNumber
op_rshift
l_int|16
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.IOCTL_Opcode
op_assign
id|DAC960_V2_GetEvent
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.EventSequenceNumberLow16
op_assign
id|Controller-&gt;V2.NextEventSequenceNumber
op_amp
l_int|0xFFFF
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.EventDMA
suffix:semicolon
id|CommandMailbox-&gt;GetEvent.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;GetEvent.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedPhysicalDeviceInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedDeviceSerialNumberInformation
)paren
(brace
id|DAC960_SCSI_Inquiry_UnitSerialNumber_T
op_star
id|InquiryUnitSerialNumber
op_assign
id|Controller-&gt;V2.NewInquiryUnitSerialNumber
suffix:semicolon
id|InquiryUnitSerialNumber-&gt;PeripheralDeviceType
op_assign
l_int|0x1F
suffix:semicolon
id|DAC960_V2_ConstructNewUnitSerialNumber
c_func
(paren
id|Controller
comma
id|CommandMailbox
comma
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;Channel
comma
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;TargetID
comma
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;LogicalUnit
op_minus
l_int|1
)paren
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.StartPhysicalDeviceInformationScan
)paren
(brace
id|Controller-&gt;V2.PhysicalDeviceIndex
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;Channel
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;TargetID
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;LogicalUnit
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.StartPhysicalDeviceInformationScan
op_assign
l_bool|false
suffix:semicolon
)brace
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_PhysicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.LogicalUnit
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;LogicalUnit
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformation-&gt;Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetPhysicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewPhysicalDeviceInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Controller-&gt;V2.NeedLogicalDeviceInformation
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;V2.StartLogicalDeviceInformationScan
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
id|Controller-&gt;V2.LogicalDriveFoundDuringScan
(braket
id|LogicalDriveNumber
)braket
op_assign
l_bool|false
suffix:semicolon
id|Controller-&gt;V2.NewLogicalDeviceInformation-&gt;LogicalDeviceNumber
op_assign
l_int|0
suffix:semicolon
id|Controller-&gt;V2.StartLogicalDeviceInformationScan
op_assign
l_bool|false
suffix:semicolon
)brace
id|CommandMailbox-&gt;LogicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_LogicalDeviceInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformation-&gt;LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetLogicalDeviceInfoValid
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewLogicalDeviceInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;LogicalDeviceInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;MonitoringTimerCount
op_increment
suffix:semicolon
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_HealthStatusMonitoringInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_ImmediateCommand
)paren
(brace
id|complete
c_func
(paren
id|Command-&gt;Completion
)paren
suffix:semicolon
id|Command-&gt;Completion
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|CommandType
op_eq
id|DAC960_QueuedCommand
)paren
(brace
id|DAC960_V2_KernelCommand_T
op_star
id|KernelCommand
op_assign
id|Command-&gt;V2.KernelCommand
suffix:semicolon
id|KernelCommand-&gt;CommandStatus
op_assign
id|CommandStatus
suffix:semicolon
id|KernelCommand-&gt;RequestSenseLength
op_assign
id|Command-&gt;V2.RequestSenseLength
suffix:semicolon
id|KernelCommand-&gt;DataTransferLength
op_assign
id|Command-&gt;V2.DataTransferResidue
suffix:semicolon
id|Command-&gt;V2.KernelCommand
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|KernelCommand
op_member_access_from_pointer
id|CompletionFunction
c_func
(paren
id|KernelCommand
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Queue a Status Monitoring Command to the Controller using the just&n;    completed Command if one was deferred previously due to lack of a&n;    free Command when the Monitoring Timer Function was called.&n;  */
r_if
c_cond
(paren
id|Controller-&gt;MonitoringCommandDeferred
)paren
(brace
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|false
suffix:semicolon
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Deallocate the Command.&n;  */
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
multiline_comment|/*&n;    Wake up any processes waiting on a free Command.&n;  */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_BA_InterruptHandler handles hardware interrupts from DAC960 BA Series&n;  Controllers.&n;*/
DECL|function|DAC960_BA_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_BA_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_BA_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
OG
l_int|0
)paren
(brace
id|DAC960_V2_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|Command-&gt;V2.RequestSenseLength
op_assign
id|NextStatusMailbox-&gt;Fields.RequestSenseLength
suffix:semicolon
id|Command-&gt;V2.DataTransferResidue
op_assign
id|NextStatusMailbox-&gt;Fields.DataTransferResidue
suffix:semicolon
id|NextStatusMailbox-&gt;Words
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V2.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LP_InterruptHandler handles hardware interrupts from DAC960 LP Series&n;  Controllers.&n;*/
DECL|function|DAC960_LP_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_LP_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V2_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_LP_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
OG
l_int|0
)paren
(brace
id|DAC960_V2_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V2.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|Command-&gt;V2.RequestSenseLength
op_assign
id|NextStatusMailbox-&gt;Fields.RequestSenseLength
suffix:semicolon
id|Command-&gt;V2.DataTransferResidue
op_assign
id|NextStatusMailbox-&gt;Fields.DataTransferResidue
suffix:semicolon
id|NextStatusMailbox-&gt;Words
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V2.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V2.FirstStatusMailbox
suffix:semicolon
id|DAC960_V2_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V2.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_LA_InterruptHandler handles hardware interrupts from DAC960 LA Series&n;  Controllers.&n;*/
DECL|function|DAC960_LA_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_LA_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_LA_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V1.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.FirstStatusMailbox
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V1.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PG_InterruptHandler handles hardware interrupts from DAC960 PG Series&n;  Controllers.&n;*/
DECL|function|DAC960_PG_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_PG_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
id|DAC960_V1_StatusMailbox_T
op_star
id|NextStatusMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_PG_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.NextStatusMailbox
suffix:semicolon
r_while
c_loop
(paren
id|NextStatusMailbox-&gt;Fields.Valid
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|NextStatusMailbox-&gt;Fields.CommandIdentifier
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|NextStatusMailbox-&gt;Fields.CommandStatus
suffix:semicolon
id|NextStatusMailbox-&gt;Word
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|NextStatusMailbox
OG
id|Controller-&gt;V1.LastStatusMailbox
)paren
id|NextStatusMailbox
op_assign
id|Controller-&gt;V1.FirstStatusMailbox
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
id|Controller-&gt;V1.NextStatusMailbox
op_assign
id|NextStatusMailbox
suffix:semicolon
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_PD_InterruptHandler handles hardware interrupts from DAC960 PD Series&n;  Controllers.&n;*/
DECL|function|DAC960_PD_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_PD_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_StatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|DAC960_PD_ReadStatusCommandIdentifier
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|DAC960_PD_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_P_InterruptHandler handles hardware interrupts from DAC960 P Series&n;  Controllers.&n;&n;  Translations of DAC960_V1_Enquiry and DAC960_V1_GetDeviceState rely&n;  on the data having been placed into DAC960_Controller_T, rather than&n;  an arbitrary buffer.&n;*/
DECL|function|DAC960_P_InterruptHandler
r_static
id|irqreturn_t
id|DAC960_P_InterruptHandler
c_func
(paren
r_int
id|IRQ_Channel
comma
r_void
op_star
id|DeviceIdentifier
comma
r_struct
id|pt_regs
op_star
id|InterruptRegisters
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|DeviceIdentifier
suffix:semicolon
r_void
op_star
id|ControllerBaseAddress
op_assign
id|Controller-&gt;BaseAddress
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAC960_PD_StatusAvailableP
c_func
(paren
id|ControllerBaseAddress
)paren
)paren
(brace
id|DAC960_V1_CommandIdentifier_T
id|CommandIdentifier
op_assign
id|DAC960_PD_ReadStatusCommandIdentifier
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
id|Controller-&gt;Commands
(braket
id|CommandIdentifier
op_minus
l_int|1
)braket
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
op_assign
id|CommandMailbox-&gt;Common.CommandOpcode
suffix:semicolon
id|Command-&gt;V1.CommandStatus
op_assign
id|DAC960_PD_ReadStatusRegister
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeInterrupt
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
id|DAC960_PD_AcknowledgeStatus
c_func
(paren
id|ControllerBaseAddress
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|CommandOpcode
)paren
(brace
r_case
id|DAC960_V1_Enquiry_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_Enquiry
suffix:semicolon
id|DAC960_P_To_PD_TranslateEnquiry
c_func
(paren
id|Controller-&gt;V1.NewEnquiry
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_GetDeviceState_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_GetDeviceState
suffix:semicolon
id|DAC960_P_To_PD_TranslateDeviceState
c_func
(paren
id|Controller-&gt;V1.NewDeviceState
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Read_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_Read
suffix:semicolon
id|DAC960_P_To_PD_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_Write_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_Write
suffix:semicolon
id|DAC960_P_To_PD_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_ReadWithScatterGather_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_ReadWithScatterGather
suffix:semicolon
id|DAC960_P_To_PD_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_WriteWithScatterGather_Old
suffix:colon
id|Command-&gt;V1.CommandMailbox.Common.CommandOpcode
op_assign
id|DAC960_V1_WriteWithScatterGather
suffix:semicolon
id|DAC960_P_To_PD_TranslateReadWriteCommand
c_func
(paren
id|CommandMailbox
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|DAC960_V1_ProcessCompletedCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;    Attempt to remove additional I/O Requests from the Controller&squot;s&n;    I/O Request Queue and queue them to the Controller.&n;  */
r_while
c_loop
(paren
id|DAC960_ProcessRequest
c_func
(paren
id|Controller
comma
l_bool|false
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_QueueMonitoringCommand queues a Monitoring Command to DAC960 V1&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V1_QueueMonitoringCommand
r_static
r_void
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_MonitoringCommand
suffix:semicolon
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_V1_Enquiry
suffix:semicolon
id|CommandMailbox-&gt;Type3.BusAddress
op_assign
id|Controller-&gt;V1.NewEnquiryDMA
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_QueueMonitoringCommand queues a Monitoring Command to DAC960 V2&n;  Firmware Controllers.&n;*/
DECL|function|DAC960_V2_QueueMonitoringCommand
r_static
r_void
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_MonitoringCommand
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetControllerInfo
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewControllerInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
suffix:semicolon
id|DAC960_QueueCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_MonitoringTimerFunction is the timer function for monitoring&n;  the status of DAC960 Controllers.&n;*/
DECL|function|DAC960_MonitoringTimerFunction
r_static
r_void
id|DAC960_MonitoringTimerFunction
c_func
(paren
r_int
r_int
id|TimerData
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|TimerData
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Queue a Status Monitoring Command to Controller.&n;      */
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|DAC960_V1_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_else
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|true
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|DAC960_V2_ControllerInfo_T
op_star
id|ControllerInfo
op_assign
op_amp
id|Controller-&gt;V2.ControllerInformation
suffix:semicolon
r_int
r_int
id|StatusChangeCounter
op_assign
id|Controller-&gt;V2.HealthStatusBuffer-&gt;StatusChangeCounter
suffix:semicolon
id|boolean
id|ForceMonitoringCommand
op_assign
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|Controller-&gt;SecondaryMonitoringTime
OG
id|DAC960_SecondaryMonitoringInterval
)paren
(brace
r_int
id|LogicalDriveNumber
suffix:semicolon
r_for
c_loop
(paren
id|LogicalDriveNumber
op_assign
l_int|0
suffix:semicolon
id|LogicalDriveNumber
OL
id|DAC960_MaxLogicalDrives
suffix:semicolon
id|LogicalDriveNumber
op_increment
)paren
(brace
id|DAC960_V2_LogicalDeviceInfo_T
op_star
id|LogicalDeviceInfo
op_assign
id|Controller-&gt;V2.LogicalDeviceInformation
(braket
id|LogicalDriveNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LogicalDeviceInfo
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|LogicalDeviceInfo-&gt;LogicalDeviceControl
dot
id|LogicalDeviceInitialized
)paren
(brace
id|ForceMonitoringCommand
op_assign
l_bool|true
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|Controller-&gt;SecondaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|StatusChangeCounter
op_eq
id|Controller-&gt;V2.StatusChangeCounter
op_logical_and
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_eq
id|Controller-&gt;V2.NextEventSequenceNumber
op_logical_and
(paren
id|ControllerInfo-&gt;BackgroundInitializationsActive
op_plus
id|ControllerInfo-&gt;LogicalDeviceInitializationsActive
op_plus
id|ControllerInfo-&gt;PhysicalDeviceInitializationsActive
op_plus
id|ControllerInfo-&gt;ConsistencyChecksActive
op_plus
id|ControllerInfo-&gt;RebuildsActive
op_plus
id|ControllerInfo-&gt;OnlineExpansionsActive
op_eq
l_int|0
op_logical_or
id|jiffies
op_minus
id|Controller-&gt;PrimaryMonitoringTime
OL
id|DAC960_MonitoringTimerInterval
)paren
op_logical_and
op_logical_neg
id|ForceMonitoringCommand
)paren
(brace
id|Controller-&gt;MonitoringTimer.expires
op_assign
id|jiffies
op_plus
id|DAC960_HealthStatusMonitoringInterval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|Controller-&gt;MonitoringTimer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|Controller-&gt;V2.StatusChangeCounter
op_assign
id|StatusChangeCounter
suffix:semicolon
id|Controller-&gt;PrimaryMonitoringTime
op_assign
id|jiffies
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Queue a Status Monitoring Command to Controller.&n;      */
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command
op_ne
l_int|NULL
)paren
id|DAC960_V2_QueueMonitoringCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_else
id|Controller-&gt;MonitoringCommandDeferred
op_assign
l_bool|true
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;Wake up any processes waiting on a Health Status Buffer change.&n;      */
id|wake_up
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_CheckStatusBuffer verifies that there is room to hold ByteCount&n;  additional bytes in the Combined Status Buffer and grows the buffer if&n;  necessary.  It returns true if there is enough room and false otherwise.&n;*/
DECL|function|DAC960_CheckStatusBuffer
r_static
id|boolean
id|DAC960_CheckStatusBuffer
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_int
id|ByteCount
)paren
(brace
r_int
r_char
op_star
id|NewStatusBuffer
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
op_plus
id|Controller-&gt;CurrentStatusLength
op_plus
id|ByteCount
op_plus
l_int|1
op_le
id|Controller-&gt;CombinedStatusBufferLength
)paren
r_return
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBufferLength
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|NewStatusBufferLength
op_assign
id|DAC960_InitialStatusBufferSize
suffix:semicolon
r_while
c_loop
(paren
id|NewStatusBufferLength
OL
id|ByteCount
)paren
id|NewStatusBufferLength
op_mul_assign
l_int|2
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|NewStatusBufferLength
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;CombinedStatusBuffer
op_eq
l_int|NULL
)paren
r_return
l_bool|false
suffix:semicolon
id|Controller-&gt;CombinedStatusBufferLength
op_assign
id|NewStatusBufferLength
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
id|NewStatusBuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
l_int|2
op_star
id|Controller-&gt;CombinedStatusBufferLength
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewStatusBuffer
op_eq
l_int|NULL
)paren
(brace
id|DAC960_Warning
c_func
(paren
l_string|&quot;Unable to expand Combined Status Buffer - Truncating&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_return
l_bool|false
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|NewStatusBuffer
comma
id|Controller-&gt;CombinedStatusBuffer
comma
id|Controller-&gt;CombinedStatusBufferLength
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|Controller-&gt;CombinedStatusBuffer
)paren
suffix:semicolon
id|Controller-&gt;CombinedStatusBuffer
op_assign
id|NewStatusBuffer
suffix:semicolon
id|Controller-&gt;CombinedStatusBufferLength
op_mul_assign
l_int|2
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
op_amp
id|NewStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
)braket
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_Message prints Driver Messages.&n;*/
DECL|function|DAC960_Message
r_static
r_void
id|DAC960_Message
c_func
(paren
id|DAC960_MessageLevel_T
id|MessageLevel
comma
r_int
r_char
op_star
id|Format
comma
id|DAC960_Controller_T
op_star
id|Controller
comma
dot
dot
dot
)paren
(brace
r_static
r_int
r_char
id|Buffer
(braket
id|DAC960_LineBufferSize
)braket
suffix:semicolon
r_static
id|boolean
id|BeginningOfLine
op_assign
l_bool|true
suffix:semicolon
id|va_list
id|Arguments
suffix:semicolon
r_int
id|Length
op_assign
l_int|0
suffix:semicolon
id|va_start
c_func
(paren
id|Arguments
comma
id|Controller
)paren
suffix:semicolon
id|Length
op_assign
id|vsprintf
c_func
(paren
id|Buffer
comma
id|Format
comma
id|Arguments
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|Arguments
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|DAC960_ControllerCount
comma
id|Buffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
op_logical_or
id|MessageLevel
op_eq
id|DAC960_InfoLevel
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|Controller-&gt;ControllerInitialized
)paren
(brace
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
id|Length
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;InitialStatusLength
op_add_assign
id|Length
suffix:semicolon
id|Controller-&gt;CurrentStatusBuffer
op_assign
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Controller-&gt;InitialStatusLength
op_plus
l_int|1
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_AnnounceLevel
)paren
(brace
r_static
r_int
id|AnnouncementLines
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|AnnouncementLines
op_le
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
(brace
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
id|Length
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|Length
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_ProgressLevel
)paren
(brace
id|strcpy
c_func
(paren
id|Controller-&gt;ProgressBuffer
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;ProgressBufferLength
op_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;EphemeralProgressMessage
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|Controller-&gt;LastProgressReportTime
op_ge
id|DAC960_ProgressReportingInterval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;LastProgressReportTime
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|MessageLevel
op_eq
id|DAC960_UserCriticalLevel
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Controller-&gt;UserStatusLength
)braket
comma
id|Buffer
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_add_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Buffer
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_or
id|Length
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|BeginningOfLine
)paren
id|printk
c_func
(paren
l_string|&quot;%sDAC960#%d: %s&quot;
comma
id|DAC960_MessageLevelMap
(braket
id|MessageLevel
)braket
comma
id|Controller-&gt;ControllerNumber
comma
id|Buffer
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|Buffer
)paren
suffix:semicolon
)brace
id|BeginningOfLine
op_assign
(paren
id|Buffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParsePhysicalDevice parses spaces followed by a Physical Device&n;  Channel:TargetID specification from a User Command string.  It updates&n;  Channel and TargetID and returns true on success and false on failure.&n;*/
DECL|function|DAC960_ParsePhysicalDevice
r_static
id|boolean
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|Channel
comma
r_int
r_char
op_star
id|TargetID
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XChannel
comma
id|XTargetID
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XChannel
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;:&squot;
op_logical_or
id|XChannel
op_ge
id|Controller-&gt;Channels
)paren
r_return
l_bool|false
suffix:semicolon
id|UserCommandString
op_assign
op_increment
id|NewUserCommandString
suffix:semicolon
id|XTargetID
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XTargetID
op_ge
id|Controller-&gt;Targets
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|Channel
op_assign
id|XChannel
suffix:semicolon
op_star
id|TargetID
op_assign
id|XTargetID
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ParseLogicalDrive parses spaces followed by a Logical Drive Number&n;  specification from a User Command string.  It updates LogicalDriveNumber and&n;  returns true on success and false on failure.&n;*/
DECL|function|DAC960_ParseLogicalDrive
r_static
id|boolean
id|DAC960_ParseLogicalDrive
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_char
op_star
id|UserCommandString
comma
r_int
r_char
op_star
id|LogicalDriveNumber
)paren
(brace
r_char
op_star
id|NewUserCommandString
op_assign
id|UserCommandString
suffix:semicolon
r_int
r_int
id|XLogicalDriveNumber
suffix:semicolon
r_while
c_loop
(paren
op_star
id|UserCommandString
op_eq
l_char|&squot; &squot;
)paren
id|UserCommandString
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UserCommandString
op_eq
id|NewUserCommandString
)paren
r_return
l_bool|false
suffix:semicolon
id|XLogicalDriveNumber
op_assign
id|simple_strtoul
c_func
(paren
id|UserCommandString
comma
op_amp
id|NewUserCommandString
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewUserCommandString
op_eq
id|UserCommandString
op_logical_or
op_star
id|NewUserCommandString
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_or
id|XLogicalDriveNumber
OG
id|DAC960_MaxLogicalDrives
op_minus
l_int|1
)paren
r_return
l_bool|false
suffix:semicolon
op_star
id|LogicalDriveNumber
op_assign
id|XLogicalDriveNumber
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V1_SetDeviceState sets the Device State for a Physical Device for&n;  DAC960 V1 Firmware Controllers.&n;*/
DECL|function|DAC960_V1_SetDeviceState
r_static
r_void
id|DAC960_V1_SetDeviceState
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
id|DAC960_Command_T
op_star
id|Command
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
id|DAC960_V1_PhysicalDeviceState_T
id|DeviceState
comma
r_const
r_int
r_char
op_star
id|DeviceStateString
)paren
(brace
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_V1_StartDevice
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;Type3D.DeviceState
op_assign
id|DeviceState
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Modifier
op_assign
l_int|0
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Succeeded&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_UnableToStartDevice
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unable to Start Device&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NoDeviceAtAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;No Device at Address&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidChannelOrTargetOrModifier
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Invalid Channel or Target or Modifier&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_ChannelBusy
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Channel Busy&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;%s of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|DeviceStateString
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;  DAC960_V1_ExecuteUserCommand executes a User Command for DAC960 V1 Firmware&n;  Controllers.&n;*/
DECL|function|DAC960_V1_ExecuteUserCommand
r_static
id|boolean
id|DAC960_V1_ExecuteUserCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|UserCommand
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V1_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|Channel
comma
id|TargetID
comma
id|LogicalDriveNumber
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V1.CommandMailbox
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;flush-cache&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Type3.CommandOpcode
op_assign
id|DAC960_V1_Flush
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cache Flush Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;kill&quot;
comma
l_int|4
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|4
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_ne
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Dead
comma
l_string|&quot;Kill&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Kill of Physical Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-online&quot;
comma
l_int|11
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|11
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Online
comma
l_string|&quot;Make Online&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Online of Physical Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-standby&quot;
comma
l_int|12
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|12
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|DAC960_V1_DeviceState_T
op_star
id|DeviceState
op_assign
op_amp
id|Controller-&gt;V1.DeviceState
(braket
id|Channel
)braket
(braket
id|TargetID
)braket
suffix:semicolon
r_if
c_cond
(paren
id|DeviceState-&gt;Present
op_logical_and
id|DeviceState-&gt;DeviceType
op_eq
id|DAC960_V1_DiskType
op_logical_and
id|DeviceState-&gt;DeviceState
op_eq
id|DAC960_V1_Device_Dead
)paren
id|DAC960_V1_SetDeviceState
c_func
(paren
id|Controller
comma
id|Command
comma
id|Channel
comma
id|TargetID
comma
id|DAC960_V1_Device_Standby
comma
l_string|&quot;Make Standby&quot;
)paren
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Standby of Physical &quot;
l_string|&quot;Device %d:%d Illegal&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;rebuild&quot;
comma
l_int|7
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|7
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3D.CommandOpcode
op_assign
id|DAC960_V1_RebuildAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3D.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;Type3D.TargetID
op_assign
id|TargetID
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Initiated&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_AttemptToRebuildOnlineDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Attempt to Rebuild Online or &quot;
l_string|&quot;Unresponsive Drive&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_NewDiskFailedDuringRebuild
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;New Disk Failed During Rebuild&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidDeviceAddress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Invalid Device Address&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Rebuild or Consistency Check Already &quot;
l_string|&quot;in Progress&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;check-consistency&quot;
comma
l_int|17
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|17
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;Type3C.CommandOpcode
op_assign
id|DAC960_V1_CheckConsistencyAsync
suffix:semicolon
id|CommandMailbox-&gt;Type3C.LogicalDriveNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;Type3C.AutoRestore
op_assign
l_bool|true
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Initiated&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_DependentDiskIsDead
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Dependent Physical Device is DEAD&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_InvalidOrNonredundantLogicalDrive
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Invalid or Nonredundant Logical Drive&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DAC960_V1_RebuildOrCheckAlreadyInProgress
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - Rebuild or &quot;
l_string|&quot;Consistency Check Already in Progress&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-rebuild&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-consistency-check&quot;
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;        the OldRebuildRateConstant is never actually used&n;        once its value is retrieved from the controller.&n;       */
r_int
r_char
op_star
id|OldRebuildRateConstant
suffix:semicolon
id|dma_addr_t
id|OldRebuildRateConstantDMA
suffix:semicolon
id|OldRebuildRateConstant
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
r_sizeof
(paren
r_char
)paren
comma
op_amp
id|OldRebuildRateConstantDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|OldRebuildRateConstant
op_eq
l_int|NULL
)paren
(brace
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cancellation of Rebuild or &quot;
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Out of Memory&quot;
comma
id|Controller
)paren
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
id|CommandMailbox-&gt;Type3R.CommandOpcode
op_assign
id|DAC960_V1_RebuildControl
suffix:semicolon
id|CommandMailbox-&gt;Type3R.RebuildRateConstant
op_assign
l_int|0xFF
suffix:semicolon
id|CommandMailbox-&gt;Type3R.BusAddress
op_assign
id|OldRebuildRateConstantDMA
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|Command-&gt;V1.CommandStatus
)paren
(brace
r_case
id|DAC960_V1_NormalCompletion
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild or Consistency Check Cancelled&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cancellation of Rebuild or &quot;
l_string|&quot;Consistency Check Failed - &quot;
l_string|&quot;Unexpected Status %04X&bslash;n&quot;
comma
id|Controller
comma
id|Command-&gt;V1.CommandStatus
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|failure
suffix:colon
id|pci_free_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
r_sizeof
(paren
r_char
)paren
comma
id|OldRebuildRateConstant
comma
id|OldRebuildRateConstantDMA
)paren
suffix:semicolon
)brace
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Illegal User Command: &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|UserCommand
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_TranslatePhysicalDevice translates a Physical Device Channel and&n;  TargetID into a Logical Device.  It returns true on success and false&n;  on failure.&n;*/
DECL|function|DAC960_V2_TranslatePhysicalDevice
r_static
id|boolean
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|DAC960_Command_T
op_star
id|Command
comma
r_int
r_char
id|Channel
comma
r_int
r_char
id|TargetID
comma
r_int
r_int
op_star
id|LogicalDeviceNumber
)paren
(brace
id|DAC960_V2_CommandMailbox_T
id|SavedCommandMailbox
comma
op_star
id|CommandMailbox
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|Command-&gt;Controller
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|SavedCommandMailbox
comma
id|CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_PhysicalToLogicalDevice_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.TargetID
op_assign
id|TargetID
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.PhysicalDevice.Channel
op_assign
id|Channel
suffix:semicolon
id|CommandMailbox-&gt;PhysicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_TranslatePhysicalToLogicalDevice
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.PhysicalToLogicalDeviceDMA
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
op_star
id|LogicalDeviceNumber
op_assign
id|Controller-&gt;V2.PhysicalToLogicalDevice-&gt;LogicalDeviceNumber
suffix:semicolon
id|memcpy
c_func
(paren
id|CommandMailbox
comma
op_amp
id|SavedCommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_return
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_V2_ExecuteUserCommand executes a User Command for DAC960 V2 Firmware&n;  Controllers.&n;*/
DECL|function|DAC960_V2_ExecuteUserCommand
r_static
id|boolean
id|DAC960_V2_ExecuteUserCommand
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
comma
r_int
r_char
op_star
id|UserCommand
)paren
(brace
id|DAC960_Command_T
op_star
id|Command
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|Channel
comma
id|TargetID
comma
id|LogicalDriveNumber
suffix:semicolon
r_int
r_int
id|LogicalDeviceNumber
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|Controller-&gt;UserStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits.DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits.NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;flush-cache&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;DeviceOperation.IOCTL_Opcode
op_assign
id|DAC960_V2_PauseDevice
suffix:semicolon
id|CommandMailbox-&gt;DeviceOperation.OperationDevice
op_assign
id|DAC960_V2_RAID_Controller
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Cache Flush Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;kill&quot;
comma
l_int|4
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|4
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Dead
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Kill of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-online&quot;
comma
l_int|11
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|11
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Online
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Online of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;make-standby&quot;
comma
l_int|12
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|12
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;SetDeviceState.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.IOCTL_Opcode
op_assign
id|DAC960_V2_SetDeviceState
suffix:semicolon
id|CommandMailbox-&gt;SetDeviceState.DeviceState.PhysicalDeviceState
op_assign
id|DAC960_V2_Device_Standby
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Make Standby of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Succeeded&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;rebuild&quot;
comma
l_int|7
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|7
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_RebuildDeviceStart
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Initiated&quot;
suffix:colon
l_string|&quot;Not Initiated&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-rebuild&quot;
comma
l_int|14
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParsePhysicalDevice
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|14
)braket
comma
op_amp
id|Channel
comma
op_amp
id|TargetID
)paren
op_logical_and
id|DAC960_V2_TranslatePhysicalDevice
c_func
(paren
id|Command
comma
id|Channel
comma
id|TargetID
comma
op_amp
id|LogicalDeviceNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;LogicalDeviceInfo.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDeviceNumber
suffix:semicolon
id|CommandMailbox-&gt;LogicalDeviceInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_RebuildDeviceStop
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Rebuild of Physical Device %d:%d %s&bslash;n&quot;
comma
id|Controller
comma
id|Channel
comma
id|TargetID
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Cancelled&quot;
suffix:colon
l_string|&quot;Not Cancelled&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;check-consistency&quot;
comma
l_int|17
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|17
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;ConsistencyCheck.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.IOCTL_Opcode
op_assign
id|DAC960_V2_ConsistencyCheckStart
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.RestoreConsistency
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.InitializedAreaOnly
op_assign
l_bool|false
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Initiated&quot;
suffix:colon
l_string|&quot;Not Initiated&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;cancel-consistency-check&quot;
comma
l_int|24
)paren
op_eq
l_int|0
op_logical_and
id|DAC960_ParseLogicalDrive
c_func
(paren
id|Controller
comma
op_amp
id|UserCommand
(braket
l_int|24
)braket
comma
op_amp
id|LogicalDriveNumber
)paren
)paren
(brace
id|CommandMailbox-&gt;ConsistencyCheck.LogicalDevice.LogicalDeviceNumber
op_assign
id|LogicalDriveNumber
suffix:semicolon
id|CommandMailbox-&gt;ConsistencyCheck.IOCTL_Opcode
op_assign
id|DAC960_V2_ConsistencyCheckStop
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Consistency Check of Logical Drive %d &quot;
l_string|&quot;(/dev/rd/c%dd%d) %s&bslash;n&quot;
comma
id|Controller
comma
id|LogicalDriveNumber
comma
id|Controller-&gt;ControllerNumber
comma
id|LogicalDriveNumber
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Cancelled&quot;
suffix:colon
l_string|&quot;Not Cancelled&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;perform-discovery&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.IOCTL_Opcode
op_assign
id|DAC960_V2_StartDiscovery
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Discovery %s&bslash;n&quot;
comma
id|Controller
comma
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
ques
c_cond
l_string|&quot;Initiated&quot;
suffix:colon
l_string|&quot;Not Initiated&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Command-&gt;V2.CommandStatus
op_eq
id|DAC960_V2_NormalCompletion
)paren
(brace
id|CommandMailbox-&gt;ControllerInfo.CommandOpcode
op_assign
id|DAC960_V2_IOCTL
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
op_assign
r_sizeof
(paren
id|DAC960_V2_ControllerInfo_T
)paren
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.IOCTL_Opcode
op_assign
id|DAC960_V2_GetControllerInfo
suffix:semicolon
multiline_comment|/*&n;&t;   * How does this NOT race with the queued Monitoring&n;&t;   * usage of this structure?&n;&t;   */
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|Controller-&gt;V2.NewControllerInformationDMA
suffix:semicolon
id|CommandMailbox-&gt;ControllerInfo.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;ControllerInfo.DataTransferSize
suffix:semicolon
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;V2.NewControllerInformation-&gt;PhysicalScanActive
)paren
(brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|sleep_on_timeout
c_func
(paren
op_amp
id|Controller-&gt;CommandWaitQueue
comma
id|HZ
)paren
suffix:semicolon
)brace
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Discovery Completed&bslash;n&quot;
comma
id|Controller
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|UserCommand
comma
l_string|&quot;suppress-enclosure-messages&quot;
)paren
op_eq
l_int|0
)paren
id|Controller-&gt;SuppressEnclosureMessages
op_assign
l_bool|true
suffix:semicolon
r_else
id|DAC960_UserCritical
c_func
(paren
l_string|&quot;Illegal User Command: &squot;%s&squot;&bslash;n&quot;
comma
id|Controller
comma
id|UserCommand
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_bool|true
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadStatus implements reading /proc/rd/status.&n;*/
DECL|function|DAC960_ProcReadStatus
r_static
r_int
id|DAC960_ProcReadStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
r_int
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;OK&bslash;n&quot;
suffix:semicolon
r_int
id|ControllerNumber
comma
id|BytesAvailable
suffix:semicolon
r_for
c_loop
(paren
id|ControllerNumber
op_assign
l_int|0
suffix:semicolon
id|ControllerNumber
OL
id|DAC960_ControllerCount
suffix:semicolon
id|ControllerNumber
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;MonitoringAlertMode
)paren
(brace
id|StatusMessage
op_assign
l_string|&quot;ALERT&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|BytesAvailable
op_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|StatusMessage
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadInitialStatus implements reading /proc/rd/cN/initial_status.&n;*/
DECL|function|DAC960_ProcReadInitialStatus
r_static
r_int
id|DAC960_ProcReadInitialStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;InitialStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;CombinedStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadCurrentStatus implements reading /proc/rd/cN/current_status.&n;*/
DECL|function|DAC960_ProcReadCurrentStatus
r_static
r_int
id|DAC960_ProcReadCurrentStatus
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
r_char
op_star
id|StatusMessage
op_assign
l_string|&quot;No Rebuild or Consistency Check in Progress&bslash;n&quot;
suffix:semicolon
r_int
id|ProgressMessageLength
op_assign
id|strlen
c_func
(paren
id|StatusMessage
)paren
suffix:semicolon
r_int
id|BytesAvailable
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_ne
id|Controller-&gt;LastCurrentStatusTime
)paren
(brace
id|Controller-&gt;CurrentStatusLength
op_assign
l_int|0
suffix:semicolon
id|DAC960_AnnounceDriver
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportControllerConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|DAC960_ReportDeviceConfiguration
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;ProgressBufferLength
OG
l_int|0
)paren
id|ProgressMessageLength
op_assign
id|Controller-&gt;ProgressBufferLength
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_CheckStatusBuffer
c_func
(paren
id|Controller
comma
l_int|2
op_plus
id|ProgressMessageLength
)paren
)paren
(brace
r_int
r_char
op_star
id|CurrentStatusBuffer
op_assign
id|Controller-&gt;CurrentStatusBuffer
suffix:semicolon
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;ProgressBufferLength
OG
l_int|0
)paren
id|strcpy
c_func
(paren
op_amp
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|Controller-&gt;ProgressBuffer
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
op_amp
id|CurrentStatusBuffer
(braket
id|Controller-&gt;CurrentStatusLength
)braket
comma
id|StatusMessage
)paren
suffix:semicolon
id|Controller-&gt;CurrentStatusLength
op_add_assign
id|ProgressMessageLength
suffix:semicolon
)brace
id|Controller-&gt;LastCurrentStatusTime
op_assign
id|jiffies
suffix:semicolon
)brace
id|BytesAvailable
op_assign
id|Controller-&gt;CurrentStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;CurrentStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcReadUserCommand implements reading /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcReadUserCommand
r_static
r_int
id|DAC960_ProcReadUserCommand
c_func
(paren
r_char
op_star
id|Page
comma
r_char
op_star
op_star
id|Start
comma
id|off_t
id|Offset
comma
r_int
id|Count
comma
r_int
op_star
id|EOF
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
id|BytesAvailable
op_assign
id|Controller-&gt;UserStatusLength
op_minus
id|Offset
suffix:semicolon
r_if
c_cond
(paren
id|Count
op_ge
id|BytesAvailable
)paren
(brace
id|Count
op_assign
id|BytesAvailable
suffix:semicolon
op_star
id|EOF
op_assign
l_bool|true
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Count
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|Start
op_assign
id|Page
suffix:semicolon
id|memcpy
c_func
(paren
id|Page
comma
op_amp
id|Controller-&gt;UserStatusBuffer
(braket
id|Offset
)braket
comma
id|Count
)paren
suffix:semicolon
r_return
id|Count
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_ProcWriteUserCommand implements writing /proc/rd/cN/user_command.&n;*/
DECL|function|DAC960_ProcWriteUserCommand
r_static
r_int
id|DAC960_ProcWriteUserCommand
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|Buffer
comma
r_int
r_int
id|Count
comma
r_void
op_star
id|Data
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
(paren
id|DAC960_Controller_T
op_star
)paren
id|Data
suffix:semicolon
r_int
r_char
id|CommandBuffer
(braket
l_int|80
)braket
suffix:semicolon
r_int
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|Count
OG
r_sizeof
(paren
id|CommandBuffer
)paren
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|CommandBuffer
comma
id|Buffer
comma
id|Count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|CommandBuffer
(braket
id|Count
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|Length
op_assign
id|strlen
c_func
(paren
id|CommandBuffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CommandBuffer
(braket
id|Length
op_minus
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|CommandBuffer
(braket
op_decrement
id|Length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_eq
id|DAC960_V1_Controller
)paren
r_return
(paren
id|DAC960_V1_ExecuteUserCommand
c_func
(paren
id|Controller
comma
id|CommandBuffer
)paren
ques
c_cond
id|Count
suffix:colon
op_minus
id|EBUSY
)paren
suffix:semicolon
r_else
r_return
(paren
id|DAC960_V2_ExecuteUserCommand
c_func
(paren
id|Controller
comma
id|CommandBuffer
)paren
ques
c_cond
id|Count
suffix:colon
op_minus
id|EBUSY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_CreateProcEntries creates the /proc/rd/... entries for the&n;  DAC960 Driver.&n;*/
DECL|function|DAC960_CreateProcEntries
r_static
r_void
id|DAC960_CreateProcEntries
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|StatusProcEntry
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|ControllerProcEntry
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|UserCommandProcEntry
suffix:semicolon
r_if
c_cond
(paren
id|DAC960_ProcDirectoryEntry
op_eq
l_int|NULL
)paren
(brace
id|DAC960_ProcDirectoryEntry
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|StatusProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;status&quot;
comma
l_int|0
comma
id|DAC960_ProcDirectoryEntry
comma
id|DAC960_ProcReadStatus
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|Controller-&gt;ControllerName
comma
l_string|&quot;c%d&quot;
comma
id|Controller-&gt;ControllerNumber
)paren
suffix:semicolon
id|ControllerProcEntry
op_assign
id|proc_mkdir
c_func
(paren
id|Controller-&gt;ControllerName
comma
id|DAC960_ProcDirectoryEntry
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;initial_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadInitialStatus
comma
id|Controller
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;current_status&quot;
comma
l_int|0
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadCurrentStatus
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;user_command&quot;
comma
id|S_IWUSR
op_or
id|S_IRUSR
comma
id|ControllerProcEntry
comma
id|DAC960_ProcReadUserCommand
comma
id|Controller
)paren
suffix:semicolon
id|UserCommandProcEntry-&gt;write_proc
op_assign
id|DAC960_ProcWriteUserCommand
suffix:semicolon
id|Controller-&gt;ControllerProcEntry
op_assign
id|ControllerProcEntry
suffix:semicolon
)brace
multiline_comment|/*&n;  DAC960_DestroyProcEntries destroys the /proc/rd/... entries for the&n;  DAC960 Driver.&n;*/
DECL|function|DAC960_DestroyProcEntries
r_static
r_void
id|DAC960_DestroyProcEntries
c_func
(paren
id|DAC960_Controller_T
op_star
id|Controller
)paren
(brace
r_if
c_cond
(paren
id|Controller-&gt;ControllerProcEntry
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;initial_status&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;current_status&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;user_command&quot;
comma
id|Controller-&gt;ControllerProcEntry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|Controller-&gt;ControllerName
comma
id|DAC960_ProcDirectoryEntry
)paren
suffix:semicolon
id|Controller-&gt;ControllerProcEntry
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef DAC960_GAM_MINOR
multiline_comment|/*&n; * DAC960_gam_ioctl is the ioctl function for performing RAID operations.&n;*/
DECL|function|DAC960_gam_ioctl
r_static
r_int
id|DAC960_gam_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|Request
comma
r_int
r_int
id|Argument
)paren
(brace
r_int
id|ErrorCode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_switch
c_cond
(paren
id|Request
)paren
(brace
r_case
id|DAC960_IOCTL_GET_CONTROLLER_COUNT
suffix:colon
r_return
id|DAC960_ControllerCount
suffix:semicolon
r_case
id|DAC960_IOCTL_GET_CONTROLLER_INFO
suffix:colon
(brace
id|DAC960_ControllerInfo_T
op_star
id|UserSpaceControllerInfo
op_assign
(paren
id|DAC960_ControllerInfo_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_ControllerInfo_T
id|ControllerInfo
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceControllerInfo
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ErrorCode
op_assign
id|get_user
c_func
(paren
id|ControllerNumber
comma
op_amp
id|UserSpaceControllerInfo-&gt;ControllerNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ErrorCode
op_ne
l_int|0
)paren
r_return
id|ErrorCode
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ControllerInfo
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
suffix:semicolon
id|ControllerInfo.ControllerNumber
op_assign
id|ControllerNumber
suffix:semicolon
id|ControllerInfo.FirmwareType
op_assign
id|Controller-&gt;FirmwareType
suffix:semicolon
id|ControllerInfo.Channels
op_assign
id|Controller-&gt;Channels
suffix:semicolon
id|ControllerInfo.Targets
op_assign
id|Controller-&gt;Targets
suffix:semicolon
id|ControllerInfo.PCI_Bus
op_assign
id|Controller-&gt;Bus
suffix:semicolon
id|ControllerInfo.PCI_Device
op_assign
id|Controller-&gt;Device
suffix:semicolon
id|ControllerInfo.PCI_Function
op_assign
id|Controller-&gt;Function
suffix:semicolon
id|ControllerInfo.IRQ_Channel
op_assign
id|Controller-&gt;IRQ_Channel
suffix:semicolon
id|ControllerInfo.PCI_Address
op_assign
id|Controller-&gt;PCI_Address
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.ModelName
comma
id|Controller-&gt;ModelName
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ControllerInfo.FirmwareVersion
comma
id|Controller-&gt;FirmwareVersion
)paren
suffix:semicolon
r_return
(paren
id|copy_to_user
c_func
(paren
id|UserSpaceControllerInfo
comma
op_amp
id|ControllerInfo
comma
r_sizeof
(paren
id|DAC960_ControllerInfo_T
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V1_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V1_UserCommand_T
op_star
id|UserSpaceUserCommand
op_assign
(paren
id|DAC960_V1_UserCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V1_UserCommand_T
id|UserCommand
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V1_CommandOpcode_T
id|CommandOpcode
suffix:semicolon
id|DAC960_V1_CommandStatus_T
id|CommandStatus
suffix:semicolon
id|DAC960_V1_DCDB_T
id|DCDB
suffix:semicolon
id|DAC960_V1_DCDB_T
op_star
id|DCDB_IOBUF
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|DCDB_IOBUFDMA
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|DataTransferBufferDMA
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceUserCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|UserCommand
comma
id|UserSpaceUserCommand
comma
r_sizeof
(paren
id|DAC960_V1_UserCommand_T
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure1a
suffix:semicolon
)brace
id|ControllerNumber
op_assign
id|UserCommand.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V1_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|CommandOpcode
op_assign
id|UserCommand.CommandMailbox.Common.CommandOpcode
suffix:semicolon
id|DataTransferLength
op_assign
id|UserCommand.DataTransferLength
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_amp
l_int|0x80
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|DCDB
comma
id|UserCommand.DCDB
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure1a
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DCDB.Channel
op_ge
id|DAC960_V1_MaxChannels
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|DataTransferLength
op_eq
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_NoDataTransfer
)paren
op_logical_or
(paren
id|DataTransferLength
OG
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_DataTransferDeviceToSystem
)paren
op_logical_or
(paren
id|DataTransferLength
OL
l_int|0
op_logical_and
id|DCDB.Direction
op_eq
id|DAC960_V1_DCDB_DataTransferSystemToDevice
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|DCDB.TransferLengthHigh4
op_lshift
l_int|16
)paren
op_or
id|DCDB.TransferLength
)paren
op_ne
id|abs
c_func
(paren
id|DataTransferLength
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DCDB_IOBUF
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
comma
op_amp
id|DCDB_IOBUFDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DCDB_IOBUF
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|DataTransferLength
comma
op_amp
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|Failure1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DataTransferLength
OL
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_minus
id|DataTransferLength
comma
op_amp
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|Failure1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|DataTransferBuffer
comma
id|UserCommand.DataTransferBuffer
comma
op_minus
id|DataTransferLength
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
)paren
suffix:semicolon
id|__wait_event
c_func
(paren
id|Controller-&gt;CommandWaitQueue
comma
op_logical_neg
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
)paren
suffix:semicolon
)brace
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|true
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|DCDB_IOBUFDMA
suffix:semicolon
id|DCDB.BusAddress
op_assign
id|DataTransferBufferDMA
suffix:semicolon
id|memcpy
c_func
(paren
id|DCDB_IOBUF
comma
op_amp
id|DCDB
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_V1_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|Command-&gt;V1.CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V1_CommandMailbox_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|Command-&gt;V1.CommandMailbox.Type3.BusAddress
op_assign
id|DataTransferBufferDMA
suffix:semicolon
)brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V1.CommandStatus
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|UserCommand.DataTransferBuffer
comma
id|DataTransferBuffer
comma
id|DataTransferLength
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|CommandOpcode
op_eq
id|DAC960_V1_DCDB
)paren
(brace
multiline_comment|/*&n;&t;      I don&squot;t believe Target or Channel in the DCDB_IOBUF&n;&t;      should be any different from the contents of DCDB.&n;&t;     */
id|Controller-&gt;V1.DirectCommandActive
(braket
id|DCDB.Channel
)braket
(braket
id|DCDB.TargetID
)braket
op_assign
l_bool|false
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|UserCommand.DCDB
comma
id|DCDB_IOBUF
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure1
suffix:semicolon
)brace
)brace
id|ErrorCode
op_assign
id|CommandStatus
suffix:semicolon
id|Failure1
suffix:colon
r_if
c_cond
(paren
id|DataTransferBuffer
op_ne
l_int|NULL
)paren
id|pci_free_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|abs
c_func
(paren
id|DataTransferLength
)paren
comma
id|DataTransferBuffer
comma
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DCDB_IOBUF
op_ne
l_int|NULL
)paren
id|pci_free_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
r_sizeof
(paren
id|DAC960_V1_DCDB_T
)paren
comma
id|DCDB_IOBUF
comma
id|DCDB_IOBUFDMA
)paren
suffix:semicolon
id|Failure1a
suffix:colon
r_return
id|ErrorCode
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V2_EXECUTE_COMMAND
suffix:colon
(brace
id|DAC960_V2_UserCommand_T
op_star
id|UserSpaceUserCommand
op_assign
(paren
id|DAC960_V2_UserCommand_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V2_UserCommand_T
id|UserCommand
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
id|DAC960_Command_T
op_star
id|Command
op_assign
l_int|NULL
suffix:semicolon
id|DAC960_V2_CommandMailbox_T
op_star
id|CommandMailbox
suffix:semicolon
id|DAC960_V2_CommandStatus_T
id|CommandStatus
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ControllerNumber
comma
id|DataTransferLength
suffix:semicolon
r_int
id|DataTransferResidue
comma
id|RequestSenseLength
suffix:semicolon
r_int
r_char
op_star
id|DataTransferBuffer
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|DataTransferBufferDMA
suffix:semicolon
r_int
r_char
op_star
id|RequestSenseBuffer
op_assign
l_int|NULL
suffix:semicolon
id|dma_addr_t
id|RequestSenseBufferDMA
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceUserCommand
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|UserCommand
comma
id|UserSpaceUserCommand
comma
r_sizeof
(paren
id|DAC960_V2_UserCommand_T
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2a
suffix:semicolon
)brace
id|ControllerNumber
op_assign
id|UserCommand.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V2_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DataTransferLength
op_assign
id|UserCommand.DataTransferLength
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|DataTransferLength
comma
op_amp
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|DataTransferBuffer
comma
l_int|0
comma
id|DataTransferLength
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|DataTransferLength
OL
l_int|0
)paren
(brace
id|DataTransferBuffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
op_minus
id|DataTransferLength
comma
op_amp
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferBuffer
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|DataTransferBuffer
comma
id|UserCommand.DataTransferBuffer
comma
op_minus
id|DataTransferLength
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
)brace
id|RequestSenseLength
op_assign
id|UserCommand.RequestSenseLength
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|RequestSenseBuffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|RequestSenseLength
comma
op_amp
id|RequestSenseBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseBuffer
op_eq
l_int|NULL
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
id|memset
c_func
(paren
id|RequestSenseBuffer
comma
l_int|0
comma
id|RequestSenseLength
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|Command
op_assign
id|DAC960_AllocateCommand
c_func
(paren
id|Controller
)paren
)paren
op_eq
l_int|NULL
)paren
id|DAC960_WaitForCommand
c_func
(paren
id|Controller
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_V2_ClearCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|Command-&gt;CommandType
op_assign
id|DAC960_ImmediateCommand
suffix:semicolon
id|CommandMailbox
op_assign
op_amp
id|Command-&gt;V2.CommandMailbox
suffix:semicolon
id|memcpy
c_func
(paren
id|CommandMailbox
comma
op_amp
id|UserCommand.CommandMailbox
comma
r_sizeof
(paren
id|DAC960_V2_CommandMailbox_T
)paren
)paren
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|AdditionalScatterGatherListMemory
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
l_int|0
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferPageNumber
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
comma
l_int|0
comma
r_sizeof
(paren
id|DAC960_V2_DataTransferMemoryAddress_T
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DataTransferLength
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|true
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
id|DataTransferLength
suffix:semicolon
)brace
r_else
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|DataTransferControllerToHost
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferSize
op_assign
op_minus
id|DataTransferLength
suffix:semicolon
)brace
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentDataPointer
op_assign
id|DataTransferBufferDMA
suffix:semicolon
id|CommandMailbox-&gt;Common.DataTransferMemoryAddress
dot
id|ScatterGatherSegments
(braket
l_int|0
)braket
dot
id|SegmentByteCount
op_assign
id|CommandMailbox-&gt;Common.DataTransferSize
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
id|CommandMailbox-&gt;Common.CommandControlBits
dot
id|NoAutoRequestSense
op_assign
l_bool|false
suffix:semicolon
id|CommandMailbox-&gt;Common.RequestSenseSize
op_assign
id|RequestSenseLength
suffix:semicolon
id|CommandMailbox-&gt;Common.RequestSenseBusAddress
op_assign
id|RequestSenseBufferDMA
suffix:semicolon
)brace
id|DAC960_ExecuteCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|CommandStatus
op_assign
id|Command-&gt;V2.CommandStatus
suffix:semicolon
id|RequestSenseLength
op_assign
id|Command-&gt;V2.RequestSenseLength
suffix:semicolon
id|DataTransferResidue
op_assign
id|Command-&gt;V2.DataTransferResidue
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
id|DAC960_DeallocateCommand
c_func
(paren
id|Command
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|Controller-&gt;queue_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseLength
OG
id|UserCommand.RequestSenseLength
)paren
id|RequestSenseLength
op_assign
id|UserCommand.RequestSenseLength
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|UserSpaceUserCommand-&gt;DataTransferLength
comma
op_amp
id|DataTransferResidue
comma
r_sizeof
(paren
id|DataTransferResidue
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|UserSpaceUserCommand-&gt;RequestSenseLength
comma
op_amp
id|RequestSenseLength
comma
r_sizeof
(paren
id|RequestSenseLength
)paren
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DataTransferLength
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|UserCommand.DataTransferBuffer
comma
id|DataTransferBuffer
comma
id|DataTransferLength
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|RequestSenseLength
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|UserCommand.RequestSenseBuffer
comma
id|RequestSenseBuffer
comma
id|RequestSenseLength
)paren
)paren
(brace
id|ErrorCode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|Failure2
suffix:semicolon
)brace
)brace
id|ErrorCode
op_assign
id|CommandStatus
suffix:semicolon
id|Failure2
suffix:colon
id|pci_free_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|abs
c_func
(paren
id|DataTransferLength
)paren
comma
id|DataTransferBuffer
comma
id|DataTransferBufferDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RequestSenseBuffer
op_ne
l_int|NULL
)paren
id|pci_free_consistent
c_func
(paren
id|Controller-&gt;PCIDevice
comma
id|RequestSenseLength
comma
id|RequestSenseBuffer
comma
id|RequestSenseBufferDMA
)paren
suffix:semicolon
id|Failure2a
suffix:colon
r_return
id|ErrorCode
suffix:semicolon
)brace
r_case
id|DAC960_IOCTL_V2_GET_HEALTH_STATUS
suffix:colon
(brace
id|DAC960_V2_GetHealthStatus_T
op_star
id|UserSpaceGetHealthStatus
op_assign
(paren
id|DAC960_V2_GetHealthStatus_T
op_star
)paren
id|Argument
suffix:semicolon
id|DAC960_V2_GetHealthStatus_T
id|GetHealthStatus
suffix:semicolon
id|DAC960_V2_HealthStatusBuffer_T
id|HealthStatusBuffer
suffix:semicolon
id|DAC960_Controller_T
op_star
id|Controller
suffix:semicolon
r_int
id|ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|UserSpaceGetHealthStatus
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|GetHealthStatus
comma
id|UserSpaceGetHealthStatus
comma
r_sizeof
(paren
id|DAC960_V2_GetHealthStatus_T
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ControllerNumber
op_assign
id|GetHealthStatus.ControllerNumber
suffix:semicolon
r_if
c_cond
(paren
id|ControllerNumber
template_param
id|DAC960_ControllerCount
op_minus
l_int|1
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|ControllerNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|Controller-&gt;FirmwareType
op_ne
id|DAC960_V2_Controller
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|HealthStatusBuffer
comma
id|GetHealthStatus.HealthStatusBuffer
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_while
c_loop
(paren
id|Controller-&gt;V2.HealthStatusBuffer-&gt;StatusChangeCounter
op_eq
id|HealthStatusBuffer.StatusChangeCounter
op_logical_and
id|Controller-&gt;V2.HealthStatusBuffer-&gt;NextEventSequenceNumber
op_eq
id|HealthStatusBuffer.NextEventSequenceNumber
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|Controller-&gt;HealthStatusWaitQueue
comma
id|DAC960_MonitoringTimerInterval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|GetHealthStatus.HealthStatusBuffer
comma
id|Controller-&gt;V2.HealthStatusBuffer
comma
r_sizeof
(paren
id|DAC960_V2_HealthStatusBuffer_T
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|DAC960_gam_fops
r_static
r_struct
id|file_operations
id|DAC960_gam_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|ioctl
op_assign
id|DAC960_gam_ioctl
)brace
suffix:semicolon
DECL|variable|DAC960_gam_dev
r_static
r_struct
id|miscdevice
id|DAC960_gam_dev
op_assign
(brace
id|DAC960_GAM_MINOR
comma
l_string|&quot;dac960_gam&quot;
comma
op_amp
id|DAC960_gam_fops
)brace
suffix:semicolon
DECL|function|DAC960_gam_init
r_static
r_int
id|DAC960_gam_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|misc_register
c_func
(paren
op_amp
id|DAC960_gam_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DAC960_gam: can&squot;t misc_register on minor %d&bslash;n&quot;
comma
id|DAC960_GAM_MINOR
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|DAC960_gam_cleanup
r_static
r_void
id|DAC960_gam_cleanup
c_func
(paren
r_void
)paren
(brace
id|misc_deregister
c_func
(paren
op_amp
id|DAC960_gam_dev
)paren
suffix:semicolon
)brace
macro_line|#endif /* DAC960_GAM_MINOR */
DECL|variable|DAC960_BA_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_BA_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_BA_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_V2_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_BA_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_BA_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_LP_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_LP_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_LP_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_LP_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_LP_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_LP_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_LA_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_LA_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_LA_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_V1_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_LA_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_LA_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_PG_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_PG_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_PG_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_V1_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_PG_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_PG_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_PD_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_PD_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_PD_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_V1_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_PD_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_PD_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_P_privdata
r_static
r_struct
id|DAC960_privdata
id|DAC960_P_privdata
op_assign
(brace
dot
id|HardwareType
op_assign
id|DAC960_P_Controller
comma
dot
id|FirmwareType
op_assign
id|DAC960_V1_Controller
comma
dot
id|InterruptHandler
op_assign
id|DAC960_P_InterruptHandler
comma
dot
id|MemoryWindowSize
op_assign
id|DAC960_PD_RegisterWindowSize
comma
)brace
suffix:semicolon
DECL|variable|DAC960_id_table
r_static
r_struct
id|pci_device_id
id|DAC960_id_table
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_BA
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_BA_privdata
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_LP
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_LP_privdata
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_DEC
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_DEC_21285
comma
dot
id|subvendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|subdevice
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_LA
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_LA_privdata
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_PG
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_PG_privdata
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_PD
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_PD_privdata
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_MYLEX
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_MYLEX_DAC960_P
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|DAC960_P_privdata
comma
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|DAC960_id_table
)paren
suffix:semicolon
DECL|variable|DAC960_pci_driver
r_static
r_struct
id|pci_driver
id|DAC960_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;DAC960&quot;
comma
dot
id|id_table
op_assign
id|DAC960_id_table
comma
dot
id|probe
op_assign
id|DAC960_Probe
comma
dot
id|remove
op_assign
id|DAC960_Remove
comma
)brace
suffix:semicolon
DECL|function|DAC960_init_module
r_static
r_int
id|DAC960_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|DAC960_pci_driver
)paren
suffix:semicolon
macro_line|#ifdef DAC960_GAM_MINOR
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|DAC960_gam_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
DECL|function|DAC960_cleanup_module
r_static
r_void
id|DAC960_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef DAC960_GAM_MINOR
id|DAC960_gam_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DAC960_ControllerCount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DAC960_Controller_T
op_star
id|Controller
op_assign
id|DAC960_Controllers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|Controller
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|DAC960_FinalizeController
c_func
(paren
id|Controller
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DAC960_ProcDirectoryEntry
op_ne
l_int|NULL
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;rd/status&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;rd&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|DAC960_ControllerCount
op_assign
l_int|0
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|DAC960_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|DAC960_init_module
id|module_init
c_func
(paren
id|DAC960_init_module
)paren
suffix:semicolon
DECL|variable|DAC960_cleanup_module
id|module_exit
c_func
(paren
id|DAC960_cleanup_module
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
