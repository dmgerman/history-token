multiline_comment|/*&n; * USB PhidgetInterfaceKit driver 1.0&n; *&n; * Copyright (C) 2004 Sean Young &lt;sean@mess.org&gt;&n; * Copyright (C) 2004 Greg Kroah-Hartman &lt;greg@kroah.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This is a driver for the USB PhidgetInterfaceKit.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Sean Young &lt;sean@mess.org&gt;&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;USB PhidgetInterfaceKit Driver&quot;
DECL|macro|USB_VENDOR_ID_GLAB
mdefine_line|#define USB_VENDOR_ID_GLAB&t;&t;0x06c2
DECL|macro|USB_DEVICE_ID_INTERFACEKIT004
mdefine_line|#define USB_DEVICE_ID_INTERFACEKIT004&t;0x0040
DECL|macro|USB_DEVICE_ID_INTERFACEKIT888
mdefine_line|#define USB_DEVICE_ID_INTERFACEKIT888&t;0x0045
DECL|macro|USB_DEVICE_ID_INTERFACEKIT047
mdefine_line|#define USB_DEVICE_ID_INTERFACEKIT047&t;0x0051
DECL|macro|USB_DEVICE_ID_INTERFACEKIT088
mdefine_line|#define USB_DEVICE_ID_INTERFACEKIT088&t;0x0053
DECL|macro|USB_VENDOR_ID_WISEGROUP
mdefine_line|#define USB_VENDOR_ID_WISEGROUP&t;&t;0x0925
DECL|macro|USB_DEVICE_ID_INTERFACEKIT884
mdefine_line|#define USB_DEVICE_ID_INTERFACEKIT884&t;0x8201
DECL|macro|MAX_INTERFACES
mdefine_line|#define MAX_INTERFACES&t;&t;&t;8
DECL|struct|driver_interfacekit
r_struct
id|driver_interfacekit
(brace
DECL|member|sensors
r_int
id|sensors
suffix:semicolon
DECL|member|inputs
r_int
id|inputs
suffix:semicolon
DECL|member|outputs
r_int
id|outputs
suffix:semicolon
DECL|member|has_lcd
r_int
id|has_lcd
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|ifkit
mdefine_line|#define ifkit(_sensors, _inputs, _outputs, _lcd)&t;&t;&t;&bslash;&n;static struct driver_interfacekit ph_##_sensors##_inputs##_outputs = {&t;&bslash;&n;&t;.sensors&t;= _sensors,&t;&t;&t;&t;&t;&bslash;&n;&t;.inputs&t;&t;= _inputs,&t;&t;&t;&t;&t;&bslash;&n;&t;.outputs&t;= _outputs,&t;&t;&t;&t;&t;&bslash;&n;&t;.has_lcd&t;= _lcd,&t;&t;&t;&t;&t;&t;&bslash;&n;};
id|ifkit
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|ifkit
c_func
(paren
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|0
)paren
suffix:semicolon
id|ifkit
c_func
(paren
l_int|0
comma
l_int|4
comma
l_int|7
comma
l_int|1
)paren
suffix:semicolon
id|ifkit
c_func
(paren
l_int|8
comma
l_int|8
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|ifkit
c_func
(paren
l_int|0
comma
l_int|8
comma
l_int|8
comma
l_int|1
)paren
suffix:semicolon
DECL|struct|phidget_interfacekit
r_struct
id|phidget_interfacekit
(brace
DECL|member|udev
r_struct
id|usb_device
op_star
id|udev
suffix:semicolon
DECL|member|intf
r_struct
id|usb_interface
op_star
id|intf
suffix:semicolon
DECL|member|ifkit
r_struct
id|driver_interfacekit
op_star
id|ifkit
suffix:semicolon
DECL|member|outputs
r_int
id|outputs
(braket
id|MAX_INTERFACES
)braket
suffix:semicolon
DECL|member|inputs
r_int
id|inputs
(braket
id|MAX_INTERFACES
)braket
suffix:semicolon
DECL|member|sensors
r_int
id|sensors
(braket
id|MAX_INTERFACES
)braket
suffix:semicolon
DECL|member|lcd_files_on
id|u8
id|lcd_files_on
suffix:semicolon
DECL|member|irq
r_struct
id|urb
op_star
id|irq
suffix:semicolon
DECL|member|data
r_int
r_char
op_star
id|data
suffix:semicolon
DECL|member|data_dma
id|dma_addr_t
id|data_dma
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|id_table
r_static
r_struct
id|usb_device_id
id|id_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_GLAB
comma
id|USB_DEVICE_ID_INTERFACEKIT004
)paren
comma
dot
id|driver_info
op_assign
(paren
id|kernel_ulong_t
)paren
op_amp
id|ph_004
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_GLAB
comma
id|USB_DEVICE_ID_INTERFACEKIT888
)paren
comma
dot
id|driver_info
op_assign
(paren
id|kernel_ulong_t
)paren
op_amp
id|ph_888
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_GLAB
comma
id|USB_DEVICE_ID_INTERFACEKIT047
)paren
comma
dot
id|driver_info
op_assign
(paren
id|kernel_ulong_t
)paren
op_amp
id|ph_047
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_GLAB
comma
id|USB_DEVICE_ID_INTERFACEKIT088
)paren
comma
dot
id|driver_info
op_assign
(paren
id|kernel_ulong_t
)paren
op_amp
id|ph_088
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_WISEGROUP
comma
id|USB_DEVICE_ID_INTERFACEKIT884
)paren
comma
dot
id|driver_info
op_assign
(paren
id|kernel_ulong_t
)paren
op_amp
id|ph_884
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|id_table
)paren
suffix:semicolon
DECL|function|change_outputs
r_static
r_int
id|change_outputs
c_func
(paren
r_struct
id|phidget_interfacekit
op_star
id|kit
comma
r_int
id|output_num
comma
r_int
id|enable
)paren
(brace
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|n
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|4
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;%s - out of memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|kit-&gt;outputs
(braket
id|output_num
)braket
op_assign
id|enable
suffix:semicolon
id|memset
c_func
(paren
id|buffer
comma
l_int|0
comma
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|8
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|kit-&gt;outputs
(braket
id|n
)braket
)paren
(brace
id|buffer
(braket
l_int|0
)braket
op_or_assign
l_int|1
op_lshift
id|n
suffix:semicolon
)brace
)brace
id|dev_dbg
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;data: %02x %02x&bslash;n&quot;
comma
id|buffer
(braket
l_int|0
)braket
comma
id|buffer
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|retval
op_assign
id|usb_control_msg
c_func
(paren
id|kit-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|kit-&gt;udev
comma
l_int|0
)paren
comma
l_int|0x09
comma
l_int|0x21
comma
l_int|0x0200
comma
l_int|0x0000
comma
id|buffer
comma
l_int|4
comma
l_int|2
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|4
)paren
id|dev_err
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|retval
OL
l_int|0
ques
c_cond
id|retval
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|change_string
r_static
r_int
id|change_string
c_func
(paren
r_struct
id|phidget_interfacekit
op_star
id|kit
comma
r_const
r_char
op_star
id|display
comma
r_int
r_char
id|row
)paren
(brace
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
r_char
op_star
id|form_buffer
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|len
comma
id|buf_ptr
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|form_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|30
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|buffer
)paren
op_logical_or
(paren
op_logical_neg
id|form_buffer
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;%s - out of memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|len
op_assign
id|strlen
c_func
(paren
id|display
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|20
)paren
id|len
op_assign
l_int|20
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;Setting LCD line %d to %s&bslash;n&quot;
comma
id|row
comma
id|display
)paren
suffix:semicolon
id|form_buffer
(braket
l_int|0
)braket
op_assign
id|row
op_star
l_int|0x40
op_plus
l_int|0x80
suffix:semicolon
id|form_buffer
(braket
l_int|1
)braket
op_assign
l_int|0x02
suffix:semicolon
id|buf_ptr
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|form_buffer
(braket
id|buf_ptr
op_increment
)braket
op_assign
id|display
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|20
op_minus
id|len
)paren
suffix:semicolon
id|i
op_increment
)paren
id|form_buffer
(braket
id|buf_ptr
op_increment
)braket
op_assign
l_int|0x20
suffix:semicolon
id|form_buffer
(braket
id|buf_ptr
op_increment
)braket
op_assign
l_int|0x01
suffix:semicolon
id|form_buffer
(braket
id|buf_ptr
op_increment
)braket
op_assign
id|row
op_star
l_int|0x40
op_plus
l_int|0x80
op_plus
id|strlen
c_func
(paren
id|display
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|buf_ptr
suffix:semicolon
id|i
op_add_assign
l_int|7
)paren
(brace
r_if
c_cond
(paren
(paren
id|buf_ptr
op_minus
id|i
)paren
OG
l_int|7
)paren
id|len
op_assign
l_int|7
suffix:semicolon
r_else
id|len
op_assign
(paren
id|buf_ptr
op_minus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
suffix:semicolon
id|j
op_increment
)paren
id|buffer
(braket
id|j
)braket
op_assign
id|form_buffer
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|buffer
(braket
l_int|7
)braket
op_assign
id|len
suffix:semicolon
id|retval
op_assign
id|usb_control_msg
c_func
(paren
id|kit-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|kit-&gt;udev
comma
l_int|0
)paren
comma
l_int|0x09
comma
l_int|0x21
comma
l_int|0x0200
comma
l_int|0x0000
comma
id|buffer
comma
l_int|8
comma
l_int|2
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
m_exit
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
m_exit
suffix:colon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|form_buffer
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|macro|set_lcd_line
mdefine_line|#define set_lcd_line(number)&t;&bslash;&n;static ssize_t lcd_line_##number(struct device *dev, const char *buf, size_t count)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct usb_interface *intf = to_usb_interface(dev);&t;&t;&t;&t;&bslash;&n;&t;struct phidget_interfacekit *kit = usb_get_intfdata(intf);&t;&t;&t;&bslash;&n;&t;change_string(kit, buf, number - 1);&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return count;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(lcd_line_##number, S_IWUGO, NULL, lcd_line_##number);
id|set_lcd_line
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_lcd_line
c_func
(paren
l_int|2
)paren
suffix:semicolon
DECL|function|set_backlight
r_static
id|ssize_t
id|set_backlight
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|phidget_interfacekit
op_star
id|kit
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|enabled
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;%s - out of memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|enabled
)paren
OL
l_int|1
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|memset
c_func
(paren
id|buffer
comma
l_int|0x00
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enabled
)paren
id|buffer
(braket
l_int|0
)braket
op_assign
l_int|0x01
suffix:semicolon
id|buffer
(braket
l_int|7
)braket
op_assign
l_int|0x11
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;Setting backlight to %s&bslash;n&quot;
comma
id|enabled
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|retval
op_assign
id|usb_control_msg
c_func
(paren
id|kit-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|kit-&gt;udev
comma
l_int|0
)paren
comma
l_int|0x09
comma
l_int|0x21
comma
l_int|0x0200
comma
l_int|0x0000
comma
id|buffer
comma
l_int|8
comma
l_int|2
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
m_exit
suffix:semicolon
id|retval
op_assign
id|count
suffix:semicolon
m_exit
suffix:colon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|backlight
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|set_backlight
)paren
suffix:semicolon
DECL|function|remove_lcd_files
r_static
r_void
id|remove_lcd_files
c_func
(paren
r_struct
id|phidget_interfacekit
op_star
id|kit
)paren
(brace
r_if
c_cond
(paren
id|kit-&gt;lcd_files_on
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;Removing lcd files&bslash;n&quot;
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_lcd_line_1
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_lcd_line_2
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_backlight
)paren
suffix:semicolon
)brace
)brace
DECL|function|enable_lcd_files
r_static
id|ssize_t
id|enable_lcd_files
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|phidget_interfacekit
op_star
id|kit
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|enable
suffix:semicolon
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;has_lcd
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
op_amp
id|enable
)paren
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|kit-&gt;lcd_files_on
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|kit-&gt;udev-&gt;dev
comma
l_string|&quot;Adding lcd files&bslash;n&quot;
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_lcd_line_1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_lcd_line_2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|kit-&gt;intf-&gt;dev
comma
op_amp
id|dev_attr_backlight
)paren
suffix:semicolon
id|kit-&gt;lcd_files_on
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|kit-&gt;lcd_files_on
)paren
(brace
id|remove_lcd_files
c_func
(paren
id|kit
)paren
suffix:semicolon
id|kit-&gt;lcd_files_on
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|lcd
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|enable_lcd_files
)paren
suffix:semicolon
DECL|function|interfacekit_irq
r_static
r_void
id|interfacekit_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|phidget_interfacekit
op_star
id|kit
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
r_char
op_star
id|buffer
op_assign
id|kit-&gt;data
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|n
suffix:semicolon
r_switch
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* success */
r_break
suffix:semicolon
r_case
op_minus
id|ECONNRESET
suffix:colon
multiline_comment|/* unlink */
r_case
op_minus
id|ENOENT
suffix:colon
r_case
op_minus
id|ESHUTDOWN
suffix:colon
r_return
suffix:semicolon
multiline_comment|/* -EPIPE:  should clear the halt */
r_default
suffix:colon
multiline_comment|/* error */
r_goto
id|resubmit
suffix:semicolon
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|8
suffix:semicolon
id|n
op_increment
)paren
(brace
id|kit-&gt;inputs
(braket
id|n
)braket
op_assign
id|buffer
(braket
l_int|1
)braket
op_amp
(paren
l_int|1
op_lshift
id|n
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
op_amp
l_int|1
)paren
(brace
id|kit-&gt;sensors
(braket
l_int|4
)braket
op_assign
id|buffer
(braket
l_int|2
)braket
op_plus
(paren
id|buffer
(braket
l_int|3
)braket
op_amp
l_int|0x0f
)paren
op_star
l_int|256
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|5
)braket
op_assign
id|buffer
(braket
l_int|4
)braket
op_plus
(paren
id|buffer
(braket
l_int|3
)braket
op_amp
l_int|0xf0
)paren
op_star
l_int|16
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|6
)braket
op_assign
id|buffer
(braket
l_int|5
)braket
op_plus
(paren
id|buffer
(braket
l_int|6
)braket
op_amp
l_int|0x0f
)paren
op_star
l_int|256
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|7
)braket
op_assign
id|buffer
(braket
l_int|7
)braket
op_plus
(paren
id|buffer
(braket
l_int|6
)braket
op_amp
l_int|0xf0
)paren
op_star
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|kit-&gt;sensors
(braket
l_int|0
)braket
op_assign
id|buffer
(braket
l_int|2
)braket
op_plus
(paren
id|buffer
(braket
l_int|3
)braket
op_amp
l_int|0x0f
)paren
op_star
l_int|256
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|1
)braket
op_assign
id|buffer
(braket
l_int|4
)braket
op_plus
(paren
id|buffer
(braket
l_int|3
)braket
op_amp
l_int|0xf0
)paren
op_star
l_int|16
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|2
)braket
op_assign
id|buffer
(braket
l_int|5
)braket
op_plus
(paren
id|buffer
(braket
l_int|6
)braket
op_amp
l_int|0x0f
)paren
op_star
l_int|256
suffix:semicolon
id|kit-&gt;sensors
(braket
l_int|3
)braket
op_assign
id|buffer
(braket
l_int|7
)braket
op_plus
(paren
id|buffer
(braket
l_int|6
)braket
op_amp
l_int|0xf0
)paren
op_star
l_int|16
suffix:semicolon
)brace
id|resubmit
suffix:colon
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|SLAB_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|err
c_func
(paren
l_string|&quot;can&squot;t resubmit intr, %s-%s/interfacekit0, status %d&quot;
comma
id|kit-&gt;udev-&gt;bus-&gt;bus_name
comma
id|kit-&gt;udev-&gt;devpath
comma
id|status
)paren
suffix:semicolon
)brace
DECL|macro|show_set_output
mdefine_line|#define show_set_output(value)&t;&t;&bslash;&n;static ssize_t set_output##value(struct device *dev, const char *buf, &t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;size_t count)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct usb_interface *intf = to_usb_interface(dev);&t;&t;&bslash;&n;&t;struct phidget_interfacekit *kit = usb_get_intfdata(intf);&t;&bslash;&n;&t;int enabled;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int retval;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (sscanf(buf, &quot;%d&quot;, &amp;enabled) &lt; 1) {&t;&t;&t;&t;&bslash;&n;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;retval = change_outputs(kit, value - 1, enabled ? 1 : 0);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return retval ? retval : count;&t;&t;&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_output##value(struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct usb_interface *intf = to_usb_interface(dev);&t;&t;&bslash;&n;&t;struct phidget_interfacekit *kit = usb_get_intfdata(intf);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, kit-&gt;outputs[value - 1 ]);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(output##value, S_IWUGO | S_IRUGO,&t;&t;&t;&bslash;&n;&t;&t;show_output##value, set_output##value);
id|show_set_output
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|show_set_output
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* should be MAX_INTERFACES - 1 */
DECL|macro|show_input
mdefine_line|#define show_input(value)&t;&bslash;&n;static ssize_t show_input##value(struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct usb_interface *intf = to_usb_interface(dev);&t;&t;&bslash;&n;&t;struct phidget_interfacekit *kit = usb_get_intfdata(intf);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, kit-&gt;inputs[value - 1]);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(input##value, S_IRUGO, show_input##value, NULL);
id|show_input
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|show_input
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* should be MAX_INTERFACES - 1 */
DECL|macro|show_sensor
mdefine_line|#define show_sensor(value)&t;&bslash;&n;static ssize_t show_sensor##value(struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct usb_interface *intf = to_usb_interface(dev);&t;&t;&bslash;&n;&t;struct phidget_interfacekit *kit = usb_get_intfdata(intf);&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, kit-&gt;sensors[value - 1]);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(sensor##value, S_IRUGO, show_sensor##value, NULL);
id|show_sensor
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|show_sensor
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* should be MAX_INTERFACES - 1 */
DECL|function|interfacekit_probe
r_static
r_int
id|interfacekit_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|usb_host_interface
op_star
id|interface
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint
suffix:semicolon
r_struct
id|phidget_interfacekit
op_star
id|kit
suffix:semicolon
r_struct
id|driver_interfacekit
op_star
id|ifkit
suffix:semicolon
r_int
id|pipe
comma
id|maxp
suffix:semicolon
id|ifkit
op_assign
(paren
r_struct
id|driver_interfacekit
op_star
)paren
id|id-&gt;driver_info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ifkit
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|interface
op_assign
id|intf-&gt;cur_altsetting
suffix:semicolon
r_if
c_cond
(paren
id|interface-&gt;desc.bNumEndpoints
op_ne
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|endpoint
op_assign
op_amp
id|interface-&gt;endpoint
(braket
l_int|0
)braket
dot
id|desc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|endpoint-&gt;bEndpointAddress
op_amp
l_int|0x80
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t; * bmAttributes&n;&t; */
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|dev
comma
id|endpoint-&gt;bEndpointAddress
)paren
suffix:semicolon
id|maxp
op_assign
id|usb_maxpacket
c_func
(paren
id|dev
comma
id|pipe
comma
id|usb_pipeout
c_func
(paren
id|pipe
)paren
)paren
suffix:semicolon
id|kit
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|kit
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kit
op_eq
l_int|NULL
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|intf-&gt;dev
comma
l_string|&quot;%s - out of memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|kit
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|kit
)paren
)paren
suffix:semicolon
id|kit-&gt;ifkit
op_assign
id|ifkit
suffix:semicolon
id|kit-&gt;data
op_assign
id|usb_buffer_alloc
c_func
(paren
id|dev
comma
l_int|8
comma
id|SLAB_ATOMIC
comma
op_amp
id|kit-&gt;data_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kit-&gt;data
)paren
(brace
id|kfree
c_func
(paren
id|kit
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|kit-&gt;irq
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kit-&gt;irq
)paren
(brace
id|usb_buffer_free
c_func
(paren
id|dev
comma
l_int|8
comma
id|kit-&gt;data
comma
id|kit-&gt;data_dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|kit
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|kit-&gt;udev
op_assign
id|usb_get_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kit-&gt;intf
op_assign
id|intf
suffix:semicolon
id|usb_fill_int_urb
c_func
(paren
id|kit-&gt;irq
comma
id|kit-&gt;udev
comma
id|pipe
comma
id|kit-&gt;data
comma
(paren
id|maxp
OG
l_int|8
ques
c_cond
l_int|8
suffix:colon
id|maxp
)paren
comma
id|interfacekit_irq
comma
id|kit
comma
id|endpoint-&gt;bInterval
)paren
suffix:semicolon
id|kit-&gt;irq-&gt;transfer_dma
op_assign
id|kit-&gt;data_dma
suffix:semicolon
id|kit-&gt;irq-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|kit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
id|kit-&gt;irq
comma
id|GFP_KERNEL
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;outputs
op_eq
l_int|8
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output3
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output4
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output5
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output6
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output7
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_output8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;inputs
op_ge
l_int|4
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input3
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input4
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;inputs
op_eq
l_int|8
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input5
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input6
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input7
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_input8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;sensors
op_ge
l_int|4
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor3
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor4
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;sensors
op_ge
l_int|7
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor5
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor6
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor7
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;sensors
op_eq
l_int|8
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_sensor8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifkit-&gt;has_lcd
)paren
id|device_create_file
c_func
(paren
op_amp
id|intf-&gt;dev
comma
op_amp
id|dev_attr_lcd
)paren
suffix:semicolon
id|dev_info
c_func
(paren
op_amp
id|intf-&gt;dev
comma
l_string|&quot;USB PhidgetInterfaceKit %d/%d/%d attached&bslash;n&quot;
comma
id|ifkit-&gt;inputs
comma
id|ifkit-&gt;outputs
comma
id|ifkit-&gt;sensors
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|interfacekit_disconnect
r_static
r_void
id|interfacekit_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
)paren
(brace
r_struct
id|phidget_interfacekit
op_star
id|kit
suffix:semicolon
id|kit
op_assign
id|usb_get_intfdata
c_func
(paren
id|interface
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|interface
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kit
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;outputs
op_eq
id|MAX_INTERFACES
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output1
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output2
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output3
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output4
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output5
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output6
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output7
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_output7
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;inputs
op_ge
l_int|4
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input1
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input2
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input3
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input4
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;inputs
op_eq
l_int|8
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input5
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input6
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input7
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_input8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;sensors
op_ge
l_int|4
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor1
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor2
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor3
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor4
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;sensors
op_ge
l_int|7
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor5
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor6
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor7
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;sensors
op_eq
l_int|8
)paren
(brace
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_sensor8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kit-&gt;ifkit-&gt;has_lcd
)paren
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_lcd
)paren
suffix:semicolon
id|dev_info
c_func
(paren
op_amp
id|interface-&gt;dev
comma
l_string|&quot;USB PhidgetInterfaceKit %d/%d/%d detached&bslash;n&quot;
comma
id|kit-&gt;ifkit-&gt;inputs
comma
id|kit-&gt;ifkit-&gt;outputs
comma
id|kit-&gt;ifkit-&gt;sensors
)paren
suffix:semicolon
id|usb_kill_urb
c_func
(paren
id|kit-&gt;irq
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|kit-&gt;irq
)paren
suffix:semicolon
id|usb_buffer_free
c_func
(paren
id|kit-&gt;udev
comma
l_int|8
comma
id|kit-&gt;data
comma
id|kit-&gt;data_dma
)paren
suffix:semicolon
id|usb_put_dev
c_func
(paren
id|kit-&gt;udev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|kit
)paren
suffix:semicolon
)brace
DECL|variable|interfacekit_driver
r_static
r_struct
id|usb_driver
id|interfacekit_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;phidgetkit&quot;
comma
dot
id|probe
op_assign
id|interfacekit_probe
comma
dot
id|disconnect
op_assign
id|interfacekit_disconnect
comma
dot
id|id_table
op_assign
id|id_table
)brace
suffix:semicolon
DECL|function|interfacekit_init
r_static
r_int
id|__init
id|interfacekit_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
id|usb_register
c_func
(paren
op_amp
id|interfacekit_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|err
c_func
(paren
l_string|&quot;usb_register failed. Error number %d&quot;
comma
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|interfacekit_exit
r_static
r_void
id|__exit
id|interfacekit_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|interfacekit_driver
)paren
suffix:semicolon
)brace
DECL|variable|interfacekit_init
id|module_init
c_func
(paren
id|interfacekit_init
)paren
suffix:semicolon
DECL|variable|interfacekit_exit
id|module_exit
c_func
(paren
id|interfacekit_exit
)paren
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
