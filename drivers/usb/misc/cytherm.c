multiline_comment|/* -*- linux-c -*-&n; * Cypress USB Thermometer driver &n; * &n; * Copyright (c) 2004 Erik Rigtorp &lt;erkki@linux.nu&gt; &lt;erik@rigtorp.com&gt;&n; * &n; * This driver works with Elektor magazine USB Interface as published in &n; * issue #291. It should also work with the original starter kit/demo board&n; * from Cypress.&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License as&n; * published by the Free Software Foundation, version 2.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;v1.0&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Erik Rigtorp&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;Cypress USB Thermometer driver&quot;
DECL|macro|USB_SKEL_VENDOR_ID
mdefine_line|#define USB_SKEL_VENDOR_ID&t;0x04b4
DECL|macro|USB_SKEL_PRODUCT_ID
mdefine_line|#define USB_SKEL_PRODUCT_ID&t;0x0002
DECL|variable|id_table
r_static
r_struct
id|usb_device_id
id|id_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|USB_SKEL_VENDOR_ID
comma
id|USB_SKEL_PRODUCT_ID
)paren
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|id_table
)paren
suffix:semicolon
multiline_comment|/* Structure to hold all of our device specific stuff */
DECL|struct|usb_cytherm
r_struct
id|usb_cytherm
(brace
DECL|member|udev
r_struct
id|usb_device
op_star
id|udev
suffix:semicolon
multiline_comment|/* save off the usb device pointer */
DECL|member|interface
r_struct
id|usb_interface
op_star
id|interface
suffix:semicolon
multiline_comment|/* the interface for this device */
DECL|member|brightness
r_int
id|brightness
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* local function prototypes */
r_static
r_int
id|cytherm_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
suffix:semicolon
r_static
r_void
id|cytherm_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
)paren
suffix:semicolon
multiline_comment|/* usb specific object needed to register this driver with the usb subsystem */
DECL|variable|cytherm_driver
r_static
r_struct
id|usb_driver
id|cytherm_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;cytherm&quot;
comma
dot
id|probe
op_assign
id|cytherm_probe
comma
dot
id|disconnect
op_assign
id|cytherm_disconnect
comma
dot
id|id_table
op_assign
id|id_table
comma
)brace
suffix:semicolon
multiline_comment|/* Vendor requests */
multiline_comment|/* They all operate on one byte at a time */
DECL|macro|PING
mdefine_line|#define PING       0x00
DECL|macro|READ_ROM
mdefine_line|#define READ_ROM   0x01 /* Reads form ROM, value = address */
DECL|macro|READ_RAM
mdefine_line|#define READ_RAM   0x02 /* Reads form RAM, value = address */
DECL|macro|WRITE_RAM
mdefine_line|#define WRITE_RAM  0x03 /* Write to RAM, value = address, index = data */
DECL|macro|READ_PORT
mdefine_line|#define READ_PORT  0x04 /* Reads from port, value = address */
DECL|macro|WRITE_PORT
mdefine_line|#define WRITE_PORT 0x05 /* Write to port, value = address, index = data */ 
multiline_comment|/* Send a vendor command to device */
DECL|function|vendor_command
r_static
r_int
id|vendor_command
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_char
id|request
comma
r_int
r_char
id|value
comma
r_int
r_char
id|index
comma
r_void
op_star
id|buf
comma
r_int
id|size
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|request
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_OTHER
comma
id|value
comma
id|index
comma
id|buf
comma
id|size
comma
id|HZ
op_star
id|USB_CTRL_GET_TIMEOUT
)paren
suffix:semicolon
)brace
DECL|macro|BRIGHTNESS
mdefine_line|#define BRIGHTNESS 0x2c     /* RAM location for brightness value */
DECL|macro|BRIGHTNESS_SEM
mdefine_line|#define BRIGHTNESS_SEM 0x2b /* RAM location for brightness semaphore */
DECL|function|show_brightness
r_static
id|ssize_t
id|show_brightness
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%i&quot;
comma
id|cytherm-&gt;brightness
)paren
suffix:semicolon
)brace
DECL|function|set_brightness
r_static
id|ssize_t
id|set_brightness
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cytherm-&gt;brightness
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cytherm-&gt;brightness
OG
l_int|0xFF
)paren
id|cytherm-&gt;brightness
op_assign
l_int|0xFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cytherm-&gt;brightness
OL
l_int|0
)paren
id|cytherm-&gt;brightness
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set brightness */
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|WRITE_RAM
comma
id|BRIGHTNESS
comma
id|cytherm-&gt;brightness
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
multiline_comment|/* Inform &#xfffd;C that we have changed the brightness setting */
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|WRITE_RAM
comma
id|BRIGHTNESS_SEM
comma
l_int|0x01
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|brightness
comma
id|S_IRUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
id|show_brightness
comma
id|set_brightness
)paren
suffix:semicolon
DECL|macro|TEMP
mdefine_line|#define TEMP 0x33 /* RAM location for temperature */
DECL|macro|SIGN
mdefine_line|#define SIGN 0x34 /* RAM location for temperature sign */
DECL|function|show_temp
r_static
id|ssize_t
id|show_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|temp
comma
id|sign
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* read temperature */
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|READ_RAM
comma
id|TEMP
comma
l_int|0
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|temp
op_assign
id|buffer
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* read sign */
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|READ_RAM
comma
id|SIGN
comma
l_int|0
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|sign
op_assign
id|buffer
(braket
l_int|1
)braket
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%c%i.%i&quot;
comma
id|sign
ques
c_cond
l_char|&squot;-&squot;
suffix:colon
l_char|&squot;+&squot;
comma
id|temp
op_rshift
l_int|1
comma
l_int|5
op_star
(paren
id|temp
op_minus
(paren
(paren
id|temp
op_rshift
l_int|1
)paren
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp
r_static
id|ssize_t
id|set_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp
comma
id|S_IRUGO
comma
id|show_temp
comma
id|set_temp
)paren
suffix:semicolon
DECL|macro|BUTTON
mdefine_line|#define BUTTON 0x7a
DECL|function|show_button
r_static
id|ssize_t
id|show_button
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check button */
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|READ_RAM
comma
id|BUTTON
comma
l_int|0
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|retval
op_assign
id|buffer
(braket
l_int|1
)braket
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;1&quot;
)paren
suffix:semicolon
r_else
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0&quot;
)paren
suffix:semicolon
)brace
DECL|function|set_button
r_static
id|ssize_t
id|set_button
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|button
comma
id|S_IRUGO
comma
id|show_button
comma
id|set_button
)paren
suffix:semicolon
DECL|function|show_port0
r_static
id|ssize_t
id|show_port0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|READ_PORT
comma
l_int|0
comma
l_int|0
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|retval
op_assign
id|buffer
(braket
l_int|1
)braket
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
id|retval
)paren
suffix:semicolon
)brace
DECL|function|set_port0
r_static
id|ssize_t
id|set_port0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|tmp
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OG
l_int|0xFF
)paren
id|tmp
op_assign
l_int|0xFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
OL
l_int|0
)paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|WRITE_PORT
comma
l_int|0
comma
id|tmp
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|port0
comma
id|S_IRUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
id|show_port0
comma
id|set_port0
)paren
suffix:semicolon
DECL|function|show_port1
r_static
id|ssize_t
id|show_port1
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|READ_PORT
comma
l_int|1
comma
l_int|0
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|retval
op_assign
id|buffer
(braket
l_int|1
)braket
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&quot;
comma
id|retval
)paren
suffix:semicolon
)brace
DECL|function|set_port1
r_static
id|ssize_t
id|set_port1
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|usb_interface
op_star
id|intf
op_assign
id|to_usb_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|cytherm
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|cytherm-&gt;udev-&gt;dev
comma
l_string|&quot;out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|tmp
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OG
l_int|0xFF
)paren
id|tmp
op_assign
l_int|0xFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
OL
l_int|0
)paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
id|vendor_command
c_func
(paren
id|cytherm-&gt;udev
comma
id|WRITE_PORT
comma
l_int|1
comma
id|tmp
comma
id|buffer
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_dbg
c_func
(paren
op_amp
id|led-&gt;udev-&gt;dev
comma
l_string|&quot;retval = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|port1
comma
id|S_IRUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
id|show_port1
comma
id|set_port1
)paren
suffix:semicolon
DECL|function|cytherm_probe
r_static
r_int
id|cytherm_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|interface
)paren
suffix:semicolon
r_struct
id|usb_cytherm
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|dev
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|usb_cytherm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|dev_err
(paren
op_amp
id|interface-&gt;dev
comma
l_string|&quot;Out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|memset
(paren
id|dev
comma
l_int|0x00
comma
r_sizeof
(paren
op_star
id|dev
)paren
)paren
suffix:semicolon
id|dev-&gt;udev
op_assign
id|usb_get_dev
c_func
(paren
id|udev
)paren
suffix:semicolon
id|usb_set_intfdata
(paren
id|interface
comma
id|dev
)paren
suffix:semicolon
id|dev-&gt;brightness
op_assign
l_int|0xFF
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_brightness
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_button
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_port0
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_port1
)paren
suffix:semicolon
id|dev_info
(paren
op_amp
id|interface-&gt;dev
comma
l_string|&quot;Cypress thermometer device now attached&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|cytherm_disconnect
r_static
r_void
id|cytherm_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
)paren
(brace
r_struct
id|usb_cytherm
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|usb_get_intfdata
(paren
id|interface
)paren
suffix:semicolon
id|usb_set_intfdata
(paren
id|interface
comma
l_int|NULL
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_brightness
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_temp
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_button
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_port0
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|interface-&gt;dev
comma
op_amp
id|dev_attr_port1
)paren
suffix:semicolon
id|usb_put_dev
c_func
(paren
id|dev-&gt;udev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_info
c_func
(paren
op_amp
id|interface-&gt;dev
comma
l_string|&quot;Cypress thermometer now disconnected&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|usb_cytherm_init
r_static
r_int
id|__init
id|usb_cytherm_init
c_func
(paren
r_void
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|usb_register
c_func
(paren
op_amp
id|cytherm_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|err
c_func
(paren
l_string|&quot;usb_register failed. Error number %d&quot;
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|info
c_func
(paren
id|DRIVER_VERSION
l_string|&quot;:&quot;
id|DRIVER_DESC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_cytherm_exit
r_static
r_void
id|__exit
id|usb_cytherm_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|cytherm_driver
)paren
suffix:semicolon
)brace
DECL|variable|usb_cytherm_init
id|module_init
(paren
id|usb_cytherm_init
)paren
suffix:semicolon
DECL|variable|usb_cytherm_exit
id|module_exit
(paren
id|usb_cytherm_exit
)paren
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
