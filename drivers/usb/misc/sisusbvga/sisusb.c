multiline_comment|/*&n; * sisusb - usb kernel driver for SiS315(E) based USB2VGA dongles&n; *&n; * Copyright (C) 2005 by Thomas Winischhofer, Vienna, Austria&n; *&n; * If distributed as part of the Linux kernel, this code is licensed under the&n; * terms of the GPL v2.&n; *&n; * Otherwise, the following license terms apply:&n; *&n; * * Redistribution and use in source and binary forms, with or without&n; * * modification, are permitted provided that the following conditions&n; * * are met:&n; * * 1) Redistributions of source code must retain the above copyright&n; * *    notice, this list of conditions and the following disclaimer.&n; * * 2) Redistributions in binary form must reproduce the above copyright&n; * *    notice, this list of conditions and the following disclaimer in the&n; * *    documentation and/or other materials provided with the distribution.&n; * * 3) The name of the author may not be used to endorse or promote products&n; * *    derived from this software without specific psisusbr written permission.&n; * *&n; * * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&squot;&squot; AND ANY EXPRESSED OR&n; * * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES&n; * * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&n; * * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; * * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; * * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,&n; * * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY&n; * * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT&n; * * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; * * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * Author: &t;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/kref.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &quot;sisusb.h&quot;
DECL|macro|SISUSB_DONTSYNC
mdefine_line|#define SISUSB_DONTSYNC
multiline_comment|/* Forward declarations / clean-up routines */
DECL|variable|sisusb_driver
r_static
r_struct
id|usb_driver
id|sisusb_driver
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|disconnect_sem
)paren
suffix:semicolon
r_static
r_void
DECL|function|sisusb_free_buffers
id|sisusb_free_buffers
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMOBUFS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sisusb-&gt;obuf
(braket
id|i
)braket
)paren
(brace
id|usb_buffer_free
c_func
(paren
id|sisusb-&gt;sisusb_dev
comma
id|sisusb-&gt;obufsize
comma
id|sisusb-&gt;obuf
(braket
id|i
)braket
comma
id|sisusb-&gt;transfer_dma_out
(braket
id|i
)braket
)paren
suffix:semicolon
id|sisusb-&gt;obuf
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sisusb-&gt;ibuf
)paren
(brace
id|usb_buffer_free
c_func
(paren
id|sisusb-&gt;sisusb_dev
comma
id|sisusb-&gt;ibufsize
comma
id|sisusb-&gt;ibuf
comma
id|sisusb-&gt;transfer_dma_in
)paren
suffix:semicolon
id|sisusb-&gt;ibuf
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|sisusb_free_urbs
id|sisusb_free_urbs
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMOBUFS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|usb_free_urb
c_func
(paren
id|sisusb-&gt;sisurbout
(braket
id|i
)braket
)paren
suffix:semicolon
id|sisusb-&gt;sisurbout
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|usb_free_urb
c_func
(paren
id|sisusb-&gt;sisurbin
)paren
suffix:semicolon
id|sisusb-&gt;sisurbin
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Level 0: USB transport layer */
multiline_comment|/* 1. out-bulks */
multiline_comment|/* out-urb management */
multiline_comment|/* Return 1 if all free, 0 otherwise */
r_static
r_int
DECL|function|sisusb_all_free
id|sisusb_all_free
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sisusb-&gt;numobufs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sisusb-&gt;urbstatus
(braket
id|i
)braket
op_amp
id|SU_URB_BUSY
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Kill all busy URBs */
r_static
r_void
DECL|function|sisusb_kill_all_busy
id|sisusb_kill_all_busy
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|sisusb_all_free
c_func
(paren
id|sisusb
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sisusb-&gt;numobufs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sisusb-&gt;urbstatus
(braket
id|i
)braket
op_amp
id|SU_URB_BUSY
)paren
id|usb_kill_urb
c_func
(paren
id|sisusb-&gt;sisurbout
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Return 1 if ok, 0 if error (not all complete within timeout) */
r_static
r_int
DECL|function|sisusb_wait_all_out_complete
id|sisusb_wait_all_out_complete
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|timeout
op_assign
l_int|5
op_star
id|HZ
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|wait_event_timeout
c_func
(paren
id|sisusb-&gt;wait_q
comma
(paren
id|i
op_assign
id|sisusb_all_free
c_func
(paren
id|sisusb
)paren
)paren
comma
id|timeout
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_outurb_available
id|sisusb_outurb_available
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sisusb-&gt;numobufs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|sisusb-&gt;urbstatus
(braket
id|i
)braket
op_amp
(paren
id|SU_URB_BUSY
op_or
id|SU_URB_ALLOC
)paren
)paren
op_eq
l_int|0
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_get_free_outbuf
id|sisusb_get_free_outbuf
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
comma
id|timeout
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
id|wait_event_timeout
c_func
(paren
id|sisusb-&gt;wait_q
comma
(paren
(paren
id|i
op_assign
id|sisusb_outurb_available
c_func
(paren
id|sisusb
)paren
)paren
op_ge
l_int|0
)paren
comma
id|timeout
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_alloc_outbuf
id|sisusb_alloc_outbuf
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|sisusb_outurb_available
c_func
(paren
id|sisusb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|0
)paren
id|sisusb-&gt;urbstatus
(braket
id|i
)braket
op_or_assign
id|SU_URB_ALLOC
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisusb_free_outbuf
id|sisusb_free_outbuf
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|index
)paren
(brace
r_if
c_cond
(paren
(paren
id|index
op_ge
l_int|0
)paren
op_logical_and
(paren
id|index
OL
id|sisusb-&gt;numobufs
)paren
)paren
id|sisusb-&gt;urbstatus
(braket
id|index
)braket
op_and_assign
op_complement
id|SU_URB_ALLOC
suffix:semicolon
)brace
multiline_comment|/* completion callback */
r_static
r_void
DECL|function|sisusb_bulk_completeout
id|sisusb_bulk_completeout
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sisusb_urb_context
op_star
id|context
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|context
)paren
r_return
suffix:semicolon
id|sisusb
op_assign
id|context-&gt;sisusb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisusb
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
op_logical_or
op_logical_neg
id|sisusb-&gt;present
)paren
r_return
suffix:semicolon
macro_line|#ifndef SISUSB_DONTSYNC
r_if
c_cond
(paren
id|context-&gt;actual_length
)paren
op_star
(paren
id|context-&gt;actual_length
)paren
op_add_assign
id|urb-&gt;actual_length
suffix:semicolon
macro_line|#endif
id|sisusb-&gt;urbstatus
(braket
id|context-&gt;urbindex
)braket
op_and_assign
op_complement
id|SU_URB_BUSY
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|sisusb-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_bulkout_msg
id|sisusb_bulkout_msg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|index
comma
r_int
r_int
id|pipe
comma
r_void
op_star
id|data
comma
r_int
id|len
comma
r_int
op_star
id|actual_length
comma
r_int
id|timeout
comma
r_int
r_int
id|tflags
comma
id|dma_addr_t
id|transfer_dma
)paren
(brace
r_struct
id|urb
op_star
id|urb
op_assign
id|sisusb-&gt;sisurbout
(braket
id|index
)braket
suffix:semicolon
r_int
id|retval
comma
id|byteswritten
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set up URB */
id|urb-&gt;transfer_flags
op_assign
l_int|0
suffix:semicolon
id|usb_fill_bulk_urb
c_func
(paren
id|urb
comma
id|sisusb-&gt;sisusb_dev
comma
id|pipe
comma
id|data
comma
id|len
comma
id|sisusb_bulk_completeout
comma
op_amp
id|sisusb-&gt;urbout_context
(braket
id|index
)braket
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_or_assign
(paren
id|tflags
op_or
id|URB_ASYNC_UNLINK
)paren
suffix:semicolon
id|urb-&gt;actual_length
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|urb-&gt;transfer_dma
op_assign
id|transfer_dma
)paren
)paren
id|urb-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
multiline_comment|/* Set up context */
id|sisusb-&gt;urbout_context
(braket
id|index
)braket
dot
id|actual_length
op_assign
(paren
id|timeout
)paren
ques
c_cond
l_int|NULL
suffix:colon
id|actual_length
suffix:semicolon
multiline_comment|/* Declare this urb/buffer in use */
id|sisusb-&gt;urbstatus
(braket
id|index
)braket
op_or_assign
id|SU_URB_BUSY
suffix:semicolon
multiline_comment|/* Submit URB */
id|retval
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
multiline_comment|/* If OK, and if timeout &gt; 0, wait for completion */
r_if
c_cond
(paren
(paren
id|retval
op_eq
l_int|0
)paren
op_logical_and
id|timeout
)paren
(brace
id|wait_event_timeout
c_func
(paren
id|sisusb-&gt;wait_q
comma
(paren
op_logical_neg
(paren
id|sisusb-&gt;urbstatus
(braket
id|index
)braket
op_amp
id|SU_URB_BUSY
)paren
)paren
comma
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisusb-&gt;urbstatus
(braket
id|index
)braket
op_amp
id|SU_URB_BUSY
)paren
(brace
multiline_comment|/* URB timed out... kill it and report error */
id|usb_kill_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Otherwise, report urb status */
id|retval
op_assign
id|urb-&gt;status
suffix:semicolon
id|byteswritten
op_assign
id|urb-&gt;actual_length
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|actual_length
)paren
op_star
id|actual_length
op_assign
id|byteswritten
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* 2. in-bulks */
multiline_comment|/* completion callback */
r_static
r_void
DECL|function|sisusb_bulk_completein
id|sisusb_bulk_completein
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisusb
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
op_logical_or
op_logical_neg
id|sisusb-&gt;present
)paren
r_return
suffix:semicolon
id|sisusb-&gt;completein
op_assign
l_int|1
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|sisusb-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_bulkin_msg
id|sisusb_bulkin_msg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
r_int
id|pipe
comma
r_void
op_star
id|data
comma
r_int
id|len
comma
r_int
op_star
id|actual_length
comma
r_int
id|timeout
comma
r_int
r_int
id|tflags
comma
id|dma_addr_t
id|transfer_dma
)paren
(brace
r_struct
id|urb
op_star
id|urb
op_assign
id|sisusb-&gt;sisurbin
suffix:semicolon
r_int
id|retval
comma
id|readbytes
op_assign
l_int|0
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
l_int|0
suffix:semicolon
id|usb_fill_bulk_urb
c_func
(paren
id|urb
comma
id|sisusb-&gt;sisusb_dev
comma
id|pipe
comma
id|data
comma
id|len
comma
id|sisusb_bulk_completein
comma
id|sisusb
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_or_assign
(paren
id|tflags
op_or
id|URB_ASYNC_UNLINK
)paren
suffix:semicolon
id|urb-&gt;actual_length
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|urb-&gt;transfer_dma
op_assign
id|transfer_dma
)paren
)paren
id|urb-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
id|sisusb-&gt;completein
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
(brace
id|wait_event_timeout
c_func
(paren
id|sisusb-&gt;wait_q
comma
id|sisusb-&gt;completein
comma
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;completein
)paren
(brace
multiline_comment|/* URB timed out... kill it and report error */
id|usb_kill_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* URB completed within timout */
id|retval
op_assign
id|urb-&gt;status
suffix:semicolon
id|readbytes
op_assign
id|urb-&gt;actual_length
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|actual_length
)paren
op_star
id|actual_length
op_assign
id|readbytes
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Level 1:  */
multiline_comment|/* Send a bulk message of variable size&n; *&n; * To copy the data from userspace, give pointer to &quot;userbuffer&quot;,&n; * to copy from (non-DMA) kernel memory, give &quot;kernbuffer&quot;. If&n; * both of these are NULL, it is assumed, that the transfer&n; * buffer &quot;sisusb-&gt;obuf[index]&quot; is set up with the data to send.&n; * Index is ignored if either kernbuffer or userbuffer is set.&n; * If async is nonzero, URBs will be sent without waiting for&n; * completion of the previous URB.&n; *&n; * (return 0 on success)&n; */
DECL|function|sisusb_send_bulk_msg
r_static
r_int
id|sisusb_send_bulk_msg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|ep
comma
r_int
id|len
comma
r_char
op_star
id|kernbuffer
comma
r_const
r_char
id|__user
op_star
id|userbuffer
comma
r_int
id|index
comma
id|ssize_t
op_star
id|bytes_written
comma
r_int
r_int
id|tflags
comma
r_int
id|async
)paren
(brace
r_int
id|result
op_assign
l_int|0
comma
id|retry
comma
id|count
op_assign
id|len
suffix:semicolon
r_int
id|passsize
comma
id|thispass
comma
id|transferred_len
op_assign
l_int|0
suffix:semicolon
r_int
id|fromuser
op_assign
(paren
id|userbuffer
op_ne
l_int|NULL
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_int
id|fromkern
op_assign
(paren
id|kernbuffer
op_ne
l_int|NULL
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_char
op_star
id|buffer
suffix:semicolon
(paren
op_star
id|bytes_written
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb
op_logical_or
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* If we copy data from kernel or userspace, force the&n;&t; * allocation of a buffer/urb. If we have the data in&n;&t; * the transfer buffer[index] already, reuse the buffer/URB&n;&t; * if the length is &gt; buffer size. (So, transmitting&n;&t; * large data amounts directly from the transfer buffer&n;&t; * treats the buffer as a ring buffer. However, we need&n;&t; * to sync in this case.)&n;&t; */
r_if
c_cond
(paren
id|fromuser
op_logical_or
id|fromkern
)paren
id|index
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|len
OG
id|sisusb-&gt;obufsize
)paren
id|async
op_assign
l_int|0
suffix:semicolon
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|sisusb-&gt;sisusb_dev
comma
id|ep
)paren
suffix:semicolon
r_do
(brace
id|passsize
op_assign
id|thispass
op_assign
(paren
id|sisusb-&gt;obufsize
OL
id|count
)paren
ques
c_cond
id|sisusb-&gt;obufsize
suffix:colon
id|count
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
l_int|0
)paren
id|index
op_assign
id|sisusb_get_free_outbuf
c_func
(paren
id|sisusb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|buffer
op_assign
id|sisusb-&gt;obuf
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fromuser
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buffer
comma
id|userbuffer
comma
id|passsize
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userbuffer
op_add_assign
id|passsize
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fromkern
)paren
(brace
id|memcpy
c_func
(paren
id|buffer
comma
id|kernbuffer
comma
id|passsize
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
id|passsize
suffix:semicolon
)brace
id|retry
op_assign
l_int|5
suffix:semicolon
r_while
c_loop
(paren
id|thispass
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|result
op_assign
id|sisusb_bulkout_msg
c_func
(paren
id|sisusb
comma
id|index
comma
id|pipe
comma
id|buffer
comma
id|thispass
comma
op_amp
id|transferred_len
comma
id|async
ques
c_cond
l_int|0
suffix:colon
l_int|5
op_star
id|HZ
comma
id|tflags
comma
id|sisusb-&gt;transfer_dma_out
(braket
id|index
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
(brace
multiline_comment|/* Will not happen if async */
r_if
c_cond
(paren
op_logical_neg
id|retry
op_decrement
)paren
r_return
op_minus
id|ETIME
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|result
op_eq
l_int|0
)paren
op_logical_and
op_logical_neg
id|async
op_logical_and
id|transferred_len
)paren
(brace
id|thispass
op_sub_assign
id|transferred_len
suffix:semicolon
r_if
c_cond
(paren
id|thispass
)paren
(brace
r_if
c_cond
(paren
id|sisusb-&gt;transfer_dma_out
)paren
(brace
multiline_comment|/* If DMA, copy remaining&n;&t;&t;&t;&t;&t;&t; * to beginning of buffer&n;&t;&t;&t;&t;&t;&t; */
id|memcpy
c_func
(paren
id|buffer
comma
id|buffer
op_plus
id|transferred_len
comma
id|thispass
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* If not DMA, simply increase&n;&t;&t;&t;&t;&t;&t; * the pointer&n;&t;&t;&t;&t;&t;&t; */
id|buffer
op_add_assign
id|transferred_len
suffix:semicolon
)brace
)brace
)brace
r_else
r_break
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_return
id|result
suffix:semicolon
(paren
op_star
id|bytes_written
)paren
op_add_assign
id|passsize
suffix:semicolon
id|count
op_sub_assign
id|passsize
suffix:semicolon
multiline_comment|/* Force new allocation in next iteration */
r_if
c_cond
(paren
id|fromuser
op_logical_or
id|fromkern
)paren
id|index
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|async
)paren
(brace
macro_line|#ifdef SISUSB_DONTSYNC
(paren
op_star
id|bytes_written
)paren
op_assign
id|len
suffix:semicolon
multiline_comment|/* Some URBs/buffers might be busy */
macro_line|#else
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
suffix:semicolon
(paren
op_star
id|bytes_written
)paren
op_assign
id|transferred_len
suffix:semicolon
multiline_comment|/* All URBs and all buffers are available */
macro_line|#endif
)brace
r_return
(paren
(paren
op_star
id|bytes_written
)paren
op_eq
id|len
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Receive a bulk message of variable size&n; *&n; * To copy the data to userspace, give pointer to &quot;userbuffer&quot;,&n; * to copy to kernel memory, give &quot;kernbuffer&quot;. One of them&n; * MUST be set. (There is no technique for letting the caller&n; * read directly from the ibuf.)&n; *&n; */
DECL|function|sisusb_recv_bulk_msg
r_static
r_int
id|sisusb_recv_bulk_msg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|ep
comma
r_int
id|len
comma
r_void
op_star
id|kernbuffer
comma
r_char
id|__user
op_star
id|userbuffer
comma
id|ssize_t
op_star
id|bytes_read
comma
r_int
r_int
id|tflags
)paren
(brace
r_int
id|result
op_assign
l_int|0
comma
id|retry
comma
id|count
op_assign
id|len
suffix:semicolon
r_int
id|bufsize
comma
id|thispass
comma
id|transferred_len
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_char
op_star
id|buffer
suffix:semicolon
(paren
op_star
id|bytes_read
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb
op_logical_or
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|sisusb-&gt;sisusb_dev
comma
id|ep
)paren
suffix:semicolon
id|buffer
op_assign
id|sisusb-&gt;ibuf
suffix:semicolon
id|bufsize
op_assign
id|sisusb-&gt;ibufsize
suffix:semicolon
id|retry
op_assign
l_int|5
suffix:semicolon
macro_line|#ifdef SISUSB_DONTSYNC
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|thispass
op_assign
(paren
id|bufsize
OL
id|count
)paren
ques
c_cond
id|bufsize
suffix:colon
id|count
suffix:semicolon
id|result
op_assign
id|sisusb_bulkin_msg
c_func
(paren
id|sisusb
comma
id|pipe
comma
id|buffer
comma
id|thispass
comma
op_amp
id|transferred_len
comma
l_int|5
op_star
id|HZ
comma
id|tflags
comma
id|sisusb-&gt;transfer_dma_in
)paren
suffix:semicolon
r_if
c_cond
(paren
id|transferred_len
)paren
id|thispass
op_assign
id|transferred_len
suffix:semicolon
r_else
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|retry
op_decrement
)paren
r_return
op_minus
id|ETIME
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|thispass
)paren
(brace
(paren
op_star
id|bytes_read
)paren
op_add_assign
id|thispass
suffix:semicolon
id|count
op_sub_assign
id|thispass
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|userbuffer
comma
id|buffer
comma
id|thispass
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userbuffer
op_add_assign
id|thispass
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|kernbuffer
comma
id|buffer
comma
id|thispass
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
id|thispass
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
(paren
op_star
id|bytes_read
)paren
op_eq
id|len
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|sisusb_send_packet
r_static
r_int
id|sisusb_send_packet
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|len
comma
r_struct
id|sisusb_packet
op_star
id|packet
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|bytes_transferred
op_assign
l_int|0
suffix:semicolon
id|__le32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|6
)paren
id|packet-&gt;data
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SISUSB_DONTSYNC
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/* Eventually correct endianness */
id|SISUSB_CORRECT_ENDIANNESS_PACKET
c_func
(paren
id|packet
)paren
suffix:semicolon
multiline_comment|/* 1. send the packet */
id|ret
op_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_OUT
comma
id|len
comma
(paren
r_char
op_star
)paren
id|packet
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|bytes_transferred
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_eq
l_int|0
)paren
op_logical_and
(paren
id|len
op_eq
l_int|6
)paren
)paren
(brace
multiline_comment|/* 2. if packet len == 6, it means we read, so wait for 32bit&n;&t;&t; *    return value and write it to packet-&gt;data&n;&t;&t; */
id|ret
op_assign
id|sisusb_recv_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_IN
comma
l_int|4
comma
(paren
r_char
op_star
)paren
op_amp
id|tmp
comma
l_int|NULL
comma
op_amp
id|bytes_transferred
comma
l_int|0
)paren
suffix:semicolon
id|packet-&gt;data
op_assign
id|le32_to_cpu
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_send_bridge_packet
r_static
r_int
id|sisusb_send_bridge_packet
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|len
comma
r_struct
id|sisusb_packet
op_star
id|packet
comma
r_int
r_int
id|tflags
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|bytes_transferred
op_assign
l_int|0
suffix:semicolon
id|__le32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|6
)paren
id|packet-&gt;data
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SISUSB_DONTSYNC
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/* Eventually correct endianness */
id|SISUSB_CORRECT_ENDIANNESS_PACKET
c_func
(paren
id|packet
)paren
suffix:semicolon
multiline_comment|/* 1. send the packet */
id|ret
op_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_BRIDGE_OUT
comma
id|len
comma
(paren
r_char
op_star
)paren
id|packet
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|bytes_transferred
comma
id|tflags
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_eq
l_int|0
)paren
op_logical_and
(paren
id|len
op_eq
l_int|6
)paren
)paren
(brace
multiline_comment|/* 2. if packet len == 6, it means we read, so wait for 32bit&n;&t;&t; *    return value and write it to packet-&gt;data&n;&t;&t; */
id|ret
op_assign
id|sisusb_recv_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_BRIDGE_IN
comma
l_int|4
comma
(paren
r_char
op_star
)paren
op_amp
id|tmp
comma
l_int|NULL
comma
op_amp
id|bytes_transferred
comma
l_int|0
)paren
suffix:semicolon
id|packet-&gt;data
op_assign
id|le32_to_cpu
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* access video memory and mmio (return 0 on success) */
multiline_comment|/* Low level */
multiline_comment|/* The following routines assume being used to transfer byte, word,&n; * long etc.&n; * This means that they assume &quot;data&quot; in machine endianness format.&n; */
DECL|function|sisusb_write_memio_byte
r_static
r_int
id|sisusb_write_memio_byte
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u8
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|packet.header
op_assign
(paren
l_int|1
op_lshift
(paren
id|addr
op_amp
l_int|3
)paren
)paren
op_or
(paren
id|type
op_lshift
l_int|6
)paren
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
(paren
(paren
id|addr
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_write_memio_word
r_static
r_int
id|sisusb_write_memio_word
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u16
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|packet.data
op_assign
(paren
id|u32
)paren
id|data
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0006
suffix:semicolon
id|packet.data
op_assign
(paren
id|u32
)paren
id|data
op_lshift
l_int|8
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|packet.data
op_assign
(paren
id|u32
)paren
id|data
op_lshift
l_int|16
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|packet.data
op_assign
(paren
id|u32
)paren
id|data
op_lshift
l_int|24
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
(paren
id|u32
)paren
id|data
op_rshift
l_int|8
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_write_memio_24bit
r_static
r_int
id|sisusb_write_memio_24bit
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u32
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0007
suffix:semicolon
id|packet.data
op_assign
id|data
op_amp
l_int|0x00ffffff
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000e
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|16
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
(paren
id|data
op_rshift
l_int|16
)paren
op_amp
l_int|0x00ff
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|24
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
(paren
id|data
op_rshift
l_int|8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_write_memio_long
r_static
r_int
id|sisusb_write_memio_long
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u32
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000f
suffix:semicolon
id|packet.data
op_assign
id|data
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000e
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
id|data
op_rshift
l_int|24
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|16
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
id|data
op_rshift
l_int|16
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|packet.data
op_assign
id|data
op_lshift
l_int|24
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0007
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|packet.data
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* The xxx_bulk routines copy a buffer of variable size. They treat the&n; * buffer as chars, therefore lsb/msb has to be corrected if using the&n; * byte/word/long/etc routines for speed-up&n; *&n; * If data is from userland, set &quot;userbuffer&quot; (and clear &quot;kernbuffer&quot;),&n; * if data is in kernel space, set &quot;kernbuffer&quot; (and clear &quot;userbuffer&quot;);&n; * if neither &quot;kernbuffer&quot; nor &quot;userbuffer&quot; are given, it is assumed&n; * that the data already is in the transfer buffer &quot;sisusb-&gt;obuf[index]&quot;.&n; */
DECL|function|sisusb_write_mem_bulk
r_static
r_int
id|sisusb_write_mem_bulk
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
id|u32
id|addr
comma
r_char
op_star
id|kernbuffer
comma
r_int
id|length
comma
r_const
r_char
id|__user
op_star
id|userbuffer
comma
r_int
id|index
comma
id|ssize_t
op_star
id|bytes_written
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|msgcount
op_assign
l_int|0
suffix:semicolon
id|u8
id|swap8
comma
id|fromkern
op_assign
id|kernbuffer
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|u16
id|swap16
suffix:semicolon
id|u32
id|swap32
comma
id|flag
op_assign
(paren
id|length
op_rshift
l_int|28
)paren
op_amp
l_int|1
suffix:semicolon
r_char
id|buf
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* if neither kernbuffer not userbuffer are given, assume&n;&t; * data in obuf&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|fromkern
op_logical_and
op_logical_neg
id|userbuffer
)paren
id|kernbuffer
op_assign
id|sisusb-&gt;obuf
(braket
id|index
)braket
suffix:semicolon
(paren
op_star
id|bytes_written
op_assign
l_int|0
)paren
suffix:semicolon
id|length
op_and_assign
l_int|0x00ffffff
suffix:semicolon
r_while
c_loop
(paren
id|length
)paren
(brace
r_switch
c_cond
(paren
id|length
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|ret
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|swap8
comma
(paren
id|u8
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
id|swap8
op_assign
id|kernbuffer
(braket
l_int|0
)braket
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
id|swap8
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(paren
op_star
id|bytes_written
)paren
op_increment
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|swap16
comma
(paren
id|u16
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
id|swap16
op_assign
(paren
id|kernbuffer
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|kernbuffer
(braket
l_int|1
)braket
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
id|swap16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(paren
op_star
id|bytes_written
)paren
op_add_assign
l_int|2
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|buf
comma
id|userbuffer
comma
l_int|3
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|swap32
op_assign
(paren
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|buf
(braket
l_int|2
)braket
suffix:semicolon
)brace
r_else
id|swap32
op_assign
(paren
id|kernbuffer
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|kernbuffer
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|kernbuffer
(braket
l_int|2
)braket
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_24bit
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
id|swap32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(paren
op_star
id|bytes_written
)paren
op_add_assign
l_int|3
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|swap32
comma
(paren
id|u32
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
id|swap32
op_assign
(paren
id|kernbuffer
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|kernbuffer
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|kernbuffer
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|kernbuffer
(braket
l_int|3
)braket
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_long
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
id|swap32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(paren
op_star
id|bytes_written
)paren
op_add_assign
l_int|4
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|length
op_amp
op_complement
l_int|3
)paren
OG
l_int|0x10000
)paren
(brace
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001d4
suffix:semicolon
id|packet.data
op_assign
id|addr
suffix:semicolon
id|ret
op_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001d0
suffix:semicolon
id|packet.data
op_assign
(paren
id|length
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001c0
suffix:semicolon
id|packet.data
op_assign
id|flag
op_or
l_int|0x16
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_LBULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
l_int|NULL
comma
id|userbuffer
comma
l_int|0
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|userbuffer
op_add_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fromkern
)paren
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_LBULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
id|kernbuffer
comma
l_int|NULL
comma
l_int|0
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_LBULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
l_int|NULL
comma
l_int|NULL
comma
id|index
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
(paren
(paren
op_star
id|bytes_written
)paren
op_amp
(paren
id|sisusb-&gt;obufsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000194
suffix:semicolon
id|packet.data
op_assign
id|addr
suffix:semicolon
id|ret
op_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000190
suffix:semicolon
id|packet.data
op_assign
(paren
id|length
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisusb-&gt;flagb0
op_ne
l_int|0x16
)paren
(brace
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000180
suffix:semicolon
id|packet.data
op_assign
id|flag
op_or
l_int|0x16
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|sisusb-&gt;flagb0
op_assign
l_int|0x16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_BULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
l_int|NULL
comma
id|userbuffer
comma
l_int|0
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|userbuffer
op_add_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fromkern
)paren
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_BULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
id|kernbuffer
comma
l_int|NULL
comma
l_int|0
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_or_assign
id|sisusb_send_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_BULK_OUT
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
l_int|NULL
comma
l_int|NULL
comma
id|index
comma
id|bytes_written
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|kernbuffer
op_add_assign
(paren
(paren
op_star
id|bytes_written
)paren
op_amp
(paren
id|sisusb-&gt;obufsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ret
)paren
(brace
id|msgcount
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|msgcount
OL
l_int|500
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Wrote %d of &quot;
l_string|&quot;%d bytes, error %d&bslash;n&quot;
comma
id|sisusb-&gt;minor
comma
op_star
id|bytes_written
comma
id|length
comma
id|ret
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|msgcount
op_eq
l_int|500
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Too many errors&quot;
l_string|&quot;, logging stopped&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
id|length
op_sub_assign
(paren
op_star
id|bytes_written
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
)brace
r_return
id|ret
ques
c_cond
op_minus
id|EIO
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|sisusb_read_memio_byte
r_static
r_int
id|sisusb_read_memio_byte
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u8
op_star
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|CLEARPACKET
c_func
(paren
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
l_int|1
op_lshift
(paren
id|addr
op_amp
l_int|3
)paren
)paren
op_or
(paren
id|type
op_lshift
l_int|6
)paren
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
(paren
id|u8
)paren
(paren
id|packet.data
op_rshift
(paren
(paren
id|addr
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_read_memio_word
r_static
r_int
id|sisusb_read_memio_word
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u16
op_star
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|CLEARPACKET
c_func
(paren
op_amp
id|packet
)paren
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
(paren
id|u16
)paren
(paren
id|packet.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0006
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
(paren
id|u16
)paren
(paren
id|packet.data
op_rshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
(paren
id|u16
)paren
(paren
id|packet.data
op_rshift
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
(paren
id|u16
)paren
(paren
id|packet.data
op_rshift
l_int|24
)paren
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
id|u16
)paren
(paren
id|packet.data
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_read_memio_24bit
r_static
r_int
id|sisusb_read_memio_24bit
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u32
op_star
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0007
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_amp
l_int|0x00ffffff
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000e
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|16
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
(paren
id|packet.data
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|24
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
(paren
id|packet.data
op_amp
l_int|0xffff
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_read_memio_long
r_static
r_int
id|sisusb_read_memio_long
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|type
comma
id|u32
id|addr
comma
id|u32
op_star
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|packet.address
op_assign
id|addr
op_amp
op_complement
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|addr
op_amp
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000f
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000e
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|8
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0001
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
id|packet.data
op_lshift
l_int|24
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x000c
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|16
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0003
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
id|packet.data
op_lshift
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0008
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
op_rshift
l_int|24
suffix:semicolon
id|packet.header
op_assign
(paren
id|type
op_lshift
l_int|6
)paren
op_or
l_int|0x0007
suffix:semicolon
id|packet.address
op_assign
(paren
id|addr
op_amp
op_complement
l_int|3
)paren
op_plus
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_or_assign
(paren
id|packet.data
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sisusb_read_mem_bulk
r_static
r_int
id|sisusb_read_mem_bulk
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
id|u32
id|addr
comma
r_char
op_star
id|kernbuffer
comma
r_int
id|length
comma
r_char
id|__user
op_star
id|userbuffer
comma
id|ssize_t
op_star
id|bytes_read
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_char
id|buf
(braket
l_int|4
)braket
suffix:semicolon
id|u16
id|swap16
suffix:semicolon
id|u32
id|swap32
suffix:semicolon
(paren
op_star
id|bytes_read
op_assign
l_int|0
)paren
suffix:semicolon
id|length
op_and_assign
l_int|0x00ffffff
suffix:semicolon
r_while
c_loop
(paren
id|length
)paren
(brace
r_switch
c_cond
(paren
id|length
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|ret
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ret
op_or_assign
id|sisusb_read_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
op_amp
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
(paren
op_star
id|bytes_read
)paren
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|buf
(braket
l_int|0
)braket
comma
(paren
id|u8
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
(brace
id|kernbuffer
(braket
l_int|0
)braket
op_assign
id|buf
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ret
op_or_assign
id|sisusb_read_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
op_amp
id|swap16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
(paren
op_star
id|bytes_read
)paren
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|swap16
comma
(paren
id|u16
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|kernbuffer
(braket
l_int|0
)braket
op_assign
id|swap16
op_rshift
l_int|8
suffix:semicolon
id|kernbuffer
(braket
l_int|1
)braket
op_assign
id|swap16
op_amp
l_int|0xff
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ret
op_or_assign
id|sisusb_read_memio_24bit
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
op_amp
id|swap32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
(paren
op_star
id|bytes_read
)paren
op_add_assign
l_int|3
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|swap32
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
(paren
id|swap32
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|swap32
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|userbuffer
comma
op_amp
id|buf
(braket
l_int|0
)braket
comma
l_int|3
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|kernbuffer
(braket
l_int|0
)braket
op_assign
id|buf
(braket
l_int|0
)braket
suffix:semicolon
id|kernbuffer
(braket
l_int|1
)braket
op_assign
id|buf
(braket
l_int|1
)braket
suffix:semicolon
id|kernbuffer
(braket
l_int|2
)braket
op_assign
id|buf
(braket
l_int|2
)braket
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
r_default
suffix:colon
id|ret
op_or_assign
id|sisusb_read_memio_long
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|addr
comma
op_amp
id|swap32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
(paren
op_star
id|bytes_read
)paren
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|swap32
comma
(paren
id|u32
id|__user
op_star
)paren
id|userbuffer
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userbuffer
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|kernbuffer
(braket
l_int|0
)braket
op_assign
(paren
id|swap32
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|kernbuffer
(braket
l_int|1
)braket
op_assign
(paren
id|swap32
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|kernbuffer
(braket
l_int|2
)braket
op_assign
(paren
id|swap32
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|kernbuffer
(braket
l_int|3
)braket
op_assign
id|swap32
op_amp
l_int|0xff
suffix:semicolon
id|kernbuffer
op_add_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_add_assign
l_int|4
suffix:semicolon
id|length
op_sub_assign
l_int|4
suffix:semicolon
)brace
macro_line|#if 0&t;&t;/* That does not work, as EP 2 is an OUT EP! */
r_default
suffix:colon
id|CLEARPACKET
c_func
(paren
op_amp
id|packet
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001a0
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000006
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001b0
suffix:semicolon
id|packet.data
op_assign
(paren
id|length
op_amp
op_complement
l_int|3
)paren
op_or
l_int|0x40000000
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001b4
suffix:semicolon
id|packet.data
op_assign
id|addr
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x000001a4
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000001
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userbuffer
)paren
(brace
id|ret
op_or_assign
id|sisusb_recv_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_BULK_IN
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
l_int|NULL
comma
id|userbuffer
comma
id|bytes_read
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|userbuffer
op_add_assign
(paren
op_star
id|bytes_read
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_or_assign
id|sisusb_recv_bulk_msg
c_func
(paren
id|sisusb
comma
id|SISUSB_EP_GFX_BULK_IN
comma
(paren
id|length
op_amp
op_complement
l_int|3
)paren
comma
id|kernbuffer
comma
l_int|NULL
comma
id|bytes_read
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|kernbuffer
op_add_assign
(paren
op_star
id|bytes_read
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
(paren
op_star
id|bytes_read
)paren
suffix:semicolon
id|length
op_sub_assign
(paren
op_star
id|bytes_read
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* High level: Gfx (indexed) register access */
r_static
r_int
DECL|function|sisusb_setidxreg
id|sisusb_setidxreg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|index
comma
id|u8
id|data
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
comma
id|index
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
id|data
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_getidxreg
id|sisusb_getidxreg
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|index
comma
id|u8
op_star
id|data
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
comma
id|index
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
id|data
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_setidxregandor
id|sisusb_setidxregandor
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|idx
comma
id|u8
id|myand
comma
id|u8
id|myor
)paren
(brace
r_int
id|ret
suffix:semicolon
id|u8
id|tmp
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
comma
id|idx
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp
op_and_assign
id|myand
suffix:semicolon
id|tmp
op_or_assign
id|myor
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
id|tmp
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_setidxregmask
id|sisusb_setidxregmask
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|idx
comma
id|u8
id|data
comma
id|u8
id|mask
)paren
(brace
r_int
id|ret
suffix:semicolon
id|u8
id|tmp
suffix:semicolon
id|ret
op_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
comma
id|idx
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|mask
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|data
op_amp
id|mask
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|port
op_plus
l_int|1
comma
id|tmp
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_setidxregor
id|sisusb_setidxregor
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|index
comma
id|u8
id|myor
)paren
(brace
r_return
id|sisusb_setidxregandor
c_func
(paren
id|sisusb
comma
id|port
comma
id|index
comma
l_int|0xff
comma
id|myor
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_setidxregand
id|sisusb_setidxregand
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|port
comma
id|u8
id|idx
comma
id|u8
id|myand
)paren
(brace
r_return
id|sisusb_setidxregandor
c_func
(paren
id|sisusb
comma
id|port
comma
id|idx
comma
id|myand
comma
l_int|0x00
)paren
suffix:semicolon
)brace
multiline_comment|/* access pci config registers (reg numbers 0, 4, 8, etc) */
r_static
r_int
DECL|function|sisusb_write_pci_config
id|sisusb_write_pci_config
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|regnum
comma
id|u32
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|packet.header
op_assign
l_int|0x008f
suffix:semicolon
id|packet.address
op_assign
id|regnum
op_or
l_int|0x10000
suffix:semicolon
id|packet.data
op_assign
id|data
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_read_pci_config
id|sisusb_read_pci_config
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|regnum
comma
id|u32
op_star
id|data
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|packet.header
op_assign
l_int|0x008f
suffix:semicolon
id|packet.address
op_assign
(paren
id|u32
)paren
id|regnum
op_or
l_int|0x10000
suffix:semicolon
id|ret
op_assign
id|sisusb_send_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
)paren
suffix:semicolon
op_star
id|data
op_assign
id|packet.data
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Clear video RAM */
r_static
r_int
DECL|function|sisusb_clear_vram
id|sisusb_clear_vram
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
id|u32
id|address
comma
r_int
id|length
)paren
(brace
r_int
id|ret
comma
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|address
OL
id|sisusb-&gt;vrambase
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|address
op_ge
id|sisusb-&gt;vrambase
op_plus
id|sisusb-&gt;vramsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|address
op_plus
id|length
OG
id|sisusb-&gt;vrambase
op_plus
id|sisusb-&gt;vramsize
)paren
id|length
op_assign
id|sisusb-&gt;vrambase
op_plus
id|sisusb-&gt;vramsize
op_minus
id|address
suffix:semicolon
r_if
c_cond
(paren
id|length
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* allocate free buffer/urb and clear the buffer */
r_if
c_cond
(paren
(paren
id|i
op_assign
id|sisusb_alloc_outbuf
c_func
(paren
id|sisusb
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memset
c_func
(paren
id|sisusb-&gt;obuf
(braket
id|i
)braket
comma
l_int|0
comma
id|sisusb-&gt;obufsize
)paren
suffix:semicolon
multiline_comment|/* We can write a length &gt; buffer size here. The buffer&n;&t; * data will simply be re-used (like a ring-buffer).&n;&t; */
id|ret
op_assign
id|sisusb_write_mem_bulk
c_func
(paren
id|sisusb
comma
id|address
comma
l_int|NULL
comma
id|length
comma
l_int|NULL
comma
id|i
comma
op_amp
id|j
)paren
suffix:semicolon
multiline_comment|/* Free the buffer/urb */
id|sisusb_free_outbuf
c_func
(paren
id|sisusb
comma
id|i
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Initialize the graphics core (return 0 on success)&n; * This resets the graphics hardware and puts it into&n; * a defined mode (640x480@60Hz)&n; */
DECL|macro|GETREG
mdefine_line|#define GETREG(r,d)     sisusb_read_memio_byte(sisusb, SISUSB_TYPE_IO, r, d)
DECL|macro|SETREG
mdefine_line|#define SETREG(r,d)&t;sisusb_write_memio_byte(sisusb, SISUSB_TYPE_IO, r, d)
DECL|macro|SETIREG
mdefine_line|#define SETIREG(r,i,d)&t;sisusb_setidxreg(sisusb, r, i, d)
DECL|macro|GETIREG
mdefine_line|#define GETIREG(r,i,d)  sisusb_getidxreg(sisusb, r, i, d)
DECL|macro|SETIREGOR
mdefine_line|#define SETIREGOR(r,i,o)&t;sisusb_setidxregor(sisusb, r, i, o)
DECL|macro|SETIREGAND
mdefine_line|#define SETIREGAND(r,i,a)&t;sisusb_setidxregand(sisusb, r, i, a)
DECL|macro|SETIREGANDOR
mdefine_line|#define SETIREGANDOR(r,i,a,o)&t;sisusb_setidxregandor(sisusb, r, i, a, o)
DECL|macro|READL
mdefine_line|#define READL(a,d)&t;sisusb_read_memio_long(sisusb, SISUSB_TYPE_MEM, a, d)
DECL|macro|WRITEL
mdefine_line|#define WRITEL(a,d) &t;sisusb_write_memio_long(sisusb, SISUSB_TYPE_MEM, a, d)
DECL|macro|READB
mdefine_line|#define READB(a,d)&t;sisusb_read_memio_byte(sisusb, SISUSB_TYPE_MEM, a, d)
DECL|macro|WRITEB
mdefine_line|#define WRITEB(a,d) &t;sisusb_write_memio_byte(sisusb, SISUSB_TYPE_MEM, a, d)
r_static
r_int
DECL|function|sisusb_triggersr16
id|sisusb_triggersr16
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
id|u8
id|ramtype
)paren
(brace
r_int
id|ret
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
id|ret
op_assign
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
op_amp
id|tmp8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ramtype
op_le
l_int|1
)paren
(brace
id|tmp8
op_and_assign
l_int|0x3f
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_or_assign
l_int|0x80
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
)brace
r_else
(brace
id|tmp8
op_or_assign
l_int|0xc0
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_and_assign
l_int|0x0f
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_or_assign
l_int|0x80
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_and_assign
l_int|0x0f
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_or_assign
l_int|0xd0
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_and_assign
l_int|0x0f
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_or_assign
l_int|0xa0
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|tmp8
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_getbuswidth
id|sisusb_getbuswidth
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
op_star
id|bw
comma
r_int
op_star
id|chab
)paren
(brace
r_int
id|ret
suffix:semicolon
id|u8
id|ramtype
comma
id|done
op_assign
l_int|0
suffix:semicolon
id|u32
id|t0
comma
id|t1
comma
id|t2
comma
id|t3
suffix:semicolon
id|u32
id|ramptr
op_assign
id|SISUSB_PCI_MEMBASE
suffix:semicolon
id|ret
op_assign
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
op_amp
id|ramtype
)paren
suffix:semicolon
id|ramtype
op_and_assign
l_int|3
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ramtype
op_le
l_int|1
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x12
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0xef
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x02
)paren
suffix:semicolon
)brace
id|ret
op_or_assign
id|sisusb_triggersr16
c_func
(paren
id|sisusb
comma
id|ramtype
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|0
comma
l_int|0x01234567
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
l_int|0x456789ab
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|8
comma
l_int|0x89abcdef
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|12
comma
l_int|0xcdef0123
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|16
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|20
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|24
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|28
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|0
comma
op_amp
id|t0
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
op_amp
id|t1
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|8
comma
op_amp
id|t2
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|12
comma
op_amp
id|t3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ramtype
op_le
l_int|1
)paren
(brace
op_star
id|chab
op_assign
l_int|0
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
r_if
c_cond
(paren
(paren
id|t3
op_ne
l_int|0xcdef0123
)paren
op_logical_or
(paren
id|t2
op_ne
l_int|0x89abcdef
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|t1
op_eq
l_int|0x456789ab
)paren
op_logical_and
(paren
id|t0
op_eq
l_int|0x01234567
)paren
)paren
(brace
op_star
id|chab
op_assign
l_int|0
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0xfd
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|t1
op_ne
l_int|0x456789ab
)paren
op_logical_or
(paren
id|t0
op_ne
l_int|0x01234567
)paren
)paren
(brace
op_star
id|chab
op_assign
l_int|1
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
id|ret
op_or_assign
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0xfc
comma
l_int|0x01
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_triggersr16
c_func
(paren
id|sisusb
comma
id|ramtype
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|0
comma
l_int|0x89abcdef
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
l_int|0xcdef0123
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|8
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|12
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|16
comma
l_int|0xaaaaaaaa
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|20
comma
l_int|0xaaaaaaaa
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
op_amp
id|t1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t1
op_ne
l_int|0xcdef0123
)paren
(brace
op_star
id|bw
op_assign
l_int|32
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x15
comma
l_int|0x10
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
op_star
id|chab
op_assign
l_int|0
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* default: cha, bw = 64 */
id|done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|t1
op_eq
l_int|0x456789ab
)paren
(brace
r_if
c_cond
(paren
id|t0
op_eq
l_int|0x01234567
)paren
(brace
op_star
id|chab
op_assign
l_int|0
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|t0
op_eq
l_int|0x01234567
)paren
(brace
op_star
id|chab
op_assign
l_int|0
suffix:semicolon
op_star
id|bw
op_assign
l_int|32
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x00
)paren
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|done
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x03
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_triggersr16
c_func
(paren
id|sisusb
comma
id|ramtype
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|0
comma
l_int|0x01234567
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
l_int|0x456789ab
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|8
comma
l_int|0x89abcdef
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|12
comma
l_int|0xcdef0123
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|16
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|20
comma
l_int|0x55555555
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|24
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|ramptr
op_plus
l_int|28
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|0
comma
op_amp
id|t0
)paren
suffix:semicolon
id|ret
op_or_assign
id|READL
c_func
(paren
id|ramptr
op_plus
l_int|4
comma
op_amp
id|t1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t1
op_eq
l_int|0x456789ab
)paren
(brace
r_if
c_cond
(paren
id|t0
op_eq
l_int|0x01234567
)paren
(brace
op_star
id|chab
op_assign
l_int|1
suffix:semicolon
op_star
id|bw
op_assign
l_int|64
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* else error */
)brace
r_else
(brace
r_if
c_cond
(paren
id|t0
op_eq
l_int|0x01234567
)paren
(brace
op_star
id|chab
op_assign
l_int|1
suffix:semicolon
op_star
id|bw
op_assign
l_int|32
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x01
)paren
suffix:semicolon
)brace
multiline_comment|/* else error */
)brace
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_verify_mclk
id|sisusb_verify_mclk
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|u32
id|ramptr
op_assign
id|SISUSB_PCI_MEMBASE
suffix:semicolon
id|u8
id|tmp1
comma
id|tmp2
comma
id|i
comma
id|j
suffix:semicolon
id|ret
op_or_assign
id|WRITEB
c_func
(paren
id|ramptr
comma
l_int|0xaa
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEB
c_func
(paren
id|ramptr
op_plus
l_int|16
comma
l_int|0x55
)paren
suffix:semicolon
id|ret
op_or_assign
id|READB
c_func
(paren
id|ramptr
comma
op_amp
id|tmp1
)paren
suffix:semicolon
id|ret
op_or_assign
id|READB
c_func
(paren
id|ramptr
op_plus
l_int|16
comma
op_amp
id|tmp2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp1
op_ne
l_int|0xaa
)paren
op_logical_or
(paren
id|tmp2
op_ne
l_int|0x55
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
comma
id|j
op_add_assign
l_int|16
)paren
(brace
id|ret
op_or_assign
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
op_amp
id|tmp1
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
(paren
id|tmp1
op_amp
l_int|0xfb
)paren
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* not on 330 */
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x3c
comma
l_int|0xfe
)paren
suffix:semicolon
multiline_comment|/* not on 330 */
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
id|tmp1
)paren
suffix:semicolon
id|ret
op_or_assign
id|WRITEB
c_func
(paren
id|ramptr
op_plus
l_int|16
op_plus
id|j
comma
id|j
)paren
suffix:semicolon
id|ret
op_or_assign
id|READB
c_func
(paren
id|ramptr
op_plus
l_int|16
op_plus
id|j
comma
op_amp
id|tmp1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp1
op_eq
id|j
)paren
(brace
id|ret
op_or_assign
id|WRITEB
c_func
(paren
id|ramptr
op_plus
id|j
comma
id|j
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_set_rank
id|sisusb_set_rank
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
op_star
id|iret
comma
r_int
id|index
comma
id|u8
id|rankno
comma
id|u8
id|chab
comma
r_const
id|u8
id|dramtype
(braket
)braket
(braket
l_int|5
)braket
comma
r_int
id|bw
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|ranksize
suffix:semicolon
id|u8
id|tmp
suffix:semicolon
op_star
id|iret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rankno
op_eq
l_int|2
)paren
op_logical_and
(paren
id|dramtype
(braket
id|index
)braket
(braket
l_int|0
)braket
op_eq
l_int|2
)paren
)paren
r_return
id|ret
suffix:semicolon
id|ranksize
op_assign
id|dramtype
(braket
id|index
)braket
(braket
l_int|3
)braket
op_div
l_int|2
op_star
id|bw
op_div
l_int|32
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ranksize
op_star
id|rankno
)paren
OG
l_int|128
)paren
r_return
id|ret
suffix:semicolon
id|tmp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ranksize
op_rshift_assign
l_int|1
)paren
OG
l_int|0
)paren
id|tmp
op_add_assign
l_int|0x10
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|rankno
op_minus
l_int|1
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|bw
op_div
l_int|64
)paren
op_amp
l_int|0x02
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|chab
op_amp
l_int|0x01
)paren
suffix:semicolon
id|ret
op_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
id|tmp
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_triggersr16
c_func
(paren
id|sisusb
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* sic! */
op_star
id|iret
op_assign
l_int|1
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_check_rbc
id|sisusb_check_rbc
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
op_star
id|iret
comma
id|u32
id|inc
comma
r_int
id|testn
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|u32
id|j
comma
id|tmp
suffix:semicolon
op_star
id|iret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|testn
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|WRITEL
c_func
(paren
id|sisusb-&gt;vrambase
op_plus
id|j
comma
id|j
)paren
suffix:semicolon
id|j
op_add_assign
id|inc
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|testn
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|READL
c_func
(paren
id|sisusb-&gt;vrambase
op_plus
id|j
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|j
)paren
r_return
id|ret
suffix:semicolon
id|j
op_add_assign
id|inc
suffix:semicolon
)brace
op_star
id|iret
op_assign
l_int|1
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_check_ranks
id|sisusb_check_ranks
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
op_star
id|iret
comma
r_int
id|rankno
comma
r_int
id|idx
comma
r_int
id|bw
comma
r_const
id|u8
id|rtype
(braket
)braket
(braket
l_int|5
)braket
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i
comma
id|i2ret
suffix:semicolon
id|u32
id|inc
suffix:semicolon
op_star
id|iret
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|rankno
suffix:semicolon
id|i
op_ge
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|inc
op_assign
l_int|1
op_lshift
(paren
id|rtype
(braket
id|idx
)braket
(braket
l_int|2
)braket
op_plus
id|rtype
(braket
id|idx
)braket
(braket
l_int|1
)braket
op_plus
id|rtype
(braket
id|idx
)braket
(braket
l_int|0
)braket
op_plus
id|bw
op_div
l_int|64
op_plus
id|i
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_check_rbc
c_func
(paren
id|sisusb
comma
op_amp
id|i2ret
comma
id|inc
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2ret
)paren
r_return
id|ret
suffix:semicolon
)brace
id|inc
op_assign
l_int|1
op_lshift
(paren
id|rtype
(braket
id|idx
)braket
(braket
l_int|2
)braket
op_plus
id|bw
op_div
l_int|64
op_plus
l_int|2
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_check_rbc
c_func
(paren
id|sisusb
comma
op_amp
id|i2ret
comma
id|inc
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2ret
)paren
r_return
id|ret
suffix:semicolon
id|inc
op_assign
l_int|1
op_lshift
(paren
l_int|10
op_plus
id|bw
op_div
l_int|64
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_check_rbc
c_func
(paren
id|sisusb
comma
op_amp
id|i2ret
comma
id|inc
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2ret
)paren
r_return
id|ret
suffix:semicolon
op_star
id|iret
op_assign
l_int|1
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_get_sdram_size
id|sisusb_get_sdram_size
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
op_star
id|iret
comma
r_int
id|bw
comma
r_int
id|chab
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i2ret
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
r_static
r_const
id|u8
id|sdramtype
(braket
l_int|13
)braket
(braket
l_int|5
)braket
op_assign
(brace
(brace
l_int|2
comma
l_int|12
comma
l_int|9
comma
l_int|64
comma
l_int|0x35
)brace
comma
(brace
l_int|1
comma
l_int|13
comma
l_int|9
comma
l_int|64
comma
l_int|0x44
)brace
comma
(brace
l_int|2
comma
l_int|12
comma
l_int|8
comma
l_int|32
comma
l_int|0x31
)brace
comma
(brace
l_int|2
comma
l_int|11
comma
l_int|9
comma
l_int|32
comma
l_int|0x25
)brace
comma
(brace
l_int|1
comma
l_int|12
comma
l_int|9
comma
l_int|32
comma
l_int|0x34
)brace
comma
(brace
l_int|1
comma
l_int|13
comma
l_int|8
comma
l_int|32
comma
l_int|0x40
)brace
comma
(brace
l_int|2
comma
l_int|11
comma
l_int|8
comma
l_int|16
comma
l_int|0x21
)brace
comma
(brace
l_int|1
comma
l_int|12
comma
l_int|8
comma
l_int|16
comma
l_int|0x30
)brace
comma
(brace
l_int|1
comma
l_int|11
comma
l_int|9
comma
l_int|16
comma
l_int|0x24
)brace
comma
(brace
l_int|1
comma
l_int|11
comma
l_int|8
comma
l_int|8
comma
l_int|0x20
)brace
comma
(brace
l_int|2
comma
l_int|9
comma
l_int|8
comma
l_int|4
comma
l_int|0x01
)brace
comma
(brace
l_int|1
comma
l_int|10
comma
l_int|8
comma
l_int|4
comma
l_int|0x10
)brace
comma
(brace
l_int|1
comma
l_int|9
comma
l_int|8
comma
l_int|2
comma
l_int|0x00
)brace
)brace
suffix:semicolon
op_star
id|iret
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* error */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|13
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
l_int|0x80
comma
id|sdramtype
(braket
id|i
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|2
suffix:semicolon
id|j
OG
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|ret
op_or_assign
id|sisusb_set_rank
c_func
(paren
id|sisusb
comma
op_amp
id|i2ret
comma
id|i
comma
id|j
comma
id|chab
comma
id|sdramtype
comma
id|bw
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2ret
)paren
r_continue
suffix:semicolon
id|ret
op_or_assign
id|sisusb_check_ranks
c_func
(paren
id|sisusb
comma
op_amp
id|i2ret
comma
id|j
comma
id|i
comma
id|bw
comma
id|sdramtype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2ret
)paren
(brace
op_star
id|iret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ram size found */
r_return
id|ret
suffix:semicolon
)brace
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_setup_screen
id|sisusb_setup_screen
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|clrall
comma
r_int
id|drwfr
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|u32
id|address
suffix:semicolon
r_int
id|i
comma
id|length
comma
id|modex
comma
id|modey
comma
id|bpp
suffix:semicolon
id|modex
op_assign
l_int|640
suffix:semicolon
id|modey
op_assign
l_int|480
suffix:semicolon
id|bpp
op_assign
l_int|2
suffix:semicolon
id|address
op_assign
id|sisusb-&gt;vrambase
suffix:semicolon
multiline_comment|/* Clear video ram */
r_if
c_cond
(paren
id|clrall
)paren
id|length
op_assign
id|sisusb-&gt;vramsize
suffix:semicolon
r_else
id|length
op_assign
id|modex
op_star
id|bpp
op_star
id|modey
suffix:semicolon
id|ret
op_assign
id|sisusb_clear_vram
c_func
(paren
id|sisusb
comma
id|address
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
op_logical_and
id|drwfr
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|modex
suffix:semicolon
id|i
op_increment
)paren
(brace
id|address
op_assign
id|sisusb-&gt;vrambase
op_plus
(paren
id|i
op_star
id|bpp
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|address
comma
l_int|0xf100
)paren
suffix:semicolon
id|address
op_add_assign
(paren
id|modex
op_star
(paren
id|modey
op_minus
l_int|1
)paren
op_star
id|bpp
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|address
comma
l_int|0xf100
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|modey
suffix:semicolon
id|i
op_increment
)paren
(brace
id|address
op_assign
id|sisusb-&gt;vrambase
op_plus
(paren
(paren
id|i
op_star
id|modex
)paren
op_star
id|bpp
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|address
comma
l_int|0xf100
)paren
suffix:semicolon
id|address
op_add_assign
(paren
(paren
id|modex
op_minus
l_int|1
)paren
op_star
id|bpp
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_MEM
comma
id|address
comma
l_int|0xf100
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_set_default_mode
id|sisusb_set_default_mode
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|touchengines
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i
comma
id|j
comma
id|modex
comma
id|modey
comma
id|bpp
comma
id|du
suffix:semicolon
id|u8
id|sr31
comma
id|cr63
comma
id|tmp8
suffix:semicolon
r_static
r_const
r_char
id|attrdata
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0a
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x0d
comma
l_int|0x0e
comma
l_int|0x0f
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
r_static
r_const
r_char
id|crtcrdata
(braket
)braket
op_assign
(brace
l_int|0x5f
comma
l_int|0x4f
comma
l_int|0x50
comma
l_int|0x82
comma
l_int|0x54
comma
l_int|0x80
comma
l_int|0x0b
comma
l_int|0x3e
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x8c
comma
l_int|0xdf
comma
l_int|0x28
comma
l_int|0x40
comma
l_int|0xe7
comma
l_int|0x04
comma
l_int|0xa3
comma
l_int|0xff
)brace
suffix:semicolon
r_static
r_const
r_char
id|grcdata
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x05
comma
l_int|0x0f
comma
l_int|0xff
)brace
suffix:semicolon
r_static
r_const
r_char
id|crtcdata
(braket
)braket
op_assign
(brace
l_int|0x5f
comma
l_int|0x4f
comma
l_int|0x4f
comma
l_int|0x83
comma
l_int|0x55
comma
l_int|0x81
comma
l_int|0x0b
comma
l_int|0x3e
comma
l_int|0xe9
comma
l_int|0x8b
comma
l_int|0xdf
comma
l_int|0xe8
comma
l_int|0x0c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x05
comma
l_int|0x00
)brace
suffix:semicolon
id|modex
op_assign
l_int|640
suffix:semicolon
id|modey
op_assign
l_int|480
suffix:semicolon
id|bpp
op_assign
l_int|2
suffix:semicolon
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
op_amp
id|sr31
)paren
suffix:semicolon
id|GETIREG
c_func
(paren
id|SISCR
comma
l_int|0x63
comma
op_amp
id|cr63
)paren
suffix:semicolon
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
l_int|0x20
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x63
comma
id|cr63
op_amp
l_int|0xbf
)paren
suffix:semicolon
id|SETIREGOR
c_func
(paren
id|SISCR
comma
l_int|0x17
comma
l_int|0x80
)paren
suffix:semicolon
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
l_int|0x04
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
l_int|0xfb
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x00
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* seq */
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
l_int|0x21
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x02
comma
l_int|0x0f
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x03
comma
l_int|0x00
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x04
comma
l_int|0x0e
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISMISCW
comma
l_int|0x23
)paren
suffix:semicolon
multiline_comment|/* misc */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x18
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* crtc */
id|SETIREG
c_func
(paren
id|SISCR
comma
id|i
comma
id|crtcrdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x13
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* att */
id|GETREG
c_func
(paren
id|SISINPSTAT
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISAR
comma
id|i
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISAR
comma
id|attrdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|GETREG
c_func
(paren
id|SISINPSTAT
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISAR
comma
l_int|0x14
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISAR
comma
l_int|0x00
)paren
suffix:semicolon
id|GETREG
c_func
(paren
id|SISINPSTAT
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISAR
comma
l_int|0x20
)paren
suffix:semicolon
id|GETREG
c_func
(paren
id|SISINPSTAT
comma
op_amp
id|tmp8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x08
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* grc */
id|SETIREG
c_func
(paren
id|SISGR
comma
id|i
comma
id|grcdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|SETIREGAND
c_func
(paren
id|SISGR
comma
l_int|0x05
comma
l_int|0xbf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x0A
suffix:semicolon
id|i
op_le
l_int|0x0E
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* clr ext */
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x37
comma
l_int|0xfe
)paren
suffix:semicolon
id|SETREG
c_func
(paren
id|SISMISCW
comma
l_int|0xef
)paren
suffix:semicolon
multiline_comment|/* sync */
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x11
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* crtc */
r_for
c_loop
(paren
id|j
op_assign
l_int|0x00
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|SETIREG
c_func
(paren
id|SISCR
comma
id|j
comma
id|crtcdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0x10
suffix:semicolon
id|i
op_le
l_int|10
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|SETIREG
c_func
(paren
id|SISCR
comma
id|j
comma
id|crtcdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0x15
suffix:semicolon
id|i
op_le
l_int|12
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|SETIREG
c_func
(paren
id|SISCR
comma
id|j
comma
id|crtcdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0x0A
suffix:semicolon
id|i
op_le
l_int|15
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|SETIREG
c_func
(paren
id|SISSR
comma
id|j
comma
id|crtcdata
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x0E
comma
(paren
id|crtcdata
(braket
l_int|16
)braket
op_amp
l_int|0xE0
)paren
)paren
suffix:semicolon
id|SETIREGANDOR
c_func
(paren
id|SISCR
comma
l_int|0x09
comma
l_int|0x5f
comma
(paren
(paren
id|crtcdata
(braket
l_int|16
)braket
op_amp
l_int|0x01
)paren
op_lshift
l_int|5
)paren
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x14
comma
l_int|0x4f
)paren
suffix:semicolon
id|du
op_assign
(paren
id|modex
op_div
l_int|16
)paren
op_star
(paren
id|bpp
op_star
l_int|2
)paren
suffix:semicolon
multiline_comment|/* offset/pitch */
r_if
c_cond
(paren
id|modex
op_mod
l_int|16
)paren
id|du
op_add_assign
id|bpp
suffix:semicolon
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x0e
comma
l_int|0xf0
comma
(paren
(paren
id|du
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x13
comma
(paren
id|du
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|du
op_lshift_assign
l_int|5
suffix:semicolon
id|tmp8
op_assign
id|du
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|du
op_amp
l_int|0xff
)paren
id|tmp8
op_increment
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x10
comma
id|tmp8
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* VCLK */
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2b
comma
l_int|0x1b
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2c
comma
l_int|0xe1
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2d
comma
l_int|0x01
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0xfe
)paren
suffix:semicolon
multiline_comment|/* FIFO */
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x08
comma
l_int|0xae
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x09
comma
l_int|0xf0
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x08
comma
l_int|0x34
)paren
suffix:semicolon
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x3d
comma
l_int|0x01
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
l_int|0x3f
)paren
suffix:semicolon
multiline_comment|/* mode regs */
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x06
comma
l_int|0xc0
comma
l_int|0x0a
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x19
comma
l_int|0x00
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISCR
comma
l_int|0x1a
comma
l_int|0xfc
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x0f
comma
l_int|0xb7
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
l_int|0xfb
)paren
suffix:semicolon
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0x1f
comma
l_int|0xa0
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x32
comma
l_int|0xf3
)paren
suffix:semicolon
id|SETIREGANDOR
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
l_int|0xf8
comma
l_int|0x03
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x52
comma
l_int|0x6c
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x0d
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* adjust frame */
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x0c
comma
l_int|0x00
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x0d
comma
l_int|0x00
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x37
comma
l_int|0xfe
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x32
comma
l_int|0x20
)paren
suffix:semicolon
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
l_int|0xdf
)paren
suffix:semicolon
multiline_comment|/* enable display */
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x63
comma
(paren
id|cr63
op_amp
l_int|0xbf
)paren
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
(paren
id|sr31
op_amp
l_int|0xfb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|touchengines
)paren
(brace
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
l_int|0xa1
)paren
suffix:semicolon
multiline_comment|/* enable engines */
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x1e
comma
l_int|0x5a
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x26
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* disable cmdqueue */
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x27
comma
l_int|0x1f
)paren
suffix:semicolon
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x26
comma
l_int|0x00
)paren
suffix:semicolon
)brace
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x34
comma
l_int|0x44
)paren
suffix:semicolon
multiline_comment|/* we just set std mode #44 */
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_init_gfxcore
id|sisusb_init_gfxcore
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|i
comma
id|j
comma
id|bw
comma
id|chab
comma
id|iret
comma
id|retry
op_assign
l_int|3
suffix:semicolon
id|u8
id|tmp8
comma
id|ramtype
suffix:semicolon
id|u32
id|tmp32
suffix:semicolon
r_static
r_const
r_char
id|mclktable
(braket
)braket
op_assign
(brace
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
)brace
suffix:semicolon
r_static
r_const
r_char
id|eclktable
(braket
)braket
op_assign
(brace
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
comma
l_int|0x3b
comma
l_int|0x22
comma
l_int|0x01
comma
l_int|143
)brace
suffix:semicolon
r_static
r_const
r_char
id|ramtypetable1
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x04
comma
l_int|0x60
comma
l_int|0x60
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x1f
comma
l_int|0x1f
comma
l_int|0xba
comma
l_int|0xba
comma
l_int|0xba
comma
l_int|0xba
comma
l_int|0xa9
comma
l_int|0xa9
comma
l_int|0xac
comma
l_int|0xac
comma
l_int|0xa0
comma
l_int|0xa0
comma
l_int|0xa0
comma
l_int|0xa8
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x30
comma
l_int|0x30
comma
l_int|0x40
comma
l_int|0x40
)brace
suffix:semicolon
r_static
r_const
r_char
id|ramtypetable2
(braket
)braket
op_assign
(brace
l_int|0x77
comma
l_int|0x77
comma
l_int|0x44
comma
l_int|0x44
comma
l_int|0x77
comma
l_int|0x77
comma
l_int|0x44
comma
l_int|0x44
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x5b
comma
l_int|0x5b
comma
l_int|0xab
comma
l_int|0xab
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xf0
comma
l_int|0xf8
)brace
suffix:semicolon
r_while
c_loop
(paren
id|retry
op_decrement
)paren
(brace
multiline_comment|/* Enable VGA */
id|ret
op_assign
id|GETREG
c_func
(paren
id|SISVGAEN
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETREG
c_func
(paren
id|SISVGAEN
comma
(paren
id|tmp8
op_or
l_int|0x01
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable GPU access to VRAM */
id|ret
op_or_assign
id|GETREG
c_func
(paren
id|SISMISCR
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETREG
c_func
(paren
id|SISMISCW
comma
(paren
id|tmp8
op_or
l_int|0x01
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_continue
suffix:semicolon
multiline_comment|/* Reset registers */
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISCR
comma
l_int|0x5b
comma
l_int|0xdf
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x05
comma
l_int|0x86
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
l_int|0x01
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETREG
c_func
(paren
id|SISMISCW
comma
l_int|0x67
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x06
suffix:semicolon
id|i
op_le
l_int|0x1f
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x21
suffix:semicolon
id|i
op_le
l_int|0x27
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x31
suffix:semicolon
id|i
op_le
l_int|0x3d
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x12
suffix:semicolon
id|i
op_le
l_int|0x1b
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x79
suffix:semicolon
id|i
op_le
l_int|0x7c
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
id|i
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
)paren
r_continue
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x63
comma
l_int|0x80
)paren
suffix:semicolon
id|ret
op_or_assign
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x3a
comma
op_amp
id|ramtype
)paren
suffix:semicolon
id|ramtype
op_and_assign
l_int|0x03
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x28
comma
id|mclktable
(braket
id|ramtype
op_star
l_int|4
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x29
comma
id|mclktable
(braket
(paren
id|ramtype
op_star
l_int|4
)paren
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2a
comma
id|mclktable
(braket
(paren
id|ramtype
op_star
l_int|4
)paren
op_plus
l_int|2
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2e
comma
id|eclktable
(braket
id|ramtype
op_star
l_int|4
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x2f
comma
id|eclktable
(braket
(paren
id|ramtype
op_star
l_int|4
)paren
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x30
comma
id|eclktable
(braket
(paren
id|ramtype
op_star
l_int|4
)paren
op_plus
l_int|2
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x07
comma
l_int|0x18
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
l_int|0x0f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x15
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x1b
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
id|i
comma
id|ramtypetable1
(braket
(paren
id|j
op_star
l_int|4
)paren
op_plus
id|ramtype
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0x40
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x44
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
id|i
comma
id|ramtypetable2
(braket
(paren
id|j
op_star
l_int|4
)paren
op_plus
id|ramtype
)braket
)paren
suffix:semicolon
)brace
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x49
comma
l_int|0xaa
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x1f
comma
l_int|0x00
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x20
comma
l_int|0xa0
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x23
comma
l_int|0xf6
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x24
comma
l_int|0x0d
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x25
comma
l_int|0x33
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x11
comma
l_int|0x0f
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISPART1
comma
l_int|0x2f
comma
l_int|0x01
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISCAP
comma
l_int|0x3f
comma
l_int|0xef
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_continue
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISPART1
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|ret
op_or_assign
id|GETIREG
c_func
(paren
id|SISSR
comma
l_int|0x13
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_rshift_assign
l_int|4
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISPART1
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISPART1
comma
l_int|0x2e
comma
l_int|0x08
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x50
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|tmp32
op_and_assign
l_int|0x00f00000
suffix:semicolon
id|tmp8
op_assign
(paren
id|tmp32
op_eq
l_int|0x100000
)paren
ques
c_cond
l_int|0x33
suffix:colon
l_int|0x03
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x25
comma
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_assign
(paren
id|tmp32
op_eq
l_int|0x100000
)paren
ques
c_cond
l_int|0xaa
suffix:colon
l_int|0x88
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x49
comma
id|tmp8
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x27
comma
l_int|0x1f
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x31
comma
l_int|0x00
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x32
comma
l_int|0x11
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x33
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_continue
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISCR
comma
l_int|0x83
comma
l_int|0x00
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_set_default_mode
c_func
(paren
id|sisusb
comma
l_int|0
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0xdf
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x01
comma
l_int|0x20
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
l_int|0x0f
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_triggersr16
c_func
(paren
id|sisusb
comma
id|ramtype
)paren
suffix:semicolon
multiline_comment|/* Disable refresh */
id|ret
op_or_assign
id|SETIREGAND
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
l_int|0xf8
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
l_int|0x03
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_getbuswidth
c_func
(paren
id|sisusb
comma
op_amp
id|bw
comma
op_amp
id|chab
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_verify_mclk
c_func
(paren
id|sisusb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ramtype
op_le
l_int|1
)paren
(brace
id|ret
op_or_assign
id|sisusb_get_sdram_size
c_func
(paren
id|sisusb
comma
op_amp
id|iret
comma
id|bw
comma
id|chab
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: RAM size &quot;
l_string|&quot;detection failed, &quot;
l_string|&quot;assuming 8MB video RAM&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x31
)paren
suffix:semicolon
multiline_comment|/* TODO */
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: DDR RAM device found, &quot;
l_string|&quot;assuming 8MB video RAM&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x14
comma
l_int|0x31
)paren
suffix:semicolon
multiline_comment|/* *** TODO *** */
)brace
multiline_comment|/* Enable refresh */
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x16
comma
id|ramtypetable1
(braket
l_int|4
op_plus
id|ramtype
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x17
comma
id|ramtypetable1
(braket
l_int|8
op_plus
id|ramtype
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x19
comma
id|ramtypetable1
(braket
l_int|16
op_plus
id|ramtype
)braket
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREGOR
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0x20
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x22
comma
l_int|0xfb
)paren
suffix:semicolon
id|ret
op_or_assign
id|SETIREG
c_func
(paren
id|SISSR
comma
l_int|0x21
comma
l_int|0xa5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|macro|SETREG
macro_line|#undef SETREG
DECL|macro|GETREG
macro_line|#undef GETREG
DECL|macro|SETIREG
macro_line|#undef SETIREG
DECL|macro|GETIREG
macro_line|#undef GETIREG
DECL|macro|SETIREGOR
macro_line|#undef SETIREGOR
DECL|macro|SETIREGAND
macro_line|#undef SETIREGAND
DECL|macro|SETIREGANDOR
macro_line|#undef SETIREGANDOR
DECL|macro|READL
macro_line|#undef READL
DECL|macro|WRITEL
macro_line|#undef WRITEL
r_static
r_void
DECL|function|sisusb_get_ramconfig
id|sisusb_get_ramconfig
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
id|u8
id|tmp8
comma
id|tmp82
comma
id|ramtype
suffix:semicolon
r_int
id|bw
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|ramtypetext1
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|ramtypetext2
(braket
)braket
op_assign
(brace
l_string|&quot;SDR SDRAM&quot;
comma
l_string|&quot;SDR SGRAM&quot;
comma
l_string|&quot;DDR SDRAM&quot;
comma
l_string|&quot;DDR SGRAM&quot;
)brace
suffix:semicolon
r_static
r_const
r_int
id|busSDR
(braket
l_int|4
)braket
op_assign
(brace
l_int|64
comma
l_int|64
comma
l_int|128
comma
l_int|128
)brace
suffix:semicolon
r_static
r_const
r_int
id|busDDR
(braket
l_int|4
)braket
op_assign
(brace
l_int|32
comma
l_int|32
comma
l_int|64
comma
l_int|64
)brace
suffix:semicolon
r_static
r_const
r_int
id|busDDRA
(braket
l_int|4
)braket
op_assign
(brace
l_int|64
op_plus
l_int|32
comma
l_int|64
op_plus
l_int|32
comma
(paren
l_int|64
op_plus
l_int|32
)paren
op_star
l_int|2
comma
(paren
l_int|64
op_plus
l_int|32
)paren
op_star
l_int|2
)brace
suffix:semicolon
id|sisusb_getidxreg
c_func
(paren
id|sisusb
comma
id|SISSR
comma
l_int|0x14
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|sisusb_getidxreg
c_func
(paren
id|sisusb
comma
id|SISSR
comma
l_int|0x15
comma
op_amp
id|tmp82
)paren
suffix:semicolon
id|sisusb_getidxreg
c_func
(paren
id|sisusb
comma
id|SISSR
comma
l_int|0x3a
comma
op_amp
id|ramtype
)paren
suffix:semicolon
id|sisusb-&gt;vramsize
op_assign
(paren
l_int|1
op_lshift
(paren
(paren
id|tmp8
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
)paren
op_star
l_int|1024
op_star
l_int|1024
suffix:semicolon
id|ramtype
op_and_assign
l_int|0x03
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tmp8
op_rshift
l_int|2
)paren
op_amp
l_int|0x03
)paren
(brace
r_case
l_int|0
suffix:colon
id|ramtypetext1
op_assign
l_string|&quot;1 ch/1 r&quot;
suffix:semicolon
r_if
c_cond
(paren
id|tmp82
op_amp
l_int|0x10
)paren
(brace
id|bw
op_assign
l_int|32
suffix:semicolon
)brace
r_else
(brace
id|bw
op_assign
id|busSDR
(braket
(paren
id|tmp8
op_amp
l_int|0x03
)paren
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ramtypetext1
op_assign
l_string|&quot;1 ch/2 r&quot;
suffix:semicolon
id|sisusb-&gt;vramsize
op_lshift_assign
l_int|1
suffix:semicolon
id|bw
op_assign
id|busSDR
(braket
(paren
id|tmp8
op_amp
l_int|0x03
)paren
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ramtypetext1
op_assign
l_string|&quot;asymmeric&quot;
suffix:semicolon
id|sisusb-&gt;vramsize
op_add_assign
id|sisusb-&gt;vramsize
op_div
l_int|2
suffix:semicolon
id|bw
op_assign
id|busDDRA
(braket
(paren
id|tmp8
op_amp
l_int|0x03
)paren
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ramtypetext1
op_assign
l_string|&quot;2 channel&quot;
suffix:semicolon
id|sisusb-&gt;vramsize
op_lshift_assign
l_int|1
suffix:semicolon
id|bw
op_assign
id|busDDR
(braket
(paren
id|tmp8
op_amp
l_int|0x03
)paren
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusbvga[%d]: %dMB %s %s, bus width %d&bslash;n&quot;
comma
id|sisusb-&gt;minor
comma
(paren
id|sisusb-&gt;vramsize
op_rshift
l_int|20
)paren
comma
id|ramtypetext1
comma
id|ramtypetext2
(braket
id|ramtype
)braket
comma
id|bw
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_do_init_gfxdevice
id|sisusb_do_init_gfxdevice
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
)paren
(brace
r_struct
id|sisusb_packet
id|packet
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|u32
id|tmp32
suffix:semicolon
multiline_comment|/* Do some magic */
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000324
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000004
suffix:semicolon
id|ret
op_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000364
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000004
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000384
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000004
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000100
suffix:semicolon
id|packet.data
op_assign
l_int|0x00000700
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.header
op_assign
l_int|0x000f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000004
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|6
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
id|packet.data
op_or_assign
l_int|0x17
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Init BAR 0 (VRAM) */
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x10
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x10
comma
l_int|0xfffffff0
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x10
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|tmp32
op_and_assign
l_int|0x0f
suffix:semicolon
id|tmp32
op_or_assign
id|SISUSB_PCI_MEMBASE
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x10
comma
id|tmp32
)paren
suffix:semicolon
multiline_comment|/* Init BAR 1 (MMIO) */
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x14
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x14
comma
l_int|0xfffffff0
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x14
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|tmp32
op_and_assign
l_int|0x0f
suffix:semicolon
id|tmp32
op_or_assign
id|SISUSB_PCI_MMIOBASE
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x14
comma
id|tmp32
)paren
suffix:semicolon
multiline_comment|/* Init BAR 2 (i/o ports) */
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x18
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x18
comma
l_int|0xfffffff0
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x18
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|tmp32
op_and_assign
l_int|0x0f
suffix:semicolon
id|tmp32
op_or_assign
id|SISUSB_PCI_IOPORTBASE
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x18
comma
id|tmp32
)paren
suffix:semicolon
multiline_comment|/* Enable memory and i/o access */
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x04
comma
op_amp
id|tmp32
)paren
suffix:semicolon
id|tmp32
op_or_assign
l_int|0x3
suffix:semicolon
id|ret
op_or_assign
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x04
comma
id|tmp32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Some further magic */
id|packet.header
op_assign
l_int|0x001f
suffix:semicolon
id|packet.address
op_assign
l_int|0x00000050
suffix:semicolon
id|packet.data
op_assign
l_int|0x000000ff
suffix:semicolon
id|ret
op_or_assign
id|sisusb_send_bridge_packet
c_func
(paren
id|sisusb
comma
l_int|10
comma
op_amp
id|packet
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Initialize the graphics device (return 0 on success)&n; * This initializes the net2280 as well as the PCI registers&n; * of the graphics board.&n; */
r_static
r_int
DECL|function|sisusb_init_gfxdevice
id|sisusb_init_gfxdevice
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_int
id|initscreen
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|test
op_assign
l_int|0
suffix:semicolon
id|u32
id|tmp32
suffix:semicolon
r_if
c_cond
(paren
id|sisusb-&gt;devinit
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Read PCI BARs and see if they have been set up */
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x10
comma
op_amp
id|tmp32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp32
op_amp
l_int|0xfffffff0
)paren
op_eq
id|SISUSB_PCI_MEMBASE
)paren
id|test
op_increment
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x14
comma
op_amp
id|tmp32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp32
op_amp
l_int|0xfffffff0
)paren
op_eq
id|SISUSB_PCI_MMIOBASE
)paren
id|test
op_increment
suffix:semicolon
id|ret
op_or_assign
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
l_int|0x18
comma
op_amp
id|tmp32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp32
op_amp
l_int|0xfffffff0
)paren
op_eq
id|SISUSB_PCI_IOPORTBASE
)paren
id|test
op_increment
suffix:semicolon
)brace
multiline_comment|/* No? So reset the device */
r_if
c_cond
(paren
(paren
id|sisusb-&gt;devinit
op_eq
l_int|0
)paren
op_logical_or
(paren
id|test
op_ne
l_int|3
)paren
)paren
(brace
id|ret
op_or_assign
id|sisusb_do_init_gfxdevice
c_func
(paren
id|sisusb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|sisusb-&gt;devinit
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisusb-&gt;devinit
)paren
(brace
multiline_comment|/* Initialize the graphics core */
r_if
c_cond
(paren
id|sisusb_init_gfxcore
c_func
(paren
id|sisusb
)paren
op_eq
l_int|0
)paren
(brace
id|sisusb-&gt;gfxinit
op_assign
l_int|1
suffix:semicolon
id|sisusb_get_ramconfig
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_set_default_mode
c_func
(paren
id|sisusb
comma
l_int|1
)paren
suffix:semicolon
id|ret
op_or_assign
id|sisusb_setup_screen
c_func
(paren
id|sisusb
comma
l_int|1
comma
id|initscreen
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* fops */
r_int
DECL|function|sisusb_open
id|sisusb_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_struct
id|usb_interface
op_star
id|interface
suffix:semicolon
r_int
id|subminor
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|interface
op_assign
id|usb_find_interface
c_func
(paren
op_amp
id|sisusb_driver
comma
id|subminor
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusb[%d]: Failed to find interface&bslash;n&quot;
comma
id|subminor
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
id|usb_get_intfdata
c_func
(paren
id|interface
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;ready
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sisusb-&gt;isopen
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;devinit
)paren
(brace
r_if
c_cond
(paren
id|sisusb-&gt;sisusb_dev-&gt;speed
op_eq
id|USB_SPEED_HIGH
)paren
(brace
r_if
c_cond
(paren
id|sisusb_init_gfxdevice
c_func
(paren
id|sisusb
comma
l_int|0
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Failed to initialize &quot;
l_string|&quot;device&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Device not attached to &quot;
l_string|&quot;USB 2.0 hub&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
multiline_comment|/* increment usage count for the device */
id|kref_get
c_func
(paren
op_amp
id|sisusb-&gt;kref
)paren
suffix:semicolon
id|sisusb-&gt;isopen
op_assign
l_int|1
suffix:semicolon
id|file-&gt;private_data
op_assign
id|sisusb
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisusbvga[%d]: opened&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sisusb_delete
id|sisusb_delete
c_func
(paren
r_struct
id|kref
op_star
id|kref
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
op_assign
id|to_sisusb_dev
c_func
(paren
id|kref
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisusb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|sisusb-&gt;sisusb_dev
)paren
id|usb_put_dev
c_func
(paren
id|sisusb-&gt;sisusb_dev
)paren
suffix:semicolon
id|sisusb-&gt;sisusb_dev
op_assign
l_int|NULL
suffix:semicolon
id|sisusb_free_buffers
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|sisusb_free_urbs
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sisusb
)paren
suffix:semicolon
)brace
r_int
DECL|function|sisusb_release
id|sisusb_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_int
id|myminor
suffix:semicolon
id|down
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
(paren
r_struct
id|sisusb_usb_data
op_star
)paren
id|file-&gt;private_data
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisusb-&gt;present
)paren
(brace
multiline_comment|/* Wait for all URBs to finish if device still present */
r_if
c_cond
(paren
op_logical_neg
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
)paren
id|sisusb_kill_all_busy
c_func
(paren
id|sisusb
)paren
suffix:semicolon
)brace
id|myminor
op_assign
id|sisusb-&gt;minor
suffix:semicolon
id|sisusb-&gt;isopen
op_assign
l_int|0
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* decrement the usage count on our device */
id|kref_put
c_func
(paren
op_amp
id|sisusb-&gt;kref
comma
id|sisusb_delete
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sisusbvga[%d]: released&quot;
comma
id|myminor
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ssize_t
DECL|function|sisusb_read
id|sisusb_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
id|ssize_t
id|bytes_read
op_assign
l_int|0
suffix:semicolon
r_int
id|errno
op_assign
l_int|0
suffix:semicolon
id|u8
id|buf8
suffix:semicolon
id|u16
id|buf16
suffix:semicolon
id|u32
id|buf32
comma
id|address
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
(paren
r_struct
id|sisusb_usb_data
op_star
)paren
id|file-&gt;private_data
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;ready
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_plus
l_int|128
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_plus
id|SISUSB_PCI_IOPORTBASE
suffix:semicolon
multiline_comment|/* Read i/o ports&n;&t;&t; * Byte, word and long(32) can be read. As this&n;&t;&t; * emulates inX instructions, the data returned is&n;&t;&t; * in machine-endianness.&n;&t;&t; */
r_switch
c_cond
(paren
id|count
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|sisusb_read_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
op_amp
id|buf8
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|buf8
comma
(paren
id|u8
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|bytes_read
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|sisusb_read_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
op_amp
id|buf16
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|buf16
comma
(paren
id|u16
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|bytes_read
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|sisusb_read_memio_long
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
op_amp
id|buf32
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|buf32
comma
(paren
id|u32
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|bytes_read
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_MEMBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_MEMBASE
op_plus
id|sisusb-&gt;vramsize
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_MEMBASE
op_plus
id|SISUSB_PCI_MEMBASE
suffix:semicolon
multiline_comment|/* Read video ram&n;&t;&t; * Remember: Data delivered is never endian-corrected&n;&t;&t; */
id|errno
op_assign
id|sisusb_read_mem_bulk
c_func
(paren
id|sisusb
comma
id|address
comma
l_int|NULL
comma
id|count
comma
id|buffer
comma
op_amp
id|bytes_read
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_read
)paren
id|errno
op_assign
id|bytes_read
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_plus
id|SISUSB_PCI_MMIOSIZE
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_plus
id|SISUSB_PCI_MMIOBASE
suffix:semicolon
multiline_comment|/* Read MMIO&n;&t;&t; * Remember: Data delivered is never endian-corrected&n;&t;&t; */
id|errno
op_assign
id|sisusb_read_mem_bulk
c_func
(paren
id|sisusb
comma
id|address
comma
l_int|NULL
comma
id|count
comma
id|buffer
comma
op_amp
id|bytes_read
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_read
)paren
id|errno
op_assign
id|bytes_read
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_PCIBASE
op_logical_and
(paren
op_star
id|ppos
)paren
op_le
id|SISUSB_PCI_PSEUDO_PCIBASE
op_plus
l_int|0x5c
)paren
(brace
r_if
c_cond
(paren
id|count
op_ne
l_int|4
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_PCIBASE
suffix:semicolon
multiline_comment|/* Read PCI config register&n;&t;&t; * Return value delivered in machine endianness.&n;&t;&t; */
r_if
c_cond
(paren
id|sisusb_read_pci_config
c_func
(paren
id|sisusb
comma
id|address
comma
op_amp
id|buf32
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|buf32
comma
(paren
id|u32
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|bytes_read
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|errno
op_assign
op_minus
id|EBADFD
suffix:semicolon
)brace
(paren
op_star
id|ppos
)paren
op_add_assign
id|bytes_read
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
id|errno
ques
c_cond
id|errno
suffix:colon
id|bytes_read
suffix:semicolon
)brace
id|ssize_t
DECL|function|sisusb_write
id|sisusb_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_int
id|errno
op_assign
l_int|0
suffix:semicolon
id|ssize_t
id|bytes_written
op_assign
l_int|0
suffix:semicolon
id|u8
id|buf8
suffix:semicolon
id|u16
id|buf16
suffix:semicolon
id|u32
id|buf32
comma
id|address
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
(paren
r_struct
id|sisusb_usb_data
op_star
)paren
id|file-&gt;private_data
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;ready
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_plus
l_int|128
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_plus
id|SISUSB_PCI_IOPORTBASE
suffix:semicolon
multiline_comment|/* Write i/o ports&n;&t;&t; * Byte, word and long(32) can be written. As this&n;&t;&t; * emulates outX instructions, the data is expected&n;&t;&t; * in machine-endianness.&n;&t;&t; */
r_switch
c_cond
(paren
id|count
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf8
comma
(paren
id|u8
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sisusb_write_memio_byte
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
id|buf8
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
id|bytes_written
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf16
comma
(paren
id|u16
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sisusb_write_memio_word
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
id|buf16
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
id|bytes_written
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf32
comma
(paren
id|u32
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sisusb_write_memio_long
c_func
(paren
id|sisusb
comma
id|SISUSB_TYPE_IO
comma
id|address
comma
id|buf32
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
id|bytes_written
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_MEMBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_MEMBASE
op_plus
id|sisusb-&gt;vramsize
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_MEMBASE
op_plus
id|SISUSB_PCI_MEMBASE
suffix:semicolon
multiline_comment|/* Write video ram.&n;&t;&t; * Buffer is copied 1:1, therefore, on big-endian&n;&t;&t; * machines, the data must be swapped by userland&n;&t;&t; * in advance (if applicable; no swapping in 8bpp&n;&t;&t; * mode or if YUV data is being transferred).&n;&t;&t; */
id|errno
op_assign
id|sisusb_write_mem_bulk
c_func
(paren
id|sisusb
comma
id|address
comma
l_int|NULL
comma
id|count
comma
id|buffer
comma
l_int|0
comma
op_amp
id|bytes_written
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_written
)paren
id|errno
op_assign
id|bytes_written
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_logical_and
(paren
op_star
id|ppos
)paren
OL
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_plus
id|SISUSB_PCI_MMIOSIZE
)paren
(brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_MMIOBASE
op_plus
id|SISUSB_PCI_MMIOBASE
suffix:semicolon
multiline_comment|/* Write MMIO.&n;&t;&t; * Buffer is copied 1:1, therefore, on big-endian&n;&t;&t; * machines, the data must be swapped by userland&n;&t;&t; * in advance.&n;&t;&t; */
id|errno
op_assign
id|sisusb_write_mem_bulk
c_func
(paren
id|sisusb
comma
id|address
comma
l_int|NULL
comma
id|count
comma
id|buffer
comma
l_int|0
comma
op_amp
id|bytes_written
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_written
)paren
id|errno
op_assign
id|bytes_written
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|ppos
)paren
op_ge
id|SISUSB_PCI_PSEUDO_PCIBASE
op_logical_and
(paren
op_star
id|ppos
)paren
op_le
id|SISUSB_PCI_PSEUDO_PCIBASE
op_plus
id|SISUSB_PCI_PCONFSIZE
)paren
(brace
r_if
c_cond
(paren
id|count
op_ne
l_int|4
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|address
op_assign
(paren
op_star
id|ppos
)paren
op_minus
id|SISUSB_PCI_PSEUDO_PCIBASE
suffix:semicolon
multiline_comment|/* Write PCI config register.&n;&t;&t; * Given value expected in machine endianness.&n;&t;&t; */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf32
comma
(paren
id|u32
id|__user
op_star
)paren
id|buffer
)paren
)paren
id|errno
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sisusb_write_pci_config
c_func
(paren
id|sisusb
comma
id|address
comma
id|buf32
)paren
)paren
id|errno
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
id|bytes_written
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Error */
id|errno
op_assign
op_minus
id|EBADFD
suffix:semicolon
)brace
(paren
op_star
id|ppos
)paren
op_add_assign
id|bytes_written
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
id|errno
ques
c_cond
id|errno
suffix:colon
id|bytes_written
suffix:semicolon
)brace
r_static
id|loff_t
DECL|function|sisusb_lseek
id|sisusb_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|orig
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
id|loff_t
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
(paren
r_struct
id|sisusb_usb_data
op_star
)paren
id|file-&gt;private_data
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;ready
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
(brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|orig
)paren
(brace
r_case
l_int|0
suffix:colon
id|file-&gt;f_pos
op_assign
id|offset
suffix:semicolon
id|ret
op_assign
id|file-&gt;f_pos
suffix:semicolon
multiline_comment|/* never negative, no force_successful_syscall needed */
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|file-&gt;f_pos
op_add_assign
id|offset
suffix:semicolon
id|ret
op_assign
id|file-&gt;f_pos
suffix:semicolon
multiline_comment|/* never negative, no force_successful_syscall needed */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* seeking relative to &quot;end of file&quot; is not supported */
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_handle_command
id|sisusb_handle_command
c_func
(paren
r_struct
id|sisusb_usb_data
op_star
id|sisusb
comma
r_struct
id|sisusb_command
op_star
id|y
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|retval
comma
id|port
comma
id|length
suffix:semicolon
id|u32
id|address
suffix:semicolon
id|port
op_assign
id|y-&gt;data3
op_minus
id|SISUSB_PCI_PSEUDO_IOPORTBASE
op_plus
id|SISUSB_PCI_IOPORTBASE
suffix:semicolon
r_switch
c_cond
(paren
id|y-&gt;operation
)paren
(brace
r_case
id|SUCMD_GET
suffix:colon
id|retval
op_assign
id|sisusb_getidxreg
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
op_amp
id|y-&gt;data1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
id|y
comma
r_sizeof
(paren
op_star
id|y
)paren
)paren
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SUCMD_SET
suffix:colon
id|retval
op_assign
id|sisusb_setidxreg
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
id|y-&gt;data1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUCMD_SETOR
suffix:colon
id|retval
op_assign
id|sisusb_setidxregor
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
id|y-&gt;data1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUCMD_SETAND
suffix:colon
id|retval
op_assign
id|sisusb_setidxregand
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
id|y-&gt;data1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUCMD_SETANDOR
suffix:colon
id|retval
op_assign
id|sisusb_setidxregandor
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
id|y-&gt;data1
comma
id|y-&gt;data2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUCMD_SETMASK
suffix:colon
id|retval
op_assign
id|sisusb_setidxregmask
c_func
(paren
id|sisusb
comma
id|port
comma
id|y-&gt;data0
comma
id|y-&gt;data1
comma
id|y-&gt;data2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUCMD_CLRSCR
suffix:colon
id|length
op_assign
(paren
id|y-&gt;data0
op_lshift
l_int|16
)paren
op_or
(paren
id|y-&gt;data1
op_lshift
l_int|8
)paren
op_or
id|y-&gt;data2
suffix:semicolon
id|address
op_assign
id|y-&gt;data3
op_minus
id|SISUSB_PCI_PSEUDO_MEMBASE
op_plus
id|SISUSB_PCI_MEMBASE
suffix:semicolon
id|retval
op_assign
id|sisusb_clear_vram
c_func
(paren
id|sisusb
comma
id|address
comma
id|length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|retval
OG
l_int|0
)paren
(brace
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|sisusb_ioctl
id|sisusb_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_struct
id|sisusb_info
id|x
suffix:semicolon
r_struct
id|sisusb_command
id|y
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|u32
id|__user
op_star
id|argp
op_assign
(paren
id|u32
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
(paren
r_struct
id|sisusb_usb_data
op_star
)paren
id|file-&gt;private_data
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
op_logical_neg
id|sisusb-&gt;present
op_logical_or
op_logical_neg
id|sisusb-&gt;ready
op_logical_or
op_logical_neg
id|sisusb-&gt;sisusb_dev
)paren
(brace
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SISUSB_GET_CONFIG_SIZE
suffix:colon
r_if
c_cond
(paren
id|put_user
c_func
(paren
r_sizeof
(paren
id|x
)paren
comma
id|argp
)paren
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISUSB_GET_CONFIG
suffix:colon
id|x.sisusb_id
op_assign
id|SISUSB_ID
suffix:semicolon
id|x.sisusb_version
op_assign
id|SISUSB_VERSION
suffix:semicolon
id|x.sisusb_revision
op_assign
id|SISUSB_REVISION
suffix:semicolon
id|x.sisusb_patchlevel
op_assign
id|SISUSB_PATCHLEVEL
suffix:semicolon
id|x.sisusb_gfxinit
op_assign
id|sisusb-&gt;gfxinit
suffix:semicolon
id|x.sisusb_vrambase
op_assign
id|SISUSB_PCI_PSEUDO_MEMBASE
suffix:semicolon
id|x.sisusb_mmiobase
op_assign
id|SISUSB_PCI_PSEUDO_MMIOBASE
suffix:semicolon
id|x.sisusb_iobase
op_assign
id|SISUSB_PCI_PSEUDO_IOPORTBASE
suffix:semicolon
id|x.sisusb_pcibase
op_assign
id|SISUSB_PCI_PSEUDO_PCIBASE
suffix:semicolon
id|x.sisusb_vramsize
op_assign
id|sisusb-&gt;vramsize
suffix:semicolon
id|x.sisusb_minor
op_assign
id|sisusb-&gt;minor
suffix:semicolon
id|x.sisusb_fbdevactive
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
op_amp
id|x
comma
r_sizeof
(paren
id|x
)paren
)paren
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SISUSB_COMMAND
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|y
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|y
)paren
)paren
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|retval
op_assign
id|sisusb_handle_command
c_func
(paren
id|sisusb
comma
op_amp
id|y
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err_out
suffix:colon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#ifdef SISUSB_NEW_CONFIG_COMPAT
r_static
r_int
DECL|function|sisusb_compat_ioctl
id|sisusb_compat_ioctl
c_func
(paren
r_struct
id|file
op_star
id|f
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|retval
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SISUSB_GET_CONFIG_SIZE
suffix:colon
r_case
id|SISUSB_GET_CONFIG
suffix:colon
r_case
id|SISUSB_COMMAND
suffix:colon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
id|sisusb_ioctl
c_func
(paren
id|f-&gt;f_dentry-&gt;d_inode
comma
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|variable|usb_sisusb_fops
r_static
r_struct
id|file_operations
id|usb_sisusb_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|sisusb_open
comma
dot
id|release
op_assign
id|sisusb_release
comma
dot
id|read
op_assign
id|sisusb_read
comma
dot
id|write
op_assign
id|sisusb_write
comma
dot
id|llseek
op_assign
id|sisusb_lseek
comma
macro_line|#ifdef SISUSB_NEW_CONFIG_COMPAT
dot
id|compat_ioctl
op_assign
id|sisusb_compat_ioctl
comma
macro_line|#endif
dot
id|ioctl
op_assign
id|sisusb_ioctl
)brace
suffix:semicolon
DECL|variable|usb_sisusb_class
r_static
r_struct
id|usb_class_driver
id|usb_sisusb_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;usb/sisusbvga%d&quot;
comma
dot
id|fops
op_assign
op_amp
id|usb_sisusb_fops
comma
dot
id|mode
op_assign
id|S_IFCHR
op_or
id|S_IRUSR
op_or
id|S_IWUSR
op_or
id|S_IRGRP
op_or
id|S_IWGRP
comma
dot
id|minor_base
op_assign
id|SISUSB_MINOR
)brace
suffix:semicolon
DECL|function|sisusb_probe
r_static
r_int
id|sisusb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|dev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_const
r_char
op_star
id|memfail
op_assign
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Failed to allocate memory for %s buffer&bslash;n&quot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusb: USB2VGA dongle found at address %d&bslash;n&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
multiline_comment|/* Allocate memory for our private */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sisusb
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusb: Failed to allocate memory for private data&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sisusb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sisusb
)paren
)paren
suffix:semicolon
id|kref_init
c_func
(paren
op_amp
id|sisusb-&gt;kref
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
(paren
id|sisusb-&gt;lock
)paren
)paren
suffix:semicolon
multiline_comment|/* Register device */
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|usb_register_dev
c_func
(paren
id|intf
comma
op_amp
id|usb_sisusb_class
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusb: Failed to get a minor for device %d&bslash;n&quot;
comma
id|dev-&gt;devnum
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error_1
suffix:semicolon
)brace
id|sisusb-&gt;sisusb_dev
op_assign
id|dev
suffix:semicolon
id|sisusb-&gt;minor
op_assign
id|intf-&gt;minor
suffix:semicolon
id|sisusb-&gt;vrambase
op_assign
id|SISUSB_PCI_MEMBASE
suffix:semicolon
id|sisusb-&gt;mmiobase
op_assign
id|SISUSB_PCI_MMIOBASE
suffix:semicolon
id|sisusb-&gt;mmiosize
op_assign
id|SISUSB_PCI_MMIOSIZE
suffix:semicolon
id|sisusb-&gt;ioportbase
op_assign
id|SISUSB_PCI_IOPORTBASE
suffix:semicolon
multiline_comment|/* Everything else is zero */
multiline_comment|/* Allocate buffers */
id|sisusb-&gt;ibufsize
op_assign
id|SISUSB_IBUF_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb-&gt;ibuf
op_assign
id|usb_buffer_alloc
c_func
(paren
id|dev
comma
id|SISUSB_IBUF_SIZE
comma
id|GFP_KERNEL
comma
op_amp
id|sisusb-&gt;transfer_dma_in
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|memfail
comma
l_string|&quot;input&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_2
suffix:semicolon
)brace
id|sisusb-&gt;numobufs
op_assign
l_int|0
suffix:semicolon
id|sisusb-&gt;obufsize
op_assign
id|SISUSB_OBUF_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUMOBUFS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb-&gt;obuf
(braket
id|i
)braket
op_assign
id|usb_buffer_alloc
c_func
(paren
id|dev
comma
id|SISUSB_OBUF_SIZE
comma
id|GFP_KERNEL
comma
op_amp
id|sisusb-&gt;transfer_dma_out
(braket
id|i
)braket
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|memfail
comma
l_string|&quot;output&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_3
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
id|sisusb-&gt;numobufs
op_increment
suffix:semicolon
)brace
multiline_comment|/* Allocate URBs */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb-&gt;sisurbin
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Failed to allocate URBs&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_3
suffix:semicolon
)brace
id|sisusb-&gt;completein
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sisusb-&gt;numobufs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb-&gt;sisurbout
(braket
id|i
)braket
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Failed to allocate URBs&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_4
suffix:semicolon
)brace
id|sisusb-&gt;urbout_context
(braket
id|i
)braket
dot
id|sisusb
op_assign
(paren
r_void
op_star
)paren
id|sisusb
suffix:semicolon
id|sisusb-&gt;urbout_context
(braket
id|i
)braket
dot
id|urbindex
op_assign
id|i
suffix:semicolon
id|sisusb-&gt;urbstatus
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusbvga[%d]: Allocated %d output buffers&bslash;n&quot;
comma
id|sisusb-&gt;minor
comma
id|sisusb-&gt;numobufs
)paren
suffix:semicolon
multiline_comment|/* Do remaining init stuff */
id|init_waitqueue_head
c_func
(paren
op_amp
id|sisusb-&gt;wait_q
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|sisusb
)paren
suffix:semicolon
macro_line|#ifdef SISUSB_OLD_CONFIG_COMPAT
(brace
r_int
id|ret
suffix:semicolon
multiline_comment|/* Our ioctls are all &quot;32/64bit compatible&quot; */
id|ret
op_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISUSB_GET_CONFIG_SIZE
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISUSB_GET_CONFIG
comma
l_int|NULL
)paren
suffix:semicolon
id|ret
op_or_assign
id|register_ioctl32_conversion
c_func
(paren
id|SISUSB_COMMAND
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Error registering ioctl32 &quot;
l_string|&quot;translations&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
r_else
id|sisusb-&gt;ioctl32registered
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|sisusb-&gt;present
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;speed
op_eq
id|USB_SPEED_HIGH
)paren
(brace
r_if
c_cond
(paren
id|sisusb_init_gfxdevice
c_func
(paren
id|sisusb
comma
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Failed to early &quot;
l_string|&quot;initialize device&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusbvga[%d]: Not attached to USB 2.0 hub, &quot;
l_string|&quot;deferring init&bslash;n&quot;
comma
id|sisusb-&gt;minor
)paren
suffix:semicolon
id|sisusb-&gt;ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error_4
suffix:colon
id|sisusb_free_urbs
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|error_3
suffix:colon
id|sisusb_free_buffers
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|error_2
suffix:colon
id|usb_deregister_dev
c_func
(paren
id|intf
comma
op_amp
id|usb_sisusb_class
)paren
suffix:semicolon
id|error_1
suffix:colon
id|kfree
c_func
(paren
id|sisusb
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|sisusb_disconnect
r_static
r_void
id|sisusb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|sisusb_usb_data
op_star
id|sisusb
suffix:semicolon
r_int
id|minor
suffix:semicolon
id|down
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
multiline_comment|/* This should *not* happen */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisusb
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Wait for all URBs to complete and kill them in case (MUST do) */
r_if
c_cond
(paren
op_logical_neg
id|sisusb_wait_all_out_complete
c_func
(paren
id|sisusb
)paren
)paren
id|sisusb_kill_all_busy
c_func
(paren
id|sisusb
)paren
suffix:semicolon
id|minor
op_assign
id|sisusb-&gt;minor
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
l_int|NULL
)paren
suffix:semicolon
id|usb_deregister_dev
c_func
(paren
id|intf
comma
op_amp
id|usb_sisusb_class
)paren
suffix:semicolon
macro_line|#ifdef SISUSB_OLD_CONFIG_COMPAT
r_if
c_cond
(paren
id|sisusb-&gt;ioctl32registered
)paren
(brace
r_int
id|ret
suffix:semicolon
id|sisusb-&gt;ioctl32registered
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISUSB_GET_CONFIG_SIZE
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISUSB_GET_CONFIG
)paren
suffix:semicolon
id|ret
op_or_assign
id|unregister_ioctl32_conversion
c_func
(paren
id|SISUSB_COMMAND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sisusbvga[%d]: Error unregistering &quot;
l_string|&quot;ioctl32 translations&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|sisusb-&gt;present
op_assign
l_int|0
suffix:semicolon
id|sisusb-&gt;ready
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sisusb-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* decrement our usage count */
id|kref_put
c_func
(paren
op_amp
id|sisusb-&gt;kref
comma
id|sisusb_delete
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusbvga[%d]: Disconnected&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
)brace
DECL|variable|sisusb_table
r_static
r_struct
id|usb_device_id
id|sisusb_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0711
comma
l_int|0x0900
)paren
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|sisusb_table
)paren
suffix:semicolon
DECL|variable|sisusb_driver
r_static
r_struct
id|usb_driver
id|sisusb_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;sisusb&quot;
comma
dot
id|probe
op_assign
id|sisusb_probe
comma
dot
id|disconnect
op_assign
id|sisusb_disconnect
comma
dot
id|id_table
op_assign
id|sisusb_table
)brace
suffix:semicolon
DECL|function|usb_sisusb_init
r_static
r_int
id|__init
id|usb_sisusb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|retval
op_assign
id|usb_register
c_func
(paren
op_amp
id|sisusb_driver
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusb: Driver version %d.%d.%d&bslash;n&quot;
comma
id|SISUSB_VERSION
comma
id|SISUSB_REVISION
comma
id|SISUSB_PATCHLEVEL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sisusb: Copyright (C) 2005 Thomas Winischhofer&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|usb_sisusb_exit
r_static
r_void
id|__exit
id|usb_sisusb_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|sisusb_driver
)paren
suffix:semicolon
)brace
DECL|variable|usb_sisusb_init
id|module_init
c_func
(paren
id|usb_sisusb_init
)paren
suffix:semicolon
DECL|variable|usb_sisusb_exit
id|module_exit
c_func
(paren
id|usb_sisusb_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;sisusb - Driver for Net2280/SiS315-based USB2VGA dongles&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
