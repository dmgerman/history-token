multiline_comment|/* Driver for Philips webcam&n;   Functions that send various control messages to the webcam, including&n;   video modes.&n;   (C) 1999-2001 Nemosoft Unv. (webcam@smcc.demon.nl)&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License as published by&n;   the Free Software Foundation; either version 2 of the License, or&n;   (at your option) any later version.&n;&n;   This program is distributed in the hope that it will be useful,&n;   but WITHOUT ANY WARRANTY; without even the implied warranty of&n;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;   GNU General Public License for more details.&n;&n;   You should have received a copy of the GNU General Public License&n;   along with this program; if not, write to the Free Software&n;   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;*/
multiline_comment|/*&n;   Changes&n;   2001/08/03  Alvarado   Added methods for changing white balance and &n;                          red/green gains&n; */
multiline_comment|/* Control functions for the cam; brightness, contrast, video mode, etc. */
macro_line|#ifdef __KERNEL__
macro_line|#include &lt;asm/uaccess.h&gt; 
macro_line|#endif
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &quot;pwc.h&quot;
macro_line|#include &quot;pwc-ioctl.h&quot;
macro_line|#include &quot;pwc-uncompress.h&quot;
multiline_comment|/* Request types: video */
DECL|macro|SET_LUM_CTL
mdefine_line|#define SET_LUM_CTL&t;&t;&t;0x01
DECL|macro|GET_LUM_CTL
mdefine_line|#define GET_LUM_CTL&t;&t;&t;0x02
DECL|macro|SET_CHROM_CTL
mdefine_line|#define SET_CHROM_CTL&t;&t;&t;0x03
DECL|macro|GET_CHROM_CTL
mdefine_line|#define GET_CHROM_CTL&t;&t;&t;0x04
DECL|macro|SET_STATUS_CTL
mdefine_line|#define SET_STATUS_CTL&t;&t;&t;0x05
DECL|macro|GET_STATUS_CTL
mdefine_line|#define GET_STATUS_CTL&t;&t;&t;0x06
DECL|macro|SET_EP_STREAM_CTL
mdefine_line|#define SET_EP_STREAM_CTL&t;&t;0x07
DECL|macro|GET_EP_STREAM_CTL
mdefine_line|#define GET_EP_STREAM_CTL&t;&t;0x08
multiline_comment|/* Selectors for the Luminance controls [GS]ET_LUM_CTL */
DECL|macro|AGC_MODE_FORMATTER
mdefine_line|#define AGC_MODE_FORMATTER&t;&t;&t;0x2000
DECL|macro|PRESET_AGC_FORMATTER
mdefine_line|#define PRESET_AGC_FORMATTER&t;&t;&t;0x2100
DECL|macro|SHUTTER_MODE_FORMATTER
mdefine_line|#define SHUTTER_MODE_FORMATTER&t;&t;&t;0x2200
DECL|macro|PRESET_SHUTTER_FORMATTER
mdefine_line|#define PRESET_SHUTTER_FORMATTER&t;&t;0x2300
DECL|macro|PRESET_CONTOUR_FORMATTER
mdefine_line|#define PRESET_CONTOUR_FORMATTER&t;&t;0x2400
DECL|macro|AUTO_CONTOUR_FORMATTER
mdefine_line|#define AUTO_CONTOUR_FORMATTER&t;&t;&t;0x2500
DECL|macro|BACK_LIGHT_COMPENSATION_FORMATTER
mdefine_line|#define BACK_LIGHT_COMPENSATION_FORMATTER&t;0x2600
DECL|macro|CONTRAST_FORMATTER
mdefine_line|#define CONTRAST_FORMATTER&t;&t;&t;0x2700
DECL|macro|DYNAMIC_NOISE_CONTROL_FORMATTER
mdefine_line|#define DYNAMIC_NOISE_CONTROL_FORMATTER&t;&t;0x2800
DECL|macro|FLICKERLESS_MODE_FORMATTER
mdefine_line|#define FLICKERLESS_MODE_FORMATTER&t;&t;0x2900
DECL|macro|AE_CONTROL_SPEED
mdefine_line|#define AE_CONTROL_SPEED&t;&t;&t;0x2A00
DECL|macro|BRIGHTNESS_FORMATTER
mdefine_line|#define BRIGHTNESS_FORMATTER&t;&t;&t;0x2B00
DECL|macro|GAMMA_FORMATTER
mdefine_line|#define GAMMA_FORMATTER&t;&t;&t;&t;0x2C00
multiline_comment|/* Selectors for the Chrominance controls [GS]ET_CHROM_CTL */
DECL|macro|WB_MODE_FORMATTER
mdefine_line|#define WB_MODE_FORMATTER&t;&t;&t;0x1000
DECL|macro|AWB_CONTROL_SPEED_FORMATTER
mdefine_line|#define AWB_CONTROL_SPEED_FORMATTER&t;&t;0x1100
DECL|macro|AWB_CONTROL_DELAY_FORMATTER
mdefine_line|#define AWB_CONTROL_DELAY_FORMATTER&t;&t;0x1200
DECL|macro|PRESET_MANUAL_RED_GAIN_FORMATTER
mdefine_line|#define PRESET_MANUAL_RED_GAIN_FORMATTER&t;0x1300
DECL|macro|PRESET_MANUAL_BLUE_GAIN_FORMATTER
mdefine_line|#define PRESET_MANUAL_BLUE_GAIN_FORMATTER&t;0x1400
DECL|macro|COLOUR_MODE_FORMATTER
mdefine_line|#define COLOUR_MODE_FORMATTER&t;&t;&t;0x1500
DECL|macro|SATURATION_MODE_FORMATTER1
mdefine_line|#define SATURATION_MODE_FORMATTER1&t;&t;0x1600
DECL|macro|SATURATION_MODE_FORMATTER2
mdefine_line|#define SATURATION_MODE_FORMATTER2&t;&t;0x1700
multiline_comment|/* Selectors for the Status controls [GS]ET_STATUS_CTL */
DECL|macro|SAVE_USER_DEFAULTS_FORMATTER
mdefine_line|#define SAVE_USER_DEFAULTS_FORMATTER&t;&t;0x0200
DECL|macro|RESTORE_USER_DEFAULTS_FORMATTER
mdefine_line|#define RESTORE_USER_DEFAULTS_FORMATTER&t;&t;0x0300
DECL|macro|RESTORE_FACTORY_DEFAULTS_FORMATTER
mdefine_line|#define RESTORE_FACTORY_DEFAULTS_FORMATTER&t;0x0400
DECL|macro|READ_AGC_FORMATTER
mdefine_line|#define READ_AGC_FORMATTER&t;&t;&t;0x0500
DECL|macro|READ_SHUTTER_FORMATTER
mdefine_line|#define READ_SHUTTER_FORMATTER&t;&t;&t;0x0600
DECL|macro|READ_RED_GAIN_FORMATTER
mdefine_line|#define READ_RED_GAIN_FORMATTER&t;&t;&t;0x0700
DECL|macro|READ_BLUE_GAIN_FORMATTER
mdefine_line|#define READ_BLUE_GAIN_FORMATTER&t;&t;0x0800
DECL|macro|READ_RAW_Y_MEAN_FORMATTER
mdefine_line|#define READ_RAW_Y_MEAN_FORMATTER&t;&t;0x3100
DECL|macro|SET_POWER_SAVE_MODE_FORMATTER
mdefine_line|#define SET_POWER_SAVE_MODE_FORMATTER&t;&t;0x3200
DECL|macro|MIRROR_IMAGE_FORMATTER
mdefine_line|#define MIRROR_IMAGE_FORMATTER&t;&t;&t;0x3300
DECL|macro|LED_FORMATTER
mdefine_line|#define LED_FORMATTER&t;&t;&t;&t;0x3400
multiline_comment|/* Formatters for the Video Endpoint controls [GS]ET_EP_STREAM_CTL */
DECL|macro|VIDEO_OUTPUT_CONTROL_FORMATTER
mdefine_line|#define VIDEO_OUTPUT_CONTROL_FORMATTER&t;&t;0x0100
DECL|variable|size2name
r_static
r_char
op_star
id|size2name
(braket
id|PSZ_MAX
)braket
op_assign
(brace
l_string|&quot;subQCIF&quot;
comma
l_string|&quot;QSIF&quot;
comma
l_string|&quot;QCIF&quot;
comma
l_string|&quot;SIF&quot;
comma
l_string|&quot;CIF&quot;
comma
l_string|&quot;VGA&quot;
comma
)brace
suffix:semicolon
multiline_comment|/********/
multiline_comment|/* Entries for the Nala (645/646) camera; the Nala doesn&squot;t have compression &n;   preferences, so you either get compressed or non-compressed streams.&n;   &n;   An alternate value of 0 means this mode is not available at all.&n; */
DECL|struct|Nala_table_entry
r_struct
id|Nala_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate setting */
DECL|member|compressed
r_int
id|compressed
suffix:semicolon
multiline_comment|/* Compressed yes/no */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* precomputed mode table */
)brace
suffix:semicolon
DECL|variable|Nala_table
r_static
r_struct
id|Nala_table_entry
id|Nala_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|8
)braket
op_assign
(brace
macro_line|#include &quot;pwc_nala.h&quot;
)brace
suffix:semicolon
multiline_comment|/* This tables contains entries for the 675/680/690 (Timon) camera, with&n;   4 different qualities (no compression, low, medium, high).&n;   It lists the bandwidth requirements for said mode by its alternate interface &n;   number. An alternate of 0 means that the mode is unavailable.&n;   &n;   There are 6 * 4 * 4 entries: &n;     6 different resolutions subqcif, qsif, qcif, sif, cif, vga&n;     6 framerates: 5, 10, 15, 20, 25, 30&n;     4 compression modi: none, low, medium, high&n;     &n;   When an uncompressed mode is not available, the next available compressed mode &n;   will be choosen (unless the decompressor is absent). Sometimes there are only&n;   1 or 2 compressed modes available; in that case entries are duplicated.&n;*/
DECL|struct|Timon_table_entry
r_struct
id|Timon_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate interface */
DECL|member|packetsize
r_int
r_int
id|packetsize
suffix:semicolon
multiline_comment|/* Normal packet size */
DECL|member|bandlength
r_int
r_int
id|bandlength
suffix:semicolon
multiline_comment|/* Bandlength when decompressing */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|13
)braket
suffix:semicolon
multiline_comment|/* precomputed mode settings for cam */
)brace
suffix:semicolon
DECL|variable|Timon_table
r_static
r_struct
id|Timon_table_entry
id|Timon_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|6
)braket
(braket
l_int|4
)braket
op_assign
(brace
macro_line|#include &quot;pwc_timon.h&quot;
)brace
suffix:semicolon
multiline_comment|/* Entries for the Kiara (730/740/750) camera */
DECL|struct|Kiara_table_entry
r_struct
id|Kiara_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate interface */
DECL|member|packetsize
r_int
r_int
id|packetsize
suffix:semicolon
multiline_comment|/* Normal packet size */
DECL|member|bandlength
r_int
r_int
id|bandlength
suffix:semicolon
multiline_comment|/* Bandlength when decompressing */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|12
)braket
suffix:semicolon
multiline_comment|/* precomputed mode settings for cam */
)brace
suffix:semicolon
DECL|variable|Kiara_table
r_static
r_struct
id|Kiara_table_entry
id|Kiara_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|6
)braket
(braket
l_int|4
)braket
op_assign
(brace
macro_line|#include &quot;pwc_kiara.h&quot;
)brace
suffix:semicolon
multiline_comment|/****************************************************************************/
macro_line|#if PWC_DEBUG
DECL|function|pwc_hexdump
r_void
id|pwc_hexdump
c_func
(paren
r_void
op_star
id|p
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|s
suffix:semicolon
r_char
id|buf
(braket
l_int|100
)braket
comma
op_star
id|d
suffix:semicolon
id|s
op_assign
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
id|d
op_assign
id|buf
suffix:semicolon
op_star
id|d
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|Debug
c_func
(paren
l_string|&quot;Doing hexdump @ %p, %d bytes.&bslash;n&quot;
comma
id|p
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|d
op_add_assign
id|sprintf
c_func
(paren
id|d
comma
l_string|&quot;%02X &quot;
comma
op_star
id|s
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0xF
)paren
op_eq
l_int|0xF
)paren
(brace
id|Debug
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
id|d
op_assign
id|buf
suffix:semicolon
op_star
id|d
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0xF
)paren
op_ne
l_int|0
)paren
id|Debug
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|send_video_command
r_static
r_inline
r_int
id|send_video_command
c_func
(paren
r_struct
id|usb_device
op_star
id|udev
comma
r_int
id|index
comma
r_void
op_star
id|buf
comma
r_int
id|buflen
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
id|SET_EP_STREAM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|VIDEO_OUTPUT_CONTROL_FORMATTER
comma
id|index
comma
id|buf
comma
id|buflen
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|set_video_mode_Nala
r_static
r_inline
r_int
id|set_video_mode_Nala
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|ret
comma
id|fps
suffix:semicolon
r_struct
id|Nala_table_entry
op_star
id|pEntry
suffix:semicolon
r_int
id|frames2frames
(braket
l_int|31
)braket
op_assign
(brace
multiline_comment|/* closest match of framerate */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|4
comma
multiline_comment|/*  0-4  */
l_int|5
comma
l_int|5
comma
l_int|7
comma
l_int|7
comma
l_int|10
comma
multiline_comment|/*  5-9  */
l_int|10
comma
l_int|10
comma
l_int|12
comma
l_int|12
comma
l_int|15
comma
multiline_comment|/* 10-14 */
l_int|15
comma
l_int|15
comma
l_int|15
comma
l_int|20
comma
l_int|20
comma
multiline_comment|/* 15-19 */
l_int|20
comma
l_int|20
comma
l_int|20
comma
l_int|24
comma
l_int|24
comma
multiline_comment|/* 20-24 */
l_int|24
comma
l_int|24
comma
l_int|24
comma
l_int|24
comma
l_int|24
comma
multiline_comment|/* 25-29 */
l_int|24
multiline_comment|/* 30    */
)brace
suffix:semicolon
r_int
id|frames2table
(braket
l_int|31
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/*  0-4  */
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
multiline_comment|/*  5-9  */
l_int|3
comma
l_int|3
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
multiline_comment|/* 10-14 */
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
multiline_comment|/* 15-19 */
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|7
comma
multiline_comment|/* 20-24 */
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
multiline_comment|/* 25-29 */
l_int|7
multiline_comment|/* 30    */
)brace
suffix:semicolon
r_if
c_cond
(paren
id|size
template_param
id|PSZ_CIF
op_logical_or
id|frames
template_param
l_int|25
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|frames
op_assign
id|frames2frames
(braket
id|frames
)braket
suffix:semicolon
id|fps
op_assign
id|frames2table
(braket
id|frames
)braket
suffix:semicolon
id|pEntry
op_assign
op_amp
id|Nala_table
(braket
id|size
)braket
(braket
id|fps
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;compressed
op_logical_and
id|pdev-&gt;decompressor
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
id|memcpy
c_func
(paren
id|buf
comma
id|pEntry-&gt;mode
comma
l_int|3
)paren
suffix:semicolon
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
id|pdev-&gt;vendpoint
comma
id|buf
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;compressed
)paren
id|pdev-&gt;decompressor
op_member_access_from_pointer
id|init
c_func
(paren
id|pdev-&gt;release
comma
id|buf
comma
id|pdev-&gt;decompress_data
)paren
suffix:semicolon
multiline_comment|/* Set various parameters */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pEntry-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|3
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;compressed
)paren
(brace
r_if
c_cond
(paren
id|pdev-&gt;release
OL
l_int|5
)paren
(brace
multiline_comment|/* 4 fold compression */
id|pdev-&gt;vbandlength
op_assign
l_int|528
suffix:semicolon
id|pdev-&gt;frame_size
op_div_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|pdev-&gt;vbandlength
op_assign
l_int|704
suffix:semicolon
id|pdev-&gt;frame_size
op_div_assign
l_int|3
suffix:semicolon
)brace
)brace
r_else
id|pdev-&gt;vbandlength
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_video_mode_Timon
r_static
r_inline
r_int
id|set_video_mode_Timon
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|13
)braket
suffix:semicolon
r_struct
id|Timon_table_entry
op_star
id|pChoose
suffix:semicolon
r_int
id|ret
comma
id|fps
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|PSZ_MAX
op_logical_or
id|frames
template_param
l_int|30
op_logical_or
id|compression
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
id|PSZ_VGA
op_logical_and
id|frames
OG
l_int|15
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fps
op_assign
(paren
id|frames
op_div
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Find a supported framerate with progressively higher compression ratios&n;&t;   if the preferred ratio is not available.&n;&t;*/
id|pChoose
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;decompressor
op_eq
l_int|NULL
)paren
(brace
macro_line|#if PWC_DEBUG&t;
id|Debug
c_func
(paren
l_string|&quot;Trying to find uncompressed mode.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pChoose
op_assign
op_amp
id|Timon_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|compression
op_le
l_int|3
)paren
(brace
id|pChoose
op_assign
op_amp
id|Timon_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
id|compression
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;alternate
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|compression
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pChoose
op_eq
l_int|NULL
op_logical_or
id|pChoose-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
id|memcpy
c_func
(paren
id|buf
comma
id|pChoose-&gt;mode
comma
l_int|13
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snapshot
)paren
id|buf
(braket
l_int|0
)braket
op_or_assign
l_int|0x80
suffix:semicolon
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
id|pdev-&gt;vendpoint
comma
id|buf
comma
l_int|13
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;bandlength
OG
l_int|0
)paren
id|pdev-&gt;decompressor
op_member_access_from_pointer
id|init
c_func
(paren
id|pdev-&gt;release
comma
id|buf
comma
id|pdev-&gt;decompress_data
)paren
suffix:semicolon
multiline_comment|/* Set various parameters */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;vsnapshot
op_assign
id|snapshot
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pChoose-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;vbandlength
op_assign
id|pChoose-&gt;bandlength
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;bandlength
OG
l_int|0
)paren
id|pdev-&gt;frame_size
op_assign
(paren
id|pChoose-&gt;bandlength
op_star
id|pdev-&gt;image.y
)paren
op_div
l_int|4
suffix:semicolon
r_else
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|12
)paren
op_div
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_video_mode_Kiara
r_static
r_inline
r_int
id|set_video_mode_Kiara
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_struct
id|Kiara_table_entry
op_star
id|pChoose
suffix:semicolon
r_int
id|fps
comma
id|ret
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|12
)braket
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|PSZ_MAX
op_logical_or
id|frames
template_param
l_int|30
op_logical_or
id|compression
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
id|PSZ_VGA
op_logical_and
id|frames
OG
l_int|15
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fps
op_assign
(paren
id|frames
op_div
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Find a supported framerate with progressively higher compression ratios&n;&t;   if the preferred ratio is not available.&n;&t;*/
id|pChoose
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;decompressor
op_eq
l_int|NULL
)paren
(brace
macro_line|#if PWC_DEBUG&t;
id|Debug
c_func
(paren
l_string|&quot;Trying to find uncompressed mode.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|pChoose
op_assign
op_amp
id|Kiara_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|compression
op_le
l_int|3
)paren
(brace
id|pChoose
op_assign
op_amp
id|Kiara_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
id|compression
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;alternate
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|compression
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pChoose
op_eq
l_int|NULL
op_logical_or
id|pChoose-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
multiline_comment|/* usb_control_msg won&squot;t take staticly allocated arrays as argument?? */
id|memcpy
c_func
(paren
id|buf
comma
id|pChoose-&gt;mode
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snapshot
)paren
id|buf
(braket
l_int|0
)braket
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Firmware bug: video endpoint is 5, but commands are sent to endpoint 4 */
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
l_int|4
multiline_comment|/* pdev-&gt;vendpoint */
comma
id|buf
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;bandlength
OG
l_int|0
)paren
id|pdev-&gt;decompressor
op_member_access_from_pointer
id|init
c_func
(paren
id|pdev-&gt;release
comma
id|buf
comma
id|pdev-&gt;decompress_data
)paren
suffix:semicolon
multiline_comment|/* All set and go */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;vsnapshot
op_assign
id|snapshot
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pChoose-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;vbandlength
op_assign
id|pChoose-&gt;bandlength
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;bandlength
OG
l_int|0
)paren
id|pdev-&gt;frame_size
op_assign
(paren
id|pChoose-&gt;bandlength
op_star
id|pdev-&gt;image.y
)paren
op_div
l_int|4
suffix:semicolon
r_else
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|12
)paren
op_div
l_int|8
suffix:semicolon
id|pdev-&gt;frame_size
op_add_assign
(paren
id|pdev-&gt;frame_header_size
op_plus
id|pdev-&gt;frame_trailer_size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n;   @pdev: device structure&n;   @width: viewport width&n;   @height: viewport height&n;   @frame: framerate, in fps&n;   @compression: preferred compression ratio&n;   @snapshot: snapshot mode or streaming&n; */
DECL|function|pwc_set_video_mode
r_int
id|pwc_set_video_mode
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|width
comma
r_int
id|height
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_int
id|ret
comma
id|size
suffix:semicolon
id|size
op_assign
id|pwc_decode_size
c_func
(paren
id|pdev
comma
id|width
comma
id|height
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
(brace
id|Debug
c_func
(paren
l_string|&quot;Could not find suitable size.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ERANGE
suffix:semicolon
)brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;type
)paren
(brace
r_case
l_int|645
suffix:colon
r_case
l_int|646
suffix:colon
id|ret
op_assign
id|set_video_mode_Nala
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|675
suffix:colon
r_case
l_int|680
suffix:colon
r_case
l_int|690
suffix:colon
id|ret
op_assign
id|set_video_mode_Timon
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
comma
id|compression
comma
id|snapshot
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|730
suffix:colon
r_case
l_int|740
suffix:colon
r_case
l_int|750
suffix:colon
id|ret
op_assign
id|set_video_mode_Kiara
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
comma
id|compression
comma
id|snapshot
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ENOENT
)paren
id|Info
c_func
(paren
l_string|&quot;Video mode %s@%d fps is only supported with the decompressor module (pwcx).&bslash;n&quot;
comma
id|size2name
(braket
id|size
)braket
comma
id|frames
)paren
suffix:semicolon
r_else
(brace
id|Err
c_func
(paren
l_string|&quot;Failed to set video mode %s@%d fps; return code = %d&bslash;n&quot;
comma
id|size2name
(braket
id|size
)braket
comma
id|frames
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
id|pdev-&gt;view.x
op_assign
id|width
suffix:semicolon
id|pdev-&gt;view.y
op_assign
id|height
suffix:semicolon
id|pwc_set_image_buffer_size
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|Trace
c_func
(paren
id|TRACE_SIZE
comma
l_string|&quot;Set viewport to %dx%d, image size is %dx%d, palette = %d.&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|pwc_image_sizes
(braket
id|size
)braket
dot
id|x
comma
id|pwc_image_sizes
(braket
id|size
)braket
dot
id|y
comma
id|pdev-&gt;vpalette
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_image_buffer_size
r_void
id|pwc_set_image_buffer_size
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
id|factor
comma
id|i
comma
id|filler
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;vpalette
)paren
(brace
r_case
id|VIDEO_PALETTE_RGB32
op_or
l_int|0x80
suffix:colon
r_case
id|VIDEO_PALETTE_RGB32
suffix:colon
id|factor
op_assign
l_int|16
suffix:semicolon
id|filler
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_RGB24
op_or
l_int|0x80
suffix:colon
r_case
id|VIDEO_PALETTE_RGB24
suffix:colon
id|factor
op_assign
l_int|12
suffix:semicolon
id|filler
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUYV
suffix:colon
r_case
id|VIDEO_PALETTE_YUV422
suffix:colon
id|factor
op_assign
l_int|8
suffix:semicolon
id|filler
op_assign
l_int|128
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV420
suffix:colon
r_case
id|VIDEO_PALETTE_YUV420P
suffix:colon
id|factor
op_assign
l_int|6
suffix:semicolon
id|filler
op_assign
l_int|128
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if PWC_DEBUG&t;&t;
r_case
id|VIDEO_PALETTE_RAW
suffix:colon
id|pdev-&gt;image.size
op_assign
id|pdev-&gt;frame_size
suffix:semicolon
id|pdev-&gt;view.size
op_assign
id|pdev-&gt;frame_size
suffix:semicolon
r_return
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;
r_default
suffix:colon
id|factor
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Set sizes in bytes */
id|pdev-&gt;image.size
op_assign
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
id|factor
op_div
l_int|4
suffix:semicolon
id|pdev-&gt;view.size
op_assign
id|pdev-&gt;view.x
op_star
id|pdev-&gt;view.y
op_star
id|factor
op_div
l_int|4
suffix:semicolon
multiline_comment|/* Align offset, or you&squot;ll get some very weird results in&n;&t;   YUV420 mode... x must be multiple of 4 (to get the Y&squot;s in &n;&t;   place), and y even (or you&squot;ll mixup U &amp; V). This is less of a&n;&t;   problem for YUV420P.&n;&t; */
id|pdev-&gt;offset.x
op_assign
(paren
(paren
id|pdev-&gt;view.x
op_minus
id|pdev-&gt;image.x
)paren
op_div
l_int|2
)paren
op_amp
l_int|0xFFFC
suffix:semicolon
id|pdev-&gt;offset.y
op_assign
(paren
(paren
id|pdev-&gt;view.y
op_minus
id|pdev-&gt;image.y
)paren
op_div
l_int|2
)paren
op_amp
l_int|0xFFFE
suffix:semicolon
multiline_comment|/* Fill buffers with gray or black */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IMAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pdev-&gt;image_ptr
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
id|memset
c_func
(paren
id|pdev-&gt;image_ptr
(braket
id|i
)braket
comma
id|filler
comma
id|pdev-&gt;view.size
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* BRIGHTNESS */
DECL|function|pwc_get_brightness
r_int
id|pwc_get_brightness
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_LUM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|BRIGHTNESS_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|9
suffix:semicolon
)brace
DECL|function|pwc_set_brightness
r_int
id|pwc_set_brightness
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|9
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|BRIGHTNESS_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* CONTRAST */
DECL|function|pwc_get_contrast
r_int
id|pwc_get_contrast
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_LUM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|CONTRAST_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|10
suffix:semicolon
)brace
DECL|function|pwc_set_contrast
r_int
id|pwc_set_contrast
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|10
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|CONTRAST_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* GAMMA */
DECL|function|pwc_get_gamma
r_int
id|pwc_get_gamma
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_LUM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|GAMMA_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|11
suffix:semicolon
)brace
DECL|function|pwc_set_gamma
r_int
id|pwc_set_gamma
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|11
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|GAMMA_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* SATURATION */
DECL|function|pwc_get_saturation
r_int
id|pwc_get_saturation
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_CHROM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|pdev-&gt;type
OL
l_int|730
ques
c_cond
id|SATURATION_MODE_FORMATTER2
suffix:colon
id|SATURATION_MODE_FORMATTER1
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|32768
op_plus
id|buf
op_star
l_int|327
suffix:semicolon
)brace
DECL|function|pwc_set_saturation
r_int
id|pwc_set_saturation
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* saturation ranges from -100 to +100 */
id|buf
op_assign
(paren
id|value
op_minus
l_int|32768
)paren
op_div
l_int|327
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_CHROM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|pdev-&gt;type
OL
l_int|730
ques
c_cond
id|SATURATION_MODE_FORMATTER2
suffix:colon
id|SATURATION_MODE_FORMATTER1
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* AGC */
DECL|function|pwc_set_agc
r_static
r_inline
r_int
id|pwc_set_agc
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
id|buf
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* auto */
r_else
id|buf
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* fixed */
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|AGC_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode
op_logical_and
id|ret
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|10
)paren
op_amp
l_int|0x3F
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_AGC_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_agc
r_static
r_inline
r_int
id|pwc_get_agc
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_LUM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|AGC_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_ne
l_int|0
)paren
(brace
multiline_comment|/* fixed */
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_LUM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_AGC_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|buf
OG
l_int|0x3F
)paren
id|buf
op_assign
l_int|0x3F
suffix:semicolon
op_star
id|value
op_assign
(paren
id|buf
op_lshift
l_int|10
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* auto */
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|READ_AGC_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/* Gah... this value ranges from 0x00 ... 0x9F */
r_if
c_cond
(paren
id|buf
OG
l_int|0x9F
)paren
id|buf
op_assign
l_int|0x9F
suffix:semicolon
op_star
id|value
op_assign
op_minus
(paren
l_int|48
op_plus
id|buf
op_star
l_int|409
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_shutter_speed
r_static
r_inline
r_int
id|pwc_set_shutter_speed
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
comma
r_int
id|value
)paren
(brace
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|speed
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* auto */
r_else
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* fixed */
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|SHUTTER_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode
op_logical_and
id|ret
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;type
)paren
(brace
r_case
l_int|675
suffix:colon
r_case
l_int|680
suffix:colon
r_case
l_int|690
suffix:colon
multiline_comment|/* speed ranges from 0x0 to 0x290 (656) */
id|speed
op_assign
(paren
id|value
op_div
l_int|100
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|speed
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|speed
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|730
suffix:colon
r_case
l_int|740
suffix:colon
r_case
l_int|750
suffix:colon
multiline_comment|/* speed seems to range from 0x0 to 0xff */
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_LUM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_SHUTTER_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|2
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* POWER */
DECL|function|pwc_camera_power
r_int
id|pwc_camera_power
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|power
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
op_logical_or
(paren
id|pdev-&gt;type
OL
l_int|730
op_logical_and
id|pdev-&gt;release
OL
l_int|6
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Not supported by Nala or Timon &lt; release 6 */
r_if
c_cond
(paren
id|power
)paren
id|buf
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* active */
r_else
id|buf
op_assign
l_int|0xFF
suffix:semicolon
multiline_comment|/* power save */
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_STATUS_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|SET_POWER_SAVE_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* private calls */
DECL|function|pwc_restore_user
r_static
r_inline
r_int
id|pwc_restore_user
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_STATUS_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|RESTORE_USER_DEFAULTS_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
l_int|NULL
comma
l_int|0
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_save_user
r_static
r_inline
r_int
id|pwc_save_user
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_STATUS_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|SAVE_USER_DEFAULTS_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
l_int|NULL
comma
l_int|0
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_restore_factory
r_static
r_inline
r_int
id|pwc_restore_factory
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_STATUS_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|RESTORE_FACTORY_DEFAULTS_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
l_int|NULL
comma
l_int|0
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* ************************************************* */
multiline_comment|/* Patch by Alvarado: (not in the original version   */
multiline_comment|/*&n;  * the camera recognizes modes from 0 to 4:&n;  *&n;  * 00: indoor (incandescant lighting)&n;  * 01: outdoor (sunlight)&n;  * 02: fluorescent lighting&n;  * 03: manual&n;  * 04: auto&n;  */
DECL|function|pwc_set_awb
r_static
r_inline
r_int
id|pwc_set_awb
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
OL
l_int|0
)paren
id|mode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode
OG
l_int|4
)paren
id|mode
op_assign
l_int|4
suffix:semicolon
id|buf
op_assign
id|mode
op_amp
l_int|0x07
suffix:semicolon
multiline_comment|/* just the lowest three bits */
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_CHROM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|WB_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_awb
r_static
r_inline
r_int
id|pwc_get_awb
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_CHROM_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|WB_MODE_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
DECL|function|pwc_set_red_gain
r_static
r_inline
r_int
id|pwc_set_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* only the msb are considered */
id|buf
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_CHROM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_MANUAL_RED_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_red_gain
r_static
r_inline
r_int
id|pwc_get_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_MANUAL_RED_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
(paren
id|buf
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|pwc_set_blue_gain
r_static
r_inline
r_int
id|pwc_set_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* linear mapping of 0..0xffff to -0x80..0x7f */
id|buf
op_assign
(paren
id|value
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_CHROM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_MANUAL_BLUE_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_blue_gain
r_static
r_inline
r_int
id|pwc_get_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|PRESET_MANUAL_BLUE_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
(paren
id|buf
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* The following two functions are different, since they only read the&n;   internal red/blue gains, which may be different from the manual &n;   gains set or read above.&n; */
DECL|function|pwc_read_red_gain
r_static
r_inline
r_int
id|pwc_read_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|READ_RED_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
(paren
id|buf
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|pwc_read_blue_gain
r_static
r_inline
r_int
id|pwc_read_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|READ_BLUE_GAIN_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|1
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
(paren
id|buf
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|pwc_set_leds
r_int
id|pwc_set_leds
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|on_value
comma
r_int
id|off_value
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|730
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|on_value
OL
l_int|0
)paren
id|on_value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|on_value
OG
l_int|0xff
)paren
id|on_value
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|off_value
OL
l_int|0
)paren
id|off_value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off_value
OG
l_int|0xff
)paren
id|off_value
op_assign
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|on_value
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|off_value
suffix:semicolon
r_return
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|SET_STATUS_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|LED_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|2
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_leds
r_int
id|pwc_get_leds
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|on_value
comma
r_int
op_star
id|off_value
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|730
)paren
(brace
op_star
id|on_value
op_assign
op_minus
l_int|1
suffix:semicolon
op_star
id|off_value
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|pdev-&gt;udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|pdev-&gt;udev
comma
l_int|0
)paren
comma
id|GET_STATUS_CTL
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|LED_FORMATTER
comma
id|pdev-&gt;vcinterface
comma
op_amp
id|buf
comma
l_int|2
comma
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|on_value
op_assign
id|buf
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|off_value
op_assign
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* End of Add-Ons                                    */
multiline_comment|/* ************************************************* */
DECL|function|pwc_ioctl
r_int
id|pwc_ioctl
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCPWCRUSER
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_restore_user
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSUSER
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_save_user
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCFACTORY
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_restore_factory
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSCQUAL
suffix:colon
(brace
r_int
id|qual
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|qual
comma
id|arg
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|qual
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|pwc_try_video_mode
c_func
(paren
id|pdev
comma
id|pdev-&gt;view.x
comma
id|pdev-&gt;view.y
comma
id|pdev-&gt;vframes
comma
id|qual
comma
id|pdev-&gt;vsnapshot
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|pdev-&gt;vcompression
op_assign
id|qual
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGCQUAL
suffix:colon
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|pdev-&gt;vcompression
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSAGC
suffix:colon
(brace
r_int
id|agc
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|agc
comma
id|arg
comma
r_sizeof
(paren
id|agc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|pwc_set_agc
c_func
(paren
id|pdev
comma
id|agc
OL
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
id|agc
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGAGC
suffix:colon
(brace
r_int
id|agc
suffix:semicolon
r_if
c_cond
(paren
id|pwc_get_agc
c_func
(paren
id|pdev
comma
op_amp
id|agc
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|agc
comma
r_sizeof
(paren
id|agc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSSHUTTER
suffix:colon
(brace
r_int
id|shutter_speed
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|shutter_speed
comma
id|arg
comma
r_sizeof
(paren
id|shutter_speed
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
id|ret
op_assign
id|pwc_set_shutter_speed
c_func
(paren
id|pdev
comma
id|shutter_speed
OL
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
id|shutter_speed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* ************************************************* */
multiline_comment|/* Begin of Add-Ons for color compensation           */
r_case
id|VIDIOCPWCSAWB
suffix:colon
(brace
r_struct
id|pwc_whitebalance
id|wb
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|wb
comma
id|arg
comma
r_sizeof
(paren
id|wb
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|pwc_set_awb
c_func
(paren
id|pdev
comma
id|wb.mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
op_logical_and
id|wb.mode
op_eq
id|PWC_WB_MANUAL
)paren
(brace
id|pwc_set_red_gain
c_func
(paren
id|pdev
comma
id|wb.manual_red
)paren
suffix:semicolon
id|pwc_set_blue_gain
c_func
(paren
id|pdev
comma
id|wb.manual_blue
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGAWB
suffix:colon
(brace
r_struct
id|pwc_whitebalance
id|wb
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|wb
comma
l_int|0
comma
r_sizeof
(paren
id|wb
)paren
)paren
suffix:semicolon
id|wb.mode
op_assign
id|pwc_get_awb
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wb.mode
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|wb.manual_red
op_assign
id|pwc_get_red_gain
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|wb.manual_blue
op_assign
id|pwc_get_blue_gain
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wb.mode
op_eq
id|PWC_WB_AUTO
)paren
(brace
id|wb.read_red
op_assign
id|pwc_read_red_gain
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|wb.read_blue
op_assign
id|pwc_read_blue_gain
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSLED
suffix:colon
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|pwc_leds
id|leds
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|leds
comma
id|arg
comma
r_sizeof
(paren
id|leds
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|pwc_set_leds
c_func
(paren
id|pdev
comma
id|leds.led_on
comma
id|leds.led_off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGLED
suffix:colon
(brace
r_int
id|led
suffix:semicolon
r_struct
id|pwc_leds
id|leds
suffix:semicolon
id|led
op_assign
id|pwc_get_leds
c_func
(paren
id|pdev
comma
op_amp
id|leds.led_on
comma
op_amp
id|leds.led_off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|led
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|leds
comma
r_sizeof
(paren
id|leds
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* End of Add-Ons                                    */
multiline_comment|/* ************************************************* */
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
