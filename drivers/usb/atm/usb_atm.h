multiline_comment|/******************************************************************************&n; *  usb_atm.h - Generic USB xDSL driver core&n; *&n; *  Copyright (C) 2001, Alcatel&n; *  Copyright (C) 2003, Duncan Sands, SolNegro, Josep Comas&n; *  Copyright (C) 2004, David Woodhouse&n; *&n; *  This program is free software; you can redistribute it and/or modify it&n; *  under the terms of the GNU General Public License as published by the Free&n; *  Software Foundation; either version 2 of the License, or (at your option)&n; *  any later version.&n; *&n; *  This program is distributed in the hope that it will be useful, but WITHOUT&n; *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or&n; *  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for&n; *  more details.&n; *&n; *  You should have received a copy of the GNU General Public License along with&n; *  this program; if not, write to the Free Software Foundation, Inc., 59&n; *  Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; *&n; ******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/kref.h&gt;
macro_line|#include &lt;linux/atm.h&gt;
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
multiline_comment|/*&n;#define DEBUG&n;#define VERBOSE_DEBUG&n;*/
macro_line|#if !defined (DEBUG) &amp;&amp; defined (CONFIG_USB_DEBUG)
DECL|macro|DEBUG
macro_line|#&t;define DEBUG
macro_line|#endif
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#ifdef DEBUG
DECL|macro|UDSL_ASSERT
mdefine_line|#define UDSL_ASSERT(x)&t;BUG_ON(!(x))
macro_line|#else
DECL|macro|UDSL_ASSERT
mdefine_line|#define UDSL_ASSERT(x)&t;do { if (!(x)) warn(&quot;failed assertion &squot;&quot; #x &quot;&squot; at line %d&quot;, __LINE__); } while(0)
macro_line|#endif
DECL|macro|UDSL_MAX_RCV_URBS
mdefine_line|#define UDSL_MAX_RCV_URBS&t;&t;4
DECL|macro|UDSL_MAX_SND_URBS
mdefine_line|#define UDSL_MAX_SND_URBS&t;&t;4
DECL|macro|UDSL_MAX_RCV_BUFS
mdefine_line|#define UDSL_MAX_RCV_BUFS&t;&t;8
DECL|macro|UDSL_MAX_SND_BUFS
mdefine_line|#define UDSL_MAX_SND_BUFS&t;&t;8
DECL|macro|UDSL_MAX_RCV_BUF_SIZE
mdefine_line|#define UDSL_MAX_RCV_BUF_SIZE&t;&t;1024&t;/* ATM cells */
DECL|macro|UDSL_MAX_SND_BUF_SIZE
mdefine_line|#define UDSL_MAX_SND_BUF_SIZE&t;&t;1024&t;/* ATM cells */
DECL|macro|UDSL_DEFAULT_RCV_URBS
mdefine_line|#define UDSL_DEFAULT_RCV_URBS&t;&t;2
DECL|macro|UDSL_DEFAULT_SND_URBS
mdefine_line|#define UDSL_DEFAULT_SND_URBS&t;&t;2
DECL|macro|UDSL_DEFAULT_RCV_BUFS
mdefine_line|#define UDSL_DEFAULT_RCV_BUFS&t;&t;4
DECL|macro|UDSL_DEFAULT_SND_BUFS
mdefine_line|#define UDSL_DEFAULT_SND_BUFS&t;&t;4
DECL|macro|UDSL_DEFAULT_RCV_BUF_SIZE
mdefine_line|#define UDSL_DEFAULT_RCV_BUF_SIZE&t;64&t;/* ATM cells */
DECL|macro|UDSL_DEFAULT_SND_BUF_SIZE
mdefine_line|#define UDSL_DEFAULT_SND_BUF_SIZE&t;64&t;/* ATM cells */
DECL|macro|ATM_CELL_HEADER
mdefine_line|#define ATM_CELL_HEADER&t;&t;&t;(ATM_CELL_SIZE - ATM_CELL_PAYLOAD)
DECL|macro|UDSL_NUM_CELLS
mdefine_line|#define UDSL_NUM_CELLS(x)&t;&t;(((x) + ATM_AAL5_TRAILER + ATM_CELL_PAYLOAD - 1) / ATM_CELL_PAYLOAD)
multiline_comment|/* receive */
DECL|struct|udsl_receive_buffer
r_struct
id|udsl_receive_buffer
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|base
r_int
r_char
op_star
id|base
suffix:semicolon
DECL|member|filled_cells
r_int
r_int
id|filled_cells
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|udsl_receiver
r_struct
id|udsl_receiver
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|buffer
r_struct
id|udsl_receive_buffer
op_star
id|buffer
suffix:semicolon
DECL|member|urb
r_struct
id|urb
op_star
id|urb
suffix:semicolon
DECL|member|instance
r_struct
id|udsl_instance_data
op_star
id|instance
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|udsl_vcc_data
r_struct
id|udsl_vcc_data
(brace
multiline_comment|/* vpi/vci lookup */
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|vpi
r_int
id|vpi
suffix:semicolon
DECL|member|vci
r_int
id|vci
suffix:semicolon
DECL|member|vcc
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
multiline_comment|/* raw cell reassembly */
DECL|member|sarb
r_struct
id|sk_buff
op_star
id|sarb
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* send */
DECL|struct|udsl_send_buffer
r_struct
id|udsl_send_buffer
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|base
r_int
r_char
op_star
id|base
suffix:semicolon
DECL|member|free_start
r_int
r_char
op_star
id|free_start
suffix:semicolon
DECL|member|free_cells
r_int
r_int
id|free_cells
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|udsl_sender
r_struct
id|udsl_sender
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|buffer
r_struct
id|udsl_send_buffer
op_star
id|buffer
suffix:semicolon
DECL|member|urb
r_struct
id|urb
op_star
id|urb
suffix:semicolon
DECL|member|instance
r_struct
id|udsl_instance_data
op_star
id|instance
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|udsl_control
r_struct
id|udsl_control
(brace
DECL|member|atm_data
r_struct
id|atm_skb_data
id|atm_data
suffix:semicolon
DECL|member|num_cells
r_int
r_int
id|num_cells
suffix:semicolon
DECL|member|num_entire
r_int
r_int
id|num_entire
suffix:semicolon
DECL|member|pdu_padding
r_int
r_int
id|pdu_padding
suffix:semicolon
DECL|member|aal5_trailer
r_int
r_char
id|aal5_trailer
(braket
id|ATM_AAL5_TRAILER
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|UDSL_SKB
mdefine_line|#define UDSL_SKB(x)&t;&t;((struct udsl_control *)(x)-&gt;cb)
multiline_comment|/* main driver data */
DECL|enum|udsl_status
r_enum
id|udsl_status
(brace
DECL|enumerator|UDSL_NO_FIRMWARE
id|UDSL_NO_FIRMWARE
comma
DECL|enumerator|UDSL_LOADING_FIRMWARE
id|UDSL_LOADING_FIRMWARE
comma
DECL|enumerator|UDSL_LOADED_FIRMWARE
id|UDSL_LOADED_FIRMWARE
)brace
suffix:semicolon
DECL|struct|udsl_instance_data
r_struct
id|udsl_instance_data
(brace
DECL|member|refcount
r_struct
id|kref
id|refcount
suffix:semicolon
DECL|member|serialize
r_struct
id|semaphore
id|serialize
suffix:semicolon
multiline_comment|/* USB device part */
DECL|member|usb_dev
r_struct
id|usb_device
op_star
id|usb_dev
suffix:semicolon
DECL|member|description
r_char
id|description
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|data_endpoint
r_int
id|data_endpoint
suffix:semicolon
DECL|member|snd_padding
r_int
id|snd_padding
suffix:semicolon
DECL|member|rcv_padding
r_int
id|rcv_padding
suffix:semicolon
DECL|member|driver_name
r_const
r_char
op_star
id|driver_name
suffix:semicolon
multiline_comment|/* ATM device part */
DECL|member|atm_dev
r_struct
id|atm_dev
op_star
id|atm_dev
suffix:semicolon
DECL|member|vcc_list
r_struct
id|list_head
id|vcc_list
suffix:semicolon
multiline_comment|/* firmware */
DECL|member|firmware_wait
r_int
(paren
op_star
id|firmware_wait
)paren
(paren
r_struct
id|udsl_instance_data
op_star
)paren
suffix:semicolon
DECL|member|status
r_enum
id|udsl_status
id|status
suffix:semicolon
DECL|member|firmware_waiters
id|wait_queue_head_t
id|firmware_waiters
suffix:semicolon
multiline_comment|/* receive */
DECL|member|receivers
r_struct
id|udsl_receiver
id|receivers
(braket
id|UDSL_MAX_RCV_URBS
)braket
suffix:semicolon
DECL|member|receive_buffers
r_struct
id|udsl_receive_buffer
id|receive_buffers
(braket
id|UDSL_MAX_RCV_BUFS
)braket
suffix:semicolon
DECL|member|receive_lock
id|spinlock_t
id|receive_lock
suffix:semicolon
DECL|member|spare_receivers
r_struct
id|list_head
id|spare_receivers
suffix:semicolon
DECL|member|filled_receive_buffers
r_struct
id|list_head
id|filled_receive_buffers
suffix:semicolon
DECL|member|receive_tasklet
r_struct
id|tasklet_struct
id|receive_tasklet
suffix:semicolon
DECL|member|spare_receive_buffers
r_struct
id|list_head
id|spare_receive_buffers
suffix:semicolon
multiline_comment|/* send */
DECL|member|senders
r_struct
id|udsl_sender
id|senders
(braket
id|UDSL_MAX_SND_URBS
)braket
suffix:semicolon
DECL|member|send_buffers
r_struct
id|udsl_send_buffer
id|send_buffers
(braket
id|UDSL_MAX_SND_BUFS
)braket
suffix:semicolon
DECL|member|sndqueue
r_struct
id|sk_buff_head
id|sndqueue
suffix:semicolon
DECL|member|send_lock
id|spinlock_t
id|send_lock
suffix:semicolon
DECL|member|spare_senders
r_struct
id|list_head
id|spare_senders
suffix:semicolon
DECL|member|spare_send_buffers
r_struct
id|list_head
id|spare_send_buffers
suffix:semicolon
DECL|member|send_tasklet
r_struct
id|tasklet_struct
id|send_tasklet
suffix:semicolon
DECL|member|current_skb
r_struct
id|sk_buff
op_star
id|current_skb
suffix:semicolon
multiline_comment|/* being emptied */
DECL|member|current_buffer
r_struct
id|udsl_send_buffer
op_star
id|current_buffer
suffix:semicolon
multiline_comment|/* being filled */
DECL|member|filled_send_buffers
r_struct
id|list_head
id|filled_send_buffers
suffix:semicolon
)brace
suffix:semicolon
r_extern
r_int
id|udsl_instance_setup
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_struct
id|udsl_instance_data
op_star
id|instance
)paren
suffix:semicolon
r_extern
r_void
id|udsl_instance_disconnect
c_func
(paren
r_struct
id|udsl_instance_data
op_star
id|instance
)paren
suffix:semicolon
r_extern
r_void
id|udsl_get_instance
c_func
(paren
r_struct
id|udsl_instance_data
op_star
id|instance
)paren
suffix:semicolon
r_extern
r_void
id|udsl_put_instance
c_func
(paren
r_struct
id|udsl_instance_data
op_star
id|instance
)paren
suffix:semicolon
eof
