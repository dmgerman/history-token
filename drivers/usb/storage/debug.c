multiline_comment|/* Driver for USB Mass Storage compliant devices&n; * Debugging Functions Source Code File&n; *&n; * $Id: debug.c,v 1.9 2002/04/22 03:39:43 mdharm Exp $&n; *&n; * Current development and maintenance by:&n; *   (c) 1999-2002 Matthew Dharm (mdharm-usb@one-eyed-alien.net)&n; *&n; * Developed with the assistance of:&n; *   (c) 2002 Alan Stern &lt;stern@rowland.org&gt;&n; *&n; * Initial work by:&n; *   (c) 1999 Michael Gee (michael@linuxspecific.com)&n; *&n; * This driver is based on the &squot;USB Mass Storage Class&squot; document. This&n; * describes in detail the protocol used to communicate with such&n; * devices.  Clearly, the designers had SCSI and ATAPI commands in&n; * mind when they created this document.  The commands are all very&n; * similar to commands in the SCSI-II and ATAPI specifications.&n; *&n; * It is important to note that in a number of cases this class&n; * exhibits class-specific exemptions from the USB specification.&n; * Notably the usage of NAK, STALL and ACK differs from the norm, in&n; * that they are used to communicate wait, failed and OK on commands.&n; *&n; * Also, for certain devices, the interrupt endpoint is used to convey&n; * status of a command.&n; *&n; * Please see http://www.one-eyed-alien.net/~mdharm/linux-usb for more&n; * information about this driver.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2, or (at your option) any&n; * later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write to the Free Software Foundation, Inc.,&n; * 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/cdrom.h&gt;
macro_line|#include &lt;scsi/scsi.h&gt;
macro_line|#include &lt;scsi/scsi_cmnd.h&gt;
macro_line|#include &quot;debug.h&quot;
macro_line|#include &quot;scsi.h&quot;
DECL|function|usb_stor_show_command
r_void
id|usb_stor_show_command
c_func
(paren
r_struct
id|scsi_cmnd
op_star
id|srb
)paren
(brace
r_char
op_star
id|what
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|srb-&gt;cmnd
(braket
l_int|0
)braket
)paren
(brace
r_case
id|TEST_UNIT_READY
suffix:colon
id|what
op_assign
l_string|&quot;TEST_UNIT_READY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REZERO_UNIT
suffix:colon
id|what
op_assign
l_string|&quot;REZERO_UNIT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REQUEST_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;REQUEST_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FORMAT_UNIT
suffix:colon
id|what
op_assign
l_string|&quot;FORMAT_UNIT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_BLOCK_LIMITS
suffix:colon
id|what
op_assign
l_string|&quot;READ_BLOCK_LIMITS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REASSIGN_BLOCKS
suffix:colon
id|what
op_assign
l_string|&quot;REASSIGN_BLOCKS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_6
suffix:colon
id|what
op_assign
l_string|&quot;READ_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_6
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEEK_6
suffix:colon
id|what
op_assign
l_string|&quot;SEEK_6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_REVERSE
suffix:colon
id|what
op_assign
l_string|&quot;READ_REVERSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_FILEMARKS
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_FILEMARKS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPACE
suffix:colon
id|what
op_assign
l_string|&quot;SPACE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INQUIRY
suffix:colon
id|what
op_assign
l_string|&quot;INQUIRY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECOVER_BUFFERED_DATA
suffix:colon
id|what
op_assign
l_string|&quot;RECOVER_BUFFERED_DATA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SELECT
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SELECT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RESERVE
suffix:colon
id|what
op_assign
l_string|&quot;RESERVE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RELEASE
suffix:colon
id|what
op_assign
l_string|&quot;RELEASE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COPY
suffix:colon
id|what
op_assign
l_string|&quot;COPY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ERASE
suffix:colon
id|what
op_assign
l_string|&quot;ERASE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|START_STOP
suffix:colon
id|what
op_assign
l_string|&quot;START_STOP&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RECEIVE_DIAGNOSTIC
suffix:colon
id|what
op_assign
l_string|&quot;RECEIVE_DIAGNOSTIC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEND_DIAGNOSTIC
suffix:colon
id|what
op_assign
l_string|&quot;SEND_DIAGNOSTIC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ALLOW_MEDIUM_REMOVAL
suffix:colon
id|what
op_assign
l_string|&quot;ALLOW_MEDIUM_REMOVAL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_WINDOW
suffix:colon
id|what
op_assign
l_string|&quot;SET_WINDOW&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_CAPACITY
suffix:colon
id|what
op_assign
l_string|&quot;READ_CAPACITY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_10
suffix:colon
id|what
op_assign
l_string|&quot;READ_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_10
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEEK_10
suffix:colon
id|what
op_assign
l_string|&quot;SEEK_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_HIGH
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_HIGH&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_EQUAL
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_EQUAL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_LOW
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_LOW&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_LIMITS
suffix:colon
id|what
op_assign
l_string|&quot;SET_LIMITS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_POSITION
suffix:colon
id|what
op_assign
l_string|&quot;READ_POSITION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SYNCHRONIZE_CACHE
suffix:colon
id|what
op_assign
l_string|&quot;SYNCHRONIZE_CACHE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOCK_UNLOCK_CACHE
suffix:colon
id|what
op_assign
l_string|&quot;LOCK_UNLOCK_CACHE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_DEFECT_DATA
suffix:colon
id|what
op_assign
l_string|&quot;READ_DEFECT_DATA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MEDIUM_SCAN
suffix:colon
id|what
op_assign
l_string|&quot;MEDIUM_SCAN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMPARE
suffix:colon
id|what
op_assign
l_string|&quot;COMPARE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COPY_VERIFY
suffix:colon
id|what
op_assign
l_string|&quot;COPY_VERIFY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_BUFFER
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_BUFFER&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_BUFFER
suffix:colon
id|what
op_assign
l_string|&quot;READ_BUFFER&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|UPDATE_BLOCK
suffix:colon
id|what
op_assign
l_string|&quot;UPDATE_BLOCK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_LONG
suffix:colon
id|what
op_assign
l_string|&quot;READ_LONG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_LONG
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_LONG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CHANGE_DEFINITION
suffix:colon
id|what
op_assign
l_string|&quot;CHANGE_DEFINITION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_SAME
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_SAME&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_SUBCHANNEL
suffix:colon
id|what
op_assign
l_string|&quot;READ SUBCHANNEL&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_TOC
suffix:colon
id|what
op_assign
l_string|&quot;READ_TOC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_HEADER
suffix:colon
id|what
op_assign
l_string|&quot;READ HEADER&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_PLAY_AUDIO_10
suffix:colon
id|what
op_assign
l_string|&quot;PLAY AUDIO (10)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_PLAY_AUDIO_MSF
suffix:colon
id|what
op_assign
l_string|&quot;PLAY AUDIO MSF&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_GET_EVENT_STATUS_NOTIFICATION
suffix:colon
id|what
op_assign
l_string|&quot;GET EVENT/STATUS NOTIFICATION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_PAUSE_RESUME
suffix:colon
id|what
op_assign
l_string|&quot;PAUSE/RESUME&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOG_SELECT
suffix:colon
id|what
op_assign
l_string|&quot;LOG_SELECT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOG_SENSE
suffix:colon
id|what
op_assign
l_string|&quot;LOG_SENSE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_STOP_PLAY_SCAN
suffix:colon
id|what
op_assign
l_string|&quot;STOP PLAY/SCAN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_DISC_INFO
suffix:colon
id|what
op_assign
l_string|&quot;READ DISC INFORMATION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_TRACK_RZONE_INFO
suffix:colon
id|what
op_assign
l_string|&quot;READ TRACK INFORMATION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_RESERVE_RZONE_TRACK
suffix:colon
id|what
op_assign
l_string|&quot;RESERVE TRACK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_SEND_OPC
suffix:colon
id|what
op_assign
l_string|&quot;SEND OPC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SELECT_10
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SELECT_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_REPAIR_RZONE_TRACK
suffix:colon
id|what
op_assign
l_string|&quot;REPAIR TRACK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x59
suffix:colon
id|what
op_assign
l_string|&quot;READ MASTER CUE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_SENSE_10
suffix:colon
id|what
op_assign
l_string|&quot;MODE_SENSE_10&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_CLOSE_TRACK
suffix:colon
id|what
op_assign
l_string|&quot;CLOSE TRACK/SESSION&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x5C
suffix:colon
id|what
op_assign
l_string|&quot;READ BUFFER CAPACITY&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x5D
suffix:colon
id|what
op_assign
l_string|&quot;SEND CUE SHEET&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_BLANK
suffix:colon
id|what
op_assign
l_string|&quot;BLANK&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MOVE_MEDIUM
suffix:colon
id|what
op_assign
l_string|&quot;MOVE_MEDIUM or PLAY AUDIO (12)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_12
suffix:colon
id|what
op_assign
l_string|&quot;READ_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_12
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_VERIFY_12
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_VERIFY_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_HIGH_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_HIGH_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_EQUAL_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_EQUAL_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEARCH_LOW_12
suffix:colon
id|what
op_assign
l_string|&quot;SEARCH_LOW_12&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEND_VOLUME_TAG
suffix:colon
id|what
op_assign
l_string|&quot;SEND_VOLUME_TAG&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|READ_ELEMENT_STATUS
suffix:colon
id|what
op_assign
l_string|&quot;READ_ELEMENT_STATUS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_CD_MSF
suffix:colon
id|what
op_assign
l_string|&quot;READ CD MSF&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_SCAN
suffix:colon
id|what
op_assign
l_string|&quot;SCAN&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_SET_SPEED
suffix:colon
id|what
op_assign
l_string|&quot;SET CD SPEED&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_MECHANISM_STATUS
suffix:colon
id|what
op_assign
l_string|&quot;MECHANISM STATUS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GPCMD_READ_CD
suffix:colon
id|what
op_assign
l_string|&quot;READ CD&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xE1
suffix:colon
id|what
op_assign
l_string|&quot;WRITE CONTINUE&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE_LONG_2
suffix:colon
id|what
op_assign
l_string|&quot;WRITE_LONG_2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|what
op_assign
l_string|&quot;(unknown command)&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|US_DEBUGP
c_func
(paren
l_string|&quot;Command %s (%d bytes)&bslash;n&quot;
comma
id|what
comma
id|srb-&gt;cmd_len
)paren
suffix:semicolon
id|US_DEBUGP
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|srb-&gt;cmd_len
op_logical_and
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|US_DEBUGPX
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|srb-&gt;cmnd
(braket
id|i
)braket
)paren
suffix:semicolon
id|US_DEBUGPX
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|usb_stor_show_sense
r_void
id|usb_stor_show_sense
c_func
(paren
r_int
r_char
id|key
comma
r_int
r_char
id|asc
comma
r_int
r_char
id|ascq
)paren
(brace
r_const
r_char
op_star
id|what
comma
op_star
id|keystr
suffix:semicolon
id|keystr
op_assign
id|scsi_sense_key_string
c_func
(paren
id|key
)paren
suffix:semicolon
id|what
op_assign
id|scsi_extd_sense_format
c_func
(paren
id|asc
comma
id|ascq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|keystr
op_eq
l_int|NULL
)paren
id|keystr
op_assign
l_string|&quot;(Unknown Key)&quot;
suffix:semicolon
r_if
c_cond
(paren
id|what
op_eq
l_int|NULL
)paren
id|what
op_assign
l_string|&quot;(unknown ASC/ASCQ)&quot;
suffix:semicolon
id|US_DEBUGP
c_func
(paren
l_string|&quot;%s: &quot;
comma
id|keystr
)paren
suffix:semicolon
id|US_DEBUGPX
c_func
(paren
id|what
comma
id|ascq
)paren
suffix:semicolon
id|US_DEBUGPX
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
