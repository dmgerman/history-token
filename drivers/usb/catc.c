multiline_comment|/*&n; *  Copyright (c) 2001 Vojtech Pavlik&n; *&n; *  CATC EL1210A NetMate USB Ethernet driver&n; *&n; *  Sponsored by SuSE&n; *&n; *  Based on the work of&n; *&t;&t;Donald Becker&n; */
multiline_comment|/*&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or &n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; * &n; * Should you need to contact me, the author, you can do so either by&n; * e-mail - mail your message to &lt;vojtech@suse.cz&gt;, or by paper mail:&n; * Vojtech Pavlik, Simunkova 1594, Prague 8, 182 00 Czech Republic&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#include &lt;linux/usb.h&gt;
multiline_comment|/*&n; * Version information.&n; */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;v2.8&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Vojtech Pavlik &lt;vojtech@suse.cz&gt;&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;CATC EL1210A NetMate USB Ethernet driver&quot;
DECL|macro|SHORT_DRIVER_DESC
mdefine_line|#define SHORT_DRIVER_DESC &quot;EL1210A NetMate USB Ethernet&quot;
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Some defines.&n; */
DECL|macro|STATS_UPDATE
mdefine_line|#define STATS_UPDATE&t;&t;(HZ)&t;/* Time between stats updates */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT&t;&t;(5*HZ)&t;/* Max time the queue can be stopped */
DECL|macro|PKT_SZ
mdefine_line|#define PKT_SZ&t;&t;&t;1536&t;/* Max Ethernet packet size */
DECL|macro|RX_MAX_BURST
mdefine_line|#define RX_MAX_BURST&t;&t;15&t;/* Max packets per rx buffer (&gt; 0, &lt; 16) */
DECL|macro|TX_MAX_BURST
mdefine_line|#define TX_MAX_BURST&t;&t;15&t;/* Max full sized packets per tx buffer (&gt; 0) */
DECL|macro|CTRL_QUEUE
mdefine_line|#define CTRL_QUEUE&t;&t;16&t;/* Max control requests in flight (power of two) */
multiline_comment|/*&n; * Control requests.&n; */
DECL|enum|control_requests
r_enum
id|control_requests
(brace
DECL|enumerator|ReadMem
id|ReadMem
op_assign
l_int|0xf1
comma
DECL|enumerator|GetMac
id|GetMac
op_assign
l_int|0xf2
comma
DECL|enumerator|Reset
id|Reset
op_assign
l_int|0xf4
comma
DECL|enumerator|SetMac
id|SetMac
op_assign
l_int|0xf5
comma
DECL|enumerator|WriteROM
id|WriteROM
op_assign
l_int|0xf8
comma
DECL|enumerator|SetReg
id|SetReg
op_assign
l_int|0xfa
comma
DECL|enumerator|GetReg
id|GetReg
op_assign
l_int|0xfb
comma
DECL|enumerator|WriteMem
id|WriteMem
op_assign
l_int|0xfc
comma
DECL|enumerator|ReadROM
id|ReadROM
op_assign
l_int|0xfd
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Registers.&n; */
DECL|enum|register_offsets
r_enum
id|register_offsets
(brace
DECL|enumerator|TxBufCount
id|TxBufCount
op_assign
l_int|0x20
comma
DECL|enumerator|RxBufCount
id|RxBufCount
op_assign
l_int|0x21
comma
DECL|enumerator|OpModes
id|OpModes
op_assign
l_int|0x22
comma
DECL|enumerator|TxQed
id|TxQed
op_assign
l_int|0x23
comma
DECL|enumerator|RxQed
id|RxQed
op_assign
l_int|0x24
comma
DECL|enumerator|MaxBurst
id|MaxBurst
op_assign
l_int|0x25
comma
DECL|enumerator|RxUnit
id|RxUnit
op_assign
l_int|0x60
comma
DECL|enumerator|EthStatus
id|EthStatus
op_assign
l_int|0x61
comma
DECL|enumerator|StationAddr0
id|StationAddr0
op_assign
l_int|0x67
comma
DECL|enumerator|EthStats
id|EthStats
op_assign
l_int|0x69
comma
DECL|enumerator|LEDCtrl
id|LEDCtrl
op_assign
l_int|0x81
comma
)brace
suffix:semicolon
DECL|enum|eth_stats
r_enum
id|eth_stats
(brace
DECL|enumerator|TxSingleColl
id|TxSingleColl
op_assign
l_int|0x00
comma
DECL|enumerator|TxMultiColl
id|TxMultiColl
op_assign
l_int|0x02
comma
DECL|enumerator|TxExcessColl
id|TxExcessColl
op_assign
l_int|0x04
comma
DECL|enumerator|RxFramErr
id|RxFramErr
op_assign
l_int|0x06
comma
)brace
suffix:semicolon
DECL|enum|op_mode_bits
r_enum
id|op_mode_bits
(brace
DECL|enumerator|Op3MemWaits
id|Op3MemWaits
op_assign
l_int|0x03
comma
DECL|enumerator|OpLenInclude
id|OpLenInclude
op_assign
l_int|0x08
comma
DECL|enumerator|OpRxMerge
id|OpRxMerge
op_assign
l_int|0x10
comma
DECL|enumerator|OpTxMerge
id|OpTxMerge
op_assign
l_int|0x20
comma
DECL|enumerator|OpWin95bugfix
id|OpWin95bugfix
op_assign
l_int|0x40
comma
DECL|enumerator|OpLoopback
id|OpLoopback
op_assign
l_int|0x80
comma
)brace
suffix:semicolon
DECL|enum|rx_filter_bits
r_enum
id|rx_filter_bits
(brace
DECL|enumerator|RxEnable
id|RxEnable
op_assign
l_int|0x01
comma
DECL|enumerator|RxPolarity
id|RxPolarity
op_assign
l_int|0x02
comma
DECL|enumerator|RxForceOK
id|RxForceOK
op_assign
l_int|0x04
comma
DECL|enumerator|RxMultiCast
id|RxMultiCast
op_assign
l_int|0x08
comma
DECL|enumerator|RxPromisc
id|RxPromisc
op_assign
l_int|0x10
comma
)brace
suffix:semicolon
DECL|enum|led_values
r_enum
id|led_values
(brace
DECL|enumerator|LEDFast
id|LEDFast
op_assign
l_int|0x01
comma
DECL|enumerator|LEDSlow
id|LEDSlow
op_assign
l_int|0x02
comma
DECL|enumerator|LEDFlash
id|LEDFlash
op_assign
l_int|0x03
comma
DECL|enumerator|LEDPulse
id|LEDPulse
op_assign
l_int|0x04
comma
DECL|enumerator|LEDLink
id|LEDLink
op_assign
l_int|0x08
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * The catc struct.&n; */
DECL|macro|CTRL_RUNNING
mdefine_line|#define CTRL_RUNNING&t;0
DECL|macro|RX_RUNNING
mdefine_line|#define RX_RUNNING&t;1
DECL|macro|TX_RUNNING
mdefine_line|#define TX_RUNNING&t;2
DECL|struct|catc
r_struct
id|catc
(brace
DECL|member|netdev
r_struct
id|net_device
op_star
id|netdev
suffix:semicolon
DECL|member|usbdev
r_struct
id|usb_device
op_star
id|usbdev
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|member|tx_ptr
DECL|member|tx_idx
r_int
r_int
id|tx_ptr
comma
id|tx_idx
suffix:semicolon
DECL|member|ctrl_head
DECL|member|ctrl_tail
r_int
r_int
id|ctrl_head
comma
id|ctrl_tail
suffix:semicolon
DECL|member|tx_lock
DECL|member|ctrl_lock
id|spinlock_t
id|tx_lock
comma
id|ctrl_lock
suffix:semicolon
DECL|member|tx_buf
id|u8
id|tx_buf
(braket
l_int|2
)braket
(braket
id|TX_MAX_BURST
op_star
(paren
id|PKT_SZ
op_plus
l_int|2
)paren
)braket
suffix:semicolon
DECL|member|rx_buf
id|u8
id|rx_buf
(braket
id|RX_MAX_BURST
op_star
(paren
id|PKT_SZ
op_plus
l_int|2
)paren
)braket
suffix:semicolon
DECL|member|irq_buf
id|u8
id|irq_buf
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ctrl_buf
id|u8
id|ctrl_buf
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|ctrl_dr
r_struct
id|usb_ctrlrequest
id|ctrl_dr
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|stats_buf
id|u8
id|stats_buf
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|stats_vals
id|u16
id|stats_vals
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|last_stats
r_int
r_int
id|last_stats
suffix:semicolon
DECL|member|multicast
id|u8
id|multicast
(braket
l_int|64
)braket
suffix:semicolon
DECL|struct|ctrl_queue
r_struct
id|ctrl_queue
(brace
DECL|member|dir
id|u8
id|dir
suffix:semicolon
DECL|member|request
id|u8
id|request
suffix:semicolon
DECL|member|value
id|u16
id|value
suffix:semicolon
DECL|member|index
id|u16
id|index
suffix:semicolon
DECL|member|buf
r_void
op_star
id|buf
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
r_struct
id|catc
op_star
id|catc
comma
r_struct
id|ctrl_queue
op_star
id|q
)paren
suffix:semicolon
DECL|member|ctrl_queue
)brace
id|ctrl_queue
(braket
id|CTRL_QUEUE
)braket
suffix:semicolon
DECL|member|tx_urb
DECL|member|rx_urb
DECL|member|irq_urb
DECL|member|ctrl_urb
r_struct
id|urb
op_star
id|tx_urb
comma
op_star
id|rx_urb
comma
op_star
id|irq_urb
comma
op_star
id|ctrl_urb
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Useful macros.&n; */
DECL|macro|catc_get_mac
mdefine_line|#define catc_get_mac(catc, mac)&t;&t;&t;&t;catc_ctrl_msg(catc, USB_DIR_IN,  GetMac, 0, 0, mac,  6)
DECL|macro|catc_reset
mdefine_line|#define catc_reset(catc)&t;&t;&t;&t;catc_ctrl_msg(catc, USB_DIR_OUT, Reset, 0, 0, NULL, 0)
DECL|macro|catc_set_reg
mdefine_line|#define catc_set_reg(catc, reg, val)&t;&t;&t;catc_ctrl_msg(catc, USB_DIR_OUT, SetReg, val, reg, NULL, 0)
DECL|macro|catc_get_reg
mdefine_line|#define catc_get_reg(catc, reg, buf)&t;&t;&t;catc_ctrl_msg(catc, USB_DIR_IN,  GetReg, 0, reg, buf, 1)
DECL|macro|catc_write_mem
mdefine_line|#define catc_write_mem(catc, addr, buf, size)&t;&t;catc_ctrl_msg(catc, USB_DIR_OUT, WriteMem, 0, addr, buf, size)
DECL|macro|catc_read_mem
mdefine_line|#define catc_read_mem(catc, addr, buf, size)&t;&t;catc_ctrl_msg(catc, USB_DIR_IN,  ReadMem, 0, addr, buf, size)
DECL|macro|catc_set_reg_async
mdefine_line|#define catc_set_reg_async(catc, reg, val)&t;&t;catc_ctrl_async(catc, USB_DIR_OUT, SetReg, val, reg, NULL, 0, NULL)
DECL|macro|catc_get_reg_async
mdefine_line|#define catc_get_reg_async(catc, reg, cb)&t;&t;catc_ctrl_async(catc, USB_DIR_IN, GetReg, 0, reg, NULL, 1, cb)
DECL|macro|catc_write_mem_async
mdefine_line|#define catc_write_mem_async(catc, addr, buf, size)&t;catc_ctrl_async(catc, USB_DIR_OUT, WriteMem, 0, addr, buf, size, NULL)
multiline_comment|/*&n; * Receive routines.&n; */
DECL|function|catc_rx_done
r_static
r_void
id|catc_rx_done
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|urb-&gt;context
suffix:semicolon
id|u8
op_star
id|pkt_start
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
id|clear_bit
c_func
(paren
id|RX_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;rx_done, status %d, length %d&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;actual_length
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
id|pkt_len
op_assign
id|le16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
id|pkt_start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OG
id|urb-&gt;actual_length
)paren
(brace
id|catc-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
id|catc-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
)paren
)paren
r_return
suffix:semicolon
id|skb-&gt;dev
op_assign
id|catc-&gt;netdev
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|pkt_start
op_plus
l_int|2
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|catc-&gt;netdev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|catc-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|catc-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|pkt_start
op_add_assign
(paren
(paren
(paren
id|pkt_len
op_plus
l_int|1
)paren
op_rshift
l_int|6
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|6
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pkt_start
op_minus
(paren
id|u8
op_star
)paren
id|urb-&gt;transfer_buffer
OL
id|urb-&gt;actual_length
)paren
suffix:semicolon
id|catc-&gt;netdev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
)brace
DECL|function|catc_irq_done
r_static
r_void
id|catc_irq_done
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|urb-&gt;context
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;irq_done, status %d, data %02x %02x.&quot;
comma
id|urb-&gt;status
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x80
)paren
op_logical_and
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|RX_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
)paren
(brace
id|catc-&gt;rx_urb-&gt;dev
op_assign
id|catc-&gt;usbdev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|catc-&gt;rx_urb
comma
id|GFP_KERNEL
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;submit(rx_urb) status %d&quot;
comma
id|status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x40
)paren
(brace
id|netif_carrier_on
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;link ok&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x20
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;link bad&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Transmit routines.&n; */
DECL|function|catc_tx_run
r_static
r_void
id|catc_tx_run
c_func
(paren
r_struct
id|catc
op_star
id|catc
)paren
(brace
r_int
id|status
suffix:semicolon
id|catc-&gt;tx_urb-&gt;transfer_buffer_length
op_assign
id|catc-&gt;tx_ptr
suffix:semicolon
id|catc-&gt;tx_urb-&gt;transfer_buffer
op_assign
id|catc-&gt;tx_buf
(braket
id|catc-&gt;tx_idx
)braket
suffix:semicolon
id|catc-&gt;tx_urb-&gt;dev
op_assign
id|catc-&gt;usbdev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|catc-&gt;tx_urb
comma
id|GFP_KERNEL
)paren
)paren
OL
l_int|0
)paren
id|err
c_func
(paren
l_string|&quot;submit(tx_urb), status %d&quot;
comma
id|status
)paren
suffix:semicolon
id|catc-&gt;tx_idx
op_assign
op_logical_neg
id|catc-&gt;tx_idx
suffix:semicolon
id|catc-&gt;tx_ptr
op_assign
l_int|0
suffix:semicolon
id|catc-&gt;netdev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
DECL|function|catc_tx_done
r_static
r_void
id|catc_tx_done
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_eq
op_minus
id|ECONNRESET
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;Tx Reset.&quot;
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_and_assign
op_complement
id|USB_ASYNC_UNLINK
suffix:semicolon
id|urb-&gt;status
op_assign
l_int|0
suffix:semicolon
id|catc-&gt;netdev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|catc-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|clear_bit
c_func
(paren
id|TX_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;tx_done, status %d, length %d&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;actual_length
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|catc-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|catc-&gt;tx_ptr
)paren
id|catc_tx_run
c_func
(paren
id|catc
)paren
suffix:semicolon
r_else
id|clear_bit
c_func
(paren
id|TX_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|catc-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|catc_hard_start_xmit
r_static
r_int
id|catc_hard_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_char
op_star
id|tx_buf
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|catc-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
id|catc-&gt;tx_ptr
op_assign
(paren
(paren
(paren
id|catc-&gt;tx_ptr
op_minus
l_int|1
)paren
op_rshift
l_int|6
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|6
suffix:semicolon
id|tx_buf
op_assign
id|catc-&gt;tx_buf
(braket
id|catc-&gt;tx_idx
)braket
op_plus
id|catc-&gt;tx_ptr
suffix:semicolon
op_star
(paren
(paren
id|u16
op_star
)paren
id|tx_buf
)paren
op_assign
id|cpu_to_le16
c_func
(paren
(paren
id|u16
)paren
id|skb-&gt;len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tx_buf
op_plus
l_int|2
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|catc-&gt;tx_ptr
op_add_assign
id|skb-&gt;len
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|TX_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
)paren
id|catc_tx_run
c_func
(paren
id|catc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|catc-&gt;tx_ptr
op_ge
(paren
(paren
id|TX_MAX_BURST
op_minus
l_int|1
)paren
op_star
(paren
id|PKT_SZ
op_plus
l_int|2
)paren
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|netdev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|catc-&gt;tx_lock
comma
id|flags
)paren
suffix:semicolon
id|catc-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|catc-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|catc_tx_timeout
r_static
r_void
id|catc_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
id|warn
c_func
(paren
l_string|&quot;Transmit timed out.&quot;
)paren
suffix:semicolon
id|catc-&gt;tx_urb-&gt;transfer_flags
op_or_assign
id|USB_ASYNC_UNLINK
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|catc-&gt;tx_urb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Control messages.&n; */
DECL|function|catc_ctrl_msg
r_static
r_int
id|catc_ctrl_msg
c_func
(paren
r_struct
id|catc
op_star
id|catc
comma
id|u8
id|dir
comma
id|u8
id|request
comma
id|u16
id|value
comma
id|u16
id|index
comma
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|retval
op_assign
id|usb_control_msg
c_func
(paren
id|catc-&gt;usbdev
comma
id|dir
ques
c_cond
id|usb_rcvctrlpipe
c_func
(paren
id|catc-&gt;usbdev
comma
l_int|0
)paren
suffix:colon
id|usb_sndctrlpipe
c_func
(paren
id|catc-&gt;usbdev
comma
l_int|0
)paren
comma
id|request
comma
l_int|0x40
op_or
id|dir
comma
id|value
comma
id|index
comma
id|buf
comma
id|len
comma
id|HZ
)paren
suffix:semicolon
r_return
id|retval
OL
l_int|0
ques
c_cond
id|retval
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|catc_ctrl_run
r_static
r_void
id|catc_ctrl_run
c_func
(paren
r_struct
id|catc
op_star
id|catc
)paren
(brace
r_struct
id|ctrl_queue
op_star
id|q
op_assign
id|catc-&gt;ctrl_queue
op_plus
id|catc-&gt;ctrl_tail
suffix:semicolon
r_struct
id|usb_device
op_star
id|usbdev
op_assign
id|catc-&gt;usbdev
suffix:semicolon
r_struct
id|urb
op_star
id|urb
op_assign
id|catc-&gt;ctrl_urb
suffix:semicolon
r_struct
id|usb_ctrlrequest
op_star
id|dr
op_assign
op_amp
id|catc-&gt;ctrl_dr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dr-&gt;bRequest
op_assign
id|q-&gt;request
suffix:semicolon
id|dr-&gt;bRequestType
op_assign
l_int|0x40
op_or
id|q-&gt;dir
suffix:semicolon
id|dr-&gt;wValue
op_assign
id|cpu_to_le16
c_func
(paren
id|q-&gt;value
)paren
suffix:semicolon
id|dr-&gt;wIndex
op_assign
id|cpu_to_le16
c_func
(paren
id|q-&gt;index
)paren
suffix:semicolon
id|dr-&gt;wLength
op_assign
id|cpu_to_le16
c_func
(paren
id|q-&gt;len
)paren
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|q-&gt;dir
ques
c_cond
id|usb_rcvctrlpipe
c_func
(paren
id|usbdev
comma
l_int|0
)paren
suffix:colon
id|usb_sndctrlpipe
c_func
(paren
id|usbdev
comma
l_int|0
)paren
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|q-&gt;len
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|catc-&gt;ctrl_buf
suffix:semicolon
id|urb-&gt;setup_packet
op_assign
(paren
r_void
op_star
)paren
id|dr
suffix:semicolon
id|urb-&gt;dev
op_assign
id|usbdev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;dir
op_logical_and
id|q-&gt;buf
op_logical_and
id|q-&gt;len
)paren
id|memcpy
c_func
(paren
id|catc-&gt;ctrl_buf
comma
id|q-&gt;buf
comma
id|q-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|catc-&gt;ctrl_urb
comma
id|GFP_KERNEL
)paren
)paren
)paren
id|err
c_func
(paren
l_string|&quot;submit(ctrl_urb) status %d&quot;
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|catc_ctrl_done
r_static
r_void
id|catc_ctrl_done
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|ctrl_queue
op_star
id|q
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
id|dbg
c_func
(paren
l_string|&quot;ctrl_done, status %d, len %d.&quot;
comma
id|urb-&gt;status
comma
id|urb-&gt;actual_length
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|catc-&gt;ctrl_lock
comma
id|flags
)paren
suffix:semicolon
id|q
op_assign
id|catc-&gt;ctrl_queue
op_plus
id|catc-&gt;ctrl_tail
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;dir
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;buf
op_logical_and
id|q-&gt;len
)paren
id|memcpy
c_func
(paren
id|q-&gt;buf
comma
id|catc-&gt;ctrl_buf
comma
id|q-&gt;len
)paren
suffix:semicolon
r_else
id|q-&gt;buf
op_assign
id|catc-&gt;ctrl_buf
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;callback
)paren
id|q
op_member_access_from_pointer
id|callback
c_func
(paren
id|catc
comma
id|q
)paren
suffix:semicolon
id|catc-&gt;ctrl_tail
op_assign
(paren
id|catc-&gt;ctrl_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|CTRL_QUEUE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|catc-&gt;ctrl_head
op_ne
id|catc-&gt;ctrl_tail
)paren
id|catc_ctrl_run
c_func
(paren
id|catc
)paren
suffix:semicolon
r_else
id|clear_bit
c_func
(paren
id|CTRL_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|catc-&gt;ctrl_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|catc_ctrl_async
r_static
r_int
id|catc_ctrl_async
c_func
(paren
r_struct
id|catc
op_star
id|catc
comma
id|u8
id|dir
comma
id|u8
id|request
comma
id|u16
id|value
comma
id|u16
id|index
comma
r_void
op_star
id|buf
comma
r_int
id|len
comma
r_void
(paren
op_star
id|callback
)paren
(paren
r_struct
id|catc
op_star
id|catc
comma
r_struct
id|ctrl_queue
op_star
id|q
)paren
)paren
(brace
r_struct
id|ctrl_queue
op_star
id|q
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|catc-&gt;ctrl_lock
comma
id|flags
)paren
suffix:semicolon
id|q
op_assign
id|catc-&gt;ctrl_queue
op_plus
id|catc-&gt;ctrl_head
suffix:semicolon
id|q-&gt;dir
op_assign
id|dir
suffix:semicolon
id|q-&gt;request
op_assign
id|request
suffix:semicolon
id|q-&gt;value
op_assign
id|value
suffix:semicolon
id|q-&gt;index
op_assign
id|index
suffix:semicolon
id|q-&gt;buf
op_assign
id|buf
suffix:semicolon
id|q-&gt;len
op_assign
id|len
suffix:semicolon
id|q-&gt;callback
op_assign
id|callback
suffix:semicolon
id|catc-&gt;ctrl_head
op_assign
(paren
id|catc-&gt;ctrl_head
op_plus
l_int|1
)paren
op_amp
(paren
id|CTRL_QUEUE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|catc-&gt;ctrl_head
op_eq
id|catc-&gt;ctrl_tail
)paren
(brace
id|err
c_func
(paren
l_string|&quot;ctrl queue full&quot;
)paren
suffix:semicolon
id|catc-&gt;ctrl_tail
op_assign
(paren
id|catc-&gt;ctrl_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|CTRL_QUEUE
op_minus
l_int|1
)paren
suffix:semicolon
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|CTRL_RUNNING
comma
op_amp
id|catc-&gt;flags
)paren
)paren
id|catc_ctrl_run
c_func
(paren
id|catc
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|catc-&gt;ctrl_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Statistics.&n; */
DECL|function|catc_stats_done
r_static
r_void
id|catc_stats_done
c_func
(paren
r_struct
id|catc
op_star
id|catc
comma
r_struct
id|ctrl_queue
op_star
id|q
)paren
(brace
r_int
id|index
op_assign
id|q-&gt;index
op_minus
id|EthStats
suffix:semicolon
id|u16
id|data
comma
id|last
suffix:semicolon
id|catc-&gt;stats_buf
(braket
id|index
)braket
op_assign
op_star
(paren
(paren
r_char
op_star
)paren
id|q-&gt;buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_amp
l_int|1
)paren
r_return
suffix:semicolon
id|data
op_assign
(paren
(paren
id|u16
)paren
id|catc-&gt;stats_buf
(braket
id|index
)braket
op_lshift
l_int|8
)paren
op_or
id|catc-&gt;stats_buf
(braket
id|index
op_plus
l_int|1
)braket
suffix:semicolon
id|last
op_assign
id|catc-&gt;stats_vals
(braket
id|index
op_rshift
l_int|1
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|index
)paren
(brace
r_case
id|TxSingleColl
suffix:colon
r_case
id|TxMultiColl
suffix:colon
id|catc-&gt;stats.collisions
op_add_assign
id|data
op_minus
id|last
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TxExcessColl
suffix:colon
id|catc-&gt;stats.tx_aborted_errors
op_add_assign
id|data
op_minus
id|last
suffix:semicolon
id|catc-&gt;stats.tx_errors
op_add_assign
id|data
op_minus
id|last
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RxFramErr
suffix:colon
id|catc-&gt;stats.rx_frame_errors
op_add_assign
id|data
op_minus
id|last
suffix:semicolon
id|catc-&gt;stats.rx_errors
op_add_assign
id|data
op_minus
id|last
suffix:semicolon
r_break
suffix:semicolon
)brace
id|catc-&gt;stats_vals
(braket
id|index
op_rshift
l_int|1
)braket
op_assign
id|data
suffix:semicolon
)brace
DECL|function|catc_stats_timer
r_static
r_void
id|catc_stats_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
(paren
r_void
op_star
)paren
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|catc_get_reg_async
c_func
(paren
id|catc
comma
id|EthStats
op_plus
l_int|7
op_minus
id|i
comma
id|catc_stats_done
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|catc-&gt;timer
comma
id|jiffies
op_plus
id|STATS_UPDATE
)paren
suffix:semicolon
)brace
DECL|function|catc_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|catc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
r_return
op_amp
id|catc-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * Receive modes. Broadcast, Multicast, Promisc.&n; */
DECL|function|catc_multicast
r_static
r_void
id|catc_multicast
c_func
(paren
r_int
r_char
op_star
id|addr
comma
id|u8
op_star
id|multicast
)paren
(brace
id|u32
id|crc
suffix:semicolon
id|crc
op_assign
id|ether_crc_le
c_func
(paren
l_int|6
comma
id|addr
)paren
suffix:semicolon
id|multicast
(braket
(paren
id|crc
op_rshift
l_int|3
)paren
op_amp
l_int|0x3f
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|crc
op_amp
l_int|7
)paren
suffix:semicolon
)brace
DECL|function|catc_set_multicast_list
r_static
r_void
id|catc_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mc
suffix:semicolon
id|u8
id|broadcast
(braket
l_int|6
)braket
suffix:semicolon
id|u8
id|rx
op_assign
id|RxEnable
op_or
id|RxPolarity
op_or
id|RxMultiCast
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|broadcast
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
id|memset
c_func
(paren
id|catc-&gt;multicast
comma
l_int|0
comma
l_int|64
)paren
suffix:semicolon
id|catc_multicast
c_func
(paren
id|broadcast
comma
id|catc-&gt;multicast
)paren
suffix:semicolon
id|catc_multicast
c_func
(paren
id|netdev-&gt;dev_addr
comma
id|catc-&gt;multicast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netdev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|memset
c_func
(paren
id|catc-&gt;multicast
comma
l_int|0xff
comma
l_int|64
)paren
suffix:semicolon
id|rx
op_or_assign
id|RxPromisc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netdev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
id|memset
c_func
(paren
id|catc-&gt;multicast
comma
l_int|0xff
comma
l_int|64
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mc
op_assign
id|netdev-&gt;mc_list
suffix:semicolon
id|mc
op_logical_and
id|i
OL
id|netdev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mc
op_assign
id|mc-&gt;next
)paren
id|catc_multicast
c_func
(paren
id|mc-&gt;dmi_addr
comma
id|catc-&gt;multicast
)paren
suffix:semicolon
id|catc_set_reg_async
c_func
(paren
id|catc
comma
id|RxUnit
comma
id|rx
)paren
suffix:semicolon
id|catc_write_mem_async
c_func
(paren
id|catc
comma
l_int|0xfa80
comma
id|catc-&gt;multicast
comma
l_int|64
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ioctl&squot;s&n; */
DECL|function|netdev_ethtool_ioctl
r_static
r_int
id|netdev_ethtool_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|useraddr
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|cmd
suffix:semicolon
r_char
id|tmp
(braket
l_int|40
)braket
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|cmd
comma
(paren
id|u32
op_star
)paren
id|useraddr
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/* get driver info */
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strncpy
c_func
(paren
id|info.driver
comma
id|SHORT_DRIVER_DESC
comma
id|ETHTOOL_BUSINFO_LEN
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.version
comma
id|DRIVER_VERSION
comma
id|ETHTOOL_BUSINFO_LEN
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;usb%d:%d&quot;
comma
id|catc-&gt;usbdev-&gt;bus-&gt;busnum
comma
id|catc-&gt;usbdev-&gt;devnum
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.bus_info
comma
id|tmp
comma
id|ETHTOOL_BUSINFO_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get link status */
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|edata.data
op_assign
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|catc_ioctl
r_static
r_int
id|catc_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|netdev_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Open, close.&n; */
DECL|function|catc_open
r_static
r_int
id|catc_open
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
r_int
id|status
suffix:semicolon
id|catc-&gt;irq_urb-&gt;dev
op_assign
id|catc-&gt;usbdev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|catc-&gt;irq_urb
comma
id|GFP_KERNEL
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;submit(irq_urb) status %d&quot;
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|netdev
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|catc-&gt;timer
comma
id|jiffies
op_plus
id|STATS_UPDATE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|catc_stop
r_static
r_int
id|catc_stop
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|netdev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|netdev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|catc-&gt;timer
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|catc-&gt;rx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|catc-&gt;tx_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|catc-&gt;irq_urb
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|catc-&gt;ctrl_urb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * USB probe, disconnect.&n; */
DECL|function|catc_probe
r_static
r_void
op_star
id|catc_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|usbdev
comma
r_int
r_int
id|ifnum
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|net_device
op_star
id|netdev
suffix:semicolon
r_struct
id|catc
op_star
id|catc
suffix:semicolon
id|u8
id|broadcast
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|usbdev
comma
id|ifnum
comma
l_int|1
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Can&squot;t set altsetting 1.&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|catc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|catc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|catc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|catc
)paren
)paren
suffix:semicolon
id|netdev
op_assign
id|init_etherdev
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|netdev-&gt;open
op_assign
id|catc_open
suffix:semicolon
id|netdev-&gt;hard_start_xmit
op_assign
id|catc_hard_start_xmit
suffix:semicolon
id|netdev-&gt;stop
op_assign
id|catc_stop
suffix:semicolon
id|netdev-&gt;get_stats
op_assign
id|catc_get_stats
suffix:semicolon
id|netdev-&gt;tx_timeout
op_assign
id|catc_tx_timeout
suffix:semicolon
id|netdev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|netdev-&gt;set_multicast_list
op_assign
id|catc_set_multicast_list
suffix:semicolon
id|netdev-&gt;do_ioctl
op_assign
id|catc_ioctl
suffix:semicolon
id|netdev-&gt;priv
op_assign
id|catc
suffix:semicolon
id|catc-&gt;usbdev
op_assign
id|usbdev
suffix:semicolon
id|catc-&gt;netdev
op_assign
id|netdev
suffix:semicolon
id|catc-&gt;tx_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|catc-&gt;ctrl_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|catc-&gt;timer
)paren
suffix:semicolon
id|catc-&gt;timer.data
op_assign
(paren
r_int
)paren
id|catc
suffix:semicolon
id|catc-&gt;timer.function
op_assign
id|catc_stats_timer
suffix:semicolon
id|catc-&gt;ctrl_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|catc-&gt;tx_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|catc-&gt;rx_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|catc-&gt;irq_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|catc-&gt;ctrl_urb
)paren
op_logical_or
(paren
op_logical_neg
id|catc-&gt;tx_urb
)paren
op_logical_or
(paren
op_logical_neg
id|catc-&gt;rx_urb
)paren
op_logical_or
(paren
op_logical_neg
id|catc-&gt;irq_urb
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;No free urbs available.&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FILL_CONTROL_URB
c_func
(paren
id|catc-&gt;ctrl_urb
comma
id|usbdev
comma
id|usb_sndctrlpipe
c_func
(paren
id|usbdev
comma
l_int|0
)paren
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
id|catc_ctrl_done
comma
id|catc
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
id|catc-&gt;tx_urb
comma
id|usbdev
comma
id|usb_sndbulkpipe
c_func
(paren
id|usbdev
comma
l_int|1
)paren
comma
l_int|NULL
comma
l_int|0
comma
id|catc_tx_done
comma
id|catc
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
id|catc-&gt;rx_urb
comma
id|usbdev
comma
id|usb_rcvbulkpipe
c_func
(paren
id|usbdev
comma
l_int|1
)paren
comma
id|catc-&gt;rx_buf
comma
id|RX_MAX_BURST
op_star
(paren
id|PKT_SZ
op_plus
l_int|2
)paren
comma
id|catc_rx_done
comma
id|catc
)paren
suffix:semicolon
id|FILL_INT_URB
c_func
(paren
id|catc-&gt;irq_urb
comma
id|usbdev
comma
id|usb_rcvintpipe
c_func
(paren
id|usbdev
comma
l_int|2
)paren
comma
id|catc-&gt;irq_buf
comma
l_int|2
comma
id|catc_irq_done
comma
id|catc
comma
l_int|1
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Checking memory size&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0x12345678
suffix:semicolon
id|catc_write_mem
c_func
(paren
id|catc
comma
l_int|0x7a80
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
id|i
op_assign
l_int|0x87654321
suffix:semicolon
id|catc_write_mem
c_func
(paren
id|catc
comma
l_int|0xfa80
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
id|catc_read_mem
c_func
(paren
id|catc
comma
l_int|0x7a80
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0x12345678
suffix:colon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|TxBufCount
comma
l_int|8
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|RxBufCount
comma
l_int|32
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;64k Memory&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|warn
c_func
(paren
l_string|&quot;Couldn&squot;t detect memory size, assuming 32k&quot;
)paren
suffix:semicolon
r_case
l_int|0x87654321
suffix:colon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|TxBufCount
comma
l_int|4
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|RxBufCount
comma
l_int|16
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;32k Memory&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;Getting MAC from SEEROM.&quot;
)paren
suffix:semicolon
id|catc_get_mac
c_func
(paren
id|catc
comma
id|netdev-&gt;dev_addr
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Setting MAC into registers.&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|catc_set_reg
c_func
(paren
id|catc
comma
id|StationAddr0
op_minus
id|i
comma
id|netdev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Filling the multicast list.&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|broadcast
comma
l_int|0xff
comma
l_int|8
)paren
suffix:semicolon
id|catc_multicast
c_func
(paren
id|broadcast
comma
id|catc-&gt;multicast
)paren
suffix:semicolon
id|catc_multicast
c_func
(paren
id|netdev-&gt;dev_addr
comma
id|catc-&gt;multicast
)paren
suffix:semicolon
id|catc_write_mem
c_func
(paren
id|catc
comma
l_int|0xfa80
comma
id|catc-&gt;multicast
comma
l_int|64
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Clearing error counters.&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|catc_set_reg
c_func
(paren
id|catc
comma
id|EthStats
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|catc-&gt;last_stats
op_assign
id|jiffies
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Enabling.&quot;
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|MaxBurst
comma
id|RX_MAX_BURST
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|OpModes
comma
id|OpTxMerge
op_or
id|OpRxMerge
op_or
id|OpLenInclude
op_or
id|Op3MemWaits
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|LEDCtrl
comma
id|LEDLink
)paren
suffix:semicolon
id|catc_set_reg
c_func
(paren
id|catc
comma
id|RxUnit
comma
id|RxEnable
op_or
id|RxPolarity
op_or
id|RxMultiCast
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Init done.&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: CATC EL1210A NetMate USB Ethernet at usb%d:%d.%d, &quot;
comma
id|netdev-&gt;name
comma
id|usbdev-&gt;bus-&gt;busnum
comma
id|usbdev-&gt;devnum
comma
id|ifnum
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
id|netdev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x.&bslash;n&quot;
comma
id|netdev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
id|catc
suffix:semicolon
)brace
DECL|function|catc_disconnect
r_static
r_void
id|catc_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|usbdev
comma
r_void
op_star
id|dev_ptr
)paren
(brace
r_struct
id|catc
op_star
id|catc
op_assign
id|dev_ptr
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|catc-&gt;ctrl_urb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|catc-&gt;tx_urb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|catc-&gt;rx_urb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|catc-&gt;irq_urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|catc-&gt;netdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|catc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Module functions and tables.&n; */
DECL|variable|catc_id_table
r_static
r_struct
id|usb_device_id
id|catc_id_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0423
comma
l_int|0xa
)paren
)brace
comma
multiline_comment|/* CATC Netmate */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0423
comma
l_int|0xc
)paren
)brace
comma
multiline_comment|/* CATC Netmate II, Belkin F5U111 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x08d1
comma
l_int|0x1
)paren
)brace
comma
multiline_comment|/* smartBridges smartNIC */
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|catc_id_table
)paren
suffix:semicolon
DECL|variable|catc_driver
r_static
r_struct
id|usb_driver
id|catc_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;catc&quot;
comma
id|probe
suffix:colon
id|catc_probe
comma
id|disconnect
suffix:colon
id|catc_disconnect
comma
id|id_table
suffix:colon
id|catc_id_table
comma
)brace
suffix:semicolon
DECL|function|catc_init
r_static
r_int
id|__init
id|catc_init
c_func
(paren
r_void
)paren
(brace
id|info
c_func
(paren
id|DRIVER_VERSION
l_string|&quot; &quot;
id|DRIVER_DESC
)paren
suffix:semicolon
id|usb_register
c_func
(paren
op_amp
id|catc_driver
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|catc_exit
r_static
r_void
id|__exit
id|catc_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|catc_driver
)paren
suffix:semicolon
)brace
DECL|variable|catc_init
id|module_init
c_func
(paren
id|catc_init
)paren
suffix:semicolon
DECL|variable|catc_exit
id|module_exit
c_func
(paren
id|catc_exit
)paren
suffix:semicolon
eof
