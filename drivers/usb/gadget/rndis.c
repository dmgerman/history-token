multiline_comment|/* &n; * RNDIS MSG parser&n; * &n; * Version:     $Id: rndis.c,v 1.19 2004/03/25 21:33:46 robert Exp $&n; * &n; * Authors:&t;Benedikt Spranger, Pengutronix&n; * &t;&t;Robert Schwebel, Pengutronix&n; * &n; *              This program is free software; you can redistribute it and/or&n; *              modify it under the terms of the GNU General Public License&n; *              version 2, as published by the Free Software Foundation. &n; * &n; *&t;&t;This software was originally developed in conformance with&n; *&t;&t;Microsoft&squot;s Remote NDIS Specification License Agreement.&n; *              &n; * 03/12/2004 Kai-Uwe Bloem &lt;linux-development@auerswald.de&gt;&n; *&t;&t;Fixed message length bug in init_response&n; * &n; * 03/25/2004 Kai-Uwe Bloem &lt;linux-development@auerswald.de&gt;&n; * &t;&t;Fixed rndis_rm_hdr length bug.&n; *&n; * Copyright (C) 2004 by David Brownell&n; *&t;&t;updates to merge with Linux 2.6, better match RNDIS spec&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/system.h&gt;
DECL|macro|RNDIS_PM
macro_line|#undef&t;RNDIS_PM
DECL|macro|VERBOSE
macro_line|#undef&t;VERBOSE
macro_line|#include &quot;rndis.h&quot;
multiline_comment|/* The driver for your USB chip needs to support ep0 OUT to work with&n; * RNDIS, plus all three CDC Ethernet endpoints (interrupt not optional).&n; *&n; * Windows hosts need an INF file like Documentation/usb/linux.inf&n; * and will be happier if you provide the host_addr module parameter.&n; */
macro_line|#if 0
mdefine_line|#define DEBUG(str,args...) do { &bslash;&n;&t;if (rndis_debug) &bslash;&n;&t;&t;printk(KERN_DEBUG str , ## args ); &bslash;&n;&t;} while (0)
r_static
r_int
id|rndis_debug
op_assign
l_int|0
suffix:semicolon
id|module_param
(paren
id|rndis_debug
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|rndis_debug
comma
l_string|&quot;enable debugging&quot;
)paren
suffix:semicolon
macro_line|#else
DECL|macro|rndis_debug
mdefine_line|#define rndis_debug&t;&t;0
DECL|macro|DEBUG
mdefine_line|#define DEBUG(str,args...)&t;do{}while(0)
macro_line|#endif
DECL|macro|RNDIS_MAX_CONFIGS
mdefine_line|#define RNDIS_MAX_CONFIGS&t;1
DECL|variable|rndis_connect_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|rndis_connect_dir
suffix:semicolon
DECL|variable|rndis_connect_state
r_static
r_struct
id|proc_dir_entry
op_star
id|rndis_connect_state
(braket
id|RNDIS_MAX_CONFIGS
)braket
suffix:semicolon
DECL|variable|rndis_per_dev_params
r_static
id|rndis_params
id|rndis_per_dev_params
(braket
id|RNDIS_MAX_CONFIGS
)braket
suffix:semicolon
multiline_comment|/* Driver Version */
DECL|variable|rndis_driver_version
r_static
r_const
id|u32
id|rndis_driver_version
op_assign
id|__constant_cpu_to_le32
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Function Prototypes */
r_static
r_int
id|rndis_init_response
(paren
r_int
id|configNr
comma
id|rndis_init_msg_type
op_star
id|buf
)paren
suffix:semicolon
r_static
r_int
id|rndis_query_response
(paren
r_int
id|configNr
comma
id|rndis_query_msg_type
op_star
id|buf
)paren
suffix:semicolon
r_static
r_int
id|rndis_set_response
(paren
r_int
id|configNr
comma
id|rndis_set_msg_type
op_star
id|buf
)paren
suffix:semicolon
r_static
r_int
id|rndis_reset_response
(paren
r_int
id|configNr
comma
id|rndis_reset_msg_type
op_star
id|buf
)paren
suffix:semicolon
r_static
r_int
id|rndis_keepalive_response
(paren
r_int
id|configNr
comma
id|rndis_keepalive_msg_type
op_star
id|buf
)paren
suffix:semicolon
r_static
id|rndis_resp_t
op_star
id|rndis_add_response
(paren
r_int
id|configNr
comma
id|u32
id|length
)paren
suffix:semicolon
multiline_comment|/* NDIS Functions */
DECL|function|gen_ndis_query_resp
r_static
r_int
id|gen_ndis_query_resp
(paren
r_int
id|configNr
comma
id|u32
id|OID
comma
id|rndis_resp_t
op_star
id|r
)paren
(brace
r_int
id|retval
op_assign
op_minus
id|ENOTSUPP
suffix:semicolon
id|u32
id|length
op_assign
l_int|0
suffix:semicolon
id|u32
op_star
id|tmp
suffix:semicolon
r_int
id|i
comma
id|count
suffix:semicolon
id|rndis_query_cmplt_type
op_star
id|resp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_query_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_switch
c_cond
(paren
id|OID
)paren
(brace
multiline_comment|/* general oids (table 4-1) */
multiline_comment|/* mandatory */
r_case
id|OID_GEN_SUPPORTED_LIST
suffix:colon
id|DEBUG
(paren
l_string|&quot;%s: OID_GEN_SUPPORTED_LIST&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
r_sizeof
(paren
id|oid_supported_list
)paren
suffix:semicolon
id|count
op_assign
id|length
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|resp
op_plus
l_int|24
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
id|tmp
(braket
id|i
)braket
op_assign
id|cpu_to_le32
(paren
id|oid_supported_list
(braket
id|i
)braket
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_HARDWARE_STATUS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_HARDWARE_STATUS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Bogus question! &n;&t;&t; * Hardware must be ready to recieve high level protocols.&n;&t;&t; * BTW: &n;&t;&t; * reddite ergo quae sunt Caesaris Caesari&n;&t;&t; * et quae sunt Dei Deo!&n;&t;&t; */
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_MEDIA_SUPPORTED
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MEDIA_SUPPORTED&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|medium
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_MEDIA_IN_USE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MEDIA_IN_USE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* one medium, one transport... (maybe you do it better) */
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|medium
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_MAXIMUM_FRAME_SIZE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MAXIMUM_FRAME_SIZE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev-&gt;mtu
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_LINK_SPEED
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_LINK_SPEED&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|media_state
op_eq
id|NDIS_MEDIA_STATE_DISCONNECTED
)paren
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
r_else
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|speed
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_TRANSMIT_BLOCK_SIZE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_TRANSMIT_BLOCK_SIZE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev-&gt;mtu
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_RECEIVE_BLOCK_SIZE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RECEIVE_BLOCK_SIZE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev-&gt;mtu
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_VENDOR_ID
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_VENDOR_ID&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|vendorID
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_VENDOR_DESCRIPTION
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_VENDOR_DESCRIPTION&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
id|strlen
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|vendorDescr
)paren
suffix:semicolon
id|memcpy
(paren
(paren
id|u8
op_star
)paren
id|resp
op_plus
l_int|24
comma
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|vendorDescr
comma
id|length
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_GEN_VENDOR_DRIVER_VERSION
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_VENDOR_DRIVER_VERSION&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Created as LE */
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|rndis_driver_version
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_CURRENT_PACKET_FILTER
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_CURRENT_PACKET_FILTER&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|filter
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_MAXIMUM_TOTAL_SIZE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MAXIMUM_TOTAL_SIZE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
c_func
(paren
id|RNDIS_MAX_TOTAL_SIZE
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_MEDIA_CONNECT_STATUS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MEDIA_CONNECT_STATUS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|media_state
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_GEN_PHYSICAL_MEDIUM
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_PHYSICAL_MEDIUM&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* The RNDIS specification is incomplete/wrong.   Some versions&n;&t; * of MS-Windows expect OIDs that aren&squot;t specified there.  Other&n;&t; * versions emit undefined RNDIS messages. DOCUMENT ALL THESE!&n;&t; */
r_case
id|OID_GEN_MAC_OPTIONS
suffix:colon
multiline_comment|/* from WinME */
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MAC_OPTIONS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
c_func
(paren
id|NDIS_MAC_OPTION_RECEIVE_SERIALIZED
op_or
id|NDIS_MAC_OPTION_FULL_DUPLEX
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* statistics OIDs (table 4-2) */
multiline_comment|/* mandatory */
r_case
id|OID_GEN_XMIT_OK
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_XMIT_OK&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_packets
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_errors
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_dropped
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_RCV_OK
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RCV_OK&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_packets
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_errors
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_dropped
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_XMIT_ERROR
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_XMIT_ERROR&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_errors
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_RCV_ERROR
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RCV_ERROR&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_errors
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_GEN_RCV_NO_BUFFER
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RCV_NO_BUFFER&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_dropped
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#ifdef&t;RNDIS_OPTIONAL_STATS
r_case
id|OID_GEN_DIRECTED_BYTES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_DIRECTED_BYTES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Aunt Tilly&squot;s size of shoes&n;&t;&t; * minus antarctica count of penguins&n;&t;&t; * divided by weight of Alpha Centauri&n;&t;&t; */
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_packets
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_errors
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_dropped
)paren
op_star
l_int|123
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_DIRECTED_FRAMES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_DIRECTED_FRAMES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* dito */
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_packets
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_errors
op_minus
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_dropped
)paren
op_div
l_int|123
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_MULTICAST_BYTES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MULTICAST_BYTES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;multicast
op_star
l_int|1234
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_MULTICAST_FRAMES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MULTICAST_FRAMES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;multicast
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_BROADCAST_BYTES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_BROADCAST_BYTES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_packets
op_div
l_int|42
op_star
l_int|255
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_BROADCAST_FRAMES_XMIT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_BROADCAST_FRAMES_XMIT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;tx_packets
op_div
l_int|42
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_DIRECTED_BYTES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_DIRECTED_BYTES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_GEN_DIRECTED_FRAMES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_DIRECTED_FRAMES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_GEN_MULTICAST_BYTES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MULTICAST_BYTES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;multicast
op_star
l_int|1111
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_MULTICAST_FRAMES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_MULTICAST_FRAMES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;multicast
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_BROADCAST_BYTES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_BROADCAST_BYTES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_packets
op_div
l_int|42
op_star
l_int|255
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_BROADCAST_FRAMES_RCV
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_BROADCAST_FRAMES_RCV&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_packets
op_div
l_int|42
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_RCV_CRC_ERROR
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RCV_CRC_ERROR&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_crc_errors
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_GEN_TRANSMIT_QUEUE_LENGTH
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_TRANSMIT_QUEUE_LENGTH&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;/* RNDIS_OPTIONAL_STATS */
multiline_comment|/* ieee802.3 OIDs (table 4-3) */
multiline_comment|/* mandatory */
r_case
id|OID_802_3_PERMANENT_ADDRESS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_PERMANENT_ADDRESS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
(brace
id|length
op_assign
id|ETH_ALEN
suffix:semicolon
id|memcpy
(paren
(paren
id|u8
op_star
)paren
id|resp
op_plus
l_int|24
comma
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|host_mac
comma
id|length
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_802_3_CURRENT_ADDRESS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_CURRENT_ADDRESS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
(brace
id|length
op_assign
id|ETH_ALEN
suffix:semicolon
id|memcpy
(paren
(paren
id|u8
op_star
)paren
id|resp
op_plus
l_int|24
comma
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|host_mac
comma
id|length
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_802_3_MULTICAST_LIST
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_MULTICAST_LIST&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Multicast base address only */
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0xE0000000
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_802_3_MAXIMUM_LIST_SIZE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_MAXIMUM_LIST_SIZE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Multicast base address only */
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|1
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_802_3_MAC_OPTIONS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_MAC_OPTIONS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* ieee802.3 statistics OIDs (table 4-4) */
multiline_comment|/* mandatory */
r_case
id|OID_802_3_RCV_ERROR_ALIGNMENT
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_RCV_ERROR_ALIGNMENT&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
)paren
(brace
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats-&gt;rx_frame_errors
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_802_3_XMIT_ONE_COLLISION
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_ONE_COLLISION&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* mandatory */
r_case
id|OID_802_3_XMIT_MORE_COLLISIONS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_MORE_COLLISIONS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|length
op_assign
l_int|4
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|resp
op_plus
l_int|6
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef&t;RNDIS_OPTIONAL_STATS
r_case
id|OID_802_3_XMIT_DEFERRED
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_DEFERRED&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_XMIT_MAX_COLLISIONS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_MAX_COLLISIONS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_RCV_OVERRUN
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_RCV_OVERRUN&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_XMIT_UNDERRUN
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_UNDERRUN&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_XMIT_HEARTBEAT_FAILURE
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_HEARTBEAT_FAILURE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_XMIT_TIMES_CRS_LOST
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_TIMES_CRS_LOST&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
r_case
id|OID_802_3_XMIT_LATE_COLLISIONS
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_XMIT_LATE_COLLISIONS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* TODO */
r_break
suffix:semicolon
macro_line|#endif&t;/* RNDIS_OPTIONAL_STATS */
macro_line|#ifdef&t;RNDIS_PM
multiline_comment|/* power management OIDs (table 4-5) */
r_case
id|OID_PNP_CAPABILITIES
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_PNP_CAPABILITIES&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* just PM, and remote wakeup on link status change&n;&t;&t; * (not magic packet or pattern match)&n;&t;&t; */
id|length
op_assign
r_sizeof
(paren
r_struct
id|NDIS_PNP_CAPABILITIES
)paren
suffix:semicolon
id|memset
(paren
id|resp
comma
l_int|0
comma
id|length
)paren
suffix:semicolon
(brace
r_struct
id|NDIS_PNP_CAPABILITIES
op_star
id|caps
op_assign
(paren
r_void
op_star
)paren
id|resp
suffix:semicolon
id|caps-&gt;Flags
op_assign
id|NDIS_DEVICE_WAKE_UP_ENABLE
suffix:semicolon
id|caps-&gt;WakeUpCapabilities.MinLinkChangeWakeUp
op_assign
id|NdisDeviceStateD3
suffix:semicolon
multiline_comment|/* FIXME then use usb_gadget_wakeup(), and&n;&t;&t;&t; * set USB_CONFIG_ATT_WAKEUP in config desc&n;&t;&t;&t; */
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_PNP_QUERY_POWER
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_PNP_QUERY_POWER&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* sure, handle any power state that maps to USB suspend */
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
(paren
id|KERN_WARNING
l_string|&quot;%s: query unknown OID 0x%08X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|OID
)paren
suffix:semicolon
)brace
id|resp-&gt;InformationBufferOffset
op_assign
id|__constant_cpu_to_le32
(paren
l_int|16
)paren
suffix:semicolon
id|resp-&gt;InformationBufferLength
op_assign
id|cpu_to_le32
(paren
id|length
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|cpu_to_le32
(paren
l_int|24
op_plus
id|length
)paren
suffix:semicolon
id|r-&gt;length
op_assign
l_int|24
op_plus
id|length
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|gen_ndis_set_resp
r_static
r_int
id|gen_ndis_set_resp
(paren
id|u8
id|configNr
comma
id|u32
id|OID
comma
id|u8
op_star
id|buf
comma
id|u32
id|buf_len
comma
id|rndis_resp_t
op_star
id|r
)paren
(brace
id|rndis_set_cmplt_type
op_star
id|resp
suffix:semicolon
r_int
id|i
comma
id|retval
op_assign
op_minus
id|ENOTSUPP
suffix:semicolon
r_struct
id|rndis_params
op_star
id|params
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_set_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;set OID %08x value, len %d:&bslash;n&quot;
comma
id|OID
comma
id|buf_len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|buf_len
suffix:semicolon
id|i
op_add_assign
l_int|16
)paren
(brace
id|DEBUG
(paren
l_string|&quot;%03d: &quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot;&bslash;n&quot;
comma
id|i
comma
id|buf
(braket
id|i
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|1
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|2
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|3
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|4
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|5
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|6
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|7
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|8
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|9
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|10
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|11
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|12
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|13
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|14
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|15
)braket
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|OID
)paren
(brace
r_case
id|OID_GEN_CURRENT_PACKET_FILTER
suffix:colon
id|params
op_assign
op_amp
id|rndis_per_dev_params
(braket
id|configNr
)braket
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME use these NDIS_PACKET_TYPE_* bitflags to&n;&t;&t; * filter packets in hard_start_xmit()&n;&t;&t; * NDIS_PACKET_TYPE_x == CDC_PACKET_TYPE_x for x in:&n;&t;&t; *&t;PROMISCUOUS, DIRECTED,&n;&t;&t; *&t;MULTICAST, ALL_MULTICAST, BROADCAST&n;&t;&t; */
id|params-&gt;filter
op_assign
id|cpu_to_le32p
c_func
(paren
(paren
id|u32
op_star
)paren
id|buf
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_CURRENT_PACKET_FILTER %08x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|params-&gt;filter
)paren
suffix:semicolon
multiline_comment|/* this call has a significant side effect:  it&squot;s&n;&t;&t; * what makes the packet flow start and stop, like&n;&t;&t; * activating the CDC Ethernet altsetting.&n;&t;&t; */
r_if
c_cond
(paren
id|params-&gt;filter
)paren
(brace
id|params-&gt;state
op_assign
id|RNDIS_DATA_INITIALIZED
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|params-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|params-&gt;dev
)paren
)paren
id|netif_wake_queue
(paren
id|params-&gt;dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|params-&gt;state
op_assign
id|RNDIS_INITIALIZED
suffix:semicolon
id|netif_carrier_off
(paren
id|params-&gt;dev
)paren
suffix:semicolon
id|netif_stop_queue
(paren
id|params-&gt;dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|OID_802_3_MULTICAST_LIST
suffix:colon
multiline_comment|/* I think we can ignore this */
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_802_3_MULTICAST_LIST&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|OID_GEN_RNDIS_CONFIG_PARAMETER
suffix:colon
(brace
r_struct
id|rndis_config_parameter
op_star
id|param
suffix:semicolon
id|param
op_assign
(paren
r_struct
id|rndis_config_parameter
op_star
)paren
id|buf
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;%s: OID_GEN_RNDIS_CONFIG_PARAMETER &squot;%*s&squot;&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|min
c_func
(paren
id|cpu_to_le32
c_func
(paren
id|param-&gt;ParameterNameLength
)paren
comma
l_int|80
)paren
comma
id|buf
op_plus
id|param-&gt;ParameterNameOffset
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef&t;RNDIS_PM
r_case
id|OID_PNP_SET_POWER
suffix:colon
id|DEBUG
(paren
l_string|&quot;OID_PNP_SET_POWER&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* sure, handle any power state that maps to USB suspend */
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OID_PNP_ENABLE_WAKE_UP
suffix:colon
multiline_comment|/* always-connected ... */
id|DEBUG
(paren
l_string|&quot;OID_PNP_ENABLE_WAKE_UP&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// no PM resume patterns supported (specified where?)
singleline_comment|// so OID_PNP_{ADD,REMOVE}_WAKE_UP_PATTERN always fails
macro_line|#endif
r_default
suffix:colon
id|printk
(paren
id|KERN_WARNING
l_string|&quot;%s: set unknown OID 0x%08X, size %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|OID
comma
id|buf_len
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* &n; * Response Functions &n; */
DECL|function|rndis_init_response
r_static
r_int
id|rndis_init_response
(paren
r_int
id|configNr
comma
id|rndis_init_msg_type
op_star
id|buf
)paren
(brace
id|rndis_init_cmplt_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|rndis_init_cmplt_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_init_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_INITIALIZE_CMPLT
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|52
)paren
suffix:semicolon
id|resp-&gt;RequestID
op_assign
id|buf-&gt;RequestID
suffix:semicolon
multiline_comment|/* Still LE in msg buffer */
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_SUCCESS
)paren
suffix:semicolon
id|resp-&gt;MajorVersion
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_MAJOR_VERSION
)paren
suffix:semicolon
id|resp-&gt;MinorVersion
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_MINOR_VERSION
)paren
suffix:semicolon
id|resp-&gt;DeviceFlags
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_DF_CONNECTIONLESS
)paren
suffix:semicolon
id|resp-&gt;Medium
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_MEDIUM_802_3
)paren
suffix:semicolon
id|resp-&gt;MaxPacketsPerTransfer
op_assign
id|__constant_cpu_to_le32
(paren
l_int|1
)paren
suffix:semicolon
id|resp-&gt;MaxTransferSize
op_assign
id|cpu_to_le32
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev-&gt;mtu
op_plus
r_sizeof
(paren
r_struct
id|ethhdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|rndis_packet_msg_type
)paren
op_plus
l_int|22
)paren
suffix:semicolon
id|resp-&gt;PacketAlignmentFactor
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|resp-&gt;AFListOffset
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|resp-&gt;AFListSize
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_query_response
r_static
r_int
id|rndis_query_response
(paren
r_int
id|configNr
comma
id|rndis_query_msg_type
op_star
id|buf
)paren
(brace
id|rndis_query_cmplt_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
singleline_comment|// DEBUG(&quot;%s: OID = %08X&bslash;n&quot;, __FUNCTION__, cpu_to_le32(buf-&gt;OID));
r_if
c_cond
(paren
op_logical_neg
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
multiline_comment|/* &n;&t; * we need more memory: &n;&t; * oid_supported_list is the largest answer &n;&t; */
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|oid_supported_list
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_query_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_QUERY_CMPLT
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|24
)paren
suffix:semicolon
id|resp-&gt;RequestID
op_assign
id|buf-&gt;RequestID
suffix:semicolon
multiline_comment|/* Still LE in msg buffer */
r_if
c_cond
(paren
id|gen_ndis_query_resp
(paren
id|configNr
comma
id|cpu_to_le32
(paren
id|buf-&gt;OID
)paren
comma
id|r
)paren
)paren
(brace
multiline_comment|/* OID not supported */
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_NOT_SUPPORTED
)paren
suffix:semicolon
id|resp-&gt;InformationBufferLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|resp-&gt;InformationBufferOffset
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_SUCCESS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_set_response
r_static
r_int
id|rndis_set_response
(paren
r_int
id|configNr
comma
id|rndis_set_msg_type
op_star
id|buf
)paren
(brace
id|u32
id|BufLength
comma
id|BufOffset
suffix:semicolon
id|rndis_set_cmplt_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|rndis_set_cmplt_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_set_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|BufLength
op_assign
id|cpu_to_le32
(paren
id|buf-&gt;InformationBufferLength
)paren
suffix:semicolon
id|BufOffset
op_assign
id|cpu_to_le32
(paren
id|buf-&gt;InformationBufferOffset
)paren
suffix:semicolon
macro_line|#ifdef&t;VERBOSE
id|DEBUG
c_func
(paren
l_string|&quot;%s: Length: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|BufLength
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;%s: Offset: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|BufOffset
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;%s: InfoBuffer: &quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BufLength
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DEBUG
(paren
l_string|&quot;%02x &quot;
comma
op_star
(paren
(paren
(paren
id|u8
op_star
)paren
id|buf
)paren
op_plus
id|i
op_plus
l_int|8
op_plus
id|BufOffset
)paren
)paren
suffix:semicolon
)brace
id|DEBUG
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_SET_CMPLT
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|16
)paren
suffix:semicolon
id|resp-&gt;RequestID
op_assign
id|buf-&gt;RequestID
suffix:semicolon
multiline_comment|/* Still LE in msg buffer */
r_if
c_cond
(paren
id|gen_ndis_set_resp
(paren
id|configNr
comma
id|cpu_to_le32
(paren
id|buf-&gt;OID
)paren
comma
(paren
(paren
id|u8
op_star
)paren
id|buf
)paren
op_plus
l_int|8
op_plus
id|BufOffset
comma
id|BufLength
comma
id|r
)paren
)paren
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_NOT_SUPPORTED
)paren
suffix:semicolon
r_else
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_SUCCESS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_reset_response
r_static
r_int
id|rndis_reset_response
(paren
r_int
id|configNr
comma
id|rndis_reset_msg_type
op_star
id|buf
)paren
(brace
id|rndis_reset_cmplt_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|rndis_reset_cmplt_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_reset_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_RESET_CMPLT
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|16
)paren
suffix:semicolon
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_SUCCESS
)paren
suffix:semicolon
multiline_comment|/* resent information */
id|resp-&gt;AddressingReset
op_assign
id|__constant_cpu_to_le32
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_keepalive_response
r_static
r_int
id|rndis_keepalive_response
(paren
r_int
id|configNr
comma
id|rndis_keepalive_msg_type
op_star
id|buf
)paren
(brace
id|rndis_keepalive_cmplt_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
multiline_comment|/* host &quot;should&quot; check only in RNDIS_DATA_INITIALIZED state */
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|rndis_keepalive_cmplt_type
)paren
)paren
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_keepalive_cmplt_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_KEEPALIVE_CMPLT
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|16
)paren
suffix:semicolon
id|resp-&gt;RequestID
op_assign
id|buf-&gt;RequestID
suffix:semicolon
multiline_comment|/* Still LE in msg buffer */
id|resp-&gt;Status
op_assign
id|__constant_cpu_to_le32
(paren
id|RNDIS_STATUS_SUCCESS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * Device to Host Comunication &n; */
DECL|function|rndis_indicate_status_msg
r_static
r_int
id|rndis_indicate_status_msg
(paren
r_int
id|configNr
comma
id|u32
id|status
)paren
(brace
id|rndis_indicate_status_msg_type
op_star
id|resp
suffix:semicolon
id|rndis_resp_t
op_star
id|r
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|state
op_eq
id|RNDIS_UNINITIALIZED
)paren
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
id|r
op_assign
id|rndis_add_response
(paren
id|configNr
comma
r_sizeof
(paren
id|rndis_indicate_status_msg_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp
op_assign
(paren
id|rndis_indicate_status_msg_type
op_star
)paren
id|r-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|resp-&gt;MessageType
op_assign
id|__constant_cpu_to_le32
(paren
id|REMOTE_NDIS_INDICATE_STATUS_MSG
)paren
suffix:semicolon
id|resp-&gt;MessageLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|20
)paren
suffix:semicolon
id|resp-&gt;Status
op_assign
id|cpu_to_le32
(paren
id|status
)paren
suffix:semicolon
id|resp-&gt;StatusBufferLength
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
id|resp-&gt;StatusBufferOffset
op_assign
id|__constant_cpu_to_le32
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
)paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|ack
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_signal_connect
r_int
id|rndis_signal_connect
(paren
r_int
id|configNr
)paren
(brace
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|media_state
op_assign
id|NDIS_MEDIA_STATE_CONNECTED
suffix:semicolon
r_return
id|rndis_indicate_status_msg
(paren
id|configNr
comma
id|RNDIS_STATUS_MEDIA_CONNECT
)paren
suffix:semicolon
)brace
DECL|function|rndis_signal_disconnect
r_int
id|rndis_signal_disconnect
(paren
r_int
id|configNr
)paren
(brace
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|media_state
op_assign
id|NDIS_MEDIA_STATE_DISCONNECTED
suffix:semicolon
r_return
id|rndis_indicate_status_msg
(paren
id|configNr
comma
id|RNDIS_STATUS_MEDIA_DISCONNECT
)paren
suffix:semicolon
)brace
DECL|function|rndis_set_host_mac
r_void
id|rndis_set_host_mac
(paren
r_int
id|configNr
comma
r_const
id|u8
op_star
id|addr
)paren
(brace
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|host_mac
op_assign
id|addr
suffix:semicolon
)brace
multiline_comment|/* &n; * Message Parser &n; */
DECL|function|rndis_msg_parser
r_int
id|rndis_msg_parser
(paren
id|u8
id|configNr
comma
id|u8
op_star
id|buf
)paren
(brace
id|u32
id|MsgType
comma
id|MsgLength
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|rndis_params
op_star
id|params
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|tmp
op_assign
(paren
id|u32
op_star
)paren
id|buf
suffix:semicolon
id|MsgType
op_assign
id|cpu_to_le32p
c_func
(paren
id|tmp
op_increment
)paren
suffix:semicolon
id|MsgLength
op_assign
id|cpu_to_le32p
c_func
(paren
id|tmp
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|configNr
op_ge
id|RNDIS_MAX_CONFIGS
)paren
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
id|params
op_assign
op_amp
id|rndis_per_dev_params
(braket
id|configNr
)braket
suffix:semicolon
multiline_comment|/* For USB: responses may take up to 10 seconds */
r_switch
c_cond
(paren
id|MsgType
)paren
(brace
r_case
id|REMOTE_NDIS_INITIALIZE_MSG
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: REMOTE_NDIS_INITIALIZE_MSG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|params-&gt;state
op_assign
id|RNDIS_INITIALIZED
suffix:semicolon
r_return
id|rndis_init_response
(paren
id|configNr
comma
(paren
id|rndis_init_msg_type
op_star
)paren
id|buf
)paren
suffix:semicolon
r_case
id|REMOTE_NDIS_HALT_MSG
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: REMOTE_NDIS_HALT_MSG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|params-&gt;state
op_assign
id|RNDIS_UNINITIALIZED
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;dev
)paren
(brace
id|netif_carrier_off
(paren
id|params-&gt;dev
)paren
suffix:semicolon
id|netif_stop_queue
(paren
id|params-&gt;dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|REMOTE_NDIS_QUERY_MSG
suffix:colon
r_return
id|rndis_query_response
(paren
id|configNr
comma
(paren
id|rndis_query_msg_type
op_star
)paren
id|buf
)paren
suffix:semicolon
r_case
id|REMOTE_NDIS_SET_MSG
suffix:colon
r_return
id|rndis_set_response
(paren
id|configNr
comma
(paren
id|rndis_set_msg_type
op_star
)paren
id|buf
)paren
suffix:semicolon
r_case
id|REMOTE_NDIS_RESET_MSG
suffix:colon
id|DEBUG
c_func
(paren
l_string|&quot;%s: REMOTE_NDIS_RESET_MSG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|rndis_reset_response
(paren
id|configNr
comma
(paren
id|rndis_reset_msg_type
op_star
)paren
id|buf
)paren
suffix:semicolon
r_case
id|REMOTE_NDIS_KEEPALIVE_MSG
suffix:colon
multiline_comment|/* For USB: host does this every 5 seconds */
macro_line|#ifdef&t;VERBOSE
id|DEBUG
c_func
(paren
l_string|&quot;%s: REMOTE_NDIS_KEEPALIVE_MSG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_return
id|rndis_keepalive_response
(paren
id|configNr
comma
(paren
id|rndis_keepalive_msg_type
op_star
)paren
id|buf
)paren
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* At least Windows XP emits some undefined RNDIS messages.&n;&t;&t; * In one case those messages seemed to relate to the host&n;&t;&t; * suspending itself.&n;&t;&t; */
id|printk
(paren
id|KERN_WARNING
l_string|&quot;%s: unknown RNDIS message 0x%08X len %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|MsgType
comma
id|MsgLength
)paren
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MsgLength
suffix:semicolon
id|i
op_add_assign
l_int|16
)paren
(brace
id|DEBUG
(paren
l_string|&quot;%03d: &quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot; %02x %02x %02x %02x&quot;
l_string|&quot;&bslash;n&quot;
comma
id|i
comma
id|buf
(braket
id|i
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|1
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|2
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|3
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|4
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|5
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|6
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|7
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|8
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|9
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|10
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|11
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|12
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|13
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|14
)braket
comma
id|buf
(braket
id|i
op_plus
l_int|15
)braket
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
)brace
DECL|function|rndis_register
r_int
id|rndis_register
(paren
r_int
(paren
op_star
id|rndis_control_ack
)paren
(paren
r_struct
id|net_device
op_star
)paren
)paren
(brace
id|u8
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RNDIS_MAX_CONFIGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|used
)paren
(brace
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|used
op_assign
l_int|1
suffix:semicolon
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|ack
op_assign
id|rndis_control_ack
suffix:semicolon
id|DEBUG
c_func
(paren
l_string|&quot;%s: configNr = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
id|DEBUG
c_func
(paren
l_string|&quot;failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|rndis_deregister
r_void
id|rndis_deregister
(paren
r_int
id|configNr
)paren
(brace
id|DEBUG
c_func
(paren
l_string|&quot;%s: &bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|configNr
op_ge
id|RNDIS_MAX_CONFIGS
)paren
r_return
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|used
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|rndis_set_param_dev
r_int
id|rndis_set_param_dev
(paren
id|u8
id|configNr
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|net_device_stats
op_star
id|stats
)paren
(brace
id|DEBUG
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|stats
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|configNr
op_ge
id|RNDIS_MAX_CONFIGS
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|dev
op_assign
id|dev
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|stats
op_assign
id|stats
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_set_param_vendor
r_int
id|rndis_set_param_vendor
(paren
id|u8
id|configNr
comma
id|u32
id|vendorID
comma
r_const
r_char
op_star
id|vendorDescr
)paren
(brace
id|DEBUG
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vendorDescr
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|configNr
op_ge
id|RNDIS_MAX_CONFIGS
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|vendorID
op_assign
id|vendorID
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|vendorDescr
op_assign
id|vendorDescr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_set_param_medium
r_int
id|rndis_set_param_medium
(paren
id|u8
id|configNr
comma
id|u32
id|medium
comma
id|u32
id|speed
)paren
(brace
id|DEBUG
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|configNr
op_ge
id|RNDIS_MAX_CONFIGS
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|medium
op_assign
id|medium
suffix:semicolon
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|speed
op_assign
id|speed
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_add_hdr
r_void
id|rndis_add_hdr
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|skb_push
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|rndis_packet_msg_type
)paren
)paren
suffix:semicolon
id|memset
(paren
id|skb-&gt;data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rndis_packet_msg_type
)paren
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb-&gt;data
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|1
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb-&gt;data
op_plus
l_int|1
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb-&gt;data
op_plus
l_int|2
)paren
op_assign
id|__constant_cpu_to_le32
(paren
l_int|36
)paren
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb-&gt;data
op_plus
l_int|3
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_minus
l_int|44
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|rndis_free_response
r_void
id|rndis_free_response
(paren
r_int
id|configNr
comma
id|u8
op_star
id|buf
)paren
(brace
id|rndis_resp_t
op_star
id|r
suffix:semicolon
r_struct
id|list_head
op_star
id|act
comma
op_star
id|tmp
suffix:semicolon
id|list_for_each_safe
(paren
id|act
comma
id|tmp
comma
op_amp
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|resp_queue
)paren
)paren
(brace
id|r
op_assign
id|list_entry
(paren
id|act
comma
id|rndis_resp_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_logical_and
id|r-&gt;buf
op_eq
id|buf
)paren
(brace
id|list_del
(paren
op_amp
id|r-&gt;list
)paren
suffix:semicolon
id|kfree
(paren
id|r
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|rndis_get_next_response
id|u8
op_star
id|rndis_get_next_response
(paren
r_int
id|configNr
comma
id|u32
op_star
id|length
)paren
(brace
id|rndis_resp_t
op_star
id|r
suffix:semicolon
r_struct
id|list_head
op_star
id|act
comma
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|length
)paren
r_return
l_int|NULL
suffix:semicolon
id|list_for_each_safe
(paren
id|act
comma
id|tmp
comma
op_amp
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|resp_queue
)paren
)paren
(brace
id|r
op_assign
id|list_entry
(paren
id|act
comma
id|rndis_resp_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r-&gt;send
)paren
(brace
id|r-&gt;send
op_assign
l_int|1
suffix:semicolon
op_star
id|length
op_assign
id|r-&gt;length
suffix:semicolon
r_return
id|r-&gt;buf
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|rndis_add_response
r_static
id|rndis_resp_t
op_star
id|rndis_add_response
(paren
r_int
id|configNr
comma
id|u32
id|length
)paren
(brace
id|rndis_resp_t
op_star
id|r
suffix:semicolon
id|r
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|rndis_resp_t
)paren
op_plus
id|length
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_return
l_int|NULL
suffix:semicolon
id|r-&gt;buf
op_assign
(paren
id|u8
op_star
)paren
(paren
id|r
op_plus
l_int|1
)paren
suffix:semicolon
id|r-&gt;length
op_assign
id|length
suffix:semicolon
id|r-&gt;send
op_assign
l_int|0
suffix:semicolon
id|list_add_tail
(paren
op_amp
id|r-&gt;list
comma
op_amp
(paren
id|rndis_per_dev_params
(braket
id|configNr
)braket
dot
id|resp_queue
)paren
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
DECL|function|rndis_rm_hdr
r_int
id|rndis_rm_hdr
(paren
id|u8
op_star
id|buf
comma
id|u32
op_star
id|length
)paren
(brace
id|u32
id|i
comma
id|messageLen
comma
id|dataOffset
comma
op_star
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
id|u32
op_star
)paren
id|buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
op_logical_or
op_logical_neg
id|length
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cpu_to_le32p
c_func
(paren
id|tmp
op_increment
)paren
op_ne
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|messageLen
op_assign
id|cpu_to_le32p
c_func
(paren
id|tmp
op_increment
)paren
suffix:semicolon
id|dataOffset
op_assign
id|cpu_to_le32p
c_func
(paren
id|tmp
op_increment
)paren
op_plus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|messageLen
template_param
op_star
id|length
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|dataOffset
suffix:semicolon
id|i
OL
id|messageLen
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
op_minus
id|dataOffset
)braket
op_assign
id|buf
(braket
id|i
)braket
suffix:semicolon
op_star
id|length
op_assign
id|messageLen
op_minus
id|dataOffset
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_proc_read
r_int
id|rndis_proc_read
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
suffix:semicolon
id|rndis_params
op_star
id|param
op_assign
(paren
id|rndis_params
op_star
)paren
id|data
suffix:semicolon
id|out
op_add_assign
id|snprintf
(paren
id|out
comma
id|count
comma
l_string|&quot;Config Nr. %d&bslash;n&quot;
l_string|&quot;used      : %s&bslash;n&quot;
l_string|&quot;state     : %s&bslash;n&quot;
l_string|&quot;medium    : 0x%08X&bslash;n&quot;
l_string|&quot;speed     : %d&bslash;n&quot;
l_string|&quot;cable     : %s&bslash;n&quot;
l_string|&quot;vendor ID : 0x%08X&bslash;n&quot;
l_string|&quot;vendor    : %s&bslash;n&quot;
comma
id|param-&gt;confignr
comma
(paren
id|param-&gt;used
)paren
ques
c_cond
l_string|&quot;y&quot;
suffix:colon
l_string|&quot;n&quot;
comma
(paren
(brace
r_char
op_star
id|s
op_assign
l_string|&quot;?&quot;
suffix:semicolon
r_switch
(paren
id|param-&gt;state
)paren
(brace
r_case
id|RNDIS_UNINITIALIZED
suffix:colon
id|s
op_assign
l_string|&quot;RNDIS_UNINITIALIZED&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RNDIS_INITIALIZED
suffix:colon
id|s
op_assign
l_string|&quot;RNDIS_INITIALIZED&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RNDIS_DATA_INITIALIZED
suffix:colon
id|s
op_assign
l_string|&quot;RNDIS_DATA_INITIALIZED&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|s
suffix:semicolon
)brace
)paren
comma
id|param-&gt;medium
comma
(paren
id|param-&gt;media_state
)paren
ques
c_cond
l_int|0
suffix:colon
id|param-&gt;speed
op_star
l_int|100
comma
(paren
id|param-&gt;media_state
)paren
ques
c_cond
l_string|&quot;disconnected&quot;
suffix:colon
l_string|&quot;connected&quot;
comma
id|param-&gt;vendorID
comma
id|param-&gt;vendorDescr
)paren
suffix:semicolon
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|len
op_sub_assign
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|count
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
id|len
op_assign
id|count
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|rndis_proc_write
r_int
id|rndis_proc_write
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|u32
id|speed
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|fl_speed
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
op_star
id|buffer
)paren
(brace
r_case
l_char|&squot;0&squot;
suffix:colon
r_case
l_char|&squot;1&squot;
suffix:colon
r_case
l_char|&squot;2&squot;
suffix:colon
r_case
l_char|&squot;3&squot;
suffix:colon
r_case
l_char|&squot;4&squot;
suffix:colon
r_case
l_char|&squot;5&squot;
suffix:colon
r_case
l_char|&squot;6&squot;
suffix:colon
r_case
l_char|&squot;7&squot;
suffix:colon
r_case
l_char|&squot;8&squot;
suffix:colon
r_case
l_char|&squot;9&squot;
suffix:colon
id|fl_speed
op_assign
l_int|1
suffix:semicolon
id|speed
op_assign
id|speed
op_star
l_int|10
op_plus
op_star
id|buffer
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
r_case
l_char|&squot;c&squot;
suffix:colon
id|rndis_signal_connect
(paren
(paren
(paren
id|rndis_params
op_star
)paren
id|data
)paren
op_member_access_from_pointer
id|confignr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
r_case
l_char|&squot;d&squot;
suffix:colon
id|rndis_signal_disconnect
(paren
(paren
(paren
id|rndis_params
op_star
)paren
id|data
)paren
op_member_access_from_pointer
id|confignr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|fl_speed
)paren
(paren
(paren
id|rndis_params
op_star
)paren
id|data
)paren
op_member_access_from_pointer
id|speed
op_assign
id|speed
suffix:semicolon
r_else
id|DEBUG
(paren
l_string|&quot;%c is not valid&bslash;n&quot;
comma
op_star
id|buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|buffer
op_increment
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|rndis_init
r_int
id|__init
id|rndis_init
(paren
r_void
)paren
(brace
id|u8
id|i
suffix:semicolon
r_char
id|name
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* FIXME this should probably be /proc/driver/rndis,&n;&t; * and only if debugging is enabled&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|rndis_connect_dir
op_assign
id|proc_mkdir
(paren
l_string|&quot;rndis&quot;
comma
l_int|NULL
)paren
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: couldn&squot;t create /proc/rndis entry&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RNDIS_MAX_CONFIGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
(paren
id|name
comma
l_string|&quot;%03d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rndis_connect_state
(braket
id|i
)braket
op_assign
id|create_proc_entry
(paren
id|name
comma
l_int|0660
comma
id|rndis_connect_dir
)paren
)paren
)paren
(brace
id|DEBUG
(paren
l_string|&quot;%s :remove entries&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_decrement
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|sprintf
(paren
id|name
comma
l_string|&quot;%03d&quot;
comma
id|i
)paren
suffix:semicolon
id|remove_proc_entry
(paren
id|name
comma
id|rndis_connect_dir
)paren
suffix:semicolon
)brace
id|DEBUG
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|remove_proc_entry
(paren
l_string|&quot;000&quot;
comma
id|rndis_connect_dir
)paren
suffix:semicolon
id|remove_proc_entry
(paren
l_string|&quot;rndis&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|rndis_connect_state
(braket
id|i
)braket
op_member_access_from_pointer
id|nlink
op_assign
l_int|1
suffix:semicolon
id|rndis_connect_state
(braket
id|i
)braket
op_member_access_from_pointer
id|write_proc
op_assign
id|rndis_proc_write
suffix:semicolon
id|rndis_connect_state
(braket
id|i
)braket
op_member_access_from_pointer
id|read_proc
op_assign
id|rndis_proc_read
suffix:semicolon
id|rndis_connect_state
(braket
id|i
)braket
op_member_access_from_pointer
id|data
op_assign
(paren
r_void
op_star
)paren
(paren
id|rndis_per_dev_params
op_plus
id|i
)paren
suffix:semicolon
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|confignr
op_assign
id|i
suffix:semicolon
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|used
op_assign
l_int|0
suffix:semicolon
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|state
op_assign
id|RNDIS_UNINITIALIZED
suffix:semicolon
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|media_state
op_assign
id|NDIS_MEDIA_STATE_DISCONNECTED
suffix:semicolon
id|INIT_LIST_HEAD
(paren
op_amp
(paren
id|rndis_per_dev_params
(braket
id|i
)braket
dot
id|resp_queue
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rndis_exit
r_void
id|rndis_exit
(paren
r_void
)paren
(brace
id|u8
id|i
suffix:semicolon
r_char
id|name
(braket
l_int|4
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RNDIS_MAX_CONFIGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
(paren
id|name
comma
l_string|&quot;%03d&quot;
comma
id|i
)paren
suffix:semicolon
id|remove_proc_entry
(paren
id|name
comma
id|rndis_connect_dir
)paren
suffix:semicolon
)brace
id|remove_proc_entry
(paren
l_string|&quot;rndis&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
