multiline_comment|/*&n; * Endpoints (formerly known as AOX) se401 USB Camera Driver&n; *&n; * Copyright (c) 2000 Jeroen B. Vreeken (pe1rxq@amsat.org)&n; *&n; * Still somewhat based on the Linux ov511 driver.&n; * &n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2 of the License, or (at your&n; * option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY&n; * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n; * for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software Foundation,&n; * Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *&n; * Thanks to Endpoints Inc. (www.endpoints.com) for making documentation on&n; * their chipset available and supporting me while writing this driver.&n; * &t;- Jeroen Vreeken&n; */
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;0.23&quot;
suffix:semicolon
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 3, 0)
DECL|macro|virt_to_page
mdefine_line|#define virt_to_page(arg)&t;MAP_NR(arg)
DECL|macro|vmalloc_32
mdefine_line|#define vmalloc_32&t;&t;vmalloc
macro_line|#endif
macro_line|#include &quot;se401.h&quot;
DECL|variable|flickerless
r_static
r_int
id|flickerless
op_assign
l_int|0
suffix:semicolon
DECL|variable|video_nr
r_static
r_int
id|video_nr
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2, 3, 0)
DECL|variable|device_table
r_static
id|__devinitdata
r_struct
id|usb_device_id
id|device_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x03e8
comma
l_int|0x0004
)paren
)brace
comma
multiline_comment|/* Endpoints/Aox SE401 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0471
comma
l_int|0x030b
)paren
)brace
comma
multiline_comment|/* Philips PCVC665K */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x047d
comma
l_int|0x5001
)paren
)brace
comma
multiline_comment|/* Kensington 67014 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x047d
comma
l_int|0x5002
)paren
)brace
comma
multiline_comment|/* Kensington 6701(5/7) */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x047d
comma
l_int|0x5003
)paren
)brace
comma
multiline_comment|/* Kensington 67016 */
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|device_table
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jeroen Vreeken &lt;pe1rxq@amsat.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SE401 USB Camera Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|flickerless
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|flickerless
comma
l_string|&quot;Net frequency to adjust exposure time to (0/50/60)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|video_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|variable|se401_driver
r_static
r_struct
id|usb_driver
id|se401_driver
suffix:semicolon
multiline_comment|/**********************************************************************&n; *&n; * Memory management&n; *&n; **********************************************************************/
multiline_comment|/* Here we want the physical address of the memory.&n; * This is used when initializing the contents of the area.&n; */
DECL|function|kvirt_to_pa
r_static
r_inline
r_int
r_int
id|kvirt_to_pa
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|kva
comma
id|ret
suffix:semicolon
id|kva
op_assign
(paren
r_int
r_int
)paren
id|page_address
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|kva
op_or_assign
id|adr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* restore the offset */
id|ret
op_assign
id|__pa
c_func
(paren
id|kva
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|rvmalloc
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
r_int
r_int
id|adr
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|vmalloc_32
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* Clear the ram out, no junk to the user */
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|mem_map_reserve
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|rvfree
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|adr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
(paren
r_int
)paren
id|size
OG
l_int|0
)paren
(brace
id|mem_map_unreserve
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * /proc interface&n; *&n; ***************************************************************************/
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(CONFIG_VIDEO_PROC_FS)
DECL|variable|se401_proc_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|se401_proc_entry
op_assign
l_int|NULL
suffix:semicolon
r_extern
r_struct
id|proc_dir_entry
op_star
id|video_proc_entry
suffix:semicolon
DECL|macro|YES_NO
mdefine_line|#define YES_NO(x) ((x) ? &quot;yes&quot; : &quot;no&quot;)
DECL|function|se401_read_proc
r_static
r_int
id|se401_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|i
comma
id|len
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
id|data
suffix:semicolon
multiline_comment|/* Stay under PAGE_SIZE or else bla bla bla.... */
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;driver_version  : %s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;model           : %s&bslash;n&quot;
comma
id|se401-&gt;camera_name
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;in use          : %s&bslash;n&quot;
comma
id|YES_NO
(paren
id|se401-&gt;user
)paren
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;streaming       : %s&bslash;n&quot;
comma
id|YES_NO
(paren
id|se401-&gt;streaming
)paren
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;button state    : %s&bslash;n&quot;
comma
id|YES_NO
(paren
id|se401-&gt;button
)paren
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;button pressed  : %s&bslash;n&quot;
comma
id|YES_NO
(paren
id|se401-&gt;buttonpressed
)paren
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;num_frames      : %d&bslash;n&quot;
comma
id|SE401_NUMFRAMES
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;Sizes           :&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|se401-&gt;sizes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot; %dx%d&quot;
comma
id|se401-&gt;width
(braket
id|i
)braket
comma
id|se401-&gt;height
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;Frames total    : %d&bslash;n&quot;
comma
id|se401-&gt;readcount
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;Frames read     : %d&bslash;n&quot;
comma
id|se401-&gt;framecount
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;Packets dropped : %d&bslash;n&quot;
comma
id|se401-&gt;dropped
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;Decoding Errors : %d&bslash;n&quot;
comma
id|se401-&gt;error
)paren
suffix:semicolon
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|len
op_sub_assign
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|count
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
id|len
op_assign
id|count
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|se401_write_proc
r_static
r_int
id|se401_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|create_proc_se401_cam
r_static
r_void
id|create_proc_se401_cam
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_char
id|name
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401_proc_entry
op_logical_or
op_logical_neg
id|se401
)paren
r_return
suffix:semicolon
id|sprintf
(paren
id|name
comma
l_string|&quot;video%d&quot;
comma
id|se401-&gt;vdev.minor
)paren
suffix:semicolon
id|ent
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|se401_proc_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
r_return
suffix:semicolon
id|ent-&gt;data
op_assign
id|se401
suffix:semicolon
id|ent-&gt;read_proc
op_assign
id|se401_read_proc
suffix:semicolon
id|ent-&gt;write_proc
op_assign
id|se401_write_proc
suffix:semicolon
id|se401-&gt;proc_entry
op_assign
id|ent
suffix:semicolon
)brace
DECL|function|destroy_proc_se401_cam
r_static
r_void
id|destroy_proc_se401_cam
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
multiline_comment|/* One to much, just to be sure :) */
r_char
id|name
(braket
l_int|9
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401
op_logical_or
op_logical_neg
id|se401-&gt;proc_entry
)paren
r_return
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;video%d&quot;
comma
id|se401-&gt;vdev.minor
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|name
comma
id|se401_proc_entry
)paren
suffix:semicolon
id|se401-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|proc_se401_create
r_static
r_void
id|proc_se401_create
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|video_proc_entry
op_eq
l_int|NULL
)paren
(brace
id|err
c_func
(paren
l_string|&quot;/proc/video/ doesn&squot;t exist&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|se401_proc_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;se401&quot;
comma
id|S_IFDIR
comma
id|video_proc_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|se401_proc_entry
)paren
id|se401_proc_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_else
id|err
c_func
(paren
l_string|&quot;Unable to initialize /proc/video/se401&quot;
)paren
suffix:semicolon
)brace
DECL|function|proc_se401_destroy
r_static
r_void
id|proc_se401_destroy
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|se401_proc_entry
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;se401&quot;
comma
id|video_proc_entry
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS &amp;&amp; CONFIG_VIDEO_PROC_FS */
multiline_comment|/****************************************************************************&n; *&n; * se401 register read/write functions&n; *&n; ***************************************************************************/
DECL|function|se401_sndctrl
r_static
r_int
id|se401_sndctrl
c_func
(paren
r_int
id|set
comma
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
r_int
id|req
comma
r_int
r_int
id|value
comma
r_int
r_char
op_star
id|cp
comma
r_int
id|size
)paren
(brace
r_return
id|usb_control_msg
(paren
id|se401-&gt;dev
comma
id|set
ques
c_cond
id|usb_sndctrlpipe
c_func
(paren
id|se401-&gt;dev
comma
l_int|0
)paren
suffix:colon
id|usb_rcvctrlpipe
c_func
(paren
id|se401-&gt;dev
comma
l_int|0
)paren
comma
id|req
comma
(paren
id|set
ques
c_cond
id|USB_DIR_OUT
suffix:colon
id|USB_DIR_IN
)paren
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|value
comma
l_int|0
comma
id|cp
comma
id|size
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|se401_set_feature
r_static
r_int
id|se401_set_feature
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
r_int
id|selector
comma
r_int
r_int
id|param
)paren
(brace
multiline_comment|/* specs say that the selector (address) should go in the value field&n;&t;   and the param in index, but in the logs of the windows driver they do&n;&t;   this the other way around...&n;&t; */
r_return
id|usb_control_msg
(paren
id|se401-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|se401-&gt;dev
comma
l_int|0
)paren
comma
id|SE401_REQ_SET_EXT_FEATURE
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|param
comma
id|selector
comma
l_int|NULL
comma
l_int|0
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|se401_get_feature
r_static
r_int
r_int
id|se401_get_feature
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
r_int
id|selector
)paren
(brace
multiline_comment|/* For &squot;set&squot; the selecetor should be in index, not sure if the spec is&n;&t;   wrong here to....&n;&t; */
r_int
r_char
id|cp
(braket
l_int|2
)braket
suffix:semicolon
id|usb_control_msg
(paren
id|se401-&gt;dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|se401-&gt;dev
comma
l_int|0
)paren
comma
id|SE401_REQ_GET_EXT_FEATURE
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
l_int|0
comma
id|selector
comma
id|cp
comma
l_int|2
comma
id|HZ
)paren
suffix:semicolon
r_return
id|cp
(braket
l_int|0
)braket
op_plus
id|cp
(braket
l_int|1
)braket
op_star
l_int|256
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * Camera control&n; *&n; ***************************************************************************/
DECL|function|se401_send_pict
r_static
r_int
id|se401_send_pict
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_TITL
comma
id|se401-&gt;expose_l
)paren
suffix:semicolon
multiline_comment|/* integration time low */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_TITM
comma
id|se401-&gt;expose_m
)paren
suffix:semicolon
multiline_comment|/* integration time mid */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_TITU
comma
id|se401-&gt;expose_h
)paren
suffix:semicolon
multiline_comment|/* integration time mid */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_ARLV
comma
id|se401-&gt;resetlevel
)paren
suffix:semicolon
multiline_comment|/* reset level value */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_ARCG
comma
id|se401-&gt;rgain
)paren
suffix:semicolon
multiline_comment|/* red color gain */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_AGCG
comma
id|se401-&gt;ggain
)paren
suffix:semicolon
multiline_comment|/* green color gain */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_ABCG
comma
id|se401-&gt;bgain
)paren
suffix:semicolon
multiline_comment|/* blue color gain */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_set_exposure
r_static
r_void
id|se401_set_exposure
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
id|brightness
)paren
(brace
r_int
id|integration
op_assign
id|brightness
op_lshift
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|flickerless
op_eq
l_int|50
)paren
(brace
id|integration
op_assign
id|integration
op_minus
id|integration
op_mod
l_int|106667
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flickerless
op_eq
l_int|60
)paren
(brace
id|integration
op_assign
id|integration
op_minus
id|integration
op_mod
l_int|88889
suffix:semicolon
)brace
id|se401-&gt;brightness
op_assign
id|integration
op_rshift
l_int|5
suffix:semicolon
id|se401-&gt;expose_h
op_assign
(paren
id|integration
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|se401-&gt;expose_m
op_assign
(paren
id|integration
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|se401-&gt;expose_l
op_assign
id|integration
op_amp
l_int|0xff
suffix:semicolon
)brace
DECL|function|se401_get_pict
r_static
r_int
id|se401_get_pict
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_struct
id|video_picture
op_star
id|p
)paren
(brace
id|p-&gt;brightness
op_assign
id|se401-&gt;brightness
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;enhance
)paren
(brace
id|p-&gt;whiteness
op_assign
l_int|32768
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;whiteness
op_assign
l_int|0
suffix:semicolon
)brace
id|p-&gt;colour
op_assign
l_int|65535
suffix:semicolon
id|p-&gt;contrast
op_assign
l_int|65535
suffix:semicolon
id|p-&gt;hue
op_assign
id|se401-&gt;rgain
op_lshift
l_int|10
suffix:semicolon
id|p-&gt;palette
op_assign
id|se401-&gt;palette
suffix:semicolon
id|p-&gt;depth
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* rgb24 */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_set_pict
r_static
r_int
id|se401_set_pict
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_struct
id|video_picture
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;palette
op_ne
id|VIDEO_PALETTE_RGB24
)paren
r_return
l_int|1
suffix:semicolon
id|se401-&gt;palette
op_assign
id|p-&gt;palette
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;hue
op_ne
id|se401-&gt;hue
)paren
(brace
id|se401-&gt;rgain
op_assign
id|p-&gt;hue
op_rshift
l_int|10
suffix:semicolon
id|se401-&gt;bgain
op_assign
l_int|0x40
op_minus
(paren
id|p-&gt;hue
op_rshift
l_int|10
)paren
suffix:semicolon
id|se401-&gt;hue
op_assign
id|p-&gt;hue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;brightness
op_ne
id|se401-&gt;brightness
)paren
(brace
id|se401_set_exposure
c_func
(paren
id|se401
comma
id|p-&gt;brightness
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;whiteness
op_ge
l_int|32768
)paren
(brace
id|se401-&gt;enhance
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|se401-&gt;enhance
op_assign
l_int|0
suffix:semicolon
)brace
id|se401_send_pict
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401_send_pict
c_func
(paren
id|se401
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;Hyundai have some really nice docs about this and other sensor related&n;&t;stuff on their homepage: www.hei.co.kr&n;*/
DECL|function|se401_auto_resetlevel
r_static
r_void
id|se401_auto_resetlevel
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_int
r_int
id|ahrc
comma
id|alrc
suffix:semicolon
r_int
id|oldreset
op_assign
id|se401-&gt;resetlevel
suffix:semicolon
multiline_comment|/* For some reason this normally read-only register doesn&squot;t get reset&n;&t;   to zero after reading them just once...&n;&t; */
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_HIREFNOH
)paren
suffix:semicolon
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_HIREFNOL
)paren
suffix:semicolon
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_LOREFNOH
)paren
suffix:semicolon
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_LOREFNOL
)paren
suffix:semicolon
id|ahrc
op_assign
l_int|256
op_star
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_HIREFNOH
)paren
op_plus
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_HIREFNOL
)paren
suffix:semicolon
id|alrc
op_assign
l_int|256
op_star
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_LOREFNOH
)paren
op_plus
id|se401_get_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_LOREFNOL
)paren
suffix:semicolon
multiline_comment|/* Not an exact science, but it seems to work pretty well... */
r_if
c_cond
(paren
id|alrc
OG
l_int|10
)paren
(brace
r_while
c_loop
(paren
id|alrc
op_ge
l_int|10
op_logical_and
id|se401-&gt;resetlevel
OL
l_int|63
)paren
(brace
id|se401-&gt;resetlevel
op_increment
suffix:semicolon
id|alrc
op_div_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ahrc
OG
l_int|20
)paren
(brace
r_while
c_loop
(paren
id|ahrc
op_ge
l_int|20
op_logical_and
id|se401-&gt;resetlevel
OG
l_int|0
)paren
(brace
id|se401-&gt;resetlevel
op_decrement
suffix:semicolon
id|ahrc
op_div_assign
l_int|2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|se401-&gt;resetlevel
op_ne
id|oldreset
)paren
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_ARLV
comma
id|se401-&gt;resetlevel
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* irq handler for snapshot button */
DECL|function|se401_button_irq
r_static
r_void
id|se401_button_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_se401
op_star
id|se401
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;dev
)paren
(brace
id|info
c_func
(paren
l_string|&quot;ohoh: device vapourished&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|urb-&gt;actual_length
op_ge
l_int|2
op_logical_and
op_logical_neg
id|urb-&gt;status
)paren
(brace
r_if
c_cond
(paren
id|se401-&gt;button
)paren
id|se401-&gt;buttonpressed
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|se401_video_irq
r_static
r_void
id|se401_video_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|usb_se401
op_star
id|se401
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
id|length
op_assign
id|urb-&gt;actual_length
suffix:semicolon
multiline_comment|/* ohoh... */
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;streaming
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;dev
)paren
(brace
id|info
(paren
l_string|&quot;ohoh: device vapourished&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* 0 sized packets happen if we are to fast, but sometimes the camera&n;&t;   keeps sending them forever...&n;&t; */
r_if
c_cond
(paren
id|length
op_logical_and
op_logical_neg
id|urb-&gt;status
)paren
(brace
id|se401-&gt;nullpackets
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_next
)braket
dot
id|state
)paren
(brace
r_case
id|BUFFER_READY
suffix:colon
r_case
id|BUFFER_BUSY
suffix:colon
(brace
id|se401-&gt;dropped
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|BUFFER_UNUSED
suffix:colon
(brace
id|memcpy
c_func
(paren
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_next
)braket
dot
id|data
comma
(paren
r_int
r_char
op_star
)paren
id|urb-&gt;transfer_buffer
comma
id|length
)paren
suffix:semicolon
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_next
)braket
dot
id|state
op_assign
id|BUFFER_READY
suffix:semicolon
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_next
)braket
dot
id|offset
op_assign
id|se401-&gt;bayeroffset
suffix:semicolon
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_next
)braket
dot
id|length
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
suffix:semicolon
)brace
id|se401-&gt;scratch_overflow
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;scratch_next
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;scratch_next
op_ge
id|SE401_NUMSCRATCH
)paren
id|se401-&gt;scratch_next
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|se401-&gt;bayeroffset
op_add_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;bayeroffset
op_ge
id|se401-&gt;cheight
op_star
id|se401-&gt;cwidth
)paren
(brace
id|se401-&gt;bayeroffset
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|se401-&gt;nullpackets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;nullpackets
OG
id|SE401_MAX_NULLPACKETS
)paren
(brace
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Resubmit urb for new data */
id|urb-&gt;status
op_assign
l_int|0
suffix:semicolon
id|urb-&gt;dev
op_assign
id|se401-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_KERNEL
)paren
)paren
(brace
id|info
c_func
(paren
l_string|&quot;urb burned down&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|se401_send_size
r_static
r_void
id|se401_send_size
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|mode
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* No compression */
r_int
id|sendheight
op_assign
id|height
suffix:semicolon
r_int
id|sendwidth
op_assign
id|width
suffix:semicolon
multiline_comment|/* JangGu compression can only be used with the camera supported sizes,&n;&t;   but bayer seems to work with any size that fits on the sensor.&n;&t;   We check if we can use compression with the current size with either&n;&t;   4 or 16 times subcapturing, if not we use uncompressed bayer data&n;&t;   but this will result in cutouts of the maximum size....&n;&t; */
r_while
c_loop
(paren
id|i
OL
id|se401-&gt;sizes
op_logical_and
op_logical_neg
(paren
id|se401-&gt;width
(braket
id|i
)braket
op_eq
id|width
op_logical_and
id|se401-&gt;height
(braket
id|i
)braket
op_eq
id|height
)paren
)paren
id|i
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|se401-&gt;sizes
)paren
(brace
r_if
c_cond
(paren
id|se401-&gt;width
(braket
id|i
)braket
op_eq
id|width
op_star
l_int|2
op_logical_and
id|se401-&gt;height
(braket
id|i
)braket
op_eq
id|height
op_star
l_int|2
)paren
(brace
id|sendheight
op_assign
id|se401-&gt;height
(braket
id|i
)braket
suffix:semicolon
id|sendwidth
op_assign
id|se401-&gt;width
(braket
id|i
)braket
suffix:semicolon
id|mode
op_assign
l_int|0x40
suffix:semicolon
)brace
r_if
c_cond
(paren
id|se401-&gt;width
(braket
id|i
)braket
op_eq
id|width
op_star
l_int|4
op_logical_and
id|se401-&gt;height
(braket
id|i
)braket
op_eq
id|height
op_star
l_int|4
)paren
(brace
id|sendheight
op_assign
id|se401-&gt;height
(braket
id|i
)braket
suffix:semicolon
id|sendwidth
op_assign
id|se401-&gt;width
(braket
id|i
)braket
suffix:semicolon
id|mode
op_assign
l_int|0x42
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_SET_WIDTH
comma
id|sendwidth
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_SET_HEIGHT
comma
id|sendheight
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_set_feature
c_func
(paren
id|se401
comma
id|SE401_OPERATINGMODE
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
l_int|0x03
)paren
(brace
id|se401-&gt;format
op_assign
id|FMT_BAYER
suffix:semicolon
)brace
r_else
(brace
id|se401-&gt;format
op_assign
id|FMT_JANGGU
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;In this function se401_send_pict is called several times,&n;&t;for some reason (depending on the state of the sensor and the phase of&n;&t;the moon :) doing this only in either place doesn&squot;t always work...&n;*/
DECL|function|se401_start_stream
r_static
r_int
id|se401_start_stream
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|se401-&gt;streaming
op_assign
l_int|1
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_CAMERA_POWER
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_LED_CONTROL
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Set picture settings */
id|se401_set_feature
c_func
(paren
id|se401
comma
id|HV7131_REG_MODE_B
comma
l_int|0x05
)paren
suffix:semicolon
multiline_comment|/*windowed + pix intg */
id|se401_send_pict
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401_send_size
c_func
(paren
id|se401
comma
id|se401-&gt;cwidth
comma
id|se401-&gt;cheight
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_START_CONTINUOUS_CAPTURE
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Do some memory allocation */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMFRAMES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|se401-&gt;frame
(braket
id|i
)braket
dot
id|data
op_assign
id|se401-&gt;fbuf
op_plus
id|i
op_star
id|se401-&gt;maxframesize
suffix:semicolon
id|se401-&gt;frame
(braket
id|i
)braket
dot
id|curpix
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSBUF
suffix:semicolon
id|i
op_increment
)paren
(brace
id|se401-&gt;sbuf
(braket
id|i
)braket
dot
id|data
op_assign
id|kmalloc
c_func
(paren
id|SE401_PACKETSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
id|se401-&gt;bayeroffset
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;scratch_next
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;scratch_use
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;scratch_overflow
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSCRATCH
suffix:semicolon
id|i
op_increment
)paren
(brace
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|data
op_assign
id|kmalloc
c_func
(paren
id|SE401_PACKETSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|state
op_assign
id|BUFFER_UNUSED
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSBUF
suffix:semicolon
id|i
op_increment
)paren
(brace
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|FILL_BULK_URB
c_func
(paren
id|urb
comma
id|se401-&gt;dev
comma
id|usb_rcvbulkpipe
c_func
(paren
id|se401-&gt;dev
comma
id|SE401_VIDEO_ENDPOINT
)paren
comma
id|se401-&gt;sbuf
(braket
id|i
)braket
dot
id|data
comma
id|SE401_PACKETSIZE
comma
id|se401_video_irq
comma
id|se401
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_or_assign
id|USB_QUEUE_BULK
suffix:semicolon
id|se401-&gt;urb
(braket
id|i
)braket
op_assign
id|urb
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|se401-&gt;urb
(braket
id|i
)braket
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|err
c_func
(paren
l_string|&quot;urb burned down&quot;
)paren
suffix:semicolon
)brace
)brace
id|se401-&gt;framecount
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_stop_stream
r_static
r_int
id|se401_stop_stream
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;streaming
op_logical_or
op_logical_neg
id|se401-&gt;dev
)paren
r_return
l_int|1
suffix:semicolon
id|se401-&gt;streaming
op_assign
l_int|0
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_STOP_CONTINUOUS_CAPTURE
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_LED_CONTROL
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_CAMERA_POWER
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSBUF
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|se401-&gt;urb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|se401-&gt;sbuf
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSCRATCH
suffix:semicolon
id|i
op_increment
)paren
(brace
id|kfree
c_func
(paren
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|data
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_set_size
r_static
r_int
id|se401_set_size
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
id|width
comma
r_int
id|height
)paren
(brace
r_int
id|wasstreaming
op_assign
id|se401-&gt;streaming
suffix:semicolon
multiline_comment|/* Check to see if we need to change */
r_if
c_cond
(paren
id|se401-&gt;cwidth
op_eq
id|width
op_logical_and
id|se401-&gt;cheight
op_eq
id|height
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Check for a valid mode */
r_if
c_cond
(paren
op_logical_neg
id|width
op_logical_or
op_logical_neg
id|height
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|width
op_amp
l_int|1
)paren
op_logical_or
(paren
id|height
op_amp
l_int|1
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
id|se401-&gt;width
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|height
OG
id|se401-&gt;height
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Stop a current stream and start it again at the new size */
r_if
c_cond
(paren
id|wasstreaming
)paren
id|se401_stop_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401-&gt;cwidth
op_assign
id|width
suffix:semicolon
id|se401-&gt;cheight
op_assign
id|height
suffix:semicolon
r_if
c_cond
(paren
id|wasstreaming
)paren
id|se401_start_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * Video Decoding&n; *&n; ***************************************************************************/
multiline_comment|/*&n;&t;This shouldn&squot;t really be done in a v4l driver....&n;&t;But it does make the image look a lot more usable.&n;&t;Basicly it lifts the dark pixels more than the light pixels.&n;*/
DECL|function|enhance_picture
r_static
r_inline
r_void
id|enhance_picture
c_func
(paren
r_int
r_char
op_star
id|frame
comma
r_int
id|len
)paren
(brace
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
op_star
id|frame
op_increment
op_assign
(paren
(paren
(paren
op_star
id|frame
op_xor
l_int|255
)paren
op_star
(paren
op_star
id|frame
op_xor
l_int|255
)paren
)paren
op_div
l_int|255
)paren
op_xor
l_int|255
suffix:semicolon
)brace
)brace
DECL|function|decode_JangGu_integrate
r_static
r_inline
r_void
id|decode_JangGu_integrate
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
id|data
)paren
(brace
r_struct
id|se401_frame
op_star
id|frame
op_assign
op_amp
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
suffix:semicolon
r_int
id|linelength
op_assign
id|se401-&gt;cwidth
op_star
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|frame-&gt;curlinepix
op_ge
id|linelength
)paren
(brace
id|frame-&gt;curlinepix
op_assign
l_int|0
suffix:semicolon
id|frame-&gt;curline
op_add_assign
id|linelength
suffix:semicolon
)brace
multiline_comment|/* First three are absolute, all others relative.&n;&t; * Format is rgb from right to left (mirrorred image), &n;&t; * we flip it to get bgr from left to right. */
r_if
c_cond
(paren
id|frame-&gt;curlinepix
OL
l_int|3
)paren
(brace
op_star
(paren
id|frame-&gt;curline
op_minus
id|frame-&gt;curlinepix
)paren
op_assign
l_int|1
op_plus
id|data
op_star
l_int|4
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|frame-&gt;curline
op_minus
id|frame-&gt;curlinepix
)paren
op_assign
op_star
(paren
id|frame-&gt;curline
op_minus
id|frame-&gt;curlinepix
op_plus
l_int|3
)paren
op_plus
id|data
op_star
l_int|4
suffix:semicolon
)brace
id|frame-&gt;curlinepix
op_increment
suffix:semicolon
)brace
DECL|function|decode_JangGu_vlc
r_static
r_inline
r_void
id|decode_JangGu_vlc
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
r_char
op_star
id|data
comma
r_int
id|bit_exp
comma
r_int
id|packetlength
)paren
(brace
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|vlc_cod
op_assign
l_int|0
suffix:semicolon
r_int
id|vlc_size
op_assign
l_int|0
suffix:semicolon
r_int
id|vlc_data
op_assign
l_int|0
suffix:semicolon
r_int
id|bit_cur
suffix:semicolon
r_int
id|bit
suffix:semicolon
id|data
op_add_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|pos
OL
id|packetlength
)paren
(brace
id|bit_cur
op_assign
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|bit_cur
op_logical_and
id|bit_exp
)paren
(brace
id|bit
op_assign
(paren
(paren
op_star
id|data
)paren
op_rshift
(paren
id|bit_cur
op_minus
l_int|1
)paren
)paren
op_amp
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vlc_cod
)paren
(brace
r_if
c_cond
(paren
id|bit
)paren
(brace
id|vlc_size
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|vlc_size
)paren
(brace
id|decode_JangGu_integrate
c_func
(paren
id|se401
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|vlc_cod
op_assign
l_int|2
suffix:semicolon
id|vlc_data
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|vlc_cod
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bit
)paren
id|vlc_data
op_assign
op_minus
(paren
l_int|1
op_lshift
id|vlc_size
)paren
op_plus
l_int|1
suffix:semicolon
id|vlc_cod
op_decrement
suffix:semicolon
)brace
id|vlc_size
op_decrement
suffix:semicolon
id|vlc_data
op_add_assign
id|bit
op_lshift
id|vlc_size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vlc_size
)paren
(brace
id|decode_JangGu_integrate
c_func
(paren
id|se401
comma
id|vlc_data
)paren
suffix:semicolon
id|vlc_cod
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|bit_cur
op_decrement
suffix:semicolon
id|bit_exp
op_decrement
suffix:semicolon
)brace
id|pos
op_increment
suffix:semicolon
id|data
op_increment
suffix:semicolon
)brace
)brace
DECL|function|decode_JangGu
r_static
r_inline
r_void
id|decode_JangGu
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_struct
id|se401_scratch
op_star
id|buffer
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|buffer-&gt;data
suffix:semicolon
r_int
id|len
op_assign
id|buffer-&gt;length
suffix:semicolon
r_int
id|bit_exp
op_assign
l_int|0
comma
id|pix_exp
op_assign
l_int|0
comma
id|frameinfo
op_assign
l_int|0
comma
id|packetlength
op_assign
l_int|0
comma
id|size
suffix:semicolon
r_int
id|datapos
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* New image? */
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
)paren
(brace
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curlinepix
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curline
op_assign
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|data
op_plus
id|se401-&gt;cwidth
op_star
l_int|3
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|grabstate
op_eq
id|FRAME_READY
)paren
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|grabstate
op_assign
id|FRAME_GRABBING
suffix:semicolon
id|se401-&gt;vlcdatapos
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|datapos
OL
id|len
)paren
(brace
id|size
op_assign
l_int|1024
op_minus
id|se401-&gt;vlcdatapos
suffix:semicolon
r_if
c_cond
(paren
id|size
op_plus
id|datapos
OG
id|len
)paren
id|size
op_assign
id|len
op_minus
id|datapos
suffix:semicolon
id|memcpy
c_func
(paren
id|se401-&gt;vlcdata
op_plus
id|se401-&gt;vlcdatapos
comma
id|data
op_plus
id|datapos
comma
id|size
)paren
suffix:semicolon
id|se401-&gt;vlcdatapos
op_add_assign
id|size
suffix:semicolon
id|packetlength
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;vlcdatapos
op_ge
l_int|4
)paren
(brace
id|bit_exp
op_assign
id|se401-&gt;vlcdata
(braket
l_int|3
)braket
op_plus
(paren
id|se401-&gt;vlcdata
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|pix_exp
op_assign
id|se401-&gt;vlcdata
(braket
l_int|1
)braket
op_plus
(paren
(paren
id|se401-&gt;vlcdata
(braket
l_int|0
)braket
op_amp
l_int|0x3f
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|frameinfo
op_assign
id|se401-&gt;vlcdata
(braket
l_int|0
)braket
op_amp
l_int|0xc0
suffix:semicolon
id|packetlength
op_assign
(paren
(paren
id|bit_exp
op_plus
l_int|47
)paren
op_rshift
l_int|4
)paren
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|packetlength
OG
l_int|1024
)paren
(brace
id|se401-&gt;vlcdatapos
op_assign
l_int|0
suffix:semicolon
id|datapos
op_assign
id|len
suffix:semicolon
id|packetlength
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;error
op_increment
suffix:semicolon
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|packetlength
op_logical_and
id|se401-&gt;vlcdatapos
op_ge
id|packetlength
)paren
(brace
id|decode_JangGu_vlc
c_func
(paren
id|se401
comma
id|se401-&gt;vlcdata
comma
id|bit_exp
comma
id|packetlength
)paren
suffix:semicolon
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
op_add_assign
id|pix_exp
op_star
l_int|3
suffix:semicolon
id|datapos
op_add_assign
id|size
op_minus
(paren
id|se401-&gt;vlcdatapos
op_minus
id|packetlength
)paren
suffix:semicolon
id|se401-&gt;vlcdatapos
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
op_ge
id|se401-&gt;cwidth
op_star
id|se401-&gt;cheight
op_star
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
op_eq
id|se401-&gt;cwidth
op_star
id|se401-&gt;cheight
op_star
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|grabstate
op_eq
id|FRAME_GRABBING
)paren
(brace
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|grabstate
op_assign
id|FRAME_DONE
suffix:semicolon
id|se401-&gt;framecount
op_increment
suffix:semicolon
id|se401-&gt;readcount
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
(paren
id|se401-&gt;curframe
op_plus
l_int|1
)paren
op_amp
(paren
id|SE401_NUMFRAMES
op_minus
l_int|1
)paren
)braket
dot
id|grabstate
op_eq
id|FRAME_READY
)paren
(brace
id|se401-&gt;curframe
op_assign
(paren
id|se401-&gt;curframe
op_plus
l_int|1
)paren
op_amp
(paren
id|SE401_NUMFRAMES
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|se401-&gt;error
op_increment
suffix:semicolon
)brace
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
dot
id|curpix
op_assign
l_int|0
suffix:semicolon
id|datapos
op_assign
id|len
suffix:semicolon
)brace
)brace
r_else
(brace
id|datapos
op_add_assign
id|size
suffix:semicolon
)brace
)brace
)brace
DECL|function|decode_bayer
r_static
r_inline
r_void
id|decode_bayer
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_struct
id|se401_scratch
op_star
id|buffer
)paren
(brace
r_int
r_char
op_star
id|data
op_assign
id|buffer-&gt;data
suffix:semicolon
r_int
id|len
op_assign
id|buffer-&gt;length
suffix:semicolon
r_int
id|offset
op_assign
id|buffer-&gt;offset
suffix:semicolon
r_int
id|datasize
op_assign
id|se401-&gt;cwidth
op_star
id|se401-&gt;cheight
suffix:semicolon
r_struct
id|se401_frame
op_star
id|frame
op_assign
op_amp
id|se401-&gt;frame
(braket
id|se401-&gt;curframe
)braket
suffix:semicolon
r_int
r_char
op_star
id|framedata
op_assign
id|frame-&gt;data
comma
op_star
id|curline
comma
op_star
id|nextline
suffix:semicolon
r_int
id|width
op_assign
id|se401-&gt;cwidth
suffix:semicolon
r_int
id|blineoffset
op_assign
l_int|0
comma
id|bline
suffix:semicolon
r_int
id|linelength
op_assign
id|width
op_star
l_int|3
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|frame-&gt;curpix
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|frame-&gt;grabstate
op_eq
id|FRAME_READY
)paren
(brace
id|frame-&gt;grabstate
op_assign
id|FRAME_GRABBING
suffix:semicolon
)brace
id|frame-&gt;curline
op_assign
id|framedata
op_plus
id|linelength
suffix:semicolon
id|frame-&gt;curlinepix
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
op_ne
id|frame-&gt;curpix
)paren
(brace
multiline_comment|/* Regard frame as lost :( */
id|frame-&gt;curpix
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;error
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Check if we have to much data */
r_if
c_cond
(paren
id|frame-&gt;curpix
op_plus
id|len
OG
id|datasize
)paren
(brace
id|len
op_assign
id|datasize
op_minus
id|frame-&gt;curpix
suffix:semicolon
)brace
r_if
c_cond
(paren
id|se401-&gt;cheight
op_mod
l_int|4
)paren
id|blineoffset
op_assign
l_int|1
suffix:semicolon
id|bline
op_assign
id|frame-&gt;curpix
op_div
id|se401-&gt;cwidth
op_plus
id|blineoffset
suffix:semicolon
id|curline
op_assign
id|frame-&gt;curline
suffix:semicolon
id|nextline
op_assign
id|curline
op_plus
id|linelength
suffix:semicolon
r_if
c_cond
(paren
id|nextline
op_ge
id|framedata
op_plus
id|datasize
op_star
l_int|3
)paren
id|nextline
op_assign
id|curline
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
id|frame-&gt;curlinepix
op_ge
id|width
)paren
(brace
id|frame-&gt;curlinepix
op_sub_assign
id|width
suffix:semicolon
id|bline
op_assign
id|frame-&gt;curpix
op_div
id|width
op_plus
id|blineoffset
suffix:semicolon
id|curline
op_add_assign
id|linelength
op_star
l_int|2
suffix:semicolon
id|nextline
op_add_assign
id|linelength
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|curline
op_ge
id|framedata
op_plus
id|datasize
op_star
l_int|3
)paren
(brace
id|frame-&gt;curlinepix
op_increment
suffix:semicolon
id|curline
op_sub_assign
l_int|3
suffix:semicolon
id|nextline
op_sub_assign
l_int|3
suffix:semicolon
id|len
op_decrement
suffix:semicolon
id|data
op_increment
suffix:semicolon
id|frame-&gt;curpix
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nextline
op_ge
id|framedata
op_plus
id|datasize
op_star
l_int|3
)paren
id|nextline
op_assign
id|curline
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bline
op_amp
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|frame-&gt;curlinepix
op_amp
l_int|1
)paren
)paren
(brace
op_star
(paren
id|curline
op_plus
l_int|2
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|curline
op_minus
l_int|1
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|nextline
op_plus
l_int|2
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|nextline
op_minus
l_int|1
)paren
op_assign
op_star
id|data
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|curline
op_plus
l_int|1
)paren
op_assign
(paren
op_star
(paren
id|curline
op_plus
l_int|1
)paren
op_plus
op_star
id|data
)paren
op_div
l_int|2
suffix:semicolon
op_star
(paren
id|curline
op_minus
l_int|2
)paren
op_assign
(paren
op_star
(paren
id|curline
op_minus
l_int|2
)paren
op_plus
op_star
id|data
)paren
op_div
l_int|2
suffix:semicolon
op_star
(paren
id|nextline
op_plus
l_int|1
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|nextline
op_minus
l_int|2
)paren
op_assign
op_star
id|data
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|frame-&gt;curlinepix
op_amp
l_int|1
)paren
)paren
(brace
op_star
(paren
id|curline
op_plus
l_int|1
)paren
op_assign
(paren
op_star
(paren
id|curline
op_plus
l_int|1
)paren
op_plus
op_star
id|data
)paren
op_div
l_int|2
suffix:semicolon
op_star
(paren
id|curline
op_minus
l_int|2
)paren
op_assign
(paren
op_star
(paren
id|curline
op_minus
l_int|2
)paren
op_plus
op_star
id|data
)paren
op_div
l_int|2
suffix:semicolon
op_star
(paren
id|nextline
op_plus
l_int|1
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|nextline
op_minus
l_int|2
)paren
op_assign
op_star
id|data
suffix:semicolon
)brace
r_else
(brace
op_star
id|curline
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|curline
op_minus
l_int|3
)paren
op_assign
op_star
id|data
suffix:semicolon
op_star
id|nextline
op_assign
op_star
id|data
suffix:semicolon
op_star
(paren
id|nextline
op_minus
l_int|3
)paren
op_assign
op_star
id|data
suffix:semicolon
)brace
)brace
id|frame-&gt;curlinepix
op_increment
suffix:semicolon
id|curline
op_sub_assign
l_int|3
suffix:semicolon
id|nextline
op_sub_assign
l_int|3
suffix:semicolon
id|len
op_decrement
suffix:semicolon
id|data
op_increment
suffix:semicolon
id|frame-&gt;curpix
op_increment
suffix:semicolon
)brace
id|frame-&gt;curline
op_assign
id|curline
suffix:semicolon
r_if
c_cond
(paren
id|frame-&gt;curpix
op_ge
id|datasize
)paren
(brace
multiline_comment|/* Fix the top line */
id|framedata
op_add_assign
id|linelength
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|linelength
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
op_decrement
id|framedata
op_assign
op_star
(paren
id|framedata
op_plus
id|linelength
)paren
suffix:semicolon
)brace
multiline_comment|/* Fix the left side (green is already present) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|se401-&gt;cheight
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|framedata
op_assign
op_star
(paren
id|framedata
op_plus
l_int|3
)paren
suffix:semicolon
op_star
(paren
id|framedata
op_plus
l_int|1
)paren
op_assign
op_star
(paren
id|framedata
op_plus
l_int|4
)paren
suffix:semicolon
op_star
(paren
id|framedata
op_plus
l_int|2
)paren
op_assign
op_star
(paren
id|framedata
op_plus
l_int|5
)paren
suffix:semicolon
id|framedata
op_add_assign
id|linelength
suffix:semicolon
)brace
id|frame-&gt;curpix
op_assign
l_int|0
suffix:semicolon
id|frame-&gt;grabstate
op_assign
id|FRAME_DONE
suffix:semicolon
id|se401-&gt;framecount
op_increment
suffix:semicolon
id|se401-&gt;readcount
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
(paren
id|se401-&gt;curframe
op_plus
l_int|1
)paren
op_amp
(paren
id|SE401_NUMFRAMES
op_minus
l_int|1
)paren
)braket
dot
id|grabstate
op_eq
id|FRAME_READY
)paren
(brace
id|se401-&gt;curframe
op_assign
(paren
id|se401-&gt;curframe
op_plus
l_int|1
)paren
op_amp
(paren
id|SE401_NUMFRAMES
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|se401_newframe
r_static
r_int
id|se401_newframe
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
comma
r_int
id|framenr
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|errors
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|se401-&gt;streaming
op_logical_and
(paren
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|grabstate
op_eq
id|FRAME_READY
op_logical_or
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|grabstate
op_eq
id|FRAME_GRABBING
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|curpix
)paren
(brace
id|errors
op_increment
suffix:semicolon
)brace
id|wait_interruptible
c_func
(paren
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
dot
id|state
op_ne
id|BUFFER_READY
comma
op_amp
id|se401-&gt;wq
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;nullpackets
OG
id|SE401_MAX_NULLPACKETS
)paren
(brace
id|se401-&gt;nullpackets
op_assign
l_int|0
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;to many null length packets, restarting capture&quot;
)paren
suffix:semicolon
id|se401_stop_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401_start_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
dot
id|state
op_ne
id|BUFFER_READY
)paren
(brace
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|grabstate
op_assign
id|FRAME_ERROR
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
dot
id|state
op_assign
id|BUFFER_BUSY
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;format
op_eq
id|FMT_JANGGU
)paren
(brace
id|decode_JangGu
c_func
(paren
id|se401
comma
op_amp
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|decode_bayer
c_func
(paren
id|se401
comma
op_amp
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
)paren
suffix:semicolon
)brace
id|se401-&gt;scratch
(braket
id|se401-&gt;scratch_use
)braket
dot
id|state
op_assign
id|BUFFER_UNUSED
suffix:semicolon
id|se401-&gt;scratch_use
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;scratch_use
op_ge
id|SE401_NUMSCRATCH
)paren
id|se401-&gt;scratch_use
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|errors
OG
id|SE401_MAX_ERRORS
)paren
(brace
id|errors
op_assign
l_int|0
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;to much errors, restarting capture&quot;
)paren
suffix:semicolon
id|se401_stop_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401_start_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|grabstate
op_eq
id|FRAME_DONE
)paren
r_if
c_cond
(paren
id|se401-&gt;enhance
)paren
id|enhance_picture
c_func
(paren
id|se401-&gt;frame
(braket
id|framenr
)braket
dot
id|data
comma
id|se401-&gt;cheight
op_star
id|se401-&gt;cwidth
op_star
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * Video4Linux&n; *&n; ***************************************************************************/
DECL|function|se401_open
r_static
r_int
id|se401_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|video_device
op_star
id|dev
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|dev
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;user
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|se401-&gt;user
op_assign
l_int|1
suffix:semicolon
id|se401-&gt;fbuf
op_assign
id|rvmalloc
c_func
(paren
id|se401-&gt;maxframesize
op_star
id|SE401_NUMFRAMES
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;fbuf
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
(brace
id|se401-&gt;user
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|file-&gt;private_data
op_assign
id|dev
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|se401_close
r_static
r_int
id|se401_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|video_device
op_star
id|dev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|dev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMFRAMES
suffix:semicolon
id|i
op_increment
)paren
id|se401-&gt;frame
(braket
id|i
)braket
dot
id|grabstate
op_assign
id|FRAME_UNUSED
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;streaming
)paren
id|se401_stop_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
id|rvfree
c_func
(paren
id|se401-&gt;fbuf
comma
id|se401-&gt;maxframesize
op_star
id|SE401_NUMFRAMES
)paren
suffix:semicolon
id|se401-&gt;user
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;removed
)paren
(brace
id|kfree
c_func
(paren
id|se401-&gt;width
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|se401-&gt;height
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|se401
)paren
suffix:semicolon
id|se401
op_assign
l_int|NULL
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;device unregistered&quot;
)paren
suffix:semicolon
)brace
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_do_ioctl
r_static
r_int
id|se401_do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|video_device
op_star
id|vdev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|vdev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;dev
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
op_star
id|b
op_assign
id|arg
suffix:semicolon
id|strcpy
c_func
(paren
id|b-&gt;name
comma
id|se401-&gt;camera_name
)paren
suffix:semicolon
id|b-&gt;type
op_assign
id|VID_TYPE_CAPTURE
suffix:semicolon
id|b-&gt;channels
op_assign
l_int|1
suffix:semicolon
id|b-&gt;audios
op_assign
l_int|0
suffix:semicolon
id|b-&gt;maxwidth
op_assign
id|se401-&gt;width
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
suffix:semicolon
id|b-&gt;maxheight
op_assign
id|se401-&gt;height
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
suffix:semicolon
id|b-&gt;minwidth
op_assign
id|se401-&gt;width
(braket
l_int|0
)braket
suffix:semicolon
id|b-&gt;minheight
op_assign
id|se401-&gt;height
(braket
l_int|0
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGCHAN
suffix:colon
(brace
r_struct
id|video_channel
op_star
id|v
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|v-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|v-&gt;tuners
op_assign
l_int|0
suffix:semicolon
id|v-&gt;type
op_assign
id|VIDEO_TYPE_CAMERA
suffix:semicolon
id|strcpy
c_func
(paren
id|v-&gt;name
comma
l_string|&quot;Camera&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSCHAN
suffix:colon
(brace
r_struct
id|video_channel
op_star
id|v
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGPICT
suffix:colon
(brace
r_struct
id|video_picture
op_star
id|p
op_assign
id|arg
suffix:semicolon
id|se401_get_pict
c_func
(paren
id|se401
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSPICT
suffix:colon
(brace
r_struct
id|video_picture
op_star
id|p
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|se401_set_pict
c_func
(paren
id|se401
comma
id|p
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSWIN
suffix:colon
(brace
r_struct
id|video_window
op_star
id|vw
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|vw-&gt;flags
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vw-&gt;clipcount
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|se401_set_size
c_func
(paren
id|se401
comma
id|vw-&gt;width
comma
id|vw-&gt;height
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGWIN
suffix:colon
(brace
r_struct
id|video_window
op_star
id|vw
op_assign
id|arg
suffix:semicolon
id|vw-&gt;x
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME */
id|vw-&gt;y
op_assign
l_int|0
suffix:semicolon
id|vw-&gt;chromakey
op_assign
l_int|0
suffix:semicolon
id|vw-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|vw-&gt;clipcount
op_assign
l_int|0
suffix:semicolon
id|vw-&gt;width
op_assign
id|se401-&gt;cwidth
suffix:semicolon
id|vw-&gt;height
op_assign
id|se401-&gt;cheight
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGMBUF
suffix:colon
(brace
r_struct
id|video_mbuf
op_star
id|vm
op_assign
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|vm
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|vm
)paren
)paren
suffix:semicolon
id|vm-&gt;size
op_assign
id|SE401_NUMFRAMES
op_star
id|se401-&gt;maxframesize
suffix:semicolon
id|vm-&gt;frames
op_assign
id|SE401_NUMFRAMES
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMFRAMES
suffix:semicolon
id|i
op_increment
)paren
id|vm-&gt;offsets
(braket
id|i
)braket
op_assign
id|se401-&gt;maxframesize
op_star
id|i
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCMCAPTURE
suffix:colon
(brace
r_struct
id|video_mmap
op_star
id|vm
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|vm-&gt;format
op_ne
id|VIDEO_PALETTE_RGB24
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vm-&gt;frame
op_ge
id|SE401_NUMFRAMES
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
id|vm-&gt;frame
)braket
dot
id|grabstate
op_ne
id|FRAME_UNUSED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* Is this according to the v4l spec??? */
r_if
c_cond
(paren
id|se401_set_size
c_func
(paren
id|se401
comma
id|vm-&gt;width
comma
id|vm-&gt;height
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|se401-&gt;frame
(braket
id|vm-&gt;frame
)braket
dot
id|grabstate
op_assign
id|FRAME_READY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;streaming
)paren
id|se401_start_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
multiline_comment|/* Set the picture properties */
r_if
c_cond
(paren
id|se401-&gt;framecount
op_eq
l_int|0
)paren
id|se401_send_pict
c_func
(paren
id|se401
)paren
suffix:semicolon
multiline_comment|/* Calibrate the reset level after a few frames. */
r_if
c_cond
(paren
id|se401-&gt;framecount
op_mod
l_int|20
op_eq
l_int|1
)paren
id|se401_auto_resetlevel
c_func
(paren
id|se401
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSYNC
suffix:colon
(brace
r_int
op_star
id|frame
op_assign
id|arg
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|frame
OL
l_int|0
op_logical_or
op_star
id|frame
op_ge
id|SE401_NUMFRAMES
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ret
op_assign
id|se401_newframe
c_func
(paren
id|se401
comma
op_star
id|frame
)paren
suffix:semicolon
id|se401-&gt;frame
(braket
op_star
id|frame
)braket
dot
id|grabstate
op_assign
id|FRAME_UNUSED
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_case
id|VIDIOCGFBUF
suffix:colon
(brace
r_struct
id|video_buffer
op_star
id|vb
op_assign
id|arg
suffix:semicolon
id|memset
c_func
(paren
id|vb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|vb
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCKEY
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCCAPTURE
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSFBUF
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGTUNER
suffix:colon
r_case
id|VIDIOCSTUNER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGFREQ
suffix:colon
r_case
id|VIDIOCSFREQ
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGAUDIO
suffix:colon
r_case
id|VIDIOCSAUDIO
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
multiline_comment|/* end switch */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se401_ioctl
r_static
r_int
id|se401_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|video_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|se401_do_ioctl
)paren
suffix:semicolon
)brace
DECL|function|se401_read
r_static
r_int
id|se401_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|realcount
op_assign
id|count
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|video_device
op_star
id|dev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|realcount
OG
id|se401-&gt;cwidth
op_star
id|se401-&gt;cheight
op_star
l_int|3
)paren
id|realcount
op_assign
id|se401-&gt;cwidth
op_star
id|se401-&gt;cheight
op_star
l_int|3
suffix:semicolon
multiline_comment|/* Shouldn&squot;t happen: */
r_if
c_cond
(paren
id|se401-&gt;frame
(braket
l_int|0
)braket
dot
id|grabstate
op_eq
id|FRAME_GRABBING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|se401-&gt;frame
(braket
l_int|0
)braket
dot
id|grabstate
op_assign
id|FRAME_READY
suffix:semicolon
id|se401-&gt;frame
(braket
l_int|1
)braket
dot
id|grabstate
op_assign
id|FRAME_UNUSED
suffix:semicolon
id|se401-&gt;curframe
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;streaming
)paren
id|se401_start_stream
c_func
(paren
id|se401
)paren
suffix:semicolon
multiline_comment|/* Set the picture properties */
r_if
c_cond
(paren
id|se401-&gt;framecount
op_eq
l_int|0
)paren
id|se401_send_pict
c_func
(paren
id|se401
)paren
suffix:semicolon
multiline_comment|/* Calibrate the reset level after a few frames. */
r_if
c_cond
(paren
id|se401-&gt;framecount
op_mod
l_int|20
op_eq
l_int|1
)paren
id|se401_auto_resetlevel
c_func
(paren
id|se401
)paren
suffix:semicolon
id|ret
op_assign
id|se401_newframe
c_func
(paren
id|se401
comma
l_int|0
)paren
suffix:semicolon
id|se401-&gt;frame
(braket
l_int|0
)braket
dot
id|grabstate
op_assign
id|FRAME_UNUSED
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|se401-&gt;frame
(braket
l_int|0
)braket
dot
id|data
comma
id|realcount
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|realcount
suffix:semicolon
)brace
DECL|function|se401_mmap
r_static
r_int
id|se401_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|video_device
op_star
id|dev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|dev
suffix:semicolon
r_int
r_int
id|start
op_assign
id|vma-&gt;vm_start
suffix:semicolon
r_int
r_int
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_int
r_int
id|page
comma
id|pos
suffix:semicolon
id|down
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|se401-&gt;dev
op_eq
l_int|NULL
)paren
(brace
id|up
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
OG
(paren
(paren
(paren
id|SE401_NUMFRAMES
op_star
id|se401-&gt;maxframesize
)paren
op_plus
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pos
op_assign
(paren
r_int
r_int
)paren
id|se401-&gt;fbuf
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma
comma
id|start
comma
id|page
comma
id|PAGE_SIZE
comma
id|PAGE_SHARED
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pos
op_add_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|PAGE_SIZE
)paren
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
r_else
id|size
op_assign
l_int|0
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|se401_fops
r_static
r_struct
id|file_operations
id|se401_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|se401_open
comma
id|release
suffix:colon
id|se401_close
comma
id|read
suffix:colon
id|se401_read
comma
id|mmap
suffix:colon
id|se401_mmap
comma
id|ioctl
suffix:colon
id|se401_ioctl
comma
id|llseek
suffix:colon
id|no_llseek
comma
)brace
suffix:semicolon
DECL|variable|se401_template
r_static
r_struct
id|video_device
id|se401_template
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|name
suffix:colon
l_string|&quot;se401 USB camera&quot;
comma
id|type
suffix:colon
id|VID_TYPE_CAPTURE
comma
id|hardware
suffix:colon
id|VID_HARDWARE_SE401
comma
id|fops
suffix:colon
op_amp
id|se401_fops
comma
)brace
suffix:semicolon
multiline_comment|/***************************/
DECL|function|se401_init
r_static
r_int
id|se401_init
c_func
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|rc
suffix:semicolon
r_int
r_char
id|cp
(braket
l_int|0x40
)braket
suffix:semicolon
r_char
id|temp
(braket
l_int|200
)braket
suffix:semicolon
multiline_comment|/* led on */
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_LED_CONTROL
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* get camera descriptor */
id|rc
op_assign
id|se401_sndctrl
c_func
(paren
l_int|0
comma
id|se401
comma
id|SE401_REQ_GET_CAMERA_DESCRIPTOR
comma
l_int|0
comma
id|cp
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp
(braket
l_int|1
)braket
op_ne
l_int|0x41
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Wrong descriptor type&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|sprintf
(paren
id|temp
comma
l_string|&quot;ExtraFeatures: %d&quot;
comma
id|cp
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|se401-&gt;sizes
op_assign
id|cp
(braket
l_int|4
)braket
op_plus
id|cp
(braket
l_int|5
)braket
op_star
l_int|256
suffix:semicolon
id|se401-&gt;width
op_assign
id|kmalloc
c_func
(paren
id|se401-&gt;sizes
op_star
r_sizeof
(paren
r_int
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;width
)paren
r_return
l_int|1
suffix:semicolon
id|se401-&gt;height
op_assign
id|kmalloc
c_func
(paren
id|se401-&gt;sizes
op_star
r_sizeof
(paren
r_int
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;height
)paren
(brace
id|kfree
c_func
(paren
id|se401-&gt;width
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|se401-&gt;sizes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|se401-&gt;width
(braket
id|i
)braket
op_assign
id|cp
(braket
l_int|6
op_plus
id|i
op_star
l_int|4
op_plus
l_int|0
)braket
op_plus
id|cp
(braket
l_int|6
op_plus
id|i
op_star
l_int|4
op_plus
l_int|1
)braket
op_star
l_int|256
suffix:semicolon
id|se401-&gt;height
(braket
id|i
)braket
op_assign
id|cp
(braket
l_int|6
op_plus
id|i
op_star
l_int|4
op_plus
l_int|2
)braket
op_plus
id|cp
(braket
l_int|6
op_plus
id|i
op_star
l_int|4
op_plus
l_int|3
)braket
op_star
l_int|256
suffix:semicolon
)brace
id|sprintf
(paren
id|temp
comma
l_string|&quot;%s Sizes:&quot;
comma
id|temp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|se401-&gt;sizes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%s %dx%d&quot;
comma
id|temp
comma
id|se401-&gt;width
(braket
id|i
)braket
comma
id|se401-&gt;height
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|info
c_func
(paren
l_string|&quot;%s&quot;
comma
id|temp
)paren
suffix:semicolon
id|se401-&gt;maxframesize
op_assign
id|se401-&gt;width
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
op_star
id|se401-&gt;height
(braket
id|se401-&gt;sizes
op_minus
l_int|1
)braket
op_star
l_int|3
suffix:semicolon
id|rc
op_assign
id|se401_sndctrl
c_func
(paren
l_int|0
comma
id|se401
comma
id|SE401_REQ_GET_WIDTH
comma
l_int|0
comma
id|cp
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|se401-&gt;cwidth
op_assign
id|cp
(braket
l_int|0
)braket
op_plus
id|cp
(braket
l_int|1
)braket
op_star
l_int|256
suffix:semicolon
id|rc
op_assign
id|se401_sndctrl
c_func
(paren
l_int|0
comma
id|se401
comma
id|SE401_REQ_GET_HEIGHT
comma
l_int|0
comma
id|cp
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|se401-&gt;cheight
op_assign
id|cp
(braket
l_int|0
)braket
op_plus
id|cp
(braket
l_int|1
)braket
op_star
l_int|256
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp
(braket
l_int|2
)braket
op_logical_and
id|SE401_FORMAT_BAYER
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Bayer format not supported!&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* set output mode (BAYER) */
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_SET_OUTPUT_MODE
comma
id|SE401_FORMAT_BAYER
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|rc
op_assign
id|se401_sndctrl
c_func
(paren
l_int|0
comma
id|se401
comma
id|SE401_REQ_GET_BRT
comma
l_int|0
comma
id|cp
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|se401-&gt;brightness
op_assign
id|cp
(braket
l_int|0
)braket
op_plus
id|cp
(braket
l_int|1
)braket
op_star
l_int|256
suffix:semicolon
multiline_comment|/* some default values */
id|se401-&gt;resetlevel
op_assign
l_int|0x2d
suffix:semicolon
id|se401-&gt;rgain
op_assign
l_int|0x20
suffix:semicolon
id|se401-&gt;ggain
op_assign
l_int|0x20
suffix:semicolon
id|se401-&gt;bgain
op_assign
l_int|0x20
suffix:semicolon
id|se401_set_exposure
c_func
(paren
id|se401
comma
l_int|20000
)paren
suffix:semicolon
id|se401-&gt;palette
op_assign
id|VIDEO_PALETTE_RGB24
suffix:semicolon
id|se401-&gt;enhance
op_assign
l_int|1
suffix:semicolon
id|se401-&gt;dropped
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;error
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;framecount
op_assign
l_int|0
suffix:semicolon
id|se401-&gt;readcount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Start interrupt transfers for snapshot button */
id|se401-&gt;inturb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;inturb
)paren
(brace
id|info
c_func
(paren
l_string|&quot;Allocation of inturb failed&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|FILL_INT_URB
c_func
(paren
id|se401-&gt;inturb
comma
id|se401-&gt;dev
comma
id|usb_rcvintpipe
c_func
(paren
id|se401-&gt;dev
comma
id|SE401_BUTTON_ENDPOINT
)paren
comma
op_amp
id|se401-&gt;button
comma
r_sizeof
(paren
id|se401-&gt;button
)paren
comma
id|se401_button_irq
comma
id|se401
comma
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
id|se401-&gt;inturb
comma
id|GFP_KERNEL
)paren
)paren
(brace
id|info
c_func
(paren
l_string|&quot;int urb burned down&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Flash the led */
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_CAMERA_POWER
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_LED_CONTROL
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_CAMERA_POWER
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|se401_sndctrl
c_func
(paren
l_int|1
comma
id|se401
comma
id|SE401_REQ_LED_CONTROL
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 3, 0)
DECL|function|se401_probe
r_static
r_void
op_star
id|se401_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
)paren
macro_line|#else
r_static
r_void
op_star
id|__devinit
id|se401_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_int
r_int
id|ifnum
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
macro_line|#endif
(brace
r_struct
id|usb_interface_descriptor
op_star
id|interface
suffix:semicolon
r_struct
id|usb_se401
op_star
id|se401
suffix:semicolon
r_char
op_star
id|camera_name
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* We don&squot;t handle multi-config cameras */
r_if
c_cond
(paren
id|dev-&gt;descriptor.bNumConfigurations
op_ne
l_int|1
)paren
r_return
l_int|NULL
suffix:semicolon
id|interface
op_assign
op_amp
id|dev-&gt;actconfig-&gt;interface
(braket
id|ifnum
)braket
dot
id|altsetting
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Is it an se401? */
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x03e8
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x0004
)paren
(brace
id|camera_name
op_assign
l_string|&quot;Endpoints/Aox SE401&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x0471
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x030b
)paren
(brace
id|camera_name
op_assign
l_string|&quot;Philips PCVC665K&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x047d
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x5001
)paren
(brace
id|camera_name
op_assign
l_string|&quot;Kensington VideoCAM 67014&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x047d
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x5002
)paren
(brace
id|camera_name
op_assign
l_string|&quot;Kensington VideoCAM 6701(5/7)&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;descriptor.idVendor
op_eq
l_int|0x047d
op_logical_and
id|dev-&gt;descriptor.idProduct
op_eq
l_int|0x5003
)paren
(brace
id|camera_name
op_assign
l_string|&quot;Kensington VideoCAM 67016&quot;
suffix:semicolon
)brace
r_else
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Checking vendor/product should be enough, but what the hell */
r_if
c_cond
(paren
id|interface-&gt;bInterfaceClass
op_ne
l_int|0x00
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|interface-&gt;bInterfaceSubClass
op_ne
l_int|0x00
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* We found one */
id|info
c_func
(paren
l_string|&quot;SE401 camera found: %s&quot;
comma
id|camera_name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|se401
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|se401
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|err
c_func
(paren
l_string|&quot;couldn&squot;t kmalloc se401 struct&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|se401
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|se401
)paren
)paren
suffix:semicolon
id|se401-&gt;dev
op_assign
id|dev
suffix:semicolon
id|se401-&gt;iface
op_assign
id|interface-&gt;bInterfaceNumber
suffix:semicolon
id|se401-&gt;camera_name
op_assign
id|camera_name
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;firmware version: %02x&quot;
comma
id|dev-&gt;descriptor.bcdDevice
op_amp
l_int|255
)paren
suffix:semicolon
r_if
c_cond
(paren
id|se401_init
c_func
(paren
id|se401
)paren
)paren
(brace
id|kfree
c_func
(paren
id|se401
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|se401-&gt;vdev
comma
op_amp
id|se401_template
comma
r_sizeof
(paren
id|se401_template
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|se401-&gt;vdev.name
comma
id|se401-&gt;camera_name
comma
id|strlen
c_func
(paren
id|se401-&gt;camera_name
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|se401-&gt;lock
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
op_amp
id|se401-&gt;vdev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|kfree
c_func
(paren
id|se401
)paren
suffix:semicolon
id|err
c_func
(paren
l_string|&quot;video_register_device failed&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(CONFIG_VIDEO_PROC_FS)
id|create_proc_se401_cam
c_func
(paren
id|se401
)paren
suffix:semicolon
macro_line|#endif
id|info
c_func
(paren
l_string|&quot;registered new video device: video%d&quot;
comma
id|se401-&gt;vdev.minor
)paren
suffix:semicolon
r_return
id|se401
suffix:semicolon
)brace
DECL|function|se401_disconnect
r_static
r_void
id|se401_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|usb_se401
op_star
id|se401
op_assign
(paren
r_struct
id|usb_se401
op_star
)paren
id|ptr
suffix:semicolon
id|video_unregister_device
c_func
(paren
op_amp
id|se401-&gt;vdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|se401-&gt;user
)paren
(brace
id|usb_se401_remove_disconnected
c_func
(paren
id|se401
)paren
suffix:semicolon
)brace
r_else
(brace
id|se401-&gt;removed
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|usb_se401_remove_disconnected
r_static
r_inline
r_void
id|usb_se401_remove_disconnected
(paren
r_struct
id|usb_se401
op_star
id|se401
)paren
(brace
r_int
id|i
suffix:semicolon
id|se401-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|se401-&gt;frame
(braket
l_int|0
)braket
dot
id|grabstate
op_assign
id|FRAME_ERROR
suffix:semicolon
id|se401-&gt;frame
(braket
l_int|1
)braket
dot
id|grabstate
op_assign
id|FRAME_ERROR
suffix:semicolon
id|se401-&gt;streaming
op_assign
l_int|0
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|se401-&gt;wq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSBUF
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|se401-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|se401-&gt;urb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|se401-&gt;sbuf
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SE401_NUMSCRATCH
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|data
)paren
(brace
id|kfree
c_func
(paren
id|se401-&gt;scratch
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|se401-&gt;inturb
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|se401-&gt;inturb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|se401-&gt;inturb
)paren
suffix:semicolon
)brace
id|info
c_func
(paren
l_string|&quot;%s disconnected&quot;
comma
id|se401-&gt;camera_name
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(CONFIG_VIDEO_PROC_FS)
id|destroy_proc_se401_cam
c_func
(paren
id|se401
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Free the memory */
id|kfree
c_func
(paren
id|se401-&gt;width
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|se401-&gt;height
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|se401
)paren
suffix:semicolon
)brace
DECL|variable|se401_driver
r_static
r_struct
id|usb_driver
id|se401_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;se401&quot;
comma
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2, 3, 0)
id|id_table
suffix:colon
id|device_table
comma
macro_line|#endif
id|probe
suffix:colon
id|se401_probe
comma
id|disconnect
suffix:colon
id|se401_disconnect
)brace
suffix:semicolon
multiline_comment|/****************************************************************************&n; *&n; *  Module routines&n; *&n; ***************************************************************************/
DECL|function|usb_se401_init
r_static
r_int
id|__init
id|usb_se401_init
c_func
(paren
r_void
)paren
(brace
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(CONFIG_VIDEO_PROC_FS)
id|proc_se401_create
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|info
c_func
(paren
l_string|&quot;SE401 usb camera driver version %s registering&quot;
comma
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flickerless
)paren
r_if
c_cond
(paren
id|flickerless
op_ne
l_int|50
op_logical_and
id|flickerless
op_ne
l_int|60
)paren
(brace
id|info
c_func
(paren
l_string|&quot;Invallid flickerless value, use 0, 50 or 60.&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usb_register
c_func
(paren
op_amp
id|se401_driver
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|usb_se401_exit
r_static
r_void
id|__exit
id|usb_se401_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|se401_driver
)paren
suffix:semicolon
id|info
c_func
(paren
l_string|&quot;SE401 driver deregistered&quot;
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_PROC_FS) &amp;&amp; defined(CONFIG_VIDEO_PROC_FS)
id|proc_se401_destroy
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|usb_se401_init
id|module_init
c_func
(paren
id|usb_se401_init
)paren
suffix:semicolon
DECL|variable|usb_se401_exit
id|module_exit
c_func
(paren
id|usb_se401_exit
)paren
suffix:semicolon
eof
