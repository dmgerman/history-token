multiline_comment|/* Driver for Philips webcam&n;   Functions that send various control messages to the webcam, including&n;   video modes.&n;   (C) 1999-2003 Nemosoft Unv. (webcam@smcc.demon.nl)&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License as published by&n;   the Free Software Foundation; either version 2 of the License, or&n;   (at your option) any later version.&n;&n;   This program is distributed in the hope that it will be useful,&n;   but WITHOUT ANY WARRANTY; without even the implied warranty of&n;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;   GNU General Public License for more details.&n;&n;   You should have received a copy of the GNU General Public License&n;   along with this program; if not, write to the Free Software&n;   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;*/
multiline_comment|/*&n;   Changes&n;   2001/08/03  Alvarado   Added methods for changing white balance and &n;                          red/green gains&n; */
multiline_comment|/* Control functions for the cam; brightness, contrast, video mode, etc. */
macro_line|#ifdef __KERNEL__
macro_line|#include &lt;asm/uaccess.h&gt; 
macro_line|#endif
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &quot;pwc.h&quot;
macro_line|#include &quot;pwc-ioctl.h&quot;
multiline_comment|/* Request types: video */
DECL|macro|SET_LUM_CTL
mdefine_line|#define SET_LUM_CTL&t;&t;&t;0x01
DECL|macro|GET_LUM_CTL
mdefine_line|#define GET_LUM_CTL&t;&t;&t;0x02
DECL|macro|SET_CHROM_CTL
mdefine_line|#define SET_CHROM_CTL&t;&t;&t;0x03
DECL|macro|GET_CHROM_CTL
mdefine_line|#define GET_CHROM_CTL&t;&t;&t;0x04
DECL|macro|SET_STATUS_CTL
mdefine_line|#define SET_STATUS_CTL&t;&t;&t;0x05
DECL|macro|GET_STATUS_CTL
mdefine_line|#define GET_STATUS_CTL&t;&t;&t;0x06
DECL|macro|SET_EP_STREAM_CTL
mdefine_line|#define SET_EP_STREAM_CTL&t;&t;0x07
DECL|macro|GET_EP_STREAM_CTL
mdefine_line|#define GET_EP_STREAM_CTL&t;&t;0x08
DECL|macro|SET_MPT_CTL
mdefine_line|#define SET_MPT_CTL&t;&t;&t;0x0D
DECL|macro|GET_MPT_CTL
mdefine_line|#define GET_MPT_CTL&t;&t;&t;0x0E
multiline_comment|/* Selectors for the Luminance controls [GS]ET_LUM_CTL */
DECL|macro|AGC_MODE_FORMATTER
mdefine_line|#define AGC_MODE_FORMATTER&t;&t;&t;0x2000
DECL|macro|PRESET_AGC_FORMATTER
mdefine_line|#define PRESET_AGC_FORMATTER&t;&t;&t;0x2100
DECL|macro|SHUTTER_MODE_FORMATTER
mdefine_line|#define SHUTTER_MODE_FORMATTER&t;&t;&t;0x2200
DECL|macro|PRESET_SHUTTER_FORMATTER
mdefine_line|#define PRESET_SHUTTER_FORMATTER&t;&t;0x2300
DECL|macro|PRESET_CONTOUR_FORMATTER
mdefine_line|#define PRESET_CONTOUR_FORMATTER&t;&t;0x2400
DECL|macro|AUTO_CONTOUR_FORMATTER
mdefine_line|#define AUTO_CONTOUR_FORMATTER&t;&t;&t;0x2500
DECL|macro|BACK_LIGHT_COMPENSATION_FORMATTER
mdefine_line|#define BACK_LIGHT_COMPENSATION_FORMATTER&t;0x2600
DECL|macro|CONTRAST_FORMATTER
mdefine_line|#define CONTRAST_FORMATTER&t;&t;&t;0x2700
DECL|macro|DYNAMIC_NOISE_CONTROL_FORMATTER
mdefine_line|#define DYNAMIC_NOISE_CONTROL_FORMATTER&t;&t;0x2800
DECL|macro|FLICKERLESS_MODE_FORMATTER
mdefine_line|#define FLICKERLESS_MODE_FORMATTER&t;&t;0x2900
DECL|macro|AE_CONTROL_SPEED
mdefine_line|#define AE_CONTROL_SPEED&t;&t;&t;0x2A00
DECL|macro|BRIGHTNESS_FORMATTER
mdefine_line|#define BRIGHTNESS_FORMATTER&t;&t;&t;0x2B00
DECL|macro|GAMMA_FORMATTER
mdefine_line|#define GAMMA_FORMATTER&t;&t;&t;&t;0x2C00
multiline_comment|/* Selectors for the Chrominance controls [GS]ET_CHROM_CTL */
DECL|macro|WB_MODE_FORMATTER
mdefine_line|#define WB_MODE_FORMATTER&t;&t;&t;0x1000
DECL|macro|AWB_CONTROL_SPEED_FORMATTER
mdefine_line|#define AWB_CONTROL_SPEED_FORMATTER&t;&t;0x1100
DECL|macro|AWB_CONTROL_DELAY_FORMATTER
mdefine_line|#define AWB_CONTROL_DELAY_FORMATTER&t;&t;0x1200
DECL|macro|PRESET_MANUAL_RED_GAIN_FORMATTER
mdefine_line|#define PRESET_MANUAL_RED_GAIN_FORMATTER&t;0x1300
DECL|macro|PRESET_MANUAL_BLUE_GAIN_FORMATTER
mdefine_line|#define PRESET_MANUAL_BLUE_GAIN_FORMATTER&t;0x1400
DECL|macro|COLOUR_MODE_FORMATTER
mdefine_line|#define COLOUR_MODE_FORMATTER&t;&t;&t;0x1500
DECL|macro|SATURATION_MODE_FORMATTER1
mdefine_line|#define SATURATION_MODE_FORMATTER1&t;&t;0x1600
DECL|macro|SATURATION_MODE_FORMATTER2
mdefine_line|#define SATURATION_MODE_FORMATTER2&t;&t;0x1700
multiline_comment|/* Selectors for the Status controls [GS]ET_STATUS_CTL */
DECL|macro|SAVE_USER_DEFAULTS_FORMATTER
mdefine_line|#define SAVE_USER_DEFAULTS_FORMATTER&t;&t;0x0200
DECL|macro|RESTORE_USER_DEFAULTS_FORMATTER
mdefine_line|#define RESTORE_USER_DEFAULTS_FORMATTER&t;&t;0x0300
DECL|macro|RESTORE_FACTORY_DEFAULTS_FORMATTER
mdefine_line|#define RESTORE_FACTORY_DEFAULTS_FORMATTER&t;0x0400
DECL|macro|READ_AGC_FORMATTER
mdefine_line|#define READ_AGC_FORMATTER&t;&t;&t;0x0500
DECL|macro|READ_SHUTTER_FORMATTER
mdefine_line|#define READ_SHUTTER_FORMATTER&t;&t;&t;0x0600
DECL|macro|READ_RED_GAIN_FORMATTER
mdefine_line|#define READ_RED_GAIN_FORMATTER&t;&t;&t;0x0700
DECL|macro|READ_BLUE_GAIN_FORMATTER
mdefine_line|#define READ_BLUE_GAIN_FORMATTER&t;&t;0x0800
DECL|macro|SENSOR_TYPE_FORMATTER1
mdefine_line|#define SENSOR_TYPE_FORMATTER1&t;&t;&t;0x0C00
DECL|macro|READ_RAW_Y_MEAN_FORMATTER
mdefine_line|#define READ_RAW_Y_MEAN_FORMATTER&t;&t;0x3100
DECL|macro|SET_POWER_SAVE_MODE_FORMATTER
mdefine_line|#define SET_POWER_SAVE_MODE_FORMATTER&t;&t;0x3200
DECL|macro|MIRROR_IMAGE_FORMATTER
mdefine_line|#define MIRROR_IMAGE_FORMATTER&t;&t;&t;0x3300
DECL|macro|LED_FORMATTER
mdefine_line|#define LED_FORMATTER&t;&t;&t;&t;0x3400
DECL|macro|SENSOR_TYPE_FORMATTER2
mdefine_line|#define SENSOR_TYPE_FORMATTER2&t;&t;&t;0x3700
multiline_comment|/* Formatters for the Video Endpoint controls [GS]ET_EP_STREAM_CTL */
DECL|macro|VIDEO_OUTPUT_CONTROL_FORMATTER
mdefine_line|#define VIDEO_OUTPUT_CONTROL_FORMATTER&t;&t;0x0100
multiline_comment|/* Formatters for the motorized pan &amp; tilt [GS]ET_MPT_CTL */
DECL|macro|PT_RELATIVE_CONTROL_FORMATTER
mdefine_line|#define PT_RELATIVE_CONTROL_FORMATTER&t;&t;0x01
DECL|macro|PT_RESET_CONTROL_FORMATTER
mdefine_line|#define PT_RESET_CONTROL_FORMATTER&t;&t;0x02
DECL|macro|PT_STATUS_FORMATTER
mdefine_line|#define PT_STATUS_FORMATTER&t;&t;&t;0x03
DECL|variable|size2name
r_static
r_char
op_star
id|size2name
(braket
id|PSZ_MAX
)braket
op_assign
(brace
l_string|&quot;subQCIF&quot;
comma
l_string|&quot;QSIF&quot;
comma
l_string|&quot;QCIF&quot;
comma
l_string|&quot;SIF&quot;
comma
l_string|&quot;CIF&quot;
comma
l_string|&quot;VGA&quot;
comma
)brace
suffix:semicolon
multiline_comment|/********/
multiline_comment|/* Entries for the Nala (645/646) camera; the Nala doesn&squot;t have compression &n;   preferences, so you either get compressed or non-compressed streams.&n;   &n;   An alternate value of 0 means this mode is not available at all.&n; */
DECL|struct|Nala_table_entry
r_struct
id|Nala_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate setting */
DECL|member|compressed
r_int
id|compressed
suffix:semicolon
multiline_comment|/* Compressed yes/no */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* precomputed mode table */
)brace
suffix:semicolon
DECL|variable|Nala_table
r_static
r_struct
id|Nala_table_entry
id|Nala_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|8
)braket
op_assign
(brace
macro_line|#include &quot;pwc_nala.h&quot;
)brace
suffix:semicolon
multiline_comment|/* This tables contains entries for the 675/680/690 (Timon) camera, with&n;   4 different qualities (no compression, low, medium, high).&n;   It lists the bandwidth requirements for said mode by its alternate interface&n;   number. An alternate of 0 means that the mode is unavailable.&n;&n;   There are 6 * 4 * 4 entries:&n;     6 different resolutions subqcif, qsif, qcif, sif, cif, vga&n;     6 framerates: 5, 10, 15, 20, 25, 30&n;     4 compression modi: none, low, medium, high&n;&n;   When an uncompressed mode is not available, the next available compressed mode&n;   will be chosen (unless the decompressor is absent). Sometimes there are only&n;   1 or 2 compressed modes available; in that case entries are duplicated.&n;*/
DECL|struct|Timon_table_entry
r_struct
id|Timon_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate interface */
DECL|member|packetsize
r_int
r_int
id|packetsize
suffix:semicolon
multiline_comment|/* Normal packet size */
DECL|member|bandlength
r_int
r_int
id|bandlength
suffix:semicolon
multiline_comment|/* Bandlength when decompressing */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|13
)braket
suffix:semicolon
multiline_comment|/* precomputed mode settings for cam */
)brace
suffix:semicolon
DECL|variable|Timon_table
r_static
r_struct
id|Timon_table_entry
id|Timon_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|6
)braket
(braket
l_int|4
)braket
op_assign
(brace
macro_line|#include &quot;pwc_timon.h&quot;
)brace
suffix:semicolon
multiline_comment|/* Entries for the Kiara (730/740/750) camera */
DECL|struct|Kiara_table_entry
r_struct
id|Kiara_table_entry
(brace
DECL|member|alternate
r_char
id|alternate
suffix:semicolon
multiline_comment|/* USB alternate interface */
DECL|member|packetsize
r_int
r_int
id|packetsize
suffix:semicolon
multiline_comment|/* Normal packet size */
DECL|member|bandlength
r_int
r_int
id|bandlength
suffix:semicolon
multiline_comment|/* Bandlength when decompressing */
DECL|member|mode
r_int
r_char
id|mode
(braket
l_int|12
)braket
suffix:semicolon
multiline_comment|/* precomputed mode settings for cam */
)brace
suffix:semicolon
DECL|variable|Kiara_table
r_static
r_struct
id|Kiara_table_entry
id|Kiara_table
(braket
id|PSZ_MAX
)braket
(braket
l_int|6
)braket
(braket
l_int|4
)braket
op_assign
(brace
macro_line|#include &quot;pwc_kiara.h&quot;
)brace
suffix:semicolon
multiline_comment|/****************************************************************************/
DECL|macro|SendControlMsg
mdefine_line|#define SendControlMsg(request, value, buflen) &bslash;&n;&t;usb_control_msg(pdev-&gt;udev, usb_sndctrlpipe(pdev-&gt;udev, 0), &bslash;&n;&t;&t;request, &bslash;&n;&t;&t;USB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_DEVICE, &bslash;&n;&t;&t;value, &bslash;&n;&t;&t;pdev-&gt;vcinterface, &bslash;&n;&t;&t;&amp;buf, buflen, HZ / 2)
DECL|macro|RecvControlMsg
mdefine_line|#define RecvControlMsg(request, value, buflen) &bslash;&n;&t;usb_control_msg(pdev-&gt;udev, usb_rcvctrlpipe(pdev-&gt;udev, 0), &bslash;&n;&t;&t;request, &bslash;&n;&t;&t;USB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_DEVICE, &bslash;&n;&t;&t;value, &bslash;&n;&t;&t;pdev-&gt;vcinterface, &bslash;&n;&t;&t;&amp;buf, buflen, HZ / 2)
macro_line|#if PWC_DEBUG
DECL|function|pwc_hexdump
r_void
id|pwc_hexdump
c_func
(paren
r_void
op_star
id|p
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|s
suffix:semicolon
r_char
id|buf
(braket
l_int|100
)braket
comma
op_star
id|d
suffix:semicolon
id|s
op_assign
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
id|d
op_assign
id|buf
suffix:semicolon
op_star
id|d
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|Debug
c_func
(paren
l_string|&quot;Doing hexdump @ %p, %d bytes.&bslash;n&quot;
comma
id|p
comma
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|d
op_add_assign
id|sprintf
c_func
(paren
id|d
comma
l_string|&quot;%02X &quot;
comma
op_star
id|s
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0xF
)paren
op_eq
l_int|0xF
)paren
(brace
id|Debug
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
id|d
op_assign
id|buf
suffix:semicolon
op_star
id|d
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0xF
)paren
op_ne
l_int|0
)paren
id|Debug
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|send_video_command
r_static
r_inline
r_int
id|send_video_command
c_func
(paren
r_struct
id|usb_device
op_star
id|udev
comma
r_int
id|index
comma
r_void
op_star
id|buf
comma
r_int
id|buflen
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
id|SET_EP_STREAM_CTL
comma
id|USB_DIR_OUT
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
id|VIDEO_OUTPUT_CONTROL_FORMATTER
comma
id|index
comma
id|buf
comma
id|buflen
comma
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|set_video_mode_Nala
r_static
r_inline
r_int
id|set_video_mode_Nala
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|ret
comma
id|fps
suffix:semicolon
r_struct
id|Nala_table_entry
op_star
id|pEntry
suffix:semicolon
r_int
id|frames2frames
(braket
l_int|31
)braket
op_assign
(brace
multiline_comment|/* closest match of framerate */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|4
comma
multiline_comment|/*  0-4  */
l_int|5
comma
l_int|5
comma
l_int|7
comma
l_int|7
comma
l_int|10
comma
multiline_comment|/*  5-9  */
l_int|10
comma
l_int|10
comma
l_int|12
comma
l_int|12
comma
l_int|15
comma
multiline_comment|/* 10-14 */
l_int|15
comma
l_int|15
comma
l_int|15
comma
l_int|20
comma
l_int|20
comma
multiline_comment|/* 15-19 */
l_int|20
comma
l_int|20
comma
l_int|20
comma
l_int|24
comma
l_int|24
comma
multiline_comment|/* 20-24 */
l_int|24
comma
l_int|24
comma
l_int|24
comma
l_int|24
comma
l_int|24
comma
multiline_comment|/* 25-29 */
l_int|24
multiline_comment|/* 30    */
)brace
suffix:semicolon
r_int
id|frames2table
(braket
l_int|31
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/*  0-4  */
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
multiline_comment|/*  5-9  */
l_int|3
comma
l_int|3
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
multiline_comment|/* 10-14 */
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
multiline_comment|/* 15-19 */
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|7
comma
multiline_comment|/* 20-24 */
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
multiline_comment|/* 25-29 */
l_int|7
multiline_comment|/* 30    */
)brace
suffix:semicolon
r_if
c_cond
(paren
id|size
template_param
id|PSZ_CIF
op_logical_or
id|frames
template_param
l_int|25
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|frames
op_assign
id|frames2frames
(braket
id|frames
)braket
suffix:semicolon
id|fps
op_assign
id|frames2table
(braket
id|frames
)braket
suffix:semicolon
id|pEntry
op_assign
op_amp
id|Nala_table
(braket
id|size
)braket
(braket
id|fps
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;compressed
op_logical_and
id|pdev-&gt;decompressor
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
id|memcpy
c_func
(paren
id|buf
comma
id|pEntry-&gt;mode
comma
l_int|3
)paren
suffix:semicolon
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
id|pdev-&gt;vendpoint
comma
id|buf
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|Debug
c_func
(paren
l_string|&quot;Failed to send video command... %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|pdev-&gt;cmd_len
op_assign
l_int|3
suffix:semicolon
id|memcpy
c_func
(paren
id|pdev-&gt;cmd_buf
comma
id|buf
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Set various parameters */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pEntry-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|3
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|pEntry-&gt;compressed
)paren
(brace
r_if
c_cond
(paren
id|pdev-&gt;release
OL
l_int|5
)paren
(brace
multiline_comment|/* 4 fold compression */
id|pdev-&gt;vbandlength
op_assign
l_int|528
suffix:semicolon
id|pdev-&gt;frame_size
op_div_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|pdev-&gt;vbandlength
op_assign
l_int|704
suffix:semicolon
id|pdev-&gt;frame_size
op_div_assign
l_int|3
suffix:semicolon
)brace
)brace
r_else
id|pdev-&gt;vbandlength
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_video_mode_Timon
r_static
r_inline
r_int
id|set_video_mode_Timon
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|13
)braket
suffix:semicolon
r_struct
id|Timon_table_entry
op_star
id|pChoose
suffix:semicolon
r_int
id|ret
comma
id|fps
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|PSZ_MAX
op_logical_or
id|frames
template_param
l_int|30
op_logical_or
id|compression
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
id|PSZ_VGA
op_logical_and
id|frames
OG
l_int|15
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fps
op_assign
(paren
id|frames
op_div
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Find a supported framerate with progressively higher compression ratios&n;&t;   if the preferred ratio is not available.&n;&t;*/
id|pChoose
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;decompressor
op_eq
l_int|NULL
)paren
(brace
macro_line|#if PWC_DEBUG
id|Debug
c_func
(paren
l_string|&quot;Trying to find uncompressed mode.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pChoose
op_assign
op_amp
id|Timon_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|compression
op_le
l_int|3
)paren
(brace
id|pChoose
op_assign
op_amp
id|Timon_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
id|compression
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;alternate
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|compression
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pChoose
op_eq
l_int|NULL
op_logical_or
id|pChoose-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
id|memcpy
c_func
(paren
id|buf
comma
id|pChoose-&gt;mode
comma
l_int|13
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snapshot
)paren
id|buf
(braket
l_int|0
)braket
op_or_assign
l_int|0x80
suffix:semicolon
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
id|pdev-&gt;vendpoint
comma
id|buf
comma
l_int|13
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|pdev-&gt;cmd_len
op_assign
l_int|13
suffix:semicolon
id|memcpy
c_func
(paren
id|pdev-&gt;cmd_buf
comma
id|buf
comma
l_int|13
)paren
suffix:semicolon
multiline_comment|/* Set various parameters */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;vsnapshot
op_assign
id|snapshot
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pChoose-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;vbandlength
op_assign
id|pChoose-&gt;bandlength
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;bandlength
OG
l_int|0
)paren
id|pdev-&gt;frame_size
op_assign
(paren
id|pChoose-&gt;bandlength
op_star
id|pdev-&gt;image.y
)paren
op_div
l_int|4
suffix:semicolon
r_else
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|12
)paren
op_div
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_video_mode_Kiara
r_static
r_inline
r_int
id|set_video_mode_Kiara
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|size
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_struct
id|Kiara_table_entry
op_star
id|pChoose
op_assign
l_int|NULL
suffix:semicolon
r_int
id|fps
comma
id|ret
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|12
)braket
suffix:semicolon
r_struct
id|Kiara_table_entry
id|RawEntry
op_assign
(brace
l_int|6
comma
l_int|773
comma
l_int|1272
comma
(brace
l_int|0xAD
comma
l_int|0xF4
comma
l_int|0x10
comma
l_int|0x27
comma
l_int|0xB6
comma
l_int|0x24
comma
l_int|0x96
comma
l_int|0x02
comma
l_int|0x30
comma
l_int|0x05
comma
l_int|0x03
comma
l_int|0x80
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|PSZ_MAX
op_logical_or
id|frames
template_param
l_int|30
op_logical_or
id|compression
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
id|PSZ_VGA
op_logical_and
id|frames
OG
l_int|15
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fps
op_assign
(paren
id|frames
op_div
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* special case: VGA @ 5 fps and snapshot is raw bayer mode */
r_if
c_cond
(paren
id|size
op_eq
id|PSZ_VGA
op_logical_and
id|frames
op_eq
l_int|5
op_logical_and
id|snapshot
)paren
(brace
multiline_comment|/* Only available in case the raw palette is selected or &n;&t;&t;   we have the decompressor available. This mode is &n;&t;&t;   only available in compressed form &n;&t;&t;*/
r_if
c_cond
(paren
id|pdev-&gt;vpalette
op_eq
id|VIDEO_PALETTE_RAW
op_logical_or
id|pdev-&gt;decompressor
op_ne
l_int|NULL
)paren
(brace
id|Info
c_func
(paren
l_string|&quot;Choosing VGA/5 BAYER mode (%d).&bslash;n&quot;
comma
id|pdev-&gt;vpalette
)paren
suffix:semicolon
id|pChoose
op_assign
op_amp
id|RawEntry
suffix:semicolon
)brace
r_else
(brace
id|Info
c_func
(paren
l_string|&quot;VGA/5 BAYER mode _must_ have a decompressor available, or use RAW palette.&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Find a supported framerate with progressively higher compression ratios&n;&t;&t;   if the preferred ratio is not available.&n;                   Skip this step when using RAW modes.&n;&t;&t;*/
r_if
c_cond
(paren
id|pdev-&gt;decompressor
op_eq
l_int|NULL
op_logical_and
id|pdev-&gt;vpalette
op_ne
id|VIDEO_PALETTE_RAW
)paren
(brace
macro_line|#if PWC_DEBUG
id|Debug
c_func
(paren
l_string|&quot;Trying to find uncompressed mode.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pChoose
op_assign
op_amp
id|Kiara_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|compression
op_le
l_int|3
)paren
(brace
id|pChoose
op_assign
op_amp
id|Kiara_table
(braket
id|size
)braket
(braket
id|fps
)braket
(braket
id|compression
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pChoose-&gt;alternate
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|compression
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|pChoose
op_eq
l_int|NULL
op_logical_or
id|pChoose-&gt;alternate
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
multiline_comment|/* Not supported. */
multiline_comment|/* usb_control_msg won&squot;t take staticly allocated arrays as argument?? */
id|memcpy
c_func
(paren
id|buf
comma
id|pChoose-&gt;mode
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snapshot
)paren
id|buf
(braket
l_int|0
)braket
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Firmware bug: video endpoint is 5, but commands are sent to endpoint 4 */
id|ret
op_assign
id|send_video_command
c_func
(paren
id|pdev-&gt;udev
comma
l_int|4
multiline_comment|/* pdev-&gt;vendpoint */
comma
id|buf
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|pdev-&gt;cmd_len
op_assign
l_int|12
suffix:semicolon
id|memcpy
c_func
(paren
id|pdev-&gt;cmd_buf
comma
id|buf
comma
l_int|12
)paren
suffix:semicolon
multiline_comment|/* All set and go */
id|pdev-&gt;vframes
op_assign
id|frames
suffix:semicolon
id|pdev-&gt;vsize
op_assign
id|size
suffix:semicolon
id|pdev-&gt;vsnapshot
op_assign
id|snapshot
suffix:semicolon
id|pdev-&gt;valternate
op_assign
id|pChoose-&gt;alternate
suffix:semicolon
id|pdev-&gt;image
op_assign
id|pwc_image_sizes
(braket
id|size
)braket
suffix:semicolon
id|pdev-&gt;vbandlength
op_assign
id|pChoose-&gt;bandlength
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;vbandlength
OG
l_int|0
)paren
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;vbandlength
op_star
id|pdev-&gt;image.y
)paren
op_div
l_int|4
suffix:semicolon
r_else
id|pdev-&gt;frame_size
op_assign
(paren
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
l_int|12
)paren
op_div
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n;   @pdev: device structure&n;   @width: viewport width&n;   @height: viewport height&n;   @frame: framerate, in fps&n;   @compression: preferred compression ratio&n;   @snapshot: snapshot mode or streaming&n; */
DECL|function|pwc_set_video_mode
r_int
id|pwc_set_video_mode
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|width
comma
r_int
id|height
comma
r_int
id|frames
comma
r_int
id|compression
comma
r_int
id|snapshot
)paren
(brace
r_int
id|ret
comma
id|size
suffix:semicolon
id|Trace
c_func
(paren
id|TRACE_FLOW
comma
l_string|&quot;set_video_mode(%dx%d @ %d, palette %d).&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|frames
comma
id|pdev-&gt;vpalette
)paren
suffix:semicolon
id|size
op_assign
id|pwc_decode_size
c_func
(paren
id|pdev
comma
id|width
comma
id|height
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
(brace
id|Debug
c_func
(paren
l_string|&quot;Could not find suitable size.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ERANGE
suffix:semicolon
)brace
id|Debug
c_func
(paren
l_string|&quot;decode_size = %d.&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;type
)paren
(brace
r_case
l_int|645
suffix:colon
r_case
l_int|646
suffix:colon
id|ret
op_assign
id|set_video_mode_Nala
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|675
suffix:colon
r_case
l_int|680
suffix:colon
r_case
l_int|690
suffix:colon
id|ret
op_assign
id|set_video_mode_Timon
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
comma
id|compression
comma
id|snapshot
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
r_case
l_int|730
suffix:colon
r_case
l_int|740
suffix:colon
r_case
l_int|750
suffix:colon
id|ret
op_assign
id|set_video_mode_Kiara
c_func
(paren
id|pdev
comma
id|size
comma
id|frames
comma
id|compression
comma
id|snapshot
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ENOENT
)paren
id|Info
c_func
(paren
l_string|&quot;Video mode %s@%d fps is only supported with the decompressor module (pwcx).&bslash;n&quot;
comma
id|size2name
(braket
id|size
)braket
comma
id|frames
)paren
suffix:semicolon
r_else
(brace
id|Err
c_func
(paren
l_string|&quot;Failed to set video mode %s@%d fps; return code = %d&bslash;n&quot;
comma
id|size2name
(braket
id|size
)braket
comma
id|frames
comma
id|ret
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
id|pdev-&gt;view.x
op_assign
id|width
suffix:semicolon
id|pdev-&gt;view.y
op_assign
id|height
suffix:semicolon
id|pdev-&gt;frame_total_size
op_assign
id|pdev-&gt;frame_size
op_plus
id|pdev-&gt;frame_header_size
op_plus
id|pdev-&gt;frame_trailer_size
suffix:semicolon
id|pwc_set_image_buffer_size
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|Trace
c_func
(paren
id|TRACE_SIZE
comma
l_string|&quot;Set viewport to %dx%d, image size is %dx%d.&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|pwc_image_sizes
(braket
id|size
)braket
dot
id|x
comma
id|pwc_image_sizes
(braket
id|size
)braket
dot
id|y
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_image_buffer_size
r_void
id|pwc_set_image_buffer_size
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
id|i
comma
id|factor
op_assign
l_int|0
comma
id|filler
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* for PALETTE_YUV420P */
r_switch
c_cond
(paren
id|pdev-&gt;vpalette
)paren
(brace
r_case
id|VIDEO_PALETTE_YUV420P
suffix:colon
id|factor
op_assign
l_int|6
suffix:semicolon
id|filler
op_assign
l_int|128
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_RAW
suffix:colon
id|factor
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* can be uncompressed YUV420P */
id|filler
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Set sizes in bytes */
id|pdev-&gt;image.size
op_assign
id|pdev-&gt;image.x
op_star
id|pdev-&gt;image.y
op_star
id|factor
op_div
l_int|4
suffix:semicolon
id|pdev-&gt;view.size
op_assign
id|pdev-&gt;view.x
op_star
id|pdev-&gt;view.y
op_star
id|factor
op_div
l_int|4
suffix:semicolon
multiline_comment|/* Align offset, or you&squot;ll get some very weird results in&n;&t;   YUV420 mode... x must be multiple of 4 (to get the Y&squot;s in&n;&t;   place), and y even (or you&squot;ll mixup U &amp; V). This is less of a&n;&t;   problem for YUV420P.&n;&t; */
id|pdev-&gt;offset.x
op_assign
(paren
(paren
id|pdev-&gt;view.x
op_minus
id|pdev-&gt;image.x
)paren
op_div
l_int|2
)paren
op_amp
l_int|0xFFFC
suffix:semicolon
id|pdev-&gt;offset.y
op_assign
(paren
(paren
id|pdev-&gt;view.y
op_minus
id|pdev-&gt;image.y
)paren
op_div
l_int|2
)paren
op_amp
l_int|0xFFFE
suffix:semicolon
multiline_comment|/* Fill buffers with gray or black */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_IMAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pdev-&gt;image_ptr
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
id|memset
c_func
(paren
id|pdev-&gt;image_ptr
(braket
id|i
)braket
comma
id|filler
comma
id|pdev-&gt;view.size
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* BRIGHTNESS */
DECL|function|pwc_get_brightness
r_int
id|pwc_get_brightness
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|BRIGHTNESS_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|9
suffix:semicolon
)brace
DECL|function|pwc_set_brightness
r_int
id|pwc_set_brightness
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|9
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|BRIGHTNESS_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* CONTRAST */
DECL|function|pwc_get_contrast
r_int
id|pwc_get_contrast
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|CONTRAST_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|10
suffix:semicolon
)brace
DECL|function|pwc_set_contrast
r_int
id|pwc_set_contrast
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|10
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|CONTRAST_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* GAMMA */
DECL|function|pwc_get_gamma
r_int
id|pwc_get_gamma
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|GAMMA_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
op_lshift
l_int|11
suffix:semicolon
)brace
DECL|function|pwc_set_gamma
r_int
id|pwc_set_gamma
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|11
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|GAMMA_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* SATURATION */
DECL|function|pwc_get_saturation
r_int
id|pwc_get_saturation
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|pdev-&gt;type
OL
l_int|730
ques
c_cond
id|SATURATION_MODE_FORMATTER2
suffix:colon
id|SATURATION_MODE_FORMATTER1
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|32768
op_plus
id|buf
op_star
l_int|327
suffix:semicolon
)brace
DECL|function|pwc_set_saturation
r_int
id|pwc_set_saturation
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* saturation ranges from -100 to +100 */
id|buf
op_assign
(paren
id|value
op_minus
l_int|32768
)paren
op_div
l_int|327
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|pdev-&gt;type
OL
l_int|730
ques
c_cond
id|SATURATION_MODE_FORMATTER2
suffix:colon
id|SATURATION_MODE_FORMATTER1
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* AGC */
DECL|function|pwc_set_agc
r_static
r_inline
r_int
id|pwc_set_agc
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
comma
r_int
id|value
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
id|buf
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* auto */
r_else
id|buf
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* fixed */
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|AGC_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode
op_logical_and
id|ret
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|value
op_rshift
l_int|10
)paren
op_amp
l_int|0x3F
suffix:semicolon
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|PRESET_AGC_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_agc
r_static
r_inline
r_int
id|pwc_get_agc
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|AGC_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_ne
l_int|0
)paren
(brace
multiline_comment|/* fixed */
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|PRESET_AGC_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|buf
OG
l_int|0x3F
)paren
id|buf
op_assign
l_int|0x3F
suffix:semicolon
op_star
id|value
op_assign
(paren
id|buf
op_lshift
l_int|10
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* auto */
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_STATUS_CTL
comma
id|READ_AGC_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/* Gah... this value ranges from 0x00 ... 0x9F */
r_if
c_cond
(paren
id|buf
OG
l_int|0x9F
)paren
id|buf
op_assign
l_int|0x9F
suffix:semicolon
op_star
id|value
op_assign
op_minus
(paren
l_int|48
op_plus
id|buf
op_star
l_int|409
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_shutter_speed
r_static
r_inline
r_int
id|pwc_set_shutter_speed
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
comma
r_int
id|value
)paren
(brace
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|speed
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* auto */
r_else
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* fixed */
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|SHUTTER_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode
op_logical_and
id|ret
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
r_switch
c_cond
(paren
id|pdev-&gt;type
)paren
(brace
r_case
l_int|675
suffix:colon
r_case
l_int|680
suffix:colon
r_case
l_int|690
suffix:colon
multiline_comment|/* speed ranges from 0x0 to 0x290 (656) */
id|speed
op_assign
(paren
id|value
op_div
l_int|100
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|speed
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|speed
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|720
suffix:colon
r_case
l_int|730
suffix:colon
r_case
l_int|740
suffix:colon
r_case
l_int|750
suffix:colon
multiline_comment|/* speed seems to range from 0x0 to 0xff */
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|PRESET_SHUTTER_FORMATTER
comma
l_int|2
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* POWER */
DECL|function|pwc_camera_power
r_int
id|pwc_camera_power
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|power
)paren
(brace
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
op_logical_or
(paren
id|pdev-&gt;type
OL
l_int|730
op_logical_and
id|pdev-&gt;release
OL
l_int|6
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Not supported by Nala or Timon &lt; release 6 */
r_if
c_cond
(paren
id|power
)paren
id|buf
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* active */
r_else
id|buf
op_assign
l_int|0xFF
suffix:semicolon
multiline_comment|/* power save */
r_return
id|SendControlMsg
c_func
(paren
id|SET_STATUS_CTL
comma
id|SET_POWER_SAVE_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* private calls */
DECL|function|pwc_restore_user
r_static
r_inline
r_int
id|pwc_restore_user
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
multiline_comment|/* dummy */
r_return
id|SendControlMsg
c_func
(paren
id|SET_STATUS_CTL
comma
id|RESTORE_USER_DEFAULTS_FORMATTER
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pwc_save_user
r_static
r_inline
r_int
id|pwc_save_user
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
multiline_comment|/* dummy */
r_return
id|SendControlMsg
c_func
(paren
id|SET_STATUS_CTL
comma
id|SAVE_USER_DEFAULTS_FORMATTER
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pwc_restore_factory
r_static
r_inline
r_int
id|pwc_restore_factory
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_char
id|buf
suffix:semicolon
multiline_comment|/* dummy */
r_return
id|SendControlMsg
c_func
(paren
id|SET_STATUS_CTL
comma
id|RESTORE_FACTORY_DEFAULTS_FORMATTER
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ************************************************* */
multiline_comment|/* Patch by Alvarado: (not in the original version   */
multiline_comment|/*&n;  * the camera recognizes modes from 0 to 4:&n;  *&n;  * 00: indoor (incandescant lighting)&n;  * 01: outdoor (sunlight)&n;  * 02: fluorescent lighting&n;  * 03: manual&n;  * 04: auto&n;  */
DECL|function|pwc_set_awb
r_static
r_inline
r_int
id|pwc_set_awb
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|mode
)paren
(brace
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|mode
OL
l_int|0
)paren
id|mode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode
OG
l_int|4
)paren
id|mode
op_assign
l_int|4
suffix:semicolon
id|buf
op_assign
id|mode
op_amp
l_int|0x07
suffix:semicolon
multiline_comment|/* just the lowest three bits */
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|WB_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_awb
r_static
r_inline
r_int
id|pwc_get_awb
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|WB_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
DECL|function|pwc_set_red_gain
r_static
r_inline
r_int
id|pwc_set_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* only the msb is considered */
id|buf
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|PRESET_MANUAL_RED_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_red_gain
r_static
r_inline
r_int
id|pwc_get_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|PRESET_MANUAL_RED_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_lshift
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_blue_gain
r_static
r_inline
r_int
id|pwc_set_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|0xffff
)paren
id|value
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* only the msb is considered */
id|buf
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|PRESET_MANUAL_BLUE_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_blue_gain
r_static
r_inline
r_int
id|pwc_get_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|PRESET_MANUAL_BLUE_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_lshift
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The following two functions are different, since they only read the&n;   internal red/blue gains, which may be different from the manual &n;   gains set or read above.&n; */
DECL|function|pwc_read_red_gain
r_static
r_inline
r_int
id|pwc_read_red_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_STATUS_CTL
comma
id|READ_RED_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_lshift
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_read_blue_gain
r_static
r_inline
r_int
id|pwc_read_blue_gain
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_STATUS_CTL
comma
id|READ_BLUE_GAIN_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_lshift
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_wb_speed
r_static
r_inline
r_int
id|pwc_set_wb_speed
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|speed
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
multiline_comment|/* useful range is 0x01..0x20 */
id|buf
op_assign
id|speed
op_div
l_int|0x7f0
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|AWB_CONTROL_SPEED_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_wb_speed
r_static
r_inline
r_int
id|pwc_get_wb_speed
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|AWB_CONTROL_SPEED_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_star
l_int|0x7f0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_wb_delay
r_static
r_inline
r_int
id|pwc_set_wb_delay
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|delay
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
multiline_comment|/* useful range is 0x01..0x3F */
id|buf
op_assign
(paren
id|delay
op_rshift
l_int|10
)paren
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_CHROM_CTL
comma
id|AWB_CONTROL_DELAY_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_wb_delay
r_static
r_inline
r_int
id|pwc_get_wb_delay
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|value
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_CHROM_CTL
comma
id|AWB_CONTROL_DELAY_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|value
op_assign
id|buf
op_lshift
l_int|10
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_leds
r_int
id|pwc_set_leds
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|on_value
comma
r_int
id|off_value
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|730
)paren
r_return
l_int|0
suffix:semicolon
id|on_value
op_div_assign
l_int|100
suffix:semicolon
id|off_value
op_div_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|on_value
OL
l_int|0
)paren
id|on_value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|on_value
OG
l_int|0xff
)paren
id|on_value
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|off_value
OL
l_int|0
)paren
id|off_value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off_value
OG
l_int|0xff
)paren
id|off_value
op_assign
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|on_value
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|off_value
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_STATUS_CTL
comma
id|LED_FORMATTER
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_leds
r_int
id|pwc_get_leds
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|on_value
comma
r_int
op_star
id|off_value
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|730
)paren
(brace
op_star
id|on_value
op_assign
op_minus
l_int|1
suffix:semicolon
op_star
id|off_value
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_STATUS_CTL
comma
id|LED_FORMATTER
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|on_value
op_assign
id|buf
(braket
l_int|0
)braket
op_star
l_int|100
suffix:semicolon
op_star
id|off_value
op_assign
id|buf
(braket
l_int|1
)braket
op_star
l_int|100
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_contour
r_static
r_inline
r_int
id|pwc_set_contour
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|contour
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|contour
OL
l_int|0
)paren
id|buf
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* auto contour on */
r_else
id|buf
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* auto contour off */
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|AUTO_CONTOUR_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|contour
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|contour
OG
l_int|0xffff
)paren
id|contour
op_assign
l_int|0xffff
suffix:semicolon
id|buf
op_assign
(paren
id|contour
op_rshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* contour preset is [0..3f] */
id|ret
op_assign
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|PRESET_CONTOUR_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_contour
r_static
r_inline
r_int
id|pwc_get_contour
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|contour
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|AUTO_CONTOUR_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_eq
l_int|0
)paren
(brace
multiline_comment|/* auto mode off, query current preset value */
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|PRESET_CONTOUR_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|contour
op_assign
id|buf
op_lshift
l_int|10
suffix:semicolon
)brace
r_else
op_star
id|contour
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_backlight
r_static
r_inline
r_int
id|pwc_set_backlight
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|backlight
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|backlight
)paren
id|buf
op_assign
l_int|0xff
suffix:semicolon
r_else
id|buf
op_assign
l_int|0x0
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|BACK_LIGHT_COMPENSATION_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_backlight
r_static
r_inline
r_int
id|pwc_get_backlight
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|backlight
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_char
id|buf
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|BACK_LIGHT_COMPENSATION_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|backlight
op_assign
id|buf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_flicker
r_static
r_inline
r_int
id|pwc_set_flicker
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|flicker
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|flicker
)paren
id|buf
op_assign
l_int|0xff
suffix:semicolon
r_else
id|buf
op_assign
l_int|0x0
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|FLICKERLESS_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_flicker
r_static
r_inline
r_int
id|pwc_get_flicker
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|flicker
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_char
id|buf
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|FLICKERLESS_MODE_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|flicker
op_assign
id|buf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_set_dynamic_noise
r_static
r_inline
r_int
id|pwc_set_dynamic_noise
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|noise
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|noise
OL
l_int|0
)paren
id|noise
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|noise
OG
l_int|3
)paren
id|noise
op_assign
l_int|3
suffix:semicolon
id|buf
op_assign
id|noise
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_LUM_CTL
comma
id|DYNAMIC_NOISE_CONTROL_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_get_dynamic_noise
r_static
r_inline
r_int
id|pwc_get_dynamic_noise
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|noise
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_char
id|buf
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_LUM_CTL
comma
id|DYNAMIC_NOISE_CONTROL_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
op_star
id|noise
op_assign
id|buf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_mpt_reset
r_int
id|pwc_mpt_reset
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|flags
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
id|buf
op_assign
id|flags
op_amp
l_int|0x03
suffix:semicolon
singleline_comment|// only lower two bits are currently used
r_return
id|SendControlMsg
c_func
(paren
id|SET_MPT_CTL
comma
id|PT_RESET_CONTROL_FORMATTER
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pwc_mpt_set_angle
r_static
r_inline
r_int
id|pwc_mpt_set_angle
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
id|pan
comma
r_int
id|tilt
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* set new relative angle; angles are expressed in degrees * 100,&n;&t;   but cam as .5 degree resolution, hence devide by 200. Also&n;&t;   the angle must be multiplied by 64 before it&squot;s send to&n;&t;   the cam (??)&n;&t; */
id|pan
op_assign
l_int|64
op_star
id|pan
op_div
l_int|100
suffix:semicolon
id|tilt
op_assign
op_minus
l_int|64
op_star
id|tilt
op_div
l_int|100
suffix:semicolon
multiline_comment|/* positive tilt is down, which is not what the user would expect */
id|buf
(braket
l_int|0
)braket
op_assign
id|pan
op_amp
l_int|0xFF
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
(paren
id|pan
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|tilt
op_amp
l_int|0xFF
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
(paren
id|tilt
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
suffix:semicolon
r_return
id|SendControlMsg
c_func
(paren
id|SET_MPT_CTL
comma
id|PT_RELATIVE_CONTROL_FORMATTER
comma
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|pwc_mpt_get_status
r_static
r_inline
r_int
id|pwc_mpt_get_status
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_struct
id|pwc_mpt_status
op_star
id|status
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|5
)braket
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_MPT_CTL
comma
id|PT_STATUS_FORMATTER
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|status-&gt;status
op_assign
id|buf
(braket
l_int|0
)braket
op_amp
l_int|0x7
suffix:semicolon
singleline_comment|// 3 bits are used for reporting
id|status-&gt;time_pan
op_assign
(paren
id|buf
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_plus
id|buf
(braket
l_int|2
)braket
suffix:semicolon
id|status-&gt;time_tilt
op_assign
(paren
id|buf
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_plus
id|buf
(braket
l_int|4
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pwc_get_cmos_sensor
r_int
id|pwc_get_cmos_sensor
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
op_star
id|sensor
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|ret
op_assign
op_minus
l_int|1
comma
id|request
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
id|request
op_assign
id|SENSOR_TYPE_FORMATTER1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|730
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* The Vesta series doesn&squot;t have this call */
r_else
id|request
op_assign
id|SENSOR_TYPE_FORMATTER2
suffix:semicolon
id|ret
op_assign
id|RecvControlMsg
c_func
(paren
id|GET_STATUS_CTL
comma
id|request
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;type
OL
l_int|675
)paren
op_star
id|sensor
op_assign
id|buf
op_or
l_int|0x100
suffix:semicolon
r_else
op_star
id|sensor
op_assign
id|buf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* End of Add-Ons                                    */
multiline_comment|/* ************************************************* */
multiline_comment|/* Linux 2.5.something and 2.6 pass direct pointers to arguments of&n;   ioctl() calls. With 2.4, you have to do tedious copy_from_user()&n;   and copy_to_user() calls. With these macros we circumvent this,&n;   and let me maintain only one source file. The functionality is&n;   exactly the same otherwise.&n; */
macro_line|#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2, 6, 0)
multiline_comment|/* define local variable for arg */
DECL|macro|ARG_DEF
mdefine_line|#define ARG_DEF(ARG_type, ARG_name)&bslash;&n;&t;ARG_type *ARG_name = arg;
multiline_comment|/* copy arg to local variable */
DECL|macro|ARG_IN
mdefine_line|#define ARG_IN(ARG_name) /* nothing */
multiline_comment|/* argument itself (referenced) */
DECL|macro|ARGR
mdefine_line|#define ARGR(ARG_name) (*ARG_name)
multiline_comment|/* argument address */
DECL|macro|ARGA
mdefine_line|#define ARGA(ARG_name) ARG_name
multiline_comment|/* copy local variable to arg */
DECL|macro|ARG_OUT
mdefine_line|#define ARG_OUT(ARG_name) /* nothing */
macro_line|#else
DECL|macro|ARG_DEF
mdefine_line|#define ARG_DEF(ARG_type, ARG_name)&bslash;&n;&t;ARG_type ARG_name;
DECL|macro|ARG_IN
mdefine_line|#define ARG_IN(ARG_name)&bslash;&n;&t;if (copy_from_user(&amp;ARG_name, arg, sizeof(ARG_name))) {&bslash;&n;&t;&t;ret = -EFAULT;&bslash;&n;&t;&t;break;&bslash;&n;&t;}
DECL|macro|ARGR
mdefine_line|#define ARGR(ARG_name) ARG_name
DECL|macro|ARGA
mdefine_line|#define ARGA(ARG_name) &amp;ARG_name
DECL|macro|ARG_OUT
mdefine_line|#define ARG_OUT(ARG_name)&bslash;&n;&t;if (copy_to_user(arg, &amp;ARG_name, sizeof(ARG_name))) {&bslash;&n;&t;&t;ret = -EFAULT;&bslash;&n;&t;&t;break;&bslash;&n;&t;}
macro_line|#endif
DECL|function|pwc_ioctl
r_int
id|pwc_ioctl
c_func
(paren
r_struct
id|pwc_device
op_star
id|pdev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCPWCRUSER
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_restore_user
c_func
(paren
id|pdev
)paren
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSUSER
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_save_user
c_func
(paren
id|pdev
)paren
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCFACTORY
suffix:colon
(brace
r_if
c_cond
(paren
id|pwc_restore_factory
c_func
(paren
id|pdev
)paren
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSCQUAL
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|qual
)paren
id|ARG_IN
c_func
(paren
id|qual
)paren
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|qual
)paren
template_param
l_int|3
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|ret
op_assign
id|pwc_try_video_mode
c_func
(paren
id|pdev
comma
id|pdev-&gt;view.x
comma
id|pdev-&gt;view.y
comma
id|pdev-&gt;vframes
comma
id|ARGR
c_func
(paren
id|qual
)paren
comma
id|pdev-&gt;vsnapshot
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
)paren
id|pdev-&gt;vcompression
op_assign
id|ARGR
c_func
(paren
id|qual
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGCQUAL
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|qual
)paren
id|ARGR
c_func
(paren
id|qual
)paren
op_assign
id|pdev-&gt;vcompression
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|qual
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCPROBE
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_probe
comma
id|probe
)paren
id|strcpy
c_func
(paren
id|ARGR
c_func
(paren
id|probe
)paren
dot
id|name
comma
id|pdev-&gt;vdev-&gt;name
)paren
suffix:semicolon
id|ARGR
c_func
(paren
id|probe
)paren
dot
id|type
op_assign
id|pdev-&gt;type
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|probe
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGSERIAL
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_serial
comma
id|serial
)paren
id|strcpy
c_func
(paren
id|ARGR
c_func
(paren
id|serial
)paren
dot
id|serial
comma
id|pdev-&gt;serial
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|serial
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSAGC
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|agc
)paren
id|ARG_IN
c_func
(paren
id|agc
)paren
r_if
c_cond
(paren
id|pwc_set_agc
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|agc
)paren
OL
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
id|ARGR
c_func
(paren
id|agc
)paren
)paren
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGAGC
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|agc
)paren
r_if
c_cond
(paren
id|pwc_get_agc
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|agc
)paren
)paren
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|agc
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSSHUTTER
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|shutter_speed
)paren
id|ARG_IN
c_func
(paren
id|shutter_speed
)paren
id|ret
op_assign
id|pwc_set_shutter_speed
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|shutter_speed
)paren
OL
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
id|ARGR
c_func
(paren
id|shutter_speed
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSAWB
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_whitebalance
comma
id|wb
)paren
id|ARG_IN
c_func
(paren
id|wb
)paren
id|ret
op_assign
id|pwc_set_awb
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
op_logical_and
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
op_eq
id|PWC_WB_MANUAL
)paren
(brace
id|pwc_set_red_gain
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|manual_red
)paren
suffix:semicolon
id|pwc_set_blue_gain
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|manual_blue
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGAWB
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_whitebalance
comma
id|wb
)paren
id|memset
c_func
(paren
id|ARGA
c_func
(paren
id|wb
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pwc_whitebalance
)paren
)paren
suffix:semicolon
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
op_assign
id|pwc_get_awb
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
OL
l_int|0
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
op_eq
id|PWC_WB_MANUAL
)paren
(brace
id|ret
op_assign
id|pwc_get_red_gain
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|manual_red
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|pwc_get_blue_gain
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|manual_blue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|mode
op_eq
id|PWC_WB_AUTO
)paren
(brace
id|ret
op_assign
id|pwc_read_red_gain
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|read_red
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|pwc_read_blue_gain
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wb
)paren
dot
id|read_blue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
)brace
id|ARG_OUT
c_func
(paren
id|wb
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSAWBSPEED
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_wb_speed
comma
id|wbs
)paren
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_speed
OG
l_int|0
)paren
(brace
id|ret
op_assign
id|pwc_set_wb_speed
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_speed
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_delay
OG
l_int|0
)paren
(brace
id|ret
op_assign
id|pwc_set_wb_delay
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_delay
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGAWBSPEED
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_wb_speed
comma
id|wbs
)paren
id|ret
op_assign
id|pwc_get_wb_speed
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_speed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
id|ret
op_assign
id|pwc_get_wb_delay
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|wbs
)paren
dot
id|control_delay
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|wbs
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSLED
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_leds
comma
id|leds
)paren
id|ARG_IN
c_func
(paren
id|leds
)paren
id|ret
op_assign
id|pwc_set_leds
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|leds
)paren
dot
id|led_on
comma
id|ARGR
c_func
(paren
id|leds
)paren
dot
id|led_off
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGLED
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_leds
comma
id|leds
)paren
id|ret
op_assign
id|pwc_get_leds
c_func
(paren
id|pdev
comma
op_amp
id|ARGR
c_func
(paren
id|leds
)paren
dot
id|led_on
comma
op_amp
id|ARGR
c_func
(paren
id|leds
)paren
dot
id|led_off
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|leds
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSCONTOUR
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|contour
)paren
id|ARG_IN
c_func
(paren
id|contour
)paren
id|ret
op_assign
id|pwc_set_contour
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|contour
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGCONTOUR
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|contour
)paren
id|ret
op_assign
id|pwc_get_contour
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|contour
)paren
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|contour
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSBACKLIGHT
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|backlight
)paren
id|ARG_IN
c_func
(paren
id|backlight
)paren
id|ret
op_assign
id|pwc_set_backlight
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|backlight
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGBACKLIGHT
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|backlight
)paren
id|ret
op_assign
id|pwc_get_backlight
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|backlight
)paren
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|backlight
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSFLICKER
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|flicker
)paren
id|ARG_IN
c_func
(paren
id|flicker
)paren
id|ret
op_assign
id|pwc_set_flicker
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|flicker
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGFLICKER
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|flicker
)paren
id|ret
op_assign
id|pwc_get_flicker
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|flicker
)paren
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|flicker
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCSDYNNOISE
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|dynnoise
)paren
id|ARG_IN
c_func
(paren
id|dynnoise
)paren
id|ret
op_assign
id|pwc_set_dynamic_noise
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|dynnoise
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGDYNNOISE
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|dynnoise
)paren
id|ret
op_assign
id|pwc_get_dynamic_noise
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|dynnoise
)paren
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|dynnoise
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGREALSIZE
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_imagesize
comma
id|size
)paren
id|ARGR
c_func
(paren
id|size
)paren
dot
id|width
op_assign
id|pdev-&gt;image.x
suffix:semicolon
id|ARGR
c_func
(paren
id|size
)paren
dot
id|height
op_assign
id|pdev-&gt;image.y
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|size
)paren
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCMPTRESET
suffix:colon
(brace
r_if
c_cond
(paren
id|pdev-&gt;features
op_amp
id|FEATURE_MOTOR_PANTILT
)paren
(brace
id|ARG_DEF
c_func
(paren
r_int
comma
id|flags
)paren
id|ARG_IN
c_func
(paren
id|flags
)paren
id|ret
op_assign
id|pwc_mpt_reset
c_func
(paren
id|pdev
comma
id|ARGR
c_func
(paren
id|flags
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
)paren
(brace
id|pdev-&gt;pan_angle
op_assign
l_int|0
suffix:semicolon
id|pdev-&gt;tilt_angle
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCMPTGRANGE
suffix:colon
(brace
r_if
c_cond
(paren
id|pdev-&gt;features
op_amp
id|FEATURE_MOTOR_PANTILT
)paren
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_mpt_range
comma
id|range
)paren
id|ARGR
c_func
(paren
id|range
)paren
op_assign
id|pdev-&gt;angle_range
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|range
)paren
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCMPTSANGLE
suffix:colon
(brace
r_int
id|new_pan
comma
id|new_tilt
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;features
op_amp
id|FEATURE_MOTOR_PANTILT
)paren
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_mpt_angles
comma
id|angles
)paren
id|ARG_IN
c_func
(paren
id|angles
)paren
multiline_comment|/* The camera can only set relative angles, so&n;&t;&t;&t;   do some calculations when getting an absolute angle .&n;&t;&t;&t; */
r_if
c_cond
(paren
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|absolute
)paren
(brace
id|new_pan
op_assign
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|pan
suffix:semicolon
id|new_tilt
op_assign
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|tilt
suffix:semicolon
)brace
r_else
(brace
id|new_pan
op_assign
id|pdev-&gt;pan_angle
op_plus
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|pan
suffix:semicolon
id|new_tilt
op_assign
id|pdev-&gt;tilt_angle
op_plus
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|tilt
suffix:semicolon
)brace
multiline_comment|/* check absolute ranges */
r_if
c_cond
(paren
id|new_pan
template_param
id|pdev-&gt;angle_range.pan_max
op_logical_or
id|new_tilt
template_param
id|pdev-&gt;angle_range.tilt_max
)paren
(brace
id|ret
op_assign
op_minus
id|ERANGE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* go to relative range, check again */
id|new_pan
op_sub_assign
id|pdev-&gt;pan_angle
suffix:semicolon
id|new_tilt
op_sub_assign
id|pdev-&gt;tilt_angle
suffix:semicolon
multiline_comment|/* angles are specified in degrees * 100, thus the limit = 36000 */
r_if
c_cond
(paren
id|new_pan
template_param
l_int|36000
op_logical_or
id|new_tilt
template_param
l_int|36000
)paren
id|ret
op_assign
op_minus
id|ERANGE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
multiline_comment|/* no errors so far */
(brace
id|ret
op_assign
id|pwc_mpt_set_angle
c_func
(paren
id|pdev
comma
id|new_pan
comma
id|new_tilt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
)paren
(brace
id|pdev-&gt;pan_angle
op_add_assign
id|new_pan
suffix:semicolon
id|pdev-&gt;tilt_angle
op_add_assign
id|new_tilt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|EPIPE
)paren
multiline_comment|/* stall -&gt; out of range */
id|ret
op_assign
op_minus
id|ERANGE
suffix:semicolon
)brace
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCMPTGANGLE
suffix:colon
(brace
r_if
c_cond
(paren
id|pdev-&gt;features
op_amp
id|FEATURE_MOTOR_PANTILT
)paren
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_mpt_angles
comma
id|angles
)paren
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|absolute
op_assign
l_int|1
suffix:semicolon
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|pan
op_assign
id|pdev-&gt;pan_angle
suffix:semicolon
id|ARGR
c_func
(paren
id|angles
)paren
dot
id|tilt
op_assign
id|pdev-&gt;tilt_angle
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|angles
)paren
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCMPTSTATUS
suffix:colon
(brace
r_if
c_cond
(paren
id|pdev-&gt;features
op_amp
id|FEATURE_MOTOR_PANTILT
)paren
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_mpt_status
comma
id|status
)paren
id|ret
op_assign
id|pwc_mpt_get_status
c_func
(paren
id|pdev
comma
id|ARGA
c_func
(paren
id|status
)paren
)paren
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|status
)paren
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCPWCGVIDCMD
suffix:colon
(brace
id|ARG_DEF
c_func
(paren
r_struct
id|pwc_video_command
comma
id|cmd
)paren
suffix:semicolon
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|type
op_assign
id|pdev-&gt;type
suffix:semicolon
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|release
op_assign
id|pdev-&gt;release
suffix:semicolon
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|command_len
op_assign
id|pdev-&gt;cmd_len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|command_buf
comma
id|pdev-&gt;cmd_buf
comma
id|pdev-&gt;cmd_len
)paren
suffix:semicolon
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|bandlength
op_assign
id|pdev-&gt;vbandlength
suffix:semicolon
id|ARGR
c_func
(paren
id|cmd
)paren
dot
id|frame_size
op_assign
id|pdev-&gt;frame_size
suffix:semicolon
id|ARG_OUT
c_func
(paren
id|cmd
)paren
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ret
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
eof
