multiline_comment|/***************************************************************************&n; * Video4Linux driver for W996[87]CF JPEG USB Dual Mode Camera Chip.       *&n; *                                                                         *&n; * Copyright (C) 2002-2004 by Luca Risolia &lt;luca.risolia@studio.unibo.it&gt;  *&n; *                                                                         *&n; * - Memory management code from bttv driver by Ralph Metzler,             *&n; *   Marcus Metzler and Gerd Knorr.                                        *&n; * - I2C interface to kernel, high-level image sensor control routines and *&n; *   some symbolic names from OV511 driver by Mark W. McClelland.          *&n; * - Low-level I2C fast write function by Piotr Czerczak.                  *&n; * - Low-level I2C read function by Frederic Jouault.                      *&n; *                                                                         *&n; * This program is free software; you can redistribute it and/or modify    *&n; * it under the terms of the GNU General Public License as published by    *&n; * the Free Software Foundation; either version 2 of the License, or       *&n; * (at your option) any later version.                                     *&n; *                                                                         *&n; * This program is distributed in the hope that it will be useful,         *&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of          *&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           *&n; * GNU General Public License for more details.                            *&n; *                                                                         *&n; * You should have received a copy of the GNU General Public License       *&n; * along with this program; if not, write to the Free Software             *&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.               *&n; ***************************************************************************/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/page-flags.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &quot;w9968cf.h&quot;
macro_line|#include &quot;w9968cf_decoder.h&quot;
multiline_comment|/****************************************************************************&n; * Module macros and parameters                                             *&n; ****************************************************************************/
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|winbond_id_table
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
id|W9968CF_MODULE_AUTHOR
l_string|&quot; &quot;
id|W9968CF_AUTHOR_EMAIL
)paren
suffix:semicolon
DECL|variable|W9968CF_MODULE_NAME
id|MODULE_DESCRIPTION
c_func
(paren
id|W9968CF_MODULE_NAME
)paren
suffix:semicolon
DECL|variable|W9968CF_MODULE_VERSION
id|MODULE_VERSION
c_func
(paren
id|W9968CF_MODULE_VERSION
)paren
suffix:semicolon
DECL|variable|W9968CF_MODULE_LICENSE
id|MODULE_LICENSE
c_func
(paren
id|W9968CF_MODULE_LICENSE
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;Video&quot;
)paren
suffix:semicolon
DECL|variable|ovmod_load
r_static
r_int
id|ovmod_load
op_assign
id|W9968CF_OVMOD_LOAD
suffix:semicolon
DECL|variable|vppmod_load
r_static
r_int
id|vppmod_load
op_assign
id|W9968CF_VPPMOD_LOAD
suffix:semicolon
DECL|variable|simcams
r_static
r_int
r_int
id|simcams
op_assign
id|W9968CF_SIMCAMS
suffix:semicolon
DECL|variable|video_nr
r_static
r_int
id|video_nr
(braket
)braket
op_assign
initialization_block
suffix:semicolon
multiline_comment|/*-1=first free*/
DECL|variable|packet_size
r_static
r_int
r_int
id|packet_size
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_PACKET_SIZE
)brace
suffix:semicolon
DECL|variable|max_buffers
r_static
r_int
r_int
id|max_buffers
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_BUFFERS
)brace
suffix:semicolon
DECL|variable|double_buffer
r_static
r_int
id|double_buffer
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_DOUBLE_BUFFER
)brace
suffix:semicolon
DECL|variable|clamping
r_static
r_int
id|clamping
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_CLAMPING
)brace
suffix:semicolon
DECL|variable|filter_type
r_static
r_int
r_int
id|filter_type
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_FILTER_TYPE
)brace
suffix:semicolon
DECL|variable|largeview
r_static
r_int
id|largeview
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_LARGEVIEW
)brace
suffix:semicolon
DECL|variable|decompression
r_static
r_int
r_int
id|decompression
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_DECOMPRESSION
)brace
suffix:semicolon
DECL|variable|upscaling
r_static
r_int
id|upscaling
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_UPSCALING
)brace
suffix:semicolon
DECL|variable|force_palette
r_static
r_int
r_int
id|force_palette
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|force_rgb
r_static
r_int
id|force_rgb
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_FORCE_RGB
)brace
suffix:semicolon
DECL|variable|autobright
r_static
r_int
id|autobright
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_AUTOBRIGHT
)brace
suffix:semicolon
DECL|variable|autoexp
r_static
r_int
id|autoexp
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_AUTOEXP
)brace
suffix:semicolon
DECL|variable|lightfreq
r_static
r_int
r_int
id|lightfreq
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_LIGHTFREQ
)brace
suffix:semicolon
DECL|variable|bandingfilter
r_static
r_int
id|bandingfilter
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_BANDINGFILTER
)brace
suffix:semicolon
DECL|variable|clockdiv
r_static
r_int
id|clockdiv
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_CLOCKDIV
)brace
suffix:semicolon
DECL|variable|backlight
r_static
r_int
id|backlight
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_BACKLIGHT
)brace
suffix:semicolon
DECL|variable|mirror
r_static
r_int
id|mirror
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_MIRROR
)brace
suffix:semicolon
DECL|variable|monochrome
r_static
r_int
id|monochrome
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_MONOCHROME
)brace
suffix:semicolon
DECL|variable|brightness
r_static
r_int
r_int
id|brightness
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_BRIGHTNESS
)brace
suffix:semicolon
DECL|variable|hue
r_static
r_int
r_int
id|hue
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_HUE
)brace
suffix:semicolon
DECL|variable|colour
r_static
r_int
r_int
id|colour
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|variable|contrast
r_static
r_int
r_int
id|contrast
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_CONTRAST
)brace
suffix:semicolon
DECL|variable|whiteness
r_static
r_int
r_int
id|whiteness
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
id|W9968CF_WHITENESS
)brace
suffix:semicolon
macro_line|#ifdef W9968CF_DEBUG
DECL|variable|debug
r_static
r_int
r_int
id|debug
op_assign
id|W9968CF_DEBUG_LEVEL
suffix:semicolon
DECL|variable|specific_debug
r_static
r_int
id|specific_debug
op_assign
id|W9968CF_SPECIFIC_DEBUG
suffix:semicolon
macro_line|#endif
DECL|variable|param_nv
r_static
r_int
r_int
id|param_nv
(braket
l_int|24
)braket
suffix:semicolon
multiline_comment|/* number of values per parameter */
macro_line|#ifdef CONFIG_KMOD
id|module_param
c_func
(paren
id|ovmod_load
comma
r_bool
comma
l_int|0644
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|vppmod_load
comma
r_bool
comma
l_int|0444
)paren
suffix:semicolon
macro_line|#endif
id|module_param
c_func
(paren
id|simcams
comma
id|ushort
comma
l_int|0644
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|video_nr
comma
r_int
comma
op_amp
id|param_nv
(braket
l_int|0
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|packet_size
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|1
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|max_buffers
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|2
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|double_buffer
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|3
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|clamping
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|4
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|filter_type
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|5
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|largeview
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|6
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|decompression
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|7
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|upscaling
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|8
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|force_palette
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|9
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|force_rgb
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|10
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|autobright
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|11
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|autoexp
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|12
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|lightfreq
comma
id|ushort
comma
op_amp
id|param_nv
(braket
l_int|13
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|bandingfilter
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|14
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|clockdiv
comma
r_int
comma
op_amp
id|param_nv
(braket
l_int|15
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|backlight
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|16
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|mirror
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|17
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|monochrome
comma
r_bool
comma
op_amp
id|param_nv
(braket
l_int|18
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|brightness
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|19
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|hue
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|20
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|colour
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|21
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|contrast
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|22
)braket
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|whiteness
comma
id|uint
comma
op_amp
id|param_nv
(braket
l_int|23
)braket
comma
l_int|0444
)paren
suffix:semicolon
macro_line|#ifdef W9968CF_DEBUG
id|module_param
c_func
(paren
id|debug
comma
id|ushort
comma
l_int|0644
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|specific_debug
comma
r_bool
comma
l_int|0644
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_KMOD
id|MODULE_PARM_DESC
c_func
(paren
id|ovmod_load
comma
l_string|&quot;&bslash;n&lt;0|1&gt; Automatic &squot;ovcamchip&squot; module loading.&quot;
l_string|&quot;&bslash;n0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nIf enabled,&squot;insmod&squot; searches for the required &squot;ovcamchip&squot;&quot;
l_string|&quot;&bslash;nmodule in the system, according to its configuration, and&quot;
l_string|&quot;&bslash;nattempts to load that module automatically. This action is&quot;
l_string|&quot;&bslash;nperformed once as soon as the &squot;w9968cf&squot; module is loaded&quot;
l_string|&quot;&bslash;ninto memory.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_OVMOD_LOAD
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vppmod_load
comma
l_string|&quot;&bslash;n&lt;0|1&gt; Automatic &squot;w9968cf-vpp&squot; module loading.&quot;
l_string|&quot;&bslash;n0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nIf enabled, every time an application attempts to open a&quot;
l_string|&quot;&bslash;ncamera, &squot;insmod&squot; searches for the video post-processing&quot;
l_string|&quot;&bslash;nmodule in the system and loads it automatically (if&quot;
l_string|&quot;&bslash;npresent). The optional &squot;w9968cf-vpp&squot; module adds extra&quot;
l_string|&quot;&bslash;n image manipulation functions to the &squot;w9968cf&squot; module,like&quot;
l_string|&quot;&bslash;nsoftware up-scaling,colour conversions and video decoding&quot;
l_string|&quot;&bslash;nfor very high frame rates.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_VPPMOD_LOAD
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM_DESC
c_func
(paren
id|simcams
comma
l_string|&quot;&bslash;n&lt;n&gt; Number of cameras allowed to stream simultaneously.&quot;
l_string|&quot;&bslash;nn may vary from 0 to &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_MAX_DEVICES
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_SIMCAMS
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|video_nr
comma
l_string|&quot;&bslash;n&lt;-1|n[,...]&gt; Specify V4L minor mode number.&quot;
l_string|&quot;&bslash;n -1 = use next available (default)&quot;
l_string|&quot;&bslash;n  n = use minor number n (integer &gt;= 0)&quot;
l_string|&quot;&bslash;nYou can specify up to &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_MAX_DEVICES
)paren
l_string|&quot; cameras this way.&quot;
l_string|&quot;&bslash;nFor example:&quot;
l_string|&quot;&bslash;nvideo_nr=-1,2,-1 would assign minor number 2 to&quot;
l_string|&quot;&bslash;nthe second camera and use auto for the first&quot;
l_string|&quot;&bslash;none and for every other camera.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|packet_size
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Specify the maximum data payload&quot;
l_string|&quot;&bslash;nsize in bytes for alternate settings, for each device.&quot;
l_string|&quot;&bslash;nn is scaled between 63 and 1023 &quot;
l_string|&quot;(default is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_PACKET_SIZE
)paren
l_string|&quot;).&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_buffers
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; For advanced users.&quot;
l_string|&quot;&bslash;nSpecify the maximum number of video frame buffers&quot;
l_string|&quot;&bslash;nto allocate for each device, from 2 to &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_MAX_BUFFERS
)paren
l_string|&quot;. (default is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_BUFFERS
)paren
l_string|&quot;).&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|double_buffer
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; &quot;
l_string|&quot;Hardware double buffering: 0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nIt should be enabled if you want smooth video output: if&quot;
l_string|&quot;&bslash;nyou obtain out of sync. video, disable it, or try to&quot;
l_string|&quot;&bslash;ndecrease the &squot;clockdiv&squot; module parameter value.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_DOUBLE_BUFFER
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|clamping
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Video data clamping: 0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_CLAMPING
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|filter_type
comma
l_string|&quot;&bslash;n&lt;0|1|2[,...]&gt; Video filter type.&quot;
l_string|&quot;&bslash;n0 none, 1 (1-2-1) 3-tap filter, &quot;
l_string|&quot;2 (2-3-6-3-2) 5-tap filter.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_FILTER_TYPE
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;nThe filter is used to reduce noise and aliasing artifacts&quot;
l_string|&quot;&bslash;nproduced by the CCD or CMOS image sensor, and the scaling&quot;
l_string|&quot; process.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|largeview
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Large view: 0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_LARGEVIEW
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|upscaling
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Software scaling (for non-compressed video):&quot;
l_string|&quot;&bslash;n0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nDisable it if you have a slow CPU or you don&squot;t have&quot;
l_string|&quot; enough memory.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_UPSCALING
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;nIf &squot;w9968cf-vpp&squot; is not present, this parameter is&quot;
l_string|&quot; set to 0.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|decompression
comma
l_string|&quot;&bslash;n&lt;0|1|2[,...]&gt; Software video decompression:&quot;
l_string|&quot;&bslash;n- 0 disables decompression (doesn&squot;t allow formats needing&quot;
l_string|&quot; decompression)&quot;
l_string|&quot;&bslash;n- 1 forces decompression (allows formats needing&quot;
l_string|&quot; decompression only);&quot;
l_string|&quot;&bslash;n- 2 allows any permitted formats.&quot;
l_string|&quot;&bslash;nFormats supporting compressed video are YUV422P and&quot;
l_string|&quot; YUV420P/YUV420 &quot;
l_string|&quot;&bslash;nin any resolutions where both width and height are &quot;
l_string|&quot;a multiple of 16.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_DECOMPRESSION
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;nIf &squot;w9968cf-vpp&squot; is not present, forcing decompression is &quot;
l_string|&quot;&bslash;nnot allowed; in this case this parameter is set to 2.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_palette
comma
l_string|&quot;&bslash;n&lt;0&quot;
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_UYVY
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_YUV420
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_YUV422P
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_YUV420P
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_YUYV
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_YUV422
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_GREY
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_RGB555
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_RGB565
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_RGB24
)paren
l_string|&quot;|&quot;
id|__MODULE_STRING
c_func
(paren
id|VIDEO_PALETTE_RGB32
)paren
l_string|&quot;[,...]&gt;&quot;
l_string|&quot; Force picture palette.&quot;
l_string|&quot;&bslash;nIn order:&quot;
l_string|&quot;&bslash;n- 0 allows any of the following formats:&quot;
l_string|&quot;&bslash;n- UYVY    16 bpp - Original video, compression disabled&quot;
l_string|&quot;&bslash;n- YUV420  12 bpp - Original video, compression enabled&quot;
l_string|&quot;&bslash;n- YUV422P 16 bpp - Original video, compression enabled&quot;
l_string|&quot;&bslash;n- YUV420P 12 bpp - Original video, compression enabled&quot;
l_string|&quot;&bslash;n- YUVY    16 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- YUV422  16 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- GREY     8 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- RGB555  16 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- RGB565  16 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- RGB24   24 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;n- RGB32   32 bpp - Software conversion from UYVY&quot;
l_string|&quot;&bslash;nWhen not 0, this parameter will override &squot;decompression&squot;.&quot;
l_string|&quot;&bslash;nDefault value is 0 for every device.&quot;
l_string|&quot;&bslash;nInitial palette is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_PALETTE_DECOMP_ON
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;nIf &squot;w9968cf-vpp&squot; is not present, this parameter is&quot;
l_string|&quot; set to 9 (UYVY).&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_rgb
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Read RGB video data instead of BGR:&quot;
l_string|&quot;&bslash;n 1 = use RGB component ordering.&quot;
l_string|&quot;&bslash;n 0 = use BGR component ordering.&quot;
l_string|&quot;&bslash;nThis parameter has effect when using RGBX palettes only.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_FORCE_RGB
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|autobright
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Image sensor automatically changes brightness:&quot;
l_string|&quot;&bslash;n 0 = no, 1 = yes&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_AUTOBRIGHT
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|autoexp
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Image sensor automatically changes exposure:&quot;
l_string|&quot;&bslash;n 0 = no, 1 = yes&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_AUTOEXP
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|lightfreq
comma
l_string|&quot;&bslash;n&lt;50|60[,...]&gt; Light frequency in Hz:&quot;
l_string|&quot;&bslash;n 50 for European and Asian lighting,&quot;
l_string|&quot; 60 for American lighting.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_LIGHTFREQ
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bandingfilter
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Banding filter to reduce effects of&quot;
l_string|&quot; fluorescent lighting:&quot;
l_string|&quot;&bslash;n 0 disabled, 1 enabled.&quot;
l_string|&quot;&bslash;nThis filter tries to reduce the pattern of horizontal&quot;
l_string|&quot;&bslash;nlight/dark bands caused by some (usually fluorescent)&quot;
l_string|&quot; lighting.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_BANDINGFILTER
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|clockdiv
comma
l_string|&quot;&bslash;n&lt;-1|n[,...]&gt; &quot;
l_string|&quot;Force pixel clock divisor to a specific value (for experts):&quot;
l_string|&quot;&bslash;n  n may vary from 0 to 127.&quot;
l_string|&quot;&bslash;n -1 for automatic value.&quot;
l_string|&quot;&bslash;nSee also the &squot;double_buffer&squot; module parameter.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_CLOCKDIV
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|backlight
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Objects are lit from behind:&quot;
l_string|&quot;&bslash;n 0 = no, 1 = yes&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_BACKLIGHT
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mirror
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Reverse image horizontally:&quot;
l_string|&quot;&bslash;n 0 = no, 1 = yes&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_MIRROR
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|monochrome
comma
l_string|&quot;&bslash;n&lt;0|1[,...]&gt; Use image sensor as monochrome sensor:&quot;
l_string|&quot;&bslash;n 0 = no, 1 = yes&quot;
l_string|&quot;&bslash;nNot all the sensors support monochrome color.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_MONOCHROME
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|brightness
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Set picture brightness (0-65535).&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_BRIGHTNESS
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;nThis parameter has no effect if &squot;autobright&squot; is enabled.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|hue
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Set picture hue (0-65535).&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_HUE
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|colour
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Set picture saturation (0-65535).&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_COLOUR
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|contrast
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Set picture contrast (0-65535).&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_CONTRAST
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|whiteness
comma
l_string|&quot;&bslash;n&lt;n[,...]&gt; Set picture whiteness (0-65535).&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_WHITENESS
)paren
l_string|&quot; for every device.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef W9968CF_DEBUG
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;&bslash;n&lt;n&gt; Debugging information level, from 0 to 6:&quot;
l_string|&quot;&bslash;n0 = none (use carefully)&quot;
l_string|&quot;&bslash;n1 = critical errors&quot;
l_string|&quot;&bslash;n2 = significant informations&quot;
l_string|&quot;&bslash;n3 = configuration or general messages&quot;
l_string|&quot;&bslash;n4 = warnings&quot;
l_string|&quot;&bslash;n5 = called functions&quot;
l_string|&quot;&bslash;n6 = function internals&quot;
l_string|&quot;&bslash;nLevel 5 and 6 are useful for testing only, when only &quot;
l_string|&quot;one device is used.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_DEBUG_LEVEL
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|specific_debug
comma
l_string|&quot;&bslash;n&lt;0|1&gt; Enable or disable specific debugging messages:&quot;
l_string|&quot;&bslash;n0 = print messages concerning every level&quot;
l_string|&quot; &lt;= &squot;debug&squot; level.&quot;
l_string|&quot;&bslash;n1 = print messages concerning the level&quot;
l_string|&quot; indicated by &squot;debug&squot;.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|W9968CF_SPECIFIC_DEBUG
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif /* W9968CF_DEBUG */
multiline_comment|/****************************************************************************&n; * Some prototypes                                                          *&n; ****************************************************************************/
multiline_comment|/* Video4linux interface */
DECL|variable|w9968cf_fops
r_static
r_struct
id|file_operations
id|w9968cf_fops
suffix:semicolon
r_static
r_int
id|w9968cf_open
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_release
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_mmap
c_func
(paren
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
id|ssize_t
id|w9968cf_read
c_func
(paren
r_struct
id|file
op_star
comma
r_char
id|__user
op_star
comma
r_int
comma
id|loff_t
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_v4l_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_void
id|__user
op_star
)paren
suffix:semicolon
multiline_comment|/* USB-specific */
r_static
r_int
id|w9968cf_start_transfer
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_stop_transfer
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_write_reg
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|value
comma
id|u16
id|index
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_read_reg
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|index
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_write_fsb
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_write_sb
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|value
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_read_sb
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_upload_quantizationtables
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_urb_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
multiline_comment|/* Low-level I2C (SMBus) I/O */
r_static
r_int
id|w9968cf_smbus_start
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_stop
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_write_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u8
id|v
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_read_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u8
op_star
id|v
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_write_ack
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_read_ack
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_smbus_refresh_bus
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_adap_read_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|address
comma
id|u8
op_star
id|value
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_adap_read_byte_data
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|address
comma
id|u8
id|subaddress
comma
id|u8
op_star
id|value
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_adap_write_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|address
comma
id|u8
id|subaddress
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_adap_fastwrite_byte_data
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
id|address
comma
id|u8
id|subaddress
comma
id|u8
id|value
)paren
suffix:semicolon
multiline_comment|/* I2C interface to kernel */
r_static
r_int
id|w9968cf_i2c_init
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_smbus_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
)paren
suffix:semicolon
r_static
id|u32
id|w9968cf_i2c_func
c_func
(paren
r_struct
id|i2c_adapter
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_attach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_detach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_i2c_control
c_func
(paren
r_struct
id|i2c_adapter
op_star
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
multiline_comment|/* Memory management */
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
r_int
id|size
)paren
suffix:semicolon
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_deallocate_memory
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_allocate_memory
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
multiline_comment|/* High-level image sensor control functions */
r_static
r_int
id|w9968cf_sensor_set_control
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_int
id|cid
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_get_control
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_int
id|cid
comma
r_int
op_star
id|val
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_cmd
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_init
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_update_settings
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_get_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_sensor_update_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|video_picture
id|pict
)paren
suffix:semicolon
multiline_comment|/* Other helper functions */
r_static
r_void
id|w9968cf_configure_camera
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|usb_device
op_star
comma
r_enum
id|w9968cf_model_id
comma
r_const
r_int
r_int
id|dev_nr
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_adjust_configuration
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_turn_on_led
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_init_chip
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_inline
id|u16
id|w9968cf_valid_palette
c_func
(paren
id|u16
id|palette
)paren
suffix:semicolon
r_static
r_inline
id|u16
id|w9968cf_valid_depth
c_func
(paren
id|u16
id|palette
)paren
suffix:semicolon
r_static
r_inline
id|u8
id|w9968cf_need_decompression
c_func
(paren
id|u16
id|palette
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_set_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|video_picture
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_set_window
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|video_window
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_postprocess_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|w9968cf_frame_t
op_star
)paren
suffix:semicolon
r_static
r_int
id|w9968cf_adjust_window_size
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u16
op_star
id|w
comma
id|u16
op_star
id|h
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_init_framelist
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_push_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
id|u8
id|f_num
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_pop_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
comma
r_struct
id|w9968cf_frame_t
op_star
op_star
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_release_resources
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
multiline_comment|/* Intermodule communication */
r_static
r_int
id|w9968cf_vppmod_detect
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|w9968cf_vppmod_release
c_func
(paren
r_struct
id|w9968cf_device
op_star
)paren
suffix:semicolon
multiline_comment|/****************************************************************************&n; * Symbolic names                                                           *&n; ****************************************************************************/
multiline_comment|/* Used to represent a list of values and their respective symbolic names */
DECL|struct|w9968cf_symbolic_list
r_struct
id|w9968cf_symbolic_list
(brace
DECL|member|num
r_const
r_int
id|num
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*-------------------------------------------------------------------------- &n;  Returns the name of the matching element in the symbolic_list array. The&n;  end of the list must be marked with an element that has a NULL name.&n;  --------------------------------------------------------------------------*/
r_static
r_inline
r_const
r_char
op_star
DECL|function|symbolic
id|symbolic
c_func
(paren
r_struct
id|w9968cf_symbolic_list
id|list
(braket
)braket
comma
r_const
r_int
id|num
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|list
(braket
id|i
)braket
dot
id|name
op_ne
l_int|NULL
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|list
(braket
id|i
)braket
dot
id|num
op_eq
id|num
)paren
r_return
(paren
id|list
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
r_return
l_string|&quot;Unknown&quot;
suffix:semicolon
)brace
DECL|variable|camlist
r_static
r_struct
id|w9968cf_symbolic_list
id|camlist
(braket
)braket
op_assign
(brace
(brace
id|W9968CF_MOD_GENERIC
comma
l_string|&quot;W996[87]CF JPEG USB Dual Mode Camera&quot;
)brace
comma
(brace
id|W9968CF_MOD_CLVBWGP
comma
l_string|&quot;Creative Labs Video Blaster WebCam Go Plus&quot;
)brace
comma
multiline_comment|/* Other cameras (having the same descriptors as Generic W996[87]CF) */
(brace
id|W9968CF_MOD_ADPVDMA
comma
l_string|&quot;Aroma Digi Pen VGA Dual Mode ADG-5000&quot;
)brace
comma
(brace
id|W9986CF_MOD_AAU
comma
l_string|&quot;AVerMedia AVerTV USB&quot;
)brace
comma
(brace
id|W9968CF_MOD_CLVBWG
comma
l_string|&quot;Creative Labs Video Blaster WebCam Go&quot;
)brace
comma
(brace
id|W9968CF_MOD_LL
comma
l_string|&quot;Lebon LDC-035A&quot;
)brace
comma
(brace
id|W9968CF_MOD_EEEMC
comma
l_string|&quot;Ezonics EZ-802 EZMega Cam&quot;
)brace
comma
(brace
id|W9968CF_MOD_OOE
comma
l_string|&quot;OmniVision OV8610-EDE&quot;
)brace
comma
(brace
id|W9968CF_MOD_ODPVDMPC
comma
l_string|&quot;OPCOM Digi Pen VGA Dual Mode Pen Camera&quot;
)brace
comma
(brace
id|W9968CF_MOD_PDPII
comma
l_string|&quot;Pretec Digi Pen-II&quot;
)brace
comma
(brace
id|W9968CF_MOD_PDP480
comma
l_string|&quot;Pretec DigiPen-480&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|variable|senlist
r_static
r_struct
id|w9968cf_symbolic_list
id|senlist
(braket
)braket
op_assign
(brace
(brace
id|CC_OV76BE
comma
l_string|&quot;OV76BE&quot;
)brace
comma
(brace
id|CC_OV7610
comma
l_string|&quot;OV7610&quot;
)brace
comma
(brace
id|CC_OV7620
comma
l_string|&quot;OV7620&quot;
)brace
comma
(brace
id|CC_OV7620AE
comma
l_string|&quot;OV7620AE&quot;
)brace
comma
(brace
id|CC_OV6620
comma
l_string|&quot;OV6620&quot;
)brace
comma
(brace
id|CC_OV6630
comma
l_string|&quot;OV6630&quot;
)brace
comma
(brace
id|CC_OV6630AE
comma
l_string|&quot;OV6630AE&quot;
)brace
comma
(brace
id|CC_OV6630AF
comma
l_string|&quot;OV6630AF&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* Video4Linux1 palettes */
DECL|variable|v4l1_plist
r_static
r_struct
id|w9968cf_symbolic_list
id|v4l1_plist
(braket
)braket
op_assign
(brace
(brace
id|VIDEO_PALETTE_GREY
comma
l_string|&quot;GREY&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_HI240
comma
l_string|&quot;HI240&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_RGB565
comma
l_string|&quot;RGB565&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_RGB24
comma
l_string|&quot;RGB24&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_RGB32
comma
l_string|&quot;RGB32&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_RGB555
comma
l_string|&quot;RGB555&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV422
comma
l_string|&quot;YUV422&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUYV
comma
l_string|&quot;YUYV&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_UYVY
comma
l_string|&quot;UYVY&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV420
comma
l_string|&quot;YUV420&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV411
comma
l_string|&quot;YUV411&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_RAW
comma
l_string|&quot;RAW&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV422P
comma
l_string|&quot;YUV422P&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV411P
comma
l_string|&quot;YUV411P&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV420P
comma
l_string|&quot;YUV420P&quot;
)brace
comma
(brace
id|VIDEO_PALETTE_YUV410P
comma
l_string|&quot;YUV410P&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* Decoder error codes: */
DECL|variable|decoder_errlist
r_static
r_struct
id|w9968cf_symbolic_list
id|decoder_errlist
(braket
)braket
op_assign
(brace
(brace
id|W9968CF_DEC_ERR_CORRUPTED_DATA
comma
l_string|&quot;Corrupted data&quot;
)brace
comma
(brace
id|W9968CF_DEC_ERR_BUF_OVERFLOW
comma
l_string|&quot;Buffer overflow&quot;
)brace
comma
(brace
id|W9968CF_DEC_ERR_NO_SOI
comma
l_string|&quot;SOI marker not found&quot;
)brace
comma
(brace
id|W9968CF_DEC_ERR_NO_SOF0
comma
l_string|&quot;SOF0 marker not found&quot;
)brace
comma
(brace
id|W9968CF_DEC_ERR_NO_SOS
comma
l_string|&quot;SOS marker not found&quot;
)brace
comma
(brace
id|W9968CF_DEC_ERR_NO_EOI
comma
l_string|&quot;EOI marker not found&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* URB error codes: */
DECL|variable|urb_errlist
r_static
r_struct
id|w9968cf_symbolic_list
id|urb_errlist
(braket
)braket
op_assign
(brace
(brace
op_minus
id|ENOMEM
comma
l_string|&quot;No memory for allocation of internal structures&quot;
)brace
comma
(brace
op_minus
id|ENOSPC
comma
l_string|&quot;The host controller&squot;s bandwidth is already consumed&quot;
)brace
comma
(brace
op_minus
id|ENOENT
comma
l_string|&quot;URB was canceled by unlink_urb&quot;
)brace
comma
(brace
op_minus
id|EXDEV
comma
l_string|&quot;ISO transfer only partially completed&quot;
)brace
comma
(brace
op_minus
id|EAGAIN
comma
l_string|&quot;Too match scheduled for the future&quot;
)brace
comma
(brace
op_minus
id|ENXIO
comma
l_string|&quot;URB already queued&quot;
)brace
comma
(brace
op_minus
id|EFBIG
comma
l_string|&quot;Too much ISO frames requested&quot;
)brace
comma
(brace
op_minus
id|ENOSR
comma
l_string|&quot;Buffer error (overrun)&quot;
)brace
comma
(brace
op_minus
id|EPIPE
comma
l_string|&quot;Specified endpoint is stalled (device not responding)&quot;
)brace
comma
(brace
op_minus
id|EOVERFLOW
comma
l_string|&quot;Babble (bad cable?)&quot;
)brace
comma
(brace
op_minus
id|EPROTO
comma
l_string|&quot;Bit-stuff error (bad cable?)&quot;
)brace
comma
(brace
op_minus
id|EILSEQ
comma
l_string|&quot;CRC/Timeout&quot;
)brace
comma
(brace
op_minus
id|ETIMEDOUT
comma
l_string|&quot;NAK (device does not respond)&quot;
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/****************************************************************************&n; * Memory management functions                                              *&n; ****************************************************************************/
DECL|function|rvmalloc
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
r_int
r_int
id|adr
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|vmalloc_32
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* Clear the ram out, no junk to the user */
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|SetPageReserved
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|rvfree
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|adr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
(paren
r_int
)paren
id|size
OG
l_int|0
)paren
(brace
id|ClearPageReserved
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Deallocate previously allocated memory.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_deallocate_memory
r_static
r_void
id|w9968cf_deallocate_memory
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
id|u8
id|i
suffix:semicolon
multiline_comment|/* Free the isochronous transfer buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|W9968CF_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|kfree
c_func
(paren
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
)paren
suffix:semicolon
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Free temporary frame buffer */
r_if
c_cond
(paren
id|cam-&gt;frame_tmp.buffer
)paren
(brace
id|rvfree
c_func
(paren
id|cam-&gt;frame_tmp.buffer
comma
id|cam-&gt;frame_tmp.size
)paren
suffix:semicolon
id|cam-&gt;frame_tmp.buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Free helper buffer */
r_if
c_cond
(paren
id|cam-&gt;frame_vpp.buffer
)paren
(brace
id|rvfree
c_func
(paren
id|cam-&gt;frame_vpp.buffer
comma
id|cam-&gt;frame_vpp.size
)paren
suffix:semicolon
id|cam-&gt;frame_vpp.buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Free video frame buffers */
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
)paren
(brace
id|rvfree
c_func
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
comma
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|size
)paren
suffix:semicolon
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
id|cam-&gt;nbuffers
op_assign
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Memory successfully deallocated&quot;
)paren
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Allocate memory buffers for USB transfers and video frames.&n;  This function is called by open() only.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_allocate_memory
r_static
r_int
id|w9968cf_allocate_memory
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_const
id|u16
id|p_size
op_assign
id|wMaxPacketSize
(braket
id|cam-&gt;altsetting
op_minus
l_int|1
)braket
suffix:semicolon
r_void
op_star
id|buff
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|hw_bufsize
comma
id|vpp_bufsize
suffix:semicolon
id|u8
id|i
comma
id|bpp
suffix:semicolon
multiline_comment|/* NOTE: Deallocation is done elsewhere in case of error */
multiline_comment|/* Calculate the max amount of raw data per frame from the device */
id|hw_bufsize
op_assign
id|cam-&gt;maxwidth
op_star
id|cam-&gt;maxheight
op_star
l_int|2
suffix:semicolon
multiline_comment|/* Calculate the max buf. size needed for post-processing routines */
id|bpp
op_assign
(paren
id|w9968cf_vpp
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;upscaling
)paren
id|vpp_bufsize
op_assign
id|max
c_func
(paren
id|W9968CF_MAX_WIDTH
op_star
id|W9968CF_MAX_HEIGHT
op_star
id|bpp
comma
id|cam-&gt;maxwidth
op_star
id|cam-&gt;maxheight
op_star
id|bpp
)paren
suffix:semicolon
r_else
id|vpp_bufsize
op_assign
id|cam-&gt;maxwidth
op_star
id|cam-&gt;maxheight
op_star
id|bpp
suffix:semicolon
multiline_comment|/* Allocate memory for the isochronous transfer buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|W9968CF_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
id|W9968CF_ISO_PACKETS
op_star
id|p_size
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for the isochronous &quot;
l_string|&quot;transfer buffers (%u bytes)&quot;
comma
id|p_size
op_star
id|W9968CF_ISO_PACKETS
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
comma
l_int|0
comma
id|W9968CF_ISO_PACKETS
op_star
id|p_size
)paren
suffix:semicolon
)brace
multiline_comment|/* Allocate memory for the temporary frame buffer */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;frame_tmp.buffer
op_assign
id|rvmalloc
c_func
(paren
id|hw_bufsize
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for the temporary &quot;
l_string|&quot;video frame buffer (%lu bytes)&quot;
comma
id|hw_bufsize
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cam-&gt;frame_tmp.size
op_assign
id|hw_bufsize
suffix:semicolon
id|cam-&gt;frame_tmp.number
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Allocate memory for the helper buffer */
r_if
c_cond
(paren
id|w9968cf_vpp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;frame_vpp.buffer
op_assign
id|rvmalloc
c_func
(paren
id|vpp_bufsize
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for the helper buffer&quot;
l_string|&quot; (%lu bytes)&quot;
comma
id|vpp_bufsize
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cam-&gt;frame_vpp.size
op_assign
id|vpp_bufsize
suffix:semicolon
)brace
r_else
id|cam-&gt;frame_vpp.buffer
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Allocate memory for video frame buffers */
id|cam-&gt;nbuffers
op_assign
id|cam-&gt;max_buffers
suffix:semicolon
r_while
c_loop
(paren
id|cam-&gt;nbuffers
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|buff
op_assign
id|rvmalloc
c_func
(paren
id|cam-&gt;nbuffers
op_star
id|vpp_bufsize
)paren
)paren
)paren
r_break
suffix:semicolon
r_else
id|cam-&gt;nbuffers
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|buff
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for the video frame buffers&quot;
)paren
id|cam-&gt;nbuffers
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;nbuffers
op_ne
id|cam-&gt;max_buffers
)paren
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Couldn&squot;t allocate memory for %u video frame buffers. &quot;
l_string|&quot;Only memory for %u buffers has been allocated&quot;
comma
id|cam-&gt;max_buffers
comma
id|cam-&gt;nbuffers
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buffer
op_assign
id|buff
op_plus
id|i
op_star
id|vpp_bufsize
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|size
op_assign
id|vpp_bufsize
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|number
op_assign
id|i
suffix:semicolon
multiline_comment|/* Circular list */
r_if
c_cond
(paren
id|i
op_ne
id|cam-&gt;nbuffers
op_minus
l_int|1
)paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|next
op_assign
op_amp
id|cam-&gt;frame
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
r_else
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|next
op_assign
op_amp
id|cam-&gt;frame
(braket
l_int|0
)braket
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|status
op_assign
id|F_UNUSED
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Memory successfully allocated&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * USB-specific functions                                                   *&n; ****************************************************************************/
multiline_comment|/*--------------------------------------------------------------------------&n;  This is an handler function which is called after the URBs are completed.&n;  It collects multiple data packets coming from the camera by putting them&n;  into frame buffers: one or more zero data length data packets are used to&n;  mark the end of a video frame; the first non-zero data packet is the start&n;  of the next video frame; if an error is encountered in a packet, the entire&n;  video frame is discarded and grabbed again.&n;  If there are no requested frames in the FIFO list, packets are collected into&n;  a temporary buffer. &n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_urb_complete
r_static
r_void
id|w9968cf_urb_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|w9968cf_frame_t
op_star
op_star
id|f
suffix:semicolon
r_int
r_int
id|len
comma
id|status
suffix:semicolon
r_void
op_star
id|pos
suffix:semicolon
id|u8
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|cam-&gt;streaming
)paren
op_logical_or
id|cam-&gt;disconnected
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Got interrupt, but not streaming&quot;
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* &quot;(*f)&quot; will be used instead of &quot;cam-&gt;frame_current&quot; */
id|f
op_assign
op_amp
id|cam-&gt;frame_current
suffix:semicolon
multiline_comment|/* If a frame has been requested and we are grabbing into  &n;&t;   the temporary frame, we&squot;ll switch to that requested frame */
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_eq
op_amp
id|cam-&gt;frame_tmp
op_logical_and
op_star
id|cam-&gt;requested_frame
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;frame_tmp.status
op_eq
id|F_GRABBING
)paren
(brace
id|w9968cf_pop_frame
c_func
(paren
id|cam
comma
op_amp
id|cam-&gt;frame_current
)paren
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_GRABBING
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
op_assign
id|cam-&gt;frame_tmp.length
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buffer
comma
id|cam-&gt;frame_tmp.buffer
comma
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Switched from temp. frame to frame #%d&quot;
comma
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|number
)paren
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|urb-&gt;number_of_packets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
suffix:semicolon
id|status
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
suffix:semicolon
id|pos
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_plus
id|urb-&gt;transfer_buffer
suffix:semicolon
r_if
c_cond
(paren
id|status
op_logical_and
id|len
op_ne
l_int|0
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;URB failed, error in data packet &quot;
l_string|&quot;(error #%u, %s)&quot;
comma
id|status
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|status
)paren
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_ERROR
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
multiline_comment|/* start of frame */
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_eq
id|F_UNUSED
)paren
(brace
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_GRABBING
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Buffer overflows shouldn&squot;t happen, however...*/
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
op_plus
id|len
OG
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|size
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Buffer overflow: bad data packets&quot;
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_eq
id|F_GRABBING
)paren
(brace
id|memcpy
c_func
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buffer
op_plus
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
comma
id|pos
comma
id|len
)paren
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
op_add_assign
id|len
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_eq
id|F_GRABBING
)paren
(brace
multiline_comment|/* end of frame */
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Frame #%d successfully grabbed&quot;
comma
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|number
)paren
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
(brace
id|err
op_assign
id|w9968cf_vpp
op_member_access_from_pointer
id|check_headers
c_func
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buffer
comma
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Skip corrupted frame: %s&quot;
comma
id|symbolic
c_func
(paren
id|decoder_errlist
comma
id|err
)paren
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_UNUSED
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* grab this frame again */
)brace
)brace
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_READY
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|queued
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Take a pointer to the new frame from the FIFO list.&n;&t;&t;&t;   If the list is empty,we&squot;ll use the temporary frame*/
r_if
c_cond
(paren
op_star
id|cam-&gt;requested_frame
)paren
id|w9968cf_pop_frame
c_func
(paren
id|cam
comma
op_amp
id|cam-&gt;frame_current
)paren
suffix:semicolon
r_else
(brace
id|cam-&gt;frame_current
op_assign
op_amp
id|cam-&gt;frame_tmp
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_UNUSED
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_eq
id|F_ERROR
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
op_assign
id|F_UNUSED
suffix:semicolon
multiline_comment|/* grab it again */
id|PDBGG
c_func
(paren
l_string|&quot;Frame length %lu | pack.#%u | pack.len. %u | state %d&quot;
comma
(paren
r_int
r_int
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|length
comma
id|i
comma
id|len
comma
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|status
)paren
)brace
multiline_comment|/* end for */
multiline_comment|/* Resubmit this URB */
id|urb-&gt;dev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|urb-&gt;status
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cam-&gt;urb_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;streaming
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|cam-&gt;misconfigured
op_assign
l_int|1
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t resubmit the URB: error %d, %s&quot;
comma
id|err
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|err
)paren
)paren
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cam-&gt;urb_lock
)paren
suffix:semicolon
multiline_comment|/* Wake up the user process */
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_queue
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;  Setup the URB structures for the isochronous transfer.&n;  Submit the URBs so that the data transfer begins.&n;  Return 0 on success, a negative number otherwise.&n;  ---------------------------------------------------------------------------*/
DECL|function|w9968cf_start_transfer
r_static
r_int
id|w9968cf_start_transfer
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_const
id|u16
id|p_size
op_assign
id|wMaxPacketSize
(braket
id|cam-&gt;altsetting
op_minus
l_int|1
)braket
suffix:semicolon
id|u16
id|w
comma
id|h
comma
id|d
suffix:semicolon
r_int
id|vidcapt
suffix:semicolon
id|u32
id|t_size
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|s8
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|W9968CF_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
id|W9968CF_ISO_PACKETS
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cam-&gt;urb
(braket
id|i
)braket
op_assign
id|urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|j
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate the URB structures&quot;
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|udev
suffix:semicolon
id|urb-&gt;context
op_assign
(paren
r_void
op_star
)paren
id|cam
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|udev
comma
l_int|1
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|W9968CF_ISO_PACKETS
suffix:semicolon
id|urb-&gt;complete
op_assign
id|w9968cf_urb_complete
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|p_size
op_star
id|W9968CF_ISO_PACKETS
suffix:semicolon
id|urb-&gt;interval
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|W9968CF_ISO_PACKETS
suffix:semicolon
id|j
op_increment
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|offset
op_assign
id|p_size
op_star
id|j
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|length
op_assign
id|p_size
suffix:semicolon
)brace
)brace
multiline_comment|/* Transfer size per frame, in WORD ! */
id|d
op_assign
id|cam-&gt;hw_depth
suffix:semicolon
id|w
op_assign
id|cam-&gt;hw_width
suffix:semicolon
id|h
op_assign
id|cam-&gt;hw_height
suffix:semicolon
id|t_size
op_assign
(paren
id|w
op_star
id|h
op_star
id|d
)paren
op_div
l_int|16
suffix:semicolon
id|err
op_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xbf17
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* reset everything */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xbf10
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* normal operation */
multiline_comment|/* Transfer size */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|t_size
op_amp
l_int|0xffff
comma
l_int|0x3d
)paren
suffix:semicolon
multiline_comment|/* low bits */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|t_size
op_rshift
l_int|16
comma
l_int|0x3e
)paren
suffix:semicolon
multiline_comment|/* high bits */
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
id|err
op_add_assign
id|w9968cf_upload_quantizationtables
c_func
(paren
id|cam
)paren
suffix:semicolon
id|vidcapt
op_assign
id|w9968cf_read_reg
c_func
(paren
id|cam
comma
l_int|0x16
)paren
suffix:semicolon
multiline_comment|/* read picture settings */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|vidcapt
op_or
l_int|0x8000
comma
l_int|0x16
)paren
suffix:semicolon
multiline_comment|/* capt. enable */
id|err
op_add_assign
id|usb_set_interface
c_func
(paren
id|udev
comma
l_int|0
comma
id|cam-&gt;altsetting
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x8a05
comma
l_int|0x3c
)paren
suffix:semicolon
multiline_comment|/* USB FIFO enable */
r_if
c_cond
(paren
id|err
op_logical_or
(paren
id|vidcapt
OL
l_int|0
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|W9968CF_URBS
suffix:semicolon
id|i
op_increment
)paren
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t tell the camera to start the data transfer&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
id|w9968cf_init_framelist
c_func
(paren
id|cam
)paren
suffix:semicolon
multiline_comment|/* Begin to grab into the temporary buffer */
id|cam-&gt;frame_tmp.status
op_assign
id|F_UNUSED
suffix:semicolon
id|cam-&gt;frame_tmp.queued
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;frame_current
op_assign
op_amp
id|cam-&gt;frame_tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Isochronous transfer size: %lu bytes/frame&quot;
comma
(paren
r_int
r_int
)paren
id|t_size
op_star
l_int|2
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Starting the isochronous transfer...&quot;
)paren
id|cam-&gt;streaming
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Submit the URBs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|W9968CF_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;streaming
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|usb_kill_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|j
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t send a transfer request to the &quot;
l_string|&quot;USB core (error #%d, %s)&quot;
comma
id|err
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|err
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Stop the isochronous transfer and set alternate setting to 0 (0Mb/s).&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_stop_transfer
r_static
r_int
id|w9968cf_stop_transfer
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|s8
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;streaming
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* This avoids race conditions with usb_submit_urb() &n;&t;   in the URB completition handler */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;urb_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|cam-&gt;streaming
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;urb_lock
comma
id|lock_flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|W9968CF_URBS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
(brace
id|usb_kill_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|cam-&gt;urb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_goto
m_exit
suffix:semicolon
id|err
op_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0a05
comma
l_int|0x3c
)paren
suffix:semicolon
multiline_comment|/* stop USB transfer */
id|err
op_add_assign
id|usb_set_interface
c_func
(paren
id|udev
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* 0 Mb/s */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x39
)paren
suffix:semicolon
multiline_comment|/* disable JPEG encoder */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x16
)paren
suffix:semicolon
multiline_comment|/* stop video capture */
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Failed to tell the camera to stop the isochronous &quot;
l_string|&quot;transfer. However this is not a critical error.&quot;
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
m_exit
suffix:colon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Isochronous transfer stopped&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Write a W9968CF register. &n;  Return 0 on success, -1 otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_write_reg
r_static
r_int
id|w9968cf_write_reg
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|value
comma
id|u16
id|index
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
r_int
id|res
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0
comma
id|USB_TYPE_VENDOR
op_or
id|USB_DIR_OUT
op_or
id|USB_RECIP_DEVICE
comma
id|value
comma
id|index
comma
l_int|NULL
comma
l_int|0
comma
id|W9968CF_USB_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Failed to write a register &quot;
l_string|&quot;(value 0x%04X, index 0x%02X, error #%d, %s)&quot;
comma
id|value
comma
id|index
comma
id|res
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|res
)paren
)paren
r_return
(paren
id|res
op_ge
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Read a W9968CF register. &n;  Return the register value on success, -1 otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_read_reg
r_static
r_int
id|w9968cf_read_reg
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|index
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u16
op_star
id|buff
op_assign
id|cam-&gt;control_buffer
suffix:semicolon
r_int
id|res
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|1
comma
id|USB_DIR_IN
op_or
id|USB_TYPE_VENDOR
op_or
id|USB_RECIP_DEVICE
comma
l_int|0
comma
id|index
comma
id|buff
comma
l_int|2
comma
id|W9968CF_USB_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Failed to read a register &quot;
l_string|&quot;(index 0x%02X, error #%d, %s)&quot;
comma
id|index
comma
id|res
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|res
)paren
)paren
r_return
(paren
id|res
op_ge
l_int|0
)paren
ques
c_cond
(paren
r_int
)paren
(paren
op_star
id|buff
)paren
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Write 64-bit data to the fast serial bus registers.&n;  Return 0 on success, -1 otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_write_fsb
r_static
r_int
id|w9968cf_write_fsb
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
op_star
id|data
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u16
id|value
suffix:semicolon
r_int
id|res
suffix:semicolon
id|value
op_assign
op_star
id|data
op_increment
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0
comma
id|USB_TYPE_VENDOR
op_or
id|USB_DIR_OUT
op_or
id|USB_RECIP_DEVICE
comma
id|value
comma
l_int|0x06
comma
id|data
comma
l_int|6
comma
id|W9968CF_USB_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Failed to write the FSB registers &quot;
l_string|&quot;(error #%d, %s)&quot;
comma
id|res
comma
id|symbolic
c_func
(paren
id|urb_errlist
comma
id|res
)paren
)paren
r_return
(paren
id|res
op_ge
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Write data to the serial bus control register.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_write_sb
r_static
r_int
id|w9968cf_write_sb
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|value
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|value
comma
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|W9968CF_I2C_BUS_DELAY
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Read data from the serial bus control register.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_read_sb
r_static
r_int
id|w9968cf_read_sb
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|v
op_assign
l_int|0
suffix:semicolon
id|v
op_assign
id|w9968cf_read_reg
c_func
(paren
id|cam
comma
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|W9968CF_I2C_BUS_DELAY
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Upload quantization tables for the JPEG compression.&n;  This function is called by w9968cf_start_transfer().&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_upload_quantizationtables
r_static
r_int
id|w9968cf_upload_quantizationtables
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
id|u16
id|a
comma
id|b
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0010
comma
l_int|0x39
)paren
suffix:semicolon
multiline_comment|/* JPEG clock enable */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
comma
id|j
op_add_assign
l_int|2
)paren
(brace
id|a
op_assign
id|Y_QUANTABLE
(braket
id|j
)braket
op_or
(paren
(paren
r_int
)paren
(paren
id|Y_QUANTABLE
(braket
id|j
op_plus
l_int|1
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|b
op_assign
id|UV_QUANTABLE
(braket
id|j
)braket
op_or
(paren
(paren
r_int
)paren
(paren
id|UV_QUANTABLE
(braket
id|j
op_plus
l_int|1
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|a
comma
l_int|0x40
op_plus
id|i
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|b
comma
l_int|0x60
op_plus
id|i
)paren
suffix:semicolon
)brace
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0012
comma
l_int|0x39
)paren
suffix:semicolon
multiline_comment|/* JPEG encoder enable */
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Low-level I2C I/O functions.                                             *&n; * The adapter supports the following I2C transfer functions:               *&n; * i2c_adap_fastwrite_byte_data() (at 400 kHz bit frequency only)           *&n; * i2c_adap_read_byte_data()                                                *&n; * i2c_adap_read_byte()                                                     *&n; ****************************************************************************/
DECL|function|w9968cf_smbus_start
r_static
r_int
id|w9968cf_smbus_start
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0011
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=1 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0010
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=0 */
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_smbus_stop
r_static
r_int
id|w9968cf_smbus_stop
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0011
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=1 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0013
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=1, SCL=1 */
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_smbus_write_byte
r_static
r_int
id|w9968cf_smbus_write_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u8
id|v
)paren
(brace
id|u8
id|bit
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|sda
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
)paren
(brace
id|sda
op_assign
(paren
id|v
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
id|v
op_lshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* SDE=1, SDA=sda, SCL=0 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x10
op_or
id|sda
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=sda, SCL=1 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x11
op_or
id|sda
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=sda, SCL=0 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x10
op_or
id|sda
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_smbus_read_byte
r_static
r_int
id|w9968cf_smbus_read_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u8
op_star
id|v
)paren
(brace
id|u8
id|bit
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
op_star
id|v
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
)paren
(brace
op_star
id|v
op_lshift_assign
l_int|1
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0013
)paren
suffix:semicolon
op_star
id|v
op_or_assign
(paren
id|w9968cf_read_sb
c_func
(paren
id|cam
)paren
op_amp
l_int|0x0008
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0012
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_smbus_write_ack
r_static
r_int
id|w9968cf_smbus_write_ack
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0010
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=0 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0011
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=1 */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0010
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=0, SCL=0 */
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_smbus_read_ack
r_static
r_int
id|w9968cf_smbus_read_ack
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
comma
id|sda
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0013
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=1, SCL=1 */
id|sda
op_assign
(paren
id|w9968cf_read_sb
c_func
(paren
id|cam
)paren
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* sda = SDA */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0012
)paren
suffix:semicolon
multiline_comment|/* SDE=1, SDA=1, SCL=0 */
r_if
c_cond
(paren
id|sda
OL
l_int|0
)paren
id|err
op_add_assign
id|sda
suffix:semicolon
r_if
c_cond
(paren
id|sda
op_eq
l_int|1
)paren
(brace
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Couldn&squot;t receive the ACK&quot;
)paren
id|err
op_add_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* This seems to refresh the communication through the serial bus */
DECL|function|w9968cf_smbus_refresh_bus
r_static
r_int
id|w9968cf_smbus_refresh_bus
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
op_le
l_int|10
suffix:semicolon
id|j
op_increment
)paren
(brace
id|err
op_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0020
comma
l_int|0x01
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* SMBus protocol: S Addr Wr [A] Subaddr [A] Value [A] P */
r_static
r_int
DECL|function|w9968cf_i2c_adap_fastwrite_byte_data
id|w9968cf_i2c_adap_fastwrite_byte_data
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|address
comma
id|u8
id|subaddress
comma
id|u8
id|value
)paren
(brace
id|u16
op_star
id|data
op_assign
id|cam-&gt;data_buffer
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_refresh_bus
c_func
(paren
id|cam
)paren
suffix:semicolon
multiline_comment|/* Enable SBUS outputs */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0020
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0x082f
op_or
(paren
(paren
id|address
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|0x1500
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x40
)paren
ques
c_cond
l_int|0x4000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x2082
op_or
(paren
(paren
id|address
op_amp
l_int|0x40
)paren
ques
c_cond
l_int|0x0005
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x0150
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x10
)paren
ques
c_cond
l_int|0x5400
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
l_int|0x8208
op_or
(paren
(paren
id|address
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|0x0015
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|0x0540
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|0x5000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x1d20
op_or
(paren
(paren
id|address
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|0x0001
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_or_assign
(paren
id|address
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|0x0054
suffix:colon
l_int|0x0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_fsb
c_func
(paren
id|cam
comma
id|data
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0x8208
op_or
(paren
(paren
id|subaddress
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|0x0015
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x40
)paren
ques
c_cond
l_int|0x0540
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x5000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x0820
op_or
(paren
(paren
id|subaddress
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x0001
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x10
)paren
ques
c_cond
l_int|0x0054
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|0x1500
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|0x4000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
l_int|0x2082
op_or
(paren
(paren
id|subaddress
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|0x0005
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|0x0150
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|subaddress
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|0x5400
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0x001d
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_fsb
c_func
(paren
id|cam
comma
id|data
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
l_int|0x8208
op_or
(paren
(paren
id|value
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|0x0015
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x40
)paren
ques
c_cond
l_int|0x0540
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x5000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0x0820
op_or
(paren
(paren
id|value
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x0001
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x10
)paren
ques
c_cond
l_int|0x0054
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|0x1500
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|0x4000
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
l_int|0x2082
op_or
(paren
(paren
id|value
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|0x0005
suffix:colon
l_int|0x0
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|0x0150
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
(paren
id|value
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|0x5400
suffix:colon
l_int|0x0
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0xfe1d
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_fsb
c_func
(paren
id|cam
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Disable SBUS outputs */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C write byte data done, addr.0x%04X, subaddr.0x%02X &quot;
l_string|&quot;value 0x%02X&quot;
comma
id|address
comma
id|subaddress
comma
id|value
)paren
r_else
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C write byte data failed, addr.0x%04X, &quot;
l_string|&quot;subaddr.0x%02X, value 0x%02X&quot;
comma
id|address
comma
id|subaddress
comma
id|value
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* SMBus protocol: S Addr Wr [A] Subaddr [A] P S Addr+1 Rd [A] [Value] NA P */
r_static
r_int
DECL|function|w9968cf_i2c_adap_read_byte_data
id|w9968cf_i2c_adap_read_byte_data
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|address
comma
id|u8
id|subaddress
comma
id|u8
op_star
id|value
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Serial data enable */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0013
)paren
suffix:semicolon
multiline_comment|/* don&squot;t change ! */
id|err
op_add_assign
id|w9968cf_smbus_start
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_byte
c_func
(paren
id|cam
comma
id|address
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_byte
c_func
(paren
id|cam
comma
id|subaddress
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_stop
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_start
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_byte
c_func
(paren
id|cam
comma
id|address
op_plus
l_int|1
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_byte
c_func
(paren
id|cam
comma
id|value
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_stop
c_func
(paren
id|cam
)paren
suffix:semicolon
multiline_comment|/* Serial data disable */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C read byte data done, addr.0x%04X, &quot;
l_string|&quot;subaddr.0x%02X, value 0x%02X&quot;
comma
id|address
comma
id|subaddress
comma
op_star
id|value
)paren
r_else
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C read byte data failed, addr.0x%04X, &quot;
l_string|&quot;subaddr.0x%02X, wrong value 0x%02X&quot;
comma
id|address
comma
id|subaddress
comma
op_star
id|value
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* SMBus protocol: S Addr+1 Rd [A] [Value] NA P */
r_static
r_int
DECL|function|w9968cf_i2c_adap_read_byte
id|w9968cf_i2c_adap_read_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|address
comma
id|u8
op_star
id|value
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Serial data enable */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0013
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_start
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_byte
c_func
(paren
id|cam
comma
id|address
op_plus
l_int|1
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_read_byte
c_func
(paren
id|cam
comma
id|value
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_write_ack
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_smbus_stop
c_func
(paren
id|cam
)paren
suffix:semicolon
multiline_comment|/* Serial data disable */
id|err
op_add_assign
id|w9968cf_write_sb
c_func
(paren
id|cam
comma
l_int|0x0000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C read byte done, addr.0x%04X, &quot;
l_string|&quot;value 0x%02X&quot;
comma
id|address
comma
op_star
id|value
)paren
r_else
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C read byte failed, addr.0x%04X, &quot;
l_string|&quot;wrong value 0x%02X&quot;
comma
id|address
comma
op_star
id|value
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* SMBus protocol: S Addr Wr [A] Value [A] P */
r_static
r_int
DECL|function|w9968cf_i2c_adap_write_byte
id|w9968cf_i2c_adap_write_byte
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
id|address
comma
id|u8
id|value
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;i2c_write_byte() is an unsupported transfer mode&quot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * I2C interface to kernel                                                  *&n; ****************************************************************************/
r_static
r_int
DECL|function|w9968cf_i2c_smbus_xfer
id|w9968cf_i2c_smbus_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
id|i2c_get_adapdata
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|u8
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|addr
)paren
(brace
r_case
id|OV6xx0_SID
suffix:colon
r_case
id|OV7xx0_SID
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Rejected slave ID 0x%04X&quot;
comma
id|addr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BYTE
)paren
(brace
multiline_comment|/* Why addr &lt;&lt;= 1? See OVXXX0_SID defines in ovcamchip.h */
id|addr
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
id|err
op_assign
id|w9968cf_i2c_adap_write_byte
c_func
(paren
id|cam
comma
id|addr
comma
id|command
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|err
op_assign
id|w9968cf_i2c_adap_read_byte
c_func
(paren
id|cam
comma
id|addr
comma
op_amp
id|data-&gt;byte
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BYTE_DATA
)paren
(brace
id|addr
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
id|err
op_assign
id|w9968cf_i2c_adap_fastwrite_byte_data
c_func
(paren
id|cam
comma
id|addr
comma
id|command
comma
id|data-&gt;byte
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|W9968CF_I2C_RW_RETRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|w9968cf_i2c_adap_read_byte_data
c_func
(paren
id|cam
comma
id|addr
comma
id|command
comma
op_amp
id|data-&gt;byte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_if
c_cond
(paren
id|w9968cf_smbus_refresh_bus
c_func
(paren
id|cam
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_break
suffix:semicolon
)brace
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Unsupported I2C transfer mode (%d)&quot;
comma
id|size
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_i2c_func
r_static
id|u32
id|w9968cf_i2c_func
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_return
id|I2C_FUNC_SMBUS_READ_BYTE
op_or
id|I2C_FUNC_SMBUS_READ_BYTE_DATA
op_or
id|I2C_FUNC_SMBUS_WRITE_BYTE_DATA
suffix:semicolon
)brace
DECL|function|w9968cf_i2c_attach_inform
r_static
r_int
id|w9968cf_i2c_attach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
r_const
r_char
op_star
id|clientname
op_assign
id|i2c_clientname
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|id
op_assign
id|client-&gt;driver-&gt;id
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|I2C_DRIVERID_OVCAMCHIP
)paren
(brace
id|cam-&gt;sensor_client
op_assign
id|client
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_init
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;sensor_client
op_assign
l_int|NULL
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_else
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Rejected client [%s] with driver [%s]&quot;
comma
id|clientname
comma
id|client-&gt;driver-&gt;name
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C attach client [%s] with driver [%s]&quot;
comma
id|clientname
comma
id|client-&gt;driver-&gt;name
)paren
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_i2c_detach_inform
r_static
r_int
id|w9968cf_i2c_detach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
r_const
r_char
op_star
id|clientname
op_assign
id|i2c_clientname
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;sensor_client
op_eq
id|client
)paren
id|cam-&gt;sensor_client
op_assign
l_int|NULL
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C detach client [%s]&quot;
comma
id|clientname
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|w9968cf_i2c_control
id|w9968cf_i2c_control
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_i2c_init
r_static
r_int
id|w9968cf_i2c_init
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
id|i2c_algorithm
id|algo
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;W996[87]CF algorithm&quot;
comma
dot
id|id
op_assign
id|I2C_ALGO_SMBUS
comma
dot
id|smbus_xfer
op_assign
id|w9968cf_i2c_smbus_xfer
comma
dot
id|algo_control
op_assign
id|w9968cf_i2c_control
comma
dot
id|functionality
op_assign
id|w9968cf_i2c_func
comma
)brace
suffix:semicolon
r_static
r_struct
id|i2c_adapter
id|adap
op_assign
(brace
dot
id|id
op_assign
id|I2C_ALGO_SMBUS
op_or
id|I2C_HW_SMBUS_W9968CF
comma
dot
r_class
op_assign
id|I2C_CLASS_CAM_DIGITAL
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|client_register
op_assign
id|w9968cf_i2c_attach_inform
comma
dot
id|client_unregister
op_assign
id|w9968cf_i2c_detach_inform
comma
dot
id|algo
op_assign
op_amp
id|algo
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cam-&gt;i2c_adapter
comma
op_amp
id|adap
comma
r_sizeof
(paren
r_struct
id|i2c_adapter
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|cam-&gt;i2c_adapter.name
comma
l_string|&quot;w9968cf&quot;
)paren
suffix:semicolon
id|i2c_set_adapdata
c_func
(paren
op_amp
id|cam-&gt;i2c_adapter
comma
id|cam
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Registering I2C adapter with kernel...&quot;
)paren
id|err
op_assign
id|i2c_add_adapter
c_func
(paren
op_amp
id|cam-&gt;i2c_adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Failed to register the I2C adapter&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;I2C adapter registered&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Helper functions                                                         *&n; ****************************************************************************/
multiline_comment|/*--------------------------------------------------------------------------&n;  Turn on the LED on some webcams. A beep should be heard too.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_turn_on_led
r_static
r_int
id|w9968cf_turn_on_led
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xff00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* power-down */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xbf17
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* reset everything */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xbf10
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* normal operation */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0010
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* serial bus, SDS high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* serial bus, SDS low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0010
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* ..high &squot;beep-beep&squot; */
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Couldn&squot;t turn on the LED&quot;
)paren
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;LED turned on&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Write some registers for the device initialization.&n;  This function is called once on open().&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_init_chip
r_static
r_int
id|w9968cf_init_chip
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
r_int
id|hw_bufsize
op_assign
id|cam-&gt;maxwidth
op_star
id|cam-&gt;maxheight
op_star
l_int|2
comma
id|y0
op_assign
l_int|0x0000
comma
id|u0
op_assign
id|y0
op_plus
id|hw_bufsize
op_div
l_int|2
comma
id|v0
op_assign
id|u0
op_plus
id|hw_bufsize
op_div
l_int|4
comma
id|y1
op_assign
id|v0
op_plus
id|hw_bufsize
op_div
l_int|4
comma
id|u1
op_assign
id|y1
op_plus
id|hw_bufsize
op_div
l_int|2
comma
id|v1
op_assign
id|u1
op_plus
id|hw_bufsize
op_div
l_int|4
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xff00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* power off */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0xbf10
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* power on */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x405d
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* DRAM timings */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0030
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* SDRAM timings */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y0
op_amp
l_int|0xffff
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* Y buf.0, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y0
op_rshift
l_int|16
comma
l_int|0x21
)paren
suffix:semicolon
multiline_comment|/* Y buf.0, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|u0
op_amp
l_int|0xffff
comma
l_int|0x24
)paren
suffix:semicolon
multiline_comment|/* U buf.0, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|u0
op_rshift
l_int|16
comma
l_int|0x25
)paren
suffix:semicolon
multiline_comment|/* U buf.0, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|v0
op_amp
l_int|0xffff
comma
l_int|0x28
)paren
suffix:semicolon
multiline_comment|/* V buf.0, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|v0
op_rshift
l_int|16
comma
l_int|0x29
)paren
suffix:semicolon
multiline_comment|/* V buf.0, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_amp
l_int|0xffff
comma
l_int|0x22
)paren
suffix:semicolon
multiline_comment|/* Y buf.1, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_rshift
l_int|16
comma
l_int|0x23
)paren
suffix:semicolon
multiline_comment|/* Y buf.1, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|u1
op_amp
l_int|0xffff
comma
l_int|0x26
)paren
suffix:semicolon
multiline_comment|/* U buf.1, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|u1
op_rshift
l_int|16
comma
l_int|0x27
)paren
suffix:semicolon
multiline_comment|/* U buf.1, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|v1
op_amp
l_int|0xffff
comma
l_int|0x2a
)paren
suffix:semicolon
multiline_comment|/* V buf.1, low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|v1
op_rshift
l_int|16
comma
l_int|0x2b
)paren
suffix:semicolon
multiline_comment|/* V buf.1, high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_amp
l_int|0xffff
comma
l_int|0x32
)paren
suffix:semicolon
multiline_comment|/* JPEG buf 0 low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_rshift
l_int|16
comma
l_int|0x33
)paren
suffix:semicolon
multiline_comment|/* JPEG buf 0 high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_amp
l_int|0xffff
comma
l_int|0x34
)paren
suffix:semicolon
multiline_comment|/* JPEG buf 1 low */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|y1
op_rshift
l_int|16
comma
l_int|0x35
)paren
suffix:semicolon
multiline_comment|/* JPEG bug 1 high */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x36
)paren
suffix:semicolon
multiline_comment|/* JPEG restart interval */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0804
comma
l_int|0x37
)paren
suffix:semicolon
multiline_comment|/*JPEG VLE FIFO threshold*/
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x38
)paren
suffix:semicolon
multiline_comment|/* disable hw up-scaling */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
l_int|0x0000
comma
l_int|0x3f
)paren
suffix:semicolon
multiline_comment|/* JPEG/MCTL test data */
id|err
op_add_assign
id|w9968cf_set_picture
c_func
(paren
id|cam
comma
id|cam-&gt;picture
)paren
suffix:semicolon
multiline_comment|/* this before */
id|err
op_add_assign
id|w9968cf_set_window
c_func
(paren
id|cam
comma
id|cam-&gt;window
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Chip initialization failed&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Chip successfully initialized&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Return non-zero if the palette is supported, 0 otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_valid_palette
r_static
r_inline
id|u16
id|w9968cf_valid_palette
c_func
(paren
id|u16
id|palette
)paren
(brace
id|u8
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|palette
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|palette
op_eq
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|palette
)paren
r_return
id|palette
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Return the depth corresponding to the given palette.&n;  Palette _must_ be supported !&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_valid_depth
r_static
r_inline
id|u16
id|w9968cf_valid_depth
c_func
(paren
id|u16
id|palette
)paren
(brace
id|u8
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|palette
op_ne
id|palette
)paren
id|i
op_increment
suffix:semicolon
r_return
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|depth
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Return non-zero if the format requires decompression, 0 otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_need_decompression
r_static
r_inline
id|u8
id|w9968cf_need_decompression
c_func
(paren
id|u16
id|palette
)paren
(brace
id|u8
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|palette
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|palette
op_eq
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|palette
)paren
r_return
id|w9968cf_formatlist
(braket
id|i
)braket
dot
id|compression
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Change the picture settings of the camera.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
r_static
r_int
DECL|function|w9968cf_set_picture
id|w9968cf_set_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|video_picture
id|pict
)paren
(brace
id|u16
id|fmt
comma
id|hw_depth
comma
id|hw_palette
comma
id|reg_v
op_assign
l_int|0x0000
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Make sure we are using a valid depth */
id|pict.depth
op_assign
id|w9968cf_valid_depth
c_func
(paren
id|pict.palette
)paren
suffix:semicolon
id|fmt
op_assign
id|pict.palette
suffix:semicolon
id|hw_depth
op_assign
id|pict.depth
suffix:semicolon
multiline_comment|/* depth used by the winbond chip */
id|hw_palette
op_assign
id|pict.palette
suffix:semicolon
multiline_comment|/* palette used by the winbond chip */
multiline_comment|/* VS &amp; HS polarities */
id|reg_v
op_assign
(paren
id|cam-&gt;vs_polarity
op_lshift
l_int|12
)paren
op_or
(paren
id|cam-&gt;hs_polarity
op_lshift
l_int|11
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
id|VIDEO_PALETTE_UYVY
suffix:colon
id|reg_v
op_or_assign
l_int|0x0000
suffix:semicolon
id|cam-&gt;vpp_flag
op_assign
id|VPP_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV422P
suffix:colon
id|reg_v
op_or_assign
l_int|0x0002
suffix:semicolon
id|cam-&gt;vpp_flag
op_assign
id|VPP_DECOMPRESSION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUV420
suffix:colon
r_case
id|VIDEO_PALETTE_YUV420P
suffix:colon
id|reg_v
op_or_assign
l_int|0x0003
suffix:semicolon
id|cam-&gt;vpp_flag
op_assign
id|VPP_DECOMPRESSION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PALETTE_YUYV
suffix:colon
r_case
id|VIDEO_PALETTE_YUV422
suffix:colon
id|reg_v
op_or_assign
l_int|0x0000
suffix:semicolon
id|cam-&gt;vpp_flag
op_assign
id|VPP_SWAP_YUV_BYTES
suffix:semicolon
id|hw_palette
op_assign
id|VIDEO_PALETTE_UYVY
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Original video is used instead of RGBX palettes. &n;&t;&t;   Software conversion later. */
r_case
id|VIDEO_PALETTE_GREY
suffix:colon
r_case
id|VIDEO_PALETTE_RGB555
suffix:colon
r_case
id|VIDEO_PALETTE_RGB565
suffix:colon
r_case
id|VIDEO_PALETTE_RGB24
suffix:colon
r_case
id|VIDEO_PALETTE_RGB32
suffix:colon
id|reg_v
op_or_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* UYVY 16 bit is used */
id|hw_depth
op_assign
l_int|16
suffix:semicolon
id|hw_palette
op_assign
id|VIDEO_PALETTE_UYVY
suffix:semicolon
id|cam-&gt;vpp_flag
op_assign
id|VPP_UYVY_TO_RGBX
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* NOTE: due to memory issues, it is better to disable the hardware&n;&t;         double buffering during compression */
r_if
c_cond
(paren
id|cam-&gt;double_buffer
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
)paren
id|reg_v
op_or_assign
l_int|0x0080
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;clamping
)paren
id|reg_v
op_or_assign
l_int|0x0020
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;filter_type
op_eq
l_int|1
)paren
id|reg_v
op_or_assign
l_int|0x0008
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cam-&gt;filter_type
op_eq
l_int|2
)paren
id|reg_v
op_or_assign
l_int|0x000c
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|reg_v
comma
l_int|0x16
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_update_picture
c_func
(paren
id|cam
comma
id|pict
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* If all went well, update the device data structure */
id|memcpy
c_func
(paren
op_amp
id|cam-&gt;picture
comma
op_amp
id|pict
comma
r_sizeof
(paren
id|pict
)paren
)paren
suffix:semicolon
id|cam-&gt;hw_depth
op_assign
id|hw_depth
suffix:semicolon
id|cam-&gt;hw_palette
op_assign
id|hw_palette
suffix:semicolon
multiline_comment|/* Settings changed, so we clear the frame buffers */
id|memset
c_func
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
comma
l_int|0
comma
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|size
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Palette is %s, depth is %u bpp&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
comma
id|pict.depth
)paren
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Failed to change picture settings&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Change the capture area size of the camera.&n;  This function _must_ be called _after_ w9968cf_set_picture().&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
r_static
r_int
DECL|function|w9968cf_set_window
id|w9968cf_set_window
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|video_window
id|win
)paren
(brace
id|u16
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|scx
comma
id|scy
comma
id|cw
comma
id|ch
comma
id|ax
comma
id|ay
suffix:semicolon
r_int
r_int
id|fw
comma
id|fh
suffix:semicolon
r_struct
id|ovcamchip_window
id|s_win
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Work around to avoid FP arithmetics */
DECL|macro|__SC
mdefine_line|#define __SC(x) ((x) &lt;&lt; 10)
DECL|macro|__UNSC
mdefine_line|#define __UNSC(x) ((x) &gt;&gt; 10)
multiline_comment|/* Make sure we are using a supported resolution */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_adjust_window_size
c_func
(paren
id|cam
comma
(paren
id|u16
op_star
)paren
op_amp
id|win.width
comma
(paren
id|u16
op_star
)paren
op_amp
id|win.height
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* Scaling factors */
id|fw
op_assign
id|__SC
c_func
(paren
id|win.width
)paren
op_div
id|cam-&gt;maxwidth
suffix:semicolon
id|fh
op_assign
id|__SC
c_func
(paren
id|win.height
)paren
op_div
id|cam-&gt;maxheight
suffix:semicolon
multiline_comment|/* Set up the width and height values used by the chip */
r_if
c_cond
(paren
(paren
id|win.width
OG
id|cam-&gt;maxwidth
)paren
op_logical_or
(paren
id|win.height
OG
id|cam-&gt;maxheight
)paren
)paren
(brace
id|cam-&gt;vpp_flag
op_or_assign
id|VPP_UPSCALE
suffix:semicolon
multiline_comment|/* Calculate largest w,h mantaining the same w/h ratio */
id|w
op_assign
(paren
id|fw
op_ge
id|fh
)paren
ques
c_cond
id|cam-&gt;maxwidth
suffix:colon
id|__SC
c_func
(paren
id|win.width
)paren
op_div
id|fh
suffix:semicolon
id|h
op_assign
(paren
id|fw
op_ge
id|fh
)paren
ques
c_cond
id|__SC
c_func
(paren
id|win.height
)paren
op_div
id|fw
suffix:colon
id|cam-&gt;maxheight
suffix:semicolon
r_if
c_cond
(paren
id|w
OL
id|cam-&gt;minwidth
)paren
multiline_comment|/* just in case */
id|w
op_assign
id|cam-&gt;minwidth
suffix:semicolon
r_if
c_cond
(paren
id|h
OL
id|cam-&gt;minheight
)paren
multiline_comment|/* just in case */
id|h
op_assign
id|cam-&gt;minheight
suffix:semicolon
)brace
r_else
(brace
id|cam-&gt;vpp_flag
op_and_assign
op_complement
id|VPP_UPSCALE
suffix:semicolon
id|w
op_assign
id|win.width
suffix:semicolon
id|h
op_assign
id|win.height
suffix:semicolon
)brace
multiline_comment|/* x,y offsets of the cropped area */
id|scx
op_assign
id|cam-&gt;start_cropx
suffix:semicolon
id|scy
op_assign
id|cam-&gt;start_cropy
suffix:semicolon
multiline_comment|/* Calculate cropped area manteining the right w/h ratio */
r_if
c_cond
(paren
id|cam-&gt;largeview
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
)paren
(brace
id|cw
op_assign
(paren
id|fw
op_ge
id|fh
)paren
ques
c_cond
id|cam-&gt;maxwidth
suffix:colon
id|__SC
c_func
(paren
id|win.width
)paren
op_div
id|fh
suffix:semicolon
id|ch
op_assign
(paren
id|fw
op_ge
id|fh
)paren
ques
c_cond
id|__SC
c_func
(paren
id|win.height
)paren
op_div
id|fw
suffix:colon
id|cam-&gt;maxheight
suffix:semicolon
)brace
r_else
(brace
id|cw
op_assign
id|w
suffix:semicolon
id|ch
op_assign
id|h
suffix:semicolon
)brace
multiline_comment|/* Setup the window of the sensor */
id|s_win.format
op_assign
id|VIDEO_PALETTE_UYVY
suffix:semicolon
id|s_win.width
op_assign
id|cam-&gt;maxwidth
suffix:semicolon
id|s_win.height
op_assign
id|cam-&gt;maxheight
suffix:semicolon
id|s_win.quarter
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* full progressive video */
multiline_comment|/* Center it */
id|s_win.x
op_assign
(paren
id|s_win.width
op_minus
id|cw
)paren
op_div
l_int|2
suffix:semicolon
id|s_win.y
op_assign
(paren
id|s_win.height
op_minus
id|ch
)paren
op_div
l_int|2
suffix:semicolon
multiline_comment|/* Clock divisor */
r_if
c_cond
(paren
id|cam-&gt;clockdiv
op_ge
l_int|0
)paren
id|s_win.clockdiv
op_assign
id|cam-&gt;clockdiv
suffix:semicolon
multiline_comment|/* manual override */
r_else
r_switch
c_cond
(paren
id|cam-&gt;sensor
)paren
(brace
r_case
id|CC_OV6620
suffix:colon
id|s_win.clockdiv
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CC_OV6630
suffix:colon
id|s_win.clockdiv
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CC_OV76BE
suffix:colon
r_case
id|CC_OV7610
suffix:colon
r_case
id|CC_OV7620
suffix:colon
id|s_win.clockdiv
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s_win.clockdiv
op_assign
id|W9968CF_DEF_CLOCKDIVISOR
suffix:semicolon
)brace
multiline_comment|/* We have to scale win.x and win.y offsets */
r_if
c_cond
(paren
(paren
id|cam-&gt;largeview
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
)paren
op_logical_or
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
)paren
(brace
id|ax
op_assign
id|__SC
c_func
(paren
id|win.x
)paren
op_div
id|fw
suffix:semicolon
id|ay
op_assign
id|__SC
c_func
(paren
id|win.y
)paren
op_div
id|fh
suffix:semicolon
)brace
r_else
(brace
id|ax
op_assign
id|win.x
suffix:semicolon
id|ay
op_assign
id|win.y
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ax
op_plus
id|cw
)paren
OG
id|cam-&gt;maxwidth
)paren
id|ax
op_assign
id|cam-&gt;maxwidth
op_minus
id|cw
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ay
op_plus
id|ch
)paren
OG
id|cam-&gt;maxheight
)paren
id|ay
op_assign
id|cam-&gt;maxheight
op_minus
id|ch
suffix:semicolon
multiline_comment|/* Adjust win.x, win.y */
r_if
c_cond
(paren
(paren
id|cam-&gt;largeview
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
)paren
op_logical_or
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
)paren
(brace
id|win.x
op_assign
id|__UNSC
c_func
(paren
id|ax
op_star
id|fw
)paren
suffix:semicolon
id|win.y
op_assign
id|__UNSC
c_func
(paren
id|ay
op_star
id|fh
)paren
suffix:semicolon
)brace
r_else
(brace
id|win.x
op_assign
id|ax
suffix:semicolon
id|win.y
op_assign
id|ay
suffix:semicolon
)brace
multiline_comment|/* Offsets used by the chip */
id|x
op_assign
id|ax
op_plus
id|s_win.x
suffix:semicolon
id|y
op_assign
id|ay
op_plus
id|s_win.y
suffix:semicolon
multiline_comment|/* Go ! */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_cmd
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CMD_S_MODE
comma
op_amp
id|s_win
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|scx
op_plus
id|x
comma
l_int|0x10
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|scy
op_plus
id|y
comma
l_int|0x11
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|scx
op_plus
id|x
op_plus
id|cw
comma
l_int|0x12
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|scy
op_plus
id|y
op_plus
id|ch
comma
l_int|0x13
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|w
comma
l_int|0x14
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|h
comma
l_int|0x15
)paren
suffix:semicolon
multiline_comment|/* JPEG width &amp; height */
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|w
comma
l_int|0x30
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|h
comma
l_int|0x31
)paren
suffix:semicolon
multiline_comment|/* Y &amp; UV frame buffer strides (in WORD) */
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
(brace
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|w
op_div
l_int|2
comma
l_int|0x2c
)paren
suffix:semicolon
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|w
op_div
l_int|4
comma
l_int|0x2d
)paren
suffix:semicolon
)brace
r_else
id|err
op_add_assign
id|w9968cf_write_reg
c_func
(paren
id|cam
comma
id|w
comma
l_int|0x2c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* If all went well, update the device data structure */
id|memcpy
c_func
(paren
op_amp
id|cam-&gt;window
comma
op_amp
id|win
comma
r_sizeof
(paren
id|win
)paren
)paren
suffix:semicolon
id|cam-&gt;hw_width
op_assign
id|w
suffix:semicolon
id|cam-&gt;hw_height
op_assign
id|h
suffix:semicolon
multiline_comment|/* Settings changed, so we clear the frame buffers */
id|memset
c_func
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
comma
l_int|0
comma
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|size
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;The capture area is %dx%d, Offset (x,y)=(%u,%u)&quot;
comma
id|win.width
comma
id|win.height
comma
id|win.x
comma
id|win.y
)paren
id|PDBGG
c_func
(paren
l_string|&quot;x=%u ,y=%u, w=%u, h=%u, ax=%u, ay=%u, s_win.x=%u, s_win.y=%u, &quot;
l_string|&quot;cw=%u, ch=%u, win.x=%u, win.y=%u, win.width=%u, win.height=%u&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|ax
comma
id|ay
comma
id|s_win.x
comma
id|s_win.y
comma
id|cw
comma
id|ch
comma
id|win.x
comma
id|win.y
comma
id|win.width
comma
id|win.height
)paren
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Failed to change the capture area size&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*-------------------------------------------------------------------------- &n;  Adjust the asked values for window width and height.&n;  Return 0 on success, -1 otherwise.&n;  --------------------------------------------------------------------------*/
r_static
r_int
DECL|function|w9968cf_adjust_window_size
id|w9968cf_adjust_window_size
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u16
op_star
id|width
comma
id|u16
op_star
id|height
)paren
(brace
id|u16
id|maxw
comma
id|maxh
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|width
OL
id|cam-&gt;minwidth
)paren
op_logical_or
(paren
op_star
id|height
OL
id|cam-&gt;minheight
)paren
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|maxw
op_assign
id|cam-&gt;upscaling
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
op_logical_and
id|w9968cf_vpp
ques
c_cond
id|max
c_func
(paren
(paren
id|u16
)paren
id|W9968CF_MAX_WIDTH
comma
id|cam-&gt;maxwidth
)paren
suffix:colon
id|cam-&gt;maxwidth
suffix:semicolon
id|maxh
op_assign
id|cam-&gt;upscaling
op_logical_and
op_logical_neg
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
op_logical_and
id|w9968cf_vpp
ques
c_cond
id|max
c_func
(paren
(paren
id|u16
)paren
id|W9968CF_MAX_HEIGHT
comma
id|cam-&gt;maxheight
)paren
suffix:colon
id|cam-&gt;maxheight
suffix:semicolon
r_if
c_cond
(paren
op_star
id|width
OG
id|maxw
)paren
op_star
id|width
op_assign
id|maxw
suffix:semicolon
r_if
c_cond
(paren
op_star
id|height
OG
id|maxh
)paren
op_star
id|height
op_assign
id|maxh
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
(brace
op_star
id|width
op_and_assign
op_complement
l_int|15L
suffix:semicolon
multiline_comment|/* multiple of 16 */
op_star
id|height
op_and_assign
op_complement
l_int|15L
suffix:semicolon
)brace
id|PDBGG
c_func
(paren
l_string|&quot;Window size adjusted w=%u, h=%u &quot;
comma
op_star
id|width
comma
op_star
id|height
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Initialize the FIFO list of requested frames.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_init_framelist
r_static
r_void
id|w9968cf_init_framelist
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
id|u8
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cam-&gt;requested_frame
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|queued
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|status
op_assign
id|F_UNUSED
suffix:semicolon
)brace
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Add a frame in the FIFO list of requested frames.&n;  This function is called in process context.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_push_frame
r_static
r_void
id|w9968cf_push_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
id|u8
id|f_num
)paren
(brace
id|u8
id|f
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;flist_lock
comma
id|lock_flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;requested_frame
(braket
id|f
)braket
op_ne
l_int|NULL
suffix:semicolon
id|f
op_increment
)paren
suffix:semicolon
id|cam-&gt;requested_frame
(braket
id|f
)braket
op_assign
op_amp
id|cam-&gt;frame
(braket
id|f_num
)braket
suffix:semicolon
id|cam-&gt;frame
(braket
id|f_num
)braket
dot
id|queued
op_assign
l_int|1
suffix:semicolon
id|cam-&gt;frame
(braket
id|f_num
)braket
dot
id|status
op_assign
id|F_UNUSED
suffix:semicolon
multiline_comment|/* clear the status */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;flist_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Frame #%u pushed into the FIFO list. Position %u&quot;
comma
id|f_num
comma
id|f
)paren
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Read, store and remove the first pointer in the FIFO list of requested&n;  frames. This function is called in interrupt context.&n;  --------------------------------------------------------------------------*/
r_static
r_void
DECL|function|w9968cf_pop_frame
id|w9968cf_pop_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|w9968cf_frame_t
op_star
op_star
id|framep
)paren
(brace
id|u8
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cam-&gt;flist_lock
)paren
suffix:semicolon
op_star
id|framep
op_assign
id|cam-&gt;requested_frame
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Shift the list of pointers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
id|cam-&gt;requested_frame
(braket
id|i
)braket
op_assign
id|cam-&gt;requested_frame
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|cam-&gt;requested_frame
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|cam-&gt;flist_lock
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Popped frame #%d from the list&quot;
comma
(paren
op_star
id|framep
)paren
op_member_access_from_pointer
id|number
)paren
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  High-level video post-processing routine on grabbed frames.&n;  Return 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
r_static
r_int
DECL|function|w9968cf_postprocess_frame
id|w9968cf_postprocess_frame
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|w9968cf_frame_t
op_star
id|fr
)paren
(brace
r_void
op_star
id|pIn
op_assign
id|fr-&gt;buffer
comma
op_star
id|pOut
op_assign
id|cam-&gt;frame_vpp.buffer
comma
op_star
id|tmp
suffix:semicolon
id|u16
id|w
op_assign
id|cam-&gt;window.width
comma
id|h
op_assign
id|cam-&gt;window.height
comma
id|d
op_assign
id|cam-&gt;picture.depth
comma
id|fmt
op_assign
id|cam-&gt;picture.palette
comma
id|rgb
op_assign
id|cam-&gt;force_rgb
comma
id|hw_w
op_assign
id|cam-&gt;hw_width
comma
id|hw_h
op_assign
id|cam-&gt;hw_height
comma
id|hw_d
op_assign
id|cam-&gt;hw_depth
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
DECL|macro|_PSWAP
mdefine_line|#define _PSWAP(pIn, pOut) {tmp = (pIn); (pIn) = (pOut); (pOut) = tmp;}
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_DECOMPRESSION
)paren
(brace
id|memcpy
c_func
(paren
id|pOut
comma
id|pIn
comma
id|fr-&gt;length
)paren
suffix:semicolon
id|_PSWAP
c_func
(paren
id|pIn
comma
id|pOut
)paren
id|err
op_assign
id|w9968cf_vpp
op_member_access_from_pointer
id|decode
c_func
(paren
id|pIn
comma
id|fr-&gt;length
comma
id|hw_w
comma
id|hw_h
comma
id|pOut
)paren
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;Compressed frame length: %lu&quot;
comma
(paren
r_int
r_int
)paren
id|fr-&gt;length
)paren
id|fr-&gt;length
op_assign
(paren
id|hw_w
op_star
id|hw_h
op_star
id|hw_d
)paren
op_div
l_int|8
suffix:semicolon
id|_PSWAP
c_func
(paren
id|pIn
comma
id|pOut
)paren
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;An error occurred while decoding the frame: &quot;
l_string|&quot;%s&quot;
comma
id|symbolic
c_func
(paren
id|decoder_errlist
comma
id|err
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Frame decoded&quot;
)paren
)brace
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_SWAP_YUV_BYTES
)paren
(brace
id|w9968cf_vpp
op_member_access_from_pointer
id|swap_yuvbytes
c_func
(paren
id|pIn
comma
id|fr-&gt;length
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Original UYVY component ordering changed&quot;
)paren
)brace
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UPSCALE
)paren
(brace
id|w9968cf_vpp
op_member_access_from_pointer
id|scale_up
c_func
(paren
id|pIn
comma
id|pOut
comma
id|hw_w
comma
id|hw_h
comma
id|hw_d
comma
id|w
comma
id|h
)paren
suffix:semicolon
id|fr-&gt;length
op_assign
(paren
id|w
op_star
id|h
op_star
id|hw_d
)paren
op_div
l_int|8
suffix:semicolon
id|_PSWAP
c_func
(paren
id|pIn
comma
id|pOut
)paren
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Vertical up-scaling done: %u,%u,%ubpp-&gt;%u,%u&quot;
comma
id|hw_w
comma
id|hw_h
comma
id|hw_d
comma
id|w
comma
id|h
)paren
)brace
r_if
c_cond
(paren
id|cam-&gt;vpp_flag
op_amp
id|VPP_UYVY_TO_RGBX
)paren
(brace
id|w9968cf_vpp
op_member_access_from_pointer
id|uyvy_to_rgbx
c_func
(paren
id|pIn
comma
id|fr-&gt;length
comma
id|pOut
comma
id|fmt
comma
id|rgb
)paren
suffix:semicolon
id|fr-&gt;length
op_assign
(paren
id|w
op_star
id|h
op_star
id|d
)paren
op_div
l_int|8
suffix:semicolon
id|_PSWAP
c_func
(paren
id|pIn
comma
id|pOut
)paren
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;UYVY-16bit to %s conversion done&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|fmt
)paren
)paren
)brace
r_if
c_cond
(paren
id|pOut
op_eq
id|fr-&gt;buffer
)paren
id|memcpy
c_func
(paren
id|fr-&gt;buffer
comma
id|cam-&gt;frame_vpp.buffer
comma
id|fr-&gt;length
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Image sensor control routines                                            *&n; ****************************************************************************/
r_static
r_int
DECL|function|w9968cf_sensor_set_control
id|w9968cf_sensor_set_control
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_int
id|cid
comma
r_int
id|val
)paren
(brace
r_struct
id|ovcamchip_control
id|ctl
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ctl.id
op_assign
id|cid
suffix:semicolon
id|ctl.value
op_assign
id|val
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_cmd
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CMD_S_CTRL
comma
op_amp
id|ctl
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|w9968cf_sensor_get_control
id|w9968cf_sensor_get_control
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_int
id|cid
comma
r_int
op_star
id|val
)paren
(brace
r_struct
id|ovcamchip_control
id|ctl
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ctl.id
op_assign
id|cid
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_cmd
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CMD_G_CTRL
comma
op_amp
id|ctl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
op_star
id|val
op_assign
id|ctl.value
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|w9968cf_sensor_cmd
id|w9968cf_sensor_cmd
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|i2c_client
op_star
id|c
op_assign
id|cam-&gt;sensor_client
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
op_logical_or
op_logical_neg
id|c-&gt;driver
op_logical_or
op_logical_neg
id|c-&gt;driver-&gt;command
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rc
op_assign
id|c-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|c
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
multiline_comment|/* The I2C driver returns -EPERM on non-supported controls */
r_return
(paren
id|rc
OL
l_int|0
op_logical_and
id|rc
op_ne
op_minus
id|EPERM
)paren
ques
c_cond
id|rc
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Update some settings of the image sensor.&n;  Returns: 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_sensor_update_settings
r_static
r_int
id|w9968cf_sensor_update_settings
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Auto brightness */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_AUTOBRIGHT
comma
id|cam-&gt;auto_brt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Auto exposure */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_AUTOEXP
comma
id|cam-&gt;auto_exp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Banding filter */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_BANDFILT
comma
id|cam-&gt;bandfilt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Light frequency */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_FREQ
comma
id|cam-&gt;lightfreq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Back light */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_BACKLIGHT
comma
id|cam-&gt;backlight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Mirror */
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_MIRROR
comma
id|cam-&gt;mirror
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Get some current picture settings from the image sensor and update the&n;  internal &squot;picture&squot; structure of the camera.&n;  Returns: 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_sensor_get_picture
r_static
r_int
id|w9968cf_sensor_get_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
comma
id|v
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_get_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_CONT
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|cam-&gt;picture.contrast
op_assign
id|v
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_get_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_BRIGHT
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|cam-&gt;picture.brightness
op_assign
id|v
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_get_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_SAT
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|cam-&gt;picture.colour
op_assign
id|v
suffix:semicolon
id|err
op_assign
id|w9968cf_sensor_get_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_HUE
comma
op_amp
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|cam-&gt;picture.hue
op_assign
id|v
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Got picture settings from the image sensor&quot;
)paren
id|PDBGG
c_func
(paren
l_string|&quot;Brightness, contrast, hue, colour, whiteness are &quot;
l_string|&quot;%u,%u,%u,%u,%u&quot;
comma
id|cam-&gt;picture.brightness
comma
id|cam-&gt;picture.contrast
comma
id|cam-&gt;picture.hue
comma
id|cam-&gt;picture.colour
comma
id|cam-&gt;picture.whiteness
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Update picture settings of the image sensor.&n;  Returns: 0 on success, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
r_static
r_int
DECL|function|w9968cf_sensor_update_picture
id|w9968cf_sensor_update_picture
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|video_picture
id|pict
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|cam-&gt;sensor_initialized
)paren
op_logical_or
id|pict.contrast
op_ne
id|cam-&gt;picture.contrast
)paren
(brace
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_CONT
comma
id|pict.contrast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Contrast changed from %u to %u&quot;
comma
id|cam-&gt;picture.contrast
comma
id|pict.contrast
)paren
id|cam-&gt;picture.contrast
op_assign
id|pict.contrast
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
op_logical_neg
id|cam-&gt;sensor_initialized
)paren
op_logical_or
id|pict.brightness
op_ne
id|cam-&gt;picture.brightness
)paren
op_logical_and
(paren
op_logical_neg
id|cam-&gt;auto_brt
)paren
)paren
(brace
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_BRIGHT
comma
id|pict.brightness
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Brightness changed from %u to %u&quot;
comma
id|cam-&gt;picture.brightness
comma
id|pict.brightness
)paren
id|cam-&gt;picture.brightness
op_assign
id|pict.brightness
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|cam-&gt;sensor_initialized
)paren
op_logical_or
id|pict.colour
op_ne
id|cam-&gt;picture.colour
)paren
(brace
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_SAT
comma
id|pict.colour
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Colour changed from %u to %u&quot;
comma
id|cam-&gt;picture.colour
comma
id|pict.colour
)paren
id|cam-&gt;picture.colour
op_assign
id|pict.colour
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|cam-&gt;sensor_initialized
)paren
op_logical_or
id|pict.hue
op_ne
id|cam-&gt;picture.hue
)paren
(brace
id|err
op_assign
id|w9968cf_sensor_set_control
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CID_HUE
comma
id|pict.hue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail
suffix:semicolon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Hue changed from %u to %u&quot;
comma
id|cam-&gt;picture.hue
comma
id|pict.hue
)paren
id|cam-&gt;picture.hue
op_assign
id|pict.hue
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Failed to change sensor picture setting&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Camera configuration                                                     *&n; ****************************************************************************/
multiline_comment|/*--------------------------------------------------------------------------&n;  This function is called when a supported image sensor is detected.&n;  Return 0 if the initialization succeeds, a negative number otherwise.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_sensor_init
r_static
r_int
id|w9968cf_sensor_init
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_cmd
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CMD_INITIALIZE
comma
op_amp
id|cam-&gt;monochrome
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_cmd
c_func
(paren
id|cam
comma
id|OVCAMCHIP_CMD_Q_SUBTYPE
comma
op_amp
id|cam-&gt;sensor
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* NOTE: Make sure width and height are a multiple of 16 */
r_switch
c_cond
(paren
id|cam-&gt;sensor_client-&gt;addr
)paren
(brace
r_case
id|OV6xx0_SID
suffix:colon
id|cam-&gt;maxwidth
op_assign
l_int|352
suffix:semicolon
id|cam-&gt;maxheight
op_assign
l_int|288
suffix:semicolon
id|cam-&gt;minwidth
op_assign
l_int|64
suffix:semicolon
id|cam-&gt;minheight
op_assign
l_int|48
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OV7xx0_SID
suffix:colon
id|cam-&gt;maxwidth
op_assign
l_int|640
suffix:semicolon
id|cam-&gt;maxheight
op_assign
l_int|480
suffix:semicolon
id|cam-&gt;minwidth
op_assign
l_int|64
suffix:semicolon
id|cam-&gt;minheight
op_assign
l_int|48
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Not supported image sensor detected for %s&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* These values depend on the ones in the ovxxx0.c sources */
r_switch
c_cond
(paren
id|cam-&gt;sensor
)paren
(brace
r_case
id|CC_OV7620
suffix:colon
id|cam-&gt;start_cropx
op_assign
l_int|287
suffix:semicolon
id|cam-&gt;start_cropy
op_assign
l_int|35
suffix:semicolon
multiline_comment|/* Seems to work around a bug in the image sensor */
id|cam-&gt;vs_polarity
op_assign
l_int|1
suffix:semicolon
id|cam-&gt;hs_polarity
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cam-&gt;start_cropx
op_assign
l_int|320
suffix:semicolon
id|cam-&gt;start_cropy
op_assign
l_int|35
suffix:semicolon
id|cam-&gt;vs_polarity
op_assign
l_int|1
suffix:semicolon
id|cam-&gt;hs_polarity
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_update_settings
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_sensor_update_picture
c_func
(paren
id|cam
comma
id|cam-&gt;picture
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
id|cam-&gt;sensor_initialized
op_assign
l_int|1
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;%s image sensor initialized&quot;
comma
id|symbolic
c_func
(paren
id|senlist
comma
id|cam-&gt;sensor
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|cam-&gt;sensor_initialized
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;sensor
op_assign
id|CC_UNKNOWN
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Image sensor initialization failed for %s (/dev/video%d). &quot;
l_string|&quot;Try to detach and attach this device again&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Fill some basic fields in the main device data structure.&n;  This function is called once on w9968cf_usb_probe() for each recognized &n;  camera.&n;  --------------------------------------------------------------------------*/
r_static
r_void
DECL|function|w9968cf_configure_camera
id|w9968cf_configure_camera
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
comma
r_struct
id|usb_device
op_star
id|udev
comma
r_enum
id|w9968cf_model_id
id|mod_id
comma
r_const
r_int
r_int
id|dev_nr
)paren
(brace
id|init_MUTEX
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|cam-&gt;open
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|cam-&gt;urb_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|cam-&gt;flist_lock
)paren
suffix:semicolon
id|cam-&gt;users
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;disconnected
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;id
op_assign
id|mod_id
suffix:semicolon
id|cam-&gt;sensor
op_assign
id|CC_UNKNOWN
suffix:semicolon
id|cam-&gt;sensor_initialized
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Calculate the alternate setting number (from 1 to 16)&n;&t;   according to the &squot;packet_size&squot; module parameter */
r_if
c_cond
(paren
id|packet_size
(braket
id|dev_nr
)braket
OL
id|W9968CF_MIN_PACKET_SIZE
)paren
id|packet_size
(braket
id|dev_nr
)braket
op_assign
id|W9968CF_MIN_PACKET_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|cam-&gt;altsetting
op_assign
l_int|1
suffix:semicolon
id|packet_size
(braket
id|dev_nr
)braket
OL
id|wMaxPacketSize
(braket
id|cam-&gt;altsetting
op_minus
l_int|1
)braket
suffix:semicolon
id|cam-&gt;altsetting
op_increment
)paren
suffix:semicolon
id|cam-&gt;max_buffers
op_assign
(paren
id|max_buffers
(braket
id|dev_nr
)braket
template_param
id|W9968CF_MAX_BUFFERS
)paren
ques
c_cond
id|W9968CF_BUFFERS
suffix:colon
(paren
id|u8
)paren
id|max_buffers
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;double_buffer
op_assign
(paren
id|double_buffer
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|double_buffer
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|double_buffer
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_DOUBLE_BUFFER
suffix:semicolon
id|cam-&gt;clamping
op_assign
(paren
id|clamping
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|clamping
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|clamping
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_CLAMPING
suffix:semicolon
id|cam-&gt;filter_type
op_assign
(paren
id|filter_type
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|filter_type
(braket
id|dev_nr
)braket
op_eq
l_int|1
op_logical_or
id|filter_type
(braket
id|dev_nr
)braket
op_eq
l_int|2
)paren
ques
c_cond
(paren
id|u8
)paren
id|filter_type
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_FILTER_TYPE
suffix:semicolon
id|cam-&gt;capture
op_assign
l_int|1
suffix:semicolon
id|cam-&gt;largeview
op_assign
(paren
id|largeview
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|largeview
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|largeview
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_LARGEVIEW
suffix:semicolon
id|cam-&gt;decompression
op_assign
(paren
id|decompression
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|decompression
(braket
id|dev_nr
)braket
op_eq
l_int|1
op_logical_or
id|decompression
(braket
id|dev_nr
)braket
op_eq
l_int|2
)paren
ques
c_cond
(paren
id|u8
)paren
id|decompression
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_DECOMPRESSION
suffix:semicolon
id|cam-&gt;upscaling
op_assign
(paren
id|upscaling
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|upscaling
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|upscaling
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_UPSCALING
suffix:semicolon
id|cam-&gt;auto_brt
op_assign
(paren
id|autobright
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|autobright
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|autobright
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_AUTOBRIGHT
suffix:semicolon
id|cam-&gt;auto_exp
op_assign
(paren
id|autoexp
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|autoexp
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|autoexp
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_AUTOEXP
suffix:semicolon
id|cam-&gt;lightfreq
op_assign
(paren
id|lightfreq
(braket
id|dev_nr
)braket
op_eq
l_int|50
op_logical_or
id|lightfreq
(braket
id|dev_nr
)braket
op_eq
l_int|60
)paren
ques
c_cond
(paren
id|u8
)paren
id|lightfreq
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_LIGHTFREQ
suffix:semicolon
id|cam-&gt;bandfilt
op_assign
(paren
id|bandingfilter
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|bandingfilter
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|bandingfilter
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_BANDINGFILTER
suffix:semicolon
id|cam-&gt;backlight
op_assign
(paren
id|backlight
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|backlight
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|backlight
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_BACKLIGHT
suffix:semicolon
id|cam-&gt;clockdiv
op_assign
(paren
id|clockdiv
(braket
id|dev_nr
)braket
op_eq
op_minus
l_int|1
op_logical_or
id|clockdiv
(braket
id|dev_nr
)braket
op_ge
l_int|0
)paren
ques
c_cond
(paren
id|s8
)paren
id|clockdiv
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_CLOCKDIV
suffix:semicolon
id|cam-&gt;mirror
op_assign
(paren
id|mirror
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|mirror
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|mirror
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_MIRROR
suffix:semicolon
id|cam-&gt;monochrome
op_assign
(paren
id|monochrome
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|monochrome
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
id|monochrome
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_MONOCHROME
suffix:semicolon
id|cam-&gt;picture.brightness
op_assign
(paren
id|u16
)paren
id|brightness
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;picture.hue
op_assign
(paren
id|u16
)paren
id|hue
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;picture.colour
op_assign
(paren
id|u16
)paren
id|colour
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;picture.contrast
op_assign
(paren
id|u16
)paren
id|contrast
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;picture.whiteness
op_assign
(paren
id|u16
)paren
id|whiteness
(braket
id|dev_nr
)braket
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_valid_palette
c_func
(paren
(paren
id|u16
)paren
id|force_palette
(braket
id|dev_nr
)braket
)paren
)paren
(brace
id|cam-&gt;picture.palette
op_assign
(paren
id|u16
)paren
id|force_palette
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;force_palette
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|cam-&gt;force_palette
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|0
)paren
id|cam-&gt;picture.palette
op_assign
id|W9968CF_PALETTE_DECOMP_OFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|1
)paren
id|cam-&gt;picture.palette
op_assign
id|W9968CF_PALETTE_DECOMP_FORCE
suffix:semicolon
r_else
id|cam-&gt;picture.palette
op_assign
id|W9968CF_PALETTE_DECOMP_ON
suffix:semicolon
)brace
id|cam-&gt;picture.depth
op_assign
id|w9968cf_valid_depth
c_func
(paren
id|cam-&gt;picture.palette
)paren
suffix:semicolon
id|cam-&gt;force_rgb
op_assign
(paren
id|force_rgb
(braket
id|dev_nr
)braket
op_eq
l_int|0
op_logical_or
id|force_rgb
(braket
id|dev_nr
)braket
op_eq
l_int|1
)paren
ques
c_cond
(paren
id|u8
)paren
id|force_rgb
(braket
id|dev_nr
)braket
suffix:colon
id|W9968CF_FORCE_RGB
suffix:semicolon
id|cam-&gt;window.x
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;window.y
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;window.width
op_assign
id|W9968CF_WIDTH
suffix:semicolon
id|cam-&gt;window.height
op_assign
id|W9968CF_HEIGHT
suffix:semicolon
id|cam-&gt;window.chromakey
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;window.clipcount
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;window.flags
op_assign
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;%s configured with settings #%u:&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
comma
id|dev_nr
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Data packet size for USB isochrnous transfer: %u bytes&quot;
comma
id|wMaxPacketSize
(braket
id|cam-&gt;altsetting
op_minus
l_int|1
)braket
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Number of requested video frame buffers: %u&quot;
comma
id|cam-&gt;max_buffers
)paren
r_if
c_cond
(paren
id|cam-&gt;double_buffer
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Hardware double buffering enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Hardware double buffering disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;filter_type
op_eq
l_int|0
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Video filtering disabled&quot;
)paren
r_else
r_if
c_cond
(paren
id|cam-&gt;filter_type
op_eq
l_int|1
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Video filtering enabled: type 1-2-1&quot;
)paren
r_else
r_if
c_cond
(paren
id|cam-&gt;filter_type
op_eq
l_int|2
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Video filtering enabled: type 2-3-6-3-2&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;clamping
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Video data clamping (CCIR-601 format) enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Video data clamping (CCIR-601 format) disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;largeview
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Large view enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Large view disabled&quot;
)paren
r_if
c_cond
(paren
(paren
id|cam-&gt;decompression
)paren
op_eq
l_int|0
op_logical_and
(paren
op_logical_neg
id|cam-&gt;force_palette
)paren
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Decompression disabled&quot;
)paren
r_else
r_if
c_cond
(paren
(paren
id|cam-&gt;decompression
)paren
op_eq
l_int|1
op_logical_and
(paren
op_logical_neg
id|cam-&gt;force_palette
)paren
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Decompression forced&quot;
)paren
r_else
r_if
c_cond
(paren
(paren
id|cam-&gt;decompression
)paren
op_eq
l_int|2
op_logical_and
(paren
op_logical_neg
id|cam-&gt;force_palette
)paren
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Decompression allowed&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;upscaling
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Software image scaling enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Software image scaling disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;force_palette
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Image palette forced to %s&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|cam-&gt;picture.palette
)paren
)paren
r_if
c_cond
(paren
id|cam-&gt;force_rgb
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- RGB component ordering will be used instead of BGR&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;auto_brt
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Auto brightness enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Auto brightness disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;auto_exp
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Auto exposure enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Auto exposure disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;backlight
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Backlight exposure algorithm enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Backlight exposure algorithm disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;mirror
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Mirror enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Mirror disabled&quot;
)paren
r_if
c_cond
(paren
id|cam-&gt;bandfilt
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Banding filter enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Banding filter disabled&quot;
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Power lighting frequency: %u&quot;
comma
id|cam-&gt;lightfreq
)paren
r_if
c_cond
(paren
id|cam-&gt;clockdiv
op_eq
op_minus
l_int|1
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Automatic clock divisor enabled&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Clock divisor: %d&quot;
comma
id|cam-&gt;clockdiv
)paren
r_if
c_cond
(paren
id|cam-&gt;monochrome
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Image sensor used as monochrome&quot;
)paren
r_else
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;- Image sensor not used as monochrome&quot;
)paren
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  If the video post-processing module is not loaded, some parameters&n;  must be overridden.&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_adjust_configuration
r_static
r_void
id|w9968cf_adjust_configuration
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_vpp
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|1
)paren
(brace
id|cam-&gt;decompression
op_assign
l_int|2
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module not found: &quot;
l_string|&quot;&squot;decompression&squot; parameter forced to 2&quot;
)paren
)brace
r_if
c_cond
(paren
id|cam-&gt;upscaling
)paren
(brace
id|cam-&gt;upscaling
op_assign
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module not found: &quot;
l_string|&quot;&squot;upscaling&squot; parameter forced to 0&quot;
)paren
)brace
r_if
c_cond
(paren
id|cam-&gt;picture.palette
op_ne
id|VIDEO_PALETTE_UYVY
)paren
(brace
id|cam-&gt;force_palette
op_assign
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module not found: &quot;
l_string|&quot;&squot;force_palette&squot; parameter forced to 0&quot;
)paren
)brace
id|cam-&gt;picture.palette
op_assign
id|VIDEO_PALETTE_UYVY
suffix:semicolon
id|cam-&gt;picture.depth
op_assign
id|w9968cf_valid_depth
c_func
(paren
id|cam-&gt;picture.palette
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*--------------------------------------------------------------------------&n;  Release the resources used by the driver.&n;  This function is called on disconnect &n;  (or on close if deallocation has been deferred)&n;  --------------------------------------------------------------------------*/
DECL|function|w9968cf_release_resources
r_static
r_void
id|w9968cf_release_resources
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
id|down
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;V4L device deregistered: /dev/video%d&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|video_unregister_device
c_func
(paren
id|cam-&gt;v4ldev
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|cam-&gt;v4llist
)paren
suffix:semicolon
id|i2c_del_adapter
c_func
(paren
op_amp
id|cam-&gt;i2c_adapter
)paren
suffix:semicolon
id|w9968cf_deallocate_memory
c_func
(paren
id|cam
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam-&gt;control_buffer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam-&gt;data_buffer
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Video4Linux interface                                                    *&n; ****************************************************************************/
DECL|function|w9968cf_open
r_static
r_int
id|w9968cf_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* This the only safe way to prevent race conditions with disconnect */
r_if
c_cond
(paren
op_logical_neg
id|down_read_trylock
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;sensor
op_eq
id|CC_UNKNOWN
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;No supported image sensor has been detected by the &quot;
l_string|&quot;&squot;ovcamchip&squot; module for the %s (/dev/video%d). Make &quot;
l_string|&quot;sure it is loaded *before* (re)connecting the camera.&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;users
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;%s (/dev/video%d) has been already occupied by &squot;%s&squot;&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
comma
id|cam-&gt;v4ldev-&gt;minor
comma
id|cam-&gt;command
)paren
r_if
c_cond
(paren
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
op_logical_or
(paren
id|filp-&gt;f_flags
op_amp
id|O_NDELAY
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible_exclusive
c_func
(paren
id|cam-&gt;open
comma
id|cam-&gt;disconnected
op_logical_or
op_logical_neg
id|cam-&gt;users
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Opening &squot;%s&squot;, /dev/video%d ...&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|cam-&gt;streaming
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;misconfigured
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_vpp
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_vppmod_detect
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_allocate_memory
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|deallocate_memory
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_init_chip
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|deallocate_memory
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_start_transfer
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|deallocate_memory
suffix:semicolon
id|filp-&gt;private_data
op_assign
id|cam
suffix:semicolon
id|cam-&gt;users
op_increment
suffix:semicolon
id|strcpy
c_func
(paren
id|cam-&gt;command
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|cam-&gt;wait_queue
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Video device is open&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|deallocate_memory
suffix:colon
id|w9968cf_deallocate_memory
c_func
(paren
id|cam
)paren
suffix:semicolon
id|out
suffix:colon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Failed to open the video device&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_release
r_static
r_int
id|w9968cf_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
multiline_comment|/* prevent disconnect() to be called */
id|w9968cf_stop_transfer
c_func
(paren
id|cam
)paren
suffix:semicolon
id|w9968cf_vppmod_release
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|w9968cf_release_resources
c_func
(paren
id|cam
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cam-&gt;users
op_decrement
suffix:semicolon
id|w9968cf_deallocate_memory
c_func
(paren
id|cam
)paren
suffix:semicolon
id|wake_up_interruptible_nr
c_func
(paren
op_amp
id|cam-&gt;open
comma
l_int|1
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Video device closed&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|w9968cf_read
id|w9968cf_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|f_pos
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
r_struct
id|w9968cf_frame_t
op_star
id|fr
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device not present&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;misconfigured
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|queued
)paren
id|w9968cf_push_frame
c_func
(paren
id|cam
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;frame
(braket
l_int|1
)braket
dot
id|queued
)paren
id|w9968cf_push_frame
c_func
(paren
id|cam
comma
l_int|1
)paren
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
c_func
(paren
id|cam-&gt;wait_queue
comma
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|status
op_eq
id|F_READY
op_logical_or
id|cam-&gt;frame
(braket
l_int|1
)braket
dot
id|status
op_eq
id|F_READY
op_logical_or
id|cam-&gt;disconnected
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|fr
op_assign
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|status
op_eq
id|F_READY
)paren
ques
c_cond
op_amp
id|cam-&gt;frame
(braket
l_int|0
)braket
suffix:colon
op_amp
id|cam-&gt;frame
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_vpp
)paren
id|w9968cf_postprocess_frame
c_func
(paren
id|cam
comma
id|fr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|fr-&gt;length
)paren
id|count
op_assign
id|fr-&gt;length
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|fr-&gt;buffer
comma
id|count
)paren
)paren
(brace
id|fr-&gt;status
op_assign
id|F_UNUSED
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|f_pos
op_add_assign
id|count
suffix:semicolon
id|fr-&gt;status
op_assign
id|F_UNUSED
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;%zu bytes read&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|w9968cf_mmap
r_static
r_int
id|w9968cf_mmap
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_int
r_int
id|vsize
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|psize
op_assign
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|size
comma
id|start
op_assign
id|vma-&gt;vm_start
comma
id|pos
op_assign
(paren
r_int
r_int
)paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
comma
id|page
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device not present&quot;
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;misconfigured
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;The camera is misconfigured. Close and open it again&quot;
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|PDBGG
c_func
(paren
l_string|&quot;mmapping %lu bytes...&quot;
comma
id|vsize
)paren
r_if
c_cond
(paren
id|vsize
OG
id|psize
op_minus
(paren
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_while
c_loop
(paren
id|vsize
OG
l_int|0
)paren
(brace
id|page
op_assign
id|vmalloc_to_pfn
c_func
(paren
(paren
r_void
op_star
)paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_pfn_range
c_func
(paren
id|vma
comma
id|start
comma
id|page
op_plus
id|vma-&gt;vm_pgoff
comma
id|PAGE_SIZE
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pos
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|vsize
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;mmap method successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|w9968cf_ioctl
id|w9968cf_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
r_int
id|err
suffix:semicolon
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device not present&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;misconfigured
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|err
op_assign
id|w9968cf_v4l_ioctl
c_func
(paren
id|inode
comma
id|filp
comma
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_v4l_ioctl
r_static
r_int
id|w9968cf_v4l_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
r_const
r_char
op_star
id|v4l1_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;?&quot;
comma
l_string|&quot;CGAP&quot;
comma
l_string|&quot;GCHAN&quot;
comma
l_string|&quot;SCHAN&quot;
comma
l_string|&quot;GTUNER&quot;
comma
l_string|&quot;STUNER&quot;
comma
l_string|&quot;GPICT&quot;
comma
l_string|&quot;SPICT&quot;
comma
l_string|&quot;CCAPTURE&quot;
comma
l_string|&quot;GWIN&quot;
comma
l_string|&quot;SWIN&quot;
comma
l_string|&quot;GFBUF&quot;
comma
l_string|&quot;SFBUF&quot;
comma
l_string|&quot;KEY&quot;
comma
l_string|&quot;GFREQ&quot;
comma
l_string|&quot;SFREQ&quot;
comma
l_string|&quot;GAUDIO&quot;
comma
l_string|&quot;SAUDIO&quot;
comma
l_string|&quot;SYNC&quot;
comma
l_string|&quot;MCAPTURE&quot;
comma
l_string|&quot;GMBUF&quot;
comma
l_string|&quot;GUNIT&quot;
comma
l_string|&quot;GCAPTURE&quot;
comma
l_string|&quot;SCAPTURE&quot;
comma
l_string|&quot;SPLAYMODE&quot;
comma
l_string|&quot;SWRITEMODE&quot;
comma
l_string|&quot;GPLAYINFO&quot;
comma
l_string|&quot;SMICROCODE&quot;
comma
l_string|&quot;GVBIFMT&quot;
comma
l_string|&quot;SVBIFMT&quot;
)brace
suffix:semicolon
DECL|macro|V4L1_IOCTL
mdefine_line|#define V4L1_IOCTL(cmd) &bslash;&n;&t;        ((_IOC_NR((cmd)) &lt; sizeof(v4l1_ioctls)/sizeof(char*)) ? &bslash;&n;&t;        v4l1_ioctls[_IOC_NR((cmd))] : &quot;?&quot;)
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
multiline_comment|/* get video capability */
(brace
r_struct
id|video_capability
id|cap
op_assign
(brace
dot
id|type
op_assign
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_SCALES
comma
dot
id|channels
op_assign
l_int|1
comma
dot
id|audios
op_assign
l_int|0
comma
dot
id|minwidth
op_assign
id|cam-&gt;minwidth
comma
dot
id|minheight
op_assign
id|cam-&gt;minheight
comma
)brace
suffix:semicolon
id|sprintf
c_func
(paren
id|cap.name
comma
l_string|&quot;W996[87]CF USB Camera #%d&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
suffix:semicolon
id|cap.maxwidth
op_assign
(paren
id|cam-&gt;upscaling
op_logical_and
id|w9968cf_vpp
)paren
ques
c_cond
id|max
c_func
(paren
(paren
id|u16
)paren
id|W9968CF_MAX_WIDTH
comma
id|cam-&gt;maxwidth
)paren
suffix:colon
id|cam-&gt;maxwidth
suffix:semicolon
id|cap.maxheight
op_assign
(paren
id|cam-&gt;upscaling
op_logical_and
id|w9968cf_vpp
)paren
ques
c_cond
id|max
c_func
(paren
(paren
id|u16
)paren
id|W9968CF_MAX_HEIGHT
comma
id|cam-&gt;maxheight
)paren
suffix:colon
id|cam-&gt;maxheight
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|cap
comma
r_sizeof
(paren
id|cap
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGCAP successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGCHAN
suffix:colon
multiline_comment|/* get video channel informations */
(brace
r_struct
id|video_channel
id|chan
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|chan
comma
id|arg
comma
r_sizeof
(paren
id|chan
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|chan.channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|strcpy
c_func
(paren
id|chan.name
comma
l_string|&quot;Camera&quot;
)paren
suffix:semicolon
id|chan.tuners
op_assign
l_int|0
suffix:semicolon
id|chan.flags
op_assign
l_int|0
suffix:semicolon
id|chan.type
op_assign
id|VIDEO_TYPE_CAMERA
suffix:semicolon
id|chan.norm
op_assign
id|VIDEO_MODE_AUTO
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|chan
comma
r_sizeof
(paren
id|chan
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGCHAN successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSCHAN
suffix:colon
multiline_comment|/* set active channel */
(brace
r_struct
id|video_channel
id|chan
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|chan
comma
id|arg
comma
r_sizeof
(paren
id|chan
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|chan.channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCSCHAN successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGPICT
suffix:colon
multiline_comment|/* get image properties of the picture */
(brace
r_if
c_cond
(paren
id|w9968cf_sensor_get_picture
c_func
(paren
id|cam
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|cam-&gt;picture
comma
r_sizeof
(paren
id|cam-&gt;picture
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGPICT successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSPICT
suffix:colon
multiline_comment|/* change picture settings */
(brace
r_struct
id|video_picture
id|pict
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|pict
comma
id|arg
comma
r_sizeof
(paren
id|pict
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cam-&gt;force_palette
op_logical_or
op_logical_neg
id|w9968cf_vpp
)paren
op_logical_and
id|pict.palette
op_ne
id|cam-&gt;picture.palette
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Palette %s rejected: only %s is allowed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|cam-&gt;picture.palette
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_valid_palette
c_func
(paren
id|pict.palette
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Palette %s not supported. VIDIOCSPICT failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;force_palette
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|w9968cf_need_decompression
c_func
(paren
id|pict.palette
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Decompression disabled: palette %s is not &quot;
l_string|&quot;allowed. VIDIOCSPICT failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_need_decompression
c_func
(paren
id|pict.palette
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Decompression forced: palette %s is not &quot;
l_string|&quot;allowed. VIDIOCSPICT failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|pict.depth
op_ne
id|w9968cf_valid_depth
c_func
(paren
id|pict.palette
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Requested depth %u bpp is not valid for %s &quot;
l_string|&quot;palette: ignored and changed to %u bpp&quot;
comma
id|pict.depth
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|pict.palette
)paren
comma
id|w9968cf_valid_depth
c_func
(paren
id|pict.palette
)paren
)paren
id|pict.depth
op_assign
id|w9968cf_valid_depth
c_func
(paren
id|pict.palette
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pict.palette
op_ne
id|cam-&gt;picture.palette
)paren
(brace
r_if
c_cond
(paren
op_star
id|cam-&gt;requested_frame
op_logical_or
id|cam-&gt;frame_current-&gt;queued
)paren
(brace
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_queue
comma
id|cam-&gt;disconnected
op_logical_or
(paren
op_logical_neg
op_star
id|cam-&gt;requested_frame
op_logical_and
op_logical_neg
id|cam-&gt;frame_current-&gt;queued
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w9968cf_stop_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_set_picture
c_func
(paren
id|cam
comma
id|pict
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_start_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|w9968cf_sensor_update_picture
c_func
(paren
id|cam
comma
id|pict
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCSPICT successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSWIN
suffix:colon
multiline_comment|/* set capture area */
(brace
r_struct
id|video_window
id|win
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|win
comma
id|arg
comma
r_sizeof
(paren
id|win
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;VIDIOCSWIN called: clipcount=%d, flags=%u, &quot;
l_string|&quot;x=%u, y=%u, %ux%u&quot;
comma
id|win.clipcount
comma
id|win.flags
comma
id|win.x
comma
id|win.y
comma
id|win.width
comma
id|win.height
)paren
r_if
c_cond
(paren
id|win.clipcount
op_ne
l_int|0
op_logical_or
id|win.flags
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_adjust_window_size
c_func
(paren
id|cam
comma
(paren
id|u16
op_star
)paren
op_amp
id|win.width
comma
(paren
id|u16
op_star
)paren
op_amp
id|win.height
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Resolution not supported (%ux%u). &quot;
l_string|&quot;VIDIOCSWIN failed&quot;
comma
id|win.width
comma
id|win.height
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|win.x
op_ne
id|cam-&gt;window.x
op_logical_or
id|win.y
op_ne
id|cam-&gt;window.y
op_logical_or
id|win.width
op_ne
id|cam-&gt;window.width
op_logical_or
id|win.height
op_ne
id|cam-&gt;window.height
)paren
(brace
r_if
c_cond
(paren
op_star
id|cam-&gt;requested_frame
op_logical_or
id|cam-&gt;frame_current-&gt;queued
)paren
(brace
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_queue
comma
id|cam-&gt;disconnected
op_logical_or
(paren
op_logical_neg
op_star
id|cam-&gt;requested_frame
op_logical_and
op_logical_neg
id|cam-&gt;frame_current-&gt;queued
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w9968cf_stop_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
multiline_comment|/* This _must_ be called before set_window() */
r_if
c_cond
(paren
id|w9968cf_set_picture
c_func
(paren
id|cam
comma
id|cam-&gt;picture
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_set_window
c_func
(paren
id|cam
comma
id|win
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_start_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCSWIN successfully called. &quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGWIN
suffix:colon
multiline_comment|/* get current window properties */
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|cam-&gt;window
comma
r_sizeof
(paren
r_struct
id|video_window
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGWIN successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGMBUF
suffix:colon
multiline_comment|/* request for memory (mapped) buffer */
(brace
r_struct
id|video_mbuf
id|mbuf
suffix:semicolon
id|u8
id|i
suffix:semicolon
id|mbuf.size
op_assign
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|size
suffix:semicolon
id|mbuf.frames
op_assign
id|cam-&gt;nbuffers
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
id|mbuf.offsets
(braket
id|i
)braket
op_assign
(paren
r_int
r_int
)paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buffer
op_minus
(paren
r_int
r_int
)paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|mbuf
comma
r_sizeof
(paren
id|mbuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGMBUF successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCMCAPTURE
suffix:colon
multiline_comment|/* start the capture to a frame */
(brace
r_struct
id|video_mmap
id|mmap
suffix:semicolon
r_struct
id|w9968cf_frame_t
op_star
id|fr
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mmap
comma
id|arg
comma
r_sizeof
(paren
id|mmap
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;VIDIOCMCAPTURE called: frame #%u, format=%s, %dx%d&quot;
comma
id|mmap.frame
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
comma
id|mmap.width
comma
id|mmap.height
)paren
r_if
c_cond
(paren
id|mmap.frame
op_ge
id|cam-&gt;nbuffers
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Invalid frame number (%u). &quot;
l_string|&quot;VIDIOCMCAPTURE failed&quot;
comma
id|mmap.frame
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mmap.format
op_ne
id|cam-&gt;picture.palette
op_logical_and
(paren
id|cam-&gt;force_palette
op_logical_or
op_logical_neg
id|w9968cf_vpp
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Palette %s rejected: only %s is allowed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|cam-&gt;picture.palette
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_valid_palette
c_func
(paren
id|mmap.format
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Palette %s not supported. &quot;
l_string|&quot;VIDIOCMCAPTURE failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;force_palette
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|w9968cf_need_decompression
c_func
(paren
id|mmap.format
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Decompression disabled: palette %s is not &quot;
l_string|&quot;allowed. VIDIOCSPICT failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cam-&gt;decompression
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_need_decompression
c_func
(paren
id|mmap.format
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Decompression forced: palette %s is not &quot;
l_string|&quot;allowed. VIDIOCSPICT failed&quot;
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|w9968cf_adjust_window_size
c_func
(paren
id|cam
comma
(paren
id|u16
op_star
)paren
op_amp
id|mmap.width
comma
(paren
id|u16
op_star
)paren
op_amp
id|mmap.height
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Resolution not supported (%dx%d). &quot;
l_string|&quot;VIDIOCMCAPTURE failed&quot;
comma
id|mmap.width
comma
id|mmap.height
)paren
r_return
id|err
suffix:semicolon
)brace
id|fr
op_assign
op_amp
id|cam-&gt;frame
(braket
id|mmap.frame
)braket
suffix:semicolon
r_if
c_cond
(paren
id|mmap.width
op_ne
id|cam-&gt;window.width
op_logical_or
id|mmap.height
op_ne
id|cam-&gt;window.height
op_logical_or
id|mmap.format
op_ne
id|cam-&gt;picture.palette
)paren
(brace
r_struct
id|video_window
id|win
suffix:semicolon
r_struct
id|video_picture
id|pict
suffix:semicolon
r_if
c_cond
(paren
op_star
id|cam-&gt;requested_frame
op_logical_or
id|cam-&gt;frame_current-&gt;queued
)paren
(brace
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;VIDIOCMCAPTURE. Change settings for &quot;
l_string|&quot;frame #%u: %dx%d, format %s. Wait...&quot;
comma
id|mmap.frame
comma
id|mmap.width
comma
id|mmap.height
comma
id|symbolic
c_func
(paren
id|v4l1_plist
comma
id|mmap.format
)paren
)paren
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_queue
comma
id|cam-&gt;disconnected
op_logical_or
(paren
op_logical_neg
op_star
id|cam-&gt;requested_frame
op_logical_and
op_logical_neg
id|cam-&gt;frame_current-&gt;queued
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|win
comma
op_amp
id|cam-&gt;window
comma
r_sizeof
(paren
id|win
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|pict
comma
op_amp
id|cam-&gt;picture
comma
r_sizeof
(paren
id|pict
)paren
)paren
suffix:semicolon
id|win.width
op_assign
id|mmap.width
suffix:semicolon
id|win.height
op_assign
id|mmap.height
suffix:semicolon
id|pict.palette
op_assign
id|mmap.format
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_stop_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
multiline_comment|/* This before set_window */
r_if
c_cond
(paren
id|w9968cf_set_picture
c_func
(paren
id|cam
comma
id|pict
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_set_window
c_func
(paren
id|cam
comma
id|win
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_start_transfer
c_func
(paren
id|cam
)paren
)paren
r_goto
id|ioctl_fail
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fr-&gt;queued
)paren
(brace
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;Wait until frame #%u is free&quot;
comma
id|mmap.frame
)paren
id|err
op_assign
id|wait_event_interruptible
c_func
(paren
id|cam-&gt;wait_queue
comma
id|cam-&gt;disconnected
op_logical_or
(paren
op_logical_neg
id|fr-&gt;queued
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|w9968cf_push_frame
c_func
(paren
id|cam
comma
id|mmap.frame
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCMCAPTURE(%u): successfully called&quot;
comma
id|mmap.frame
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSYNC
suffix:colon
multiline_comment|/* wait until the capture of a frame is finished */
(brace
r_int
r_int
id|f_num
suffix:semicolon
r_struct
id|w9968cf_frame_t
op_star
id|fr
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|f_num
comma
id|arg
comma
r_sizeof
(paren
id|f_num
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|f_num
op_ge
id|cam-&gt;nbuffers
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Invalid frame number (%u). &quot;
l_string|&quot;VIDIOCMCAPTURE failed&quot;
comma
id|f_num
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|6
comma
l_string|&quot;VIDIOCSYNC called for frame #%u&quot;
comma
id|f_num
)paren
id|fr
op_assign
op_amp
id|cam-&gt;frame
(braket
id|f_num
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|fr-&gt;status
)paren
(brace
r_case
id|F_UNUSED
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|fr-&gt;queued
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;VIDIOSYNC: Frame #%u not requested!&quot;
comma
id|f_num
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_case
id|F_ERROR
suffix:colon
r_case
id|F_GRABBING
suffix:colon
id|err
op_assign
id|wait_event_interruptible
c_func
(paren
id|cam-&gt;wait_queue
comma
(paren
id|fr-&gt;status
op_eq
id|F_READY
)paren
op_logical_or
id|cam-&gt;disconnected
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;disconnected
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
r_case
id|F_READY
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w9968cf_vpp
)paren
id|w9968cf_postprocess_frame
c_func
(paren
id|cam
comma
id|fr
)paren
suffix:semicolon
id|fr-&gt;status
op_assign
id|F_UNUSED
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCSYNC(%u) successfully called&quot;
comma
id|f_num
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGUNIT
suffix:colon
multiline_comment|/* report the unit numbers of the associated devices*/
(brace
r_struct
id|video_unit
id|unit
op_assign
(brace
dot
id|video
op_assign
id|cam-&gt;v4ldev-&gt;minor
comma
dot
id|vbi
op_assign
id|VIDEO_NO_UNIT
comma
dot
id|radio
op_assign
id|VIDEO_NO_UNIT
comma
dot
id|audio
op_assign
id|VIDEO_NO_UNIT
comma
dot
id|teletext
op_assign
id|VIDEO_NO_UNIT
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|unit
comma
r_sizeof
(paren
id|unit
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGUNIT successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCKEY
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCGFBUF
suffix:colon
(brace
r_if
c_cond
(paren
id|clear_user
c_func
(paren
id|arg
comma
r_sizeof
(paren
r_struct
id|video_buffer
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGFBUF successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|tuner
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tuner
comma
id|arg
comma
r_sizeof
(paren
id|tuner
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|tuner.tuner
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|strcpy
c_func
(paren
id|tuner.name
comma
l_string|&quot;no_tuner&quot;
)paren
suffix:semicolon
id|tuner.rangelow
op_assign
l_int|0
suffix:semicolon
id|tuner.rangehigh
op_assign
l_int|0
suffix:semicolon
id|tuner.flags
op_assign
id|VIDEO_TUNER_NORM
suffix:semicolon
id|tuner.mode
op_assign
id|VIDEO_MODE_AUTO
suffix:semicolon
id|tuner.signal
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|tuner
comma
r_sizeof
(paren
id|tuner
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCGTUNER successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSTUNER
suffix:colon
(brace
r_struct
id|video_tuner
id|tuner
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tuner
comma
id|arg
comma
r_sizeof
(paren
id|tuner
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|tuner.tuner
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|tuner.mode
op_ne
id|VIDEO_MODE_AUTO
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;VIDIOCSTUNER successfully called&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSFBUF
suffix:colon
r_case
id|VIDIOCCAPTURE
suffix:colon
r_case
id|VIDIOCGFREQ
suffix:colon
r_case
id|VIDIOCSFREQ
suffix:colon
r_case
id|VIDIOCGAUDIO
suffix:colon
r_case
id|VIDIOCSAUDIO
suffix:colon
r_case
id|VIDIOCSPLAYMODE
suffix:colon
r_case
id|VIDIOCSWRITEMODE
suffix:colon
r_case
id|VIDIOCGPLAYINFO
suffix:colon
r_case
id|VIDIOCSMICROCODE
suffix:colon
r_case
id|VIDIOCGVBIFMT
suffix:colon
r_case
id|VIDIOCSVBIFMT
suffix:colon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Unsupported V4L1 IOCtl: VIDIOC%s &quot;
l_string|&quot;(type 0x%01X, &quot;
l_string|&quot;n. 0x%01X, &quot;
l_string|&quot;dir. 0x%01X, &quot;
l_string|&quot;size 0x%02X)&quot;
comma
id|V4L1_IOCTL
c_func
(paren
id|cmd
)paren
comma
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
comma
id|_IOC_NR
c_func
(paren
id|cmd
)paren
comma
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
comma
id|_IOC_SIZE
c_func
(paren
id|cmd
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Invalid V4L1 IOCtl: VIDIOC%s &quot;
l_string|&quot;type 0x%01X, &quot;
l_string|&quot;n. 0x%01X, &quot;
l_string|&quot;dir. 0x%01X, &quot;
l_string|&quot;size 0x%02X&quot;
comma
id|V4L1_IOCTL
c_func
(paren
id|cmd
)paren
comma
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
comma
id|_IOC_NR
c_func
(paren
id|cmd
)paren
comma
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
comma
id|_IOC_SIZE
c_func
(paren
id|cmd
)paren
)paren
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
multiline_comment|/* end of switch */
id|ioctl_fail
suffix:colon
id|cam-&gt;misconfigured
op_assign
l_int|1
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC%s failed because of hardware problems. &quot;
l_string|&quot;To use the camera, close and open it again.&quot;
comma
id|V4L1_IOCTL
c_func
(paren
id|cmd
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
DECL|variable|w9968cf_fops
r_static
r_struct
id|file_operations
id|w9968cf_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|w9968cf_open
comma
dot
id|release
op_assign
id|w9968cf_release
comma
dot
id|read
op_assign
id|w9968cf_read
comma
dot
id|ioctl
op_assign
id|w9968cf_ioctl
comma
dot
id|mmap
op_assign
id|w9968cf_mmap
comma
dot
id|llseek
op_assign
id|no_llseek
comma
)brace
suffix:semicolon
multiline_comment|/****************************************************************************&n; * USB probe and V4L registration, disconnect and id_table[] definition     *&n; ****************************************************************************/
r_static
r_int
DECL|function|w9968cf_usb_probe
id|w9968cf_usb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|w9968cf_device
op_star
id|cam
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_enum
id|w9968cf_model_id
id|mod_id
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
id|u8
id|sc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* number of simultaneous cameras */
r_static
r_int
r_int
id|dev_nr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* we are handling device number n */
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|udev-&gt;descriptor.idVendor
)paren
op_eq
id|winbond_id_table
(braket
l_int|0
)braket
dot
id|idVendor
op_logical_and
id|le16_to_cpu
c_func
(paren
id|udev-&gt;descriptor.idProduct
)paren
op_eq
id|winbond_id_table
(braket
l_int|0
)braket
dot
id|idProduct
)paren
id|mod_id
op_assign
id|W9968CF_MOD_CLVBWGP
suffix:semicolon
multiline_comment|/* see camlist[] table */
r_else
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|udev-&gt;descriptor.idVendor
)paren
op_eq
id|winbond_id_table
(braket
l_int|1
)braket
dot
id|idVendor
op_logical_and
id|le16_to_cpu
c_func
(paren
id|udev-&gt;descriptor.idProduct
)paren
op_eq
id|winbond_id_table
(braket
l_int|1
)braket
dot
id|idProduct
)paren
id|mod_id
op_assign
id|W9968CF_MOD_GENERIC
suffix:semicolon
multiline_comment|/* see camlist[] table */
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|w9968cf_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|cam
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cam
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|cam-&gt;usbdev
op_assign
id|udev
suffix:semicolon
multiline_comment|/* NOTE: a local copy is used to avoid possible race conditions */
id|memcpy
c_func
(paren
op_amp
id|cam-&gt;dev
comma
op_amp
id|udev-&gt;dev
comma
r_sizeof
(paren
r_struct
id|device
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;%s detected&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|mod_id
)paren
)paren
r_if
c_cond
(paren
id|simcams
OG
id|W9968CF_MAX_DEVICES
)paren
id|simcams
op_assign
id|W9968CF_SIMCAMS
suffix:semicolon
multiline_comment|/* How many cameras are connected ? */
id|down
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|ptr
comma
op_amp
id|w9968cf_dev_list
)paren
id|sc
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sc
op_ge
id|simcams
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device rejected: too many connected cameras &quot;
l_string|&quot;(max. %u)&quot;
comma
id|simcams
)paren
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* Allocate 2 bytes of memory for camera control USB transfers */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;control_buffer
op_assign
(paren
id|u16
op_star
)paren
id|kmalloc
c_func
(paren
l_int|2
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for camera control transfers&quot;
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cam-&gt;control_buffer
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Allocate 8 bytes of memory for USB data transfers to the FSB */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;data_buffer
op_assign
(paren
id|u16
op_star
)paren
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t allocate memory for data &quot;
l_string|&quot;transfers to the FSB&quot;
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cam-&gt;data_buffer
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Register the V4L device */
id|cam-&gt;v4ldev
op_assign
id|video_device_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;v4ldev
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Could not allocate memory for a V4L structure&quot;
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|cam-&gt;v4ldev-&gt;name
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|mod_id
)paren
)paren
suffix:semicolon
id|cam-&gt;v4ldev-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|cam-&gt;v4ldev-&gt;type
op_assign
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_SCALES
suffix:semicolon
id|cam-&gt;v4ldev-&gt;hardware
op_assign
id|VID_HARDWARE_W9968CF
suffix:semicolon
id|cam-&gt;v4ldev-&gt;fops
op_assign
op_amp
id|w9968cf_fops
suffix:semicolon
id|cam-&gt;v4ldev-&gt;minor
op_assign
id|video_nr
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;v4ldev-&gt;release
op_assign
id|video_device_release
suffix:semicolon
id|video_set_drvdata
c_func
(paren
id|cam-&gt;v4ldev
comma
id|cam
)paren
suffix:semicolon
id|cam-&gt;v4ldev-&gt;dev
op_assign
op_amp
id|cam-&gt;dev
suffix:semicolon
id|err
op_assign
id|video_register_device
c_func
(paren
id|cam-&gt;v4ldev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
(braket
id|dev_nr
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;V4L device registration failed&quot;
)paren
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|ENFILE
op_logical_and
id|video_nr
(braket
id|dev_nr
)braket
op_eq
op_minus
l_int|1
)paren
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Couldn&squot;t find a free /dev/videoX node&quot;
)paren
id|video_nr
(braket
id|dev_nr
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev_nr
op_assign
(paren
id|dev_nr
OL
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)paren
ques
c_cond
id|dev_nr
op_plus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;V4L device registered as /dev/video%d&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
multiline_comment|/* Set some basic constants */
id|w9968cf_configure_camera
c_func
(paren
id|cam
comma
id|udev
comma
id|mod_id
comma
id|dev_nr
)paren
suffix:semicolon
multiline_comment|/* Add a new entry into the list of V4L registered devices */
id|down
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|cam-&gt;v4llist
comma
op_amp
id|w9968cf_dev_list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|w9968cf_devlist_sem
)paren
suffix:semicolon
id|dev_nr
op_assign
(paren
id|dev_nr
OL
id|W9968CF_MAX_DEVICES
op_minus
l_int|1
)paren
ques
c_cond
id|dev_nr
op_plus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|w9968cf_turn_on_led
c_func
(paren
id|cam
)paren
suffix:semicolon
id|w9968cf_i2c_init
c_func
(paren
id|cam
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|cam
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
multiline_comment|/* Free unused memory */
r_if
c_cond
(paren
id|cam-&gt;control_buffer
)paren
id|kfree
c_func
(paren
id|cam-&gt;control_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;data_buffer
)paren
id|kfree
c_func
(paren
id|cam-&gt;data_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;v4ldev
)paren
id|video_device_release
c_func
(paren
id|cam-&gt;v4ldev
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|w9968cf_usb_disconnect
r_static
r_void
id|w9968cf_usb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|w9968cf_device
op_star
id|cam
op_assign
(paren
r_struct
id|w9968cf_device
op_star
)paren
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam
)paren
(brace
multiline_comment|/* Prevent concurrent accesses to data */
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|cam-&gt;disconnected
op_assign
l_int|1
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Disconnecting %s...&quot;
comma
id|symbolic
c_func
(paren
id|camlist
comma
id|cam-&gt;id
)paren
)paren
id|wake_up_interruptible_all
c_func
(paren
op_amp
id|cam-&gt;open
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;users
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;The device is open (/dev/video%d)! &quot;
l_string|&quot;Process name: %s. Deregistration and memory &quot;
l_string|&quot;deallocation are deferred on close.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
comma
id|cam-&gt;command
)paren
id|cam-&gt;misconfigured
op_assign
l_int|1
suffix:semicolon
id|w9968cf_stop_transfer
c_func
(paren
id|cam
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_queue
)paren
suffix:semicolon
)brace
r_else
id|w9968cf_release_resources
c_func
(paren
id|cam
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;users
)paren
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|w9968cf_disconnect
)paren
suffix:semicolon
)brace
DECL|variable|w9968cf_usb_driver
r_static
r_struct
id|usb_driver
id|w9968cf_usb_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;w9968cf&quot;
comma
dot
id|id_table
op_assign
id|winbond_id_table
comma
dot
id|probe
op_assign
id|w9968cf_usb_probe
comma
dot
id|disconnect
op_assign
id|w9968cf_usb_disconnect
comma
)brace
suffix:semicolon
multiline_comment|/****************************************************************************&n; * Module init, exit and intermodule communication                          *&n; ****************************************************************************/
DECL|function|w9968cf_vppmod_detect
r_static
r_int
id|w9968cf_vppmod_detect
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_vpp
)paren
r_if
c_cond
(paren
id|vppmod_load
)paren
id|request_module
c_func
(paren
l_string|&quot;w9968cf-vpp&quot;
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_vpp
)paren
(brace
id|DBG
c_func
(paren
l_int|4
comma
l_string|&quot;Video post-processing module not detected&quot;
)paren
id|w9968cf_adjust_configuration
c_func
(paren
id|cam
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|w9968cf_vpp-&gt;owner
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Couldn&squot;t increment the reference count of &quot;
l_string|&quot;the video post-processing module&quot;
)paren
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
id|w9968cf_vpp-&gt;busy
op_increment
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Video post-processing module detected&quot;
)paren
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_vppmod_release
r_static
r_void
id|w9968cf_vppmod_release
c_func
(paren
r_struct
id|w9968cf_device
op_star
id|cam
)paren
(brace
id|down
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_vpp
op_logical_and
id|w9968cf_vpp-&gt;busy
)paren
(brace
id|module_put
c_func
(paren
id|w9968cf_vpp-&gt;owner
)paren
suffix:semicolon
id|w9968cf_vpp-&gt;busy
op_decrement
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|w9968cf_vppmod_wait
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|5
comma
l_string|&quot;Video post-processing module released&quot;
)paren
)brace
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
)brace
DECL|function|w9968cf_vppmod_register
r_int
id|w9968cf_vppmod_register
c_func
(paren
r_struct
id|w9968cf_vpp_t
op_star
id|vpp
)paren
(brace
id|down
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w9968cf_vpp
)paren
(brace
id|KDBG
c_func
(paren
l_int|1
comma
l_string|&quot;Video post-processing module already registered&quot;
)paren
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|w9968cf_vpp
op_assign
id|vpp
suffix:semicolon
id|w9968cf_vpp-&gt;busy
op_assign
l_int|0
suffix:semicolon
id|KDBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module registered&quot;
)paren
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_vppmod_deregister
r_int
id|w9968cf_vppmod_deregister
c_func
(paren
r_struct
id|w9968cf_vpp_t
op_star
id|vpp
)paren
(brace
id|down
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|w9968cf_vpp
)paren
(brace
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w9968cf_vpp
op_ne
id|vpp
)paren
(brace
id|KDBG
c_func
(paren
l_int|1
comma
l_string|&quot;Only the owner can unregister the video &quot;
l_string|&quot;post-processing module&quot;
)paren
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w9968cf_vpp-&gt;busy
)paren
(brace
id|KDBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module busy. Wait for it to be &quot;
l_string|&quot;released...&quot;
)paren
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|w9968cf_vppmod_wait
comma
op_logical_neg
id|w9968cf_vpp-&gt;busy
)paren
suffix:semicolon
id|w9968cf_vpp
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|w9968cf_vpp
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|w9968cf_vppmod_lock
)paren
suffix:semicolon
id|out
suffix:colon
id|KDBG
c_func
(paren
l_int|2
comma
l_string|&quot;Video post-processing module unregistered&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_module_init
r_static
r_int
id|__init
id|w9968cf_module_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|KDBG
c_func
(paren
l_int|2
comma
id|W9968CF_MODULE_NAME
l_string|&quot; &quot;
id|W9968CF_MODULE_VERSION
)paren
id|KDBG
c_func
(paren
l_int|3
comma
id|W9968CF_MODULE_AUTHOR
)paren
r_if
c_cond
(paren
id|ovmod_load
)paren
id|request_module
c_func
(paren
l_string|&quot;ovcamchip&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|w9968cf_usb_driver
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w9968cf_module_exit
r_static
r_void
id|__exit
id|w9968cf_module_exit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* w9968cf_usb_disconnect() will be called */
id|usb_deregister
c_func
(paren
op_amp
id|w9968cf_usb_driver
)paren
suffix:semicolon
id|KDBG
c_func
(paren
l_int|2
comma
id|W9968CF_MODULE_NAME
l_string|&quot; deregistered&quot;
)paren
)brace
DECL|variable|w9968cf_module_init
id|module_init
c_func
(paren
id|w9968cf_module_init
)paren
suffix:semicolon
DECL|variable|w9968cf_module_exit
id|module_exit
c_func
(paren
id|w9968cf_module_exit
)paren
suffix:semicolon
DECL|variable|w9968cf_vppmod_register
id|EXPORT_SYMBOL
c_func
(paren
id|w9968cf_vppmod_register
)paren
suffix:semicolon
DECL|variable|w9968cf_vppmod_deregister
id|EXPORT_SYMBOL
c_func
(paren
id|w9968cf_vppmod_deregister
)paren
suffix:semicolon
eof
