multiline_comment|/***************************************************************************&n; * V4L2 driver for SN9C10x PC Camera Controllers                           *&n; *                                                                         *&n; * Copyright (C) 2004 by Luca Risolia &lt;luca.risolia@studio.unibo.it&gt;       *&n; *                                                                         *&n; * This program is free software; you can redistribute it and/or modify    *&n; * it under the terms of the GNU General Public License as published by    *&n; * the Free Software Foundation; either version 2 of the License, or       *&n; * (at your option) any later version.                                     *&n; *                                                                         *&n; * This program is distributed in the hope that it will be useful,         *&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of          *&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           *&n; * GNU General Public License for more details.                            *&n; *                                                                         *&n; * You should have received a copy of the GNU General Public License       *&n; * along with this program; if not, write to the Free Software             *&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.               *&n; ***************************************************************************/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/page-flags.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;sn9c102.h&quot;
multiline_comment|/*****************************************************************************/
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|sn9c102_id_table
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
id|SN9C102_MODULE_AUTHOR
l_string|&quot; &quot;
id|SN9C102_AUTHOR_EMAIL
)paren
suffix:semicolon
DECL|variable|SN9C102_MODULE_NAME
id|MODULE_DESCRIPTION
c_func
(paren
id|SN9C102_MODULE_NAME
)paren
suffix:semicolon
DECL|variable|SN9C102_MODULE_VERSION
id|MODULE_VERSION
c_func
(paren
id|SN9C102_MODULE_VERSION
)paren
suffix:semicolon
DECL|variable|SN9C102_MODULE_LICENSE
id|MODULE_LICENSE
c_func
(paren
id|SN9C102_MODULE_LICENSE
)paren
suffix:semicolon
DECL|variable|video_nr
r_static
r_int
id|video_nr
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|SN9C102_MAX_DEVICES
op_minus
l_int|1
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|nv
r_static
r_int
r_int
id|nv
suffix:semicolon
id|module_param_array
c_func
(paren
id|video_nr
comma
r_int
comma
id|nv
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|video_nr
comma
l_string|&quot;&bslash;n&lt;-1|n[,...]&gt; Specify V4L2 minor mode number.&quot;
l_string|&quot;&bslash;n -1 = use next available (default)&quot;
l_string|&quot;&bslash;n  n = use minor number n (integer &gt;= 0)&quot;
l_string|&quot;&bslash;nYou can specify up to &quot;
id|__MODULE_STRING
c_func
(paren
id|SN9C102_MAX_DEVICES
)paren
l_string|&quot; cameras this way.&quot;
l_string|&quot;&bslash;nFor example:&quot;
l_string|&quot;&bslash;nvideo_nr=-1,2,-1 would assign minor number 2 to&quot;
l_string|&quot;&bslash;nthe second camera and use auto for the first&quot;
l_string|&quot;&bslash;none and for every other camera.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef SN9C102_DEBUG
DECL|variable|debug
r_static
r_int
r_int
id|debug
op_assign
id|SN9C102_DEBUG_LEVEL
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
id|ushort
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;&bslash;n&lt;n&gt; Debugging information level, from 0 to 3:&quot;
l_string|&quot;&bslash;n0 = none (use carefully)&quot;
l_string|&quot;&bslash;n1 = critical errors&quot;
l_string|&quot;&bslash;n2 = significant informations&quot;
l_string|&quot;&bslash;n3 = more verbose messages&quot;
l_string|&quot;&bslash;nLevel 3 is useful for testing only, when only &quot;
l_string|&quot;one device is used.&quot;
l_string|&quot;&bslash;nDefault value is &quot;
id|__MODULE_STRING
c_func
(paren
id|SN9C102_DEBUG_LEVEL
)paren
l_string|&quot;.&quot;
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*****************************************************************************/
DECL|typedef|sn9c102_sof_header_t
r_typedef
r_char
id|sn9c102_sof_header_t
(braket
l_int|12
)braket
suffix:semicolon
DECL|typedef|sn9c102_eof_header_t
r_typedef
r_char
id|sn9c102_eof_header_t
(braket
l_int|4
)braket
suffix:semicolon
DECL|variable|sn9c102_sof_header
r_static
id|sn9c102_sof_header_t
id|sn9c102_sof_header
(braket
)braket
op_assign
(brace
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0x00
comma
l_int|0xc4
comma
l_int|0xc4
comma
l_int|0x96
comma
l_int|0x00
)brace
comma
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0x00
comma
l_int|0xc4
comma
l_int|0xc4
comma
l_int|0x96
comma
l_int|0x01
)brace
comma
)brace
suffix:semicolon
DECL|variable|sn9c102_eof_header
r_static
id|sn9c102_eof_header_t
id|sn9c102_eof_header
(braket
)braket
op_assign
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x40
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x80
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0xc0
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*****************************************************************************/
DECL|function|kvirt_to_pa
r_static
r_inline
r_int
r_int
id|kvirt_to_pa
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|kva
comma
id|ret
suffix:semicolon
id|kva
op_assign
(paren
r_int
r_int
)paren
id|page_address
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|kva
op_or_assign
id|adr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|ret
op_assign
id|__pa
c_func
(paren
id|kva
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|rvmalloc
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
r_int
r_int
id|adr
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|vmalloc_32
c_func
(paren
(paren
r_int
r_int
)paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|SetPageReserved
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|rvfree
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|adr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|ClearPageReserved
c_func
(paren
id|vmalloc_to_page
c_func
(paren
(paren
r_void
op_star
)paren
id|adr
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
DECL|function|sn9c102_request_buffers
r_static
id|u32
id|sn9c102_request_buffers
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u32
id|count
)paren
(brace
r_struct
id|v4l2_pix_format
op_star
id|p
op_assign
op_amp
(paren
id|cam-&gt;sensor-&gt;pix_format
)paren
suffix:semicolon
r_const
r_int
id|imagesize
op_assign
(paren
id|p-&gt;width
op_star
id|p-&gt;height
op_star
id|p-&gt;priv
)paren
op_div
l_int|8
suffix:semicolon
r_void
op_star
id|buff
op_assign
l_int|NULL
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|SN9C102_MAX_FRAMES
)paren
id|count
op_assign
id|SN9C102_MAX_FRAMES
suffix:semicolon
id|cam-&gt;nbuffers
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|cam-&gt;nbuffers
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|buff
op_assign
id|rvmalloc
c_func
(paren
id|cam-&gt;nbuffers
op_star
id|PAGE_ALIGN
c_func
(paren
id|imagesize
)paren
)paren
)paren
)paren
r_break
suffix:semicolon
id|cam-&gt;nbuffers
op_decrement
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|bufmem
op_assign
id|buff
op_plus
id|i
op_star
id|PAGE_ALIGN
c_func
(paren
id|imagesize
)paren
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.index
op_assign
id|i
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.m.offset
op_assign
id|i
op_star
id|PAGE_ALIGN
c_func
(paren
id|imagesize
)paren
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.length
op_assign
id|imagesize
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.sequence
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.field
op_assign
id|V4L2_FIELD_NONE
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.memory
op_assign
id|V4L2_MEMORY_MMAP
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.flags
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|cam-&gt;nbuffers
suffix:semicolon
)brace
DECL|function|sn9c102_release_buffers
r_static
r_void
id|sn9c102_release_buffers
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;nbuffers
)paren
(brace
id|rvfree
c_func
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|bufmem
comma
id|cam-&gt;nbuffers
op_star
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buf.length
)paren
suffix:semicolon
id|cam-&gt;nbuffers
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sn9c102_empty_framequeues
r_static
r_void
id|sn9c102_empty_framequeues
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
id|u32
id|i
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|cam-&gt;inqueue
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SN9C102_MAX_FRAMES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|state
op_assign
id|F_UNUSED
suffix:semicolon
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.bytesused
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|sn9c102_queue_unusedframes
r_static
r_void
id|sn9c102_queue_unusedframes
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_int
r_int
id|lock_flags
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|state
op_eq
id|F_UNUSED
)paren
(brace
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|state
op_assign
id|F_QUEUED
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|frame
comma
op_amp
id|cam-&gt;inqueue
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_write_reg
r_int
id|sn9c102_write_reg
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u8
id|value
comma
id|u16
id|index
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u8
op_star
id|buff
op_assign
id|cam-&gt;control_buffer
suffix:semicolon
r_int
id|res
suffix:semicolon
op_star
id|buff
op_assign
id|value
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x08
comma
l_int|0x41
comma
id|index
comma
l_int|0
comma
id|buff
comma
l_int|1
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Failed to write a register (value 0x%02X, index &quot;
l_string|&quot;0x%02X, error %d)&quot;
comma
id|value
comma
id|index
comma
id|res
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|cam-&gt;reg
(braket
id|index
)braket
op_assign
id|value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* NOTE: reading some registers always returns 0 */
DECL|function|sn9c102_read_reg
r_static
r_int
id|sn9c102_read_reg
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u16
id|index
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u8
op_star
id|buff
op_assign
id|cam-&gt;control_buffer
suffix:semicolon
r_int
id|res
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x00
comma
l_int|0xc1
comma
id|index
comma
l_int|0
comma
id|buff
comma
l_int|1
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Failed to read a register (index 0x%02X, error %d)&quot;
comma
id|index
comma
id|res
)paren
r_return
(paren
id|res
op_ge
l_int|0
)paren
ques
c_cond
(paren
r_int
)paren
(paren
op_star
id|buff
)paren
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|sn9c102_pread_reg
r_int
id|sn9c102_pread_reg
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u16
id|index
)paren
(brace
r_if
c_cond
(paren
id|index
OG
l_int|0x1f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|cam-&gt;reg
(braket
id|index
)braket
suffix:semicolon
)brace
r_static
r_int
DECL|function|sn9c102_i2c_wait
id|sn9c102_i2c_wait
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
)paren
(brace
r_int
id|i
comma
id|r
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|r
op_assign
id|sn9c102_read_reg
c_func
(paren
id|cam
comma
l_int|0x08
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
l_int|0x04
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sensor-&gt;frequency
op_amp
id|SN9C102_I2C_400KHZ
)paren
id|udelay
c_func
(paren
l_int|5
op_star
l_int|8
)paren
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|16
op_star
l_int|8
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_static
r_int
DECL|function|sn9c102_i2c_detect_read_error
id|sn9c102_i2c_detect_read_error
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
)paren
(brace
r_int
id|r
suffix:semicolon
id|r
op_assign
id|sn9c102_read_reg
c_func
(paren
id|cam
comma
l_int|0x08
)paren
suffix:semicolon
r_return
(paren
id|r
OL
l_int|0
op_logical_or
(paren
id|r
op_ge
l_int|0
op_logical_and
op_logical_neg
(paren
id|r
op_amp
l_int|0x08
)paren
)paren
)paren
ques
c_cond
op_minus
id|EIO
suffix:colon
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sn9c102_i2c_detect_write_error
id|sn9c102_i2c_detect_write_error
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
)paren
(brace
r_int
id|r
suffix:semicolon
id|r
op_assign
id|sn9c102_read_reg
c_func
(paren
id|cam
comma
l_int|0x08
)paren
suffix:semicolon
r_return
(paren
id|r
OL
l_int|0
op_logical_or
(paren
id|r
op_ge
l_int|0
op_logical_and
(paren
id|r
op_amp
l_int|0x08
)paren
)paren
)paren
ques
c_cond
op_minus
id|EIO
suffix:colon
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|sn9c102_i2c_try_read
id|sn9c102_i2c_try_read
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
comma
id|u8
id|address
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|cam-&gt;control_buffer
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|res
suffix:semicolon
multiline_comment|/* Write cycle - address */
id|data
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|sensor-&gt;interface
op_eq
id|SN9C102_I2C_2WIRES
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|sensor-&gt;frequency
op_amp
id|SN9C102_I2C_400KHZ
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0
)paren
op_or
l_int|0x10
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|sensor-&gt;slave_write_id
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|address
suffix:semicolon
id|data
(braket
l_int|7
)braket
op_assign
l_int|0x10
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x08
comma
l_int|0x41
comma
l_int|0x08
comma
l_int|0
comma
id|data
comma
l_int|8
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|err
op_add_assign
id|res
suffix:semicolon
id|err
op_add_assign
id|sn9c102_i2c_wait
c_func
(paren
id|cam
comma
id|sensor
)paren
suffix:semicolon
multiline_comment|/* Read cycle - 1 byte */
id|data
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|sensor-&gt;interface
op_eq
id|SN9C102_I2C_2WIRES
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|sensor-&gt;frequency
op_amp
id|SN9C102_I2C_400KHZ
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0
)paren
op_or
l_int|0x10
op_or
l_int|0x02
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|sensor-&gt;slave_read_id
suffix:semicolon
id|data
(braket
l_int|7
)braket
op_assign
l_int|0x10
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x08
comma
l_int|0x41
comma
l_int|0x08
comma
l_int|0
comma
id|data
comma
l_int|8
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|err
op_add_assign
id|res
suffix:semicolon
id|err
op_add_assign
id|sn9c102_i2c_wait
c_func
(paren
id|cam
comma
id|sensor
)paren
suffix:semicolon
multiline_comment|/* The read byte will be placed in data[4] */
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x00
comma
l_int|0xc1
comma
l_int|0x0a
comma
l_int|0
comma
id|data
comma
l_int|5
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|err
op_add_assign
id|res
suffix:semicolon
id|err
op_add_assign
id|sn9c102_i2c_detect_read_error
c_func
(paren
id|cam
comma
id|sensor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;I2C read failed for %s image sensor&quot;
comma
id|sensor-&gt;name
)paren
id|PDBGG
c_func
(paren
l_string|&quot;I2C read: address 0x%02X, value: 0x%02X&quot;
comma
id|address
comma
id|data
(braket
l_int|4
)braket
)paren
r_return
id|err
ques
c_cond
op_minus
l_int|1
suffix:colon
(paren
r_int
)paren
id|data
(braket
l_int|4
)braket
suffix:semicolon
)brace
r_int
DECL|function|sn9c102_i2c_try_raw_write
id|sn9c102_i2c_try_raw_write
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
comma
id|u8
id|n
comma
id|u8
id|data0
comma
id|u8
id|data1
comma
id|u8
id|data2
comma
id|u8
id|data3
comma
id|u8
id|data4
comma
id|u8
id|data5
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|cam-&gt;control_buffer
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|res
suffix:semicolon
multiline_comment|/* Write cycle. It usually is address + value */
id|data
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|sensor-&gt;interface
op_eq
id|SN9C102_I2C_2WIRES
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|sensor-&gt;frequency
op_amp
id|SN9C102_I2C_400KHZ
)paren
ques
c_cond
l_int|0x01
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|n
op_minus
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|data0
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|data1
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|data2
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
id|data3
suffix:semicolon
id|data
(braket
l_int|5
)braket
op_assign
id|data4
suffix:semicolon
id|data
(braket
l_int|6
)braket
op_assign
id|data5
suffix:semicolon
id|data
(braket
l_int|7
)braket
op_assign
l_int|0x14
suffix:semicolon
id|res
op_assign
id|usb_control_msg
c_func
(paren
id|udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|udev
comma
l_int|0
)paren
comma
l_int|0x08
comma
l_int|0x41
comma
l_int|0x08
comma
l_int|0
comma
id|data
comma
l_int|8
comma
id|SN9C102_CTRL_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|err
op_add_assign
id|res
suffix:semicolon
id|err
op_add_assign
id|sn9c102_i2c_wait
c_func
(paren
id|cam
comma
id|sensor
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_i2c_detect_write_error
c_func
(paren
id|cam
comma
id|sensor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;I2C write failed for %s image sensor&quot;
comma
id|sensor-&gt;name
)paren
id|PDBGG
c_func
(paren
l_string|&quot;I2C raw write: %u bytes, data0 = 0x%02X, data1 = 0x%02X, &quot;
l_string|&quot;data2 = 0x%02X, data3 = 0x%02X, data4 = 0x%02X, data5 = 0x%02X&quot;
comma
id|n
comma
id|data0
comma
id|data1
comma
id|data2
comma
id|data3
comma
id|data4
comma
id|data5
)paren
r_return
id|err
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|sn9c102_i2c_try_write
id|sn9c102_i2c_try_write
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|sn9c102_sensor
op_star
id|sensor
comma
id|u8
id|address
comma
id|u8
id|value
)paren
(brace
r_return
id|sn9c102_i2c_try_raw_write
c_func
(paren
id|cam
comma
id|sensor
comma
l_int|3
comma
id|sensor-&gt;slave_write_id
comma
id|address
comma
id|value
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sn9c102_i2c_read
r_int
id|sn9c102_i2c_read
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u8
id|address
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;sensor
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|sn9c102_i2c_try_read
c_func
(paren
id|cam
comma
id|cam-&gt;sensor
comma
id|address
)paren
suffix:semicolon
)brace
DECL|function|sn9c102_i2c_write
r_int
id|sn9c102_i2c_write
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u8
id|address
comma
id|u8
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;sensor
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|sn9c102_i2c_try_write
c_func
(paren
id|cam
comma
id|cam-&gt;sensor
comma
id|address
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_find_sof_header
r_static
r_void
op_star
id|sn9c102_find_sof_header
c_func
(paren
r_void
op_star
id|mem
comma
r_int
id|len
)paren
(brace
r_int
id|soflen
op_assign
r_sizeof
(paren
id|sn9c102_sof_header_t
)paren
comma
id|i
suffix:semicolon
id|u8
id|j
comma
id|n
op_assign
r_sizeof
(paren
id|sn9c102_sof_header
)paren
op_div
id|soflen
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|len
op_ge
id|soflen
)paren
op_logical_and
(paren
id|i
op_le
id|len
op_minus
id|soflen
)paren
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
multiline_comment|/* It&squot;s enough to compare 7 bytes */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|mem
op_plus
id|i
comma
id|sn9c102_sof_header
(braket
id|j
)braket
comma
l_int|7
)paren
)paren
multiline_comment|/* Skips the header */
r_return
id|mem
op_plus
id|i
op_plus
id|soflen
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sn9c102_find_eof_header
r_static
r_void
op_star
id|sn9c102_find_eof_header
c_func
(paren
r_void
op_star
id|mem
comma
r_int
id|len
)paren
(brace
r_int
id|eoflen
op_assign
r_sizeof
(paren
id|sn9c102_eof_header_t
)paren
comma
id|i
suffix:semicolon
r_int
id|j
comma
id|n
op_assign
r_sizeof
(paren
id|sn9c102_eof_header
)paren
op_div
id|eoflen
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|len
op_ge
id|eoflen
)paren
op_logical_and
(paren
id|i
op_le
id|len
op_minus
id|eoflen
)paren
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|mem
op_plus
id|i
comma
id|sn9c102_eof_header
(braket
id|j
)braket
comma
id|eoflen
)paren
)paren
r_return
id|mem
op_plus
id|i
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|sn9c102_urb_complete
r_static
r_void
id|sn9c102_urb_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|urb-&gt;context
suffix:semicolon
r_struct
id|sn9c102_frame_t
op_star
op_star
id|f
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
id|u8
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_eq
op_minus
id|ENOENT
)paren
r_return
suffix:semicolon
id|f
op_assign
op_amp
id|cam-&gt;frame_current
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_INTERRUPT
)paren
(brace
id|cam-&gt;stream
op_assign
id|STREAM_OFF
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_assign
id|F_QUEUED
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Stream interrupted&quot;
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_stream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
op_logical_or
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;inqueue
)paren
)paren
r_goto
id|resubmit_urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|f
)paren
)paren
(paren
op_star
id|f
)paren
op_assign
id|list_entry
c_func
(paren
id|cam-&gt;inqueue.next
comma
r_struct
id|sn9c102_frame_t
comma
id|frame
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|urb-&gt;number_of_packets
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|img
comma
id|len
comma
id|status
suffix:semicolon
r_void
op_star
id|pos
comma
op_star
id|sof
comma
op_star
id|eof
suffix:semicolon
id|len
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
suffix:semicolon
id|status
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
suffix:semicolon
id|pos
op_assign
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_plus
id|urb-&gt;transfer_buffer
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Error in isochronous frame&quot;
)paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_assign
id|F_ERROR
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|PDBGG
c_func
(paren
l_string|&quot;Isochrnous frame: length %u, #%u i&quot;
comma
id|len
comma
id|i
)paren
multiline_comment|/*&n;&t;&t;   NOTE: It is probably correct to assume that SOF and EOF&n;&t;&t;         headers do not occur between two consecutive packets,&n;&t;&t;         but who knows..Whatever is the truth, this assumption&n;&t;&t;         doesn&squot;t introduce bugs.&n;&t;&t;*/
id|redo
suffix:colon
id|sof
op_assign
id|sn9c102_find_sof_header
c_func
(paren
id|pos
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sof
)paren
(brace
id|eof
op_assign
id|sn9c102_find_eof_header
c_func
(paren
id|pos
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_eq
id|F_GRABBING
)paren
(brace
id|end_of_frame
suffix:colon
id|img
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|eof
)paren
id|img
op_assign
(paren
id|eof
OG
id|pos
)paren
ques
c_cond
id|eof
op_minus
id|pos
op_minus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_plus
id|img
OG
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.length
)paren
(brace
id|u32
id|b
op_assign
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_plus
id|img
op_minus
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.length
suffix:semicolon
id|img
op_assign
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.length
op_minus
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Expected EOF not found: &quot;
l_string|&quot;video frame cut&quot;
)paren
r_if
c_cond
(paren
id|eof
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Exceeded limit: +%u &quot;
l_string|&quot;bytes&quot;
comma
(paren
r_int
)paren
(paren
id|b
)paren
)paren
)brace
id|memcpy
c_func
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|bufmem
op_plus
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
comma
id|pos
comma
id|img
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_eq
l_int|0
)paren
id|do_gettimeofday
c_func
(paren
op_amp
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.timestamp
)paren
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_add_assign
id|img
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_eq
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.length
)paren
(brace
id|u32
id|b
op_assign
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_assign
id|F_DONE
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.sequence
op_assign
op_increment
id|cam-&gt;frame_count
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_move_tail
c_func
(paren
op_amp
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|frame
comma
op_amp
id|cam-&gt;outqueue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;inqueue
)paren
)paren
(paren
op_star
id|f
)paren
op_assign
id|list_entry
c_func
(paren
id|cam-&gt;inqueue.next
comma
r_struct
id|sn9c102_frame_t
comma
id|frame
)paren
suffix:semicolon
r_else
(paren
op_star
id|f
)paren
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Video frame captured: &quot;
l_string|&quot;%lu bytes&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|b
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|f
)paren
)paren
r_goto
id|resubmit_urb
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|eof
)paren
(brace
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_assign
id|F_ERROR
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Not expected EOF after %lu &quot;
l_string|&quot;bytes of image data&quot;
comma
(paren
r_int
r_int
)paren
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
)paren
)paren
)brace
r_if
c_cond
(paren
id|sof
)paren
multiline_comment|/* (1) */
r_goto
id|start_of_frame
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|eof
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;EOF without SOF&quot;
)paren
r_continue
suffix:semicolon
)brace
r_else
(brace
id|PDBGG
c_func
(paren
l_string|&quot;Ignoring pointless isochronous frame&quot;
)paren
r_continue
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_eq
id|F_QUEUED
op_logical_or
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_eq
id|F_ERROR
)paren
(brace
id|start_of_frame
suffix:colon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_assign
id|F_GRABBING
suffix:semicolon
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
(paren
id|sof
op_minus
id|pos
)paren
suffix:semicolon
id|pos
op_assign
id|sof
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;SOF detected: new video frame&quot;
)paren
r_if
c_cond
(paren
id|len
)paren
r_goto
id|redo
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|state
op_eq
id|F_GRABBING
)paren
(brace
id|eof
op_assign
id|sn9c102_find_eof_header
c_func
(paren
id|pos
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eof
op_logical_and
id|eof
OL
id|sof
)paren
r_goto
id|end_of_frame
suffix:semicolon
multiline_comment|/* (1) */
r_else
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;SOF before expected EOF after %lu &quot;
l_string|&quot;bytes of image data&quot;
comma
(paren
r_int
r_int
)paren
(paren
(paren
op_star
id|f
)paren
op_member_access_from_pointer
id|buf.bytesused
)paren
)paren
r_goto
id|start_of_frame
suffix:semicolon
)brace
)brace
)brace
id|resubmit_urb
suffix:colon
id|urb-&gt;dev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
op_logical_and
id|err
op_ne
op_minus
id|EPERM
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;usb_submit_urb() failed&quot;
)paren
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_frame
)paren
suffix:semicolon
)brace
DECL|function|sn9c102_start_transfer
r_static
r_int
id|sn9c102_start_transfer
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_const
r_int
r_int
id|wMaxPacketSize
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|128
comma
l_int|256
comma
l_int|384
comma
l_int|512
comma
l_int|680
comma
l_int|800
comma
l_int|900
comma
l_int|1023
)brace
suffix:semicolon
r_const
r_int
r_int
id|psz
op_assign
id|wMaxPacketSize
(braket
id|SN9C102_ALTERNATE_SETTING
)braket
suffix:semicolon
id|s8
id|i
comma
id|j
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SN9C102_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
id|SN9C102_ISO_PACKETS
op_star
id|psz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Not enough memory&quot;
)paren
r_goto
id|free_buffers
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SN9C102_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
id|SN9C102_ISO_PACKETS
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cam-&gt;urb
(braket
id|i
)braket
op_assign
id|urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;usb_alloc_urb() failed&quot;
)paren
r_goto
id|free_urbs
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|udev
suffix:semicolon
id|urb-&gt;context
op_assign
id|cam
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|udev
comma
l_int|1
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|SN9C102_ISO_PACKETS
suffix:semicolon
id|urb-&gt;complete
op_assign
id|sn9c102_urb_complete
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|psz
op_star
id|SN9C102_ISO_PACKETS
suffix:semicolon
id|urb-&gt;interval
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|SN9C102_ISO_PACKETS
suffix:semicolon
id|j
op_increment
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|offset
op_assign
id|psz
op_star
id|j
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|length
op_assign
id|psz
suffix:semicolon
)brace
)brace
multiline_comment|/* Enable video */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;reg
(braket
l_int|0x01
)braket
op_amp
l_int|0x04
)paren
)paren
(brace
id|err
op_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|cam-&gt;reg
(braket
l_int|0x01
)braket
op_or
l_int|0x04
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;I/O hardware error&quot;
)paren
r_goto
id|free_urbs
suffix:semicolon
)brace
)brace
id|err
op_assign
id|usb_set_interface
c_func
(paren
id|udev
comma
l_int|0
comma
id|SN9C102_ALTERNATE_SETTING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;usb_set_interface() failed&quot;
)paren
r_goto
id|free_urbs
suffix:semicolon
)brace
id|cam-&gt;frame_current
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SN9C102_URBS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
id|usb_kill_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|j
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;usb_submit_urb() failed, error %d&quot;
comma
id|err
)paren
r_goto
id|free_urbs
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|free_urbs
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|SN9C102_URBS
)paren
op_logical_and
id|cam-&gt;urb
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|free_buffers
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|SN9C102_URBS
)paren
op_logical_and
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
id|kfree
c_func
(paren
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|sn9c102_stop_transfer
r_static
r_int
id|sn9c102_stop_transfer
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|cam-&gt;usbdev
suffix:semicolon
id|s8
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|SN9C102_URBS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|usb_kill_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|cam-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam-&gt;transfer_buffer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|err
op_assign
id|usb_set_interface
c_func
(paren
id|udev
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* 0 Mb/s */
r_if
c_cond
(paren
id|err
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;usb_set_interface() failed&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_strtou8
r_static
id|u8
id|sn9c102_strtou8
c_func
(paren
r_const
r_char
op_star
id|buff
comma
r_int
id|len
comma
id|ssize_t
op_star
id|count
)paren
(brace
r_char
id|str
(braket
l_int|5
)braket
suffix:semicolon
r_char
op_star
id|endp
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|4
)paren
(brace
id|strncpy
c_func
(paren
id|str
comma
id|buff
comma
id|len
)paren
suffix:semicolon
id|str
(braket
id|len
op_plus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
(brace
id|strncpy
c_func
(paren
id|str
comma
id|buff
comma
l_int|4
)paren
suffix:semicolon
id|str
(braket
l_int|4
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|endp
comma
l_int|0
)paren
suffix:semicolon
op_star
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_le
l_int|0xff
)paren
op_star
id|count
op_assign
(paren
id|ssize_t
)paren
(paren
id|endp
op_minus
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|count
)paren
op_logical_and
(paren
id|len
op_eq
op_star
id|count
op_plus
l_int|1
)paren
op_logical_and
(paren
id|buff
(braket
op_star
id|count
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
)paren
op_star
id|count
op_add_assign
l_int|1
suffix:semicolon
r_return
(paren
id|u8
)paren
id|val
suffix:semicolon
)brace
multiline_comment|/*&n;   NOTE 1: being inside one of the following methods implies that the v4l&n;           device exists for sure (see kobjects and reference counters)&n;   NOTE 2: buffers are PAGE_SIZE long&n;*/
DECL|function|sn9c102_show_reg
r_static
id|ssize_t
id|sn9c102_show_reg
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|count
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|cam-&gt;sysfs.reg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_reg
id|sn9c102_store_reg
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|u8
id|index
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|index
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
l_int|0x1f
op_logical_or
op_logical_neg
id|count
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cam-&gt;sysfs.reg
op_assign
id|index
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Moved SN9C10X register index to 0x%02X&quot;
comma
id|cam-&gt;sysfs.reg
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Written bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|sn9c102_show_val
r_static
id|ssize_t
id|sn9c102_show_val
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|sn9c102_read_reg
c_func
(paren
id|cam
comma
id|cam-&gt;sysfs.reg
)paren
)paren
OL
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|count
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Read bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_val
id|sn9c102_store_val
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|u8
id|value
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|value
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|err
op_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|value
comma
id|cam-&gt;sysfs.reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Written SN9C10X reg. 0x%02X, val. 0x%02X&quot;
comma
id|cam-&gt;sysfs.reg
comma
id|value
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Written bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|sn9c102_show_i2c_reg
r_static
id|ssize_t
id|sn9c102_show_i2c_reg
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|count
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|cam-&gt;sysfs.i2c_reg
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Read bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_i2c_reg
id|sn9c102_store_i2c_reg
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|u8
id|index
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|index
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cam-&gt;sysfs.i2c_reg
op_assign
id|index
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Moved sensor register index to 0x%02X&quot;
comma
id|cam-&gt;sysfs.i2c_reg
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Written bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|sn9c102_show_i2c_val
r_static
id|ssize_t
id|sn9c102_show_i2c_val
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;sensor-&gt;slave_read_id
op_eq
id|SN9C102_I2C_SLAVEID_UNAVAILABLE
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|sn9c102_i2c_read
c_func
(paren
id|cam
comma
id|cam-&gt;sysfs.i2c_reg
)paren
)paren
OL
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|count
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Read bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_i2c_val
id|sn9c102_store_i2c_val
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
id|u8
id|value
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|value
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|err
op_assign
id|sn9c102_i2c_write
c_func
(paren
id|cam
comma
id|cam-&gt;sysfs.i2c_reg
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Written sensor reg. 0x%02X, val. 0x%02X&quot;
comma
id|cam-&gt;sysfs.i2c_reg
comma
id|value
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Written bytes: %zd&quot;
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_green
id|sn9c102_store_green
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
r_enum
id|sn9c102_bridge
id|bridge
suffix:semicolon
id|ssize_t
id|res
op_assign
l_int|0
suffix:semicolon
id|u8
id|value
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|to_video_device
c_func
(paren
id|cd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
(brace
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|bridge
op_assign
id|cam-&gt;bridge
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
id|value
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|bridge
)paren
(brace
r_case
id|BRIDGE_SN9C101
suffix:colon
r_case
id|BRIDGE_SN9C102
suffix:colon
r_if
c_cond
(paren
id|value
OG
l_int|0x0f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|sn9c102_store_reg
c_func
(paren
id|cd
comma
l_string|&quot;0x11&quot;
comma
l_int|4
)paren
)paren
op_ge
l_int|0
)paren
id|res
op_assign
id|sn9c102_store_val
c_func
(paren
id|cd
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BRIDGE_SN9C103
suffix:colon
r_if
c_cond
(paren
id|value
OG
l_int|0x7f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|sn9c102_store_reg
c_func
(paren
id|cd
comma
l_string|&quot;0x04&quot;
comma
l_int|4
)paren
)paren
op_ge
l_int|0
)paren
id|res
op_assign
id|sn9c102_store_val
c_func
(paren
id|cd
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_blue
id|sn9c102_store_blue
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
id|ssize_t
id|res
op_assign
l_int|0
suffix:semicolon
id|u8
id|value
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
id|value
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
op_logical_or
id|value
OG
l_int|0x7f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|sn9c102_store_reg
c_func
(paren
id|cd
comma
l_string|&quot;0x06&quot;
comma
l_int|4
)paren
)paren
op_ge
l_int|0
)paren
id|res
op_assign
id|sn9c102_store_val
c_func
(paren
id|cd
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_store_red
id|sn9c102_store_red
c_func
(paren
r_struct
id|class_device
op_star
id|cd
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
id|ssize_t
id|res
op_assign
l_int|0
suffix:semicolon
id|u8
id|value
suffix:semicolon
id|ssize_t
id|count
suffix:semicolon
id|value
op_assign
id|sn9c102_strtou8
c_func
(paren
id|buf
comma
id|len
comma
op_amp
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
op_logical_or
id|value
OG
l_int|0x7f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|sn9c102_store_reg
c_func
(paren
id|cd
comma
l_string|&quot;0x05&quot;
comma
l_int|4
)paren
)paren
op_ge
l_int|0
)paren
id|res
op_assign
id|sn9c102_store_val
c_func
(paren
id|cd
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|reg
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sn9c102_show_reg
comma
id|sn9c102_store_reg
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|val
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sn9c102_show_val
comma
id|sn9c102_store_val
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|i2c_reg
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sn9c102_show_i2c_reg
comma
id|sn9c102_store_i2c_reg
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|i2c_val
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|sn9c102_show_i2c_val
comma
id|sn9c102_store_i2c_val
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|green
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|sn9c102_store_green
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|blue
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|sn9c102_store_blue
)paren
suffix:semicolon
r_static
id|CLASS_DEVICE_ATTR
c_func
(paren
id|red
comma
id|S_IWUGO
comma
l_int|NULL
comma
id|sn9c102_store_red
)paren
suffix:semicolon
DECL|function|sn9c102_create_sysfs
r_static
r_void
id|sn9c102_create_sysfs
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_struct
id|video_device
op_star
id|v4ldev
op_assign
id|cam-&gt;v4ldev
suffix:semicolon
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_reg
)paren
suffix:semicolon
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;bridge
op_eq
id|BRIDGE_SN9C101
op_logical_or
id|cam-&gt;bridge
op_eq
id|BRIDGE_SN9C102
)paren
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_green
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cam-&gt;bridge
op_eq
id|BRIDGE_SN9C103
)paren
(brace
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_blue
)paren
suffix:semicolon
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_red
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;sensor-&gt;slave_write_id
op_ne
id|SN9C102_I2C_SLAVEID_UNAVAILABLE
op_logical_or
id|cam-&gt;sensor-&gt;slave_read_id
op_ne
id|SN9C102_I2C_SLAVEID_UNAVAILABLE
)paren
(brace
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_i2c_reg
)paren
suffix:semicolon
id|video_device_create_file
c_func
(paren
id|v4ldev
comma
op_amp
id|class_device_attr_i2c_val
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_set_scale
r_static
r_int
id|sn9c102_set_scale
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
id|u8
id|scale
)paren
(brace
id|u8
id|r
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|scale
op_eq
l_int|1
)paren
id|r
op_assign
id|cam-&gt;reg
(braket
l_int|0x18
)braket
op_amp
l_int|0xcf
suffix:semicolon
r_else
r_if
c_cond
(paren
id|scale
op_eq
l_int|2
)paren
(brace
id|r
op_assign
id|cam-&gt;reg
(braket
l_int|0x18
)braket
op_amp
l_int|0xcf
suffix:semicolon
id|r
op_or_assign
l_int|0x10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scale
op_eq
l_int|4
)paren
id|r
op_assign
id|cam-&gt;reg
(braket
l_int|0x18
)braket
op_or
l_int|0x20
suffix:semicolon
id|err
op_add_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|r
comma
l_int|0x18
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;Scaling factor: %u&quot;
comma
id|scale
)paren
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sn9c102_set_crop
r_static
r_int
id|sn9c102_set_crop
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
comma
r_struct
id|v4l2_rect
op_star
id|rect
)paren
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
id|u8
id|h_start
op_assign
(paren
id|u8
)paren
(paren
id|rect-&gt;left
op_minus
id|s-&gt;cropcap.bounds.left
)paren
comma
id|v_start
op_assign
(paren
id|u8
)paren
(paren
id|rect-&gt;top
op_minus
id|s-&gt;cropcap.bounds.top
)paren
comma
id|h_size
op_assign
(paren
id|u8
)paren
(paren
id|rect-&gt;width
op_div
l_int|16
)paren
comma
id|v_size
op_assign
(paren
id|u8
)paren
(paren
id|rect-&gt;height
op_div
l_int|16
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_add_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|h_start
comma
l_int|0x12
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|v_start
comma
l_int|0x13
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|h_size
comma
l_int|0x15
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_write_reg
c_func
(paren
id|cam
comma
id|v_size
comma
l_int|0x16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;h_start, v_start, h_size, v_size, ho_size, vo_size &quot;
l_string|&quot;%u %u %u %u&quot;
comma
id|h_start
comma
id|v_start
comma
id|h_size
comma
id|v_size
)paren
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sn9c102_init
r_static
r_int
id|sn9c102_init
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_control
id|ctrl
suffix:semicolon
r_struct
id|v4l2_queryctrl
op_star
id|qctrl
suffix:semicolon
r_struct
id|v4l2_rect
op_star
id|rect
suffix:semicolon
id|u8
id|i
op_assign
l_int|0
comma
id|n
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;state
op_amp
id|DEV_INITIALIZED
)paren
)paren
(brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|cam-&gt;open
)paren
suffix:semicolon
id|qctrl
op_assign
id|s-&gt;qctrl
suffix:semicolon
id|rect
op_assign
op_amp
(paren
id|s-&gt;cropcap.defrect
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* use current values */
id|qctrl
op_assign
id|s-&gt;_qctrl
suffix:semicolon
id|rect
op_assign
op_amp
(paren
id|s-&gt;_rect
)paren
suffix:semicolon
)brace
id|err
op_add_assign
id|sn9c102_set_scale
c_func
(paren
id|cam
comma
id|rect-&gt;width
op_div
id|s-&gt;pix_format.width
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_set_crop
c_func
(paren
id|cam
comma
id|rect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;init
)paren
(brace
id|err
op_assign
id|s
op_member_access_from_pointer
id|init
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Sensor initialization failed&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|s-&gt;set_crop
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|s
op_member_access_from_pointer
id|set_crop
c_func
(paren
id|cam
comma
id|rect
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;set_crop() failed&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;set_ctrl
)paren
(brace
id|n
op_assign
r_sizeof
(paren
id|s-&gt;qctrl
)paren
op_div
r_sizeof
(paren
id|s-&gt;qctrl
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|id
op_ne
l_int|0
op_logical_and
op_logical_neg
(paren
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|flags
op_amp
id|V4L2_CTRL_FLAG_DISABLED
)paren
)paren
(brace
id|ctrl.id
op_assign
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|id
suffix:semicolon
id|ctrl.value
op_assign
id|qctrl
(braket
id|i
)braket
dot
id|default_value
suffix:semicolon
id|err
op_assign
id|s
op_member_access_from_pointer
id|set_ctrl
c_func
(paren
id|cam
comma
op_amp
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Set control failed&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;state
op_amp
id|DEV_INITIALIZED
)paren
)paren
(brace
id|init_MUTEX
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|cam-&gt;queue_lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|cam-&gt;wait_frame
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|cam-&gt;wait_stream
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|s-&gt;_qctrl
comma
id|s-&gt;qctrl
comma
r_sizeof
(paren
id|s-&gt;qctrl
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|s-&gt;_rect
)paren
comma
op_amp
(paren
id|s-&gt;cropcap.defrect
)paren
comma
r_sizeof
(paren
r_struct
id|v4l2_rect
)paren
)paren
suffix:semicolon
id|cam-&gt;state
op_or_assign
id|DEV_INITIALIZED
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Initialization succeeded&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sn9c102_release_resources
r_static
r_void
id|sn9c102_release_resources
c_func
(paren
r_struct
id|sn9c102_device
op_star
id|cam
)paren
(brace
id|down
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;V4L2 device /dev/video%d deregistered&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|video_set_drvdata
c_func
(paren
id|cam-&gt;v4ldev
comma
l_int|NULL
)paren
suffix:semicolon
id|video_unregister_device
c_func
(paren
id|cam-&gt;v4ldev
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sn9c102_sysfs_lock
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam-&gt;control_buffer
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_open
r_static
r_int
id|sn9c102_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;   This is the only safe way to prevent race conditions with&n;&t;   disconnect&n;&t;*/
r_if
c_cond
(paren
op_logical_neg
id|down_read_trylock
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;users
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device /dev/video%d is busy...&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_if
c_cond
(paren
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
op_logical_or
(paren
id|filp-&gt;f_flags
op_amp
id|O_NDELAY
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible_exclusive
c_func
(paren
id|cam-&gt;open
comma
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
op_logical_or
op_logical_neg
id|cam-&gt;users
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|up_read
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
(brace
id|err
op_assign
id|sn9c102_init
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Initialization failed again. &quot;
l_string|&quot;I will retry on next open().&quot;
)paren
r_goto
id|out
suffix:semicolon
)brace
id|cam-&gt;state
op_and_assign
op_complement
id|DEV_MISCONFIGURED
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sn9c102_start_transfer
c_func
(paren
id|cam
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|filp-&gt;private_data
op_assign
id|cam
suffix:semicolon
id|cam-&gt;users
op_increment
suffix:semicolon
id|cam-&gt;io
op_assign
id|IO_NONE
suffix:semicolon
id|cam-&gt;stream
op_assign
id|STREAM_OFF
suffix:semicolon
id|cam-&gt;nbuffers
op_assign
l_int|0
suffix:semicolon
id|cam-&gt;frame_count
op_assign
l_int|0
suffix:semicolon
id|sn9c102_empty_framequeues
c_func
(paren
id|cam
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Video device /dev/video%d is open&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|sn9c102_release
r_static
r_int
id|sn9c102_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
multiline_comment|/* prevent disconnect() to be called */
id|sn9c102_stop_transfer
c_func
(paren
id|cam
)paren
suffix:semicolon
id|sn9c102_release_buffers
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|sn9c102_release_resources
c_func
(paren
id|cam
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cam-&gt;users
op_decrement
suffix:semicolon
id|wake_up_interruptible_nr
c_func
(paren
op_amp
id|cam-&gt;open
comma
l_int|1
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Video device /dev/video%d closed&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|sn9c102_read
id|sn9c102_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|f_pos
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_struct
id|sn9c102_frame_t
op_star
id|f
comma
op_star
id|i
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Device not present&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;io
op_eq
id|IO_MMAP
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Close and open the device again to choose &quot;
l_string|&quot;the read method&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;io
op_eq
id|IO_NONE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sn9c102_request_buffers
c_func
(paren
id|cam
comma
l_int|2
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;read() failed, not enough memory&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cam-&gt;io
op_assign
id|IO_READ
suffix:semicolon
id|cam-&gt;stream
op_assign
id|STREAM_ON
suffix:semicolon
id|sn9c102_queue_unusedframes
c_func
(paren
id|cam
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
)paren
(brace
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_frame
comma
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|f
op_assign
id|list_entry
c_func
(paren
id|cam-&gt;outqueue.prev
comma
r_struct
id|sn9c102_frame_t
comma
id|frame
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|i
comma
op_amp
id|cam-&gt;outqueue
comma
id|frame
)paren
id|i-&gt;state
op_assign
id|F_UNUSED
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|sn9c102_queue_unusedframes
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|f-&gt;buf.length
)paren
id|count
op_assign
id|f-&gt;buf.length
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|f-&gt;bufmem
comma
id|count
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|f_pos
op_add_assign
id|count
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;Frame #%lu, bytes read: %zu&quot;
comma
(paren
r_int
r_int
)paren
id|f-&gt;buf.index
comma
id|count
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|sn9c102_poll
r_static
r_int
r_int
id|sn9c102_poll
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
id|POLLERR
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Device not present&quot;
)paren
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;io
op_eq
id|IO_NONE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sn9c102_request_buffers
c_func
(paren
id|cam
comma
l_int|2
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;poll() failed, not enough memory&quot;
)paren
r_goto
id|error
suffix:semicolon
)brace
id|cam-&gt;io
op_assign
id|IO_READ
suffix:semicolon
id|cam-&gt;stream
op_assign
id|STREAM_ON
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;io
op_eq
id|IO_READ
)paren
id|sn9c102_queue_unusedframes
c_func
(paren
id|cam
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|filp
comma
op_amp
id|cam-&gt;wait_frame
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
id|error
suffix:colon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|POLLERR
suffix:semicolon
)brace
DECL|function|sn9c102_vm_open
r_static
r_void
id|sn9c102_vm_open
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|sn9c102_frame_t
op_star
id|f
op_assign
id|vma-&gt;vm_private_data
suffix:semicolon
id|f-&gt;vma_use_count
op_increment
suffix:semicolon
)brace
DECL|function|sn9c102_vm_close
r_static
r_void
id|sn9c102_vm_close
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
multiline_comment|/* NOTE: buffers are not freed here */
r_struct
id|sn9c102_frame_t
op_star
id|f
op_assign
id|vma-&gt;vm_private_data
suffix:semicolon
id|f-&gt;vma_use_count
op_decrement
suffix:semicolon
)brace
DECL|variable|sn9c102_vm_ops
r_static
r_struct
id|vm_operations_struct
id|sn9c102_vm_ops
op_assign
(brace
dot
id|open
op_assign
id|sn9c102_vm_open
comma
dot
id|close
op_assign
id|sn9c102_vm_close
comma
)brace
suffix:semicolon
DECL|function|sn9c102_mmap
r_static
r_int
id|sn9c102_mmap
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_int
r_int
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
comma
id|start
op_assign
id|vma-&gt;vm_start
comma
id|pos
comma
id|page
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Device not present&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;io
op_ne
id|IO_MMAP
op_logical_or
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
op_logical_or
id|size
op_ne
id|PAGE_ALIGN
c_func
(paren
id|cam-&gt;frame
(braket
l_int|0
)braket
dot
id|buf.length
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|buf.m.offset
op_rshift
id|PAGE_SHIFT
)paren
op_eq
id|vma-&gt;vm_pgoff
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|cam-&gt;nbuffers
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pos
op_assign
(paren
r_int
r_int
)paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|bufmem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
multiline_comment|/* size is page-aligned */
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma
comma
id|start
comma
id|page
comma
id|PAGE_SIZE
comma
id|vma-&gt;vm_page_prot
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pos
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vma-&gt;vm_ops
op_assign
op_amp
id|sn9c102_vm_ops
suffix:semicolon
id|vma-&gt;vm_flags
op_and_assign
op_complement
id|VM_IO
suffix:semicolon
multiline_comment|/* not I/O memory */
id|vma-&gt;vm_flags
op_or_assign
id|VM_RESERVED
suffix:semicolon
multiline_comment|/* avoid to swap out this VMA */
id|vma-&gt;vm_private_data
op_assign
op_amp
id|cam-&gt;frame
(braket
id|i
)braket
suffix:semicolon
id|sn9c102_vm_open
c_func
(paren
id|vma
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sn9c102_v4l2_ioctl
r_static
r_int
id|sn9c102_v4l2_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOC_QUERYCAP
suffix:colon
(brace
r_struct
id|v4l2_capability
id|cap
op_assign
(brace
dot
id|driver
op_assign
l_string|&quot;sn9c102&quot;
comma
dot
id|version
op_assign
id|SN9C102_MODULE_VERSION_CODE
comma
dot
id|capabilities
op_assign
id|V4L2_CAP_VIDEO_CAPTURE
op_or
id|V4L2_CAP_READWRITE
op_or
id|V4L2_CAP_STREAMING
comma
)brace
suffix:semicolon
id|strlcpy
c_func
(paren
id|cap.card
comma
id|cam-&gt;v4ldev-&gt;name
comma
r_sizeof
(paren
id|cap.card
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|cap.bus_info
comma
id|cam-&gt;dev.bus_id
comma
r_sizeof
(paren
id|cap.bus_info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|cap
comma
r_sizeof
(paren
id|cap
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_ENUMINPUT
suffix:colon
(brace
r_struct
id|v4l2_input
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|i
comma
id|arg
comma
r_sizeof
(paren
id|i
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|i.index
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|i
comma
l_int|0
comma
r_sizeof
(paren
id|i
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|i.name
comma
l_string|&quot;USB&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|i
comma
r_sizeof
(paren
id|i
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_INPUT
suffix:colon
r_case
id|VIDIOC_S_INPUT
suffix:colon
(brace
r_int
id|index
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|index
comma
id|arg
comma
r_sizeof
(paren
id|index
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_QUERYCTRL
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_queryctrl
id|qc
suffix:semicolon
id|u8
id|i
comma
id|n
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|qc
comma
id|arg
comma
r_sizeof
(paren
id|qc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|n
op_assign
r_sizeof
(paren
id|s-&gt;qctrl
)paren
op_div
r_sizeof
(paren
id|s-&gt;qctrl
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|qc.id
op_logical_and
id|qc.id
op_eq
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|id
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|qc
comma
op_amp
(paren
id|s-&gt;qctrl
(braket
id|i
)braket
)paren
comma
r_sizeof
(paren
id|qc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|qc
comma
r_sizeof
(paren
id|qc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_case
id|VIDIOC_G_CTRL
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_control
id|ctrl
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;get_ctrl
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ctrl
comma
id|arg
comma
r_sizeof
(paren
id|ctrl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err
op_assign
id|s
op_member_access_from_pointer
id|get_ctrl
c_func
(paren
id|cam
comma
op_amp
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|ctrl
comma
r_sizeof
(paren
id|ctrl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_case
id|VIDIOC_S_CTRL
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_control
id|ctrl
suffix:semicolon
id|u8
id|i
comma
id|n
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;set_ctrl
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ctrl
comma
id|arg
comma
r_sizeof
(paren
id|ctrl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|n
op_assign
r_sizeof
(paren
id|s-&gt;qctrl
)paren
op_div
r_sizeof
(paren
id|s-&gt;qctrl
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ctrl.id
op_eq
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|id
)paren
(brace
r_if
c_cond
(paren
id|ctrl.value
template_param
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|maximum
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|ctrl.value
op_sub_assign
id|ctrl.value
op_mod
id|s-&gt;qctrl
(braket
id|i
)braket
dot
id|step
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|s
op_member_access_from_pointer
id|set_ctrl
c_func
(paren
id|cam
comma
op_amp
id|ctrl
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|s-&gt;_qctrl
(braket
id|i
)braket
dot
id|default_value
op_assign
id|ctrl.value
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_CROPCAP
suffix:colon
(brace
r_struct
id|v4l2_cropcap
op_star
id|cc
op_assign
op_amp
(paren
id|cam-&gt;sensor-&gt;cropcap
)paren
suffix:semicolon
id|cc-&gt;type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
suffix:semicolon
id|cc-&gt;pixelaspect.numerator
op_assign
l_int|1
suffix:semicolon
id|cc-&gt;pixelaspect.denominator
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
id|cc
comma
r_sizeof
(paren
op_star
id|cc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_CROP
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_crop
id|crop
op_assign
(brace
dot
id|type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|crop.c
)paren
comma
op_amp
(paren
id|s-&gt;_rect
)paren
comma
r_sizeof
(paren
r_struct
id|v4l2_rect
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|crop
comma
r_sizeof
(paren
id|crop
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_CROP
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_crop
id|crop
suffix:semicolon
r_struct
id|v4l2_rect
op_star
id|rect
suffix:semicolon
r_struct
id|v4l2_rect
op_star
id|bounds
op_assign
op_amp
(paren
id|s-&gt;cropcap.bounds
)paren
suffix:semicolon
r_struct
id|v4l2_pix_format
op_star
id|pix_format
op_assign
op_amp
(paren
id|s-&gt;pix_format
)paren
suffix:semicolon
id|u8
id|scale
suffix:semicolon
r_const
r_enum
id|sn9c102_stream_state
id|stream
op_assign
id|cam-&gt;stream
suffix:semicolon
r_const
id|u32
id|nbuffers
op_assign
id|cam-&gt;nbuffers
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|crop
comma
id|arg
comma
r_sizeof
(paren
id|crop
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|rect
op_assign
op_amp
(paren
id|crop.c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|crop.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|vma_use_count
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;VIDIOC_S_CROP failed. &quot;
l_string|&quot;Unmap the buffers first.&quot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Preserve R,G or B origin */
id|rect-&gt;left
op_assign
(paren
id|s-&gt;_rect.left
op_amp
l_int|1L
)paren
ques
c_cond
id|rect-&gt;left
op_or
l_int|1L
suffix:colon
id|rect-&gt;left
op_amp
op_complement
l_int|1L
suffix:semicolon
id|rect-&gt;top
op_assign
(paren
id|s-&gt;_rect.top
op_amp
l_int|1L
)paren
ques
c_cond
id|rect-&gt;top
op_or
l_int|1L
suffix:colon
id|rect-&gt;top
op_amp
op_complement
l_int|1L
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;width
OL
l_int|16
)paren
id|rect-&gt;width
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;height
OL
l_int|16
)paren
id|rect-&gt;height
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;width
OG
id|bounds-&gt;width
)paren
id|rect-&gt;width
op_assign
id|bounds-&gt;width
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;height
OG
id|bounds-&gt;height
)paren
id|rect-&gt;height
op_assign
id|bounds-&gt;height
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;left
OL
id|bounds-&gt;left
)paren
id|rect-&gt;left
op_assign
id|bounds-&gt;left
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;top
OL
id|bounds-&gt;top
)paren
id|rect-&gt;top
op_assign
id|bounds-&gt;top
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;left
op_plus
id|rect-&gt;width
OG
id|bounds-&gt;left
op_plus
id|bounds-&gt;width
)paren
id|rect-&gt;left
op_assign
id|bounds-&gt;left
op_plus
id|bounds-&gt;width
op_minus
id|rect-&gt;width
suffix:semicolon
r_if
c_cond
(paren
id|rect-&gt;top
op_plus
id|rect-&gt;height
OG
id|bounds-&gt;top
op_plus
id|bounds-&gt;height
)paren
id|rect-&gt;top
op_assign
id|bounds-&gt;top
op_plus
id|bounds-&gt;height
op_minus
id|rect-&gt;height
suffix:semicolon
id|rect-&gt;width
op_and_assign
op_complement
l_int|15L
suffix:semicolon
id|rect-&gt;height
op_and_assign
op_complement
l_int|15L
suffix:semicolon
r_if
c_cond
(paren
id|SN9C102_PRESERVE_IMGSCALE
)paren
(brace
multiline_comment|/* Calculate the actual scaling factor */
id|u32
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|rect-&gt;width
op_star
id|rect-&gt;height
suffix:semicolon
id|b
op_assign
id|pix_format-&gt;width
op_star
id|pix_format-&gt;height
suffix:semicolon
id|scale
op_assign
id|b
ques
c_cond
(paren
id|u8
)paren
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|4
ques
c_cond
l_int|1
suffix:colon
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|16
ques
c_cond
l_int|2
suffix:colon
l_int|4
)paren
)paren
suffix:colon
l_int|1
suffix:semicolon
)brace
r_else
id|scale
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_ON
)paren
(brace
id|cam-&gt;stream
op_assign
id|STREAM_INTERRUPT
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_stream
comma
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. To use &quot;
l_string|&quot;it, close and open /dev/video%d &quot;
l_string|&quot;again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|crop
comma
r_sizeof
(paren
id|crop
)paren
)paren
)paren
(brace
id|cam-&gt;stream
op_assign
id|stream
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sn9c102_release_buffers
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_assign
id|sn9c102_set_crop
c_func
(paren
id|cam
comma
id|rect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;set_crop
)paren
id|err
op_add_assign
id|s
op_member_access_from_pointer
id|set_crop
c_func
(paren
id|cam
comma
id|rect
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_set_scale
c_func
(paren
id|cam
comma
id|scale
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
multiline_comment|/* atomic, no rollback in ioctl() */
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_S_CROP failed because of hardware &quot;
l_string|&quot;problems. To use the camera, close and open &quot;
l_string|&quot;/dev/video%d again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|s-&gt;pix_format.width
op_assign
id|rect-&gt;width
op_div
id|scale
suffix:semicolon
id|s-&gt;pix_format.height
op_assign
id|rect-&gt;height
op_div
id|scale
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|s-&gt;_rect
)paren
comma
id|rect
comma
r_sizeof
(paren
op_star
id|rect
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nbuffers
op_ne
id|sn9c102_request_buffers
c_func
(paren
id|cam
comma
id|nbuffers
)paren
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_S_CROP failed because of not enough &quot;
l_string|&quot;memory. To use the camera, close and open &quot;
l_string|&quot;/dev/video%d again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cam-&gt;stream
op_assign
id|stream
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_ENUM_FMT
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_fmtdesc
id|fmtd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|fmtd
comma
id|arg
comma
r_sizeof
(paren
id|fmtd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|fmtd.index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fmtd
comma
l_int|0
comma
r_sizeof
(paren
id|fmtd
)paren
)paren
suffix:semicolon
id|fmtd.type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
suffix:semicolon
id|strcpy
c_func
(paren
id|fmtd.description
comma
l_string|&quot;bayer rgb&quot;
)paren
suffix:semicolon
id|fmtd.pixelformat
op_assign
id|s-&gt;pix_format.pixelformat
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|fmtd
comma
r_sizeof
(paren
id|fmtd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_FMT
suffix:colon
(brace
r_struct
id|v4l2_format
id|format
suffix:semicolon
r_struct
id|v4l2_pix_format
op_star
id|pfmt
op_assign
op_amp
(paren
id|cam-&gt;sensor-&gt;pix_format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|format
comma
id|arg
comma
r_sizeof
(paren
id|format
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|format.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pfmt-&gt;bytesperline
op_assign
(paren
id|pfmt-&gt;width
op_star
id|pfmt-&gt;priv
)paren
op_div
l_int|8
suffix:semicolon
id|pfmt-&gt;sizeimage
op_assign
id|pfmt-&gt;height
op_star
id|pfmt-&gt;bytesperline
suffix:semicolon
id|pfmt-&gt;field
op_assign
id|V4L2_FIELD_NONE
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|format.fmt.pix
)paren
comma
id|pfmt
comma
r_sizeof
(paren
op_star
id|pfmt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|format
comma
r_sizeof
(paren
id|format
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_TRY_FMT
suffix:colon
r_case
id|VIDIOC_S_FMT
suffix:colon
(brace
r_struct
id|sn9c102_sensor
op_star
id|s
op_assign
id|cam-&gt;sensor
suffix:semicolon
r_struct
id|v4l2_format
id|format
suffix:semicolon
r_struct
id|v4l2_pix_format
op_star
id|pix
suffix:semicolon
r_struct
id|v4l2_pix_format
op_star
id|pfmt
op_assign
op_amp
(paren
id|s-&gt;pix_format
)paren
suffix:semicolon
r_struct
id|v4l2_rect
op_star
id|bounds
op_assign
op_amp
(paren
id|s-&gt;cropcap.bounds
)paren
suffix:semicolon
r_struct
id|v4l2_rect
id|rect
suffix:semicolon
id|u8
id|scale
suffix:semicolon
r_const
r_enum
id|sn9c102_stream_state
id|stream
op_assign
id|cam-&gt;stream
suffix:semicolon
r_const
id|u32
id|nbuffers
op_assign
id|cam-&gt;nbuffers
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|format
comma
id|arg
comma
r_sizeof
(paren
id|format
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|pix
op_assign
op_amp
(paren
id|format.fmt.pix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|format.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rect
comma
op_amp
(paren
id|s-&gt;_rect
)paren
comma
r_sizeof
(paren
id|rect
)paren
)paren
suffix:semicolon
(brace
multiline_comment|/* calculate the actual scaling factor */
id|u32
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|rect.width
op_star
id|rect.height
suffix:semicolon
id|b
op_assign
id|pix-&gt;width
op_star
id|pix-&gt;height
suffix:semicolon
id|scale
op_assign
id|b
ques
c_cond
(paren
id|u8
)paren
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|4
ques
c_cond
l_int|1
suffix:colon
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|16
ques
c_cond
l_int|2
suffix:colon
l_int|4
)paren
)paren
suffix:colon
l_int|1
suffix:semicolon
)brace
id|rect.width
op_assign
id|scale
op_star
id|pix-&gt;width
suffix:semicolon
id|rect.height
op_assign
id|scale
op_star
id|pix-&gt;height
suffix:semicolon
r_if
c_cond
(paren
id|rect.width
OL
l_int|16
)paren
id|rect.width
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|rect.height
OL
l_int|16
)paren
id|rect.height
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|rect.width
OG
id|bounds-&gt;left
op_plus
id|bounds-&gt;width
op_minus
id|rect.left
)paren
id|rect.width
op_assign
id|bounds-&gt;left
op_plus
id|bounds-&gt;width
op_minus
id|rect.left
suffix:semicolon
r_if
c_cond
(paren
id|rect.height
OG
id|bounds-&gt;top
op_plus
id|bounds-&gt;height
op_minus
id|rect.top
)paren
id|rect.height
op_assign
id|bounds-&gt;top
op_plus
id|bounds-&gt;height
op_minus
id|rect.top
suffix:semicolon
id|rect.width
op_and_assign
op_complement
l_int|15L
suffix:semicolon
id|rect.height
op_and_assign
op_complement
l_int|15L
suffix:semicolon
(brace
multiline_comment|/* adjust the scaling factor */
id|u32
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|rect.width
op_star
id|rect.height
suffix:semicolon
id|b
op_assign
id|pix-&gt;width
op_star
id|pix-&gt;height
suffix:semicolon
id|scale
op_assign
id|b
ques
c_cond
(paren
id|u8
)paren
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|4
ques
c_cond
l_int|1
suffix:colon
(paren
(paren
id|a
op_div
id|b
)paren
OL
l_int|16
ques
c_cond
l_int|2
suffix:colon
l_int|4
)paren
)paren
suffix:colon
l_int|1
suffix:semicolon
)brace
id|pix-&gt;width
op_assign
id|rect.width
op_div
id|scale
suffix:semicolon
id|pix-&gt;height
op_assign
id|rect.height
op_div
id|scale
suffix:semicolon
id|pix-&gt;pixelformat
op_assign
id|pfmt-&gt;pixelformat
suffix:semicolon
id|pix-&gt;priv
op_assign
id|pfmt-&gt;priv
suffix:semicolon
multiline_comment|/* bpp */
id|pix-&gt;colorspace
op_assign
id|pfmt-&gt;colorspace
suffix:semicolon
id|pix-&gt;bytesperline
op_assign
(paren
id|pix-&gt;width
op_star
id|pix-&gt;priv
)paren
op_div
l_int|8
suffix:semicolon
id|pix-&gt;sizeimage
op_assign
id|pix-&gt;height
op_star
id|pix-&gt;bytesperline
suffix:semicolon
id|pix-&gt;field
op_assign
id|V4L2_FIELD_NONE
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDIOC_TRY_FMT
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|vma_use_count
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;VIDIOC_S_FMT failed. &quot;
l_string|&quot;Unmap the buffers first.&quot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_ON
)paren
(brace
id|cam-&gt;stream
op_assign
id|STREAM_INTERRUPT
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_stream
comma
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. To use &quot;
l_string|&quot;it, close and open /dev/video%d &quot;
l_string|&quot;again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|format
comma
r_sizeof
(paren
id|format
)paren
)paren
)paren
(brace
id|cam-&gt;stream
op_assign
id|stream
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sn9c102_release_buffers
c_func
(paren
id|cam
)paren
suffix:semicolon
id|err
op_assign
id|sn9c102_set_crop
c_func
(paren
id|cam
comma
op_amp
id|rect
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;set_crop
)paren
id|err
op_add_assign
id|s
op_member_access_from_pointer
id|set_crop
c_func
(paren
id|cam
comma
op_amp
id|rect
)paren
suffix:semicolon
id|err
op_add_assign
id|sn9c102_set_scale
c_func
(paren
id|cam
comma
id|scale
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
multiline_comment|/* atomic, no rollback in ioctl() */
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_S_FMT failed because of hardware &quot;
l_string|&quot;problems. To use the camera, close and open &quot;
l_string|&quot;/dev/video%d again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|pfmt
comma
id|pix
comma
r_sizeof
(paren
op_star
id|pix
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|s-&gt;_rect
)paren
comma
op_amp
id|rect
comma
r_sizeof
(paren
id|rect
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nbuffers
op_ne
id|sn9c102_request_buffers
c_func
(paren
id|cam
comma
id|nbuffers
)paren
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_S_FMT failed because of not enough &quot;
l_string|&quot;memory. To use the camera, close and open &quot;
l_string|&quot;/dev/video%d again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cam-&gt;stream
op_assign
id|stream
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_REQBUFS
suffix:colon
(brace
r_struct
id|v4l2_requestbuffers
id|rb
suffix:semicolon
id|u32
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|rb
comma
id|arg
comma
r_sizeof
(paren
id|rb
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|rb.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|rb.memory
op_ne
id|V4L2_MEMORY_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;io
op_eq
id|IO_READ
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Close and open the device again to choose &quot;
l_string|&quot;the mmap I/O method&quot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cam-&gt;nbuffers
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|i
)braket
dot
id|vma_use_count
)paren
(brace
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;VIDIOC_REQBUFS failed. &quot;
l_string|&quot;Previous buffers are still mapped.&quot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_ON
)paren
(brace
id|cam-&gt;stream
op_assign
id|STREAM_INTERRUPT
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_stream
comma
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. To use &quot;
l_string|&quot;it, close and open /dev/video%d &quot;
l_string|&quot;again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sn9c102_empty_framequeues
c_func
(paren
id|cam
)paren
suffix:semicolon
id|sn9c102_release_buffers
c_func
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rb.count
)paren
id|rb.count
op_assign
id|sn9c102_request_buffers
c_func
(paren
id|cam
comma
id|rb.count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|rb
comma
r_sizeof
(paren
id|rb
)paren
)paren
)paren
(brace
id|sn9c102_release_buffers
c_func
(paren
id|cam
)paren
suffix:semicolon
id|cam-&gt;io
op_assign
id|IO_NONE
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|cam-&gt;io
op_assign
id|rb.count
ques
c_cond
id|IO_MMAP
suffix:colon
id|IO_NONE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_QUERYBUF
suffix:colon
(brace
r_struct
id|v4l2_buffer
id|b
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|b
comma
id|arg
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|b.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|b.index
op_ge
id|cam-&gt;nbuffers
op_logical_or
id|cam-&gt;io
op_ne
id|IO_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|b
comma
op_amp
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|buf
comma
r_sizeof
(paren
id|b
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|vma_use_count
)paren
id|b.flags
op_or_assign
id|V4L2_BUF_FLAG_MAPPED
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|state
op_eq
id|F_DONE
)paren
id|b.flags
op_or_assign
id|V4L2_BUF_FLAG_DONE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|state
op_ne
id|F_UNUSED
)paren
id|b.flags
op_or_assign
id|V4L2_BUF_FLAG_QUEUED
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|b
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_QBUF
suffix:colon
(brace
r_struct
id|v4l2_buffer
id|b
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|b
comma
id|arg
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|b.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|b.index
op_ge
id|cam-&gt;nbuffers
op_logical_or
id|cam-&gt;io
op_ne
id|IO_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|state
op_ne
id|F_UNUSED
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|state
op_assign
id|F_QUEUED
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|cam-&gt;frame
(braket
id|b.index
)braket
dot
id|frame
comma
op_amp
id|cam-&gt;inqueue
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;Frame #%lu queued&quot;
comma
(paren
r_int
r_int
)paren
id|b.index
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_DQBUF
suffix:colon
(brace
r_struct
id|v4l2_buffer
id|b
suffix:semicolon
r_struct
id|sn9c102_frame_t
op_star
id|f
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|b
comma
id|arg
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|b.type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|cam-&gt;io
op_ne
id|IO_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
)paren
(brace
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_frame
comma
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;outqueue
)paren
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|f
op_assign
id|list_entry
c_func
(paren
id|cam-&gt;outqueue.next
comma
r_struct
id|sn9c102_frame_t
comma
id|frame
)paren
suffix:semicolon
id|list_del
c_func
(paren
id|cam-&gt;outqueue.next
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cam-&gt;queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|f-&gt;state
op_assign
id|F_UNUSED
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|b
comma
op_amp
id|f-&gt;buf
comma
r_sizeof
(paren
id|b
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;vma_use_count
)paren
id|b.flags
op_or_assign
id|V4L2_BUF_FLAG_MAPPED
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|b
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|PDBGG
c_func
(paren
l_string|&quot;Frame #%lu dequeued&quot;
comma
(paren
r_int
r_int
)paren
id|f-&gt;buf.index
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_STREAMON
suffix:colon
(brace
r_int
id|type
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|type
comma
id|arg
comma
r_sizeof
(paren
id|type
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|cam-&gt;io
op_ne
id|IO_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|cam-&gt;inqueue
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cam-&gt;stream
op_assign
id|STREAM_ON
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Stream on&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_STREAMOFF
suffix:colon
(brace
r_int
id|type
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|type
comma
id|arg
comma
r_sizeof
(paren
id|type
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
op_logical_or
id|cam-&gt;io
op_ne
id|IO_MMAP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;stream
op_eq
id|STREAM_ON
)paren
(brace
id|cam-&gt;stream
op_assign
id|STREAM_INTERRUPT
suffix:semicolon
id|err
op_assign
id|wait_event_interruptible
(paren
id|cam-&gt;wait_stream
comma
(paren
id|cam-&gt;stream
op_eq
id|STREAM_OFF
)paren
op_logical_or
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. To use &quot;
l_string|&quot;it, close and open /dev/video%d &quot;
l_string|&quot;again.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|sn9c102_empty_framequeues
c_func
(paren
id|cam
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Stream off&quot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_STD
suffix:colon
r_case
id|VIDIOC_S_STD
suffix:colon
r_case
id|VIDIOC_QUERYSTD
suffix:colon
r_case
id|VIDIOC_ENUMSTD
suffix:colon
r_case
id|VIDIOC_QUERYMENU
suffix:colon
r_case
id|VIDIOC_G_PARM
suffix:colon
r_case
id|VIDIOC_S_PARM
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|sn9c102_ioctl
r_static
r_int
id|sn9c102_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|video_get_drvdata
c_func
(paren
id|video_devdata
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_DISCONNECTED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Device not present&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cam-&gt;state
op_amp
id|DEV_MISCONFIGURED
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;The camera is misconfigured. Close and open it again.&quot;
)paren
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|err
op_assign
id|sn9c102_v4l2_ioctl
c_func
(paren
id|inode
comma
id|filp
comma
id|cmd
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;fileop_sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|sn9c102_fops
r_static
r_struct
id|file_operations
id|sn9c102_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|sn9c102_open
comma
dot
id|release
op_assign
id|sn9c102_release
comma
dot
id|ioctl
op_assign
id|sn9c102_ioctl
comma
dot
id|read
op_assign
id|sn9c102_read
comma
dot
id|poll
op_assign
id|sn9c102_poll
comma
dot
id|mmap
op_assign
id|sn9c102_mmap
comma
dot
id|llseek
op_assign
id|no_llseek
comma
)brace
suffix:semicolon
multiline_comment|/*****************************************************************************/
multiline_comment|/* It exists a single interface only. We do not need to validate anything. */
r_static
r_int
DECL|function|sn9c102_usb_probe
id|sn9c102_usb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|sn9c102_device
op_star
id|cam
suffix:semicolon
r_static
r_int
r_int
id|dev_nr
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
comma
id|n
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|r
suffix:semicolon
id|n
op_assign
r_sizeof
(paren
id|sn9c102_id_table
)paren
op_div
r_sizeof
(paren
id|sn9c102_id_table
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|udev-&gt;descriptor.idVendor
op_eq
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idVendor
op_logical_and
id|udev-&gt;descriptor.idProduct
op_eq
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idProduct
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|n
op_minus
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sn9c102_device
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|cam
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cam
)paren
)paren
suffix:semicolon
id|cam-&gt;usbdev
op_assign
id|udev
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cam-&gt;dev
comma
op_amp
id|udev-&gt;dev
comma
r_sizeof
(paren
r_struct
id|device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;control_buffer
op_assign
id|kmalloc
c_func
(paren
l_int|8
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;kmalloc() failed&quot;
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cam-&gt;control_buffer
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cam-&gt;v4ldev
op_assign
id|video_device_alloc
c_func
(paren
)paren
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;video_device_alloc() failed&quot;
)paren
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|init_MUTEX
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|r
op_assign
id|sn9c102_read_reg
c_func
(paren
id|cam
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|0
op_logical_or
id|r
op_ne
l_int|0x10
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Sorry, this is not a SN9C10x based camera &quot;
l_string|&quot;(vid/pid 0x%04X/0x%04X)&quot;
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idVendor
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idProduct
)paren
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|cam-&gt;bridge
op_assign
(paren
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idProduct
op_amp
l_int|0xffc0
)paren
op_eq
l_int|0x6080
ques
c_cond
id|BRIDGE_SN9C103
suffix:colon
id|BRIDGE_SN9C102
suffix:semicolon
r_switch
c_cond
(paren
id|cam-&gt;bridge
)paren
(brace
r_case
id|BRIDGE_SN9C101
suffix:colon
r_case
id|BRIDGE_SN9C102
suffix:colon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;SN9C10[12] PC Camera Controller detected &quot;
l_string|&quot;(vid/pid 0x%04X/0x%04X)&quot;
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idVendor
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idProduct
)paren
r_break
suffix:semicolon
r_case
id|BRIDGE_SN9C103
suffix:colon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;SN9C103 PC Camera Controller detected &quot;
l_string|&quot;(vid/pid 0x%04X/0x%04X)&quot;
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idVendor
comma
id|sn9c102_id_table
(braket
id|i
)braket
dot
id|idProduct
)paren
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|sn9c102_sensor_table
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|sn9c102_sensor_table
(braket
id|i
)braket
(paren
id|cam
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|cam-&gt;sensor
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;%s image sensor detected&quot;
comma
id|cam-&gt;sensor-&gt;name
)paren
id|DBG
c_func
(paren
l_int|3
comma
l_string|&quot;Support for %s maintained by %s&quot;
comma
id|cam-&gt;sensor-&gt;name
comma
id|cam-&gt;sensor-&gt;maintainer
)paren
)brace
r_else
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;No supported image sensor detected&quot;
)paren
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sn9c102_init
c_func
(paren
id|cam
)paren
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Initialization failed. I will retry on open().&quot;
)paren
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|cam-&gt;v4ldev-&gt;name
comma
l_string|&quot;SN9C10x PC Camera&quot;
)paren
suffix:semicolon
id|cam-&gt;v4ldev-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|cam-&gt;v4ldev-&gt;type
op_assign
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_SCALES
suffix:semicolon
id|cam-&gt;v4ldev-&gt;hardware
op_assign
id|VID_HARDWARE_SN9C102
suffix:semicolon
id|cam-&gt;v4ldev-&gt;fops
op_assign
op_amp
id|sn9c102_fops
suffix:semicolon
id|cam-&gt;v4ldev-&gt;minor
op_assign
id|video_nr
(braket
id|dev_nr
)braket
suffix:semicolon
id|cam-&gt;v4ldev-&gt;release
op_assign
id|video_device_release
suffix:semicolon
id|video_set_drvdata
c_func
(paren
id|cam-&gt;v4ldev
comma
id|cam
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|err
op_assign
id|video_register_device
c_func
(paren
id|cam-&gt;v4ldev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
(braket
id|dev_nr
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;V4L2 device registration failed&quot;
)paren
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|ENFILE
op_logical_and
id|video_nr
(braket
id|dev_nr
)braket
op_eq
op_minus
l_int|1
)paren
id|DBG
c_func
(paren
l_int|1
comma
l_string|&quot;Free /dev/videoX node not found&quot;
)paren
id|video_nr
(braket
id|dev_nr
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|dev_nr
op_assign
(paren
id|dev_nr
OL
id|SN9C102_MAX_DEVICES
op_minus
l_int|1
)paren
ques
c_cond
id|dev_nr
op_plus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;V4L2 device registered as /dev/video%d&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|sn9c102_create_sysfs
c_func
(paren
id|cam
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|cam
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
r_if
c_cond
(paren
id|cam
)paren
(brace
id|kfree
c_func
(paren
id|cam-&gt;control_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;v4ldev
)paren
id|video_device_release
c_func
(paren
id|cam-&gt;v4ldev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|sn9c102_usb_disconnect
r_static
r_void
id|sn9c102_usb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|sn9c102_device
op_star
id|cam
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam
)paren
r_return
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Disconnecting %s...&quot;
comma
id|cam-&gt;v4ldev-&gt;name
)paren
id|wake_up_interruptible_all
c_func
(paren
op_amp
id|cam-&gt;open
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam-&gt;users
)paren
(brace
id|DBG
c_func
(paren
l_int|2
comma
l_string|&quot;Device /dev/video%d is open! Deregistration and &quot;
l_string|&quot;memory deallocation are deferred on close.&quot;
comma
id|cam-&gt;v4ldev-&gt;minor
)paren
id|cam-&gt;state
op_or_assign
id|DEV_MISCONFIGURED
suffix:semicolon
id|sn9c102_stop_transfer
c_func
(paren
id|cam
)paren
suffix:semicolon
id|cam-&gt;state
op_or_assign
id|DEV_DISCONNECTED
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_frame
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|cam-&gt;wait_stream
)paren
suffix:semicolon
)brace
r_else
(brace
id|cam-&gt;state
op_or_assign
id|DEV_DISCONNECTED
suffix:semicolon
id|sn9c102_release_resources
c_func
(paren
id|cam
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cam-&gt;dev_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cam-&gt;users
)paren
id|kfree
c_func
(paren
id|cam
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|sn9c102_disconnect
)paren
suffix:semicolon
)brace
DECL|variable|sn9c102_usb_driver
r_static
r_struct
id|usb_driver
id|sn9c102_usb_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;sn9c102&quot;
comma
dot
id|id_table
op_assign
id|sn9c102_id_table
comma
dot
id|probe
op_assign
id|sn9c102_usb_probe
comma
dot
id|disconnect
op_assign
id|sn9c102_usb_disconnect
comma
)brace
suffix:semicolon
multiline_comment|/*****************************************************************************/
DECL|function|sn9c102_module_init
r_static
r_int
id|__init
id|sn9c102_module_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|KDBG
c_func
(paren
l_int|2
comma
id|SN9C102_MODULE_NAME
l_string|&quot; v&quot;
id|SN9C102_MODULE_VERSION
)paren
id|KDBG
c_func
(paren
l_int|3
comma
id|SN9C102_MODULE_AUTHOR
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|sn9c102_usb_driver
)paren
)paren
)paren
id|KDBG
c_func
(paren
l_int|1
comma
l_string|&quot;usb_register() failed&quot;
)paren
r_return
id|err
suffix:semicolon
)brace
DECL|function|sn9c102_module_exit
r_static
r_void
id|__exit
id|sn9c102_module_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|sn9c102_usb_driver
)paren
suffix:semicolon
)brace
DECL|variable|sn9c102_module_init
id|module_init
c_func
(paren
id|sn9c102_module_init
)paren
suffix:semicolon
DECL|variable|sn9c102_module_exit
id|module_exit
c_func
(paren
id|sn9c102_module_exit
)paren
suffix:semicolon
eof
