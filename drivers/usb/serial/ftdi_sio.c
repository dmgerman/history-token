multiline_comment|/*&n; * USB FTDI SIO driver&n; *&n; * &t;Copyright (C) 1999 - 2001&n; * &t;    Greg Kroah-Hartman (greg@kroah.com)&n; *          Bill Ryder (bryder@sgi.com)&n; *&t;Copyright (C) 2002&n; *&t;    Kuba Ober (kuba@mareimbrium.org)&n; *&n; * &t;This program is free software; you can redistribute it and/or modify&n; * &t;it under the terms of the GNU General Public License as published by&n; * &t;the Free Software Foundation; either version 2 of the License, or&n; * &t;(at your option) any later version.&n; *&n; * See Documentation/usb/usb-serial.txt for more information on using this driver&n; *&n; * See http://ftdi-usb-sio.sourceforge.net for upto date testing info&n; *&t;and extra documentation&n; *&n; * (09/Feb/2004) Ian Abbott&n; *      Changed full name of USB-UIRT device to avoid &quot;/&quot; character.&n; *      Added FTDI&squot;s alternate PID (0x6006) for FT232/245 devices.&n; *      Added PID for &quot;ELV USB Module UO100&quot; from Stefan Frings.&n; * &n; * (21/Oct/2003) Ian Abbott&n; *      Renamed some VID/PID macros for Matrix Orbital and Perle Systems&n; *      devices.  Removed Matrix Orbital and Perle Systems devices from the&n; *      8U232AM device table, but left them in the FT232BM table, as they are&n; *      known to use only FT232BM.&n; *&n; * (17/Oct/2003) Scott Allen&n; *      Added vid/pid for Perle Systems UltraPort USB serial converters&n; *&n; * (21/Sep/2003) Ian Abbott&n; *      Added VID/PID for Omnidirectional Control Technology US101 USB to&n; *      RS-232 adapter (also rebadged as Dick Smith Electronics XH6381).&n; *      VID/PID supplied by Donald Gordon.&n; *&n; * (19/Aug/2003) Ian Abbott&n; *      Freed urb&squot;s transfer buffer in write bulk callback.&n; *      Omitted some paranoid checks in write bulk callback that don&squot;t matter.&n; *      Scheduled work in write bulk callback regardless of port&squot;s open count.&n; *&n; * (05/Aug/2003) Ian Abbott&n; *      Added VID/PID for ID TECH IDT1221U USB to RS-232 adapter.&n; *      VID/PID provided by Steve Briggs.&n; *&n; * (23/Jul/2003) Ian Abbott&n; *      Added PIDs for CrystalFontz 547, 633, 631, 635, 640 and 640 from&n; *      Wayne Wylupski.&n; *&n; * (10/Jul/2003) David Glance&n; *      Added PID for DSS-20 SyncStation cradle for Sony-Ericsson P800.&n; *&n; * (27/Jun/2003) Ian Abbott&n; *&t;Reworked the urb handling logic.  We have no more pool, but dynamically&n; *&t;allocate the urb and the transfer buffer on the fly.  In testing this&n; *&t;does not incure any measurable overhead.  This also relies on the fact&n; *&t;that we have proper reference counting logic for urbs.  I nicked this&n; *&t;from Greg KH&squot;s Visor driver.&n; *      &n; * (23/Jun/2003) Ian Abbott&n; *      Reduced flip buffer pushes and corrected a data length test in&n; *      ftdi_read_bulk_callback.&n; *      Defererence pointers after any paranoid checks, not before.&n; *&n; * (21/Jun/2003) Erik Nygren&n; *      Added support for Home Electronics Tira-1 IR tranceiver using FT232BM chip.&n; *      See &lt;http://www.home-electro.com/tira1.htm&gt;.  Only operates properly &n; *      at 100000 and RTS-CTS, so set custom divisor mode on startup.&n; *      Also force the Tira-1 and USB-UIRT to only use their custom baud rates.&n; *&n; * (18/Jun/2003) Ian Abbott&n; *      Added Device ID of the USB relais from Rudolf Gugler (backported from&n; *      Philipp G&#xfffd;hring&squot;s patch for 2.5.x kernel).&n; *      Moved read transfer buffer reallocation into startup function.&n; *      Free existing write urb and transfer buffer in startup function.&n; *      Only use urbs in write urb pool that were successfully allocated.&n; *      Moved some constant macros out of functions.&n; *      Minor whitespace and comment changes.&n; *&n; * (12/Jun/2003) David Norwood&n; *      Added support for USB-UIRT IR tranceiver using 8U232AM chip.&n; *      See &lt;http://home.earthlink.net/~jrhees/USBUIRT/index.htm&gt;.  Only&n; *      operates properly at 312500, so set custom divisor mode on startup.&n; *&n; * (12/Jun/2003) Ian Abbott&n; *      Added Sealevel SeaLINK+ 210x, 220x, 240x, 280x vid/pids from Tuan Hoang&n; *      - I&squot;ve eliminated some that don&squot;t seem to exist!&n; *      Added Home Electronics Tira-1 IR transceiver pid from Chris Horn&n; *      Some whitespace/coding-style cleanups&n; *&n; * (11/Jun/2003) Ian Abbott&n; *      Fixed unsafe spinlock usage in ftdi_write&n; *&n; * (24/Feb/2003) Richard Shooter&n; *      Increase read buffer size to improve read speeds at higher baud rates&n; *      (specifically tested with up to 1Mb/sec at 1.5M baud)&n; *&n; * (23/Feb/2003) John Wilkins&n; *      Added Xon/xoff flow control (activating support in the ftdi device)&n; *      Added vid/pid for Videonetworks/Homechoice (UK ISP)&n; *&n; * (23/Feb/2003) Bill Ryder&n; *      Added matrix orb device vid/pids from Wayne Wylupski&n; *&n; * (19/Feb/2003) Ian Abbott&n; *      For TIOCSSERIAL, set alt_speed to 0 when ASYNC_SPD_MASK value has&n; *      changed to something other than ASYNC_SPD_HI, ASYNC_SPD_VHI,&n; *      ASYNC_SPD_SHI or ASYNC_SPD_WARP.  Also, unless ASYNC_SPD_CUST is in&n; *      force, don&squot;t bother changing baud rate when custom_divisor has changed.&n; *&n; * (18/Feb/2003) Ian Abbott&n; *      Fixed TIOCMGET handling to include state of DTR and RTS, the state&n; *      of which are now saved by set_dtr() and set_rts().&n; *      Fixed improper storage class for buf in set_dtr() and set_rts().&n; *      Added FT232BM chip type and support for its extra baud rates (compared&n; *      to FT8U232AM).&n; *      Took account of special case divisor values for highest baud rates of&n; *      FT8U232AM and FT232BM.&n; *      For TIOCSSERIAL, forced alt_speed to 0 when ASYNC_SPD_CUST kludge used,&n; *      as previous alt_speed setting is now stale.&n; *      Moved startup code common between the startup routines for the&n; *      different chip types into a common subroutine.&n; *&n; * (17/Feb/2003) Bill Ryder&n; *      Added write urb buffer pool on a per device basis&n; *      Added more checking for open file on callbacks (fixed OOPS)&n; *      Added CrystalFontz 632 and 634 PIDs &n; *         (thanx to CrystalFontz for the sample devices - they flushed out&n; *           some driver bugs)&n; *      Minor debugging message changes&n; *      Added throttle, unthrottle and chars_in_buffer functions&n; *      Fixed FTDI_SIO (the original device) bug&n; *      Fixed some shutdown handling&n; *      &n; * &n; * &n; * &n; * (07/Jun/2002) Kuba Ober&n; *&t;Changed FTDI_SIO_BASE_BAUD_TO_DIVISOR macro into ftdi_baud_to_divisor&n; *&t;function. It was getting too complex.&n; *&t;Fix the divisor calculation logic which was setting divisor of 0.125&n; *&t;instead of 0.5 for fractional parts of divisor equal to 5/8, 6/8, 7/8.&n; *&t;Also make it bump up the divisor to next integer in case of 7/8 - it&squot;s&n; *&t;a better approximation.&n; *&n; * (25/Jul/2002) Bill Ryder inserted Dmitri&squot;s TIOCMIWAIT patch&n; *      Not tested by me but it doesn&squot;t break anything I use.&n; * &n; * (04/Jan/2002) Kuba Ober&n; *&t;Implemented 38400 baudrate kludge, where it can be substituted with other&n; *&t;  values. That&squot;s the only way to set custom baudrates.&n; *&t;Implemented TIOCSSERIAL, TIOCGSERIAL ioctl&squot;s so that setserial is happy.&n; *&t;FIXME: both baudrate things should eventually go to usbserial.c as other&n; *&t;  devices may need that functionality too. Actually, it can probably be&n; *&t;  merged in serial.c somehow - too many drivers repeat this code over&n; *&t;  and over.&n; *&t;Fixed baudrate forgetfulness - open() used to reset baudrate to 9600 every time.&n; *&t;Divisors for baudrates are calculated by a macro.&n; *&t;Small code cleanups. Ugly whitespace changes for Plato&squot;s sake only ;-].&n; *&n; * (04/Nov/2001) Bill Ryder&n; *&t;Fixed bug in read_bulk_callback where incorrect urb buffer was used.&n; *&t;Cleaned up write offset calculation&n; *&t;Added write_room since default values can be incorrect for sio&n; *&t;Changed write_bulk_callback to use same queue_task as other drivers&n; *        (the previous version caused panics)&n; *&t;Removed port iteration code since the device only has one I/O port and it&n; *&t;  was wrong anyway.&n; * &n; * (31/May/2001) gkh&n; *&t;Switched from using spinlock to a semaphore, which fixes lots of problems.&n; *&n; * (23/May/2001)   Bill Ryder&n; *&t;Added runtime debug patch (thanx Tyson D Sawyer).&n; *&t;Cleaned up comments for 8U232&n; *&t;Added parity, framing and overrun error handling&n; *&t;Added receive break handling.&n; * &n; * (04/08/2001) gb&n; *&t;Identify version on module load.&n; *       &n; * (18/March/2001) Bill Ryder&n; *&t;(Not released)&n; *&t;Added send break handling. (requires kernel patch too)&n; *&t;Fixed 8U232AM hardware RTS/CTS etc status reporting.&n; *&t;Added flipbuf fix copied from generic device&n; * &n; * (12/3/2000) Bill Ryder&n; *&t;Added support for 8U232AM device.&n; *&t;Moved PID and VIDs into header file only.&n; *&t;Turned on low-latency for the tty (device will do high baudrates)&n; *&t;Added shutdown routine to close files when device removed.&n; *&t;More debug and error message cleanups.&n; *&n; * (11/13/2000) Bill Ryder&n; *&t;Added spinlock protected open code and close code.&n; *&t;Multiple opens work (sort of - see webpage mentioned above).&n; *&t;Cleaned up comments. Removed multiple PID/VID definitions.&n; *&t;Factorised cts/dtr code&n; *&t;Made use of __FUNCTION__ in dbg&squot;s&n; *      &n; * (11/01/2000) Adam J. Richter&n; *&t;usb_device_id table support&n; * &n; * (10/05/2000) gkh&n; *&t;Fixed bug with urb-&gt;dev not being set properly, now that the usb&n; *&t;core needs it.&n; * &n; * (09/11/2000) gkh&n; *&t;Removed DEBUG #ifdefs with call to usb_serial_debug_data&n; *&n; * (07/19/2000) gkh&n; *&t;Added module_init and module_exit functions to handle the fact that this&n; *&t;driver is a loadable module now.&n; *&n; * (04/04/2000) Bill Ryder &n; *&t;Fixed bugs in TCGET/TCSET ioctls (by removing them - they are&n; *        handled elsewhere in the tty io driver chain).&n; *&n; * (03/30/2000) Bill Ryder &n; *&t;Implemented lots of ioctls&n; *&t;Fixed a race condition in write&n; *&t;Changed some dbg&squot;s to errs&n; *&n; * (03/26/2000) gkh&n; *&t;Split driver up into device specific pieces.&n; *&n; */
multiline_comment|/* Bill Ryder - bryder@sgi.com - wrote the FTDI_SIO implementation */
multiline_comment|/* Thanx to FTDI for so kindly providing details of the protocol required */
multiline_comment|/*   to talk to the device */
multiline_comment|/* Thanx to gkh and the rest of the usb dev group for all code I have assimilated :-) */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_driver.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#ifdef CONFIG_USB_SERIAL_DEBUG
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
macro_line|#else
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
macro_line|#endif
macro_line|#include &quot;usb-serial.h&quot;
macro_line|#include &quot;ftdi_sio.h&quot;
multiline_comment|/*&n; * Version Information&n; */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;v1.4.0&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Greg Kroah-Hartman &lt;greg@kroah.com&gt;, Bill Ryder &lt;bryder@sgi.com&gt;, Kuba Ober &lt;kuba@mareimbrium.org&gt;&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;USB FTDI Serial Converters Driver&quot;
DECL|variable|id_table_sio
r_static
r_struct
id|usb_device_id
id|id_table_sio
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_SIO_PID
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
multiline_comment|/*&n; * The 8U232AM has the same API as the sio except for:&n; * - it can support MUCH higher baudrates; up to:&n; *   o 921600 for RS232 and 2000000 for RS422/485 at 48MHz&n; *   o 230400 at 12MHz&n; *   so .. 8U232AM&squot;s baudrate setting codes are different&n; * - it has a two byte status code.&n; * - it returns characters every 16ms (the FTDI does it every 40ms)&n; *&n; * the bcdDevice value is used to differentiate FT232BM and FT245BM from&n; * the earlier FT8U232AM and FT8U232BM.  For now, include all known VID/PID&n; * combinations in both tables.&n; * FIXME: perhaps bcdDevice can also identify 12MHz devices, but I don&squot;t know&n; * if those ever went into mass production. [Ian Abbott]&n; */
DECL|variable|id_table_8U232AM
r_static
r_struct
id|usb_device_id
id|id_table_8U232AM
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_IRTRANS_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_ALT_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_RELAIS_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_NF_RIC_VID
comma
id|FTDI_NF_RIC_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_632_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_634_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_547_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_633_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_631_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_635_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_640_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_642_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_VNHCPCUSB_D_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_DSS20_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2101_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2102_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2103_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2104_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_5_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_6_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_7_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_8_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_5_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_6_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_7_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_8_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_1_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_2_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_3_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_4_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_5_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_6_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_7_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_8_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|IDTECH_VID
comma
id|IDTECH_IDT1221U_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|OCT_VID
comma
id|OCT_US101_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_1
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_R2X0
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_3
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_4
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_ELV_UO100_PID
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|INSIDE_ACCESSO
comma
l_int|0
comma
l_int|0x3ff
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
DECL|variable|id_table_FT232BM
r_static
r_struct
id|usb_device_id
id|id_table_FT232BM
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_IRTRANS_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_ALT_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_RELAIS_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_NF_RIC_VID
comma
id|FTDI_NF_RIC_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_632_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_634_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_547_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_633_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_631_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_635_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_640_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_642_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_VNHCPCUSB_D_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_DSS20_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_0_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_5_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_6_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_PERLE_ULTRAPORT_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_PIEGROUP_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2101_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2102_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2103_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2104_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_5_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_6_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_7_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_8_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_5_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_6_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_7_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_8_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_5_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_6_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_7_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_8_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|IDTECH_VID
comma
id|IDTECH_IDT1221U_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|OCT_VID
comma
id|OCT_US101_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_1
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_R2X0
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_3
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_4
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E808_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E809_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80A_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80B_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80C_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80D_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80E_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E80F_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E888_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E889_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88A_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88B_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88C_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88D_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88E_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_GUDEADS_E88F_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_ELV_UO100_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_SDMUSBQSS_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_MASTERDEVEL2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_0_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
DECL|variable|id_table_USB_UIRT
r_static
r_struct
id|usb_device_id
id|id_table_USB_UIRT
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_USB_UIRT_PID
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
DECL|variable|id_table_HE_TIRA1
r_static
r_struct
id|usb_device_id
id|id_table_HE_TIRA1
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_HE_TIRA1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
DECL|variable|id_table_combined
r_static
r_struct
id|usb_device_id
id|id_table_combined
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_IRTRANS_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_SIO_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_8U232AM_ALT_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_RELAIS_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_632_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_634_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_547_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_633_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_631_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_635_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_640_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_XF_642_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_DSS20_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_NF_RIC_VID
comma
id|FTDI_NF_RIC_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_VNHCPCUSB_D_PID
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_0_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_3_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_4_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_5_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_MTXORB_6_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_PERLE_ULTRAPORT_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2101_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2102_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2103_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2104_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2201_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2202_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2203_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2401_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2402_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2403_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_5_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_6_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_7_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2801_8_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_5_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_6_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_7_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2802_8_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_1_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_2_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_3_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_4_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_5_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_6_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_7_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|SEALEVEL_VID
comma
id|SEALEVEL_2803_8_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|IDTECH_VID
comma
id|IDTECH_IDT1221U_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|OCT_VID
comma
id|OCT_US101_PID
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|FTDI_HE_TIRA1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_USB_UIRT_PID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_1
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_R2X0
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_3
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|PROTEGO_SPECIAL_4
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|FTDI_ELV_UO100_PID
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_SDMUSBQSS_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_MASTERDEVEL2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_0_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_1_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE_VER
c_func
(paren
id|FTDI_VID
comma
id|LINX_FUTURE_2_PID
comma
l_int|0x400
comma
l_int|0xffff
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|FTDI_VID
comma
id|INSIDE_ACCESSO
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|id_table_combined
)paren
suffix:semicolon
DECL|variable|ftdi_driver
r_static
r_struct
id|usb_driver
id|ftdi_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ftdi_sio&quot;
comma
dot
id|probe
op_assign
id|usb_serial_probe
comma
dot
id|disconnect
op_assign
id|usb_serial_disconnect
comma
dot
id|id_table
op_assign
id|id_table_combined
comma
)brace
suffix:semicolon
multiline_comment|/* Constants for read urb and write urb */
DECL|macro|BUFSZ
mdefine_line|#define BUFSZ 512
DECL|macro|PKTSZ
mdefine_line|#define PKTSZ 64
DECL|struct|ftdi_private
r_struct
id|ftdi_private
(brace
DECL|member|chip_type
id|ftdi_chip_type_t
id|chip_type
suffix:semicolon
multiline_comment|/* type of the device, either SIO or FT8U232AM */
DECL|member|baud_base
r_int
id|baud_base
suffix:semicolon
multiline_comment|/* baud base clock for divisor setting */
DECL|member|custom_divisor
r_int
id|custom_divisor
suffix:semicolon
multiline_comment|/* custom_divisor kludge, this is for baud_base (different from what goes to the chip!) */
DECL|member|last_set_data_urb_value
id|__u16
id|last_set_data_urb_value
suffix:semicolon
multiline_comment|/* the last data state set - needed for doing a break */
DECL|member|write_offset
r_int
id|write_offset
suffix:semicolon
multiline_comment|/* This is the offset in the usb data block to write the serial data - &n;&t;&t;&t;&t; * it is different between devices&n;&t;&t;&t;&t; */
DECL|member|flags
r_int
id|flags
suffix:semicolon
multiline_comment|/* some ASYNC_xxxx flags are supported */
DECL|member|last_dtr_rts
r_int
r_int
id|last_dtr_rts
suffix:semicolon
multiline_comment|/* saved modem control outputs */
DECL|member|delta_msr_wait
id|wait_queue_head_t
id|delta_msr_wait
suffix:semicolon
multiline_comment|/* Used for TIOCMIWAIT */
DECL|member|prev_status
DECL|member|diff_status
r_char
id|prev_status
comma
id|diff_status
suffix:semicolon
multiline_comment|/* Used for TIOCMIWAIT */
DECL|member|force_baud
r_int
id|force_baud
suffix:semicolon
multiline_comment|/* if non-zero, force the baud rate to this value */
DECL|member|force_rtscts
r_int
id|force_rtscts
suffix:semicolon
multiline_comment|/* if non-zero, force RTS-CTS to always be enabled */
)brace
suffix:semicolon
multiline_comment|/* Used for TIOCMIWAIT */
DECL|macro|FTDI_STATUS_B0_MASK
mdefine_line|#define FTDI_STATUS_B0_MASK&t;(FTDI_RS0_CTS | FTDI_RS0_DSR | FTDI_RS0_RI | FTDI_RS0_RLSD)
DECL|macro|FTDI_STATUS_B1_MASK
mdefine_line|#define FTDI_STATUS_B1_MASK&t;(FTDI_RS_BI)
multiline_comment|/* End TIOCMIWAIT */
DECL|macro|FTDI_IMPL_ASYNC_FLAGS
mdefine_line|#define FTDI_IMPL_ASYNC_FLAGS = ( ASYNC_SPD_HI | ASYNC_SPD_VHI &bslash;&n; ASYNC_SPD_CUST | ASYNC_SPD_SHI | ASYNC_SPD_WARP )
multiline_comment|/* function prototypes for a FTDI serial converter */
r_static
r_int
id|ftdi_SIO_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_int
id|ftdi_8U232AM_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_int
id|ftdi_FT232BM_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_int
id|ftdi_USB_UIRT_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_int
id|ftdi_HE_TIRA1_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_void
id|ftdi_shutdown
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
suffix:semicolon
r_static
r_int
id|ftdi_open
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|filp
)paren
suffix:semicolon
r_static
r_void
id|ftdi_close
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|filp
)paren
suffix:semicolon
r_static
r_int
id|ftdi_write
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|ftdi_write_room
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
suffix:semicolon
r_static
r_int
id|ftdi_chars_in_buffer
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
suffix:semicolon
r_static
r_void
id|ftdi_write_bulk_callback
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ftdi_read_bulk_callback
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ftdi_set_termios
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|old
)paren
suffix:semicolon
r_static
r_int
id|ftdi_tiocmget
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|ftdi_tiocmset
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|set
comma
r_int
r_int
id|clear
)paren
suffix:semicolon
r_static
r_int
id|ftdi_ioctl
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|ftdi_break_ctl
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|break_state
)paren
suffix:semicolon
r_static
r_void
id|ftdi_throttle
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
suffix:semicolon
r_static
r_void
id|ftdi_unthrottle
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
suffix:semicolon
r_static
r_int
r_int
r_int
id|ftdi_232am_baud_base_to_divisor
(paren
r_int
id|baud
comma
r_int
id|base
)paren
suffix:semicolon
r_static
r_int
r_int
r_int
id|ftdi_232am_baud_to_divisor
(paren
r_int
id|baud
)paren
suffix:semicolon
r_static
id|__u32
id|ftdi_232bm_baud_base_to_divisor
(paren
r_int
id|baud
comma
r_int
id|base
)paren
suffix:semicolon
r_static
id|__u32
id|ftdi_232bm_baud_to_divisor
(paren
r_int
id|baud
)paren
suffix:semicolon
DECL|variable|ftdi_SIO_device
r_static
r_struct
id|usb_serial_device_type
id|ftdi_SIO_device
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;FTDI SIO&quot;
comma
dot
id|id_table
op_assign
id|id_table_sio
comma
dot
id|num_interrupt_in
op_assign
l_int|0
comma
dot
id|num_bulk_in
op_assign
l_int|1
comma
dot
id|num_bulk_out
op_assign
l_int|1
comma
dot
id|num_ports
op_assign
l_int|1
comma
dot
id|open
op_assign
id|ftdi_open
comma
dot
id|close
op_assign
id|ftdi_close
comma
dot
id|throttle
op_assign
id|ftdi_throttle
comma
dot
id|unthrottle
op_assign
id|ftdi_unthrottle
comma
dot
id|write
op_assign
id|ftdi_write
comma
dot
id|write_room
op_assign
id|ftdi_write_room
comma
dot
id|chars_in_buffer
op_assign
id|ftdi_chars_in_buffer
comma
dot
id|read_bulk_callback
op_assign
id|ftdi_read_bulk_callback
comma
dot
id|write_bulk_callback
op_assign
id|ftdi_write_bulk_callback
comma
dot
id|tiocmget
op_assign
id|ftdi_tiocmget
comma
dot
id|tiocmset
op_assign
id|ftdi_tiocmset
comma
dot
id|ioctl
op_assign
id|ftdi_ioctl
comma
dot
id|set_termios
op_assign
id|ftdi_set_termios
comma
dot
id|break_ctl
op_assign
id|ftdi_break_ctl
comma
dot
id|attach
op_assign
id|ftdi_SIO_startup
comma
dot
id|shutdown
op_assign
id|ftdi_shutdown
comma
)brace
suffix:semicolon
DECL|variable|ftdi_8U232AM_device
r_static
r_struct
id|usb_serial_device_type
id|ftdi_8U232AM_device
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;FTDI 8U232AM Compatible&quot;
comma
dot
id|id_table
op_assign
id|id_table_8U232AM
comma
dot
id|num_interrupt_in
op_assign
l_int|0
comma
dot
id|num_bulk_in
op_assign
l_int|1
comma
dot
id|num_bulk_out
op_assign
l_int|1
comma
dot
id|num_ports
op_assign
l_int|1
comma
dot
id|open
op_assign
id|ftdi_open
comma
dot
id|close
op_assign
id|ftdi_close
comma
dot
id|throttle
op_assign
id|ftdi_throttle
comma
dot
id|unthrottle
op_assign
id|ftdi_unthrottle
comma
dot
id|write
op_assign
id|ftdi_write
comma
dot
id|write_room
op_assign
id|ftdi_write_room
comma
dot
id|chars_in_buffer
op_assign
id|ftdi_chars_in_buffer
comma
dot
id|read_bulk_callback
op_assign
id|ftdi_read_bulk_callback
comma
dot
id|write_bulk_callback
op_assign
id|ftdi_write_bulk_callback
comma
dot
id|tiocmget
op_assign
id|ftdi_tiocmget
comma
dot
id|tiocmset
op_assign
id|ftdi_tiocmset
comma
dot
id|ioctl
op_assign
id|ftdi_ioctl
comma
dot
id|set_termios
op_assign
id|ftdi_set_termios
comma
dot
id|break_ctl
op_assign
id|ftdi_break_ctl
comma
dot
id|attach
op_assign
id|ftdi_8U232AM_startup
comma
dot
id|shutdown
op_assign
id|ftdi_shutdown
comma
)brace
suffix:semicolon
DECL|variable|ftdi_FT232BM_device
r_static
r_struct
id|usb_serial_device_type
id|ftdi_FT232BM_device
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;FTDI FT232BM Compatible&quot;
comma
dot
id|id_table
op_assign
id|id_table_FT232BM
comma
dot
id|num_interrupt_in
op_assign
l_int|0
comma
dot
id|num_bulk_in
op_assign
l_int|1
comma
dot
id|num_bulk_out
op_assign
l_int|1
comma
dot
id|num_ports
op_assign
l_int|1
comma
dot
id|open
op_assign
id|ftdi_open
comma
dot
id|close
op_assign
id|ftdi_close
comma
dot
id|throttle
op_assign
id|ftdi_throttle
comma
dot
id|unthrottle
op_assign
id|ftdi_unthrottle
comma
dot
id|write
op_assign
id|ftdi_write
comma
dot
id|write_room
op_assign
id|ftdi_write_room
comma
dot
id|chars_in_buffer
op_assign
id|ftdi_chars_in_buffer
comma
dot
id|read_bulk_callback
op_assign
id|ftdi_read_bulk_callback
comma
dot
id|write_bulk_callback
op_assign
id|ftdi_write_bulk_callback
comma
dot
id|tiocmget
op_assign
id|ftdi_tiocmget
comma
dot
id|tiocmset
op_assign
id|ftdi_tiocmset
comma
dot
id|ioctl
op_assign
id|ftdi_ioctl
comma
dot
id|set_termios
op_assign
id|ftdi_set_termios
comma
dot
id|break_ctl
op_assign
id|ftdi_break_ctl
comma
dot
id|attach
op_assign
id|ftdi_FT232BM_startup
comma
dot
id|shutdown
op_assign
id|ftdi_shutdown
comma
)brace
suffix:semicolon
DECL|variable|ftdi_USB_UIRT_device
r_static
r_struct
id|usb_serial_device_type
id|ftdi_USB_UIRT_device
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;USB-UIRT Infrared Tranceiver&quot;
comma
dot
id|id_table
op_assign
id|id_table_USB_UIRT
comma
dot
id|num_interrupt_in
op_assign
l_int|0
comma
dot
id|num_bulk_in
op_assign
l_int|1
comma
dot
id|num_bulk_out
op_assign
l_int|1
comma
dot
id|num_ports
op_assign
l_int|1
comma
dot
id|open
op_assign
id|ftdi_open
comma
dot
id|close
op_assign
id|ftdi_close
comma
dot
id|throttle
op_assign
id|ftdi_throttle
comma
dot
id|unthrottle
op_assign
id|ftdi_unthrottle
comma
dot
id|write
op_assign
id|ftdi_write
comma
dot
id|write_room
op_assign
id|ftdi_write_room
comma
dot
id|chars_in_buffer
op_assign
id|ftdi_chars_in_buffer
comma
dot
id|read_bulk_callback
op_assign
id|ftdi_read_bulk_callback
comma
dot
id|write_bulk_callback
op_assign
id|ftdi_write_bulk_callback
comma
dot
id|tiocmget
op_assign
id|ftdi_tiocmget
comma
dot
id|tiocmset
op_assign
id|ftdi_tiocmset
comma
dot
id|ioctl
op_assign
id|ftdi_ioctl
comma
dot
id|set_termios
op_assign
id|ftdi_set_termios
comma
dot
id|break_ctl
op_assign
id|ftdi_break_ctl
comma
dot
id|attach
op_assign
id|ftdi_USB_UIRT_startup
comma
dot
id|shutdown
op_assign
id|ftdi_shutdown
comma
)brace
suffix:semicolon
multiline_comment|/* The TIRA1 is based on a  FT232BM which requires a fixed baud rate of 100000&n; * and which requires RTS-CTS to be enabled. */
DECL|variable|ftdi_HE_TIRA1_device
r_static
r_struct
id|usb_serial_device_type
id|ftdi_HE_TIRA1_device
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;Home-Electronics TIRA-1 IR Transceiver&quot;
comma
dot
id|id_table
op_assign
id|id_table_HE_TIRA1
comma
dot
id|num_interrupt_in
op_assign
l_int|0
comma
dot
id|num_bulk_in
op_assign
l_int|1
comma
dot
id|num_bulk_out
op_assign
l_int|1
comma
dot
id|num_ports
op_assign
l_int|1
comma
dot
id|open
op_assign
id|ftdi_open
comma
dot
id|close
op_assign
id|ftdi_close
comma
dot
id|throttle
op_assign
id|ftdi_throttle
comma
dot
id|unthrottle
op_assign
id|ftdi_unthrottle
comma
dot
id|write
op_assign
id|ftdi_write
comma
dot
id|write_room
op_assign
id|ftdi_write_room
comma
dot
id|chars_in_buffer
op_assign
id|ftdi_chars_in_buffer
comma
dot
id|read_bulk_callback
op_assign
id|ftdi_read_bulk_callback
comma
dot
id|write_bulk_callback
op_assign
id|ftdi_write_bulk_callback
comma
dot
id|tiocmget
op_assign
id|ftdi_tiocmget
comma
dot
id|tiocmset
op_assign
id|ftdi_tiocmset
comma
dot
id|ioctl
op_assign
id|ftdi_ioctl
comma
dot
id|set_termios
op_assign
id|ftdi_set_termios
comma
dot
id|break_ctl
op_assign
id|ftdi_break_ctl
comma
dot
id|attach
op_assign
id|ftdi_HE_TIRA1_startup
comma
dot
id|shutdown
op_assign
id|ftdi_shutdown
comma
)brace
suffix:semicolon
DECL|macro|WDR_TIMEOUT
mdefine_line|#define WDR_TIMEOUT (HZ * 5 ) /* default urb timeout */
multiline_comment|/* High and low are for DTR, RTS etc etc */
DECL|macro|HIGH
mdefine_line|#define HIGH 1
DECL|macro|LOW
mdefine_line|#define LOW 0
multiline_comment|/*&n; * ***************************************************************************&n; * Utlity functions&n; * ***************************************************************************&n; */
DECL|function|ftdi_232am_baud_base_to_divisor
r_static
r_int
r_int
r_int
id|ftdi_232am_baud_base_to_divisor
c_func
(paren
r_int
id|baud
comma
r_int
id|base
)paren
(brace
r_int
r_int
r_int
id|divisor
suffix:semicolon
r_int
id|divisor3
op_assign
id|base
op_div
l_int|2
op_div
id|baud
suffix:semicolon
singleline_comment|// divisor shifted 3 bits to the left
r_if
c_cond
(paren
(paren
id|divisor3
op_amp
l_int|0x7
)paren
op_eq
l_int|7
)paren
id|divisor3
op_increment
suffix:semicolon
singleline_comment|// round x.7/8 up to x+1
id|divisor
op_assign
id|divisor3
op_rshift
l_int|3
suffix:semicolon
id|divisor3
op_and_assign
l_int|0x7
suffix:semicolon
r_if
c_cond
(paren
id|divisor3
op_eq
l_int|1
)paren
id|divisor
op_or_assign
l_int|0xc000
suffix:semicolon
r_else
singleline_comment|// 0.125
r_if
c_cond
(paren
id|divisor3
op_ge
l_int|4
)paren
id|divisor
op_or_assign
l_int|0x4000
suffix:semicolon
r_else
singleline_comment|// 0.5
r_if
c_cond
(paren
id|divisor3
op_ne
l_int|0
)paren
id|divisor
op_or_assign
l_int|0x8000
suffix:semicolon
singleline_comment|// 0.25
r_if
c_cond
(paren
id|divisor
op_eq
l_int|1
)paren
id|divisor
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* special case for maximum baud rate */
r_return
id|divisor
suffix:semicolon
)brace
DECL|function|ftdi_232am_baud_to_divisor
r_static
r_int
r_int
r_int
id|ftdi_232am_baud_to_divisor
c_func
(paren
r_int
id|baud
)paren
(brace
r_return
id|ftdi_232am_baud_base_to_divisor
c_func
(paren
id|baud
comma
l_int|48000000
)paren
suffix:semicolon
)brace
DECL|function|ftdi_232bm_baud_base_to_divisor
r_static
id|__u32
id|ftdi_232bm_baud_base_to_divisor
c_func
(paren
r_int
id|baud
comma
r_int
id|base
)paren
(brace
r_static
r_const
r_int
r_char
id|divfrac
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|3
comma
l_int|2
comma
l_int|4
comma
l_int|1
comma
l_int|5
comma
l_int|6
comma
l_int|7
)brace
suffix:semicolon
id|__u32
id|divisor
suffix:semicolon
r_int
id|divisor3
op_assign
id|base
op_div
l_int|2
op_div
id|baud
suffix:semicolon
singleline_comment|// divisor shifted 3 bits to the left
id|divisor
op_assign
id|divisor3
op_rshift
l_int|3
suffix:semicolon
id|divisor
op_or_assign
(paren
id|__u32
)paren
id|divfrac
(braket
id|divisor3
op_amp
l_int|0x7
)braket
op_lshift
l_int|14
suffix:semicolon
multiline_comment|/* Deal with special cases for highest baud rates. */
r_if
c_cond
(paren
id|divisor
op_eq
l_int|1
)paren
id|divisor
op_assign
l_int|0
suffix:semicolon
r_else
singleline_comment|// 1.0
r_if
c_cond
(paren
id|divisor
op_eq
l_int|0x4001
)paren
id|divisor
op_assign
l_int|1
suffix:semicolon
singleline_comment|// 1.5
r_return
id|divisor
suffix:semicolon
)brace
DECL|function|ftdi_232bm_baud_to_divisor
r_static
id|__u32
id|ftdi_232bm_baud_to_divisor
c_func
(paren
r_int
id|baud
)paren
(brace
r_return
id|ftdi_232bm_baud_base_to_divisor
c_func
(paren
id|baud
comma
l_int|48000000
)paren
suffix:semicolon
)brace
DECL|function|set_rts
r_static
r_int
id|set_rts
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|high_or_low
)paren
(brace
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|ftdi_high_or_low
suffix:semicolon
r_int
id|rv
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
l_int|1
comma
id|GFP_NOIO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|high_or_low
)paren
(brace
id|ftdi_high_or_low
op_assign
id|FTDI_SIO_SET_RTS_HIGH
suffix:semicolon
id|priv-&gt;last_dtr_rts
op_or_assign
id|TIOCM_RTS
suffix:semicolon
)brace
r_else
(brace
id|ftdi_high_or_low
op_assign
id|FTDI_SIO_SET_RTS_LOW
suffix:semicolon
id|priv-&gt;last_dtr_rts
op_and_assign
op_complement
id|TIOCM_RTS
suffix:semicolon
)brace
id|rv
op_assign
id|usb_control_msg
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_MODEM_CTRL_REQUEST
comma
id|FTDI_SIO_SET_MODEM_CTRL_REQUEST_TYPE
comma
id|ftdi_high_or_low
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|set_dtr
r_static
r_int
id|set_dtr
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|high_or_low
)paren
(brace
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|ftdi_high_or_low
suffix:semicolon
r_int
id|rv
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
l_int|1
comma
id|GFP_NOIO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|high_or_low
)paren
(brace
id|ftdi_high_or_low
op_assign
id|FTDI_SIO_SET_DTR_HIGH
suffix:semicolon
id|priv-&gt;last_dtr_rts
op_or_assign
id|TIOCM_DTR
suffix:semicolon
)brace
r_else
(brace
id|ftdi_high_or_low
op_assign
id|FTDI_SIO_SET_DTR_LOW
suffix:semicolon
id|priv-&gt;last_dtr_rts
op_and_assign
op_complement
id|TIOCM_DTR
suffix:semicolon
)brace
id|rv
op_assign
id|usb_control_msg
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_MODEM_CTRL_REQUEST
comma
id|FTDI_SIO_SET_MODEM_CTRL_REQUEST_TYPE
comma
id|ftdi_high_or_low
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
r_static
id|__u32
id|get_ftdi_divisor
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
suffix:semicolon
DECL|function|change_speed
r_static
r_int
id|change_speed
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
r_char
op_star
id|buf
suffix:semicolon
id|__u16
id|urb_value
suffix:semicolon
id|__u16
id|urb_index
suffix:semicolon
id|__u32
id|urb_index_value
suffix:semicolon
r_int
id|rv
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
l_int|1
comma
id|GFP_NOIO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|urb_index_value
op_assign
id|get_ftdi_divisor
c_func
(paren
id|port
)paren
suffix:semicolon
id|urb_value
op_assign
(paren
id|__u16
)paren
id|urb_index_value
suffix:semicolon
id|urb_index
op_assign
(paren
id|__u16
)paren
(paren
id|urb_index_value
op_rshift
l_int|16
)paren
suffix:semicolon
id|rv
op_assign
id|usb_control_msg
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|port-&gt;serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_BAUDRATE_REQUEST
comma
id|FTDI_SIO_SET_BAUDRATE_REQUEST_TYPE
comma
id|urb_value
comma
id|urb_index
comma
id|buf
comma
l_int|0
comma
l_int|100
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|get_ftdi_divisor
r_static
id|__u32
id|get_ftdi_divisor
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
multiline_comment|/* get_ftdi_divisor */
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
id|__u32
id|div_value
op_assign
l_int|0
suffix:semicolon
r_int
id|div_okay
op_assign
l_int|1
suffix:semicolon
r_char
op_star
id|chip_name
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_int
id|baud
suffix:semicolon
multiline_comment|/*&n;&t; * The logic involved in setting the baudrate can be cleanly split in 3 steps.&n;&t; * Obtaining the actual baud rate is a little tricky since unix traditionally&n;&t; * somehow ignored the possibility to set non-standard baud rates.&n;&t; * 1. Standard baud rates are set in tty-&gt;termios-&gt;c_cflag&n;&t; * 2. If these are not enough, you can set any speed using alt_speed as follows:&n;&t; *    - set tty-&gt;termios-&gt;c_cflag speed to B38400&n;&t; *    - set your real speed in tty-&gt;alt_speed; it gets ignored when&n;&t; *      alt_speed==0, (or)&n;&t; *    - call TIOCSSERIAL ioctl with (struct serial_struct) set as follows:&n;&t; *      flags &amp; ASYNC_SPD_MASK == ASYNC_SPD_[HI, VHI, SHI, WARP], this just&n;&t; *      sets alt_speed to (HI: 57600, VHI: 115200, SHI: 230400, WARP: 460800)&n;&t; * ** Steps 1, 2 are done courtesy of tty_get_baud_rate&n;&t; * 3. You can also set baud rate by setting custom divisor as follows&n;&t; *    - set tty-&gt;termios-&gt;c_cflag speed to B38400&n;&t; *    - call TIOCSSERIAL ioctl with (struct serial_struct) set as follows:&n;&t; *      o flags &amp; ASYNC_SPD_MASK == ASYNC_SPD_CUST&n;&t; *      o custom_divisor set to baud_base / your_new_baudrate&n;&t; * ** Step 3 is done courtesy of code borrowed from serial.c - I should really&n;&t; *    spend some time and separate+move this common code to serial.c, it is&n;&t; *    replicated in nearly every serial driver you see.&n;&t; */
multiline_comment|/* 1. Get the baud rate from the tty settings, this observes alt_speed hack */
id|baud
op_assign
id|tty_get_baud_rate
c_func
(paren
id|port-&gt;tty
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s - tty_get_baud_rate reports speed %d&quot;
comma
id|__FUNCTION__
comma
id|baud
)paren
suffix:semicolon
multiline_comment|/* 2. Observe async-compatible custom_divisor hack, update baudrate if needed */
r_if
c_cond
(paren
id|baud
op_eq
l_int|38400
op_logical_and
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_CUST
)paren
op_logical_and
(paren
id|priv-&gt;custom_divisor
)paren
)paren
(brace
id|baud
op_assign
id|priv-&gt;baud_base
op_div
id|priv-&gt;custom_divisor
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s - custom divisor %d sets baud rate to %d&quot;
comma
id|__FUNCTION__
comma
id|priv-&gt;custom_divisor
comma
id|baud
)paren
suffix:semicolon
)brace
multiline_comment|/* 3. Convert baudrate to device-specific divisor */
r_if
c_cond
(paren
op_logical_neg
id|baud
)paren
id|baud
op_assign
l_int|9600
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;chip_type
)paren
(brace
r_case
id|SIO
suffix:colon
multiline_comment|/* SIO chip */
id|chip_name
op_assign
l_string|&quot;SIO&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|baud
)paren
(brace
r_case
l_int|300
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b300
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|600
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1200
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b1200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2400
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b2400
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4800
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b4800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9600
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b9600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|19200
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b19200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|38400
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b38400
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|57600
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b57600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|115200
suffix:colon
id|div_value
op_assign
id|ftdi_sio_b115200
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* baud */
r_if
c_cond
(paren
id|div_value
op_eq
l_int|0
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - Baudrate (%d) requested is not supported&quot;
comma
id|__FUNCTION__
comma
id|baud
)paren
suffix:semicolon
id|div_value
op_assign
id|ftdi_sio_b9600
suffix:semicolon
id|div_okay
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FT8U232AM
suffix:colon
multiline_comment|/* 8U232AM chip */
id|chip_name
op_assign
l_string|&quot;FT8U232AM&quot;
suffix:semicolon
r_if
c_cond
(paren
id|baud
op_le
l_int|3000000
)paren
(brace
id|div_value
op_assign
id|ftdi_232am_baud_to_divisor
c_func
(paren
id|baud
)paren
suffix:semicolon
)brace
r_else
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - Baud rate too high!&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|div_value
op_assign
id|ftdi_232am_baud_to_divisor
c_func
(paren
l_int|9600
)paren
suffix:semicolon
id|div_okay
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FT232BM
suffix:colon
multiline_comment|/* FT232BM chip */
id|chip_name
op_assign
l_string|&quot;FT232BM&quot;
suffix:semicolon
r_if
c_cond
(paren
id|baud
op_le
l_int|3000000
)paren
(brace
id|div_value
op_assign
id|ftdi_232bm_baud_to_divisor
c_func
(paren
id|baud
)paren
suffix:semicolon
)brace
r_else
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - Baud rate too high!&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|div_value
op_assign
id|ftdi_232bm_baud_to_divisor
c_func
(paren
l_int|9600
)paren
suffix:semicolon
id|div_okay
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* priv-&gt;chip_type */
r_if
c_cond
(paren
id|div_okay
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - Baud rate set to %d (divisor 0x%lX) on chip %s&quot;
comma
id|__FUNCTION__
comma
id|baud
comma
(paren
r_int
r_int
)paren
id|div_value
comma
id|chip_name
)paren
suffix:semicolon
)brace
r_return
id|div_value
suffix:semicolon
)brace
DECL|function|get_serial_info
r_static
r_int
id|get_serial_info
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|retinfo
)paren
(brace
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_struct
id|serial_struct
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retinfo
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|tmp
comma
l_int|0
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|tmp.flags
op_assign
id|priv-&gt;flags
suffix:semicolon
id|tmp.baud_base
op_assign
id|priv-&gt;baud_base
suffix:semicolon
id|tmp.custom_divisor
op_assign
id|priv-&gt;custom_divisor
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|retinfo
comma
op_amp
id|tmp
comma
r_sizeof
(paren
op_star
id|retinfo
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get_serial_info */
DECL|function|set_serial_info
r_static
r_int
id|set_serial_info
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|newinfo
)paren
(brace
multiline_comment|/* set_serial_info */
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_struct
id|serial_struct
id|new_serial
suffix:semicolon
r_struct
id|ftdi_private
id|old_priv
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|new_serial
comma
id|newinfo
comma
r_sizeof
(paren
id|new_serial
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|old_priv
op_assign
op_star
id|priv
suffix:semicolon
multiline_comment|/* Do error checking and permission checking */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|new_serial.flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
op_ne
(paren
id|priv-&gt;flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|priv-&gt;flags
op_assign
(paren
(paren
id|priv-&gt;flags
op_amp
op_complement
id|ASYNC_USR_MASK
)paren
op_or
(paren
id|new_serial.flags
op_amp
id|ASYNC_USR_MASK
)paren
)paren
suffix:semicolon
id|priv-&gt;custom_divisor
op_assign
id|new_serial.custom_divisor
suffix:semicolon
r_goto
id|check_and_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|new_serial.baud_base
op_ne
id|priv-&gt;baud_base
)paren
op_logical_or
(paren
id|new_serial.baud_base
OL
l_int|9600
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Make the changes - these are privileged changes! */
id|priv-&gt;flags
op_assign
(paren
(paren
id|priv-&gt;flags
op_amp
op_complement
id|ASYNC_FLAGS
)paren
op_or
(paren
id|new_serial.flags
op_amp
id|ASYNC_FLAGS
)paren
)paren
suffix:semicolon
id|priv-&gt;custom_divisor
op_assign
id|new_serial.custom_divisor
suffix:semicolon
id|port-&gt;tty-&gt;low_latency
op_assign
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_LOW_LATENCY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|check_and_exit
suffix:colon
r_if
c_cond
(paren
(paren
id|old_priv.flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_ne
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_HI
)paren
id|port-&gt;tty-&gt;alt_speed
op_assign
l_int|57600
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_VHI
)paren
id|port-&gt;tty-&gt;alt_speed
op_assign
l_int|115200
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_SHI
)paren
id|port-&gt;tty-&gt;alt_speed
op_assign
l_int|230400
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_WARP
)paren
id|port-&gt;tty-&gt;alt_speed
op_assign
l_int|460800
suffix:semicolon
r_else
id|port-&gt;tty-&gt;alt_speed
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|old_priv.flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_ne
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
)paren
op_logical_or
(paren
(paren
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_SPD_MASK
)paren
op_eq
id|ASYNC_SPD_CUST
)paren
op_logical_and
(paren
id|old_priv.custom_divisor
op_ne
id|priv-&gt;custom_divisor
)paren
)paren
)paren
(brace
id|change_speed
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* set_serial_info */
multiline_comment|/*&n; * ***************************************************************************&n; * FTDI driver specific functions&n; * ***************************************************************************&n; */
multiline_comment|/* Common startup subroutine */
multiline_comment|/* Called from ftdi_SIO_startup, etc. */
DECL|function|ftdi_common_startup
r_static
r_int
id|ftdi_common_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
r_struct
id|usb_serial_port
op_star
id|port
op_assign
id|serial-&gt;port
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ftdi_private
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s- kmalloc(%Zd) failed.&quot;
comma
id|__FUNCTION__
comma
r_sizeof
(paren
r_struct
id|ftdi_private
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|priv
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|priv
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|priv-&gt;delta_msr_wait
)paren
suffix:semicolon
multiline_comment|/* This will push the characters through immediately rather&n;&t;   than queue a task to deliver them */
id|priv-&gt;flags
op_assign
id|ASYNC_LOW_LATENCY
suffix:semicolon
multiline_comment|/* Increase the size of read buffers */
r_if
c_cond
(paren
id|port-&gt;bulk_in_buffer
)paren
(brace
id|kfree
(paren
id|port-&gt;bulk_in_buffer
)paren
suffix:semicolon
)brace
id|port-&gt;bulk_in_buffer
op_assign
id|kmalloc
(paren
id|BUFSZ
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;bulk_in_buffer
)paren
(brace
id|kfree
(paren
id|priv
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;read_urb
)paren
(brace
id|port-&gt;read_urb-&gt;transfer_buffer
op_assign
id|port-&gt;bulk_in_buffer
suffix:semicolon
id|port-&gt;read_urb-&gt;transfer_buffer_length
op_assign
id|BUFSZ
suffix:semicolon
)brace
multiline_comment|/* Free port&squot;s existing write urb and transfer buffer. */
r_if
c_cond
(paren
id|port-&gt;write_urb
)paren
(brace
id|usb_free_urb
(paren
id|port-&gt;write_urb
)paren
suffix:semicolon
id|port-&gt;write_urb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;bulk_out_buffer
)paren
(brace
id|kfree
(paren
id|port-&gt;bulk_out_buffer
)paren
suffix:semicolon
id|port-&gt;bulk_out_buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
id|usb_set_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
comma
id|priv
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Startup for the SIO chip */
multiline_comment|/* Called from usbserial:serial_probe */
DECL|function|ftdi_SIO_startup
r_static
r_int
id|ftdi_SIO_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
id|ftdi_common_startup
c_func
(paren
id|serial
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|priv-&gt;chip_type
op_assign
id|SIO
suffix:semicolon
id|priv-&gt;baud_base
op_assign
l_int|12000000
op_div
l_int|16
suffix:semicolon
id|priv-&gt;write_offset
op_assign
l_int|1
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Startup for the 8U232AM chip */
multiline_comment|/* Called from usbserial:serial_probe */
DECL|function|ftdi_8U232AM_startup
r_static
r_int
id|ftdi_8U232AM_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
multiline_comment|/* ftdi_8U232AM_startup */
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
id|ftdi_common_startup
c_func
(paren
id|serial
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|priv-&gt;chip_type
op_assign
id|FT8U232AM
suffix:semicolon
id|priv-&gt;baud_base
op_assign
l_int|48000000
op_div
l_int|2
suffix:semicolon
multiline_comment|/* Would be / 16, but FTDI supports 0.125, 0.25 and 0.5 divisor fractions! */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ftdi_8U232AM_startup */
multiline_comment|/* Startup for the FT232BM chip */
multiline_comment|/* Called from usbserial:serial_probe */
DECL|function|ftdi_FT232BM_startup
r_static
r_int
id|ftdi_FT232BM_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
multiline_comment|/* ftdi_FT232BM_startup */
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
id|ftdi_common_startup
c_func
(paren
id|serial
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|priv-&gt;chip_type
op_assign
id|FT232BM
suffix:semicolon
id|priv-&gt;baud_base
op_assign
l_int|48000000
op_div
l_int|2
suffix:semicolon
multiline_comment|/* Would be / 16, but FT232BM supports multiple of 0.125 divisor fractions! */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ftdi_FT232BM_startup */
multiline_comment|/* Startup for the USB-UIRT device, which requires hardwired baudrate (38400 gets mapped to 312500) */
multiline_comment|/* Called from usbserial:serial_probe */
DECL|function|ftdi_USB_UIRT_startup
r_static
r_int
id|ftdi_USB_UIRT_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
multiline_comment|/* ftdi_USB_UIRT_startup */
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
id|ftdi_8U232AM_startup
c_func
(paren
id|serial
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|priv-&gt;flags
op_or_assign
id|ASYNC_SPD_CUST
suffix:semicolon
id|priv-&gt;custom_divisor
op_assign
l_int|77
suffix:semicolon
id|priv-&gt;force_baud
op_assign
id|B38400
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ftdi_USB_UIRT_startup */
multiline_comment|/* Startup for the HE-TIRA1 device, which requires hardwired&n; * baudrate (38400 gets mapped to 100000) */
DECL|function|ftdi_HE_TIRA1_startup
r_static
r_int
id|ftdi_HE_TIRA1_startup
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
multiline_comment|/* ftdi_HE_TIRA1_startup */
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
id|ftdi_FT232BM_startup
c_func
(paren
id|serial
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|serial-&gt;port
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|priv-&gt;flags
op_or_assign
id|ASYNC_SPD_CUST
suffix:semicolon
id|priv-&gt;custom_divisor
op_assign
l_int|240
suffix:semicolon
id|priv-&gt;force_baud
op_assign
id|B38400
suffix:semicolon
id|priv-&gt;force_rtscts
op_assign
l_int|1
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ftdi_HE_TIRA1_startup */
multiline_comment|/* ftdi_shutdown is called from usbserial:usb_serial_disconnect &n; *   it is called when the usb device is disconnected&n; *&n; *   usbserial:usb_serial_disconnect&n; *      calls __serial_close for each open of the port&n; *      shutdown is called then (ie ftdi_shutdown)&n; */
DECL|function|ftdi_shutdown
r_static
r_void
id|ftdi_shutdown
(paren
r_struct
id|usb_serial
op_star
id|serial
)paren
(brace
multiline_comment|/* ftdi_shutdown */
r_struct
id|usb_serial_port
op_star
id|port
op_assign
id|serial-&gt;port
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* all open ports are closed at this point &n;         *    (by usbserial.c:__serial_close, which calls ftdi_close)  &n;&t; */
r_if
c_cond
(paren
id|priv
)paren
(brace
id|kfree
c_func
(paren
id|priv
)paren
suffix:semicolon
id|usb_set_serial_port_data
c_func
(paren
id|port
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ftdi_shutdown */
DECL|function|ftdi_open
r_static
r_int
id|ftdi_open
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
multiline_comment|/* ftdi_open */
r_struct
id|termios
id|tmp_termios
suffix:semicolon
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|port-&gt;serial
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_char
id|buf
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Needed for the usb_control_msg I think */
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|port-&gt;tty-&gt;low_latency
op_assign
(paren
id|priv-&gt;flags
op_amp
id|ASYNC_LOW_LATENCY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* No error checking for this (will get errors later anyway) */
multiline_comment|/* See ftdi_sio.h for description of what is reset */
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_RESET_REQUEST
comma
id|FTDI_SIO_RESET_REQUEST_TYPE
comma
id|FTDI_SIO_RESET_SIO
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
suffix:semicolon
multiline_comment|/* Termios defaults are set by usb_serial_init. We don&squot;t change&n;&t;   port-&gt;tty-&gt;termios - this would loose speed settings, etc.&n;&t;   This is same behaviour as serial.c/rs_open() - Kuba */
multiline_comment|/* ftdi_set_termios  will send usb control messages */
id|ftdi_set_termios
c_func
(paren
id|port
comma
op_amp
id|tmp_termios
)paren
suffix:semicolon
multiline_comment|/* FIXME: Flow control might be enabled, so it should be checked -&n;&t;   we have no control of defaults! */
multiline_comment|/* Turn on RTS and DTR since we are not flow controlling by default */
r_if
c_cond
(paren
id|set_dtr
c_func
(paren
id|port
comma
id|HIGH
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Error from DTR HIGH urb&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set_rts
c_func
(paren
id|port
comma
id|HIGH
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Error from RTS HIGH urb&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
multiline_comment|/* Start reading from the device */
id|usb_fill_bulk_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|serial-&gt;dev
comma
id|usb_rcvbulkpipe
c_func
(paren
id|serial-&gt;dev
comma
id|port-&gt;bulk_in_endpointAddress
)paren
comma
id|port-&gt;read_urb-&gt;transfer_buffer
comma
id|port-&gt;read_urb-&gt;transfer_buffer_length
comma
id|ftdi_read_bulk_callback
comma
id|port
)paren
suffix:semicolon
id|result
op_assign
id|usb_submit_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|err
c_func
(paren
l_string|&quot;%s - failed submitting read urb, error %d&quot;
comma
id|__FUNCTION__
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* ftdi_open */
multiline_comment|/* &n; * usbserial:__serial_close  only calls ftdi_close if the point is open&n; *&n; *   This only gets called when it is the last close&n; *   &n; *   &n; */
DECL|function|ftdi_close
r_static
r_void
id|ftdi_close
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
multiline_comment|/* ftdi_close */
r_struct
id|usb_serial
op_star
id|serial
suffix:semicolon
r_int
r_int
id|c_cflag
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_cflag
suffix:semicolon
r_char
id|buf
(braket
l_int|1
)braket
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|serial
op_assign
id|get_usb_serial
(paren
id|port
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|serial
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|serial-&gt;dev
)paren
(brace
r_if
c_cond
(paren
id|c_cflag
op_amp
id|HUPCL
)paren
(brace
multiline_comment|/* Disable flow control */
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST_TYPE
comma
l_int|0
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;error from flowcontrol urb&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* drop DTR */
r_if
c_cond
(paren
id|set_dtr
c_func
(paren
id|port
comma
id|LOW
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Error from DTR LOW urb&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* drop RTS */
r_if
c_cond
(paren
id|set_rts
c_func
(paren
id|port
comma
id|LOW
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Error from RTS LOW urb&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Note change no line if hupcl is off */
multiline_comment|/* shutdown our bulk read */
r_if
c_cond
(paren
id|port-&gt;read_urb
)paren
(brace
r_if
c_cond
(paren
id|usb_unlink_urb
(paren
id|port-&gt;read_urb
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Error unlinking read urb&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* if (serial-&gt;dev) */
)brace
multiline_comment|/* ftdi_close */
multiline_comment|/* The SIO requires the first byte to have:&n; *  B0 1&n; *  B1 0&n; *  B2..7 length of message excluding byte 0&n; *&n; * The new devices do not require this byte&n; */
DECL|function|ftdi_write
r_static
r_int
id|ftdi_write
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
multiline_comment|/* ftdi_write */
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|get_usb_serial
(paren
id|port
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
r_int
id|data_offset
suffix:semicolon
multiline_comment|/* will be 1 for the SIO and 0 otherwise */
r_int
id|status
suffix:semicolon
r_int
id|transfer_size
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s port %d, %d bytes&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;write request of 0 bytes&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|data_offset
op_assign
id|priv-&gt;write_offset
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;data_offset set to %d&quot;
comma
id|data_offset
)paren
suffix:semicolon
multiline_comment|/* Determine total transfer size */
id|transfer_size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|data_offset
OG
l_int|0
)paren
(brace
multiline_comment|/* Original sio needs control bytes too... */
id|transfer_size
op_add_assign
(paren
id|data_offset
op_star
(paren
(paren
id|count
op_plus
(paren
id|PKTSZ
op_minus
l_int|1
op_minus
id|data_offset
)paren
)paren
op_div
(paren
id|PKTSZ
op_minus
id|data_offset
)paren
)paren
)paren
suffix:semicolon
)brace
id|buffer
op_assign
id|kmalloc
(paren
id|transfer_size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s ran out of kernel memory for urb ...&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s - no more free urbs&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|kfree
(paren
id|buffer
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Copy data */
r_if
c_cond
(paren
id|data_offset
OG
l_int|0
)paren
(brace
multiline_comment|/* Original sio requires control byte at start of each packet. */
r_int
id|user_pktsz
op_assign
id|PKTSZ
op_minus
id|data_offset
suffix:semicolon
r_int
id|todo
op_assign
id|count
suffix:semicolon
r_int
r_char
op_star
id|first_byte
op_assign
id|buffer
suffix:semicolon
r_const
r_int
r_char
op_star
id|current_position
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|user_pktsz
OG
id|todo
)paren
(brace
id|user_pktsz
op_assign
id|todo
suffix:semicolon
)brace
multiline_comment|/* Write the control byte at the front of the packet*/
op_star
id|first_byte
op_assign
l_int|1
op_or
(paren
(paren
id|user_pktsz
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Copy data for packet */
r_if
c_cond
(paren
id|from_user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
id|first_byte
op_plus
id|data_offset
comma
id|current_position
comma
id|user_pktsz
)paren
)paren
(brace
id|kfree
(paren
id|buffer
)paren
suffix:semicolon
id|usb_free_urb
(paren
id|urb
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
(brace
id|memcpy
(paren
id|first_byte
op_plus
id|data_offset
comma
id|current_position
comma
id|user_pktsz
)paren
suffix:semicolon
)brace
id|first_byte
op_add_assign
id|user_pktsz
op_plus
id|data_offset
suffix:semicolon
id|current_position
op_add_assign
id|user_pktsz
suffix:semicolon
id|todo
op_sub_assign
id|user_pktsz
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* No control byte required. */
multiline_comment|/* Copy in the data to send */
r_if
c_cond
(paren
id|from_user
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
(paren
id|buffer
comma
id|buf
comma
id|count
)paren
)paren
(brace
id|kfree
(paren
id|buffer
)paren
suffix:semicolon
id|usb_free_urb
(paren
id|urb
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
(brace
id|memcpy
(paren
id|buffer
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
)brace
id|usb_serial_debug_data
(paren
id|__FILE__
comma
id|__FUNCTION__
comma
id|transfer_size
comma
id|buffer
)paren
suffix:semicolon
multiline_comment|/* fill the buffer and send it */
id|usb_fill_bulk_urb
c_func
(paren
id|urb
comma
id|serial-&gt;dev
comma
id|usb_sndbulkpipe
c_func
(paren
id|serial-&gt;dev
comma
id|port-&gt;bulk_out_endpointAddress
)paren
comma
id|buffer
comma
id|transfer_size
comma
id|ftdi_write_bulk_callback
comma
id|port
)paren
suffix:semicolon
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s - failed submitting write urb, error %d&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
id|count
op_assign
id|status
suffix:semicolon
)brace
multiline_comment|/* we are done with this urb, so let the host driver&n;&t; * really free it when it is finished with it */
id|usb_free_urb
(paren
id|urb
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s write returning: %d&quot;
comma
id|__FUNCTION__
comma
id|count
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* ftdi_write */
multiline_comment|/* This function may get called when the device is closed */
DECL|function|ftdi_write_bulk_callback
r_static
r_void
id|ftdi_write_bulk_callback
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|usb_serial_port
op_star
id|port
op_assign
(paren
r_struct
id|usb_serial_port
op_star
)paren
id|urb-&gt;context
suffix:semicolon
multiline_comment|/* free up the transfer buffer, as usb_free_urb() does not do this */
id|kfree
(paren
id|urb-&gt;transfer_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port_paranoia_check
(paren
id|port
comma
id|__FUNCTION__
)paren
)paren
r_return
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s - port %d&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;nonzero write bulk status received: %d&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|schedule_work
c_func
(paren
op_amp
id|port-&gt;work
)paren
suffix:semicolon
)brace
multiline_comment|/* ftdi_write_bulk_callback */
DECL|function|ftdi_write_room
r_static
r_int
id|ftdi_write_room
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - port %d&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We really can take anything the user throws at us&n;&t; * but let&squot;s pick a nice big number to tell the tty&n;&t; * layer that we have lots of free space&n;&t; */
r_return
l_int|2048
suffix:semicolon
)brace
multiline_comment|/* ftdi_write_room */
DECL|function|ftdi_chars_in_buffer
r_static
r_int
id|ftdi_chars_in_buffer
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
multiline_comment|/* ftdi_chars_in_buffer */
id|dbg
c_func
(paren
l_string|&quot;%s - port %d&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * We can&squot;t really account for how much data we&n;&t; * have sent out, but hasn&squot;t made it through to the&n;&t; * device, so just tell the tty layer that everything&n;&t; * is flushed.&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ftdi_chars_in_buffer */
DECL|function|ftdi_read_bulk_callback
r_static
r_void
id|ftdi_read_bulk_callback
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* ftdi_read_bulk_callback */
r_struct
id|usb_serial_port
op_star
id|port
op_assign
(paren
r_struct
id|usb_serial_port
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|usb_serial
op_star
id|serial
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
suffix:semicolon
r_char
id|error_flag
suffix:semicolon
r_int
r_char
op_star
id|data
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
id|need_flip
suffix:semicolon
r_int
id|packet_offset
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;number_of_packets
OG
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s transfer_buffer_length %d actual_length %d number of packets %d&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;transfer_buffer_length
comma
id|urb-&gt;actual_length
comma
id|urb-&gt;number_of_packets
)paren
suffix:semicolon
id|err
c_func
(paren
l_string|&quot;%s transfer_flags %x &quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;transfer_flags
)paren
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port_paranoia_check
(paren
id|port
comma
id|__FUNCTION__
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port-&gt;open_count
op_le
l_int|0
)paren
r_return
suffix:semicolon
id|serial
op_assign
id|get_usb_serial
c_func
(paren
id|port
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|serial
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - bad serial pointer - exiting&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tty
op_assign
id|port-&gt;tty
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - bad tty pointer - exiting&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
multiline_comment|/* This will happen at close every time so it is a dbg not an err */
id|dbg
c_func
(paren
l_string|&quot;(this is ok on close) nonzero read bulk status received: %d&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* The first two bytes of every read packet are status */
r_if
c_cond
(paren
id|urb-&gt;actual_length
OG
l_int|2
)paren
(brace
id|usb_serial_debug_data
(paren
id|__FILE__
comma
id|__FUNCTION__
comma
id|urb-&gt;actual_length
comma
id|data
)paren
suffix:semicolon
)brace
r_else
(brace
id|dbg
c_func
(paren
l_string|&quot;Status only: %03oo %03oo&quot;
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* TO DO -- check for hung up line and handle appropriately: */
multiline_comment|/*   send hangup  */
multiline_comment|/* See acm.c - you do a tty_hangup  - eg tty_hangup(tty) */
multiline_comment|/* if CD is dropped and the line is not CLOCAL then we should hangup */
id|need_flip
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|packet_offset
op_assign
l_int|0
suffix:semicolon
id|packet_offset
OL
id|urb-&gt;actual_length
suffix:semicolon
id|packet_offset
op_add_assign
id|PKTSZ
)paren
(brace
multiline_comment|/* Compare new line status to the old one, signal if different */
r_if
c_cond
(paren
id|priv
op_ne
l_int|NULL
)paren
(brace
r_char
id|new_status
op_assign
id|data
(braket
id|packet_offset
op_plus
l_int|0
)braket
op_amp
id|FTDI_STATUS_B0_MASK
suffix:semicolon
r_if
c_cond
(paren
id|new_status
op_ne
id|priv-&gt;prev_status
)paren
(brace
id|priv-&gt;diff_status
op_or_assign
id|new_status
op_xor
id|priv-&gt;prev_status
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|priv-&gt;delta_msr_wait
)paren
suffix:semicolon
id|priv-&gt;prev_status
op_assign
id|new_status
suffix:semicolon
)brace
)brace
multiline_comment|/* Handle errors and break */
id|error_flag
op_assign
id|TTY_NORMAL
suffix:semicolon
multiline_comment|/* Although the device uses a bitmask and hence can have multiple */
multiline_comment|/* errors on a packet - the order here sets the priority the */
multiline_comment|/* error is returned to the tty layer  */
r_if
c_cond
(paren
id|data
(braket
id|packet_offset
op_plus
l_int|1
)braket
op_amp
id|FTDI_RS_OE
)paren
(brace
id|error_flag
op_assign
id|TTY_OVERRUN
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;OVERRRUN error&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
id|packet_offset
op_plus
l_int|1
)braket
op_amp
id|FTDI_RS_BI
)paren
(brace
id|error_flag
op_assign
id|TTY_BREAK
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;BREAK received&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
id|packet_offset
op_plus
l_int|1
)braket
op_amp
id|FTDI_RS_PE
)paren
(brace
id|error_flag
op_assign
id|TTY_PARITY
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;PARITY error&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
id|packet_offset
op_plus
l_int|1
)braket
op_amp
id|FTDI_RS_FE
)paren
(brace
id|error_flag
op_assign
id|TTY_FRAME
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;FRAMING error&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|urb-&gt;actual_length
OG
id|packet_offset
op_plus
l_int|2
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
(paren
id|i
OL
id|PKTSZ
)paren
op_logical_and
(paren
(paren
id|i
op_plus
id|packet_offset
)paren
OL
id|urb-&gt;actual_length
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* have to make sure we don&squot;t overflow the buffer&n;&t;&t;&t;&t;  with tty_insert_flip_char&squot;s */
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
(brace
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
multiline_comment|/* Note that the error flag is duplicated for &n;&t;&t;&t;&t;   every character received since we don&squot;t know&n;&t;&t;&t;&t;   which character it applied to */
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
id|data
(braket
id|packet_offset
op_plus
id|i
)braket
comma
id|error_flag
)paren
suffix:semicolon
)brace
id|need_flip
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef NOT_CORRECT_BUT_KEEPING_IT_FOR_NOW
multiline_comment|/* if a parity error is detected you get status packets forever&n;&t;&t;   until a character is sent without a parity error.&n;&t;&t;   This doesn&squot;t work well since the application receives a never&n;&t;&t;   ending stream of bad data - even though new data hasn&squot;t been sent.&n;&t;&t;   Therefore I (bill) have taken this out.&n;&t;&t;   However - this might make sense for framing errors and so on &n;&t;&t;   so I am leaving the code in for now.&n;&t;&t;*/
r_else
(brace
r_if
c_cond
(paren
id|error_flag
op_ne
id|TTY_NORMAL
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;error_flag is not normal&quot;
)paren
suffix:semicolon
multiline_comment|/* In this case it is just status - if that is an error send a bad character */
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
(brace
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
l_int|0xff
comma
id|error_flag
)paren
suffix:semicolon
id|need_flip
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
multiline_comment|/* &quot;for(packet_offset=0...&quot; */
multiline_comment|/* Low latency */
r_if
c_cond
(paren
id|need_flip
)paren
(brace
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
multiline_comment|/* if the port is closed stop trying to read */
r_if
c_cond
(paren
id|port-&gt;open_count
OG
l_int|0
)paren
(brace
multiline_comment|/* Continue trying to always read  */
id|usb_fill_bulk_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|serial-&gt;dev
comma
id|usb_rcvbulkpipe
c_func
(paren
id|serial-&gt;dev
comma
id|port-&gt;bulk_in_endpointAddress
)paren
comma
id|port-&gt;read_urb-&gt;transfer_buffer
comma
id|port-&gt;read_urb-&gt;transfer_buffer_length
comma
id|ftdi_read_bulk_callback
comma
id|port
)paren
suffix:semicolon
id|result
op_assign
id|usb_submit_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|err
c_func
(paren
l_string|&quot;%s - failed resubmitting read urb, error %d&quot;
comma
id|__FUNCTION__
comma
id|result
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* ftdi_read_bulk_callback */
DECL|function|ftdi_break_ctl
r_static
r_void
id|ftdi_break_ctl
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_int
id|break_state
)paren
(brace
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|port-&gt;serial
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
id|__u16
id|urb_value
op_assign
l_int|0
suffix:semicolon
r_char
id|buf
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* break_state = -1 to turn on break, and 0 to turn off break */
multiline_comment|/* see drivers/char/tty_io.c to see it used */
multiline_comment|/* last_set_data_urb_value NEVER has the break bit set in it */
r_if
c_cond
(paren
id|break_state
)paren
(brace
id|urb_value
op_assign
id|priv-&gt;last_set_data_urb_value
op_or
id|FTDI_SIO_SET_BREAK
suffix:semicolon
)brace
r_else
(brace
id|urb_value
op_assign
id|priv-&gt;last_set_data_urb_value
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_DATA_REQUEST
comma
id|FTDI_SIO_SET_DATA_REQUEST_TYPE
comma
id|urb_value
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s FAILED to enable/disable break state (state was %d)&quot;
comma
id|__FUNCTION__
comma
id|break_state
)paren
suffix:semicolon
)brace
id|dbg
c_func
(paren
l_string|&quot;%s break state is %d - urb is %d&quot;
comma
id|__FUNCTION__
comma
id|break_state
comma
id|urb_value
)paren
suffix:semicolon
)brace
multiline_comment|/* old_termios contains the original termios settings and tty-&gt;termios contains&n; * the new setting to be used&n; * WARNING: set_termios calls this with old_termios in kernel space&n; */
DECL|function|ftdi_set_termios
r_static
r_void
id|ftdi_set_termios
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
multiline_comment|/* ftdi_termios */
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|port-&gt;serial
suffix:semicolon
r_int
r_int
id|cflag
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_cflag
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
id|__u16
id|urb_value
suffix:semicolon
multiline_comment|/* will hold the new flags */
r_char
id|buf
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Perhaps I should dynamically alloc this? */
singleline_comment|// Added for xon/xoff support
r_int
r_int
id|iflag
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_iflag
suffix:semicolon
r_int
r_char
id|vstop
suffix:semicolon
r_int
r_char
id|vstart
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* Force baud rate if this device requires it, unless it is set to B0. */
r_if
c_cond
(paren
id|priv-&gt;force_baud
op_logical_and
(paren
(paren
id|port-&gt;tty-&gt;termios-&gt;c_cflag
op_amp
id|CBAUD
)paren
op_ne
id|B0
)paren
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: forcing baud rate for this device&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|port-&gt;tty-&gt;termios-&gt;c_cflag
op_and_assign
op_complement
id|CBAUD
suffix:semicolon
id|port-&gt;tty-&gt;termios-&gt;c_cflag
op_or_assign
id|priv-&gt;force_baud
suffix:semicolon
)brace
multiline_comment|/* Force RTS-CTS if this device requires it. */
r_if
c_cond
(paren
id|priv-&gt;force_rtscts
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s: forcing rtscts for this device&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|port-&gt;tty-&gt;termios-&gt;c_cflag
op_or_assign
id|CRTSCTS
suffix:semicolon
)brace
id|cflag
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_cflag
suffix:semicolon
multiline_comment|/* FIXME -For this cut I don&squot;t care if the line is really changing or &n;&t;   not  - so just do the change regardless  - should be able to &n;&t;   compare old_termios and tty-&gt;termios */
multiline_comment|/* NOTE These routines can get interrupted by &n;&t;   ftdi_sio_read_bulk_callback  - need to examine what this &n;           means - don&squot;t see any problems yet */
multiline_comment|/* Set number of data bits, parity, stop bits */
id|urb_value
op_assign
l_int|0
suffix:semicolon
id|urb_value
op_or_assign
(paren
id|cflag
op_amp
id|CSTOPB
ques
c_cond
id|FTDI_SIO_SET_DATA_STOP_BITS_2
suffix:colon
id|FTDI_SIO_SET_DATA_STOP_BITS_1
)paren
suffix:semicolon
id|urb_value
op_or_assign
(paren
id|cflag
op_amp
id|PARENB
ques
c_cond
(paren
id|cflag
op_amp
id|PARODD
ques
c_cond
id|FTDI_SIO_SET_DATA_PARITY_ODD
suffix:colon
id|FTDI_SIO_SET_DATA_PARITY_EVEN
)paren
suffix:colon
id|FTDI_SIO_SET_DATA_PARITY_NONE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CSIZE
)paren
(brace
r_switch
c_cond
(paren
id|cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
id|urb_value
op_or_assign
l_int|5
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Setting CS5&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|urb_value
op_or_assign
l_int|6
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Setting CS6&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|urb_value
op_or_assign
l_int|7
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Setting CS7&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
id|urb_value
op_or_assign
l_int|8
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;Setting CS8&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;CSIZE was set but not CS5-CS8&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* This is needed by the break command since it uses the same command - but is&n;&t; *  or&squot;ed with this value  */
id|priv-&gt;last_set_data_urb_value
op_assign
id|urb_value
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_DATA_REQUEST
comma
id|FTDI_SIO_SET_DATA_REQUEST_TYPE
comma
id|urb_value
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
l_int|100
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s FAILED to set databits/stopbits/parity&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
multiline_comment|/* Now do the baudrate */
r_if
c_cond
(paren
(paren
id|cflag
op_amp
id|CBAUD
)paren
op_eq
id|B0
)paren
(brace
multiline_comment|/* Disable flow control */
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST_TYPE
comma
l_int|0
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s error from disable flowcontrol urb&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
multiline_comment|/* Drop RTS and DTR */
r_if
c_cond
(paren
id|set_dtr
c_func
(paren
id|port
comma
id|LOW
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Error from DTR LOW urb&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set_rts
c_func
(paren
id|port
comma
id|LOW
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Error from RTS LOW urb&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* set the baudrate determined before */
r_if
c_cond
(paren
id|change_speed
c_func
(paren
id|port
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s urb failed to set baurdrate&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Set flow control */
multiline_comment|/* Note device also supports DTR/CD (ugh) and Xon/Xoff in hardware */
r_if
c_cond
(paren
id|cflag
op_amp
id|CRTSCTS
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s Setting to CRTSCTS flow control&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST_TYPE
comma
l_int|0
comma
id|FTDI_SIO_RTS_CTS_HS
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;urb failed to set to rts/cts flow control&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Xon/Xoff code&n;&t;&t; *&n;&t;&t; * Check the IXOFF status in the iflag component of the termios structure&n;&t;&t; * if IXOFF is not set, the pre-xon/xoff code is executed.&n;&t;&t;*/
r_if
c_cond
(paren
id|iflag
op_amp
id|IXOFF
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s  request to enable xonxoff iflag=%04x&quot;
comma
id|__FUNCTION__
comma
id|iflag
)paren
suffix:semicolon
singleline_comment|// Try to enable the XON/XOFF on the ftdi_sio
singleline_comment|// Set the vstart and vstop -- could have been done up above where
singleline_comment|// a lot of other dereferencing is done but that would be very
singleline_comment|// inefficient as vstart and vstop are not always needed
id|vstart
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_cc
(braket
id|VSTART
)braket
suffix:semicolon
id|vstop
op_assign
id|port-&gt;tty-&gt;termios-&gt;c_cc
(braket
id|VSTOP
)braket
suffix:semicolon
id|urb_value
op_assign
(paren
id|vstop
op_lshift
l_int|8
)paren
op_or
(paren
id|vstart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST_TYPE
comma
id|urb_value
comma
id|FTDI_SIO_XON_XOFF_HS
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;urb failed to set to xon/xoff flow control&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* else clause to only run if cfag ! CRTSCTS and iflag ! XOFF */
multiline_comment|/* CHECKME Assuming XON/XOFF handled by tty stack - not by device */
id|dbg
c_func
(paren
l_string|&quot;%s Turning off hardware flow control&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST
comma
id|FTDI_SIO_SET_FLOW_CTRL_REQUEST_TYPE
comma
l_int|0
comma
l_int|0
comma
id|buf
comma
l_int|0
comma
id|WDR_TIMEOUT
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;urb failed to clear flow control&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* ftdi_termios */
DECL|function|ftdi_tiocmget
r_static
r_int
id|ftdi_tiocmget
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|port-&gt;serial
suffix:semicolon
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s TIOCMGET&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;chip_type
)paren
(brace
r_case
id|SIO
suffix:colon
multiline_comment|/* Request the status from the device */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_GET_MODEM_STATUS_REQUEST
comma
id|FTDI_SIO_GET_MODEM_STATUS_REQUEST_TYPE
comma
l_int|0
comma
l_int|0
comma
id|buf
comma
l_int|1
comma
id|WDR_TIMEOUT
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Could not get modem status of device - err: %d&quot;
comma
id|__FUNCTION__
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FT8U232AM
suffix:colon
r_case
id|FT232BM
suffix:colon
multiline_comment|/* the 8U232AM returns a two byte value (the sio is a 1 byte value) - in the same&n;&t;&t;   format as the data returned from the in point */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|usb_control_msg
c_func
(paren
id|serial-&gt;dev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|FTDI_SIO_GET_MODEM_STATUS_REQUEST
comma
id|FTDI_SIO_GET_MODEM_STATUS_REQUEST_TYPE
comma
l_int|0
comma
l_int|0
comma
id|buf
comma
l_int|2
comma
id|WDR_TIMEOUT
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s Could not get modem status of device - err: %d&quot;
comma
id|__FUNCTION__
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
id|buf
(braket
l_int|0
)braket
op_amp
id|FTDI_SIO_DSR_MASK
ques
c_cond
id|TIOCM_DSR
suffix:colon
l_int|0
)paren
op_or
(paren
id|buf
(braket
l_int|0
)braket
op_amp
id|FTDI_SIO_CTS_MASK
ques
c_cond
id|TIOCM_CTS
suffix:colon
l_int|0
)paren
op_or
(paren
id|buf
(braket
l_int|0
)braket
op_amp
id|FTDI_SIO_RI_MASK
ques
c_cond
id|TIOCM_RI
suffix:colon
l_int|0
)paren
op_or
(paren
id|buf
(braket
l_int|0
)braket
op_amp
id|FTDI_SIO_RLSD_MASK
ques
c_cond
id|TIOCM_CD
suffix:colon
l_int|0
)paren
op_or
id|priv-&gt;last_dtr_rts
suffix:semicolon
)brace
DECL|function|ftdi_tiocmset
r_static
r_int
id|ftdi_tiocmset
c_func
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|set
comma
r_int
r_int
id|clear
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|set
op_amp
id|TIOCM_DTR
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_dtr
c_func
(paren
id|port
comma
id|HIGH
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to set DTR failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|set
op_amp
id|TIOCM_RTS
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_rts
c_func
(paren
id|port
comma
id|HIGH
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to set RTS failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|clear
op_amp
id|TIOCM_DTR
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_dtr
c_func
(paren
id|port
comma
id|LOW
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to unset DTR failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|clear
op_amp
id|TIOCM_RTS
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_rts
c_func
(paren
id|port
comma
id|LOW
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to unset RTS failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ftdi_ioctl
r_static
r_int
id|ftdi_ioctl
(paren
r_struct
id|usb_serial_port
op_star
id|port
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|ftdi_private
op_star
id|priv
op_assign
id|usb_get_serial_port_data
c_func
(paren
id|port
)paren
suffix:semicolon
r_int
id|ret
comma
id|mask
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s cmd 0x%04x&quot;
comma
id|__FUNCTION__
comma
id|cmd
)paren
suffix:semicolon
multiline_comment|/* Based on code from acm.c and others */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCMBIS
suffix:colon
multiline_comment|/* turns on (Sets) the lines as specified by the mask */
id|dbg
c_func
(paren
l_string|&quot;%s TIOCMBIS&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|mask
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|TIOCM_DTR
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_dtr
c_func
(paren
id|port
comma
id|HIGH
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to set DTR failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mask
op_amp
id|TIOCM_RTS
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_rts
c_func
(paren
id|port
comma
id|HIGH
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to set RTS failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCMBIC
suffix:colon
multiline_comment|/* turns off (Clears) the lines as specified by the mask */
id|dbg
c_func
(paren
l_string|&quot;%s TIOCMBIC&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|mask
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|TIOCM_DTR
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_dtr
c_func
(paren
id|port
comma
id|LOW
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to unset DTR failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mask
op_amp
id|TIOCM_RTS
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|set_rts
c_func
(paren
id|port
comma
id|LOW
)paren
)paren
OL
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;Urb to unset RTS failed&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t; * I had originally implemented TCSET{A,S}{,F,W} and&n;&t;&t; * TCGET{A,S} here separately, however when testing I&n;&t;&t; * found that the higher layers actually do the termios&n;&t;&t; * conversions themselves and pass the call onto&n;&t;&t; * ftdi_sio_set_termios. &n;&t;&t; *&n;&t;&t; */
r_case
id|TIOCGSERIAL
suffix:colon
multiline_comment|/* gets serial port data */
r_return
id|get_serial_info
c_func
(paren
id|port
comma
(paren
r_struct
id|serial_struct
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|TIOCSSERIAL
suffix:colon
multiline_comment|/* sets serial port data */
r_return
id|set_serial_info
c_func
(paren
id|port
comma
(paren
r_struct
id|serial_struct
op_star
)paren
id|arg
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for any of the 4 modem inputs (DCD,RI,DSR,CTS) to change&n;&t; * - mask passed in arg for lines of interest&n;&t; *   (use |&squot;ed TIOCM_RNG/DSR/CD/CTS for masking)&n;&t; * Caller should use TIOCGICOUNT to see which one it was.&n;&t; *&n;&t; * This code is borrowed from linux/drivers/char/serial.c&n;&t; */
r_case
id|TIOCMIWAIT
suffix:colon
r_while
c_loop
(paren
id|priv
op_ne
l_int|NULL
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
op_amp
id|priv-&gt;delta_msr_wait
)paren
suffix:semicolon
multiline_comment|/* see if a signal did it */
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_else
(brace
r_char
id|diff
op_assign
id|priv-&gt;diff_status
suffix:semicolon
r_if
c_cond
(paren
id|diff
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* no change =&gt; error */
)brace
multiline_comment|/* Consume all events */
id|priv-&gt;diff_status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Return 0 if caller wanted to know about these bits */
r_if
c_cond
(paren
(paren
(paren
id|arg
op_amp
id|TIOCM_RNG
)paren
op_logical_and
(paren
id|diff
op_amp
id|FTDI_RS0_RI
)paren
)paren
op_logical_or
(paren
(paren
id|arg
op_amp
id|TIOCM_DSR
)paren
op_logical_and
(paren
id|diff
op_amp
id|FTDI_RS0_DSR
)paren
)paren
op_logical_or
(paren
(paren
id|arg
op_amp
id|TIOCM_CD
)paren
op_logical_and
(paren
id|diff
op_amp
id|FTDI_RS0_RLSD
)paren
)paren
op_logical_or
(paren
(paren
id|arg
op_amp
id|TIOCM_CTS
)paren
op_logical_and
(paren
id|diff
op_amp
id|FTDI_RS0_CTS
)paren
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t; * Otherwise caller can&squot;t care less about what happened,&n;&t;&t;&t;&t; * and so we continue to wait for more events.&n;&t;&t;&t;&t; */
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* This is not necessarily an error - turns out the higher layers will do &n;&t; *  some ioctls itself (see comment above)&n;&t; */
id|dbg
c_func
(paren
l_string|&quot;%s arg not supported - it was 0x%04x - check /usr/include/asm/ioctls.h&quot;
comma
id|__FUNCTION__
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
multiline_comment|/* ftdi_ioctl */
DECL|function|ftdi_throttle
r_static
r_void
id|ftdi_throttle
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - port %d&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
)paren
suffix:semicolon
id|usb_unlink_urb
(paren
id|port-&gt;read_urb
)paren
suffix:semicolon
)brace
DECL|function|ftdi_unthrottle
r_static
r_void
id|ftdi_unthrottle
(paren
r_struct
id|usb_serial_port
op_star
id|port
)paren
(brace
r_int
id|result
suffix:semicolon
r_struct
id|usb_serial
op_star
id|serial
op_assign
id|port-&gt;serial
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s - port %d&quot;
comma
id|__FUNCTION__
comma
id|port-&gt;number
)paren
suffix:semicolon
id|port-&gt;read_urb-&gt;dev
op_assign
id|serial-&gt;dev
suffix:semicolon
id|usb_fill_bulk_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|serial-&gt;dev
comma
id|usb_rcvbulkpipe
c_func
(paren
id|serial-&gt;dev
comma
id|port-&gt;bulk_in_endpointAddress
)paren
comma
id|port-&gt;read_urb-&gt;transfer_buffer
comma
id|port-&gt;read_urb-&gt;transfer_buffer_length
comma
id|ftdi_read_bulk_callback
comma
id|port
)paren
suffix:semicolon
id|result
op_assign
id|usb_submit_urb
c_func
(paren
id|port-&gt;read_urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|err
c_func
(paren
l_string|&quot;%s - failed submitting read urb, error %d&quot;
comma
id|__FUNCTION__
comma
id|result
)paren
suffix:semicolon
)brace
DECL|function|ftdi_init
r_static
r_int
id|__init
id|ftdi_init
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
id|usb_serial_register
c_func
(paren
op_amp
id|ftdi_SIO_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_SIO_register
suffix:semicolon
id|retval
op_assign
id|usb_serial_register
c_func
(paren
op_amp
id|ftdi_8U232AM_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_8U232AM_register
suffix:semicolon
id|retval
op_assign
id|usb_serial_register
c_func
(paren
op_amp
id|ftdi_FT232BM_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_FT232BM_register
suffix:semicolon
id|retval
op_assign
id|usb_serial_register
c_func
(paren
op_amp
id|ftdi_USB_UIRT_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_USB_UIRT_register
suffix:semicolon
id|retval
op_assign
id|usb_serial_register
c_func
(paren
op_amp
id|ftdi_HE_TIRA1_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_HE_TIRA1_register
suffix:semicolon
id|retval
op_assign
id|usb_register
c_func
(paren
op_amp
id|ftdi_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_usb_register
suffix:semicolon
id|info
c_func
(paren
id|DRIVER_VERSION
l_string|&quot;:&quot;
id|DRIVER_DESC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed_usb_register
suffix:colon
id|usb_serial_deregister
c_func
(paren
op_amp
id|ftdi_HE_TIRA1_device
)paren
suffix:semicolon
id|failed_HE_TIRA1_register
suffix:colon
id|usb_serial_deregister
c_func
(paren
op_amp
id|ftdi_USB_UIRT_device
)paren
suffix:semicolon
id|failed_USB_UIRT_register
suffix:colon
id|usb_serial_deregister
c_func
(paren
op_amp
id|ftdi_FT232BM_device
)paren
suffix:semicolon
id|failed_FT232BM_register
suffix:colon
id|usb_serial_deregister
c_func
(paren
op_amp
id|ftdi_8U232AM_device
)paren
suffix:semicolon
id|failed_8U232AM_register
suffix:colon
id|usb_serial_deregister
c_func
(paren
op_amp
id|ftdi_SIO_device
)paren
suffix:semicolon
id|failed_SIO_register
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|ftdi_exit
r_static
r_void
id|__exit
id|ftdi_exit
(paren
r_void
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|usb_deregister
(paren
op_amp
id|ftdi_driver
)paren
suffix:semicolon
id|usb_serial_deregister
(paren
op_amp
id|ftdi_HE_TIRA1_device
)paren
suffix:semicolon
id|usb_serial_deregister
(paren
op_amp
id|ftdi_USB_UIRT_device
)paren
suffix:semicolon
id|usb_serial_deregister
(paren
op_amp
id|ftdi_FT232BM_device
)paren
suffix:semicolon
id|usb_serial_deregister
(paren
op_amp
id|ftdi_8U232AM_device
)paren
suffix:semicolon
id|usb_serial_deregister
(paren
op_amp
id|ftdi_SIO_device
)paren
suffix:semicolon
)brace
DECL|variable|ftdi_init
id|module_init
c_func
(paren
id|ftdi_init
)paren
suffix:semicolon
DECL|variable|ftdi_exit
id|module_exit
c_func
(paren
id|ftdi_exit
)paren
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Debug enabled or not&quot;
)paren
suffix:semicolon
eof
