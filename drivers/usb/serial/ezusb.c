multiline_comment|/*&n; * EZ-USB specific functions used by some of the USB to Serial drivers.&n; *&n; * Copyright (C) 1999 - 2002 Greg Kroah-Hartman (greg@kroah.com)&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License version&n; *&t;2 as published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#ifdef CONFIG_USB_SERIAL_DEBUG
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
macro_line|#else
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
macro_line|#endif
macro_line|#include &quot;usb-serial.h&quot;
multiline_comment|/* EZ-USB Control and Status Register.  Bit 0 controls 8051 reset */
DECL|macro|CPUCS_REG
mdefine_line|#define CPUCS_REG    0x7F92
DECL|function|ezusb_writememory
r_int
id|ezusb_writememory
(paren
r_struct
id|usb_serial
op_star
id|serial
comma
r_int
id|address
comma
r_int
r_char
op_star
id|data
comma
r_int
id|length
comma
id|__u8
id|bRequest
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_char
op_star
id|transfer_buffer
suffix:semicolon
multiline_comment|/* dbg(&quot;ezusb_writememory %x, %d&quot;, address, length); */
r_if
c_cond
(paren
op_logical_neg
id|serial-&gt;dev
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - no physical device present, failing.&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|transfer_buffer
op_assign
id|kmalloc
(paren
id|length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|transfer_buffer
)paren
(brace
id|dev_err
c_func
(paren
id|serial-&gt;dev-&gt;dev
comma
l_string|&quot;%s - kmalloc(%d) failed.&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|length
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|transfer_buffer
comma
id|data
comma
id|length
)paren
suffix:semicolon
id|result
op_assign
id|usb_control_msg
(paren
id|serial-&gt;dev
comma
id|usb_sndctrlpipe
c_func
(paren
id|serial-&gt;dev
comma
l_int|0
)paren
comma
id|bRequest
comma
l_int|0x40
comma
id|address
comma
l_int|0
comma
id|transfer_buffer
comma
id|length
comma
l_int|3
op_star
id|HZ
)paren
suffix:semicolon
id|kfree
(paren
id|transfer_buffer
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ezusb_set_reset
r_int
id|ezusb_set_reset
(paren
r_struct
id|usb_serial
op_star
id|serial
comma
r_int
r_char
id|reset_bit
)paren
(brace
r_int
id|response
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s - %d&quot;
comma
id|__FUNCTION__
comma
id|reset_bit
)paren
suffix:semicolon
id|response
op_assign
id|ezusb_writememory
(paren
id|serial
comma
id|CPUCS_REG
comma
op_amp
id|reset_bit
comma
l_int|1
comma
l_int|0xa0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|response
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
id|serial-&gt;dev-&gt;dev
comma
l_string|&quot;%s- %d failed&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|reset_bit
)paren
suffix:semicolon
)brace
r_return
id|response
suffix:semicolon
)brace
DECL|variable|ezusb_writememory
id|EXPORT_SYMBOL
c_func
(paren
id|ezusb_writememory
)paren
suffix:semicolon
DECL|variable|ezusb_set_reset
id|EXPORT_SYMBOL
c_func
(paren
id|ezusb_set_reset
)paren
suffix:semicolon
eof
