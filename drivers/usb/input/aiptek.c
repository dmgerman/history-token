multiline_comment|/*&n; *  Native support for the Aiptek HyperPen USB Tablets&n; *  (4000U/5000U/6000U/8000U/12000U)&n; *  &n; *  Copyright (c) 2001      Chris Atenasio   &lt;chris@crud.net&gt;&n; *  Copyright (c) 2002-2004 Bryan W. Headley &lt;bwheadley@earthlink.net&gt;&n; *&n; *  based on wacom.c by&n; *     Vojtech Pavlik      &lt;vojtech@suse.cz&gt;&n; *     Andreas Bach Aaen   &lt;abach@stofanet.dk&gt;&n; *     Clifford Wolf       &lt;clifford@clifford.at&gt;&n; *     Sam Mosel           &lt;sam.mosel@computer.org&gt;&n; *     James E. Blair      &lt;corvus@gnu.org&gt;&n; *     Daniel Egger        &lt;egger@suse.de&gt;&n; *&n; *  Many thanks to Oliver Kuechemann for his support.&n; *&n; *  ChangeLog:&n; *      v0.1 - Initial release&n; *      v0.2 - Hack to get around fake event 28&squot;s. (Bryan W. Headley)&n; *      v0.3 - Make URB dynamic (Bryan W. Headley, Jun-8-2002)&n; *             Released to Linux 2.4.19 and 2.5.x&n; *      v0.4 - Rewrote substantial portions of the code to deal with&n; *             corrected control sequences, timing, dynamic configuration,&n; *             support of 6000U - 12000U, procfs, and macro key support&n; *             (Jan-1-2003 - Feb-5-2003, Bryan W. Headley)&n; *      v1.0 - Added support for diagnostic messages, count of messages&n; *             received from URB - Mar-8-2003, Bryan W. Headley&n; *      v1.1 - added support for tablet resolution, changed DV and proximity&n; *             some corrections - Jun-22-2003, martin schneebacher&n; *           - Added support for the sysfs interface, deprecating the&n; *             procfs interface for 2.5.x kernel. Also added support for&n; *             Wheel command. Bryan W. Headley July-15-2003.&n; *      v1.2 - Reworked jitter timer as a kernel thread. &n; *             Bryan W. Headley November-28-2003/Jan-10-2004.&n; *      v1.3 - Repaired issue of kernel thread going nuts on single-processor&n; *             machines, introduced programmableDelay as a command line&n; *             parameter. Feb 7 2004, Bryan W. Headley.&n; *      v1.4 - Re-wire jitter so it does not require a thread. Courtesy of&n; *             Rene van Paassen. Added reporting of physical pointer device&n; *             (e.g., stylus, mouse in reports 2, 3, 4, 5. We don&squot;t know&n; *             for reports 1, 6.)&n; *             what physical device reports for reports 1, 6.) Also enabled&n; *             MOUSE and LENS tool button modes. Renamed &quot;rubber&quot; to &quot;eraser&quot;.&n; *             Feb 20, 2004, Bryan W. Headley.&n; *      v1.5 - Added previousJitterable, so we don&squot;t do jitter delay when the&n; *             user is holding a button down for periods of time.&n; *&n; * NOTE:&n; *      This kernel driver is augmented by the &quot;Aiptek&quot; XFree86 input&n; *      driver for your X server, as well as the Gaiptek GUI Front-end&n; *      &quot;Tablet Manager&quot;. &n; *      These three products are highly interactive with one another, &n; *      so therefore it&squot;s easier to document them all as one subsystem.&n; *      Please visit the project&squot;s &quot;home page&quot;, located at, &n; *      http://aiptektablet.sourceforge.net.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; */
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
multiline_comment|/*&n; * Version Information&n; */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;v1.5 (May-15-2004)&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR  &quot;Bryan W. Headley/Chris Atenasio&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC    &quot;Aiptek HyperPen USB Tablet Driver (Linux 2.6.x)&quot;
multiline_comment|/*&n; * Aiptek status packet:&n; *&n; * (returned as Report 1 - relative coordinates from mouse and stylus)&n; *&n; *        bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0&n; * byte0   0     0     0     0     0     0     0     1&n; * byte1   0     0     0     0     0    BS2   BS    Tip&n; * byte2  X7    X6    X5    X4    X3    X2    X1    X0&n; * byte3  Y7    Y6    Y5    Y4    Y3    Y2    Y1    Y0&n; *&n; * (returned as Report 2 - absolute coordinates from the stylus)&n; *&n; *        bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0&n; * byte0   0     0     0     0     0     0     1     0&n; * byte1  X7    X6    X5    X4    X3    X2    X1    X0&n; * byte2  X15   X14   X13   X12   X11   X10   X9    X8&n; * byte3  Y7    Y6    Y5    Y4    Y3    Y2    Y1    Y0&n; * byte4  Y15   Y14   Y13   Y12   Y11   Y10   Y9    Y8&n; * byte5   *     *     *    BS2   BS1   Tip   IR    DV&n; * byte6  P7    P6    P5    P4    P3    P2    P1    P0&n; * byte7  P15   P14   P13   P12   P11   P10   P9    P8&n; *&n; * (returned as Report 3 - absolute coordinates from the mouse)&n; *&n; *        bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0&n; * byte0   0     0     0     0     0     0     1     0&n; * byte1  X7    X6    X5    X4    X3    X2    X1    X0&n; * byte2  X15   X14   X13   X12   X11   X10   X9    X8&n; * byte3  Y7    Y6    Y5    Y4    Y3    Y2    Y1    Y0&n; * byte4  Y15   Y14   Y13   Y12   Y11   Y10   Y9    Y8&n; * byte5   *     *     *    BS2   BS1   Tip   IR    DV&n; * byte6  P7    P6    P5    P4    P3    P2    P1    P0&n; * byte7  P15   P14   P13   P12   P11   P10   P9    P8&n; *&n; * (returned as Report 4 - macrokeys from the stylus)&n; *&n; *        bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0&n; * byte0   0     0     0     0     0     1     0     0&n; * byte1   0     0     0    BS2   BS    Tip   IR    DV&n; * byte2   0     0     0     0     0     0     1     0&n; * byte3   0     0     0    K4    K3    K2    K1    K0&n; * byte4  P7    P6    P5    P4    P3    P2    P1    P0&n; * byte5  P15   P14   P13   P12   P11   P10   P9    P8&n; *&n; * (returned as Report 5 - macrokeys from the mouse)&n; *&n; *        bit7  bit6  bit5  bit4  bit3  bit2  bit1  bit0&n; * byte0   0     0     0     0     0     1     0     0&n; * byte1   0     0     0    BS2   BS    Tip   IR    DV&n; * byte2   0     0     0     0     0     0     1     0&n; * byte3   0     0     0    K4    K3    K2    K1    K0&n; * byte4  P7    P6    P5    P4    P3    P2    P1    P0&n; * byte5  P15   P14   P13   P12   P11   P10   P9    P8&n; *&n; * IR: In Range = Proximity on&n; * DV = Data Valid&n; * BS = Barrel Switch (as in, macro keys)&n; * BS2 also referred to as Tablet Pick&n; *&n; * Command Summary:&n; *&n; * Use report_type CONTROL (3)&n; * Use report_id   2&n; *&n; * Command/Data    Description     Return Bytes    Return Value&n; * 0x10/0x00       SwitchToMouse       0&n; * 0x10/0x01       SwitchToTablet      0&n; * 0x18/0x04       SetResolution       0 &n; * 0x12/0xFF       AutoGainOn          0&n; * 0x17/0x00       FilterOn            0&n; * 0x01/0x00       GetXExtension       2           MaxX&n; * 0x01/0x01       GetYExtension       2           MaxY&n; * 0x02/0x00       GetModelCode        2           ModelCode = LOBYTE&n; * 0x03/0x00       GetODMCode          2           ODMCode&n; * 0x08/0x00       GetPressureLevels   2           =512&n; * 0x04/0x00       GetFirmwareVersion  2           Firmware Version&n; * 0x11/0x02       EnableMacroKeys     0&n; *&n; * To initialize the tablet:&n; *&n; * (1) Send Resolution500LPI (Command)&n; * (2) Query for Model code (Option Report)&n; * (3) Query for ODM code (Option Report)&n; * (4) Query for firmware (Option Report)&n; * (5) Query for GetXExtension (Option Report)&n; * (6) Query for GetYExtension (Option Report)&n; * (7) Query for GetPressureLevels (Option Report)&n; * (8) SwitchToTablet for Absolute coordinates, or&n; *     SwitchToMouse for Relative coordinates (Command)&n; * (9) EnableMacroKeys (Command)&n; * (10) FilterOn (Command)&n; * (11) AutoGainOn (Command)&n; *&n; * (Step 9 can be omitted, but you&squot;ll then have no function keys.)&n; */
DECL|macro|USB_VENDOR_ID_AIPTEK
mdefine_line|#define USB_VENDOR_ID_AIPTEK&t;&t;&t;&t;0x08ca
DECL|macro|USB_REQ_GET_REPORT
mdefine_line|#define USB_REQ_GET_REPORT&t;&t;&t;&t;0x01
DECL|macro|USB_REQ_SET_REPORT
mdefine_line|#define USB_REQ_SET_REPORT&t;&t;&t;&t;0x09
multiline_comment|/* PointerMode codes&n;&t; */
DECL|macro|AIPTEK_POINTER_ONLY_MOUSE_MODE
mdefine_line|#define AIPTEK_POINTER_ONLY_MOUSE_MODE&t;&t;&t;0
DECL|macro|AIPTEK_POINTER_ONLY_STYLUS_MODE
mdefine_line|#define AIPTEK_POINTER_ONLY_STYLUS_MODE&t;&t;&t;1
DECL|macro|AIPTEK_POINTER_EITHER_MODE
mdefine_line|#define AIPTEK_POINTER_EITHER_MODE&t;&t;&t;2
DECL|macro|AIPTEK_POINTER_ALLOW_MOUSE_MODE
mdefine_line|#define AIPTEK_POINTER_ALLOW_MOUSE_MODE(a)&t;&t;&bslash;&n;&t;(a == AIPTEK_POINTER_ONLY_MOUSE_MODE ||&t;&t;&bslash;&n;&t; a == AIPTEK_POINTER_EITHER_MODE)
DECL|macro|AIPTEK_POINTER_ALLOW_STYLUS_MODE
mdefine_line|#define AIPTEK_POINTER_ALLOW_STYLUS_MODE(a)&t;&t;&bslash;&n;&t;(a == AIPTEK_POINTER_ONLY_STYLUS_MODE ||&t;&bslash;&n;&t; a == AIPTEK_POINTER_EITHER_MODE)
multiline_comment|/* CoordinateMode code&n;&t; */
DECL|macro|AIPTEK_COORDINATE_RELATIVE_MODE
mdefine_line|#define AIPTEK_COORDINATE_RELATIVE_MODE&t;&t;&t;0
DECL|macro|AIPTEK_COORDINATE_ABSOLUTE_MODE
mdefine_line|#define AIPTEK_COORDINATE_ABSOLUTE_MODE&t;&t;&t;1
multiline_comment|/* XTilt and YTilt values&n;        */
DECL|macro|AIPTEK_TILT_MIN
mdefine_line|#define AIPTEK_TILT_MIN&t;&t;&t;&t;&t;(-128)
DECL|macro|AIPTEK_TILT_MAX
mdefine_line|#define AIPTEK_TILT_MAX&t;&t;&t;&t;&t;127
DECL|macro|AIPTEK_TILT_DISABLE
mdefine_line|#define AIPTEK_TILT_DISABLE&t;&t;&t;&t;(-10101)
multiline_comment|/* Wheel values&n;&t; */
DECL|macro|AIPTEK_WHEEL_MIN
mdefine_line|#define AIPTEK_WHEEL_MIN&t;&t;&t;&t;0
DECL|macro|AIPTEK_WHEEL_MAX
mdefine_line|#define AIPTEK_WHEEL_MAX&t;&t;&t;&t;1024
DECL|macro|AIPTEK_WHEEL_DISABLE
mdefine_line|#define AIPTEK_WHEEL_DISABLE&t;&t;&t;&t;(-10101)
multiline_comment|/* ToolCode values, which BTW are 0x140 .. 0x14f&n;&t; * We have things set up such that if TOOL_BUTTON_FIRED_BIT is&n;&t; * not set, we&squot;ll send one instance of AIPTEK_TOOL_BUTTON_xxx.&n;&t; *&n;&t; * Whenever the user resets the value, TOOL_BUTTON_FIRED_BIT will&n;&t; * get reset.&n;&t; */
DECL|macro|TOOL_BUTTON
mdefine_line|#define TOOL_BUTTON(x)&t;&t;&t;&t;&t;((x) &amp; 0x14f)
DECL|macro|TOOL_BUTTON_FIRED
mdefine_line|#define TOOL_BUTTON_FIRED(x)&t;&t;&t;&t;((x) &amp; 0x200)
DECL|macro|TOOL_BUTTON_FIRED_BIT
mdefine_line|#define TOOL_BUTTON_FIRED_BIT&t;&t;&t;&t;0x200
multiline_comment|/* toolMode codes&n;&t; */
DECL|macro|AIPTEK_TOOL_BUTTON_PEN_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_PEN_MODE&t;&t;&t;BTN_TOOL_PEN
DECL|macro|AIPTEK_TOOL_BUTTON_PEN_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_PEN_MODE&t;&t;&t;BTN_TOOL_PEN
DECL|macro|AIPTEK_TOOL_BUTTON_PENCIL_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_PENCIL_MODE&t;&t;&t;BTN_TOOL_PENCIL
DECL|macro|AIPTEK_TOOL_BUTTON_BRUSH_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_BRUSH_MODE&t;&t;&t;BTN_TOOL_BRUSH
DECL|macro|AIPTEK_TOOL_BUTTON_AIRBRUSH_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_AIRBRUSH_MODE&t;&t;BTN_TOOL_AIRBRUSH
DECL|macro|AIPTEK_TOOL_BUTTON_ERASER_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_ERASER_MODE&t;&t;&t;BTN_TOOL_RUBBER
DECL|macro|AIPTEK_TOOL_BUTTON_MOUSE_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_MOUSE_MODE&t;&t;&t;BTN_TOOL_MOUSE
DECL|macro|AIPTEK_TOOL_BUTTON_LENS_MODE
mdefine_line|#define AIPTEK_TOOL_BUTTON_LENS_MODE&t;&t;&t;BTN_TOOL_LENS
multiline_comment|/* Diagnostic message codes&n;&t; */
DECL|macro|AIPTEK_DIAGNOSTIC_NA
mdefine_line|#define AIPTEK_DIAGNOSTIC_NA&t;&t;&t;&t;0
DECL|macro|AIPTEK_DIAGNOSTIC_SENDING_RELATIVE_IN_ABSOLUTE
mdefine_line|#define AIPTEK_DIAGNOSTIC_SENDING_RELATIVE_IN_ABSOLUTE&t;1
DECL|macro|AIPTEK_DIAGNOSTIC_SENDING_ABSOLUTE_IN_RELATIVE
mdefine_line|#define AIPTEK_DIAGNOSTIC_SENDING_ABSOLUTE_IN_RELATIVE&t;2
DECL|macro|AIPTEK_DIAGNOSTIC_TOOL_DISALLOWED
mdefine_line|#define AIPTEK_DIAGNOSTIC_TOOL_DISALLOWED&t;&t;3
multiline_comment|/* Time to wait (in ms) to help mask hand jittering &n;&t; * when pressing the stylus buttons.&n;&t; */
DECL|macro|AIPTEK_JITTER_DELAY_DEFAULT
mdefine_line|#define AIPTEK_JITTER_DELAY_DEFAULT&t;&t;&t;50
multiline_comment|/* Time to wait (in ms) in-between sending the tablet&n;&t; * a command and beginning the process of reading the return&n;&t; * sequence from the tablet.&n;&t; */
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_25
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_25&t;&t;25
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_50
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_50&t;&t;50
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_100
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_100&t;&t;100
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_200
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_200&t;&t;200
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_300
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_300&t;&t;300
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_400
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_400&t;&t;400
DECL|macro|AIPTEK_PROGRAMMABLE_DELAY_DEFAULT
mdefine_line|#define AIPTEK_PROGRAMMABLE_DELAY_DEFAULT&t;AIPTEK_PROGRAMMABLE_DELAY_400
multiline_comment|/* Mouse button programming&n;&t; */
DECL|macro|AIPTEK_MOUSE_LEFT_BUTTON
mdefine_line|#define AIPTEK_MOUSE_LEFT_BUTTON&t;&t;0x01
DECL|macro|AIPTEK_MOUSE_RIGHT_BUTTON
mdefine_line|#define AIPTEK_MOUSE_RIGHT_BUTTON&t;&t;0x02
DECL|macro|AIPTEK_MOUSE_MIDDLE_BUTTON
mdefine_line|#define AIPTEK_MOUSE_MIDDLE_BUTTON&t;&t;0x04
multiline_comment|/* Stylus button programming&n;&t; */
DECL|macro|AIPTEK_STYLUS_LOWER_BUTTON
mdefine_line|#define AIPTEK_STYLUS_LOWER_BUTTON&t;&t;0x08
DECL|macro|AIPTEK_STYLUS_UPPER_BUTTON
mdefine_line|#define AIPTEK_STYLUS_UPPER_BUTTON&t;&t;0x10
multiline_comment|/* Length of incoming packet from the tablet&n;&t; */
DECL|macro|AIPTEK_PACKET_LENGTH
mdefine_line|#define AIPTEK_PACKET_LENGTH&t;&t;&t;8
multiline_comment|/* We report in EV_MISC both the proximity and&n;&t; * whether the report came from the stylus, tablet mouse&n;&t; * or &quot;unknown&quot; -- Unknown when the tablet is in relative&n;&t; * mode, because we only get report 1&squot;s.&n;&t; */
DECL|macro|AIPTEK_REPORT_TOOL_UNKNOWN
mdefine_line|#define AIPTEK_REPORT_TOOL_UNKNOWN&t;&t;0x10
DECL|macro|AIPTEK_REPORT_TOOL_STYLUS
mdefine_line|#define AIPTEK_REPORT_TOOL_STYLUS&t;&t;0x20
DECL|macro|AIPTEK_REPORT_TOOL_MOUSE
mdefine_line|#define AIPTEK_REPORT_TOOL_MOUSE&t;&t;0x40
DECL|variable|programmableDelay
r_static
r_int
id|programmableDelay
op_assign
id|AIPTEK_PROGRAMMABLE_DELAY_DEFAULT
suffix:semicolon
DECL|variable|jitterDelay
r_static
r_int
id|jitterDelay
op_assign
id|AIPTEK_JITTER_DELAY_DEFAULT
suffix:semicolon
DECL|struct|aiptek_features
r_struct
id|aiptek_features
(brace
DECL|member|odmCode
r_int
id|odmCode
suffix:semicolon
multiline_comment|/* Tablet manufacturer code       */
DECL|member|modelCode
r_int
id|modelCode
suffix:semicolon
multiline_comment|/* Tablet model code (not unique) */
DECL|member|firmwareCode
r_int
id|firmwareCode
suffix:semicolon
multiline_comment|/* prom/eeprom version            */
DECL|member|usbPath
r_char
id|usbPath
(braket
l_int|64
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* device&squot;s physical usb path     */
DECL|member|inputPath
r_char
id|inputPath
(braket
l_int|64
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* input device path              */
DECL|member|manuName
r_char
id|manuName
(braket
l_int|64
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* manufacturer name              */
DECL|member|prodName
r_char
id|prodName
(braket
l_int|64
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* product name                   */
)brace
suffix:semicolon
DECL|struct|aiptek_settings
r_struct
id|aiptek_settings
(brace
DECL|member|pointerMode
r_int
id|pointerMode
suffix:semicolon
multiline_comment|/* stylus-, mouse-only or either */
DECL|member|coordinateMode
r_int
id|coordinateMode
suffix:semicolon
multiline_comment|/* absolute/relative coords      */
DECL|member|toolMode
r_int
id|toolMode
suffix:semicolon
multiline_comment|/* pen, pencil, brush, etc. tool */
DECL|member|xTilt
r_int
id|xTilt
suffix:semicolon
multiline_comment|/* synthetic xTilt amount        */
DECL|member|yTilt
r_int
id|yTilt
suffix:semicolon
multiline_comment|/* synthetic yTilt amount        */
DECL|member|wheel
r_int
id|wheel
suffix:semicolon
multiline_comment|/* synthetic wheel amount        */
DECL|member|stylusButtonUpper
r_int
id|stylusButtonUpper
suffix:semicolon
multiline_comment|/* stylus upper btn delivers...  */
DECL|member|stylusButtonLower
r_int
id|stylusButtonLower
suffix:semicolon
multiline_comment|/* stylus lower btn delivers...  */
DECL|member|mouseButtonLeft
r_int
id|mouseButtonLeft
suffix:semicolon
multiline_comment|/* mouse left btn delivers...    */
DECL|member|mouseButtonMiddle
r_int
id|mouseButtonMiddle
suffix:semicolon
multiline_comment|/* mouse middle btn delivers...  */
DECL|member|mouseButtonRight
r_int
id|mouseButtonRight
suffix:semicolon
multiline_comment|/* mouse right btn delivers...   */
DECL|member|programmableDelay
r_int
id|programmableDelay
suffix:semicolon
multiline_comment|/* delay for tablet programming  */
DECL|member|jitterDelay
r_int
id|jitterDelay
suffix:semicolon
multiline_comment|/* delay for hand jittering      */
)brace
suffix:semicolon
DECL|struct|aiptek
r_struct
id|aiptek
(brace
DECL|member|inputdev
r_struct
id|input_dev
id|inputdev
suffix:semicolon
multiline_comment|/* input device struct           */
DECL|member|usbdev
r_struct
id|usb_device
op_star
id|usbdev
suffix:semicolon
multiline_comment|/* usb device struct             */
DECL|member|urb
r_struct
id|urb
op_star
id|urb
suffix:semicolon
multiline_comment|/* urb for incoming reports      */
DECL|member|data_dma
id|dma_addr_t
id|data_dma
suffix:semicolon
multiline_comment|/* our dma stuffage              */
DECL|member|features
r_struct
id|aiptek_features
id|features
suffix:semicolon
multiline_comment|/* tablet&squot;s array of features    */
DECL|member|curSetting
r_struct
id|aiptek_settings
id|curSetting
suffix:semicolon
multiline_comment|/* tablet&squot;s current programmable */
DECL|member|newSetting
r_struct
id|aiptek_settings
id|newSetting
suffix:semicolon
multiline_comment|/* ... and new param settings    */
DECL|member|ifnum
r_int
r_int
id|ifnum
suffix:semicolon
multiline_comment|/* interface number for IO       */
DECL|member|openCount
r_int
id|openCount
suffix:semicolon
multiline_comment|/* module use counter            */
DECL|member|diagnostic
r_int
id|diagnostic
suffix:semicolon
multiline_comment|/* tablet diagnostic codes       */
DECL|member|eventCount
r_int
r_int
id|eventCount
suffix:semicolon
multiline_comment|/* event count                   */
DECL|member|inDelay
r_int
id|inDelay
suffix:semicolon
multiline_comment|/* jitter: in jitter delay?      */
DECL|member|endDelay
r_int
r_int
id|endDelay
suffix:semicolon
multiline_comment|/* jitter: time when delay ends  */
DECL|member|previousJitterable
r_int
id|previousJitterable
suffix:semicolon
multiline_comment|/* jitterable prev value     */
DECL|member|data
r_int
r_char
op_star
id|data
suffix:semicolon
multiline_comment|/* incoming packet data          */
)brace
suffix:semicolon
multiline_comment|/*&n; * Permit easy lookup of keyboard events to send, versus&n; * the bitmap which comes from the tablet. This hides the&n; * issue that the F_keys are not sequentially numbered.&n; */
DECL|variable|macroKeyEvents
r_static
r_int
id|macroKeyEvents
(braket
)braket
op_assign
(brace
id|KEY_ESC
comma
id|KEY_F1
comma
id|KEY_F2
comma
id|KEY_F3
comma
id|KEY_F4
comma
id|KEY_F5
comma
id|KEY_F6
comma
id|KEY_F7
comma
id|KEY_F8
comma
id|KEY_F9
comma
id|KEY_F10
comma
id|KEY_F11
comma
id|KEY_F12
comma
id|KEY_F13
comma
id|KEY_F14
comma
id|KEY_F15
comma
id|KEY_F16
comma
id|KEY_F17
comma
id|KEY_F18
comma
id|KEY_F19
comma
id|KEY_F20
comma
id|KEY_F21
comma
id|KEY_F22
comma
id|KEY_F23
comma
id|KEY_F24
comma
id|KEY_STOP
comma
id|KEY_AGAIN
comma
id|KEY_PROPS
comma
id|KEY_UNDO
comma
id|KEY_FRONT
comma
id|KEY_COPY
comma
id|KEY_OPEN
comma
id|KEY_PASTE
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/***********************************************************************&n; * Relative reports deliver values in 2&squot;s complement format to&n; * deal with negative offsets.&n; */
DECL|function|aiptek_convert_from_2s_complement
r_static
r_int
id|aiptek_convert_from_2s_complement
c_func
(paren
r_int
r_char
id|c
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_char
id|b
op_assign
id|c
suffix:semicolon
r_int
id|negate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b
op_amp
l_int|0x80
)paren
op_ne
l_int|0
)paren
(brace
id|b
op_assign
op_complement
id|b
suffix:semicolon
id|b
op_decrement
suffix:semicolon
id|negate
op_assign
l_int|1
suffix:semicolon
)brace
id|ret
op_assign
id|b
suffix:semicolon
id|ret
op_assign
(paren
id|negate
op_eq
l_int|1
)paren
ques
c_cond
op_minus
id|ret
suffix:colon
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * aiptek_irq can receive one of six potential reports.&n; * The documentation for each is in the body of the function.&n; *&n; * The tablet reports on several attributes per invocation of&n; * aiptek_irq. Because the Linux Input Event system allows the&n; * transmission of ONE attribute per input_report_xxx() call,&n; * collation has to be done on the other end to reconstitute&n; * a complete tablet report. Further, the number of Input Event reports&n; * submitted varies, depending on what USB report type, and circumstance.&n; * To deal with this, EV_MSC is used to indicate an &squot;end-of-report&squot;&n; * message. This has been an undocumented convention understood by the kernel&n; * tablet driver and clients such as gpm and XFree86&squot;s tablet drivers.&n; *&n; * Of the information received from the tablet, the one piece I&n; * cannot transmit is the proximity bit (without resorting to an EV_MSC&n; * convention above.) I therefore have taken over REL_MISC and ABS_MISC&n; * (for relative and absolute reports, respectively) for communicating&n; * Proximity. Why two events? I thought it interesting to know if the&n; * Proximity event occured while the tablet was in absolute or relative&n; * mode.&n; *&n; * Other tablets use the notion of a certain minimum stylus pressure&n; * to infer proximity. While that could have been done, that is yet&n; * another &squot;by convention&squot; behavior, the documentation for which&n; * would be spread between two (or more) pieces of software.&n; *&n; * EV_MSC usage was terminated for this purpose in Linux 2.5.x, and&n; * replaced with the input_sync() method (which emits EV_SYN.)&n; */
DECL|function|aiptek_irq
r_static
r_void
id|aiptek_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
r_char
op_star
id|data
op_assign
id|aiptek-&gt;data
suffix:semicolon
r_struct
id|input_dev
op_star
id|inputdev
op_assign
op_amp
id|aiptek-&gt;inputdev
suffix:semicolon
r_int
id|jitterable
op_assign
l_int|0
suffix:semicolon
r_int
id|retval
comma
id|macro
comma
id|x
comma
id|y
comma
id|z
comma
id|left
comma
id|right
comma
id|middle
comma
id|p
comma
id|dv
comma
id|tip
comma
id|bs
comma
id|pck
suffix:semicolon
r_switch
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Success */
r_break
suffix:semicolon
r_case
op_minus
id|ECONNRESET
suffix:colon
r_case
op_minus
id|ENOENT
suffix:colon
r_case
op_minus
id|ESHUTDOWN
suffix:colon
multiline_comment|/* This urb is terminated, clean up */
id|dbg
c_func
(paren
l_string|&quot;%s - urb shutting down with status: %d&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|dbg
c_func
(paren
l_string|&quot;%s - nonzero urb status received: %d&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
multiline_comment|/* See if we are in a delay loop -- throw out report if true.&n;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;inDelay
op_eq
l_int|1
op_logical_and
id|time_after
c_func
(paren
id|aiptek-&gt;endDelay
comma
id|jiffies
)paren
)paren
(brace
r_goto
m_exit
suffix:semicolon
)brace
id|aiptek-&gt;inDelay
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;eventCount
op_increment
suffix:semicolon
multiline_comment|/* Report 1 delivers relative coordinates with either a stylus&n;&t; * or the mouse. You do not know, however, which input&n;&t; * tool generated the event.&n;&t; */
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.coordinateMode
op_eq
id|AIPTEK_COORDINATE_ABSOLUTE_MODE
)paren
(brace
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_SENDING_RELATIVE_IN_ABSOLUTE
suffix:semicolon
)brace
r_else
(brace
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
id|x
op_assign
id|aiptek_convert_from_2s_complement
c_func
(paren
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|y
op_assign
id|aiptek_convert_from_2s_complement
c_func
(paren
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
multiline_comment|/* jitterable keeps track of whether any button has been pressed.&n;&t;&t;&t; * We&squot;re also using it to remap the physical mouse button mask&n;&t;&t;&t; * to pseudo-settings. (We don&squot;t specifically care about it&squot;s&n;&t;&t;&t; * value after moving/transposing mouse button bitmasks, except&n;&t;&t;&t; * that a non-zero value indicates that one or more&n;&t;&t;&t; * mouse button was pressed.)&n;&t;&t;&t; */
id|jitterable
op_assign
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x07
suffix:semicolon
id|left
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonLeft
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|right
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonRight
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|middle
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonMiddle
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_LEFT
comma
id|left
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_MIDDLE
comma
id|middle
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_RIGHT
comma
id|right
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|REL_X
comma
id|x
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|REL_Y
comma
id|y
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|REL_MISC
comma
l_int|1
op_or
id|AIPTEK_REPORT_TOOL_UNKNOWN
)paren
suffix:semicolon
multiline_comment|/* Wheel support is in the form of a single-event&n;&t;&t;&t; * firing.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.wheel
op_ne
id|AIPTEK_WHEEL_DISABLE
)paren
(brace
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|REL_WHEEL
comma
id|aiptek-&gt;curSetting.wheel
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.wheel
op_assign
id|AIPTEK_WHEEL_DISABLE
suffix:semicolon
)brace
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Report 2 is delivered only by the stylus, and delivers&n;&t; * absolute coordinates.&n;&t; */
r_else
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.coordinateMode
op_eq
id|AIPTEK_COORDINATE_RELATIVE_MODE
)paren
(brace
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_SENDING_ABSOLUTE_IN_RELATIVE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|AIPTEK_POINTER_ALLOW_STYLUS_MODE
(paren
id|aiptek-&gt;curSetting.pointerMode
)paren
)paren
(brace
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_TOOL_DISALLOWED
suffix:semicolon
)brace
r_else
(brace
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
id|x
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|y
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|z
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|6
)paren
)paren
)paren
suffix:semicolon
id|p
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x01
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dv
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x02
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|tip
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x04
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* Use jitterable to re-arrange button masks&n;&t;&t;&t; */
id|jitterable
op_assign
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x18
suffix:semicolon
id|bs
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.stylusButtonLower
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|pck
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.stylusButtonUpper
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* dv indicates &squot;data valid&squot; (e.g., the tablet is in sync&n;&t;&t;&t; * and has delivered a &quot;correct&quot; report) We will ignore&n;&t;&t;&t; * all &squot;bad&squot; reports...&n;&t;&t;&t; */
r_if
c_cond
(paren
id|dv
op_ne
l_int|0
)paren
(brace
multiline_comment|/* If we&squot;ve not already sent a tool_button_?? code, do&n;&t;&t;&t;&t; * so now. Then set FIRED_BIT so it won&squot;t be resent unless&n;&t;&t;&t;&t; * the user forces FIRED_BIT off.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|TOOL_BUTTON_FIRED
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
op_eq
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
comma
l_int|1
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_or_assign
id|TOOL_BUTTON_FIRED_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_ne
l_int|0
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_X
comma
id|x
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_Y
comma
id|y
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_PRESSURE
comma
id|z
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_TOUCH
comma
id|tip
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_STYLUS
comma
id|bs
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_STYLUS2
comma
id|pck
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.xTilt
op_ne
id|AIPTEK_TILT_DISABLE
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_TILT_X
comma
id|aiptek-&gt;curSetting.xTilt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.yTilt
op_ne
id|AIPTEK_TILT_DISABLE
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_TILT_Y
comma
id|aiptek-&gt;curSetting.yTilt
)paren
suffix:semicolon
)brace
multiline_comment|/* Wheel support is in the form of a single-event&n;&t;&t;&t;&t;&t; * firing.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.wheel
op_ne
id|AIPTEK_WHEEL_DISABLE
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_WHEEL
comma
id|aiptek-&gt;curSetting.wheel
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.wheel
op_assign
id|AIPTEK_WHEEL_DISABLE
suffix:semicolon
)brace
)brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_MISC
comma
id|p
op_or
id|AIPTEK_REPORT_TOOL_STYLUS
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Report 3&squot;s come from the mouse in absolute mode.&n;&t; */
r_else
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.coordinateMode
op_eq
id|AIPTEK_COORDINATE_RELATIVE_MODE
)paren
(brace
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_SENDING_ABSOLUTE_IN_RELATIVE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|AIPTEK_POINTER_ALLOW_MOUSE_MODE
(paren
id|aiptek-&gt;curSetting.pointerMode
)paren
)paren
(brace
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_TOOL_DISALLOWED
suffix:semicolon
)brace
r_else
(brace
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
id|x
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|y
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|jitterable
op_assign
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x1c
suffix:semicolon
id|p
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x01
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dv
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
l_int|0x02
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|left
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonLeft
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|right
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonRight
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|middle
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonMiddle
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dv
op_ne
l_int|0
)paren
(brace
multiline_comment|/* If we&squot;ve not already sent a tool_button_?? code, do&n;&t;&t;&t;&t; * so now. Then set FIRED_BIT so it won&squot;t be resent unless&n;&t;&t;&t;&t; * the user forces FIRED_BIT off.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|TOOL_BUTTON_FIRED
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
op_eq
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
comma
l_int|1
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_or_assign
id|TOOL_BUTTON_FIRED_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_ne
l_int|0
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_X
comma
id|x
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_Y
comma
id|y
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_LEFT
comma
id|left
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_MIDDLE
comma
id|middle
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_RIGHT
comma
id|right
)paren
suffix:semicolon
multiline_comment|/* Wheel support is in the form of a single-event&n;&t;&t;&t;&t;&t; * firing.&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.wheel
op_ne
id|AIPTEK_WHEEL_DISABLE
)paren
(brace
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_WHEEL
comma
id|aiptek-&gt;curSetting.wheel
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.wheel
op_assign
id|AIPTEK_WHEEL_DISABLE
suffix:semicolon
)brace
)brace
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|REL_MISC
comma
id|p
op_or
id|AIPTEK_REPORT_TOOL_MOUSE
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Report 4s come from the macro keys when pressed by stylus&n;&t; */
r_else
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|4
)paren
(brace
id|jitterable
op_assign
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x18
suffix:semicolon
id|p
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x01
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dv
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x02
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|tip
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x04
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|bs
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|aiptek-&gt;curSetting.stylusButtonLower
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|pck
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|aiptek-&gt;curSetting.stylusButtonUpper
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|macro
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
id|z
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dv
op_ne
l_int|0
)paren
(brace
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* If we&squot;ve not already sent a tool_button_?? code, do&n;&t;&t;&t; * so now. Then set FIRED_BIT so it won&squot;t be resent unless&n;&t;&t;&t; * the user forces FIRED_BIT off.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|TOOL_BUTTON_FIRED
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
op_eq
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
comma
l_int|1
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_or_assign
id|TOOL_BUTTON_FIRED_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_ne
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_TOUCH
comma
id|tip
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_STYLUS
comma
id|bs
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_STYLUS2
comma
id|pck
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_PRESSURE
comma
id|z
)paren
suffix:semicolon
)brace
multiline_comment|/* For safety, we&squot;re sending key &squot;break&squot; codes for the&n;&t;&t;&t; * neighboring macro keys.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|macro
OG
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_minus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|macro
OL
l_int|25
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_plus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
)braket
comma
id|p
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_MISC
comma
id|p
op_or
id|AIPTEK_REPORT_TOOL_STYLUS
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Report 5s come from the macro keys when pressed by mouse&n;&t; */
r_else
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|5
)paren
(brace
id|jitterable
op_assign
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1c
suffix:semicolon
id|p
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x01
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dv
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x02
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|left
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonLeft
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|right
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonRight
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|middle
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|aiptek-&gt;curSetting.mouseButtonMiddle
)paren
op_ne
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|macro
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dv
op_ne
l_int|0
)paren
(brace
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* If we&squot;ve not already sent a tool_button_?? code, do&n;&t;&t;&t; * so now. Then set FIRED_BIT so it won&squot;t be resent unless&n;&t;&t;&t; * the user forces FIRED_BIT off.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|TOOL_BUTTON_FIRED
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
op_eq
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
comma
l_int|1
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_or_assign
id|TOOL_BUTTON_FIRED_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_ne
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_LEFT
comma
id|left
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_MIDDLE
comma
id|middle
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|inputdev
comma
id|BTN_RIGHT
comma
id|right
)paren
suffix:semicolon
)brace
multiline_comment|/* For safety, we&squot;re sending key &squot;break&squot; codes for the&n;&t;&t;&t; * neighboring macro keys.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|macro
OG
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_minus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|macro
OL
l_int|25
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_plus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
)braket
comma
l_int|1
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|inputdev
comma
id|ABS_MISC
comma
id|p
op_or
id|AIPTEK_REPORT_TOOL_MOUSE
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* We have no idea which tool can generate a report 6. Theoretically,&n;&t; * neither need to, having been given reports 4 &amp; 5 for such use.&n;&t; * However, report 6 is the &squot;official-looking&squot; report for macroKeys;&n;&t; * reports 4 &amp; 5 supposively are used to support unnamed, unknown&n;&t; * hat switches (which just so happen to be the macroKeys.)&n;&t; */
r_else
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
l_int|6
)paren
(brace
id|macro
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|data
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|input_regs
c_func
(paren
id|inputdev
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|macro
OG
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_minus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|macro
OL
l_int|25
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
op_plus
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* If we&squot;ve not already sent a tool_button_?? code, do&n;&t;&t; * so now. Then set FIRED_BIT so it won&squot;t be resent unless&n;&t;&t; * the user forces FIRED_BIT off.&n;&t;&t; */
r_if
c_cond
(paren
id|TOOL_BUTTON_FIRED
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
op_eq
l_int|0
)paren
(brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting
dot
id|toolMode
)paren
comma
l_int|1
)paren
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_or_assign
id|TOOL_BUTTON_FIRED_BIT
suffix:semicolon
)brace
id|input_report_key
c_func
(paren
id|inputdev
comma
id|macroKeyEvents
(braket
id|macro
)braket
comma
l_int|1
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
id|inputdev
comma
id|ABS_MISC
comma
l_int|1
op_or
id|AIPTEK_REPORT_TOOL_UNKNOWN
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|inputdev
)paren
suffix:semicolon
)brace
r_else
(brace
id|dbg
c_func
(paren
l_string|&quot;Unknown report %d&quot;
comma
id|data
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Jitter may occur when the user presses a button on the stlyus&n;&t; * or the mouse. What we do to prevent that is wait &squot;x&squot; milliseconds&n;&t; * following a &squot;jitterable&squot; event, which should give the hand some time&n;&t; * stabilize itself.&n;&t; *&n;&t; * We just introduced aiptek-&gt;previousJitterable to carry forth the&n;&t; * notion that jitter occurs when the button state changes from on to off:&n;&t; * a person drawing, holding a button down is not subject to jittering.&n;&t; * With that in mind, changing from upper button depressed to lower button&n;&t; * WILL transition through a jitter delay.&n;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;previousJitterable
op_ne
id|jitterable
op_logical_and
id|aiptek-&gt;curSetting.jitterDelay
op_ne
l_int|0
op_logical_and
id|aiptek-&gt;inDelay
op_ne
l_int|1
)paren
(brace
id|aiptek-&gt;endDelay
op_assign
id|jiffies
op_plus
(paren
(paren
id|aiptek-&gt;curSetting.jitterDelay
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
id|aiptek-&gt;inDelay
op_assign
l_int|1
suffix:semicolon
)brace
id|aiptek-&gt;previousJitterable
op_assign
id|jitterable
suffix:semicolon
m_exit
suffix:colon
id|retval
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s - usb_submit_urb failed with result %d&quot;
comma
id|__FUNCTION__
comma
id|retval
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/***********************************************************************&n; * These are the USB id&squot;s known so far. We do not identify them to&n; * specific Aiptek model numbers, because there has been overlaps,&n; * use, and reuse of id&squot;s in existing models. Certain models have&n; * been known to use more than one ID, indicative perhaps of&n; * manufacturing revisions. In any event, we consider these &n; * IDs to not be model-specific nor unique.&n; */
DECL|variable|aiptek_ids
r_struct
id|usb_device_id
id|aiptek_ids
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x01
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x10
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x20
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x21
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x22
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x23
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|USB_VENDOR_ID_AIPTEK
comma
l_int|0x24
)paren
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|aiptek_ids
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * Open an instance of the tablet driver.&n; */
DECL|function|aiptek_open
r_static
r_int
id|aiptek_open
c_func
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|inputdev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;openCount
op_increment
OG
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|aiptek-&gt;urb-&gt;dev
op_assign
id|aiptek-&gt;usbdev
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
id|aiptek-&gt;urb
comma
id|GFP_KERNEL
)paren
op_ne
l_int|0
)paren
(brace
id|aiptek-&gt;openCount
op_decrement
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * Close an instance of the tablet driver.&n; */
DECL|function|aiptek_close
r_static
r_void
id|aiptek_close
c_func
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|inputdev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|aiptek-&gt;openCount
op_eq
l_int|0
)paren
(brace
id|usb_kill_urb
c_func
(paren
id|aiptek-&gt;urb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/***********************************************************************&n; * aiptek_set_report and aiptek_get_report() are borrowed from Linux 2.4.x, &n; * where they were known as usb_set_report and usb_get_report.&n; */
r_static
r_int
DECL|function|aiptek_set_report
id|aiptek_set_report
c_func
(paren
r_struct
id|aiptek
op_star
id|aiptek
comma
r_int
r_char
id|report_type
comma
r_int
r_char
id|report_id
comma
r_void
op_star
id|buffer
comma
r_int
id|size
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|aiptek-&gt;usbdev
comma
id|usb_sndctrlpipe
c_func
(paren
id|aiptek-&gt;usbdev
comma
l_int|0
)paren
comma
id|USB_REQ_SET_REPORT
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_INTERFACE
op_or
id|USB_DIR_OUT
comma
(paren
id|report_type
op_lshift
l_int|8
)paren
op_plus
id|report_id
comma
id|aiptek-&gt;ifnum
comma
id|buffer
comma
id|size
comma
l_int|5
op_star
id|HZ
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|aiptek_get_report
id|aiptek_get_report
c_func
(paren
r_struct
id|aiptek
op_star
id|aiptek
comma
r_int
r_char
id|report_type
comma
r_int
r_char
id|report_id
comma
r_void
op_star
id|buffer
comma
r_int
id|size
)paren
(brace
r_return
id|usb_control_msg
c_func
(paren
id|aiptek-&gt;usbdev
comma
id|usb_rcvctrlpipe
c_func
(paren
id|aiptek-&gt;usbdev
comma
l_int|0
)paren
comma
id|USB_REQ_GET_REPORT
comma
id|USB_TYPE_CLASS
op_or
id|USB_RECIP_INTERFACE
op_or
id|USB_DIR_IN
comma
(paren
id|report_type
op_lshift
l_int|8
)paren
op_plus
id|report_id
comma
id|aiptek-&gt;ifnum
comma
id|buffer
comma
id|size
comma
l_int|5
op_star
id|HZ
)paren
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * Send a command to the tablet.&n; */
r_static
r_int
DECL|function|aiptek_command
id|aiptek_command
c_func
(paren
r_struct
id|aiptek
op_star
id|aiptek
comma
r_int
r_char
id|command
comma
r_int
r_char
id|data
)paren
(brace
r_const
r_int
id|sizeof_buf
op_assign
l_int|3
op_star
r_sizeof
(paren
id|u8
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|u8
op_star
id|buf
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|sizeof_buf
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|2
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_set_report
c_func
(paren
id|aiptek
comma
l_int|3
comma
l_int|2
comma
id|buf
comma
id|sizeof_buf
)paren
)paren
op_ne
id|sizeof_buf
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;aiptek_program: failed, tried to send: 0x%02x 0x%02x&quot;
comma
id|command
comma
id|data
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|ret
OL
l_int|0
ques
c_cond
id|ret
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * Retrieve information from the tablet. Querying info is defined as first&n; * sending the {command,data} sequence as a command, followed by a wait&n; * (aka, &quot;programmaticDelay&quot;) and then a &quot;read&quot; request.&n; */
r_static
r_int
DECL|function|aiptek_query
id|aiptek_query
c_func
(paren
r_struct
id|aiptek
op_star
id|aiptek
comma
r_int
r_char
id|command
comma
r_int
r_char
id|data
)paren
(brace
r_const
r_int
id|sizeof_buf
op_assign
l_int|3
op_star
r_sizeof
(paren
id|u8
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|u8
op_star
id|buf
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|sizeof_buf
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|2
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|aiptek_command
c_func
(paren
id|aiptek
comma
id|command
comma
id|data
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|msleep
c_func
(paren
id|aiptek-&gt;curSetting.programmableDelay
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_get_report
c_func
(paren
id|aiptek
comma
l_int|3
comma
l_int|2
comma
id|buf
comma
id|sizeof_buf
)paren
)paren
op_ne
id|sizeof_buf
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;aiptek_query failed: returned 0x%02x 0x%02x 0x%02x&quot;
comma
id|buf
(braket
l_int|0
)braket
comma
id|buf
(braket
l_int|1
)braket
comma
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|le16_to_cpu
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|__le16
op_star
)paren
(paren
id|buf
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * Program the tablet into either absolute or relative mode.&n; * We also get information about the tablet&squot;s size.&n; */
DECL|function|aiptek_program_tablet
r_static
r_int
id|aiptek_program_tablet
c_func
(paren
r_struct
id|aiptek
op_star
id|aiptek
)paren
(brace
r_int
id|ret
suffix:semicolon
multiline_comment|/* Execute Resolution500LPI */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x18
comma
l_int|0x04
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/* Query getModelCode */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x02
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;features.modelCode
op_assign
id|ret
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* Query getODMCode */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x03
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;features.odmCode
op_assign
id|ret
suffix:semicolon
multiline_comment|/* Query getFirmwareCode */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x04
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;features.firmwareCode
op_assign
id|ret
suffix:semicolon
multiline_comment|/* Query getXextension */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x01
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_X
)braket
op_assign
id|ret
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Query getYextension */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x01
comma
l_int|0x01
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_Y
)braket
op_assign
id|ret
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Query getPressureLevels */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_query
c_func
(paren
id|aiptek
comma
l_int|0x08
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_PRESSURE
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_PRESSURE
)braket
op_assign
id|ret
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Depending on whether we are in absolute or relative mode, we will&n;&t; * do a switchToTablet(absolute) or switchToMouse(relative) command.&n;&t; */
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.coordinateMode
op_eq
id|AIPTEK_COORDINATE_ABSOLUTE_MODE
)paren
(brace
multiline_comment|/* Execute switchToTablet */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x10
comma
l_int|0x01
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Execute switchToMouse */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x10
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
)brace
multiline_comment|/* Enable the macro keys */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x11
comma
l_int|0x02
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Execute FilterOn */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x17
comma
l_int|0x00
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
macro_line|#endif
multiline_comment|/* Execute AutoGainOn */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aiptek_command
c_func
(paren
id|aiptek
comma
l_int|0x12
comma
l_int|0xff
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
multiline_comment|/* Reset the eventCount, so we track events from last (re)programming&n;&t; */
id|aiptek-&gt;diagnostic
op_assign
id|AIPTEK_DIAGNOSTIC_NA
suffix:semicolon
id|aiptek-&gt;eventCount
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * Sysfs functions. Sysfs prefers that individually-tunable parameters&n; * exist in their separate pseudo-files. Summary data that is immutable&n; * may exist in a singular file so long as you don&squot;t define a writeable&n; * interface.&n; */
multiline_comment|/***********************************************************************&n; * support the &squot;size&squot; file -- display support&n; */
DECL|function|show_tabletSize
r_static
id|ssize_t
id|show_tabletSize
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%dx%d&bslash;n&quot;
comma
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_X
)braket
op_plus
l_int|1
comma
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_Y
)braket
op_plus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* These structs define the sysfs files, param #1 is the name of the&n; * file, param 2 is the file permissions, param 3 &amp; 4 are to the&n; * output generator and input parser routines. Absence of a routine is&n; * permitted -- it only means can&squot;t either &squot;cat&squot; the file, or send data&n; * to it.&n; */
r_static
id|DEVICE_ATTR
c_func
(paren
id|size
comma
id|S_IRUGO
comma
id|show_tabletSize
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;product_id&squot; file&n; */
DECL|function|show_tabletProductId
r_static
id|ssize_t
id|show_tabletProductId
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|aiptek-&gt;inputdev.id.product
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|product_id
comma
id|S_IRUGO
comma
id|show_tabletProductId
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;vendor_id&squot; file&n; */
DECL|function|show_tabletVendorId
r_static
id|ssize_t
id|show_tabletVendorId
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|aiptek-&gt;inputdev.id.vendor
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|vendor_id
comma
id|S_IRUGO
comma
id|show_tabletVendorId
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;vendor&squot; file&n; */
DECL|function|show_tabletManufacturer
r_static
id|ssize_t
id|show_tabletManufacturer
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|retval
op_assign
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|aiptek-&gt;features.manuName
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|vendor
comma
id|S_IRUGO
comma
id|show_tabletManufacturer
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;product&squot; file&n; */
DECL|function|show_tabletProduct
r_static
id|ssize_t
id|show_tabletProduct
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|retval
op_assign
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|aiptek-&gt;features.prodName
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|product
comma
id|S_IRUGO
comma
id|show_tabletProduct
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;pointer_mode&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletPointerMode
r_static
id|ssize_t
id|show_tabletPointerMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.pointerMode
)paren
(brace
r_case
id|AIPTEK_POINTER_ONLY_STYLUS_MODE
suffix:colon
id|s
op_assign
l_string|&quot;stylus&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_POINTER_ONLY_MOUSE_MODE
suffix:colon
id|s
op_assign
l_string|&quot;mouse&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_POINTER_EITHER_MODE
suffix:colon
id|s
op_assign
l_string|&quot;either&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletPointerMode
id|store_tabletPointerMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;stylus&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.pointerMode
op_assign
id|AIPTEK_POINTER_ONLY_STYLUS_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;mouse&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.pointerMode
op_assign
id|AIPTEK_POINTER_ONLY_MOUSE_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;either&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.pointerMode
op_assign
id|AIPTEK_POINTER_EITHER_MODE
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|pointer_mode
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletPointerMode
comma
id|store_tabletPointerMode
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;coordinate_mode&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletCoordinateMode
r_static
id|ssize_t
id|show_tabletCoordinateMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.coordinateMode
)paren
(brace
r_case
id|AIPTEK_COORDINATE_ABSOLUTE_MODE
suffix:colon
id|s
op_assign
l_string|&quot;absolute&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_COORDINATE_RELATIVE_MODE
suffix:colon
id|s
op_assign
l_string|&quot;relative&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletCoordinateMode
id|store_tabletCoordinateMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;absolute&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.pointerMode
op_assign
id|AIPTEK_COORDINATE_ABSOLUTE_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;relative&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.pointerMode
op_assign
id|AIPTEK_COORDINATE_RELATIVE_MODE
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|coordinate_mode
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletCoordinateMode
comma
id|store_tabletCoordinateMode
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;tool_mode&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletToolMode
r_static
id|ssize_t
id|show_tabletToolMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|TOOL_BUTTON
c_func
(paren
id|aiptek-&gt;curSetting.toolMode
)paren
)paren
(brace
r_case
id|AIPTEK_TOOL_BUTTON_MOUSE_MODE
suffix:colon
id|s
op_assign
l_string|&quot;mouse&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_ERASER_MODE
suffix:colon
id|s
op_assign
l_string|&quot;eraser&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_PENCIL_MODE
suffix:colon
id|s
op_assign
l_string|&quot;pencil&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_PEN_MODE
suffix:colon
id|s
op_assign
l_string|&quot;pen&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_BRUSH_MODE
suffix:colon
id|s
op_assign
l_string|&quot;brush&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_AIRBRUSH_MODE
suffix:colon
id|s
op_assign
l_string|&quot;airbrush&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_TOOL_BUTTON_LENS_MODE
suffix:colon
id|s
op_assign
l_string|&quot;lens&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletToolMode
id|store_tabletToolMode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;mouse&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_MOUSE_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;eraser&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_ERASER_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;pencil&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_PENCIL_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;pen&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_PEN_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;brush&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_BRUSH_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;airbrush&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_AIRBRUSH_MODE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;lens&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_LENS_MODE
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|tool_mode
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletToolMode
comma
id|store_tabletToolMode
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;xtilt&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletXtilt
r_static
id|ssize_t
id|show_tabletXtilt
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.xTilt
op_eq
id|AIPTEK_TILT_DISABLE
)paren
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;disable&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.xTilt
)paren
suffix:semicolon
)brace
)brace
r_static
id|ssize_t
DECL|function|store_tabletXtilt
id|store_tabletXtilt
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|x
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.xTilt
op_assign
id|AIPTEK_TILT_DISABLE
suffix:semicolon
)brace
r_else
(brace
id|x
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
id|AIPTEK_TILT_MIN
op_logical_and
id|x
op_le
id|AIPTEK_TILT_MAX
)paren
(brace
id|aiptek-&gt;newSetting.xTilt
op_assign
id|x
suffix:semicolon
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|xtilt
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletXtilt
comma
id|store_tabletXtilt
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;ytilt&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletYtilt
r_static
id|ssize_t
id|show_tabletYtilt
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.yTilt
op_eq
id|AIPTEK_TILT_DISABLE
)paren
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;disable&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.yTilt
)paren
suffix:semicolon
)brace
)brace
r_static
id|ssize_t
DECL|function|store_tabletYtilt
id|store_tabletYtilt
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|y
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.yTilt
op_assign
id|AIPTEK_TILT_DISABLE
suffix:semicolon
)brace
r_else
(brace
id|y
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|y
op_ge
id|AIPTEK_TILT_MIN
op_logical_and
id|y
op_le
id|AIPTEK_TILT_MAX
)paren
(brace
id|aiptek-&gt;newSetting.yTilt
op_assign
id|y
suffix:semicolon
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|ytilt
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletYtilt
comma
id|store_tabletYtilt
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;jitter&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletJitterDelay
r_static
id|ssize_t
id|show_tabletJitterDelay
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.jitterDelay
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletJitterDelay
id|store_tabletJitterDelay
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|aiptek-&gt;newSetting.jitterDelay
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|jitter
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletJitterDelay
comma
id|store_tabletJitterDelay
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;delay&squot; file. Note that this file&n; * both displays current setting and allows reprogramming.&n; */
DECL|function|show_tabletProgrammableDelay
r_static
id|ssize_t
id|show_tabletProgrammableDelay
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.programmableDelay
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletProgrammableDelay
id|store_tabletProgrammableDelay
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|aiptek-&gt;newSetting.programmableDelay
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|delay
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletProgrammableDelay
comma
id|store_tabletProgrammableDelay
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;input_path&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_tabletInputDevice
r_static
id|ssize_t
id|show_tabletInputDevice
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;/dev/input/%s&bslash;n&quot;
comma
id|aiptek-&gt;features.inputPath
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|input_path
comma
id|S_IRUGO
comma
id|show_tabletInputDevice
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;event_count&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_tabletEventsReceived
r_static
id|ssize_t
id|show_tabletEventsReceived
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|aiptek-&gt;eventCount
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|event_count
comma
id|S_IRUGO
comma
id|show_tabletEventsReceived
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;diagnostic&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_tabletDiagnosticMessage
r_static
id|ssize_t
id|show_tabletDiagnosticMessage
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|retMsg
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;diagnostic
)paren
(brace
r_case
id|AIPTEK_DIAGNOSTIC_NA
suffix:colon
id|retMsg
op_assign
l_string|&quot;no errors&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_DIAGNOSTIC_SENDING_RELATIVE_IN_ABSOLUTE
suffix:colon
id|retMsg
op_assign
l_string|&quot;Error: receiving relative reports&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_DIAGNOSTIC_SENDING_ABSOLUTE_IN_RELATIVE
suffix:colon
id|retMsg
op_assign
l_string|&quot;Error: receiving absolute reports&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_DIAGNOSTIC_TOOL_DISALLOWED
suffix:colon
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.pointerMode
op_eq
id|AIPTEK_POINTER_ONLY_MOUSE_MODE
)paren
(brace
id|retMsg
op_assign
l_string|&quot;Error: receiving stylus reports&bslash;n&quot;
suffix:semicolon
)brace
r_else
(brace
id|retMsg
op_assign
l_string|&quot;Error: receiving mouse reports&bslash;n&quot;
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
id|retMsg
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|diagnostic
comma
id|S_IRUGO
comma
id|show_tabletDiagnosticMessage
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;stylus_upper&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletStylusUpper
r_static
id|ssize_t
id|show_tabletStylusUpper
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.stylusButtonUpper
)paren
(brace
r_case
id|AIPTEK_STYLUS_UPPER_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;upper&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_STYLUS_LOWER_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;lower&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletStylusUpper
id|store_tabletStylusUpper
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;upper&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.stylusButtonUpper
op_assign
id|AIPTEK_STYLUS_UPPER_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;lower&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.stylusButtonUpper
op_assign
id|AIPTEK_STYLUS_LOWER_BUTTON
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|stylus_upper
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletStylusUpper
comma
id|store_tabletStylusUpper
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;stylus_lower&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletStylusLower
r_static
id|ssize_t
id|show_tabletStylusLower
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.stylusButtonLower
)paren
(brace
r_case
id|AIPTEK_STYLUS_UPPER_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;upper&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_STYLUS_LOWER_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;lower&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletStylusLower
id|store_tabletStylusLower
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;upper&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.stylusButtonLower
op_assign
id|AIPTEK_STYLUS_UPPER_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;lower&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.stylusButtonLower
op_assign
id|AIPTEK_STYLUS_LOWER_BUTTON
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|stylus_lower
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletStylusLower
comma
id|store_tabletStylusLower
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;mouse_left&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletMouseLeft
r_static
id|ssize_t
id|show_tabletMouseLeft
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.mouseButtonLeft
)paren
(brace
r_case
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;left&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;middle&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;right&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletMouseLeft
id|store_tabletMouseLeft
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;left&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonLeft
op_assign
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;middle&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonLeft
op_assign
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;right&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonLeft
op_assign
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|mouse_left
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletMouseLeft
comma
id|store_tabletMouseLeft
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;mouse_middle&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletMouseMiddle
r_static
id|ssize_t
id|show_tabletMouseMiddle
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.mouseButtonMiddle
)paren
(brace
r_case
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;left&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;middle&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;right&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletMouseMiddle
id|store_tabletMouseMiddle
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;left&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonMiddle
op_assign
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;middle&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonMiddle
op_assign
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;right&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonMiddle
op_assign
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|mouse_middle
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletMouseMiddle
comma
id|store_tabletMouseMiddle
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;mouse_right&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletMouseRight
r_static
id|ssize_t
id|show_tabletMouseRight
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aiptek-&gt;curSetting.mouseButtonRight
)paren
(brace
r_case
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;left&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;middle&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:colon
id|s
op_assign
l_string|&quot;right&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletMouseRight
id|store_tabletMouseRight
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;left&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonRight
op_assign
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;middle&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonRight
op_assign
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|buf
comma
l_string|&quot;right&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|aiptek-&gt;newSetting.mouseButtonRight
op_assign
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|mouse_right
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletMouseRight
comma
id|store_tabletMouseRight
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;wheel&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletWheel
r_static
id|ssize_t
id|show_tabletWheel
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;curSetting.wheel
op_eq
id|AIPTEK_WHEEL_DISABLE
)paren
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;disable&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.wheel
)paren
suffix:semicolon
)brace
)brace
r_static
id|ssize_t
DECL|function|store_tabletWheel
id|store_tabletWheel
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|aiptek-&gt;newSetting.wheel
op_assign
(paren
r_int
)paren
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|wheel
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletWheel
comma
id|store_tabletWheel
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;execute&squot; file. Note that this file&n; * both displays current setting and allows for setting changing.&n; */
DECL|function|show_tabletExecute
r_static
id|ssize_t
id|show_tabletExecute
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* There is nothing useful to display, so a one-line manual&n;&t; * is in order...&n;&t; */
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;Write anything to this file to program your tablet.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_tabletExecute
id|store_tabletExecute
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* We do not care what you write to this file. Merely the action&n;&t; * of writing to this file triggers a tablet reprogramming.&n;&t; */
id|memcpy
c_func
(paren
op_amp
id|aiptek-&gt;curSetting
comma
op_amp
id|aiptek-&gt;newSetting
comma
r_sizeof
(paren
r_struct
id|aiptek_settings
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek_program_tablet
c_func
(paren
id|aiptek
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|execute
comma
id|S_IRUGO
op_or
id|S_IWUGO
comma
id|show_tabletExecute
comma
id|store_tabletExecute
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;odm_code&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_tabletODMCode
r_static
id|ssize_t
id|show_tabletODMCode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|aiptek-&gt;features.odmCode
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|odm_code
comma
id|S_IRUGO
comma
id|show_tabletODMCode
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;model_code&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_tabletModelCode
r_static
id|ssize_t
id|show_tabletModelCode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;0x%04x&bslash;n&quot;
comma
id|aiptek-&gt;features.modelCode
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|model_code
comma
id|S_IRUGO
comma
id|show_tabletModelCode
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * support routines for the &squot;firmware_code&squot; file. Note that this file&n; * only displays current setting.&n; */
DECL|function|show_firmwareCode
r_static
id|ssize_t
id|show_firmwareCode
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snprintf
c_func
(paren
id|buf
comma
id|PAGE_SIZE
comma
l_string|&quot;%04x&bslash;n&quot;
comma
id|aiptek-&gt;features.firmwareCode
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|firmware_code
comma
id|S_IRUGO
comma
id|show_firmwareCode
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/***********************************************************************&n; * This routine removes all existing sysfs files managed by this device&n; * driver.&n; */
DECL|function|aiptek_delete_files
r_static
r_void
id|aiptek_delete_files
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_size
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_product_id
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_vendor_id
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_vendor
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_product
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_pointer_mode
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_coordinate_mode
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_tool_mode
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_xtilt
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_ytilt
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_jitter
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_delay
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_input_path
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_event_count
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_diagnostic
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_odm_code
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_model_code
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_firmware_code
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_stylus_lower
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_stylus_upper
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_left
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_middle
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_right
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_wheel
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_execute
)paren
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * This routine creates the sysfs files managed by this device&n; * driver.&n; */
DECL|function|aiptek_add_files
r_static
r_int
id|aiptek_add_files
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_size
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_product_id
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_vendor_id
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_vendor
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_product
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_pointer_mode
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_coordinate_mode
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_tool_mode
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_xtilt
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_ytilt
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_jitter
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_delay
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_input_path
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_event_count
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_diagnostic
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_odm_code
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_model_code
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_firmware_code
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_stylus_lower
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_stylus_upper
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_left
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_middle
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_mouse_right
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_wheel
)paren
)paren
op_logical_or
(paren
id|ret
op_assign
id|device_create_file
c_func
(paren
id|dev
comma
op_amp
id|dev_attr_execute
)paren
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;aiptek: killing own sysfs device files&bslash;n&quot;
)paren
suffix:semicolon
id|aiptek_delete_files
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/***********************************************************************&n; * This routine is called when a tablet has been identified. It basically&n; * sets up the tablet and the driver&squot;s internal structures.&n; */
r_static
r_int
DECL|function|aiptek_probe
id|aiptek_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|usbdev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint
suffix:semicolon
r_struct
id|aiptek
op_star
id|aiptek
suffix:semicolon
r_struct
id|input_dev
op_star
id|inputdev
suffix:semicolon
r_struct
id|input_handle
op_star
id|inputhandle
suffix:semicolon
r_struct
id|list_head
op_star
id|node
comma
op_star
id|next
suffix:semicolon
r_char
id|path
(braket
l_int|64
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|speeds
(braket
)braket
op_assign
(brace
l_int|0
comma
id|AIPTEK_PROGRAMMABLE_DELAY_50
comma
id|AIPTEK_PROGRAMMABLE_DELAY_400
comma
id|AIPTEK_PROGRAMMABLE_DELAY_25
comma
id|AIPTEK_PROGRAMMABLE_DELAY_100
comma
id|AIPTEK_PROGRAMMABLE_DELAY_200
comma
id|AIPTEK_PROGRAMMABLE_DELAY_300
)brace
suffix:semicolon
multiline_comment|/* programmableDelay is where the command-line specified&n;&t; * delay is kept. We make it the first element of speeds[],&n;&t; * so therefore, your override speed is tried first, then the&n;&t; * remainder. Note that the default value of 400ms will be tried&n;&t; * if you do not specify any command line parameter.&n;&t; */
id|speeds
(braket
l_int|0
)braket
op_assign
id|programmableDelay
suffix:semicolon
r_if
c_cond
(paren
(paren
id|aiptek
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|aiptek
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|aiptek
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|aiptek
)paren
)paren
suffix:semicolon
id|aiptek-&gt;data
op_assign
id|usb_buffer_alloc
c_func
(paren
id|usbdev
comma
id|AIPTEK_PACKET_LENGTH
comma
id|SLAB_ATOMIC
comma
op_amp
id|aiptek-&gt;data_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;data
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|aiptek
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|aiptek-&gt;urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;urb
op_eq
l_int|NULL
)paren
(brace
id|usb_buffer_free
c_func
(paren
id|usbdev
comma
id|AIPTEK_PACKET_LENGTH
comma
id|aiptek-&gt;data
comma
id|aiptek-&gt;data_dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|aiptek
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Set up the curSettings struct. Said struct contains the current&n;&t; * programmable parameters. The newSetting struct contains changes&n;&t; * the user makes to the settings via the sysfs interface. Those&n;&t; * changes are not &quot;committed&quot; to curSettings until the user&n;&t; * writes to the sysfs/.../execute file.&n;&t; */
id|aiptek-&gt;curSetting.pointerMode
op_assign
id|AIPTEK_POINTER_EITHER_MODE
suffix:semicolon
id|aiptek-&gt;curSetting.coordinateMode
op_assign
id|AIPTEK_COORDINATE_ABSOLUTE_MODE
suffix:semicolon
id|aiptek-&gt;curSetting.toolMode
op_assign
id|AIPTEK_TOOL_BUTTON_PEN_MODE
suffix:semicolon
id|aiptek-&gt;curSetting.xTilt
op_assign
id|AIPTEK_TILT_DISABLE
suffix:semicolon
id|aiptek-&gt;curSetting.yTilt
op_assign
id|AIPTEK_TILT_DISABLE
suffix:semicolon
id|aiptek-&gt;curSetting.mouseButtonLeft
op_assign
id|AIPTEK_MOUSE_LEFT_BUTTON
suffix:semicolon
id|aiptek-&gt;curSetting.mouseButtonMiddle
op_assign
id|AIPTEK_MOUSE_MIDDLE_BUTTON
suffix:semicolon
id|aiptek-&gt;curSetting.mouseButtonRight
op_assign
id|AIPTEK_MOUSE_RIGHT_BUTTON
suffix:semicolon
id|aiptek-&gt;curSetting.stylusButtonUpper
op_assign
id|AIPTEK_STYLUS_UPPER_BUTTON
suffix:semicolon
id|aiptek-&gt;curSetting.stylusButtonLower
op_assign
id|AIPTEK_STYLUS_LOWER_BUTTON
suffix:semicolon
id|aiptek-&gt;curSetting.jitterDelay
op_assign
id|jitterDelay
suffix:semicolon
id|aiptek-&gt;curSetting.programmableDelay
op_assign
id|programmableDelay
suffix:semicolon
multiline_comment|/* Both structs should have equivalent settings&n;&t; */
id|memcpy
c_func
(paren
op_amp
id|aiptek-&gt;newSetting
comma
op_amp
id|aiptek-&gt;curSetting
comma
r_sizeof
(paren
r_struct
id|aiptek_settings
)paren
)paren
suffix:semicolon
multiline_comment|/* Now program the capacities of the tablet, in terms of being&n;&t; * an input device.&n;&t; */
id|aiptek-&gt;inputdev.evbit
(braket
l_int|0
)braket
op_or_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_ABS
)paren
op_or
id|BIT
c_func
(paren
id|EV_REL
)paren
op_or
id|BIT
c_func
(paren
id|EV_MSC
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.absbit
(braket
l_int|0
)braket
op_or_assign
(paren
id|BIT
c_func
(paren
id|ABS_X
)paren
op_or
id|BIT
c_func
(paren
id|ABS_Y
)paren
op_or
id|BIT
c_func
(paren
id|ABS_PRESSURE
)paren
op_or
id|BIT
c_func
(paren
id|ABS_TILT_X
)paren
op_or
id|BIT
c_func
(paren
id|ABS_TILT_Y
)paren
op_or
id|BIT
c_func
(paren
id|ABS_WHEEL
)paren
op_or
id|BIT
c_func
(paren
id|ABS_MISC
)paren
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.relbit
(braket
l_int|0
)braket
op_or_assign
(paren
id|BIT
c_func
(paren
id|REL_X
)paren
op_or
id|BIT
c_func
(paren
id|REL_Y
)paren
op_or
id|BIT
c_func
(paren
id|REL_WHEEL
)paren
op_or
id|BIT
c_func
(paren
id|REL_MISC
)paren
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.keybit
(braket
id|LONG
c_func
(paren
id|BTN_LEFT
)paren
)braket
op_or_assign
(paren
id|BIT
c_func
(paren
id|BTN_LEFT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_RIGHT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_MIDDLE
)paren
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.keybit
(braket
id|LONG
c_func
(paren
id|BTN_DIGI
)paren
)braket
op_or_assign
(paren
id|BIT
c_func
(paren
id|BTN_TOOL_PEN
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_RUBBER
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_PENCIL
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_AIRBRUSH
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_BRUSH
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_MOUSE
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOOL_LENS
)paren
op_or
id|BIT
c_func
(paren
id|BTN_TOUCH
)paren
op_or
id|BIT
c_func
(paren
id|BTN_STYLUS
)paren
op_or
id|BIT
c_func
(paren
id|BTN_STYLUS2
)paren
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.mscbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|MSC_SERIAL
)paren
suffix:semicolon
multiline_comment|/* Programming the tablet macro keys needs to be done with a for loop&n;&t; * as the keycodes are discontiguous.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|macroKeyEvents
)paren
op_div
r_sizeof
(paren
id|macroKeyEvents
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
id|set_bit
c_func
(paren
id|macroKeyEvents
(braket
id|i
)braket
comma
id|aiptek-&gt;inputdev.keybit
)paren
suffix:semicolon
multiline_comment|/* Set up client data, pointers to open and close routines&n;&t; * for the input device.&n;&t; */
id|aiptek-&gt;inputdev
dot
r_private
op_assign
id|aiptek
suffix:semicolon
id|aiptek-&gt;inputdev.open
op_assign
id|aiptek_open
suffix:semicolon
id|aiptek-&gt;inputdev.close
op_assign
id|aiptek_close
suffix:semicolon
multiline_comment|/* Determine the usb devices&squot; physical path.&n;&t; * Asketh not why we always pretend we&squot;re using &quot;../input0&quot;,&n;&t; * but I suspect this will have to be refactored one&n;&t; * day if a single USB device can be a keyboard &amp; a mouse&n;&t; * &amp; a tablet, and the inputX number actually will tell&n;&t; * us something...&n;&t; */
r_if
c_cond
(paren
id|usb_make_path
c_func
(paren
id|usbdev
comma
id|path
comma
l_int|64
)paren
OG
l_int|0
)paren
id|sprintf
c_func
(paren
id|aiptek-&gt;features.usbPath
comma
l_string|&quot;%s/input0&quot;
comma
id|path
)paren
suffix:semicolon
multiline_comment|/* Program the input device coordinate capacities. We do not yet&n;&t; * know what maximum X, Y, and Z values are, so we&squot;re putting fake&n;&t; * values in. Later, we&squot;ll ask the tablet to put in the correct&n;&t; * values.&n;&t; */
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_X
)braket
op_assign
l_int|2999
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_Y
)braket
op_assign
l_int|2249
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_PRESSURE
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_PRESSURE
)braket
op_assign
l_int|511
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_TILT_X
)braket
op_assign
id|AIPTEK_TILT_MIN
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_TILT_X
)braket
op_assign
id|AIPTEK_TILT_MAX
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_TILT_Y
)braket
op_assign
id|AIPTEK_TILT_MIN
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_TILT_Y
)braket
op_assign
id|AIPTEK_TILT_MAX
suffix:semicolon
id|aiptek-&gt;inputdev.absmin
(braket
id|ABS_WHEEL
)braket
op_assign
id|AIPTEK_WHEEL_MIN
suffix:semicolon
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_WHEEL
)braket
op_assign
id|AIPTEK_WHEEL_MAX
op_minus
l_int|1
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_PRESSURE
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_TILT_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_TILT_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absfuzz
(braket
id|ABS_WHEEL
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_PRESSURE
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_TILT_X
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_TILT_Y
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.absflat
(braket
id|ABS_WHEEL
)braket
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;inputdev.name
op_assign
l_string|&quot;Aiptek&quot;
suffix:semicolon
id|aiptek-&gt;inputdev.phys
op_assign
id|aiptek-&gt;features.usbPath
suffix:semicolon
id|aiptek-&gt;inputdev.id.bustype
op_assign
id|BUS_USB
suffix:semicolon
id|aiptek-&gt;inputdev.id.vendor
op_assign
id|le16_to_cpu
c_func
(paren
id|usbdev-&gt;descriptor.idVendor
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.id.product
op_assign
id|le16_to_cpu
c_func
(paren
id|usbdev-&gt;descriptor.idProduct
)paren
suffix:semicolon
id|aiptek-&gt;inputdev.id.version
op_assign
id|le16_to_cpu
c_func
(paren
id|usbdev-&gt;descriptor.bcdDevice
)paren
suffix:semicolon
id|aiptek-&gt;usbdev
op_assign
id|usbdev
suffix:semicolon
id|aiptek-&gt;ifnum
op_assign
id|intf-&gt;altsetting
(braket
l_int|0
)braket
dot
id|desc.bInterfaceNumber
suffix:semicolon
id|aiptek-&gt;inDelay
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;endDelay
op_assign
l_int|0
suffix:semicolon
id|aiptek-&gt;previousJitterable
op_assign
l_int|0
suffix:semicolon
id|endpoint
op_assign
op_amp
id|intf-&gt;altsetting
(braket
l_int|0
)braket
dot
id|endpoint
(braket
l_int|0
)braket
dot
id|desc
suffix:semicolon
multiline_comment|/* Go set up our URB, which is called when the tablet receives&n;&t; * input.&n;&t; */
id|usb_fill_int_urb
c_func
(paren
id|aiptek-&gt;urb
comma
id|aiptek-&gt;usbdev
comma
id|usb_rcvintpipe
c_func
(paren
id|aiptek-&gt;usbdev
comma
id|endpoint-&gt;bEndpointAddress
)paren
comma
id|aiptek-&gt;data
comma
l_int|8
comma
id|aiptek_irq
comma
id|aiptek
comma
id|endpoint-&gt;bInterval
)paren
suffix:semicolon
id|aiptek-&gt;urb-&gt;transfer_dma
op_assign
id|aiptek-&gt;data_dma
suffix:semicolon
id|aiptek-&gt;urb-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
multiline_comment|/* Register the tablet as an Input Device&n;&t; */
id|input_register_device
c_func
(paren
op_amp
id|aiptek-&gt;inputdev
)paren
suffix:semicolon
multiline_comment|/* Go and decode the USB representation of the tablet&squot;s manufacturer&n;&t; * name and product name. They only change once every hotplug event,&n;&t; * which is why we put it here instead of in the sysfs interface.&n;&t; */
id|usb_string
c_func
(paren
id|usbdev
comma
id|usbdev-&gt;descriptor.iManufacturer
comma
id|aiptek-&gt;features.manuName
comma
r_sizeof
(paren
id|aiptek-&gt;features.manuName
)paren
)paren
suffix:semicolon
id|usb_string
c_func
(paren
id|usbdev
comma
id|usbdev-&gt;descriptor.iProduct
comma
id|aiptek-&gt;features.prodName
comma
r_sizeof
(paren
id|aiptek-&gt;features.prodName
)paren
)paren
suffix:semicolon
multiline_comment|/* We now will look for the evdev device which is mapped to&n;&t; * the tablet. The partial name is kept in the link list of&n;&t; * input_handles associated with this input device.&n;&t; * What identifies an evdev input_handler is that it begins&n;&t; * with &squot;event&squot;, continues with a digit, and that in turn&n;&t; * is mapped to /{devfs}/input/eventN.&n;&t; */
id|inputdev
op_assign
op_amp
id|aiptek-&gt;inputdev
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|node
comma
id|next
comma
op_amp
id|inputdev-&gt;h_list
)paren
(brace
id|inputhandle
op_assign
id|to_handle
c_func
(paren
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|inputhandle-&gt;name
comma
l_string|&quot;event&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|aiptek-&gt;features.inputPath
comma
id|inputhandle-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|info
c_func
(paren
l_string|&quot;input: Aiptek on %s (%s)&bslash;n&quot;
comma
id|path
comma
id|aiptek-&gt;features.inputPath
)paren
suffix:semicolon
multiline_comment|/* Program the tablet. This sets the tablet up in the mode&n;&t; * specified in newSetting, and also queries the tablet&squot;s&n;&t; * physical capacities.&n;&t; *&n;&t; * Sanity check: if a tablet doesn&squot;t like the slow programmatic&n;&t; * delay, we often get sizes of 0x0. Let&squot;s use that as an indicator&n;&t; * to try faster delays, up to 25 ms. If that logic fails, well, you&squot;ll&n;&t; * have to explain to us how your tablet thinks it&squot;s 0x0, and yet that&squot;s&n;&t; * not an error :-)&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|speeds
)paren
op_div
r_sizeof
(paren
id|speeds
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|aiptek-&gt;curSetting.programmableDelay
op_assign
id|speeds
(braket
id|i
)braket
suffix:semicolon
(paren
r_void
)paren
id|aiptek_program_tablet
c_func
(paren
id|aiptek
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek-&gt;inputdev.absmax
(braket
id|ABS_X
)braket
OG
l_int|0
)paren
(brace
id|info
c_func
(paren
l_string|&quot;input: Aiptek using %d ms programming speed&bslash;n&quot;
comma
id|aiptek-&gt;curSetting.programmableDelay
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Associate this driver&squot;s struct with the usb interface.&n;&t; */
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|aiptek
)paren
suffix:semicolon
multiline_comment|/* Set up the sysfs files&n;&t; */
id|aiptek_add_files
c_func
(paren
op_amp
id|intf-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Make sure the evdev module is loaded. Assuming evdev IS a module :-)&n;&t; */
r_if
c_cond
(paren
id|request_module
c_func
(paren
l_string|&quot;evdev&quot;
)paren
op_ne
l_int|0
)paren
id|info
c_func
(paren
l_string|&quot;aiptek: error loading &squot;evdev&squot; module&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Forward declaration */
r_static
r_void
id|aiptek_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
suffix:semicolon
DECL|variable|aiptek_driver
r_static
r_struct
id|usb_driver
id|aiptek_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;aiptek&quot;
comma
dot
id|probe
op_assign
id|aiptek_probe
comma
dot
id|disconnect
op_assign
id|aiptek_disconnect
comma
dot
id|id_table
op_assign
id|aiptek_ids
comma
)brace
suffix:semicolon
multiline_comment|/***********************************************************************&n; * Deal with tablet disconnecting from the system.&n; */
DECL|function|aiptek_disconnect
r_static
r_void
id|aiptek_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|aiptek
op_star
id|aiptek
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
multiline_comment|/* Disassociate driver&squot;s struct with usb interface&n;&t; */
id|usb_set_intfdata
c_func
(paren
id|intf
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aiptek
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* Free &amp; unhook everything from the system.&n;&t;&t; */
id|usb_kill_urb
c_func
(paren
id|aiptek-&gt;urb
)paren
suffix:semicolon
id|input_unregister_device
c_func
(paren
op_amp
id|aiptek-&gt;inputdev
)paren
suffix:semicolon
id|aiptek_delete_files
c_func
(paren
op_amp
id|intf-&gt;dev
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|aiptek-&gt;urb
)paren
suffix:semicolon
id|usb_buffer_free
c_func
(paren
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
comma
id|AIPTEK_PACKET_LENGTH
comma
id|aiptek-&gt;data
comma
id|aiptek-&gt;data_dma
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|aiptek
)paren
suffix:semicolon
id|aiptek
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|aiptek_init
r_static
r_int
id|__init
id|aiptek_init
c_func
(paren
r_void
)paren
(brace
r_int
id|result
op_assign
id|usb_register
c_func
(paren
op_amp
id|aiptek_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
l_int|0
)paren
(brace
id|info
c_func
(paren
id|DRIVER_VERSION
l_string|&quot;: &quot;
id|DRIVER_AUTHOR
)paren
suffix:semicolon
id|info
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|aiptek_exit
r_static
r_void
id|__exit
id|aiptek_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|aiptek_driver
)paren
suffix:semicolon
)brace
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|programmableDelay
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|programmableDelay
comma
l_string|&quot;delay used during tablet programming&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|jitterDelay
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|jitterDelay
comma
l_string|&quot;stylus/mouse settlement delay&quot;
)paren
suffix:semicolon
DECL|variable|aiptek_init
id|module_init
c_func
(paren
id|aiptek_init
)paren
suffix:semicolon
DECL|variable|aiptek_exit
id|module_exit
c_func
(paren
id|aiptek_exit
)paren
suffix:semicolon
eof
