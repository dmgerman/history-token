multiline_comment|/* &n; *  USB ATI Remote support&n; *&n; *  Version 2.2.0 Copyright (c) 2004 Torrey Hoffman &lt;thoffman@arnor.net&gt;&n; *  Version 2.1.1 Copyright (c) 2002 Vladimir Dergachev&n; *&n; *  This 2.2.0 version is a rewrite / cleanup of the 2.1.1 driver, including&n; *  porting to the 2.6 kernel interfaces, along with other modification &n; *  to better match the style of the existing usb/input drivers.  However, the&n; *  protocol and hardware handling is essentially unchanged from 2.1.1.&n; *  &n; *  The 2.1.1 driver was derived from the usbati_remote and usbkbd drivers by &n; *  Vojtech Pavlik.&n; *&n; *  Changes:&n; *&n; *  Feb 2004: Torrey Hoffman &lt;thoffman@arnor.net&gt;&n; *            Version 2.2.0&n; *  Jun 2004: Torrey Hoffman &lt;thoffman@arnor.net&gt;&n; *            Version 2.2.1&n; *            Added key repeat support contributed by:&n; *                Vincent Vanackere &lt;vanackere@lif.univ-mrs.fr&gt;&n; *            Added support for the &quot;Lola&quot; remote contributed by:&n; *                Seth Cohn &lt;sethcohn@yahoo.com&gt;&n; *&n; * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * &n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or &n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; * &n; * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * &n; *&n; * Hardware &amp; software notes&n; *&n; * These remote controls are distributed by ATI as part of their &n; * &quot;All-In-Wonder&quot; video card packages.  The receiver self-identifies as a &n; * &quot;USB Receiver&quot; with manufacturer &quot;X10 Wireless Technology Inc&quot;.&n; *&n; * The &quot;Lola&quot; remote is available from X10.  See: &n; *    http://www.x10.com/products/lola_sg1.htm&n; * The Lola is similar to the ATI remote but has no mouse support, and slightly&n; * different keys.&n; *&n; * It is possible to use multiple receivers and remotes on multiple computers &n; * simultaneously by configuring them to use specific channels.&n; * &n; * The RF protocol used by the remote supports 16 distinct channels, 1 to 16.  &n; * Actually, it may even support more, at least in some revisions of the &n; * hardware.&n; *&n; * Each remote can be configured to transmit on one channel as follows:&n; *   - Press and hold the &quot;hand icon&quot; button.  &n; *   - When the red LED starts to blink, let go of the &quot;hand icon&quot; button. &n; *   - When it stops blinking, input the channel code as two digits, from 01 &n; *     to 16, and press the hand icon again.&n; * &n; * The timing can be a little tricky.  Try loading the module with debug=1&n; * to have the kernel print out messages about the remote control number&n; * and mask.  Note: debugging prints remote numbers as zero-based hexadecimal.&n; *&n; * The driver has a &quot;channel_mask&quot; parameter. This bitmask specifies which&n; * channels will be ignored by the module.  To mask out channels, just add &n; * all the 2^channel_number values together.&n; *&n; * For instance, set channel_mask = 2^4 = 16 (binary 10000) to make ati_remote&n; * ignore signals coming from remote controls transmitting on channel 4, but &n; * accept all other channels.&n; *&n; * Or, set channel_mask = 65533, (0xFFFD), and all channels except 1 will be &n; * ignored.&n; *&n; * The default is 0 (respond to all channels). Bit 0 and bits 17-32 of this &n; * parameter are unused.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
multiline_comment|/*&n; * Module and Version Information, Module Parameters&n; */
DECL|macro|ATI_REMOTE_VENDOR_ID
mdefine_line|#define ATI_REMOTE_VENDOR_ID &t;0x0bc7
DECL|macro|ATI_REMOTE_PRODUCT_ID
mdefine_line|#define ATI_REMOTE_PRODUCT_ID &t;0x004
DECL|macro|LOLA_REMOTE_PRODUCT_ID
mdefine_line|#define LOLA_REMOTE_PRODUCT_ID &t;0x002
DECL|macro|MEDION_REMOTE_PRODUCT_ID
mdefine_line|#define MEDION_REMOTE_PRODUCT_ID 0x006
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &t;        &quot;2.2.1&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR           &quot;Torrey Hoffman &lt;thoffman@arnor.net&gt;&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC             &quot;ATI/X10 RF USB Remote Control&quot;
DECL|macro|NAME_BUFSIZE
mdefine_line|#define NAME_BUFSIZE      80    /* size of product name, path buffers */
DECL|macro|DATA_BUFSIZE
mdefine_line|#define DATA_BUFSIZE      63    /* size of URB data buffers */
DECL|macro|ATI_INPUTNUM
mdefine_line|#define ATI_INPUTNUM      1     /* Which input device to register as */
DECL|variable|channel_mask
r_static
r_int
r_int
id|channel_mask
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|channel_mask
comma
id|ulong
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|channel_mask
comma
l_string|&quot;Bitmask of remote control channels to ignore&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Enable extra debug messages and information&quot;
)paren
suffix:semicolon
DECL|macro|dbginfo
mdefine_line|#define dbginfo(dev, format, arg...) do { if (debug) dev_info(dev , format , ## arg); } while (0)
DECL|macro|err
macro_line|#undef err
DECL|macro|err
mdefine_line|#define err(format, arg...) printk(KERN_ERR format , ## arg)
DECL|variable|ati_remote_table
r_static
r_struct
id|usb_device_id
id|ati_remote_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
id|ATI_REMOTE_VENDOR_ID
comma
id|ATI_REMOTE_PRODUCT_ID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|ATI_REMOTE_VENDOR_ID
comma
id|LOLA_REMOTE_PRODUCT_ID
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
id|ATI_REMOTE_VENDOR_ID
comma
id|MEDION_REMOTE_PRODUCT_ID
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|ati_remote_table
)paren
suffix:semicolon
multiline_comment|/* Get hi and low bytes of a 16-bits int */
DECL|macro|HI
mdefine_line|#define HI(a)&t;((unsigned char)((a) &gt;&gt; 8))
DECL|macro|LO
mdefine_line|#define LO(a)&t;((unsigned char)((a) &amp; 0xff))
DECL|macro|SEND_FLAG_IN_PROGRESS
mdefine_line|#define SEND_FLAG_IN_PROGRESS&t;1
DECL|macro|SEND_FLAG_COMPLETE
mdefine_line|#define SEND_FLAG_COMPLETE&t;2
multiline_comment|/* Device initialization strings */
DECL|variable|init1
r_static
r_char
id|init1
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x00
comma
l_int|0x20
comma
l_int|0x14
)brace
suffix:semicolon
DECL|variable|init2
r_static
r_char
id|init2
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x00
comma
l_int|0x20
comma
l_int|0x14
comma
l_int|0x20
comma
l_int|0x20
comma
l_int|0x20
)brace
suffix:semicolon
multiline_comment|/* Acceleration curve for directional control pad */
DECL|variable|accel
r_static
r_char
id|accel
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|6
comma
l_int|9
comma
l_int|13
comma
l_int|20
)brace
suffix:semicolon
multiline_comment|/* Duplicate event filtering time. &n; * Sequential, identical KIND_FILTERED inputs with less than&n; * FILTER_TIME jiffies between them are considered as repeat&n; * events. The hardware generates 5 events for the first keypress&n; * and we have to take this into account for an accurate repeat&n; * behaviour.&n; * (HZ / 20) == 50 ms and works well for me.&n; */
DECL|macro|FILTER_TIME
mdefine_line|#define FILTER_TIME (HZ / 20)
r_static
id|DECLARE_MUTEX
c_func
(paren
id|disconnect_sem
)paren
suffix:semicolon
DECL|struct|ati_remote
r_struct
id|ati_remote
(brace
DECL|member|idev
r_struct
id|input_dev
id|idev
suffix:semicolon
DECL|member|udev
r_struct
id|usb_device
op_star
id|udev
suffix:semicolon
DECL|member|interface
r_struct
id|usb_interface
op_star
id|interface
suffix:semicolon
DECL|member|irq_urb
r_struct
id|urb
op_star
id|irq_urb
suffix:semicolon
DECL|member|out_urb
r_struct
id|urb
op_star
id|out_urb
suffix:semicolon
DECL|member|endpoint_in
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint_in
suffix:semicolon
DECL|member|endpoint_out
r_struct
id|usb_endpoint_descriptor
op_star
id|endpoint_out
suffix:semicolon
DECL|member|inbuf
r_int
r_char
op_star
id|inbuf
suffix:semicolon
DECL|member|outbuf
r_int
r_char
op_star
id|outbuf
suffix:semicolon
DECL|member|inbuf_dma
id|dma_addr_t
id|inbuf_dma
suffix:semicolon
DECL|member|outbuf_dma
id|dma_addr_t
id|outbuf_dma
suffix:semicolon
DECL|member|open
r_int
id|open
suffix:semicolon
multiline_comment|/* open counter */
DECL|member|present
r_int
id|present
suffix:semicolon
multiline_comment|/* device plugged in? */
DECL|member|old_data
r_int
r_char
id|old_data
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Detect duplicate events */
DECL|member|old_jiffies
r_int
r_int
id|old_jiffies
suffix:semicolon
DECL|member|acc_jiffies
r_int
r_int
id|acc_jiffies
suffix:semicolon
multiline_comment|/* handle acceleration */
DECL|member|repeat_count
r_int
r_int
id|repeat_count
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
id|NAME_BUFSIZE
)braket
suffix:semicolon
DECL|member|phys
r_char
id|phys
(braket
id|NAME_BUFSIZE
)braket
suffix:semicolon
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|send_flags
r_int
id|send_flags
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* &quot;Kinds&quot; of messages sent from the hardware to the driver. */
DECL|macro|KIND_END
mdefine_line|#define KIND_END        0
DECL|macro|KIND_LITERAL
mdefine_line|#define KIND_LITERAL    1   /* Simply pass to input system */
DECL|macro|KIND_FILTERED
mdefine_line|#define KIND_FILTERED   2   /* Add artificial key-up events, drop keyrepeats */
DECL|macro|KIND_LU
mdefine_line|#define KIND_LU         3   /* Directional keypad diagonals - left up, */
DECL|macro|KIND_RU
mdefine_line|#define KIND_RU         4   /*   right up,  */
DECL|macro|KIND_LD
mdefine_line|#define KIND_LD         5   /*   left down, */
DECL|macro|KIND_RD
mdefine_line|#define KIND_RD         6   /*   right down */
DECL|macro|KIND_ACCEL
mdefine_line|#define KIND_ACCEL      7   /* Directional keypad - left, right, up, down.*/
multiline_comment|/* Translation table from hardware messages to input events. */
r_static
r_struct
(brace
DECL|member|kind
r_int
id|kind
suffix:semicolon
DECL|member|data1
DECL|member|data2
r_int
r_char
id|data1
comma
id|data2
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:semicolon
DECL|member|code
r_int
r_int
id|code
suffix:semicolon
DECL|member|value
r_int
id|value
suffix:semicolon
DECL|variable|ati_remote_tbl
)brace
id|ati_remote_tbl
(braket
)braket
op_assign
(brace
multiline_comment|/* Directional control pad axes */
(brace
id|KIND_ACCEL
comma
l_int|0x35
comma
l_int|0x70
comma
id|EV_REL
comma
id|REL_X
comma
op_minus
l_int|1
)brace
comma
multiline_comment|/* left */
(brace
id|KIND_ACCEL
comma
l_int|0x36
comma
l_int|0x71
comma
id|EV_REL
comma
id|REL_X
comma
l_int|1
)brace
comma
multiline_comment|/* right */
(brace
id|KIND_ACCEL
comma
l_int|0x37
comma
l_int|0x72
comma
id|EV_REL
comma
id|REL_Y
comma
op_minus
l_int|1
)brace
comma
multiline_comment|/* up */
(brace
id|KIND_ACCEL
comma
l_int|0x38
comma
l_int|0x73
comma
id|EV_REL
comma
id|REL_Y
comma
l_int|1
)brace
comma
multiline_comment|/* down */
multiline_comment|/* Directional control pad diagonals */
(brace
id|KIND_LU
comma
l_int|0x39
comma
l_int|0x74
comma
id|EV_REL
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* left up */
(brace
id|KIND_RU
comma
l_int|0x3a
comma
l_int|0x75
comma
id|EV_REL
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* right up */
(brace
id|KIND_LD
comma
l_int|0x3c
comma
l_int|0x77
comma
id|EV_REL
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* left down */
(brace
id|KIND_RD
comma
l_int|0x3b
comma
l_int|0x76
comma
id|EV_REL
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* right down */
multiline_comment|/* &quot;Mouse button&quot; buttons */
(brace
id|KIND_LITERAL
comma
l_int|0x3d
comma
l_int|0x78
comma
id|EV_KEY
comma
id|BTN_LEFT
comma
l_int|1
)brace
comma
multiline_comment|/* left btn down */
(brace
id|KIND_LITERAL
comma
l_int|0x3e
comma
l_int|0x79
comma
id|EV_KEY
comma
id|BTN_LEFT
comma
l_int|0
)brace
comma
multiline_comment|/* left btn up */
(brace
id|KIND_LITERAL
comma
l_int|0x41
comma
l_int|0x7c
comma
id|EV_KEY
comma
id|BTN_RIGHT
comma
l_int|1
)brace
comma
multiline_comment|/* right btn down */
(brace
id|KIND_LITERAL
comma
l_int|0x42
comma
l_int|0x7d
comma
id|EV_KEY
comma
id|BTN_RIGHT
comma
l_int|0
)brace
comma
multiline_comment|/* right btn up */
multiline_comment|/* Artificial &quot;doubleclick&quot; events are generated by the hardware. &n;&t; * They are mapped to the &quot;side&quot; and &quot;extra&quot; mouse buttons here. */
(brace
id|KIND_FILTERED
comma
l_int|0x3f
comma
l_int|0x7a
comma
id|EV_KEY
comma
id|BTN_SIDE
comma
l_int|1
)brace
comma
multiline_comment|/* left dblclick */
(brace
id|KIND_FILTERED
comma
l_int|0x43
comma
l_int|0x7e
comma
id|EV_KEY
comma
id|BTN_EXTRA
comma
l_int|1
)brace
comma
multiline_comment|/* right dblclick */
multiline_comment|/* keyboard. */
(brace
id|KIND_FILTERED
comma
l_int|0xd2
comma
l_int|0x0d
comma
id|EV_KEY
comma
id|KEY_1
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd3
comma
l_int|0x0e
comma
id|EV_KEY
comma
id|KEY_2
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd4
comma
l_int|0x0f
comma
id|EV_KEY
comma
id|KEY_3
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd5
comma
l_int|0x10
comma
id|EV_KEY
comma
id|KEY_4
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd6
comma
l_int|0x11
comma
id|EV_KEY
comma
id|KEY_5
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd7
comma
l_int|0x12
comma
id|EV_KEY
comma
id|KEY_6
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd8
comma
l_int|0x13
comma
id|EV_KEY
comma
id|KEY_7
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xd9
comma
l_int|0x14
comma
id|EV_KEY
comma
id|KEY_8
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xda
comma
l_int|0x15
comma
id|EV_KEY
comma
id|KEY_9
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xdc
comma
l_int|0x17
comma
id|EV_KEY
comma
id|KEY_0
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xc5
comma
l_int|0x00
comma
id|EV_KEY
comma
id|KEY_A
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xc6
comma
l_int|0x01
comma
id|EV_KEY
comma
id|KEY_B
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xde
comma
l_int|0x19
comma
id|EV_KEY
comma
id|KEY_C
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xe0
comma
l_int|0x1b
comma
id|EV_KEY
comma
id|KEY_D
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xe6
comma
l_int|0x21
comma
id|EV_KEY
comma
id|KEY_E
comma
l_int|1
)brace
comma
(brace
id|KIND_FILTERED
comma
l_int|0xe8
comma
l_int|0x23
comma
id|EV_KEY
comma
id|KEY_F
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;special&quot; keys */
(brace
id|KIND_FILTERED
comma
l_int|0xdd
comma
l_int|0x18
comma
id|EV_KEY
comma
id|KEY_KPENTER
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;check&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xdb
comma
l_int|0x16
comma
id|EV_KEY
comma
id|KEY_MENU
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;menu&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xc7
comma
l_int|0x02
comma
id|EV_KEY
comma
id|KEY_POWER
comma
l_int|1
)brace
comma
multiline_comment|/* Power */
(brace
id|KIND_FILTERED
comma
l_int|0xc8
comma
l_int|0x03
comma
id|EV_KEY
comma
id|KEY_PROG1
comma
l_int|1
)brace
comma
multiline_comment|/* TV */
(brace
id|KIND_FILTERED
comma
l_int|0xc9
comma
l_int|0x04
comma
id|EV_KEY
comma
id|KEY_PROG2
comma
l_int|1
)brace
comma
multiline_comment|/* DVD */
(brace
id|KIND_FILTERED
comma
l_int|0xca
comma
l_int|0x05
comma
id|EV_KEY
comma
id|KEY_WWW
comma
l_int|1
)brace
comma
multiline_comment|/* WEB */
(brace
id|KIND_FILTERED
comma
l_int|0xcb
comma
l_int|0x06
comma
id|EV_KEY
comma
id|KEY_BOOKMARKS
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;book&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xcc
comma
l_int|0x07
comma
id|EV_KEY
comma
id|KEY_EDIT
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;hand&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xe1
comma
l_int|0x1c
comma
id|EV_KEY
comma
id|KEY_COFFEE
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;timer&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xe5
comma
l_int|0x20
comma
id|EV_KEY
comma
id|KEY_FRONT
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;max&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xe2
comma
l_int|0x1d
comma
id|EV_KEY
comma
id|KEY_LEFT
comma
l_int|1
)brace
comma
multiline_comment|/* left */
(brace
id|KIND_FILTERED
comma
l_int|0xe4
comma
l_int|0x1f
comma
id|EV_KEY
comma
id|KEY_RIGHT
comma
l_int|1
)brace
comma
multiline_comment|/* right */
(brace
id|KIND_FILTERED
comma
l_int|0xe7
comma
l_int|0x22
comma
id|EV_KEY
comma
id|KEY_DOWN
comma
l_int|1
)brace
comma
multiline_comment|/* down */
(brace
id|KIND_FILTERED
comma
l_int|0xdf
comma
l_int|0x1a
comma
id|EV_KEY
comma
id|KEY_UP
comma
l_int|1
)brace
comma
multiline_comment|/* up */
(brace
id|KIND_FILTERED
comma
l_int|0xe3
comma
l_int|0x1e
comma
id|EV_KEY
comma
id|KEY_ENTER
comma
l_int|1
)brace
comma
multiline_comment|/* &quot;OK&quot; */
(brace
id|KIND_FILTERED
comma
l_int|0xce
comma
l_int|0x09
comma
id|EV_KEY
comma
id|KEY_VOLUMEDOWN
comma
l_int|1
)brace
comma
multiline_comment|/* VOL + */
(brace
id|KIND_FILTERED
comma
l_int|0xcd
comma
l_int|0x08
comma
id|EV_KEY
comma
id|KEY_VOLUMEUP
comma
l_int|1
)brace
comma
multiline_comment|/* VOL - */
(brace
id|KIND_FILTERED
comma
l_int|0xcf
comma
l_int|0x0a
comma
id|EV_KEY
comma
id|KEY_MUTE
comma
l_int|1
)brace
comma
multiline_comment|/* MUTE  */
(brace
id|KIND_FILTERED
comma
l_int|0xd1
comma
l_int|0x0c
comma
id|EV_KEY
comma
id|KEY_CHANNELUP
comma
l_int|1
)brace
comma
multiline_comment|/* CH + */
(brace
id|KIND_FILTERED
comma
l_int|0xd0
comma
l_int|0x0b
comma
id|EV_KEY
comma
id|KEY_CHANNELDOWN
comma
l_int|1
)brace
comma
multiline_comment|/* CH - */
(brace
id|KIND_FILTERED
comma
l_int|0xec
comma
l_int|0x27
comma
id|EV_KEY
comma
id|KEY_RECORD
comma
l_int|1
)brace
comma
multiline_comment|/* ( o) red */
(brace
id|KIND_FILTERED
comma
l_int|0xea
comma
l_int|0x25
comma
id|EV_KEY
comma
id|KEY_PLAYCD
comma
l_int|1
)brace
comma
multiline_comment|/* ( &gt;) */
(brace
id|KIND_FILTERED
comma
l_int|0xe9
comma
l_int|0x24
comma
id|EV_KEY
comma
id|KEY_REWIND
comma
l_int|1
)brace
comma
multiline_comment|/* (&lt;&lt;) */
(brace
id|KIND_FILTERED
comma
l_int|0xeb
comma
l_int|0x26
comma
id|EV_KEY
comma
id|KEY_FORWARD
comma
l_int|1
)brace
comma
multiline_comment|/* (&gt;&gt;) */
(brace
id|KIND_FILTERED
comma
l_int|0xed
comma
l_int|0x28
comma
id|EV_KEY
comma
id|KEY_STOP
comma
l_int|1
)brace
comma
multiline_comment|/* ([]) */
(brace
id|KIND_FILTERED
comma
l_int|0xee
comma
l_int|0x29
comma
id|EV_KEY
comma
id|KEY_PAUSE
comma
l_int|1
)brace
comma
multiline_comment|/* (&squot;&squot;) */
(brace
id|KIND_FILTERED
comma
l_int|0xf0
comma
l_int|0x2b
comma
id|EV_KEY
comma
id|KEY_PREVIOUS
comma
l_int|1
)brace
comma
multiline_comment|/* (&lt;-) */
(brace
id|KIND_FILTERED
comma
l_int|0xef
comma
l_int|0x2a
comma
id|EV_KEY
comma
id|KEY_NEXT
comma
l_int|1
)brace
comma
multiline_comment|/* (&gt;+) */
(brace
id|KIND_FILTERED
comma
l_int|0xf2
comma
l_int|0x2D
comma
id|EV_KEY
comma
id|KEY_INFO
comma
l_int|1
)brace
comma
multiline_comment|/* PLAYING */
(brace
id|KIND_FILTERED
comma
l_int|0xf3
comma
l_int|0x2E
comma
id|EV_KEY
comma
id|KEY_HOME
comma
l_int|1
)brace
comma
multiline_comment|/* TOP */
(brace
id|KIND_FILTERED
comma
l_int|0xf4
comma
l_int|0x2F
comma
id|EV_KEY
comma
id|KEY_END
comma
l_int|1
)brace
comma
multiline_comment|/* END */
(brace
id|KIND_FILTERED
comma
l_int|0xf5
comma
l_int|0x30
comma
id|EV_KEY
comma
id|KEY_SELECT
comma
l_int|1
)brace
comma
multiline_comment|/* SELECT */
(brace
id|KIND_END
comma
l_int|0x00
comma
l_int|0x00
comma
id|EV_MAX
op_plus
l_int|1
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/* Local function prototypes */
r_static
r_void
id|ati_remote_dump
(paren
r_int
r_char
op_star
id|data
comma
r_int
r_int
id|actual_length
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_delete
(paren
r_struct
id|ati_remote
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ati_remote_open
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_close
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
suffix:semicolon
r_static
r_int
id|ati_remote_sendpacket
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
comma
id|u16
id|cmd
comma
r_int
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_irq_out
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_irq_in
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_input_report
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|ati_remote_initialize
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
)paren
suffix:semicolon
r_static
r_int
id|ati_remote_probe
(paren
r_struct
id|usb_interface
op_star
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
suffix:semicolon
r_static
r_void
id|ati_remote_disconnect
(paren
r_struct
id|usb_interface
op_star
id|interface
)paren
suffix:semicolon
multiline_comment|/* usb specific object to register with the usb subsystem */
DECL|variable|ati_remote_driver
r_static
r_struct
id|usb_driver
id|ati_remote_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;ati_remote&quot;
comma
dot
id|probe
op_assign
id|ati_remote_probe
comma
dot
id|disconnect
op_assign
id|ati_remote_disconnect
comma
dot
id|id_table
op_assign
id|ati_remote_table
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;ati_remote_dump_input&n; */
DECL|function|ati_remote_dump
r_static
r_void
id|ati_remote_dump
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
(paren
id|len
op_eq
l_int|1
)paren
op_logical_and
(paren
id|data
(braket
l_int|0
)braket
op_ne
(paren
r_int
r_char
)paren
l_int|0xff
)paren
op_logical_and
(paren
id|data
(braket
l_int|0
)braket
op_ne
l_int|0x00
)paren
)paren
id|warn
c_func
(paren
l_string|&quot;Weird byte 0x%02x&quot;
comma
id|data
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|len
op_eq
l_int|4
)paren
id|warn
c_func
(paren
l_string|&quot;Weird key %02x %02x %02x %02x&quot;
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_else
id|warn
c_func
(paren
l_string|&quot;Weird data, len=%d %02x %02x %02x %02x %02x %02x ...&quot;
comma
id|len
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|data
(braket
l_int|3
)braket
comma
id|data
(braket
l_int|4
)braket
comma
id|data
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_open&n; */
DECL|function|ati_remote_open
r_static
r_int
id|ati_remote_open
c_func
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
id|inputdev
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;open
op_increment
)paren
r_goto
m_exit
suffix:semicolon
multiline_comment|/* On first open, submit the read urb which was set up previously. */
id|ati_remote-&gt;irq_urb-&gt;dev
op_assign
id|ati_remote-&gt;udev
suffix:semicolon
r_if
c_cond
(paren
id|usb_submit_urb
c_func
(paren
id|ati_remote-&gt;irq_urb
comma
id|GFP_KERNEL
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: usb_submit_urb failed!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ati_remote-&gt;open
op_decrement
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
m_exit
suffix:colon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_close&n; */
DECL|function|ati_remote_close
r_static
r_void
id|ati_remote_close
c_func
(paren
r_struct
id|input_dev
op_star
id|inputdev
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
id|inputdev
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote
op_eq
l_int|NULL
)paren
(brace
id|err
c_func
(paren
l_string|&quot;ati_remote: %s: object is NULL!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ati_remote-&gt;open
op_le
l_int|0
)paren
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: Not open.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_else
op_decrement
id|ati_remote-&gt;open
suffix:semicolon
multiline_comment|/* If still present, disconnect will call delete. */
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;present
op_logical_and
op_logical_neg
id|ati_remote-&gt;open
)paren
id|ati_remote_delete
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;&t;ati_remote_irq_out&n; */
DECL|function|ati_remote_irq_out
r_static
r_void
id|ati_remote_irq_out
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: status %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ati_remote-&gt;send_flags
op_or_assign
id|SEND_FLAG_COMPLETE
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ati_remote-&gt;wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_sendpacket&n; *&t;&t;&n; *&t;Used to send device initialization strings&n; */
DECL|function|ati_remote_sendpacket
r_static
r_int
id|ati_remote_sendpacket
c_func
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
comma
id|u16
id|cmd
comma
r_int
r_char
op_star
id|data
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|timeout
op_assign
id|HZ
suffix:semicolon
multiline_comment|/* 1 second */
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set up out_urb */
id|memcpy
c_func
(paren
id|ati_remote-&gt;out_urb-&gt;transfer_buffer
op_plus
l_int|1
comma
id|data
comma
id|LO
c_func
(paren
id|cmd
)paren
)paren
suffix:semicolon
(paren
(paren
r_char
op_star
)paren
id|ati_remote-&gt;out_urb-&gt;transfer_buffer
)paren
(braket
l_int|0
)braket
op_assign
id|HI
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|ati_remote-&gt;out_urb-&gt;transfer_buffer_length
op_assign
id|LO
c_func
(paren
id|cmd
)paren
op_plus
l_int|1
suffix:semicolon
id|ati_remote-&gt;out_urb-&gt;dev
op_assign
id|ati_remote-&gt;udev
suffix:semicolon
id|ati_remote-&gt;send_flags
op_assign
id|SEND_FLAG_IN_PROGRESS
suffix:semicolon
id|retval
op_assign
id|usb_submit_urb
c_func
(paren
id|ati_remote-&gt;out_urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;sendpacket: usb_submit_urb failed: %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|ati_remote-&gt;wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_logical_and
(paren
id|ati_remote-&gt;out_urb-&gt;status
op_eq
op_minus
id|EINPROGRESS
)paren
op_logical_and
op_logical_neg
(paren
id|ati_remote-&gt;send_flags
op_amp
id|SEND_FLAG_COMPLETE
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|ati_remote-&gt;wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|usb_kill_urb
c_func
(paren
id|ati_remote-&gt;out_urb
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_event_lookup&n; */
DECL|function|ati_remote_event_lookup
r_static
r_int
id|ati_remote_event_lookup
c_func
(paren
r_int
id|rem
comma
r_int
r_char
id|d1
comma
r_int
r_char
id|d2
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|kind
op_ne
id|KIND_END
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* &n;&t;&t; * Decide if the table entry matches the remote input. &n;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
(paren
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|data1
op_amp
l_int|0x0f
)paren
op_eq
(paren
id|d1
op_amp
l_int|0x0f
)paren
)paren
)paren
op_logical_and
(paren
(paren
(paren
(paren
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|data1
op_rshift
l_int|4
)paren
op_minus
(paren
id|d1
op_rshift
l_int|4
)paren
op_plus
id|rem
)paren
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x0f
)paren
op_logical_and
(paren
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|data2
op_eq
id|d2
)paren
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_report_input&n; */
DECL|function|ati_remote_input_report
r_static
r_void
id|ati_remote_input_report
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
r_char
op_star
id|data
op_assign
id|ati_remote-&gt;inbuf
suffix:semicolon
r_struct
id|input_dev
op_star
id|dev
op_assign
op_amp
id|ati_remote-&gt;idev
suffix:semicolon
r_int
id|index
comma
id|acc
suffix:semicolon
r_int
id|remote_num
suffix:semicolon
multiline_comment|/* Deal with strange looking inputs */
r_if
c_cond
(paren
(paren
id|urb-&gt;actual_length
op_ne
l_int|4
)paren
op_logical_or
(paren
id|data
(braket
l_int|0
)braket
op_ne
l_int|0x14
)paren
op_logical_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x0f
)paren
op_ne
l_int|0x00
)paren
)paren
(brace
id|ati_remote_dump
c_func
(paren
id|data
comma
id|urb-&gt;actual_length
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Mask unwanted remote channels.  */
multiline_comment|/* note: remote_num is 0-based, channel 1 on remote == 0 here */
id|remote_num
op_assign
(paren
id|data
(braket
l_int|3
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|channel_mask
op_amp
(paren
l_int|1
op_lshift
(paren
id|remote_num
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|dbginfo
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;Masked input from channel 0x%02x: data %02x,%02x, mask= 0x%02lx&bslash;n&quot;
comma
id|remote_num
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|channel_mask
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Look up event code index in translation table */
id|index
op_assign
id|ati_remote_event_lookup
c_func
(paren
id|remote_num
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
l_int|0
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;Unknown input from channel 0x%02x: data %02x,%02x&bslash;n&quot;
comma
id|remote_num
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dbginfo
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;channel 0x%02x; data %02x,%02x; index %d; keycode %d&bslash;n&quot;
comma
id|remote_num
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|index
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|code
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|kind
op_eq
id|KIND_LITERAL
)paren
(brace
id|input_regs
c_func
(paren
id|dev
comma
id|regs
)paren
suffix:semicolon
id|input_event
c_func
(paren
id|dev
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|type
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|code
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|value
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ati_remote-&gt;old_jiffies
op_assign
id|jiffies
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|kind
op_eq
id|KIND_FILTERED
)paren
(brace
multiline_comment|/* Filter duplicate events which happen &quot;too close&quot; together. */
r_if
c_cond
(paren
(paren
id|ati_remote-&gt;old_data
(braket
l_int|0
)braket
op_eq
id|data
(braket
l_int|1
)braket
)paren
op_logical_and
(paren
id|ati_remote-&gt;old_data
(braket
l_int|1
)braket
op_eq
id|data
(braket
l_int|2
)braket
)paren
op_logical_and
(paren
(paren
id|ati_remote-&gt;old_jiffies
op_plus
id|FILTER_TIME
)paren
OG
id|jiffies
)paren
)paren
(brace
id|ati_remote-&gt;repeat_count
op_increment
suffix:semicolon
)brace
r_else
(brace
id|ati_remote-&gt;repeat_count
op_assign
l_int|0
suffix:semicolon
)brace
id|ati_remote-&gt;old_data
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|ati_remote-&gt;old_data
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|ati_remote-&gt;old_jiffies
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ati_remote-&gt;repeat_count
OG
l_int|0
)paren
op_logical_and
(paren
id|ati_remote-&gt;repeat_count
OL
l_int|5
)paren
)paren
r_return
suffix:semicolon
id|input_regs
c_func
(paren
id|dev
comma
id|regs
)paren
suffix:semicolon
id|input_event
c_func
(paren
id|dev
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|type
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|code
comma
l_int|1
)paren
suffix:semicolon
id|input_event
c_func
(paren
id|dev
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|type
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|code
comma
l_int|0
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * Other event kinds are from the directional control pad, and have an&n;&t; * acceleration factor applied to them.  Without this acceleration, the&n;&t; * control pad is mostly unusable.&n;&t; * &n;&t; * If elapsed time since last event is &gt; 1/4 second, user &quot;stopped&quot;,&n;&t; * so reset acceleration. Otherwise, user is probably holding the control&n;&t; * pad down, so we increase acceleration, ramping up over two seconds to&n;&t; * a maximum speed.  The acceleration curve is #defined above.&n;&t; */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;old_jiffies
)paren
OG
(paren
id|HZ
op_rshift
l_int|2
)paren
)paren
(brace
id|acc
op_assign
l_int|1
suffix:semicolon
id|ati_remote-&gt;acc_jiffies
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
(paren
id|HZ
op_rshift
l_int|3
)paren
)paren
id|acc
op_assign
id|accel
(braket
l_int|0
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
(paren
id|HZ
op_rshift
l_int|2
)paren
)paren
id|acc
op_assign
id|accel
(braket
l_int|1
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
(paren
id|HZ
op_rshift
l_int|1
)paren
)paren
id|acc
op_assign
id|accel
(braket
l_int|2
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
id|HZ
)paren
id|acc
op_assign
id|accel
(braket
l_int|3
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
id|HZ
op_plus
(paren
id|HZ
op_rshift
l_int|1
)paren
)paren
id|acc
op_assign
id|accel
(braket
l_int|4
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|ati_remote-&gt;acc_jiffies
)paren
OL
(paren
id|HZ
op_lshift
l_int|1
)paren
)paren
id|acc
op_assign
id|accel
(braket
l_int|5
)braket
suffix:semicolon
r_else
id|acc
op_assign
id|accel
(braket
l_int|6
)braket
suffix:semicolon
id|input_regs
c_func
(paren
id|dev
comma
id|regs
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|kind
)paren
(brace
r_case
id|KIND_ACCEL
suffix:colon
id|input_event
c_func
(paren
id|dev
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|type
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|code
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|value
op_star
id|acc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KIND_LU
suffix:colon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_X
comma
op_minus
id|acc
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_Y
comma
op_minus
id|acc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KIND_RU
suffix:colon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_X
comma
id|acc
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_Y
comma
op_minus
id|acc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KIND_LD
suffix:colon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_X
comma
op_minus
id|acc
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_Y
comma
id|acc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KIND_RD
suffix:colon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_X
comma
id|acc
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
id|dev
comma
id|REL_Y
comma
id|acc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;ati_remote kind=%d&bslash;n&quot;
comma
id|ati_remote_tbl
(braket
id|index
)braket
dot
id|kind
)paren
suffix:semicolon
)brace
id|input_sync
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ati_remote-&gt;old_jiffies
op_assign
id|jiffies
suffix:semicolon
id|ati_remote-&gt;old_data
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|ati_remote-&gt;old_data
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_irq_in&n; */
DECL|function|ati_remote_irq_in
r_static
r_void
id|ati_remote_irq_in
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
id|urb-&gt;context
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_switch
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* success */
id|ati_remote_input_report
c_func
(paren
id|urb
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|ECONNRESET
suffix:colon
multiline_comment|/* unlink */
r_case
op_minus
id|ENOENT
suffix:colon
r_case
op_minus
id|ESHUTDOWN
suffix:colon
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: urb error status, unlink? &bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* error */
id|dev_dbg
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: Nonzero urb status %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;status
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|SLAB_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|dev_err
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;%s: usb_submit_urb()=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|retval
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_delete&n; */
DECL|function|ati_remote_delete
r_static
r_void
id|ati_remote_delete
c_func
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ati_remote
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;irq_urb
)paren
id|usb_kill_urb
c_func
(paren
id|ati_remote-&gt;irq_urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;out_urb
)paren
id|usb_kill_urb
c_func
(paren
id|ati_remote-&gt;out_urb
)paren
suffix:semicolon
id|input_unregister_device
c_func
(paren
op_amp
id|ati_remote-&gt;idev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;inbuf
)paren
id|usb_buffer_free
c_func
(paren
id|ati_remote-&gt;udev
comma
id|DATA_BUFSIZE
comma
id|ati_remote-&gt;inbuf
comma
id|ati_remote-&gt;inbuf_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;outbuf
)paren
id|usb_buffer_free
c_func
(paren
id|ati_remote-&gt;udev
comma
id|DATA_BUFSIZE
comma
id|ati_remote-&gt;inbuf
comma
id|ati_remote-&gt;outbuf_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;irq_urb
)paren
id|usb_free_urb
c_func
(paren
id|ati_remote-&gt;irq_urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ati_remote-&gt;out_urb
)paren
id|usb_free_urb
c_func
(paren
id|ati_remote-&gt;out_urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
)brace
DECL|function|ati_remote_input_init
r_static
r_void
id|ati_remote_input_init
c_func
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
)paren
(brace
r_struct
id|input_dev
op_star
id|idev
op_assign
op_amp
(paren
id|ati_remote-&gt;idev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|idev-&gt;evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_REL
)paren
suffix:semicolon
id|idev-&gt;keybit
(braket
id|LONG
c_func
(paren
id|BTN_MOUSE
)paren
)braket
op_assign
(paren
id|BIT
c_func
(paren
id|BTN_LEFT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_RIGHT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_SIDE
)paren
op_or
id|BIT
c_func
(paren
id|BTN_EXTRA
)paren
)paren
suffix:semicolon
id|idev-&gt;relbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|REL_X
)paren
op_or
id|BIT
c_func
(paren
id|REL_Y
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|kind
op_ne
id|KIND_END
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|type
op_eq
id|EV_KEY
)paren
id|set_bit
c_func
(paren
id|ati_remote_tbl
(braket
id|i
)braket
dot
id|code
comma
id|idev-&gt;keybit
)paren
suffix:semicolon
id|idev
op_member_access_from_pointer
r_private
op_assign
id|ati_remote
suffix:semicolon
id|idev-&gt;open
op_assign
id|ati_remote_open
suffix:semicolon
id|idev-&gt;close
op_assign
id|ati_remote_close
suffix:semicolon
id|idev-&gt;name
op_assign
id|ati_remote-&gt;name
suffix:semicolon
id|idev-&gt;phys
op_assign
id|ati_remote-&gt;phys
suffix:semicolon
id|idev-&gt;id.bustype
op_assign
id|BUS_USB
suffix:semicolon
id|idev-&gt;id.vendor
op_assign
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;udev-&gt;descriptor.idVendor
)paren
suffix:semicolon
id|idev-&gt;id.product
op_assign
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;udev-&gt;descriptor.idProduct
)paren
suffix:semicolon
id|idev-&gt;id.version
op_assign
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;udev-&gt;descriptor.bcdDevice
)paren
suffix:semicolon
)brace
DECL|function|ati_remote_initialize
r_static
r_int
id|ati_remote_initialize
c_func
(paren
r_struct
id|ati_remote
op_star
id|ati_remote
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|ati_remote-&gt;udev
suffix:semicolon
r_int
id|pipe
comma
id|maxp
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ati_remote-&gt;wait
)paren
suffix:semicolon
multiline_comment|/* Set up irq_urb */
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|udev
comma
id|ati_remote-&gt;endpoint_in-&gt;bEndpointAddress
)paren
suffix:semicolon
id|maxp
op_assign
id|usb_maxpacket
c_func
(paren
id|udev
comma
id|pipe
comma
id|usb_pipeout
c_func
(paren
id|pipe
)paren
)paren
suffix:semicolon
id|maxp
op_assign
(paren
id|maxp
OG
id|DATA_BUFSIZE
)paren
ques
c_cond
id|DATA_BUFSIZE
suffix:colon
id|maxp
suffix:semicolon
id|usb_fill_int_urb
c_func
(paren
id|ati_remote-&gt;irq_urb
comma
id|udev
comma
id|pipe
comma
id|ati_remote-&gt;inbuf
comma
id|maxp
comma
id|ati_remote_irq_in
comma
id|ati_remote
comma
id|ati_remote-&gt;endpoint_in-&gt;bInterval
)paren
suffix:semicolon
id|ati_remote-&gt;irq_urb-&gt;transfer_dma
op_assign
id|ati_remote-&gt;inbuf_dma
suffix:semicolon
id|ati_remote-&gt;irq_urb-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
multiline_comment|/* Set up out_urb */
id|pipe
op_assign
id|usb_sndintpipe
c_func
(paren
id|udev
comma
id|ati_remote-&gt;endpoint_out-&gt;bEndpointAddress
)paren
suffix:semicolon
id|maxp
op_assign
id|usb_maxpacket
c_func
(paren
id|udev
comma
id|pipe
comma
id|usb_pipeout
c_func
(paren
id|pipe
)paren
)paren
suffix:semicolon
id|maxp
op_assign
(paren
id|maxp
OG
id|DATA_BUFSIZE
)paren
ques
c_cond
id|DATA_BUFSIZE
suffix:colon
id|maxp
suffix:semicolon
id|usb_fill_int_urb
c_func
(paren
id|ati_remote-&gt;out_urb
comma
id|udev
comma
id|pipe
comma
id|ati_remote-&gt;outbuf
comma
id|maxp
comma
id|ati_remote_irq_out
comma
id|ati_remote
comma
id|ati_remote-&gt;endpoint_out-&gt;bInterval
)paren
suffix:semicolon
id|ati_remote-&gt;out_urb-&gt;transfer_dma
op_assign
id|ati_remote-&gt;outbuf_dma
suffix:semicolon
id|ati_remote-&gt;out_urb-&gt;transfer_flags
op_or_assign
id|URB_NO_TRANSFER_DMA_MAP
suffix:semicolon
multiline_comment|/* send initialization strings */
r_if
c_cond
(paren
(paren
id|ati_remote_sendpacket
c_func
(paren
id|ati_remote
comma
l_int|0x8004
comma
id|init1
)paren
)paren
op_logical_or
(paren
id|ati_remote_sendpacket
c_func
(paren
id|ati_remote
comma
l_int|0x8007
comma
id|init2
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;Initializing ati_remote hardware failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_probe&n; */
DECL|function|ati_remote_probe
r_static
r_int
id|ati_remote_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|interface
)paren
suffix:semicolon
r_struct
id|ati_remote
op_star
id|ati_remote
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|usb_host_interface
op_star
id|iface_host
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_char
id|path
(braket
l_int|64
)braket
suffix:semicolon
r_char
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Allocate and clear an ati_remote struct */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ati_remote
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ati_remote
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|ati_remote
comma
l_int|0x00
comma
r_sizeof
(paren
r_struct
id|ati_remote
)paren
)paren
suffix:semicolon
id|iface_host
op_assign
id|interface-&gt;cur_altsetting
suffix:semicolon
r_if
c_cond
(paren
id|iface_host-&gt;desc.bNumEndpoints
op_ne
l_int|2
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s: Unexpected desc.bNumEndpoints&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|ati_remote-&gt;endpoint_in
op_assign
op_amp
(paren
id|iface_host-&gt;endpoint
(braket
l_int|0
)braket
dot
id|desc
)paren
suffix:semicolon
id|ati_remote-&gt;endpoint_out
op_assign
op_amp
(paren
id|iface_host-&gt;endpoint
(braket
l_int|1
)braket
dot
id|desc
)paren
suffix:semicolon
id|ati_remote-&gt;udev
op_assign
id|udev
suffix:semicolon
id|ati_remote-&gt;interface
op_assign
id|interface
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ati_remote-&gt;endpoint_in-&gt;bEndpointAddress
op_amp
l_int|0x80
)paren
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s: Unexpected endpoint_in-&gt;bEndpointAddress&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ati_remote-&gt;endpoint_in-&gt;bmAttributes
op_amp
l_int|3
)paren
op_ne
l_int|3
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s: Unexpected endpoint_in-&gt;bmAttributes&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;endpoint_in-&gt;wMaxPacketSize
)paren
op_eq
l_int|0
)paren
(brace
id|err
c_func
(paren
l_string|&quot;%s: endpoint_in message size==0? &bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
op_assign
id|kmalloc
c_func
(paren
id|NAME_BUFSIZE
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* Allocate URB buffers, URBs */
id|ati_remote-&gt;inbuf
op_assign
id|usb_buffer_alloc
c_func
(paren
id|udev
comma
id|DATA_BUFSIZE
comma
id|SLAB_ATOMIC
comma
op_amp
id|ati_remote-&gt;inbuf_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;inbuf
)paren
r_goto
id|error
suffix:semicolon
id|ati_remote-&gt;outbuf
op_assign
id|usb_buffer_alloc
c_func
(paren
id|udev
comma
id|DATA_BUFSIZE
comma
id|SLAB_ATOMIC
comma
op_amp
id|ati_remote-&gt;outbuf_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;outbuf
)paren
r_goto
id|error
suffix:semicolon
id|ati_remote-&gt;irq_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;irq_urb
)paren
r_goto
id|error
suffix:semicolon
id|ati_remote-&gt;out_urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;out_urb
)paren
r_goto
id|error
suffix:semicolon
id|usb_make_path
c_func
(paren
id|udev
comma
id|path
comma
id|NAME_BUFSIZE
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|ati_remote-&gt;phys
comma
l_string|&quot;%s/input%d&quot;
comma
id|path
comma
id|ATI_INPUTNUM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udev-&gt;descriptor.iManufacturer
op_logical_and
(paren
id|usb_string
c_func
(paren
id|udev
comma
id|udev-&gt;descriptor.iManufacturer
comma
id|buf
comma
id|NAME_BUFSIZE
)paren
OG
l_int|0
)paren
)paren
id|strcat
c_func
(paren
id|ati_remote-&gt;name
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udev-&gt;descriptor.iProduct
op_logical_and
(paren
id|usb_string
c_func
(paren
id|udev
comma
id|udev-&gt;descriptor.iProduct
comma
id|buf
comma
id|NAME_BUFSIZE
)paren
OG
l_int|0
)paren
)paren
id|sprintf
c_func
(paren
id|ati_remote-&gt;name
comma
l_string|&quot;%s %s&quot;
comma
id|ati_remote-&gt;name
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strlen
c_func
(paren
id|ati_remote-&gt;name
)paren
)paren
id|sprintf
c_func
(paren
id|ati_remote-&gt;name
comma
id|DRIVER_DESC
l_string|&quot;(%04x,%04x)&quot;
comma
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;udev-&gt;descriptor.idVendor
)paren
comma
id|le16_to_cpu
c_func
(paren
id|ati_remote-&gt;udev-&gt;descriptor.idProduct
)paren
)paren
suffix:semicolon
multiline_comment|/* Device Hardware Initialization - fills in ati_remote-&gt;idev from udev. */
id|retval
op_assign
id|ati_remote_initialize
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* Set up and register input device */
id|ati_remote_input_init
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
id|input_register_device
c_func
(paren
op_amp
id|ati_remote-&gt;idev
)paren
suffix:semicolon
id|dev_info
c_func
(paren
op_amp
id|ati_remote-&gt;interface-&gt;dev
comma
l_string|&quot;Input registered: %s on %s&bslash;n&quot;
comma
id|ati_remote-&gt;name
comma
id|path
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|interface
comma
id|ati_remote
)paren
suffix:semicolon
id|ati_remote-&gt;present
op_assign
l_int|1
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|buf
)paren
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|ati_remote_delete
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_disconnect&n; */
DECL|function|ati_remote_disconnect
r_static
r_void
id|ati_remote_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|interface
)paren
(brace
r_struct
id|ati_remote
op_star
id|ati_remote
suffix:semicolon
id|down
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
id|ati_remote
op_assign
id|usb_get_intfdata
c_func
(paren
id|interface
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|interface
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ati_remote
)paren
(brace
id|warn
c_func
(paren
l_string|&quot;%s - null device?&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Mark device as unplugged */
id|ati_remote-&gt;present
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If device is still open, ati_remote_close will call delete. */
r_if
c_cond
(paren
op_logical_neg
id|ati_remote-&gt;open
)paren
id|ati_remote_delete
c_func
(paren
id|ati_remote
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|disconnect_sem
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_init&n; */
DECL|function|ati_remote_init
r_static
r_int
id|__init
id|ati_remote_init
c_func
(paren
r_void
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|usb_register
c_func
(paren
op_amp
id|ati_remote_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|err
c_func
(paren
l_string|&quot;usb_register error #%d&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_else
id|info
c_func
(paren
l_string|&quot;Registered USB driver &quot;
id|DRIVER_DESC
l_string|&quot; v. &quot;
id|DRIVER_VERSION
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ati_remote_exit&n; */
DECL|function|ati_remote_exit
r_static
r_void
id|__exit
id|ati_remote_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|ati_remote_driver
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; *&t;module specification &n; */
DECL|variable|ati_remote_init
id|module_init
c_func
(paren
id|ati_remote_init
)paren
suffix:semicolon
DECL|variable|ati_remote_exit
id|module_exit
c_func
(paren
id|ati_remote_exit
)paren
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
