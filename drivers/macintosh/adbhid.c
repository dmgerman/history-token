multiline_comment|/*&n; * drivers/input/adbhid.c&n; *&n; * ADB HID driver for Power Macintosh computers.&n; *&n; * Adapted from drivers/macintosh/mac_keyb.c by Franz Sirl.&n; * drivers/macintosh/mac_keyb.c was Copyright (C) 1996 Paul Mackerras&n; * with considerable contributions from Ben Herrenschmidt and others.&n; *&n; * Copyright (C) 2000 Franz Sirl.&n; *&n; * Adapted to ADB changes and support for more devices by&n; * Benjamin Herrenschmidt. Adapted from code in MkLinux&n; * and reworked.&n; * &n; * Supported devices:&n; *&n; * - Standard 1 button mouse&n; * - All standard Apple Extended protocol (handler ID 4)&n; * - mouseman and trackman mice &amp; trackballs &n; * - PowerBook Trackpad (default setup: enable tapping)&n; * - MicroSpeed mouse &amp; trackball (needs testing)&n; * - CH Products Trackball Pro (needs testing)&n; * - Contour Design (Contour Mouse)&n; * - Hunter digital (NoHandsMouse)&n; * - Kensignton TurboMouse 5 (needs testing)&n; * - Mouse Systems A3 mice and trackballs &lt;aidan@kublai.com&gt;&n; * - MacAlly 2-buttons mouse (needs testing) &lt;pochini@denise.shiny.it&gt;&n; *&n; * To do:&n; *&n; * Improve Kensington support.&n; * Split mouse/kbd&n; * Move to syfs&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/adb.h&gt;
macro_line|#include &lt;linux/cuda.h&gt;
macro_line|#include &lt;linux/pmu.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#ifdef CONFIG_PPC_PMAC
macro_line|#include &lt;asm/pmac_feature.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
macro_line|#include &lt;asm/backlight.h&gt;
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Franz Sirl &lt;Franz.Sirl-kernel@lauterbach.com&gt;&quot;
)paren
suffix:semicolon
DECL|macro|KEYB_KEYREG
mdefine_line|#define KEYB_KEYREG&t;0&t;/* register # for key up/down data */
DECL|macro|KEYB_LEDREG
mdefine_line|#define KEYB_LEDREG&t;2&t;/* register # for leds on ADB keyboard */
DECL|macro|MOUSE_DATAREG
mdefine_line|#define MOUSE_DATAREG&t;0&t;/* reg# for movement/button codes from mouse */
r_static
r_int
id|adb_message_handler
c_func
(paren
r_struct
id|notifier_block
op_star
comma
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
DECL|variable|adbhid_adb_notifier
r_static
r_struct
id|notifier_block
id|adbhid_adb_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|adb_message_handler
comma
)brace
suffix:semicolon
multiline_comment|/* Some special keys */
DECL|macro|ADB_KEY_DEL
mdefine_line|#define ADB_KEY_DEL&t;&t;0x33
DECL|macro|ADB_KEY_CMD
mdefine_line|#define ADB_KEY_CMD&t;&t;0x37
DECL|macro|ADB_KEY_CAPSLOCK
mdefine_line|#define ADB_KEY_CAPSLOCK&t;0x39
DECL|macro|ADB_KEY_FN
mdefine_line|#define ADB_KEY_FN&t;&t;0x3f
DECL|macro|ADB_KEY_FWDEL
mdefine_line|#define ADB_KEY_FWDEL&t;&t;0x75
DECL|macro|ADB_KEY_POWER_OLD
mdefine_line|#define ADB_KEY_POWER_OLD&t;0x7e
DECL|macro|ADB_KEY_POWER
mdefine_line|#define ADB_KEY_POWER&t;&t;0x7f
DECL|variable|adb_to_linux_keycodes
id|u8
id|adb_to_linux_keycodes
(braket
l_int|128
)braket
op_assign
(brace
multiline_comment|/* 0x00 */
id|KEY_A
comma
multiline_comment|/*  30 */
multiline_comment|/* 0x01 */
id|KEY_S
comma
multiline_comment|/*  31 */
multiline_comment|/* 0x02 */
id|KEY_D
comma
multiline_comment|/*  32 */
multiline_comment|/* 0x03 */
id|KEY_F
comma
multiline_comment|/*  33 */
multiline_comment|/* 0x04 */
id|KEY_H
comma
multiline_comment|/*  35 */
multiline_comment|/* 0x05 */
id|KEY_G
comma
multiline_comment|/*  34 */
multiline_comment|/* 0x06 */
id|KEY_Z
comma
multiline_comment|/*  44 */
multiline_comment|/* 0x07 */
id|KEY_X
comma
multiline_comment|/*  45 */
multiline_comment|/* 0x08 */
id|KEY_C
comma
multiline_comment|/*  46 */
multiline_comment|/* 0x09 */
id|KEY_V
comma
multiline_comment|/*  47 */
multiline_comment|/* 0x0a */
id|KEY_102ND
comma
multiline_comment|/*  86 */
multiline_comment|/* 0x0b */
id|KEY_B
comma
multiline_comment|/*  48 */
multiline_comment|/* 0x0c */
id|KEY_Q
comma
multiline_comment|/*  16 */
multiline_comment|/* 0x0d */
id|KEY_W
comma
multiline_comment|/*  17 */
multiline_comment|/* 0x0e */
id|KEY_E
comma
multiline_comment|/*  18 */
multiline_comment|/* 0x0f */
id|KEY_R
comma
multiline_comment|/*  19 */
multiline_comment|/* 0x10 */
id|KEY_Y
comma
multiline_comment|/*  21 */
multiline_comment|/* 0x11 */
id|KEY_T
comma
multiline_comment|/*  20 */
multiline_comment|/* 0x12 */
id|KEY_1
comma
multiline_comment|/*   2 */
multiline_comment|/* 0x13 */
id|KEY_2
comma
multiline_comment|/*   3 */
multiline_comment|/* 0x14 */
id|KEY_3
comma
multiline_comment|/*   4 */
multiline_comment|/* 0x15 */
id|KEY_4
comma
multiline_comment|/*   5 */
multiline_comment|/* 0x16 */
id|KEY_6
comma
multiline_comment|/*   7 */
multiline_comment|/* 0x17 */
id|KEY_5
comma
multiline_comment|/*   6 */
multiline_comment|/* 0x18 */
id|KEY_EQUAL
comma
multiline_comment|/*  13 */
multiline_comment|/* 0x19 */
id|KEY_9
comma
multiline_comment|/*  10 */
multiline_comment|/* 0x1a */
id|KEY_7
comma
multiline_comment|/*   8 */
multiline_comment|/* 0x1b */
id|KEY_MINUS
comma
multiline_comment|/*  12 */
multiline_comment|/* 0x1c */
id|KEY_8
comma
multiline_comment|/*   9 */
multiline_comment|/* 0x1d */
id|KEY_0
comma
multiline_comment|/*  11 */
multiline_comment|/* 0x1e */
id|KEY_RIGHTBRACE
comma
multiline_comment|/*  27 */
multiline_comment|/* 0x1f */
id|KEY_O
comma
multiline_comment|/*  24 */
multiline_comment|/* 0x20 */
id|KEY_U
comma
multiline_comment|/*  22 */
multiline_comment|/* 0x21 */
id|KEY_LEFTBRACE
comma
multiline_comment|/*  26 */
multiline_comment|/* 0x22 */
id|KEY_I
comma
multiline_comment|/*  23 */
multiline_comment|/* 0x23 */
id|KEY_P
comma
multiline_comment|/*  25 */
multiline_comment|/* 0x24 */
id|KEY_ENTER
comma
multiline_comment|/*  28 */
multiline_comment|/* 0x25 */
id|KEY_L
comma
multiline_comment|/*  38 */
multiline_comment|/* 0x26 */
id|KEY_J
comma
multiline_comment|/*  36 */
multiline_comment|/* 0x27 */
id|KEY_APOSTROPHE
comma
multiline_comment|/*  40 */
multiline_comment|/* 0x28 */
id|KEY_K
comma
multiline_comment|/*  37 */
multiline_comment|/* 0x29 */
id|KEY_SEMICOLON
comma
multiline_comment|/*  39 */
multiline_comment|/* 0x2a */
id|KEY_BACKSLASH
comma
multiline_comment|/*  43 */
multiline_comment|/* 0x2b */
id|KEY_COMMA
comma
multiline_comment|/*  51 */
multiline_comment|/* 0x2c */
id|KEY_SLASH
comma
multiline_comment|/*  53 */
multiline_comment|/* 0x2d */
id|KEY_N
comma
multiline_comment|/*  49 */
multiline_comment|/* 0x2e */
id|KEY_M
comma
multiline_comment|/*  50 */
multiline_comment|/* 0x2f */
id|KEY_DOT
comma
multiline_comment|/*  52 */
multiline_comment|/* 0x30 */
id|KEY_TAB
comma
multiline_comment|/*  15 */
multiline_comment|/* 0x31 */
id|KEY_SPACE
comma
multiline_comment|/*  57 */
multiline_comment|/* 0x32 */
id|KEY_GRAVE
comma
multiline_comment|/*  41 */
multiline_comment|/* 0x33 */
id|KEY_BACKSPACE
comma
multiline_comment|/*  14 */
multiline_comment|/* 0x34 */
id|KEY_KPENTER
comma
multiline_comment|/*  96 */
multiline_comment|/* 0x35 */
id|KEY_ESC
comma
multiline_comment|/*   1 */
multiline_comment|/* 0x36 */
id|KEY_LEFTCTRL
comma
multiline_comment|/*  29 */
multiline_comment|/* 0x37 */
id|KEY_LEFTMETA
comma
multiline_comment|/* 125 */
multiline_comment|/* 0x38 */
id|KEY_LEFTSHIFT
comma
multiline_comment|/*  42 */
multiline_comment|/* 0x39 */
id|KEY_CAPSLOCK
comma
multiline_comment|/*  58 */
multiline_comment|/* 0x3a */
id|KEY_LEFTALT
comma
multiline_comment|/*  56 */
multiline_comment|/* 0x3b */
id|KEY_LEFT
comma
multiline_comment|/* 105 */
multiline_comment|/* 0x3c */
id|KEY_RIGHT
comma
multiline_comment|/* 106 */
multiline_comment|/* 0x3d */
id|KEY_DOWN
comma
multiline_comment|/* 108 */
multiline_comment|/* 0x3e */
id|KEY_UP
comma
multiline_comment|/* 103 */
multiline_comment|/* 0x3f */
l_int|0
comma
multiline_comment|/* 0x40 */
l_int|0
comma
multiline_comment|/* 0x41 */
id|KEY_KPDOT
comma
multiline_comment|/*  83 */
multiline_comment|/* 0x42 */
l_int|0
comma
multiline_comment|/* 0x43 */
id|KEY_KPASTERISK
comma
multiline_comment|/*  55 */
multiline_comment|/* 0x44 */
l_int|0
comma
multiline_comment|/* 0x45 */
id|KEY_KPPLUS
comma
multiline_comment|/*  78 */
multiline_comment|/* 0x46 */
l_int|0
comma
multiline_comment|/* 0x47 */
id|KEY_NUMLOCK
comma
multiline_comment|/*  69 */
multiline_comment|/* 0x48 */
l_int|0
comma
multiline_comment|/* 0x49 */
l_int|0
comma
multiline_comment|/* 0x4a */
l_int|0
comma
multiline_comment|/* 0x4b */
id|KEY_KPSLASH
comma
multiline_comment|/*  98 */
multiline_comment|/* 0x4c */
id|KEY_KPENTER
comma
multiline_comment|/*  96 */
multiline_comment|/* 0x4d */
l_int|0
comma
multiline_comment|/* 0x4e */
id|KEY_KPMINUS
comma
multiline_comment|/*  74 */
multiline_comment|/* 0x4f */
l_int|0
comma
multiline_comment|/* 0x50 */
l_int|0
comma
multiline_comment|/* 0x51 */
id|KEY_KPEQUAL
comma
multiline_comment|/* 117 */
multiline_comment|/* 0x52 */
id|KEY_KP0
comma
multiline_comment|/*  82 */
multiline_comment|/* 0x53 */
id|KEY_KP1
comma
multiline_comment|/*  79 */
multiline_comment|/* 0x54 */
id|KEY_KP2
comma
multiline_comment|/*  80 */
multiline_comment|/* 0x55 */
id|KEY_KP3
comma
multiline_comment|/*  81 */
multiline_comment|/* 0x56 */
id|KEY_KP4
comma
multiline_comment|/*  75 */
multiline_comment|/* 0x57 */
id|KEY_KP5
comma
multiline_comment|/*  76 */
multiline_comment|/* 0x58 */
id|KEY_KP6
comma
multiline_comment|/*  77 */
multiline_comment|/* 0x59 */
id|KEY_KP7
comma
multiline_comment|/*  71 */
multiline_comment|/* 0x5a */
l_int|0
comma
multiline_comment|/* 0x5b */
id|KEY_KP8
comma
multiline_comment|/*  72 */
multiline_comment|/* 0x5c */
id|KEY_KP9
comma
multiline_comment|/*  73 */
multiline_comment|/* 0x5d */
id|KEY_YEN
comma
multiline_comment|/* 124 */
multiline_comment|/* 0x5e */
id|KEY_RO
comma
multiline_comment|/*  89 */
multiline_comment|/* 0x5f */
id|KEY_KPCOMMA
comma
multiline_comment|/* 121 */
multiline_comment|/* 0x60 */
id|KEY_F5
comma
multiline_comment|/*  63 */
multiline_comment|/* 0x61 */
id|KEY_F6
comma
multiline_comment|/*  64 */
multiline_comment|/* 0x62 */
id|KEY_F7
comma
multiline_comment|/*  65 */
multiline_comment|/* 0x63 */
id|KEY_F3
comma
multiline_comment|/*  61 */
multiline_comment|/* 0x64 */
id|KEY_F8
comma
multiline_comment|/*  66 */
multiline_comment|/* 0x65 */
id|KEY_F9
comma
multiline_comment|/*  67 */
multiline_comment|/* 0x66 */
id|KEY_HANJA
comma
multiline_comment|/* 123 */
multiline_comment|/* 0x67 */
id|KEY_F11
comma
multiline_comment|/*  87 */
multiline_comment|/* 0x68 */
id|KEY_HANGUEL
comma
multiline_comment|/* 122 */
multiline_comment|/* 0x69 */
id|KEY_SYSRQ
comma
multiline_comment|/*  99 */
multiline_comment|/* 0x6a */
l_int|0
comma
multiline_comment|/* 0x6b */
id|KEY_SCROLLLOCK
comma
multiline_comment|/*  70 */
multiline_comment|/* 0x6c */
l_int|0
comma
multiline_comment|/* 0x6d */
id|KEY_F10
comma
multiline_comment|/*  68 */
multiline_comment|/* 0x6e */
id|KEY_COMPOSE
comma
multiline_comment|/* 127 */
multiline_comment|/* 0x6f */
id|KEY_F12
comma
multiline_comment|/*  88 */
multiline_comment|/* 0x70 */
l_int|0
comma
multiline_comment|/* 0x71 */
id|KEY_PAUSE
comma
multiline_comment|/* 119 */
multiline_comment|/* 0x72 */
id|KEY_INSERT
comma
multiline_comment|/* 110 */
multiline_comment|/* 0x73 */
id|KEY_HOME
comma
multiline_comment|/* 102 */
multiline_comment|/* 0x74 */
id|KEY_PAGEUP
comma
multiline_comment|/* 104 */
multiline_comment|/* 0x75 */
id|KEY_DELETE
comma
multiline_comment|/* 111 */
multiline_comment|/* 0x76 */
id|KEY_F4
comma
multiline_comment|/*  62 */
multiline_comment|/* 0x77 */
id|KEY_END
comma
multiline_comment|/* 107 */
multiline_comment|/* 0x78 */
id|KEY_F2
comma
multiline_comment|/*  60 */
multiline_comment|/* 0x79 */
id|KEY_PAGEDOWN
comma
multiline_comment|/* 109 */
multiline_comment|/* 0x7a */
id|KEY_F1
comma
multiline_comment|/*  59 */
multiline_comment|/* 0x7b */
id|KEY_RIGHTSHIFT
comma
multiline_comment|/*  54 */
multiline_comment|/* 0x7c */
id|KEY_RIGHTALT
comma
multiline_comment|/* 100 */
multiline_comment|/* 0x7d */
id|KEY_RIGHTCTRL
comma
multiline_comment|/*  97 */
multiline_comment|/* 0x7e */
id|KEY_RIGHTMETA
comma
multiline_comment|/* 126 */
multiline_comment|/* 0x7f */
id|KEY_POWER
comma
multiline_comment|/* 116 */
)brace
suffix:semicolon
DECL|struct|adbhid
r_struct
id|adbhid
(brace
DECL|member|input
r_struct
id|input_dev
id|input
suffix:semicolon
DECL|member|id
r_int
id|id
suffix:semicolon
DECL|member|default_id
r_int
id|default_id
suffix:semicolon
DECL|member|original_handler_id
r_int
id|original_handler_id
suffix:semicolon
DECL|member|current_handler_id
r_int
id|current_handler_id
suffix:semicolon
DECL|member|mouse_kind
r_int
id|mouse_kind
suffix:semicolon
DECL|member|keycode
r_int
r_char
op_star
id|keycode
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|phys
r_char
id|phys
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|FLAG_FN_KEY_PRESSED
mdefine_line|#define FLAG_FN_KEY_PRESSED&t;0x00000001
DECL|macro|FLAG_POWER_FROM_FN
mdefine_line|#define FLAG_POWER_FROM_FN&t;0x00000002
DECL|macro|FLAG_EMU_FWDEL_DOWN
mdefine_line|#define FLAG_EMU_FWDEL_DOWN&t;0x00000004
DECL|variable|adbhid
r_static
r_struct
id|adbhid
op_star
id|adbhid
(braket
l_int|16
)braket
suffix:semicolon
r_static
r_void
id|adbhid_probe
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|adbhid_input_keycode
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_static
r_void
id|init_trackpad
c_func
(paren
r_int
id|id
)paren
suffix:semicolon
r_static
r_void
id|init_trackball
c_func
(paren
r_int
id|id
)paren
suffix:semicolon
r_static
r_void
id|init_turbomouse
c_func
(paren
r_int
id|id
)paren
suffix:semicolon
r_static
r_void
id|init_microspeed
c_func
(paren
r_int
id|id
)paren
suffix:semicolon
r_static
r_void
id|init_ms_a3
c_func
(paren
r_int
id|id
)paren
suffix:semicolon
DECL|variable|keyboard_ids
r_static
r_struct
id|adb_ids
id|keyboard_ids
suffix:semicolon
DECL|variable|mouse_ids
r_static
r_struct
id|adb_ids
id|mouse_ids
suffix:semicolon
DECL|variable|buttons_ids
r_static
r_struct
id|adb_ids
id|buttons_ids
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
multiline_comment|/* Exported to via-pmu.c */
DECL|variable|disable_kernel_backlight
r_int
id|disable_kernel_backlight
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
multiline_comment|/* Kind of keyboard, see Apple technote 1152  */
DECL|macro|ADB_KEYBOARD_UNKNOWN
mdefine_line|#define ADB_KEYBOARD_UNKNOWN&t;0
DECL|macro|ADB_KEYBOARD_ANSI
mdefine_line|#define ADB_KEYBOARD_ANSI&t;0x0100
DECL|macro|ADB_KEYBOARD_ISO
mdefine_line|#define ADB_KEYBOARD_ISO&t;0x0200
DECL|macro|ADB_KEYBOARD_JIS
mdefine_line|#define ADB_KEYBOARD_JIS&t;0x0300
multiline_comment|/* Kind of mouse  */
DECL|macro|ADBMOUSE_STANDARD_100
mdefine_line|#define ADBMOUSE_STANDARD_100&t;0&t;/* Standard 100cpi mouse (handler 1) */
DECL|macro|ADBMOUSE_STANDARD_200
mdefine_line|#define ADBMOUSE_STANDARD_200&t;1&t;/* Standard 200cpi mouse (handler 2) */
DECL|macro|ADBMOUSE_EXTENDED
mdefine_line|#define ADBMOUSE_EXTENDED&t;2&t;/* Apple Extended mouse (handler 4) */
DECL|macro|ADBMOUSE_TRACKBALL
mdefine_line|#define ADBMOUSE_TRACKBALL&t;3&t;/* TrackBall (handler 4) */
DECL|macro|ADBMOUSE_TRACKPAD
mdefine_line|#define ADBMOUSE_TRACKPAD       4&t;/* Apple&squot;s PowerBook trackpad (handler 4) */
DECL|macro|ADBMOUSE_TURBOMOUSE5
mdefine_line|#define ADBMOUSE_TURBOMOUSE5    5&t;/* Turbomouse 5 (previously req. mousehack) */
DECL|macro|ADBMOUSE_MICROSPEED
mdefine_line|#define ADBMOUSE_MICROSPEED&t;6&t;/* Microspeed mouse (&amp;trackball ?), MacPoint */
DECL|macro|ADBMOUSE_TRACKBALLPRO
mdefine_line|#define ADBMOUSE_TRACKBALLPRO&t;7&t;/* Trackball Pro (special buttons) */
DECL|macro|ADBMOUSE_MS_A3
mdefine_line|#define ADBMOUSE_MS_A3&t;&t;8&t;/* Mouse systems A3 trackball (handler 3) */
DECL|macro|ADBMOUSE_MACALLY2
mdefine_line|#define ADBMOUSE_MACALLY2&t;9&t;/* MacAlly 2-button mouse */
r_static
r_void
DECL|function|adbhid_keyboard_input
id|adbhid_keyboard_input
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|nb
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|apoll
)paren
(brace
r_int
id|id
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adbhid
(braket
id|id
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ADB HID on ID %d not yet registered, packet %#02x, %#02x, %#02x, %#02x&bslash;n&quot;
comma
id|id
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* first check this is from register 0 */
r_if
c_cond
(paren
id|nb
op_ne
l_int|3
op_logical_or
(paren
id|data
(braket
l_int|0
)braket
op_amp
l_int|3
)paren
op_ne
id|KEYB_KEYREG
)paren
r_return
suffix:semicolon
multiline_comment|/* ignore it */
id|adbhid_input_keycode
c_func
(paren
id|id
comma
id|data
(braket
l_int|1
)braket
comma
l_int|0
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
(braket
l_int|2
)braket
op_eq
l_int|0xff
op_logical_or
(paren
id|data
(braket
l_int|2
)braket
op_eq
l_int|0x7f
op_logical_and
id|data
(braket
l_int|1
)braket
op_eq
l_int|0x7f
)paren
)paren
)paren
id|adbhid_input_keycode
c_func
(paren
id|id
comma
id|data
(braket
l_int|2
)braket
comma
l_int|0
comma
id|regs
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_input_keycode
id|adbhid_input_keycode
c_func
(paren
r_int
id|id
comma
r_int
id|keycode
comma
r_int
id|repeat
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|adbhid
op_star
id|ahid
op_assign
id|adbhid
(braket
id|id
)braket
suffix:semicolon
r_int
id|up_flag
suffix:semicolon
id|up_flag
op_assign
(paren
id|keycode
op_amp
l_int|0x80
)paren
suffix:semicolon
id|keycode
op_and_assign
l_int|0x7f
suffix:semicolon
r_switch
c_cond
(paren
id|keycode
)paren
(brace
r_case
id|ADB_KEY_CAPSLOCK
suffix:colon
multiline_comment|/* Generate down/up events for CapsLock everytime. */
id|input_regs
c_func
(paren
op_amp
id|ahid-&gt;input
comma
id|regs
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
op_amp
id|ahid-&gt;input
comma
id|KEY_CAPSLOCK
comma
l_int|1
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
op_amp
id|ahid-&gt;input
comma
id|KEY_CAPSLOCK
comma
l_int|0
)paren
suffix:semicolon
id|input_sync
c_func
(paren
op_amp
id|ahid-&gt;input
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_PPC_PMAC
r_case
id|ADB_KEY_POWER_OLD
suffix:colon
multiline_comment|/* Power key on PBook 3400 needs remapping */
r_switch
c_cond
(paren
id|pmac_call_feature
c_func
(paren
id|PMAC_FTR_GET_MB_INFO
comma
l_int|NULL
comma
id|PMAC_MB_INFO_MODEL
comma
l_int|0
)paren
)paren
(brace
r_case
id|PMAC_TYPE_COMET
suffix:colon
r_case
id|PMAC_TYPE_HOOPER
suffix:colon
r_case
id|PMAC_TYPE_KANGA
suffix:colon
id|keycode
op_assign
id|ADB_KEY_POWER
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ADB_KEY_POWER
suffix:colon
multiline_comment|/* Fn + Command will produce a bogus &quot;power&quot; keycode */
r_if
c_cond
(paren
id|ahid-&gt;flags
op_amp
id|FLAG_FN_KEY_PRESSED
)paren
(brace
id|keycode
op_assign
id|ADB_KEY_CMD
suffix:semicolon
r_if
c_cond
(paren
id|up_flag
)paren
id|ahid-&gt;flags
op_and_assign
op_complement
id|FLAG_POWER_FROM_FN
suffix:semicolon
r_else
id|ahid-&gt;flags
op_or_assign
id|FLAG_POWER_FROM_FN
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ahid-&gt;flags
op_amp
id|FLAG_POWER_FROM_FN
)paren
(brace
id|keycode
op_assign
id|ADB_KEY_CMD
suffix:semicolon
id|ahid-&gt;flags
op_and_assign
op_complement
id|FLAG_POWER_FROM_FN
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ADB_KEY_FN
suffix:colon
multiline_comment|/* Keep track of the Fn key state */
r_if
c_cond
(paren
id|up_flag
)paren
(brace
id|ahid-&gt;flags
op_and_assign
op_complement
id|FLAG_FN_KEY_PRESSED
suffix:semicolon
multiline_comment|/* Emulate Fn+delete = forward delete */
r_if
c_cond
(paren
id|ahid-&gt;flags
op_amp
id|FLAG_EMU_FWDEL_DOWN
)paren
(brace
id|ahid-&gt;flags
op_and_assign
op_complement
id|FLAG_EMU_FWDEL_DOWN
suffix:semicolon
id|keycode
op_assign
id|ADB_KEY_FWDEL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|ahid-&gt;flags
op_or_assign
id|FLAG_FN_KEY_PRESSED
suffix:semicolon
multiline_comment|/* Swallow the key press */
r_return
suffix:semicolon
r_case
id|ADB_KEY_DEL
suffix:colon
multiline_comment|/* Emulate Fn+delete = forward delete */
r_if
c_cond
(paren
id|ahid-&gt;flags
op_amp
id|FLAG_FN_KEY_PRESSED
)paren
(brace
id|keycode
op_assign
id|ADB_KEY_FWDEL
suffix:semicolon
r_if
c_cond
(paren
id|up_flag
)paren
id|ahid-&gt;flags
op_and_assign
op_complement
id|FLAG_EMU_FWDEL_DOWN
suffix:semicolon
r_else
id|ahid-&gt;flags
op_or_assign
id|FLAG_EMU_FWDEL_DOWN
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_PPC_PMAC */
)brace
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
id|keycode
)braket
)paren
(brace
id|input_regs
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|regs
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
id|keycode
)braket
comma
op_logical_neg
id|up_flag
)paren
suffix:semicolon
id|input_sync
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Unhandled ADB key (scancode %#02x) %s.&bslash;n&quot;
comma
id|keycode
comma
id|up_flag
ques
c_cond
l_string|&quot;released&quot;
suffix:colon
l_string|&quot;pressed&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_mouse_input
id|adbhid_mouse_input
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|nb
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|autopoll
)paren
(brace
r_int
id|id
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adbhid
(braket
id|id
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ADB HID on ID %d not yet registered&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;    Handler 1 -- 100cpi original Apple mouse protocol.&n;    Handler 2 -- 200cpi original Apple mouse protocol.&n;&n;    For Apple&squot;s standard one-button mouse protocol the data array will&n;    contain the following values:&n;&n;                BITS    COMMENTS&n;    data[0] = dddd 1100 ADB command: Talk, register 0, for device dddd.&n;    data[1] = bxxx xxxx First button and x-axis motion.&n;    data[2] = byyy yyyy Second button and y-axis motion.&n;&n;    Handler 4 -- Apple Extended mouse protocol.&n;&n;    For Apple&squot;s 3-button mouse protocol the data array will contain the&n;    following values:&n;&n;&t;&t;BITS    COMMENTS&n;    data[0] = dddd 1100 ADB command: Talk, register 0, for device dddd.&n;    data[1] = bxxx xxxx Left button and x-axis motion.&n;    data[2] = byyy yyyy Second button and y-axis motion.&n;    data[3] = byyy bxxx Third button and fourth button.  Y is additional&n;&t;      high bits of y-axis motion.  XY is additional&n;&t;      high bits of x-axis motion.&n;&n;    MacAlly 2-button mouse protocol.&n;&n;    For MacAlly 2-button mouse protocol the data array will contain the&n;    following values:&n;&n;&t;&t;BITS    COMMENTS&n;    data[0] = dddd 1100 ADB command: Talk, register 0, for device dddd.&n;    data[1] = bxxx xxxx Left button and x-axis motion.&n;    data[2] = byyy yyyy Right button and y-axis motion.&n;    data[3] = ???? ???? unknown&n;    data[4] = ???? ???? unknown&n;&n;  */
multiline_comment|/* If it&squot;s a trackpad, we alias the second button to the first.&n;&t;   NOTE: Apple sends an ADB flush command to the trackpad when&n;&t;         the first (the real) button is released. We could do&n;&t;&t; this here using async flush requests.&n;&t;*/
r_switch
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|mouse_kind
)paren
(brace
r_case
id|ADBMOUSE_TRACKPAD
suffix:colon
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
id|data
(braket
l_int|2
)braket
)paren
op_amp
l_int|0x80
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|data
(braket
l_int|2
)braket
op_or
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADBMOUSE_MICROSPEED
suffix:colon
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x02
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x77
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x04
)paren
op_lshift
l_int|5
)paren
op_or
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x08
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADBMOUSE_TRACKBALLPRO
suffix:colon
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x04
)paren
op_lshift
l_int|5
)paren
op_amp
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x08
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x77
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x02
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADBMOUSE_MS_A3
suffix:colon
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
op_or
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x02
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|data
(braket
l_int|3
)braket
op_amp
l_int|0x04
)paren
op_lshift
l_int|5
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADBMOUSE_MACALLY2
suffix:colon
id|data
(braket
l_int|3
)braket
op_assign
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* Right button is mapped as button 3 */
id|nb
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|input_regs
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|regs
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|BTN_LEFT
comma
op_logical_neg
(paren
(paren
id|data
(braket
l_int|1
)braket
op_rshift
l_int|7
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|BTN_MIDDLE
comma
op_logical_neg
(paren
(paren
id|data
(braket
l_int|2
)braket
op_rshift
l_int|7
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nb
op_ge
l_int|4
op_logical_and
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|mouse_kind
op_ne
id|ADBMOUSE_TRACKPAD
)paren
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|BTN_RIGHT
comma
op_logical_neg
(paren
(paren
id|data
(braket
l_int|3
)braket
op_rshift
l_int|7
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|REL_X
comma
(paren
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
OL
l_int|64
ques
c_cond
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
suffix:colon
(paren
id|data
(braket
l_int|2
)braket
op_amp
l_int|0x7f
)paren
op_minus
l_int|128
)paren
)paren
suffix:semicolon
id|input_report_rel
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|REL_Y
comma
(paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
OL
l_int|64
ques
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
suffix:colon
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x7f
)paren
op_minus
l_int|128
)paren
)paren
suffix:semicolon
id|input_sync
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_buttons_input
id|adbhid_buttons_input
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|nb
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|autopoll
)paren
(brace
r_int
id|id
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adbhid
(braket
id|id
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ADB HID on ID %d not yet registered&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|input_regs
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|regs
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|original_handler_id
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_case
l_int|0x02
suffix:colon
multiline_comment|/* Adjustable keyboard button device */
(brace
r_int
id|down
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_eq
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x0f
)paren
(brace
r_case
l_int|0x0
suffix:colon
multiline_comment|/* microphone */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_SOUND
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
multiline_comment|/* mute */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_MUTE
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
multiline_comment|/* volume decrease */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_VOLUMEDOWN
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
multiline_comment|/* volume increase */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_VOLUMEUP
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Unhandled ADB_MISC event %02x, %02x, %02x, %02x&bslash;n&quot;
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
comma
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|0x1f
suffix:colon
multiline_comment|/* Powerbook button device */
(brace
r_int
id|down
op_assign
(paren
id|data
(braket
l_int|1
)braket
op_eq
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_int
id|backlight
op_assign
id|get_backlight_level
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t;&t; * XXX: Where is the contrast control for the passive?&n;&t;&t; *  -- Cort&n;&t;&t; */
r_switch
c_cond
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x0f
)paren
(brace
r_case
l_int|0x8
suffix:colon
multiline_comment|/* mute */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_MUTE
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7
suffix:colon
multiline_comment|/* volume decrease */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_VOLUMEDOWN
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6
suffix:colon
multiline_comment|/* volume increase */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_VOLUMEUP
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xb
suffix:colon
multiline_comment|/* eject */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_EJECTCD
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xa
suffix:colon
multiline_comment|/* brightness decrease */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
op_logical_neg
id|disable_kernel_backlight
)paren
(brace
r_if
c_cond
(paren
id|down
op_logical_and
id|backlight
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|backlight
OG
id|BACKLIGHT_OFF
)paren
id|set_backlight_level
c_func
(paren
id|backlight
op_minus
l_int|1
)paren
suffix:semicolon
r_else
id|set_backlight_level
c_func
(paren
id|BACKLIGHT_OFF
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_BRIGHTNESSDOWN
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x9
suffix:colon
multiline_comment|/* brightness increase */
macro_line|#ifdef CONFIG_PMAC_BACKLIGHT
r_if
c_cond
(paren
op_logical_neg
id|disable_kernel_backlight
)paren
(brace
r_if
c_cond
(paren
id|down
op_logical_and
id|backlight
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|backlight
OL
id|BACKLIGHT_MAX
)paren
id|set_backlight_level
c_func
(paren
id|backlight
op_plus
l_int|1
)paren
suffix:semicolon
r_else
id|set_backlight_level
c_func
(paren
id|BACKLIGHT_MAX
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_PMAC_BACKLIGHT */
id|input_report_key
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
comma
id|KEY_BRIGHTNESSUP
comma
id|down
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
id|input_sync
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
)brace
DECL|variable|led_request
r_static
r_struct
id|adb_request
id|led_request
suffix:semicolon
DECL|variable|leds_pending
r_static
r_int
id|leds_pending
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|leds_req_pending
r_static
r_int
id|leds_req_pending
suffix:semicolon
DECL|variable|pending_devs
r_static
r_int
id|pending_devs
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|pending_led_start
r_static
r_int
id|pending_led_start
op_assign
l_int|0
suffix:semicolon
DECL|variable|pending_led_end
r_static
r_int
id|pending_led_end
op_assign
l_int|0
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|leds_lock
)paren
suffix:semicolon
DECL|function|leds_done
r_static
r_void
id|leds_done
c_func
(paren
r_struct
id|adb_request
op_star
id|req
)paren
(brace
r_int
id|leds
op_assign
l_int|0
comma
id|device
op_assign
l_int|0
comma
id|pending
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|leds_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pending_led_start
op_ne
id|pending_led_end
)paren
(brace
id|device
op_assign
id|pending_devs
(braket
id|pending_led_start
)braket
suffix:semicolon
id|leds
op_assign
id|leds_pending
(braket
id|device
)braket
op_amp
l_int|0xff
suffix:semicolon
id|leds_pending
(braket
id|device
)braket
op_assign
l_int|0
suffix:semicolon
id|pending_led_start
op_increment
suffix:semicolon
id|pending_led_start
op_assign
(paren
id|pending_led_start
OL
l_int|16
)paren
ques
c_cond
id|pending_led_start
suffix:colon
l_int|0
suffix:semicolon
id|pending
op_assign
id|leds_req_pending
suffix:semicolon
)brace
r_else
id|leds_req_pending
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|leds_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pending
)paren
id|adb_request
c_func
(paren
op_amp
id|led_request
comma
id|leds_done
comma
l_int|0
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|device
comma
id|KEYB_LEDREG
)paren
comma
l_int|0xff
comma
op_complement
id|leds
)paren
suffix:semicolon
)brace
DECL|function|real_leds
r_static
r_void
id|real_leds
c_func
(paren
r_int
r_char
id|leds
comma
r_int
id|device
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|leds_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|leds_req_pending
)paren
(brace
id|leds_req_pending
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|leds_lock
comma
id|flags
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|led_request
comma
id|leds_done
comma
l_int|0
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|device
comma
id|KEYB_LEDREG
)paren
comma
l_int|0xff
comma
op_complement
id|leds
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|leds_pending
(braket
id|device
)braket
op_amp
l_int|0x100
)paren
)paren
(brace
id|pending_devs
(braket
id|pending_led_end
)braket
op_assign
id|device
suffix:semicolon
id|pending_led_end
op_increment
suffix:semicolon
id|pending_led_end
op_assign
(paren
id|pending_led_end
OL
l_int|16
)paren
ques
c_cond
id|pending_led_end
suffix:colon
l_int|0
suffix:semicolon
)brace
id|leds_pending
(braket
id|device
)braket
op_assign
id|leds
op_or
l_int|0x100
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|leds_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Event callback from the input module. Events that change the state of&n; * the hardware are processed here.&n; */
DECL|function|adbhid_kbd_event
r_static
r_int
id|adbhid_kbd_event
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_int
r_int
id|code
comma
r_int
id|value
)paren
(brace
r_struct
id|adbhid
op_star
id|adbhid
op_assign
id|dev
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
r_char
id|leds
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|EV_LED
suffix:colon
id|leds
op_assign
(paren
id|test_bit
c_func
(paren
id|LED_SCROLLL
comma
id|dev-&gt;led
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|0
)paren
op_or
(paren
id|test_bit
c_func
(paren
id|LED_NUML
comma
id|dev-&gt;led
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
op_or
(paren
id|test_bit
c_func
(paren
id|LED_CAPSL
comma
id|dev-&gt;led
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|0
)paren
suffix:semicolon
id|real_leds
c_func
(paren
id|leds
comma
id|adbhid-&gt;id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|adb_message_handler
id|adb_message_handler
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|code
comma
r_void
op_star
id|x
)paren
(brace
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
id|ADB_MSG_PRE_RESET
suffix:colon
r_case
id|ADB_MSG_POWERDOWN
suffix:colon
multiline_comment|/* Stop the repeat timer. Autopoll is already off at this point */
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adbhid
(braket
id|i
)braket
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|adbhid
(braket
id|i
)braket
op_member_access_from_pointer
id|input.timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Stop pending led requests */
r_while
c_loop
(paren
id|leds_req_pending
)paren
(brace
id|adb_poll
c_func
(paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ADB_MSG_POST_RESET
suffix:colon
id|adbhid_probe
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_input_register
id|adbhid_input_register
c_func
(paren
r_int
id|id
comma
r_int
id|default_id
comma
r_int
id|original_handler_id
comma
r_int
id|current_handler_id
comma
r_int
id|mouse_kind
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Trying to reregister ADB HID on ID %d&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adbhid
(braket
id|id
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|adbhid
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|adbhid
(braket
id|id
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|adbhid
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|phys
comma
l_string|&quot;adb%d:%d.%02x/input&quot;
comma
id|id
comma
id|default_id
comma
id|original_handler_id
)paren
suffix:semicolon
id|init_input_dev
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|id
op_assign
id|default_id
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|original_handler_id
op_assign
id|original_handler_id
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|current_handler_id
op_assign
id|current_handler_id
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|mouse_kind
op_assign
id|mouse_kind
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|flags
op_assign
l_int|0
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
dot
r_private
op_assign
id|adbhid
(braket
id|id
)braket
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.name
op_assign
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.phys
op_assign
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|phys
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.bustype
op_assign
id|BUS_ADB
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.vendor
op_assign
l_int|0x0001
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.product
op_assign
(paren
id|id
op_lshift
l_int|12
)paren
op_or
(paren
id|default_id
op_lshift
l_int|8
)paren
op_or
id|original_handler_id
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.version
op_assign
l_int|0x0100
suffix:semicolon
r_switch
c_cond
(paren
id|default_id
)paren
(brace
r_case
id|ADB_KEYBOARD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|adb_to_linux_keycodes
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|adbhid
(braket
id|id
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
comma
l_string|&quot;ADB keyboard&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
comma
id|adb_to_linux_keycodes
comma
r_sizeof
(paren
id|adb_to_linux_keycodes
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Detected ADB keyboard, type &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|original_handler_id
)paren
(brace
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;&lt;unknown&gt;.&bslash;n&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.version
op_assign
id|ADB_KEYBOARD_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
r_case
l_int|0x02
suffix:colon
r_case
l_int|0x03
suffix:colon
r_case
l_int|0x06
suffix:colon
r_case
l_int|0x08
suffix:colon
r_case
l_int|0x0C
suffix:colon
r_case
l_int|0x10
suffix:colon
r_case
l_int|0x18
suffix:colon
r_case
l_int|0x1B
suffix:colon
r_case
l_int|0x1C
suffix:colon
r_case
l_int|0xC0
suffix:colon
r_case
l_int|0xC3
suffix:colon
r_case
l_int|0xC6
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ANSI.&bslash;n&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.version
op_assign
id|ADB_KEYBOARD_ANSI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
r_case
l_int|0x05
suffix:colon
r_case
l_int|0x07
suffix:colon
r_case
l_int|0x09
suffix:colon
r_case
l_int|0x0D
suffix:colon
r_case
l_int|0x11
suffix:colon
r_case
l_int|0x14
suffix:colon
r_case
l_int|0x19
suffix:colon
r_case
l_int|0x1D
suffix:colon
r_case
l_int|0xC1
suffix:colon
r_case
l_int|0xC4
suffix:colon
r_case
l_int|0xC7
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ISO, swapping keys.&bslash;n&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.version
op_assign
id|ADB_KEYBOARD_ISO
suffix:semicolon
id|i
op_assign
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
l_int|10
)braket
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
l_int|10
)braket
op_assign
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
l_int|50
)braket
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
l_int|50
)braket
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x12
suffix:colon
r_case
l_int|0x15
suffix:colon
r_case
l_int|0x16
suffix:colon
r_case
l_int|0x17
suffix:colon
r_case
l_int|0x1A
suffix:colon
r_case
l_int|0x1E
suffix:colon
r_case
l_int|0xC2
suffix:colon
r_case
l_int|0xC5
suffix:colon
r_case
l_int|0xC8
suffix:colon
r_case
l_int|0xC9
suffix:colon
id|printk
c_func
(paren
l_string|&quot;JIS.&bslash;n&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.version
op_assign
id|ADB_KEYBOARD_JIS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
id|i
)braket
)paren
id|set_bit
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
(braket
id|i
)braket
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_LED
)paren
op_or
id|BIT
c_func
(paren
id|EV_REP
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.ledbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|LED_SCROLLL
)paren
op_or
id|BIT
c_func
(paren
id|LED_CAPSL
)paren
op_or
id|BIT
c_func
(paren
id|LED_NUML
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.event
op_assign
id|adbhid_kbd_event
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keycodemax
op_assign
l_int|127
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keycodesize
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADB_MOUSE
suffix:colon
id|sprintf
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
comma
l_string|&quot;ADB mouse&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_REL
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
(braket
id|LONG
c_func
(paren
id|BTN_MOUSE
)paren
)braket
op_assign
id|BIT
c_func
(paren
id|BTN_LEFT
)paren
op_or
id|BIT
c_func
(paren
id|BTN_MIDDLE
)paren
op_or
id|BIT
c_func
(paren
id|BTN_RIGHT
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.relbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|REL_X
)paren
op_or
id|BIT
c_func
(paren
id|REL_Y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADB_MISC
suffix:colon
r_switch
c_cond
(paren
id|original_handler_id
)paren
(brace
r_case
l_int|0x02
suffix:colon
multiline_comment|/* Adjustable keyboard button device */
id|sprintf
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
comma
l_string|&quot;ADB adjustable keyboard buttons&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_REP
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_SOUND
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_MUTE
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_VOLUMEUP
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_VOLUMEDOWN
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1f
suffix:colon
multiline_comment|/* Powerbook button device */
id|sprintf
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
comma
l_string|&quot;ADB Powerbook buttons&quot;
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_KEY
)paren
op_or
id|BIT
c_func
(paren
id|EV_REP
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_MUTE
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_VOLUMEUP
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_VOLUMEDOWN
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_BRIGHTNESSUP
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_BRIGHTNESSDOWN
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|KEY_EJECTCD
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keybit
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
(braket
l_int|0
)braket
)paren
r_break
suffix:semicolon
multiline_comment|/* else fall through */
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Trying to register unknown ADB device to input layer.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|adbhid
(braket
id|id
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.keycode
op_assign
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
suffix:semicolon
id|input_register_device
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;input: %s on %s&bslash;n&quot;
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|name
comma
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|default_id
op_eq
id|ADB_KEYBOARD
)paren
(brace
multiline_comment|/* HACK WARNING!! This should go away as soon there is an utility&n;&t;&t; * to control that for event devices.&n;&t;&t; */
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.rep
(braket
id|REP_DELAY
)braket
op_assign
l_int|500
suffix:semicolon
multiline_comment|/* input layer default: 250 */
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.rep
(braket
id|REP_PERIOD
)braket
op_assign
l_int|66
suffix:semicolon
multiline_comment|/* input layer default: 33 */
)brace
)brace
DECL|function|adbhid_input_unregister
r_static
r_void
id|adbhid_input_unregister
c_func
(paren
r_int
id|id
)paren
(brace
id|input_unregister_device
c_func
(paren
op_amp
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
)paren
id|kfree
c_func
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|keycode
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|adbhid
(braket
id|id
)braket
)paren
suffix:semicolon
id|adbhid
(braket
id|id
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
id|u16
DECL|function|adbhid_input_reregister
id|adbhid_input_reregister
c_func
(paren
r_int
id|id
comma
r_int
id|default_id
comma
r_int
id|org_handler_id
comma
r_int
id|cur_handler_id
comma
r_int
id|mk
)paren
(brace
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
)paren
(brace
r_if
c_cond
(paren
id|adbhid
(braket
id|id
)braket
op_member_access_from_pointer
id|input.id.product
op_ne
(paren
(paren
id|id
op_lshift
l_int|12
)paren
op_or
(paren
id|default_id
op_lshift
l_int|8
)paren
op_or
id|org_handler_id
)paren
)paren
(brace
id|adbhid_input_unregister
c_func
(paren
id|id
)paren
suffix:semicolon
id|adbhid_input_register
c_func
(paren
id|id
comma
id|default_id
comma
id|org_handler_id
comma
id|cur_handler_id
comma
id|mk
)paren
suffix:semicolon
)brace
)brace
r_else
id|adbhid_input_register
c_func
(paren
id|id
comma
id|default_id
comma
id|org_handler_id
comma
id|cur_handler_id
comma
id|mk
)paren
suffix:semicolon
r_return
l_int|1
op_lshift
id|id
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_input_devcleanup
id|adbhid_input_devcleanup
c_func
(paren
id|u16
id|exist
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adbhid
(braket
id|i
)braket
op_logical_and
op_logical_neg
(paren
id|exist
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
id|adbhid_input_unregister
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|adbhid_probe
id|adbhid_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
r_int
id|i
comma
id|default_id
comma
id|org_handler_id
comma
id|cur_handler_id
suffix:semicolon
id|u16
id|reg
op_assign
l_int|0
suffix:semicolon
id|adb_register
c_func
(paren
id|ADB_MOUSE
comma
l_int|0
comma
op_amp
id|mouse_ids
comma
id|adbhid_mouse_input
)paren
suffix:semicolon
id|adb_register
c_func
(paren
id|ADB_KEYBOARD
comma
l_int|0
comma
op_amp
id|keyboard_ids
comma
id|adbhid_keyboard_input
)paren
suffix:semicolon
id|adb_register
c_func
(paren
id|ADB_MISC
comma
l_int|0
comma
op_amp
id|buttons_ids
comma
id|adbhid_buttons_input
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|keyboard_ids.nids
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|id
op_assign
id|keyboard_ids.id
(braket
id|i
)braket
suffix:semicolon
id|adb_get_infos
c_func
(paren
id|id
comma
op_amp
id|default_id
comma
op_amp
id|org_handler_id
)paren
suffix:semicolon
multiline_comment|/* turn off all leds */
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
id|KEYB_LEDREG
)paren
comma
l_int|0xff
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Enable full feature set of the keyboard&n;&t;&t;   -&gt;get it to send separate codes for left and right shift,&n;&t;&t;   control, option keys */
macro_line|#if 0&t;&t;/* handler 5 doesn&squot;t send separate codes for R modifiers */
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|5
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;ADB keyboard at %d, handler set to 5&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|3
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;ADB keyboard at %d, handler set to 3&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;ADB keyboard at %d, handler 1&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
id|adb_get_infos
c_func
(paren
id|id
comma
op_amp
id|default_id
comma
op_amp
id|cur_handler_id
)paren
suffix:semicolon
id|reg
op_or_assign
id|adbhid_input_reregister
c_func
(paren
id|id
comma
id|default_id
comma
id|org_handler_id
comma
id|cur_handler_id
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|buttons_ids.nids
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|id
op_assign
id|buttons_ids.id
(braket
id|i
)braket
suffix:semicolon
id|adb_get_infos
c_func
(paren
id|id
comma
op_amp
id|default_id
comma
op_amp
id|org_handler_id
)paren
suffix:semicolon
id|reg
op_or_assign
id|adbhid_input_reregister
c_func
(paren
id|id
comma
id|default_id
comma
id|org_handler_id
comma
id|org_handler_id
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Try to switch all mice to handler 4, or 2 for three-button&n;&t;   mode and full resolution. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mouse_ids.nids
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|id
op_assign
id|mouse_ids.id
(braket
id|i
)braket
suffix:semicolon
r_int
id|mouse_kind
suffix:semicolon
id|adb_get_infos
c_func
(paren
id|id
comma
op_amp
id|default_id
comma
op_amp
id|org_handler_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|4
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 4&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_EXTENDED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|0x2F
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 0x2F&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_MICROSPEED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|0x42
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 0x42&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_TRACKBALLPRO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|0x66
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 0x66&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_MICROSPEED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|0x5F
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 0x5F&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_MICROSPEED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|3
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 3&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_MS_A3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler set to 2&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_STANDARD_200
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;ADB mouse at %d, handler 1&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_STANDARD_100
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mouse_kind
op_eq
id|ADBMOUSE_TRACKBALLPRO
)paren
op_logical_or
(paren
id|mouse_kind
op_eq
id|ADBMOUSE_MICROSPEED
)paren
)paren
(brace
id|init_microspeed
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mouse_kind
op_eq
id|ADBMOUSE_MS_A3
)paren
(brace
id|init_ms_a3
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mouse_kind
op_eq
id|ADBMOUSE_EXTENDED
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Register 1 is usually used for device&n;&t;&t;&t; * identification.  Here, we try to identify&n;&t;&t;&t; * a known device and call the appropriate&n;&t;&t;&t; * init function.&n;&t;&t;&t; */
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
op_or
id|ADBREQ_REPLY
comma
l_int|1
comma
id|ADB_READREG
c_func
(paren
id|id
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|req.reply_len
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|1
)braket
op_eq
l_int|0x9a
)paren
op_logical_and
(paren
(paren
id|req.reply
(braket
l_int|2
)braket
op_eq
l_int|0x21
)paren
op_logical_or
(paren
id|req.reply
(braket
l_int|2
)braket
op_eq
l_int|0x20
)paren
)paren
)paren
(brace
id|mouse_kind
op_assign
id|ADBMOUSE_TRACKBALL
suffix:semicolon
id|init_trackball
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|req.reply_len
op_ge
l_int|4
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|1
)braket
op_eq
l_int|0x74
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|2
)braket
op_eq
l_int|0x70
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|3
)braket
op_eq
l_int|0x61
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|4
)braket
op_eq
l_int|0x64
)paren
)paren
(brace
id|mouse_kind
op_assign
id|ADBMOUSE_TRACKPAD
suffix:semicolon
id|init_trackpad
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|req.reply_len
op_ge
l_int|4
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|1
)braket
op_eq
l_int|0x4b
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|2
)braket
op_eq
l_int|0x4d
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|3
)braket
op_eq
l_int|0x4c
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|4
)braket
op_eq
l_int|0x31
)paren
)paren
(brace
id|mouse_kind
op_assign
id|ADBMOUSE_TURBOMOUSE5
suffix:semicolon
id|init_turbomouse
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|req.reply_len
op_eq
l_int|9
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|1
)braket
op_eq
l_int|0x4b
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|2
)braket
op_eq
l_int|0x4f
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|3
)braket
op_eq
l_int|0x49
)paren
op_logical_and
(paren
id|req.reply
(braket
l_int|4
)braket
op_eq
l_int|0x54
)paren
)paren
(brace
r_if
c_cond
(paren
id|adb_try_handler_change
c_func
(paren
id|id
comma
l_int|0x42
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nADB MacAlly 2-button mouse at %d, handler set to 0x42&quot;
comma
id|id
)paren
suffix:semicolon
id|mouse_kind
op_assign
id|ADBMOUSE_MACALLY2
suffix:semicolon
)brace
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|adb_get_infos
c_func
(paren
id|id
comma
op_amp
id|default_id
comma
op_amp
id|cur_handler_id
)paren
suffix:semicolon
id|reg
op_or_assign
id|adbhid_input_reregister
c_func
(paren
id|id
comma
id|default_id
comma
id|org_handler_id
comma
id|cur_handler_id
comma
id|mouse_kind
)paren
suffix:semicolon
)brace
id|adbhid_input_devcleanup
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_trackpad
id|init_trackpad
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
r_int
r_char
id|r1_buffer
(braket
l_int|8
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; (trackpad)&quot;
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
op_or
id|ADBREQ_REPLY
comma
l_int|1
comma
id|ADB_READREG
c_func
(paren
id|id
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req.reply_len
OL
l_int|8
)paren
id|printk
c_func
(paren
l_string|&quot;bad length for reg. 1&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
id|r1_buffer
comma
op_amp
id|req.reply
(braket
l_int|1
)braket
comma
l_int|8
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|9
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
id|r1_buffer
(braket
l_int|0
)braket
comma
id|r1_buffer
(braket
l_int|1
)braket
comma
id|r1_buffer
(braket
l_int|2
)braket
comma
id|r1_buffer
(braket
l_int|3
)braket
comma
id|r1_buffer
(braket
l_int|4
)braket
comma
id|r1_buffer
(braket
l_int|5
)braket
comma
l_int|0x0d
comma
id|r1_buffer
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|9
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|2
)paren
comma
l_int|0x99
comma
l_int|0x94
comma
l_int|0x19
comma
l_int|0xff
comma
l_int|0xb2
comma
l_int|0x8a
comma
l_int|0x1b
comma
l_int|0x50
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|9
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
id|r1_buffer
(braket
l_int|0
)braket
comma
id|r1_buffer
(braket
l_int|1
)braket
comma
id|r1_buffer
(braket
l_int|2
)braket
comma
id|r1_buffer
(braket
l_int|3
)braket
comma
id|r1_buffer
(braket
l_int|4
)braket
comma
id|r1_buffer
(braket
l_int|5
)braket
comma
l_int|0x03
comma
multiline_comment|/*r1_buffer[6],*/
id|r1_buffer
(braket
l_int|7
)braket
)paren
suffix:semicolon
multiline_comment|/* Without this flush, the trackpad may be locked up */
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
id|id
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|init_trackball
id|init_trackball
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; (trackman/mouseman)&quot;
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|00
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|01
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|02
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|03
comma
l_int|0x38
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|00
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|01
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|02
comma
l_int|0x81
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|03
comma
l_int|0x38
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_turbomouse
id|init_turbomouse
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; (TurboMouse 5)&quot;
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
id|id
)paren
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|9
comma
id|ADB_WRITEREG
c_func
(paren
l_int|3
comma
l_int|2
)paren
comma
l_int|0xe7
comma
l_int|0x8c
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x94
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|9
comma
id|ADB_WRITEREG
c_func
(paren
l_int|3
comma
l_int|2
)paren
comma
l_int|0xa5
comma
l_int|0x14
comma
l_int|0
comma
l_int|0
comma
l_int|0x69
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x27
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_microspeed
id|init_microspeed
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; (Microspeed/MacPoint or compatible)&quot;
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
id|id
)paren
)paren
suffix:semicolon
multiline_comment|/* This will initialize mice using the Microspeed, MacPoint and&n;&t;   other compatible firmware. Bit 12 enables extended protocol.&n;&t;   &n;&t;   Register 1 Listen (4 Bytes)&n;            0 -  3     Button is mouse (set also for double clicking!!!)&n;            4 -  7     Button is locking (affects change speed also)&n;            8 - 11     Button changes speed&n;           12          1 = Extended mouse mode, 0 = normal mouse mode&n;           13 - 15     unused 0&n;           16 - 23     normal speed&n;           24 - 31     changed speed&n;&n;       Register 1 talk holds version and product identification information.&n;       Register 1 Talk (4 Bytes):&n;            0 -  7     Product code&n;            8 - 23     undefined, reserved&n;           24 - 31     Version number&n;        &n;       Speed 0 is max. 1 to 255 set speed in increments of 1/256 of max.&n; */
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|5
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|1
)paren
comma
l_int|0x20
comma
multiline_comment|/* alt speed = 0x20 (rather slow) */
l_int|0x00
comma
multiline_comment|/* norm speed = 0x00 (fastest) */
l_int|0x10
comma
multiline_comment|/* extended protocol, no speed change */
l_int|0x07
)paren
suffix:semicolon
multiline_comment|/* all buttons enabled as mouse buttons, no locking */
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
id|id
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|init_ms_a3
id|init_ms_a3
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; (Mouse Systems A3 Mouse, or compatible)&quot;
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|3
comma
id|ADB_WRITEREG
c_func
(paren
id|id
comma
l_int|0x2
)paren
comma
l_int|0x00
comma
l_int|0x07
)paren
suffix:semicolon
id|adb_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
id|ADBREQ_SYNC
comma
l_int|1
comma
id|ADB_FLUSH
c_func
(paren
id|id
)paren
)paren
suffix:semicolon
)brace
DECL|function|adbhid_init
r_static
r_int
id|__init
id|adbhid_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef CONFIG_MAC
r_if
c_cond
(paren
(paren
id|_machine
op_ne
id|_MACH_chrp
)paren
op_logical_and
(paren
id|_machine
op_ne
id|_MACH_Pmac
)paren
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
id|led_request.complete
op_assign
l_int|1
suffix:semicolon
id|adbhid_probe
c_func
(paren
)paren
suffix:semicolon
id|notifier_chain_register
c_func
(paren
op_amp
id|adb_client_list
comma
op_amp
id|adbhid_adb_notifier
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|adbhid_exit
r_static
r_void
id|__exit
id|adbhid_exit
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|adbhid_init
id|module_init
c_func
(paren
id|adbhid_init
)paren
suffix:semicolon
DECL|variable|adbhid_exit
id|module_exit
c_func
(paren
id|adbhid_exit
)paren
suffix:semicolon
eof
