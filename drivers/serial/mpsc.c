multiline_comment|/*&n; * drivers/serial/mpsc.c&n; *&n; * Generic driver for the MPSC (UART mode) on Marvell parts (e.g., GT64240,&n; * GT64260, MV64340, MV64360, GT96100, ... ).&n; *&n; * Author: Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * Based on an old MPSC driver that was in the linuxppc tree.  It appears to&n; * have been created by Chris Zankel (formerly of MontaVista) but there&n; * is no proper Copyright so I&squot;m not sure.  Apparently, parts were also&n; * taken from PPCBoot (now U-Boot).  Also based on drivers/serial/8250.c&n; * by Russell King.&n; *&n; * 2004 (c) MontaVista, Software, Inc.  This file is licensed under&n; * the terms of the GNU General Public License version 2.  This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
multiline_comment|/*&n; * The MPSC interface is much like a typical network controller&squot;s interface.&n; * That is, you set up separate rings of descriptors for transmitting and&n; * receiving data.  There is also a pool of buffers with (one buffer per&n; * descriptor) that incoming data are dma&squot;d into or outgoing data are dma&squot;d&n; * out of.&n; *&n; * The MPSC requires two other controllers to be able to work.  The Baud Rate&n; * Generator (BRG) provides a clock at programmable frequencies which determines&n; * the baud rate.  The Serial DMA Controller (SDMA) takes incoming data from the&n; * MPSC and DMA&squot;s it into memory or DMA&squot;s outgoing data and passes it to the&n; * MPSC.  It is actually the SDMA interrupt that the driver uses to keep the&n; * transmit and receive &quot;engines&quot; going (i.e., indicate data has been&n; * transmitted or received).&n; *&n; * NOTES:&n; *&n; * 1) Some chips have an erratum where several regs cannot be&n; * read.  To work around that, we keep a local copy of those regs in&n; * &squot;mpsc_port_info&squot; and use the *_M or *_S macros when accessing those regs.&n; *&n; * 2) Some chips have an erratum where the ctlr will hang when the SDMA ctlr&n; * accesses system mem in a cache coherent region.  This *should* be a&n; * show-stopper when coherency is turned on but it seems to work okay as&n; * long as there are no snoop hits.  Therefore, the ring buffer entries and&n; * the buffers themselves are allocated via &squot;dma_alloc_noncoherent()&squot; and&n; * &squot;dma_cache_sync()&squot; is used.  Also, since most PPC platforms are coherent&n; * which makes &squot;dma_cache_sync()&squot; a no-op, explicit cache management macros&n; * have been added ensuring there are no snoop hits when coherency is on.&n; *&n; * 3) There is an erratum (on PPC) where you can&squot;t use the instruction to do&n; * a DMA_TO_DEVICE/cache clean so DMA_BIDIRECTIONAL/flushes are used in places&n; * where a DMA_TO_DEVICE/clean would have [otherwise] sufficed.&n; *&n; * 4) AFAICT, hardware flow control isn&squot;t supported by the controller --MAG.&n; */
macro_line|#include &lt;linux/mv64xxx.h&gt;
macro_line|#include &quot;mpsc.h&quot;
multiline_comment|/*&n; * Define how this driver is known to the outside (we&squot;ve been assigned a&n; * range on the &quot;Low-density serial ports&quot; major).&n; */
DECL|macro|MPSC_MAJOR
mdefine_line|#define MPSC_MAJOR&t;&t;204
DECL|macro|MPSC_MINOR_START
mdefine_line|#define MPSC_MINOR_START&t;44
DECL|macro|MPSC_DRIVER_NAME
mdefine_line|#define&t;MPSC_DRIVER_NAME&t;&quot;MPSC&quot;
DECL|macro|MPSC_DEVFS_NAME
mdefine_line|#define&t;MPSC_DEVFS_NAME&t;&t;&quot;ttymm/&quot;
DECL|macro|MPSC_DEV_NAME
mdefine_line|#define&t;MPSC_DEV_NAME&t;&t;&quot;ttyMM&quot;
DECL|macro|MPSC_VERSION
mdefine_line|#define&t;MPSC_VERSION&t;&t;&quot;1.00&quot;
DECL|variable|mpsc_ports
r_static
r_struct
id|mpsc_port_info
id|mpsc_ports
(braket
id|MPSC_NUM_CTLRS
)braket
suffix:semicolon
DECL|variable|mpsc_shared_regs
r_static
r_struct
id|mpsc_shared_regs
id|mpsc_shared_regs
suffix:semicolon
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Baud Rate Generator Routines (BRG)&n; *&n; ******************************************************************************&n; */
r_static
r_void
DECL|function|mpsc_brg_init
id|mpsc_brg_init
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|clk_src
)paren
(brace
r_if
c_cond
(paren
id|pi-&gt;brg_can_tune
)paren
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BCR
comma
l_int|1
comma
l_int|25
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BCR
comma
l_int|4
comma
l_int|18
comma
id|clk_src
)paren
suffix:semicolon
id|MPSC_MOD_FIELD
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BTR
comma
l_int|16
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_brg_enable
id|mpsc_brg_enable
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BCR
comma
l_int|1
comma
l_int|16
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_brg_disable
id|mpsc_brg_disable
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BCR
comma
l_int|1
comma
l_int|16
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_set_baudrate
id|mpsc_set_baudrate
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|baud
)paren
(brace
multiline_comment|/*&n;&t; * To set the baud, we adjust the CDV field in the BRG_BCR reg.&n;&t; * From manual: Baud = clk / ((CDV+1)*2) ==&gt; CDV = (clk / (baud*2)) - 1.&n;&t; * However, the input clock is divided by 16 in the MPSC b/c of how&n;&t; * &squot;MPSC_MMCRH&squot; was set up so we have to divide the &squot;clk&squot; used in our&n;&t; * calculation by 16 to account for that.  So the real calculation&n;&t; * that accounts for the way the mpsc is set up is:&n;&t; * CDV = (clk / (baud*2*16)) - 1 ==&gt; CDV = (clk / (baud &lt;&lt; 5)) - 1.&n;&t; */
id|u32
id|cdv
op_assign
(paren
id|pi-&gt;port.uartclk
op_div
(paren
id|baud
op_lshift
l_int|5
)paren
)paren
op_minus
l_int|1
suffix:semicolon
id|mpsc_brg_disable
c_func
(paren
id|pi
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|brg
comma
id|BRG_BCR
comma
l_int|16
comma
l_int|0
comma
id|cdv
)paren
suffix:semicolon
id|mpsc_brg_enable
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Serial DMA Routines (SDMA)&n; *&n; ******************************************************************************&n; */
r_static
r_void
DECL|function|mpsc_sdma_burstsize
id|mpsc_sdma_burstsize
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|burst_size
)paren
(brace
id|u32
id|v
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_burstsize[%d]: burst_size: %d&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|burst_size
)paren
suffix:semicolon
id|burst_size
op_rshift_assign
l_int|3
suffix:semicolon
multiline_comment|/* Divide by 8 b/c reg values are 8-byte chunks */
r_if
c_cond
(paren
id|burst_size
OL
l_int|2
)paren
id|v
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* 1 64-bit word */
r_else
r_if
c_cond
(paren
id|burst_size
OL
l_int|4
)paren
id|v
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* 2 64-bit words */
r_else
r_if
c_cond
(paren
id|burst_size
OL
l_int|8
)paren
id|v
op_assign
l_int|0x2
suffix:semicolon
multiline_comment|/* 4 64-bit words */
r_else
id|v
op_assign
l_int|0x3
suffix:semicolon
multiline_comment|/* 8 64-bit words */
id|MPSC_MOD_FIELD
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDC
comma
l_int|2
comma
l_int|12
comma
id|v
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_sdma_init
id|mpsc_sdma_init
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|burst_size
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_init[%d]: burst_size: %d&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|burst_size
)paren
suffix:semicolon
id|MPSC_MOD_FIELD
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDC
comma
l_int|10
comma
l_int|0
comma
l_int|0x03f
)paren
suffix:semicolon
id|mpsc_sdma_burstsize
c_func
(paren
id|pi
comma
id|burst_size
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
id|u32
DECL|function|mpsc_sdma_intr_mask
id|mpsc_sdma_intr_mask
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|mask
)paren
(brace
id|u32
id|old
comma
id|v
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_intr_mask[%d]: mask: 0x%x&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|mask
)paren
suffix:semicolon
id|old
op_assign
id|v
op_assign
id|MPSC_READ_S
c_func
(paren
id|pi
comma
id|sdma_intr
comma
id|SDMA_INTR_MASK
)paren
suffix:semicolon
id|mask
op_and_assign
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;port.line
)paren
id|mask
op_lshift_assign
l_int|8
suffix:semicolon
id|v
op_and_assign
op_complement
id|mask
suffix:semicolon
id|MPSC_WRITE_S
c_func
(paren
id|pi
comma
id|sdma_intr
comma
id|SDMA_INTR_MASK
comma
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;port.line
)paren
id|old
op_rshift_assign
l_int|8
suffix:semicolon
r_return
id|old
op_amp
l_int|0xf
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_intr_unmask
id|mpsc_sdma_intr_unmask
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|mask
)paren
(brace
id|u32
id|v
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_intr_unmask[%d]: mask: 0x%x&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|mask
)paren
suffix:semicolon
id|v
op_assign
id|MPSC_READ_S
c_func
(paren
id|pi
comma
id|sdma_intr
comma
id|SDMA_INTR_MASK
)paren
suffix:semicolon
id|mask
op_and_assign
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;port.line
)paren
id|mask
op_lshift_assign
l_int|8
suffix:semicolon
id|v
op_or_assign
id|mask
suffix:semicolon
id|MPSC_WRITE_S
c_func
(paren
id|pi
comma
id|sdma_intr
comma
id|SDMA_INTR_MASK
comma
id|v
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_intr_ack
id|mpsc_sdma_intr_ack
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_intr_ack[%d]: Acknowledging IRQ&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|MPSC_WRITE_S
c_func
(paren
id|pi
comma
id|sdma_intr
comma
id|SDMA_INTR_CAUSE
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_set_rx_ring
id|mpsc_sdma_set_rx_ring
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
r_struct
id|mpsc_rx_desc
op_star
id|rxre_p
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_set_rx_ring[%d]: rxre_p: 0x%x&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
(paren
id|u32
)paren
id|rxre_p
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SCRDP
comma
(paren
id|u32
)paren
id|rxre_p
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_set_tx_ring
id|mpsc_sdma_set_tx_ring
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
r_struct
id|mpsc_tx_desc
op_star
id|txre_p
)paren
(brace
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SFTDP
comma
(paren
id|u32
)paren
id|txre_p
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SCTDP
comma
(paren
id|u32
)paren
id|txre_p
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_cmd
id|mpsc_sdma_cmd
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|val
)paren
(brace
id|u32
id|v
suffix:semicolon
id|v
op_assign
id|MPSC_READ
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDCM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|v
op_or_assign
id|val
suffix:semicolon
r_else
id|v
op_assign
l_int|0
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDCM
comma
id|v
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
id|uint
DECL|function|mpsc_sdma_tx_active
id|mpsc_sdma_tx_active
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_return
id|MPSC_READ
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDCM
)paren
op_amp
id|SDMA_SDCM_TXD
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_start_tx
id|mpsc_sdma_start_tx
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_struct
id|mpsc_tx_desc
op_star
id|txre
comma
op_star
id|txre_p
suffix:semicolon
multiline_comment|/* If tx isn&squot;t running &amp; there&squot;s a desc ready to go, start it */
r_if
c_cond
(paren
op_logical_neg
id|mpsc_sdma_tx_active
c_func
(paren
id|pi
)paren
)paren
(brace
id|txre
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
(paren
id|pi-&gt;txr
op_plus
(paren
id|pi-&gt;txr_tail
op_star
id|MPSC_TXRE_SIZE
)paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|txre
comma
id|MPSC_TXRE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|txre
comma
(paren
id|u32
)paren
id|txre
op_plus
id|MPSC_TXRE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|be32_to_cpu
c_func
(paren
id|txre-&gt;cmdstat
)paren
op_amp
id|SDMA_DESC_CMDSTAT_O
)paren
(brace
id|txre_p
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
(paren
id|pi-&gt;txr_p
op_plus
(paren
id|pi-&gt;txr_tail
op_star
id|MPSC_TXRE_SIZE
)paren
)paren
suffix:semicolon
id|mpsc_sdma_set_tx_ring
c_func
(paren
id|pi
comma
id|txre_p
)paren
suffix:semicolon
id|mpsc_sdma_cmd
c_func
(paren
id|pi
comma
id|SDMA_SDCM_STD
op_or
id|SDMA_SDCM_TXD
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_sdma_stop
id|mpsc_sdma_stop
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_stop[%d]: Stopping SDMA&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
multiline_comment|/* Abort any SDMA transfers */
id|mpsc_sdma_cmd
c_func
(paren
id|pi
comma
l_int|0
)paren
suffix:semicolon
id|mpsc_sdma_cmd
c_func
(paren
id|pi
comma
id|SDMA_SDCM_AR
op_or
id|SDMA_SDCM_AT
)paren
suffix:semicolon
multiline_comment|/* Clear the SDMA current and first TX and RX pointers */
id|mpsc_sdma_set_tx_ring
c_func
(paren
id|pi
comma
l_int|0
)paren
suffix:semicolon
id|mpsc_sdma_set_rx_ring
c_func
(paren
id|pi
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts */
id|mpsc_sdma_intr_mask
c_func
(paren
id|pi
comma
l_int|0xf
)paren
suffix:semicolon
id|mpsc_sdma_intr_ack
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Multi-Protocol Serial Controller Routines (MPSC)&n; *&n; ******************************************************************************&n; */
r_static
r_void
DECL|function|mpsc_hw_init
id|mpsc_hw_init
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_hw_init[%d]: Initializing hardware&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
multiline_comment|/* Set up clock routing */
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_MRR
comma
l_int|3
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_MRR
comma
l_int|3
comma
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_RCRR
comma
l_int|4
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_RCRR
comma
l_int|4
comma
l_int|8
comma
l_int|1
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_TCRR
comma
l_int|4
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_S
c_func
(paren
id|pi
comma
id|mpsc_routing
comma
id|MPSC_TCRR
comma
l_int|4
comma
l_int|8
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Put MPSC in UART mode &amp; enabel Tx/Rx egines */
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MMCRL
comma
l_int|0x000004c4
)paren
suffix:semicolon
multiline_comment|/* No preamble, 16x divider, low-latency,  */
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MMCRH
comma
l_int|0x04400400
)paren
suffix:semicolon
id|MPSC_WRITE_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_1
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_2
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_3
comma
id|pi-&gt;mpsc_max_idle
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_4
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_5
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_6
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_7
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_8
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_9
comma
l_int|0
)paren
suffix:semicolon
id|MPSC_WRITE
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_10
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_enter_hunt
id|mpsc_enter_hunt
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|u32
id|v
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_enter_hunt[%d]: Hunting...&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_2
comma
l_int|1
comma
l_int|31
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* If erratum prevents reading CHR_2, just delay for a while */
r_if
c_cond
(paren
id|pi-&gt;mirror_regs
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_else
r_do
(brace
id|v
op_assign
id|MPSC_READ_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_2
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|v
op_amp
id|MPSC_CHR_2_EH
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_freeze
id|mpsc_freeze
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_freeze[%d]: Freezing&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MPCR
comma
l_int|1
comma
l_int|9
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_unfreeze
id|mpsc_unfreeze
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MPCR
comma
l_int|1
comma
l_int|9
comma
l_int|0
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_unfreeze[%d]: Unfrozen&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_set_char_length
id|mpsc_set_char_length
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|len
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_set_char_length[%d]: char len: %d&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|len
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MPCR
comma
l_int|2
comma
l_int|12
comma
id|len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_set_stop_bit_length
id|mpsc_set_stop_bit_length
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|len
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_set_stop_bit_length[%d]: stop bits: %d&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|len
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_MPCR
comma
l_int|1
comma
l_int|14
comma
id|len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_set_parity
id|mpsc_set_parity
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|p
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_set_parity[%d]: parity bits: 0x%x&bslash;n&quot;
comma
id|pi-&gt;port.line
comma
id|p
)paren
suffix:semicolon
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_2
comma
l_int|2
comma
l_int|2
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* TPM */
id|MPSC_MOD_FIELD_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_2
comma
l_int|2
comma
l_int|18
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* RPM */
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Driver Init Routines&n; *&n; ******************************************************************************&n; */
r_static
r_void
DECL|function|mpsc_init_hw
id|mpsc_init_hw
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_init_hw[%d]: Initializing&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|mpsc_brg_init
c_func
(paren
id|pi
comma
id|pi-&gt;brg_clk_src
)paren
suffix:semicolon
id|mpsc_brg_enable
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_sdma_init
c_func
(paren
id|pi
comma
id|dma_get_cache_alignment
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/* burst a cacheline */
id|mpsc_sdma_stop
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_hw_init
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_alloc_ring_mem
id|mpsc_alloc_ring_mem
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_static
r_void
id|mpsc_free_ring_mem
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_alloc_ring_mem[%d]: Allocating ring mem&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;dma_region
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dma_supported
c_func
(paren
id|pi-&gt;port.dev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MPSC: Inadequate DMA support&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|pi-&gt;dma_region
op_assign
id|dma_alloc_noncoherent
c_func
(paren
id|pi-&gt;port.dev
comma
id|MPSC_DMA_ALLOC_SIZE
comma
op_amp
id|pi-&gt;dma_region_p
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MPSC: Can&squot;t alloc Desc region&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_free_ring_mem
id|mpsc_free_ring_mem
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_free_ring_mem[%d]: Freeing ring mem&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;dma_region
)paren
(brace
id|dma_free_noncoherent
c_func
(paren
id|pi-&gt;port.dev
comma
id|MPSC_DMA_ALLOC_SIZE
comma
id|pi-&gt;dma_region
comma
id|pi-&gt;dma_region_p
)paren
suffix:semicolon
id|pi-&gt;dma_region
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;dma_region_p
op_assign
(paren
id|dma_addr_t
)paren
l_int|NULL
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_init_rings
id|mpsc_init_rings
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_struct
id|mpsc_rx_desc
op_star
id|rxre
suffix:semicolon
r_struct
id|mpsc_tx_desc
op_star
id|txre
suffix:semicolon
id|dma_addr_t
id|dp
comma
id|dp_p
suffix:semicolon
id|u8
op_star
id|bp
comma
op_star
id|bp_p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_init_rings[%d]: Initializing rings&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|pi-&gt;dma_region
op_eq
l_int|NULL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pi-&gt;dma_region
comma
l_int|0
comma
id|MPSC_DMA_ALLOC_SIZE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Descriptors &amp; buffers are multiples of cacheline size and must be&n;&t; * cacheline aligned.&n;&t; */
id|dp
op_assign
id|ALIGN
c_func
(paren
(paren
id|u32
)paren
id|pi-&gt;dma_region
comma
id|dma_get_cache_alignment
c_func
(paren
)paren
)paren
suffix:semicolon
id|dp_p
op_assign
id|ALIGN
c_func
(paren
(paren
id|u32
)paren
id|pi-&gt;dma_region_p
comma
id|dma_get_cache_alignment
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Partition dma region into rx ring descriptor, rx buffers,&n;&t; * tx ring descriptors, and tx buffers.&n;&t; */
id|pi-&gt;rxr
op_assign
id|dp
suffix:semicolon
id|pi-&gt;rxr_p
op_assign
id|dp_p
suffix:semicolon
id|dp
op_add_assign
id|MPSC_RXR_SIZE
suffix:semicolon
id|dp_p
op_add_assign
id|MPSC_RXR_SIZE
suffix:semicolon
id|pi-&gt;rxb
op_assign
(paren
id|u8
op_star
)paren
id|dp
suffix:semicolon
id|pi-&gt;rxb_p
op_assign
(paren
id|u8
op_star
)paren
id|dp_p
suffix:semicolon
id|dp
op_add_assign
id|MPSC_RXB_SIZE
suffix:semicolon
id|dp_p
op_add_assign
id|MPSC_RXB_SIZE
suffix:semicolon
id|pi-&gt;rxr_posn
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txr
op_assign
id|dp
suffix:semicolon
id|pi-&gt;txr_p
op_assign
id|dp_p
suffix:semicolon
id|dp
op_add_assign
id|MPSC_TXR_SIZE
suffix:semicolon
id|dp_p
op_add_assign
id|MPSC_TXR_SIZE
suffix:semicolon
id|pi-&gt;txb
op_assign
(paren
id|u8
op_star
)paren
id|dp
suffix:semicolon
id|pi-&gt;txb_p
op_assign
(paren
id|u8
op_star
)paren
id|dp_p
suffix:semicolon
id|pi-&gt;txr_head
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txr_tail
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Init rx ring descriptors */
id|dp
op_assign
id|pi-&gt;rxr
suffix:semicolon
id|dp_p
op_assign
id|pi-&gt;rxr_p
suffix:semicolon
id|bp
op_assign
id|pi-&gt;rxb
suffix:semicolon
id|bp_p
op_assign
id|pi-&gt;rxb_p
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MPSC_RXR_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rxre
op_assign
(paren
r_struct
id|mpsc_rx_desc
op_star
)paren
id|dp
suffix:semicolon
id|rxre-&gt;bufsize
op_assign
id|cpu_to_be16
c_func
(paren
id|MPSC_RXBE_SIZE
)paren
suffix:semicolon
id|rxre-&gt;bytecnt
op_assign
id|cpu_to_be16
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rxre-&gt;cmdstat
op_assign
id|cpu_to_be32
c_func
(paren
id|SDMA_DESC_CMDSTAT_O
op_or
id|SDMA_DESC_CMDSTAT_EI
op_or
id|SDMA_DESC_CMDSTAT_F
op_or
id|SDMA_DESC_CMDSTAT_L
)paren
suffix:semicolon
id|rxre-&gt;link
op_assign
id|cpu_to_be32
c_func
(paren
id|dp_p
op_plus
id|MPSC_RXRE_SIZE
)paren
suffix:semicolon
id|rxre-&gt;buf_ptr
op_assign
id|cpu_to_be32
c_func
(paren
id|bp_p
)paren
suffix:semicolon
id|dp
op_add_assign
id|MPSC_RXRE_SIZE
suffix:semicolon
id|dp_p
op_add_assign
id|MPSC_RXRE_SIZE
suffix:semicolon
id|bp
op_add_assign
id|MPSC_RXBE_SIZE
suffix:semicolon
id|bp_p
op_add_assign
id|MPSC_RXBE_SIZE
suffix:semicolon
)brace
id|rxre-&gt;link
op_assign
id|cpu_to_be32
c_func
(paren
id|pi-&gt;rxr_p
)paren
suffix:semicolon
multiline_comment|/* Wrap last back to first */
multiline_comment|/* Init tx ring descriptors */
id|dp
op_assign
id|pi-&gt;txr
suffix:semicolon
id|dp_p
op_assign
id|pi-&gt;txr_p
suffix:semicolon
id|bp
op_assign
id|pi-&gt;txb
suffix:semicolon
id|bp_p
op_assign
id|pi-&gt;txb_p
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MPSC_TXR_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|txre
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
id|dp
suffix:semicolon
id|txre-&gt;link
op_assign
id|cpu_to_be32
c_func
(paren
id|dp_p
op_plus
id|MPSC_TXRE_SIZE
)paren
suffix:semicolon
id|txre-&gt;buf_ptr
op_assign
id|cpu_to_be32
c_func
(paren
id|bp_p
)paren
suffix:semicolon
id|dp
op_add_assign
id|MPSC_TXRE_SIZE
suffix:semicolon
id|dp_p
op_add_assign
id|MPSC_TXRE_SIZE
suffix:semicolon
id|bp
op_add_assign
id|MPSC_TXBE_SIZE
suffix:semicolon
id|bp_p
op_add_assign
id|MPSC_TXBE_SIZE
suffix:semicolon
)brace
id|txre-&gt;link
op_assign
id|cpu_to_be32
c_func
(paren
id|pi-&gt;txr_p
)paren
suffix:semicolon
multiline_comment|/* Wrap last back to first */
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|pi-&gt;dma_region
comma
id|MPSC_DMA_ALLOC_SIZE
comma
id|DMA_BIDIRECTIONAL
)paren
suffix:semicolon
id|MPSC_CACHE_FLUSH
c_func
(paren
id|pi
comma
id|pi-&gt;dma_region
comma
id|pi-&gt;dma_region
op_plus
id|MPSC_DMA_ALLOC_SIZE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_uninit_rings
id|mpsc_uninit_rings
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_uninit_rings[%d]: Uninitializing rings&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|pi-&gt;dma_region
op_eq
l_int|NULL
)paren
suffix:semicolon
id|pi-&gt;rxr
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;rxr_p
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;rxb
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;rxb_p
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;rxr_posn
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txr
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txr_p
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txb
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;txb_p
op_assign
l_int|NULL
suffix:semicolon
id|pi-&gt;txr_head
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;txr_tail
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_make_ready
id|mpsc_make_ready
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_int
id|rc
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_make_ready[%d]: Making cltr ready&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;ready
)paren
(brace
id|mpsc_init_hw
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|mpsc_alloc_ring_mem
c_func
(paren
id|pi
)paren
)paren
)paren
r_return
id|rc
suffix:semicolon
id|mpsc_init_rings
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi-&gt;ready
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Interrupt Handling Routines&n; *&n; ******************************************************************************&n; */
r_static
r_inline
r_int
DECL|function|mpsc_rx_intr
id|mpsc_rx_intr
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|mpsc_rx_desc
op_star
id|rxre
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|pi-&gt;port.info-&gt;tty
suffix:semicolon
id|u32
id|cmdstat
comma
id|bytes_in
comma
id|i
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|u8
op_star
id|bp
suffix:semicolon
r_char
id|flag
op_assign
id|TTY_NORMAL
suffix:semicolon
r_static
r_void
id|mpsc_start_rx
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_rx_intr[%d]: Handling Rx intr&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|rxre
op_assign
(paren
r_struct
id|mpsc_rx_desc
op_star
)paren
(paren
id|pi-&gt;rxr
op_plus
(paren
id|pi-&gt;rxr_posn
op_star
id|MPSC_RXRE_SIZE
)paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|rxre
comma
id|MPSC_RXRE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|rxre
comma
(paren
id|u32
)paren
id|rxre
op_plus
id|MPSC_RXRE_SIZE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Loop through Rx descriptors handling ones that have been completed.&n;&t; */
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|cmdstat
op_assign
id|be32_to_cpu
c_func
(paren
id|rxre-&gt;cmdstat
)paren
)paren
op_amp
id|SDMA_DESC_CMDSTAT_O
)paren
)paren
(brace
id|bytes_in
op_assign
id|be16_to_cpu
c_func
(paren
id|rxre-&gt;bytecnt
)paren
suffix:semicolon
multiline_comment|/* Following use of tty struct directly is deprecated */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
(paren
id|tty-&gt;flip.count
op_plus
id|bytes_in
)paren
op_ge
id|TTY_FLIPBUF_SIZE
)paren
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;low_latency
)paren
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * If this failed then we will throw awa the bytes&n;&t;&t;&t; * but mst do so to clear interrupts.&n;&t;&t;&t; */
)brace
id|bp
op_assign
id|pi-&gt;rxb
op_plus
(paren
id|pi-&gt;rxr_posn
op_star
id|MPSC_RXBE_SIZE
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|bp
comma
id|MPSC_RXBE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
id|bp
comma
id|bp
op_plus
id|MPSC_RXBE_SIZE
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Other than for parity error, the manual provides little&n;&t;&t; * info on what data will be in a frame flagged by any of&n;&t;&t; * these errors.  For parity error, it is the last byte in&n;&t;&t; * the buffer that had the error.  As for the rest, I guess&n;&t;&t; * we&squot;ll assume there is no data in the buffer.&n;&t;&t; * If there is...it gets lost.&n;&t;&t; */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|cmdstat
op_amp
(paren
id|SDMA_DESC_CMDSTAT_BR
op_or
id|SDMA_DESC_CMDSTAT_FR
op_or
id|SDMA_DESC_CMDSTAT_OR
)paren
)paren
)paren
(brace
id|pi-&gt;port.icount.rx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_BR
)paren
(brace
multiline_comment|/* Break */
id|pi-&gt;port.icount.brk
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_handle_break
c_func
(paren
op_amp
id|pi-&gt;port
)paren
)paren
r_goto
id|next_frame
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_FR
)paren
multiline_comment|/* Framing */
id|pi-&gt;port.icount.frame
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_OR
)paren
multiline_comment|/* Overrun */
id|pi-&gt;port.icount.overrun
op_increment
suffix:semicolon
id|cmdstat
op_and_assign
id|pi-&gt;port.read_status_mask
suffix:semicolon
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_BR
)paren
id|flag
op_assign
id|TTY_BREAK
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_FR
)paren
id|flag
op_assign
id|TTY_FRAME
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_OR
)paren
id|flag
op_assign
id|TTY_OVERRUN
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cmdstat
op_amp
id|SDMA_DESC_CMDSTAT_PE
)paren
id|flag
op_assign
id|TTY_PARITY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_handle_sysrq_char
c_func
(paren
op_amp
id|pi-&gt;port
comma
op_star
id|bp
comma
id|regs
)paren
)paren
(brace
id|bp
op_increment
suffix:semicolon
id|bytes_in
op_decrement
suffix:semicolon
r_goto
id|next_frame
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|unlikely
c_func
(paren
id|cmdstat
op_amp
(paren
id|SDMA_DESC_CMDSTAT_BR
op_or
id|SDMA_DESC_CMDSTAT_FR
op_or
id|SDMA_DESC_CMDSTAT_OR
)paren
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|cmdstat
op_amp
id|pi-&gt;port.ignore_status_mask
)paren
)paren
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
op_star
id|bp
comma
id|flag
)paren
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bytes_in
suffix:semicolon
id|i
op_increment
)paren
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
op_star
id|bp
op_increment
comma
id|TTY_NORMAL
)paren
suffix:semicolon
id|pi-&gt;port.icount.rx
op_add_assign
id|bytes_in
suffix:semicolon
)brace
id|next_frame
suffix:colon
id|rxre-&gt;bytecnt
op_assign
id|cpu_to_be16
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|rxre-&gt;cmdstat
op_assign
id|cpu_to_be32
c_func
(paren
id|SDMA_DESC_CMDSTAT_O
op_or
id|SDMA_DESC_CMDSTAT_EI
op_or
id|SDMA_DESC_CMDSTAT_F
op_or
id|SDMA_DESC_CMDSTAT_L
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|rxre
comma
id|MPSC_RXRE_SIZE
comma
id|DMA_BIDIRECTIONAL
)paren
suffix:semicolon
id|MPSC_CACHE_FLUSH
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|rxre
comma
(paren
id|u32
)paren
id|rxre
op_plus
id|MPSC_RXRE_SIZE
)paren
suffix:semicolon
multiline_comment|/* Advance to next descriptor */
id|pi-&gt;rxr_posn
op_assign
(paren
id|pi-&gt;rxr_posn
op_plus
l_int|1
)paren
op_amp
(paren
id|MPSC_RXR_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
id|rxre
op_assign
(paren
r_struct
id|mpsc_rx_desc
op_star
)paren
(paren
id|pi-&gt;rxr
op_plus
(paren
id|pi-&gt;rxr_posn
op_star
id|MPSC_RXRE_SIZE
)paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|rxre
comma
id|MPSC_RXRE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|rxre
comma
(paren
id|u32
)paren
id|rxre
op_plus
id|MPSC_RXRE_SIZE
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Restart rx engine, if its stopped */
r_if
c_cond
(paren
(paren
id|MPSC_READ
c_func
(paren
id|pi
comma
id|sdma
comma
id|SDMA_SDCM
)paren
op_amp
id|SDMA_SDCM_ERD
)paren
op_eq
l_int|0
)paren
id|mpsc_start_rx
c_func
(paren
id|pi
)paren
suffix:semicolon
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_setup_tx_desc
id|mpsc_setup_tx_desc
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
id|u32
id|count
comma
id|u32
id|intr
)paren
(brace
r_struct
id|mpsc_tx_desc
op_star
id|txre
suffix:semicolon
id|txre
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
(paren
id|pi-&gt;txr
op_plus
(paren
id|pi-&gt;txr_head
op_star
id|MPSC_TXRE_SIZE
)paren
)paren
suffix:semicolon
id|txre-&gt;bytecnt
op_assign
id|cpu_to_be16
c_func
(paren
id|count
)paren
suffix:semicolon
id|txre-&gt;shadow
op_assign
id|txre-&gt;bytecnt
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* ensure cmdstat is last field updated */
id|txre-&gt;cmdstat
op_assign
id|cpu_to_be32
c_func
(paren
id|SDMA_DESC_CMDSTAT_O
op_or
id|SDMA_DESC_CMDSTAT_F
op_or
id|SDMA_DESC_CMDSTAT_L
op_or
(paren
(paren
id|intr
)paren
ques
c_cond
id|SDMA_DESC_CMDSTAT_EI
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|txre
comma
id|MPSC_TXRE_SIZE
comma
id|DMA_BIDIRECTIONAL
)paren
suffix:semicolon
id|MPSC_CACHE_FLUSH
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|txre
comma
(paren
id|u32
)paren
id|txre
op_plus
id|MPSC_TXRE_SIZE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|mpsc_copy_tx_data
id|mpsc_copy_tx_data
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|pi-&gt;port.info-&gt;xmit
suffix:semicolon
id|u8
op_star
id|bp
suffix:semicolon
id|u32
id|i
suffix:semicolon
multiline_comment|/* Make sure the desc ring isn&squot;t full */
r_while
c_loop
(paren
id|CIRC_CNT
c_func
(paren
id|pi-&gt;txr_head
comma
id|pi-&gt;txr_tail
comma
id|MPSC_TXR_ENTRIES
)paren
OL
(paren
id|MPSC_TXR_ENTRIES
op_minus
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|pi-&gt;port.x_char
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Ideally, we should use the TCS field in&n;&t;&t;&t; * CHR_1 to put the x_char out immediately but&n;&t;&t;&t; * errata prevents us from being able to read&n;&t;&t;&t; * CHR_2 to know that its safe to write to&n;&t;&t;&t; * CHR_1.  Instead, just put it in-band with&n;&t;&t;&t; * all the other Tx data.&n;&t;&t;&t; */
id|bp
op_assign
id|pi-&gt;txb
op_plus
(paren
id|pi-&gt;txr_head
op_star
id|MPSC_TXBE_SIZE
)paren
suffix:semicolon
op_star
id|bp
op_assign
id|pi-&gt;port.x_char
suffix:semicolon
id|pi-&gt;port.x_char
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
op_logical_and
op_logical_neg
id|uart_tx_stopped
c_func
(paren
op_amp
id|pi-&gt;port
)paren
)paren
(brace
id|i
op_assign
id|min
c_func
(paren
(paren
id|u32
)paren
id|MPSC_TXBE_SIZE
comma
(paren
id|u32
)paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
)paren
suffix:semicolon
id|i
op_assign
id|min
c_func
(paren
id|i
comma
(paren
id|u32
)paren
id|CIRC_CNT_TO_END
c_func
(paren
id|xmit-&gt;head
comma
id|xmit-&gt;tail
comma
id|UART_XMIT_SIZE
)paren
)paren
suffix:semicolon
id|bp
op_assign
id|pi-&gt;txb
op_plus
(paren
id|pi-&gt;txr_head
op_star
id|MPSC_TXBE_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|bp
comma
op_amp
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
comma
id|i
)paren
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
id|i
)paren
op_amp
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
OL
id|WAKEUP_CHARS
)paren
id|uart_write_wakeup
c_func
(paren
op_amp
id|pi-&gt;port
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* All tx data copied into ring bufs */
r_return
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|bp
comma
id|MPSC_TXBE_SIZE
comma
id|DMA_BIDIRECTIONAL
)paren
suffix:semicolon
id|MPSC_CACHE_FLUSH
c_func
(paren
id|pi
comma
id|bp
comma
id|bp
op_plus
id|MPSC_TXBE_SIZE
)paren
suffix:semicolon
id|mpsc_setup_tx_desc
c_func
(paren
id|pi
comma
id|i
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Advance to next descriptor */
id|pi-&gt;txr_head
op_assign
(paren
id|pi-&gt;txr_head
op_plus
l_int|1
)paren
op_amp
(paren
id|MPSC_TXR_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|mpsc_tx_intr
id|mpsc_tx_intr
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_struct
id|mpsc_tx_desc
op_star
id|txre
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mpsc_sdma_tx_active
c_func
(paren
id|pi
)paren
)paren
(brace
id|txre
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
(paren
id|pi-&gt;txr
op_plus
(paren
id|pi-&gt;txr_tail
op_star
id|MPSC_TXRE_SIZE
)paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|txre
comma
id|MPSC_TXRE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|txre
comma
(paren
id|u32
)paren
id|txre
op_plus
id|MPSC_TXRE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|be32_to_cpu
c_func
(paren
id|txre-&gt;cmdstat
)paren
op_amp
id|SDMA_DESC_CMDSTAT_O
)paren
)paren
(brace
id|rc
op_assign
l_int|1
suffix:semicolon
id|pi-&gt;port.icount.tx
op_add_assign
id|be16_to_cpu
c_func
(paren
id|txre-&gt;bytecnt
)paren
suffix:semicolon
id|pi-&gt;txr_tail
op_assign
(paren
id|pi-&gt;txr_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|MPSC_TXR_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* If no more data to tx, fall out of loop */
r_if
c_cond
(paren
id|pi-&gt;txr_head
op_eq
id|pi-&gt;txr_tail
)paren
r_break
suffix:semicolon
id|txre
op_assign
(paren
r_struct
id|mpsc_tx_desc
op_star
)paren
(paren
id|pi-&gt;txr
op_plus
(paren
id|pi-&gt;txr_tail
op_star
id|MPSC_TXRE_SIZE
)paren
)paren
suffix:semicolon
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|txre
comma
id|MPSC_TXRE_SIZE
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|MPSC_CACHE_INVALIDATE
c_func
(paren
id|pi
comma
(paren
id|u32
)paren
id|txre
comma
(paren
id|u32
)paren
id|txre
op_plus
id|MPSC_TXRE_SIZE
)paren
suffix:semicolon
)brace
id|mpsc_copy_tx_data
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_sdma_start_tx
c_func
(paren
id|pi
)paren
suffix:semicolon
multiline_comment|/* start next desc if ready */
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * This is the driver&squot;s interrupt handler.  To avoid a race, we first clear&n; * the interrupt, then handle any completed Rx/Tx descriptors.  When done&n; * handling those descriptors, we restart the Rx/Tx engines if they&squot;re stopped.&n; */
r_static
id|irqreturn_t
DECL|function|mpsc_sdma_intr
id|mpsc_sdma_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
id|dev_id
suffix:semicolon
id|ulong
id|iflags
suffix:semicolon
r_int
id|rc
op_assign
id|IRQ_NONE
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_intr[%d]: SDMA Interrupt Received&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
id|mpsc_sdma_intr_ack
c_func
(paren
id|pi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpsc_rx_intr
c_func
(paren
id|pi
comma
id|regs
)paren
)paren
id|rc
op_assign
id|IRQ_HANDLED
suffix:semicolon
r_if
c_cond
(paren
id|mpsc_tx_intr
c_func
(paren
id|pi
)paren
)paren
id|rc
op_assign
id|IRQ_HANDLED
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_sdma_intr[%d]: SDMA Interrupt Handled&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; ******************************************************************************&n; *&n; * serial_core.c Interface routines&n; *&n; ******************************************************************************&n; */
r_static
id|uint
DECL|function|mpsc_tx_empty
id|mpsc_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|ulong
id|iflags
suffix:semicolon
id|uint
id|rc
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
id|rc
op_assign
id|mpsc_sdma_tx_active
c_func
(paren
id|pi
)paren
ques
c_cond
l_int|0
suffix:colon
id|TIOCSER_TEMT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_set_mctrl
id|mpsc_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
id|uint
id|mctrl
)paren
(brace
multiline_comment|/* Have no way to set modem control lines AFAICT */
r_return
suffix:semicolon
)brace
r_static
id|uint
DECL|function|mpsc_get_mctrl
id|mpsc_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|u32
id|mflags
comma
id|status
suffix:semicolon
id|ulong
id|iflags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
id|status
op_assign
id|MPSC_READ_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_10
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|iflags
)paren
suffix:semicolon
id|mflags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1
)paren
id|mflags
op_or_assign
id|TIOCM_CTS
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2
)paren
id|mflags
op_or_assign
id|TIOCM_CAR
suffix:semicolon
r_return
id|mflags
op_or
id|TIOCM_DSR
suffix:semicolon
multiline_comment|/* No way to tell if DSR asserted */
)brace
r_static
r_void
DECL|function|mpsc_stop_tx
id|mpsc_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
id|uint
id|tty_start
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_stop_tx[%d]: tty_start: %d&bslash;n&quot;
comma
id|port-&gt;line
comma
id|tty_start
)paren
suffix:semicolon
id|mpsc_freeze
c_func
(paren
id|pi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_start_tx
id|mpsc_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
id|uint
id|tty_start
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|mpsc_unfreeze
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_copy_tx_data
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_sdma_start_tx
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_start_tx[%d]: tty_start: %d&bslash;n&quot;
comma
id|port-&gt;line
comma
id|tty_start
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_start_rx
id|mpsc_start_rx
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_start_rx[%d]: Starting...&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;rcv_data
)paren
(brace
id|mpsc_enter_hunt
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_sdma_cmd
c_func
(paren
id|pi
comma
id|SDMA_SDCM_ERD
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_stop_rx
id|mpsc_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_stop_rx[%d]: Stopping...&bslash;n&quot;
comma
id|port-&gt;line
)paren
suffix:semicolon
id|mpsc_sdma_cmd
c_func
(paren
id|pi
comma
id|SDMA_SDCM_AR
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_enable_ms
id|mpsc_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
suffix:semicolon
multiline_comment|/* Not supported */
)brace
r_static
r_void
DECL|function|mpsc_break_ctl
id|mpsc_break_ctl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|ctl
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctl
)paren
multiline_comment|/* Send as many BRK chars as we can */
id|MPSC_WRITE_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_1
comma
l_int|0x00ff0000
)paren
suffix:semicolon
r_else
multiline_comment|/* Stop sending BRK chars */
id|MPSC_WRITE_M
c_func
(paren
id|pi
comma
id|mpsc
comma
id|MPSC_CHR_1
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_startup
id|mpsc_startup
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|u32
id|flag
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_startup[%d]: Starting up MPSC, irq: %d&bslash;n&quot;
comma
id|port-&gt;line
comma
id|pi-&gt;port.irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|mpsc_make_ready
c_func
(paren
id|pi
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Setup IRQ handler */
id|mpsc_sdma_intr_ack
c_func
(paren
id|pi
)paren
suffix:semicolon
multiline_comment|/* If irq&squot;s are shared, need to set flag */
r_if
c_cond
(paren
id|mpsc_ports
(braket
l_int|0
)braket
dot
id|port.irq
op_eq
id|mpsc_ports
(braket
l_int|1
)braket
dot
id|port.irq
)paren
id|flag
op_assign
id|SA_SHIRQ
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pi-&gt;port.irq
comma
id|mpsc_sdma_intr
comma
id|flag
comma
l_string|&quot;mpsc/sdma&quot;
comma
id|pi
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;MPSC: Can&squot;t get SDMA IRQ %d&bslash;n&quot;
comma
id|pi-&gt;port.irq
)paren
suffix:semicolon
id|mpsc_sdma_intr_unmask
c_func
(paren
id|pi
comma
l_int|0xf
)paren
suffix:semicolon
id|mpsc_sdma_set_rx_ring
c_func
(paren
id|pi
comma
(paren
r_struct
id|mpsc_rx_desc
op_star
)paren
(paren
id|pi-&gt;rxr_p
op_plus
(paren
id|pi-&gt;rxr_posn
op_star
id|MPSC_RXRE_SIZE
)paren
)paren
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_shutdown
id|mpsc_shutdown
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
r_static
r_void
id|mpsc_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_shutdown[%d]: Shutting down MPSC&bslash;n&quot;
comma
id|port-&gt;line
)paren
suffix:semicolon
id|mpsc_sdma_stop
c_func
(paren
id|pi
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|pi-&gt;port.irq
comma
id|pi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_set_termios
id|mpsc_set_termios
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
id|u32
id|baud
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|u32
id|chr_bits
comma
id|stop_bits
comma
id|par
suffix:semicolon
id|pi-&gt;c_iflag
op_assign
id|termios-&gt;c_iflag
suffix:semicolon
id|pi-&gt;c_cflag
op_assign
id|termios-&gt;c_cflag
suffix:semicolon
r_switch
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
id|chr_bits
op_assign
id|MPSC_MPCR_CL_5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|chr_bits
op_assign
id|MPSC_MPCR_CL_6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|chr_bits
op_assign
id|MPSC_MPCR_CL_7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
r_default
suffix:colon
id|chr_bits
op_assign
id|MPSC_MPCR_CL_8
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSTOPB
)paren
id|stop_bits
op_assign
id|MPSC_MPCR_SBL_2
suffix:semicolon
r_else
id|stop_bits
op_assign
id|MPSC_MPCR_SBL_1
suffix:semicolon
id|par
op_assign
id|MPSC_CHR_2_PAR_EVEN
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARENB
)paren
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARODD
)paren
id|par
op_assign
id|MPSC_CHR_2_PAR_ODD
suffix:semicolon
macro_line|#ifdef&t;CMSPAR
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CMSPAR
)paren
(brace
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARODD
)paren
id|par
op_assign
id|MPSC_CHR_2_PAR_MARK
suffix:semicolon
r_else
id|par
op_assign
id|MPSC_CHR_2_PAR_SPACE
suffix:semicolon
)brace
macro_line|#endif
id|baud
op_assign
id|uart_get_baud_rate
c_func
(paren
id|port
comma
id|termios
comma
id|old
comma
l_int|0
comma
id|port-&gt;uartclk
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|uart_update_timeout
c_func
(paren
id|port
comma
id|termios-&gt;c_cflag
comma
id|baud
)paren
suffix:semicolon
id|mpsc_set_char_length
c_func
(paren
id|pi
comma
id|chr_bits
)paren
suffix:semicolon
id|mpsc_set_stop_bit_length
c_func
(paren
id|pi
comma
id|stop_bits
)paren
suffix:semicolon
id|mpsc_set_parity
c_func
(paren
id|pi
comma
id|par
)paren
suffix:semicolon
id|mpsc_set_baudrate
c_func
(paren
id|pi
comma
id|baud
)paren
suffix:semicolon
multiline_comment|/* Characters/events to read */
id|pi-&gt;rcv_data
op_assign
l_int|1
suffix:semicolon
id|pi-&gt;port.read_status_mask
op_assign
id|SDMA_DESC_CMDSTAT_OR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|INPCK
)paren
id|pi-&gt;port.read_status_mask
op_or_assign
id|SDMA_DESC_CMDSTAT_PE
op_or
id|SDMA_DESC_CMDSTAT_FR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
(paren
id|BRKINT
op_or
id|PARMRK
)paren
)paren
id|pi-&gt;port.read_status_mask
op_or_assign
id|SDMA_DESC_CMDSTAT_BR
suffix:semicolon
multiline_comment|/* Characters/events to ignore */
id|pi-&gt;port.ignore_status_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNPAR
)paren
id|pi-&gt;port.ignore_status_mask
op_or_assign
id|SDMA_DESC_CMDSTAT_PE
op_or
id|SDMA_DESC_CMDSTAT_FR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNBRK
)paren
(brace
id|pi-&gt;port.ignore_status_mask
op_or_assign
id|SDMA_DESC_CMDSTAT_BR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNPAR
)paren
id|pi-&gt;port.ignore_status_mask
op_or_assign
id|SDMA_DESC_CMDSTAT_OR
suffix:semicolon
)brace
multiline_comment|/* Ignore all chars if CREAD not set */
r_if
c_cond
(paren
op_logical_neg
(paren
id|termios-&gt;c_cflag
op_amp
id|CREAD
)paren
)paren
id|pi-&gt;rcv_data
op_assign
l_int|0
suffix:semicolon
r_else
id|mpsc_start_rx
c_func
(paren
id|pi
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pi-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_const
r_char
op_star
DECL|function|mpsc_type
id|mpsc_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_type[%d]: port type: %s&bslash;n&quot;
comma
id|port-&gt;line
comma
id|MPSC_DRIVER_NAME
)paren
suffix:semicolon
r_return
id|MPSC_DRIVER_NAME
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_request_port
id|mpsc_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
multiline_comment|/* Should make chip/platform specific call */
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_release_port
id|mpsc_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;ready
)paren
(brace
id|mpsc_uninit_rings
c_func
(paren
id|pi
)paren
suffix:semicolon
id|mpsc_free_ring_mem
c_func
(paren
id|pi
)paren
suffix:semicolon
id|pi-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_config_port
id|mpsc_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|flags
)paren
(brace
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_verify_port
id|mpsc_verify_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|ser
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
(paren
r_struct
id|mpsc_port_info
op_star
)paren
id|port
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_verify_port[%d]: Verifying port data&bslash;n&quot;
comma
id|pi-&gt;port.line
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ser-&gt;type
op_ne
id|PORT_UNKNOWN
op_logical_and
id|ser-&gt;type
op_ne
id|PORT_MPSC
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pi-&gt;port.irq
op_ne
id|ser-&gt;irq
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ser-&gt;io_type
op_ne
id|SERIAL_IO_MEM
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pi-&gt;port.uartclk
op_div
l_int|16
op_ne
id|ser-&gt;baud_base
)paren
multiline_comment|/* Not sure */
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
r_void
op_star
)paren
id|pi-&gt;port.mapbase
op_ne
id|ser-&gt;iomem_base
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pi-&gt;port.iobase
op_ne
id|ser-&gt;port
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ser-&gt;hub6
op_ne
l_int|0
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|mpsc_pops
r_static
r_struct
id|uart_ops
id|mpsc_pops
op_assign
(brace
dot
id|tx_empty
op_assign
id|mpsc_tx_empty
comma
dot
id|set_mctrl
op_assign
id|mpsc_set_mctrl
comma
dot
id|get_mctrl
op_assign
id|mpsc_get_mctrl
comma
dot
id|stop_tx
op_assign
id|mpsc_stop_tx
comma
dot
id|start_tx
op_assign
id|mpsc_start_tx
comma
dot
id|stop_rx
op_assign
id|mpsc_stop_rx
comma
dot
id|enable_ms
op_assign
id|mpsc_enable_ms
comma
dot
id|break_ctl
op_assign
id|mpsc_break_ctl
comma
dot
id|startup
op_assign
id|mpsc_startup
comma
dot
id|shutdown
op_assign
id|mpsc_shutdown
comma
dot
id|set_termios
op_assign
id|mpsc_set_termios
comma
dot
id|type
op_assign
id|mpsc_type
comma
dot
id|release_port
op_assign
id|mpsc_release_port
comma
dot
id|request_port
op_assign
id|mpsc_request_port
comma
dot
id|config_port
op_assign
id|mpsc_config_port
comma
dot
id|verify_port
op_assign
id|mpsc_verify_port
comma
)brace
suffix:semicolon
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Console Interface Routines&n; *&n; ******************************************************************************&n; */
macro_line|#ifdef CONFIG_SERIAL_MPSC_CONSOLE
r_static
r_void
DECL|function|mpsc_console_write
id|mpsc_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
id|uint
id|count
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
op_assign
op_amp
id|mpsc_ports
(braket
id|co-&gt;index
)braket
suffix:semicolon
id|u8
op_star
id|bp
comma
op_star
id|dp
comma
id|add_cr
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|mpsc_sdma_tx_active
c_func
(paren
id|pi
)paren
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|bp
op_assign
id|dp
op_assign
id|pi-&gt;txb
op_plus
(paren
id|pi-&gt;txr_head
op_star
id|MPSC_TXBE_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MPSC_TXBE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|add_cr
)paren
(brace
op_star
(paren
id|dp
op_increment
)paren
op_assign
l_char|&squot;&bslash;r&squot;
suffix:semicolon
id|add_cr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|dp
op_increment
)paren
op_assign
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|s
op_increment
)paren
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
multiline_comment|/* add &squot;&bslash;r&squot; after &squot;&bslash;n&squot; */
id|add_cr
op_assign
l_int|1
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
)brace
id|count
op_decrement
suffix:semicolon
)brace
id|dma_cache_sync
c_func
(paren
(paren
r_void
op_star
)paren
id|bp
comma
id|MPSC_TXBE_SIZE
comma
id|DMA_BIDIRECTIONAL
)paren
suffix:semicolon
id|MPSC_CACHE_FLUSH
c_func
(paren
id|pi
comma
id|bp
comma
id|bp
op_plus
id|MPSC_TXBE_SIZE
)paren
suffix:semicolon
id|mpsc_setup_tx_desc
c_func
(paren
id|pi
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
id|pi-&gt;txr_head
op_assign
(paren
id|pi-&gt;txr_head
op_plus
l_int|1
)paren
op_amp
(paren
id|MPSC_TXR_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
id|mpsc_sdma_start_tx
c_func
(paren
id|pi
)paren
suffix:semicolon
r_while
c_loop
(paren
id|mpsc_sdma_tx_active
c_func
(paren
id|pi
)paren
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|pi-&gt;txr_tail
op_assign
(paren
id|pi-&gt;txr_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|MPSC_TXR_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|mpsc_console_setup
id|mpsc_console_setup
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|mpsc_port_info
op_star
id|pi
suffix:semicolon
r_int
id|baud
comma
id|bits
comma
id|parity
comma
id|flow
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_console_setup[%d]: options: %s&bslash;n&quot;
comma
id|co-&gt;index
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
id|co-&gt;index
op_ge
id|MPSC_NUM_CTLRS
)paren
id|co-&gt;index
op_assign
l_int|0
suffix:semicolon
id|pi
op_assign
op_amp
id|mpsc_ports
(braket
id|co-&gt;index
)braket
suffix:semicolon
id|baud
op_assign
id|pi-&gt;default_baud
suffix:semicolon
id|bits
op_assign
id|pi-&gt;default_bits
suffix:semicolon
id|parity
op_assign
id|pi-&gt;default_parity
suffix:semicolon
id|flow
op_assign
id|pi-&gt;default_flow
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;port.ops
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|pi-&gt;port.lock
)paren
suffix:semicolon
multiline_comment|/* Temporary fix--copied from 8250.c */
r_if
c_cond
(paren
id|options
)paren
id|uart_parse_options
c_func
(paren
id|options
comma
op_amp
id|baud
comma
op_amp
id|parity
comma
op_amp
id|bits
comma
op_amp
id|flow
)paren
suffix:semicolon
r_return
id|uart_set_options
c_func
(paren
op_amp
id|pi-&gt;port
comma
id|co
comma
id|baud
comma
id|parity
comma
id|bits
comma
id|flow
)paren
suffix:semicolon
)brace
r_extern
r_struct
id|uart_driver
id|mpsc_reg
suffix:semicolon
DECL|variable|mpsc_console
r_static
r_struct
id|console
id|mpsc_console
op_assign
(brace
dot
id|name
op_assign
id|MPSC_DEV_NAME
comma
dot
id|write
op_assign
id|mpsc_console_write
comma
dot
id|device
op_assign
id|uart_console_device
comma
dot
id|setup
op_assign
id|mpsc_console_setup
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
op_minus
l_int|1
comma
dot
id|data
op_assign
op_amp
id|mpsc_reg
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|mpsc_late_console_init
id|mpsc_late_console_init
c_func
(paren
r_void
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_late_console_init: Enter&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mpsc_console.flags
op_amp
id|CON_ENABLED
)paren
)paren
id|register_console
c_func
(paren
op_amp
id|mpsc_console
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|mpsc_late_console_init
id|late_initcall
c_func
(paren
id|mpsc_late_console_init
)paren
suffix:semicolon
DECL|macro|MPSC_CONSOLE
mdefine_line|#define MPSC_CONSOLE&t;&amp;mpsc_console
macro_line|#else
DECL|macro|MPSC_CONSOLE
mdefine_line|#define MPSC_CONSOLE&t;NULL
macro_line|#endif
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Dummy Platform Driver to extract &amp; map shared register regions&n; *&n; ******************************************************************************&n; */
r_static
r_void
DECL|function|mpsc_resource_err
id|mpsc_resource_err
c_func
(paren
r_char
op_star
id|s
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;MPSC: Platform device resource error in %s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_shared_map_regs
id|mpsc_shared_map_regs
c_func
(paren
r_struct
id|platform_device
op_star
id|pd
)paren
(brace
r_struct
id|resource
op_star
id|r
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd
comma
id|IORESOURCE_MEM
comma
id|MPSC_ROUTING_BASE_ORDER
)paren
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|r-&gt;start
comma
id|MPSC_ROUTING_REG_BLOCK_SIZE
comma
l_string|&quot;mpsc_routing_regs&quot;
)paren
)paren
(brace
id|mpsc_shared_regs.mpsc_routing_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|r-&gt;start
comma
id|MPSC_ROUTING_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|mpsc_shared_regs.mpsc_routing_base_p
op_assign
id|r-&gt;start
suffix:semicolon
)brace
r_else
(brace
id|mpsc_resource_err
c_func
(paren
l_string|&quot;MPSC routing base&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd
comma
id|IORESOURCE_MEM
comma
id|MPSC_SDMA_INTR_BASE_ORDER
)paren
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|r-&gt;start
comma
id|MPSC_SDMA_INTR_REG_BLOCK_SIZE
comma
l_string|&quot;sdma_intr_regs&quot;
)paren
)paren
(brace
id|mpsc_shared_regs.sdma_intr_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|r-&gt;start
comma
id|MPSC_SDMA_INTR_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|mpsc_shared_regs.sdma_intr_base_p
op_assign
id|r-&gt;start
suffix:semicolon
)brace
r_else
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|mpsc_shared_regs.mpsc_routing_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|mpsc_shared_regs.mpsc_routing_base_p
comma
id|MPSC_ROUTING_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|mpsc_resource_err
c_func
(paren
l_string|&quot;SDMA intr base&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_shared_unmap_regs
id|mpsc_shared_unmap_regs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mpsc_shared_regs.mpsc_routing_base
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|mpsc_shared_regs.mpsc_routing_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|mpsc_shared_regs.mpsc_routing_base_p
comma
id|MPSC_ROUTING_REG_BLOCK_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mpsc_shared_regs.sdma_intr_base
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|mpsc_shared_regs.sdma_intr_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|mpsc_shared_regs.sdma_intr_base_p
comma
id|MPSC_SDMA_INTR_REG_BLOCK_SIZE
)paren
suffix:semicolon
)brace
id|mpsc_shared_regs.mpsc_routing_base
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.sdma_intr_base
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.mpsc_routing_base_p
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.sdma_intr_base_p
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_shared_drv_probe
id|mpsc_shared_drv_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|platform_device
op_star
id|pd
op_assign
id|to_platform_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|mpsc_shared_pd_dd
op_star
id|dd
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pd-&gt;id
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|mpsc_shared_map_regs
c_func
(paren
id|pd
)paren
)paren
)paren
(brace
id|dd
op_assign
(paren
r_struct
id|mpsc_shared_pd_dd
op_star
)paren
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
id|mpsc_shared_regs.MPSC_MRR_m
op_assign
id|dd-&gt;mrr_val
suffix:semicolon
id|mpsc_shared_regs.MPSC_RCRR_m
op_assign
id|dd-&gt;rcrr_val
suffix:semicolon
id|mpsc_shared_regs.MPSC_TCRR_m
op_assign
id|dd-&gt;tcrr_val
suffix:semicolon
id|mpsc_shared_regs.SDMA_INTR_CAUSE_m
op_assign
id|dd-&gt;intr_cause_val
suffix:semicolon
id|mpsc_shared_regs.SDMA_INTR_MASK_m
op_assign
id|dd-&gt;intr_mask_val
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_shared_drv_remove
id|mpsc_shared_drv_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|platform_device
op_star
id|pd
op_assign
id|to_platform_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pd-&gt;id
op_eq
l_int|0
)paren
(brace
id|mpsc_shared_unmap_regs
c_func
(paren
)paren
suffix:semicolon
id|mpsc_shared_regs.MPSC_MRR_m
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.MPSC_RCRR_m
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.MPSC_TCRR_m
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.SDMA_INTR_CAUSE_m
op_assign
l_int|0
suffix:semicolon
id|mpsc_shared_regs.SDMA_INTR_MASK_m
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|mpsc_shared_driver
r_static
r_struct
id|device_driver
id|mpsc_shared_driver
op_assign
(brace
dot
id|name
op_assign
id|MPSC_SHARED_NAME
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
dot
id|probe
op_assign
id|mpsc_shared_drv_probe
comma
dot
id|remove
op_assign
id|mpsc_shared_drv_remove
comma
)brace
suffix:semicolon
multiline_comment|/*&n; ******************************************************************************&n; *&n; * Driver Interface Routines&n; *&n; ******************************************************************************&n; */
DECL|variable|mpsc_reg
r_static
r_struct
id|uart_driver
id|mpsc_reg
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
id|MPSC_DRIVER_NAME
comma
dot
id|devfs_name
op_assign
id|MPSC_DEVFS_NAME
comma
dot
id|dev_name
op_assign
id|MPSC_DEV_NAME
comma
dot
id|major
op_assign
id|MPSC_MAJOR
comma
dot
id|minor
op_assign
id|MPSC_MINOR_START
comma
dot
id|nr
op_assign
id|MPSC_NUM_CTLRS
comma
dot
id|cons
op_assign
id|MPSC_CONSOLE
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|mpsc_drv_map_regs
id|mpsc_drv_map_regs
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
r_struct
id|platform_device
op_star
id|pd
)paren
(brace
r_struct
id|resource
op_star
id|r
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd
comma
id|IORESOURCE_MEM
comma
id|MPSC_BASE_ORDER
)paren
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|r-&gt;start
comma
id|MPSC_REG_BLOCK_SIZE
comma
l_string|&quot;mpsc_regs&quot;
)paren
)paren
(brace
id|pi-&gt;mpsc_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|r-&gt;start
comma
id|MPSC_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|pi-&gt;mpsc_base_p
op_assign
id|r-&gt;start
suffix:semicolon
)brace
r_else
(brace
id|mpsc_resource_err
c_func
(paren
l_string|&quot;MPSC base&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd
comma
id|IORESOURCE_MEM
comma
id|MPSC_SDMA_BASE_ORDER
)paren
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|r-&gt;start
comma
id|MPSC_SDMA_REG_BLOCK_SIZE
comma
l_string|&quot;sdma_regs&quot;
)paren
)paren
(brace
id|pi-&gt;sdma_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|r-&gt;start
comma
id|MPSC_SDMA_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|pi-&gt;sdma_base_p
op_assign
id|r-&gt;start
suffix:semicolon
)brace
r_else
(brace
id|mpsc_resource_err
c_func
(paren
l_string|&quot;SDMA base&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd
comma
id|IORESOURCE_MEM
comma
id|MPSC_BRG_BASE_ORDER
)paren
)paren
op_logical_and
id|request_mem_region
c_func
(paren
id|r-&gt;start
comma
id|MPSC_BRG_REG_BLOCK_SIZE
comma
l_string|&quot;brg_regs&quot;
)paren
)paren
(brace
id|pi-&gt;brg_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|r-&gt;start
comma
id|MPSC_BRG_REG_BLOCK_SIZE
)paren
suffix:semicolon
id|pi-&gt;brg_base_p
op_assign
id|r-&gt;start
suffix:semicolon
)brace
r_else
(brace
id|mpsc_resource_err
c_func
(paren
l_string|&quot;BRG base&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_drv_unmap_regs
id|mpsc_drv_unmap_regs
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;mpsc_base
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|pi-&gt;mpsc_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pi-&gt;mpsc_base_p
comma
id|MPSC_REG_BLOCK_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;sdma_base
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|pi-&gt;sdma_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pi-&gt;sdma_base_p
comma
id|MPSC_SDMA_REG_BLOCK_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pi-&gt;brg_base
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|pi-&gt;brg_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pi-&gt;brg_base_p
comma
id|MPSC_BRG_REG_BLOCK_SIZE
)paren
suffix:semicolon
)brace
id|pi-&gt;mpsc_base
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;sdma_base
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;brg_base
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;mpsc_base_p
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;sdma_base_p
op_assign
l_int|0
suffix:semicolon
id|pi-&gt;brg_base_p
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mpsc_drv_get_platform_data
id|mpsc_drv_get_platform_data
c_func
(paren
r_struct
id|mpsc_port_info
op_star
id|pi
comma
r_struct
id|platform_device
op_star
id|pd
comma
r_int
id|num
)paren
(brace
r_struct
id|mpsc_pd_dd
op_star
id|dd
suffix:semicolon
id|dd
op_assign
(paren
r_struct
id|mpsc_pd_dd
op_star
)paren
id|dev_get_drvdata
c_func
(paren
op_amp
id|pd-&gt;dev
)paren
suffix:semicolon
id|pi-&gt;port.uartclk
op_assign
id|dd-&gt;brg_clk_freq
suffix:semicolon
id|pi-&gt;port.iotype
op_assign
id|UPIO_MEM
suffix:semicolon
id|pi-&gt;port.line
op_assign
id|num
suffix:semicolon
id|pi-&gt;port.type
op_assign
id|PORT_MPSC
suffix:semicolon
id|pi-&gt;port.fifosize
op_assign
id|MPSC_TXBE_SIZE
suffix:semicolon
id|pi-&gt;port.membase
op_assign
(paren
r_char
op_star
)paren
id|pi-&gt;mpsc_base
suffix:semicolon
id|pi-&gt;port.mapbase
op_assign
(paren
id|ulong
)paren
id|pi-&gt;mpsc_base
suffix:semicolon
id|pi-&gt;port.ops
op_assign
op_amp
id|mpsc_pops
suffix:semicolon
id|pi-&gt;mirror_regs
op_assign
id|dd-&gt;mirror_regs
suffix:semicolon
id|pi-&gt;cache_mgmt
op_assign
id|dd-&gt;cache_mgmt
suffix:semicolon
id|pi-&gt;brg_can_tune
op_assign
id|dd-&gt;brg_can_tune
suffix:semicolon
id|pi-&gt;brg_clk_src
op_assign
id|dd-&gt;brg_clk_src
suffix:semicolon
id|pi-&gt;mpsc_max_idle
op_assign
id|dd-&gt;max_idle
suffix:semicolon
id|pi-&gt;default_baud
op_assign
id|dd-&gt;default_baud
suffix:semicolon
id|pi-&gt;default_bits
op_assign
id|dd-&gt;default_bits
suffix:semicolon
id|pi-&gt;default_parity
op_assign
id|dd-&gt;default_parity
suffix:semicolon
id|pi-&gt;default_flow
op_assign
id|dd-&gt;default_flow
suffix:semicolon
multiline_comment|/* Initial values of mirrored regs */
id|pi-&gt;MPSC_CHR_1_m
op_assign
id|dd-&gt;chr_1_val
suffix:semicolon
id|pi-&gt;MPSC_CHR_2_m
op_assign
id|dd-&gt;chr_2_val
suffix:semicolon
id|pi-&gt;MPSC_CHR_10_m
op_assign
id|dd-&gt;chr_10_val
suffix:semicolon
id|pi-&gt;MPSC_MPCR_m
op_assign
id|dd-&gt;mpcr_val
suffix:semicolon
id|pi-&gt;BRG_BCR_m
op_assign
id|dd-&gt;bcr_val
suffix:semicolon
id|pi-&gt;shared_regs
op_assign
op_amp
id|mpsc_shared_regs
suffix:semicolon
id|pi-&gt;port.irq
op_assign
id|platform_get_irq
c_func
(paren
id|pd
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_drv_probe
id|mpsc_drv_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|platform_device
op_star
id|pd
op_assign
id|to_platform_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|mpsc_port_info
op_star
id|pi
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_drv_probe: Adding MPSC %d&bslash;n&quot;
comma
id|pd-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pd-&gt;id
OL
id|MPSC_NUM_CTLRS
)paren
(brace
id|pi
op_assign
op_amp
id|mpsc_ports
(braket
id|pd-&gt;id
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|mpsc_drv_map_regs
c_func
(paren
id|pi
comma
id|pd
)paren
)paren
)paren
(brace
id|mpsc_drv_get_platform_data
c_func
(paren
id|pi
comma
id|pd
comma
id|pd-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|mpsc_make_ready
c_func
(paren
id|pi
)paren
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|uart_add_one_port
c_func
(paren
op_amp
id|mpsc_reg
comma
op_amp
id|pi-&gt;port
)paren
)paren
)paren
id|rc
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|mpsc_release_port
c_func
(paren
(paren
r_struct
id|uart_port
op_star
)paren
id|pi
)paren
suffix:semicolon
id|mpsc_drv_unmap_regs
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
r_else
id|mpsc_drv_unmap_regs
c_func
(paren
id|pi
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpsc_drv_remove
id|mpsc_drv_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|platform_device
op_star
id|pd
op_assign
id|to_platform_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;mpsc_drv_exit: Removing MPSC %d&bslash;n&quot;
comma
id|pd-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pd-&gt;id
OL
id|MPSC_NUM_CTLRS
)paren
(brace
id|uart_remove_one_port
c_func
(paren
op_amp
id|mpsc_reg
comma
op_amp
id|mpsc_ports
(braket
id|pd-&gt;id
)braket
dot
id|port
)paren
suffix:semicolon
id|mpsc_release_port
c_func
(paren
(paren
r_struct
id|uart_port
op_star
)paren
op_amp
id|mpsc_ports
(braket
id|pd-&gt;id
)braket
dot
id|port
)paren
suffix:semicolon
id|mpsc_drv_unmap_regs
c_func
(paren
op_amp
id|mpsc_ports
(braket
id|pd-&gt;id
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|mpsc_driver
r_static
r_struct
id|device_driver
id|mpsc_driver
op_assign
(brace
dot
id|name
op_assign
id|MPSC_CTLR_NAME
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
dot
id|probe
op_assign
id|mpsc_drv_probe
comma
dot
id|remove
op_assign
id|mpsc_drv_remove
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|mpsc_drv_init
id|mpsc_drv_init
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Serial: MPSC driver $Revision: 1.00 $&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mpsc_ports
comma
l_int|0
comma
r_sizeof
(paren
id|mpsc_ports
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mpsc_shared_regs
comma
l_int|0
comma
r_sizeof
(paren
id|mpsc_shared_regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|mpsc_reg
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|driver_register
c_func
(paren
op_amp
id|mpsc_shared_driver
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|driver_register
c_func
(paren
op_amp
id|mpsc_driver
)paren
)paren
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|mpsc_shared_driver
)paren
suffix:semicolon
id|uart_unregister_driver
c_func
(paren
op_amp
id|mpsc_reg
)paren
suffix:semicolon
)brace
)brace
r_else
id|uart_unregister_driver
c_func
(paren
op_amp
id|mpsc_reg
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|mpsc_drv_exit
id|mpsc_drv_exit
c_func
(paren
r_void
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|mpsc_driver
)paren
suffix:semicolon
id|driver_unregister
c_func
(paren
op_amp
id|mpsc_shared_driver
)paren
suffix:semicolon
id|uart_unregister_driver
c_func
(paren
op_amp
id|mpsc_reg
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mpsc_ports
comma
l_int|0
comma
r_sizeof
(paren
id|mpsc_ports
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mpsc_shared_regs
comma
l_int|0
comma
r_sizeof
(paren
id|mpsc_shared_regs
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|mpsc_drv_init
id|module_init
c_func
(paren
id|mpsc_drv_init
)paren
suffix:semicolon
DECL|variable|mpsc_drv_exit
id|module_exit
c_func
(paren
id|mpsc_drv_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Mark A. Greer &lt;mgreer@mvista.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Generic Marvell MPSC serial/UART driver $Revision: 1.00 $&quot;
)paren
suffix:semicolon
DECL|variable|MPSC_VERSION
id|MODULE_VERSION
c_func
(paren
id|MPSC_VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|MPSC_MAJOR
id|MODULE_ALIAS_CHARDEV_MAJOR
c_func
(paren
id|MPSC_MAJOR
)paren
suffix:semicolon
eof
