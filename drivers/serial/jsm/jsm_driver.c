multiline_comment|/************************************************************************&n; * Copyright 2003 Digi International (www.digi.com)&n; *&n; * Copyright (C) 2004 IBM Corporation. All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY, EXPRESS OR IMPLIED; without even the&n; * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR&n; * PURPOSE.  See the GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 * Temple Place - Suite 330, Boston,&n; * MA  02111-1307, USA.&n; *&n; * Contact Information:&n; * Scott H Kilau &lt;Scott_Kilau@digi.com&gt;&n; * Wendy Xiong   &lt;wendyx@us.ltcfwd.linux.ibm.com&gt;&n; *&n; ***********************************************************************/
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;jsm.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Digi International, http://www.digi.com&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver for the Digi International Neo PCI based product line&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;jsm&quot;
)paren
suffix:semicolon
DECL|macro|JSM_DRIVER_NAME
mdefine_line|#define JSM_DRIVER_NAME &quot;jsm&quot;
DECL|macro|NR_PORTS
mdefine_line|#define NR_PORTS&t;32
DECL|macro|JSM_MINOR_START
mdefine_line|#define JSM_MINOR_START&t;0
DECL|variable|jsm_uart_driver
r_struct
id|uart_driver
id|jsm_uart_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
id|JSM_DRIVER_NAME
comma
dot
id|dev_name
op_assign
l_string|&quot;ttyn&quot;
comma
dot
id|major
op_assign
l_int|253
comma
dot
id|minor
op_assign
id|JSM_MINOR_START
comma
dot
id|nr
op_assign
id|NR_PORTS
comma
dot
id|cons
op_assign
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|jsm_debug
r_int
id|jsm_debug
suffix:semicolon
DECL|variable|jsm_rawreadok
r_int
id|jsm_rawreadok
suffix:semicolon
id|module_param
c_func
(paren
id|jsm_debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|jsm_rawreadok
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|jsm_debug
comma
l_string|&quot;Driver debugging level&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|jsm_rawreadok
comma
l_string|&quot;Bypass flip buffers on input&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Globals&n; */
DECL|variable|jsm_driver_state
r_int
id|jsm_driver_state
op_assign
id|DRIVER_INITIALIZED
suffix:semicolon
DECL|variable|jsm_board_head_lock
id|spinlock_t
id|jsm_board_head_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|jsm_board_head
id|LIST_HEAD
c_func
(paren
id|jsm_board_head
)paren
suffix:semicolon
DECL|variable|jsm_pci_tbl
r_static
r_struct
id|pci_device_id
id|jsm_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_DEVICE
(paren
id|PCI_VENDOR_ID_DIGI
comma
id|PCI_DEVICE_ID_NEO_2DB9
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_DEVICE
(paren
id|PCI_VENDOR_ID_DIGI
comma
id|PCI_DEVICE_ID_NEO_2DB9PRI
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
comma
(brace
id|PCI_DEVICE
(paren
id|PCI_VENDOR_ID_DIGI
comma
id|PCI_DEVICE_ID_NEO_2RJ45
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|2
)brace
comma
(brace
id|PCI_DEVICE
(paren
id|PCI_VENDOR_ID_DIGI
comma
id|PCI_DEVICE_ID_NEO_2RJ45PRI
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|3
)brace
comma
(brace
l_int|0
comma
)brace
multiline_comment|/* 0 terminated list. */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|jsm_pci_tbl
)paren
suffix:semicolon
DECL|variable|jsm_Ids
r_static
r_struct
id|board_id
id|jsm_Ids
(braket
)braket
op_assign
(brace
(brace
id|PCI_DEVICE_NEO_2DB9_PCI_NAME
comma
l_int|2
)brace
comma
(brace
id|PCI_DEVICE_NEO_2DB9PRI_PCI_NAME
comma
l_int|2
)brace
comma
(brace
id|PCI_DEVICE_NEO_2RJ45_PCI_NAME
comma
l_int|2
)brace
comma
(brace
id|PCI_DEVICE_NEO_2RJ45PRI_PCI_NAME
comma
l_int|2
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|jsm_driver_state_text
r_char
op_star
id|jsm_driver_state_text
(braket
)braket
op_assign
(brace
l_string|&quot;Driver Initialized&quot;
comma
l_string|&quot;Driver Ready.&quot;
)brace
suffix:semicolon
DECL|function|jsm_finalize_board_init
r_static
r_int
id|jsm_finalize_board_init
c_func
(paren
r_struct
id|jsm_board
op_star
id|brd
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|jsm_printk
c_func
(paren
id|INIT
comma
id|INFO
comma
op_amp
id|brd-&gt;pci_dev
comma
l_string|&quot;start&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|brd-&gt;irq
)paren
(brace
id|rc
op_assign
id|request_irq
c_func
(paren
id|brd-&gt;irq
comma
id|brd-&gt;bd_ops-&gt;intr
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;JSM&quot;
comma
id|brd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Failed to hook IRQ %d&bslash;n&quot;
comma
id|brd-&gt;irq
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FAILED
suffix:semicolon
id|brd-&gt;dpastatus
op_assign
id|BD_NOFEP
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|jsm_printk
c_func
(paren
id|INIT
comma
id|INFO
comma
op_amp
id|brd-&gt;pci_dev
comma
l_string|&quot;Requested and received usage of IRQ %d&bslash;n&quot;
comma
id|brd-&gt;irq
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * jsm_found_board()&n; *&n; * A board has been found, init it.&n; */
DECL|function|jsm_found_board
r_static
r_int
id|jsm_found_board
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|id
)paren
(brace
r_struct
id|jsm_board
op_star
id|brd
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_struct
id|jsm_board
op_star
id|cur_board_entry
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
r_int
id|adapter_count
op_assign
l_int|0
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|brd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|jsm_board
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|brd
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;memory allocation for board structure failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|brd
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|jsm_board
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|jsm_board_head_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|jsm_board_head
)paren
(brace
id|cur_board_entry
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|jsm_board
comma
id|jsm_board_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur_board_entry-&gt;boardnum
op_ne
id|adapter_count
)paren
(brace
r_break
suffix:semicolon
)brace
id|adapter_count
op_increment
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|brd-&gt;jsm_board_entry
comma
op_amp
id|jsm_board_head
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|jsm_board_head_lock
comma
id|lock_flags
)paren
suffix:semicolon
multiline_comment|/* store the info for the board we&squot;ve found */
id|brd-&gt;boardnum
op_assign
id|adapter_count
suffix:semicolon
id|brd-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|brd-&gt;name
op_assign
id|jsm_Ids
(braket
id|id
)braket
dot
id|name
suffix:semicolon
id|brd-&gt;maxports
op_assign
id|jsm_Ids
(braket
id|id
)braket
dot
id|maxports
suffix:semicolon
id|brd-&gt;dpastatus
op_assign
id|BD_NOFEP
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|brd-&gt;state_wait
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|brd-&gt;bd_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|brd-&gt;bd_intr_lock
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FOUND
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|brd-&gt;maxports
suffix:semicolon
id|i
op_increment
)paren
id|brd-&gt;channels
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* store which revision we have */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|brd-&gt;rev
)paren
suffix:semicolon
id|brd-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_switch
c_cond
(paren
id|brd-&gt;pci_dev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_NEO_2DB9
suffix:colon
r_case
id|PCI_DEVICE_ID_NEO_2DB9PRI
suffix:colon
r_case
id|PCI_DEVICE_ID_NEO_2RJ45
suffix:colon
r_case
id|PCI_DEVICE_ID_NEO_2RJ45PRI
suffix:colon
multiline_comment|/*&n;&t;&t; * This chip is set up 100% when we get to it.&n;&t;&t; * No need to enable global interrupts or anything.&n;&t;&t; */
id|brd-&gt;dpatype
op_assign
id|T_NEO
op_or
id|T_PCIBUS
suffix:semicolon
id|jsm_printk
c_func
(paren
id|INIT
comma
id|INFO
comma
op_amp
id|brd-&gt;pci_dev
comma
l_string|&quot;jsm_found_board - NEO adapter&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* get the PCI Base Address Registers */
id|brd-&gt;membase
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|brd-&gt;membase_end
op_assign
id|pci_resource_end
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|brd-&gt;membase
op_amp
l_int|1
)paren
id|brd-&gt;membase
op_and_assign
op_complement
l_int|3
suffix:semicolon
r_else
id|brd-&gt;membase
op_and_assign
op_complement
l_int|15
suffix:semicolon
multiline_comment|/* Assign the board_ops struct */
id|brd-&gt;bd_ops
op_assign
op_amp
id|jsm_neo_ops
suffix:semicolon
id|brd-&gt;bd_uart_offset
op_assign
l_int|0x200
suffix:semicolon
id|brd-&gt;bd_dividend
op_assign
l_int|921600
suffix:semicolon
id|brd-&gt;re_map_membase
op_assign
id|ioremap
c_func
(paren
id|brd-&gt;membase
comma
l_int|0x1000
)paren
suffix:semicolon
id|jsm_printk
c_func
(paren
id|INIT
comma
id|INFO
comma
op_amp
id|brd-&gt;pci_dev
comma
l_string|&quot;remapped mem: 0x%p&bslash;n&quot;
comma
id|brd-&gt;re_map_membase
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|brd-&gt;re_map_membase
)paren
(brace
id|kfree
c_func
(paren
id|brd
)paren
suffix:semicolon
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;card has no PCI Memory resources, failing board.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;Did not find any compatible Neo or Classic PCI boards in system.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|brd
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Do tty device initialization.&n;&t; */
id|rc
op_assign
id|jsm_finalize_board_init
c_func
(paren
id|brd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;Can&squot;t finalize board init (%d)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FAILED
suffix:semicolon
id|retval
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|failed0
suffix:semicolon
)brace
id|rc
op_assign
id|jsm_tty_init
c_func
(paren
id|brd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;Can&squot;t init tty devices (%d)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FAILED
suffix:semicolon
id|retval
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|failed1
suffix:semicolon
)brace
id|rc
op_assign
id|jsm_uart_port_init
c_func
(paren
id|brd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;Can&squot;t init uart port (%d)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FAILED
suffix:semicolon
id|retval
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|failed1
suffix:semicolon
)brace
id|brd-&gt;state
op_assign
id|BOARD_READY
suffix:semicolon
id|brd-&gt;dpastatus
op_assign
id|BD_RUNNING
suffix:semicolon
multiline_comment|/* Log the information about the board */
id|dev_info
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;board %d: %s (rev %d), irq %d&bslash;n&quot;
comma
id|adapter_count
comma
id|brd-&gt;name
comma
id|brd-&gt;rev
comma
id|brd-&gt;irq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * allocate flip buffer for board.&n;&t; *&n;&t; * Okay to malloc with GFP_KERNEL, we are not at interrupt&n;&t; * context, and there are no locks held.&n;&t; */
id|brd-&gt;flipbuf
op_assign
id|kmalloc
c_func
(paren
id|MYFLIPLEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|brd-&gt;flipbuf
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;memory allocation for flipbuf failed&bslash;n&quot;
)paren
suffix:semicolon
id|brd-&gt;state
op_assign
id|BOARD_FAILED
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|brd-&gt;flipbuf
comma
l_int|0
comma
id|MYFLIPLEN
)paren
suffix:semicolon
id|jsm_create_driver_sysfiles
c_func
(paren
id|pdev-&gt;dev.driver
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|brd-&gt;state_wait
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed1
suffix:colon
id|free_irq
c_func
(paren
id|brd-&gt;irq
comma
id|brd
)paren
suffix:semicolon
id|failed0
suffix:colon
id|kfree
c_func
(paren
id|brd
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|brd-&gt;re_map_membase
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* returns count (&gt;= 0), or negative on error */
DECL|function|jsm_init_one
r_static
r_int
id|jsm_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;Device enable FAILED&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
l_string|&quot;jsm&quot;
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;pci_request_region FAILED&bslash;n&quot;
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|jsm_found_board
c_func
(paren
id|pdev
comma
id|ent-&gt;driver_data
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|pdev-&gt;dev
comma
l_string|&quot;jsm_found_board FAILED&bslash;n&quot;
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * jsm_cleanup_board()&n; *&n; * Free all the memory associated with a board&n; */
DECL|function|jsm_cleanup_board
r_static
r_void
id|jsm_cleanup_board
c_func
(paren
r_struct
id|jsm_board
op_star
id|brd
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|free_irq
c_func
(paren
id|brd-&gt;irq
comma
id|brd
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|brd-&gt;re_map_membase
)paren
suffix:semicolon
multiline_comment|/* Free all allocated channels structs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|brd-&gt;maxports
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|brd-&gt;channels
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_rqueue
)paren
id|kfree
c_func
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_rqueue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_equeue
)paren
id|kfree
c_func
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_equeue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_wqueue
)paren
id|kfree
c_func
(paren
id|brd-&gt;channels
(braket
id|i
)braket
op_member_access_from_pointer
id|ch_wqueue
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|brd-&gt;channels
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|pci_release_regions
c_func
(paren
id|brd-&gt;pci_dev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|brd-&gt;pci_dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|brd-&gt;flipbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|brd
)paren
suffix:semicolon
)brace
DECL|function|jsm_remove_one
r_static
r_void
id|jsm_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_int
r_int
id|lock_flags
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_struct
id|jsm_board
op_star
id|brd
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|jsm_board_head_lock
comma
id|lock_flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|jsm_board_head
)paren
(brace
id|brd
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|jsm_board
comma
id|jsm_board_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|brd
op_ne
l_int|NULL
op_logical_and
id|brd-&gt;pci_dev
op_eq
id|dev
)paren
(brace
id|jsm_remove_uart_port
c_func
(paren
id|brd
)paren
suffix:semicolon
id|jsm_cleanup_board
c_func
(paren
id|brd
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|brd-&gt;jsm_board_entry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|jsm_board_head_lock
comma
id|lock_flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|jsm_driver
r_struct
id|pci_driver
id|jsm_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;jsm&quot;
comma
dot
id|probe
op_assign
id|jsm_init_one
comma
dot
id|id_table
op_assign
id|jsm_pci_tbl
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|jsm_remove_one
)paren
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * jsm_init_module()&n; *&n; * Module load.  This is where it all starts.&n; */
DECL|function|jsm_init_module
r_static
r_int
id|__init
id|jsm_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s, Digi International Part Number %s&bslash;n&quot;
comma
id|JSM_VERSION
comma
id|JSM_VERSION
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialize global stuff&n;&t; */
id|rc
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|jsm_uart_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|pci_register_driver
c_func
(paren
op_amp
id|jsm_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|uart_unregister_driver
c_func
(paren
op_amp
id|jsm_uart_driver
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|jsm_driver_state
op_assign
id|DRIVER_READY
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|jsm_init_module
id|module_init
c_func
(paren
id|jsm_init_module
)paren
suffix:semicolon
multiline_comment|/*&n; * jsm_exit_module()&n; *&n; * Module unload.  This is where it all ends.&n; */
DECL|function|jsm_exit_module
r_static
r_void
id|__exit
id|jsm_exit_module
c_func
(paren
r_void
)paren
(brace
id|jsm_remove_driver_sysfiles
c_func
(paren
op_amp
id|jsm_driver.driver
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|jsm_driver
)paren
suffix:semicolon
id|uart_unregister_driver
c_func
(paren
op_amp
id|jsm_uart_driver
)paren
suffix:semicolon
)brace
DECL|variable|jsm_exit_module
id|module_exit
c_func
(paren
id|jsm_exit_module
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
