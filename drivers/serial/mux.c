multiline_comment|/*&n;** mux.c:&n;**&t;serial driver for the Mux console found in some PA-RISC servers.&n;**&n;**&t;(c) Copyright 2002 Ryan Bradetich&n;**&t;(c) Copyright 2002 Hewlett-Packard Company&n;**&n;** This program is free software; you can redistribute it and/or modify&n;** it under the terms of the GNU General Public License as published by&n;** the Free Software Foundation; either version 2 of the License, or&n;** (at your option) any later version.&n;**&n;** This Driver currently only supports the console (port 0) on the MUX.&n;** Additional work will be needed on this driver to enable the full&n;** functionality of the MUX.&n;**&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
macro_line|#include &lt;linux/sysrq.h&gt;
DECL|macro|SUPPORT_SYSRQ
mdefine_line|#define SUPPORT_SYSRQ
macro_line|#endif
macro_line|#include &lt;linux/serial_core.h&gt;
DECL|macro|MUX_NR
mdefine_line|#define MUX_NR 1
DECL|macro|MUX_OFFSET
mdefine_line|#define MUX_OFFSET 0x800
DECL|macro|MUX_LINE_OFFSET
mdefine_line|#define MUX_LINE_OFFSET 0x80
DECL|macro|MUX_FIFO_SIZE
mdefine_line|#define MUX_FIFO_SIZE 255
DECL|macro|MUX_MIN_FREE_SIZE
mdefine_line|#define MUX_MIN_FREE_SIZE 32
DECL|macro|MUX_FIFO_DRAIN_DELAY
mdefine_line|#define MUX_FIFO_DRAIN_DELAY 1
DECL|macro|MUX_POLL_DELAY
mdefine_line|#define MUX_POLL_DELAY (30 * HZ / 1000) 
DECL|macro|IO_COMMAND_REG_OFFSET
mdefine_line|#define IO_COMMAND_REG_OFFSET 0x30
DECL|macro|IO_STATUS_REG_OFFSET
mdefine_line|#define IO_STATUS_REG_OFFSET 0x34
DECL|macro|IO_DATA_REG_OFFSET
mdefine_line|#define IO_DATA_REG_OFFSET 0x3c
DECL|macro|IO_DCOUNT_REG_OFFSET
mdefine_line|#define IO_DCOUNT_REG_OFFSET 0x40
DECL|macro|IO_UCOUNT_REG_OFFSET
mdefine_line|#define IO_UCOUNT_REG_OFFSET 0x44
DECL|macro|IO_FIFOS_REG_OFFSET
mdefine_line|#define IO_FIFOS_REG_OFFSET 0x48
DECL|macro|MUX_EOFIFO
mdefine_line|#define MUX_EOFIFO(status) ((status &amp; 0xF000) == 0xF000)
DECL|macro|MUX_STATUS
mdefine_line|#define MUX_STATUS(status) ((status &amp; 0xF000) == 0x8000)
DECL|macro|MUX_BREAK
mdefine_line|#define MUX_BREAK(status) ((status &amp; 0xF000) == 0x2000)
DECL|variable|mux_ports
r_static
r_struct
id|uart_port
id|mux_ports
(braket
id|MUX_NR
)braket
suffix:semicolon
DECL|variable|mux_timer
r_static
r_struct
id|timer_list
id|mux_timer
suffix:semicolon
DECL|macro|UART_PUT_CHAR
mdefine_line|#define UART_PUT_CHAR(p, c) __raw_writel((c), (unsigned long)(p)-&gt;membase + IO_DATA_REG_OFFSET)
DECL|macro|UART_GET_FIFO_CNT
mdefine_line|#define UART_GET_FIFO_CNT(p) __raw_readl((unsigned long)(p)-&gt;membase + IO_DCOUNT_REG_OFFSET)
multiline_comment|/**&n; * mux_tx_empty - Check if the transmitter fifo is empty.&n; * @port: Ptr to the uart_port.&n; *&n; * This function test if the transmitter fifo for the port&n; * described by &squot;port&squot; is empty.  If it is empty, this function&n; * should return TIOCSER_TEMT, otherwise return 0.&n; */
DECL|function|mux_tx_empty
r_static
r_int
r_int
id|mux_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
r_int
id|cnt
op_assign
id|__raw_readl
c_func
(paren
(paren
r_int
r_int
)paren
id|port-&gt;membase
op_plus
id|IO_DCOUNT_REG_OFFSET
)paren
suffix:semicolon
r_return
id|cnt
ques
c_cond
l_int|0
suffix:colon
id|TIOCSER_TEMT
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_set_mctrl - Set the current state of the modem control inputs.&n; * @ports: Ptr to the uart_port.&n; * @mctrl: Modem control bits.&n; *&n; * The Serial MUX does not support CTS, DCD or DSR so this function&n; * is ignored.&n; */
DECL|function|mux_set_mctrl
r_static
r_void
id|mux_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|mctrl
)paren
(brace
)brace
multiline_comment|/**&n; * mux_get_mctrl - Returns the current state of modem control inputs.&n; * @port: Ptr to the uart_port.&n; *&n; * The Serial MUX does not support CTS, DCD or DSR so these lines are&n; * treated as permanently active.&n; */
DECL|function|mux_get_mctrl
r_static
r_int
r_int
id|mux_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
id|TIOCM_CAR
op_or
id|TIOCM_DSR
op_or
id|TIOCM_CTS
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_stop_tx - Stop transmitting characters.&n; * @port: Ptr to the uart_port.&n; * @tty_stop: tty layer issue this command?&n; *&n; * The Serial MUX does not support this function.&n; */
DECL|function|mux_stop_tx
r_static
r_void
id|mux_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_stop
)paren
(brace
)brace
multiline_comment|/**&n; * mux_start_tx - Start transmitting characters.&n; * @port: Ptr to the uart_port.&n; * @tty_start: tty layer issue this command?&n; *&n; * The Serial Mux does not support this function.&n; */
DECL|function|mux_start_tx
r_static
r_void
id|mux_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_start
)paren
(brace
)brace
multiline_comment|/**&n; * mux_stop_rx - Stop receiving characters.&n; * @port: Ptr to the uart_port.&n; *&n; * The Serial Mux does not support this function.&n; */
DECL|function|mux_stop_rx
r_static
r_void
id|mux_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
multiline_comment|/**&n; * mux_enable_ms - Enable modum status interrupts.&n; * @port: Ptr to the uart_port.&n; *&n; * The Serial Mux does not support this function.&n; */
DECL|function|mux_enable_ms
r_static
r_void
id|mux_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
multiline_comment|/**&n; * mux_break_ctl - Control the transmitssion of a break signal.&n; * @port: Ptr to the uart_port.&n; * @break_state: Raise/Lower the break signal.&n; *&n; * The Serial Mux does not support this function.&n; */
DECL|function|mux_break_ctl
r_static
r_void
id|mux_break_ctl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|break_state
)paren
(brace
)brace
multiline_comment|/**&n; * mux_write - Write chars to the mux fifo.&n; * @port: Ptr to the uart_port.&n; *&n; * This function writes all the data from the uart buffer to&n; * the mux fifo.&n; */
DECL|function|mux_write
r_static
r_void
id|mux_write
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
id|count
suffix:semicolon
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|port-&gt;info-&gt;xmit
suffix:semicolon
r_if
c_cond
(paren
id|port-&gt;x_char
)paren
(brace
id|UART_PUT_CHAR
c_func
(paren
id|port
comma
id|port-&gt;x_char
)paren
suffix:semicolon
id|port-&gt;icount.tx
op_increment
suffix:semicolon
id|port-&gt;x_char
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
op_logical_or
id|uart_tx_stopped
c_func
(paren
id|port
)paren
)paren
(brace
id|mux_stop_tx
c_func
(paren
id|port
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|count
op_assign
(paren
id|port-&gt;fifosize
op_rshift
l_int|1
)paren
op_minus
id|UART_GET_FIFO_CNT
c_func
(paren
id|port
)paren
suffix:semicolon
r_do
(brace
id|UART_PUT_CHAR
c_func
(paren
id|port
comma
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
)paren
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
l_int|1
)paren
op_amp
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|port-&gt;icount.tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_decrement
id|count
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
OL
id|WAKEUP_CHARS
)paren
(brace
id|uart_write_wakeup
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
id|mux_stop_tx
c_func
(paren
id|port
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_read - Read chars from the mux fifo.&n; * @port: Ptr to the uart_port.&n; *&n; * This reads all available data from the mux&squot;s fifo and pushes&n; * the data to the tty layer.&n; */
DECL|function|mux_read
r_static
r_void
id|mux_read
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
id|data
suffix:semicolon
id|__u32
id|start_count
op_assign
id|port-&gt;icount.rx
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|port-&gt;info-&gt;tty
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|data
op_assign
id|__raw_readl
c_func
(paren
(paren
r_int
r_int
)paren
id|port-&gt;membase
op_plus
id|IO_DATA_REG_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MUX_STATUS
c_func
(paren
id|data
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|MUX_EOFIFO
c_func
(paren
id|data
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
r_continue
suffix:semicolon
op_star
id|tty-&gt;flip.char_buf_ptr
op_assign
id|data
op_amp
l_int|0xffu
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_NORMAL
suffix:semicolon
id|port-&gt;icount.rx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|MUX_BREAK
c_func
(paren
id|data
)paren
)paren
(brace
id|port-&gt;icount.brk
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_handle_break
c_func
(paren
id|port
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|uart_handle_sysrq_char
c_func
(paren
id|port
comma
id|data
op_amp
l_int|0xffu
comma
l_int|NULL
)paren
)paren
r_continue
suffix:semicolon
id|tty-&gt;flip.flag_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.count
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start_count
op_ne
id|port-&gt;icount.rx
)paren
(brace
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * mux_startup - Initialize the port.&n; * @port: Ptr to the uart_port.&n; *&n; * Grab any resources needed for this port and start the&n; * mux timer.&n; */
DECL|function|mux_startup
r_static
r_int
id|mux_startup
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|mux_timer
comma
id|jiffies
op_plus
id|MUX_POLL_DELAY
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_shutdown - Disable the port.&n; * @port: Ptr to the uart_port.&n; *&n; * Release any resources needed for the port.&n; */
DECL|function|mux_shutdown
r_static
r_void
id|mux_shutdown
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
multiline_comment|/**&n; * mux_settermios - Chane port parameters.&n; * @port: Ptr to the uart_port.&n; * @termios: new termios settings.&n; * @old: old termios settings.&n; *&n; * The Serial Mux does not support this function.&n; */
r_static
r_void
DECL|function|mux_settermios
id|mux_settermios
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old
)paren
(brace
)brace
multiline_comment|/**&n; * mux_type - Describe the port.&n; * @port: Ptr to the uart_port.&n; *&n; * Return a pointer to a string constant describing the&n; * specified port.&n; */
DECL|function|mux_type
r_static
r_const
r_char
op_star
id|mux_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_string|&quot;Mux&quot;
suffix:semicolon
)brace
multiline_comment|/**&n; * release_port - Release memory and IO regions.&n; * @port: Ptr to the uart_port.&n; * &n; * Release any memory and IO region resources currently in use by&n; * the port.&n; */
DECL|function|mux_release_port
r_static
r_void
id|mux_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
multiline_comment|/**&n; * mux_request_port - Request memory and IO regions.&n; * @port: Ptr to the uart_port.&n; *&n; * Request any memory and IO region resources required by the port.&n; * If any fail, no resources should be registered when this function&n; * returns, and it should return -EBUSY on failure.&n; */
DECL|function|mux_request_port
r_static
r_int
id|mux_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_config_port - Perform port autoconfiguration.&n; * @port: Ptr to the uart_port.&n; * @type: Bitmask of required configurations.&n; *&n; * Perform any autoconfiguration steps for the port.  This functino is&n; * called if the UPF_BOOT_AUTOCONF flag is specified for the port.&n; * [Note: This is required for now because of a bug in the Serial core.&n; *  rmk has already submitted a patch to linus, should be available for&n; *  2.5.47.]&n; */
DECL|function|mux_config_port
r_static
r_void
id|mux_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|type
)paren
(brace
id|port-&gt;type
op_assign
id|PORT_MUX
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_verify_port - Verify the port information.&n; * @port: Ptr to the uart_port.&n; * @ser: Ptr to the serial information.&n; *&n; * Verify the new serial port information contained within serinfo is&n; * suitable for this port type.&n; */
DECL|function|mux_verify_port
r_static
r_int
id|mux_verify_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|ser
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;membase
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_drv_poll - Mux poll function.   &n; * @unused: Unused variable&n; *&n; * This function periodically polls the Serial MUX to check for new data.&n; */
DECL|function|mux_poll
r_static
r_void
id|mux_poll
c_func
(paren
r_int
r_int
id|unused
)paren
(brace
r_struct
id|uart_port
op_star
id|port
op_assign
op_amp
id|mux_ports
(braket
l_int|0
)braket
suffix:semicolon
id|mux_read
c_func
(paren
id|port
)paren
suffix:semicolon
id|mux_write
c_func
(paren
id|port
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|mux_timer
comma
id|jiffies
op_plus
id|MUX_POLL_DELAY
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SERIAL_MUX_CONSOLE
DECL|variable|mux_console
r_static
r_struct
id|console
id|mux_console
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ttyB&quot;
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|macro|MUX_CONSOLE
mdefine_line|#define MUX_CONSOLE&t;&amp;mux_console
macro_line|#else
DECL|macro|MUX_CONSOLE
mdefine_line|#define MUX_CONSOLE&t;NULL
macro_line|#endif
DECL|variable|mux_pops
r_static
r_struct
id|uart_ops
id|mux_pops
op_assign
(brace
dot
id|tx_empty
op_assign
id|mux_tx_empty
comma
dot
id|set_mctrl
op_assign
id|mux_set_mctrl
comma
dot
id|get_mctrl
op_assign
id|mux_get_mctrl
comma
dot
id|stop_tx
op_assign
id|mux_stop_tx
comma
dot
id|start_tx
op_assign
id|mux_start_tx
comma
dot
id|stop_rx
op_assign
id|mux_stop_rx
comma
dot
id|enable_ms
op_assign
id|mux_enable_ms
comma
dot
id|break_ctl
op_assign
id|mux_break_ctl
comma
dot
id|startup
op_assign
id|mux_startup
comma
dot
id|shutdown
op_assign
id|mux_shutdown
comma
dot
id|settermios
op_assign
id|mux_settermios
comma
dot
id|type
op_assign
id|mux_type
comma
dot
id|release_port
op_assign
id|mux_release_port
comma
dot
id|request_port
op_assign
id|mux_request_port
comma
dot
id|config_port
op_assign
id|mux_config_port
comma
dot
id|verify_port
op_assign
id|mux_verify_port
comma
)brace
suffix:semicolon
DECL|variable|mux_reg
r_static
r_struct
id|uart_driver
id|mux_reg
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
l_string|&quot;ttyB&quot;
comma
macro_line|#ifdef CONFIG_DEVFS_FS
dot
id|dev_name
op_assign
l_string|&quot;ttyB%d&quot;
comma
macro_line|#else
dot
id|dev_name
op_assign
l_string|&quot;ttyB%d&quot;
comma
macro_line|#endif
dot
id|major
op_assign
id|MUX_MAJOR
comma
dot
id|minor
op_assign
l_int|0
comma
dot
id|nr
op_assign
id|MUX_NR
comma
dot
id|cons
op_assign
id|MUX_CONSOLE
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * mux_probe - Determine if the Serial Mux should claim this device.&n; * @dev: The parisc device.&n; *&n; * Deterimine if the Serial Mux should claim this chip (return 0)&n; * or not (return 1).&n; */
DECL|function|mux_probe
r_static
r_int
id|__init
id|mux_probe
c_func
(paren
r_struct
id|parisc_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
r_struct
id|uart_port
op_star
id|port
op_assign
op_amp
id|mux_ports
(braket
l_int|0
)braket
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|mux_timer
)paren
suffix:semicolon
id|mux_timer.function
op_assign
id|mux_poll
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Serial mux driver Revision: 0.1&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|mux_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MUX_NR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|port
op_assign
op_amp
id|mux_ports
(braket
id|i
)braket
suffix:semicolon
id|port-&gt;iobase
op_assign
l_int|0
suffix:semicolon
id|port-&gt;mapbase
op_assign
id|dev-&gt;hpa
op_plus
id|MUX_OFFSET
op_plus
(paren
id|i
op_star
id|MUX_LINE_OFFSET
)paren
suffix:semicolon
id|port-&gt;membase
op_assign
id|ioremap
c_func
(paren
id|port-&gt;mapbase
comma
id|MUX_LINE_OFFSET
)paren
suffix:semicolon
id|port-&gt;iotype
op_assign
id|SERIAL_IO_MEM
suffix:semicolon
id|port-&gt;type
op_assign
id|PORT_MUX
suffix:semicolon
id|port-&gt;irq
op_assign
id|SERIAL_IRQ_NONE
suffix:semicolon
id|port-&gt;uartclk
op_assign
l_int|0
suffix:semicolon
id|port-&gt;fifosize
op_assign
id|MUX_FIFO_SIZE
suffix:semicolon
id|port-&gt;ops
op_assign
op_amp
id|mux_pops
suffix:semicolon
id|port-&gt;flags
op_assign
id|UPF_BOOT_AUTOCONF
suffix:semicolon
id|port-&gt;line
op_assign
l_int|0
suffix:semicolon
id|uart_add_one_port
c_func
(paren
op_amp
id|mux_reg
comma
id|port
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|mux_tbl
r_static
r_struct
id|parisc_device_id
id|mux_tbl
(braket
)braket
op_assign
(brace
(brace
id|HPHW_A_DIRECT
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0000D
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|parisc
comma
id|mux_tbl
)paren
suffix:semicolon
DECL|variable|mux_driver
r_static
r_struct
id|parisc_driver
id|mux_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Serial MUX driver&quot;
comma
dot
id|id_table
op_assign
id|mux_tbl
comma
dot
id|probe
op_assign
id|mux_probe
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * mux_init - Serial MUX initalization procedure.&n; *&n; * Register the Serial MUX driver.&n; */
DECL|function|mux_init
r_static
r_int
id|__init
id|mux_init
c_func
(paren
r_void
)paren
(brace
r_return
id|register_parisc_driver
c_func
(paren
op_amp
id|mux_driver
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * mux_exit - Serial MUX cleanup procedure.&n; *&n; * Unregister the Serial MUX driver from the tty layer.&n; */
DECL|function|mux_exit
r_static
r_void
id|__exit
id|mux_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MUX_NR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|uart_remove_one_port
c_func
(paren
op_amp
id|mux_reg
comma
op_amp
id|mux_ports
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|uart_unregister_driver
c_func
(paren
op_amp
id|mux_reg
)paren
suffix:semicolon
)brace
DECL|variable|mux_init
id|module_init
c_func
(paren
id|mux_init
)paren
suffix:semicolon
DECL|variable|mux_exit
id|module_exit
c_func
(paren
id|mux_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ryan Bradetich&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Serial MUX driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
