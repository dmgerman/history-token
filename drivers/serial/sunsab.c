multiline_comment|/* sunsab.c: ASYNC Driver for the SIEMENS SAB82532 DUSCC.&n; *&n; * Copyright (C) 1997  Eddie C. Dost  (ecd@skynet.be)&n; * Copyright (C) 2002  David S. Miller (davem@redhat.com)&n; *&n; * Rewrote buffer handling to use CIRC(Circular Buffer) macros.&n; *   Maxim Krasnyanskiy &lt;maxk@qualcomm.com&gt;&n; *&n; * Fixed to use tty_get_baud_rate, and to allow for arbitrary baud&n; * rates to be programmed into the UART.  Also eliminated a lot of&n; * duplicated code in the console setup.&n; *   Theodore Ts&squot;o &lt;tytso@mit.edu&gt;, 2001-Oct-12&n; *&n; * Ported to new 2.5.x UART layer.&n; *   David S. Miller &lt;davem@redhat.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/circ_buf.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &quot;suncore.h&quot;
macro_line|#include &quot;sunsab.h&quot;
DECL|struct|uart_sunsab_port
r_struct
id|uart_sunsab_port
(brace
DECL|member|port
r_struct
id|uart_port
id|port
suffix:semicolon
multiline_comment|/* Generic UART port&t;*/
DECL|member|regs
r_union
id|sab82532_async_regs
op_star
id|regs
suffix:semicolon
multiline_comment|/* Chip registers&t;*/
DECL|member|irqflags
r_int
r_int
id|irqflags
suffix:semicolon
multiline_comment|/* IRQ state flags&t;*/
DECL|member|xmit_fifo_size
r_int
id|xmit_fifo_size
suffix:semicolon
multiline_comment|/* TX fifo size&t;&t;*/
DECL|member|recv_fifo_size
r_int
id|recv_fifo_size
suffix:semicolon
multiline_comment|/* RX fifo size&t;&t;*/
DECL|member|dsr
r_int
id|dsr
suffix:semicolon
multiline_comment|/* Current DSR state&t;*/
DECL|member|cec_timeout
r_int
r_int
id|cec_timeout
suffix:semicolon
multiline_comment|/* Chip poll timeout... */
DECL|member|tec_timeout
r_int
r_int
id|tec_timeout
suffix:semicolon
multiline_comment|/* likewise&t;&t;*/
DECL|member|interrupt_mask0
r_int
r_char
id|interrupt_mask0
suffix:semicolon
multiline_comment|/* ISR0 masking&t;&t;*/
DECL|member|interrupt_mask1
r_int
r_char
id|interrupt_mask1
suffix:semicolon
multiline_comment|/* ISR1 masking&t;&t;*/
DECL|member|pvr_dtr_bit
r_int
r_char
id|pvr_dtr_bit
suffix:semicolon
multiline_comment|/* Which PVR bit is DTR */
DECL|member|pvr_dsr_bit
r_int
r_char
id|pvr_dsr_bit
suffix:semicolon
multiline_comment|/* Which PVR bit is DSR */
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* SAB82532 version&t;*/
DECL|member|sab_line
r_int
id|sab_line
suffix:semicolon
multiline_comment|/* Internal numbering&t;*/
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
multiline_comment|/* Device interrupt&t;*/
)brace
suffix:semicolon
multiline_comment|/*&n; * This assumes you have a 29.4912 MHz clock for your UART.&n; */
DECL|macro|SAB_BASE_BAUD
mdefine_line|#define SAB_BASE_BAUD ( 29491200 / 16 )
DECL|variable|sab82532_version
r_static
r_char
op_star
id|sab82532_version
(braket
l_int|16
)braket
op_assign
(brace
l_string|&quot;V1.0&quot;
comma
l_string|&quot;V2.0&quot;
comma
l_string|&quot;V3.2&quot;
comma
l_string|&quot;V(0x03)&quot;
comma
l_string|&quot;V(0x04)&quot;
comma
l_string|&quot;V(0x05)&quot;
comma
l_string|&quot;V(0x06)&quot;
comma
l_string|&quot;V(0x07)&quot;
comma
l_string|&quot;V(0x08)&quot;
comma
l_string|&quot;V(0x09)&quot;
comma
l_string|&quot;V(0x0a)&quot;
comma
l_string|&quot;V(0x0b)&quot;
comma
l_string|&quot;V(0x0c)&quot;
comma
l_string|&quot;V(0x0d)&quot;
comma
l_string|&quot;V(0x0e)&quot;
comma
l_string|&quot;V(0x0f)&quot;
)brace
suffix:semicolon
DECL|macro|SAB82532_MAX_TEC_TIMEOUT
mdefine_line|#define SAB82532_MAX_TEC_TIMEOUT 200000&t;/* 1 character time (at 50 baud) */
DECL|macro|SAB82532_MAX_CEC_TIMEOUT
mdefine_line|#define SAB82532_MAX_CEC_TIMEOUT  50000&t;/* 2.5 TX CLKs (at 50 baud) */
DECL|function|sunsab_tec_wait
r_static
id|__inline__
r_void
id|sunsab_tec_wait
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
)paren
(brace
r_int
id|timeout
op_assign
id|up-&gt;tec_timeout
suffix:semicolon
r_while
c_loop
(paren
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.star
)paren
op_amp
id|SAB82532_STAR_TEC
)paren
op_logical_and
op_decrement
id|timeout
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|sunsab_cec_wait
r_static
id|__inline__
r_void
id|sunsab_cec_wait
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
)paren
(brace
r_int
id|timeout
op_assign
id|up-&gt;cec_timeout
suffix:semicolon
r_while
c_loop
(paren
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.star
)paren
op_amp
id|SAB82532_STAR_CEC
)paren
op_logical_and
op_decrement
id|timeout
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|receive_chars
r_static
r_void
id|receive_chars
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
comma
r_union
id|sab82532_irq_status
op_star
id|stat
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|up-&gt;port.info-&gt;tty
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|saw_console_brk
op_assign
l_int|0
suffix:semicolon
r_int
id|free_fifo
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Read number of BYTES (Character + Status) available. */
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_RPF
)paren
(brace
id|count
op_assign
id|up-&gt;recv_fifo_size
suffix:semicolon
id|free_fifo
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_TCD
)paren
(brace
id|count
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.rbcl
)paren
op_amp
(paren
id|up-&gt;recv_fifo_size
op_minus
l_int|1
)paren
suffix:semicolon
id|free_fifo
op_increment
suffix:semicolon
)brace
multiline_comment|/* Issue a FIFO read command in case we where idle. */
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_TIME
)paren
(brace
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CMDR_RFRD
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_RFO
)paren
id|free_fifo
op_increment
suffix:semicolon
multiline_comment|/* Read the FIFO. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.rfifo
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Issue Receive Message Complete command. */
r_if
c_cond
(paren
id|free_fifo
)paren
(brace
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CMDR_RMC
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|ch
op_assign
id|buf
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
)paren
(brace
id|tty-&gt;flip.work
dot
id|func
c_func
(paren
(paren
r_void
op_star
)paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
r_return
suffix:semicolon
singleline_comment|// if TTY_DONT_FLIP is set
)brace
op_star
id|tty-&gt;flip.char_buf_ptr
op_assign
id|ch
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_NORMAL
suffix:semicolon
id|up-&gt;port.icount.rx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|stat-&gt;sreg.isr0
op_amp
(paren
id|SAB82532_ISR0_PERR
op_or
id|SAB82532_ISR0_FERR
op_or
id|SAB82532_ISR0_RFO
)paren
)paren
op_logical_or
id|unlikely
c_func
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_BRK
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * For statistics only&n;&t;&t;&t; */
r_if
c_cond
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_BRK
)paren
(brace
id|stat-&gt;sreg.isr0
op_and_assign
op_complement
(paren
id|SAB82532_ISR0_PERR
op_or
id|SAB82532_ISR0_FERR
)paren
suffix:semicolon
id|up-&gt;port.icount.brk
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;port.line
op_eq
id|up-&gt;port.cons-&gt;index
)paren
id|saw_console_brk
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * We do the SysRQ and SAK checking&n;&t;&t;&t;&t; * here because otherwise the break&n;&t;&t;&t;&t; * may get masked by ignore_status_mask&n;&t;&t;&t;&t; * or read_status_mask.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|uart_handle_break
c_func
(paren
op_amp
id|up-&gt;port
)paren
)paren
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_PERR
)paren
id|up-&gt;port.icount.parity
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_FERR
)paren
id|up-&gt;port.icount.frame
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_RFO
)paren
id|up-&gt;port.icount.overrun
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Mask off conditions which should be ingored.&n;&t;&t;&t; */
id|stat-&gt;sreg.isr0
op_and_assign
(paren
id|up-&gt;port.read_status_mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|stat-&gt;sreg.isr1
op_and_assign
(paren
(paren
id|up-&gt;port.read_status_mask
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_BRK
)paren
(brace
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_BREAK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_PERR
)paren
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_PARITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_FERR
)paren
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_FRAME
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_handle_sysrq_char
c_func
(paren
op_amp
id|up-&gt;port
comma
id|ch
comma
id|regs
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat-&gt;sreg.isr0
op_amp
(paren
id|up-&gt;port.ignore_status_mask
op_amp
l_int|0xff
)paren
)paren
op_eq
l_int|0
op_logical_and
(paren
id|stat-&gt;sreg.isr1
op_amp
(paren
(paren
id|up-&gt;port.ignore_status_mask
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|tty-&gt;flip.flag_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.count
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_RFO
)paren
op_logical_and
id|tty-&gt;flip.count
OL
id|TTY_FLIPBUF_SIZE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Overrun is special, since it&squot;s reported&n;&t;&t;&t; * immediately, and doesn&squot;t affect the current&n;&t;&t;&t; * character.&n;&t;&t;&t; */
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_OVERRUN
suffix:semicolon
id|tty-&gt;flip.flag_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.count
op_increment
suffix:semicolon
)brace
)brace
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saw_console_brk
)paren
id|sun_do_break
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|sunsab_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|function|transmit_chars
r_static
r_void
id|transmit_chars
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
comma
r_union
id|sab82532_irq_status
op_star
id|stat
)paren
(brace
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|up-&gt;port.info-&gt;xmit
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_ALLS
)paren
(brace
id|up-&gt;interrupt_mask1
op_or_assign
id|SAB82532_IMR1_ALLS
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|SAB82532_ALLS
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_XPR
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.star
)paren
op_amp
id|SAB82532_STAR_XFW
)paren
)paren
r_return
suffix:semicolon
id|set_bit
c_func
(paren
id|SAB82532_XPR
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
op_logical_or
id|uart_tx_stopped
c_func
(paren
op_amp
id|up-&gt;port
)paren
)paren
(brace
id|up-&gt;interrupt_mask1
op_or_assign
id|SAB82532_IMR1_XPR
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|up-&gt;interrupt_mask1
op_and_assign
op_complement
(paren
id|SAB82532_IMR1_ALLS
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|SAB82532_ALLS
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
multiline_comment|/* Stuff 32 bytes into Transmit FIFO. */
id|clear_bit
c_func
(paren
id|SAB82532_XPR
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|up-&gt;xmit_fifo_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writeb
c_func
(paren
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
comma
op_amp
id|up-&gt;regs-&gt;w.xfifo
(braket
id|i
)braket
)paren
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
l_int|1
)paren
op_amp
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|up-&gt;port.icount.tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* Issue a Transmit Frame command. */
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CMDR_XF
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
OL
id|WAKEUP_CHARS
)paren
id|uart_write_wakeup
c_func
(paren
op_amp
id|up-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
id|sunsab_stop_tx
c_func
(paren
op_amp
id|up-&gt;port
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|check_status
r_static
r_void
id|check_status
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
comma
r_union
id|sab82532_irq_status
op_star
id|stat
)paren
(brace
r_if
c_cond
(paren
id|stat-&gt;sreg.isr0
op_amp
id|SAB82532_ISR0_CDSC
)paren
id|uart_handle_dcd_change
c_func
(paren
op_amp
id|up-&gt;port
comma
op_logical_neg
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.vstr
)paren
op_amp
id|SAB82532_VSTR_CD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat-&gt;sreg.isr1
op_amp
id|SAB82532_ISR1_CSC
)paren
id|uart_handle_cts_change
c_func
(paren
op_amp
id|up-&gt;port
comma
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.star
)paren
op_amp
id|SAB82532_STAR_CTS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.pvr
)paren
op_amp
id|up-&gt;pvr_dsr_bit
)paren
op_xor
id|up-&gt;dsr
)paren
(brace
id|up-&gt;dsr
op_assign
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.pvr
)paren
op_amp
id|up-&gt;pvr_dsr_bit
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|up-&gt;port.icount.dsr
op_increment
suffix:semicolon
)brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|up-&gt;port.info-&gt;delta_msr_wait
)paren
suffix:semicolon
)brace
DECL|function|sunsab_interrupt
r_static
r_void
id|sunsab_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
id|dev_id
suffix:semicolon
r_union
id|sab82532_irq_status
id|status
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|status.stat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.gis
)paren
op_amp
id|SAB82532_GIS_ISA0
)paren
id|status.sreg.isr0
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.gis
)paren
op_amp
id|SAB82532_GIS_ISA1
)paren
id|status.sreg.isr1
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status.stat
)paren
(brace
r_if
c_cond
(paren
id|status.sreg.isr0
op_amp
(paren
id|SAB82532_ISR0_TCD
op_or
id|SAB82532_ISR0_TIME
op_or
id|SAB82532_ISR0_RFO
op_or
id|SAB82532_ISR0_RPF
)paren
)paren
id|receive_chars
c_func
(paren
id|up
comma
op_amp
id|status
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status.sreg.isr0
op_amp
id|SAB82532_ISR0_CDSC
)paren
op_logical_or
(paren
id|status.sreg.isr1
op_amp
id|SAB82532_ISR1_CSC
)paren
)paren
id|check_status
c_func
(paren
id|up
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status.sreg.isr1
op_amp
(paren
id|SAB82532_ISR1_ALLS
op_or
id|SAB82532_ISR1_XPR
)paren
)paren
id|transmit_chars
c_func
(paren
id|up
comma
op_amp
id|status
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|up-&gt;port.lock
)paren
suffix:semicolon
id|up
op_increment
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|up-&gt;port.lock
)paren
suffix:semicolon
id|status.stat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.gis
)paren
op_amp
id|SAB82532_GIS_ISB0
)paren
id|status.sreg.isr0
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.gis
)paren
op_amp
id|SAB82532_GIS_ISB1
)paren
id|status.sreg.isr1
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status.stat
)paren
(brace
r_if
c_cond
(paren
id|status.sreg.isr0
op_amp
(paren
id|SAB82532_ISR0_TCD
op_or
id|SAB82532_ISR0_TIME
op_or
id|SAB82532_ISR0_RFO
op_or
id|SAB82532_ISR0_RPF
)paren
)paren
id|receive_chars
c_func
(paren
id|up
comma
op_amp
id|status
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status.sreg.isr0
op_amp
id|SAB82532_ISR0_CDSC
)paren
op_logical_or
(paren
id|status.sreg.isr1
op_amp
(paren
id|SAB82532_ISR1_BRK
op_or
id|SAB82532_ISR1_CSC
)paren
)paren
)paren
id|check_status
c_func
(paren
id|up
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status.sreg.isr1
op_amp
(paren
id|SAB82532_ISR1_ALLS
op_or
id|SAB82532_ISR1_XPR
)paren
)paren
id|transmit_chars
c_func
(paren
id|up
comma
op_amp
id|status
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_tx_empty
r_static
r_int
r_int
id|sunsab_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Do not need a lock for a state test like this.  */
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|SAB82532_ALLS
comma
op_amp
id|up-&gt;irqflags
)paren
)paren
id|ret
op_assign
id|TIOCSER_TEMT
suffix:semicolon
r_else
id|ret
op_assign
l_int|0
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock held by caller.  */
DECL|function|sunsab_set_mctrl
r_static
r_void
id|sunsab_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|mctrl
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_RTS
)paren
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_amp
op_complement
id|SAB82532_MODE_FRTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_RTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
)brace
r_else
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_FRTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_RTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_DTR
)paren
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.pvr
)paren
op_amp
op_complement
(paren
id|up-&gt;pvr_dtr_bit
)paren
comma
op_amp
id|up-&gt;regs-&gt;rw.pvr
)paren
suffix:semicolon
)brace
r_else
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.pvr
)paren
op_or
id|up-&gt;pvr_dtr_bit
comma
op_amp
id|up-&gt;regs-&gt;rw.pvr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_get_mctrl
r_static
r_int
r_int
id|sunsab_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.pvr
)paren
suffix:semicolon
id|result
op_or_assign
(paren
id|val
op_amp
id|up-&gt;pvr_dsr_bit
)paren
ques
c_cond
l_int|0
suffix:colon
id|TIOCM_DSR
suffix:semicolon
id|val
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.vstr
)paren
suffix:semicolon
id|result
op_or_assign
(paren
id|val
op_amp
id|SAB82532_VSTR_CD
)paren
ques
c_cond
l_int|0
suffix:colon
id|TIOCM_CAR
suffix:semicolon
id|val
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.star
)paren
suffix:semicolon
id|result
op_or_assign
(paren
id|val
op_amp
id|SAB82532_STAR_CTS
)paren
ques
c_cond
id|TIOCM_CTS
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock held by caller.  */
DECL|function|sunsab_stop_tx
r_static
r_void
id|sunsab_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_stop
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
id|up-&gt;interrupt_mask1
op_or_assign
id|SAB82532_IMR1_XPR
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock held by caller.  */
DECL|function|sunsab_start_tx
r_static
r_void
id|sunsab_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_start
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|up-&gt;port.info-&gt;xmit
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|SAB82532_XPR
comma
op_amp
id|up-&gt;irqflags
)paren
)paren
r_return
suffix:semicolon
id|up-&gt;interrupt_mask1
op_and_assign
op_complement
id|SAB82532_IMR1_XPR
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|SAB82532_ALLS
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|SAB82532_XPR
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|up-&gt;xmit_fifo_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writeb
c_func
(paren
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
comma
op_amp
id|up-&gt;regs-&gt;w.xfifo
(braket
id|i
)braket
)paren
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
l_int|1
)paren
op_amp
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|up-&gt;port.icount.tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* Issue a Transmit Frame command.  */
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CMDR_XF
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_send_xchar
r_static
r_void
id|sunsab_send_xchar
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_char
id|ch
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|sunsab_tec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|ch
comma
op_amp
id|up-&gt;regs-&gt;w.tic
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock held by caller.  */
DECL|function|sunsab_stop_rx
r_static
r_void
id|sunsab_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
id|up-&gt;interrupt_mask0
op_or_assign
id|SAB82532_ISR0_TCD
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr0
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock held by caller.  */
DECL|function|sunsab_enable_ms
r_static
r_void
id|sunsab_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
multiline_comment|/* For now we always receive these interrupts.  */
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_break_ctl
r_static
r_void
id|sunsab_break_ctl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|break_state
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.dafo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|break_state
)paren
id|val
op_or_assign
id|SAB82532_DAFO_XBRK
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
id|SAB82532_DAFO_XBRK
suffix:semicolon
id|writeb
c_func
(paren
id|val
comma
op_amp
id|up-&gt;regs-&gt;rw.dafo
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_startup
r_static
r_int
id|sunsab_startup
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for any commands or immediate characters&n;&t; */
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|sunsab_tec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the FIFO buffers.&n;&t; */
id|writeb
c_func
(paren
id|SAB82532_CMDR_RRES
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CMDR_XRES
comma
op_amp
id|up-&gt;regs-&gt;w.cmdr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the interrupt registers.&n;&t; */
(paren
r_void
)paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr0
)paren
suffix:semicolon
(paren
r_void
)paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.isr1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now, initialize the UART &n;&t; */
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|up-&gt;regs-&gt;w.ccr0
)paren
suffix:semicolon
multiline_comment|/* power-down */
id|writeb
c_func
(paren
id|SAB82532_CCR0_MCE
op_or
id|SAB82532_CCR0_SC_NRZ
op_or
id|SAB82532_CCR0_SM_ASYNC
comma
op_amp
id|up-&gt;regs-&gt;w.ccr0
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CCR1_ODS
op_or
id|SAB82532_CCR1_BCR
op_or
l_int|7
comma
op_amp
id|up-&gt;regs-&gt;w.ccr1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CCR2_BDF
op_or
id|SAB82532_CCR2_SSEL
op_or
id|SAB82532_CCR2_TOE
comma
op_amp
id|up-&gt;regs-&gt;w.ccr2
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|up-&gt;regs-&gt;w.ccr3
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_CCR4_MCK4
op_or
id|SAB82532_CCR4_EBRG
comma
op_amp
id|up-&gt;regs-&gt;w.ccr4
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_MODE_RTS
op_or
id|SAB82532_MODE_FCTS
op_or
id|SAB82532_MODE_RAC
comma
op_amp
id|up-&gt;regs-&gt;w.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_RFC_DPS
op_or
id|SAB82532_RFC_RFDF
comma
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|up-&gt;recv_fifo_size
)paren
(brace
r_case
l_int|1
suffix:colon
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SAB82532_RFC_RFTH_1
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SAB82532_RFC_RFTH_4
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SAB82532_RFC_RFTH_16
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|up-&gt;recv_fifo_size
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|32
suffix:colon
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SAB82532_RFC_RFTH_32
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;w.rfc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.ccr0
)paren
suffix:semicolon
id|tmp
op_or_assign
id|SAB82532_CCR0_PU
suffix:semicolon
multiline_comment|/* power-up */
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;rw.ccr0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Finally, enable interrupts&n;&t; */
id|up-&gt;interrupt_mask0
op_assign
(paren
id|SAB82532_IMR0_PERR
op_or
id|SAB82532_IMR0_FERR
op_or
id|SAB82532_IMR0_PLLA
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask0
comma
op_amp
id|up-&gt;regs-&gt;w.imr0
)paren
suffix:semicolon
id|up-&gt;interrupt_mask1
op_assign
(paren
id|SAB82532_IMR1_BRKT
op_or
id|SAB82532_IMR1_ALLS
op_or
id|SAB82532_IMR1_XOFF
op_or
id|SAB82532_IMR1_TIN
op_or
id|SAB82532_IMR1_CSC
op_or
id|SAB82532_IMR1_XON
op_or
id|SAB82532_IMR1_XPR
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|SAB82532_ALLS
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|SAB82532_XPR
comma
op_amp
id|up-&gt;irqflags
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_shutdown
r_static
r_void
id|sunsab_shutdown
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable Interrupts */
id|up-&gt;interrupt_mask0
op_assign
l_int|0xff
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask0
comma
op_amp
id|up-&gt;regs-&gt;w.imr0
)paren
suffix:semicolon
id|up-&gt;interrupt_mask1
op_assign
l_int|0xff
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
multiline_comment|/* Disable break condition */
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.dafo
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SAB82532_DAFO_XBRK
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;rw.dafo
)paren
suffix:semicolon
multiline_comment|/* Disable Receiver */
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SAB82532_MODE_RAC
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
multiline_comment|/* Power Down */
id|tmp
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.ccr0
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|SAB82532_CCR0_PU
suffix:semicolon
id|writeb
c_func
(paren
id|tmp
comma
op_amp
id|up-&gt;regs-&gt;rw.ccr0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is used to figure out the divisor speeds.&n; *&n; * The formula is:    Baud = SAB_BASE_BAUD / ((N + 1) * (1 &lt;&lt; M)),&n; *&n; * with               0 &lt;= N &lt; 64 and 0 &lt;= M &lt; 16&n; */
DECL|function|calc_ebrg
r_static
r_void
id|calc_ebrg
c_func
(paren
r_int
id|baud
comma
r_int
op_star
id|n_ret
comma
r_int
op_star
id|m_ret
)paren
(brace
r_int
id|n
comma
id|m
suffix:semicolon
r_if
c_cond
(paren
id|baud
op_eq
l_int|0
)paren
(brace
op_star
id|n_ret
op_assign
l_int|0
suffix:semicolon
op_star
id|m_ret
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We scale numbers by 10 so that we get better accuracy&n;&t; * without having to use floating point.  Here we increment m&n;&t; * until n is within the valid range.&n;&t; */
id|n
op_assign
(paren
id|SAB_BASE_BAUD
op_star
l_int|10
)paren
op_div
id|baud
suffix:semicolon
id|m
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n
op_ge
l_int|640
)paren
(brace
id|n
op_assign
id|n
op_div
l_int|2
suffix:semicolon
id|m
op_increment
suffix:semicolon
)brace
id|n
op_assign
(paren
id|n
op_plus
l_int|5
)paren
op_div
l_int|10
suffix:semicolon
multiline_comment|/*&n;&t; * We try very hard to avoid speeds with M == 0 since they may&n;&t; * not work correctly for XTAL frequences above 10 MHz.&n;&t; */
r_if
c_cond
(paren
(paren
id|m
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|n
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|n
op_assign
id|n
op_div
l_int|2
suffix:semicolon
id|m
op_increment
suffix:semicolon
)brace
op_star
id|n_ret
op_assign
id|n
op_minus
l_int|1
suffix:semicolon
op_star
id|m_ret
op_assign
id|m
suffix:semicolon
)brace
multiline_comment|/* Internal routine, port-&gt;lock is held and local interrupts are disabled.  */
DECL|function|sunsab_convert_to_sab
r_static
r_void
id|sunsab_convert_to_sab
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
comma
r_int
r_int
id|cflag
comma
r_int
r_int
id|iflag
comma
r_int
id|baud
)paren
(brace
r_int
r_int
id|ebrg
suffix:semicolon
r_int
r_char
id|dafo
suffix:semicolon
r_int
id|bits
comma
id|n
comma
id|m
suffix:semicolon
multiline_comment|/* Byte size and parity */
r_switch
c_cond
(paren
id|cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
id|dafo
op_assign
id|SAB82532_DAFO_CHL5
suffix:semicolon
id|bits
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|dafo
op_assign
id|SAB82532_DAFO_CHL6
suffix:semicolon
id|bits
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|dafo
op_assign
id|SAB82532_DAFO_CHL7
suffix:semicolon
id|bits
op_assign
l_int|9
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
id|dafo
op_assign
id|SAB82532_DAFO_CHL8
suffix:semicolon
id|bits
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Never happens, but GCC is too dumb to figure it out */
r_default
suffix:colon
id|dafo
op_assign
id|SAB82532_DAFO_CHL5
suffix:semicolon
id|bits
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|CSTOPB
)paren
(brace
id|dafo
op_or_assign
id|SAB82532_DAFO_STOP
suffix:semicolon
id|bits
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|PARENB
)paren
(brace
id|dafo
op_or_assign
id|SAB82532_DAFO_PARE
suffix:semicolon
id|bits
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|PARODD
)paren
(brace
id|dafo
op_or_assign
id|SAB82532_DAFO_PAR_ODD
suffix:semicolon
)brace
r_else
(brace
id|dafo
op_or_assign
id|SAB82532_DAFO_PAR_EVEN
suffix:semicolon
)brace
id|calc_ebrg
c_func
(paren
id|baud
comma
op_amp
id|n
comma
op_amp
id|m
)paren
suffix:semicolon
id|ebrg
op_assign
id|n
op_or
(paren
id|m
op_lshift
l_int|6
)paren
suffix:semicolon
id|up-&gt;tec_timeout
op_assign
(paren
l_int|10
op_star
l_int|1000000
)paren
op_div
id|baud
suffix:semicolon
id|up-&gt;cec_timeout
op_assign
id|up-&gt;tec_timeout
op_rshift
l_int|2
suffix:semicolon
multiline_comment|/* CTS flow control flags */
multiline_comment|/* We encode read_status_mask and ignore_status_mask like so:&n;&t; *&n;&t; * ---------------------&n;&t; * | ... | ISR1 | ISR0 |&n;&t; * ---------------------&n;&t; *  ..    15   8 7    0&n;&t; */
id|up-&gt;port.read_status_mask
op_assign
(paren
id|SAB82532_ISR0_TCD
op_or
id|SAB82532_ISR0_TIME
op_or
id|SAB82532_ISR0_RFO
op_or
id|SAB82532_ISR0_RPF
op_or
id|SAB82532_ISR0_CDSC
)paren
suffix:semicolon
id|up-&gt;port.read_status_mask
op_or_assign
(paren
id|SAB82532_ISR1_CSC
op_or
id|SAB82532_ISR1_ALLS
op_or
id|SAB82532_ISR1_XPR
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|INPCK
)paren
id|up-&gt;port.read_status_mask
op_or_assign
(paren
id|SAB82532_ISR0_PERR
op_or
id|SAB82532_ISR0_FERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
(paren
id|BRKINT
op_or
id|PARMRK
)paren
)paren
id|up-&gt;port.read_status_mask
op_or_assign
(paren
id|SAB82532_ISR1_BRK
op_lshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Characteres to ignore&n;&t; */
id|up-&gt;port.ignore_status_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNPAR
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
(paren
id|SAB82532_ISR0_PERR
op_or
id|SAB82532_ISR0_FERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNBRK
)paren
(brace
id|up-&gt;port.ignore_status_mask
op_or_assign
(paren
id|SAB82532_ISR1_BRK
op_lshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we&squot;re ignoring parity and break indicators,&n;&t;&t; * ignore overruns too (for real raw support).&n;&t;&t; */
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNPAR
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
id|SAB82532_ISR0_RFO
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * ignore all characters if CREAD is not set&n;&t; */
r_if
c_cond
(paren
(paren
id|cflag
op_amp
id|CREAD
)paren
op_eq
l_int|0
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
(paren
id|SAB82532_ISR0_RPF
op_or
id|SAB82532_ISR0_TCD
)paren
suffix:semicolon
multiline_comment|/* Now bang the new settings into the chip.  */
id|sunsab_cec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|sunsab_tec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|dafo
comma
op_amp
id|up-&gt;regs-&gt;w.dafo
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|ebrg
op_amp
l_int|0xff
comma
op_amp
id|up-&gt;regs-&gt;w.bgr
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.ccr2
)paren
op_amp
op_complement
l_int|0xc0
)paren
op_or
(paren
(paren
id|ebrg
op_rshift
l_int|2
)paren
op_amp
l_int|0xc0
)paren
comma
op_amp
id|up-&gt;regs-&gt;rw.ccr2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CRTSCTS
)paren
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_amp
op_complement
id|SAB82532_MODE_RTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_FRTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_amp
op_complement
id|SAB82532_MODE_FCTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|up-&gt;interrupt_mask1
op_and_assign
op_complement
id|SAB82532_IMR1_CSC
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
)brace
r_else
(brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_RTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_amp
op_complement
id|SAB82532_MODE_FRTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_FCTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|up-&gt;interrupt_mask1
op_or_assign
id|SAB82532_IMR1_CSC
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_RAC
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
)brace
multiline_comment|/* port-&gt;lock is not held.  */
DECL|function|sunsab_set_termios
r_static
r_void
id|sunsab_set_termios
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_sunsab_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|baud
op_assign
id|uart_get_baud_rate
c_func
(paren
id|port
comma
id|termios
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|sunsab_convert_to_sab
c_func
(paren
id|up
comma
id|termios-&gt;c_cflag
comma
id|termios-&gt;c_iflag
comma
id|baud
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sunsab_type
r_static
r_const
r_char
op_star
id|sunsab_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_string|&quot;SunSAB&quot;
suffix:semicolon
)brace
DECL|function|sunsab_release_port
r_static
r_void
id|sunsab_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
DECL|function|sunsab_request_port
r_static
r_int
id|sunsab_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sunsab_config_port
r_static
r_void
id|sunsab_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|flags
)paren
(brace
)brace
DECL|function|sunsab_verify_port
r_static
r_int
id|sunsab_verify_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|ser
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|sunsab_pops
r_static
r_struct
id|uart_ops
id|sunsab_pops
op_assign
(brace
dot
id|tx_empty
op_assign
id|sunsab_tx_empty
comma
dot
id|set_mctrl
op_assign
id|sunsab_set_mctrl
comma
dot
id|get_mctrl
op_assign
id|sunsab_get_mctrl
comma
dot
id|stop_tx
op_assign
id|sunsab_stop_tx
comma
dot
id|start_tx
op_assign
id|sunsab_start_tx
comma
dot
id|send_xchar
op_assign
id|sunsab_send_xchar
comma
dot
id|stop_rx
op_assign
id|sunsab_stop_rx
comma
dot
id|enable_ms
op_assign
id|sunsab_enable_ms
comma
dot
id|break_ctl
op_assign
id|sunsab_break_ctl
comma
dot
id|startup
op_assign
id|sunsab_startup
comma
dot
id|shutdown
op_assign
id|sunsab_shutdown
comma
dot
id|set_termios
op_assign
id|sunsab_set_termios
comma
dot
id|type
op_assign
id|sunsab_type
comma
dot
id|release_port
op_assign
id|sunsab_release_port
comma
dot
id|request_port
op_assign
id|sunsab_request_port
comma
dot
id|config_port
op_assign
id|sunsab_config_port
comma
dot
id|verify_port
op_assign
id|sunsab_verify_port
comma
)brace
suffix:semicolon
DECL|variable|sunsab_reg
r_static
r_struct
id|uart_driver
id|sunsab_reg
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
l_string|&quot;serial&quot;
comma
macro_line|#ifdef CONFIG_DEVFS_FS
dot
id|dev_name
op_assign
l_string|&quot;tts/%d&quot;
comma
macro_line|#else
dot
id|dev_name
op_assign
l_string|&quot;ttyS%d&quot;
comma
macro_line|#endif
dot
id|major
op_assign
id|TTY_MAJOR
comma
)brace
suffix:semicolon
DECL|variable|sunsab_ports
r_static
r_struct
id|uart_sunsab_port
op_star
id|sunsab_ports
suffix:semicolon
DECL|variable|num_channels
r_static
r_int
id|num_channels
suffix:semicolon
DECL|function|sunsab_console_putchar
r_static
id|__inline__
r_void
id|sunsab_console_putchar
c_func
(paren
r_struct
id|uart_sunsab_port
op_star
id|up
comma
r_char
id|c
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|sunsab_tec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|c
comma
op_amp
id|up-&gt;regs-&gt;w.tic
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sunsab_console_write
r_static
r_void
id|sunsab_console_write
c_func
(paren
r_struct
id|console
op_star
id|con
comma
r_const
r_char
op_star
id|s
comma
r_int
id|n
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|con-&gt;index
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|sunsab_console_putchar
c_func
(paren
id|up
comma
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|sunsab_console_putchar
c_func
(paren
id|up
comma
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
id|sunsab_tec_wait
c_func
(paren
id|up
)paren
suffix:semicolon
)brace
DECL|function|sunsab_console_device
r_static
id|kdev_t
id|sunsab_console_device
c_func
(paren
r_struct
id|console
op_star
id|con
)paren
(brace
r_return
id|mk_kdev
c_func
(paren
id|sunsab_reg.major
comma
id|sunsab_reg.minor
op_plus
id|con-&gt;index
)paren
suffix:semicolon
)brace
DECL|function|sunsab_console_setup
r_static
r_int
id|sunsab_console_setup
c_func
(paren
r_struct
id|console
op_star
id|con
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|con-&gt;index
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|baud
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Console: ttyS%d (SAB82532)&bslash;n&quot;
comma
(paren
id|sunsab_reg.minor
op_minus
l_int|64
)paren
op_plus
id|con-&gt;index
)paren
suffix:semicolon
id|sunserial_console_termios
c_func
(paren
id|con
)paren
suffix:semicolon
multiline_comment|/* Firmware console speed is limited to 150--&gt;38400 baud so&n;&t; * this hackish cflag thing is OK.&n;&t; */
r_switch
c_cond
(paren
id|con-&gt;cflag
op_amp
id|CBAUD
)paren
(brace
r_case
id|B150
suffix:colon
id|baud
op_assign
l_int|150
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B300
suffix:colon
id|baud
op_assign
l_int|300
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B600
suffix:colon
id|baud
op_assign
l_int|600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B1200
suffix:colon
id|baud
op_assign
l_int|1200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B2400
suffix:colon
id|baud
op_assign
l_int|2400
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B4800
suffix:colon
id|baud
op_assign
l_int|4800
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|B9600
suffix:colon
id|baud
op_assign
l_int|9600
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B19200
suffix:colon
id|baud
op_assign
l_int|19200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B38400
suffix:colon
id|baud
op_assign
l_int|38400
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n;&t; * Temporary fix.&n;&t; */
id|spin_lock_init
c_func
(paren
op_amp
id|up-&gt;port.lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialize the hardware&n;&t; */
id|sunsab_startup
c_func
(paren
op_amp
id|up-&gt;port
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Finally, enable interrupts&n;&t; */
id|up-&gt;interrupt_mask0
op_assign
id|SAB82532_IMR0_PERR
op_or
id|SAB82532_IMR0_FERR
op_or
id|SAB82532_IMR0_PLLA
op_or
id|SAB82532_IMR0_CDSC
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask0
comma
op_amp
id|up-&gt;regs-&gt;w.imr0
)paren
suffix:semicolon
id|up-&gt;interrupt_mask1
op_assign
id|SAB82532_IMR1_BRKT
op_or
id|SAB82532_IMR1_ALLS
op_or
id|SAB82532_IMR1_XOFF
op_or
id|SAB82532_IMR1_TIN
op_or
id|SAB82532_IMR1_CSC
op_or
id|SAB82532_IMR1_XON
op_or
id|SAB82532_IMR1_XPR
suffix:semicolon
id|writeb
c_func
(paren
id|up-&gt;interrupt_mask1
comma
op_amp
id|up-&gt;regs-&gt;w.imr1
)paren
suffix:semicolon
id|sunsab_convert_to_sab
c_func
(paren
id|up
comma
id|con-&gt;cflag
comma
l_int|0
comma
id|baud
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sunsab_console
r_static
r_struct
id|console
id|sunsab_console
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ttyS&quot;
comma
dot
id|write
op_assign
id|sunsab_console_write
comma
dot
id|device
op_assign
id|sunsab_console_device
comma
dot
id|setup
op_assign
id|sunsab_console_setup
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|sunsab_console_init
r_static
r_void
id|__init
id|sunsab_console_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|con_is_present
c_func
(paren
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|this_minor
op_assign
id|sunsab_reg.minor
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|this_minor
op_minus
l_int|64
)paren
op_eq
(paren
id|serial_console
op_minus
l_int|1
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|num_channels
)paren
r_return
suffix:semicolon
id|sunsab_console.index
op_assign
id|i
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|sunsab_console
)paren
suffix:semicolon
)brace
DECL|function|for_each_sab_edev
r_static
r_void
id|__init
id|for_each_sab_edev
c_func
(paren
r_void
(paren
op_star
id|callback
)paren
(paren
r_struct
id|linux_ebus_device
op_star
comma
r_void
op_star
)paren
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|linux_ebus
op_star
id|ebus
suffix:semicolon
r_struct
id|linux_ebus_device
op_star
id|edev
op_assign
l_int|NULL
suffix:semicolon
id|for_each_ebus
c_func
(paren
id|ebus
)paren
(brace
id|for_each_ebusdev
c_func
(paren
id|edev
comma
id|ebus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;se&quot;
)paren
)paren
(brace
id|callback
c_func
(paren
id|edev
comma
id|arg
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;serial&quot;
)paren
)paren
(brace
r_char
id|compat
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|clen
suffix:semicolon
multiline_comment|/* On RIO this can be an SE, check it.  We could&n;&t;&t;&t;&t; * just check ebus-&gt;is_rio, but this is more portable.&n;&t;&t;&t;&t; */
id|clen
op_assign
id|prom_getproperty
c_func
(paren
id|edev-&gt;prom_node
comma
l_string|&quot;compatible&quot;
comma
id|compat
comma
r_sizeof
(paren
id|compat
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clen
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|compat
comma
l_string|&quot;sab82532&quot;
comma
l_int|8
)paren
op_eq
l_int|0
)paren
(brace
id|callback
c_func
(paren
id|edev
comma
id|arg
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
)brace
DECL|function|sab_count_callback
r_static
r_void
id|__init
id|sab_count_callback
c_func
(paren
r_struct
id|linux_ebus_device
op_star
id|edev
comma
r_void
op_star
id|arg
)paren
(brace
r_int
op_star
id|count_p
op_assign
id|arg
suffix:semicolon
(paren
op_star
id|count_p
)paren
op_increment
suffix:semicolon
)brace
DECL|function|sab_attach_callback
r_static
r_void
id|__init
id|sab_attach_callback
c_func
(paren
r_struct
id|linux_ebus_device
op_star
id|edev
comma
r_void
op_star
id|arg
)paren
(brace
r_int
op_star
id|instance_p
op_assign
id|arg
suffix:semicolon
r_struct
id|uart_sunsab_port
op_star
id|up
suffix:semicolon
r_int
r_int
id|regs
comma
id|offset
suffix:semicolon
r_int
id|i
suffix:semicolon
id|regs
op_assign
id|edev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
id|offset
op_assign
r_sizeof
(paren
r_union
id|sab82532_async_regs
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|up
op_assign
op_amp
id|sunsab_ports
(braket
(paren
op_star
id|instance_p
op_star
l_int|2
)paren
op_plus
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
id|up
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|up
)paren
)paren
suffix:semicolon
id|up-&gt;regs
op_assign
id|ioremap
c_func
(paren
id|regs
op_plus
id|offset
comma
r_sizeof
(paren
r_union
id|sab82532_async_regs
)paren
)paren
suffix:semicolon
id|up-&gt;irq
op_assign
id|edev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|up-&gt;sab_line
op_assign
l_int|1
op_minus
id|i
suffix:semicolon
id|up-&gt;xmit_fifo_size
op_assign
l_int|32
suffix:semicolon
id|up-&gt;recv_fifo_size
op_assign
l_int|32
suffix:semicolon
id|writeb
c_func
(paren
id|SAB82532_IPC_IC_ACT_LOW
comma
op_amp
id|up-&gt;regs-&gt;w.ipc
)paren
suffix:semicolon
id|offset
op_sub_assign
r_sizeof
(paren
r_union
id|sab82532_async_regs
)paren
suffix:semicolon
)brace
)brace
DECL|function|probe_for_sabs
r_static
r_int
id|__init
id|probe_for_sabs
c_func
(paren
r_void
)paren
(brace
r_int
id|this_sab
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Find device instances.  */
id|for_each_sab_edev
c_func
(paren
op_amp
id|sab_count_callback
comma
op_amp
id|this_sab
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|this_sab
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Allocate tables.  */
id|sunsab_ports
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|uart_sunsab_port
)paren
op_star
id|this_sab
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sunsab_ports
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|num_channels
op_assign
id|this_sab
op_star
l_int|2
suffix:semicolon
id|this_sab
op_assign
l_int|0
suffix:semicolon
id|for_each_sab_edev
c_func
(paren
op_amp
id|sab_attach_callback
comma
op_amp
id|this_sab
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sunsab_init_hw
r_static
r_void
id|__init
id|sunsab_init_hw
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|i
)braket
suffix:semicolon
id|up-&gt;port.line
op_assign
id|i
suffix:semicolon
id|up-&gt;port.ops
op_assign
op_amp
id|sunsab_pops
suffix:semicolon
id|up-&gt;port.type
op_assign
id|PORT_SUNSAB
suffix:semicolon
id|up-&gt;port.uartclk
op_assign
id|SAB_BASE_BAUD
suffix:semicolon
id|up-&gt;type
op_assign
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;r.vstr
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|writeb
c_func
(paren
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|1
)paren
op_or
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|4
)paren
)paren
comma
op_amp
id|up-&gt;regs-&gt;w.pcr
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0xff
comma
op_amp
id|up-&gt;regs-&gt;w.pim
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;sab_line
op_eq
l_int|0
)paren
(brace
id|up-&gt;pvr_dsr_bit
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
suffix:semicolon
id|up-&gt;pvr_dtr_bit
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|up-&gt;pvr_dsr_bit
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
suffix:semicolon
id|up-&gt;pvr_dtr_bit
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
(paren
l_int|1
op_lshift
l_int|1
)paren
op_or
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
op_amp
id|up-&gt;regs-&gt;w.pvr
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_FRTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|readb
c_func
(paren
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
op_or
id|SAB82532_MODE_RTS
comma
op_amp
id|up-&gt;regs-&gt;rw.mode
)paren
suffix:semicolon
id|up-&gt;tec_timeout
op_assign
id|SAB82532_MAX_TEC_TIMEOUT
suffix:semicolon
id|up-&gt;cec_timeout
op_assign
id|SAB82532_MAX_CEC_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|up-&gt;sab_line
op_amp
l_int|0x01
)paren
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|up-&gt;irq
comma
id|sunsab_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;serial(sab82532)&quot;
comma
id|up
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sunsab%d: can&squot;t get IRQ %x&bslash;n&quot;
comma
id|i
comma
id|up-&gt;irq
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sunsab%d at 0x%lx (irq = %s) is a SAB82532 %s&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|up-&gt;regs
comma
id|__irq_itoa
c_func
(paren
id|up-&gt;irq
)paren
comma
id|sab82532_version
(braket
id|up-&gt;type
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|sunsab_init
r_static
r_int
id|__init
id|sunsab_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
id|probe_for_sabs
c_func
(paren
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|sunsab_init_hw
c_func
(paren
)paren
suffix:semicolon
id|sunsab_reg.minor
op_assign
id|sunserial_current_minor
suffix:semicolon
id|sunserial_current_minor
op_add_assign
id|num_channels
suffix:semicolon
id|sunsab_reg.nr
op_assign
id|num_channels
suffix:semicolon
id|sunsab_reg.cons
op_assign
op_amp
id|sunsab_console
suffix:semicolon
id|ret
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|sunsab_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|up-&gt;sab_line
op_amp
l_int|0x01
)paren
)paren
id|free_irq
c_func
(paren
id|up-&gt;irq
comma
id|up
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|up-&gt;regs
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|sunsab_ports
)paren
suffix:semicolon
id|sunsab_ports
op_assign
l_int|NULL
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|i
)braket
suffix:semicolon
id|uart_add_one_port
c_func
(paren
op_amp
id|sunsab_reg
comma
op_amp
id|up-&gt;port
)paren
suffix:semicolon
)brace
id|sunsab_console_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sunsab_exit
r_static
r_void
id|__exit
id|sunsab_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|uart_sunsab_port
op_star
id|up
op_assign
op_amp
id|sunsab_ports
(braket
id|i
)braket
suffix:semicolon
id|uart_remove_one_port
c_func
(paren
op_amp
id|sunsab_reg
comma
op_amp
id|up-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|up-&gt;sab_line
op_amp
l_int|0x01
)paren
)paren
id|free_irq
c_func
(paren
id|up-&gt;irq
comma
id|up
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|up-&gt;regs
)paren
suffix:semicolon
)brace
id|uart_unregister_driver
c_func
(paren
op_amp
id|sunsab_reg
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sunsab_ports
)paren
suffix:semicolon
id|sunsab_ports
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|sunsab_init
id|module_init
c_func
(paren
id|sunsab_init
)paren
suffix:semicolon
DECL|variable|sunsab_exit
id|module_exit
c_func
(paren
id|sunsab_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Eddie C. Dost and David S. Miller&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Sun SAB82532 serial port driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
