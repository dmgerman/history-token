multiline_comment|/*&n; *  linux/drivers/serial/pxa.c&n; *&n; *  Based on drivers/serial/8250.c by Russell King.&n; *&n; *  Author:&t;Nicolas Pitre&n; *  Created:&t;Feb 20, 2003&n; *  Copyright:&t;(C) 2003 Monta Vista Software, Inc.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * Note 1: This driver is made separate from the already too overloaded&n; * 8250.c because it needs some kirks of its own and that&squot;ll make it&n; * easier to add DMA support.&n; *&n; * Note 2: I&squot;m too sick of device allocation policies for serial ports.&n; * If someone else wants to request an &quot;official&quot; allocation of major/minor&n; * for this driver please be my guest.  And don&squot;t forget that new hardware&n; * to come from Intel might have more than 3 or 4 of those UARTs.  Let&squot;s&n; * hope for a better port registration and dynamic device allocation scheme&n; * with the serial core maintainer satisfaction to appear soon.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#if defined(CONFIG_SERIAL_PXA_CONSOLE) &amp;&amp; defined(CONFIG_MAGIC_SYSRQ)
DECL|macro|SUPPORT_SYSRQ
mdefine_line|#define SUPPORT_SYSRQ
macro_line|#endif
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/sysrq.h&gt;
macro_line|#include &lt;linux/serial_reg.h&gt;
macro_line|#include &lt;linux/circ_buf.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/arch/pxa-regs.h&gt;
DECL|struct|uart_pxa_port
r_struct
id|uart_pxa_port
(brace
DECL|member|port
r_struct
id|uart_port
id|port
suffix:semicolon
DECL|member|ier
r_int
r_char
id|ier
suffix:semicolon
DECL|member|lcr
r_int
r_char
id|lcr
suffix:semicolon
DECL|member|mcr
r_int
r_char
id|mcr
suffix:semicolon
DECL|member|lsr_break_flag
r_int
r_int
id|lsr_break_flag
suffix:semicolon
DECL|member|cken
r_int
r_int
id|cken
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
)brace
suffix:semicolon
DECL|function|serial_in
r_static
r_inline
r_int
r_int
id|serial_in
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
comma
r_int
id|offset
)paren
(brace
id|offset
op_lshift_assign
l_int|2
suffix:semicolon
r_return
id|readl
c_func
(paren
id|up-&gt;port.membase
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|serial_out
r_static
r_inline
r_void
id|serial_out
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
comma
r_int
id|offset
comma
r_int
id|value
)paren
(brace
id|offset
op_lshift_assign
l_int|2
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|up-&gt;port.membase
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|serial_pxa_enable_ms
r_static
r_void
id|serial_pxa_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
id|up-&gt;ier
op_or_assign
id|UART_IER_MSI
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
)brace
DECL|function|serial_pxa_stop_tx
r_static
r_void
id|serial_pxa_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_stop
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;ier
op_amp
id|UART_IER_THRI
)paren
(brace
id|up-&gt;ier
op_and_assign
op_complement
id|UART_IER_THRI
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
)brace
)brace
DECL|function|serial_pxa_stop_rx
r_static
r_void
id|serial_pxa_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
id|up-&gt;ier
op_and_assign
op_complement
id|UART_IER_RLSI
suffix:semicolon
id|up-&gt;port.read_status_mask
op_and_assign
op_complement
id|UART_LSR_DR
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|receive_chars
id|receive_chars
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
comma
r_int
op_star
id|status
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|up-&gt;port.info-&gt;tty
suffix:semicolon
r_int
r_int
id|ch
comma
id|flag
suffix:semicolon
r_int
id|max_count
op_assign
l_int|256
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;low_latency
)paren
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * If this failed then we will throw away the&n;&t;&t;&t; * bytes but must do so to clear interrupts&n;&t;&t;&t; */
)brace
id|ch
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_RX
)paren
suffix:semicolon
id|flag
op_assign
id|TTY_NORMAL
suffix:semicolon
id|up-&gt;port.icount.rx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_star
id|status
op_amp
(paren
id|UART_LSR_BI
op_or
id|UART_LSR_PE
op_or
id|UART_LSR_FE
op_or
id|UART_LSR_OE
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * For statistics only&n;&t;&t;&t; */
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_BI
)paren
(brace
op_star
id|status
op_and_assign
op_complement
(paren
id|UART_LSR_FE
op_or
id|UART_LSR_PE
)paren
suffix:semicolon
id|up-&gt;port.icount.brk
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * We do the SysRQ and SAK checking&n;&t;&t;&t;&t; * here because otherwise the break&n;&t;&t;&t;&t; * may get masked by ignore_status_mask&n;&t;&t;&t;&t; * or read_status_mask.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|uart_handle_break
c_func
(paren
op_amp
id|up-&gt;port
)paren
)paren
r_goto
id|ignore_char
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_PE
)paren
id|up-&gt;port.icount.parity
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_FE
)paren
id|up-&gt;port.icount.frame
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_OE
)paren
id|up-&gt;port.icount.overrun
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Mask off conditions which should be ignored.&n;&t;&t;&t; */
op_star
id|status
op_and_assign
id|up-&gt;port.read_status_mask
suffix:semicolon
macro_line|#ifdef CONFIG_SERIAL_PXA_CONSOLE
r_if
c_cond
(paren
id|up-&gt;port.line
op_eq
id|up-&gt;port.cons-&gt;index
)paren
(brace
multiline_comment|/* Recover the break flag from console xmit */
op_star
id|status
op_or_assign
id|up-&gt;lsr_break_flag
suffix:semicolon
id|up-&gt;lsr_break_flag
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_BI
)paren
(brace
id|flag
op_assign
id|TTY_BREAK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_PE
)paren
id|flag
op_assign
id|TTY_PARITY
suffix:semicolon
r_else
r_if
c_cond
(paren
op_star
id|status
op_amp
id|UART_LSR_FE
)paren
id|flag
op_assign
id|TTY_FRAME
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_handle_sysrq_char
c_func
(paren
op_amp
id|up-&gt;port
comma
id|ch
comma
id|regs
)paren
)paren
r_goto
id|ignore_char
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|status
op_amp
id|up-&gt;port.ignore_status_mask
)paren
op_eq
l_int|0
)paren
(brace
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
id|ch
comma
id|flag
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
id|status
op_amp
id|UART_LSR_OE
)paren
op_logical_and
id|tty-&gt;flip.count
OL
id|TTY_FLIPBUF_SIZE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Overrun is special, since it&squot;s reported&n;&t;&t;&t; * immediately, and doesn&squot;t affect the current&n;&t;&t;&t; * character.&n;&t;&t;&t; */
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
l_int|0
comma
id|TTY_OVERRUN
)paren
suffix:semicolon
)brace
id|ignore_char
suffix:colon
op_star
id|status
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
op_star
id|status
op_amp
id|UART_LSR_DR
)paren
op_logical_and
(paren
id|max_count
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|transmit_chars
r_static
r_void
id|transmit_chars
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
)paren
(brace
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|up-&gt;port.info-&gt;xmit
suffix:semicolon
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;port.x_char
)paren
(brace
id|serial_out
c_func
(paren
id|up
comma
id|UART_TX
comma
id|up-&gt;port.x_char
)paren
suffix:semicolon
id|up-&gt;port.icount.tx
op_increment
suffix:semicolon
id|up-&gt;port.x_char
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
op_logical_or
id|uart_tx_stopped
c_func
(paren
op_amp
id|up-&gt;port
)paren
)paren
(brace
id|serial_pxa_stop_tx
c_func
(paren
op_amp
id|up-&gt;port
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|count
op_assign
id|up-&gt;port.fifosize
op_div
l_int|2
suffix:semicolon
r_do
(brace
id|serial_out
c_func
(paren
id|up
comma
id|UART_TX
comma
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
)paren
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
l_int|1
)paren
op_amp
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|up-&gt;port.icount.tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
OL
id|WAKEUP_CHARS
)paren
id|uart_write_wakeup
c_func
(paren
op_amp
id|up-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
id|serial_pxa_stop_tx
c_func
(paren
op_amp
id|up-&gt;port
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|serial_pxa_start_tx
r_static
r_void
id|serial_pxa_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_start
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|up-&gt;ier
op_amp
id|UART_IER_THRI
)paren
)paren
(brace
id|up-&gt;ier
op_or_assign
id|UART_IER_THRI
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
)brace
)brace
DECL|function|check_modem_status
r_static
r_inline
r_void
id|check_modem_status
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_MSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|UART_MSR_ANY_DELTA
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_TERI
)paren
id|up-&gt;port.icount.rng
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_DDSR
)paren
id|up-&gt;port.icount.dsr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_DDCD
)paren
id|uart_handle_dcd_change
c_func
(paren
op_amp
id|up-&gt;port
comma
id|status
op_amp
id|UART_MSR_DCD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_DCTS
)paren
id|uart_handle_cts_change
c_func
(paren
op_amp
id|up-&gt;port
comma
id|status
op_amp
id|UART_MSR_CTS
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|up-&gt;port.info-&gt;delta_msr_wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This handles the interrupt from one port.&n; */
r_static
r_inline
id|irqreturn_t
DECL|function|serial_pxa_irq
id|serial_pxa_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|iir
comma
id|lsr
suffix:semicolon
id|iir
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_IIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iir
op_amp
id|UART_IIR_NO_INT
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|lsr
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lsr
op_amp
id|UART_LSR_DR
)paren
id|receive_chars
c_func
(paren
id|up
comma
op_amp
id|lsr
comma
id|regs
)paren
suffix:semicolon
id|check_modem_status
c_func
(paren
id|up
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lsr
op_amp
id|UART_LSR_THRE
)paren
id|transmit_chars
c_func
(paren
id|up
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|serial_pxa_tx_empty
r_static
r_int
r_int
id|serial_pxa_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
op_amp
id|UART_LSR_TEMT
ques
c_cond
id|TIOCSER_TEMT
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|serial_pxa_get_mctrl
r_static
r_int
r_int
id|serial_pxa_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
r_int
r_int
id|ret
suffix:semicolon
r_return
id|TIOCM_CTS
op_or
id|TIOCM_DSR
op_or
id|TIOCM_CAR
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|status
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_MSR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_DCD
)paren
id|ret
op_or_assign
id|TIOCM_CAR
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_RI
)paren
id|ret
op_or_assign
id|TIOCM_RNG
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_DSR
)paren
id|ret
op_or_assign
id|TIOCM_DSR
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_MSR_CTS
)paren
id|ret
op_or_assign
id|TIOCM_CTS
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|serial_pxa_set_mctrl
r_static
r_void
id|serial_pxa_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|mctrl
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_char
id|mcr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_RTS
)paren
id|mcr
op_or_assign
id|UART_MCR_RTS
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_DTR
)paren
id|mcr
op_or_assign
id|UART_MCR_DTR
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_OUT1
)paren
id|mcr
op_or_assign
id|UART_MCR_OUT1
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_OUT2
)paren
id|mcr
op_or_assign
id|UART_MCR_OUT2
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_LOOP
)paren
id|mcr
op_or_assign
id|UART_MCR_LOOP
suffix:semicolon
id|mcr
op_or_assign
id|up-&gt;mcr
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_MCR
comma
id|mcr
)paren
suffix:semicolon
)brace
DECL|function|serial_pxa_break_ctl
r_static
r_void
id|serial_pxa_break_ctl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|break_state
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|break_state
op_eq
op_minus
l_int|1
)paren
id|up-&gt;lcr
op_or_assign
id|UART_LCR_SBC
suffix:semicolon
r_else
id|up-&gt;lcr
op_and_assign
op_complement
id|UART_LCR_SBC
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_LCR
comma
id|up-&gt;lcr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|serial_pxa_dma_init
c_func
(paren
r_struct
id|pxa_uart
op_star
id|up
)paren
(brace
id|up-&gt;rxdma
op_assign
id|pxa_request_dma
c_func
(paren
id|up-&gt;name
comma
id|DMA_PRIO_LOW
comma
id|pxa_receive_dma
comma
id|up
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;rxdma
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|up-&gt;txdma
op_assign
id|pxa_request_dma
c_func
(paren
id|up-&gt;name
comma
id|DMA_PRIO_LOW
comma
id|pxa_transmit_dma
comma
id|up
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up-&gt;txdma
OL
l_int|0
)paren
r_goto
id|err_txdma
suffix:semicolon
id|up-&gt;dmadesc
op_assign
id|kmalloc
c_func
(paren
l_int|4
op_star
r_sizeof
(paren
id|pxa_dma_desc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|up-&gt;dmadesc
)paren
r_goto
id|err_alloc
suffix:semicolon
multiline_comment|/* ... */
id|err_alloc
suffix:colon
id|pxa_free_dma
c_func
(paren
id|up-&gt;txdma
)paren
suffix:semicolon
id|err_rxdma
suffix:colon
id|pxa_free_dma
c_func
(paren
id|up-&gt;rxdma
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
macro_line|#endif
DECL|function|serial_pxa_startup
r_static
r_int
id|serial_pxa_startup
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|up-&gt;mcr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Allocate the IRQ&n;&t; */
id|retval
op_assign
id|request_irq
c_func
(paren
id|up-&gt;port.irq
comma
id|serial_pxa_irq
comma
l_int|0
comma
id|up-&gt;name
comma
id|up
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the FIFO buffers and disable them.&n;&t; * (they will be reenabled in set_termios())&n;&t; */
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
id|UART_FCR_ENABLE_FIFO
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_CLEAR_RCVR
op_or
id|UART_FCR_CLEAR_XMIT
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear the interrupt registers.&n;&t; */
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_RX
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_IIR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_MSR
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now, initialize the UART&n;&t; */
id|serial_out
c_func
(paren
id|up
comma
id|UART_LCR
comma
id|UART_LCR_WLEN8
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|up-&gt;port.mctrl
op_or_assign
id|TIOCM_OUT2
suffix:semicolon
id|serial_pxa_set_mctrl
c_func
(paren
op_amp
id|up-&gt;port
comma
id|up-&gt;port.mctrl
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Finally, enable interrupts.  Note: Modem status interrupts&n;&t; * are set via set_termios(), which will be occuring imminently&n;&t; * anyway, so we don&squot;t enable them here.&n;&t; */
id|up-&gt;ier
op_assign
id|UART_IER_RLSI
op_or
id|UART_IER_RDI
op_or
id|UART_IER_RTOIE
op_or
id|UART_IER_UUE
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * And clear the interrupt registers again for luck.&n;&t; */
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_RX
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_IIR
)paren
suffix:semicolon
(paren
r_void
)paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_MSR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|serial_pxa_shutdown
r_static
r_void
id|serial_pxa_shutdown
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|free_irq
c_func
(paren
id|up-&gt;port.irq
comma
id|up
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Disable interrupts from this port&n;&t; */
id|up-&gt;ier
op_assign
l_int|0
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|up-&gt;port.mctrl
op_and_assign
op_complement
id|TIOCM_OUT2
suffix:semicolon
id|serial_pxa_set_mctrl
c_func
(paren
op_amp
id|up-&gt;port
comma
id|up-&gt;port.mctrl
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Disable break condition and FIFOs&n;&t; */
id|serial_out
c_func
(paren
id|up
comma
id|UART_LCR
comma
id|serial_in
c_func
(paren
id|up
comma
id|UART_LCR
)paren
op_amp
op_complement
id|UART_LCR_SBC
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_CLEAR_RCVR
op_or
id|UART_FCR_CLEAR_XMIT
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|serial_pxa_set_termios
id|serial_pxa_set_termios
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_int
r_char
id|cval
comma
id|fcr
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|baud
comma
id|quot
suffix:semicolon
r_switch
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
id|cval
op_assign
l_int|0x00
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|cval
op_assign
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|cval
op_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|CS8
suffix:colon
id|cval
op_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSTOPB
)paren
id|cval
op_or_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARENB
)paren
id|cval
op_or_assign
id|UART_LCR_PARITY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|termios-&gt;c_cflag
op_amp
id|PARODD
)paren
)paren
id|cval
op_or_assign
id|UART_LCR_EPAR
suffix:semicolon
multiline_comment|/*&n;&t; * Ask the core to calculate the divisor for us.&n;&t; */
id|baud
op_assign
id|uart_get_baud_rate
c_func
(paren
id|port
comma
id|termios
comma
id|old
comma
l_int|0
comma
id|port-&gt;uartclk
op_div
l_int|16
)paren
suffix:semicolon
id|quot
op_assign
id|uart_get_divisor
c_func
(paren
id|port
comma
id|baud
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|up-&gt;port.uartclk
op_div
id|quot
)paren
OL
(paren
l_int|2400
op_star
l_int|16
)paren
)paren
id|fcr
op_assign
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_PXAR1
suffix:semicolon
r_else
id|fcr
op_assign
id|UART_FCR_ENABLE_FIFO
op_or
id|UART_FCR_PXAR8
suffix:semicolon
multiline_comment|/*&n;&t; * Ok, we&squot;re now changing the port state.  Do it with&n;&t; * interrupts disabled.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Ensure the port will be enabled.&n;&t; * This is required especially for serial console.&n;&t; */
id|up-&gt;ier
op_or_assign
id|IER_UUE
suffix:semicolon
multiline_comment|/*&n;&t; * Update the per-port timeout.&n;&t; */
id|uart_update_timeout
c_func
(paren
id|port
comma
id|termios-&gt;c_cflag
comma
id|quot
)paren
suffix:semicolon
id|up-&gt;port.read_status_mask
op_assign
id|UART_LSR_OE
op_or
id|UART_LSR_THRE
op_or
id|UART_LSR_DR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|INPCK
)paren
id|up-&gt;port.read_status_mask
op_or_assign
id|UART_LSR_FE
op_or
id|UART_LSR_PE
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
(paren
id|BRKINT
op_or
id|PARMRK
)paren
)paren
id|up-&gt;port.read_status_mask
op_or_assign
id|UART_LSR_BI
suffix:semicolon
multiline_comment|/*&n;&t; * Characters to ignore&n;&t; */
id|up-&gt;port.ignore_status_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNPAR
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
id|UART_LSR_PE
op_or
id|UART_LSR_FE
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNBRK
)paren
(brace
id|up-&gt;port.ignore_status_mask
op_or_assign
id|UART_LSR_BI
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we&squot;re ignoring parity and break indicators,&n;&t;&t; * ignore overruns too (for real raw support).&n;&t;&t; */
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNPAR
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
id|UART_LSR_OE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * ignore all characters if CREAD is not set&n;&t; */
r_if
c_cond
(paren
(paren
id|termios-&gt;c_cflag
op_amp
id|CREAD
)paren
op_eq
l_int|0
)paren
id|up-&gt;port.ignore_status_mask
op_or_assign
id|UART_LSR_DR
suffix:semicolon
multiline_comment|/*&n;&t; * CTS flow control flag and modem status interrupts&n;&t; */
id|up-&gt;ier
op_and_assign
op_complement
id|UART_IER_MSI
suffix:semicolon
r_if
c_cond
(paren
id|UART_ENABLE_MS
c_func
(paren
op_amp
id|up-&gt;port
comma
id|termios-&gt;c_cflag
)paren
)paren
id|up-&gt;ier
op_or_assign
id|UART_IER_MSI
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|up-&gt;ier
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_LCR
comma
id|cval
op_or
id|UART_LCR_DLAB
)paren
suffix:semicolon
multiline_comment|/* set DLAB */
id|serial_out
c_func
(paren
id|up
comma
id|UART_DLL
comma
id|quot
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* LS of divisor */
id|serial_out
c_func
(paren
id|up
comma
id|UART_DLM
comma
id|quot
op_rshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/* MS of divisor */
id|serial_out
c_func
(paren
id|up
comma
id|UART_LCR
comma
id|cval
)paren
suffix:semicolon
multiline_comment|/* reset DLAB */
id|up-&gt;lcr
op_assign
id|cval
suffix:semicolon
multiline_comment|/* Save LCR */
id|serial_pxa_set_mctrl
c_func
(paren
op_amp
id|up-&gt;port
comma
id|up-&gt;port.mctrl
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_FCR
comma
id|fcr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|up-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|serial_pxa_pm
id|serial_pxa_pm
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|state
comma
r_int
r_int
id|oldstate
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
id|pxa_set_cken
c_func
(paren
id|up-&gt;cken
comma
op_logical_neg
id|state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|serial_pxa_release_port
r_static
r_void
id|serial_pxa_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
DECL|function|serial_pxa_request_port
r_static
r_int
id|serial_pxa_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|serial_pxa_config_port
r_static
r_void
id|serial_pxa_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|flags
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
id|up-&gt;port.type
op_assign
id|PORT_PXA
suffix:semicolon
)brace
r_static
r_int
DECL|function|serial_pxa_verify_port
id|serial_pxa_verify_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|ser
)paren
(brace
multiline_comment|/* we don&squot;t want the core code to modify any port params */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_const
r_char
op_star
DECL|function|serial_pxa_type
id|serial_pxa_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
(paren
r_struct
id|uart_pxa_port
op_star
)paren
id|port
suffix:semicolon
r_return
id|up-&gt;name
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SERIAL_PXA_CONSOLE
r_extern
r_struct
id|uart_pxa_port
id|serial_pxa_ports
(braket
)braket
suffix:semicolon
r_extern
r_struct
id|uart_driver
id|serial_pxa_reg
suffix:semicolon
DECL|macro|BOTH_EMPTY
mdefine_line|#define BOTH_EMPTY (UART_LSR_TEMT | UART_LSR_THRE)
multiline_comment|/*&n; *&t;Wait for transmitter &amp; holding register to empty&n; */
DECL|function|wait_for_xmitr
r_static
r_inline
r_void
id|wait_for_xmitr
c_func
(paren
r_struct
id|uart_pxa_port
op_star
id|up
)paren
(brace
r_int
r_int
id|status
comma
id|tmout
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* Wait up to 10ms for the character(s) to be sent. */
r_do
(brace
id|status
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_LSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|UART_LSR_BI
)paren
id|up-&gt;lsr_break_flag
op_assign
id|UART_LSR_BI
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|tmout
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_amp
id|BOTH_EMPTY
)paren
op_ne
id|BOTH_EMPTY
)paren
suffix:semicolon
multiline_comment|/* Wait up to 1s for flow control if necessary */
r_if
c_cond
(paren
id|up-&gt;port.flags
op_amp
id|UPF_CONS_FLOW
)paren
(brace
id|tmout
op_assign
l_int|1000000
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|tmout
op_logical_and
(paren
(paren
id|serial_in
c_func
(paren
id|up
comma
id|UART_MSR
)paren
op_amp
id|UART_MSR_CTS
)paren
op_eq
l_int|0
)paren
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Print a string to the serial port trying not to disturb&n; * any possible real use of the port...&n; *&n; *&t;The console_lock must be held when we get here.&n; */
r_static
r_void
DECL|function|serial_pxa_console_write
id|serial_pxa_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
op_assign
op_amp
id|serial_pxa_ports
(braket
id|co-&gt;index
)braket
suffix:semicolon
r_int
r_int
id|ier
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; *&t;First save the UER then disable the interrupts&n;&t; */
id|ier
op_assign
id|serial_in
c_func
(paren
id|up
comma
id|UART_IER
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|UART_IER_UUE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now, do each character&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|s
op_increment
)paren
(brace
id|wait_for_xmitr
c_func
(paren
id|up
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Send the character out.&n;&t;&t; *&t;If a LF, also do CR...&n;&t;&t; */
id|serial_out
c_func
(paren
id|up
comma
id|UART_TX
comma
op_star
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|s
op_eq
l_int|10
)paren
(brace
id|wait_for_xmitr
c_func
(paren
id|up
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_TX
comma
l_int|13
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;Finally, wait for transmitter to become empty&n;&t; *&t;and restore the IER&n;&t; */
id|wait_for_xmitr
c_func
(paren
id|up
)paren
suffix:semicolon
id|serial_out
c_func
(paren
id|up
comma
id|UART_IER
comma
id|ier
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|serial_pxa_console_setup
id|serial_pxa_console_setup
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|up
suffix:semicolon
r_int
id|baud
op_assign
l_int|9600
suffix:semicolon
r_int
id|bits
op_assign
l_int|8
suffix:semicolon
r_int
id|parity
op_assign
l_char|&squot;n&squot;
suffix:semicolon
r_int
id|flow
op_assign
l_char|&squot;n&squot;
suffix:semicolon
r_if
c_cond
(paren
id|co-&gt;index
op_eq
op_minus
l_int|1
op_logical_or
id|co-&gt;index
op_ge
id|serial_pxa_reg.nr
)paren
id|co-&gt;index
op_assign
l_int|0
suffix:semicolon
id|up
op_assign
op_amp
id|serial_pxa_ports
(braket
id|co-&gt;index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|options
)paren
id|uart_parse_options
c_func
(paren
id|options
comma
op_amp
id|baud
comma
op_amp
id|parity
comma
op_amp
id|bits
comma
op_amp
id|flow
)paren
suffix:semicolon
r_return
id|uart_set_options
c_func
(paren
op_amp
id|up-&gt;port
comma
id|co
comma
id|baud
comma
id|parity
comma
id|bits
comma
id|flow
)paren
suffix:semicolon
)brace
DECL|variable|serial_pxa_console
r_static
r_struct
id|console
id|serial_pxa_console
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ttyS&quot;
comma
dot
id|write
op_assign
id|serial_pxa_console_write
comma
dot
id|device
op_assign
id|uart_console_device
comma
dot
id|setup
op_assign
id|serial_pxa_console_setup
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
op_minus
l_int|1
comma
dot
id|data
op_assign
op_amp
id|serial_pxa_reg
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|serial_pxa_console_init
id|serial_pxa_console_init
c_func
(paren
r_void
)paren
(brace
id|register_console
c_func
(paren
op_amp
id|serial_pxa_console
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|serial_pxa_console_init
id|console_initcall
c_func
(paren
id|serial_pxa_console_init
)paren
suffix:semicolon
DECL|macro|PXA_CONSOLE
mdefine_line|#define PXA_CONSOLE&t;&amp;serial_pxa_console
macro_line|#else
DECL|macro|PXA_CONSOLE
mdefine_line|#define PXA_CONSOLE&t;NULL
macro_line|#endif
DECL|variable|serial_pxa_pops
r_struct
id|uart_ops
id|serial_pxa_pops
op_assign
(brace
dot
id|tx_empty
op_assign
id|serial_pxa_tx_empty
comma
dot
id|set_mctrl
op_assign
id|serial_pxa_set_mctrl
comma
dot
id|get_mctrl
op_assign
id|serial_pxa_get_mctrl
comma
dot
id|stop_tx
op_assign
id|serial_pxa_stop_tx
comma
dot
id|start_tx
op_assign
id|serial_pxa_start_tx
comma
dot
id|stop_rx
op_assign
id|serial_pxa_stop_rx
comma
dot
id|enable_ms
op_assign
id|serial_pxa_enable_ms
comma
dot
id|break_ctl
op_assign
id|serial_pxa_break_ctl
comma
dot
id|startup
op_assign
id|serial_pxa_startup
comma
dot
id|shutdown
op_assign
id|serial_pxa_shutdown
comma
dot
id|set_termios
op_assign
id|serial_pxa_set_termios
comma
dot
id|pm
op_assign
id|serial_pxa_pm
comma
dot
id|type
op_assign
id|serial_pxa_type
comma
dot
id|release_port
op_assign
id|serial_pxa_release_port
comma
dot
id|request_port
op_assign
id|serial_pxa_request_port
comma
dot
id|config_port
op_assign
id|serial_pxa_config_port
comma
dot
id|verify_port
op_assign
id|serial_pxa_verify_port
comma
)brace
suffix:semicolon
DECL|variable|serial_pxa_ports
r_static
r_struct
id|uart_pxa_port
id|serial_pxa_ports
(braket
)braket
op_assign
(brace
(brace
multiline_comment|/* FFUART */
dot
id|name
op_assign
l_string|&quot;FFUART&quot;
comma
dot
id|cken
op_assign
id|CKEN6_FFUART
comma
dot
id|port
op_assign
(brace
dot
id|type
op_assign
id|PORT_PXA
comma
dot
id|iotype
op_assign
id|UPIO_MEM
comma
dot
id|membase
op_assign
(paren
r_void
op_star
)paren
op_amp
id|FFUART
comma
dot
id|mapbase
op_assign
id|__PREG
c_func
(paren
id|FFUART
)paren
comma
dot
id|irq
op_assign
id|IRQ_FFUART
comma
dot
id|uartclk
op_assign
l_int|921600
op_star
l_int|16
comma
dot
id|fifosize
op_assign
l_int|64
comma
dot
id|ops
op_assign
op_amp
id|serial_pxa_pops
comma
dot
id|line
op_assign
l_int|0
comma
)brace
comma
)brace
comma
(brace
multiline_comment|/* BTUART */
dot
id|name
op_assign
l_string|&quot;BTUART&quot;
comma
dot
id|cken
op_assign
id|CKEN7_BTUART
comma
dot
id|port
op_assign
(brace
dot
id|type
op_assign
id|PORT_PXA
comma
dot
id|iotype
op_assign
id|UPIO_MEM
comma
dot
id|membase
op_assign
(paren
r_void
op_star
)paren
op_amp
id|BTUART
comma
dot
id|mapbase
op_assign
id|__PREG
c_func
(paren
id|BTUART
)paren
comma
dot
id|irq
op_assign
id|IRQ_BTUART
comma
dot
id|uartclk
op_assign
l_int|921600
op_star
l_int|16
comma
dot
id|fifosize
op_assign
l_int|64
comma
dot
id|ops
op_assign
op_amp
id|serial_pxa_pops
comma
dot
id|line
op_assign
l_int|1
comma
)brace
comma
)brace
comma
(brace
multiline_comment|/* STUART */
dot
id|name
op_assign
l_string|&quot;STUART&quot;
comma
dot
id|cken
op_assign
id|CKEN5_STUART
comma
dot
id|port
op_assign
(brace
dot
id|type
op_assign
id|PORT_PXA
comma
dot
id|iotype
op_assign
id|UPIO_MEM
comma
dot
id|membase
op_assign
(paren
r_void
op_star
)paren
op_amp
id|STUART
comma
dot
id|mapbase
op_assign
id|__PREG
c_func
(paren
id|STUART
)paren
comma
dot
id|irq
op_assign
id|IRQ_STUART
comma
dot
id|uartclk
op_assign
l_int|921600
op_star
l_int|16
comma
dot
id|fifosize
op_assign
l_int|64
comma
dot
id|ops
op_assign
op_amp
id|serial_pxa_pops
comma
dot
id|line
op_assign
l_int|2
comma
)brace
comma
)brace
)brace
suffix:semicolon
DECL|variable|serial_pxa_reg
r_static
r_struct
id|uart_driver
id|serial_pxa_reg
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
l_string|&quot;PXA serial&quot;
comma
dot
id|devfs_name
op_assign
l_string|&quot;tts/&quot;
comma
dot
id|dev_name
op_assign
l_string|&quot;ttyS&quot;
comma
dot
id|major
op_assign
id|TTY_MAJOR
comma
dot
id|minor
op_assign
l_int|64
comma
dot
id|nr
op_assign
id|ARRAY_SIZE
c_func
(paren
id|serial_pxa_ports
)paren
comma
dot
id|cons
op_assign
id|PXA_CONSOLE
comma
)brace
suffix:semicolon
DECL|function|serial_pxa_suspend
r_static
r_int
id|serial_pxa_suspend
c_func
(paren
r_struct
id|device
op_star
id|_dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|sport
op_assign
id|dev_get_drvdata
c_func
(paren
id|_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sport
op_logical_and
id|level
op_eq
id|SUSPEND_DISABLE
)paren
id|uart_suspend_port
c_func
(paren
op_amp
id|serial_pxa_reg
comma
op_amp
id|sport-&gt;port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|serial_pxa_resume
r_static
r_int
id|serial_pxa_resume
c_func
(paren
r_struct
id|device
op_star
id|_dev
comma
id|u32
id|level
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|sport
op_assign
id|dev_get_drvdata
c_func
(paren
id|_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sport
op_logical_and
id|level
op_eq
id|RESUME_ENABLE
)paren
id|uart_resume_port
c_func
(paren
op_amp
id|serial_pxa_reg
comma
op_amp
id|sport-&gt;port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|serial_pxa_probe
r_static
r_int
id|serial_pxa_probe
c_func
(paren
r_struct
id|device
op_star
id|_dev
)paren
(brace
r_struct
id|platform_device
op_star
id|dev
op_assign
id|to_platform_device
c_func
(paren
id|_dev
)paren
suffix:semicolon
id|serial_pxa_ports
(braket
id|dev-&gt;id
)braket
dot
id|port.dev
op_assign
id|_dev
suffix:semicolon
id|uart_add_one_port
c_func
(paren
op_amp
id|serial_pxa_reg
comma
op_amp
id|serial_pxa_ports
(braket
id|dev-&gt;id
)braket
dot
id|port
)paren
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
id|_dev
comma
op_amp
id|serial_pxa_ports
(braket
id|dev-&gt;id
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|serial_pxa_remove
r_static
r_int
id|serial_pxa_remove
c_func
(paren
r_struct
id|device
op_star
id|_dev
)paren
(brace
r_struct
id|uart_pxa_port
op_star
id|sport
op_assign
id|dev_get_drvdata
c_func
(paren
id|_dev
)paren
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
id|_dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sport
)paren
id|uart_remove_one_port
c_func
(paren
op_amp
id|serial_pxa_reg
comma
op_amp
id|sport-&gt;port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|serial_pxa_driver
r_static
r_struct
id|device_driver
id|serial_pxa_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;pxa2xx-uart&quot;
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
dot
id|probe
op_assign
id|serial_pxa_probe
comma
dot
id|remove
op_assign
id|serial_pxa_remove
comma
dot
id|suspend
op_assign
id|serial_pxa_suspend
comma
dot
id|resume
op_assign
id|serial_pxa_resume
comma
)brace
suffix:semicolon
DECL|function|serial_pxa_init
r_int
id|__init
id|serial_pxa_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|serial_pxa_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|driver_register
c_func
(paren
op_amp
id|serial_pxa_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
id|uart_unregister_driver
c_func
(paren
op_amp
id|serial_pxa_reg
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|serial_pxa_exit
r_void
id|__exit
id|serial_pxa_exit
c_func
(paren
r_void
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|serial_pxa_driver
)paren
suffix:semicolon
id|uart_unregister_driver
c_func
(paren
op_amp
id|serial_pxa_reg
)paren
suffix:semicolon
)brace
DECL|variable|serial_pxa_init
id|module_init
c_func
(paren
id|serial_pxa_init
)paren
suffix:semicolon
DECL|variable|serial_pxa_exit
id|module_exit
c_func
(paren
id|serial_pxa_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
