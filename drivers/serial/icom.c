multiline_comment|/*&n;  * icom.c&n;  *&n;  * Copyright (C) 2001 IBM Corporation. All rights reserved.&n;  *&n;  * Serial device driver.&n;  *&n;  * Based on code from serial.c&n;  *&n;  * This program is free software; you can redistribute it and/or modify&n;  * it under the terms of the GNU General Public License as published by&n;  * the Free Software Foundation; either version 2 of the License, or&n;  * (at your option) any later version.&n;  *&n;  * This program is distributed in the hope that it will be useful,&n;  * but WITHOUT ANY WARRANTY; without even the implied warranty of&n;  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;  * GNU General Public License for more details.&n;  *&n;  * You should have received a copy of the GNU General Public License&n;  * along with this program; if not, write to the Free Software&n;  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n;  *&n;  */
DECL|macro|SERIAL_DO_RESTART
mdefine_line|#define SERIAL_DO_RESTART
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/serial_reg.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/kobject.h&gt;
macro_line|#include &lt;linux/firmware.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &quot;icom.h&quot;
multiline_comment|/*#define ICOM_TRACE&t;&t; enable port trace capabilities */
DECL|macro|ICOM_DRIVER_NAME
mdefine_line|#define ICOM_DRIVER_NAME &quot;icom&quot;
DECL|macro|ICOM_VERSION_STR
mdefine_line|#define ICOM_VERSION_STR &quot;1.3.1&quot;
DECL|macro|NR_PORTS
mdefine_line|#define NR_PORTS&t;       128
DECL|macro|ICOM_PORT
mdefine_line|#define ICOM_PORT ((struct icom_port *)port)
DECL|macro|to_icom_adapter
mdefine_line|#define to_icom_adapter(d) container_of(d, struct icom_adapter, kobj)
DECL|variable|icom_pci_table
r_static
r_const
r_struct
id|pci_device_id
id|icom_pci_table
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_DEV_ID_1
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|ADAPTER_V1
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_DEV_ID_2
comma
dot
id|subvendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|subdevice
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_V2_TWO_PORTS_RVX
comma
dot
id|driver_data
op_assign
id|ADAPTER_V2
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_DEV_ID_2
comma
dot
id|subvendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|subdevice
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_V2_ONE_PORT_RVX_ONE_PORT_MDM
comma
dot
id|driver_data
op_assign
id|ADAPTER_V2
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_DEV_ID_2
comma
dot
id|subvendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|subdevice
op_assign
id|PCI_DEVICE_ID_IBM_ICOM_FOUR_PORT_MODEL
comma
dot
id|driver_data
op_assign
id|ADAPTER_V2
comma
)brace
comma
(brace
)brace
)brace
suffix:semicolon
DECL|variable|start_proc
r_struct
id|lookup_proc_table
id|start_proc
(braket
l_int|4
)braket
op_assign
(brace
(brace
l_int|0
comma
id|ICOM_CONTROL_START_A
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_START_B
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_START_C
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_START_D
)brace
)brace
suffix:semicolon
DECL|variable|stop_proc
r_struct
id|lookup_proc_table
id|stop_proc
(braket
l_int|4
)braket
op_assign
(brace
(brace
l_int|0
comma
id|ICOM_CONTROL_STOP_A
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_STOP_B
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_STOP_C
)brace
comma
(brace
l_int|0
comma
id|ICOM_CONTROL_STOP_D
)brace
)brace
suffix:semicolon
DECL|variable|int_mask_tbl
r_struct
id|lookup_int_table
id|int_mask_tbl
(braket
l_int|4
)braket
op_assign
(brace
(brace
l_int|0
comma
id|ICOM_INT_MASK_PRC_A
)brace
comma
(brace
l_int|0
comma
id|ICOM_INT_MASK_PRC_B
)brace
comma
(brace
l_int|0
comma
id|ICOM_INT_MASK_PRC_C
)brace
comma
(brace
l_int|0
comma
id|ICOM_INT_MASK_PRC_D
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|icom_pci_table
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|icom_adapter_head
)paren
suffix:semicolon
multiline_comment|/* spinlock for adapter initialization and changing adapter operations */
DECL|variable|icom_lock
r_static
id|spinlock_t
id|icom_lock
suffix:semicolon
macro_line|#ifdef ICOM_TRACE
DECL|function|trace
r_static
r_inline
r_void
id|trace
c_func
(paren
r_struct
id|icom_port
op_star
comma
r_char
op_star
comma
r_int
r_int
)paren
(brace
)brace
suffix:semicolon
macro_line|#else
DECL|function|trace
r_static
r_inline
r_void
id|trace
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
comma
r_char
op_star
id|trace_pt
comma
r_int
r_int
id|trace_data
)paren
(brace
)brace
suffix:semicolon
macro_line|#endif
DECL|function|msleep
r_static
r_void
id|msleep
c_func
(paren
r_int
r_int
id|msecs
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|MSECS_TO_JIFFIES
c_func
(paren
id|msecs
)paren
)paren
suffix:semicolon
)brace
DECL|function|free_port_memory
r_static
r_void
id|free_port_memory
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|icom_port-&gt;adapter-&gt;pci_dev
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;RET_PORT_MEM&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;recv_buf
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
id|icom_port-&gt;recv_buf
comma
id|icom_port-&gt;recv_buf_pci
)paren
suffix:semicolon
id|icom_port-&gt;recv_buf
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|icom_port-&gt;xmit_buf
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
id|icom_port-&gt;xmit_buf
comma
id|icom_port-&gt;xmit_buf_pci
)paren
suffix:semicolon
id|icom_port-&gt;xmit_buf
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|icom_port-&gt;statStg
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
id|icom_port-&gt;statStg
comma
id|icom_port-&gt;statStg_pci
)paren
suffix:semicolon
id|icom_port-&gt;statStg
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|icom_port-&gt;xmitRestart
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
id|icom_port-&gt;xmitRestart
comma
id|icom_port-&gt;xmitRestart_pci
)paren
suffix:semicolon
id|icom_port-&gt;xmitRestart
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|get_port_memory
r_static
r_int
id|__init
id|get_port_memory
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
id|index
suffix:semicolon
r_int
r_int
id|stgAddr
suffix:semicolon
r_int
r_int
id|startStgAddr
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|icom_port-&gt;adapter-&gt;pci_dev
suffix:semicolon
id|icom_port-&gt;xmit_buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
op_amp
id|icom_port-&gt;xmit_buf_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_port-&gt;xmit_buf
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Can not allocate Transmit buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;GET_PORT_MEM&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;xmit_buf
)paren
suffix:semicolon
id|icom_port-&gt;recv_buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
op_amp
id|icom_port-&gt;recv_buf_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_port-&gt;recv_buf
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Can not allocate Receive buffer&bslash;n&quot;
)paren
suffix:semicolon
id|free_port_memory
c_func
(paren
id|icom_port
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;GET_PORT_MEM&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;recv_buf
)paren
suffix:semicolon
id|icom_port-&gt;statStg
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
op_amp
id|icom_port-&gt;statStg_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_port-&gt;statStg
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Can not allocate Status buffer&bslash;n&quot;
)paren
suffix:semicolon
id|free_port_memory
c_func
(paren
id|icom_port
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;GET_PORT_MEM&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;statStg
)paren
suffix:semicolon
id|icom_port-&gt;xmitRestart
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
op_amp
id|icom_port-&gt;xmitRestart_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_port-&gt;xmitRestart
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Can not allocate xmit Restart buffer&bslash;n&quot;
)paren
suffix:semicolon
id|free_port_memory
c_func
(paren
id|icom_port
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|icom_port-&gt;statStg
comma
l_int|0
comma
l_int|4096
)paren
suffix:semicolon
multiline_comment|/* FODs: Frame Out Descriptor Queue, this is a FIFO queue that&n;           indicates that frames are to be transmitted&n;&t;*/
id|stgAddr
op_assign
(paren
r_int
r_int
)paren
id|icom_port-&gt;statStg
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|NUM_XBUFFS
suffix:semicolon
id|index
op_increment
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FOD_ADDR&quot;
comma
id|stgAddr
)paren
suffix:semicolon
id|stgAddr
op_assign
id|stgAddr
op_plus
r_sizeof
(paren
id|icom_port-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
(paren
id|NUM_XBUFFS
op_minus
l_int|1
)paren
)paren
(brace
id|memset
c_func
(paren
op_amp
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|xmit_status_area
)paren
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
dot
id|leLengthASD
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|XMIT_BUFF_SZ
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FOD_ADDR&quot;
comma
id|stgAddr
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FOD_XBUFF&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;xmit_buf
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
dot
id|leBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port-&gt;xmit_buf_pci
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
(paren
id|NUM_XBUFFS
op_minus
l_int|1
)paren
)paren
(brace
id|memset
c_func
(paren
op_amp
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|xmit_status_area
)paren
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
dot
id|leLengthASD
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|XMIT_BUFF_SZ
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FOD_XBUFF&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;xmit_buf
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
dot
id|leBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port-&gt;xmit_buf_pci
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
op_amp
id|icom_port-&gt;statStg-&gt;xmit
(braket
id|index
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|xmit_status_area
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* FIDs */
id|startStgAddr
op_assign
id|stgAddr
suffix:semicolon
multiline_comment|/* fill in every entry, even if no buffer */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|NUM_RBUFFS
suffix:semicolon
id|index
op_increment
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FID_ADDR&quot;
comma
id|stgAddr
)paren
suffix:semicolon
id|stgAddr
op_assign
id|stgAddr
op_plus
r_sizeof
(paren
id|icom_port-&gt;statStg-&gt;rcv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leLength
op_assign
l_int|0
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|WorkingLength
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|RCV_BUFF_SZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
(paren
id|NUM_RBUFFS
op_minus
l_int|1
)paren
)paren
(brace
id|offset
op_assign
id|stgAddr
op_minus
(paren
r_int
r_int
)paren
id|icom_port-&gt;statStg
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leNext
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port
op_member_access_from_pointer
id|statStg_pci
op_plus
id|offset
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FID_RBUFF&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;recv_buf
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port-&gt;recv_buf_pci
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
(paren
id|NUM_RBUFFS
op_minus
l_int|1
)paren
)paren
(brace
id|offset
op_assign
id|startStgAddr
op_minus
(paren
r_int
r_int
)paren
id|icom_port-&gt;statStg
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leNext
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port
op_member_access_from_pointer
id|statStg_pci
op_plus
id|offset
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FID_RBUFF&quot;
comma
(paren
r_int
r_int
)paren
id|icom_port-&gt;recv_buf
op_plus
l_int|2048
)paren
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port-&gt;recv_buf_pci
op_plus
l_int|2048
)paren
suffix:semicolon
)brace
r_else
(brace
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leNext
op_assign
l_int|0
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|index
)braket
dot
id|leBuffer
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|stop_processor
r_static
r_void
id|stop_processor
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|port
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
id|port
op_assign
id|icom_port-&gt;port
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
op_logical_or
id|port
op_eq
l_int|1
)paren
id|stop_proc
(braket
id|port
)braket
dot
id|global_control_reg
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;control
suffix:semicolon
r_else
id|stop_proc
(braket
id|port
)braket
dot
id|global_control_reg
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;control_2
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|4
)paren
(brace
id|temp
op_assign
id|readl
c_func
(paren
id|stop_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
op_complement
id|start_proc
(braket
id|port
)braket
dot
id|processor_id
)paren
op_or
id|stop_proc
(braket
id|port
)braket
dot
id|processor_id
suffix:semicolon
id|writel
c_func
(paren
id|temp
comma
id|stop_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
multiline_comment|/* write flush */
id|readl
c_func
(paren
id|stop_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Invalid port assignment&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_processor
r_static
r_void
id|start_processor
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|port
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
id|port
op_assign
id|icom_port-&gt;port
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
op_logical_or
id|port
op_eq
l_int|1
)paren
id|start_proc
(braket
id|port
)braket
dot
id|global_control_reg
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;control
suffix:semicolon
r_else
id|start_proc
(braket
id|port
)braket
dot
id|global_control_reg
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;control_2
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|4
)paren
(brace
id|temp
op_assign
id|readl
c_func
(paren
id|start_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
op_complement
id|stop_proc
(braket
id|port
)braket
dot
id|processor_id
)paren
op_or
id|start_proc
(braket
id|port
)braket
dot
id|processor_id
suffix:semicolon
id|writel
c_func
(paren
id|temp
comma
id|start_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
multiline_comment|/* write flush */
id|readl
c_func
(paren
id|start_proc
(braket
id|port
)braket
dot
id|global_control_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Invalid port assignment&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|load_code
r_static
r_void
id|load_code
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_const
r_struct
id|firmware
op_star
id|fw
suffix:semicolon
r_char
op_star
id|iram_ptr
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|dram_ptr
op_assign
(paren
r_char
op_star
)paren
id|icom_port-&gt;dram
suffix:semicolon
id|dma_addr_t
id|temp_pci
suffix:semicolon
r_int
r_char
op_star
id|new_page
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|cable_id
op_assign
id|NO_CABLE
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|icom_port-&gt;adapter-&gt;pci_dev
suffix:semicolon
multiline_comment|/* Clear out any pending interrupts */
id|writew
c_func
(paren
l_int|0x3FFF
comma
(paren
r_void
op_star
)paren
id|icom_port-&gt;int_reg
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;CLEAR_INTERRUPTS&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Stop processor */
id|stop_processor
c_func
(paren
id|icom_port
)paren
suffix:semicolon
multiline_comment|/* Zero out DRAM */
id|memset_io
c_func
(paren
id|dram_ptr
comma
l_int|0
comma
l_int|512
)paren
suffix:semicolon
multiline_comment|/* Load Call Setup into Adapter */
r_if
c_cond
(paren
id|request_firmware
c_func
(paren
op_amp
id|fw
comma
l_string|&quot;icom_call_setup.bin&quot;
comma
op_amp
id|dev-&gt;dev
)paren
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Unable to load icom_call_setup.bin firmware image&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fw-&gt;size
OG
id|ICOM_DCE_IRAM_OFFSET
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Invalid firmware image for icom_call_setup.bin found.&bslash;n&quot;
)paren
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
id|iram_ptr
op_assign
(paren
r_char
op_star
)paren
id|icom_port-&gt;dram
op_plus
id|ICOM_IRAM_OFFSET
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|fw-&gt;size
suffix:semicolon
id|index
op_increment
)paren
id|writeb
c_func
(paren
id|fw-&gt;data
(braket
id|index
)braket
comma
op_amp
id|iram_ptr
(braket
id|index
)braket
)paren
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
multiline_comment|/* Load Resident DCE portion of Adapter */
r_if
c_cond
(paren
id|request_firmware
c_func
(paren
op_amp
id|fw
comma
l_string|&quot;icom_res_dce.bin&quot;
comma
op_amp
id|dev-&gt;dev
)paren
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Unable to load icom_res_dce.bin firmware image&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fw-&gt;size
OG
id|ICOM_IRAM_SIZE
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Invalid firmware image for icom_res_dce.bin found.&bslash;n&quot;
)paren
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
id|iram_ptr
op_assign
(paren
r_char
op_star
)paren
id|icom_port-&gt;dram
op_plus
id|ICOM_IRAM_OFFSET
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
id|ICOM_DCE_IRAM_OFFSET
suffix:semicolon
id|index
OL
id|fw-&gt;size
suffix:semicolon
id|index
op_increment
)paren
id|writeb
c_func
(paren
id|fw-&gt;data
(braket
id|index
)braket
comma
op_amp
id|iram_ptr
(braket
id|index
)braket
)paren
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
multiline_comment|/* Set Hardware level */
r_if
c_cond
(paren
(paren
id|icom_port-&gt;adapter-&gt;version
op_or
id|ADAPTER_V2
)paren
op_eq
id|ADAPTER_V2
)paren
id|writeb
c_func
(paren
id|V2_HARDWARE
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;misc_flags
)paren
)paren
suffix:semicolon
multiline_comment|/* Start the processor in Adapter */
id|start_processor
c_func
(paren
id|icom_port
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|HDLC_PPP_PURE_ASYNC
op_or
id|HDLC_FF_FILL
)paren
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;HDLCConfigReg
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x04
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;FlagFillIdleTimer
)paren
)paren
suffix:semicolon
multiline_comment|/* 0.5 seconds */
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;CmdReg
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x10
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;async_config3
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|ICOM_ACFG_DRIVE1
op_or
id|ICOM_ACFG_NO_PARITY
op_or
id|ICOM_ACFG_8BPC
op_or
id|ICOM_ACFG_1STOP_BIT
)paren
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;async_config2
)paren
)paren
suffix:semicolon
multiline_comment|/*Set up data in icom DRAM to indicate where personality&n;&t; *code is located and its length.&n;&t; */
id|new_page
op_assign
id|pci_alloc_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
op_amp
id|temp_pci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_page
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Can not allocate DMA buffer&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_firmware
c_func
(paren
op_amp
id|fw
comma
l_string|&quot;icom_asc.bin&quot;
comma
op_amp
id|dev-&gt;dev
)paren
OL
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Unable to load icom_asc.bin firmware image&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fw-&gt;size
OG
id|ICOM_DCE_IRAM_OFFSET
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Invalid firmware image for icom_asc.bin found.&bslash;n&quot;
)paren
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|load_code_exit
suffix:semicolon
)brace
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|fw-&gt;size
suffix:semicolon
id|index
op_increment
)paren
id|new_page
(braket
id|index
)braket
op_assign
id|fw-&gt;data
(braket
id|index
)braket
suffix:semicolon
id|release_firmware
c_func
(paren
id|fw
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
r_char
)paren
(paren
(paren
id|fw-&gt;size
op_plus
l_int|16
)paren
op_div
l_int|16
)paren
comma
op_amp
id|icom_port-&gt;dram-&gt;mac_length
)paren
suffix:semicolon
id|writel
c_func
(paren
id|temp_pci
comma
op_amp
id|icom_port-&gt;dram-&gt;mac_load_addr
)paren
suffix:semicolon
multiline_comment|/*Setting the syncReg to 0x80 causes adapter to start downloading&n;&t;   the personality code into adapter instruction RAM.&n;&t;   Once code is loaded, it will begin executing and, based on&n;&t;   information provided above, will start DMAing data from&n;&t;   shared memory to adapter DRAM.&n;&t; */
multiline_comment|/* the wait loop below verifies this write operation has been done&n;&t;   and processed&n;&t;*/
id|writeb
c_func
(paren
id|START_DOWNLOAD
comma
op_amp
id|icom_port-&gt;dram-&gt;sync
)paren
suffix:semicolon
multiline_comment|/* Wait max 1 Sec for data download and processor to start */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
l_int|10
suffix:semicolon
id|index
op_increment
)paren
(brace
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;misc_flags
)paren
op_amp
id|ICOM_HDW_ACTIVE
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index
op_eq
l_int|10
)paren
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * check Cable ID&n;&t; */
id|cable_id
op_assign
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;cable_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cable_id
op_amp
id|ICOM_CABLE_ID_VALID
)paren
(brace
multiline_comment|/* Get cable ID into the lower 4 bits (standard form) */
id|cable_id
op_assign
(paren
id|cable_id
op_amp
id|ICOM_CABLE_ID_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
id|icom_port-&gt;cable_id
op_assign
id|cable_id
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Invalid or no cable attached&bslash;n&quot;
)paren
suffix:semicolon
id|icom_port-&gt;cable_id
op_assign
id|NO_CABLE
suffix:semicolon
)brace
id|load_code_exit
suffix:colon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Clear out any pending interrupts */
id|writew
c_func
(paren
l_int|0x3FFF
comma
(paren
r_void
op_star
)paren
id|icom_port-&gt;int_reg
)paren
suffix:semicolon
multiline_comment|/* Turn off port */
id|writeb
c_func
(paren
id|ICOM_DISABLE
comma
op_amp
(paren
id|icom_port-&gt;dram-&gt;disable
)paren
)paren
suffix:semicolon
multiline_comment|/* Stop processor */
id|stop_processor
c_func
(paren
id|icom_port
)paren
suffix:semicolon
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Port not opertional&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|new_page
op_ne
l_int|NULL
)paren
id|pci_free_consistent
c_func
(paren
id|dev
comma
l_int|4096
comma
id|new_page
comma
id|temp_pci
)paren
suffix:semicolon
)brace
DECL|function|startup
r_static
r_int
id|startup
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
r_char
id|cable_id
comma
id|raw_cable_id
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|port
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;STARTUP&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;dram
op_eq
l_int|0x00000000
)paren
(brace
multiline_comment|/* should NEVER be zero */
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Unusable Port, port configuration missing&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * check Cable ID&n;&t; */
id|raw_cable_id
op_assign
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;cable_id
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;CABLE_ID&quot;
comma
id|raw_cable_id
)paren
suffix:semicolon
multiline_comment|/* Get cable ID into the lower 4 bits (standard form) */
id|cable_id
op_assign
(paren
id|raw_cable_id
op_amp
id|ICOM_CABLE_ID_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
multiline_comment|/* Check for valid Cable ID */
r_if
c_cond
(paren
op_logical_neg
(paren
id|raw_cable_id
op_amp
id|ICOM_CABLE_ID_VALID
)paren
op_logical_or
(paren
id|cable_id
op_ne
id|icom_port-&gt;cable_id
)paren
)paren
(brace
multiline_comment|/* reload adapter code, pick up any potential changes in cable id */
id|load_code
c_func
(paren
id|icom_port
)paren
suffix:semicolon
multiline_comment|/* still no sign of cable, error out */
id|raw_cable_id
op_assign
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;cable_id
)paren
suffix:semicolon
id|cable_id
op_assign
(paren
id|raw_cable_id
op_amp
id|ICOM_CABLE_ID_MASK
)paren
op_rshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|raw_cable_id
op_amp
id|ICOM_CABLE_ID_VALID
)paren
op_logical_or
(paren
id|icom_port-&gt;cable_id
op_eq
id|NO_CABLE
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Finally, clear and  enable interrupts&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
id|port
op_assign
id|icom_port-&gt;port
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
op_logical_or
id|port
op_eq
l_int|1
)paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;int_mask
suffix:semicolon
r_else
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;int_mask_2
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
op_logical_or
id|port
op_eq
l_int|2
)paren
id|writew
c_func
(paren
l_int|0x00FF
comma
(paren
r_void
op_star
)paren
id|icom_port-&gt;int_reg
)paren
suffix:semicolon
r_else
id|writew
c_func
(paren
l_int|0x3F00
comma
(paren
r_void
op_star
)paren
id|icom_port-&gt;int_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|4
)paren
(brace
id|temp
op_assign
id|readl
c_func
(paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
id|writel
c_func
(paren
id|temp
op_amp
op_complement
id|int_mask_tbl
(braket
id|port
)braket
dot
id|processor_id
comma
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
multiline_comment|/* write flush */
id|readl
c_func
(paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Invalid port assignment&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|shutdown
r_static
r_void
id|shutdown
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
r_char
id|cmdReg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|port
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;SHUTDOWN&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * disable all interrupts&n;&t; */
id|port
op_assign
id|icom_port-&gt;port
suffix:semicolon
r_if
c_cond
(paren
id|port
op_eq
l_int|0
op_logical_or
id|port
op_eq
l_int|1
)paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;int_mask
suffix:semicolon
r_else
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
op_assign
op_amp
id|icom_port-&gt;global_reg-&gt;int_mask_2
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|4
)paren
(brace
id|temp
op_assign
id|readl
c_func
(paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
id|writel
c_func
(paren
id|temp
op_or
id|int_mask_tbl
(braket
id|port
)braket
dot
id|processor_id
comma
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
multiline_comment|/* write flush */
id|readl
c_func
(paren
id|int_mask_tbl
(braket
id|port
)braket
dot
id|global_int_mask
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Invalid port assignment&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|icom_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * disable break condition&n;&t; */
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmdReg
op_or
id|CMD_SND_BREAK
)paren
op_eq
id|CMD_SND_BREAK
)paren
(brace
id|writeb
c_func
(paren
id|cmdReg
op_amp
op_complement
id|CMD_SND_BREAK
comma
op_amp
id|icom_port-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
)brace
)brace
DECL|function|icom_write
r_static
r_int
id|icom_write
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
r_int
id|data_count
suffix:semicolon
r_int
r_char
id|cmdReg
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
r_int
id|temp_tail
op_assign
id|port-&gt;info-&gt;xmit.tail
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;WRITE&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_to_le16
c_func
(paren
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|flags
)paren
op_amp
id|SA_FLAGS_READY_TO_XMIT
)paren
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;WRITE_FULL&quot;
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|data_count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|port-&gt;info-&gt;xmit.head
op_ne
id|temp_tail
)paren
op_logical_and
(paren
id|data_count
op_le
id|XMIT_BUFF_SZ
)paren
)paren
(brace
id|ICOM_PORT-&gt;xmit_buf
(braket
id|data_count
op_increment
)braket
op_assign
id|port-&gt;info-&gt;xmit.buf
(braket
id|temp_tail
)braket
suffix:semicolon
id|temp_tail
op_increment
suffix:semicolon
id|temp_tail
op_and_assign
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data_count
)paren
(brace
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|cpu_to_le16
c_func
(paren
id|SA_FLAGS_READY_TO_XMIT
)paren
suffix:semicolon
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|leLength
op_assign
id|cpu_to_le16
c_func
(paren
id|data_count
)paren
suffix:semicolon
id|offset
op_assign
(paren
r_int
r_int
)paren
op_amp
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
op_minus
(paren
r_int
r_int
)paren
id|ICOM_PORT-&gt;statStg
suffix:semicolon
op_star
id|ICOM_PORT-&gt;xmitRestart
op_assign
id|cpu_to_le32
c_func
(paren
id|ICOM_PORT-&gt;statStg_pci
op_plus
id|offset
)paren
suffix:semicolon
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|cmdReg
op_or
id|CMD_XMIT_RCV_ENABLE
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|START_XMIT
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;StartXmitCmd
)paren
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;WRITE_START&quot;
comma
id|data_count
)paren
suffix:semicolon
multiline_comment|/* write flush */
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;StartXmitCmd
)paren
suffix:semicolon
)brace
r_return
id|data_count
suffix:semicolon
)brace
DECL|function|check_modem_status
r_static
r_inline
r_void
id|check_modem_status
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_static
r_char
id|old_status
op_assign
l_int|0
suffix:semicolon
r_char
id|delta_status
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.lock
)paren
suffix:semicolon
multiline_comment|/*modem input register */
id|status
op_assign
id|readb
c_func
(paren
op_amp
id|icom_port-&gt;dram-&gt;isr
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;CHECK_MODEM&quot;
comma
id|status
)paren
suffix:semicolon
id|delta_status
op_assign
id|status
op_xor
id|old_status
suffix:semicolon
r_if
c_cond
(paren
id|delta_status
)paren
(brace
r_if
c_cond
(paren
id|delta_status
op_amp
id|ICOM_RI
)paren
id|icom_port-&gt;uart_port.icount.rng
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|delta_status
op_amp
id|ICOM_DSR
)paren
id|icom_port-&gt;uart_port.icount.dsr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|delta_status
op_amp
id|ICOM_DCD
)paren
id|uart_handle_dcd_change
c_func
(paren
op_amp
id|icom_port-&gt;uart_port
comma
id|delta_status
op_amp
id|ICOM_DCD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delta_status
op_amp
id|ICOM_CTS
)paren
id|uart_handle_cts_change
c_func
(paren
op_amp
id|icom_port-&gt;uart_port
comma
id|delta_status
op_amp
id|ICOM_CTS
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.info
op_member_access_from_pointer
id|delta_msr_wait
)paren
suffix:semicolon
id|old_status
op_assign
id|status
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.lock
)paren
suffix:semicolon
)brace
DECL|function|xmit_interrupt
r_static
r_void
id|xmit_interrupt
c_func
(paren
id|u16
id|port_int_reg
comma
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
r_int
id|count
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|port_int_reg
op_amp
(paren
id|INT_XMIT_COMPLETED
)paren
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;XMIT_COMPLETE&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clear buffer in use bit */
id|icom_port-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|flags
op_and_assign
id|cpu_to_le16
c_func
(paren
op_complement
id|SA_FLAGS_READY_TO_XMIT
)paren
suffix:semicolon
id|count
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|icom_port-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|leLength
)paren
suffix:semicolon
id|icom_port-&gt;uart_port.icount.tx
op_add_assign
id|count
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
op_logical_and
op_logical_neg
id|uart_circ_empty
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.info-&gt;xmit
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|icom_port-&gt;uart_port.info-&gt;xmit.tail
op_increment
suffix:semicolon
id|icom_port-&gt;uart_port.info-&gt;xmit.tail
op_and_assign
(paren
id|UART_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|icom_write
c_func
(paren
op_amp
id|icom_port-&gt;uart_port
)paren
)paren
multiline_comment|/* activate write queue */
id|uart_write_wakeup
c_func
(paren
op_amp
id|icom_port-&gt;uart_port
)paren
suffix:semicolon
)brace
r_else
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;XMIT_DISABLED&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|recv_interrupt
r_static
r_void
id|recv_interrupt
c_func
(paren
id|u16
id|port_int_reg
comma
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
r_int
r_int
id|count
comma
id|rcv_buff
suffix:semicolon
r_struct
id|tty_struct
op_star
id|tty
op_assign
id|icom_port-&gt;uart_port.info-&gt;tty
suffix:semicolon
r_int
r_int
r_int
id|status
suffix:semicolon
r_struct
id|uart_icount
op_star
id|icount
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;RCV_COMPLETE&quot;
comma
l_int|0
)paren
suffix:semicolon
id|rcv_buff
op_assign
id|icom_port-&gt;next_rcv
suffix:semicolon
id|status
op_assign
id|cpu_to_le16
c_func
(paren
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|status
op_amp
id|SA_FL_RCV_DONE
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;FID_STATUS&quot;
comma
id|status
)paren
suffix:semicolon
id|count
op_assign
id|cpu_to_le16
c_func
(paren
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|leLength
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;RCV_COUNT&quot;
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
(paren
id|TTY_FLIPBUF_SIZE
op_minus
id|tty-&gt;flip.count
)paren
)paren
id|count
op_assign
id|TTY_FLIPBUF_SIZE
op_minus
id|tty-&gt;flip.count
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;REAL_COUNT&quot;
comma
id|count
)paren
suffix:semicolon
id|offset
op_assign
id|cpu_to_le32
c_func
(paren
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|leBuffer
)paren
op_minus
id|icom_port-&gt;recv_buf_pci
suffix:semicolon
id|memcpy
c_func
(paren
id|tty-&gt;flip.char_buf_ptr
comma
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|icom_port-&gt;recv_buf
op_plus
id|offset
)paren
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|tty-&gt;flip.count
op_add_assign
id|count
op_minus
l_int|1
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_add_assign
id|count
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|tty-&gt;flip.flag_buf_ptr
comma
l_int|0
comma
id|count
)paren
suffix:semicolon
id|tty-&gt;flip.flag_buf_ptr
op_add_assign
id|count
op_minus
l_int|1
suffix:semicolon
)brace
id|icount
op_assign
op_amp
id|icom_port-&gt;uart_port.icount
suffix:semicolon
id|icount-&gt;rx
op_add_assign
id|count
suffix:semicolon
multiline_comment|/* Break detect logic */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|SA_FLAGS_FRAME_ERROR
)paren
op_logical_and
(paren
id|tty-&gt;flip.char_buf_ptr
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
)paren
(brace
id|status
op_and_assign
op_complement
id|SA_FLAGS_FRAME_ERROR
suffix:semicolon
id|status
op_or_assign
id|SA_FLAGS_BREAK_DET
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;BREAK_DET&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|SA_FLAGS_BREAK_DET
op_or
id|SA_FLAGS_PARITY_ERROR
op_or
id|SA_FLAGS_FRAME_ERROR
op_or
id|SA_FLAGS_OVERRUN
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_BREAK_DET
)paren
id|icount-&gt;brk
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_PARITY_ERROR
)paren
id|icount-&gt;parity
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_FRAME_ERROR
)paren
id|icount-&gt;frame
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_OVERRUN
)paren
id|icount-&gt;overrun
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Now check to see if character should be&n;&t;&t;&t; * ignored, and mask off conditions which&n;&t;&t;&t; * should be ignored.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|status
op_amp
id|icom_port-&gt;ignore_status_mask
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;IGNORE_CHAR&quot;
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|ignore_char
suffix:semicolon
)brace
id|status
op_and_assign
id|icom_port-&gt;read_status_mask
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_BREAK_DET
)paren
(brace
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_BREAK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_PARITY_ERROR
)paren
(brace
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;PARITY_ERROR&quot;
comma
l_int|0
)paren
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_PARITY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_FRAME_ERROR
)paren
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_FRAME
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SA_FLAGS_OVERRUN
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Overrun is special, since it&squot;s&n;&t;&t;&t;&t; * reported immediately, and doesn&squot;t&n;&t;&t;&t;&t; * affect the current character&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|tty-&gt;flip.count
OL
id|TTY_FLIPBUF_SIZE
)paren
(brace
id|tty-&gt;flip.count
op_increment
suffix:semicolon
id|tty-&gt;flip.flag_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_increment
suffix:semicolon
op_star
id|tty-&gt;flip.flag_buf_ptr
op_assign
id|TTY_OVERRUN
suffix:semicolon
)brace
)brace
)brace
id|tty-&gt;flip.flag_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.char_buf_ptr
op_increment
suffix:semicolon
id|tty-&gt;flip.count
op_increment
suffix:semicolon
id|ignore_char
suffix:colon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|leLength
op_assign
l_int|0
suffix:semicolon
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|WorkingLength
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|RCV_BUFF_SZ
)paren
suffix:semicolon
id|rcv_buff
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rcv_buff
op_eq
id|NUM_RBUFFS
)paren
id|rcv_buff
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|cpu_to_le16
c_func
(paren
id|icom_port-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|flags
)paren
suffix:semicolon
)brace
id|icom_port-&gt;next_rcv
op_assign
id|rcv_buff
suffix:semicolon
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|process_interrupt
r_static
r_void
id|process_interrupt
c_func
(paren
id|u16
id|port_int_reg
comma
r_struct
id|icom_port
op_star
id|icom_port
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.lock
)paren
suffix:semicolon
id|trace
c_func
(paren
id|icom_port
comma
l_string|&quot;INTERRUPT&quot;
comma
id|port_int_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port_int_reg
op_amp
(paren
id|INT_XMIT_COMPLETED
op_or
id|INT_XMIT_DISABLED
)paren
)paren
id|xmit_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port_int_reg
op_amp
id|INT_RCV_COMPLETED
)paren
id|recv_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|icom_port-&gt;uart_port.lock
)paren
suffix:semicolon
)brace
DECL|function|icom_interrupt
r_static
id|irqreturn_t
id|icom_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|int_reg
suffix:semicolon
id|u32
id|adapter_interrupts
suffix:semicolon
id|u16
id|port_int_reg
suffix:semicolon
r_struct
id|icom_adapter
op_star
id|icom_adapter
suffix:semicolon
r_struct
id|icom_port
op_star
id|icom_port
suffix:semicolon
multiline_comment|/* find icom_port for this interrupt */
id|icom_adapter
op_assign
(paren
r_struct
id|icom_adapter
op_star
)paren
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|icom_adapter-&gt;version
op_or
id|ADAPTER_V2
)paren
op_eq
id|ADAPTER_V2
)paren
(brace
id|int_reg
op_assign
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x8024
suffix:semicolon
id|adapter_interrupts
op_assign
id|readl
c_func
(paren
(paren
r_void
op_star
)paren
id|int_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter_interrupts
op_amp
l_int|0x00003FFF
)paren
(brace
multiline_comment|/* port 2 interrupt,  NOTE:  for all ADAPTER_V2, port 2 will be active */
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
l_int|2
)braket
suffix:semicolon
id|port_int_reg
op_assign
(paren
id|u16
)paren
id|adapter_interrupts
suffix:semicolon
id|process_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
id|check_modem_status
c_func
(paren
id|icom_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter_interrupts
op_amp
l_int|0x3FFF0000
)paren
(brace
multiline_comment|/* port 3 interrupt */
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;status
op_eq
id|ICOM_PORT_ACTIVE
)paren
(brace
id|port_int_reg
op_assign
(paren
id|u16
)paren
(paren
id|adapter_interrupts
op_rshift
l_int|16
)paren
suffix:semicolon
id|process_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
id|check_modem_status
c_func
(paren
id|icom_port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Clear out any pending interrupts */
id|writel
c_func
(paren
id|adapter_interrupts
comma
(paren
r_void
op_star
)paren
id|int_reg
)paren
suffix:semicolon
id|int_reg
op_assign
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x8004
suffix:semicolon
)brace
r_else
(brace
id|int_reg
op_assign
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x4004
suffix:semicolon
)brace
id|adapter_interrupts
op_assign
id|readl
c_func
(paren
(paren
r_void
op_star
)paren
id|int_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter_interrupts
op_amp
l_int|0x00003FFF
)paren
(brace
multiline_comment|/* port 0 interrupt, NOTE:  for all adapters, port 0 will be active */
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
l_int|0
)braket
suffix:semicolon
id|port_int_reg
op_assign
(paren
id|u16
)paren
id|adapter_interrupts
suffix:semicolon
id|process_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
id|check_modem_status
c_func
(paren
id|icom_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter_interrupts
op_amp
l_int|0x3FFF0000
)paren
(brace
multiline_comment|/* port 1 interrupt */
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;status
op_eq
id|ICOM_PORT_ACTIVE
)paren
(brace
id|port_int_reg
op_assign
(paren
id|u16
)paren
(paren
id|adapter_interrupts
op_rshift
l_int|16
)paren
suffix:semicolon
id|process_interrupt
c_func
(paren
id|port_int_reg
comma
id|icom_port
)paren
suffix:semicolon
id|check_modem_status
c_func
(paren
id|icom_port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Clear out any pending interrupts */
id|writel
c_func
(paren
id|adapter_interrupts
comma
(paren
r_void
op_star
)paren
id|int_reg
)paren
suffix:semicolon
multiline_comment|/* flush the write */
id|adapter_interrupts
op_assign
id|readl
c_func
(paren
(paren
r_void
op_star
)paren
id|int_reg
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------------&n; * Begin serial-core API&n; * ------------------------------------------------------------------&n; */
DECL|function|icom_tx_empty
r_static
r_int
r_int
id|icom_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_to_le16
c_func
(paren
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
l_int|0
)braket
dot
id|flags
)paren
op_amp
id|SA_FLAGS_READY_TO_XMIT
)paren
id|ret
op_assign
id|TIOCSER_TEMT
suffix:semicolon
r_else
id|ret
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|icom_set_mctrl
r_static
r_void
id|icom_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|mctrl
)paren
(brace
r_int
r_char
id|local_osr
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;SET_MODEM&quot;
comma
l_int|0
)paren
suffix:semicolon
id|local_osr
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;osr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_RTS
)paren
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;RAISE_RTS&quot;
comma
l_int|0
)paren
suffix:semicolon
id|local_osr
op_or_assign
id|ICOM_RTS
suffix:semicolon
)brace
r_else
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;LOWER_RTS&quot;
comma
l_int|0
)paren
suffix:semicolon
id|local_osr
op_and_assign
op_complement
id|ICOM_RTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_DTR
)paren
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;RAISE_DTR&quot;
comma
l_int|0
)paren
suffix:semicolon
id|local_osr
op_or_assign
id|ICOM_DTR
suffix:semicolon
)brace
r_else
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;LOWER_DTR&quot;
comma
l_int|0
)paren
suffix:semicolon
id|local_osr
op_and_assign
op_complement
id|ICOM_DTR
suffix:semicolon
)brace
id|writeb
c_func
(paren
id|local_osr
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;osr
)paren
suffix:semicolon
)brace
DECL|function|icom_get_mctrl
r_static
r_int
r_int
id|icom_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
r_char
id|status
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;GET_MODEM&quot;
comma
l_int|0
)paren
suffix:semicolon
id|status
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;isr
)paren
suffix:semicolon
id|result
op_assign
(paren
(paren
id|status
op_amp
id|ICOM_DCD
)paren
ques
c_cond
id|TIOCM_CAR
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ICOM_RI
)paren
ques
c_cond
id|TIOCM_RNG
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ICOM_DSR
)paren
ques
c_cond
id|TIOCM_DSR
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|status
op_amp
id|ICOM_CTS
)paren
ques
c_cond
id|TIOCM_CTS
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|icom_stop_tx
r_static
r_void
id|icom_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_stop
)paren
(brace
r_int
r_char
id|cmdReg
suffix:semicolon
r_if
c_cond
(paren
id|tty_stop
)paren
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;STOP&quot;
comma
l_int|0
)paren
suffix:semicolon
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|cmdReg
op_or
id|CMD_HOLD_XMIT
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
)brace
)brace
DECL|function|icom_start_tx
r_static
r_void
id|icom_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
r_int
id|tty_start
)paren
(brace
r_int
r_char
id|cmdReg
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;START&quot;
comma
l_int|0
)paren
suffix:semicolon
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmdReg
op_amp
id|CMD_HOLD_XMIT
)paren
op_eq
id|CMD_HOLD_XMIT
)paren
id|writeb
c_func
(paren
id|cmdReg
op_amp
op_complement
id|CMD_HOLD_XMIT
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|icom_write
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|function|icom_send_xchar
r_static
r_void
id|icom_send_xchar
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_char
id|ch
)paren
(brace
r_int
r_char
id|xdata
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;SEND_XCHAR&quot;
comma
id|ch
)paren
suffix:semicolon
multiline_comment|/* wait .1 sec to send char */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
l_int|10
suffix:semicolon
id|index
op_increment
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|xdata
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;xchar
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xdata
op_eq
l_int|0x00
)paren
(brace
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;QUICK_WRITE&quot;
comma
l_int|0
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|ch
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;xchar
)paren
suffix:semicolon
multiline_comment|/* flush write operation */
id|xdata
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;xchar
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
DECL|function|icom_stop_rx
r_static
r_void
id|icom_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
r_char
id|cmdReg
suffix:semicolon
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|cmdReg
op_amp
op_complement
id|CMD_RCV_ENABLE
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
)brace
DECL|function|icom_enable_ms
r_static
r_void
id|icom_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
multiline_comment|/* no-op */
)brace
DECL|function|icom_break
r_static
r_void
id|icom_break
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|break_state
)paren
(brace
r_int
r_char
id|cmdReg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;BREAK&quot;
comma
l_int|0
)paren
suffix:semicolon
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|break_state
op_eq
op_minus
l_int|1
)paren
(brace
id|writeb
c_func
(paren
id|cmdReg
op_or
id|CMD_SND_BREAK
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
)brace
r_else
(brace
id|writeb
c_func
(paren
id|cmdReg
op_amp
op_complement
id|CMD_SND_BREAK
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|icom_open
r_static
r_int
id|icom_open
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
id|retval
suffix:semicolon
id|kobject_get
c_func
(paren
op_amp
id|ICOM_PORT-&gt;adapter-&gt;kobj
)paren
suffix:semicolon
id|retval
op_assign
id|startup
c_func
(paren
id|ICOM_PORT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|kobject_put
c_func
(paren
op_amp
id|ICOM_PORT-&gt;adapter-&gt;kobj
)paren
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;STARTUP_ERROR&quot;
comma
l_int|0
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|icom_close
r_static
r_void
id|icom_close
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_int
r_char
id|cmdReg
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;CLOSE&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* stop receiver */
id|cmdReg
op_assign
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|cmdReg
op_amp
(paren
r_int
r_char
)paren
op_complement
id|CMD_RCV_ENABLE
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|shutdown
c_func
(paren
id|ICOM_PORT
)paren
suffix:semicolon
id|kobject_put
c_func
(paren
op_amp
id|ICOM_PORT-&gt;adapter-&gt;kobj
)paren
suffix:semicolon
)brace
DECL|function|icom_set_termios
r_static
r_void
id|icom_set_termios
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
r_int
id|baud
suffix:semicolon
r_int
id|cflag
comma
id|iflag
suffix:semicolon
r_int
id|bits
suffix:semicolon
r_char
id|new_config2
suffix:semicolon
r_char
id|new_config3
op_assign
l_int|0
suffix:semicolon
r_char
id|tmp_byte
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|rcv_buff
comma
id|xmit_buff
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;CHANGE_SPEED&quot;
comma
l_int|0
)paren
suffix:semicolon
id|cflag
op_assign
id|termios-&gt;c_cflag
suffix:semicolon
id|iflag
op_assign
id|termios-&gt;c_iflag
suffix:semicolon
id|new_config2
op_assign
id|ICOM_ACFG_DRIVE1
suffix:semicolon
multiline_comment|/* byte size and parity */
r_switch
c_cond
(paren
id|cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
multiline_comment|/* 5 bits/char */
id|new_config2
op_or_assign
id|ICOM_ACFG_5BPC
suffix:semicolon
id|bits
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
multiline_comment|/* 6 bits/char */
id|new_config2
op_or_assign
id|ICOM_ACFG_6BPC
suffix:semicolon
id|bits
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
multiline_comment|/* 7 bits/char */
id|new_config2
op_or_assign
id|ICOM_ACFG_7BPC
suffix:semicolon
id|bits
op_assign
l_int|9
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
multiline_comment|/* 8 bits/char */
id|new_config2
op_or_assign
id|ICOM_ACFG_8BPC
suffix:semicolon
id|bits
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|bits
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|CSTOPB
)paren
(brace
multiline_comment|/* 2 stop bits */
id|new_config2
op_or_assign
id|ICOM_ACFG_2STOP_BIT
suffix:semicolon
id|bits
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|PARENB
)paren
(brace
multiline_comment|/* parity bit enabled */
id|new_config2
op_or_assign
id|ICOM_ACFG_PARITY_ENAB
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;PARENB&quot;
comma
l_int|0
)paren
suffix:semicolon
id|bits
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cflag
op_amp
id|PARODD
)paren
(brace
multiline_comment|/* odd parity */
id|new_config2
op_or_assign
id|ICOM_ACFG_PARITY_ODD
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;PARODD&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine divisor based on baud rate */
id|baud
op_assign
id|uart_get_baud_rate
c_func
(paren
id|port
comma
id|termios
comma
id|old_termios
comma
id|icom_acfg_baud
(braket
l_int|0
)braket
comma
id|icom_acfg_baud
(braket
id|BAUD_TABLE_LIMIT
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|baud
)paren
id|baud
op_assign
l_int|9600
suffix:semicolon
multiline_comment|/* B0 transition handled in rs_set_termios */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|BAUD_TABLE_LIMIT
suffix:semicolon
id|index
op_increment
)paren
(brace
r_if
c_cond
(paren
id|icom_acfg_baud
(braket
id|index
)braket
op_eq
id|baud
)paren
(brace
id|new_config3
op_assign
id|index
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|uart_update_timeout
c_func
(paren
id|port
comma
id|cflag
comma
id|baud
)paren
suffix:semicolon
multiline_comment|/* CTS flow control flag and modem status interrupts */
id|tmp_byte
op_assign
id|readb
c_func
(paren
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;HDLCConfigReg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CRTSCTS
)paren
id|tmp_byte
op_or_assign
id|HDLC_HDW_FLOW
suffix:semicolon
r_else
id|tmp_byte
op_and_assign
op_complement
id|HDLC_HDW_FLOW
suffix:semicolon
id|writeb
c_func
(paren
id|tmp_byte
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;HDLCConfigReg
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set up parity check flag&n;&t; */
id|ICOM_PORT-&gt;read_status_mask
op_assign
id|SA_FLAGS_OVERRUN
op_or
id|SA_FL_RCV_DONE
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|INPCK
)paren
id|ICOM_PORT-&gt;read_status_mask
op_or_assign
id|SA_FLAGS_FRAME_ERROR
op_or
id|SA_FLAGS_PARITY_ERROR
suffix:semicolon
r_if
c_cond
(paren
(paren
id|iflag
op_amp
id|BRKINT
)paren
op_logical_or
(paren
id|iflag
op_amp
id|PARMRK
)paren
)paren
id|ICOM_PORT-&gt;read_status_mask
op_or_assign
id|SA_FLAGS_BREAK_DET
suffix:semicolon
multiline_comment|/*&n;&t; * Characters to ignore&n;&t; */
id|ICOM_PORT-&gt;ignore_status_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNPAR
)paren
id|ICOM_PORT-&gt;ignore_status_mask
op_or_assign
id|SA_FLAGS_PARITY_ERROR
op_or
id|SA_FLAGS_FRAME_ERROR
suffix:semicolon
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNBRK
)paren
(brace
id|ICOM_PORT-&gt;ignore_status_mask
op_or_assign
id|SA_FLAGS_BREAK_DET
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we&squot;re ignore parity and break indicators, ignore&n;&t;&t; * overruns too.  (For real raw support).&n;&t;&t; */
r_if
c_cond
(paren
id|iflag
op_amp
id|IGNPAR
)paren
id|ICOM_PORT-&gt;ignore_status_mask
op_or_assign
id|SA_FLAGS_OVERRUN
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * !!! ignore all characters if CREAD is not set&n;&t; */
r_if
c_cond
(paren
(paren
id|cflag
op_amp
id|CREAD
)paren
op_eq
l_int|0
)paren
id|ICOM_PORT-&gt;ignore_status_mask
op_or_assign
id|SA_FL_RCV_DONE
suffix:semicolon
multiline_comment|/* Turn off Receiver to prepare for reset */
id|writeb
c_func
(paren
id|CMD_RCV_DISABLE
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
l_int|10
suffix:semicolon
id|index
op_increment
)paren
(brace
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;PrevCmdReg
)paren
op_eq
l_int|0x00
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* clear all current buffers of data */
r_for
c_loop
(paren
id|rcv_buff
op_assign
l_int|0
suffix:semicolon
id|rcv_buff
OL
id|NUM_RBUFFS
suffix:semicolon
id|rcv_buff
op_increment
)paren
(brace
id|ICOM_PORT-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
id|ICOM_PORT-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|leLength
op_assign
l_int|0
suffix:semicolon
id|ICOM_PORT-&gt;statStg-&gt;rcv
(braket
id|rcv_buff
)braket
dot
id|WorkingLength
op_assign
(paren
r_int
r_int
r_int
)paren
id|cpu_to_le16
c_func
(paren
id|RCV_BUFF_SZ
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|xmit_buff
op_assign
l_int|0
suffix:semicolon
id|xmit_buff
OL
id|NUM_XBUFFS
suffix:semicolon
id|xmit_buff
op_increment
)paren
(brace
id|ICOM_PORT-&gt;statStg-&gt;xmit
(braket
id|xmit_buff
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* activate changes and start xmit and receiver here */
multiline_comment|/* Enable the receiver */
id|writeb
c_func
(paren
id|new_config3
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;async_config3
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|new_config2
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;async_config2
)paren
)paren
suffix:semicolon
id|tmp_byte
op_assign
id|readb
c_func
(paren
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;HDLCConfigReg
)paren
)paren
suffix:semicolon
id|tmp_byte
op_or_assign
id|HDLC_PPP_PURE_ASYNC
op_or
id|HDLC_FF_FILL
suffix:semicolon
id|writeb
c_func
(paren
id|tmp_byte
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;HDLCConfigReg
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0x04
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;FlagFillIdleTimer
)paren
)paren
suffix:semicolon
multiline_comment|/* 0.5 seconds */
id|writeb
c_func
(paren
l_int|0xFF
comma
op_amp
(paren
id|ICOM_PORT-&gt;dram-&gt;ier
)paren
)paren
suffix:semicolon
multiline_comment|/* enable modem signal interrupts */
multiline_comment|/* reset processor */
id|writeb
c_func
(paren
id|CMD_RESTART
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
l_int|10
suffix:semicolon
id|index
op_increment
)paren
(brace
r_if
c_cond
(paren
id|readb
c_func
(paren
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
op_eq
l_int|0x00
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Enable Transmitter and Reciever */
id|offset
op_assign
(paren
r_int
r_int
)paren
op_amp
id|ICOM_PORT-&gt;statStg-&gt;rcv
(braket
l_int|0
)braket
op_minus
(paren
r_int
r_int
)paren
id|ICOM_PORT-&gt;statStg
suffix:semicolon
id|writel
c_func
(paren
id|ICOM_PORT-&gt;statStg_pci
op_plus
id|offset
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;RcvStatusAddr
)paren
suffix:semicolon
id|ICOM_PORT-&gt;next_rcv
op_assign
l_int|0
suffix:semicolon
id|ICOM_PORT-&gt;put_length
op_assign
l_int|0
suffix:semicolon
op_star
id|ICOM_PORT-&gt;xmitRestart
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|ICOM_PORT-&gt;xmitRestart_pci
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;XmitStatusAddr
)paren
suffix:semicolon
id|trace
c_func
(paren
id|ICOM_PORT
comma
l_string|&quot;XR_ENAB&quot;
comma
l_int|0
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|CMD_XMIT_RCV_ENABLE
comma
op_amp
id|ICOM_PORT-&gt;dram-&gt;CmdReg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|port-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|icom_type
r_static
r_const
r_char
op_star
id|icom_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_string|&quot;icom&quot;
suffix:semicolon
)brace
DECL|function|icom_release_port
r_static
r_void
id|icom_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
)brace
DECL|function|icom_request_port
r_static
r_int
id|icom_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|icom_config_port
r_static
r_void
id|icom_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|flags
)paren
(brace
id|port-&gt;type
op_assign
id|PORT_ICOM
suffix:semicolon
)brace
DECL|variable|icom_ops
r_static
r_struct
id|uart_ops
id|icom_ops
op_assign
(brace
dot
id|tx_empty
op_assign
id|icom_tx_empty
comma
dot
id|set_mctrl
op_assign
id|icom_set_mctrl
comma
dot
id|get_mctrl
op_assign
id|icom_get_mctrl
comma
dot
id|stop_tx
op_assign
id|icom_stop_tx
comma
dot
id|start_tx
op_assign
id|icom_start_tx
comma
dot
id|send_xchar
op_assign
id|icom_send_xchar
comma
dot
id|stop_rx
op_assign
id|icom_stop_rx
comma
dot
id|enable_ms
op_assign
id|icom_enable_ms
comma
dot
id|break_ctl
op_assign
id|icom_break
comma
dot
id|startup
op_assign
id|icom_open
comma
dot
id|shutdown
op_assign
id|icom_close
comma
dot
id|set_termios
op_assign
id|icom_set_termios
comma
dot
id|type
op_assign
id|icom_type
comma
dot
id|release_port
op_assign
id|icom_release_port
comma
dot
id|request_port
op_assign
id|icom_request_port
comma
dot
id|config_port
op_assign
id|icom_config_port
comma
)brace
suffix:semicolon
DECL|macro|ICOM_CONSOLE
mdefine_line|#define ICOM_CONSOLE NULL
DECL|variable|icom_uart_driver
r_static
r_struct
id|uart_driver
id|icom_uart_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
id|ICOM_DRIVER_NAME
comma
dot
id|dev_name
op_assign
l_string|&quot;ttyA&quot;
comma
dot
id|major
op_assign
id|ICOM_MAJOR
comma
dot
id|minor
op_assign
id|ICOM_MINOR_START
comma
dot
id|nr
op_assign
id|NR_PORTS
comma
dot
id|cons
op_assign
id|ICOM_CONSOLE
comma
)brace
suffix:semicolon
DECL|function|icom_init_ports
r_static
r_int
id|__devinit
id|icom_init_ports
c_func
(paren
r_struct
id|icom_adapter
op_star
id|icom_adapter
)paren
(brace
id|u32
id|subsystem_id
op_assign
id|icom_adapter-&gt;subsystem_id
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|icom_port
op_star
id|icom_port
suffix:semicolon
r_if
c_cond
(paren
id|icom_adapter-&gt;version
op_eq
id|ADAPTER_V1
)paren
(brace
id|icom_adapter-&gt;numb_ports
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
id|i
)braket
suffix:semicolon
id|icom_port-&gt;port
op_assign
id|i
suffix:semicolon
id|icom_port-&gt;status
op_assign
id|ICOM_PORT_ACTIVE
suffix:semicolon
id|icom_port-&gt;imbed_modem
op_assign
id|ICOM_UNKNOWN
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|subsystem_id
op_eq
id|PCI_DEVICE_ID_IBM_ICOM_FOUR_PORT_MODEL
)paren
(brace
id|icom_adapter-&gt;numb_ports
op_assign
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
id|i
)braket
suffix:semicolon
id|icom_port-&gt;port
op_assign
id|i
suffix:semicolon
id|icom_port-&gt;status
op_assign
id|ICOM_PORT_ACTIVE
suffix:semicolon
id|icom_port-&gt;imbed_modem
op_assign
id|ICOM_IMBED_MODEM
suffix:semicolon
)brace
)brace
r_else
(brace
id|icom_adapter-&gt;numb_ports
op_assign
l_int|4
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|0
)braket
dot
id|port
op_assign
l_int|0
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|0
)braket
dot
id|status
op_assign
id|ICOM_PORT_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
id|subsystem_id
op_eq
id|PCI_DEVICE_ID_IBM_ICOM_V2_ONE_PORT_RVX_ONE_PORT_MDM
)paren
(brace
id|icom_adapter-&gt;port_info
(braket
l_int|0
)braket
dot
id|imbed_modem
op_assign
id|ICOM_IMBED_MODEM
suffix:semicolon
)brace
r_else
(brace
id|icom_adapter-&gt;port_info
(braket
l_int|0
)braket
dot
id|imbed_modem
op_assign
id|ICOM_RVX
suffix:semicolon
)brace
id|icom_adapter-&gt;port_info
(braket
l_int|1
)braket
dot
id|status
op_assign
id|ICOM_PORT_OFF
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|2
)braket
dot
id|port
op_assign
l_int|2
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|2
)braket
dot
id|status
op_assign
id|ICOM_PORT_ACTIVE
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|2
)braket
dot
id|imbed_modem
op_assign
id|ICOM_RVX
suffix:semicolon
id|icom_adapter-&gt;port_info
(braket
l_int|3
)braket
dot
id|status
op_assign
id|ICOM_PORT_OFF
suffix:semicolon
)brace
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|icom_port_active
r_static
r_void
id|icom_port_active
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
comma
r_struct
id|icom_adapter
op_star
id|icom_adapter
comma
r_int
id|port_num
)paren
(brace
r_if
c_cond
(paren
id|icom_adapter-&gt;version
op_eq
id|ADAPTER_V1
)paren
(brace
id|icom_port-&gt;global_reg
op_assign
(paren
r_struct
id|icom_regs
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x4000
)paren
suffix:semicolon
id|icom_port-&gt;int_reg
op_assign
(paren
r_int
r_int
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x4004
op_plus
l_int|2
op_minus
l_int|2
op_star
id|port_num
suffix:semicolon
)brace
r_else
(brace
id|icom_port-&gt;global_reg
op_assign
(paren
r_struct
id|icom_regs
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x8000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;port
OL
l_int|2
)paren
id|icom_port-&gt;int_reg
op_assign
(paren
r_int
r_int
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x8004
op_plus
l_int|2
op_minus
l_int|2
op_star
id|icom_port-&gt;port
suffix:semicolon
r_else
id|icom_port-&gt;int_reg
op_assign
(paren
r_int
r_int
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x8024
op_plus
l_int|2
op_minus
l_int|2
op_star
(paren
id|icom_port-&gt;port
op_minus
l_int|2
)paren
suffix:semicolon
)brace
)brace
DECL|function|icom_load_ports
r_static
r_int
id|__init
id|icom_load_ports
c_func
(paren
r_struct
id|icom_adapter
op_star
id|icom_adapter
)paren
(brace
r_struct
id|icom_port
op_star
id|icom_port
suffix:semicolon
r_int
id|port_num
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_for
c_loop
(paren
id|port_num
op_assign
l_int|0
suffix:semicolon
id|port_num
OL
id|icom_adapter-&gt;numb_ports
suffix:semicolon
id|port_num
op_increment
)paren
(brace
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
id|port_num
)braket
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;status
op_eq
id|ICOM_PORT_ACTIVE
)paren
(brace
id|icom_port_active
c_func
(paren
id|icom_port
comma
id|icom_adapter
comma
id|port_num
)paren
suffix:semicolon
id|icom_port-&gt;dram
op_assign
(paren
r_struct
id|func_dram
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|icom_adapter-&gt;base_addr
op_plus
l_int|0x2000
op_star
id|icom_port-&gt;port
)paren
suffix:semicolon
id|icom_port-&gt;adapter
op_assign
id|icom_adapter
suffix:semicolon
multiline_comment|/* get port memory */
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|get_port_memory
c_func
(paren
id|icom_port
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Memory allocation for port FAILED&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|icom_alloc_adapter
r_static
r_int
id|__devinit
id|icom_alloc_adapter
c_func
(paren
r_struct
id|icom_adapter
op_star
op_star
id|icom_adapter_ref
)paren
(brace
r_int
id|adapter_count
op_assign
l_int|0
suffix:semicolon
r_struct
id|icom_adapter
op_star
id|icom_adapter
suffix:semicolon
r_struct
id|icom_adapter
op_star
id|cur_adapter_entry
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
id|icom_adapter
op_assign
(paren
r_struct
id|icom_adapter
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|icom_adapter
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_adapter
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|icom_adapter
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|icom_adapter
)paren
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|icom_adapter_head
)paren
(brace
id|cur_adapter_entry
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|icom_adapter
comma
id|icom_adapter_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur_adapter_entry-&gt;index
op_ne
id|adapter_count
)paren
(brace
r_break
suffix:semicolon
)brace
id|adapter_count
op_increment
suffix:semicolon
)brace
id|icom_adapter-&gt;index
op_assign
id|adapter_count
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|icom_adapter-&gt;icom_adapter_entry
comma
id|tmp
)paren
suffix:semicolon
op_star
id|icom_adapter_ref
op_assign
id|icom_adapter
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|icom_free_adapter
r_static
r_void
id|icom_free_adapter
c_func
(paren
r_struct
id|icom_adapter
op_star
id|icom_adapter
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|icom_adapter-&gt;icom_adapter_entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
)brace
DECL|function|icom_remove_adapter
r_static
r_void
id|icom_remove_adapter
c_func
(paren
r_struct
id|icom_adapter
op_star
id|icom_adapter
)paren
(brace
r_struct
id|icom_port
op_star
id|icom_port
suffix:semicolon
r_int
id|index
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|icom_adapter-&gt;numb_ports
suffix:semicolon
id|index
op_increment
)paren
(brace
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;status
op_eq
id|ICOM_PORT_ACTIVE
)paren
(brace
id|dev_info
c_func
(paren
op_amp
id|icom_adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;Device removed&bslash;n&quot;
)paren
suffix:semicolon
id|uart_remove_one_port
c_func
(paren
op_amp
id|icom_uart_driver
comma
op_amp
id|icom_port-&gt;uart_port
)paren
suffix:semicolon
multiline_comment|/* be sure that DTR and RTS are dropped */
id|writeb
c_func
(paren
l_int|0x00
comma
op_amp
id|icom_port-&gt;dram-&gt;osr
)paren
suffix:semicolon
multiline_comment|/* Wait 0.1 Sec for simple Init to complete */
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Stop proccessor */
id|stop_processor
c_func
(paren
id|icom_port
)paren
suffix:semicolon
id|free_port_memory
c_func
(paren
id|icom_port
)paren
suffix:semicolon
)brace
)brace
id|free_irq
c_func
(paren
id|icom_adapter-&gt;irq_number
comma
(paren
r_void
op_star
)paren
id|icom_adapter
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|icom_adapter-&gt;base_addr
)paren
suffix:semicolon
id|icom_free_adapter
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|icom_adapter-&gt;pci_dev
)paren
suffix:semicolon
)brace
DECL|function|icom_kobj_release
r_static
r_void
id|icom_kobj_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
r_struct
id|icom_adapter
op_star
id|icom_adapter
suffix:semicolon
id|icom_adapter
op_assign
id|to_icom_adapter
c_func
(paren
id|kobj
)paren
suffix:semicolon
id|icom_remove_adapter
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
)brace
DECL|variable|icom_kobj_type
r_static
r_struct
id|kobj_type
id|icom_kobj_type
op_assign
(brace
dot
id|release
op_assign
id|icom_kobj_release
comma
)brace
suffix:semicolon
DECL|function|icom_probe
r_static
r_int
id|__devinit
id|icom_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
id|index
suffix:semicolon
r_int
r_int
id|command_reg
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|icom_adapter
op_star
id|icom_adapter
suffix:semicolon
r_struct
id|icom_port
op_star
id|icom_port
suffix:semicolon
id|retval
op_assign
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Device enable FAILED&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|pci_request_regions
c_func
(paren
id|dev
comma
l_string|&quot;icom&quot;
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;pci_request_region FAILED&bslash;n&quot;
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|command_reg
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;PCI Config read FAILED&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|command_reg
op_or
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ent-&gt;driver_data
op_eq
id|ADAPTER_V1
)paren
(brace
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x44
comma
l_int|0x8300830A
)paren
suffix:semicolon
)brace
r_else
(brace
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x44
comma
l_int|0x42004200
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x48
comma
l_int|0x42004200
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|icom_alloc_adapter
c_func
(paren
op_amp
id|icom_adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;icom_alloc_adapter FAILED&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|probe_exit0
suffix:semicolon
)brace
id|icom_adapter-&gt;base_addr_pci
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|icom_adapter-&gt;irq_number
op_assign
id|dev-&gt;irq
suffix:semicolon
id|icom_adapter-&gt;pci_dev
op_assign
id|dev
suffix:semicolon
id|icom_adapter-&gt;version
op_assign
id|ent-&gt;driver_data
suffix:semicolon
id|icom_adapter-&gt;subsystem_id
op_assign
id|ent-&gt;subdevice
suffix:semicolon
id|retval
op_assign
id|icom_init_ports
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Port configuration failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|probe_exit1
suffix:semicolon
)brace
id|icom_adapter-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|icom_adapter-&gt;base_addr_pci
comma
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|icom_adapter-&gt;base_addr
)paren
r_goto
id|probe_exit1
suffix:semicolon
multiline_comment|/* save off irq and request irq line */
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|icom_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|ICOM_DRIVER_NAME
comma
(paren
r_void
op_star
)paren
id|icom_adapter
)paren
)paren
)paren
(brace
r_goto
id|probe_exit2
suffix:semicolon
)brace
id|retval
op_assign
id|icom_load_ports
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|icom_adapter-&gt;numb_ports
suffix:semicolon
id|index
op_increment
)paren
(brace
id|icom_port
op_assign
op_amp
id|icom_adapter-&gt;port_info
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|icom_port-&gt;status
op_eq
id|ICOM_PORT_ACTIVE
)paren
(brace
id|icom_port-&gt;uart_port.irq
op_assign
id|icom_port-&gt;adapter-&gt;irq_number
suffix:semicolon
id|icom_port-&gt;uart_port.type
op_assign
id|PORT_ICOM
suffix:semicolon
id|icom_port-&gt;uart_port.iotype
op_assign
id|UPIO_MEM
suffix:semicolon
id|icom_port-&gt;uart_port.membase
op_assign
(paren
r_char
op_star
)paren
id|icom_adapter-&gt;base_addr_pci
suffix:semicolon
id|icom_port-&gt;uart_port.fifosize
op_assign
l_int|16
suffix:semicolon
id|icom_port-&gt;uart_port.ops
op_assign
op_amp
id|icom_ops
suffix:semicolon
id|icom_port-&gt;uart_port.line
op_assign
id|icom_port-&gt;port
op_plus
id|icom_adapter-&gt;index
op_star
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|uart_add_one_port
(paren
op_amp
id|icom_uart_driver
comma
op_amp
id|icom_port-&gt;uart_port
)paren
)paren
(brace
id|icom_port-&gt;status
op_assign
id|ICOM_PORT_OFF
suffix:semicolon
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Device add failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|dev_info
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Device added&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|kobject_init
c_func
(paren
op_amp
id|icom_adapter-&gt;kobj
)paren
suffix:semicolon
id|icom_adapter-&gt;kobj.ktype
op_assign
op_amp
id|icom_kobj_type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|probe_exit2
suffix:colon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|icom_adapter-&gt;base_addr
)paren
suffix:semicolon
id|probe_exit1
suffix:colon
id|icom_free_adapter
c_func
(paren
id|icom_adapter
)paren
suffix:semicolon
id|probe_exit0
suffix:colon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|icom_remove
r_static
r_void
id|__devexit
id|icom_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|icom_adapter
op_star
id|icom_adapter
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
id|list_for_each
c_func
(paren
id|tmp
comma
op_amp
id|icom_adapter_head
)paren
(brace
id|icom_adapter
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|icom_adapter
comma
id|icom_adapter_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|icom_adapter-&gt;pci_dev
op_eq
id|dev
)paren
(brace
id|kobject_put
c_func
(paren
op_amp
id|icom_adapter-&gt;kobj
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Unable to find device to remove&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|icom_pci_driver
r_static
r_struct
id|pci_driver
id|icom_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|ICOM_DRIVER_NAME
comma
dot
id|id_table
op_assign
id|icom_pci_table
comma
dot
id|probe
op_assign
id|icom_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|icom_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|icom_init
r_static
r_int
id|__init
id|icom_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|icom_lock
)paren
suffix:semicolon
id|icom_lock
op_assign
(paren
id|spinlock_t
)paren
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ret
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|icom_uart_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|pci_register_driver
c_func
(paren
op_amp
id|icom_pci_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
id|uart_unregister_driver
c_func
(paren
op_amp
id|icom_uart_driver
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|icom_exit
r_static
r_void
id|__exit
id|icom_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|icom_pci_driver
)paren
suffix:semicolon
id|uart_unregister_driver
c_func
(paren
op_amp
id|icom_uart_driver
)paren
suffix:semicolon
)brace
DECL|variable|icom_init
id|module_init
c_func
(paren
id|icom_init
)paren
suffix:semicolon
DECL|variable|icom_exit
id|module_exit
c_func
(paren
id|icom_exit
)paren
suffix:semicolon
macro_line|#ifdef ICOM_TRACE
DECL|function|trace
r_static
r_inline
r_void
id|trace
c_func
(paren
r_struct
id|icom_port
op_star
id|icom_port
comma
r_char
op_star
id|trace_pt
comma
r_int
r_int
id|trace_data
)paren
(brace
id|dev_info
c_func
(paren
op_amp
id|icom_port-&gt;adapter-&gt;pci_dev-&gt;dev
comma
l_string|&quot;:%d:%s - %lx&bslash;n&quot;
comma
id|icom_port-&gt;port
comma
id|trace_pt
comma
id|trace_data
)paren
suffix:semicolon
)brace
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Michael Anderson &lt;mjanders@us.ibm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;IBM iSeries Serial IOA driver&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
(paren
l_string|&quot;IBM iSeries 2745, 2771, 2772, 2742, 2793 and 2805 Communications adapters&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
