multiline_comment|/*&n; * dz.c: Serial port driver for DECStations equiped &n; *       with the DZ chipset.&n; *&n; * Copyright (C) 1998 Olivier A. D. Lebaillif &n; *             &n; * Email: olivier.lebaillif@ifrsys.com&n; *&n; * [31-AUG-98] triemer&n; * Changed IRQ to use Harald&squot;s dec internals interrupts.h&n; * removed base_addr code - moving address assignment to setup.c&n; * Changed name of dz_init to rs_init to be consistent with tc code&n; * [13-NOV-98] triemer fixed code to receive characters&n; *    after patches by harald to irq code.  &n; * [09-JAN-99] triemer minor fix for schedule - due to removal of timeout&n; *            field from &quot;current&quot; - somewhere between 2.1.121 and 2.1.131&n; Qua Jun 27 15:02:26 BRT 2001&n; * [27-JUN-2001] Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - cleanups&n; *  &n; * Parts (C) 1999 David Airlie, airlied@linux.ie &n; * [07-SEP-99] Bugfixes &n; *&n; * [06-Jan-2002] Russell King &lt;rmk@arm.linux.org.uk&gt;&n; * Converted to new serial core&n; */
DECL|macro|DEBUG_DZ
macro_line|#undef DEBUG_DZ
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/tty_flip.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/dec/interrupts.h&gt;
macro_line|#include &lt;asm/dec/kn01.h&gt;
macro_line|#include &lt;asm/dec/kn02.h&gt;
macro_line|#include &lt;asm/dec/machtype.h&gt;
macro_line|#include &lt;asm/dec/prom.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|CONSOLE_LINE
mdefine_line|#define CONSOLE_LINE (3)&t;/* for definition of struct console */
macro_line|#include &quot;dz.h&quot;
DECL|macro|DZ_INTR_DEBUG
mdefine_line|#define DZ_INTR_DEBUG 1
DECL|variable|dz_name
r_static
r_char
op_star
id|dz_name
op_assign
l_string|&quot;DECstation DZ serial driver version &quot;
suffix:semicolon
DECL|variable|dz_version
r_static
r_char
op_star
id|dz_version
op_assign
l_string|&quot;1.02&quot;
suffix:semicolon
DECL|struct|dz_port
r_struct
id|dz_port
(brace
DECL|member|port
r_struct
id|uart_port
id|port
suffix:semicolon
DECL|member|cflag
r_int
r_int
id|cflag
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|dz_ports
r_static
r_struct
id|dz_port
id|dz_ports
(braket
id|DZ_NB_PORT
)braket
suffix:semicolon
macro_line|#ifdef DEBUG_DZ
multiline_comment|/*&n; * debugging code to send out chars via prom &n; */
DECL|function|debug_console
r_static
r_void
id|debug_console
c_func
(paren
r_const
r_char
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|s
op_eq
l_int|10
)paren
id|prom_printf
c_func
(paren
l_string|&quot;%c&quot;
comma
l_int|13
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;%c&quot;
comma
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * ------------------------------------------------------------&n; * dz_in () and dz_out ()&n; *&n; * These routines are used to access the registers of the DZ &n; * chip, hiding relocation differences between implementation.&n; * ------------------------------------------------------------&n; */
DECL|function|dz_in
r_static
r_inline
r_int
r_int
id|dz_in
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
comma
r_int
id|offset
)paren
(brace
r_volatile
r_int
r_int
op_star
id|addr
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
(paren
id|dport-&gt;port.membase
op_plus
id|offset
)paren
suffix:semicolon
r_return
op_star
id|addr
suffix:semicolon
)brace
DECL|function|dz_out
r_static
r_inline
r_void
id|dz_out
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
comma
r_int
id|offset
comma
r_int
r_int
id|value
)paren
(brace
r_volatile
r_int
r_int
op_star
id|addr
op_assign
(paren
r_volatile
r_int
r_int
op_star
)paren
(paren
id|dport-&gt;port.membase
op_plus
id|offset
)paren
suffix:semicolon
op_star
id|addr
op_assign
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------&n; * rs_stop () and rs_start ()&n; *&n; * These routines are called before setting or resetting &n; * tty-&gt;stopped. They enable or disable transmitter interrupts, &n; * as necessary.&n; * ------------------------------------------------------------&n; */
DECL|function|dz_stop_tx
r_static
r_void
id|dz_stop_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
comma
r_int
r_int
id|tty_stop
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|tmp
comma
id|mask
op_assign
l_int|1
op_lshift
id|dport-&gt;port.line
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_TCR
)paren
suffix:semicolon
multiline_comment|/* read the TX flag */
id|tmp
op_and_assign
op_complement
id|mask
suffix:semicolon
multiline_comment|/* clear the TX flag */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TCR
comma
id|tmp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dz_start_tx
r_static
r_void
id|dz_start_tx
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
comma
r_int
r_int
id|tty_start
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|tmp
comma
id|mask
op_assign
l_int|1
op_lshift
id|dport-&gt;port.line
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_TCR
)paren
suffix:semicolon
multiline_comment|/* read the TX flag */
id|tmp
op_or_assign
id|mask
suffix:semicolon
multiline_comment|/* set the TX flag */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TCR
comma
id|tmp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dz_stop_rx
r_static
r_void
id|dz_stop_rx
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|dport-&gt;cflag
op_and_assign
op_complement
id|DZ_CREAD
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_LPR
comma
id|dport-&gt;cflag
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dz_enable_ms
r_static
r_void
id|dz_enable_ms
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
multiline_comment|/* nothing to do */
)brace
multiline_comment|/*&n; * ------------------------------------------------------------&n; * Here starts the interrupt handling routines.  All of the &n; * following subroutines are declared as inline and are folded &n; * into dz_interrupt.  They were separated out for readability&squot;s &n; * sake. &n; *&n; * Note: rs_interrupt() is a &quot;fast&quot; interrupt, which means that it&n; * runs with interrupts turned off.  People who may want to modify&n; * rs_interrupt() should try to keep the interrupt handler as fast as&n; * possible.  After you are done making modifications, it is not a bad&n; * idea to do:&n; * &n; *&t;make drivers/serial/dz.s&n; *&n; * and look at the resulting assemble code in dz.s.&n; *&n; * ------------------------------------------------------------&n; */
multiline_comment|/*&n; * ------------------------------------------------------------&n; * receive_char ()&n; *&n; * This routine deals with inputs from any lines.&n; * ------------------------------------------------------------&n; */
DECL|function|dz_receive_chars
r_static
r_inline
r_void
id|dz_receive_chars
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
)paren
(brace
r_struct
id|tty_struct
op_star
id|tty
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|uart_icount
op_star
id|icount
suffix:semicolon
r_int
id|ignore
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|status
comma
id|tmp
suffix:semicolon
r_int
r_char
id|ch
comma
id|flag
suffix:semicolon
multiline_comment|/* this code is going to be a problem...&n;&t;   the call to tty_flip_buffer is going to need&n;&t;   to be rethought...&n;&t; */
r_do
(brace
id|status
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_RBUF
)paren
suffix:semicolon
multiline_comment|/* punt so we don&squot;t get duplicate characters */
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|DZ_DVAL
)paren
)paren
r_goto
id|ignore_char
suffix:semicolon
id|ch
op_assign
id|UCHAR
c_func
(paren
id|status
)paren
suffix:semicolon
multiline_comment|/* grab the char */
id|flag
op_assign
id|TTY_NORMAL
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|info-&gt;is_console
)paren
(brace
r_if
c_cond
(paren
id|ch
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* it&squot;s a break ... */
)brace
macro_line|#endif
id|tty
op_assign
id|dport-&gt;port.info-&gt;tty
suffix:semicolon
multiline_comment|/* now tty points to the proper dev */
id|icount
op_assign
op_amp
id|dport-&gt;port.icount
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tty
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|tty-&gt;flip.count
op_ge
id|TTY_FLIPBUF_SIZE
)paren
r_break
suffix:semicolon
id|icount-&gt;rx
op_increment
suffix:semicolon
multiline_comment|/* keep track of the statistics */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|DZ_OERR
op_or
id|DZ_FERR
op_or
id|DZ_PERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|DZ_PERR
)paren
multiline_comment|/* parity error */
id|icount-&gt;parity
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|status
op_amp
id|DZ_FERR
)paren
multiline_comment|/* frame error */
id|icount-&gt;frame
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DZ_OERR
)paren
multiline_comment|/* overrun error */
id|icount-&gt;overrun
op_increment
suffix:semicolon
multiline_comment|/*  check to see if we should ignore the character&n;&t;&t;&t;   and mask off conditions that should be ignored&n;&t;&t;&t; */
r_if
c_cond
(paren
id|status
op_amp
id|dport-&gt;port.ignore_status_mask
)paren
(brace
r_if
c_cond
(paren
op_increment
id|ignore
OG
l_int|100
)paren
r_break
suffix:semicolon
r_goto
id|ignore_char
suffix:semicolon
)brace
multiline_comment|/* mask off the error conditions we want to ignore */
id|tmp
op_assign
id|status
op_amp
id|dport-&gt;port.read_status_mask
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|DZ_PERR
)paren
(brace
id|flag
op_assign
id|TTY_PARITY
suffix:semicolon
macro_line|#ifdef DEBUG_DZ
id|debug_console
c_func
(paren
l_string|&quot;PERR&bslash;n&quot;
comma
l_int|5
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_amp
id|DZ_FERR
)paren
(brace
id|flag
op_assign
id|TTY_FRAME
suffix:semicolon
macro_line|#ifdef DEBUG_DZ
id|debug_console
c_func
(paren
l_string|&quot;FERR&bslash;n&quot;
comma
l_int|5
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|tmp
op_amp
id|DZ_OERR
)paren
(brace
macro_line|#ifdef DEBUG_DZ
id|debug_console
c_func
(paren
l_string|&quot;OERR&bslash;n&quot;
comma
l_int|5
)paren
suffix:semicolon
macro_line|#endif
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
id|ch
comma
id|flag
)paren
suffix:semicolon
id|ch
op_assign
l_int|0
suffix:semicolon
id|flag
op_assign
id|TTY_OVERRUN
suffix:semicolon
)brace
)brace
id|tty_insert_flip_char
c_func
(paren
id|tty
comma
id|ch
comma
id|flag
)paren
suffix:semicolon
id|ignore_char
suffix:colon
)brace
r_while
c_loop
(paren
id|status
op_amp
id|DZ_DVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tty
)paren
id|tty_flip_buffer_push
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------&n; * transmit_char ()&n; *&n; * This routine deals with outputs to any lines.&n; * ------------------------------------------------------------&n; */
DECL|function|dz_transmit_chars
r_static
r_inline
r_void
id|dz_transmit_chars
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
)paren
(brace
r_struct
id|circ_buf
op_star
id|xmit
op_assign
op_amp
id|dport-&gt;port.info-&gt;xmit
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|dport-&gt;port.x_char
)paren
(brace
multiline_comment|/* XON/XOFF chars */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TDR
comma
id|dport-&gt;port.x_char
)paren
suffix:semicolon
id|dport-&gt;port.icount.tx
op_increment
suffix:semicolon
id|dport-&gt;port.x_char
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* if nothing to do or stopped or hardware stopped */
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
op_logical_or
id|uart_tx_stopped
c_func
(paren
op_amp
id|dport-&gt;port
)paren
)paren
(brace
id|dz_stop_tx
c_func
(paren
op_amp
id|dport-&gt;port
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * if something to do ... (rember the dz has no output fifo so we go&n;&t; * one char at a time :-&lt;&n;&t; */
id|tmp
op_assign
id|xmit-&gt;buf
(braket
id|xmit-&gt;tail
)braket
suffix:semicolon
id|xmit-&gt;tail
op_assign
(paren
id|xmit-&gt;tail
op_plus
l_int|1
)paren
op_amp
(paren
id|DZ_XMIT_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TDR
comma
id|tmp
)paren
suffix:semicolon
id|dport-&gt;port.icount.tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|uart_circ_chars_pending
c_func
(paren
id|xmit
)paren
OL
id|DZ_WAKEUP_CHARS
)paren
id|uart_write_wakeup
c_func
(paren
op_amp
id|dport-&gt;port
)paren
suffix:semicolon
multiline_comment|/* Are we done */
r_if
c_cond
(paren
id|uart_circ_empty
c_func
(paren
id|xmit
)paren
)paren
id|dz_stop_tx
c_func
(paren
op_amp
id|dport-&gt;port
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------&n; * check_modem_status ()&n; *&n; * Only valid for the MODEM line duh !&n; * ------------------------------------------------------------&n; */
DECL|function|check_modem_status
r_static
r_inline
r_void
id|check_modem_status
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
)paren
(brace
r_int
r_int
id|status
suffix:semicolon
multiline_comment|/* if not ne modem line just return */
r_if
c_cond
(paren
id|dport-&gt;port.line
op_ne
id|DZ_MODEM
)paren
r_return
suffix:semicolon
id|status
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_MSR
)paren
suffix:semicolon
multiline_comment|/* it&squot;s easy, since DSR2 is the only bit in the register */
r_if
c_cond
(paren
id|status
)paren
id|dport-&gt;port.icount.dsr
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * ------------------------------------------------------------&n; * dz_interrupt ()&n; *&n; * this is the main interrupt routine for the DZ chip.&n; * It deals with the multiple ports.&n; * ------------------------------------------------------------&n; */
DECL|function|dz_interrupt
r_static
id|irqreturn_t
id|dz_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
multiline_comment|/* get the reason why we just got an irq */
id|status
op_assign
id|dz_in
c_func
(paren
(paren
r_struct
id|dz_port
op_star
)paren
id|dev
comma
id|DZ_CSR
)paren
suffix:semicolon
id|dport
op_assign
op_amp
id|dz_ports
(braket
id|LINE
c_func
(paren
id|status
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DZ_RDONE
)paren
id|dz_receive_chars
c_func
(paren
id|dport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DZ_TRDY
)paren
id|dz_transmit_chars
c_func
(paren
id|dport
)paren
suffix:semicolon
multiline_comment|/* FIXME: what about check modem status??? --rmk */
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n; * -------------------------------------------------------------------&n; * Here ends the DZ interrupt routines.&n; * -------------------------------------------------------------------&n; */
DECL|function|dz_get_mctrl
r_static
r_int
r_int
id|dz_get_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|mctrl
op_assign
id|TIOCM_CAR
op_or
id|TIOCM_DSR
op_or
id|TIOCM_CTS
suffix:semicolon
r_if
c_cond
(paren
id|dport-&gt;port.line
op_eq
id|DZ_MODEM
)paren
(brace
multiline_comment|/*&n;&t;&t; * CHECKME: This is a guess from the other code... --rmk&n;&t;&t; */
r_if
c_cond
(paren
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_MSR
)paren
op_amp
id|DZ_MODEM_DSR
)paren
id|mctrl
op_and_assign
op_complement
id|TIOCM_DSR
suffix:semicolon
)brace
r_return
id|mctrl
suffix:semicolon
)brace
DECL|function|dz_set_mctrl
r_static
r_void
id|dz_set_mctrl
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
comma
r_int
r_int
id|mctrl
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|dport-&gt;port.line
op_eq
id|DZ_MODEM
)paren
(brace
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_TCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mctrl
op_amp
id|TIOCM_DTR
)paren
id|tmp
op_and_assign
op_complement
id|DZ_MODEM_DTR
suffix:semicolon
r_else
id|tmp
op_or_assign
id|DZ_MODEM_DTR
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TCR
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * -------------------------------------------------------------------&n; * startup ()&n; *&n; * various initialization tasks&n; * ------------------------------------------------------------------- &n; */
DECL|function|dz_startup
r_static
r_int
id|dz_startup
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/* The dz lines for the mouse/keyboard must be&n;&t; * opened using their respective drivers.&n;&t; */
r_if
c_cond
(paren
(paren
id|dport-&gt;port.line
op_eq
id|DZ_KEYBOARD
)paren
op_logical_or
(paren
id|dport-&gt;port.line
op_eq
id|DZ_MOUSE
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* enable the interrupt and the scanning */
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_CSR
)paren
suffix:semicolon
id|tmp
op_or_assign
id|DZ_RIE
op_or
id|DZ_TIE
op_or
id|DZ_MSE
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_CSR
comma
id|tmp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * -------------------------------------------------------------------&n; * shutdown ()&n; *&n; * This routine will shutdown a serial port; interrupts are disabled, and&n; * DTR is dropped if the hangup on close termio flag is on.&n; * ------------------------------------------------------------------- &n; */
DECL|function|dz_shutdown
r_static
r_void
id|dz_shutdown
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
)paren
(brace
id|dz_stop_tx
c_func
(paren
id|uport
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * get_lsr_info - get line status register info&n; *&n; * Purpose: Let user call ioctl() to get info when the UART physically&n; *          is emptied.  On bus types like RS485, the transmitter must&n; *          release the bus after transmitting. This must be done when&n; *          the transmit shift register is empty, not be done when the&n; *          transmit holding register is empty.  This functionality&n; *          allows an RS485 driver to be written in user space. &n; */
DECL|function|dz_tx_empty
r_static
r_int
r_int
id|dz_tx_empty
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|status
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_LPR
)paren
suffix:semicolon
multiline_comment|/* FIXME: this appears to be obviously broken --rmk. */
r_return
id|status
ques
c_cond
id|TIOCSER_TEMT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|dz_break_ctl
r_static
r_void
id|dz_break_ctl
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
comma
r_int
id|break_state
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|tmp
comma
id|mask
op_assign
l_int|1
op_lshift
id|uport-&gt;line
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|uport-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_TCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|break_state
)paren
id|tmp
op_or_assign
id|mask
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|mask
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TCR
comma
id|tmp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|uport-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dz_set_termios
r_static
r_void
id|dz_set_termios
c_func
(paren
r_struct
id|uart_port
op_star
id|uport
comma
r_struct
id|termios
op_star
id|termios
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
(paren
r_struct
id|dz_port
op_star
)paren
id|uport
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|cflag
comma
id|baud
suffix:semicolon
id|cflag
op_assign
id|dport-&gt;port.line
suffix:semicolon
r_switch
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSIZE
)paren
(brace
r_case
id|CS5
suffix:colon
id|cflag
op_or_assign
id|DZ_CS5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS6
suffix:colon
id|cflag
op_or_assign
id|DZ_CS6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS7
suffix:colon
id|cflag
op_or_assign
id|DZ_CS7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS8
suffix:colon
r_default
suffix:colon
id|cflag
op_or_assign
id|DZ_CS8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CSTOPB
)paren
id|cflag
op_or_assign
id|DZ_CSTOPB
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARENB
)paren
id|cflag
op_or_assign
id|DZ_PARENB
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|PARODD
)paren
id|cflag
op_or_assign
id|DZ_PARODD
suffix:semicolon
id|baud
op_assign
id|uart_get_baud_rate
c_func
(paren
id|uport
comma
id|termios
comma
id|old_termios
comma
l_int|50
comma
l_int|9600
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|baud
)paren
(brace
r_case
l_int|50
suffix:colon
id|cflag
op_or_assign
id|DZ_B50
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|75
suffix:colon
id|cflag
op_or_assign
id|DZ_B75
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|110
suffix:colon
id|cflag
op_or_assign
id|DZ_B110
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|134
suffix:colon
id|cflag
op_or_assign
id|DZ_B134
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|150
suffix:colon
id|cflag
op_or_assign
id|DZ_B150
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|300
suffix:colon
id|cflag
op_or_assign
id|DZ_B300
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|600
suffix:colon
id|cflag
op_or_assign
id|DZ_B600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1200
suffix:colon
id|cflag
op_or_assign
id|DZ_B1200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1800
suffix:colon
id|cflag
op_or_assign
id|DZ_B1800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2000
suffix:colon
id|cflag
op_or_assign
id|DZ_B2000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2400
suffix:colon
id|cflag
op_or_assign
id|DZ_B2400
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3600
suffix:colon
id|cflag
op_or_assign
id|DZ_B3600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4800
suffix:colon
id|cflag
op_or_assign
id|DZ_B4800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7200
suffix:colon
id|cflag
op_or_assign
id|DZ_B7200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9600
suffix:colon
r_default
suffix:colon
id|cflag
op_or_assign
id|DZ_B9600
suffix:semicolon
)brace
r_if
c_cond
(paren
id|termios-&gt;c_cflag
op_amp
id|CREAD
)paren
id|cflag
op_or_assign
id|DZ_RXENAB
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_LPR
comma
id|cflag
)paren
suffix:semicolon
id|dport-&gt;cflag
op_assign
id|cflag
suffix:semicolon
multiline_comment|/* setup accept flag */
id|dport-&gt;port.read_status_mask
op_assign
id|DZ_OERR
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|INPCK
)paren
id|dport-&gt;port.read_status_mask
op_or_assign
id|DZ_FERR
op_or
id|DZ_PERR
suffix:semicolon
multiline_comment|/* characters to ignore */
id|uport-&gt;ignore_status_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|termios-&gt;c_iflag
op_amp
id|IGNPAR
)paren
id|dport-&gt;port.ignore_status_mask
op_or_assign
id|DZ_FERR
op_or
id|DZ_PERR
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dz_type
r_static
r_const
r_char
op_star
id|dz_type
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_string|&quot;DZ&quot;
suffix:semicolon
)brace
DECL|function|dz_release_port
r_static
r_void
id|dz_release_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
multiline_comment|/* nothing to do */
)brace
DECL|function|dz_request_port
r_static
r_int
id|dz_request_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dz_config_port
r_static
r_void
id|dz_config_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|UART_CONFIG_TYPE
)paren
id|port-&gt;type
op_assign
id|PORT_DZ
suffix:semicolon
)brace
multiline_comment|/*&n; * verify the new serial_struct (for TIOCSSERIAL).&n; */
DECL|function|dz_verify_port
r_static
r_int
id|dz_verify_port
c_func
(paren
r_struct
id|uart_port
op_star
id|port
comma
r_struct
id|serial_struct
op_star
id|ser
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ser-&gt;type
op_ne
id|PORT_UNKNOWN
op_logical_and
id|ser-&gt;type
op_ne
id|PORT_DZ
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ser-&gt;irq
op_ne
id|port-&gt;irq
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|dz_ops
r_static
r_struct
id|uart_ops
id|dz_ops
op_assign
(brace
dot
id|tx_empty
op_assign
id|dz_tx_empty
comma
dot
id|get_mctrl
op_assign
id|dz_get_mctrl
comma
dot
id|set_mctrl
op_assign
id|dz_set_mctrl
comma
dot
id|stop_tx
op_assign
id|dz_stop_tx
comma
dot
id|start_tx
op_assign
id|dz_start_tx
comma
dot
id|stop_rx
op_assign
id|dz_stop_rx
comma
dot
id|enable_ms
op_assign
id|dz_enable_ms
comma
dot
id|break_ctl
op_assign
id|dz_break_ctl
comma
dot
id|startup
op_assign
id|dz_startup
comma
dot
id|shutdown
op_assign
id|dz_shutdown
comma
dot
id|set_termios
op_assign
id|dz_set_termios
comma
dot
id|type
op_assign
id|dz_type
comma
dot
id|release_port
op_assign
id|dz_release_port
comma
dot
id|request_port
op_assign
id|dz_request_port
comma
dot
id|config_port
op_assign
id|dz_config_port
comma
dot
id|verify_port
op_assign
id|dz_verify_port
comma
)brace
suffix:semicolon
DECL|function|dz_init_ports
r_static
r_void
id|__init
id|dz_init_ports
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|first
op_assign
l_int|1
suffix:semicolon
r_struct
id|dz_port
op_star
id|dport
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first
)paren
r_return
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mips_machtype
op_eq
id|MACH_DS23100
op_logical_or
id|mips_machtype
op_eq
id|MACH_DS5100
)paren
id|base
op_assign
(paren
r_int
r_int
)paren
id|KN01_DZ11_BASE
suffix:semicolon
r_else
id|base
op_assign
(paren
r_int
r_int
)paren
id|KN02_DZ11_BASE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|dport
op_assign
id|dz_ports
suffix:semicolon
id|i
OL
id|DZ_NB_PORT
suffix:semicolon
id|i
op_increment
comma
id|dport
op_increment
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|dport-&gt;port.lock
)paren
suffix:semicolon
id|dport-&gt;port.membase
op_assign
(paren
r_char
op_star
)paren
id|base
suffix:semicolon
id|dport-&gt;port.iotype
op_assign
id|SERIAL_IO_PORT
suffix:semicolon
id|dport-&gt;port.irq
op_assign
id|dec_interrupt
(braket
id|DEC_IRQ_DZ11
)braket
suffix:semicolon
id|dport-&gt;port.line
op_assign
id|i
suffix:semicolon
id|dport-&gt;port.fifosize
op_assign
l_int|1
suffix:semicolon
id|dport-&gt;port.ops
op_assign
op_amp
id|dz_ops
suffix:semicolon
id|dport-&gt;port.flags
op_assign
id|UPF_BOOT_AUTOCONF
suffix:semicolon
)brace
)brace
DECL|function|dz_reset
r_static
r_void
id|dz_reset
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
)paren
(brace
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_CSR
comma
id|DZ_CLR
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_CSR
)paren
op_amp
id|DZ_CLR
)paren
suffix:semicolon
multiline_comment|/* FIXME: cpu_relax? */
id|iob
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* enable scanning */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_CSR
comma
id|DZ_MSE
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SERIAL_DZ_CONSOLE
DECL|function|dz_console_put_char
r_static
r_void
id|dz_console_put_char
c_func
(paren
r_struct
id|dz_port
op_star
id|dport
comma
r_int
r_char
id|ch
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|loops
op_assign
l_int|2500
suffix:semicolon
r_int
r_int
id|tmp
op_assign
id|ch
suffix:semicolon
multiline_comment|/* this code sends stuff out to serial device - spinning its&n;&t;   wheels and waiting. */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* spin our wheels */
r_while
c_loop
(paren
(paren
(paren
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_CSR
)paren
op_amp
id|DZ_TRDY
)paren
op_ne
id|DZ_TRDY
)paren
op_logical_and
id|loops
op_decrement
)paren
multiline_comment|/* FIXME: cpu_relax, udelay? --rmk */
suffix:semicolon
multiline_comment|/* Actually transmit the character. */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TDR
comma
id|tmp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dport-&gt;port.lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * -------------------------------------------------------------------&n; * dz_console_print ()&n; *&n; * dz_console_print is registered for printk.&n; * The console must be locked when we get here.&n; * ------------------------------------------------------------------- &n; */
DECL|function|dz_console_print
r_static
r_void
id|dz_console_print
c_func
(paren
r_struct
id|console
op_star
id|cons
comma
r_const
r_char
op_star
id|str
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
op_amp
id|dz_ports
(braket
id|CONSOLE_LINE
)braket
suffix:semicolon
macro_line|#ifdef DEBUG_DZ
id|prom_printf
c_func
(paren
(paren
r_char
op_star
)paren
id|str
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|dz_console_put_char
c_func
(paren
id|dport
comma
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|dz_console_put_char
c_func
(paren
id|dport
comma
op_star
id|str
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|dz_console_setup
r_static
r_int
id|__init
id|dz_console_setup
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|dz_port
op_star
id|dport
op_assign
op_amp
id|dz_ports
(braket
id|CONSOLE_LINE
)braket
suffix:semicolon
r_int
id|baud
op_assign
l_int|9600
suffix:semicolon
r_int
id|bits
op_assign
l_int|8
suffix:semicolon
r_int
id|parity
op_assign
l_char|&squot;n&squot;
suffix:semicolon
r_int
id|flow
op_assign
l_char|&squot;n&squot;
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
r_int
id|mask
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|options
)paren
id|uart_parse_options
c_func
(paren
id|options
comma
op_amp
id|baud
comma
op_amp
id|parity
comma
op_amp
id|bits
comma
op_amp
id|flow
)paren
suffix:semicolon
id|dz_reset
c_func
(paren
id|dport
)paren
suffix:semicolon
id|ret
op_assign
id|uart_set_options
c_func
(paren
op_amp
id|dport-&gt;port
comma
id|co
comma
id|baud
comma
id|parity
comma
id|bits
comma
id|flow
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
id|mask
op_assign
l_int|1
op_lshift
id|dport-&gt;port.line
suffix:semicolon
id|tmp
op_assign
id|dz_in
c_func
(paren
id|dport
comma
id|DZ_TCR
)paren
suffix:semicolon
multiline_comment|/* read the TX flag */
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|mask
)paren
)paren
(brace
id|tmp
op_or_assign
id|mask
suffix:semicolon
multiline_comment|/* set the TX flag */
id|dz_out
c_func
(paren
id|dport
comma
id|DZ_TCR
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|dz_sercons
r_static
r_struct
id|console
id|dz_sercons
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ttyS&quot;
comma
dot
id|write
op_assign
id|dz_console_print
comma
dot
id|device
op_assign
id|uart_console_device
comma
dot
id|setup
op_assign
id|dz_console_setup
comma
dot
id|flags
op_assign
id|CON_CONSDEV
op_or
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
id|CONSOLE_LINE
comma
)brace
suffix:semicolon
DECL|function|dz_serial_console_init
r_void
id|__init
id|dz_serial_console_init
c_func
(paren
r_void
)paren
(brace
id|dz_init_ports
c_func
(paren
)paren
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|dz_sercons
)paren
suffix:semicolon
)brace
DECL|macro|SERIAL_DZ_CONSOLE
mdefine_line|#define SERIAL_DZ_CONSOLE&t;&amp;dz_sercons
macro_line|#else
DECL|macro|SERIAL_DZ_CONSOLE
mdefine_line|#define SERIAL_DZ_CONSOLE&t;NULL
macro_line|#endif /* CONFIG_SERIAL_DZ_CONSOLE */
DECL|variable|dz_reg
r_static
r_struct
id|uart_driver
id|dz_reg
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|driver_name
op_assign
l_string|&quot;serial&quot;
comma
macro_line|#ifdef CONFIG_DEVFS
dot
id|dev_name
op_assign
l_string|&quot;tts/%d&quot;
comma
macro_line|#else
dot
id|dev_name
op_assign
l_string|&quot;ttyS%d&quot;
comma
macro_line|#endif
dot
id|major
op_assign
id|TTY_MAJOR
comma
dot
id|minor
op_assign
l_int|64
comma
dot
id|nr
op_assign
id|DZ_NB_PORT
comma
dot
id|cons
op_assign
id|SERIAL_DZ_CONSOLE
comma
)brace
suffix:semicolon
DECL|function|dz_init
r_int
id|__init
id|dz_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
comma
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s%s&bslash;n&quot;
comma
id|dz_name
comma
id|dz_version
)paren
suffix:semicolon
id|dz_init_ports
c_func
(paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_SERIAL_DZ_CONSOLE
multiline_comment|/* reset the chip */
id|dz_reset
c_func
(paren
op_amp
id|dz_ports
(braket
l_int|0
)braket
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* order matters here... the trick is that flags&n;&t;   is updated... in request_irq - to immediatedly obliterate&n;&t;   it is unwise. */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dz_ports
(braket
l_int|0
)braket
dot
id|port.irq
comma
id|dz_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;DZ&quot;
comma
op_amp
id|dz_ports
(braket
l_int|0
)braket
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;Unable to register DZ interrupt&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|uart_register_driver
c_func
(paren
op_amp
id|dz_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DZ_NB_PORT
suffix:semicolon
id|i
op_increment
)paren
id|uart_add_one_port
c_func
(paren
op_amp
id|dz_reg
comma
op_amp
id|dz_ports
(braket
id|i
)braket
dot
id|port
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;DECstation DZ serial driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
