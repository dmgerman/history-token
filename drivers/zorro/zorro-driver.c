multiline_comment|/*&n; *  Zorro Driver Services&n; *&n; *  Copyright (C) 2003 Geert Uytterhoeven&n; *&n; *  Loosely based on drivers/pci/pci-driver.c&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive&n; *  for more details.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/zorro.h&gt;
multiline_comment|/**&n;     *  zorro_match_device - Tell if a Zorro device structure has a matching&n;     *                       Zorro device id structure&n;     *  @ids: array of Zorro device id structures to search in&n;     *  @dev: the Zorro device structure to match against&n;     *&n;     *  Used by a driver to check whether a Zorro device present in the&n;     *  system is in its list of supported devices. Returns the matching&n;     *  zorro_device_id structure or %NULL if there is no match.&n;     */
r_const
r_struct
id|zorro_device_id
op_star
DECL|function|zorro_match_device
id|zorro_match_device
c_func
(paren
r_const
r_struct
id|zorro_device_id
op_star
id|ids
comma
r_const
r_struct
id|zorro_dev
op_star
id|z
)paren
(brace
r_while
c_loop
(paren
id|ids-&gt;id
)paren
(brace
r_if
c_cond
(paren
id|ids-&gt;id
op_eq
id|ZORRO_WILDCARD
op_logical_or
id|ids-&gt;id
op_eq
id|z-&gt;id
)paren
r_return
id|ids
suffix:semicolon
id|ids
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|zorro_device_probe
r_static
r_int
id|zorro_device_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_struct
id|zorro_driver
op_star
id|drv
op_assign
id|to_zorro_driver
c_func
(paren
id|dev-&gt;driver
)paren
suffix:semicolon
r_struct
id|zorro_dev
op_star
id|z
op_assign
id|to_zorro_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|z-&gt;driver
op_logical_and
id|drv-&gt;probe
)paren
(brace
r_const
r_struct
id|zorro_device_id
op_star
id|id
suffix:semicolon
id|id
op_assign
id|zorro_match_device
c_func
(paren
id|drv-&gt;id_table
comma
id|z
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
)paren
id|error
op_assign
id|drv
op_member_access_from_pointer
id|probe
c_func
(paren
id|z
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
(brace
id|z-&gt;driver
op_assign
id|drv
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/**&n;     *  zorro_register_driver - register a new Zorro driver&n;     *  @drv: the driver structure to register&n;     *&n;     *  Adds the driver structure to the list of registered drivers&n;     *  Returns the number of Zorro devices which were claimed by the driver&n;     *  during registration.  The driver remains registered even if the&n;     *  return value is zero.&n;     */
DECL|function|zorro_register_driver
r_int
id|zorro_register_driver
c_func
(paren
r_struct
id|zorro_driver
op_star
id|drv
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initialize common driver fields */
id|drv-&gt;driver.name
op_assign
id|drv-&gt;name
suffix:semicolon
id|drv-&gt;driver.bus
op_assign
op_amp
id|zorro_bus_type
suffix:semicolon
id|drv-&gt;driver.probe
op_assign
id|zorro_device_probe
suffix:semicolon
multiline_comment|/* register with core */
id|count
op_assign
id|driver_register
c_func
(paren
op_amp
id|drv-&gt;driver
)paren
suffix:semicolon
r_return
id|count
ques
c_cond
id|count
suffix:colon
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n;     *  zorro_unregister_driver - unregister a zorro driver&n;     *  @drv: the driver structure to unregister&n;     *&n;     *  Deletes the driver structure from the list of registered Zorro drivers,&n;     *  gives it a chance to clean up by calling its remove() function for&n;     *  each device it was responsible for, and marks those devices as&n;     *  driverless.&n;     */
DECL|function|zorro_unregister_driver
r_void
id|zorro_unregister_driver
c_func
(paren
r_struct
id|zorro_driver
op_star
id|drv
)paren
(brace
id|driver_unregister
c_func
(paren
op_amp
id|drv-&gt;driver
)paren
suffix:semicolon
)brace
multiline_comment|/**&n;     *  zorro_bus_match - Tell if a Zorro device structure has a matching Zorro&n;     *                    device id structure&n;     *  @ids: array of Zorro device id structures to search in&n;     *  @dev: the Zorro device structure to match against&n;     *&n;     *  Used by a driver to check whether a Zorro device present in the&n;     *  system is in its list of supported devices.Returns the matching&n;     *  zorro_device_id structure or %NULL if there is no match.&n;     */
DECL|function|zorro_bus_match
r_static
r_int
id|zorro_bus_match
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
r_struct
id|zorro_dev
op_star
id|z
op_assign
id|to_zorro_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|zorro_driver
op_star
id|zorro_drv
op_assign
id|to_zorro_driver
c_func
(paren
id|drv
)paren
suffix:semicolon
r_const
r_struct
id|zorro_device_id
op_star
id|ids
op_assign
id|zorro_drv-&gt;id_table
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ids
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|ids-&gt;id
)paren
(brace
r_if
c_cond
(paren
id|ids-&gt;id
op_eq
id|ZORRO_WILDCARD
op_logical_or
id|ids-&gt;id
op_eq
id|z-&gt;id
)paren
r_return
l_int|1
suffix:semicolon
id|ids
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|zorro_bus_type
r_struct
id|bus_type
id|zorro_bus_type
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;zorro&quot;
comma
dot
id|match
op_assign
id|zorro_bus_match
)brace
suffix:semicolon
DECL|function|zorro_driver_init
r_static
r_int
id|__init
id|zorro_driver_init
c_func
(paren
r_void
)paren
(brace
r_return
id|bus_register
c_func
(paren
op_amp
id|zorro_bus_type
)paren
suffix:semicolon
)brace
DECL|variable|zorro_driver_init
id|postcore_initcall
c_func
(paren
id|zorro_driver_init
)paren
suffix:semicolon
DECL|variable|zorro_match_device
id|EXPORT_SYMBOL
c_func
(paren
id|zorro_match_device
)paren
suffix:semicolon
DECL|variable|zorro_register_driver
id|EXPORT_SYMBOL
c_func
(paren
id|zorro_register_driver
)paren
suffix:semicolon
DECL|variable|zorro_unregister_driver
id|EXPORT_SYMBOL
c_func
(paren
id|zorro_unregister_driver
)paren
suffix:semicolon
DECL|variable|zorro_dev_driver
id|EXPORT_SYMBOL
c_func
(paren
id|zorro_dev_driver
)paren
suffix:semicolon
DECL|variable|zorro_bus_type
id|EXPORT_SYMBOL
c_func
(paren
id|zorro_bus_type
)paren
suffix:semicolon
eof
