multiline_comment|/*&n; * Intel &amp; MS High Precision Event Timer Implementation.&n; * Contributors:&n; *&t;Venki Pallipadi&n; * &t;Bob Picco&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/miscdevice.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/bcd.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;asm/current.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/div64.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;acpi/acpi_bus.h&gt;
macro_line|#include &lt;linux/hpet.h&gt;
multiline_comment|/*&n; * The High Precision Event Timer driver.&n; * This driver is closely modelled after the rtc.c driver.&n; * http://www.intel.com/labs/platcomp/hpet/hpetspec.htm&n; */
DECL|macro|HPET_USER_FREQ
mdefine_line|#define&t;HPET_USER_FREQ&t;(64)
DECL|macro|HPET_DRIFT
mdefine_line|#define&t;HPET_DRIFT&t;(500)
DECL|variable|hpet_ntimer
DECL|variable|hpet_nhpet
DECL|variable|hpet_max_freq
r_static
id|u32
id|hpet_ntimer
comma
id|hpet_nhpet
comma
id|hpet_max_freq
op_assign
id|HPET_USER_FREQ
suffix:semicolon
multiline_comment|/* A lock for concurrent access by app and isr hpet activity. */
DECL|variable|hpet_lock
r_static
id|spinlock_t
id|hpet_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* A lock for concurrent intermodule access to hpet and isr hpet activity. */
DECL|variable|hpet_task_lock
r_static
id|spinlock_t
id|hpet_task_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|struct|hpet_dev
r_struct
id|hpet_dev
(brace
DECL|member|hd_hpets
r_struct
id|hpets
op_star
id|hd_hpets
suffix:semicolon
DECL|member|hd_hpet
r_struct
id|hpet
op_star
id|hd_hpet
suffix:semicolon
DECL|member|hd_timer
r_struct
id|hpet_timer
op_star
id|hd_timer
suffix:semicolon
DECL|member|hd_ireqfreq
r_int
r_int
id|hd_ireqfreq
suffix:semicolon
DECL|member|hd_irqdata
r_int
r_int
id|hd_irqdata
suffix:semicolon
DECL|member|hd_waitqueue
id|wait_queue_head_t
id|hd_waitqueue
suffix:semicolon
DECL|member|hd_async_queue
r_struct
id|fasync_struct
op_star
id|hd_async_queue
suffix:semicolon
DECL|member|hd_task
r_struct
id|hpet_task
op_star
id|hd_task
suffix:semicolon
DECL|member|hd_flags
r_int
r_int
id|hd_flags
suffix:semicolon
DECL|member|hd_irq
r_int
r_int
id|hd_irq
suffix:semicolon
DECL|member|hd_hdwirq
r_int
r_int
id|hd_hdwirq
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|hpets
r_struct
id|hpets
(brace
DECL|member|hp_next
r_struct
id|hpets
op_star
id|hp_next
suffix:semicolon
DECL|member|hp_hpet
r_struct
id|hpet
op_star
id|hp_hpet
suffix:semicolon
DECL|member|hp_period
r_int
r_int
id|hp_period
suffix:semicolon
DECL|member|hp_delta
r_int
r_int
id|hp_delta
suffix:semicolon
DECL|member|hp_ntimer
r_int
r_int
id|hp_ntimer
suffix:semicolon
DECL|member|hp_which
r_int
r_int
id|hp_which
suffix:semicolon
DECL|member|hp_dev
r_struct
id|hpet_dev
id|hp_dev
(braket
l_int|1
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|hpets
r_static
r_struct
id|hpets
op_star
id|hpets
suffix:semicolon
DECL|macro|HPET_OPEN
mdefine_line|#define&t;HPET_OPEN&t;&t;0x0001
DECL|macro|HPET_IE
mdefine_line|#define&t;HPET_IE&t;&t;&t;0x0002&t;/* interrupt enabled */
DECL|macro|HPET_PERIODIC
mdefine_line|#define&t;HPET_PERIODIC&t;&t;0x0004
macro_line|#if BITS_PER_LONG == 64
DECL|macro|write_counter
mdefine_line|#define&t;write_counter(V, MC)&t;writeq(V, MC)
DECL|macro|read_counter
mdefine_line|#define&t;read_counter(MC)&t;readq(MC)
macro_line|#else
DECL|macro|write_counter
mdefine_line|#define&t;write_counter(V, MC) &t;writel(V, MC)
DECL|macro|read_counter
mdefine_line|#define&t;read_counter(MC)&t;readl(MC)
macro_line|#endif
macro_line|#ifndef readq
DECL|function|readq
r_static
r_int
r_int
r_int
id|__inline
id|readq
c_func
(paren
r_void
op_star
id|addr
)paren
(brace
r_return
id|readl
c_func
(paren
id|addr
)paren
op_or
(paren
(paren
(paren
r_int
r_int
r_int
)paren
id|readl
c_func
(paren
id|addr
op_plus
l_int|4
)paren
)paren
op_lshift
l_int|32LL
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifndef writeq
DECL|function|writeq
r_static
r_void
id|__inline
id|writeq
c_func
(paren
r_int
r_int
r_int
id|v
comma
r_void
op_star
id|addr
)paren
(brace
id|writel
c_func
(paren
id|v
op_amp
l_int|0xffffffff
comma
id|addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|v
op_rshift
l_int|32
comma
id|addr
op_plus
l_int|4
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hpet_interrupt
r_static
id|irqreturn_t
id|hpet_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|data
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_int
r_int
id|isr
suffix:semicolon
id|devp
op_assign
id|data
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|devp-&gt;hd_irqdata
op_increment
suffix:semicolon
multiline_comment|/*&n;&t; * For non-periodic timers, increment the accumulator.&n;&t; * This has the effect of treating non-periodic like periodic.&n;&t; */
r_if
c_cond
(paren
(paren
id|devp-&gt;hd_flags
op_amp
(paren
id|HPET_IE
op_or
id|HPET_PERIODIC
)paren
)paren
op_eq
id|HPET_IE
)paren
(brace
r_int
r_int
id|m
comma
id|t
suffix:semicolon
id|t
op_assign
id|devp-&gt;hd_ireqfreq
suffix:semicolon
id|m
op_assign
id|read_counter
c_func
(paren
op_amp
id|devp-&gt;hd_hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|write_counter
c_func
(paren
id|t
op_plus
id|m
op_plus
id|devp-&gt;hd_hpets-&gt;hp_delta
comma
op_amp
id|devp-&gt;hd_timer-&gt;hpet_compare
)paren
suffix:semicolon
)brace
id|isr
op_assign
(paren
l_int|1
op_lshift
(paren
id|devp
op_minus
id|devp-&gt;hd_hpets-&gt;hp_dev
)paren
)paren
suffix:semicolon
id|writeq
c_func
(paren
id|isr
comma
op_amp
id|devp-&gt;hd_hpet-&gt;hpet_isr
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_task
)paren
id|devp-&gt;hd_task
op_member_access_from_pointer
id|ht_func
c_func
(paren
id|devp-&gt;hd_task-&gt;ht_data
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|devp-&gt;hd_waitqueue
)paren
suffix:semicolon
id|kill_fasync
c_func
(paren
op_amp
id|devp-&gt;hd_async_queue
comma
id|SIGIO
comma
id|POLL_IN
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|hpet_open
r_static
r_int
id|hpet_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|devp
op_assign
l_int|NULL
comma
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
op_logical_and
op_logical_neg
id|devp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hpetp-&gt;hp_ntimer
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|hpetp-&gt;hp_dev
(braket
id|i
)braket
dot
id|hd_flags
op_amp
id|HPET_OPEN
op_logical_or
id|hpetp-&gt;hp_dev
(braket
id|i
)braket
dot
id|hd_task
)paren
r_continue
suffix:semicolon
r_else
(brace
id|devp
op_assign
op_amp
id|hpetp-&gt;hp_dev
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|devp
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|file-&gt;private_data
op_assign
id|devp
suffix:semicolon
id|devp-&gt;hd_irqdata
op_assign
l_int|0
suffix:semicolon
id|devp-&gt;hd_flags
op_or_assign
id|HPET_OPEN
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|hpet_read
id|hpet_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|data
suffix:semicolon
id|ssize_t
id|retval
suffix:semicolon
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devp-&gt;hd_ireqfreq
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
r_int
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|devp-&gt;hd_waitqueue
comma
op_amp
id|wait
)paren
suffix:semicolon
r_do
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|data
op_assign
id|devp-&gt;hd_irqdata
suffix:semicolon
id|devp-&gt;hd_irqdata
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
r_break
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
id|retval
op_assign
id|put_user
c_func
(paren
id|data
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
id|retval
op_assign
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
id|out
suffix:colon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|devp-&gt;hd_waitqueue
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|hpet_poll
r_static
r_int
r_int
id|hpet_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devp-&gt;hd_ireqfreq
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|devp-&gt;hd_waitqueue
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|v
op_assign
id|devp-&gt;hd_irqdata
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_ne
l_int|0
)paren
r_return
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpet_mmap
r_static
r_int
id|hpet_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
macro_line|#ifdef&t;CONFIG_HPET_NOMMAP
r_return
op_minus
id|ENOSYS
suffix:semicolon
macro_line|#else
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
)paren
op_ne
id|PAGE_SIZE
)paren
op_logical_or
id|vma-&gt;vm_pgoff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
id|addr
op_assign
(paren
r_int
r_int
)paren
id|devp-&gt;hd_hpet
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_IO
suffix:semicolon
id|vma-&gt;vm_page_prot
op_assign
id|pgprot_noncached
c_func
(paren
id|vma-&gt;vm_page_prot
)paren
suffix:semicolon
id|addr
op_assign
id|__pa
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|addr
comma
id|PAGE_SIZE
comma
id|vma-&gt;vm_page_prot
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;remap_page_range failed in hpet.c&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|function|hpet_fasync
r_static
r_int
id|hpet_fasync
c_func
(paren
r_int
id|fd
comma
r_struct
id|file
op_star
id|file
comma
r_int
id|on
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|fasync_helper
c_func
(paren
id|fd
comma
id|file
comma
id|on
comma
op_amp
id|devp-&gt;hd_async_queue
)paren
op_ge
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|hpet_release
r_static
r_int
id|hpet_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_int
id|irq
op_assign
l_int|0
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
id|timer
op_assign
id|devp-&gt;hd_timer
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|writeq
c_func
(paren
(paren
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
op_complement
id|Tn_INT_ENB_CNF_MASK
)paren
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|irq
op_assign
id|devp-&gt;hd_irq
suffix:semicolon
id|devp-&gt;hd_irq
op_assign
l_int|0
suffix:semicolon
id|devp-&gt;hd_ireqfreq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_PERIODIC
op_logical_and
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
id|Tn_TYPE_CNF_MASK
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|v
op_xor_assign
id|Tn_TYPE_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|v
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
)brace
id|devp-&gt;hd_flags
op_and_assign
op_complement
(paren
id|HPET_OPEN
op_or
id|HPET_IE
op_or
id|HPET_PERIODIC
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
)paren
id|free_irq
c_func
(paren
id|irq
comma
id|devp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|FASYNC
)paren
id|hpet_fasync
c_func
(paren
op_minus
l_int|1
comma
id|file
comma
l_int|0
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|hpet_ioctl_common
c_func
(paren
r_struct
id|hpet_dev
op_star
comma
r_int
comma
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
DECL|function|hpet_ioctl
id|hpet_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
id|devp
op_assign
id|file-&gt;private_data
suffix:semicolon
r_return
id|hpet_ioctl_common
c_func
(paren
id|devp
comma
id|cmd
comma
id|arg
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|hpet_ioctl_ieon
r_static
r_int
id|hpet_ioctl_ieon
c_func
(paren
r_struct
id|hpet_dev
op_star
id|devp
)paren
(brace
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
r_int
id|g
comma
id|v
comma
id|t
comma
id|m
suffix:semicolon
r_int
r_int
id|flags
comma
id|isr
suffix:semicolon
id|timer
op_assign
id|devp-&gt;hd_timer
suffix:semicolon
id|hpet
op_assign
id|devp-&gt;hd_hpet
suffix:semicolon
id|hpetp
op_assign
id|devp-&gt;hd_hpets
suffix:semicolon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_IE
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|devp-&gt;hd_flags
op_or_assign
id|HPET_IE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|t
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|irq
op_assign
id|devp-&gt;hd_hdwirq
suffix:semicolon
r_if
c_cond
(paren
id|irq
)paren
(brace
r_char
id|name
(braket
l_int|7
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;hpet%d&quot;
comma
(paren
r_int
)paren
(paren
id|devp
op_minus
id|hpetp-&gt;hp_dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
(paren
id|irq
comma
id|hpet_interrupt
comma
id|SA_INTERRUPT
comma
id|name
comma
(paren
r_void
op_star
)paren
id|devp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hpet: IRQ %d is not free&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|irq
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|irq
op_eq
l_int|0
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|devp-&gt;hd_flags
op_xor_assign
id|HPET_IE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|devp-&gt;hd_irq
op_assign
id|irq
suffix:semicolon
id|t
op_assign
id|devp-&gt;hd_ireqfreq
suffix:semicolon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|g
op_assign
id|v
op_or
id|Tn_INT_ENB_CNF_MASK
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_PERIODIC
)paren
(brace
id|write_counter
c_func
(paren
id|t
comma
op_amp
id|timer-&gt;hpet_compare
)paren
suffix:semicolon
id|g
op_or_assign
id|Tn_TYPE_CNF_MASK
suffix:semicolon
id|v
op_or_assign
id|Tn_TYPE_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|v
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|v
op_or_assign
id|Tn_VAL_SET_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|v
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|m
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|write_counter
c_func
(paren
id|t
op_plus
id|m
op_plus
id|hpetp-&gt;hp_delta
comma
op_amp
id|timer-&gt;hpet_compare
)paren
suffix:semicolon
)brace
r_else
(brace
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|m
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|write_counter
c_func
(paren
id|t
op_plus
id|m
op_plus
id|hpetp-&gt;hp_delta
comma
op_amp
id|timer-&gt;hpet_compare
)paren
suffix:semicolon
)brace
id|isr
op_assign
(paren
l_int|1
op_lshift
(paren
id|devp
op_minus
id|hpets-&gt;hp_dev
)paren
)paren
suffix:semicolon
id|writeq
c_func
(paren
id|isr
comma
op_amp
id|hpet-&gt;hpet_isr
)paren
suffix:semicolon
id|writeq
c_func
(paren
id|g
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpet_time_div
r_static
r_inline
r_int
r_int
id|hpet_time_div
c_func
(paren
r_int
r_int
id|dis
)paren
(brace
r_int
r_int
r_int
id|m
op_assign
l_int|1000000000000000ULL
suffix:semicolon
id|do_div
c_func
(paren
id|m
comma
id|dis
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
id|m
suffix:semicolon
)brace
r_static
r_int
DECL|function|hpet_ioctl_common
id|hpet_ioctl_common
c_func
(paren
r_struct
id|hpet_dev
op_star
id|devp
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
comma
r_int
id|kernel
)paren
(brace
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|v
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|HPET_IE_OFF
suffix:colon
r_case
id|HPET_INFO
suffix:colon
r_case
id|HPET_EPI
suffix:colon
r_case
id|HPET_DPI
suffix:colon
r_case
id|HPET_IRQFREQ
suffix:colon
id|timer
op_assign
id|devp-&gt;hd_timer
suffix:semicolon
id|hpet
op_assign
id|devp-&gt;hd_hpet
suffix:semicolon
id|hpetp
op_assign
id|devp-&gt;hd_hpets
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HPET_IE_ON
suffix:colon
r_return
id|hpet_ioctl_ieon
c_func
(paren
id|devp
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|HPET_IE_OFF
suffix:colon
r_if
c_cond
(paren
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_IE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|v
op_and_assign
op_complement
id|Tn_INT_ENB_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|v
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_irq
)paren
(brace
id|free_irq
c_func
(paren
id|devp-&gt;hd_irq
comma
id|devp
)paren
suffix:semicolon
id|devp-&gt;hd_irq
op_assign
l_int|0
suffix:semicolon
)brace
id|devp-&gt;hd_flags
op_xor_assign
id|HPET_IE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HPET_INFO
suffix:colon
(brace
r_struct
id|hpet_info
id|info
suffix:semicolon
id|info.hi_ireqfreq
op_assign
id|hpet_time_div
c_func
(paren
id|hpetp-&gt;hp_period
op_star
id|devp-&gt;hd_ireqfreq
)paren
suffix:semicolon
id|info.hi_flags
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
id|Tn_PER_INT_CAP_MASK
suffix:semicolon
id|info.hi_hpet
op_assign
id|devp-&gt;hd_hpets-&gt;hp_which
suffix:semicolon
id|info.hi_timer
op_assign
id|devp
op_minus
id|devp-&gt;hd_hpets-&gt;hp_dev
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|HPET_EPI
suffix:colon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v
op_amp
id|Tn_PER_INT_CAP_MASK
)paren
op_eq
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_break
suffix:semicolon
)brace
id|devp-&gt;hd_flags
op_or_assign
id|HPET_PERIODIC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HPET_DPI
suffix:colon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v
op_amp
id|Tn_PER_INT_CAP_MASK
)paren
op_eq
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_PERIODIC
op_logical_and
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
id|Tn_TYPE_CNF_MASK
)paren
(brace
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|v
op_xor_assign
id|Tn_TYPE_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|v
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
)brace
id|devp-&gt;hd_flags
op_and_assign
op_complement
id|HPET_PERIODIC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HPET_IRQFREQ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|kernel
op_logical_and
(paren
id|arg
OG
id|hpet_max_freq
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RESOURCE
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EACCES
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg
op_amp
(paren
id|arg
op_minus
l_int|1
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|devp-&gt;hd_ireqfreq
op_assign
id|hpet_time_div
c_func
(paren
id|hpetp-&gt;hp_period
op_star
id|arg
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|variable|hpet_fops
r_static
r_struct
id|file_operations
id|hpet_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|hpet_read
comma
dot
id|poll
op_assign
id|hpet_poll
comma
dot
id|ioctl
op_assign
id|hpet_ioctl
comma
dot
id|open
op_assign
id|hpet_open
comma
dot
id|release
op_assign
id|hpet_release
comma
dot
id|fasync
op_assign
id|hpet_fasync
comma
dot
id|mmap
op_assign
id|hpet_mmap
comma
)brace
suffix:semicolon
DECL|variable|hpet_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|hpet_alloc
)paren
suffix:semicolon
DECL|variable|hpet_register
id|EXPORT_SYMBOL
c_func
(paren
id|hpet_register
)paren
suffix:semicolon
DECL|variable|hpet_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|hpet_unregister
)paren
suffix:semicolon
DECL|variable|hpet_control
id|EXPORT_SYMBOL
c_func
(paren
id|hpet_control
)paren
suffix:semicolon
DECL|function|hpet_register
r_int
id|hpet_register
c_func
(paren
r_struct
id|hpet_task
op_star
id|tp
comma
r_int
id|periodic
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|u64
id|mask
suffix:semicolon
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_switch
c_cond
(paren
id|periodic
)paren
(brace
r_case
l_int|1
suffix:colon
id|mask
op_assign
id|Tn_PER_INT_CAP_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|mask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|devp
op_assign
l_int|0
comma
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
op_logical_and
op_logical_neg
id|devp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_for
c_loop
(paren
id|timer
op_assign
id|hpetp-&gt;hp_hpet-&gt;hpet_timers
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hpetp-&gt;hp_ntimer
suffix:semicolon
id|i
op_increment
comma
id|timer
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
id|Tn_PER_INT_CAP_MASK
)paren
op_ne
id|mask
)paren
r_continue
suffix:semicolon
id|devp
op_assign
op_amp
id|hpetp-&gt;hp_dev
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_OPEN
op_logical_or
id|devp-&gt;hd_task
)paren
(brace
id|devp
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|tp-&gt;ht_opaque
op_assign
id|devp
suffix:semicolon
id|devp-&gt;hd_task
op_assign
id|tp
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;ht_opaque
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|hpet_tpcheck
r_static
r_inline
r_int
id|hpet_tpcheck
c_func
(paren
r_struct
id|hpet_task
op_star
id|tp
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
id|devp
op_assign
id|tp-&gt;ht_opaque
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devp
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_for
c_loop
(paren
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_if
c_cond
(paren
id|devp
op_ge
id|hpetp-&gt;hp_dev
op_logical_and
id|devp
OL
(paren
id|hpetp-&gt;hp_dev
op_plus
id|hpetp-&gt;hp_ntimer
)paren
op_logical_and
id|devp-&gt;hd_hpet
op_eq
id|hpetp-&gt;hp_hpet
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
DECL|function|hpet_unregister
r_int
id|hpet_unregister
c_func
(paren
r_struct
id|hpet_task
op_star
id|tp
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|hpet_tpcheck
c_func
(paren
id|tp
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|devp
op_assign
id|tp-&gt;ht_opaque
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_task
op_ne
id|tp
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|timer
op_assign
id|devp-&gt;hd_timer
suffix:semicolon
id|writeq
c_func
(paren
(paren
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
op_amp
op_complement
id|Tn_INT_ENB_CNF_MASK
)paren
comma
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|devp-&gt;hd_flags
op_and_assign
op_complement
(paren
id|HPET_IE
op_or
id|HPET_PERIODIC
)paren
suffix:semicolon
id|devp-&gt;hd_task
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_task_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpet_control
r_int
id|hpet_control
c_func
(paren
r_struct
id|hpet_task
op_star
id|tp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|hpet_tpcheck
c_func
(paren
id|tp
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
id|devp
op_assign
id|tp-&gt;ht_opaque
suffix:semicolon
r_if
c_cond
(paren
id|devp-&gt;hd_task
op_ne
id|tp
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|hpet_lock
)paren
suffix:semicolon
r_return
id|hpet_ioctl_common
c_func
(paren
id|devp
comma
id|cmd
comma
id|arg
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;CONFIG_TIME_INTERPOLATION
DECL|variable|hpet_offset
DECL|variable|last_wall_hpet
r_static
r_int
r_int
id|hpet_offset
comma
id|last_wall_hpet
suffix:semicolon
DECL|variable|hpet_nsecs_per_cycle
DECL|variable|hpet_cycles_per_sec
r_static
r_int
id|hpet_nsecs_per_cycle
comma
id|hpet_cycles_per_sec
suffix:semicolon
DECL|function|hpet_getoffset
r_static
r_int
r_int
id|hpet_getoffset
c_func
(paren
r_void
)paren
(brace
r_return
id|hpet_offset
op_plus
(paren
id|read_counter
c_func
(paren
op_amp
id|hpets-&gt;hp_hpet-&gt;hpet_mc
)paren
op_minus
id|last_wall_hpet
)paren
op_star
id|hpet_nsecs_per_cycle
suffix:semicolon
)brace
DECL|function|hpet_update
r_static
r_void
id|hpet_update
c_func
(paren
r_int
id|delta
)paren
(brace
r_int
r_int
id|mc
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
id|mc
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpets-&gt;hp_hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|offset
op_assign
id|hpet_offset
op_plus
(paren
id|mc
op_minus
id|last_wall_hpet
)paren
op_star
id|hpet_nsecs_per_cycle
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
op_logical_or
(paren
r_int
r_int
)paren
id|delta
OL
id|offset
)paren
id|hpet_offset
op_assign
id|offset
op_minus
id|delta
suffix:semicolon
r_else
id|hpet_offset
op_assign
l_int|0
suffix:semicolon
id|last_wall_hpet
op_assign
id|mc
suffix:semicolon
)brace
DECL|function|hpet_reset
r_static
r_void
id|hpet_reset
c_func
(paren
r_void
)paren
(brace
id|hpet_offset
op_assign
l_int|0
suffix:semicolon
id|last_wall_hpet
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpets-&gt;hp_hpet-&gt;hpet_mc
)paren
suffix:semicolon
)brace
DECL|variable|hpet_interpolator
r_static
r_struct
id|time_interpolator
id|hpet_interpolator
op_assign
(brace
dot
id|get_offset
op_assign
id|hpet_getoffset
comma
dot
id|update
op_assign
id|hpet_update
comma
dot
id|reset
op_assign
id|hpet_reset
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|hpet_table
r_static
id|ctl_table
id|hpet_table
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
l_int|1
comma
dot
id|procname
op_assign
l_string|&quot;max-user-freq&quot;
comma
dot
id|data
op_assign
op_amp
id|hpet_max_freq
comma
dot
id|maxlen
op_assign
r_sizeof
(paren
r_int
)paren
comma
dot
id|mode
op_assign
l_int|0644
comma
dot
id|proc_handler
op_assign
op_amp
id|proc_dointvec
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|hpet_root
r_static
id|ctl_table
id|hpet_root
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
l_int|1
comma
dot
id|procname
op_assign
l_string|&quot;hpet&quot;
comma
dot
id|maxlen
op_assign
l_int|0
comma
dot
id|mode
op_assign
l_int|0555
comma
dot
id|child
op_assign
id|hpet_table
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|dev_root
r_static
id|ctl_table
id|dev_root
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
id|CTL_DEV
comma
dot
id|procname
op_assign
l_string|&quot;dev&quot;
comma
dot
id|maxlen
op_assign
l_int|0
comma
dot
id|mode
op_assign
l_int|0555
comma
dot
id|child
op_assign
id|hpet_root
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|sysctl_header
r_static
r_struct
id|ctl_table_header
op_star
id|sysctl_header
suffix:semicolon
DECL|function|hpet_start
r_static
r_void
op_star
id|hpet_start
c_func
(paren
r_struct
id|seq_file
op_star
id|s
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
id|loff_t
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
op_star
id|pos
comma
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_if
c_cond
(paren
op_logical_neg
id|n
op_decrement
)paren
r_return
id|hpetp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpet_next
r_static
r_void
op_star
id|hpet_next
c_func
(paren
r_struct
id|seq_file
op_star
id|s
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
id|hpetp
op_assign
id|v
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|hpetp-&gt;hp_next
suffix:semicolon
)brace
DECL|function|hpet_stop
r_static
r_void
id|hpet_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|s
comma
r_void
op_star
id|v
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|hpet_show
r_static
r_int
id|hpet_show
c_func
(paren
r_struct
id|seq_file
op_star
id|s
comma
r_void
op_star
id|v
)paren
(brace
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
id|u64
id|cap
comma
id|vendor
comma
id|period
suffix:semicolon
id|hpetp
op_assign
id|v
suffix:semicolon
id|hpet
op_assign
id|hpetp-&gt;hp_hpet
suffix:semicolon
id|cap
op_assign
id|readq
c_func
(paren
op_amp
id|hpet-&gt;hpet_cap
)paren
suffix:semicolon
id|period
op_assign
(paren
id|cap
op_amp
id|HPET_COUNTER_CLK_PERIOD_MASK
)paren
op_rshift
id|HPET_COUNTER_CLK_PERIOD_SHIFT
suffix:semicolon
id|vendor
op_assign
(paren
id|cap
op_amp
id|HPET_VENDOR_ID_MASK
)paren
op_rshift
id|HPET_VENDOR_ID_SHIFT
suffix:semicolon
id|seq_printf
c_func
(paren
id|s
comma
l_string|&quot;HPET%d period = %d 10**-15  vendor = 0x%x number timer = %d&bslash;n&quot;
comma
id|hpetp-&gt;hp_which
comma
(paren
id|u32
)paren
id|period
comma
(paren
id|u32
)paren
id|vendor
comma
id|hpetp-&gt;hp_ntimer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hpet_seq_ops
r_static
r_struct
id|seq_operations
id|hpet_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|hpet_start
comma
dot
id|next
op_assign
id|hpet_next
comma
dot
id|stop
op_assign
id|hpet_stop
comma
dot
id|show
op_assign
id|hpet_show
)brace
suffix:semicolon
DECL|function|hpet_proc_open
r_static
r_int
id|hpet_proc_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|hpet_seq_ops
)paren
suffix:semicolon
)brace
DECL|variable|hpet_proc_fops
r_static
r_struct
id|file_operations
id|hpet_proc_fops
op_assign
(brace
dot
id|open
op_assign
id|hpet_proc_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release
)brace
suffix:semicolon
multiline_comment|/*&n; * Adjustment for when arming the timer with&n; * initial conditions.  That is, main counter&n; * ticks expired before interrupts are enabled.&n; */
DECL|macro|TICK_CALIBRATE
mdefine_line|#define&t;TICK_CALIBRATE&t;(1000UL)
DECL|function|hpet_calibrate
r_static
r_int
r_int
id|__init
id|hpet_calibrate
c_func
(paren
r_struct
id|hpets
op_star
id|hpetp
)paren
(brace
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
r_int
r_int
id|t
comma
id|m
comma
id|count
comma
id|i
comma
id|flags
comma
id|start
suffix:semicolon
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
r_int
id|j
suffix:semicolon
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
comma
id|devp
op_assign
id|hpetp-&gt;hp_dev
suffix:semicolon
id|j
OL
id|hpetp-&gt;hp_ntimer
suffix:semicolon
id|j
op_increment
comma
id|devp
op_increment
)paren
r_if
c_cond
(paren
(paren
id|devp-&gt;hd_flags
op_amp
id|HPET_OPEN
)paren
op_eq
l_int|0
)paren
(brace
id|timer
op_assign
id|devp-&gt;hd_timer
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|timer
)paren
r_return
l_int|0
suffix:semicolon
id|hpet
op_assign
id|hpets-&gt;hp_hpet
suffix:semicolon
id|t
op_assign
id|read_counter
c_func
(paren
op_amp
id|timer-&gt;hpet_compare
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
id|hpet_time_div
c_func
(paren
id|hpetp-&gt;hp_period
op_star
id|TICK_CALIBRATE
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|start
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpet-&gt;hpet_mc
)paren
suffix:semicolon
r_do
(brace
id|m
op_assign
id|read_counter
c_func
(paren
op_amp
id|hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|write_counter
c_func
(paren
id|t
op_plus
id|m
op_plus
id|hpetp-&gt;hp_delta
comma
op_amp
id|timer-&gt;hpet_compare
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_increment
comma
(paren
id|m
op_minus
id|start
)paren
OL
id|count
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|m
op_minus
id|start
)paren
op_div
id|i
suffix:semicolon
)brace
DECL|function|hpet_alloc
r_int
id|__init
id|hpet_alloc
c_func
(paren
r_struct
id|hpet_data
op_star
id|hdp
)paren
(brace
id|u64
id|cap
comma
id|mcfg
suffix:semicolon
r_struct
id|hpet_dev
op_star
id|devp
suffix:semicolon
id|u32
id|i
comma
id|ntimer
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
r_int
id|siz
suffix:semicolon
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
r_static
r_struct
id|hpets
op_star
id|last
id|__initdata
op_assign
(paren
r_struct
id|hpets
op_star
)paren
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * hpet_alloc can be called by platform dependent code.&n;&t; * if platform dependent code has allocated the hpet&n;&t; * ACPI also reports hpet, then we catch it here.&n;&t; */
r_for
c_loop
(paren
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_if
c_cond
(paren
id|hpetp-&gt;hp_hpet
op_eq
(paren
r_struct
id|hpet
op_star
)paren
(paren
id|hdp-&gt;hd_address
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|siz
op_assign
r_sizeof
(paren
r_struct
id|hpets
)paren
op_plus
(paren
(paren
id|hdp-&gt;hd_nirqs
op_minus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|hpet_dev
)paren
)paren
suffix:semicolon
id|hpetp
op_assign
id|kmalloc
c_func
(paren
id|siz
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hpetp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|hpetp
comma
l_int|0
comma
id|siz
)paren
suffix:semicolon
id|hpetp-&gt;hp_which
op_assign
id|hpet_nhpet
op_increment
suffix:semicolon
id|hpetp-&gt;hp_hpet
op_assign
(paren
r_struct
id|hpet
op_star
)paren
id|hdp-&gt;hd_address
suffix:semicolon
id|hpetp-&gt;hp_ntimer
op_assign
id|hdp-&gt;hd_nirqs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hdp-&gt;hd_nirqs
suffix:semicolon
id|i
op_increment
)paren
id|hpetp-&gt;hp_dev
(braket
id|i
)braket
dot
id|hd_hdwirq
op_assign
id|hdp-&gt;hd_irq
(braket
id|i
)braket
suffix:semicolon
id|hpet
op_assign
id|hpetp-&gt;hp_hpet
suffix:semicolon
id|cap
op_assign
id|readq
c_func
(paren
op_amp
id|hpet-&gt;hpet_cap
)paren
suffix:semicolon
id|ntimer
op_assign
(paren
(paren
id|cap
op_amp
id|HPET_NUM_TIM_CAP_MASK
)paren
op_rshift
id|HPET_NUM_TIM_CAP_SHIFT
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hpetp-&gt;hp_ntimer
op_ne
id|ntimer
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;hpet: number irqs doesn&squot;t agree&quot;
l_string|&quot; with number of timers&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|hpetp
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|last
)paren
id|last-&gt;hp_next
op_assign
id|hpetp
suffix:semicolon
r_else
id|hpets
op_assign
id|hpetp
suffix:semicolon
id|last
op_assign
id|hpetp
suffix:semicolon
id|hpetp-&gt;hp_period
op_assign
(paren
id|cap
op_amp
id|HPET_COUNTER_CLK_PERIOD_MASK
)paren
op_rshift
id|HPET_COUNTER_CLK_PERIOD_SHIFT
suffix:semicolon
id|mcfg
op_assign
id|readq
c_func
(paren
op_amp
id|hpet-&gt;hpet_config
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mcfg
op_amp
id|HPET_ENABLE_CNF_MASK
)paren
op_eq
l_int|0
)paren
(brace
id|write_counter
c_func
(paren
l_int|0L
comma
op_amp
id|hpet-&gt;hpet_mc
)paren
suffix:semicolon
id|mcfg
op_or_assign
id|HPET_ENABLE_CNF_MASK
suffix:semicolon
id|writeq
c_func
(paren
id|mcfg
comma
op_amp
id|hpet-&gt;hpet_config
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|devp
op_assign
id|hpetp-&gt;hp_dev
suffix:semicolon
id|i
OL
id|hpetp-&gt;hp_ntimer
suffix:semicolon
id|i
op_increment
comma
id|hpet_ntimer
op_increment
comma
id|devp
op_increment
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_struct
id|hpet_timer
op_star
id|timer
suffix:semicolon
id|timer
op_assign
op_amp
id|hpet-&gt;hpet_timers
(braket
id|devp
op_minus
id|hpetp-&gt;hp_dev
)braket
suffix:semicolon
id|v
op_assign
id|readq
c_func
(paren
op_amp
id|timer-&gt;hpet_config
)paren
suffix:semicolon
id|devp-&gt;hd_hpets
op_assign
id|hpetp
suffix:semicolon
id|devp-&gt;hd_hpet
op_assign
id|hpet
suffix:semicolon
id|devp-&gt;hd_timer
op_assign
id|timer
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If the timer was reserved by platform code,&n;&t;&t; * then make timer unavailable for opens.&n;&t;&t; */
r_if
c_cond
(paren
id|hdp-&gt;hd_state
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|devp-&gt;hd_flags
op_assign
id|HPET_OPEN
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|devp-&gt;hd_waitqueue
)paren
suffix:semicolon
)brace
id|hpetp-&gt;hp_delta
op_assign
id|hpet_calibrate
c_func
(paren
id|hpetp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hpet_resources
r_static
id|acpi_status
id|__init
id|hpet_resources
c_func
(paren
r_struct
id|acpi_resource
op_star
id|res
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|hpet_data
op_star
id|hdp
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
r_struct
id|acpi_resource_address64
id|addr
suffix:semicolon
r_struct
id|hpets
op_star
id|hpetp
suffix:semicolon
id|hdp
op_assign
id|data
suffix:semicolon
id|status
op_assign
id|acpi_resource_to_address64
c_func
(paren
id|res
comma
op_amp
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
c_func
(paren
id|status
)paren
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
id|size
op_assign
id|addr.max_address_range
op_minus
id|addr.min_address_range
op_plus
l_int|1
suffix:semicolon
id|hdp-&gt;hd_address
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|addr.min_address_range
comma
id|size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hpetp
op_assign
id|hpets
suffix:semicolon
id|hpetp
suffix:semicolon
id|hpetp
op_assign
id|hpetp-&gt;hp_next
)paren
r_if
c_cond
(paren
id|hpetp-&gt;hp_hpet
op_eq
(paren
r_struct
id|hpet
op_star
)paren
(paren
id|hdp-&gt;hd_address
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|res-&gt;id
op_eq
id|ACPI_RSTYPE_EXT_IRQ
)paren
(brace
r_struct
id|acpi_resource_ext_irq
op_star
id|irqp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|irqp
op_assign
op_amp
id|res-&gt;data.extended_irq
suffix:semicolon
r_if
c_cond
(paren
id|irqp-&gt;number_of_interrupts
OG
l_int|0
)paren
(brace
id|hdp-&gt;hd_nirqs
op_assign
id|irqp-&gt;number_of_interrupts
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hdp-&gt;hd_nirqs
suffix:semicolon
id|i
op_increment
)paren
macro_line|#ifdef&t;CONFIG_IA64
id|hdp-&gt;hd_irq
(braket
id|i
)braket
op_assign
id|acpi_register_gsi
c_func
(paren
id|irqp-&gt;interrupts
(braket
id|i
)braket
comma
id|irqp-&gt;edge_level
comma
id|irqp-&gt;active_high_low
)paren
suffix:semicolon
macro_line|#else
id|hdp-&gt;hd_irq
(braket
id|i
)braket
op_assign
id|irqp-&gt;interrupts
(braket
id|i
)braket
suffix:semicolon
macro_line|#endif
)brace
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
DECL|function|hpet_acpi_add
r_static
r_int
id|__init
id|hpet_acpi_add
c_func
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
id|acpi_status
id|result
suffix:semicolon
r_struct
id|hpet_data
id|data
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|data
comma
l_int|0
comma
r_sizeof
(paren
id|data
)paren
)paren
suffix:semicolon
id|result
op_assign
id|acpi_walk_resources
c_func
(paren
id|device-&gt;handle
comma
id|METHOD_NAME__CRS
comma
id|hpet_resources
comma
op_amp
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|result
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data.hd_address
op_logical_or
op_logical_neg
id|data.hd_nirqs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no address or irqs in _CRS&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|hpet_alloc
c_func
(paren
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|hpet_acpi_remove
r_static
r_int
id|__init
id|hpet_acpi_remove
c_func
(paren
r_struct
id|acpi_device
op_star
id|device
comma
r_int
id|type
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|acpi_driver
id|hpet_acpi_driver
id|__initdata
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;hpet&quot;
comma
dot
r_class
op_assign
l_string|&quot;&quot;
comma
dot
id|ids
op_assign
l_string|&quot;PNP0103&quot;
comma
dot
id|ops
op_assign
(brace
dot
id|add
op_assign
id|hpet_acpi_add
comma
dot
id|remove
op_assign
id|hpet_acpi_remove
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|hpet_misc
r_static
r_struct
id|miscdevice
id|hpet_misc
op_assign
(brace
id|HPET_MINOR
comma
l_string|&quot;hpet&quot;
comma
op_amp
id|hpet_fops
)brace
suffix:semicolon
DECL|function|hpet_init
r_static
r_int
id|__init
id|hpet_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
(paren
r_void
)paren
id|acpi_bus_register_driver
c_func
(paren
op_amp
id|hpet_acpi_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hpets
)paren
(brace
r_if
c_cond
(paren
id|misc_register
c_func
(paren
op_amp
id|hpet_misc
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;driver/hpet&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
id|entry-&gt;proc_fops
op_assign
op_amp
id|hpet_proc_fops
suffix:semicolon
id|sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|dev_root
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef&t;CONFIG_TIME_INTERPOLATION
(brace
r_struct
id|hpet
op_star
id|hpet
suffix:semicolon
id|hpet
op_assign
id|hpets-&gt;hp_hpet
suffix:semicolon
id|hpet_cycles_per_sec
op_assign
id|hpet_time_div
c_func
(paren
id|hpets-&gt;hp_period
)paren
suffix:semicolon
id|hpet_interpolator.frequency
op_assign
id|hpet_cycles_per_sec
suffix:semicolon
id|hpet_interpolator.drift
op_assign
id|hpet_cycles_per_sec
op_star
id|HPET_DRIFT
op_div
l_int|1000000
suffix:semicolon
id|hpet_nsecs_per_cycle
op_assign
l_int|1000000000
op_div
id|hpet_cycles_per_sec
suffix:semicolon
id|register_time_interpolator
c_func
(paren
op_amp
id|hpet_interpolator
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|hpet_exit
r_static
r_void
id|__exit
id|hpet_exit
c_func
(paren
r_void
)paren
(brace
id|acpi_bus_unregister_driver
c_func
(paren
op_amp
id|hpet_acpi_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hpets
)paren
(brace
id|unregister_sysctl_table
c_func
(paren
id|sysctl_header
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;driver/hpet&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|variable|hpet_init
id|module_init
c_func
(paren
id|hpet_init
)paren
suffix:semicolon
DECL|variable|hpet_exit
id|module_exit
c_func
(paren
id|hpet_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Bob Picco &lt;Robert.Picco@hp.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
