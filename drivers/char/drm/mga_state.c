multiline_comment|/* mga_state.c -- State support for MGA G200/G400 -*- linux-c -*-&n; * Created: Thu Jan 27 02:53:43 2000 by jhartmann@precisioninsight.com&n; *&n; * Copyright 1999 Precision Insight, Inc., Cedar Park, Texas.&n; * Copyright 2000 VA Linux Systems, Inc., Sunnyvale, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * VA LINUX SYSTEMS AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR&n; * OTHER DEALINGS IN THE SOFTWARE.&n; *&n; * Authors:&n; *    Jeff Hartmann &lt;jhartmann@valinux.com&gt;&n; *    Keith Whitwell &lt;keithw@valinux.com&gt;&n; *&n; * Rewritten by:&n; *    Gareth Hughes &lt;gareth@valinux.com&gt;&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;mga.h&quot;
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;drm.h&quot;
macro_line|#include &quot;mga_drm.h&quot;
macro_line|#include &quot;mga_drv.h&quot;
macro_line|#include &quot;drm.h&quot;
multiline_comment|/* ================================================================&n; * DMA hardware state programming functions&n; */
DECL|function|mga_emit_clip_rect
r_static
r_void
id|mga_emit_clip_rect
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
id|drm_clip_rect_t
op_star
id|box
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
r_int
r_int
id|pitch
op_assign
id|dev_priv-&gt;front_pitch
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Force reset of DWGCTL on G400 (eliminates clip disable bit).&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
id|DMA_BLOCK
c_func
(paren
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
comma
id|MGA_LEN
op_plus
id|MGA_EXEC
comma
l_int|0x80000000
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
comma
id|MGA_LEN
op_plus
id|MGA_EXEC
comma
l_int|0x80000000
)paren
suffix:semicolon
)brace
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_CXBNDRY
comma
(paren
id|box-&gt;x2
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
comma
id|MGA_YTOP
comma
id|box-&gt;y1
op_star
id|pitch
comma
id|MGA_YBOT
comma
id|box-&gt;y2
op_star
id|pitch
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g200_emit_context
r_static
r_inline
r_void
id|mga_g200_emit_context
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DSTORG
comma
id|ctx-&gt;dstorg
comma
id|MGA_MACCESS
comma
id|ctx-&gt;maccess
comma
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_ALPHACTRL
comma
id|ctx-&gt;alphactrl
comma
id|MGA_FOGCOL
comma
id|ctx-&gt;fogcolor
comma
id|MGA_WFLAG
comma
id|ctx-&gt;wflag
comma
id|MGA_ZORG
comma
id|dev_priv-&gt;depth_offset
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_FCOL
comma
id|ctx-&gt;fcol
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g400_emit_context
r_static
r_inline
r_void
id|mga_g400_emit_context
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DSTORG
comma
id|ctx-&gt;dstorg
comma
id|MGA_MACCESS
comma
id|ctx-&gt;maccess
comma
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_ALPHACTRL
comma
id|ctx-&gt;alphactrl
comma
id|MGA_FOGCOL
comma
id|ctx-&gt;fogcolor
comma
id|MGA_WFLAG
comma
id|ctx-&gt;wflag
comma
id|MGA_ZORG
comma
id|dev_priv-&gt;depth_offset
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WFLAG1
comma
id|ctx-&gt;wflag
comma
id|MGA_TDUALSTAGE0
comma
id|ctx-&gt;tdualstage0
comma
id|MGA_TDUALSTAGE1
comma
id|ctx-&gt;tdualstage1
comma
id|MGA_FCOL
comma
id|ctx-&gt;fcol
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_STENCIL
comma
id|ctx-&gt;stencil
comma
id|MGA_STENCILCTL
comma
id|ctx-&gt;stencilctl
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g200_emit_tex0
r_static
r_inline
r_void
id|mga_g200_emit_tex0
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|0
)braket
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXCTL2
comma
id|tex-&gt;texctl2
comma
id|MGA_TEXCTL
comma
id|tex-&gt;texctl
comma
id|MGA_TEXFILTER
comma
id|tex-&gt;texfilter
comma
id|MGA_TEXBORDERCOL
comma
id|tex-&gt;texbordercol
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG
comma
id|tex-&gt;texorg
comma
id|MGA_TEXORG1
comma
id|tex-&gt;texorg1
comma
id|MGA_TEXORG2
comma
id|tex-&gt;texorg2
comma
id|MGA_TEXORG3
comma
id|tex-&gt;texorg3
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG4
comma
id|tex-&gt;texorg4
comma
id|MGA_TEXWIDTH
comma
id|tex-&gt;texwidth
comma
id|MGA_TEXHEIGHT
comma
id|tex-&gt;texheight
comma
id|MGA_WR24
comma
id|tex-&gt;texwidth
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR34
comma
id|tex-&gt;texheight
comma
id|MGA_TEXTRANS
comma
l_int|0x0000ffff
comma
id|MGA_TEXTRANSHIGH
comma
l_int|0x0000ffff
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g400_emit_tex0
r_static
r_inline
r_void
id|mga_g400_emit_tex0
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|0
)braket
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
multiline_comment|/*  &t;printk(&quot;mga_g400_emit_tex0 %x %x %x&bslash;n&quot;, tex-&gt;texorg, */
multiline_comment|/*  &t;       tex-&gt;texctl, tex-&gt;texctl2); */
id|BEGIN_DMA
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXCTL2
comma
id|tex-&gt;texctl2
op_or
id|MGA_G400_TC2_MAGIC
comma
id|MGA_TEXCTL
comma
id|tex-&gt;texctl
comma
id|MGA_TEXFILTER
comma
id|tex-&gt;texfilter
comma
id|MGA_TEXBORDERCOL
comma
id|tex-&gt;texbordercol
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG
comma
id|tex-&gt;texorg
comma
id|MGA_TEXORG1
comma
id|tex-&gt;texorg1
comma
id|MGA_TEXORG2
comma
id|tex-&gt;texorg2
comma
id|MGA_TEXORG3
comma
id|tex-&gt;texorg3
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG4
comma
id|tex-&gt;texorg4
comma
id|MGA_TEXWIDTH
comma
id|tex-&gt;texwidth
comma
id|MGA_TEXHEIGHT
comma
id|tex-&gt;texheight
comma
id|MGA_WR49
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR57
comma
l_int|0x00000000
comma
id|MGA_WR53
comma
l_int|0x00000000
comma
id|MGA_WR61
comma
l_int|0x00000000
comma
id|MGA_WR52
comma
id|MGA_G400_WR_MAGIC
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR60
comma
id|MGA_G400_WR_MAGIC
comma
id|MGA_WR54
comma
id|tex-&gt;texwidth
op_or
id|MGA_G400_WR_MAGIC
comma
id|MGA_WR62
comma
id|tex-&gt;texheight
op_or
id|MGA_G400_WR_MAGIC
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_TEXTRANS
comma
l_int|0x0000ffff
comma
id|MGA_TEXTRANSHIGH
comma
l_int|0x0000ffff
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g400_emit_tex1
r_static
r_inline
r_void
id|mga_g400_emit_tex1
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|1
)braket
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
multiline_comment|/*  &t;printk(&quot;mga_g400_emit_tex1 %x %x %x&bslash;n&quot;, tex-&gt;texorg,  */
multiline_comment|/*  &t;       tex-&gt;texctl, tex-&gt;texctl2); */
id|BEGIN_DMA
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXCTL2
comma
(paren
id|tex-&gt;texctl2
op_or
id|MGA_MAP1_ENABLE
op_or
id|MGA_G400_TC2_MAGIC
)paren
comma
id|MGA_TEXCTL
comma
id|tex-&gt;texctl
comma
id|MGA_TEXFILTER
comma
id|tex-&gt;texfilter
comma
id|MGA_TEXBORDERCOL
comma
id|tex-&gt;texbordercol
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG
comma
id|tex-&gt;texorg
comma
id|MGA_TEXORG1
comma
id|tex-&gt;texorg1
comma
id|MGA_TEXORG2
comma
id|tex-&gt;texorg2
comma
id|MGA_TEXORG3
comma
id|tex-&gt;texorg3
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXORG4
comma
id|tex-&gt;texorg4
comma
id|MGA_TEXWIDTH
comma
id|tex-&gt;texwidth
comma
id|MGA_TEXHEIGHT
comma
id|tex-&gt;texheight
comma
id|MGA_WR49
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR57
comma
l_int|0x00000000
comma
id|MGA_WR53
comma
l_int|0x00000000
comma
id|MGA_WR61
comma
l_int|0x00000000
comma
id|MGA_WR52
comma
id|tex-&gt;texwidth
op_or
id|MGA_G400_WR_MAGIC
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR60
comma
id|tex-&gt;texheight
op_or
id|MGA_G400_WR_MAGIC
comma
id|MGA_TEXTRANS
comma
l_int|0x0000ffff
comma
id|MGA_TEXTRANSHIGH
comma
l_int|0x0000ffff
comma
id|MGA_TEXCTL2
comma
id|tex-&gt;texctl2
op_or
id|MGA_G400_TC2_MAGIC
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g200_emit_pipe
r_static
r_inline
r_void
id|mga_g200_emit_pipe
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|pipe
op_assign
id|sarea_priv-&gt;warp_pipe
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WIADDR
comma
id|MGA_WMODE_SUSPEND
comma
id|MGA_WVRTXSZ
comma
l_int|0x00000007
comma
id|MGA_WFLAG
comma
l_int|0x00000000
comma
id|MGA_WR24
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR25
comma
l_int|0x00000100
comma
id|MGA_WR34
comma
l_int|0x00000000
comma
id|MGA_WR42
comma
l_int|0x0000ffff
comma
id|MGA_WR60
comma
l_int|0x0000ffff
)paren
suffix:semicolon
multiline_comment|/* Padding required to to hardware bug.&n;&t; */
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_WIADDR
comma
(paren
id|dev_priv-&gt;warp_pipe_phys
(braket
id|pipe
)braket
op_or
id|MGA_WMODE_START
op_or
id|MGA_WAGP_ENABLE
)paren
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g400_emit_pipe
r_static
r_inline
r_void
id|mga_g400_emit_pipe
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|pipe
op_assign
id|sarea_priv-&gt;warp_pipe
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
multiline_comment|/*  &t;printk(&quot;mga_g400_emit_pipe %x&bslash;n&quot;, pipe); */
id|BEGIN_DMA
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WIADDR2
comma
id|MGA_WMODE_SUSPEND
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pipe
op_amp
id|MGA_T2
)paren
(brace
id|DMA_BLOCK
c_func
(paren
id|MGA_WVRTXSZ
comma
l_int|0x00001e09
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x1e000000
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev_priv-&gt;warp_pipe
op_amp
id|MGA_T2
)paren
(brace
multiline_comment|/* Flush the WARP pipe */
id|DMA_BLOCK
c_func
(paren
id|MGA_YDST
comma
l_int|0x00000000
comma
id|MGA_FXLEFT
comma
l_int|0x00000000
comma
id|MGA_FXRIGHT
comma
l_int|0x00000001
comma
id|MGA_DWGCTL
comma
id|MGA_DWGCTL_FLUSH
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_LEN
op_plus
id|MGA_EXEC
comma
l_int|0x00000001
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
comma
id|MGA_TEXCTL2
comma
id|MGA_G400_TC2_MAGIC
comma
id|MGA_LEN
op_plus
id|MGA_EXEC
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_TEXCTL2
comma
(paren
id|MGA_DUALTEX
op_or
id|MGA_G400_TC2_MAGIC
)paren
comma
id|MGA_LEN
op_plus
id|MGA_EXEC
comma
l_int|0x00000000
comma
id|MGA_TEXCTL2
comma
id|MGA_G400_TC2_MAGIC
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
id|DMA_BLOCK
c_func
(paren
id|MGA_WVRTXSZ
comma
l_int|0x00001807
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x00000000
comma
id|MGA_WACCEPTSEQ
comma
l_int|0x18000000
)paren
suffix:semicolon
)brace
id|DMA_BLOCK
c_func
(paren
id|MGA_WFLAG
comma
l_int|0x00000000
comma
id|MGA_WFLAG1
comma
l_int|0x00000000
comma
id|MGA_WR56
comma
id|MGA_G400_WR56_MAGIC
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_WR49
comma
l_int|0x00000000
comma
multiline_comment|/* tex0              */
id|MGA_WR57
comma
l_int|0x00000000
comma
multiline_comment|/* tex0              */
id|MGA_WR53
comma
l_int|0x00000000
comma
multiline_comment|/* tex1              */
id|MGA_WR61
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* tex1              */
id|DMA_BLOCK
c_func
(paren
id|MGA_WR54
comma
id|MGA_G400_WR_MAGIC
comma
multiline_comment|/* tex0 width        */
id|MGA_WR62
comma
id|MGA_G400_WR_MAGIC
comma
multiline_comment|/* tex0 height       */
id|MGA_WR52
comma
id|MGA_G400_WR_MAGIC
comma
multiline_comment|/* tex1 width        */
id|MGA_WR60
comma
id|MGA_G400_WR_MAGIC
)paren
suffix:semicolon
multiline_comment|/* tex1 height       */
multiline_comment|/* Padding required to to hardware bug */
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_DMAPAD
comma
l_int|0xffffffff
comma
id|MGA_WIADDR2
comma
(paren
id|dev_priv-&gt;warp_pipe_phys
(braket
id|pipe
)braket
op_or
id|MGA_WMODE_START
op_or
id|MGA_WAGP_ENABLE
)paren
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_g200_emit_state
r_static
r_void
id|mga_g200_emit_state
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;warp_pipe
op_ne
id|dev_priv-&gt;warp_pipe
)paren
(brace
id|mga_g200_emit_pipe
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|dev_priv-&gt;warp_pipe
op_assign
id|sarea_priv-&gt;warp_pipe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CONTEXT
)paren
(brace
id|mga_g200_emit_context
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
(brace
id|mga_g200_emit_tex0
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX0
suffix:semicolon
)brace
)brace
DECL|function|mga_g400_emit_state
r_static
r_void
id|mga_g400_emit_state
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_int
id|multitex
op_assign
id|sarea_priv-&gt;warp_pipe
op_amp
id|MGA_T2
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;warp_pipe
op_ne
id|dev_priv-&gt;warp_pipe
)paren
(brace
id|mga_g400_emit_pipe
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|dev_priv-&gt;warp_pipe
op_assign
id|sarea_priv-&gt;warp_pipe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CONTEXT
)paren
(brace
id|mga_g400_emit_context
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
(brace
id|mga_g400_emit_tex0
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX1
)paren
op_logical_and
id|multitex
)paren
(brace
id|mga_g400_emit_tex1
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|MGA_UPLOAD_TEX1
suffix:semicolon
)brace
)brace
multiline_comment|/* ================================================================&n; * SAREA state verification&n; */
multiline_comment|/* Disallow all write destinations except the front and backbuffer.&n; */
DECL|function|mga_verify_context
r_static
r_int
id|mga_verify_context
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;dstorg
op_ne
id|dev_priv-&gt;front_offset
op_logical_and
id|ctx-&gt;dstorg
op_ne
id|dev_priv-&gt;back_offset
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;*** bad DSTORG: %x (front %x, back %x)&bslash;n&bslash;n&quot;
comma
id|ctx-&gt;dstorg
comma
id|dev_priv-&gt;front_offset
comma
id|dev_priv-&gt;back_offset
)paren
suffix:semicolon
id|ctx-&gt;dstorg
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Disallow texture reads from PCI space.&n; */
DECL|function|mga_verify_tex
r_static
r_int
id|mga_verify_tex
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
r_int
id|unit
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
id|unit
)braket
suffix:semicolon
r_int
r_int
id|org
suffix:semicolon
id|org
op_assign
id|tex-&gt;texorg
op_amp
(paren
id|MGA_TEXORGMAP_MASK
op_or
id|MGA_TEXORGACC_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|org
op_eq
(paren
id|MGA_TEXORGMAP_SYSMEM
op_or
id|MGA_TEXORGACC_PCI
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;*** bad TEXORG: 0x%x, unit %d&bslash;n&quot;
comma
id|tex-&gt;texorg
comma
id|unit
)paren
suffix:semicolon
id|tex-&gt;texorg
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_verify_state
r_static
r_int
id|mga_verify_state
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_CONTEXT
)paren
id|ret
op_or_assign
id|mga_verify_context
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX0
)paren
id|ret
op_or_assign
id|mga_verify_tex
c_func
(paren
id|dev_priv
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;chipset
op_eq
id|MGA_CARD_TYPE_G400
)paren
(brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_TEX1
)paren
id|ret
op_or_assign
id|mga_verify_tex
c_func
(paren
id|dev_priv
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_PIPE
)paren
id|ret
op_or_assign
(paren
id|sarea_priv-&gt;warp_pipe
OG
id|MGA_MAX_G400_PIPES
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dirty
op_amp
id|MGA_UPLOAD_PIPE
)paren
id|ret
op_or_assign
(paren
id|sarea_priv-&gt;warp_pipe
OG
id|MGA_MAX_G200_PIPES
)paren
suffix:semicolon
)brace
r_return
(paren
id|ret
op_eq
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|mga_verify_iload
r_static
r_int
id|mga_verify_iload
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
r_int
r_int
id|dstorg
comma
r_int
r_int
id|length
)paren
(brace
r_if
c_cond
(paren
id|dstorg
template_param
(paren
id|dev_priv-&gt;texture_offset
op_plus
id|dev_priv-&gt;texture_size
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;*** bad iload DSTORG: 0x%x&bslash;n&quot;
comma
id|dstorg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
op_amp
id|MGA_ILOAD_MASK
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;*** bad iload length: 0x%x&bslash;n&quot;
comma
id|length
op_amp
id|MGA_ILOAD_MASK
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_verify_blit
r_static
r_int
id|mga_verify_blit
c_func
(paren
id|drm_mga_private_t
op_star
id|dev_priv
comma
r_int
r_int
id|srcorg
comma
r_int
r_int
id|dstorg
)paren
(brace
r_if
c_cond
(paren
(paren
id|srcorg
op_amp
l_int|0x3
)paren
op_eq
(paren
id|MGA_SRCACC_PCI
op_or
id|MGA_SRCMAP_SYSMEM
)paren
op_logical_or
(paren
id|dstorg
op_amp
l_int|0x3
)paren
op_eq
(paren
id|MGA_SRCACC_PCI
op_or
id|MGA_SRCMAP_SYSMEM
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;*** bad blit: src=0x%x dst=0x%x&bslash;n&quot;
comma
id|srcorg
comma
id|dstorg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; *&n; */
DECL|function|mga_dma_dispatch_clear
r_static
r_void
id|mga_dma_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_mga_clear_t
op_star
id|clear
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;:&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DWGSYNC
comma
l_int|0x00007100
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_clip_rect_t
op_star
id|box
op_assign
op_amp
id|pbox
(braket
id|i
)braket
suffix:semicolon
id|u32
id|height
op_assign
id|box-&gt;y2
op_minus
id|box-&gt;y1
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   from=%d,%d to=%d,%d&bslash;n&quot;
comma
id|box-&gt;x1
comma
id|box-&gt;y1
comma
id|box-&gt;x2
comma
id|box-&gt;y2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clear-&gt;flags
op_amp
id|MGA_FRONT
)paren
(brace
id|BEGIN_DMA
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|clear-&gt;color_mask
comma
id|MGA_YDSTLEN
comma
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|height
comma
id|MGA_FXBNDRY
comma
(paren
id|box-&gt;x2
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_FCOL
comma
id|clear-&gt;clear_color
comma
id|MGA_DSTORG
comma
id|dev_priv-&gt;front_offset
comma
id|MGA_DWGCTL
op_plus
id|MGA_EXEC
comma
id|dev_priv-&gt;clear_cmd
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clear-&gt;flags
op_amp
id|MGA_BACK
)paren
(brace
id|BEGIN_DMA
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|clear-&gt;color_mask
comma
id|MGA_YDSTLEN
comma
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|height
comma
id|MGA_FXBNDRY
comma
(paren
id|box-&gt;x2
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_FCOL
comma
id|clear-&gt;clear_color
comma
id|MGA_DSTORG
comma
id|dev_priv-&gt;back_offset
comma
id|MGA_DWGCTL
op_plus
id|MGA_EXEC
comma
id|dev_priv-&gt;clear_cmd
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clear-&gt;flags
op_amp
id|MGA_DEPTH
)paren
(brace
id|BEGIN_DMA
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|clear-&gt;depth_mask
comma
id|MGA_YDSTLEN
comma
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|height
comma
id|MGA_FXBNDRY
comma
(paren
id|box-&gt;x2
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_FCOL
comma
id|clear-&gt;clear_depth
comma
id|MGA_DSTORG
comma
id|dev_priv-&gt;depth_offset
comma
id|MGA_DWGCTL
op_plus
id|MGA_EXEC
comma
id|dev_priv-&gt;clear_cmd
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|BEGIN_DMA
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Force reset of DWGCTL */
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
id|FLUSH_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_swap
r_static
r_void
id|mga_dma_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;:&bslash;n&quot;
)paren
suffix:semicolon
id|sarea_priv-&gt;last_frame.head
op_assign
id|dev_priv-&gt;prim.tail
suffix:semicolon
id|sarea_priv-&gt;last_frame.wrap
op_assign
id|dev_priv-&gt;prim.last_wrap
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|4
op_plus
id|nbox
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DWGSYNC
comma
l_int|0x00007100
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DSTORG
comma
id|dev_priv-&gt;front_offset
comma
id|MGA_MACCESS
comma
id|dev_priv-&gt;maccess
comma
id|MGA_SRCORG
comma
id|dev_priv-&gt;back_offset
comma
id|MGA_AR5
comma
id|dev_priv-&gt;front_pitch
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
l_int|0xffffffff
comma
id|MGA_DWGCTL
comma
id|MGA_DWGCTL_COPY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_clip_rect_t
op_star
id|box
op_assign
op_amp
id|pbox
(braket
id|i
)braket
suffix:semicolon
id|u32
id|height
op_assign
id|box-&gt;y2
op_minus
id|box-&gt;y1
suffix:semicolon
id|u32
id|start
op_assign
id|box-&gt;y1
op_star
id|dev_priv-&gt;front_pitch
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   from=%d,%d to=%d,%d&bslash;n&quot;
comma
id|box-&gt;x1
comma
id|box-&gt;y1
comma
id|box-&gt;x2
comma
id|box-&gt;y2
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_AR0
comma
id|start
op_plus
id|box-&gt;x2
op_minus
l_int|1
comma
id|MGA_AR3
comma
id|start
op_plus
id|box-&gt;x1
comma
id|MGA_FXBNDRY
comma
(paren
(paren
id|box-&gt;x2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
comma
id|MGA_YDSTLEN
op_plus
id|MGA_EXEC
comma
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|height
)paren
suffix:semicolon
)brace
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_SRCORG
comma
id|dev_priv-&gt;front_offset
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
id|FLUSH_DMA
c_func
(paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s... done.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_vertex
r_static
r_void
id|mga_dma_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|u32
id|address
op_assign
(paren
id|u32
)paren
id|buf-&gt;bus_address
suffix:semicolon
id|u32
id|length
op_assign
(paren
id|u32
)paren
id|buf-&gt;used
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;vertex: buf=%d used=%d&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;used
)paren
(brace
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
id|MGA_EMIT_STATE
c_func
(paren
id|dev_priv
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|mga_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|BEGIN_DMA
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_SECADDRESS
comma
(paren
id|address
op_or
id|MGA_DMA_VERTEX
)paren
comma
id|MGA_SECEND
comma
(paren
(paren
id|address
op_plus
id|length
)paren
op_or
id|MGA_PAGPXFER
)paren
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
id|AGE_BUFFER
c_func
(paren
id|buf_priv
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|FLUSH_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_indices
r_static
r_void
id|mga_dma_dispatch_indices
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|u32
id|address
op_assign
(paren
id|u32
)paren
id|buf-&gt;bus_address
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indices: buf=%d start=%d end=%d&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|start
comma
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
id|MGA_EMIT_STATE
c_func
(paren
id|dev_priv
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|mga_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|BEGIN_DMA
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_SETUPADDRESS
comma
id|address
op_plus
id|start
comma
id|MGA_SETUPEND
comma
(paren
(paren
id|address
op_plus
id|end
)paren
op_or
id|MGA_PAGPXFER
)paren
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
id|AGE_BUFFER
c_func
(paren
id|buf_priv
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|FLUSH_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This copies a 64 byte aligned agp region to the frambuffer with a&n; * standard blit, the ioctl needs to do checking.&n; */
DECL|function|mga_dma_dispatch_iload
r_static
r_void
id|mga_dma_dispatch_iload
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
r_int
id|dstorg
comma
r_int
r_int
id|length
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|dev_priv-&gt;sarea_priv-&gt;context_state
suffix:semicolon
id|u32
id|srcorg
op_assign
id|buf-&gt;bus_address
op_or
id|MGA_SRCACC_AGP
op_or
id|MGA_SRCMAP_SYSMEM
suffix:semicolon
id|u32
id|y2
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: buf=%d used=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|buf-&gt;idx
comma
id|buf-&gt;used
)paren
suffix:semicolon
id|y2
op_assign
id|length
op_div
l_int|64
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DWGSYNC
comma
l_int|0x00007100
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DSTORG
comma
id|dstorg
comma
id|MGA_MACCESS
comma
l_int|0x00000000
comma
id|MGA_SRCORG
comma
id|srcorg
comma
id|MGA_AR5
comma
l_int|64
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_PITCH
comma
l_int|64
comma
id|MGA_PLNWT
comma
l_int|0xffffffff
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DWGCTL
comma
id|MGA_DWGCTL_COPY
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_AR0
comma
l_int|63
comma
id|MGA_AR3
comma
l_int|0
comma
id|MGA_FXBNDRY
comma
(paren
l_int|63
op_lshift
l_int|16
)paren
op_or
l_int|0
comma
id|MGA_YDSTLEN
op_plus
id|MGA_EXEC
comma
id|y2
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_SRCORG
comma
id|dev_priv-&gt;front_offset
comma
id|MGA_PITCH
comma
id|dev_priv-&gt;front_pitch
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
id|AGE_BUFFER
c_func
(paren
id|buf_priv
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|FLUSH_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|mga_dma_dispatch_blit
r_static
r_void
id|mga_dma_dispatch_blit
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_mga_blit_t
op_star
id|blit
)paren
(brace
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|u32
id|scandir
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|DMA_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;:&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_DMA
c_func
(paren
l_int|4
op_plus
id|nbox
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_DWGSYNC
comma
l_int|0x00007100
comma
id|MGA_DWGSYNC
comma
l_int|0x00007000
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_DWGCTL
comma
id|MGA_DWGCTL_COPY
comma
id|MGA_PLNWT
comma
id|blit-&gt;planemask
comma
id|MGA_SRCORG
comma
id|blit-&gt;srcorg
comma
id|MGA_DSTORG
comma
id|blit-&gt;dstorg
)paren
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_SGN
comma
id|scandir
comma
id|MGA_MACCESS
comma
id|dev_priv-&gt;maccess
comma
id|MGA_AR5
comma
id|blit-&gt;ydir
op_star
id|blit-&gt;src_pitch
comma
id|MGA_PITCH
comma
id|blit-&gt;dst_pitch
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|srcx
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
op_plus
id|blit-&gt;delta_sx
suffix:semicolon
r_int
id|srcy
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
op_plus
id|blit-&gt;delta_sy
suffix:semicolon
r_int
id|dstx
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
op_plus
id|blit-&gt;delta_dx
suffix:semicolon
r_int
id|dsty
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
op_plus
id|blit-&gt;delta_dy
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|pbox
(braket
id|i
)braket
dot
id|x1
op_minus
l_int|1
suffix:semicolon
r_int
id|start
suffix:semicolon
r_if
c_cond
(paren
id|blit-&gt;ydir
op_eq
op_minus
l_int|1
)paren
(brace
id|srcy
op_assign
id|blit-&gt;height
op_minus
id|srcy
op_minus
l_int|1
suffix:semicolon
)brace
id|start
op_assign
id|srcy
op_star
id|blit-&gt;src_pitch
op_plus
id|srcx
suffix:semicolon
id|DMA_BLOCK
c_func
(paren
id|MGA_AR0
comma
id|start
op_plus
id|w
comma
id|MGA_AR3
comma
id|start
comma
id|MGA_FXBNDRY
comma
(paren
(paren
id|dstx
op_plus
id|w
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|dstx
op_amp
l_int|0xffff
)paren
comma
id|MGA_YDSTLEN
op_plus
id|MGA_EXEC
comma
(paren
id|dsty
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
)brace
multiline_comment|/* Do something to flush AGP?&n;&t; */
multiline_comment|/* Force reset of DWGCTL */
id|DMA_BLOCK
c_func
(paren
id|MGA_DMAPAD
comma
l_int|0x00000000
comma
id|MGA_PLNWT
comma
id|ctx-&gt;plnwt
comma
id|MGA_PITCH
comma
id|dev_priv-&gt;front_pitch
comma
id|MGA_DWGCTL
comma
id|ctx-&gt;dwgctl
)paren
suffix:semicolon
id|ADVANCE_DMA
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; *&n; */
DECL|function|mga_dma_clear
r_int
id|mga_dma_clear
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_clear_t
id|clear
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clear
comma
(paren
id|drm_mga_clear_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clear
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_clear
c_func
(paren
id|dev
comma
op_amp
id|clear
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_swap
r_int
id|mga_dma_swap
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_vertex
r_int
id|mga_dma_vertex
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_vertex_t
id|vertex
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_mga_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
template_param
id|dma-&gt;buf_count
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|buf-&gt;used
op_assign
id|vertex.used
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|vertex.discard
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mga_verify_state
c_func
(paren
id|dev_priv
)paren
)paren
(brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGE_BUFFER
c_func
(paren
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_indices
r_int
id|mga_dma_indices
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_indices_t
id|indices
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|indices
comma
(paren
id|drm_mga_indices_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|indices
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|indices.idx
template_param
id|dma-&gt;buf_count
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|indices.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|indices.discard
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mga_verify_state
c_func
(paren
id|dev_priv
)paren
)paren
(brace
r_if
c_cond
(paren
id|indices.discard
)paren
(brace
r_if
c_cond
(paren
id|buf_priv-&gt;dispatched
op_eq
l_int|1
)paren
id|AGE_BUFFER
c_func
(paren
id|buf_priv
)paren
suffix:semicolon
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
id|indices.start
comma
id|indices.end
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_iload
r_int
id|mga_dma_iload
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_mga_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_mga_iload_t
id|iload
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;:&bslash;n&quot;
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|iload
comma
(paren
id|drm_mga_iload_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|iload
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|mga_do_wait_for_idle
c_func
(paren
id|dev_priv
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|MGA_DMA_DEBUG
)paren
id|DRM_INFO
c_func
(paren
id|__FUNCTION__
l_string|&quot;: -EBUSY&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|iload.idx
template_param
id|dma-&gt;buf_count
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|iload.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|mga_verify_iload
c_func
(paren
id|dev_priv
comma
id|iload.dstorg
comma
id|iload.length
)paren
)paren
(brace
id|mga_freelist_put
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_iload
c_func
(paren
id|dev
comma
id|buf
comma
id|iload.dstorg
comma
id|iload.length
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mga_dma_blit
r_int
id|mga_dma_blit
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_mga_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_mga_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_mga_blit_t
id|blit
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|blit
comma
(paren
id|drm_mga_blit_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|blit
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|MGA_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|MGA_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|mga_verify_blit
c_func
(paren
id|dev_priv
comma
id|blit.srcorg
comma
id|blit.dstorg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|WRAP_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|mga_dma_dispatch_blit
c_func
(paren
id|dev
comma
op_amp
id|blit
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
id|MGA_UPLOAD_CONTEXT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
