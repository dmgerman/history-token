multiline_comment|/* gamma_dma.c -- DMA support for GMX 2000 -*- linux-c -*-&n; * Created: Fri Mar 19 14:30:16 1999 by faith@precisioninsight.com&n; *&n; * Copyright 1999 Precision Insight, Inc., Cedar Park, Texas.&n; * Copyright 2000 VA Linux Systems, Inc., Sunnyvale, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors:&n; *    Rickard E. (Rik) Faith &lt;faith@valinux.com&gt;&n; *&n; */
macro_line|#include &quot;gamma.h&quot;
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;drm.h&quot;
macro_line|#include &quot;gamma_drm.h&quot;
macro_line|#include &quot;gamma_drv.h&quot;
macro_line|#include &lt;linux/interrupt.h&gt;&t;/* For task queue support */
macro_line|#include &lt;linux/delay.h&gt;
DECL|function|gamma_dma_dispatch
r_static
r_inline
r_void
id|gamma_dma_dispatch
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
r_int
id|address
comma
r_int
r_int
id|length
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|2
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_DMAADDRESS
comma
id|address
)paren
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_GCOMMANDSTATUS
)paren
op_ne
l_int|4
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_DMACOUNT
comma
id|length
op_div
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|gamma_dma_quiescent_single
r_void
id|gamma_dma_quiescent_single
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_DMACOUNT
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|2
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_FILTERMODE
comma
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_SYNC
comma
l_int|0
)paren
suffix:semicolon
r_do
(brace
r_while
c_loop
(paren
op_logical_neg
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTFIFOWORDS
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTPUTFIFO
)paren
op_ne
id|GAMMA_SYNC_TAG
)paren
suffix:semicolon
)brace
DECL|function|gamma_dma_quiescent_dual
r_void
id|gamma_dma_quiescent_dual
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_DMACOUNT
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|3
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_BROADCASTMASK
comma
l_int|3
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_FILTERMODE
comma
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_SYNC
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Read from first MX */
r_do
(brace
r_while
c_loop
(paren
op_logical_neg
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTFIFOWORDS
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTPUTFIFO
)paren
op_ne
id|GAMMA_SYNC_TAG
)paren
suffix:semicolon
multiline_comment|/* Read from second MX */
r_do
(brace
r_while
c_loop
(paren
op_logical_neg
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTFIFOWORDS
op_plus
l_int|0x10000
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_OUTPUTFIFO
op_plus
l_int|0x10000
)paren
op_ne
id|GAMMA_SYNC_TAG
)paren
suffix:semicolon
)brace
DECL|function|gamma_dma_ready
r_void
id|gamma_dma_ready
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_DMACOUNT
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|gamma_dma_is_ready
r_static
r_inline
r_int
id|gamma_dma_is_ready
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_return
(paren
op_logical_neg
id|GAMMA_READ
c_func
(paren
id|GAMMA_DMACOUNT
)paren
)paren
suffix:semicolon
)brace
DECL|function|gamma_irq_handler
id|irqreturn_t
id|gamma_irq_handler
c_func
(paren
id|DRM_IRQ_ARGS
)paren
(brace
id|drm_device_t
op_star
id|dev
op_assign
(paren
id|drm_device_t
op_star
)paren
id|arg
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
multiline_comment|/* FIXME: should check whether we&squot;re actually interested in the interrupt? */
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|6
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_IRQ */
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|3
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GDELAYTIMER
comma
l_int|0xc350
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 0x05S */
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GCOMMANDINTFLAGS
comma
l_int|8
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GINTFLAGS
comma
l_int|0x2001
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gamma_dma_is_ready
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* Free previous buffer */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
)paren
r_return
id|IRQ_HANDLED
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;this_buffer
)paren
(brace
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|dma-&gt;this_buffer
)paren
suffix:semicolon
id|dma-&gt;this_buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
multiline_comment|/* Dispatch new buffer */
id|schedule_work
c_func
(paren
op_amp
id|dev-&gt;work
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/* Only called by gamma_dma_schedule. */
DECL|function|gamma_do_dma
r_static
r_int
id|gamma_do_dma
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|locked
)paren
(brace
r_int
r_int
id|address
suffix:semicolon
r_int
r_int
id|length
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;next_buffer
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;No next_buffer&bslash;n&quot;
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;next_buffer
suffix:semicolon
multiline_comment|/* WE NOW ARE ON LOGICAL PAGES!! - using page table setup in dma_init */
multiline_comment|/* So we pass the buffer index value into the physical page offset */
id|address
op_assign
id|buf-&gt;idx
op_lshift
l_int|12
suffix:semicolon
id|length
op_assign
id|buf-&gt;used
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;context %d, buffer %d (%ld bytes)&bslash;n&quot;
comma
id|buf-&gt;context
comma
id|buf-&gt;idx
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;list
op_eq
id|DRM_LIST_RECLAIM
)paren
(brace
id|gamma_clear_next_buffer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|length
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;0 length buffer&bslash;n&quot;
)paren
suffix:semicolon
id|gamma_clear_next_buffer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gamma_dma_is_ready
c_func
(paren
id|dev
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;while_locked
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Dispatching buffer %d from pid %d&quot;
l_string|&quot; &bslash;&quot;while locked&bslash;&quot;, but no lock held&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|current-&gt;pid
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|locked
op_logical_and
op_logical_neg
id|gamma_lock_take
c_func
(paren
op_amp
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|DRM_KERNEL_CONTEXT
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;last_context
op_ne
id|buf-&gt;context
op_logical_and
op_logical_neg
(paren
id|dev-&gt;queuelist
(braket
id|buf-&gt;context
)braket
op_member_access_from_pointer
id|flags
op_amp
id|_DRM_CONTEXT_PRESERVED
)paren
)paren
(brace
multiline_comment|/* PRE: dev-&gt;last_context != buf-&gt;context */
r_if
c_cond
(paren
id|DRM
c_func
(paren
id|context_switch
)paren
(paren
id|dev
comma
id|dev-&gt;last_context
comma
id|buf-&gt;context
)paren
)paren
(brace
id|DRM
c_func
(paren
id|clear_next_buffer
)paren
(paren
id|dev
)paren
suffix:semicolon
id|DRM
c_func
(paren
id|free_buffer
)paren
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|retcode
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
multiline_comment|/* POST: we will wait for the context&n;&t;&t;&t;&t;   switch and will dispatch on a later call&n;&t;&t;&t;&t;   when dev-&gt;last_context == buf-&gt;context.&n;&t;&t;&t;&t;   NOTE WE HOLD THE LOCK THROUGHOUT THIS&n;&t;&t;&t;&t;   TIME! */
)brace
id|gamma_clear_next_buffer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
id|buf-&gt;waiting
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;list
op_assign
id|DRM_LIST_PEND
suffix:semicolon
multiline_comment|/* WE NOW ARE ON LOGICAL PAGES!!! - overriding address */
id|address
op_assign
id|buf-&gt;idx
op_lshift
l_int|12
suffix:semicolon
id|gamma_dma_dispatch
c_func
(paren
id|dev
comma
id|address
comma
id|length
)paren
suffix:semicolon
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|dma-&gt;this_buffer
)paren
suffix:semicolon
id|dma-&gt;this_buffer
op_assign
id|buf
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|7
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_DMA */
id|atomic_add
c_func
(paren
id|length
comma
op_amp
id|dev-&gt;counts
(braket
l_int|8
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_PRIMARY */
r_if
c_cond
(paren
op_logical_neg
id|buf-&gt;while_locked
op_logical_and
op_logical_neg
id|dev-&gt;context_flag
op_logical_and
op_logical_neg
id|locked
)paren
(brace
r_if
c_cond
(paren
id|gamma_lock_free
c_func
(paren
id|dev
comma
op_amp
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|DRM_KERNEL_CONTEXT
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|cleanup
suffix:colon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;dma_flag
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|gamma_dma_timer_bh
r_static
r_void
id|gamma_dma_timer_bh
c_func
(paren
r_int
r_int
id|dev
)paren
(brace
id|gamma_dma_schedule
c_func
(paren
(paren
id|drm_device_t
op_star
)paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|gamma_irq_immediate_bh
r_void
id|gamma_irq_immediate_bh
c_func
(paren
r_void
op_star
id|dev
)paren
(brace
id|gamma_dma_schedule
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|gamma_dma_schedule
r_int
id|gamma_dma_schedule
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|locked
)paren
(brace
r_int
id|next
suffix:semicolon
id|drm_queue_t
op_star
id|q
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
r_int
id|processed
op_assign
l_int|0
suffix:semicolon
r_int
id|missed
suffix:semicolon
r_int
id|expire
op_assign
l_int|20
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
)paren
(brace
multiline_comment|/* Not reentrant */
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|10
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_MISSED */
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|missed
op_assign
id|atomic_read
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|10
)braket
)paren
suffix:semicolon
id|again
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;context_flag
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;next_buffer
)paren
(brace
multiline_comment|/* Unsent buffer that was previously&n;&t;&t;&t;&t;   selected, but that couldn&squot;t be sent&n;&t;&t;&t;&t;   because the lock could not be obtained&n;&t;&t;&t;&t;   or the DMA engine wasn&squot;t ready.  Try&n;&t;&t;&t;&t;   again. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|retcode
op_assign
id|gamma_do_dma
c_func
(paren
id|dev
comma
id|locked
)paren
)paren
)paren
op_increment
id|processed
suffix:semicolon
)brace
r_else
(brace
r_do
(brace
id|next
op_assign
id|gamma_select_queue
c_func
(paren
id|dev
comma
id|gamma_dma_timer_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_ge
l_int|0
)paren
(brace
id|q
op_assign
id|dev-&gt;queuelist
(braket
id|next
)braket
suffix:semicolon
id|buf
op_assign
id|gamma_waitlist_get
c_func
(paren
op_amp
id|q-&gt;waitlist
)paren
suffix:semicolon
id|dma-&gt;next_buffer
op_assign
id|buf
suffix:semicolon
id|dma-&gt;next_queue
op_assign
id|q
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_logical_and
id|buf-&gt;list
op_eq
id|DRM_LIST_RECLAIM
)paren
(brace
id|gamma_clear_next_buffer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|next
op_ge
l_int|0
op_logical_and
op_logical_neg
id|dma-&gt;next_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;next_buffer
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|retcode
op_assign
id|gamma_do_dma
c_func
(paren
id|dev
comma
id|locked
)paren
)paren
)paren
(brace
op_increment
id|processed
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_decrement
id|expire
)paren
(brace
r_if
c_cond
(paren
id|missed
op_ne
id|atomic_read
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|10
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
id|gamma_dma_is_ready
c_func
(paren
id|dev
)paren
)paren
r_goto
id|again
suffix:semicolon
)brace
r_if
c_cond
(paren
id|processed
op_logical_and
id|gamma_dma_is_ready
c_func
(paren
id|dev
)paren
)paren
(brace
id|processed
op_assign
l_int|0
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
)brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|gamma_dma_priority
r_static
r_int
id|gamma_dma_priority
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
id|drm_device_t
op_star
id|dev
comma
id|drm_dma_t
op_star
id|d
)paren
(brace
r_int
r_int
id|address
suffix:semicolon
r_int
r_int
id|length
suffix:semicolon
r_int
id|must_free
op_assign
l_int|0
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_buf_t
op_star
id|last_buf
op_assign
l_int|NULL
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
op_star
id|send_indices
op_assign
l_int|NULL
suffix:semicolon
r_int
op_star
id|send_sizes
op_assign
l_int|NULL
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|entry
comma
id|current
)paren
suffix:semicolon
multiline_comment|/* Turn off interrupt handling */
r_while
c_loop
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d-&gt;flags
op_amp
id|_DRM_DMA_WHILE_LOCKED
)paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|gamma_lock_take
c_func
(paren
op_amp
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|DRM_KERNEL_CONTEXT
)paren
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
op_increment
id|must_free
suffix:semicolon
)brace
id|send_indices
op_assign
id|DRM
c_func
(paren
id|alloc
)paren
(paren
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_indices
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_indices
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|send_indices
comma
id|d-&gt;send_indices
comma
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_indices
)paren
)paren
)paren
(brace
id|retcode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|send_sizes
op_assign
id|DRM
c_func
(paren
id|alloc
)paren
(paren
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_sizes
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_sizes
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|send_sizes
comma
id|d-&gt;send_sizes
comma
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_sizes
)paren
)paren
)paren
(brace
id|retcode
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;send_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idx
op_assign
id|send_indices
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
op_logical_or
id|idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Index %d (of %d max)&bslash;n&quot;
comma
id|send_indices
(braket
id|i
)braket
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Process %d using buffer not owned&bslash;n&quot;
comma
id|current-&gt;pid
)paren
suffix:semicolon
id|retcode
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;list
op_ne
id|DRM_LIST_NONE
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Process %d using buffer on list %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;list
)paren
suffix:semicolon
id|retcode
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* This isn&squot;t a race condition on&n;&t;&t;&t;&t;   buf-&gt;list, since our concern is the&n;&t;&t;&t;&t;   buffer reclaim during the time the&n;&t;&t;&t;&t;   process closes the /dev/drm? handle, so&n;&t;&t;&t;&t;   it can&squot;t also be doing DMA. */
id|buf-&gt;list
op_assign
id|DRM_LIST_PRIO
suffix:semicolon
id|buf-&gt;used
op_assign
id|send_sizes
(braket
id|i
)braket
suffix:semicolon
id|buf-&gt;context
op_assign
id|d-&gt;context
suffix:semicolon
id|buf-&gt;while_locked
op_assign
id|d-&gt;flags
op_amp
id|_DRM_DMA_WHILE_LOCKED
suffix:semicolon
id|address
op_assign
(paren
r_int
r_int
)paren
id|buf-&gt;address
suffix:semicolon
id|length
op_assign
id|buf-&gt;used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|length
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;0 length buffer&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Sending pending buffer:&quot;
l_string|&quot; buffer %d, offset %d&bslash;n&quot;
comma
id|send_indices
(braket
id|i
)braket
comma
id|i
)paren
suffix:semicolon
id|retcode
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;waiting
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Sending waiting buffer:&quot;
l_string|&quot; buffer %d, offset %d&bslash;n&quot;
comma
id|send_indices
(braket
id|i
)braket
comma
id|i
)paren
suffix:semicolon
id|retcode
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;last_context
op_ne
id|buf-&gt;context
op_logical_and
op_logical_neg
(paren
id|dev-&gt;queuelist
(braket
id|buf-&gt;context
)braket
op_member_access_from_pointer
id|flags
op_amp
id|_DRM_CONTEXT_PRESERVED
)paren
)paren
(brace
id|add_wait_queue
c_func
(paren
op_amp
id|dev-&gt;context_wait
comma
op_amp
id|entry
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
multiline_comment|/* PRE: dev-&gt;last_context != buf-&gt;context */
id|DRM
c_func
(paren
id|context_switch
)paren
(paren
id|dev
comma
id|dev-&gt;last_context
comma
id|buf-&gt;context
)paren
suffix:semicolon
multiline_comment|/* POST: we will wait for the context&n;&t;&t;&t;&t;   switch and will dispatch on a later call&n;&t;&t;&t;&t;   when dev-&gt;last_context == buf-&gt;context.&n;&t;&t;&t;&t;   NOTE WE HOLD THE LOCK THROUGHOUT THIS&n;&t;&t;&t;&t;   TIME! */
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|dev-&gt;context_wait
comma
op_amp
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|retcode
op_assign
op_minus
id|EINTR
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;last_context
op_ne
id|buf-&gt;context
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Context mismatch: %d %d&bslash;n&quot;
comma
id|dev-&gt;last_context
comma
id|buf-&gt;context
)paren
suffix:semicolon
)brace
)brace
id|gamma_dma_dispatch
c_func
(paren
id|dev
comma
id|address
comma
id|length
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;counts
(braket
l_int|9
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_SPECIAL */
id|atomic_add
c_func
(paren
id|length
comma
op_amp
id|dev-&gt;counts
(braket
l_int|8
)braket
)paren
suffix:semicolon
multiline_comment|/* _DRM_STAT_PRIMARY */
r_if
c_cond
(paren
id|last_buf
)paren
(brace
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|last_buf
)paren
suffix:semicolon
)brace
id|last_buf
op_assign
id|buf
suffix:semicolon
)brace
id|cleanup
suffix:colon
r_if
c_cond
(paren
id|last_buf
)paren
(brace
id|gamma_dma_ready
c_func
(paren
id|dev
)paren
suffix:semicolon
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|last_buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|send_indices
)paren
id|DRM
c_func
(paren
id|free
)paren
(paren
id|send_indices
comma
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_indices
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|send_sizes
)paren
id|DRM
c_func
(paren
id|free
)paren
(paren
id|send_sizes
comma
id|d-&gt;send_count
op_star
r_sizeof
(paren
op_star
id|send_sizes
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|must_free
op_logical_and
op_logical_neg
id|dev-&gt;context_flag
)paren
(brace
r_if
c_cond
(paren
id|gamma_lock_free
c_func
(paren
id|dev
comma
op_amp
id|dev-&gt;lock.hw_lock-&gt;lock
comma
id|DRM_KERNEL_CONTEXT
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|dev-&gt;interrupt_flag
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|gamma_dma_send_buffers
r_static
r_int
id|gamma_dma_send_buffers
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
id|drm_device_t
op_star
id|dev
comma
id|drm_dma_t
op_star
id|d
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|entry
comma
id|current
)paren
suffix:semicolon
id|drm_buf_t
op_star
id|last_buf
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
id|send_index
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|send_index
comma
op_amp
id|d-&gt;send_indices
(braket
id|d-&gt;send_count
op_minus
l_int|1
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|_DRM_DMA_BLOCK
)paren
(brace
id|last_buf
op_assign
id|dma-&gt;buflist
(braket
id|send_index
)braket
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|last_buf-&gt;dma_wait
comma
op_amp
id|entry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|retcode
op_assign
id|gamma_dma_enqueue
c_func
(paren
id|filp
comma
id|d
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|_DRM_DMA_BLOCK
)paren
id|remove_wait_queue
c_func
(paren
op_amp
id|last_buf-&gt;dma_wait
comma
op_amp
id|entry
)paren
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
id|gamma_dma_schedule
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|_DRM_DMA_BLOCK
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d waiting&bslash;n&quot;
comma
id|current-&gt;pid
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|last_buf-&gt;waiting
op_logical_and
op_logical_neg
id|last_buf-&gt;pending
)paren
r_break
suffix:semicolon
multiline_comment|/* finished */
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|retcode
op_assign
op_minus
id|EINTR
suffix:semicolon
multiline_comment|/* Can&squot;t restart */
r_break
suffix:semicolon
)brace
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d running&bslash;n&quot;
comma
id|current-&gt;pid
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|last_buf-&gt;dma_wait
comma
op_amp
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retcode
op_logical_or
(paren
id|last_buf-&gt;list
op_eq
id|DRM_LIST_PEND
op_logical_and
op_logical_neg
id|last_buf-&gt;pending
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|waitqueue_active
c_func
(paren
op_amp
id|last_buf-&gt;dma_wait
)paren
)paren
(brace
id|gamma_free_buffer
c_func
(paren
id|dev
comma
id|last_buf
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|retcode
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;ctx%d w%d p%d c%ld i%d l%d pid:%d&bslash;n&quot;
comma
id|d-&gt;context
comma
id|last_buf-&gt;waiting
comma
id|last_buf-&gt;pending
comma
(paren
r_int
)paren
id|DRM_WAITCOUNT
c_func
(paren
id|dev
comma
id|d-&gt;context
)paren
comma
id|last_buf-&gt;idx
comma
id|last_buf-&gt;list
comma
id|current-&gt;pid
)paren
suffix:semicolon
)brace
)brace
r_return
id|retcode
suffix:semicolon
)brace
DECL|function|gamma_dma
r_int
id|gamma_dma
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
id|retcode
op_assign
l_int|0
suffix:semicolon
id|drm_dma_t
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
id|drm_dma_t
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|d
comma
id|argp
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|d.send_count
template_param
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Process %d trying to send %d buffers (of %d max)&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|d.send_count
comma
id|dma-&gt;buf_count
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d.request_count
template_param
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Process %d trying to get %d buffers (of %d max)&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|d.request_count
comma
id|dma-&gt;buf_count
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d.send_count
)paren
(brace
r_if
c_cond
(paren
id|d.flags
op_amp
id|_DRM_DMA_PRIORITY
)paren
id|retcode
op_assign
id|gamma_dma_priority
c_func
(paren
id|filp
comma
id|dev
comma
op_amp
id|d
)paren
suffix:semicolon
r_else
id|retcode
op_assign
id|gamma_dma_send_buffers
c_func
(paren
id|filp
comma
id|dev
comma
op_amp
id|d
)paren
suffix:semicolon
)brace
id|d.granted_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|retcode
op_logical_and
id|d.request_count
)paren
(brace
id|retcode
op_assign
id|gamma_dma_get_buffers
c_func
(paren
id|filp
comma
op_amp
id|d
)paren
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%d returning, granted = %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|d.granted_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|d
comma
r_sizeof
(paren
id|d
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|retcode
suffix:semicolon
)brace
multiline_comment|/* =============================================================&n; * DMA initialization, cleanup&n; */
DECL|function|gamma_do_init_dma
r_static
r_int
id|gamma_do_init_dma
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_gamma_init_t
op_star
id|init
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_int
r_int
op_star
id|pgt
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dev_priv
op_assign
id|DRM
c_func
(paren
id|alloc
)paren
(paren
r_sizeof
(paren
id|drm_gamma_private_t
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dev-&gt;dev_private
op_assign
(paren
r_void
op_star
)paren
id|dev_priv
suffix:semicolon
id|memset
c_func
(paren
id|dev_priv
comma
l_int|0
comma
r_sizeof
(paren
id|drm_gamma_private_t
)paren
)paren
suffix:semicolon
id|dev_priv-&gt;num_rast
op_assign
id|init-&gt;num_rast
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|dev-&gt;maplist-&gt;head
)paren
(brace
id|drm_map_list_t
op_star
id|r_list
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|drm_map_list_t
comma
id|head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r_list-&gt;map
op_logical_and
id|r_list-&gt;map-&gt;type
op_eq
id|_DRM_SHM
op_logical_and
id|r_list-&gt;map-&gt;flags
op_amp
id|_DRM_CONTAINS_LOCK
)paren
(brace
id|dev_priv-&gt;sarea
op_assign
id|r_list-&gt;map
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|DRM_FIND_MAP
c_func
(paren
id|dev_priv-&gt;mmio0
comma
id|init-&gt;mmio0
)paren
suffix:semicolon
id|DRM_FIND_MAP
c_func
(paren
id|dev_priv-&gt;mmio1
comma
id|init-&gt;mmio1
)paren
suffix:semicolon
id|DRM_FIND_MAP
c_func
(paren
id|dev_priv-&gt;mmio2
comma
id|init-&gt;mmio2
)paren
suffix:semicolon
id|DRM_FIND_MAP
c_func
(paren
id|dev_priv-&gt;mmio3
comma
id|init-&gt;mmio3
)paren
suffix:semicolon
id|dev_priv-&gt;sarea_priv
op_assign
(paren
id|drm_gamma_sarea_t
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|dev_priv-&gt;sarea-&gt;handle
op_plus
id|init-&gt;sarea_priv_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init-&gt;pcimode
)paren
(brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|GLINT_DRI_BUF_COUNT
)braket
suffix:semicolon
id|pgt
op_assign
id|buf-&gt;address
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GLINT_DRI_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
op_star
id|pgt
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|buf-&gt;address
)paren
op_or
l_int|0x07
suffix:semicolon
id|pgt
op_increment
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|GLINT_DRI_BUF_COUNT
)braket
suffix:semicolon
)brace
r_else
(brace
id|DRM_FIND_MAP
c_func
(paren
id|dev-&gt;agp_buffer_map
comma
id|init-&gt;buffers_offset
)paren
suffix:semicolon
id|DRM_IOREMAP
c_func
(paren
id|dev-&gt;agp_buffer_map
comma
id|dev
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|GLINT_DRI_BUF_COUNT
)braket
suffix:semicolon
id|pgt
op_assign
id|buf-&gt;address
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|GLINT_DRI_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|i
)braket
suffix:semicolon
op_star
id|pgt
op_assign
(paren
r_int
r_int
)paren
id|buf-&gt;address
op_plus
l_int|0x07
suffix:semicolon
id|pgt
op_increment
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|GLINT_DRI_BUF_COUNT
)braket
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|1
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GDMACONTROL
comma
l_int|0xe
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|2
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_PAGETABLEADDR
comma
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|buf-&gt;address
)paren
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_PAGETABLELENGTH
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_do_cleanup_dma
r_int
id|gamma_do_cleanup_dma
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#if __HAVE_IRQ
multiline_comment|/* Make sure interrupts are disabled here because the uninstall ioctl&n;&t; * may not have been called from userspace and after dev_private&n;&t; * is freed, it&squot;s too late.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;irq_enabled
)paren
id|DRM
c_func
(paren
id|irq_uninstall
)paren
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;dev_private
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;agp_buffer_map
op_ne
l_int|NULL
)paren
id|DRM_IOREMAPFREE
c_func
(paren
id|dev-&gt;agp_buffer_map
comma
id|dev
)paren
suffix:semicolon
id|DRM
c_func
(paren
id|free
)paren
(paren
id|dev-&gt;dev_private
comma
r_sizeof
(paren
id|drm_gamma_private_t
)paren
comma
id|DRM_MEM_DRIVER
)paren
suffix:semicolon
id|dev-&gt;dev_private
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_dma_init
r_int
id|gamma_dma_init
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_gamma_init_t
id|init
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|init
comma
(paren
id|drm_gamma_init_t
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|init
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|init.func
)paren
(brace
r_case
id|GAMMA_INIT_DMA
suffix:colon
r_return
id|gamma_do_init_dma
c_func
(paren
id|dev
comma
op_amp
id|init
)paren
suffix:semicolon
r_case
id|GAMMA_CLEANUP_DMA
suffix:colon
r_return
id|gamma_do_cleanup_dma
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|gamma_do_copy_dma
r_static
r_int
id|gamma_do_copy_dma
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_gamma_copy_t
op_star
id|copy
)paren
(brace
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
r_int
r_int
op_star
id|screenbuf
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* We&squot;ve DRM_RESTRICTED this DMA buffer */
id|screenbuf
op_assign
id|dma-&gt;buflist
(braket
id|GLINT_DRI_BUF_COUNT
op_plus
l_int|1
)braket
op_member_access_from_pointer
id|address
suffix:semicolon
macro_line|#if 0
op_star
id|buffer
op_increment
op_assign
l_int|0x180
suffix:semicolon
multiline_comment|/* Tag (FilterMode) */
op_star
id|buffer
op_increment
op_assign
l_int|0x200
suffix:semicolon
multiline_comment|/* Allow FBColor through */
op_star
id|buffer
op_increment
op_assign
l_int|0x53B
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;Pitch
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x53A
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;SrcAddress
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x539
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;WidthHeight
suffix:semicolon
multiline_comment|/* Initiates transfer */
op_star
id|buffer
op_increment
op_assign
l_int|0x53C
suffix:semicolon
multiline_comment|/* Tag - DMAOutputAddress */
op_star
id|buffer
op_increment
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|screenbuf
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x53D
suffix:semicolon
multiline_comment|/* Tag - DMAOutputCount */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;Count
suffix:semicolon
multiline_comment|/* Reads HostOutFifo BLOCKS until ..*/
multiline_comment|/* Data now sitting in dma-&gt;buflist[ GLINT_DRI_BUF_COUNT + 1 ] */
multiline_comment|/* Now put it back to the screen */
op_star
id|buffer
op_increment
op_assign
l_int|0x180
suffix:semicolon
multiline_comment|/* Tag (FilterMode) */
op_star
id|buffer
op_increment
op_assign
l_int|0x400
suffix:semicolon
multiline_comment|/* Allow Sync through */
op_star
id|buffer
op_increment
op_assign
l_int|0x538
suffix:semicolon
multiline_comment|/* Tag - DMARectangleReadTarget */
op_star
id|buffer
op_increment
op_assign
l_int|0x155
suffix:semicolon
multiline_comment|/* FBSourceData | count */
op_star
id|buffer
op_increment
op_assign
l_int|0x537
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;Pitch
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x536
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;DstAddress
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x535
suffix:semicolon
multiline_comment|/* Tag */
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;WidthHeight
suffix:semicolon
multiline_comment|/* Initiates transfer */
op_star
id|buffer
op_increment
op_assign
l_int|0x530
suffix:semicolon
multiline_comment|/* Tag - DMAAddr */
op_star
id|buffer
op_increment
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|screenbuf
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_int|0x531
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
id|copy-&gt;Count
suffix:semicolon
multiline_comment|/* initiates DMA transfer of color data */
macro_line|#endif
multiline_comment|/* need to dispatch it now */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_dma_copy
r_int
id|gamma_dma_copy
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_gamma_copy_t
id|copy
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|copy
comma
(paren
id|drm_gamma_copy_t
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|copy
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|gamma_do_copy_dma
c_func
(paren
id|dev
comma
op_amp
id|copy
)paren
suffix:semicolon
)brace
multiline_comment|/* =============================================================&n; * Per Context SAREA Support&n; */
DECL|function|gamma_getsareactx
r_int
id|gamma_getsareactx
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_ctx_priv_map_t
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
id|drm_ctx_priv_map_t
id|request
suffix:semicolon
id|drm_map_t
op_star
id|map
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|request
comma
id|argp
comma
r_sizeof
(paren
id|request
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|request.ctx_id
op_ge
id|dev-&gt;max_context
)paren
(brace
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|map
op_assign
id|dev-&gt;context_sareas
(braket
id|request.ctx_id
)braket
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
id|request.handle
op_assign
id|map-&gt;handle
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|request
comma
r_sizeof
(paren
id|request
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_setsareactx
r_int
id|gamma_setsareactx
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_ctx_priv_map_t
id|request
suffix:semicolon
id|drm_map_t
op_star
id|map
op_assign
l_int|NULL
suffix:semicolon
id|drm_map_list_t
op_star
id|r_list
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|request
comma
(paren
id|drm_ctx_priv_map_t
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|request
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
id|r_list
op_assign
l_int|NULL
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|dev-&gt;maplist-&gt;head
)paren
(brace
id|r_list
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|drm_map_list_t
comma
id|head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r_list-&gt;map
op_logical_and
id|r_list-&gt;map-&gt;handle
op_eq
id|request.handle
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
(paren
id|dev-&gt;maplist-&gt;head
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|map
op_assign
id|r_list-&gt;map
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|map
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|request.ctx_id
op_ge
id|dev-&gt;max_context
)paren
(brace
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev-&gt;context_sareas
(braket
id|request.ctx_id
)braket
op_assign
id|map
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dev-&gt;struct_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|driver_irq_preinstall
r_void
id|DRM
c_func
(paren
id|driver_irq_preinstall
)paren
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|2
)paren
(brace
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GCOMMANDMODE
comma
l_int|0x00000004
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GDMACONTROL
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
DECL|function|driver_irq_postinstall
r_void
id|DRM
c_func
(paren
id|driver_irq_postinstall
)paren
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|3
)paren
(brace
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GINTENABLE
comma
l_int|0x00002001
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_COMMANDINTENABLE
comma
l_int|0x00000008
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GDELAYTIMER
comma
l_int|0x00039090
)paren
suffix:semicolon
)brace
DECL|function|driver_irq_uninstall
r_void
id|DRM
c_func
(paren
id|driver_irq_uninstall
)paren
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|GAMMA_READ
c_func
(paren
id|GAMMA_INFIFOSPACE
)paren
OL
l_int|3
)paren
(brace
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GDELAYTIMER
comma
l_int|0x00000000
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_COMMANDINTENABLE
comma
l_int|0x00000000
)paren
suffix:semicolon
id|GAMMA_WRITE
c_func
(paren
id|GAMMA_GINTENABLE
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
r_extern
id|drm_ioctl_desc_t
id|DRM
c_func
(paren
id|ioctls
)paren
(braket
)braket
suffix:semicolon
DECL|function|gamma_driver_preinit
r_static
r_int
id|gamma_driver_preinit
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
multiline_comment|/* reset the finish ioctl */
id|DRM
c_func
(paren
id|ioctls
)paren
(braket
id|DRM_IOCTL_NR
c_func
(paren
id|DRM_IOCTL_FINISH
)paren
)braket
dot
id|func
op_assign
id|DRM
c_func
(paren
id|finish
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_driver_pretakedown
r_static
r_void
id|gamma_driver_pretakedown
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|gamma_do_cleanup_dma
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|gamma_driver_dma_ready
r_static
r_void
id|gamma_driver_dma_ready
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|gamma_dma_ready
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|gamma_driver_dma_quiescent
r_static
r_int
id|gamma_driver_dma_quiescent
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_gamma_private_t
op_star
id|dev_priv
op_assign
(paren
id|drm_gamma_private_t
op_star
)paren
id|dev-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;num_rast
op_eq
l_int|2
)paren
id|gamma_dma_quiescent_dual
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
id|gamma_dma_quiescent_single
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gamma_driver_register_fns
r_void
id|gamma_driver_register_fns
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|DRM
c_func
(paren
id|fops
)paren
dot
id|read
op_assign
id|gamma_fops_read
suffix:semicolon
id|DRM
c_func
(paren
id|fops
)paren
dot
id|poll
op_assign
id|gamma_fops_poll
suffix:semicolon
id|dev-&gt;fn_tbl.preinit
op_assign
id|gamma_driver_preinit
suffix:semicolon
id|dev-&gt;fn_tbl.pretakedown
op_assign
id|gamma_driver_pretakedown
suffix:semicolon
id|dev-&gt;fn_tbl.dma_ready
op_assign
id|gamma_driver_dma_ready
suffix:semicolon
id|dev-&gt;fn_tbl.dma_quiescent
op_assign
id|gamma_driver_dma_quiescent
suffix:semicolon
id|dev-&gt;fn_tbl.dma_flush_block_and_flush
op_assign
id|gamma_flush_block_and_flush
suffix:semicolon
id|dev-&gt;fn_tbl.dma_flush_unblock
op_assign
id|gamma_flush_unblock
suffix:semicolon
)brace
eof
