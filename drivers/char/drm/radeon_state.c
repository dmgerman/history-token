multiline_comment|/* radeon_state.c -- State support for Radeon -*- linux-c -*-&n; *&n; * Copyright 2000 VA Linux Systems, Inc., Fremont, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors:&n; *    Kevin E. Martin &lt;martin@valinux.com&gt;&n; *    Gareth Hughes &lt;gareth@valinux.com&gt;&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;radeon_drv.h&quot;
macro_line|#include &quot;drm.h&quot;
macro_line|#include &lt;linux/delay.h&gt;
multiline_comment|/* ================================================================&n; * CP hardware state programming functions&n; */
DECL|function|radeon_emit_clip_rect
r_static
r_inline
r_void
id|radeon_emit_clip_rect
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_clip_rect_t
op_star
id|box
)paren
(brace
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   box:  x1=%d y1=%d  x2=%d y2=%d&bslash;n&quot;
comma
id|box-&gt;x1
comma
id|box-&gt;y1
comma
id|box-&gt;x2
comma
id|box-&gt;y2
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_TOP_LEFT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_WIDTH_HEIGHT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
(paren
id|box-&gt;y2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|box-&gt;x2
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_context
r_static
r_inline
r_void
id|radeon_emit_context
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|14
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_MISC
comma
l_int|6
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_misc
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_fog_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_solid_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_blendcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthpitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_coloroffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_COLORPITCH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_colorpitch
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_vertfmt
r_static
r_inline
r_void
id|radeon_emit_vertfmt
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_COORD_FMT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_coord_fmt
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_line
r_static
r_inline
r_void
id|radeon_emit_line
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_LINE_PATTERN
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_pattern
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_state
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_LINE_WIDTH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_line_width
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_bumpmap
r_static
r_inline
r_void
id|radeon_emit_bumpmap
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_LUM_MATRIX
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_lum_matrix
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_ROT_MATRIX_0
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_1
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_masks
r_static
r_inline
r_void
id|radeon_emit_masks
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_stencilrefmask
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_ropcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_planemask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_viewport
r_static
r_inline
r_void
id|radeon_emit_viewport
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_VPORT_XSCALE
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zoffset
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_setup
r_static
r_inline
r_void
id|radeon_emit_setup
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL_STATUS
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl_status
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_tcl
r_static
r_inline
r_void
id|radeon_emit_tcl
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
macro_line|#ifdef TCL_ENABLE
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|29
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_MATERIAL_EMMISSIVE_RED
comma
l_int|27
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_emmissive.red
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_emmissive.green
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_emmissive.blue
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_emmissive.alpha
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_ambient.red
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_ambient.green
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_ambient.blue
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_ambient.alpha
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_diffuse.red
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_diffuse.green
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_diffuse.blue
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_diffuse.alpha
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_specular.red
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_specular.green
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_specular.blue
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_material_specular.alpha
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_shininess
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_output_vtx_fmt
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_output_vtx_sel
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_matrix_select_0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_matrix_select_1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_ucp_vert_blend_ctl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_texture_proc_ctl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_light_model_ctl
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_tcl_per_light_ctl
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
id|DRM_ERROR
c_func
(paren
l_string|&quot;TCL not enabled!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|radeon_emit_misc
r_static
r_inline
r_void
id|radeon_emit_misc
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_context_regs_t
op_star
id|ctx
op_assign
op_amp
id|sarea_priv-&gt;context_state
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_MISC
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_misc
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_tex0
r_static
r_inline
r_void
id|radeon_emit_tex0
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|0
)braket
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s: offset=0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tex-&gt;pp_txoffset
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_0
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_0
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_tex1
r_static
r_inline
r_void
id|radeon_emit_tex1
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|1
)braket
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s: offset=0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tex-&gt;pp_txoffset
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_1
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_1
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_tex2
r_static
r_inline
r_void
id|radeon_emit_tex2
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_texture_regs_t
op_star
id|tex
op_assign
op_amp
id|sarea_priv-&gt;tex_state
(braket
l_int|2
)braket
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;    %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_2
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_2
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex-&gt;pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_emit_state
r_static
r_inline
r_void
id|radeon_emit_state
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
r_int
id|dirty
op_assign
id|sarea_priv-&gt;dirty
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: dirty=0x%08x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dirty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_CONTEXT
)paren
(brace
id|radeon_emit_context
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_CONTEXT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VERTFMT
)paren
(brace
id|radeon_emit_vertfmt
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_VERTFMT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_LINE
)paren
(brace
id|radeon_emit_line
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_LINE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_BUMPMAP
)paren
(brace
id|radeon_emit_bumpmap
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_BUMPMAP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MASKS
)paren
(brace
id|radeon_emit_masks
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_MASKS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VIEWPORT
)paren
(brace
id|radeon_emit_viewport
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_VIEWPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_SETUP
)paren
(brace
id|radeon_emit_setup
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_SETUP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TCL
)paren
(brace
macro_line|#ifdef TCL_ENABLE
id|radeon_emit_tcl
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_TCL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MISC
)paren
(brace
id|radeon_emit_misc
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_MISC
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX0
)paren
(brace
id|radeon_emit_tex0
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_TEX0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX1
)paren
(brace
id|radeon_emit_tex1
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_TEX1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX2
)paren
(brace
macro_line|#if 0
id|radeon_emit_tex2
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_TEX2
suffix:semicolon
)brace
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
(paren
id|RADEON_UPLOAD_TEX0IMAGES
op_or
id|RADEON_UPLOAD_TEX1IMAGES
op_or
id|RADEON_UPLOAD_TEX2IMAGES
op_or
id|RADEON_REQUIRE_QUIESCENCE
)paren
suffix:semicolon
)brace
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* ================================================================&n; * Performance monitoring functions&n; */
DECL|function|radeon_clear_box
r_static
r_void
id|radeon_clear_box
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|w
comma
r_int
id|h
comma
r_int
id|r
comma
r_int
id|g
comma
r_int
id|b
)paren
(brace
id|u32
id|pitch
comma
id|offset
suffix:semicolon
id|u32
id|color
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
r_switch
c_cond
(paren
id|dev_priv-&gt;color_fmt
)paren
(brace
r_case
id|RADEON_COLOR_FORMAT_RGB565
suffix:colon
id|color
op_assign
(paren
(paren
(paren
id|r
op_amp
l_int|0xf8
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|g
op_amp
l_int|0xfc
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|b
op_amp
l_int|0xf8
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:colon
r_default
suffix:colon
id|color
op_assign
(paren
(paren
(paren
l_int|0xff
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|r
op_lshift
l_int|16
)paren
op_or
(paren
id|g
op_lshift
l_int|8
)paren
op_or
id|b
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|offset
op_assign
id|dev_priv-&gt;back_offset
suffix:semicolon
id|pitch
op_assign
id|dev_priv-&gt;back_pitch
op_rshift
l_int|3
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|pitch
op_lshift
l_int|22
)paren
op_or
(paren
id|offset
op_rshift
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_performance_boxes
r_static
r_void
id|radeon_cp_performance_boxes
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|dev_priv-&gt;idle_count
)paren
op_eq
l_int|0
)paren
(brace
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|64
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|0
comma
l_int|255
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;idle_count
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* ================================================================&n; * CP command dispatch functions&n; */
DECL|function|radeon_print_dirty
r_static
r_void
id|radeon_print_dirty
c_func
(paren
r_const
r_char
op_star
id|msg
comma
r_int
r_int
id|flags
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: (0x%x) %s%s%s%s%s%s%s%s%s%s%s%s%s%s&bslash;n&quot;
comma
id|msg
comma
id|flags
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_CONTEXT
)paren
ques
c_cond
l_string|&quot;context, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_VERTFMT
)paren
ques
c_cond
l_string|&quot;vertfmt, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_LINE
)paren
ques
c_cond
l_string|&quot;line, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_BUMPMAP
)paren
ques
c_cond
l_string|&quot;bumpmap, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_MASKS
)paren
ques
c_cond
l_string|&quot;masks, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_VIEWPORT
)paren
ques
c_cond
l_string|&quot;viewport, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_SETUP
)paren
ques
c_cond
l_string|&quot;setup, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_TCL
)paren
ques
c_cond
l_string|&quot;tcl, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_MISC
)paren
ques
c_cond
l_string|&quot;misc, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_TEX0
)paren
ques
c_cond
l_string|&quot;tex0, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_TEX1
)paren
ques
c_cond
l_string|&quot;tex1, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_TEX2
)paren
ques
c_cond
l_string|&quot;tex2, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_UPLOAD_CLIPRECTS
)paren
ques
c_cond
l_string|&quot;cliprects, &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|flags
op_amp
id|RADEON_REQUIRE_QUIESCENCE
)paren
ques
c_cond
l_string|&quot;quiescence, &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_clear
r_static
r_void
id|radeon_cp_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_clear_t
op_star
id|clear
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|clear-&gt;flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;page_flipping
op_logical_and
id|dev_priv-&gt;current_page
op_eq
l_int|1
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|flags
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_FRONT
)paren
id|flags
op_or_assign
id|RADEON_BACK
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_BACK
)paren
id|flags
op_or_assign
id|RADEON_FRONT
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch clear %d,%d-%d,%d flags 0x%x&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Ensure the 3D stream is idle before doing a&n;&t;&t;&t; * 2D fill to clear the front or back buffer.&n;&t;&t;&t; */
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_DP_WRITE_MASK
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|sarea_priv-&gt;context_state.rb3d_planemask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
(paren
id|RADEON_UPLOAD_CONTEXT
op_or
id|RADEON_UPLOAD_MASKS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_FRONT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_BACK
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_DEPTH
)paren
(brace
id|drm_radeon_depth_clear_t
op_star
id|depth_clear
op_assign
op_amp
id|dev_priv-&gt;depth_clear
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: Render a rectangle to clear the depth&n;&t;&t;&t; * buffer.  So much for those &quot;fast Z clears&quot;...&n;&t;&t;&t; */
id|BEGIN_RING
c_func
(paren
l_int|23
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_clear-&gt;rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_ZSTENCILCNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_clear-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_PLANEMASK
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_clear-&gt;se_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_DRAW_IMMD
comma
l_int|10
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_VTX_Z_PRESENT
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|RADEON_PRIM_TYPE_RECT_LIST
op_or
id|RADEON_PRIM_WALK_RING
op_or
id|RADEON_MAOS_ENABLE
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
l_int|3
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_Y1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_X2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;rect.ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
(paren
id|RADEON_UPLOAD_CONTEXT
op_or
id|RADEON_UPLOAD_SETUP
op_or
id|RADEON_UPLOAD_MASKS
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Increment the clear counter.  The client-side 3D driver must&n;&t; * wait on this value before performing the clear ioctl.  We&n;&t; * need this because the card&squot;s so damned fast...&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_clear
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_CLEAR_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_clear
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_swap
r_static
r_void
id|radeon_cp_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Wait for the 3D stream to idle before dispatching the bitblt.&n;&t; * This will prevent data corruption between the two streams.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch swap %d,%d-%d,%d&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_BITBLT_MULTI
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_SRC_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_MEMORY
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_flip
r_static
r_void
id|radeon_cp_dispatch_flip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: page=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev_priv-&gt;current_page
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_PAGE_FLIPPED
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CRTC_OFFSET
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;current_page
op_eq
l_int|0
)paren
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_offset
)paren
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_offset
)paren
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|0
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_vertex
r_static
r_void
id|radeon_cp_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|format
op_assign
id|sarea_priv-&gt;vc_format
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;agp_buffers_offset
op_plus
id|buf-&gt;offset
suffix:semicolon
r_int
id|size
op_assign
id|buf-&gt;used
suffix:semicolon
r_int
id|prim
op_assign
id|buf_priv-&gt;prim
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: nbox=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
id|radeon_print_dirty
c_func
(paren
l_string|&quot;dispatch_vertex&quot;
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;used
)paren
(brace
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
r_do
(brace
multiline_comment|/* Emit the next set of up to three cliprects */
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Emit the vertex buffer rendering commands */
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
l_int|3
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|size
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|format
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|prim
op_or
id|RADEON_PRIM_WALK_LIST
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|size
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
id|buf_priv-&gt;age
op_assign
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
suffix:semicolon
multiline_comment|/* Emit the vertex buffer age */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_DISPATCH_AGE
c_func
(paren
id|buf_priv-&gt;age
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: Check dispatched field */
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
)brace
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
op_increment
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_CLIPRECTS
suffix:semicolon
id|sarea_priv-&gt;nbox
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_indirect
r_static
r_void
id|radeon_cp_dispatch_indirect
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: buf=%d s=0x%x e=0x%x&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|start
comma
id|end
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
r_int
id|offset
op_assign
(paren
id|dev_priv-&gt;agp_buffers_offset
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
r_int
id|dwords
op_assign
(paren
id|end
op_minus
id|start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* Indirect buffer data must be an even number of&n;&t;&t; * dwords, so if we&squot;ve been given an odd number we must&n;&t;&t; * pad the data with a Type-2 CP packet.&n;&t;&t; */
r_if
c_cond
(paren
id|dwords
op_amp
l_int|1
)paren
(brace
id|u32
op_star
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
id|data
(braket
id|dwords
op_increment
)braket
op_assign
id|RADEON_CP_PACKET2
suffix:semicolon
)brace
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Fire off the indirect buffer */
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CP_IB_BASE
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dwords
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
id|buf_priv-&gt;age
op_assign
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
suffix:semicolon
multiline_comment|/* Emit the indirect buffer age */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_DISPATCH_AGE
c_func
(paren
id|buf_priv-&gt;age
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: Check dispatched field */
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
)brace
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
op_increment
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_indices
r_static
r_void
id|radeon_cp_dispatch_indices
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
id|start
comma
r_int
id|end
comma
r_int
id|count
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|format
op_assign
id|sarea_priv-&gt;vc_format
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;agp_buffers_offset
suffix:semicolon
r_int
id|prim
op_assign
id|buf_priv-&gt;prim
suffix:semicolon
id|u32
op_star
id|data
suffix:semicolon
r_int
id|dwords
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indices: s=%d e=%d c=%d&bslash;n&quot;
comma
id|start
comma
id|end
comma
id|count
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
id|radeon_print_dirty
c_func
(paren
l_string|&quot;dispatch_indices&quot;
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
id|buf_priv-&gt;dispatched
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
id|dwords
op_assign
(paren
id|end
op_minus
id|start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
id|dwords
op_minus
l_int|2
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|offset
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|RADEON_MAX_VB_VERTS
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|format
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
(paren
id|prim
op_or
id|RADEON_PRIM_WALK_IND
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|count
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_amp
l_int|0x1
)paren
(brace
id|data
(braket
id|dwords
op_minus
l_int|1
)braket
op_and_assign
l_int|0x0000ffff
suffix:semicolon
)brace
r_do
(brace
multiline_comment|/* Emit the next set of up to three cliprects */
r_if
c_cond
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
(brace
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
id|start
comma
id|end
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf_priv-&gt;discard
)paren
(brace
id|buf_priv-&gt;age
op_assign
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
suffix:semicolon
multiline_comment|/* Emit the vertex buffer age */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_DISPATCH_AGE
c_func
(paren
id|buf_priv-&gt;age
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME: Check dispatched field */
id|buf_priv-&gt;dispatched
op_assign
l_int|0
suffix:semicolon
)brace
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
op_increment
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
id|RADEON_UPLOAD_CLIPRECTS
suffix:semicolon
id|sarea_priv-&gt;nbox
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_blit
r_static
r_int
id|radeon_cp_dispatch_blit
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_blit_t
op_star
id|blit
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|u32
id|format
suffix:semicolon
id|u32
op_star
id|data
suffix:semicolon
r_int
id|dword_shift
comma
id|dwords
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;blit: ofs=0x%x p=%d f=%d x=%hd y=%hd w=%hd h=%hd&bslash;n&quot;
comma
id|blit-&gt;offset
op_rshift
l_int|10
comma
id|blit-&gt;pitch
comma
id|blit-&gt;format
comma
id|blit-&gt;x
comma
id|blit-&gt;y
comma
id|blit-&gt;width
comma
id|blit-&gt;height
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* The compiler won&squot;t optimize away a division by a variable,&n;&t; * even if the only legal values are powers of two.  Thus, we&squot;ll&n;&t; * use a shift instead.&n;&t; */
r_switch
c_cond
(paren
id|blit-&gt;format
)paren
(brace
r_case
id|RADEON_TXF_32BPP_ARGB8888
suffix:colon
r_case
id|RADEON_TXF_32BPP_RGBA8888
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:semicolon
id|dword_shift
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXF_16BPP_AI88
suffix:colon
r_case
id|RADEON_TXF_16BPP_ARGB1555
suffix:colon
r_case
id|RADEON_TXF_16BPP_RGB565
suffix:colon
r_case
id|RADEON_TXF_16BPP_ARGB4444
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_RGB565
suffix:semicolon
id|dword_shift
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXF_8BPP_I
suffix:colon
r_case
id|RADEON_TXF_8BPP_RGB332
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_CI8
suffix:semicolon
id|dword_shift
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;invalid blit format %d&bslash;n&quot;
comma
id|blit-&gt;format
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Flush the pixel cache.  This ensures no pixel data gets mixed&n;&t; * up with the texture data from the host data blit, otherwise&n;&t; * part of the texture image may be corrupted.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Dispatch the indirect buffer.&n;&t; */
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|blit-&gt;idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|blit-&gt;idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf_priv-&gt;discard
op_assign
l_int|1
suffix:semicolon
id|dwords
op_assign
(paren
id|blit-&gt;width
op_star
id|blit-&gt;height
)paren
op_rshift
id|dword_shift
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dwords
)paren
id|dwords
op_assign
l_int|1
suffix:semicolon
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|buf-&gt;offset
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_HOSTDATA_BLT
comma
id|dwords
op_plus
l_int|6
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|format
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_HOST_DATA
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
(paren
id|blit-&gt;pitch
op_lshift
l_int|22
)paren
op_or
(paren
id|blit-&gt;offset
op_rshift
l_int|10
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|data
(braket
l_int|5
)braket
op_assign
(paren
id|blit-&gt;y
op_lshift
l_int|16
)paren
op_or
id|blit-&gt;x
suffix:semicolon
id|data
(braket
l_int|6
)braket
op_assign
(paren
id|blit-&gt;height
op_lshift
l_int|16
)paren
op_or
id|blit-&gt;width
suffix:semicolon
id|data
(braket
l_int|7
)braket
op_assign
id|dwords
suffix:semicolon
id|buf-&gt;used
op_assign
(paren
id|dwords
op_plus
l_int|8
)paren
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
l_int|0
comma
id|buf-&gt;used
)paren
suffix:semicolon
multiline_comment|/* Flush the pixel cache after the blit completes.  This ensures&n;&t; * the texture data is written out to memory before rendering&n;&t; * continues.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_stipple
r_static
r_void
id|radeon_cp_dispatch_stipple
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|u32
op_star
id|stipple
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|radeon_update_ring_snapshot
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|35
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_STIPPLE_ADDR
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_RE_STIPPLE_DATA
comma
l_int|31
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OUT_RING
c_func
(paren
id|stipple
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; * IOCTL functions&n; */
DECL|function|radeon_cp_clear
r_int
id|radeon_cp_clear
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_clear_t
id|clear
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clear
comma
(paren
id|drm_radeon_clear_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clear
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
id|radeon_cp_dispatch_clear
c_func
(paren
id|dev
comma
op_amp
id|clear
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_swap
r_int
id|radeon_cp_swap
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv-&gt;page_flipping
)paren
(brace
id|radeon_cp_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;dirty
op_or_assign
(paren
id|RADEON_UPLOAD_CONTEXT
op_or
id|RADEON_UPLOAD_MASKS
)paren
suffix:semicolon
)brace
r_else
(brace
id|radeon_cp_dispatch_flip
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_vertex
r_int
id|radeon_cp_vertex
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_radeon_vertex_t
id|vertex
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
op_logical_or
id|dev_priv-&gt;is_pci
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with a PCI card&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_radeon_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: pid=%d index=%d count=%d discard=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|current-&gt;pid
comma
id|vertex.idx
comma
id|vertex.count
comma
id|vertex.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
OL
l_int|0
op_logical_or
id|vertex.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|vertex.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|vertex.prim
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|VB_AGE_CHECK_WITH_RET
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|vertex.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf-&gt;used
op_assign
id|vertex.count
suffix:semicolon
id|buf_priv-&gt;prim
op_assign
id|vertex.prim
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|vertex.discard
suffix:semicolon
id|radeon_cp_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indices
r_int
id|radeon_cp_indices
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_radeon_indices_t
id|elts
suffix:semicolon
r_int
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
op_logical_or
id|dev_priv-&gt;is_pci
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with a PCI card&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|elts
comma
(paren
id|drm_radeon_indices_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|elts
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: pid=%d index=%d start=%d end=%d discard=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|current-&gt;pid
comma
id|elts.idx
comma
id|elts.start
comma
id|elts.end
comma
id|elts.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elts.idx
OL
l_int|0
op_logical_or
id|elts.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|elts.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|elts.prim
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|VB_AGE_CHECK_WITH_RET
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|elts.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|elts.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|count
op_assign
(paren
id|elts.end
op_minus
id|elts.start
)paren
op_div
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
id|elts.start
op_sub_assign
id|RADEON_INDEX_PRIM_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|elts.start
op_amp
l_int|0x7
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;misaligned buffer 0x%x&bslash;n&quot;
comma
id|elts.start
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;no header 0x%x - 0x%x&bslash;n&quot;
comma
id|elts.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf-&gt;used
op_assign
id|elts.end
suffix:semicolon
id|buf_priv-&gt;prim
op_assign
id|elts.prim
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|elts.discard
suffix:semicolon
id|radeon_cp_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
id|elts.start
comma
id|elts.end
comma
id|count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_blit
r_int
id|radeon_cp_blit
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_radeon_blit_t
id|blit
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|blit
comma
(paren
id|drm_radeon_blit_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|blit
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: pid=%d index=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|current-&gt;pid
comma
id|blit.idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blit.idx
template_param
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending %d buffers (of %d max)&bslash;n&quot;
comma
id|blit.idx
comma
id|dma-&gt;buf_count
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|VB_AGE_CHECK_WITH_RET
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_return
id|radeon_cp_dispatch_blit
c_func
(paren
id|dev
comma
op_amp
id|blit
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_stipple
r_int
id|radeon_cp_stipple
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_stipple_t
id|stipple
suffix:semicolon
id|u32
id|mask
(braket
l_int|32
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|stipple
comma
(paren
id|drm_radeon_stipple_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|stipple
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mask
comma
id|stipple.mask
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|radeon_cp_dispatch_stipple
c_func
(paren
id|dev
comma
id|mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indirect
r_int
id|radeon_cp_indirect
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
suffix:semicolon
id|drm_radeon_indirect_t
id|indirect
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_DRM_LOCK_IS_HELD
c_func
(paren
id|dev-&gt;lock.hw_lock-&gt;lock
)paren
op_logical_or
id|dev-&gt;lock.pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called without lock held&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
op_logical_or
id|dev_priv-&gt;is_pci
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with a PCI card&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|indirect
comma
(paren
id|drm_radeon_indirect_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|indirect
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: idx=%d s=%d e=%d d=%d&bslash;n&quot;
comma
id|indirect.idx
comma
id|indirect.start
comma
id|indirect.end
comma
id|indirect.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indirect.idx
OL
l_int|0
op_logical_or
id|indirect.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|indirect.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|indirect.idx
)braket
suffix:semicolon
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|indirect.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|indirect.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;reusing indirect: start=0x%x actual=0x%x&bslash;n&quot;
comma
id|indirect.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|VB_AGE_CHECK_WITH_RET
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf-&gt;used
op_assign
id|indirect.end
suffix:semicolon
id|buf_priv-&gt;discard
op_assign
id|indirect.discard
suffix:semicolon
multiline_comment|/* Wait for the 3D stream to idle before the indirect buffer&n;&t; * containing 2D acceleration commands is processed.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Dispatch the indirect buffer full of commands from the&n;&t; * X server.  This is insecure and is thus only available to&n;&t; * privileged clients.&n;&t; */
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
id|indirect.start
comma
id|indirect.end
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
