multiline_comment|/* radeon_state.c -- State support for Radeon -*- linux-c -*-&n; *&n; * Copyright 2000 VA Linux Systems, Inc., Fremont, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors:&n; *    Gareth Hughes &lt;gareth@valinux.com&gt;&n; *    Kevin E. Martin &lt;martin@valinux.com&gt;&n; */
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;drm.h&quot;
macro_line|#include &quot;drm_sarea.h&quot;
macro_line|#include &quot;radeon_drm.h&quot;
macro_line|#include &quot;radeon_drv.h&quot;
multiline_comment|/* ================================================================&n; * Helper functions for client state checking and fixup&n; */
DECL|function|radeon_check_and_fixup_offset
r_static
id|__inline__
r_int
id|radeon_check_and_fixup_offset
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|u32
op_star
id|offset
)paren
(brace
id|u32
id|off
op_assign
op_star
id|offset
suffix:semicolon
r_struct
id|drm_radeon_driver_file_fields
op_star
id|radeon_priv
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ge
id|dev_priv-&gt;fb_location
op_logical_and
id|off
OL
(paren
id|dev_priv-&gt;gart_vm_start
op_plus
id|dev_priv-&gt;gart_size
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|radeon_priv
op_assign
id|filp_priv-&gt;driver_priv
suffix:semicolon
id|off
op_add_assign
id|radeon_priv-&gt;radeon_fb_delta
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;offset fixed up to 0x%x&bslash;n&quot;
comma
id|off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|off
OL
id|dev_priv-&gt;fb_location
op_logical_or
id|off
op_ge
(paren
id|dev_priv-&gt;gart_vm_start
op_plus
id|dev_priv-&gt;gart_size
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
op_star
id|offset
op_assign
id|off
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_check_and_fixup_offset_user
r_static
id|__inline__
r_int
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|u32
id|__user
op_star
id|offset
)paren
(brace
id|u32
id|off
suffix:semicolon
id|DRM_GET_USER_UNCHECKED
c_func
(paren
id|off
comma
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|off
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
id|DRM_PUT_USER_UNCHECKED
c_func
(paren
id|offset
comma
id|off
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_check_and_fixup_packets
r_static
id|__inline__
r_int
id|radeon_check_and_fixup_packets
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
r_int
id|id
comma
id|u32
id|__user
op_star
id|data
)paren
(brace
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|RADEON_EMIT_PP_MISC
suffix:colon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|data
(braket
(paren
id|RADEON_RB3D_DEPTHOFFSET
op_minus
id|RADEON_PP_MISC
)paren
op_div
l_int|4
)braket
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid depth buffer offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_EMIT_PP_CNTL
suffix:colon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|data
(braket
(paren
id|RADEON_RB3D_COLOROFFSET
op_minus
id|RADEON_PP_CNTL
)paren
op_div
l_int|4
)braket
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid colour buffer offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|R200_EMIT_PP_TXOFFSET_0
suffix:colon
r_case
id|R200_EMIT_PP_TXOFFSET_1
suffix:colon
r_case
id|R200_EMIT_PP_TXOFFSET_2
suffix:colon
r_case
id|R200_EMIT_PP_TXOFFSET_3
suffix:colon
r_case
id|R200_EMIT_PP_TXOFFSET_4
suffix:colon
r_case
id|R200_EMIT_PP_TXOFFSET_5
suffix:colon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|data
(braket
l_int|0
)braket
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid R200 texture offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_EMIT_PP_TXFILTER_0
suffix:colon
r_case
id|RADEON_EMIT_PP_TXFILTER_1
suffix:colon
r_case
id|RADEON_EMIT_PP_TXFILTER_2
suffix:colon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|data
(braket
(paren
id|RADEON_PP_TXOFFSET_0
op_minus
id|RADEON_PP_TXFILTER_0
)paren
op_div
l_int|4
)braket
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid R100 texture offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_0
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_1
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_2
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_3
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_4
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_OFFSETS_5
suffix:colon
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset_user
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|data
(braket
id|i
)braket
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid R200 cubic texture offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_case
id|RADEON_EMIT_RB3D_COLORPITCH
suffix:colon
r_case
id|RADEON_EMIT_RE_LINE_PATTERN
suffix:colon
r_case
id|RADEON_EMIT_SE_LINE_WIDTH
suffix:colon
r_case
id|RADEON_EMIT_PP_LUM_MATRIX
suffix:colon
r_case
id|RADEON_EMIT_PP_ROT_MATRIX_0
suffix:colon
r_case
id|RADEON_EMIT_RB3D_STENCILREFMASK
suffix:colon
r_case
id|RADEON_EMIT_SE_VPORT_XSCALE
suffix:colon
r_case
id|RADEON_EMIT_SE_CNTL
suffix:colon
r_case
id|RADEON_EMIT_SE_CNTL_STATUS
suffix:colon
r_case
id|RADEON_EMIT_RE_MISC
suffix:colon
r_case
id|RADEON_EMIT_PP_BORDER_COLOR_0
suffix:colon
r_case
id|RADEON_EMIT_PP_BORDER_COLOR_1
suffix:colon
r_case
id|RADEON_EMIT_PP_BORDER_COLOR_2
suffix:colon
r_case
id|RADEON_EMIT_SE_ZBIAS_FACTOR
suffix:colon
r_case
id|RADEON_EMIT_SE_TCL_OUTPUT_VTX_FMT
suffix:colon
r_case
id|RADEON_EMIT_SE_TCL_MATERIAL_EMMISSIVE_RED
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_0
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_1
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_2
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_3
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_4
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_5
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_6
suffix:colon
r_case
id|R200_EMIT_PP_TXCBLEND_7
suffix:colon
r_case
id|R200_EMIT_TCL_LIGHT_MODEL_CTL_0
suffix:colon
r_case
id|R200_EMIT_TFACTOR_0
suffix:colon
r_case
id|R200_EMIT_VTX_FMT_0
suffix:colon
r_case
id|R200_EMIT_VAP_CTL
suffix:colon
r_case
id|R200_EMIT_MATRIX_SELECT_0
suffix:colon
r_case
id|R200_EMIT_TEX_PROC_CTL_2
suffix:colon
r_case
id|R200_EMIT_TCL_UCP_VERT_BLEND_CTL
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_0
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_1
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_2
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_3
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_4
suffix:colon
r_case
id|R200_EMIT_PP_TXFILTER_5
suffix:colon
r_case
id|R200_EMIT_VTE_CNTL
suffix:colon
r_case
id|R200_EMIT_OUTPUT_VTX_COMP_SEL
suffix:colon
r_case
id|R200_EMIT_PP_TAM_DEBUG3
suffix:colon
r_case
id|R200_EMIT_PP_CNTL_X
suffix:colon
r_case
id|R200_EMIT_RB3D_DEPTHXY_OFFSET
suffix:colon
r_case
id|R200_EMIT_RE_AUX_SCISSOR_CNTL
suffix:colon
r_case
id|R200_EMIT_RE_SCISSOR_TL_0
suffix:colon
r_case
id|R200_EMIT_RE_SCISSOR_TL_1
suffix:colon
r_case
id|R200_EMIT_RE_SCISSOR_TL_2
suffix:colon
r_case
id|R200_EMIT_SE_VAP_CNTL_STATUS
suffix:colon
r_case
id|R200_EMIT_SE_VTX_STATE_CNTL
suffix:colon
r_case
id|R200_EMIT_RE_POINTSIZE
suffix:colon
r_case
id|R200_EMIT_TCL_INPUT_VTX_VECTOR_ADDR_0
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_0
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_1
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_2
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_3
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_4
suffix:colon
r_case
id|R200_EMIT_PP_CUBIC_FACES_5
suffix:colon
r_case
id|RADEON_EMIT_PP_TEX_SIZE_0
suffix:colon
r_case
id|RADEON_EMIT_PP_TEX_SIZE_1
suffix:colon
r_case
id|RADEON_EMIT_PP_TEX_SIZE_2
suffix:colon
r_case
id|R200_EMIT_RB3D_BLENDCOLOR
suffix:colon
multiline_comment|/* These packets don&squot;t contain memory offsets */
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;Unknown state packet ID %d&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_check_and_fixup_packet3
r_static
id|__inline__
r_int
id|radeon_check_and_fixup_packet3
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
comma
r_int
r_int
op_star
id|cmdsz
)paren
(brace
id|u32
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|u32
id|__user
op_star
id|cmd
op_assign
(paren
id|u32
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER_UNCHECKED
c_func
(paren
id|tmp
comma
id|cmd
comma
r_sizeof
(paren
id|tmp
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Failed to copy data from user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
op_star
id|cmdsz
op_assign
l_int|2
op_plus
(paren
(paren
id|tmp
(braket
l_int|0
)braket
op_amp
id|RADEON_CP_PACKET_COUNT_MASK
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
(braket
l_int|0
)braket
op_amp
l_int|0xc0000000
)paren
op_ne
id|RADEON_CP_PACKET3
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Not a type 3 packet&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|4
op_star
op_star
id|cmdsz
OG
id|cmdbuf-&gt;bufsz
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Packet size larger than size of data provided&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/* Check client state and fix it up if necessary */
r_if
c_cond
(paren
id|tmp
(braket
l_int|0
)braket
op_amp
l_int|0x8000
)paren
(brace
multiline_comment|/* MSB of opcode: next DWORD GUI_CNTL */
id|u32
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|tmp
(braket
l_int|1
)braket
op_amp
(paren
id|RADEON_GMC_SRC_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
)paren
)paren
(brace
id|offset
op_assign
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|offset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid first packet offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|tmp
(braket
l_int|2
)braket
op_assign
(paren
id|tmp
(braket
l_int|2
)braket
op_amp
l_int|0xffc00000
)paren
op_or
id|offset
op_rshift
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
(braket
l_int|1
)braket
op_amp
id|RADEON_GMC_SRC_PITCH_OFFSET_CNTL
)paren
op_logical_and
(paren
id|tmp
(braket
l_int|1
)braket
op_amp
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
)paren
)paren
(brace
id|offset
op_assign
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|offset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid second packet offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|tmp
(braket
l_int|3
)braket
op_assign
(paren
id|tmp
(braket
l_int|3
)braket
op_amp
l_int|0xffc00000
)paren
op_or
id|offset
op_rshift
l_int|10
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DRM_COPY_TO_USER_UNCHECKED
c_func
(paren
id|cmd
comma
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Failed to copy data to user space&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; * CP hardware state programming functions&n; */
DECL|function|radeon_emit_clip_rect
r_static
id|__inline__
r_void
id|radeon_emit_clip_rect
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_clip_rect_t
op_star
id|box
)paren
(brace
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   box:  x1=%d y1=%d  x2=%d y2=%d&bslash;n&quot;
comma
id|box-&gt;x1
comma
id|box-&gt;y1
comma
id|box-&gt;x2
comma
id|box-&gt;y2
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_TOP_LEFT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_WIDTH_HEIGHT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
(paren
id|box-&gt;y2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|box-&gt;x2
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Emit 1.1 state&n; */
DECL|function|radeon_emit_state
r_static
r_int
id|radeon_emit_state
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_context_regs_t
op_star
id|ctx
comma
id|drm_radeon_texture_regs_t
op_star
id|tex
comma
r_int
r_int
id|dirty
)paren
(brace
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dirty=0x%08x&bslash;n&quot;
comma
id|dirty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_CONTEXT
)paren
(brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|ctx-&gt;rb3d_depthoffset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid depth buffer offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|ctx-&gt;rb3d_coloroffset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid depth buffer offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|14
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_MISC
comma
l_int|6
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_misc
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_fog_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_solid_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_blendcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthpitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_coloroffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_COLORPITCH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_colorpitch
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VERTFMT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_COORD_FMT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_coord_fmt
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_LINE
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_LINE_PATTERN
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_pattern
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_state
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_LINE_WIDTH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_line_width
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_BUMPMAP
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_LUM_MATRIX
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_lum_matrix
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_ROT_MATRIX_0
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_1
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MASKS
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_stencilrefmask
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_ropcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_planemask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VIEWPORT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_VPORT_XSCALE
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zoffset
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_SETUP
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL_STATUS
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl_status
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MISC
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_MISC
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_misc
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX0
)paren
(brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|tex
(braket
l_int|0
)braket
dot
id|pp_txoffset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid texture offset for unit 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_0
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_0
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX1
)paren
(brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|tex
(braket
l_int|1
)braket
dot
id|pp_txoffset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid texture offset for unit 1&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_1
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_1
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX2
)paren
(brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|tex
(braket
l_int|2
)braket
dot
id|pp_txoffset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid texture offset for unit 2&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_2
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_2
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Emit 1.2 state&n; */
DECL|function|radeon_emit_state2
r_static
r_int
id|radeon_emit_state2
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_state_t
op_star
id|state
)paren
(brace
id|RING_LOCALS
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;dirty
op_amp
id|RADEON_UPLOAD_ZBIAS
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_ZBIAS_FACTOR
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|state-&gt;context2.se_zbias_factor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|state-&gt;context2.se_zbias_constant
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|state-&gt;context
comma
id|state-&gt;tex
comma
id|state-&gt;dirty
)paren
suffix:semicolon
)brace
multiline_comment|/* New (1.3) state mechanism.  3 commands (packet, scalar, vector) in&n; * 1.3 cmdbuffers allow all previous state to be updated as well as&n; * the tcl scalar and vector areas.  &n; */
r_static
r_struct
(brace
DECL|member|start
r_int
id|start
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|variable|packet
)brace
id|packet
(braket
id|RADEON_MAX_STATE_PACKETS
)braket
op_assign
(brace
(brace
id|RADEON_PP_MISC
comma
l_int|7
comma
l_string|&quot;RADEON_PP_MISC&quot;
)brace
comma
(brace
id|RADEON_PP_CNTL
comma
l_int|3
comma
l_string|&quot;RADEON_PP_CNTL&quot;
)brace
comma
(brace
id|RADEON_RB3D_COLORPITCH
comma
l_int|1
comma
l_string|&quot;RADEON_RB3D_COLORPITCH&quot;
)brace
comma
(brace
id|RADEON_RE_LINE_PATTERN
comma
l_int|2
comma
l_string|&quot;RADEON_RE_LINE_PATTERN&quot;
)brace
comma
(brace
id|RADEON_SE_LINE_WIDTH
comma
l_int|1
comma
l_string|&quot;RADEON_SE_LINE_WIDTH&quot;
)brace
comma
(brace
id|RADEON_PP_LUM_MATRIX
comma
l_int|1
comma
l_string|&quot;RADEON_PP_LUM_MATRIX&quot;
)brace
comma
(brace
id|RADEON_PP_ROT_MATRIX_0
comma
l_int|2
comma
l_string|&quot;RADEON_PP_ROT_MATRIX_0&quot;
)brace
comma
(brace
id|RADEON_RB3D_STENCILREFMASK
comma
l_int|3
comma
l_string|&quot;RADEON_RB3D_STENCILREFMASK&quot;
)brace
comma
(brace
id|RADEON_SE_VPORT_XSCALE
comma
l_int|6
comma
l_string|&quot;RADEON_SE_VPORT_XSCALE&quot;
)brace
comma
(brace
id|RADEON_SE_CNTL
comma
l_int|2
comma
l_string|&quot;RADEON_SE_CNTL&quot;
)brace
comma
(brace
id|RADEON_SE_CNTL_STATUS
comma
l_int|1
comma
l_string|&quot;RADEON_SE_CNTL_STATUS&quot;
)brace
comma
(brace
id|RADEON_RE_MISC
comma
l_int|1
comma
l_string|&quot;RADEON_RE_MISC&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_0
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_0&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_0
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_0&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_1
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_1&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_1
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_1&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_2
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_2&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_2
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_2&quot;
)brace
comma
(brace
id|RADEON_SE_ZBIAS_FACTOR
comma
l_int|2
comma
l_string|&quot;RADEON_SE_ZBIAS_FACTOR&quot;
)brace
comma
(brace
id|RADEON_SE_TCL_OUTPUT_VTX_FMT
comma
l_int|11
comma
l_string|&quot;RADEON_SE_TCL_OUTPUT_VTX_FMT&quot;
)brace
comma
(brace
id|RADEON_SE_TCL_MATERIAL_EMMISSIVE_RED
comma
l_int|17
comma
l_string|&quot;RADEON_SE_TCL_MATERIAL_EMMISSIVE_RED&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_0
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_0&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_1
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_1&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_2
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_2&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_3
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_3&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_4
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_4&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_5
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_5&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_6
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_6&quot;
)brace
comma
(brace
id|R200_PP_TXCBLEND_7
comma
l_int|4
comma
l_string|&quot;R200_PP_TXCBLEND_7&quot;
)brace
comma
(brace
id|R200_SE_TCL_LIGHT_MODEL_CTL_0
comma
l_int|6
comma
l_string|&quot;R200_SE_TCL_LIGHT_MODEL_CTL_0&quot;
)brace
comma
(brace
id|R200_PP_TFACTOR_0
comma
l_int|6
comma
l_string|&quot;R200_PP_TFACTOR_0&quot;
)brace
comma
(brace
id|R200_SE_VTX_FMT_0
comma
l_int|4
comma
l_string|&quot;R200_SE_VTX_FMT_0&quot;
)brace
comma
(brace
id|R200_SE_VAP_CNTL
comma
l_int|1
comma
l_string|&quot;R200_SE_VAP_CNTL&quot;
)brace
comma
(brace
id|R200_SE_TCL_MATRIX_SEL_0
comma
l_int|5
comma
l_string|&quot;R200_SE_TCL_MATRIX_SEL_0&quot;
)brace
comma
(brace
id|R200_SE_TCL_TEX_PROC_CTL_2
comma
l_int|5
comma
l_string|&quot;R200_SE_TCL_TEX_PROC_CTL_2&quot;
)brace
comma
(brace
id|R200_SE_TCL_UCP_VERT_BLEND_CTL
comma
l_int|1
comma
l_string|&quot;R200_SE_TCL_UCP_VERT_BLEND_CTL&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_0
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_0&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_1
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_1&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_2
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_2&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_3
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_3&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_4
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_4&quot;
)brace
comma
(brace
id|R200_PP_TXFILTER_5
comma
l_int|6
comma
l_string|&quot;R200_PP_TXFILTER_5&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_0
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_0&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_1
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_1&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_2
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_2&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_3
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_3&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_4
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_4&quot;
)brace
comma
(brace
id|R200_PP_TXOFFSET_5
comma
l_int|1
comma
l_string|&quot;R200_PP_TXOFFSET_5&quot;
)brace
comma
(brace
id|R200_SE_VTE_CNTL
comma
l_int|1
comma
l_string|&quot;R200_SE_VTE_CNTL&quot;
)brace
comma
(brace
id|R200_SE_TCL_OUTPUT_VTX_COMP_SEL
comma
l_int|1
comma
l_string|&quot;R200_SE_TCL_OUTPUT_VTX_COMP_SEL&quot;
)brace
comma
(brace
id|R200_PP_TAM_DEBUG3
comma
l_int|1
comma
l_string|&quot;R200_PP_TAM_DEBUG3&quot;
)brace
comma
(brace
id|R200_PP_CNTL_X
comma
l_int|1
comma
l_string|&quot;R200_PP_CNTL_X&quot;
)brace
comma
(brace
id|R200_RB3D_DEPTHXY_OFFSET
comma
l_int|1
comma
l_string|&quot;R200_RB3D_DEPTHXY_OFFSET&quot;
)brace
comma
(brace
id|R200_RE_AUX_SCISSOR_CNTL
comma
l_int|1
comma
l_string|&quot;R200_RE_AUX_SCISSOR_CNTL&quot;
)brace
comma
(brace
id|R200_RE_SCISSOR_TL_0
comma
l_int|2
comma
l_string|&quot;R200_RE_SCISSOR_TL_0&quot;
)brace
comma
(brace
id|R200_RE_SCISSOR_TL_1
comma
l_int|2
comma
l_string|&quot;R200_RE_SCISSOR_TL_1&quot;
)brace
comma
(brace
id|R200_RE_SCISSOR_TL_2
comma
l_int|2
comma
l_string|&quot;R200_RE_SCISSOR_TL_2&quot;
)brace
comma
(brace
id|R200_SE_VAP_CNTL_STATUS
comma
l_int|1
comma
l_string|&quot;R200_SE_VAP_CNTL_STATUS&quot;
)brace
comma
(brace
id|R200_SE_VTX_STATE_CNTL
comma
l_int|1
comma
l_string|&quot;R200_SE_VTX_STATE_CNTL&quot;
)brace
comma
(brace
id|R200_RE_POINTSIZE
comma
l_int|1
comma
l_string|&quot;R200_RE_POINTSIZE&quot;
)brace
comma
(brace
id|R200_SE_TCL_INPUT_VTX_VECTOR_ADDR_0
comma
l_int|4
comma
l_string|&quot;R200_SE_TCL_INPUT_VTX_VECTOR_ADDR_0&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_FACES_0
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_0&quot;
)brace
comma
multiline_comment|/* 61 */
(brace
id|R200_PP_CUBIC_OFFSET_F1_0
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_0&quot;
)brace
comma
multiline_comment|/* 62 */
(brace
id|R200_PP_CUBIC_FACES_1
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_1&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_OFFSET_F1_1
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_1&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_FACES_2
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_2&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_OFFSET_F1_2
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_2&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_FACES_3
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_3&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_OFFSET_F1_3
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_3&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_FACES_4
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_4&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_OFFSET_F1_4
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_4&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_FACES_5
comma
l_int|1
comma
l_string|&quot;R200_PP_CUBIC_FACES_5&quot;
)brace
comma
(brace
id|R200_PP_CUBIC_OFFSET_F1_5
comma
l_int|5
comma
l_string|&quot;R200_PP_CUBIC_OFFSET_F1_5&quot;
)brace
comma
(brace
id|RADEON_PP_TEX_SIZE_0
comma
l_int|2
comma
l_string|&quot;RADEON_PP_TEX_SIZE_0&quot;
)brace
comma
(brace
id|RADEON_PP_TEX_SIZE_1
comma
l_int|2
comma
l_string|&quot;RADEON_PP_TEX_SIZE_1&quot;
)brace
comma
(brace
id|RADEON_PP_TEX_SIZE_2
comma
l_int|2
comma
l_string|&quot;RADEON_PP_TEX_SIZE_2&quot;
)brace
comma
(brace
id|R200_RB3D_BLENDCOLOR
comma
l_int|3
comma
l_string|&quot;R200_RB3D_BLENDCOLOR&quot;
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* ================================================================&n; * Performance monitoring functions&n; */
DECL|function|radeon_clear_box
r_static
r_void
id|radeon_clear_box
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|w
comma
r_int
id|h
comma
r_int
id|r
comma
r_int
id|g
comma
r_int
id|b
)paren
(brace
id|u32
id|color
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|x
op_add_assign
id|dev_priv-&gt;sarea_priv-&gt;boxes
(braket
l_int|0
)braket
dot
id|x1
suffix:semicolon
id|y
op_add_assign
id|dev_priv-&gt;sarea_priv-&gt;boxes
(braket
l_int|0
)braket
dot
id|y1
suffix:semicolon
r_switch
c_cond
(paren
id|dev_priv-&gt;color_fmt
)paren
(brace
r_case
id|RADEON_COLOR_FORMAT_RGB565
suffix:colon
id|color
op_assign
(paren
(paren
(paren
id|r
op_amp
l_int|0xf8
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|g
op_amp
l_int|0xfc
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|b
op_amp
l_int|0xf8
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:colon
r_default
suffix:colon
id|color
op_assign
(paren
(paren
(paren
l_int|0xff
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|r
op_lshift
l_int|16
)paren
op_or
(paren
id|g
op_lshift
l_int|8
)paren
op_or
id|b
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_DP_WRITE_MASK
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0xffffffff
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;page_flipping
op_logical_and
id|dev_priv-&gt;current_page
op_eq
l_int|1
)paren
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
)brace
r_else
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
)brace
id|OUT_RING
c_func
(paren
id|color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_performance_boxes
r_static
r_void
id|radeon_cp_performance_boxes
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
multiline_comment|/* Collapse various things into a wait flag -- trying to&n;&t; * guess if userspase slept -- better just to have them tell us.&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;stats.last_frame_reads
OG
l_int|1
op_logical_or
id|dev_priv-&gt;stats.last_clear_reads
OG
id|dev_priv-&gt;stats.clears
)paren
(brace
id|dev_priv-&gt;stats.boxes
op_or_assign
id|RADEON_BOX_WAIT_IDLE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_priv-&gt;stats.freelist_loops
)paren
(brace
id|dev_priv-&gt;stats.boxes
op_or_assign
id|RADEON_BOX_WAIT_IDLE
suffix:semicolon
)brace
multiline_comment|/* Purple box for page flipping&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;stats.boxes
op_amp
id|RADEON_BOX_FLIP
)paren
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|4
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|255
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
multiline_comment|/* Red box if we have to wait for idle at any point&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;stats.boxes
op_amp
id|RADEON_BOX_WAIT_IDLE
)paren
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|16
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|255
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Blue box: lost context?&n;&t; */
multiline_comment|/* Yellow box for texture swaps&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;stats.boxes
op_amp
id|RADEON_BOX_TEXTURE_LOAD
)paren
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|40
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|255
comma
l_int|255
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Green box if hardware never idles (as far as we can tell)&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev_priv-&gt;stats.boxes
op_amp
id|RADEON_BOX_DMA_IDLE
)paren
)paren
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|64
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|0
comma
l_int|255
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Draw bars indicating number of buffers allocated &n;&t; * (not a great measure, easily confused)&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;stats.requested_bufs
)paren
(brace
r_if
c_cond
(paren
id|dev_priv-&gt;stats.requested_bufs
OG
l_int|100
)paren
id|dev_priv-&gt;stats.requested_bufs
op_assign
l_int|100
suffix:semicolon
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|4
comma
l_int|16
comma
id|dev_priv-&gt;stats.requested_bufs
comma
l_int|4
comma
l_int|196
comma
l_int|128
comma
l_int|128
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|dev_priv-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
id|dev_priv-&gt;stats
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; * CP command dispatch functions&n; */
DECL|function|radeon_cp_dispatch_clear
r_static
r_void
id|radeon_cp_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_clear_t
op_star
id|clear
comma
id|drm_radeon_clear_rect_t
op_star
id|depth_boxes
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_depth_clear_t
op_star
id|depth_clear
op_assign
op_amp
id|dev_priv-&gt;depth_clear
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|clear-&gt;flags
suffix:semicolon
id|u32
id|rb3d_cntl
op_assign
l_int|0
comma
id|rb3d_stencilrefmask
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;flags = 0x%x&bslash;n&quot;
comma
id|flags
)paren
suffix:semicolon
id|dev_priv-&gt;stats.clears
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;page_flipping
op_logical_and
id|dev_priv-&gt;current_page
op_eq
l_int|1
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|flags
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_FRONT
)paren
id|flags
op_or_assign
id|RADEON_BACK
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_BACK
)paren
id|flags
op_or_assign
id|RADEON_FRONT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Ensure the 3D stream is idle before doing a&n;&t;&t; * 2D fill to clear the front or back buffer.&n;&t;&t; */
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_DP_WRITE_MASK
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;color_mask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch clear %d,%d-%d,%d flags 0x%x&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_FRONT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_BACK
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* We have to clear the depth and/or stencil buffers by&n;&t; * rendering a quad into just those buffers.  Thus, we have to&n;&t; * make sure the 3D engine is configured correctly.&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;is_r200
op_logical_and
(paren
id|flags
op_amp
(paren
id|RADEON_DEPTH
op_or
id|RADEON_STENCIL
)paren
)paren
)paren
(brace
r_int
id|tempPP_CNTL
suffix:semicolon
r_int
id|tempRE_CNTL
suffix:semicolon
r_int
id|tempRB3D_CNTL
suffix:semicolon
r_int
id|tempRB3D_ZSTENCILCNTL
suffix:semicolon
r_int
id|tempRB3D_STENCILREFMASK
suffix:semicolon
r_int
id|tempRB3D_PLANEMASK
suffix:semicolon
r_int
id|tempSE_CNTL
suffix:semicolon
r_int
id|tempSE_VTE_CNTL
suffix:semicolon
r_int
id|tempSE_VTX_FMT_0
suffix:semicolon
r_int
id|tempSE_VTX_FMT_1
suffix:semicolon
r_int
id|tempSE_VAP_CNTL
suffix:semicolon
r_int
id|tempRE_AUX_SCISSOR_CNTL
suffix:semicolon
id|tempPP_CNTL
op_assign
l_int|0
suffix:semicolon
id|tempRE_CNTL
op_assign
l_int|0
suffix:semicolon
id|tempRB3D_CNTL
op_assign
id|depth_clear-&gt;rb3d_cntl
suffix:semicolon
id|tempRB3D_CNTL
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|15
)paren
suffix:semicolon
multiline_comment|/* unset radeon magic flag */
id|tempRB3D_ZSTENCILCNTL
op_assign
id|depth_clear-&gt;rb3d_zstencilcntl
suffix:semicolon
id|tempRB3D_STENCILREFMASK
op_assign
l_int|0x0
suffix:semicolon
id|tempSE_CNTL
op_assign
id|depth_clear-&gt;se_cntl
suffix:semicolon
multiline_comment|/* Disable TCL */
id|tempSE_VAP_CNTL
op_assign
(paren
multiline_comment|/* SE_VAP_CNTL__FORCE_W_TO_ONE_MASK |  */
(paren
l_int|0x9
op_lshift
id|SE_VAP_CNTL__VF_MAX_VTX_NUM__SHIFT
)paren
)paren
suffix:semicolon
id|tempRB3D_PLANEMASK
op_assign
l_int|0x0
suffix:semicolon
id|tempRE_AUX_SCISSOR_CNTL
op_assign
l_int|0x0
suffix:semicolon
id|tempSE_VTE_CNTL
op_assign
id|SE_VTE_CNTL__VTX_XY_FMT_MASK
op_or
id|SE_VTE_CNTL__VTX_Z_FMT_MASK
suffix:semicolon
multiline_comment|/* Vertex format (X, Y, Z, W)*/
id|tempSE_VTX_FMT_0
op_assign
id|SE_VTX_FMT_0__VTX_Z0_PRESENT_MASK
op_or
id|SE_VTX_FMT_0__VTX_W0_PRESENT_MASK
suffix:semicolon
id|tempSE_VTX_FMT_1
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Depth buffer specific enables &n;&t;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_DEPTH
)paren
(brace
multiline_comment|/* Enable depth buffer */
id|tempRB3D_CNTL
op_or_assign
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable depth buffer */
id|tempRB3D_CNTL
op_and_assign
op_complement
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t; * Stencil buffer specific enables&n;&t;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_STENCIL
)paren
(brace
id|tempRB3D_CNTL
op_or_assign
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|tempRB3D_STENCILREFMASK
op_assign
id|clear-&gt;depth_mask
suffix:semicolon
)brace
r_else
(brace
id|tempRB3D_CNTL
op_and_assign
op_complement
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|tempRB3D_STENCILREFMASK
op_assign
l_int|0x00000000
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|26
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_PP_CNTL
comma
id|tempPP_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_RE_CNTL
comma
id|tempRE_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_CNTL
comma
id|tempRB3D_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_ZSTENCILCNTL
comma
id|tempRB3D_ZSTENCILCNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
id|tempRB3D_STENCILREFMASK
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_PLANEMASK
comma
id|tempRB3D_PLANEMASK
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_SE_CNTL
comma
id|tempSE_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_SE_VTE_CNTL
comma
id|tempSE_VTE_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_SE_VTX_FMT_0
comma
id|tempSE_VTX_FMT_0
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_SE_VTX_FMT_1
comma
id|tempSE_VTX_FMT_1
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_SE_VAP_CNTL
comma
id|tempSE_VAP_CNTL
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|R200_RE_AUX_SCISSOR_CNTL
comma
id|tempRE_AUX_SCISSOR_CNTL
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Funny that this should be required -- &n;&t;&t;&t; *  sets top-left?&n;&t;&t;&t; */
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|14
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|R200_3D_DRAW_IMMD_2
comma
l_int|12
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|RADEON_PRIM_TYPE_RECT_LIST
op_or
id|RADEON_PRIM_WALK_RING
op_or
(paren
l_int|3
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x3f800000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x3f800000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x3f800000
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|flags
op_amp
(paren
id|RADEON_DEPTH
op_or
id|RADEON_STENCIL
)paren
)paren
)paren
(brace
id|rb3d_cntl
op_assign
id|depth_clear-&gt;rb3d_cntl
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_DEPTH
)paren
(brace
id|rb3d_cntl
op_or_assign
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
r_else
(brace
id|rb3d_cntl
op_and_assign
op_complement
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_STENCIL
)paren
(brace
id|rb3d_cntl
op_or_assign
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|rb3d_stencilrefmask
op_assign
id|clear-&gt;depth_mask
suffix:semicolon
multiline_comment|/* misnamed field */
)brace
r_else
(brace
id|rb3d_cntl
op_and_assign
op_complement
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|rb3d_stencilrefmask
op_assign
l_int|0x00000000
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
l_int|13
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_ZSTENCILCNTL
comma
id|depth_clear-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
id|rb3d_stencilrefmask
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_PLANEMASK
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_SE_CNTL
comma
id|depth_clear-&gt;se_cntl
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Funny that this should be required -- &n;&t;&t;&t; *  sets top-left?&n;&t;&t;&t; */
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_DRAW_IMMD
comma
l_int|13
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_VTX_Z_PRESENT
op_or
id|RADEON_VTX_PKCOLOR_PRESENT
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|RADEON_PRIM_TYPE_RECT_LIST
op_or
id|RADEON_PRIM_WALK_RING
op_or
id|RADEON_MAOS_ENABLE
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
l_int|3
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Increment the clear counter.  The client-side 3D driver must&n;&t; * wait on this value before performing the clear ioctl.  We&n;&t; * need this because the card&squot;s so damned fast...&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_clear
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_CLEAR_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_clear
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_swap
r_static
r_void
id|radeon_cp_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;do_boxes
)paren
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
multiline_comment|/* Wait for the 3D stream to idle before dispatching the bitblt.&n;&t; * This will prevent data corruption between the two streams.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch swap %d,%d-%d,%d&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_BITBLT_MULTI
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_SRC_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_MEMORY
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
multiline_comment|/* Make this work even if front &amp; back are flipped:&n;&t;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;current_page
op_eq
l_int|0
)paren
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
)brace
r_else
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
)brace
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_flip
r_static
r_void
id|radeon_cp_dispatch_flip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_sarea_t
op_star
id|sarea
op_assign
(paren
id|drm_sarea_t
op_star
)paren
id|dev_priv-&gt;sarea-&gt;handle
suffix:semicolon
r_int
id|offset
op_assign
(paren
id|dev_priv-&gt;current_page
op_eq
l_int|1
)paren
ques
c_cond
id|dev_priv-&gt;front_offset
suffix:colon
id|dev_priv-&gt;back_offset
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: page=%d pfCurrentPage=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev_priv-&gt;current_page
comma
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
)paren
suffix:semicolon
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;do_boxes
)paren
(brace
id|dev_priv-&gt;stats.boxes
op_or_assign
id|RADEON_BOX_FLIP
suffix:semicolon
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
)brace
multiline_comment|/* Update the frame offsets for both CRTCs&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_CRTC_OFFSET
comma
(paren
(paren
id|sarea-&gt;frame.y
op_star
id|dev_priv-&gt;front_pitch
op_plus
id|sarea-&gt;frame.x
op_star
(paren
id|dev_priv-&gt;color_fmt
op_minus
l_int|2
)paren
)paren
op_amp
op_complement
l_int|7
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_CRTC2_OFFSET
comma
id|dev_priv-&gt;sarea_priv-&gt;crtc2_base
op_plus
id|offset
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
op_assign
id|dev_priv-&gt;current_page
op_assign
l_int|1
op_minus
id|dev_priv-&gt;current_page
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|bad_prim_vertex_nr
r_static
r_int
id|bad_prim_vertex_nr
c_func
(paren
r_int
id|primitive
comma
r_int
id|nr
)paren
(brace
r_switch
c_cond
(paren
id|primitive
op_amp
id|RADEON_PRIM_TYPE_MASK
)paren
(brace
r_case
id|RADEON_PRIM_TYPE_NONE
suffix:colon
r_case
id|RADEON_PRIM_TYPE_POINT
suffix:colon
r_return
id|nr
OL
l_int|1
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_LINE
suffix:colon
r_return
(paren
id|nr
op_amp
l_int|1
)paren
op_logical_or
id|nr
op_eq
l_int|0
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_LINE_STRIP
suffix:colon
r_return
id|nr
OL
l_int|2
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_TRI_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_3VRT_POINT_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_RECT_LIST
suffix:colon
r_return
id|nr
op_mod
l_int|3
op_logical_or
id|nr
op_eq
l_int|0
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_TRI_FAN
suffix:colon
r_case
id|RADEON_PRIM_TYPE_TRI_STRIP
suffix:colon
r_return
id|nr
OL
l_int|3
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_typedef
r_struct
(brace
DECL|member|start
r_int
r_int
id|start
suffix:semicolon
DECL|member|finish
r_int
r_int
id|finish
suffix:semicolon
DECL|member|prim
r_int
r_int
id|prim
suffix:semicolon
DECL|member|numverts
r_int
r_int
id|numverts
suffix:semicolon
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
DECL|member|vc_format
r_int
r_int
id|vc_format
suffix:semicolon
DECL|typedef|drm_radeon_tcl_prim_t
)brace
id|drm_radeon_tcl_prim_t
suffix:semicolon
DECL|function|radeon_cp_dispatch_vertex
r_static
r_void
id|radeon_cp_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
id|drm_radeon_tcl_prim_t
op_star
id|prim
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;gart_buffers_offset
op_plus
id|buf-&gt;offset
op_plus
id|prim-&gt;start
suffix:semicolon
r_int
id|numverts
op_assign
(paren
r_int
)paren
id|prim-&gt;numverts
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hwprim 0x%x vfmt 0x%x %d..%d %d verts&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|prim-&gt;vc_format
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bad_prim_vertex_nr
c_func
(paren
id|prim-&gt;prim
comma
id|prim-&gt;numverts
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad prim %x numverts %d&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
multiline_comment|/* Emit the next cliprect */
r_if
c_cond
(paren
id|i
OL
id|nbox
)paren
(brace
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Emit the vertex buffer rendering commands */
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
l_int|3
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|numverts
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|prim-&gt;vc_format
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|prim-&gt;prim
op_or
id|RADEON_PRIM_WALK_LIST
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|numverts
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|nbox
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_discard_buffer
r_static
r_void
id|radeon_cp_discard_buffer
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|buf_priv-&gt;age
op_assign
op_increment
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
suffix:semicolon
multiline_comment|/* Emit the vertex buffer age */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_DISPATCH_AGE
c_func
(paren
id|buf_priv-&gt;age
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_indirect
r_static
r_void
id|radeon_cp_dispatch_indirect
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: buf=%d s=0x%x e=0x%x&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|start
comma
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
r_int
id|offset
op_assign
(paren
id|dev_priv-&gt;gart_buffers_offset
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
r_int
id|dwords
op_assign
(paren
id|end
op_minus
id|start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* Indirect buffer data must be an even number of&n;&t;&t; * dwords, so if we&squot;ve been given an odd number we must&n;&t;&t; * pad the data with a Type-2 CP packet.&n;&t;&t; */
r_if
c_cond
(paren
id|dwords
op_amp
l_int|1
)paren
(brace
id|u32
op_star
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;agp_buffer_map-&gt;handle
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
id|data
(braket
id|dwords
op_increment
)braket
op_assign
id|RADEON_CP_PACKET2
suffix:semicolon
)brace
multiline_comment|/* Fire off the indirect buffer */
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CP_IB_BASE
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dwords
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeon_cp_dispatch_indices
r_static
r_void
id|radeon_cp_dispatch_indices
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|elt_buf
comma
id|drm_radeon_tcl_prim_t
op_star
id|prim
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;gart_buffers_offset
op_plus
id|prim-&gt;offset
suffix:semicolon
id|u32
op_star
id|data
suffix:semicolon
r_int
id|dwords
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|start
op_assign
id|prim-&gt;start
op_plus
id|RADEON_INDEX_PRIM_OFFSET
suffix:semicolon
r_int
id|count
op_assign
(paren
id|prim-&gt;finish
op_minus
id|start
)paren
op_div
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;hwprim 0x%x vfmt 0x%x %d..%d offset: %x nr %d&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|prim-&gt;vc_format
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
comma
id|prim-&gt;offset
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bad_prim_vertex_nr
c_func
(paren
id|prim-&gt;prim
comma
id|count
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad prim %x count %d&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|count
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_ge
id|prim-&gt;finish
op_logical_or
(paren
id|prim-&gt;start
op_amp
l_int|0x7
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|prim-&gt;prim
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dwords
op_assign
(paren
id|prim-&gt;finish
op_minus
id|prim-&gt;start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;agp_buffer_map-&gt;handle
op_plus
id|elt_buf-&gt;offset
op_plus
id|prim-&gt;start
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
id|dwords
op_minus
l_int|2
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|offset
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|prim-&gt;numverts
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|prim-&gt;vc_format
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
(paren
id|prim-&gt;prim
op_or
id|RADEON_PRIM_WALK_IND
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|count
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|nbox
)paren
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|elt_buf
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|nbox
)paren
suffix:semicolon
)brace
DECL|macro|RADEON_MAX_TEXTURE_SIZE
mdefine_line|#define RADEON_MAX_TEXTURE_SIZE (RADEON_BUFFER_SIZE - 8 * sizeof(u32))
DECL|function|radeon_cp_dispatch_texture
r_static
r_int
id|radeon_cp_dispatch_texture
c_func
(paren
id|DRMFILE
id|filp
comma
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_texture_t
op_star
id|tex
comma
id|drm_radeon_tex_image_t
op_star
id|image
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|u32
id|format
suffix:semicolon
id|u32
op_star
id|buffer
suffix:semicolon
r_const
id|u8
id|__user
op_star
id|data
suffix:semicolon
r_int
id|size
comma
id|dwords
comma
id|tex_width
comma
id|blit_width
suffix:semicolon
id|u32
id|height
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_check_and_fixup_offset
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|tex-&gt;offset
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Invalid destination offset&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|dev_priv-&gt;stats.boxes
op_or_assign
id|RADEON_BOX_TEXTURE_LOAD
suffix:semicolon
multiline_comment|/* Flush the pixel cache.  This ensures no pixel data gets mixed&n;&t; * up with the texture data from the host data blit, otherwise&n;&t; * part of the texture image may be corrupted.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
multiline_comment|/* The Mesa texture functions provide the data in little endian as the&n;&t; * chip wants it, but we need to compensate for the fact that the CP&n;&t; * ring gets byte-swapped&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RBBM_GUICNTL
comma
id|RADEON_HOST_DATA_SWAP_32BIT
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* The compiler won&squot;t optimize away a division by a variable,&n;&t; * even if the only legal values are powers of two.  Thus, we&squot;ll&n;&t; * use a shift instead.&n;&t; */
r_switch
c_cond
(paren
id|tex-&gt;format
)paren
(brace
r_case
id|RADEON_TXFORMAT_ARGB8888
suffix:colon
r_case
id|RADEON_TXFORMAT_RGBA8888
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|4
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXFORMAT_AI88
suffix:colon
r_case
id|RADEON_TXFORMAT_ARGB1555
suffix:colon
r_case
id|RADEON_TXFORMAT_RGB565
suffix:colon
r_case
id|RADEON_TXFORMAT_ARGB4444
suffix:colon
r_case
id|RADEON_TXFORMAT_VYUY422
suffix:colon
r_case
id|RADEON_TXFORMAT_YVYU422
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_RGB565
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|2
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXFORMAT_I8
suffix:colon
r_case
id|RADEON_TXFORMAT_RGB332
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_CI8
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|1
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;invalid texture format %d&bslash;n&quot;
comma
id|tex-&gt;format
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;tex=%dx%d blit=%d&bslash;n&quot;
comma
id|tex_width
comma
id|tex-&gt;height
comma
id|blit_width
)paren
suffix:semicolon
r_do
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;tex: ofs=0x%x p=%d f=%d x=%hd y=%hd w=%hd h=%hd&bslash;n&quot;
comma
id|tex-&gt;offset
op_rshift
l_int|10
comma
id|tex-&gt;pitch
comma
id|tex-&gt;format
comma
id|image-&gt;x
comma
id|image-&gt;y
comma
id|image-&gt;width
comma
id|image-&gt;height
)paren
suffix:semicolon
multiline_comment|/* Make a copy of some parameters in case we have to&n;&t;&t; * update them for a multi-pass texture blit.&n;&t;&t; */
id|height
op_assign
id|image-&gt;height
suffix:semicolon
id|data
op_assign
(paren
r_const
id|u8
id|__user
op_star
)paren
id|image-&gt;data
suffix:semicolon
id|size
op_assign
id|height
op_star
id|blit_width
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|RADEON_MAX_TEXTURE_SIZE
)paren
(brace
id|height
op_assign
id|RADEON_MAX_TEXTURE_SIZE
op_div
id|blit_width
suffix:semicolon
id|size
op_assign
id|height
op_star
id|blit_width
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
template_param
l_int|0
)paren
(brace
id|size
op_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|buf
op_assign
id|radeon_freelist_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_logical_and
op_logical_neg
id|buf
)paren
(brace
id|radeon_do_cp_idle
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|radeon_freelist_get
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;radeon_cp_dispatch_texture: EAGAIN&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_TO_USER
c_func
(paren
id|tex-&gt;image
comma
id|image
comma
r_sizeof
(paren
op_star
id|image
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EAGAIN
)paren
suffix:semicolon
)brace
multiline_comment|/* Dispatch the indirect buffer.&n;&t;&t; */
id|buffer
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;agp_buffer_map-&gt;handle
op_plus
id|buf-&gt;offset
)paren
suffix:semicolon
id|dwords
op_assign
id|size
op_div
l_int|4
suffix:semicolon
id|buffer
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_HOSTDATA_BLT
comma
id|dwords
op_plus
l_int|6
)paren
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|format
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_HOST_DATA
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
(paren
id|tex-&gt;pitch
op_lshift
l_int|22
)paren
op_or
(paren
id|tex-&gt;offset
op_rshift
l_int|10
)paren
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|buffer
(braket
l_int|4
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|buffer
(braket
l_int|5
)braket
op_assign
(paren
id|image-&gt;y
op_lshift
l_int|16
)paren
op_or
id|image-&gt;x
suffix:semicolon
id|buffer
(braket
l_int|6
)braket
op_assign
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|image-&gt;width
suffix:semicolon
id|buffer
(braket
l_int|7
)braket
op_assign
id|dwords
suffix:semicolon
id|buffer
op_add_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|tex_width
op_ge
l_int|32
)paren
(brace
multiline_comment|/* Texture image width is larger than the minimum, so we&n;&t;&t;&t; * can upload it directly.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
id|buffer
comma
id|data
comma
id|dwords
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;EFAULT on data, %d dwords&bslash;n&quot;
comma
id|dwords
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Texture image width is less than the minimum, so we&n;&t;&t;&t; * need to pad out each image scanline to the minimum&n;&t;&t;&t; * width.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tex-&gt;height
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
id|buffer
comma
id|data
comma
id|tex_width
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;EFAULT on pad, %d bytes&bslash;n&quot;
comma
id|tex_width
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
id|buffer
op_add_assign
l_int|8
suffix:semicolon
id|data
op_add_assign
id|tex_width
suffix:semicolon
)brace
)brace
id|buf-&gt;filp
op_assign
id|filp
suffix:semicolon
id|buf-&gt;used
op_assign
(paren
id|dwords
op_plus
l_int|8
)paren
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
l_int|0
comma
id|buf-&gt;used
)paren
suffix:semicolon
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
multiline_comment|/* Update the input parameters for next time */
id|image-&gt;y
op_add_assign
id|height
suffix:semicolon
id|image-&gt;height
op_sub_assign
id|height
suffix:semicolon
id|image-&gt;data
op_assign
(paren
r_const
id|u8
id|__user
op_star
)paren
id|image-&gt;data
op_plus
id|size
suffix:semicolon
)brace
r_while
c_loop
(paren
id|image-&gt;height
OG
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Flush the pixel cache after the blit completes.  This ensures&n;&t; * the texture data is written out to memory before rendering&n;&t; * continues.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_stipple
r_static
r_void
id|radeon_cp_dispatch_stipple
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|u32
op_star
id|stipple
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|35
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_STIPPLE_ADDR
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_RE_STIPPLE_DATA
comma
l_int|31
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OUT_RING
c_func
(paren
id|stipple
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; * IOCTL functions&n; */
DECL|function|radeon_cp_clear
r_int
id|radeon_cp_clear
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_clear_t
id|clear
suffix:semicolon
id|drm_radeon_clear_rect_t
id|depth_boxes
(braket
id|RADEON_NR_SAREA_CLIPRECTS
)braket
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|clear
comma
(paren
id|drm_radeon_clear_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|clear
)paren
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
op_amp
id|depth_boxes
comma
id|clear.depth_boxes
comma
id|sarea_priv-&gt;nbox
op_star
r_sizeof
(paren
id|depth_boxes
(braket
l_int|0
)braket
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|radeon_cp_dispatch_clear
c_func
(paren
id|dev
comma
op_amp
id|clear
comma
id|depth_boxes
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Not sure why this isn&squot;t set all the time:&n; */
DECL|function|radeon_do_init_pageflip
r_static
r_int
id|radeon_do_init_pageflip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CRTC_OFFSET_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_READ
c_func
(paren
id|RADEON_CRTC_OFFSET_CNTL
)paren
op_or
id|RADEON_CRTC_OFFSET_FLIP_CNTL
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CRTC2_OFFSET_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_READ
c_func
(paren
id|RADEON_CRTC2_OFFSET_CNTL
)paren
op_or
id|RADEON_CRTC_OFFSET_FLIP_CNTL
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|dev_priv-&gt;page_flipping
op_assign
l_int|1
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|0
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
op_assign
id|dev_priv-&gt;current_page
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called whenever a client dies, from drm_release.&n; * NOTE:  Lock isn&squot;t necessarily held when this is called!&n; */
DECL|function|radeon_do_cleanup_pageflip
r_int
id|radeon_do_cleanup_pageflip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;current_page
op_ne
l_int|0
)paren
id|radeon_cp_dispatch_flip
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_priv-&gt;page_flipping
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Swapping and flipping are different operations, need different ioctls.&n; * They can &amp; should be intermixed to support multiple 3d windows.  &n; */
DECL|function|radeon_cp_flip
r_int
id|radeon_cp_flip
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv-&gt;page_flipping
)paren
id|radeon_do_init_pageflip
c_func
(paren
id|dev
)paren
suffix:semicolon
id|radeon_cp_dispatch_flip
c_func
(paren
id|dev
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_swap
r_int
id|radeon_cp_swap
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
id|radeon_cp_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_vertex
r_int
id|radeon_cp_vertex
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_vertex_t
id|vertex
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|prim
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|vertex
comma
(paren
id|drm_radeon_vertex_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|vertex
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;pid=%d index=%d count=%d discard=%d&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|vertex.idx
comma
id|vertex.count
comma
id|vertex.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
OL
l_int|0
op_logical_or
id|vertex.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|vertex.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|vertex.prim
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %p&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|buf-&gt;filp
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|vertex.idx
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/* Build up a prim_t record:&n;&t; */
r_if
c_cond
(paren
id|vertex.count
)paren
(brace
id|buf-&gt;used
op_assign
id|vertex.count
suffix:semicolon
multiline_comment|/* not used? */
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
r_if
c_cond
(paren
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|sarea_priv-&gt;context_state
comma
id|sarea_priv-&gt;tex_state
comma
id|sarea_priv-&gt;dirty
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_state failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
(paren
id|RADEON_UPLOAD_TEX0IMAGES
op_or
id|RADEON_UPLOAD_TEX1IMAGES
op_or
id|RADEON_UPLOAD_TEX2IMAGES
op_or
id|RADEON_REQUIRE_QUIESCENCE
)paren
suffix:semicolon
)brace
id|prim.start
op_assign
l_int|0
suffix:semicolon
id|prim.finish
op_assign
id|vertex.count
suffix:semicolon
multiline_comment|/* unused */
id|prim.prim
op_assign
id|vertex.prim
suffix:semicolon
id|prim.numverts
op_assign
id|vertex.count
suffix:semicolon
id|prim.vc_format
op_assign
id|dev_priv-&gt;sarea_priv-&gt;vc_format
suffix:semicolon
id|radeon_cp_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|prim
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indices
r_int
id|radeon_cp_indices
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_indices_t
id|elts
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|prim
suffix:semicolon
r_int
id|count
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|elts
comma
(paren
id|drm_radeon_indices_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|elts
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;pid=%d index=%d start=%d end=%d discard=%d&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|elts.idx
comma
id|elts.start
comma
id|elts.end
comma
id|elts.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elts.idx
OL
l_int|0
op_logical_or
id|elts.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|elts.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|elts.prim
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|elts.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %p&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|buf-&gt;filp
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|elts.idx
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|count
op_assign
(paren
id|elts.end
op_minus
id|elts.start
)paren
op_div
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
id|elts.start
op_sub_assign
id|RADEON_INDEX_PRIM_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|elts.start
op_amp
l_int|0x7
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;misaligned buffer 0x%x&bslash;n&quot;
comma
id|elts.start
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;no header 0x%x - 0x%x&bslash;n&quot;
comma
id|elts.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|buf-&gt;used
op_assign
id|elts.end
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
r_if
c_cond
(paren
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|sarea_priv-&gt;context_state
comma
id|sarea_priv-&gt;tex_state
comma
id|sarea_priv-&gt;dirty
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_state failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
(paren
id|RADEON_UPLOAD_TEX0IMAGES
op_or
id|RADEON_UPLOAD_TEX1IMAGES
op_or
id|RADEON_UPLOAD_TEX2IMAGES
op_or
id|RADEON_REQUIRE_QUIESCENCE
)paren
suffix:semicolon
)brace
multiline_comment|/* Build up a prim_t record:&n;&t; */
id|prim.start
op_assign
id|elts.start
suffix:semicolon
id|prim.finish
op_assign
id|elts.end
suffix:semicolon
id|prim.prim
op_assign
id|elts.prim
suffix:semicolon
id|prim.offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* offset from start of dma buffers */
id|prim.numverts
op_assign
id|RADEON_MAX_VB_VERTS
suffix:semicolon
multiline_comment|/* duh */
id|prim.vc_format
op_assign
id|dev_priv-&gt;sarea_priv-&gt;vc_format
suffix:semicolon
id|radeon_cp_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|prim
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elts.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_texture
r_int
id|radeon_cp_texture
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_texture_t
id|tex
suffix:semicolon
id|drm_radeon_tex_image_t
id|image
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|tex
comma
(paren
id|drm_radeon_texture_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|tex
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tex.image
op_eq
l_int|NULL
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;null texture image!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
op_amp
id|image
comma
(paren
id|drm_radeon_tex_image_t
id|__user
op_star
)paren
id|tex.image
comma
r_sizeof
(paren
id|image
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|ret
op_assign
id|radeon_cp_dispatch_texture
c_func
(paren
id|filp
comma
id|dev
comma
op_amp
id|tex
comma
op_amp
id|image
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|radeon_cp_stipple
r_int
id|radeon_cp_stipple
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_stipple_t
id|stipple
suffix:semicolon
id|u32
id|mask
(braket
l_int|32
)braket
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|stipple
comma
(paren
id|drm_radeon_stipple_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|stipple
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
op_amp
id|mask
comma
id|stipple.mask
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|radeon_cp_dispatch_stipple
c_func
(paren
id|dev
comma
id|mask
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indirect
r_int
id|radeon_cp_indirect
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_indirect_t
id|indirect
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|indirect
comma
(paren
id|drm_radeon_indirect_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|indirect
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: idx=%d s=%d e=%d d=%d&bslash;n&quot;
comma
id|indirect.idx
comma
id|indirect.start
comma
id|indirect.end
comma
id|indirect.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indirect.idx
OL
l_int|0
op_logical_or
id|indirect.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|indirect.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|indirect.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %p&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|buf-&gt;filp
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|indirect.idx
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|indirect.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;reusing indirect: start=0x%x actual=0x%x&bslash;n&quot;
comma
id|indirect.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf-&gt;used
op_assign
id|indirect.end
suffix:semicolon
multiline_comment|/* Wait for the 3D stream to idle before the indirect buffer&n;&t; * containing 2D acceleration commands is processed.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Dispatch the indirect buffer full of commands from the&n;&t; * X server.  This is insecure and is thus only available to&n;&t; * privileged clients.&n;&t; */
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
id|indirect.start
comma
id|indirect.end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indirect.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_vertex2
r_int
id|radeon_cp_vertex2
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_vertex2_t
id|vertex
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|laststate
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|vertex
comma
(paren
id|drm_radeon_vertex2_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|vertex
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;pid=%d index=%d discard=%d&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|vertex.idx
comma
id|vertex.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
OL
l_int|0
op_logical_or
id|vertex.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|vertex.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %p&bslash;n&quot;
comma
id|DRM_CURRENTPID
comma
id|buf-&gt;filp
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|vertex.idx
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|laststate
op_assign
l_int|0xff
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|vertex.nr_prims
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_radeon_prim_t
id|prim
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|tclprim
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
op_amp
id|prim
comma
op_amp
id|vertex.prim
(braket
id|i
)braket
comma
r_sizeof
(paren
id|prim
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prim.stateidx
op_ne
id|laststate
)paren
(brace
id|drm_radeon_state_t
id|state
suffix:semicolon
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER
c_func
(paren
op_amp
id|state
comma
op_amp
id|vertex.state
(braket
id|prim.stateidx
)braket
comma
r_sizeof
(paren
id|state
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_state2
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
op_amp
id|state
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_state2 failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|laststate
op_assign
id|prim.stateidx
suffix:semicolon
)brace
id|tclprim.start
op_assign
id|prim.start
suffix:semicolon
id|tclprim.finish
op_assign
id|prim.finish
suffix:semicolon
id|tclprim.prim
op_assign
id|prim.prim
suffix:semicolon
id|tclprim.vc_format
op_assign
id|prim.vc_format
suffix:semicolon
r_if
c_cond
(paren
id|prim.prim
op_amp
id|RADEON_PRIM_WALK_IND
)paren
(brace
id|tclprim.offset
op_assign
id|prim.numverts
op_star
l_int|64
suffix:semicolon
id|tclprim.numverts
op_assign
id|RADEON_MAX_VB_VERTS
suffix:semicolon
multiline_comment|/* duh */
id|radeon_cp_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|tclprim
)paren
suffix:semicolon
)brace
r_else
(brace
id|tclprim.numverts
op_assign
id|prim.numverts
suffix:semicolon
id|tclprim.offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
id|radeon_cp_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|tclprim
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
op_eq
l_int|1
)paren
id|sarea_priv-&gt;nbox
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packets
r_static
r_int
id|radeon_emit_packets
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|id
op_assign
(paren
r_int
)paren
id|header.packet.packet_id
suffix:semicolon
r_int
id|sz
comma
id|reg
suffix:semicolon
r_int
id|__user
op_star
id|data
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ge
id|RADEON_MAX_STATE_PACKETS
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
id|sz
op_assign
id|packet
(braket
id|id
)braket
dot
id|len
suffix:semicolon
id|reg
op_assign
id|packet
(braket
id|id
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|sz
op_star
r_sizeof
(paren
r_int
)paren
OG
id|cmdbuf-&gt;bufsz
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Packet size provided larger than data provided&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|radeon_check_and_fixup_packets
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
id|id
comma
id|data
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Packet verification failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
id|sz
op_plus
l_int|1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|reg
comma
(paren
id|sz
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_scalars
r_static
id|__inline__
r_int
id|radeon_emit_scalars
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|sz
op_assign
id|header.scalars.count
suffix:semicolon
r_int
id|__user
op_star
id|data
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|start
op_assign
id|header.scalars.offset
suffix:semicolon
r_int
id|stride
op_assign
id|header.scalars.stride
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
op_plus
id|sz
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_SCALAR_INDX_REG
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
(paren
id|stride
op_lshift
id|RADEON_SCAL_INDX_DWORD_STRIDE_SHIFT
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_SE_TCL_SCALAR_DATA_REG
comma
id|sz
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* God this is ugly&n; */
DECL|function|radeon_emit_scalars2
r_static
id|__inline__
r_int
id|radeon_emit_scalars2
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|sz
op_assign
id|header.scalars.count
suffix:semicolon
r_int
id|__user
op_star
id|data
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|start
op_assign
(paren
(paren
r_int
r_int
)paren
id|header.scalars.offset
)paren
op_plus
l_int|0x100
suffix:semicolon
r_int
id|stride
op_assign
id|header.scalars.stride
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
op_plus
id|sz
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_SCALAR_INDX_REG
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
(paren
id|stride
op_lshift
id|RADEON_SCAL_INDX_DWORD_STRIDE_SHIFT
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_SE_TCL_SCALAR_DATA_REG
comma
id|sz
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_vectors
r_static
id|__inline__
r_int
id|radeon_emit_vectors
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|sz
op_assign
id|header.vectors.count
suffix:semicolon
r_int
id|__user
op_star
id|data
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|start
op_assign
id|header.vectors.offset
suffix:semicolon
r_int
id|stride
op_assign
id|header.vectors.stride
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
op_plus
id|sz
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_VECTOR_INDX_REG
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
(paren
id|stride
op_lshift
id|RADEON_VEC_INDX_OCTWORD_STRIDE_SHIFT
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_SE_TCL_VECTOR_DATA_REG
comma
(paren
id|sz
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packet3
r_static
r_int
id|radeon_emit_packet3
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
r_int
id|cmdsz
suffix:semicolon
r_int
id|__user
op_star
id|cmd
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|radeon_check_and_fixup_packet3
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
id|cmdbuf
comma
op_amp
id|cmdsz
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Packet verification failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
id|cmdsz
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|cmd
comma
id|cmdsz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packet3_cliprect
r_static
r_int
id|radeon_emit_packet3_cliprect
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_file_t
op_star
id|filp_priv
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
comma
r_int
id|orig_nbox
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_clip_rect_t
id|box
suffix:semicolon
r_int
r_int
id|cmdsz
suffix:semicolon
r_int
id|__user
op_star
id|cmd
op_assign
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|drm_clip_rect_t
id|__user
op_star
id|boxes
op_assign
id|cmdbuf-&gt;boxes
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|radeon_check_and_fixup_packet3
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
id|cmdbuf
comma
op_amp
id|cmdsz
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;Packet verification failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|orig_nbox
)paren
r_goto
id|out
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|cmdbuf-&gt;nbox
)paren
(brace
r_if
c_cond
(paren
id|DRM_COPY_FROM_USER_UNCHECKED
c_func
(paren
op_amp
id|box
comma
op_amp
id|boxes
(braket
id|i
)braket
comma
r_sizeof
(paren
id|box
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
multiline_comment|/* FIXME The second and subsequent times round&n;&t;&t;&t; * this loop, send a WAIT_UNTIL_3D_IDLE before&n;&t;&t;&t; * calling emit_clip_rect(). This fixes a&n;&t;&t;&t; * lockup on fast machines when sending&n;&t;&t;&t; * several cliprects with a cmdbuf, as when&n;&t;&t;&t; * waving a 2D window over a 3D&n;&t;&t;&t; * window. Something in the commands from user&n;&t;&t;&t; * space seems to hang the card when they&squot;re&n;&t;&t;&t; * sent several times in a row. That would be&n;&t;&t;&t; * the correct place to fix it but this works&n;&t;&t;&t; * around it until I can figure that out - Tim&n;&t;&t;&t; * Smith */
r_if
c_cond
(paren
id|i
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|box
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
id|cmdsz
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|cmd
comma
id|cmdsz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|cmdbuf-&gt;nbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdbuf-&gt;nbox
op_eq
l_int|1
)paren
id|cmdbuf-&gt;nbox
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|cmdbuf-&gt;buf
op_add_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_wait
r_static
r_int
id|radeon_emit_wait
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flags
)paren
(brace
r_case
id|RADEON_WAIT_2D
suffix:colon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_WAIT_3D
suffix:colon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_WAIT_2D
op_or
id|RADEON_WAIT_3D
suffix:colon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_cmdbuf
r_int
id|radeon_cp_cmdbuf
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|drm_radeon_cmd_buffer_t
id|cmdbuf
suffix:semicolon
id|drm_radeon_cmd_header_t
id|header
suffix:semicolon
r_int
id|orig_nbox
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
comma
id|filp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|cmdbuf
comma
(paren
id|drm_radeon_cmd_buffer_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|cmdbuf
)paren
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DRM_VERIFYAREA_READ
c_func
(paren
id|cmdbuf.buf
comma
id|cmdbuf.bufsz
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdbuf.nbox
op_logical_and
id|DRM_VERIFYAREA_READ
c_func
(paren
id|cmdbuf.boxes
comma
id|cmdbuf.nbox
op_star
r_sizeof
(paren
id|drm_clip_rect_t
)paren
)paren
)paren
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|orig_nbox
op_assign
id|cmdbuf.nbox
suffix:semicolon
r_while
c_loop
(paren
id|cmdbuf.bufsz
op_ge
r_sizeof
(paren
id|header
)paren
)paren
(brace
r_if
c_cond
(paren
id|DRM_GET_USER_UNCHECKED
c_func
(paren
id|header.i
comma
(paren
r_int
id|__user
op_star
)paren
id|cmdbuf.buf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;__get_user %p&bslash;n&quot;
comma
id|cmdbuf.buf
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
id|cmdbuf.buf
op_add_assign
r_sizeof
(paren
id|header
)paren
suffix:semicolon
id|cmdbuf.bufsz
op_sub_assign
r_sizeof
(paren
id|header
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|header.header.cmd_type
)paren
(brace
r_case
id|RADEON_CMD_PACKET
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_PACKET&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_packets
c_func
(paren
id|dev_priv
comma
id|filp_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packets failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_SCALARS
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_SCALARS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_scalars
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_scalars failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_VECTORS
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_VECTORS&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_vectors
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_vectors failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_DMA_DISCARD
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_DMA_DISCARD&bslash;n&quot;
)paren
suffix:semicolon
id|idx
op_assign
id|header.dma.buf_idx
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
op_logical_or
id|idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;filp
op_ne
id|filp
op_logical_or
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad buffer %p %p %d&bslash;n&quot;
comma
id|buf-&gt;filp
comma
id|filp
comma
id|buf-&gt;pending
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_CMD_PACKET3
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_PACKET3&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_packet3
c_func
(paren
id|dev
comma
id|filp_priv
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packet3 failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_PACKET3_CLIP
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_PACKET3_CLIP&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_packet3_cliprect
c_func
(paren
id|dev
comma
id|filp_priv
comma
op_amp
id|cmdbuf
comma
id|orig_nbox
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packet3_clip failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_SCALARS2
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_SCALARS2&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_scalars2
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_scalars2 failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_WAIT
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;RADEON_CMD_WAIT&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|radeon_emit_wait
c_func
(paren
id|dev
comma
id|header.wait.flags
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_wait failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad cmd_type %d at %p&bslash;n&quot;
comma
id|header.header.cmd_type
comma
id|cmdbuf.buf
op_minus
r_sizeof
(paren
id|header
)paren
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;DONE&bslash;n&quot;
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_getparam
r_int
id|radeon_cp_getparam
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_getparam_t
id|param
suffix:semicolon
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|param
comma
(paren
id|drm_radeon_getparam_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|param
)paren
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;pid=%d&bslash;n&quot;
comma
id|DRM_CURRENTPID
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|param.param
)paren
(brace
r_case
id|RADEON_PARAM_GART_BUFFER_OFFSET
suffix:colon
id|value
op_assign
id|dev_priv-&gt;gart_buffers_offset
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_LAST_FRAME
suffix:colon
id|dev_priv-&gt;stats.last_frame_reads
op_increment
suffix:semicolon
id|value
op_assign
id|GET_SCRATCH
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_LAST_DISPATCH
suffix:colon
id|value
op_assign
id|GET_SCRATCH
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_LAST_CLEAR
suffix:colon
id|dev_priv-&gt;stats.last_clear_reads
op_increment
suffix:semicolon
id|value
op_assign
id|GET_SCRATCH
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_IRQ_NR
suffix:colon
id|value
op_assign
id|dev-&gt;irq
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_GART_BASE
suffix:colon
id|value
op_assign
id|dev_priv-&gt;gart_vm_start
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_REGISTER_HANDLE
suffix:colon
id|value
op_assign
id|dev_priv-&gt;mmio_offset
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_PARAM_STATUS_HANDLE
suffix:colon
id|value
op_assign
id|dev_priv-&gt;ring_rptr_offset
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if BITS_PER_LONG == 32
multiline_comment|/*&n;&t; * This ioctl() doesn&squot;t work on 64-bit platforms because hw_lock is a&n;&t; * pointer which can&squot;t fit into an int-sized variable.  According to&n;&t; * Michel D&#xfffd;nzer, the ioctl() is only used on embedded platforms, so&n;&t; * not supporting it shouldn&squot;t be a problem.  If the same functionality&n;&t; * is needed on 64-bit platforms, a new ioctl() would have to be added,&n;&t; * so backwards-compatibility for the embedded platforms can be&n;&t; * maintained.  --davidm 4-Feb-2004.&n;&t; */
r_case
id|RADEON_PARAM_SAREA_HANDLE
suffix:colon
multiline_comment|/* The lock is the first dword in the sarea. */
id|value
op_assign
(paren
r_int
)paren
id|dev-&gt;lock.hw_lock
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|RADEON_PARAM_GART_TEX_HANDLE
suffix:colon
id|value
op_assign
id|dev_priv-&gt;gart_textures_offset
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DRM_COPY_TO_USER
c_func
(paren
id|param.value
comma
op_amp
id|value
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;copy_to_user&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_setparam
r_int
id|radeon_cp_setparam
c_func
(paren
id|DRM_IOCTL_ARGS
)paren
(brace
id|DRM_DEVICE
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_file_t
op_star
id|filp_priv
suffix:semicolon
id|drm_radeon_setparam_t
id|sp
suffix:semicolon
r_struct
id|drm_radeon_driver_file_fields
op_star
id|radeon_priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|DRM_GET_PRIV_WITH_RETURN
c_func
(paren
id|filp_priv
comma
id|filp
)paren
suffix:semicolon
id|DRM_COPY_FROM_USER_IOCTL
c_func
(paren
id|sp
comma
(paren
id|drm_radeon_setparam_t
id|__user
op_star
)paren
id|data
comma
r_sizeof
(paren
id|sp
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sp.param
)paren
(brace
r_case
id|RADEON_SETPARAM_FB_LOCATION
suffix:colon
id|radeon_priv
op_assign
id|filp_priv-&gt;driver_priv
suffix:semicolon
id|radeon_priv-&gt;radeon_fb_delta
op_assign
id|dev_priv-&gt;fb_location
op_minus
id|sp.value
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;Invalid parameter %d&bslash;n&quot;
comma
id|sp.param
)paren
suffix:semicolon
r_return
id|DRM_ERR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* When a client dies:&n; *    - Check for and clean up flipped page state&n; *    - Free any alloced GART memory.&n; *&n; * DRM infrastructure takes care of reclaiming dma buffers.&n; */
DECL|function|radeon_driver_prerelease
r_void
id|radeon_driver_prerelease
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|DRMFILE
id|filp
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;dev_private
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;page_flipping
)paren
(brace
id|radeon_do_cleanup_pageflip
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|radeon_mem_release
c_func
(paren
id|filp
comma
id|dev_priv-&gt;gart_heap
)paren
suffix:semicolon
id|radeon_mem_release
c_func
(paren
id|filp
comma
id|dev_priv-&gt;fb_heap
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeon_driver_pretakedown
r_void
id|radeon_driver_pretakedown
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|radeon_do_release
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|radeon_driver_open_helper
r_int
id|radeon_driver_open_helper
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_file_t
op_star
id|filp_priv
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_struct
id|drm_radeon_driver_file_fields
op_star
id|radeon_priv
suffix:semicolon
id|radeon_priv
op_assign
(paren
r_struct
id|drm_radeon_driver_file_fields
op_star
)paren
id|drm_alloc
c_func
(paren
r_sizeof
(paren
op_star
id|radeon_priv
)paren
comma
id|DRM_MEM_FILES
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|radeon_priv
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|filp_priv-&gt;driver_priv
op_assign
id|radeon_priv
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv
)paren
id|radeon_priv-&gt;radeon_fb_delta
op_assign
id|dev_priv-&gt;fb_location
suffix:semicolon
r_else
id|radeon_priv-&gt;radeon_fb_delta
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_driver_free_filp_priv
r_void
id|radeon_driver_free_filp_priv
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_file_t
op_star
id|filp_priv
)paren
(brace
r_struct
id|drm_radeon_driver_file_fields
op_star
id|radeon_priv
op_assign
id|filp_priv-&gt;driver_priv
suffix:semicolon
id|drm_free
c_func
(paren
id|radeon_priv
comma
r_sizeof
(paren
op_star
id|radeon_priv
)paren
comma
id|DRM_MEM_FILES
)paren
suffix:semicolon
)brace
eof
