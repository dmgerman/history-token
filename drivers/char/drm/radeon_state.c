multiline_comment|/* radeon_state.c -- State support for Radeon -*- linux-c -*-&n; *&n; * Copyright 2000 VA Linux Systems, Inc., Fremont, California.&n; * All Rights Reserved.&n; *&n; * Permission is hereby granted, free of charge, to any person obtaining a&n; * copy of this software and associated documentation files (the &quot;Software&quot;),&n; * to deal in the Software without restriction, including without limitation&n; * the rights to use, copy, modify, merge, publish, distribute, sublicense,&n; * and/or sell copies of the Software, and to permit persons to whom the&n; * Software is furnished to do so, subject to the following conditions:&n; *&n; * The above copyright notice and this permission notice (including the next&n; * paragraph) shall be included in all copies or substantial portions of the&n; * Software.&n; *&n; * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&n; * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n; * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL&n; * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR&n; * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,&n; * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER&n; * DEALINGS IN THE SOFTWARE.&n; *&n; * Authors:&n; *    Gareth Hughes &lt;gareth@valinux.com&gt;&n; *    Kevin E. Martin &lt;martin@valinux.com&gt;&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &quot;radeon.h&quot;
macro_line|#include &quot;drmP.h&quot;
macro_line|#include &quot;drm.h&quot;
macro_line|#include &quot;radeon_drm.h&quot;
macro_line|#include &quot;radeon_drv.h&quot;
macro_line|#include &lt;linux/delay.h&gt;
multiline_comment|/* ================================================================&n; * CP hardware state programming functions&n; */
DECL|function|radeon_emit_clip_rect
r_static
r_inline
r_void
id|radeon_emit_clip_rect
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_clip_rect_t
op_star
id|box
)paren
(brace
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   box:  x1=%d y1=%d  x2=%d y2=%d&bslash;n&quot;
comma
id|box-&gt;x1
comma
id|box-&gt;y1
comma
id|box-&gt;x2
comma
id|box-&gt;y2
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_SET_SCISSORS
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|box-&gt;y1
op_lshift
l_int|16
)paren
op_or
id|box-&gt;x1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
(paren
id|box-&gt;y2
op_minus
l_int|1
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|box-&gt;x2
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Emit 1.1 state&n; */
DECL|function|radeon_emit_state
r_static
r_void
id|radeon_emit_state
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_context_regs_t
op_star
id|ctx
comma
id|drm_radeon_texture_regs_t
op_star
id|tex
comma
r_int
r_int
id|dirty
)paren
(brace
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: dirty=0x%08x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dirty
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_CONTEXT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|14
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_MISC
comma
l_int|6
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_misc
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_fog_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_solid_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_blendcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_depthpitch
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_coloroffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_COLORPITCH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_colorpitch
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VERTFMT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_COORD_FMT
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_coord_fmt
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_LINE
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_LINE_PATTERN
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_pattern
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_line_state
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_LINE_WIDTH
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_line_width
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_BUMPMAP
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_LUM_MATRIX
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_lum_matrix
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_ROT_MATRIX_0
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;pp_rot_matrix_1
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MASKS
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
l_int|2
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_stencilrefmask
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_ropcntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;rb3d_planemask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_VIEWPORT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_VPORT_XSCALE
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_xoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_yoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zscale
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_vport_zoffset
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_SETUP
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_CNTL_STATUS
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;se_cntl_status
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_MISC
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_MISC
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|ctx-&gt;re_misc
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX0
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_0
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_0
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|0
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX1
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_1
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_1
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|1
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dirty
op_amp
id|RADEON_UPLOAD_TEX2
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_TXFILTER_2
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txfilter
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txformat
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txoffset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txcblend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_txablend
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_tfactor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_BORDER_COLOR_2
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|tex
(braket
l_int|2
)braket
dot
id|pp_border_color
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Emit 1.2 state&n; */
DECL|function|radeon_emit_state2
r_static
r_void
id|radeon_emit_state2
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_state_t
op_star
id|state
)paren
(brace
id|RING_LOCALS
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;dirty
op_amp
id|RADEON_UPLOAD_ZBIAS
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_ZBIAS_FACTOR
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|state-&gt;context2.se_zbias_factor
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|state-&gt;context2.se_zbias_constant
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
op_amp
id|state-&gt;context
comma
id|state-&gt;tex
comma
id|state-&gt;dirty
)paren
suffix:semicolon
)brace
multiline_comment|/* New (1.3) state mechanism.  3 commands (packet, scalar, vector) in&n; * 1.3 cmdbuffers allow all previous state to be updated as well as&n; * the tcl scalar and vector areas.  &n; */
r_static
r_struct
(brace
DECL|member|start
r_int
id|start
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|variable|packet
)brace
id|packet
(braket
id|RADEON_MAX_STATE_PACKETS
)braket
op_assign
(brace
(brace
id|RADEON_PP_MISC
comma
l_int|7
comma
l_string|&quot;RADEON_PP_MISC&quot;
)brace
comma
(brace
id|RADEON_PP_CNTL
comma
l_int|3
comma
l_string|&quot;RADEON_PP_CNTL&quot;
)brace
comma
(brace
id|RADEON_RB3D_COLORPITCH
comma
l_int|1
comma
l_string|&quot;RADEON_RB3D_COLORPITCH&quot;
)brace
comma
(brace
id|RADEON_RE_LINE_PATTERN
comma
l_int|2
comma
l_string|&quot;RADEON_RE_LINE_PATTERN&quot;
)brace
comma
(brace
id|RADEON_SE_LINE_WIDTH
comma
l_int|1
comma
l_string|&quot;RADEON_SE_LINE_WIDTH&quot;
)brace
comma
(brace
id|RADEON_PP_LUM_MATRIX
comma
l_int|1
comma
l_string|&quot;RADEON_PP_LUM_MATRIX&quot;
)brace
comma
(brace
id|RADEON_PP_ROT_MATRIX_0
comma
l_int|2
comma
l_string|&quot;RADEON_PP_ROT_MATRIX_0&quot;
)brace
comma
(brace
id|RADEON_RB3D_STENCILREFMASK
comma
l_int|3
comma
l_string|&quot;RADEON_RB3D_STENCILREFMASK&quot;
)brace
comma
(brace
id|RADEON_SE_VPORT_XSCALE
comma
l_int|6
comma
l_string|&quot;RADEON_SE_VPORT_XSCALE&quot;
)brace
comma
(brace
id|RADEON_SE_CNTL
comma
l_int|2
comma
l_string|&quot;RADEON_SE_CNTL&quot;
)brace
comma
(brace
id|RADEON_SE_CNTL_STATUS
comma
l_int|1
comma
l_string|&quot;RADEON_SE_CNTL_STATUS&quot;
)brace
comma
(brace
id|RADEON_RE_MISC
comma
l_int|1
comma
l_string|&quot;RADEON_RE_MISC&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_0
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_0&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_0
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_0&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_1
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_1&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_1
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_1&quot;
)brace
comma
(brace
id|RADEON_PP_TXFILTER_2
comma
l_int|6
comma
l_string|&quot;RADEON_PP_TXFILTER_2&quot;
)brace
comma
(brace
id|RADEON_PP_BORDER_COLOR_2
comma
l_int|1
comma
l_string|&quot;RADEON_PP_BORDER_COLOR_2&quot;
)brace
comma
(brace
id|RADEON_SE_ZBIAS_FACTOR
comma
l_int|2
comma
l_string|&quot;RADEON_SE_ZBIAS_FACTOR&quot;
)brace
comma
(brace
id|RADEON_SE_TCL_OUTPUT_VTX_FMT
comma
l_int|11
comma
l_string|&quot;RADEON_SE_TCL_OUTPUT_VTX_FMT&quot;
)brace
comma
(brace
id|RADEON_SE_TCL_MATERIAL_EMMISSIVE_RED
comma
l_int|17
comma
l_string|&quot;RADEON_SE_TCL_MATERIAL_EMMISSIVE_RED&quot;
)brace
comma
)brace
suffix:semicolon
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* ================================================================&n; * Performance monitoring functions&n; */
DECL|function|radeon_clear_box
r_static
r_void
id|radeon_clear_box
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|w
comma
r_int
id|h
comma
r_int
id|r
comma
r_int
id|g
comma
r_int
id|b
)paren
(brace
id|u32
id|pitch
comma
id|offset
suffix:semicolon
id|u32
id|color
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
r_switch
c_cond
(paren
id|dev_priv-&gt;color_fmt
)paren
(brace
r_case
id|RADEON_COLOR_FORMAT_RGB565
suffix:colon
id|color
op_assign
(paren
(paren
(paren
id|r
op_amp
l_int|0xf8
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|g
op_amp
l_int|0xfc
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|b
op_amp
l_int|0xf8
)paren
op_rshift
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:colon
r_default
suffix:colon
id|color
op_assign
(paren
(paren
(paren
l_int|0xff
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|r
op_lshift
l_int|16
)paren
op_or
(paren
id|g
op_lshift
l_int|8
)paren
op_or
id|b
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|offset
op_assign
id|dev_priv-&gt;back_offset
suffix:semicolon
id|pitch
op_assign
id|dev_priv-&gt;back_pitch
op_rshift
l_int|3
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|pitch
op_lshift
l_int|22
)paren
op_or
(paren
id|offset
op_rshift
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_performance_boxes
r_static
r_void
id|radeon_cp_performance_boxes
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|dev_priv-&gt;idle_count
)paren
op_eq
l_int|0
)paren
(brace
id|radeon_clear_box
c_func
(paren
id|dev_priv
comma
l_int|64
comma
l_int|4
comma
l_int|8
comma
l_int|8
comma
l_int|0
comma
l_int|255
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|atomic_set
c_func
(paren
op_amp
id|dev_priv-&gt;idle_count
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* ================================================================&n; * CP command dispatch functions&n; */
DECL|function|radeon_cp_dispatch_clear
r_static
r_void
id|radeon_cp_dispatch_clear
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_clear_t
op_star
id|clear
comma
id|drm_radeon_clear_rect_t
op_star
id|depth_boxes
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_depth_clear_t
op_star
id|depth_clear
op_assign
op_amp
id|dev_priv-&gt;depth_clear
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|clear-&gt;flags
suffix:semicolon
id|u32
id|rb3d_cntl
op_assign
l_int|0
comma
id|rb3d_stencilrefmask
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;: flags = 0x%x&bslash;n&quot;
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;page_flipping
op_logical_and
id|dev_priv-&gt;current_page
op_eq
l_int|1
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|flags
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_FRONT
)paren
id|flags
op_or_assign
id|RADEON_BACK
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|RADEON_BACK
)paren
id|flags
op_or_assign
id|RADEON_FRONT
suffix:semicolon
)brace
multiline_comment|/* We have to clear the depth and/or stencil buffers by&n;&t; * rendering a quad into just those buffers.  Thus, we have to&n;&t; * make sure the 3D engine is configured correctly.&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RADEON_DEPTH
op_or
id|RADEON_STENCIL
)paren
)paren
(brace
id|rb3d_cntl
op_assign
id|depth_clear-&gt;rb3d_cntl
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_DEPTH
)paren
(brace
id|rb3d_cntl
op_or_assign
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
r_else
(brace
id|rb3d_cntl
op_and_assign
op_complement
id|RADEON_Z_ENABLE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_STENCIL
)paren
(brace
id|rb3d_cntl
op_or_assign
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|rb3d_stencilrefmask
op_assign
id|clear-&gt;depth_mask
suffix:semicolon
multiline_comment|/* misnamed field */
)brace
r_else
(brace
id|rb3d_cntl
op_and_assign
op_complement
id|RADEON_STENCIL_ENABLE
suffix:semicolon
id|rb3d_stencilrefmask
op_assign
l_int|0x00000000
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch clear %d,%d-%d,%d flags 0x%x&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RADEON_FRONT
op_or
id|RADEON_BACK
)paren
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Ensure the 3D stream is idle before doing a&n;&t;&t;&t; * 2D fill to clear the front or back buffer.&n;&t;&t;&t; */
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_DP_WRITE_MASK
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;color_mask
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_FRONT
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RADEON_BACK
)paren
(brace
id|BEGIN_RING
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_PAINT_MULTI
comma
l_int|4
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_SOLID_COLOR
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_P
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|clear-&gt;clear_color
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RADEON_DEPTH
op_or
id|RADEON_STENCIL
)paren
)paren
(brace
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;boxes
(braket
id|i
)braket
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|28
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_PP_CNTL
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|rb3d_cntl
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_ZSTENCILCNTL
comma
id|depth_clear-&gt;rb3d_zstencilcntl
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_STENCILREFMASK
comma
id|rb3d_stencilrefmask
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RB3D_PLANEMASK
comma
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_SE_CNTL
comma
id|depth_clear-&gt;se_cntl
)paren
suffix:semicolon
multiline_comment|/* Radeon 7500 doesn&squot;t like vertices without&n;&t;&t;&t; * color.&n;&t;&t;&t; */
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_DRAW_IMMD
comma
l_int|13
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_VTX_Z_PRESENT
op_or
id|RADEON_VTX_PKCOLOR_PRESENT
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|RADEON_PRIM_TYPE_RECT_LIST
op_or
id|RADEON_PRIM_WALK_RING
op_or
id|RADEON_MAOS_ENABLE
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
l_int|3
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X1
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_X2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_Y2
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|depth_boxes
(braket
id|i
)braket
dot
id|ui
(braket
id|CLEAR_DEPTH
)braket
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we restore the 3D state next time.&n;&t;&t;&t; */
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Increment the clear counter.  The client-side 3D driver must&n;&t; * wait on this value before performing the clear ioctl.  We&n;&t; * need this because the card&squot;s so damned fast...&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_clear
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_CLEAR_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_clear
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_swap
r_static
r_void
id|radeon_cp_dispatch_swap
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
r_int
id|nbox
op_assign
id|sarea_priv-&gt;nbox
suffix:semicolon
id|drm_clip_rect_t
op_star
id|pbox
op_assign
id|sarea_priv-&gt;boxes
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Wait for the 3D stream to idle before dispatching the bitblt.&n;&t; * This will prevent data corruption between the two streams.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbox
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|x
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x1
suffix:semicolon
r_int
id|y
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y1
suffix:semicolon
r_int
id|w
op_assign
id|pbox
(braket
id|i
)braket
dot
id|x2
op_minus
id|x
suffix:semicolon
r_int
id|h
op_assign
id|pbox
(braket
id|i
)braket
dot
id|y2
op_minus
id|y
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;dispatch swap %d,%d-%d,%d&bslash;n&quot;
comma
id|x
comma
id|y
comma
id|w
comma
id|h
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_BITBLT_MULTI
comma
l_int|5
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|RADEON_GMC_SRC_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|dev_priv-&gt;color_fmt
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_MEMORY
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
multiline_comment|/* Make this work even if front &amp; back are flipped:&n;&t;&t; */
r_if
c_cond
(paren
id|dev_priv-&gt;current_page
op_eq
l_int|0
)paren
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
)brace
r_else
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_pitch_offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_pitch_offset
)paren
suffix:semicolon
)brace
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|x
op_lshift
l_int|16
)paren
op_or
id|y
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
(paren
id|w
op_lshift
l_int|16
)paren
op_or
id|h
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_flip
r_static
r_void
id|radeon_cp_dispatch_flip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: page=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dev_priv-&gt;current_page
)paren
suffix:semicolon
macro_line|#if RADEON_PERFORMANCE_BOXES
multiline_comment|/* Do some trivial performance monitoring...&n;&t; */
id|radeon_cp_performance_boxes
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
macro_line|#endif
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;RADEON_WAIT_UNTIL_PAGE_FLIPPED();&n;*/
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CRTC_OFFSET
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_priv-&gt;current_page
op_eq
l_int|0
)paren
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;back_offset
)paren
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|OUT_RING
c_func
(paren
id|dev_priv-&gt;front_offset
)paren
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|0
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Increment the frame counter.  The client-side 3D driver must&n;&t; * throttle the framerate by waiting for this value before&n;&t; * performing the swapbuffer ioctl.&n;&t; */
id|dev_priv-&gt;sarea_priv-&gt;last_frame
op_increment
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
op_assign
id|dev_priv-&gt;current_page
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_FRAME_AGE
c_func
(paren
id|dev_priv-&gt;sarea_priv-&gt;last_frame
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|bad_prim_vertex_nr
r_static
r_int
id|bad_prim_vertex_nr
c_func
(paren
r_int
id|primitive
comma
r_int
id|nr
)paren
(brace
r_switch
c_cond
(paren
id|primitive
op_amp
id|RADEON_PRIM_TYPE_MASK
)paren
(brace
r_case
id|RADEON_PRIM_TYPE_NONE
suffix:colon
r_case
id|RADEON_PRIM_TYPE_POINT
suffix:colon
r_return
id|nr
OL
l_int|1
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_LINE
suffix:colon
r_return
(paren
id|nr
op_amp
l_int|1
)paren
op_logical_or
id|nr
op_eq
l_int|0
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_LINE_STRIP
suffix:colon
r_return
id|nr
OL
l_int|2
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_TRI_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_3VRT_POINT_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
suffix:colon
r_case
id|RADEON_PRIM_TYPE_RECT_LIST
suffix:colon
r_return
id|nr
op_mod
l_int|3
op_logical_or
id|nr
op_eq
l_int|0
suffix:semicolon
r_case
id|RADEON_PRIM_TYPE_TRI_FAN
suffix:colon
r_case
id|RADEON_PRIM_TYPE_TRI_STRIP
suffix:colon
r_return
id|nr
OL
l_int|3
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_typedef
r_struct
(brace
DECL|member|start
r_int
r_int
id|start
suffix:semicolon
DECL|member|finish
r_int
r_int
id|finish
suffix:semicolon
DECL|member|prim
r_int
r_int
id|prim
suffix:semicolon
DECL|member|numverts
r_int
r_int
id|numverts
suffix:semicolon
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
DECL|member|vc_format
r_int
r_int
id|vc_format
suffix:semicolon
DECL|typedef|drm_radeon_tcl_prim_t
)brace
id|drm_radeon_tcl_prim_t
suffix:semicolon
DECL|function|radeon_cp_dispatch_vertex
r_static
r_void
id|radeon_cp_dispatch_vertex
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
id|drm_radeon_tcl_prim_t
op_star
id|prim
comma
id|drm_clip_rect_t
op_star
id|boxes
comma
r_int
id|nbox
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_clip_rect_t
id|box
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;agp_buffers_offset
op_plus
id|buf-&gt;offset
op_plus
id|prim-&gt;start
suffix:semicolon
r_int
id|numverts
op_assign
(paren
r_int
)paren
id|prim-&gt;numverts
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: hwprim 0x%x vfmt 0x%x %d..%d %d verts&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|prim-&gt;prim
comma
id|prim-&gt;vc_format
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bad_prim_vertex_nr
c_func
(paren
id|prim-&gt;prim
comma
id|prim-&gt;numverts
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad prim %x numverts %d&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
multiline_comment|/* Emit the next cliprect */
r_if
c_cond
(paren
id|i
OL
id|nbox
)paren
(brace
r_if
c_cond
(paren
id|__copy_from_user
c_func
(paren
op_amp
id|box
comma
op_amp
id|boxes
(braket
id|i
)braket
comma
r_sizeof
(paren
id|box
)paren
)paren
)paren
r_return
suffix:semicolon
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|box
)paren
suffix:semicolon
)brace
multiline_comment|/* Emit the vertex buffer rendering commands */
id|BEGIN_RING
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
l_int|3
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|numverts
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|prim-&gt;vc_format
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|prim-&gt;prim
op_or
id|RADEON_PRIM_WALK_LIST
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|numverts
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|nbox
)paren
suffix:semicolon
)brace
DECL|function|radeon_cp_discard_buffer
r_static
r_void
id|radeon_cp_discard_buffer
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_buf_priv_t
op_star
id|buf_priv
op_assign
id|buf-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|buf_priv-&gt;age
op_assign
op_increment
id|dev_priv-&gt;sarea_priv-&gt;last_dispatch
suffix:semicolon
multiline_comment|/* Emit the vertex buffer age */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_DISPATCH_AGE
c_func
(paren
id|buf_priv-&gt;age
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|buf-&gt;pending
op_assign
l_int|1
suffix:semicolon
id|buf-&gt;used
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_indirect
r_static
r_void
id|radeon_cp_dispatch_indirect
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|buf
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: buf=%d s=0x%x e=0x%x&bslash;n&quot;
comma
id|buf-&gt;idx
comma
id|start
comma
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ne
id|end
)paren
(brace
r_int
id|offset
op_assign
(paren
id|dev_priv-&gt;agp_buffers_offset
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
r_int
id|dwords
op_assign
(paren
id|end
op_minus
id|start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* Indirect buffer data must be an even number of&n;&t;&t; * dwords, so if we&squot;ve been given an odd number we must&n;&t;&t; * pad the data with a Type-2 CP packet.&n;&t;&t; */
r_if
c_cond
(paren
id|dwords
op_amp
l_int|1
)paren
(brace
id|u32
op_star
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|buf-&gt;offset
op_plus
id|start
)paren
suffix:semicolon
id|data
(braket
id|dwords
op_increment
)braket
op_assign
id|RADEON_CP_PACKET2
suffix:semicolon
)brace
multiline_comment|/* Fire off the indirect buffer */
id|BEGIN_RING
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_CP_IB_BASE
comma
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|offset
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|dwords
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|radeon_cp_dispatch_indices
r_static
r_void
id|radeon_cp_dispatch_indices
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_buf_t
op_star
id|elt_buf
comma
id|drm_radeon_tcl_prim_t
op_star
id|prim
comma
id|drm_clip_rect_t
op_star
id|boxes
comma
r_int
id|nbox
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_clip_rect_t
id|box
suffix:semicolon
r_int
id|offset
op_assign
id|dev_priv-&gt;agp_buffers_offset
op_plus
id|prim-&gt;offset
suffix:semicolon
id|u32
op_star
id|data
suffix:semicolon
r_int
id|dwords
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|start
op_assign
id|prim-&gt;start
op_plus
id|RADEON_INDEX_PRIM_OFFSET
suffix:semicolon
r_int
id|count
op_assign
(paren
id|prim-&gt;finish
op_minus
id|start
)paren
op_div
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: hwprim 0x%x vfmt 0x%x %d..%d offset: %x nr %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|prim-&gt;prim
comma
id|prim-&gt;vc_format
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
comma
id|prim-&gt;offset
comma
id|prim-&gt;numverts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bad_prim_vertex_nr
c_func
(paren
id|prim-&gt;prim
comma
id|count
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad prim %x count %d&bslash;n&quot;
comma
id|prim-&gt;prim
comma
id|count
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_ge
id|prim-&gt;finish
op_logical_or
(paren
id|prim-&gt;start
op_amp
l_int|0x7
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|prim-&gt;prim
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dwords
op_assign
(paren
id|prim-&gt;finish
op_minus
id|prim-&gt;start
op_plus
l_int|3
)paren
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|data
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|elt_buf-&gt;offset
op_plus
id|prim-&gt;start
)paren
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_3D_RNDR_GEN_INDX_PRIM
comma
id|dwords
op_minus
l_int|2
)paren
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|offset
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|prim-&gt;numverts
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|prim-&gt;vc_format
suffix:semicolon
id|data
(braket
l_int|4
)braket
op_assign
(paren
id|prim-&gt;prim
op_or
id|RADEON_PRIM_WALK_IND
op_or
id|RADEON_COLOR_ORDER_RGBA
op_or
id|RADEON_VTX_FMT_RADEON_MODE
op_or
(paren
id|count
op_lshift
id|RADEON_NUM_VERTICES_SHIFT
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|nbox
)paren
(brace
r_if
c_cond
(paren
id|__copy_from_user
c_func
(paren
op_amp
id|box
comma
op_amp
id|boxes
(braket
id|i
)braket
comma
r_sizeof
(paren
id|box
)paren
)paren
)paren
r_return
suffix:semicolon
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|box
)paren
suffix:semicolon
)brace
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|elt_buf
comma
id|prim-&gt;start
comma
id|prim-&gt;finish
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|nbox
)paren
suffix:semicolon
)brace
DECL|macro|RADEON_MAX_TEXTURE_SIZE
mdefine_line|#define RADEON_MAX_TEXTURE_SIZE (RADEON_BUFFER_SIZE - 8 * sizeof(u32))
DECL|function|radeon_cp_dispatch_texture
r_static
r_int
id|radeon_cp_dispatch_texture
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_texture_t
op_star
id|tex
comma
id|drm_radeon_tex_image_t
op_star
id|image
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|u32
id|format
suffix:semicolon
id|u32
op_star
id|buffer
suffix:semicolon
id|u8
op_star
id|data
suffix:semicolon
r_int
id|size
comma
id|dwords
comma
id|tex_width
comma
id|blit_width
suffix:semicolon
id|u32
id|y
comma
id|height
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
multiline_comment|/* FIXME: Be smarter about this...&n;&t; */
id|buf
op_assign
id|radeon_freelist_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;tex: ofs=0x%x p=%d f=%d x=%hd y=%hd w=%hd h=%hd&bslash;n&quot;
comma
id|tex-&gt;offset
op_rshift
l_int|10
comma
id|tex-&gt;pitch
comma
id|tex-&gt;format
comma
id|image-&gt;x
comma
id|image-&gt;y
comma
id|image-&gt;width
comma
id|image-&gt;height
)paren
suffix:semicolon
multiline_comment|/* The compiler won&squot;t optimize away a division by a variable,&n;&t; * even if the only legal values are powers of two.  Thus, we&squot;ll&n;&t; * use a shift instead.&n;&t; */
r_switch
c_cond
(paren
id|tex-&gt;format
)paren
(brace
r_case
id|RADEON_TXFORMAT_ARGB8888
suffix:colon
r_case
id|RADEON_TXFORMAT_RGBA8888
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_ARGB8888
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|4
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXFORMAT_AI88
suffix:colon
r_case
id|RADEON_TXFORMAT_ARGB1555
suffix:colon
r_case
id|RADEON_TXFORMAT_RGB565
suffix:colon
r_case
id|RADEON_TXFORMAT_ARGB4444
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_RGB565
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|2
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_TXFORMAT_I8
suffix:colon
r_case
id|RADEON_TXFORMAT_RGB332
suffix:colon
id|format
op_assign
id|RADEON_COLOR_FORMAT_CI8
suffix:semicolon
id|tex_width
op_assign
id|tex-&gt;width
op_star
l_int|1
suffix:semicolon
id|blit_width
op_assign
id|image-&gt;width
op_star
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;invalid texture format %d&bslash;n&quot;
comma
id|tex-&gt;format
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
l_string|&quot;   tex=%dx%d  blit=%d&bslash;n&quot;
comma
id|tex_width
comma
id|tex-&gt;height
comma
id|blit_width
)paren
suffix:semicolon
multiline_comment|/* Flush the pixel cache.  This ensures no pixel data gets mixed&n;&t; * up with the texture data from the host data blit, otherwise&n;&t; * part of the texture image may be corrupted.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
multiline_comment|/* The Mesa texture functions provide the data in little endian as the&n;&t; * chip wants it, but we need to compensate for the fact that the CP&n;&t; * ring gets byte-swapped&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|OUT_RING_REG
c_func
(paren
id|RADEON_RBBM_GUICNTL
comma
id|RADEON_HOST_DATA_SWAP_32BIT
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Make a copy of the parameters in case we have to update them&n;&t; * for a multi-pass texture blit.&n;&t; */
id|y
op_assign
id|image-&gt;y
suffix:semicolon
id|height
op_assign
id|image-&gt;height
suffix:semicolon
id|data
op_assign
(paren
id|u8
op_star
)paren
id|image-&gt;data
suffix:semicolon
id|size
op_assign
id|height
op_star
id|blit_width
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|RADEON_MAX_TEXTURE_SIZE
)paren
(brace
multiline_comment|/* Texture image is too large, do a multipass upload */
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
multiline_comment|/* Adjust the blit size to fit the indirect buffer */
id|height
op_assign
id|RADEON_MAX_TEXTURE_SIZE
op_div
id|blit_width
suffix:semicolon
id|size
op_assign
id|height
op_star
id|blit_width
suffix:semicolon
multiline_comment|/* Update the input parameters for next time */
id|image-&gt;y
op_add_assign
id|height
suffix:semicolon
id|image-&gt;height
op_sub_assign
id|height
suffix:semicolon
id|image-&gt;data
op_assign
(paren
r_char
op_star
)paren
id|image-&gt;data
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|tex-&gt;image
comma
id|image
comma
r_sizeof
(paren
op_star
id|image
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;EFAULT on tex-&gt;image&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|size
template_param
l_int|0
)paren
(brace
id|size
op_assign
l_int|4
suffix:semicolon
)brace
id|dwords
op_assign
id|size
op_div
l_int|4
suffix:semicolon
multiline_comment|/* Dispatch the indirect buffer.&n;&t; */
id|buffer
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|dev_priv-&gt;buffers-&gt;handle
op_plus
id|buf-&gt;offset
)paren
suffix:semicolon
id|buffer
(braket
l_int|0
)braket
op_assign
id|CP_PACKET3
c_func
(paren
id|RADEON_CNTL_HOSTDATA_BLT
comma
id|dwords
op_plus
l_int|6
)paren
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
(paren
id|RADEON_GMC_DST_PITCH_OFFSET_CNTL
op_or
id|RADEON_GMC_BRUSH_NONE
op_or
(paren
id|format
op_lshift
l_int|8
)paren
op_or
id|RADEON_GMC_SRC_DATATYPE_COLOR
op_or
id|RADEON_ROP3_S
op_or
id|RADEON_DP_SRC_SOURCE_HOST_DATA
op_or
id|RADEON_GMC_CLR_CMP_CNTL_DIS
op_or
id|RADEON_GMC_WR_MSK_DIS
)paren
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
(paren
id|tex-&gt;pitch
op_lshift
l_int|22
)paren
op_or
(paren
id|tex-&gt;offset
op_rshift
l_int|10
)paren
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|buffer
(braket
l_int|4
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|buffer
(braket
l_int|5
)braket
op_assign
(paren
id|y
op_lshift
l_int|16
)paren
op_or
id|image-&gt;x
suffix:semicolon
id|buffer
(braket
l_int|6
)braket
op_assign
(paren
id|height
op_lshift
l_int|16
)paren
op_or
id|image-&gt;width
suffix:semicolon
id|buffer
(braket
l_int|7
)braket
op_assign
id|dwords
suffix:semicolon
id|buffer
op_add_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|tex_width
op_ge
l_int|32
)paren
(brace
multiline_comment|/* Texture image width is larger than the minimum, so we&n;&t;&t; * can upload it directly.&n;&t;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buffer
comma
id|data
comma
id|dwords
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;EFAULT on data, %d dwords&bslash;n&quot;
comma
id|dwords
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Texture image width is less than the minimum, so we&n;&t;&t; * need to pad out each image scanline to the minimum&n;&t;&t; * width.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tex-&gt;height
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buffer
comma
id|data
comma
id|tex_width
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;EFAULT on pad, %d bytes&bslash;n&quot;
comma
id|tex_width
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|buffer
op_add_assign
l_int|8
suffix:semicolon
id|data
op_add_assign
id|tex_width
suffix:semicolon
)brace
)brace
id|buf-&gt;pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|buf-&gt;used
op_assign
(paren
id|dwords
op_plus
l_int|8
)paren
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
l_int|0
comma
id|buf-&gt;used
)paren
suffix:semicolon
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
multiline_comment|/* Flush the pixel cache after the blit completes.  This ensures&n;&t; * the texture data is written out to memory before rendering&n;&t; * continues.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|RADEON_FLUSH_CACHE
c_func
(paren
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_2D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|radeon_cp_dispatch_stipple
r_static
r_void
id|radeon_cp_dispatch_stipple
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|u32
op_star
id|stipple
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|35
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_RE_STIPPLE_ADDR
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
l_int|0x00000000
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_RE_STIPPLE_DATA
comma
l_int|31
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OUT_RING
c_func
(paren
id|stipple
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================&n; * IOCTL functions&n; */
DECL|function|radeon_cp_clear
r_int
id|radeon_cp_clear
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_radeon_clear_t
id|clear
suffix:semicolon
id|drm_radeon_clear_rect_t
id|depth_boxes
(braket
id|RADEON_NR_SAREA_CLIPRECTS
)braket
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|clear
comma
(paren
id|drm_radeon_clear_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|clear
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|depth_boxes
comma
id|clear.depth_boxes
comma
id|sarea_priv-&gt;nbox
op_star
r_sizeof
(paren
id|depth_boxes
(braket
l_int|0
)braket
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|radeon_cp_dispatch_clear
c_func
(paren
id|dev
comma
op_amp
id|clear
comma
id|depth_boxes
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Not sure why this isn&squot;t set all the time:&n; */
DECL|function|radeon_do_init_pageflip
r_static
r_int
id|radeon_do_init_pageflip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dev_priv-&gt;crtc_offset
op_assign
id|RADEON_READ
c_func
(paren
id|RADEON_CRTC_OFFSET
)paren
suffix:semicolon
id|dev_priv-&gt;crtc_offset_cntl
op_assign
id|RADEON_READ
c_func
(paren
id|RADEON_CRTC_OFFSET_CNTL
)paren
suffix:semicolon
id|RADEON_WRITE
c_func
(paren
id|RADEON_CRTC_OFFSET
comma
id|dev_priv-&gt;front_offset
)paren
suffix:semicolon
id|RADEON_WRITE
c_func
(paren
id|RADEON_CRTC_OFFSET_CNTL
comma
id|dev_priv-&gt;crtc_offset_cntl
op_or
id|RADEON_CRTC_OFFSET_FLIP_CNTL
)paren
suffix:semicolon
id|dev_priv-&gt;page_flipping
op_assign
l_int|1
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|0
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
op_assign
id|dev_priv-&gt;current_page
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_do_cleanup_pageflip
r_int
id|radeon_do_cleanup_pageflip
c_func
(paren
id|drm_device_t
op_star
id|dev
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|RADEON_WRITE
c_func
(paren
id|RADEON_CRTC_OFFSET
comma
id|dev_priv-&gt;crtc_offset
)paren
suffix:semicolon
id|RADEON_WRITE
c_func
(paren
id|RADEON_CRTC_OFFSET_CNTL
comma
id|dev_priv-&gt;crtc_offset_cntl
)paren
suffix:semicolon
id|dev_priv-&gt;page_flipping
op_assign
l_int|0
suffix:semicolon
id|dev_priv-&gt;current_page
op_assign
l_int|0
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;pfCurrentPage
op_assign
id|dev_priv-&gt;current_page
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Swapping and flipping are different operations, need different ioctls.&n; * They can &amp; should be intermixed to support multiple 3d windows.  &n; */
DECL|function|radeon_cp_flip
r_int
id|radeon_cp_flip
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv-&gt;page_flipping
)paren
id|radeon_do_init_pageflip
c_func
(paren
id|dev
)paren
suffix:semicolon
id|radeon_cp_dispatch_flip
c_func
(paren
id|dev
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_swap
r_int
id|radeon_cp_swap
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
id|sarea_priv-&gt;nbox
op_assign
id|RADEON_NR_SAREA_CLIPRECTS
suffix:semicolon
id|radeon_cp_dispatch_swap
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_priv-&gt;sarea_priv-&gt;ctx_owner
op_assign
l_int|0
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_vertex
r_int
id|radeon_cp_vertex
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_vertex_t
id|vertex
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|prim
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_radeon_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: pid=%d index=%d count=%d discard=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|current-&gt;pid
comma
id|vertex.idx
comma
id|vertex.count
comma
id|vertex.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
OL
l_int|0
op_logical_or
id|vertex.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|vertex.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|vertex.prim
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|vertex.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Build up a prim_t record:&n;&t; */
r_if
c_cond
(paren
id|vertex.count
)paren
(brace
id|buf-&gt;used
op_assign
id|vertex.count
suffix:semicolon
multiline_comment|/* not used? */
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;context_state
comma
id|sarea_priv-&gt;tex_state
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
(paren
id|RADEON_UPLOAD_TEX0IMAGES
op_or
id|RADEON_UPLOAD_TEX1IMAGES
op_or
id|RADEON_UPLOAD_TEX2IMAGES
op_or
id|RADEON_REQUIRE_QUIESCENCE
)paren
suffix:semicolon
)brace
id|prim.start
op_assign
l_int|0
suffix:semicolon
id|prim.finish
op_assign
id|vertex.count
suffix:semicolon
multiline_comment|/* unused */
id|prim.prim
op_assign
id|vertex.prim
suffix:semicolon
id|prim.numverts
op_assign
id|vertex.count
suffix:semicolon
id|prim.vc_format
op_assign
id|dev_priv-&gt;sarea_priv-&gt;vc_format
suffix:semicolon
id|radeon_cp_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|prim
comma
id|dev_priv-&gt;sarea_priv-&gt;boxes
comma
id|dev_priv-&gt;sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indices
r_int
id|radeon_cp_indices
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_indices_t
id|elts
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|prim
suffix:semicolon
r_int
id|count
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|elts
comma
(paren
id|drm_radeon_indices_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|elts
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s: pid=%d index=%d start=%d end=%d discard=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|current-&gt;pid
comma
id|elts.idx
comma
id|elts.start
comma
id|elts.end
comma
id|elts.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elts.idx
OL
l_int|0
op_logical_or
id|elts.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|elts.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.prim
template_param
id|RADEON_PRIM_TYPE_3VRT_LINE_LIST
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer prim %d&bslash;n&quot;
comma
id|elts.prim
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|elts.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|elts.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|count
op_assign
(paren
id|elts.end
op_minus
id|elts.start
)paren
op_div
r_sizeof
(paren
id|u16
)paren
suffix:semicolon
id|elts.start
op_sub_assign
id|RADEON_INDEX_PRIM_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|elts.start
op_amp
l_int|0x7
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;misaligned buffer 0x%x&bslash;n&quot;
comma
id|elts.start
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|elts.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;no header 0x%x - 0x%x&bslash;n&quot;
comma
id|elts.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf-&gt;used
op_assign
id|elts.end
suffix:semicolon
r_if
c_cond
(paren
id|sarea_priv-&gt;dirty
op_amp
op_complement
id|RADEON_UPLOAD_CLIPRECTS
)paren
(brace
id|radeon_emit_state
c_func
(paren
id|dev_priv
comma
op_amp
id|sarea_priv-&gt;context_state
comma
id|sarea_priv-&gt;tex_state
comma
id|sarea_priv-&gt;dirty
)paren
suffix:semicolon
id|sarea_priv-&gt;dirty
op_and_assign
op_complement
(paren
id|RADEON_UPLOAD_TEX0IMAGES
op_or
id|RADEON_UPLOAD_TEX1IMAGES
op_or
id|RADEON_UPLOAD_TEX2IMAGES
op_or
id|RADEON_REQUIRE_QUIESCENCE
)paren
suffix:semicolon
)brace
multiline_comment|/* Build up a prim_t record:&n;&t; */
id|prim.start
op_assign
id|elts.start
suffix:semicolon
id|prim.finish
op_assign
id|elts.end
suffix:semicolon
id|prim.prim
op_assign
id|elts.prim
suffix:semicolon
id|prim.offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* offset from start of dma buffers */
id|prim.numverts
op_assign
id|RADEON_MAX_VB_VERTS
suffix:semicolon
multiline_comment|/* duh */
id|prim.vc_format
op_assign
id|dev_priv-&gt;sarea_priv-&gt;vc_format
suffix:semicolon
id|radeon_cp_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|prim
comma
id|dev_priv-&gt;sarea_priv-&gt;boxes
comma
id|dev_priv-&gt;sarea_priv-&gt;nbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elts.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_texture
r_int
id|radeon_cp_texture
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_texture_t
id|tex
suffix:semicolon
id|drm_radeon_tex_image_t
id|image
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tex
comma
(paren
id|drm_radeon_texture_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|tex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|tex.image
op_eq
l_int|NULL
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;null texture image!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|image
comma
(paren
id|drm_radeon_tex_image_t
op_star
)paren
id|tex.image
comma
r_sizeof
(paren
id|image
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|ret
op_assign
id|radeon_cp_dispatch_texture
c_func
(paren
id|dev
comma
op_amp
id|tex
comma
op_amp
id|image
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|radeon_cp_stipple
r_int
id|radeon_cp_stipple
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_stipple_t
id|stipple
suffix:semicolon
id|u32
id|mask
(braket
l_int|32
)braket
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|stipple
comma
(paren
id|drm_radeon_stipple_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|stipple
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mask
comma
id|stipple.mask
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|radeon_cp_dispatch_stipple
c_func
(paren
id|dev
comma
id|mask
)paren
suffix:semicolon
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_indirect
r_int
id|radeon_cp_indirect
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_indirect_t
id|indirect
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|indirect
comma
(paren
id|drm_radeon_indirect_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|indirect
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;indirect: idx=%d s=%d e=%d d=%d&bslash;n&quot;
comma
id|indirect.idx
comma
id|indirect.start
comma
id|indirect.end
comma
id|indirect.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indirect.idx
OL
l_int|0
op_logical_or
id|indirect.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|indirect.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|indirect.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|indirect.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|indirect.start
OL
id|buf-&gt;used
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;reusing indirect: start=0x%x actual=0x%x&bslash;n&quot;
comma
id|indirect.start
comma
id|buf-&gt;used
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf-&gt;used
op_assign
id|indirect.end
suffix:semicolon
multiline_comment|/* Wait for the 3D stream to idle before the indirect buffer&n;&t; * containing 2D acceleration commands is processed.&n;&t; */
id|BEGIN_RING
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|RADEON_WAIT_UNTIL_3D_IDLE
c_func
(paren
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Dispatch the indirect buffer full of commands from the&n;&t; * X server.  This is insecure and is thus only available to&n;&t; * privileged clients.&n;&t; */
id|radeon_cp_dispatch_indirect
c_func
(paren
id|dev
comma
id|buf
comma
id|indirect.start
comma
id|indirect.end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indirect.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_vertex2
r_int
id|radeon_cp_vertex2
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_sarea_t
op_star
id|sarea_priv
op_assign
id|dev_priv-&gt;sarea_priv
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
suffix:semicolon
id|drm_radeon_vertex2_t
id|vertex
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|laststate
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vertex
comma
(paren
id|drm_radeon_vertex_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vertex
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;: pid=%d index=%d discard=%d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|vertex.idx
comma
id|vertex.discard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vertex.idx
OL
l_int|0
op_logical_or
id|vertex.idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|vertex.idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|vertex.idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;process %d using buffer owned by %d&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|buf-&gt;pid
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;sending pending buffer %d&bslash;n&quot;
comma
id|vertex.idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
OG
id|RADEON_NR_SAREA_CLIPRECTS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|laststate
op_assign
l_int|0xff
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|vertex.nr_prims
suffix:semicolon
id|i
op_increment
)paren
(brace
id|drm_radeon_prim_t
id|prim
suffix:semicolon
id|drm_radeon_tcl_prim_t
id|tclprim
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|prim
comma
op_amp
id|vertex.prim
(braket
id|i
)braket
comma
r_sizeof
(paren
id|prim
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|prim.stateidx
op_ne
id|laststate
)paren
(brace
id|drm_radeon_state_t
id|state
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|state
comma
op_amp
id|vertex.state
(braket
id|prim.stateidx
)braket
comma
r_sizeof
(paren
id|state
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|radeon_emit_state2
c_func
(paren
id|dev_priv
comma
op_amp
id|state
)paren
suffix:semicolon
id|laststate
op_assign
id|prim.stateidx
suffix:semicolon
)brace
id|tclprim.start
op_assign
id|prim.start
suffix:semicolon
id|tclprim.finish
op_assign
id|prim.finish
suffix:semicolon
id|tclprim.prim
op_assign
id|prim.prim
suffix:semicolon
id|tclprim.vc_format
op_assign
id|prim.vc_format
suffix:semicolon
r_if
c_cond
(paren
id|prim.prim
op_amp
id|RADEON_PRIM_WALK_IND
)paren
(brace
id|tclprim.offset
op_assign
id|prim.numverts
op_star
l_int|64
suffix:semicolon
id|tclprim.numverts
op_assign
id|RADEON_MAX_VB_VERTS
suffix:semicolon
multiline_comment|/* duh */
id|radeon_cp_dispatch_indices
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|tclprim
comma
id|sarea_priv-&gt;boxes
comma
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_else
(brace
id|tclprim.numverts
op_assign
id|prim.numverts
suffix:semicolon
id|tclprim.offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
id|radeon_cp_dispatch_vertex
c_func
(paren
id|dev
comma
id|buf
comma
op_amp
id|tclprim
comma
id|sarea_priv-&gt;boxes
comma
id|sarea_priv-&gt;nbox
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sarea_priv-&gt;nbox
op_eq
l_int|1
)paren
id|sarea_priv-&gt;nbox
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vertex.discard
)paren
(brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packets
r_static
r_int
id|radeon_emit_packets
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|id
op_assign
(paren
r_int
)paren
id|header.packet.packet_id
suffix:semicolon
r_int
id|sz
op_assign
id|packet
(braket
id|id
)braket
dot
id|len
suffix:semicolon
r_int
id|reg
op_assign
id|packet
(braket
id|id
)braket
dot
id|start
suffix:semicolon
r_int
op_star
id|data
op_assign
(paren
r_int
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
r_if
c_cond
(paren
id|sz
op_star
r_sizeof
(paren
r_int
)paren
OG
id|cmdbuf-&gt;bufsz
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|BEGIN_RING
c_func
(paren
id|sz
op_plus
l_int|1
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|reg
comma
(paren
id|sz
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_scalars
r_static
r_inline
r_int
id|radeon_emit_scalars
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|sz
op_assign
id|header.scalars.count
suffix:semicolon
r_int
op_star
id|data
op_assign
(paren
r_int
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|start
op_assign
id|header.scalars.offset
suffix:semicolon
r_int
id|stride
op_assign
id|header.scalars.stride
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
op_plus
id|sz
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_SCALAR_INDX_REG
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
(paren
id|stride
op_lshift
id|RADEON_SCAL_INDX_DWORD_STRIDE_SHIFT
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_SE_TCL_SCALAR_DATA_REG
comma
id|sz
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_vectors
r_static
r_inline
r_int
id|radeon_emit_vectors
c_func
(paren
id|drm_radeon_private_t
op_star
id|dev_priv
comma
id|drm_radeon_cmd_header_t
id|header
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
r_int
id|sz
op_assign
id|header.vectors.count
suffix:semicolon
r_int
op_star
id|data
op_assign
(paren
r_int
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
r_int
id|start
op_assign
id|header.vectors.offset
suffix:semicolon
r_int
id|stride
op_assign
id|header.vectors.stride
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|BEGIN_RING
c_func
(paren
l_int|3
op_plus
id|sz
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0
c_func
(paren
id|RADEON_SE_TCL_VECTOR_INDX_REG
comma
l_int|0
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|start
op_or
(paren
id|stride
op_lshift
id|RADEON_VEC_INDX_OCTWORD_STRIDE_SHIFT
)paren
)paren
suffix:semicolon
id|OUT_RING
c_func
(paren
id|CP_PACKET0_TABLE
c_func
(paren
id|RADEON_SE_TCL_VECTOR_DATA_REG
comma
(paren
id|sz
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|data
comma
id|sz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|sz
op_star
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packet3
r_static
r_int
id|radeon_emit_packet3
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
r_int
id|cmdsz
comma
id|tmp
suffix:semicolon
r_int
op_star
id|cmd
op_assign
(paren
r_int
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__get_user
c_func
(paren
id|tmp
comma
op_amp
id|cmd
(braket
l_int|0
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|cmdsz
op_assign
l_int|2
op_plus
(paren
(paren
id|tmp
op_amp
id|RADEON_CP_PACKET_COUNT_MASK
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0xc0000000
)paren
op_ne
id|RADEON_CP_PACKET3
op_logical_or
id|cmdsz
op_star
l_int|4
OG
id|cmdbuf-&gt;bufsz
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|BEGIN_RING
c_func
(paren
id|cmdsz
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|cmd
comma
id|cmdsz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_emit_packet3_cliprect
r_static
r_int
id|radeon_emit_packet3_cliprect
c_func
(paren
id|drm_device_t
op_star
id|dev
comma
id|drm_radeon_cmd_buffer_t
op_star
id|cmdbuf
)paren
(brace
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_clip_rect_t
id|box
suffix:semicolon
r_int
id|cmdsz
comma
id|tmp
suffix:semicolon
r_int
op_star
id|cmd
op_assign
(paren
r_int
op_star
)paren
id|cmdbuf-&gt;buf
suffix:semicolon
id|drm_clip_rect_t
op_star
id|boxes
op_assign
id|cmdbuf-&gt;boxes
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|RING_LOCALS
suffix:semicolon
id|DRM_DEBUG
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__get_user
c_func
(paren
id|tmp
comma
op_amp
id|cmd
(braket
l_int|0
)braket
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|cmdsz
op_assign
l_int|2
op_plus
(paren
(paren
id|tmp
op_amp
id|RADEON_CP_PACKET_COUNT_MASK
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
l_int|0xc0000000
)paren
op_ne
id|RADEON_CP_PACKET3
op_logical_or
id|cmdsz
op_star
l_int|4
OG
id|cmdbuf-&gt;bufsz
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|i
OL
id|cmdbuf-&gt;nbox
)paren
(brace
r_if
c_cond
(paren
id|__copy_from_user
c_func
(paren
op_amp
id|box
comma
op_amp
id|boxes
(braket
id|i
)braket
comma
r_sizeof
(paren
id|box
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|radeon_emit_clip_rect
c_func
(paren
id|dev_priv
comma
op_amp
id|box
)paren
suffix:semicolon
)brace
id|BEGIN_RING
c_func
(paren
id|cmdsz
)paren
suffix:semicolon
id|OUT_RING_USER_TABLE
c_func
(paren
id|cmd
comma
id|cmdsz
)paren
suffix:semicolon
id|ADVANCE_RING
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|cmdbuf-&gt;nbox
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdbuf-&gt;nbox
op_eq
l_int|1
)paren
id|cmdbuf-&gt;nbox
op_assign
l_int|0
suffix:semicolon
id|cmdbuf-&gt;buf
op_add_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
id|cmdbuf-&gt;bufsz
op_sub_assign
id|cmdsz
op_star
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_cmdbuf
r_int
id|radeon_cp_cmdbuf
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_device_dma_t
op_star
id|dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|drm_buf_t
op_star
id|buf
op_assign
l_int|0
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|drm_radeon_cmd_buffer_t
id|cmdbuf
suffix:semicolon
id|drm_radeon_cmd_header_t
id|header
suffix:semicolon
id|LOCK_TEST_WITH_RETURN
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmdbuf
comma
(paren
id|drm_radeon_cmd_buffer_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|cmdbuf
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;copy_from_user&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;: pid=%d&bslash;n&quot;
comma
id|current-&gt;pid
)paren
suffix:semicolon
id|RING_SPACE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
id|VB_AGE_TEST_WITH_RETURN
c_func
(paren
id|dev_priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|cmdbuf.buf
comma
id|cmdbuf.bufsz
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|cmdbuf.nbox
op_logical_and
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|cmdbuf.boxes
comma
id|cmdbuf.nbox
op_star
r_sizeof
(paren
id|drm_clip_rect_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_while
c_loop
(paren
id|cmdbuf.bufsz
op_ge
r_sizeof
(paren
id|header
)paren
)paren
(brace
r_if
c_cond
(paren
id|__get_user
c_func
(paren
id|header.i
comma
(paren
r_int
op_star
)paren
id|cmdbuf.buf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;__get_user %p&bslash;n&quot;
comma
id|cmdbuf.buf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|cmdbuf.buf
op_add_assign
r_sizeof
(paren
id|header
)paren
suffix:semicolon
id|cmdbuf.bufsz
op_sub_assign
r_sizeof
(paren
id|header
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|header.header.cmd_type
)paren
(brace
r_case
id|RADEON_CMD_PACKET
suffix:colon
r_if
c_cond
(paren
id|radeon_emit_packets
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packets failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_SCALARS
suffix:colon
r_if
c_cond
(paren
id|radeon_emit_scalars
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_scalars failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_VECTORS
suffix:colon
r_if
c_cond
(paren
id|radeon_emit_vectors
c_func
(paren
id|dev_priv
comma
id|header
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_vectors failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_DMA_DISCARD
suffix:colon
id|idx
op_assign
id|header.dma.buf_idx
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
op_logical_or
id|idx
op_ge
id|dma-&gt;buf_count
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;buffer index %d (of %d max)&bslash;n&quot;
comma
id|idx
comma
id|dma-&gt;buf_count
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|buf
op_assign
id|dma-&gt;buflist
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;pid
op_ne
id|current-&gt;pid
op_logical_or
id|buf-&gt;pending
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|radeon_cp_discard_buffer
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RADEON_CMD_PACKET3
suffix:colon
r_if
c_cond
(paren
id|radeon_emit_packet3
c_func
(paren
id|dev
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packet3 failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RADEON_CMD_PACKET3_CLIP
suffix:colon
r_if
c_cond
(paren
id|radeon_emit_packet3_cliprect
c_func
(paren
id|dev
comma
op_amp
id|cmdbuf
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;radeon_emit_packet3_clip failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|DRM_ERROR
c_func
(paren
l_string|&quot;bad cmd_type %d at %p&bslash;n&quot;
comma
id|header.header.cmd_type
comma
id|cmdbuf.buf
op_minus
r_sizeof
(paren
id|header
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|COMMIT_RING
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|radeon_cp_getparam
r_int
id|radeon_cp_getparam
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|drm_file_t
op_star
id|priv
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|drm_device_t
op_star
id|dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|drm_radeon_private_t
op_star
id|dev_priv
op_assign
id|dev-&gt;dev_private
suffix:semicolon
id|drm_radeon_getparam_t
id|param
suffix:semicolon
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_priv
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;%s called with no initialization&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|param
comma
(paren
id|drm_radeon_getparam_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|param
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;copy_from_user&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|DRM_DEBUG
c_func
(paren
id|__FUNCTION__
l_string|&quot;: pid=%d&bslash;n&quot;
comma
id|current-&gt;pid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|param.param
)paren
(brace
r_case
id|RADEON_PARAM_AGP_BUFFER_OFFSET
suffix:colon
id|value
op_assign
id|dev_priv-&gt;agp_buffers_offset
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|param.value
comma
op_amp
id|value
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
(brace
id|DRM_ERROR
c_func
(paren
l_string|&quot;copy_to_user&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
