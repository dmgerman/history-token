multiline_comment|/*&n; * drivers/mtd/maps/chestnut.c&n; *&n; * $Id: chestnut.c,v 1.1 2005/01/05 16:59:50 dwmw2 Exp $&n; *&n; * Flash map driver for IBM Chestnut (750FXGX Eval)&n; *&n; * Chose not to enable 8 bit flash as it contains the firmware and board&n; * info.  Thus only the 32bit flash is supported.&n; *&n; * Author: &lt;source@mvista.com&gt;&n; *&n; * 2004 (c) MontaVista Software, Inc. This file is licensed under&n; * the terms of the GNU General Public License version 2. This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/mtd/mtd.h&gt;
macro_line|#include &lt;linux/mtd/map.h&gt;
macro_line|#include &lt;linux/mtd/partitions.h&gt;
macro_line|#include &lt;platforms/chestnut.h&gt;
DECL|variable|chestnut32_map
r_static
r_struct
id|map_info
id|chestnut32_map
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|size
op_assign
id|CHESTNUT_32BIT_SIZE
comma
dot
id|bankwidth
op_assign
l_int|4
comma
dot
id|phys
op_assign
id|CHESTNUT_32BIT_BASE
comma
)brace
suffix:semicolon
DECL|variable|chestnut32_partitions
r_static
r_struct
id|mtd_partition
id|chestnut32_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|size
op_assign
id|CHESTNUT_32BIT_SIZE
comma
)brace
)brace
suffix:semicolon
DECL|variable|flash32
r_static
r_struct
id|mtd_info
op_star
id|flash32
suffix:semicolon
DECL|function|init_chestnut
r_int
id|__init
id|init_chestnut
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* 32-bit FLASH */
id|chestnut32_map.virt
op_assign
id|ioremap
c_func
(paren
id|chestnut32_map.phys
comma
id|chestnut32_map.size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chestnut32_map.virt
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Failed to ioremap 32-bit flash&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|simple_map_init
c_func
(paren
op_amp
id|chestnut32_map
)paren
suffix:semicolon
id|flash32
op_assign
id|do_map_probe
c_func
(paren
l_string|&quot;cfi_probe&quot;
comma
op_amp
id|chestnut32_map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flash32
)paren
(brace
id|flash32-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|add_mtd_partitions
c_func
(paren
id|flash32
comma
id|chestnut32_partitions
comma
id|ARRAY_SIZE
c_func
(paren
id|chestnut32_partitions
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;map probe failed for 32-bit flash&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|cleanup_chestnut
id|cleanup_chestnut
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|flash32
)paren
(brace
id|del_mtd_partitions
c_func
(paren
id|flash32
)paren
suffix:semicolon
id|map_destroy
c_func
(paren
id|flash32
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chestnut32_map.virt
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|chestnut32_map.virt
)paren
suffix:semicolon
id|chestnut32_map.virt
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|variable|init_chestnut
id|module_init
c_func
(paren
id|init_chestnut
)paren
suffix:semicolon
DECL|variable|cleanup_chestnut
id|module_exit
c_func
(paren
id|cleanup_chestnut
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;MTD map and partitions for IBM Chestnut (750fxgx Eval)&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;&lt;source@mvista.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
