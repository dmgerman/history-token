multiline_comment|/*&n; *  linux/drivers/mtd/maps/pci.c&n; *&n; *  Copyright (C) 2001 Russell King, All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; *  $Id: pci.c,v 1.5 2003/05/20 20:59:31 dwmw2 Exp $&n; * &n; * Generic PCI memory map driver.  We support the following boards:&n; *  - Intel IQ80310 ATU.&n; *  - Intel EBSA285 (blank rom programming mode). Tested working 27/09/2001&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mtd/mtd.h&gt;
macro_line|#include &lt;linux/mtd/map.h&gt;
macro_line|#include &lt;linux/mtd/partitions.h&gt;
r_struct
id|map_pci_info
suffix:semicolon
DECL|struct|mtd_pci_info
r_struct
id|mtd_pci_info
(brace
DECL|member|init
r_int
(paren
op_star
id|init
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
suffix:semicolon
DECL|member|exit
r_void
(paren
op_star
m_exit
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
suffix:semicolon
DECL|member|translate
r_int
r_int
(paren
op_star
id|translate
)paren
(paren
r_struct
id|map_pci_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
suffix:semicolon
DECL|member|map_name
r_const
r_char
op_star
id|map_name
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|map_pci_info
r_struct
id|map_pci_info
(brace
DECL|member|map
r_struct
id|map_info
id|map
suffix:semicolon
DECL|member|base
r_void
op_star
id|base
suffix:semicolon
DECL|member|exit
r_void
(paren
op_star
m_exit
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
suffix:semicolon
DECL|member|translate
r_int
r_int
(paren
op_star
id|translate
)paren
(paren
r_struct
id|map_pci_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
suffix:semicolon
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Intel IOP80310 Flash driver&n; */
r_static
r_int
DECL|function|intel_iq80310_init
id|intel_iq80310_init
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
(brace
id|u32
id|win_base
suffix:semicolon
id|map-&gt;map.buswidth
op_assign
l_int|1
suffix:semicolon
id|map-&gt;map.size
op_assign
l_int|0x00800000
suffix:semicolon
id|map-&gt;base
op_assign
id|ioremap_nocache
c_func
(paren
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|map-&gt;base
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * We want to base the memory window at Xscale&n;&t; * bus address 0, not 0x1000.&n;&t; */
id|pci_read_config_dword
c_func
(paren
id|dev
comma
l_int|0x44
comma
op_amp
id|win_base
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x44
comma
l_int|0
)paren
suffix:semicolon
id|map-&gt;map.map_priv_2
op_assign
id|win_base
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|intel_iq80310_exit
id|intel_iq80310_exit
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
(brace
r_if
c_cond
(paren
id|map-&gt;base
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|map-&gt;base
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x44
comma
id|map-&gt;map.map_priv_2
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|intel_iq80310_translate
id|intel_iq80310_translate
c_func
(paren
r_struct
id|map_pci_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_int
r_int
id|page_addr
op_assign
id|ofs
op_amp
l_int|0x00400000
suffix:semicolon
multiline_comment|/*&n;&t; * This mundges the flash location so we avoid&n;&t; * the first 80 bytes (they appear to read nonsense).&n;&t; */
r_if
c_cond
(paren
id|page_addr
)paren
(brace
id|writel
c_func
(paren
l_int|0x00000008
comma
id|map-&gt;base
op_plus
l_int|0x1558
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|map-&gt;base
op_plus
l_int|0x1550
)paren
suffix:semicolon
)brace
r_else
(brace
id|writel
c_func
(paren
l_int|0x00000007
comma
id|map-&gt;base
op_plus
l_int|0x1558
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00800000
comma
id|map-&gt;base
op_plus
l_int|0x1550
)paren
suffix:semicolon
id|ofs
op_add_assign
l_int|0x00800000
suffix:semicolon
)brace
r_return
id|ofs
suffix:semicolon
)brace
DECL|variable|intel_iq80310_info
r_static
r_struct
id|mtd_pci_info
id|intel_iq80310_info
op_assign
(brace
dot
id|init
op_assign
id|intel_iq80310_init
comma
dot
m_exit
op_assign
id|intel_iq80310_exit
comma
dot
id|translate
op_assign
id|intel_iq80310_translate
comma
dot
id|map_name
op_assign
l_string|&quot;cfi_probe&quot;
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Intel DC21285 driver&n; */
r_static
r_int
DECL|function|intel_dc21285_init
id|intel_dc21285_init
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
(brace
r_int
r_int
id|base
comma
id|len
suffix:semicolon
id|base
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
id|PCI_ROM_RESOURCE
)paren
suffix:semicolon
id|len
op_assign
id|pci_resource_len
c_func
(paren
id|dev
comma
id|PCI_ROM_RESOURCE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
op_logical_or
op_logical_neg
id|base
)paren
(brace
multiline_comment|/*&n;&t;&t; * No ROM resource&n;&t;&t; */
id|base
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|len
op_assign
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We need to re-allocate PCI BAR2 address range to the&n;&t;&t; * PCI ROM BAR, and disable PCI BAR2.&n;&t;&t; */
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Hmm, if an address was allocated to the ROM resource, but&n;&t;&t; * not enabled, should we be allocating a new resource for it&n;&t;&t; * or simply enabling it?&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|dev
comma
id|PCI_ROM_RESOURCE
)paren
op_amp
id|PCI_ROM_ADDRESS_ENABLE
)paren
)paren
(brace
id|u32
id|val
suffix:semicolon
id|pci_resource_flags
c_func
(paren
id|dev
comma
id|PCI_ROM_RESOURCE
)paren
op_or_assign
id|PCI_ROM_ADDRESS_ENABLE
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_ROM_ADDRESS
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_or_assign
id|PCI_ROM_ADDRESS_ENABLE
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_ROM_ADDRESS
comma
id|val
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: enabling expansion ROM&bslash;n&quot;
comma
id|dev-&gt;slot_name
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|len
op_logical_or
op_logical_neg
id|base
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|map-&gt;map.buswidth
op_assign
l_int|4
suffix:semicolon
id|map-&gt;map.size
op_assign
id|len
suffix:semicolon
id|map-&gt;base
op_assign
id|ioremap_nocache
c_func
(paren
id|base
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|map-&gt;base
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|intel_dc21285_exit
id|intel_dc21285_exit
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|map_pci_info
op_star
id|map
)paren
(brace
id|u32
id|val
suffix:semicolon
r_if
c_cond
(paren
id|map-&gt;base
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|map-&gt;base
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We need to undo the PCI BAR2/PCI ROM BAR address alteration.&n;&t; */
id|pci_resource_flags
c_func
(paren
id|dev
comma
id|PCI_ROM_RESOURCE
)paren
op_and_assign
op_complement
id|PCI_ROM_ADDRESS_ENABLE
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_ROM_ADDRESS
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|PCI_ROM_ADDRESS_ENABLE
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_ROM_ADDRESS
comma
id|val
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|intel_dc21285_translate
id|intel_dc21285_translate
c_func
(paren
r_struct
id|map_pci_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
id|ofs
op_amp
l_int|0x00ffffc0
ques
c_cond
id|ofs
suffix:colon
(paren
id|ofs
op_xor
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
suffix:semicolon
)brace
DECL|variable|intel_dc21285_info
r_static
r_struct
id|mtd_pci_info
id|intel_dc21285_info
op_assign
(brace
dot
id|init
op_assign
id|intel_dc21285_init
comma
dot
m_exit
op_assign
id|intel_dc21285_exit
comma
dot
id|translate
op_assign
id|intel_dc21285_translate
comma
dot
id|map_name
op_assign
l_string|&quot;jedec_probe&quot;
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * PCI device ID table&n; */
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|mtd_pci_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_INTEL
comma
dot
id|device
op_assign
l_int|0x530d
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
r_class
op_assign
id|PCI_CLASS_MEMORY_OTHER
op_lshift
l_int|8
comma
dot
id|class_mask
op_assign
l_int|0xffff00
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|intel_iq80310_info
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_DEC
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_DEC_21285
comma
dot
id|subvendor
op_assign
l_int|0
comma
multiline_comment|/* DC21285 defaults to 0 on reset */
dot
id|subdevice
op_assign
l_int|0
comma
multiline_comment|/* DC21285 defaults to 0 on reset */
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|intel_dc21285_info
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Generic code follows.&n; */
DECL|function|mtd_pci_read8
r_static
id|u8
id|mtd_pci_read8
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
id|u8
id|val
op_assign
id|readb
c_func
(paren
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
singleline_comment|//&t;printk(&quot;read8 : %08lx =&gt; %02x&bslash;n&quot;, ofs, val);
r_return
id|val
suffix:semicolon
)brace
DECL|function|mtd_pci_read16
r_static
id|u16
id|mtd_pci_read16
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
id|u16
id|val
op_assign
id|readw
c_func
(paren
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
singleline_comment|//&t;printk(&quot;read16: %08lx =&gt; %04x&bslash;n&quot;, ofs, val);
r_return
id|val
suffix:semicolon
)brace
DECL|function|mtd_pci_read32
r_static
id|u32
id|mtd_pci_read32
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
id|u32
id|val
op_assign
id|readl
c_func
(paren
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
singleline_comment|//&t;printk(&quot;read32: %08lx =&gt; %08x&bslash;n&quot;, ofs, val);
r_return
id|val
suffix:semicolon
)brace
DECL|function|mtd_pci_copyfrom
r_static
r_void
id|mtd_pci_copyfrom
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
r_void
op_star
id|to
comma
r_int
r_int
id|from
comma
id|ssize_t
id|len
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|to
comma
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|from
)paren
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|mtd_pci_write8
r_static
r_void
id|mtd_pci_write8
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
id|u8
id|val
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
singleline_comment|//&t;printk(&quot;write8 : %08lx &lt;= %02x&bslash;n&quot;, ofs, val);
id|writeb
c_func
(paren
id|val
comma
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
)brace
DECL|function|mtd_pci_write16
r_static
r_void
id|mtd_pci_write16
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
id|u16
id|val
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
singleline_comment|//&t;printk(&quot;write16: %08lx &lt;= %04x&bslash;n&quot;, ofs, val);
id|writew
c_func
(paren
id|val
comma
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
)brace
DECL|function|mtd_pci_write32
r_static
r_void
id|mtd_pci_write32
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
id|u32
id|val
comma
r_int
r_int
id|ofs
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
singleline_comment|//&t;printk(&quot;write32: %08lx &lt;= %08x&bslash;n&quot;, ofs, val);
id|writel
c_func
(paren
id|val
comma
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|ofs
)paren
)paren
suffix:semicolon
)brace
DECL|function|mtd_pci_copyto
r_static
r_void
id|mtd_pci_copyto
c_func
(paren
r_struct
id|map_info
op_star
id|_map
comma
r_int
r_int
id|to
comma
r_const
r_void
op_star
id|from
comma
id|ssize_t
id|len
)paren
(brace
r_struct
id|map_pci_info
op_star
id|map
op_assign
(paren
r_struct
id|map_pci_info
op_star
)paren
id|_map
suffix:semicolon
id|memcpy_toio
c_func
(paren
id|map-&gt;base
op_plus
id|map
op_member_access_from_pointer
id|translate
c_func
(paren
id|map
comma
id|to
)paren
comma
id|from
comma
id|len
)paren
suffix:semicolon
)brace
DECL|variable|mtd_pci_map
r_static
r_struct
id|map_info
id|mtd_pci_map
op_assign
(brace
dot
id|phys
op_assign
id|NO_XIP
comma
dot
id|read8
op_assign
id|mtd_pci_read8
comma
dot
id|read16
op_assign
id|mtd_pci_read16
comma
dot
id|read32
op_assign
id|mtd_pci_read32
comma
dot
id|copy_from
op_assign
id|mtd_pci_copyfrom
comma
dot
id|write8
op_assign
id|mtd_pci_write8
comma
dot
id|write16
op_assign
id|mtd_pci_write16
comma
dot
id|write32
op_assign
id|mtd_pci_write32
comma
dot
id|copy_to
op_assign
id|mtd_pci_copyto
comma
)brace
suffix:semicolon
r_static
r_int
id|__devinit
DECL|function|mtd_pci_probe
id|mtd_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|mtd_pci_info
op_star
id|info
op_assign
(paren
r_struct
id|mtd_pci_info
op_star
)paren
id|id-&gt;driver_data
suffix:semicolon
r_struct
id|map_pci_info
op_star
id|map
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|mtd_info
op_star
id|mtd
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|dev
comma
l_string|&quot;pci mtd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|map
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|map
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|map
)paren
r_goto
id|release
suffix:semicolon
id|map-&gt;map
op_assign
id|mtd_pci_map
suffix:semicolon
id|map-&gt;map.name
op_assign
id|dev-&gt;slot_name
suffix:semicolon
id|map-&gt;dev
op_assign
id|dev
suffix:semicolon
id|map
op_member_access_from_pointer
m_exit
op_assign
id|info
op_member_access_from_pointer
m_exit
suffix:semicolon
id|map-&gt;translate
op_assign
id|info-&gt;translate
suffix:semicolon
id|err
op_assign
id|info
op_member_access_from_pointer
id|init
c_func
(paren
id|dev
comma
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|release
suffix:semicolon
multiline_comment|/* tsk - do_map_probe should take const char * */
id|mtd
op_assign
id|do_map_probe
c_func
(paren
(paren
r_char
op_star
)paren
id|info-&gt;map_name
comma
op_amp
id|map-&gt;map
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mtd
)paren
r_goto
id|release
suffix:semicolon
id|mtd-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|add_mtd_device
c_func
(paren
id|mtd
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
id|mtd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|release
suffix:colon
r_if
c_cond
(paren
id|mtd
)paren
id|map_destroy
c_func
(paren
id|mtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map
)paren
(brace
id|map
op_member_access_from_pointer
m_exit
(paren
id|dev
comma
id|map
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|map
)paren
suffix:semicolon
)brace
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
r_static
r_void
id|__devexit
DECL|function|mtd_pci_remove
id|mtd_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|mtd_info
op_star
id|mtd
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|map_pci_info
op_star
id|map
op_assign
id|mtd-&gt;priv
suffix:semicolon
id|del_mtd_device
c_func
(paren
id|mtd
)paren
suffix:semicolon
id|map_destroy
c_func
(paren
id|mtd
)paren
suffix:semicolon
id|map
op_member_access_from_pointer
m_exit
(paren
id|dev
comma
id|map
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|map
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|mtd_pci_driver
r_static
r_struct
id|pci_driver
id|mtd_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;MTD PCI&quot;
comma
dot
id|probe
op_assign
id|mtd_pci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|mtd_pci_remove
)paren
comma
dot
id|id_table
op_assign
id|mtd_pci_ids
comma
)brace
suffix:semicolon
DECL|function|mtd_pci_maps_init
r_static
r_int
id|__init
id|mtd_pci_maps_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|mtd_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|mtd_pci_maps_exit
r_static
r_void
id|__exit
id|mtd_pci_maps_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|mtd_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|mtd_pci_maps_init
id|module_init
c_func
(paren
id|mtd_pci_maps_init
)paren
suffix:semicolon
DECL|variable|mtd_pci_maps_exit
id|module_exit
c_func
(paren
id|mtd_pci_maps_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Russell King &lt;rmk@arm.linux.org.uk&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Generic PCI map driver&quot;
)paren
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|mtd_pci_ids
)paren
suffix:semicolon
eof
