multiline_comment|/*&n; * Flash memory access on SA11x0 based devices&n; * &n; * (C) 2000 Nicolas Pitre &lt;nico@cam.org&gt;&n; * &n; * $Id: sa1100-flash.c,v 1.15 2001/06/02 18:29:22 nico Exp $&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mtd/mtd.h&gt;
macro_line|#include &lt;linux/mtd/map.h&gt;
macro_line|#include &lt;linux/mtd/partitions.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#ifndef CONFIG_ARCH_SA1100
macro_line|#error This is for SA1100 architecture only
macro_line|#endif
DECL|macro|WINDOW_ADDR
mdefine_line|#define WINDOW_ADDR 0xe8000000
DECL|function|sa1100_read8
r_static
id|__u8
id|sa1100_read8
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
op_star
(paren
id|__u8
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_read16
r_static
id|__u16
id|sa1100_read16
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
op_star
(paren
id|__u16
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_read32
r_static
id|__u32
id|sa1100_read32
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
op_star
(paren
id|__u32
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_copy_from
r_static
r_void
id|sa1100_copy_from
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_void
op_star
id|to
comma
r_int
r_int
id|from
comma
id|ssize_t
id|len
)paren
(brace
id|memcpy
c_func
(paren
id|to
comma
(paren
r_void
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|from
)paren
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sa1100_write8
r_static
r_void
id|sa1100_write8
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u8
id|d
comma
r_int
r_int
id|adr
)paren
(brace
op_star
(paren
id|__u8
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|adr
)paren
op_assign
id|d
suffix:semicolon
)brace
DECL|function|sa1100_write16
r_static
r_void
id|sa1100_write16
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u16
id|d
comma
r_int
r_int
id|adr
)paren
(brace
op_star
(paren
id|__u16
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|adr
)paren
op_assign
id|d
suffix:semicolon
)brace
DECL|function|sa1100_write32
r_static
r_void
id|sa1100_write32
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u32
id|d
comma
r_int
r_int
id|adr
)paren
(brace
op_star
(paren
id|__u32
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|adr
)paren
op_assign
id|d
suffix:semicolon
)brace
DECL|function|sa1100_copy_to
r_static
r_void
id|sa1100_copy_to
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|to
comma
r_const
r_void
op_star
id|from
comma
id|ssize_t
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|WINDOW_ADDR
op_plus
id|to
)paren
comma
id|from
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SA1100_BITSY
DECL|function|bitsy_set_vpp
r_static
r_void
id|bitsy_set_vpp
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
id|vpp
)paren
(brace
r_if
c_cond
(paren
id|vpp
)paren
id|set_bitsy_egpio
c_func
(paren
id|EGPIO_BITSY_VPP_ON
)paren
suffix:semicolon
r_else
id|clr_bitsy_egpio
c_func
(paren
id|EGPIO_BITSY_VPP_ON
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_JORNADA720
DECL|function|jornada720_set_vpp
r_static
r_void
id|jornada720_set_vpp
c_func
(paren
r_int
id|vpp
)paren
(brace
r_if
c_cond
(paren
id|vpp
)paren
id|PPSR
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|PPSR
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|PPDR
op_or_assign
l_int|0x80
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|sa1100_map
r_static
r_struct
id|map_info
id|sa1100_map
op_assign
(brace
id|name
suffix:colon
l_string|&quot;SA1100 flash&quot;
comma
id|read8
suffix:colon
id|sa1100_read8
comma
id|read16
suffix:colon
id|sa1100_read16
comma
id|read32
suffix:colon
id|sa1100_read32
comma
id|copy_from
suffix:colon
id|sa1100_copy_from
comma
id|write8
suffix:colon
id|sa1100_write8
comma
id|write16
suffix:colon
id|sa1100_write16
comma
id|write32
suffix:colon
id|sa1100_write32
comma
id|copy_to
suffix:colon
id|sa1100_copy_to
)brace
suffix:semicolon
multiline_comment|/*&n; * Here are partition information for all known SA1100-based devices.&n; * See include/linux/mtd/partitions.h for definition of the mtd_partition&n; * structure.&n; * &n; * The *_max_flash_size is the maximum possible mapped flash size which&n; * is not necessarily the actual flash size.  It must correspond to the &n; * value specified in the mapping definition defined by the&n; * &quot;struct map_desc *_io_desc&quot; for the corresponding machine.&n; */
macro_line|#ifdef CONFIG_SA1100_ASSABET
multiline_comment|/* Phase 4 Assabet has two 28F160B3 flash parts in bank 0: */
DECL|variable|assabet4_max_flash_size
r_static
r_int
r_int
id|assabet4_max_flash_size
op_assign
l_int|0x00400000
suffix:semicolon
DECL|variable|assabet4_partitions
r_static
r_struct
id|mtd_partition
id|assabet4_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;bootloader&quot;
comma
id|size
suffix:colon
l_int|0x00020000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;bootloader params&quot;
comma
id|size
suffix:colon
l_int|0x00020000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;jffs&quot;
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
)brace
)brace
suffix:semicolon
multiline_comment|/* Phase 5 Assabet has two 28F128J3A flash parts in bank 0: */
DECL|variable|assabet5_max_flash_size
r_static
r_int
r_int
id|assabet5_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|assabet5_partitions
r_static
r_struct
id|mtd_partition
id|assabet5_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;bootloader&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;bootloader params&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;jffs&quot;
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
)brace
)brace
suffix:semicolon
DECL|macro|assabet_max_flash_size
mdefine_line|#define assabet_max_flash_size assabet5_max_flash_size
DECL|macro|assabet_partitions
mdefine_line|#define assabet_partitions     assabet5_partitions
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FLEXANET
multiline_comment|/* Flexanet has two 28F128J3A flash parts in bank 0: */
DECL|variable|flexanet_max_flash_size
r_static
r_int
r_int
id|flexanet_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|flexanet_partitions
r_static
r_struct
id|mtd_partition
id|flexanet_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;bootloader&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;bootloader params&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;kernel&quot;
comma
id|size
suffix:colon
l_int|0x000C0000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;altkernel&quot;
comma
id|size
suffix:colon
l_int|0x000C0000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;root&quot;
comma
id|size
suffix:colon
l_int|0x00400000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;free1&quot;
comma
id|size
suffix:colon
l_int|0x00300000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;free2&quot;
comma
id|size
suffix:colon
l_int|0x00300000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;free3&quot;
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
DECL|variable|huw_webpanel_max_flash_size
r_static
r_int
r_int
id|huw_webpanel_max_flash_size
op_assign
l_int|0x01000000
suffix:semicolon
DECL|variable|huw_webpanel_partitions
r_static
r_struct
id|mtd_partition
id|huw_webpanel_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;Loader&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;Sector 1&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
id|size
suffix:colon
id|MTDPART_SIZ_FULL
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_SA1100_HUW_WEBPANEL */
macro_line|#ifdef CONFIG_SA1100_BITSY
DECL|variable|bitsy_max_flash_size
r_static
r_int
r_int
id|bitsy_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|bitsy_partitions
r_static
r_struct
id|mtd_partition
id|bitsy_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;BITSY boot firmware&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
multiline_comment|/* force read-only */
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;BITSY kernel&quot;
comma
id|size
suffix:colon
l_int|0x00080000
comma
id|offset
suffix:colon
l_int|0x40000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;BITSY params&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0xC0000
)brace
comma
(brace
macro_line|#ifdef CONFIG_JFFS2_FS
id|name
suffix:colon
l_string|&quot;BITSY root jffs2&quot;
comma
id|offset
suffix:colon
l_int|0x00100000
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
macro_line|#else
id|name
suffix:colon
l_string|&quot;BITSY initrd&quot;
comma
id|size
suffix:colon
l_int|0x00100000
comma
id|offset
suffix:colon
l_int|0x00100000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;BITSY root cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00300000
comma
id|offset
suffix:colon
l_int|0x00200000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;BITSY usr cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00800000
comma
id|offset
suffix:colon
l_int|0x00500000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;BITSY usr local&quot;
comma
id|offset
suffix:colon
l_int|0x00d00000
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
macro_line|#endif
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
DECL|variable|freebird_max_flash_size
r_static
r_int
r_int
id|freebird_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|freebird_partitions
r_static
r_struct
id|mtd_partition
id|freebird_partitions
(braket
)braket
op_assign
(brace
macro_line|#if CONFIG_SA1100_FREEBIRD_NEW
(brace
id|name
suffix:colon
l_string|&quot;firmware&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
multiline_comment|/* force read-only */
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;kernel&quot;
comma
id|size
suffix:colon
l_int|0x00080000
comma
id|offset
suffix:colon
l_int|0x40000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;params&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0xC0000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;initrd&quot;
comma
id|size
suffix:colon
l_int|0x00100000
comma
id|offset
suffix:colon
l_int|0x00100000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;root cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00300000
comma
id|offset
suffix:colon
l_int|0x00200000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;usr cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00C00000
comma
id|offset
suffix:colon
l_int|0x00500000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;local&quot;
comma
id|offset
suffix:colon
l_int|0x01100000
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
)brace
macro_line|#else
(brace
id|offset
suffix:colon
l_int|0
comma
id|size
suffix:colon
l_int|0x00040000
comma
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x000c0000
comma
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x00400000
comma
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
)brace
macro_line|#endif
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
DECL|variable|cerf_max_flash_size
r_static
r_int
r_int
id|cerf_max_flash_size
op_assign
l_int|0x01000000
suffix:semicolon
DECL|variable|cerf_partitions
r_static
r_struct
id|mtd_partition
id|cerf_partitions
(braket
)braket
op_assign
(brace
(brace
id|offset
suffix:colon
l_int|0
comma
id|size
suffix:colon
l_int|0x00800000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x00800000
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
DECL|variable|graphicsclient_max_flash_size
r_static
r_int
r_int
id|graphicsclient_max_flash_size
op_assign
l_int|0x01000000
suffix:semicolon
DECL|variable|graphicsclient_partitions
r_static
r_struct
id|mtd_partition
id|graphicsclient_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;Bootloader + zImage&quot;
comma
id|offset
suffix:colon
l_int|0
comma
id|size
suffix:colon
l_int|0x100000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;ramdisk.gz&quot;
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x300000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;User FS&quot;
comma
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_LART
DECL|variable|lart_max_flash_size
r_static
r_int
r_int
id|lart_max_flash_size
op_assign
l_int|0x00400000
suffix:semicolon
DECL|variable|lart_partitions
r_static
r_struct
id|mtd_partition
id|lart_partitions
(braket
)braket
op_assign
(brace
(brace
id|offset
suffix:colon
l_int|0
comma
id|size
suffix:colon
l_int|0x020000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x0e0000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
id|MTDPART_SIZ_FULL
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
DECL|variable|pangolin_max_flash_size
r_static
r_int
r_int
id|pangolin_max_flash_size
op_assign
l_int|0x04000000
suffix:semicolon
DECL|variable|pangolin_partitions
r_static
r_struct
id|mtd_partition
id|pangolin_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;boot firmware&quot;
comma
id|offset
suffix:colon
l_int|0x00000000
comma
id|size
suffix:colon
l_int|0x00080000
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;kernel&quot;
comma
id|offset
suffix:colon
l_int|0x00080000
comma
id|size
suffix:colon
l_int|0x00100000
comma
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;initrd&quot;
comma
id|offset
suffix:colon
l_int|0x00180000
comma
id|size
suffix:colon
l_int|0x00200000
comma
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;initrd-test&quot;
comma
id|offset
suffix:colon
l_int|0x00400000
comma
id|size
suffix:colon
l_int|0x03C00000
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_YOPY
DECL|variable|yopy_max_flash_size
r_static
r_int
r_int
id|yopy_max_flash_size
op_assign
l_int|0x08000000
suffix:semicolon
DECL|variable|yopy_partitions
r_static
r_struct
id|mtd_partition
id|yopy_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;boot firmware&quot;
comma
id|offset
suffix:colon
l_int|0x00000000
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;kernel&quot;
comma
id|offset
suffix:colon
l_int|0x00080000
comma
id|size
suffix:colon
l_int|0x00080000
comma
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;initrd&quot;
comma
id|offset
suffix:colon
l_int|0x00100000
comma
id|size
suffix:colon
l_int|0x00300000
comma
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;root&quot;
comma
id|offset
suffix:colon
l_int|0x00400000
comma
id|size
suffix:colon
l_int|0x01000000
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_JORNADA720
DECL|variable|jornada720_max_flash_size
r_static
r_int
r_int
id|jornada720_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|jornada720_partitions
r_static
r_struct
id|mtd_partition
id|jornada720_partitions
(braket
)braket
op_assign
(brace
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 boot firmware&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0
comma
id|mask_flags
suffix:colon
id|MTD_WRITEABLE
multiline_comment|/* force read-only */
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 kernel&quot;
comma
id|size
suffix:colon
l_int|0x000c0000
comma
id|offset
suffix:colon
l_int|0x40000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 params&quot;
comma
id|size
suffix:colon
l_int|0x00040000
comma
id|offset
suffix:colon
l_int|0x100000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 initrd&quot;
comma
id|size
suffix:colon
l_int|0x00100000
comma
id|offset
suffix:colon
l_int|0x00140000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 root cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00300000
comma
id|offset
suffix:colon
l_int|0x00240000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 usr cramfs&quot;
comma
id|size
suffix:colon
l_int|0x00800000
comma
id|offset
suffix:colon
l_int|0x00540000
)brace
comma
(brace
id|name
suffix:colon
l_string|&quot;JORNADA720 usr local&quot;
comma
id|offset
suffix:colon
l_int|0x00d00000
comma
id|size
suffix:colon
l_int|0
multiline_comment|/* will expand to the end of the flash */
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHERMAN
DECL|variable|sherman_max_flash_size
r_static
r_int
r_int
id|sherman_max_flash_size
op_assign
l_int|0x02000000
suffix:semicolon
DECL|variable|sherman_partitions
r_static
r_struct
id|mtd_partition
id|sherman_partitions
(braket
)braket
op_assign
(brace
(brace
id|offset
suffix:colon
l_int|0
comma
id|size
suffix:colon
l_int|0x50000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x70000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0x600000
)brace
comma
(brace
id|offset
suffix:colon
id|MTDPART_OFS_APPEND
comma
id|size
suffix:colon
l_int|0xA0000
)brace
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|NB_OF
mdefine_line|#define NB_OF(x)  (sizeof(x)/sizeof(x[0]))
r_extern
r_int
id|parse_redboot_partitions
c_func
(paren
r_struct
id|mtd_info
op_star
id|master
comma
r_struct
id|mtd_partition
op_star
op_star
id|pparts
)paren
suffix:semicolon
r_extern
r_int
id|parse_bootldr_partitions
c_func
(paren
r_struct
id|mtd_info
op_star
id|master
comma
r_struct
id|mtd_partition
op_star
op_star
id|pparts
)paren
suffix:semicolon
DECL|variable|parsed_parts
r_static
r_struct
id|mtd_partition
op_star
id|parsed_parts
suffix:semicolon
DECL|variable|mymtd
r_static
r_struct
id|mtd_info
op_star
id|mymtd
suffix:semicolon
DECL|function|sa1100_mtd_init
r_int
id|__init
id|sa1100_mtd_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|mtd_partition
op_star
id|parts
suffix:semicolon
r_int
id|nb_parts
op_assign
l_int|0
suffix:semicolon
r_int
id|parsed_nr_parts
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|part_type
suffix:semicolon
id|sa1100_map.buswidth
op_assign
(paren
id|MSC0
op_amp
id|MSC_RBW
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;SA1100 flash: probing %d-bit flash bus&bslash;n&quot;
comma
id|sa1100_map.buswidth
op_star
l_int|8
)paren
suffix:semicolon
id|mymtd
op_assign
id|do_map_probe
c_func
(paren
l_string|&quot;cfi&quot;
comma
op_amp
id|sa1100_map
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mymtd
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|mymtd-&gt;module
op_assign
id|THIS_MODULE
suffix:semicolon
multiline_comment|/*&n;&t; * Static partition definition selection&n;&t; */
id|part_type
op_assign
l_string|&quot;static&quot;
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_ASSABET
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|assabet_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|assabet_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|assabet_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
r_if
c_cond
(paren
id|machine_is_huw_webpanel
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|huw_webpanel_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|huw_webpanel_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|huw_webpanel_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BITSY
r_if
c_cond
(paren
id|machine_is_bitsy
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|bitsy_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|bitsy_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|bitsy_max_flash_size
suffix:semicolon
id|sa1100_map.set_vpp
op_assign
id|bitsy_set_vpp
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
r_if
c_cond
(paren
id|machine_is_freebird
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|freebird_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|freebird_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|freebird_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|cerf_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|cerf_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|cerf_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|graphicsclient_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|graphicsclient_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|graphicsclient_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_LART
r_if
c_cond
(paren
id|machine_is_lart
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|lart_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|lart_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|lart_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
r_if
c_cond
(paren
id|machine_is_pangolin
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|pangolin_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|pangolin_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|pangolin_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_JORNADA720
r_if
c_cond
(paren
id|machine_is_jornada720
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|jornada720_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|jornada720_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|jornada720_max_flash_size
suffix:semicolon
id|sa1100_map.set_vpp
op_assign
id|jornada720_set_vpp
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_YOPY
r_if
c_cond
(paren
id|machine_is_yopy
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|yopy_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|yopy_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|yopy_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHERMAN
r_if
c_cond
(paren
id|machine_is_sherman
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|sherman_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|sherman_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|sherman_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FLEXANET
r_if
c_cond
(paren
id|machine_is_flexanet
c_func
(paren
)paren
)paren
(brace
id|parts
op_assign
id|flexanet_partitions
suffix:semicolon
id|nb_parts
op_assign
id|NB_OF
c_func
(paren
id|flexanet_partitions
)paren
suffix:semicolon
id|sa1100_map.size
op_assign
id|flexanet_max_flash_size
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|nb_parts
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;MTD: no known flash definition for this SA1100 machine&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Dynamic partition selection stuff (might override the static ones)&n;&t; */
macro_line|#ifdef CONFIG_MTD_SA1100_REDBOOT_PARTITIONS
r_if
c_cond
(paren
id|parsed_nr_parts
op_eq
l_int|0
)paren
(brace
r_int
id|ret
op_assign
id|parse_redboot_partitions
c_func
(paren
id|mymtd
comma
op_amp
id|parsed_parts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
(brace
id|part_type
op_assign
l_string|&quot;RedBoot&quot;
suffix:semicolon
id|parsed_nr_parts
op_assign
id|ret
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MTD_SA1100_BOOTLDR_PARTITIONS
r_if
c_cond
(paren
id|parsed_nr_parts
op_eq
l_int|0
)paren
(brace
r_int
id|ret
op_assign
id|parse_bootldr_partitions
c_func
(paren
id|mymtd
comma
op_amp
id|parsed_parts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OG
l_int|0
)paren
(brace
id|part_type
op_assign
l_string|&quot;Compaq bootldr&quot;
suffix:semicolon
id|parsed_nr_parts
op_assign
id|ret
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|parsed_nr_parts
OG
l_int|0
)paren
(brace
id|parts
op_assign
id|parsed_parts
suffix:semicolon
id|nb_parts
op_assign
id|parsed_nr_parts
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nb_parts
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;SA1100 flash: no partition info available, registering whole flash at once&bslash;n&quot;
)paren
suffix:semicolon
id|add_mtd_device
c_func
(paren
id|mymtd
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Using %s partition definition&bslash;n&quot;
comma
id|part_type
)paren
suffix:semicolon
id|add_mtd_partitions
c_func
(paren
id|mymtd
comma
id|parts
comma
id|nb_parts
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sa1100_mtd_cleanup
r_static
r_void
id|__exit
id|sa1100_mtd_cleanup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mymtd
)paren
(brace
id|del_mtd_partitions
c_func
(paren
id|mymtd
)paren
suffix:semicolon
id|map_destroy
c_func
(paren
id|mymtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parsed_parts
)paren
id|kfree
c_func
(paren
id|parsed_parts
)paren
suffix:semicolon
)brace
)brace
DECL|variable|sa1100_mtd_init
id|module_init
c_func
(paren
id|sa1100_mtd_init
)paren
suffix:semicolon
DECL|variable|sa1100_mtd_cleanup
id|module_exit
c_func
(paren
id|sa1100_mtd_cleanup
)paren
suffix:semicolon
eof
