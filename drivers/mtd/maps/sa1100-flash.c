multiline_comment|/*&n; * Flash memory access on SA11x0 based devices&n; * &n; * (C) 2000 Nicolas Pitre &lt;nico@cam.org&gt;&n; * &n; * $Id: sa1100-flash.c,v 1.28 2002/05/07 13:48:38 abz Exp $&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mtd/mtd.h&gt;
macro_line|#include &lt;linux/mtd/map.h&gt;
macro_line|#include &lt;linux/mtd/partitions.h&gt;
macro_line|#include &lt;linux/mtd/concat.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sizes.h&gt;
macro_line|#include &lt;asm/arch/h3600.h&gt;
macro_line|#ifndef CONFIG_ARCH_SA1100
macro_line|#error This is for SA1100 architecture only
macro_line|#endif
multiline_comment|/*&n; * This isnt complete yet, so...&n; */
DECL|macro|CONFIG_MTD_SA1100_STATICMAP
mdefine_line|#define CONFIG_MTD_SA1100_STATICMAP 1
DECL|function|sa1100_read8
r_static
id|__u8
id|sa1100_read8
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
id|readb
c_func
(paren
id|map-&gt;map_priv_1
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_read16
r_static
id|__u16
id|sa1100_read16
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
id|readw
c_func
(paren
id|map-&gt;map_priv_1
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_read32
r_static
id|__u32
id|sa1100_read32
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|ofs
)paren
(brace
r_return
id|readl
c_func
(paren
id|map-&gt;map_priv_1
op_plus
id|ofs
)paren
suffix:semicolon
)brace
DECL|function|sa1100_copy_from
r_static
r_void
id|sa1100_copy_from
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_void
op_star
id|to
comma
r_int
r_int
id|from
comma
id|ssize_t
id|len
)paren
(brace
id|memcpy
c_func
(paren
id|to
comma
(paren
r_void
op_star
)paren
(paren
id|map-&gt;map_priv_1
op_plus
id|from
)paren
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sa1100_write8
r_static
r_void
id|sa1100_write8
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u8
id|d
comma
r_int
r_int
id|adr
)paren
(brace
id|writeb
c_func
(paren
id|d
comma
id|map-&gt;map_priv_1
op_plus
id|adr
)paren
suffix:semicolon
)brace
DECL|function|sa1100_write16
r_static
r_void
id|sa1100_write16
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u16
id|d
comma
r_int
r_int
id|adr
)paren
(brace
id|writew
c_func
(paren
id|d
comma
id|map-&gt;map_priv_1
op_plus
id|adr
)paren
suffix:semicolon
)brace
DECL|function|sa1100_write32
r_static
r_void
id|sa1100_write32
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
id|__u32
id|d
comma
r_int
r_int
id|adr
)paren
(brace
id|writel
c_func
(paren
id|d
comma
id|map-&gt;map_priv_1
op_plus
id|adr
)paren
suffix:semicolon
)brace
DECL|function|sa1100_copy_to
r_static
r_void
id|sa1100_copy_to
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
r_int
id|to
comma
r_const
r_void
op_star
id|from
comma
id|ssize_t
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|map-&gt;map_priv_1
op_plus
id|to
)paren
comma
id|from
comma
id|len
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_struct
id|map_info
id|sa1100_map
id|__initdata
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SA1100 flash&quot;
comma
dot
id|read8
op_assign
id|sa1100_read8
comma
dot
id|read16
op_assign
id|sa1100_read16
comma
dot
id|read32
op_assign
id|sa1100_read32
comma
dot
id|copy_from
op_assign
id|sa1100_copy_from
comma
dot
id|write8
op_assign
id|sa1100_write8
comma
dot
id|write16
op_assign
id|sa1100_write16
comma
dot
id|write32
op_assign
id|sa1100_write32
comma
dot
id|copy_to
op_assign
id|sa1100_copy_to
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_MTD_SA1100_STATICMAP
multiline_comment|/*&n; * Here are partition information for all known SA1100-based devices.&n; * See include/linux/mtd/partitions.h for definition of the mtd_partition&n; * structure.&n; *&n; * Please note:&n; *  1. We no longer support static flash mappings via the machine io_desc&n; *     structure.&n; *  2. The flash size given should be the largest flash size that can&n; *     be accomodated.&n; *&n; * The MTD layer will detect flash chip aliasing and reduce the size of&n; * the map accordingly.&n; *&n; * Please keep these in alphabetical order, and formatted as per existing&n; * entries.  Thanks.&n; */
macro_line|#ifdef CONFIG_SA1100_ADSBITSY
DECL|variable|adsbitsy_partitions
r_static
r_struct
id|mtd_partition
id|adsbitsy_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;bootROM&quot;
comma
dot
id|size
op_assign
l_int|0x80000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;zImage&quot;
comma
dot
id|size
op_assign
l_int|0x100000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ramdisk.gz&quot;
comma
dot
id|size
op_assign
l_int|0x300000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_ASSABET
multiline_comment|/* Phase 4 Assabet has two 28F160B3 flash parts in bank 0: */
DECL|variable|assabet4_partitions
r_static
r_struct
id|mtd_partition
id|assabet4_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;bootloader&quot;
comma
dot
id|size
op_assign
l_int|0x00020000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootloader params&quot;
comma
dot
id|size
op_assign
l_int|0x00020000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;jffs&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* Phase 5 Assabet has two 28F128J3A flash parts in bank 0: */
DECL|variable|assabet5_partitions
r_static
r_struct
id|mtd_partition
id|assabet5_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;bootloader&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootloader params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;jffs&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
DECL|macro|assabet_partitions
mdefine_line|#define assabet_partitions&t;assabet5_partitions
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BADGE4
multiline_comment|/*&n; * 1 x Intel 28F320C3BA100 Advanced+ Boot Block Flash (32 Mi bit)&n; *   Eight 4 KiW Parameter Bottom Blocks (64 KiB)&n; *   Sixty-three 32 KiW Main Blocks (4032 Ki b)&n; */
DECL|variable|badge4_partitions
r_static
r_struct
id|mtd_partition
id|badge4_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;BLOB boot loader&quot;
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|size
op_assign
l_int|0x0000A000
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;params&quot;
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|size
op_assign
l_int|0x00006000
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|size
op_assign
l_int|0x00100000
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;root&quot;
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
macro_line|#ifdef CONFIG_SA1100_CERF_FLASH_32MB
DECL|variable|cerf_partitions
r_static
r_struct
id|mtd_partition
id|cerf_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00080000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;rootdisk&quot;
comma
dot
id|size
op_assign
l_int|0x01E80000
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
)brace
)brace
suffix:semicolon
macro_line|#elif defined CONFIG_SA1100_CERF_FLASH_16MB
DECL|variable|cerf_partitions
r_static
r_struct
id|mtd_partition
id|cerf_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00020000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;params&quot;
comma
dot
id|size
op_assign
l_int|0x00020000
comma
dot
id|offset
op_assign
l_int|0x00020000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;rootdisk&quot;
comma
dot
id|size
op_assign
l_int|0x00EC0000
comma
dot
id|offset
op_assign
l_int|0x00140000
comma
)brace
)brace
suffix:semicolon
macro_line|#elif defined CONFIG_SA1100_CERF_FLASH_8MB
macro_line|#   error &quot;Unwritten type definition&quot;
macro_line|#else
macro_line|#   error &quot;Undefined memory orientation for CERF in sa1100-flash.c&quot;
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CONSUS
DECL|variable|consus_partitions
r_static
r_struct
id|mtd_partition
id|consus_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;Consus boot firmware&quot;
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;Consus kernel&quot;
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;Consus disk&quot;
comma
dot
id|offset
op_assign
l_int|0x00140000
comma
multiline_comment|/* The rest (up to 16M) for jffs.  We could put 0 and&n;&t;&t;   make it find the size automatically, but right now&n;&t;&t;   i have 32 megs.  jffs will use all 32 megs if given&n;&t;&t;   the chance, and this leads to horrible problems&n;&t;&t;   when you try to re-flash the image because blob&n;&t;&t;   won&squot;t erase the whole partition. */
dot
id|size
op_assign
l_int|0x01000000
op_minus
l_int|0x00140000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
multiline_comment|/* this disk is a secondary disk, which can be used as&n;&t;&t;   needed, for simplicity, make it the size of the other&n;&t;&t;   consus partition, although realistically it could be&n;&t;&t;   the remainder of the disk (depending on the file&n;&t;&t;   system used) */
dot
id|name
op_assign
l_string|&quot;Consus disk2&quot;
comma
dot
id|offset
op_assign
l_int|0x01000000
comma
dot
id|size
op_assign
l_int|0x01000000
op_minus
l_int|0x00140000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FLEXANET
multiline_comment|/* Flexanet has two 28F128J3A flash parts in bank 0: */
DECL|macro|FLEXANET_FLASH_SIZE
mdefine_line|#define FLEXANET_FLASH_SIZE&t;&t;0x02000000
DECL|variable|flexanet_partitions
r_static
r_struct
id|mtd_partition
id|flexanet_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;bootloader&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootloader params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x000C0000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;altkernel&quot;
comma
dot
id|size
op_assign
l_int|0x000C0000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;root&quot;
comma
dot
id|size
op_assign
l_int|0x00400000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;free1&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;free2&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;free3&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
DECL|variable|freebird_partitions
r_static
r_struct
id|mtd_partition
id|freebird_partitions
(braket
)braket
op_assign
(brace
macro_line|#if CONFIG_SA1100_FREEBIRD_NEW
(brace
dot
id|name
op_assign
l_string|&quot;firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00080000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x000C0000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00100000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;root cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00200000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;usr cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00C00000
comma
dot
id|offset
op_assign
l_int|0x00500000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;local&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x01100000
comma
)brace
macro_line|#else
(brace
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|size
op_assign
l_int|0x000c0000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
l_int|0x00400000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
macro_line|#endif
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FRODO
multiline_comment|/* Frodo has 2 x 16M 28F128J3A flash chips in bank 0: */
DECL|variable|frodo_partitions
r_static
r_struct
id|mtd_partition
id|frodo_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;bootloader&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00000000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootloader params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ramdisk&quot;
comma
dot
id|size
op_assign
l_int|0x00400000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;file system&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
DECL|variable|graphicsclient_partitions
r_static
r_struct
id|mtd_partition
id|graphicsclient_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;zImage&quot;
comma
dot
id|size
op_assign
l_int|0x100000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ramdisk.gz&quot;
comma
dot
id|size
op_assign
l_int|0x300000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSMASTER
DECL|variable|graphicsmaster_partitions
r_static
r_struct
id|mtd_partition
id|graphicsmaster_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;zImage&quot;
comma
dot
id|size
op_assign
l_int|0x100000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ramdisk.gz&quot;
comma
dot
id|size
op_assign
l_int|0x300000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_H3XXX
DECL|variable|h3xxx_partitions
r_static
r_struct
id|mtd_partition
id|h3xxx_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;H3XXX boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
macro_line|#ifdef CONFIG_MTD_2PARTS_IPAQ
dot
id|name
op_assign
l_string|&quot;H3XXX root jffs2&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
macro_line|#else
dot
id|name
op_assign
l_string|&quot;H3XXX kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00080000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;H3XXX params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x000C0000
comma
)brace
comma
(brace
macro_line|#ifdef CONFIG_JFFS2_FS
dot
id|name
op_assign
l_string|&quot;H3XXX root jffs2&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x00100000
comma
macro_line|#else
dot
id|name
op_assign
l_string|&quot;H3XXX initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00100000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;H3XXX root cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00200000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;H3XXX usr cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00800000
comma
dot
id|offset
op_assign
l_int|0x00500000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;H3XXX usr local&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x00d00000
comma
macro_line|#endif
macro_line|#endif
)brace
)brace
suffix:semicolon
DECL|function|h3xxx_set_vpp
r_static
r_void
id|h3xxx_set_vpp
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
id|vpp
)paren
(brace
id|assign_h3600_egpio
c_func
(paren
id|IPAQ_EGPIO_VPP_ON
comma
id|vpp
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|h3xxx_set_vpp
mdefine_line|#define h3xxx_set_vpp NULL
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HACKKIT
DECL|variable|hackkit_partitions
r_static
r_struct
id|mtd_partition
id|hackkit_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;BLOB&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00000000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;config&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00180000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;rootfs&quot;
comma
dot
id|size
op_assign
l_int|0x700000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;data&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
DECL|variable|huw_webpanel_partitions
r_static
r_struct
id|mtd_partition
id|huw_webpanel_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;Loader&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;Sector 1&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_JORNADA720
DECL|variable|jornada720_partitions
r_static
r_struct
id|mtd_partition
id|jornada720_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 kernel&quot;
comma
dot
id|size
op_assign
l_int|0x000c0000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00100000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00140000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 root cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00240000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 usr cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00800000
comma
dot
id|offset
op_assign
l_int|0x00540000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;JORNADA720 usr local&quot;
comma
dot
id|size
op_assign
l_int|0
comma
multiline_comment|/* will expand to the end of the flash */
dot
id|offset
op_assign
l_int|0x00d00000
comma
)brace
)brace
suffix:semicolon
DECL|function|jornada720_set_vpp
r_static
r_void
id|jornada720_set_vpp
c_func
(paren
r_struct
id|map_info
op_star
id|map
comma
r_int
id|vpp
)paren
(brace
r_if
c_cond
(paren
id|vpp
)paren
id|PPSR
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|PPSR
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|PPDR
op_or_assign
l_int|0x80
suffix:semicolon
)brace
macro_line|#else
DECL|macro|jornada720_set_vpp
mdefine_line|#define jornada720_set_vpp NULL
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
DECL|variable|pangolin_partitions
r_static
r_struct
id|mtd_partition
id|pangolin_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00080000
comma
dot
id|offset
op_assign
l_int|0x00000000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00080000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00280000
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd-test&quot;
comma
dot
id|size
op_assign
l_int|0x03C00000
comma
dot
id|offset
op_assign
l_int|0x00400000
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PT_SYSTEM3
multiline_comment|/* erase size is 0x40000 == 256k partitions have to have this boundary */
DECL|variable|system3_partitions
r_static
r_struct
id|mtd_partition
id|system3_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;BLOB&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00000000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;config&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;root&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHANNON
DECL|variable|shannon_partitions
r_static
r_struct
id|mtd_partition
id|shannon_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;BLOB boot loader&quot;
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|size
op_assign
l_int|0x20000
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|size
op_assign
l_int|0xe0000
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd&quot;
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHERMAN
DECL|variable|sherman_partitions
r_static
r_struct
id|mtd_partition
id|sherman_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|size
op_assign
l_int|0x50000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|size
op_assign
l_int|0x70000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
l_int|0x600000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
l_int|0xA0000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SIMPAD
DECL|variable|simpad_partitions
r_static
r_struct
id|mtd_partition
id|simpad_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;SIMpad boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00080000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;SIMpad kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00080000
comma
)brace
comma
(brace
macro_line|#ifdef CONFIG_JFFS2_FS
dot
id|name
op_assign
l_string|&quot;SIMpad root jffs2&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
macro_line|#else
dot
id|name
op_assign
l_string|&quot;SIMpad initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;SIMpad root cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00480000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;SIMpad usr cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x005c0000
comma
dot
id|offset
op_assign
l_int|0x00780000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;SIMpad usr local&quot;
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
l_int|0x00d40000
comma
macro_line|#endif
)brace
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_SA1100_SIMPAD */
macro_line|#ifdef CONFIG_SA1100_STORK
DECL|variable|stork_partitions
r_static
r_struct
id|mtd_partition
id|stork_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;STORK boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;STORK params&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00040000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;STORK kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00080000
comma
)brace
comma
(brace
macro_line|#ifdef CONFIG_JFFS2_FS
dot
id|name
op_assign
l_string|&quot;STORK root jffs2&quot;
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
macro_line|#else
dot
id|name
op_assign
l_string|&quot;STORK initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x00180000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;STORK root cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00280000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;STORK usr cramfs&quot;
comma
dot
id|size
op_assign
l_int|0x00800000
comma
dot
id|offset
op_assign
l_int|0x00580000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;STORK usr local&quot;
comma
dot
id|offset
op_assign
l_int|0x00d80000
comma
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
macro_line|#endif
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_TRIZEPS
DECL|variable|trizeps_partitions
r_static
r_struct
id|mtd_partition
id|trizeps_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;Bootloader &amp; the kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00200000
comma
dot
id|offset
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;Data&quot;
comma
dot
id|size
op_assign
l_int|0x00400000
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
comma
(brace
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
comma
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_YOPY
DECL|variable|yopy_partitions
r_static
r_struct
id|mtd_partition
id|yopy_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;boot firmware&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x00000000
comma
dot
id|mask_flags
op_assign
id|MTD_WRITEABLE
comma
multiline_comment|/* force read-only */
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;kernel&quot;
comma
dot
id|size
op_assign
l_int|0x00080000
comma
dot
id|offset
op_assign
l_int|0x00080000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;initrd&quot;
comma
dot
id|size
op_assign
l_int|0x00300000
comma
dot
id|offset
op_assign
l_int|0x00100000
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;root&quot;
comma
dot
id|size
op_assign
l_int|0x01000000
comma
dot
id|offset
op_assign
l_int|0x00400000
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
DECL|function|sa1100_static_partitions
r_static
r_int
id|__init
id|sa1100_static_partitions
c_func
(paren
r_struct
id|mtd_partition
op_star
op_star
id|parts
)paren
(brace
r_int
id|nb_parts
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_SA1100_ADSBITSY
r_if
c_cond
(paren
id|machine_is_adsbitsy
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|adsbitsy_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|adsbitsy_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_ASSABET
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|assabet_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|assabet_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BADGE4
r_if
c_cond
(paren
id|machine_is_badge4
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|badge4_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|badge4_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|cerf_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|cerf_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CONSUS
r_if
c_cond
(paren
id|machine_is_consus
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|consus_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|consus_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FLEXANET
r_if
c_cond
(paren
id|machine_is_flexanet
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|flexanet_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|flexanet_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FREEBIRD
r_if
c_cond
(paren
id|machine_is_freebird
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|freebird_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|freebird_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_FRODO
r_if
c_cond
(paren
id|machine_is_frodo
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|frodo_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|frodo_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif&t;
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|graphicsclient_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|graphicsclient_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSMASTER
r_if
c_cond
(paren
id|machine_is_graphicsmaster
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|graphicsmaster_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|graphicsmaster_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_H3XXX
r_if
c_cond
(paren
id|machine_is_h3xxx
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|h3xxx_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|h3xxx_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HACKKIT
r_if
c_cond
(paren
id|machine_is_hackkit
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|hackkit_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|hackkit_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_HUW_WEBPANEL
r_if
c_cond
(paren
id|machine_is_huw_webpanel
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|huw_webpanel_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|huw_webpanel_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_JORNADA720
r_if
c_cond
(paren
id|machine_is_jornada720
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|jornada720_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|jornada720_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PANGOLIN
r_if
c_cond
(paren
id|machine_is_pangolin
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|pangolin_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|pangolin_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PT_SYSTEM3
r_if
c_cond
(paren
id|machine_is_pt_system3
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|system3_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|system3_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHANNON
r_if
c_cond
(paren
id|machine_is_shannon
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|shannon_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|shannon_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SHERMAN
r_if
c_cond
(paren
id|machine_is_sherman
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|sherman_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|sherman_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_SIMPAD
r_if
c_cond
(paren
id|machine_is_simpad
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|simpad_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|simpad_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_STORK
r_if
c_cond
(paren
id|machine_is_stork
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|stork_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|stork_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_TRIZEPS
r_if
c_cond
(paren
id|machine_is_trizeps
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|trizeps_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|trizeps_parititons
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_YOPY
r_if
c_cond
(paren
id|machine_is_yopy
c_func
(paren
)paren
)paren
(brace
op_star
id|parts
op_assign
id|yopy_partitions
suffix:semicolon
id|nb_parts
op_assign
id|ARRAY_SIZE
c_func
(paren
id|yopy_partitions
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|nb_parts
suffix:semicolon
)brace
macro_line|#endif
DECL|struct|sa_info
r_struct
id|sa_info
(brace
DECL|member|base
r_int
r_int
id|base
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|width
r_int
id|width
suffix:semicolon
DECL|member|vbase
r_void
op_star
id|vbase
suffix:semicolon
DECL|member|map
r_struct
id|map_info
op_star
id|map
suffix:semicolon
DECL|member|mtd
r_struct
id|mtd_info
op_star
id|mtd
suffix:semicolon
DECL|member|res
r_struct
id|resource
op_star
id|res
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|NR_SUBMTD
mdefine_line|#define NR_SUBMTD 4
DECL|variable|info
r_static
r_struct
id|sa_info
id|info
(braket
id|NR_SUBMTD
)braket
suffix:semicolon
DECL|function|sa1100_setup_mtd
r_static
r_int
id|__init
id|sa1100_setup_mtd
c_func
(paren
r_struct
id|sa_info
op_star
id|sa
comma
r_int
id|nr
comma
r_struct
id|mtd_info
op_star
op_star
id|rmtd
)paren
(brace
r_struct
id|mtd_info
op_star
id|subdev
(braket
id|nr
)braket
suffix:semicolon
r_struct
id|map_info
op_star
id|maps
suffix:semicolon
r_int
id|i
comma
id|found
op_assign
l_int|0
comma
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Allocate the map_info structs in one go.&n;&t; */
id|maps
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|map_info
)paren
op_star
id|nr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|maps
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * Claim and then map the memory regions.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|base
op_eq
(paren
r_int
r_int
)paren
op_minus
l_int|1
)paren
r_break
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|res
op_assign
id|request_mem_region
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|base
comma
id|sa
(braket
id|i
)braket
dot
id|size
comma
l_string|&quot;sa1100 flash&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sa
(braket
id|i
)braket
dot
id|res
)paren
(brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sa
(braket
id|i
)braket
dot
id|map
op_assign
id|maps
op_plus
id|i
suffix:semicolon
id|memcpy
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|map
comma
op_amp
id|sa1100_map
comma
r_sizeof
(paren
r_struct
id|map_info
)paren
)paren
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|vbase
op_assign
id|ioremap
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|base
comma
id|sa
(braket
id|i
)braket
dot
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sa
(braket
id|i
)braket
dot
id|map-&gt;map_priv_1
op_assign
(paren
r_int
r_int
)paren
id|sa
(braket
id|i
)braket
dot
id|vbase
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|map-&gt;buswidth
op_assign
id|sa
(braket
id|i
)braket
dot
id|width
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|map-&gt;size
op_assign
id|sa
(braket
id|i
)braket
dot
id|size
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Now let&squot;s probe for the actual flash.  Do it here since&n;&t;&t; * specific machine settings might have been set above.&n;&t;&t; */
id|sa
(braket
id|i
)braket
dot
id|mtd
op_assign
id|do_map_probe
c_func
(paren
l_string|&quot;cfi_probe&quot;
comma
id|sa
(braket
id|i
)braket
dot
id|map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|mtd
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sa
(braket
id|i
)braket
dot
id|mtd-&gt;module
op_assign
id|THIS_MODULE
suffix:semicolon
id|subdev
(braket
id|i
)braket
op_assign
id|sa
(braket
id|i
)braket
dot
id|mtd
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SA1100 flash: CFI device at 0x%08lx, %dMiB, &quot;
l_string|&quot;%d-bit&bslash;n&quot;
comma
id|sa
(braket
id|i
)braket
dot
id|base
comma
id|sa
(braket
id|i
)braket
dot
id|mtd-&gt;size
op_rshift
l_int|20
comma
id|sa
(braket
id|i
)braket
dot
id|width
op_star
l_int|8
)paren
suffix:semicolon
id|found
op_add_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * ENXIO is special.  It means we didn&squot;t find a chip when&n;&t; * we probed.  We need to tear down the mapping, free the&n;&t; * resource and mark it as such.&n;&t; */
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ENXIO
)paren
(brace
id|iounmap
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|vbase
op_assign
l_int|NULL
suffix:semicolon
id|release_resource
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|res
)paren
suffix:semicolon
id|sa
(braket
id|i
)braket
dot
id|res
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If we found one device, don&squot;t bother with concat support.&n;&t; * If we found multiple devices, use concat if we have it&n;&t; * available, otherwise fail.&n;&t; */
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
op_logical_or
id|ret
op_eq
op_minus
id|ENXIO
)paren
(brace
r_if
c_cond
(paren
id|found
op_eq
l_int|1
)paren
(brace
op_star
id|rmtd
op_assign
id|subdev
(braket
l_int|0
)braket
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|found
OG
l_int|1
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * We detected multiple devices.  Concatenate&n;&t;&t;&t; * them together.&n;&t;&t;&t; */
macro_line|#ifdef CONFIG_MTD_CONCAT
op_star
id|rmtd
op_assign
id|mtd_concat_create
c_func
(paren
id|subdev
comma
id|found
comma
l_string|&quot;sa1100 flash&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|rmtd
op_eq
l_int|NULL
)paren
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SA1100 flash: multiple devices &quot;
l_string|&quot;found but MTD concat support disabled.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
)brace
)brace
multiline_comment|/*&n;&t; * If we failed, clean up.&n;&t; */
r_if
c_cond
(paren
id|ret
)paren
(brace
r_do
(brace
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|mtd
)paren
id|map_destroy
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|mtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
id|iounmap
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|res
)paren
id|release_resource
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|res
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
op_decrement
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|maps
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sa1100_destroy_mtd
r_static
r_void
id|__exit
id|sa1100_destroy_mtd
c_func
(paren
r_struct
id|sa_info
op_star
id|sa
comma
r_struct
id|mtd_info
op_star
id|mtd
)paren
(brace
r_int
id|i
suffix:semicolon
id|del_mtd_partitions
c_func
(paren
id|mtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mtd
op_ne
id|sa
(braket
l_int|0
)braket
dot
id|mtd
)paren
id|mtd_concat_destroy
c_func
(paren
id|mtd
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|NR_SUBMTD
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|mtd
)paren
id|map_destroy
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|mtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
id|iounmap
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|vbase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sa
(braket
id|i
)braket
dot
id|res
)paren
id|release_resource
c_func
(paren
id|sa
(braket
id|i
)braket
dot
id|res
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|sa
(braket
l_int|0
)braket
dot
id|map
)paren
suffix:semicolon
)brace
DECL|function|sa1100_locate_flash
r_static
r_int
id|__init
id|sa1100_locate_flash
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|nr
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_adsbitsy
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
multiline_comment|/* neponset */
id|info
(braket
l_int|1
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_badge4
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_4M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_consus
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_flexanet
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_freebird
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_frodo
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_graphicsmaster
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_16M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_h3xxx
c_func
(paren
)paren
)paren
(brace
id|sa1100_map.set_vpp
op_assign
id|h3xxx_set_vpp
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_huw_webpanel
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_16M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_itsy
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_jornada720
c_func
(paren
)paren
)paren
(brace
id|sa1100_map.set_vpp
op_assign
id|jornada720_set_vpp
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_nanoengine
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_pangolin
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_64M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_pfs168
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_pleb
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_4M
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|size
op_assign
id|SZ_4M
suffix:semicolon
id|nr
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_pt_system3
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_16M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_shannon
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_4M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_sherman
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_simpad
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_stork
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_32M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_trizeps
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_16M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_victor
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_2M
suffix:semicolon
id|nr
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|machine_is_yopy
c_func
(paren
)paren
)paren
(brace
id|info
(braket
l_int|0
)braket
dot
id|base
op_assign
id|SA1100_CS0_PHYS
suffix:semicolon
id|info
(braket
l_int|0
)braket
dot
id|size
op_assign
id|SZ_64M
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|base
op_assign
id|SA1100_CS1_PHYS
suffix:semicolon
id|info
(braket
l_int|1
)braket
dot
id|size
op_assign
id|SZ_64M
suffix:semicolon
id|nr
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nr
OL
l_int|0
)paren
r_return
id|nr
suffix:semicolon
multiline_comment|/*&n;&t; * Retrieve the buswidth from the MSC registers.&n;&t; * We currently only implement CS0 and CS1 here.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|info
(braket
id|i
)braket
dot
id|base
)paren
(brace
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SA1100 flash: unknown base address &quot;
l_string|&quot;0x%08lx, assuming CS0&bslash;n&quot;
comma
id|info
(braket
id|i
)braket
dot
id|base
)paren
suffix:semicolon
r_case
id|SA1100_CS0_PHYS
suffix:colon
id|info
(braket
id|i
)braket
dot
id|width
op_assign
(paren
id|MSC0
op_amp
id|MSC_RBW
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SA1100_CS1_PHYS
suffix:colon
id|info
(braket
id|i
)braket
dot
id|width
op_assign
(paren
(paren
id|MSC0
op_rshift
l_int|16
)paren
op_amp
id|MSC_RBW
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|nr
suffix:semicolon
)brace
r_extern
r_int
id|parse_redboot_partitions
c_func
(paren
r_struct
id|mtd_info
op_star
id|master
comma
r_struct
id|mtd_partition
op_star
op_star
id|pparts
)paren
suffix:semicolon
r_extern
r_int
id|parse_cmdline_partitions
c_func
(paren
r_struct
id|mtd_info
op_star
id|master
comma
r_struct
id|mtd_partition
op_star
op_star
id|pparts
comma
r_char
op_star
)paren
suffix:semicolon
DECL|variable|parsed_parts
r_static
r_struct
id|mtd_partition
op_star
id|parsed_parts
suffix:semicolon
DECL|function|sa1100_locate_partitions
r_static
r_void
id|__init
id|sa1100_locate_partitions
c_func
(paren
r_struct
id|mtd_info
op_star
id|mtd
)paren
(brace
r_const
r_char
op_star
id|part_type
op_assign
l_int|NULL
suffix:semicolon
r_int
id|nr_parts
op_assign
l_int|0
suffix:semicolon
r_do
(brace
multiline_comment|/*&n;&t;&t; * Partition selection stuff.&n;&t;&t; */
macro_line|#ifdef CONFIG_MTD_CMDLINE_PARTS
id|nr_parts
op_assign
id|parse_cmdline_partitions
c_func
(paren
id|mtd
comma
op_amp
id|parsed_parts
comma
l_string|&quot;sa1100&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_parts
OG
l_int|0
)paren
(brace
id|part_type
op_assign
l_string|&quot;command line&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MTD_REDBOOT_PARTS
id|nr_parts
op_assign
id|parse_redboot_partitions
c_func
(paren
id|mtd
comma
op_amp
id|parsed_parts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_parts
OG
l_int|0
)paren
(brace
id|part_type
op_assign
l_string|&quot;RedBoot&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MTD_SA1100_STATICMAP
id|nr_parts
op_assign
id|sa1100_static_partitions
c_func
(paren
op_amp
id|parsed_parts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_parts
OG
l_int|0
)paren
(brace
id|part_type
op_assign
l_string|&quot;static&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
r_while
c_loop
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_parts
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;SA1100 flash: no partition info &quot;
l_string|&quot;available, registering whole flash&bslash;n&quot;
)paren
suffix:semicolon
id|add_mtd_device
c_func
(paren
id|mtd
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;SA1100 flash: using %s partition &quot;
l_string|&quot;definition&bslash;n&quot;
comma
id|part_type
)paren
suffix:semicolon
id|add_mtd_partitions
c_func
(paren
id|mtd
comma
id|parsed_parts
comma
id|nr_parts
)paren
suffix:semicolon
)brace
multiline_comment|/* Always succeeds. */
)brace
DECL|function|sa1100_destroy_partitions
r_static
r_void
id|__exit
id|sa1100_destroy_partitions
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|parsed_parts
)paren
id|kfree
c_func
(paren
id|parsed_parts
)paren
suffix:semicolon
)brace
DECL|variable|mymtd
r_static
r_struct
id|mtd_info
op_star
id|mymtd
suffix:semicolon
DECL|function|sa1100_mtd_init
r_static
r_int
id|__init
id|sa1100_mtd_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
id|nr
suffix:semicolon
id|nr
op_assign
id|sa1100_locate_flash
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr
OL
l_int|0
)paren
r_return
id|nr
suffix:semicolon
id|ret
op_assign
id|sa1100_setup_mtd
c_func
(paren
id|info
comma
id|nr
comma
op_amp
id|mymtd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|sa1100_locate_partitions
c_func
(paren
id|mymtd
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sa1100_mtd_cleanup
r_static
r_void
id|__exit
id|sa1100_mtd_cleanup
c_func
(paren
r_void
)paren
(brace
id|sa1100_destroy_mtd
c_func
(paren
id|info
comma
id|mymtd
)paren
suffix:semicolon
id|sa1100_destroy_partitions
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|sa1100_mtd_init
id|module_init
c_func
(paren
id|sa1100_mtd_init
)paren
suffix:semicolon
DECL|variable|sa1100_mtd_cleanup
id|module_exit
c_func
(paren
id|sa1100_mtd_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Nicolas Pitre&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SA1100 CFI map driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
