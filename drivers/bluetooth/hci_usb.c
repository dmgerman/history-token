multiline_comment|/* &n;   HCI USB driver for Linux Bluetooth protocol stack (BlueZ)&n;   Copyright (C) 2000-2001 Qualcomm Incorporated&n;   Written 2000,2001 by Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&n;&n;   Copyright (C) 2003 Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License version 2 as&n;   published by the Free Software Foundation;&n;&n;   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS&n;   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n;   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.&n;   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY&n;   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES &n;   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN &n;   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF &n;   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.&n;&n;   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, &n;   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS &n;   SOFTWARE IS DISCLAIMED.&n;*/
multiline_comment|/*&n; * Bluetooth HCI USB driver.&n; * Based on original USB Bluetooth driver for Linux kernel&n; *    Copyright (c) 2000 Greg Kroah-Hartman        &lt;greg@kroah.com&gt;&n; *    Copyright (c) 2000 Mark Douglas Corner       &lt;mcorner@umich.edu&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;net/bluetooth/bluetooth.h&gt;
macro_line|#include &lt;net/bluetooth/hci_core.h&gt;
macro_line|#include &quot;hci_usb.h&quot;
macro_line|#ifndef CONFIG_BT_HCIUSB_DEBUG
DECL|macro|BT_DBG
macro_line|#undef  BT_DBG
DECL|macro|BT_DBG
mdefine_line|#define BT_DBG(D...)
DECL|macro|BT_DMP
macro_line|#undef  BT_DMP
DECL|macro|BT_DMP
mdefine_line|#define BT_DMP(D...)
macro_line|#endif
macro_line|#ifndef CONFIG_BT_HCIUSB_ZERO_PACKET
DECL|macro|URB_ZERO_PACKET
macro_line|#undef  URB_ZERO_PACKET
DECL|macro|URB_ZERO_PACKET
mdefine_line|#define URB_ZERO_PACKET 0
macro_line|#endif
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
DECL|variable|isoc
r_static
r_int
id|isoc
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;2.7&quot;
DECL|variable|hci_usb_driver
r_static
r_struct
id|usb_driver
id|hci_usb_driver
suffix:semicolon
DECL|variable|bluetooth_ids
r_static
r_struct
id|usb_device_id
id|bluetooth_ids
(braket
)braket
op_assign
(brace
multiline_comment|/* Generic Bluetooth USB device */
(brace
id|USB_DEVICE_INFO
c_func
(paren
id|HCI_DEV_CLASS
comma
id|HCI_DEV_SUBCLASS
comma
id|HCI_DEV_PROTOCOL
)paren
)brace
comma
multiline_comment|/* AVM BlueFRITZ! USB v2.0 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x057c
comma
l_int|0x3800
)paren
)brace
comma
multiline_comment|/* Bluetooth Ultraport Module from IBM */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x04bf
comma
l_int|0x030a
)paren
)brace
comma
multiline_comment|/* ALPS Modules with non-standard id */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x044e
comma
l_int|0x3001
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x044e
comma
l_int|0x3002
)paren
)brace
comma
multiline_comment|/* Ericsson with non-standard id */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0bdb
comma
l_int|0x1002
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|bluetooth_ids
)paren
suffix:semicolon
DECL|variable|blacklist_ids
r_static
r_struct
id|usb_device_id
id|blacklist_ids
(braket
)braket
op_assign
(brace
multiline_comment|/* Broadcom BCM2033 without firmware */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0a5c
comma
l_int|0x2033
)paren
comma
dot
id|driver_info
op_assign
id|HCI_IGNORE
)brace
comma
multiline_comment|/* Broadcom BCM2035 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0a5c
comma
l_int|0x2009
)paren
comma
dot
id|driver_info
op_assign
id|HCI_RESET
op_or
id|HCI_BROKEN_ISOC
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0a5c
comma
l_int|0x200a
)paren
comma
dot
id|driver_info
op_assign
id|HCI_RESET
op_or
id|HCI_BROKEN_ISOC
)brace
comma
multiline_comment|/* Microsoft Wireless Transceiver for Bluetooth 2.0 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x045e
comma
l_int|0x009c
)paren
comma
dot
id|driver_info
op_assign
id|HCI_RESET
op_or
id|HCI_BROKEN_ISOC
)brace
comma
multiline_comment|/* ISSC Bluetooth Adapter v3.1 */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x1131
comma
l_int|0x1001
)paren
comma
dot
id|driver_info
op_assign
id|HCI_RESET
)brace
comma
multiline_comment|/* Digianswer devices */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x08fd
comma
l_int|0x0001
)paren
comma
dot
id|driver_info
op_assign
id|HCI_DIGIANSWER
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x08fd
comma
l_int|0x0002
)paren
comma
dot
id|driver_info
op_assign
id|HCI_IGNORE
)brace
comma
multiline_comment|/* RTX Telecom based adapter with buggy SCO support */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0400
comma
l_int|0x0807
)paren
comma
dot
id|driver_info
op_assign
id|HCI_BROKEN_ISOC
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
DECL|function|_urb_alloc
r_static
r_struct
id|_urb
op_star
id|_urb_alloc
c_func
(paren
r_int
id|isoc
comma
r_int
id|gfp
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|_urb
)paren
op_plus
r_sizeof
(paren
r_struct
id|usb_iso_packet_descriptor
)paren
op_star
id|isoc
comma
id|gfp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_urb
)paren
(brace
id|memset
c_func
(paren
id|_urb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|_urb
)paren
)paren
suffix:semicolon
id|usb_init_urb
c_func
(paren
op_amp
id|_urb-&gt;urb
)paren
suffix:semicolon
)brace
r_return
id|_urb
suffix:semicolon
)brace
DECL|function|_urb_dequeue
r_static
r_struct
id|_urb
op_star
id|_urb_dequeue
c_func
(paren
r_struct
id|_urb_queue
op_star
id|q
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;lock
comma
id|flags
)paren
suffix:semicolon
(brace
r_struct
id|list_head
op_star
id|head
op_assign
op_amp
id|q-&gt;head
suffix:semicolon
r_struct
id|list_head
op_star
id|next
op_assign
id|head-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|next
op_ne
id|head
)paren
(brace
id|_urb
op_assign
id|list_entry
c_func
(paren
id|next
comma
r_struct
id|_urb
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
id|next
)paren
suffix:semicolon
id|_urb-&gt;queue
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|_urb
suffix:semicolon
)brace
r_static
r_void
id|hci_usb_rx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|hci_usb_tx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|macro|__pending_tx
mdefine_line|#define __pending_tx(husb, type)  (&amp;husb-&gt;pending_tx[type-1])
DECL|macro|__pending_q
mdefine_line|#define __pending_q(husb, type)   (&amp;husb-&gt;pending_q[type-1])
DECL|macro|__completed_q
mdefine_line|#define __completed_q(husb, type) (&amp;husb-&gt;completed_q[type-1])
DECL|macro|__transmit_q
mdefine_line|#define __transmit_q(husb, type)  (&amp;husb-&gt;transmit_q[type-1])
DECL|macro|__reassembly
mdefine_line|#define __reassembly(husb, type)  (husb-&gt;reassembly[type-1])
DECL|function|__get_completed
r_static
r_inline
r_struct
id|_urb
op_star
id|__get_completed
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_int
id|type
)paren
(brace
r_return
id|_urb_dequeue
c_func
(paren
id|__completed_q
c_func
(paren
id|husb
comma
id|type
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
DECL|function|__fill_isoc_desc
r_static
r_void
id|__fill_isoc_desc
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_int
id|len
comma
r_int
id|mtu
)paren
(brace
r_int
id|offset
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;len %d mtu %d&quot;
comma
id|len
comma
id|mtu
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HCI_MAX_ISOC_FRAMES
op_logical_and
id|len
op_ge
id|mtu
suffix:semicolon
id|i
op_increment
comma
id|offset
op_add_assign
id|mtu
comma
id|len
op_sub_assign
id|mtu
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offset
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
id|mtu
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;desc %d offset %d len %d&quot;
comma
id|i
comma
id|offset
comma
id|mtu
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_logical_and
id|i
OL
id|HCI_MAX_ISOC_FRAMES
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
op_assign
id|offset
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|length
op_assign
id|len
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;desc %d offset %d len %d&quot;
comma
id|i
comma
id|offset
comma
id|len
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|urb-&gt;number_of_packets
op_assign
id|i
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hci_usb_intr_rx_submit
r_static
r_int
id|hci_usb_intr_rx_submit
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|err
comma
id|pipe
comma
id|interval
comma
id|size
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev-&gt;name
)paren
suffix:semicolon
id|size
op_assign
id|husb-&gt;intr_in_ep-&gt;desc.wMaxPacketSize
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|_urb-&gt;type
op_assign
id|HCI_EVENT_PKT
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__pending_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;intr_in_ep-&gt;desc.bEndpointAddress
)paren
suffix:semicolon
id|interval
op_assign
id|husb-&gt;intr_in_ep-&gt;desc.bInterval
suffix:semicolon
id|usb_fill_int_urb
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|buf
comma
id|size
comma
id|hci_usb_rx_complete
comma
id|husb
comma
id|interval
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s intr rx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|_urb_unlink
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|_urb_free
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_bulk_rx_submit
r_static
r_int
id|hci_usb_bulk_rx_submit
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|err
comma
id|pipe
comma
id|size
op_assign
id|HCI_MAX_FRAME_SIZE
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|_urb-&gt;type
op_assign
id|HCI_ACLDATA_PKT
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__pending_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;bulk_in_ep-&gt;desc.bEndpointAddress
)paren
suffix:semicolon
id|usb_fill_bulk_urb
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|buf
comma
id|size
comma
id|hci_usb_rx_complete
comma
id|husb
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s bulk rx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|_urb_unlink
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|_urb_free
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
DECL|function|hci_usb_isoc_rx_submit
r_static
r_int
id|hci_usb_isoc_rx_submit
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|err
comma
id|mtu
comma
id|size
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
id|mtu
op_assign
id|husb-&gt;isoc_in_ep-&gt;desc.wMaxPacketSize
suffix:semicolon
id|size
op_assign
id|mtu
op_star
id|HCI_MAX_ISOC_FRAMES
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
id|HCI_MAX_ISOC_FRAMES
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|_urb-&gt;type
op_assign
id|HCI_SCODATA_PKT
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__pending_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|urb-&gt;context
op_assign
id|husb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|husb-&gt;udev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;isoc_in_ep-&gt;desc.bEndpointAddress
)paren
suffix:semicolon
id|urb-&gt;complete
op_assign
id|hci_usb_rx_complete
suffix:semicolon
id|urb-&gt;interval
op_assign
id|husb-&gt;isoc_in_ep-&gt;desc.bInterval
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|size
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|buf
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ISO_ASAP
suffix:semicolon
id|__fill_isoc_desc
c_func
(paren
id|urb
comma
id|size
comma
id|mtu
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s isoc rx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|_urb_unlink
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|_urb_free
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Initialize device */
DECL|function|hci_usb_open
r_static
r_int
id|hci_usb_open
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
id|err
op_assign
id|hci_usb_intr_rx_submit
c_func
(paren
id|husb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HCI_MAX_BULK_RX
suffix:semicolon
id|i
op_increment
)paren
id|hci_usb_bulk_rx_submit
c_func
(paren
id|husb
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
r_if
c_cond
(paren
id|husb-&gt;isoc_iface
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HCI_MAX_ISOC_RX
suffix:semicolon
id|i
op_increment
)paren
id|hci_usb_isoc_rx_submit
c_func
(paren
id|husb
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|clear_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Reset device */
DECL|function|hci_usb_flush
r_static
r_int
id|hci_usb_flush
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|skb_queue_purge
c_func
(paren
op_amp
id|husb-&gt;transmit_q
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_unlink_urbs
r_static
r_void
id|hci_usb_unlink_urbs
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_int
id|i
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
multiline_comment|/* Kill pending requests */
r_while
c_loop
(paren
(paren
id|_urb
op_assign
id|_urb_dequeue
c_func
(paren
op_amp
id|husb-&gt;pending_q
(braket
id|i
)braket
)paren
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s unlinking _urb %p type %d urb %p&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|_urb
comma
id|_urb-&gt;type
comma
id|urb
)paren
suffix:semicolon
id|usb_kill_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__completed_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
)brace
multiline_comment|/* Release completed requests */
r_while
c_loop
(paren
(paren
id|_urb
op_assign
id|_urb_dequeue
c_func
(paren
op_amp
id|husb-&gt;completed_q
(braket
id|i
)braket
)paren
)paren
)paren
(brace
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s freeing _urb %p type %d urb %p&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|_urb
comma
id|_urb-&gt;type
comma
id|urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;setup_packet
)paren
id|kfree
c_func
(paren
id|urb-&gt;setup_packet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;transfer_buffer
)paren
id|kfree
c_func
(paren
id|urb-&gt;transfer_buffer
)paren
suffix:semicolon
id|_urb_free
c_func
(paren
id|_urb
)paren
suffix:semicolon
)brace
multiline_comment|/* Release reassembly buffers */
r_if
c_cond
(paren
id|husb-&gt;reassembly
(braket
id|i
)braket
)paren
(brace
id|kfree_skb
c_func
(paren
id|husb-&gt;reassembly
(braket
id|i
)braket
)paren
suffix:semicolon
id|husb-&gt;reassembly
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Close device */
DECL|function|hci_usb_close
r_static
r_int
id|hci_usb_close
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_clear_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Synchronize with completion handlers */
id|write_lock_irqsave
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
id|hci_usb_unlink_urbs
c_func
(paren
id|husb
)paren
suffix:semicolon
id|hci_usb_flush
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__tx_submit
r_static
r_int
id|__tx_submit
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|_urb
op_star
id|_urb
)paren
(brace
r_struct
id|urb
op_star
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p type %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
comma
id|_urb-&gt;type
)paren
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__pending_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s tx submit failed urb %p type %d err %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|urb
comma
id|_urb-&gt;type
comma
id|err
)paren
suffix:semicolon
id|_urb_unlink
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__completed_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
)brace
r_else
id|atomic_inc
c_func
(paren
id|__pending_tx
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_send_ctrl
r_static
r_inline
r_int
id|hci_usb_send_ctrl
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|__get_completed
c_func
(paren
id|husb
comma
id|skb-&gt;pkt_type
)paren
suffix:semicolon
r_struct
id|usb_ctrlrequest
op_star
id|dr
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb-&gt;type
op_assign
id|skb-&gt;pkt_type
suffix:semicolon
id|dr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|dr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dr
)paren
(brace
id|_urb_free
c_func
(paren
id|_urb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_else
id|dr
op_assign
(paren
r_void
op_star
)paren
id|_urb-&gt;urb.setup_packet
suffix:semicolon
id|dr-&gt;bRequestType
op_assign
id|husb-&gt;ctrl_req
suffix:semicolon
id|dr-&gt;bRequest
op_assign
l_int|0
suffix:semicolon
id|dr-&gt;wIndex
op_assign
l_int|0
suffix:semicolon
id|dr-&gt;wValue
op_assign
l_int|0
suffix:semicolon
id|dr-&gt;wLength
op_assign
id|__cpu_to_le16
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|usb_fill_control_urb
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|usb_sndctrlpipe
c_func
(paren
id|husb-&gt;udev
comma
l_int|0
)paren
comma
(paren
r_void
op_star
)paren
id|dr
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|hci_usb_tx_complete
comma
id|husb
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s skb %p len %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|_urb-&gt;priv
op_assign
id|skb
suffix:semicolon
r_return
id|__tx_submit
c_func
(paren
id|husb
comma
id|_urb
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_send_bulk
r_static
r_inline
r_int
id|hci_usb_send_bulk
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|__get_completed
c_func
(paren
id|husb
comma
id|skb-&gt;pkt_type
)paren
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|pipe
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb-&gt;type
op_assign
id|skb-&gt;pkt_type
suffix:semicolon
)brace
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;bulk_out_ep-&gt;desc.bEndpointAddress
)paren
suffix:semicolon
id|usb_fill_bulk_urb
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|hci_usb_tx_complete
comma
id|husb
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ZERO_PACKET
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s skb %p len %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|_urb-&gt;priv
op_assign
id|skb
suffix:semicolon
r_return
id|__tx_submit
c_func
(paren
id|husb
comma
id|_urb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
DECL|function|hci_usb_send_isoc
r_static
r_inline
r_int
id|hci_usb_send_isoc
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|__get_completed
c_func
(paren
id|husb
comma
id|skb-&gt;pkt_type
)paren
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
(brace
id|_urb
op_assign
id|_urb_alloc
c_func
(paren
id|HCI_MAX_ISOC_FRAMES
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|_urb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|_urb-&gt;type
op_assign
id|skb-&gt;pkt_type
suffix:semicolon
)brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s skb %p len %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|urb
op_assign
op_amp
id|_urb-&gt;urb
suffix:semicolon
id|urb-&gt;context
op_assign
id|husb
suffix:semicolon
id|urb-&gt;dev
op_assign
id|husb-&gt;udev
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|usb_sndisocpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;isoc_out_ep-&gt;desc.bEndpointAddress
)paren
suffix:semicolon
id|urb-&gt;complete
op_assign
id|hci_usb_tx_complete
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ISO_ASAP
suffix:semicolon
id|urb-&gt;interval
op_assign
id|husb-&gt;isoc_out_ep-&gt;desc.bInterval
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|skb-&gt;data
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|skb-&gt;len
suffix:semicolon
id|__fill_isoc_desc
c_func
(paren
id|urb
comma
id|skb-&gt;len
comma
id|husb-&gt;isoc_out_ep-&gt;desc.wMaxPacketSize
)paren
suffix:semicolon
id|_urb-&gt;priv
op_assign
id|skb
suffix:semicolon
r_return
id|__tx_submit
c_func
(paren
id|husb
comma
id|_urb
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hci_usb_tx_process
r_static
r_void
id|hci_usb_tx_process
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|sk_buff_head
op_star
id|q
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev-&gt;name
)paren
suffix:semicolon
r_do
(brace
id|clear_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
multiline_comment|/* Process command queue */
id|q
op_assign
id|__transmit_q
c_func
(paren
id|husb
comma
id|HCI_COMMAND_PKT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
id|__pending_tx
c_func
(paren
id|husb
comma
id|HCI_COMMAND_PKT
)paren
)paren
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|q
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hci_usb_send_ctrl
c_func
(paren
id|husb
comma
id|skb
)paren
OL
l_int|0
)paren
id|skb_queue_head
c_func
(paren
id|q
comma
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
multiline_comment|/* Process SCO queue */
id|q
op_assign
id|__transmit_q
c_func
(paren
id|husb
comma
id|HCI_SCODATA_PKT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
id|__pending_tx
c_func
(paren
id|husb
comma
id|HCI_SCODATA_PKT
)paren
)paren
OL
id|HCI_MAX_ISOC_TX
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|q
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hci_usb_send_isoc
c_func
(paren
id|husb
comma
id|skb
)paren
OL
l_int|0
)paren
id|skb_queue_head
c_func
(paren
id|q
comma
id|skb
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Process ACL queue */
id|q
op_assign
id|__transmit_q
c_func
(paren
id|husb
comma
id|HCI_ACLDATA_PKT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
id|__pending_tx
c_func
(paren
id|husb
comma
id|HCI_ACLDATA_PKT
)paren
)paren
OL
id|HCI_MAX_BULK_TX
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|q
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hci_usb_send_bulk
c_func
(paren
id|husb
comma
id|skb
)paren
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
id|q
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|test_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|hci_usb_tx_wakeup
r_static
r_inline
r_void
id|hci_usb_tx_wakeup
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
multiline_comment|/* Serialize TX queue processing to avoid data reordering */
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|HCI_USB_TX_PROCESS
comma
op_amp
id|husb-&gt;state
)paren
)paren
(brace
id|hci_usb_tx_process
c_func
(paren
id|husb
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_USB_TX_PROCESS
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
r_else
id|set_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
multiline_comment|/* Send frames from HCI layer */
DECL|function|hci_usb_send_frame
r_static
r_int
id|hci_usb_send_frame
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_dev
op_star
id|hdev
op_assign
(paren
r_struct
id|hci_dev
op_star
)paren
id|skb-&gt;dev
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdev
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;frame for uknown device (hdev=NULL)&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s type %d len %d&quot;
comma
id|hdev-&gt;name
comma
id|skb-&gt;pkt_type
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_switch
c_cond
(paren
id|skb-&gt;pkt_type
)paren
(brace
r_case
id|HCI_COMMAND_PKT
suffix:colon
id|hdev-&gt;stat.cmd_tx
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_ACLDATA_PKT
suffix:colon
id|hdev-&gt;stat.acl_tx
op_increment
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
r_case
id|HCI_SCODATA_PKT
suffix:colon
id|hdev-&gt;stat.sco_tx
op_increment
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
id|__transmit_q
c_func
(paren
id|husb
comma
id|skb-&gt;pkt_type
)paren
comma
id|skb
)paren
suffix:semicolon
id|hci_usb_tx_wakeup
c_func
(paren
id|husb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__recv_frame
r_static
r_inline
r_int
id|__recv_frame
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_int
id|type
comma
r_void
op_star
id|data
comma
r_int
id|count
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s type %d data %p count %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|type
comma
id|data
comma
id|count
)paren
suffix:semicolon
id|husb-&gt;hdev-&gt;stat.byte_rx
op_add_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|__reassembly
c_func
(paren
id|husb
comma
id|type
)paren
suffix:semicolon
r_struct
(brace
r_int
id|expect
suffix:semicolon
)brace
op_star
id|scb
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
multiline_comment|/* Start of the frame */
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|HCI_EVENT_PKT
suffix:colon
r_if
c_cond
(paren
id|count
op_ge
id|HCI_EVENT_HDR_SIZE
)paren
(brace
r_struct
id|hci_event_hdr
op_star
id|h
op_assign
id|data
suffix:semicolon
id|len
op_assign
id|HCI_EVENT_HDR_SIZE
op_plus
id|h-&gt;plen
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EILSEQ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_ACLDATA_PKT
suffix:colon
r_if
c_cond
(paren
id|count
op_ge
id|HCI_ACL_HDR_SIZE
)paren
(brace
r_struct
id|hci_acl_hdr
op_star
id|h
op_assign
id|data
suffix:semicolon
id|len
op_assign
id|HCI_ACL_HDR_SIZE
op_plus
id|__le16_to_cpu
c_func
(paren
id|h-&gt;dlen
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EILSEQ
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
r_case
id|HCI_SCODATA_PKT
suffix:colon
r_if
c_cond
(paren
id|count
op_ge
id|HCI_SCO_HDR_SIZE
)paren
(brace
r_struct
id|hci_sco_hdr
op_star
id|h
op_assign
id|data
suffix:semicolon
id|len
op_assign
id|HCI_SCO_HDR_SIZE
op_plus
id|h-&gt;dlen
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EILSEQ
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|BT_DBG
c_func
(paren
l_string|&quot;new packet len %d&quot;
comma
id|len
)paren
suffix:semicolon
id|skb
op_assign
id|bt_skb_alloc
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s no memory for the packet&quot;
comma
id|husb-&gt;hdev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
(paren
r_void
op_star
)paren
id|husb-&gt;hdev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|type
suffix:semicolon
id|__reassembly
c_func
(paren
id|husb
comma
id|type
)paren
op_assign
id|skb
suffix:semicolon
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|scb-&gt;expect
op_assign
id|len
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Continuation */
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|len
op_assign
id|scb-&gt;expect
suffix:semicolon
)brace
id|len
op_assign
id|min
c_func
(paren
id|len
comma
id|count
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|data
comma
id|len
)paren
suffix:semicolon
id|scb-&gt;expect
op_sub_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scb-&gt;expect
)paren
(brace
multiline_comment|/* Complete frame */
id|__reassembly
c_func
(paren
id|husb
comma
id|type
)paren
op_assign
l_int|NULL
suffix:semicolon
id|hci_recv_frame
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|count
op_sub_assign
id|len
suffix:semicolon
id|data
op_add_assign
id|len
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_rx_complete
r_static
r_void
id|hci_usb_rx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|container_of
c_func
(paren
id|urb
comma
r_struct
id|_urb
comma
id|urb
)paren
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_void
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
op_assign
id|husb-&gt;hdev
suffix:semicolon
r_int
id|err
comma
id|count
op_assign
id|urb-&gt;actual_length
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p type %d status %d count %d flags %x&quot;
comma
id|hdev-&gt;name
comma
id|urb
comma
id|_urb-&gt;type
comma
id|urb-&gt;status
comma
id|count
comma
id|urb-&gt;transfer_flags
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_goto
id|unlock
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_logical_or
op_logical_neg
id|count
)paren
r_goto
id|resubmit
suffix:semicolon
r_if
c_cond
(paren
id|_urb-&gt;type
op_eq
id|HCI_SCODATA_PKT
)paren
(brace
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|urb-&gt;number_of_packets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;desc %d status %d offset %d len %d&quot;
comma
id|i
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|status
)paren
id|__recv_frame
c_func
(paren
id|husb
comma
id|_urb-&gt;type
comma
id|urb-&gt;transfer_buffer
op_plus
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|offset
comma
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
dot
id|actual_length
)paren
suffix:semicolon
)brace
macro_line|#else
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|err
op_assign
id|__recv_frame
c_func
(paren
id|husb
comma
id|_urb-&gt;type
comma
id|urb-&gt;transfer_buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s corrupted packet: type %d count %d&quot;
comma
id|husb-&gt;hdev-&gt;name
comma
id|_urb-&gt;type
comma
id|count
)paren
suffix:semicolon
id|hdev-&gt;stat.err_rx
op_increment
suffix:semicolon
)brace
)brace
id|resubmit
suffix:colon
id|urb-&gt;dev
op_assign
id|husb-&gt;udev
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p type %d resubmit status %d&quot;
comma
id|hdev-&gt;name
comma
id|urb
comma
id|_urb-&gt;type
comma
id|err
)paren
suffix:semicolon
id|unlock
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_tx_complete
r_static
r_void
id|hci_usb_tx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|_urb
op_star
id|_urb
op_assign
id|container_of
c_func
(paren
id|urb
comma
r_struct
id|_urb
comma
id|urb
)paren
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_void
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
op_assign
id|husb-&gt;hdev
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p status %d flags %x&quot;
comma
id|hdev-&gt;name
comma
id|urb
comma
id|urb-&gt;status
comma
id|urb-&gt;transfer_flags
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
id|__pending_tx
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
)paren
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
l_int|NULL
suffix:semicolon
id|kfree_skb
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
id|_urb-&gt;priv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb-&gt;status
)paren
id|hdev-&gt;stat.byte_tx
op_add_assign
id|urb-&gt;transfer_buffer_length
suffix:semicolon
r_else
id|hdev-&gt;stat.err_tx
op_increment
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
id|_urb_unlink
c_func
(paren
id|_urb
)paren
suffix:semicolon
id|_urb_queue_tail
c_func
(paren
id|__completed_q
c_func
(paren
id|husb
comma
id|_urb-&gt;type
)paren
comma
id|_urb
)paren
suffix:semicolon
id|hci_usb_tx_wakeup
c_func
(paren
id|husb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_destruct
r_static
r_void
id|hci_usb_destruct
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|husb
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_notify
r_static
r_void
id|hci_usb_notify
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
comma
r_int
r_int
id|evt
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s evt %d&quot;
comma
id|hdev-&gt;name
comma
id|evt
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_probe
r_static
r_int
id|hci_usb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|bulk_out_ep
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|bulk_in_ep
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|intr_in_ep
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|ep
suffix:semicolon
r_struct
id|usb_host_interface
op_star
id|uif
suffix:semicolon
r_struct
id|usb_interface
op_star
id|isoc_iface
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
suffix:semicolon
r_int
id|i
comma
id|e
comma
id|size
comma
id|isoc_ifnum
comma
id|isoc_alts
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;udev %p intf %p&quot;
comma
id|udev
comma
id|intf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id-&gt;driver_info
)paren
(brace
r_const
r_struct
id|usb_device_id
op_star
id|match
suffix:semicolon
id|match
op_assign
id|usb_match_id
c_func
(paren
id|intf
comma
id|blacklist_ids
)paren
suffix:semicolon
r_if
c_cond
(paren
id|match
)paren
id|id
op_assign
id|match
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id-&gt;driver_info
op_amp
id|HCI_IGNORE
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|intf-&gt;cur_altsetting-&gt;desc.bInterfaceNumber
OG
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Find endpoints that we need */
id|uif
op_assign
id|intf-&gt;cur_altsetting
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|uif-&gt;desc.bNumEndpoints
suffix:semicolon
id|e
op_increment
)paren
(brace
id|ep
op_assign
op_amp
id|uif-&gt;endpoint
(braket
id|e
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ep-&gt;desc.bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
(brace
r_case
id|USB_ENDPOINT_XFER_INT
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;desc.bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|intr_in_ep
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
r_case
id|USB_ENDPOINT_XFER_BULK
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;desc.bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|bulk_in_ep
op_assign
id|ep
suffix:semicolon
r_else
id|bulk_out_ep
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|bulk_in_ep
op_logical_or
op_logical_neg
id|bulk_out_ep
op_logical_or
op_logical_neg
id|intr_in_ep
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;Bulk endpoints not found&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|husb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hci_usb
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t allocate: control structure&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|memset
c_func
(paren
id|husb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hci_usb
)paren
)paren
suffix:semicolon
id|husb-&gt;udev
op_assign
id|udev
suffix:semicolon
id|husb-&gt;bulk_out_ep
op_assign
id|bulk_out_ep
suffix:semicolon
id|husb-&gt;bulk_in_ep
op_assign
id|bulk_in_ep
suffix:semicolon
id|husb-&gt;intr_in_ep
op_assign
id|intr_in_ep
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_info
op_amp
id|HCI_DIGIANSWER
)paren
id|husb-&gt;ctrl_req
op_assign
id|USB_TYPE_VENDOR
suffix:semicolon
r_else
id|husb-&gt;ctrl_req
op_assign
id|USB_TYPE_CLASS
suffix:semicolon
multiline_comment|/* Find isochronous endpoints that we can use */
id|size
op_assign
l_int|0
suffix:semicolon
id|isoc_iface
op_assign
l_int|NULL
suffix:semicolon
id|isoc_alts
op_assign
l_int|0
suffix:semicolon
id|isoc_ifnum
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
r_if
c_cond
(paren
id|isoc
op_logical_and
op_logical_neg
(paren
id|id-&gt;driver_info
op_amp
id|HCI_BROKEN_ISOC
)paren
)paren
id|isoc_iface
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|udev
comma
id|isoc_ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isoc_iface
)paren
(brace
r_int
id|a
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|isoc_out_ep
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|usb_host_endpoint
op_star
id|isoc_in_ep
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|a
op_assign
l_int|0
suffix:semicolon
id|a
OL
id|isoc_iface-&gt;num_altsetting
suffix:semicolon
id|a
op_increment
)paren
(brace
id|uif
op_assign
op_amp
id|isoc_iface-&gt;altsetting
(braket
id|a
)braket
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|uif-&gt;desc.bNumEndpoints
suffix:semicolon
id|e
op_increment
)paren
(brace
id|ep
op_assign
op_amp
id|uif-&gt;endpoint
(braket
id|e
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ep-&gt;desc.bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
(brace
r_case
id|USB_ENDPOINT_XFER_ISOC
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;desc.wMaxPacketSize
template_param
l_int|2
)paren
r_break
suffix:semicolon
id|size
op_assign
id|ep-&gt;desc.wMaxPacketSize
suffix:semicolon
id|isoc_alts
op_assign
id|uif-&gt;desc.bAlternateSetting
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;desc.bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|isoc_in_ep
op_assign
id|ep
suffix:semicolon
r_else
id|isoc_out_ep
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|isoc_in_ep
op_logical_or
op_logical_neg
id|isoc_out_ep
)paren
id|BT_DBG
c_func
(paren
l_string|&quot;Isoc endpoints not found&quot;
)paren
suffix:semicolon
r_else
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;isoc ifnum %d alts %d&quot;
comma
id|isoc_ifnum
comma
id|isoc_alts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_driver_claim_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|isoc_iface
comma
id|husb
)paren
op_ne
l_int|0
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t claim isoc interface&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|udev
comma
id|isoc_ifnum
comma
id|isoc_alts
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t set isoc interface settings&quot;
)paren
suffix:semicolon
id|husb-&gt;isoc_iface
op_assign
id|isoc_iface
suffix:semicolon
id|usb_driver_release_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|isoc_iface
)paren
suffix:semicolon
id|husb-&gt;isoc_iface
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|husb-&gt;isoc_iface
op_assign
id|isoc_iface
suffix:semicolon
id|husb-&gt;isoc_in_ep
op_assign
id|isoc_in_ep
suffix:semicolon
id|husb-&gt;isoc_out_ep
op_assign
id|isoc_out_ep
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|husb-&gt;completion_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb_queue_head_init
c_func
(paren
op_amp
id|husb-&gt;transmit_q
(braket
id|i
)braket
)paren
suffix:semicolon
id|_urb_queue_init
c_func
(paren
op_amp
id|husb-&gt;pending_q
(braket
id|i
)braket
)paren
suffix:semicolon
id|_urb_queue_init
c_func
(paren
op_amp
id|husb-&gt;completed_q
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize and register HCI device */
id|hdev
op_assign
id|hci_alloc_dev
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdev
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t allocate HCI device&quot;
)paren
suffix:semicolon
r_goto
id|probe_error
suffix:semicolon
)brace
id|husb-&gt;hdev
op_assign
id|hdev
suffix:semicolon
id|hdev-&gt;type
op_assign
id|HCI_USB
suffix:semicolon
id|hdev-&gt;driver_data
op_assign
id|husb
suffix:semicolon
id|SET_HCIDEV_DEV
c_func
(paren
id|hdev
comma
op_amp
id|intf-&gt;dev
)paren
suffix:semicolon
id|hdev-&gt;open
op_assign
id|hci_usb_open
suffix:semicolon
id|hdev-&gt;close
op_assign
id|hci_usb_close
suffix:semicolon
id|hdev-&gt;flush
op_assign
id|hci_usb_flush
suffix:semicolon
id|hdev-&gt;send
op_assign
id|hci_usb_send_frame
suffix:semicolon
id|hdev-&gt;destruct
op_assign
id|hci_usb_destruct
suffix:semicolon
id|hdev-&gt;notify
op_assign
id|hci_usb_notify
suffix:semicolon
id|hdev-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_info
op_amp
id|HCI_RESET
)paren
id|set_bit
c_func
(paren
id|HCI_QUIRK_RESET_ON_INIT
comma
op_amp
id|hdev-&gt;quirks
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hci_register_dev
c_func
(paren
id|hdev
)paren
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t register HCI device&quot;
)paren
suffix:semicolon
id|hci_free_dev
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_goto
id|probe_error
suffix:semicolon
)brace
id|usb_set_intfdata
c_func
(paren
id|intf
comma
id|husb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|probe_error
suffix:colon
r_if
c_cond
(paren
id|husb-&gt;isoc_iface
)paren
id|usb_driver_release_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|husb-&gt;isoc_iface
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|husb
)paren
suffix:semicolon
id|done
suffix:colon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|hci_usb_disconnect
r_static
r_void
id|hci_usb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|husb
op_logical_or
id|intf
op_eq
id|husb-&gt;isoc_iface
)paren
r_return
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
l_int|NULL
)paren
suffix:semicolon
id|hdev
op_assign
id|husb-&gt;hdev
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|hci_usb_close
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|husb-&gt;isoc_iface
)paren
id|usb_driver_release_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|husb-&gt;isoc_iface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hci_unregister_dev
c_func
(paren
id|hdev
)paren
OL
l_int|0
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t unregister HCI device %s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|hci_free_dev
c_func
(paren
id|hdev
)paren
suffix:semicolon
)brace
DECL|variable|hci_usb_driver
r_static
r_struct
id|usb_driver
id|hci_usb_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;hci_usb&quot;
comma
dot
id|probe
op_assign
id|hci_usb_probe
comma
dot
id|disconnect
op_assign
id|hci_usb_disconnect
comma
dot
id|id_table
op_assign
id|bluetooth_ids
comma
)brace
suffix:semicolon
DECL|function|hci_usb_init
r_static
r_int
id|__init
id|hci_usb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|BT_INFO
c_func
(paren
l_string|&quot;HCI USB driver ver %s&quot;
comma
id|VERSION
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|hci_usb_driver
)paren
)paren
OL
l_int|0
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;Failed to register HCI USB driver&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_exit
r_static
r_void
id|__exit
id|hci_usb_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|hci_usb_driver
)paren
suffix:semicolon
)brace
DECL|variable|hci_usb_init
id|module_init
c_func
(paren
id|hci_usb_init
)paren
suffix:semicolon
DECL|variable|hci_usb_exit
id|module_exit
c_func
(paren
id|hci_usb_exit
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BT_HCIUSB_SCO
id|module_param
c_func
(paren
id|isoc
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isoc
comma
l_string|&quot;Set isochronous transfers for SCO over HCI support&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;, Marcel Holtmann &lt;marcel@holtmann.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Bluetooth HCI USB driver ver &quot;
id|VERSION
)paren
suffix:semicolon
DECL|variable|VERSION
id|MODULE_VERSION
c_func
(paren
id|VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
