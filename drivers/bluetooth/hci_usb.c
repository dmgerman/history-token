multiline_comment|/* &n;   BlueZ - Bluetooth protocol stack for Linux&n;   Copyright (C) 2000-2001 Qualcomm Incorporated&n;&n;   Written 2000,2001 by Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License version 2 as&n;   published by the Free Software Foundation;&n;&n;   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS&n;   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&n;   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.&n;   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY&n;   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES &n;   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN &n;   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF &n;   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.&n;&n;   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, &n;   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS &n;   SOFTWARE IS DISCLAIMED.&n;*/
multiline_comment|/*&n; * BlueZ HCI USB driver.&n; * Based on original USB Bluetooth driver for Linux kernel&n; *    Copyright (c) 2000 Greg Kroah-Hartman        &lt;greg@kroah.com&gt;&n; *    Copyright (c) 2000 Mark Douglas Corner       &lt;mcorner@umich.edu&gt;&n; *&n; * $Id: hci_usb.c,v 1.6 2002/04/17 17:37:20 maxk Exp $    &n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;2.0&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;net/bluetooth/bluetooth.h&gt;
macro_line|#include &lt;net/bluetooth/hci_core.h&gt;
macro_line|#include &quot;hci_usb.h&quot;
DECL|macro|HCI_MAX_PENDING
mdefine_line|#define HCI_MAX_PENDING (HCI_MAX_BULK_RX + HCI_MAX_BULK_TX + 1)
macro_line|#ifndef HCI_USB_DEBUG
DECL|macro|BT_DBG
macro_line|#undef  BT_DBG
DECL|macro|BT_DBG
mdefine_line|#define BT_DBG( A... )
DECL|macro|BT_DMP
macro_line|#undef  BT_DMP
DECL|macro|BT_DMP
mdefine_line|#define BT_DMP( A... )
macro_line|#endif
macro_line|#ifndef CONFIG_BLUEZ_USB_ZERO_PACKET
DECL|macro|USB_ZERO_PACKET
macro_line|#undef  USB_ZERO_PACKET
DECL|macro|USB_ZERO_PACKET
mdefine_line|#define USB_ZERO_PACKET 0
macro_line|#endif
DECL|variable|hci_usb_driver
r_static
r_struct
id|usb_driver
id|hci_usb_driver
suffix:semicolon
DECL|variable|usb_bluetooth_ids
r_static
r_struct
id|usb_device_id
id|usb_bluetooth_ids
(braket
)braket
op_assign
(brace
multiline_comment|/* Generic Bluetooth USB device */
(brace
id|USB_DEVICE_INFO
c_func
(paren
id|HCI_DEV_CLASS
comma
id|HCI_DEV_SUBCLASS
comma
id|HCI_DEV_PROTOCOL
)paren
)brace
comma
multiline_comment|/* Ericsson with non-standard id */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0x0bdb
comma
l_int|0x1002
)paren
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|usb
comma
id|usb_bluetooth_ids
)paren
suffix:semicolon
r_static
r_void
id|hci_usb_interrupt
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
suffix:semicolon
r_static
r_void
id|hci_usb_rx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
suffix:semicolon
r_static
r_void
id|hci_usb_tx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
suffix:semicolon
DECL|function|hci_usb_get_completed
r_static
r_struct
id|urb
op_star
id|hci_usb_get_completed
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
op_assign
l_int|NULL
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|husb-&gt;completed_q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|urb
op_assign
(paren
(paren
r_struct
id|hci_usb_scb
op_star
)paren
id|skb-&gt;cb
)paren
op_member_access_from_pointer
id|urb
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
)paren
suffix:semicolon
r_return
id|urb
suffix:semicolon
)brace
DECL|function|hci_usb_enable_intr
r_static
r_int
id|hci_usb_enable_intr
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_int
id|pipe
comma
id|size
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev.name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
op_assign
id|kmalloc
c_func
(paren
id|HCI_MAX_EVENT_SIZE
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|husb-&gt;intr_urb
op_assign
id|urb
suffix:semicolon
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;intr_ep
)paren
suffix:semicolon
id|size
op_assign
id|usb_maxpacket
c_func
(paren
id|husb-&gt;udev
comma
id|pipe
comma
id|usb_pipeout
c_func
(paren
id|pipe
)paren
)paren
suffix:semicolon
id|FILL_INT_URB
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|buf
comma
id|size
comma
id|hci_usb_interrupt
comma
id|husb
comma
id|husb-&gt;intr_interval
)paren
suffix:semicolon
r_return
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_disable_intr
r_static
r_int
id|hci_usb_disable_intr
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|urb
op_star
id|urb
op_assign
id|husb-&gt;intr_urb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev.name
)paren
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|husb-&gt;intr_urb
op_assign
l_int|NULL
suffix:semicolon
id|skb
op_assign
id|husb-&gt;intr_skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|husb-&gt;intr_skb
op_assign
l_int|NULL
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_rx_submit
r_static
r_int
id|hci_usb_rx_submit
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|hci_usb_scb
op_star
id|scb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|pipe
comma
id|size
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
op_logical_and
op_logical_neg
(paren
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|size
op_assign
id|HCI_MAX_FRAME_SIZE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|bluez_skb_alloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
(paren
r_void
op_star
)paren
op_amp
id|husb-&gt;hdev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|HCI_ACLDATA_PKT
suffix:semicolon
id|scb
op_assign
(paren
r_struct
id|hci_usb_scb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|scb-&gt;urb
op_assign
id|urb
suffix:semicolon
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;bulk_in_ep
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|skb-&gt;data
comma
id|size
comma
id|hci_usb_rx_complete
comma
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;pending_q
comma
id|skb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s bulk rx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Initialize device */
DECL|function|hci_usb_open
r_static
r_int
id|hci_usb_open
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
id|err
op_assign
id|hci_usb_enable_intr
c_func
(paren
id|husb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HCI_MAX_BULK_TX
suffix:semicolon
id|i
op_increment
)paren
id|hci_usb_rx_submit
c_func
(paren
id|husb
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|clear_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Reset device */
DECL|function|hci_usb_flush
r_static
r_int
id|hci_usb_flush
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|husb-&gt;cmd_q
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|husb-&gt;acl_q
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_unlink_urbs
r_static
r_inline
r_void
id|hci_usb_unlink_urbs
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev.name
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|husb-&gt;pending_q
)paren
)paren
)paren
(brace
id|urb
op_assign
(paren
(paren
r_struct
id|hci_usb_scb
op_star
)paren
id|skb-&gt;cb
)paren
op_member_access_from_pointer
id|urb
suffix:semicolon
id|usb_unlink_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|urb
op_assign
id|hci_usb_get_completed
c_func
(paren
id|husb
)paren
)paren
)paren
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
)brace
multiline_comment|/* Close device */
DECL|function|hci_usb_close
r_static
r_int
id|hci_usb_close
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_and_clear_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
id|hci_usb_disable_intr
c_func
(paren
id|husb
)paren
suffix:semicolon
id|hci_usb_unlink_urbs
c_func
(paren
id|husb
)paren
suffix:semicolon
id|hci_usb_flush
c_func
(paren
id|hdev
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|husb-&gt;completion_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_send_ctrl
r_static
r_inline
r_int
id|hci_usb_send_ctrl
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_usb_scb
op_star
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
op_assign
id|hci_usb_get_completed
c_func
(paren
id|husb
)paren
suffix:semicolon
r_struct
id|usb_ctrlrequest
op_star
id|cr
suffix:semicolon
r_int
id|pipe
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
op_logical_and
op_logical_neg
(paren
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cr
)paren
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pipe
op_assign
id|usb_sndctrlpipe
c_func
(paren
id|husb-&gt;udev
comma
l_int|0
)paren
suffix:semicolon
id|cr-&gt;bRequestType
op_assign
id|HCI_CTRL_REQ
suffix:semicolon
id|cr-&gt;bRequest
op_assign
l_int|0
suffix:semicolon
id|cr-&gt;wIndex
op_assign
l_int|0
suffix:semicolon
id|cr-&gt;wValue
op_assign
l_int|0
suffix:semicolon
id|cr-&gt;wLength
op_assign
id|__cpu_to_le16
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|FILL_CONTROL_URB
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
(paren
r_void
op_star
)paren
id|cr
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|hci_usb_tx_complete
comma
id|skb
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p len %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|scb-&gt;urb
op_assign
id|urb
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;pending_q
comma
id|skb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s ctrl tx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cr
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_send_bulk
r_static
r_inline
r_int
id|hci_usb_send_bulk
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_usb_scb
op_star
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|urb
op_star
id|urb
op_assign
id|hci_usb_get_completed
c_func
(paren
id|husb
)paren
suffix:semicolon
r_int
id|pipe
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb
op_logical_and
op_logical_neg
(paren
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|husb-&gt;udev
comma
id|husb-&gt;bulk_out_ep
)paren
suffix:semicolon
id|FILL_BULK_URB
c_func
(paren
id|urb
comma
id|husb-&gt;udev
comma
id|pipe
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|hci_usb_tx_complete
comma
id|skb
)paren
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|USB_ZERO_PACKET
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p len %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|scb-&gt;urb
op_assign
id|urb
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;pending_q
comma
id|skb
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s bulk tx submit failed urb %p err %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|err
)paren
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|urb
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_tx_process
r_static
r_void
id|hci_usb_tx_process
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|husb-&gt;hdev.name
)paren
suffix:semicolon
r_do
(brace
id|clear_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
multiline_comment|/* Process ACL queue */
r_while
c_loop
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|husb-&gt;pending_q
)paren
OL
id|HCI_MAX_PENDING
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|husb-&gt;acl_q
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|hci_usb_send_bulk
c_func
(paren
id|husb
comma
id|skb
)paren
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|husb-&gt;acl_q
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Process command queue */
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_USB_CTRL_TX
comma
op_amp
id|husb-&gt;state
)paren
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|husb-&gt;cmd_q
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|set_bit
c_func
(paren
id|HCI_USB_CTRL_TX
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hci_usb_send_ctrl
c_func
(paren
id|husb
comma
id|skb
)paren
OL
l_int|0
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|husb-&gt;cmd_q
comma
id|skb
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_USB_CTRL_TX
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|test_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|hci_usb_tx_wakeup
r_static
r_inline
r_void
id|hci_usb_tx_wakeup
c_func
(paren
r_struct
id|hci_usb
op_star
id|husb
)paren
(brace
multiline_comment|/* Serialize TX queue processing to avoid data reordering */
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|HCI_USB_TX_PROCESS
comma
op_amp
id|husb-&gt;state
)paren
)paren
(brace
id|hci_usb_tx_process
c_func
(paren
id|husb
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_USB_TX_PROCESS
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
r_else
id|set_bit
c_func
(paren
id|HCI_USB_TX_WAKEUP
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
multiline_comment|/* Send frames from HCI layer */
DECL|function|hci_usb_send_frame
r_int
id|hci_usb_send_frame
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|hci_dev
op_star
id|hdev
op_assign
(paren
r_struct
id|hci_dev
op_star
)paren
id|skb-&gt;dev
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdev
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;frame for uknown device (hdev=NULL)&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s type %d len %d&quot;
comma
id|hdev-&gt;name
comma
id|skb-&gt;pkt_type
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|skb-&gt;pkt_type
)paren
(brace
r_case
id|HCI_COMMAND_PKT
suffix:colon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;cmd_q
comma
id|skb
)paren
suffix:semicolon
id|hdev-&gt;stat.cmd_tx
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_ACLDATA_PKT
suffix:colon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;acl_q
comma
id|skb
)paren
suffix:semicolon
id|hdev-&gt;stat.acl_tx
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HCI_SCODATA_PKT
suffix:colon
r_default
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hci_usb_tx_wakeup
c_func
(paren
id|husb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hci_usb_interrupt
r_static
r_void
id|hci_usb_interrupt
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_void
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|hci_usb_scb
op_star
id|scb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|hci_event_hdr
op_star
id|eh
suffix:semicolon
id|__u8
op_star
id|data
op_assign
id|urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|count
op_assign
id|urb-&gt;actual_length
suffix:semicolon
r_int
id|len
op_assign
id|HCI_EVENT_HDR_SIZE
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p count %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|husb-&gt;hdev.flags
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_logical_or
op_logical_neg
id|count
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;%s intr status %d, count %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb-&gt;status
comma
id|count
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
id|husb-&gt;hdev.stat.byte_rx
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|husb-&gt;intr_skb
)paren
)paren
(brace
multiline_comment|/* Start of the frame */
r_if
c_cond
(paren
id|count
OL
id|HCI_EVENT_HDR_SIZE
)paren
r_goto
id|bad_len
suffix:semicolon
id|eh
op_assign
(paren
id|hci_event_hdr
op_star
)paren
id|data
suffix:semicolon
id|len
op_assign
id|eh-&gt;plen
op_plus
id|HCI_EVENT_HDR_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|len
)paren
r_goto
id|bad_len
suffix:semicolon
id|skb
op_assign
id|bluez_skb_alloc
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s no memory for event packet&quot;
comma
id|husb-&gt;hdev.name
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|skb-&gt;dev
op_assign
(paren
r_void
op_star
)paren
op_amp
id|husb-&gt;hdev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|HCI_EVENT_PKT
suffix:semicolon
id|husb-&gt;intr_skb
op_assign
id|skb
suffix:semicolon
id|scb-&gt;intr_len
op_assign
id|len
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Continuation */
id|scb
op_assign
(paren
r_void
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|len
op_assign
id|scb-&gt;intr_len
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|len
)paren
(brace
id|husb-&gt;intr_skb
op_assign
l_int|NULL
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|bad_len
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|data
comma
id|count
)paren
suffix:semicolon
id|scb-&gt;intr_len
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scb-&gt;intr_len
)paren
(brace
multiline_comment|/* Complete frame */
id|husb-&gt;intr_skb
op_assign
l_int|NULL
suffix:semicolon
id|hci_recv_frame
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
id|bad_len
suffix:colon
id|BT_ERR
c_func
(paren
l_string|&quot;%s bad frame len %d expected %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|count
comma
id|len
)paren
suffix:semicolon
id|husb-&gt;hdev.stat.err_rx
op_increment
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_tx_complete
r_static
r_void
id|hci_usb_tx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
op_assign
(paren
r_struct
id|hci_dev
op_star
)paren
id|skb-&gt;dev
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p status %d flags %x&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|urb-&gt;status
comma
id|urb-&gt;transfer_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;pipe
op_eq
id|usb_sndctrlpipe
c_func
(paren
id|husb-&gt;udev
comma
l_int|0
)paren
)paren
(brace
id|kfree
c_func
(paren
id|urb-&gt;setup_packet
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|HCI_USB_CTRL_TX
comma
op_amp
id|husb-&gt;state
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|urb-&gt;status
)paren
id|husb-&gt;hdev.stat.byte_tx
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_else
id|husb-&gt;hdev.stat.err_tx
op_increment
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|husb-&gt;completed_q
comma
id|skb
)paren
suffix:semicolon
id|hci_usb_tx_wakeup
c_func
(paren
id|husb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hci_usb_rx_complete
r_static
r_void
id|hci_usb_rx_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|urb-&gt;context
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
op_assign
(paren
r_struct
id|hci_dev
op_star
)paren
id|skb-&gt;dev
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
r_int
id|status
comma
id|count
op_assign
id|urb-&gt;actual_length
suffix:semicolon
id|hci_acl_hdr
op_star
id|ah
suffix:semicolon
r_int
id|dlen
comma
id|size
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s urb %p status %d count %d flags %x&quot;
comma
id|husb-&gt;hdev.name
comma
id|urb
comma
id|urb-&gt;status
comma
id|count
comma
id|urb-&gt;transfer_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|HCI_RUNNING
comma
op_amp
id|hdev-&gt;flags
)paren
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_logical_or
op_logical_neg
id|count
)paren
r_goto
id|resubmit
suffix:semicolon
id|husb-&gt;hdev.stat.byte_rx
op_add_assign
id|count
suffix:semicolon
id|ah
op_assign
(paren
id|hci_acl_hdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|dlen
op_assign
id|__le16_to_cpu
c_func
(paren
id|ah-&gt;dlen
)paren
suffix:semicolon
id|size
op_assign
id|HCI_ACL_HDR_SIZE
op_plus
id|dlen
suffix:semicolon
multiline_comment|/* Verify frame len and completeness */
r_if
c_cond
(paren
id|count
op_ne
id|size
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;%s corrupted ACL packet: count %d, dlen %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|count
comma
id|dlen
)paren
suffix:semicolon
id|bluez_dump
c_func
(paren
l_string|&quot;hci_usb&quot;
comma
id|skb-&gt;data
comma
id|count
)paren
suffix:semicolon
id|husb-&gt;hdev.stat.err_rx
op_increment
suffix:semicolon
r_goto
id|resubmit
suffix:semicolon
)brace
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
suffix:semicolon
id|hci_recv_frame
c_func
(paren
id|skb
)paren
suffix:semicolon
id|hci_usb_rx_submit
c_func
(paren
id|husb
comma
id|urb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
id|resubmit
suffix:colon
id|urb-&gt;dev
op_assign
id|husb-&gt;udev
suffix:semicolon
id|status
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s URB resubmit status %d&quot;
comma
id|husb-&gt;hdev.name
comma
id|status
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|husb-&gt;completion_lock
)paren
suffix:semicolon
)brace
DECL|function|hci_usb_destruct
r_static
r_void
id|hci_usb_destruct
c_func
(paren
r_struct
id|hci_dev
op_star
id|hdev
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdev
)paren
r_return
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|husb
op_assign
(paren
r_struct
id|hci_usb
op_star
)paren
id|hdev-&gt;driver_data
suffix:semicolon
id|kfree
c_func
(paren
id|husb
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLUEZ_USB_FW_LOAD
multiline_comment|/* Support for user mode Bluetooth USB firmware loader */
DECL|macro|FW_LOADER
mdefine_line|#define FW_LOADER &quot;/sbin/bluefw&quot;
DECL|variable|errno
r_static
r_int
id|errno
suffix:semicolon
DECL|function|hci_usb_fw_exec
r_static
r_int
id|hci_usb_fw_exec
c_func
(paren
r_void
op_star
id|dev
)paren
(brace
r_char
op_star
id|envp
(braket
)braket
op_assign
(brace
l_string|&quot;HOME=/&quot;
comma
l_string|&quot;TERM=linux&quot;
comma
l_string|&quot;PATH=/sbin:/usr/sbin:/bin:/usr/bin&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
id|FW_LOADER
comma
id|dev
comma
l_int|NULL
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|exec_usermodehelper
c_func
(paren
id|FW_LOADER
comma
id|argv
comma
id|envp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;failed to exec %s %s&quot;
comma
id|FW_LOADER
comma
(paren
r_char
op_star
)paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_fw_load
r_static
r_int
id|hci_usb_fw_load
c_func
(paren
r_struct
id|usb_device
op_star
id|udev
)paren
(brace
id|sigset_t
id|tmpsig
suffix:semicolon
r_char
id|dev
(braket
l_int|16
)braket
suffix:semicolon
id|pid_t
id|pid
suffix:semicolon
r_int
id|result
suffix:semicolon
multiline_comment|/* Check if root fs is mounted */
r_if
c_cond
(paren
op_logical_neg
id|current-&gt;fs-&gt;root
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;root fs not mounted&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dev
comma
l_string|&quot;%3.3d/%3.3d&quot;
comma
id|udev-&gt;bus-&gt;busnum
comma
id|udev-&gt;devnum
)paren
suffix:semicolon
id|pid
op_assign
id|kernel_thread
c_func
(paren
id|hci_usb_fw_exec
comma
(paren
r_void
op_star
)paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;fork failed, errno %d&bslash;n&quot;
comma
op_minus
id|pid
)paren
suffix:semicolon
r_return
id|pid
suffix:semicolon
)brace
multiline_comment|/* Block signals, everything but SIGKILL/SIGSTOP */
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|tmpsig
op_assign
id|current-&gt;blocked
suffix:semicolon
id|siginitsetinv
c_func
(paren
op_amp
id|current-&gt;blocked
comma
id|sigmask
c_func
(paren
id|SIGKILL
)paren
op_or
id|sigmask
c_func
(paren
id|SIGSTOP
)paren
)paren
suffix:semicolon
id|recalc_sigpending
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|result
op_assign
id|waitpid
c_func
(paren
id|pid
comma
l_int|NULL
comma
id|__WCLONE
)paren
suffix:semicolon
multiline_comment|/* Allow signals again */
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|current-&gt;blocked
op_assign
id|tmpsig
suffix:semicolon
id|recalc_sigpending
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
id|pid
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;waitpid failed pid %d errno %d&bslash;n&quot;
comma
id|pid
comma
op_minus
id|result
)paren
suffix:semicolon
r_return
op_minus
id|result
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_BLUEZ_USB_FW_LOAD */
DECL|function|hci_usb_probe
r_static
r_int
id|hci_usb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|bulk_out_ep
(braket
id|HCI_MAX_IFACE_NUM
)braket
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|isoc_out_ep
(braket
id|HCI_MAX_IFACE_NUM
)braket
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|bulk_in_ep
(braket
id|HCI_MAX_IFACE_NUM
)braket
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|isoc_in_ep
(braket
id|HCI_MAX_IFACE_NUM
)braket
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|intr_in_ep
(braket
id|HCI_MAX_IFACE_NUM
)braket
suffix:semicolon
r_struct
id|usb_interface_descriptor
op_star
id|uif
suffix:semicolon
r_struct
id|usb_endpoint_descriptor
op_star
id|ep
suffix:semicolon
r_struct
id|usb_interface
op_star
id|iface
comma
op_star
id|isoc_iface
suffix:semicolon
r_struct
id|hci_usb
op_star
id|husb
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
suffix:semicolon
r_int
id|i
comma
id|a
comma
id|e
comma
id|size
comma
id|ifn
comma
id|isoc_ifnum
comma
id|isoc_alts
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;intf %p&quot;
comma
id|intf
)paren
suffix:semicolon
multiline_comment|/* Check number of endpoints */
r_if
c_cond
(paren
id|intf-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bNumEndpoints
OL
l_int|3
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#ifdef CONFIG_BLUEZ_USB_FW_LOAD
id|hci_usb_fw_load
c_func
(paren
id|udev
)paren
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|bulk_out_ep
comma
l_int|0
comma
r_sizeof
(paren
id|bulk_out_ep
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|isoc_out_ep
comma
l_int|0
comma
r_sizeof
(paren
id|isoc_out_ep
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|bulk_in_ep
comma
l_int|0
comma
r_sizeof
(paren
id|bulk_in_ep
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|isoc_in_ep
comma
l_int|0
comma
r_sizeof
(paren
id|isoc_in_ep
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|intr_in_ep
comma
l_int|0
comma
r_sizeof
(paren
id|intr_in_ep
)paren
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|isoc_iface
op_assign
l_int|NULL
suffix:semicolon
id|isoc_alts
op_assign
id|isoc_ifnum
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Find endpoints that we need */
id|ifn
op_assign
id|MIN
c_func
(paren
id|udev-&gt;actconfig-&gt;bNumInterfaces
comma
id|HCI_MAX_IFACE_NUM
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ifn
suffix:semicolon
id|i
op_increment
)paren
(brace
id|iface
op_assign
op_amp
id|udev-&gt;actconfig-&gt;interface
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|a
op_assign
l_int|0
suffix:semicolon
id|a
OL
id|iface-&gt;num_altsetting
suffix:semicolon
id|a
op_increment
)paren
(brace
id|uif
op_assign
op_amp
id|iface-&gt;altsetting
(braket
id|a
)braket
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|uif-&gt;bNumEndpoints
suffix:semicolon
id|e
op_increment
)paren
(brace
id|ep
op_assign
op_amp
id|uif-&gt;endpoint
(braket
id|e
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ep-&gt;bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
(brace
r_case
id|USB_ENDPOINT_XFER_INT
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|intr_in_ep
(braket
id|i
)braket
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
r_case
id|USB_ENDPOINT_XFER_BULK
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|bulk_in_ep
(braket
id|i
)braket
op_assign
id|ep
suffix:semicolon
r_else
id|bulk_out_ep
(braket
id|i
)braket
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
r_case
id|USB_ENDPOINT_XFER_ISOC
suffix:colon
r_if
c_cond
(paren
id|ep-&gt;wMaxPacketSize
OL
id|size
)paren
r_break
suffix:semicolon
id|size
op_assign
id|ep-&gt;wMaxPacketSize
suffix:semicolon
id|isoc_iface
op_assign
id|iface
suffix:semicolon
id|isoc_alts
op_assign
id|a
suffix:semicolon
id|isoc_ifnum
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
id|isoc_in_ep
(braket
id|i
)braket
op_assign
id|ep
suffix:semicolon
r_else
id|isoc_out_ep
(braket
id|i
)braket
op_assign
id|ep
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|bulk_in_ep
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
id|bulk_out_ep
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
id|intr_in_ep
(braket
l_int|0
)braket
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;Bulk endpoints not found&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|isoc_in_ep
(braket
l_int|1
)braket
op_logical_or
op_logical_neg
id|isoc_out_ep
(braket
l_int|1
)braket
)paren
(brace
id|BT_DBG
c_func
(paren
l_string|&quot;Isoc endpoints not found&quot;
)paren
suffix:semicolon
id|isoc_iface
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|husb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hci_usb
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t allocate: control structure&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|memset
c_func
(paren
id|husb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hci_usb
)paren
)paren
suffix:semicolon
id|husb-&gt;udev
op_assign
id|udev
suffix:semicolon
id|husb-&gt;bulk_out_ep
op_assign
id|bulk_out_ep
(braket
l_int|0
)braket
op_member_access_from_pointer
id|bEndpointAddress
suffix:semicolon
id|husb-&gt;bulk_in_ep
op_assign
id|bulk_in_ep
(braket
l_int|0
)braket
op_member_access_from_pointer
id|bEndpointAddress
suffix:semicolon
id|husb-&gt;intr_ep
op_assign
id|intr_in_ep
(braket
l_int|0
)braket
op_member_access_from_pointer
id|bEndpointAddress
suffix:semicolon
id|husb-&gt;intr_interval
op_assign
id|intr_in_ep
(braket
l_int|0
)braket
op_member_access_from_pointer
id|bInterval
suffix:semicolon
r_if
c_cond
(paren
id|isoc_iface
)paren
(brace
r_if
c_cond
(paren
id|usb_set_interface
c_func
(paren
id|udev
comma
id|isoc_ifnum
comma
id|isoc_alts
)paren
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t set isoc interface settings&quot;
)paren
suffix:semicolon
id|isoc_iface
op_assign
l_int|NULL
suffix:semicolon
)brace
id|usb_driver_claim_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|isoc_iface
comma
id|husb
)paren
suffix:semicolon
id|husb-&gt;isoc_iface
op_assign
id|isoc_iface
suffix:semicolon
id|husb-&gt;isoc_in_ep
op_assign
id|isoc_in_ep
(braket
l_int|1
)braket
op_member_access_from_pointer
id|bEndpointAddress
suffix:semicolon
id|husb-&gt;isoc_out_ep
op_assign
id|isoc_in_ep
(braket
l_int|1
)braket
op_member_access_from_pointer
id|bEndpointAddress
suffix:semicolon
)brace
id|husb-&gt;completion_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|husb-&gt;acl_q
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|husb-&gt;cmd_q
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|husb-&gt;pending_q
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|husb-&gt;completed_q
)paren
suffix:semicolon
multiline_comment|/* Initialize and register HCI device */
id|hdev
op_assign
op_amp
id|husb-&gt;hdev
suffix:semicolon
id|hdev-&gt;type
op_assign
id|HCI_USB
suffix:semicolon
id|hdev-&gt;driver_data
op_assign
id|husb
suffix:semicolon
id|hdev-&gt;open
op_assign
id|hci_usb_open
suffix:semicolon
id|hdev-&gt;close
op_assign
id|hci_usb_close
suffix:semicolon
id|hdev-&gt;flush
op_assign
id|hci_usb_flush
suffix:semicolon
id|hdev-&gt;send
op_assign
id|hci_usb_send_frame
suffix:semicolon
id|hdev-&gt;destruct
op_assign
id|hci_usb_destruct
suffix:semicolon
r_if
c_cond
(paren
id|hci_register_dev
c_func
(paren
id|hdev
)paren
OL
l_int|0
)paren
(brace
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t register HCI device&quot;
)paren
suffix:semicolon
r_goto
id|probe_error
suffix:semicolon
)brace
id|dev_set_drvdata
c_func
(paren
op_amp
id|intf-&gt;dev
comma
id|husb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|probe_error
suffix:colon
id|kfree
c_func
(paren
id|husb
)paren
suffix:semicolon
id|done
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|hci_usb_disconnect
r_static
r_void
id|hci_usb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|hci_usb
op_star
id|husb
op_assign
id|dev_get_drvdata
c_func
(paren
op_amp
id|intf-&gt;dev
)paren
suffix:semicolon
r_struct
id|hci_dev
op_star
id|hdev
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
op_amp
id|intf-&gt;dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|husb
)paren
r_return
suffix:semicolon
id|hdev
op_assign
op_amp
id|husb-&gt;hdev
suffix:semicolon
id|BT_DBG
c_func
(paren
l_string|&quot;%s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
id|hci_usb_close
c_func
(paren
id|hdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|husb-&gt;isoc_iface
)paren
id|usb_driver_release_interface
c_func
(paren
op_amp
id|hci_usb_driver
comma
id|husb-&gt;isoc_iface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hci_unregister_dev
c_func
(paren
id|hdev
)paren
OL
l_int|0
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;Can&squot;t unregister HCI device %s&quot;
comma
id|hdev-&gt;name
)paren
suffix:semicolon
)brace
DECL|variable|hci_usb_driver
r_static
r_struct
id|usb_driver
id|hci_usb_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;hci_usb&quot;
comma
id|probe
suffix:colon
id|hci_usb_probe
comma
id|disconnect
suffix:colon
id|hci_usb_disconnect
comma
id|id_table
suffix:colon
id|usb_bluetooth_ids
comma
)brace
suffix:semicolon
DECL|function|hci_usb_init
r_int
id|hci_usb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|BT_INFO
c_func
(paren
l_string|&quot;BlueZ HCI USB driver ver %s Copyright (C) 2000,2001 Qualcomm Inc&quot;
comma
id|VERSION
)paren
suffix:semicolon
id|BT_INFO
c_func
(paren
l_string|&quot;Written 2000,2001 by Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|hci_usb_driver
)paren
)paren
OL
l_int|0
)paren
id|BT_ERR
c_func
(paren
l_string|&quot;Failed to register HCI USB driver&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|hci_usb_cleanup
r_void
id|hci_usb_cleanup
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|hci_usb_driver
)paren
suffix:semicolon
)brace
DECL|variable|hci_usb_init
id|module_init
c_func
(paren
id|hci_usb_init
)paren
suffix:semicolon
DECL|variable|hci_usb_cleanup
id|module_exit
c_func
(paren
id|hci_usb_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;BlueZ HCI USB driver ver &quot;
id|VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
